[{"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7263", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7263/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7263/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7263/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7263", "id": 1687397827, "node_id": "I_kwDOAMpNN85kk6XD", "number": 7263, "title": "OverflowError: Python int too large to convert to C ssize_t when serving a 10GiB file", "user": {"login": "paroga", "id": 337009, "node_id": "MDQ6VXNlcjMzNzAwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/337009?v=4", "gravatar_id": "", "url": "https://api.github.com/users/paroga", "html_url": "https://github.com/paroga", "followers_url": "https://api.github.com/users/paroga/followers", "following_url": "https://api.github.com/users/paroga/following{/other_user}", "gists_url": "https://api.github.com/users/paroga/gists{/gist_id}", "starred_url": "https://api.github.com/users/paroga/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/paroga/subscriptions", "organizations_url": "https://api.github.com/users/paroga/orgs", "repos_url": "https://api.github.com/users/paroga/repos", "events_url": "https://api.github.com/users/paroga/events{/privacy}", "received_events_url": "https://api.github.com/users/paroga/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-04-27T18:57:48Z", "updated_at": "2023-04-28T18:59:04Z", "closed_at": "2023-04-28T18:59:04Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nWhen serving a static file with _10912798008 bytes_ an `OverflowError` is thrown. It looks to me that the limit of a 32bit integer is reached.\r\n\r\nWith `AIOHTTP_NOSENDFILE=1` the file is served as expected.\r\n\r\n\r\n### To Reproduce\r\n\r\nUse the following `Dockerfile` and `app.py` and access an file with _10912798008 bytes_ via HTTP.\r\n\r\n```Dockerfile\r\n# Dockerfile\r\n\r\nFROM alpine:edge\r\n\r\nRUN apk add py3-aiohttp py3-pip\r\n\r\nADD app.py .\r\n\r\nCMD [\"python\", \"app.py\"]\r\n```\r\n\r\n```python\r\n# app.py\r\n\r\nfrom aiohttp import web\r\n\r\napp = web.Application()\r\napp.add_routes([web.static(\"/static\", \"/work/static\")])\r\n\r\nif __name__ == \"__main__\":\r\n    web.run_app(app)\r\n```\r\n\r\n### Expected behavior\r\n\r\nNo exception. :wink: \r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3.11/site-packages/aiohttp/web_protocol.py\", line 512, in start\r\n    resp, reset = await task\r\n                  ^^^^^^^^^^\r\n  File \"/usr/lib/python3.11/site-packages/aiohttp/web_protocol.py\", line 458, in _handle_request\r\n    reset = await self.finish_response(request, resp, start_time)\r\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/usr/lib/python3.11/site-packages/aiohttp/web_protocol.py\", line 611, in finish_response\r\n    await prepare_meth(request)\r\n  File \"/usr/lib/python3.11/site-packages/aiohttp/web_fileresponse.py\", line 286, in prepare\r\n    return await self._sendfile(request, fobj, offset, count)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/usr/lib/python3.11/site-packages/aiohttp/web_fileresponse.py\", line 99, in _sendfile\r\n    await loop.sendfile(transport, fobj, offset, count)\r\n  File \"/usr/lib/python3.11/asyncio/base_events.py\", line 1185, in sendfile\r\n    return await self._sendfile_native(transport, file,\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/usr/lib/python3.11/asyncio/selector_events.py\", line 725, in _sendfile_native\r\n    return await self.sock_sendfile(transp._sock, file, offset, count,\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/usr/lib/python3.11/asyncio/base_events.py\", line 881, in sock_sendfile\r\n    return await self._sock_sendfile_native(sock, file,\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/usr/lib/python3.11/asyncio/unix_events.py\", line 373, in _sock_sendfile_native\r\n    return await fut\r\n           ^^^^^^^^^\r\n  File \"/usr/lib/python3.11/asyncio/unix_events.py\", line 395, in _sock_sendfile_native_impl\r\n    sent = os.sendfile(fd, fileno, offset, blocksize)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\nOverflowError: Python int too large to convert to C ssize_t\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n$ python --version\r\nPython 3.11.3\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.8.4\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: \r\nAuthor-email: \r\nLicense: Apache 2\r\nLocation: /usr/lib/python3.11/site-packages\r\nRequires: aiosignal, async_timeout, attrs, charset-normalizer, frozenlist, multidict, yarl\r\nRequired-by:\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 6.0.4\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/lib/python3.11/site-packages\r\nRequires: \r\nRequired-by: aiohttp, yarl\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.9.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache-2.0\r\nLocation: /usr/lib/python3.11/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\r\n### OS\r\n\r\n```console\r\n$ uname -a\r\nLinux 64fea89ba9a5 6.1.21-v8+ #1642 SMP PREEMPT Mon Apr  3 17:24:16 BST 2023 aarch64 Linux\r\n```\r\n\r\n### Related component\r\n\r\nServer\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7263/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7263/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7243", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7243/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7243/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7243/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7243", "id": 1645642468, "node_id": "I_kwDOAMpNN85iFoLk", "number": 7243, "title": "Websocket client send wrong Connection header", "user": {"login": "liewhite", "id": 7992884, "node_id": "MDQ6VXNlcjc5OTI4ODQ=", "avatar_url": "https://avatars.githubusercontent.com/u/7992884?v=4", "gravatar_id": "", "url": "https://api.github.com/users/liewhite", "html_url": "https://github.com/liewhite", "followers_url": "https://api.github.com/users/liewhite/followers", "following_url": "https://api.github.com/users/liewhite/following{/other_user}", "gists_url": "https://api.github.com/users/liewhite/gists{/gist_id}", "starred_url": "https://api.github.com/users/liewhite/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/liewhite/subscriptions", "organizations_url": "https://api.github.com/users/liewhite/orgs", "repos_url": "https://api.github.com/users/liewhite/repos", "events_url": "https://api.github.com/users/liewhite/events{/privacy}", "received_events_url": "https://api.github.com/users/liewhite/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-03-29T11:52:00Z", "updated_at": "2023-03-29T18:05:41Z", "closed_at": "2023-03-29T18:05:41Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Describe the bug\n\nIn websocket standard , the `Connection` header shoule be `Upgrade`, but we send a `upgrade` . \r\nIt's a lowercase word.\n\n### To Reproduce\n\nconnect to server with strict case sensitive checking will failed\n\n### Expected behavior\n\nSend a \r\n`Connection: Upgrade`\r\nheader\n\n### Logs/tracebacks\n\n```python-traceback\nno traceback\n```\n\n\n### Python Version\n\n```console\nPython 3.8.16\n```\n\n\n### aiohttp Version\n\n```console\nName: aiohttp\r\nVersion: 3.8.4\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: \r\nAuthor-email: \r\nLicense: Apache 2\r\nLocation: /opt/homebrew/lib/python3.8/site-packages\r\nRequires: aiosignal, async-timeout, attrs, charset-normalizer, frozenlist, multidict, yarl\r\nRequired-by: web3\n```\n\n\n### multidict Version\n\n```console\nName: multidict\r\nVersion: 6.0.4\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /opt/homebrew/lib/python3.8/site-packages\r\nRequires: \r\nRequired-by: aiohttp, yarl\n```\n\n\n### yarl Version\n\n```console\nName: yarl\r\nVersion: 1.8.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /opt/homebrew/lib/python3.8/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp, gql\n```\n\n\n### OS\n\nMacOs\n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7243/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7243/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7242", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7242/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7242/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7242/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7242", "id": 1641305438, "node_id": "I_kwDOAMpNN85h1FVe", "number": 7242, "title": "Using web.FileResponse to send an empty file causes an error", "user": {"login": "ddurham2", "id": 4805134, "node_id": "MDQ6VXNlcjQ4MDUxMzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4805134?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ddurham2", "html_url": "https://github.com/ddurham2", "followers_url": "https://api.github.com/users/ddurham2/followers", "following_url": "https://api.github.com/users/ddurham2/following{/other_user}", "gists_url": "https://api.github.com/users/ddurham2/gists{/gist_id}", "starred_url": "https://api.github.com/users/ddurham2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ddurham2/subscriptions", "organizations_url": "https://api.github.com/users/ddurham2/orgs", "repos_url": "https://api.github.com/users/ddurham2/repos", "events_url": "https://api.github.com/users/ddurham2/events{/privacy}", "received_events_url": "https://api.github.com/users/ddurham2/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-03-27T03:33:58Z", "updated_at": "2023-04-26T03:52:45Z", "closed_at": "2023-04-26T03:52:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nIf a web.FileResponse() is used to send an empty file, then the following stack trace is raise...\r\n```\r\n  File \\\"/usr/local/lib/python3.8/dist-packages/aiohttp/web_protocol.py\\\", line 485, in start\r\n    resp, reset = await task\r\n  File \\\"/usr/local/lib/python3.8/dist-packages/aiohttp/web_protocol.py\\\", line 440, in _handle_request\r\n    reset = await self.finish_response(request, resp, start_time)\r\n  File \\\"/usr/local/lib/python3.8/dist-packages/aiohttp/web_protocol.py\\\", line 591, in finish_response\r\n    await prepare_meth(request)\r\n  File \\\"/usr/local/lib/python3.8/dist-packages/aiohttp/web_fileresponse.py\\\", line 241, in prepare\r\n    return await self._sendfile(request, fobj, offset, count)\r\n  File \\\"/usr/local/lib/python3.8/dist-packages/aiohttp/web_fileresponse.py\\\", line 96, in _sendfile\r\n    await loop.sendfile(transport, fobj, offset, count)\r\n  File \\\"/usr/lib/python3.8/asyncio/base_events.py\\\", line 1120, in sendfile\r\n    return await self._sendfile_native(transport, file,\r\n  File \\\"/usr/lib/python3.8/asyncio/selector_events.py\\\", line 578, in _sendfile_native\r\n    return await self.sock_sendfile(transp._sock, file, offset, count,\r\n  File \\\"/usr/lib/python3.8/asyncio/base_events.py\\\", line 836, in sock_sendfile\r\n    self._check_sendfile_params(sock, file, offset, count)\r\n  File \\\"/usr/lib/python3.8/asyncio/base_events.py\\\", line 889, in _check_sendfile_params\r\n    raise ValueError(\r\n```\r\n\r\nSo, it's actually an error to call asyncio's sendfile() function with 0 bytes.. which seems like something they would have short-circuited on purpose, but apparently have not.\r\n\r\nNevertheless, it was easily fixed in web.file_response.py ~96 just to add an `if count > 0` around calling sendfile.  And that resulted in the expected 200 response with content-length of 0.\r\n\r\n\r\n### To Reproduce\r\n\r\nreturn web.FileResponse(path=\"/dev/null\")\r\nor \r\nreturn web.FileResponse(path=\"/path/to/requested-resource/that-happens/to-have-zero-size\")\r\n\r\n### Expected behavior\r\n\r\ncorrect 200 response just with 0 length.\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nFile \\\"/usr/local/lib/python3.8/dist-packages/aiohttp/web_protocol.py\\\", line 485, in start\r\n    resp, reset = await task\r\n  File \\\"/usr/local/lib/python3.8/dist-packages/aiohttp/web_protocol.py\\\", line 440, in _handle_request\r\n    reset = await self.finish_response(request, resp, start_time)\r\n  File \\\"/usr/local/lib/python3.8/dist-packages/aiohttp/web_protocol.py\\\", line 591, in finish_response\r\n    await prepare_meth(request)\r\n  File \\\"/usr/local/lib/python3.8/dist-packages/aiohttp/web_fileresponse.py\\\", line 241, in prepare\r\n    return await self._sendfile(request, fobj, offset, count)\r\n  File \\\"/usr/local/lib/python3.8/dist-packages/aiohttp/web_fileresponse.py\\\", line 96, in _sendfile\r\n    await loop.sendfile(transport, fobj, offset, count)\r\n  File \\\"/usr/lib/python3.8/asyncio/base_events.py\\\", line 1120, in sendfile\r\n    return await self._sendfile_native(transport, file,\r\n  File \\\"/usr/lib/python3.8/asyncio/selector_events.py\\\", line 578, in _sendfile_native\r\n    return await self.sock_sendfile(transp._sock, file, offset, count,\r\n  File \\\"/usr/lib/python3.8/asyncio/base_events.py\\\", line 836, in sock_sendfile\r\n    self._check_sendfile_params(sock, file, offset, count)\r\n  File \\\"/usr/lib/python3.8/asyncio/base_events.py\\\", line 889, in _check_sendfile_params\r\n    raise ValueError(\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n$ python --version\r\nPython 3.8.10\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.8.4\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: None\r\nAuthor-email: None\r\nLicense: Apache 2\r\nLocation: /usr/local/lib/python3.8/dist-packages\r\nRequires: charset-normalizer, frozenlist, attrs, async-timeout, multidict, aiosignal, yarl\r\nRequired-by: pyht, keycloak-api, htdm, aiohttp-jinja2\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 6.0.4\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/local/lib/python3.8/dist-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.8.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/local/lib/python3.8/dist-packages\r\nRequires: multidict, idna\r\nRequired-by: aiohttp\r\n```\r\n\r\n\r\n### OS\r\n\r\nuname -a\r\nLinux myhost 5.10.0-0.deb10.17-amd64 #1 SMP Debian 5.10.136-1~deb10u3 (2022-09-06) x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n### Related component\r\n\r\nServer\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7242/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7242/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7241", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7241/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7241/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7241/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7241", "id": 1639544092, "node_id": "I_kwDOAMpNN85huXUc", "number": 7241, "title": "possibly malformed sslcontext breaks server responses without any error", "user": {"login": "dotSynergy", "id": 39027216, "node_id": "MDQ6VXNlcjM5MDI3MjE2", "avatar_url": "https://avatars.githubusercontent.com/u/39027216?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dotSynergy", "html_url": "https://github.com/dotSynergy", "followers_url": "https://api.github.com/users/dotSynergy/followers", "following_url": "https://api.github.com/users/dotSynergy/following{/other_user}", "gists_url": "https://api.github.com/users/dotSynergy/gists{/gist_id}", "starred_url": "https://api.github.com/users/dotSynergy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dotSynergy/subscriptions", "organizations_url": "https://api.github.com/users/dotSynergy/orgs", "repos_url": "https://api.github.com/users/dotSynergy/repos", "events_url": "https://api.github.com/users/dotSynergy/events{/privacy}", "received_events_url": "https://api.github.com/users/dotSynergy/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-03-24T14:53:02Z", "updated_at": "2023-03-28T17:00:22Z", "closed_at": "2023-03-27T20:03:22Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\ni'm running aiohttp only to serve a redirect so a reverse proxy wasn't an option, and i wanted to replace an older raw tcp implementation with aiohttp, however by leaving my previous ssl context code somehow i only got empty body responses.\r\nssl negotiation and header would look fine, until (using curl): `curl: (52) Empty reply from server` and connection would close.\r\n\r\nthe error, minus ssl, looks exactly as this stackoverflow question:\r\nhttps://stackoverflow.com/questions/66855708/empty-reply-from-server-with-aiohttp-with-python-3-8\r\n\r\nolder code:\r\n\r\n```\r\nif use_ssl is True:\r\n            path = os.path.dirname(os.path.abspath(__file__))\r\n            ssl_context = ssl.create_default_context(purpose=ssl.Purpose.SERVER_AUTH) # CLIENT_AUTH didn't work either\r\n            ssl_context.load_cert_chain(f'{path}/certs/tls.crt', f'{path}/certs/tls.key')\r\n```\r\n\r\nfor everyone left scratching its head, this code works:\r\n```\r\nif use_ssl is True:\r\n            path = os.path.dirname(os.path.abspath(__file__))\r\n            ssl_context = ssl.SSLContext(ssl.PROTOCOL_TLS_SERVER) #only this combination works, class + PROTOCOL_TLS_SERVER\r\n            ssl_context.load_cert_chain(f'{path}/certs/tls.crt', f'{path}/certs/tls.key')\r\n```\r\n\r\n\r\n\r\n\r\n### To Reproduce\r\n\r\n```python\r\n\r\nasync def handler()\r\n    return web.Request(...)\r\n\r\npath = \"....\"\r\naddr = \"0.0.0.0\"\r\nport = 8080\r\n\r\nctx = None\r\n\r\nif use_ssl is True:\r\n            path = os.path.dirname(os.path.abspath(__file__))\r\n            ctx = ssl.create_default_context(purpose=ssl.Purpose.SERVER_AUTH) # CLIENT_AUTH didn't work either\r\n            ctx.load_cert_chain(f'{path}/certs/tls.crt', f'{path}/certs/tls.key')\r\n\r\nserver = web.Server(handler)\r\nrunner = web.ServerRunner(server)\r\n\r\nawait self.runner.setup()\r\n\r\nsite = web.TCPSite(\r\n            runner, \r\n            host=addr, \r\n            port=port,\r\n            ssl_context=\r\n\r\nawait self.site.start()\r\n\r\n```\r\n\r\n### Expected behavior\r\n\r\nany log of the error\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nnope\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n$ python --version\r\n\r\n 3.10.10\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n$ python -m pip show aiohttp\r\n3.8.4\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n$ python -m pip show multidict\r\n6.0.4\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n$ python -m pip show yarl\r\n1.8.2\r\n```\r\n\r\n\r\n### OS\r\n\r\ndocker ubuntu:focal\r\n\r\n### Related component\r\n\r\nServer\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [x] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7241/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7241/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7233", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7233/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7233/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7233/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7233", "id": 1616511820, "node_id": "I_kwDOAMpNN85gWgNM", "number": 7233, "title": "[BUG] Can't get responses content (multidict seems like doesnt work)", "user": {"login": "Evil0ctal", "id": 20760448, "node_id": "MDQ6VXNlcjIwNzYwNDQ4", "avatar_url": "https://avatars.githubusercontent.com/u/20760448?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Evil0ctal", "html_url": "https://github.com/Evil0ctal", "followers_url": "https://api.github.com/users/Evil0ctal/followers", "following_url": "https://api.github.com/users/Evil0ctal/following{/other_user}", "gists_url": "https://api.github.com/users/Evil0ctal/gists{/gist_id}", "starred_url": "https://api.github.com/users/Evil0ctal/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Evil0ctal/subscriptions", "organizations_url": "https://api.github.com/users/Evil0ctal/orgs", "repos_url": "https://api.github.com/users/Evil0ctal/repos", "events_url": "https://api.github.com/users/Evil0ctal/events{/privacy}", "received_events_url": "https://api.github.com/users/Evil0ctal/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2023-03-09T06:30:15Z", "updated_at": "2023-03-10T10:25:37Z", "closed_at": "2023-03-10T10:25:36Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\n# The following code will reproduce the problem, first I have two variables, `url` and `headers`.\r\n\r\n```python\r\nimport aiohttp\r\nimport requests\r\n\r\nurl  = \"https://api16-core-useast5.us.tiktokv.com/aweme/v1/aweme/post/?source=0&user_avatar_shrink=96_96&video_cover_shrink=248_330&max_cursor=0&sec_user_id=MS4wLjABAAAArFyeo4ABoR3n04XDlNWjexQXcwbhLbnAxSYWgphk0uFtnYeqM9kD_uThGw3si-QX&count=20&locate_item_id=7202594866214309162&iid=7208312964359833387&device_id=7170857108601833002&ac=wifi&channel=googleplay&aid=1233&app_name=musical_ly&version_code=260802&version_name=26.8.2&device_platform=android&ab_version=26.8.2&ssmix=a&device_type=SM-G996U1&device_brand=samsung&language=zh-hant&os_api=28&os_version=9&openudid=6c42d18f9012249b&manifest_version_code=2022608020&dpi=450&update_version_code=2022608020&_rticket=1678316270464&current_region=US&app_type=normal&mcc_mnc=310260&timezone_name=Asia%2FShanghai&carrier_region_v2=310&residence=US&app_language=zh-Hant&carrier_region=US&ac2=wifi5g&uoo=1&op_region=US&timezone_offset=28800&build_number=26.8.2&host_abi=arm64-v8a&locale=zh-Hant-TW&region=TW&ts=1678316270&content_language=en%2C&cdid=6e3e02dd-c362-4f14-8ca1-f014a8a792e9\"\r\n\r\nheaders = {'Cookie': 'install_id=7207567550891460398', 'passport-sdk-version': '19', 'sdk-version': '2', 'x-ss-req-ticket': '1678342747102', 'x-vc-bdturing-sdk-version': '2.2.1.i18n', 'x-tt-dm-status': 'login=1;ct=1;rt=6', 'x-tt-store-idc': 'alisg', 'x-tt-store-region': 'am', 'x-tt-store-region-src': 'did', 'Accept-Encoding': 'gzip, deflate, br', 'user-agent': 'com.zhiliaoapp.musically/2022608020 (Linux; U; Android 9; en; SM-G996U1; Build/N2G48H;tt-ok/3.10.0.2)', 'X-Ladon': 'oYXFWhrfJggcYvzwUy0lt60dLipq1aJJ6+0OH+TEBF/shGCS', 'X-khronos': '1678342748', 'X-Argus': 'Rw77CHFYhC6/ZTVfbq+2xh8rlL1VT/e+CHkY20KPReDsLy+IfIGyh8Uf/QGwjw9t/8qRkHx7AvEGA7+flS4btCDwhq0kUiEs3uiYH0TJWctO+lnvks3laWvbR6gwQHl3RcdfPe39REvc3SsJd1Mv8dWQg+rACDvPobNhIzcfYG/Co9utjfxwwJTwmhPBdyHOoZ4kFcyj9YKbia7E/tymO8f4nIi7E0wl48UZV+bAqWQR9RrpGV2fXoGP3LkTGmPzoeTezH2GgPt90WiIArxJqWfz', 'X-Gorgon': '040420920000e71e7722d2a7a0bb1580a67542a4ef56084c5b06'}\r\n\r\n# Using requests\r\n\r\nresponse = requests.get(url, headers=headers)\r\nprint(\"response_by_requests: \", response.text[:100])\r\n\r\n\r\n# Using AioHTTP\r\n\r\n# async with aiohttp.ClientSession(headers=headers) as session:\r\n#     async with session.get(url) as response:\r\n#         print('url: ', response.url)\r\n#         print('headers: ', dict(session.headers))\r\n#         print(\"response: \", await response.text())\r\n\r\nasync with aiohttp.ClientSession() as session:\r\n    async with session.get(url, headers=headers) as response:\r\n        print(\"response_by_aiohttp: \", (await response.text())[:100])\r\n        print('status: ', response.status)      \r\n```\r\n        \r\n# Output:\r\n\r\n```\r\nresponse_by_requests:  {\"aweme_list\":[{\"anchors\":null,\"anchors_extras\":\"\",\"author\":{\"accept_private_policy\":false,\"account_\r\nresponse_by_aiohttp:  \r\nstatus:  200\r\n```\r\n\r\n### To Reproduce\r\n\r\nSee code above.\r\n\r\n### Expected behavior\r\n\r\nNot sure, but looks like the headers didnt work.\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nSee code above.\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n$ python --version\r\ntried Python 3.9 and 3.11\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.8.3\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 6.0.4\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.8.2\r\n```\r\n\r\n\r\n### OS\r\n\r\nWindows 11\r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7233/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7233/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7231", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7231/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7231/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7231/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7231", "id": 1605114227, "node_id": "I_kwDOAMpNN85frBlz", "number": 7231, "title": "aiohttp get routes block ", "user": {"login": "thedtvn", "id": 80153297, "node_id": "MDQ6VXNlcjgwMTUzMjk3", "avatar_url": "https://avatars.githubusercontent.com/u/80153297?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thedtvn", "html_url": "https://github.com/thedtvn", "followers_url": "https://api.github.com/users/thedtvn/followers", "following_url": "https://api.github.com/users/thedtvn/following{/other_user}", "gists_url": "https://api.github.com/users/thedtvn/gists{/gist_id}", "starred_url": "https://api.github.com/users/thedtvn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thedtvn/subscriptions", "organizations_url": "https://api.github.com/users/thedtvn/orgs", "repos_url": "https://api.github.com/users/thedtvn/repos", "events_url": "https://api.github.com/users/thedtvn/events{/privacy}", "received_events_url": "https://api.github.com/users/thedtvn/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2023-03-01T14:49:03Z", "updated_at": "2023-03-03T08:05:49Z", "closed_at": "2023-03-03T08:05:49Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\ni at  2 tab at the same time and then that routes get block in to task is run done and all task in routes is async\r\n\n\n### To Reproduce\n\njuse  code  a base aiohttp req \r\ncode\r\n```\r\nimport asyncio\r\nimport re\r\nfrom urllib.parse import quote\r\nfrom aiohttp import web\r\nfrom playwright.async_api import async_playwright\r\n\r\n# async all\r\nasync def getdata(inpt):\r\n    async with async_playwright() as p:\r\n         browser = await p.chromium.launch(headless=False)\r\n         context = await browser.new_context()\r\n         page = await context.new_page()\r\n         inpt = quote(str(inpt))\r\n         await page.goto(f\"<url to bypass Cloudflare>\")\r\n         eobj = await page.wait_for_selector('div[id=\"challenge-spinner\"]')\r\n         await eobj.wait_for_element_state(\"hidden\")\r\n         eobj = await page.query_selector('input[value=\"Verify you are human\"]')\r\n         if eobj is None:\r\n             eobj = page.frame_locator('iframe[title=\"Widget containing a Cloudflare security challenge\"]')\r\n             eobj = eobj.locator('[class=\"mark\"]')\r\n         await eobj.click()\r\n         await page.wait_for_event(\"load\")\r\n         eobj = await page.wait_for_selector('pre', timeout=None)\r\n         dataout = await eobj.text_content()\r\n         await context.close()\r\n         await browser.close()\r\n         return dataout \r\n\r\nroutes = web.RouteTableDef()\r\n\r\n@routes.get('/')\r\nasync def hello(request: web.Request):\r\n     message = request.query.get('m')\r\n     loop = asyncio.get_running_loop()\r\n     data = await getdata(message)\r\n     return web.json_response({\"data\": data})\r\n\r\n@routes.get('/hi')\r\nasync def hello(request: web.Request):\r\n     message = request.query.get('m')\r\n     print(message)\r\n     return web.json_response({\"data\": \"hi\"})\r\n\r\napp = web.Application()\r\napp.add_routes(routes)\r\nweb.run_app(app, port=1234)\r\n```\n\n### Expected behavior\n\nrun  2 task at the same time\n\n### Logs/tracebacks\n\n```python-traceback\nno\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\nPython 3.11.0\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.8.3\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor:\r\nAuthor-email:\r\nLicense: Apache 2\r\nLocation: C:\\Users\\duong\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\r\nRequires: aiosignal, async-timeout, attrs, charset-normalizer, frozenlist, multidict, yarl\r\nRequired-by: aiohttp-session\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 6.0.2\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: C:\\Users\\duong\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\r\nRequires:\r\nRequired-by: aiohttp, yarl\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.8.1\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: C:\\Users\\duong\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\n```\n\n\n### OS\n\nwin 11\n\n### Related component\n\nServer\n\n### Additional context\n\n\r\nhttps://user-images.githubusercontent.com/80153297/222171216-9aaab897-5f5c-4580-8726-9ea41c662038.mp4\r\n\r\n\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7231/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7231/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7224", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7224/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7224/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7224/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7224", "id": 1599785429, "node_id": "I_kwDOAMpNN85fWsnV", "number": 7224, "title": "aiohttp WebSocket cannot upgrade", "user": {"login": "redradist", "id": 6311799, "node_id": "MDQ6VXNlcjYzMTE3OTk=", "avatar_url": "https://avatars.githubusercontent.com/u/6311799?v=4", "gravatar_id": "", "url": "https://api.github.com/users/redradist", "html_url": "https://github.com/redradist", "followers_url": "https://api.github.com/users/redradist/followers", "following_url": "https://api.github.com/users/redradist/following{/other_user}", "gists_url": "https://api.github.com/users/redradist/gists{/gist_id}", "starred_url": "https://api.github.com/users/redradist/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/redradist/subscriptions", "organizations_url": "https://api.github.com/users/redradist/orgs", "repos_url": "https://api.github.com/users/redradist/repos", "events_url": "https://api.github.com/users/redradist/events{/privacy}", "received_events_url": "https://api.github.com/users/redradist/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-02-25T18:05:29Z", "updated_at": "2023-02-28T07:09:37Z", "closed_at": "2023-02-28T07:09:37Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nDuring the testing the following example from README.md page:\r\n```python\r\nfrom aiohttp import web\r\n\r\nasync def handle(request):\r\n    name = request.match_info.get('name', \"Anonymous\")\r\n    text = \"Hello, \" + name\r\n    return web.Response(text=text)\r\n\r\nasync def wshandle(request):\r\n    ws = web.WebSocketResponse()\r\n    await ws.prepare(request)\r\n\r\n    async for msg in ws:\r\n        if msg.type == web.WSMsgType.text:\r\n            await ws.send_str(\"Hello, {}\".format(msg.data))\r\n        elif msg.type == web.WSMsgType.binary:\r\n            await ws.send_bytes(msg.data)\r\n        elif msg.type == web.WSMsgType.close:\r\n            break\r\n\r\n    return ws\r\n\r\n\r\napp = web.Application()\r\napp.add_routes([web.get('/', handle),\r\n                web.get('/echo', wshandle),\r\n                web.get('/{name}', handle)])\r\n\r\nif __name__ == '__main__':\r\n    web.run_app(app)\r\n```\r\n\r\nusing WebSocket I got the following error:\r\n```console\r\nNo WebSocket UPGRADE hdr: None\r\n Can \"Upgrade\" only to \"WebSocket\".\r\n```\n\n### To Reproduce\n\n1. Run sample for WebSocker from README.md page\r\n2. Open in browser ws://0.0.0.0:8080/ws/echo or http://0.0.0.0:8080/ws/echo\n\n### Expected behavior\n\nReturn echo message\n\n### Logs/tracebacks\n\n```python-traceback\nNo WebSocket UPGRADE hdr: None\r\n Can \"Upgrade\" only to \"WebSocket\".\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\n3.11\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\n3.8.4\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\n6.0.4\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\n1.8.2\n```\n\n\n### OS\n\nmacOS\n\n### Related component\n\nServer\n\n### Additional context\n\nFirefox 110.0\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7224/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7224/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7222", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7222/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7222/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7222/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7222", "id": 1598608678, "node_id": "I_kwDOAMpNN85fSNUm", "number": 7222, "title": "Query parameters are being URL-decoded when making a request", "user": {"login": "coyotte508", "id": 342922, "node_id": "MDQ6VXNlcjM0MjkyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/342922?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coyotte508", "html_url": "https://github.com/coyotte508", "followers_url": "https://api.github.com/users/coyotte508/followers", "following_url": "https://api.github.com/users/coyotte508/following{/other_user}", "gists_url": "https://api.github.com/users/coyotte508/gists{/gist_id}", "starred_url": "https://api.github.com/users/coyotte508/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coyotte508/subscriptions", "organizations_url": "https://api.github.com/users/coyotte508/orgs", "repos_url": "https://api.github.com/users/coyotte508/repos", "events_url": "https://api.github.com/users/coyotte508/events{/privacy}", "received_events_url": "https://api.github.com/users/coyotte508/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-02-24T13:14:16Z", "updated_at": "2023-02-25T13:45:58Z", "closed_at": "2023-02-24T17:49:52Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nWhen making a request, eg to https://huggingface.co/?response-content-type=application%2Fgzip, the URL gets converted to https://huggingface.co/?response-content-type=application/gzip before making the request: the `%2F` is converted to `/` in the query.\r\n\r\nMost of the time, this is harmless. But when making calls to cloudfront on a signed URL, the signature won't match anymore and cloudfront will answer with a 403.\r\n\r\n### To Reproduce\r\n\r\n```\r\nimport aiohttp\r\nimport asyncio\r\n\r\nasync def main():\r\n    async with aiohttp.ClientSession() as session:\r\n        async with session.get('https://huggingface.co/?response-content-type=application%2Fgzip') as response:\r\n            print(\"Status:\", response.status)\r\n            print(\"Url:\", response.url)\r\n\r\nloop = asyncio.get_event_loop()\r\nloop.run_until_complete(main())\r\n```\r\n\r\n### Expected behavior\r\n\r\nThe code above should show\r\n\r\n```\r\nStatus: 200\r\nUrl: https://huggingface.co/?response-content-type=application%2Fgzip\r\n```\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nStatus: 200\r\nUrl: https://huggingface.co/?response-content-type=application/gzip\r\n```\r\n\r\nServerside, we also see that it's called with this decoded url\r\n\r\n### Python Version\r\n\r\n\r\n```console\r\nPython 3.10.6\r\n```\r\n\r\n### aiohttp Version\r\n\r\n```console\r\nName: aiohttp\r\nVersion: 3.8.4\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: \r\nAuthor-email: \r\nLicense: Apache 2\r\nLocation: /usr/local/lib/python3.10/dist-packages\r\nRequires: aiosignal, async-timeout, attrs, charset-normalizer, frozenlist, multidict, yarl\r\nRequired-by:\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n$ python -m pip show multidict\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\nName: multidict\r\nVersion: 6.0.4\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/local/lib/python3.10/dist-packages\r\nRequires: \r\nRequired-by: aiohttp, yarl\r\n```\r\n\r\n\r\n### OS\r\n\r\nLinux\r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\nWe use `aoihttp` in https://github.com/huggingface/datasets/ . Recently on hf.co, we added `Content-Type` to the redirected response when fetching LFS files, eg on https://huggingface.co/bert-base-uncased/resolve/main/flax_model.msgpack and it caused 403s to happen.\r\n\r\nWe removed the `response-content-type` we pass to cloudfront for now due to the problem, and there is a workaround (cloudfront allow to sign query params with a `*`) - so we're going to readd it and be fine. But it'd be nice to fix the issue here :)\r\n\r\nRelated issue: https://github.com/aio-libs/aiohttp/issues/4972 , it's serverside but probably related (yarl)\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7222/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7222/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7216", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7216/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7216/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7216/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7216", "id": 1590927842, "node_id": "I_kwDOAMpNN85e06Hi", "number": 7216, "title": "Loading saved CookieJar breaks in 3.8.4", "user": {"login": "Traktormaster", "id": 9530287, "node_id": "MDQ6VXNlcjk1MzAyODc=", "avatar_url": "https://avatars.githubusercontent.com/u/9530287?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Traktormaster", "html_url": "https://github.com/Traktormaster", "followers_url": "https://api.github.com/users/Traktormaster/followers", "following_url": "https://api.github.com/users/Traktormaster/following{/other_user}", "gists_url": "https://api.github.com/users/Traktormaster/gists{/gist_id}", "starred_url": "https://api.github.com/users/Traktormaster/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Traktormaster/subscriptions", "organizations_url": "https://api.github.com/users/Traktormaster/orgs", "repos_url": "https://api.github.com/users/Traktormaster/repos", "events_url": "https://api.github.com/users/Traktormaster/events{/privacy}", "received_events_url": "https://api.github.com/users/Traktormaster/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-02-20T00:27:03Z", "updated_at": "2023-02-28T17:44:47Z", "closed_at": "2023-02-28T17:44:47Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Describe the bug\n\nI save the contents of a CookieJar to persist a session. Loading a file saved in <3.8.4 will not work in aiohttp 3.8.4 as expected. When I'd iterate through the cookies the expiration update will raise an unhandled exception.\r\n\r\nThis issue completely breaks the authentication flow and bricks the session of a user in my application.\n\n### To Reproduce\n\n1. Create and save a simple CookieJar in 3.8.3:\r\n```python\r\nfrom aiohttp import CookieJar\r\nfrom http.cookies import SimpleCookie\r\ncj = CookieJar()\r\ncooks = SimpleCookie({\"coo\": \"kie\"})\r\ncj.update_cookies(cooks)\r\ncj.save(\"/tmp/aiohttp383s.cj\")\r\n```\r\n2. Load it in 3.8.4 and trigger expiration-update by iterating over it:\r\n```python\r\nfrom aiohttp import CookieJar\r\ncj = CookieJar()\r\ncj.load(\"/tmp/aiohttp383s.cj\")\r\nlist(cj)\r\n```\n\n### Expected behavior\n\nI expected the save/load to work across versions, but at least when upgrading to a newer version. The documentation does not mention anything to be afraid of either.\n\n### Logs/tracebacks\n\n```python-traceback\nTraceback (most recent call last):\r\n  File \"<input>\", line 1, in <module>\r\n  File \"/home/gg/PycharmProjects/.venv/x310/lib/python3.10/site-packages/aiohttp/cookiejar.py\", line 147, in __len__\r\n    return sum(1 for i in self)\r\n  File \"/home/gg/PycharmProjects/.venv/x310/lib/python3.10/site-packages/aiohttp/cookiejar.py\", line 147, in <genexpr>\r\n    return sum(1 for i in self)\r\n  File \"/home/gg/PycharmProjects/.venv/x310/lib/python3.10/site-packages/aiohttp/cookiejar.py\", line 142, in __iter__\r\n    self._do_expiration()\r\n  File \"/home/gg/PycharmProjects/.venv/x310/lib/python3.10/site-packages/aiohttp/cookiejar.py\", line 150, in _do_expiration\r\n    self.clear(lambda x: False)\r\n  File \"/home/gg/PycharmProjects/.venv/x310/lib/python3.10/site-packages/aiohttp/cookiejar.py\", line 115, in clear\r\n    for (domain, path), cookie in self._cookies.items():\r\nValueError: not enough values to unpack (expected 2, got 0)\n```\n\n\n### Python Version\n\n```console\nPython 3.10.9\n```\n\n\n### aiohttp Version\n\n```console\nName: aiohttp\r\nVersion: 3.8.4\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: \r\nAuthor-email: \r\nLicense: Apache 2\r\nLocation: /home/gg/PycharmProjects/.venv/x310/lib/python3.10/site-packages\r\nRequires: aiosignal, async-timeout, attrs, charset-normalizer, frozenlist, multidict, yarl\n```\n\n\n### multidict Version\n\n```console\nName: multidict\r\nVersion: 6.0.4\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/gg/PycharmProjects/.venv/x310/lib/python3.10/site-packages\r\nRequires: \r\nRequired-by: aiohttp, yarl\n```\n\n\n### yarl Version\n\n```console\nName: yarl\r\nVersion: 1.8.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/gg/PycharmProjects/.venv/x310/lib/python3.10/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\n```\n\n\n### OS\n\nArch Linux\n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7216/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7216/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7214", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7214/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7214/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7214/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7214", "id": 1587702251, "node_id": "I_kwDOAMpNN85eomnr", "number": 7214, "title": "ValueError: too many values to unpack (expected 2)", "user": {"login": "QiYueColdRain", "id": 16873278, "node_id": "MDQ6VXNlcjE2ODczMjc4", "avatar_url": "https://avatars.githubusercontent.com/u/16873278?v=4", "gravatar_id": "", "url": "https://api.github.com/users/QiYueColdRain", "html_url": "https://github.com/QiYueColdRain", "followers_url": "https://api.github.com/users/QiYueColdRain/followers", "following_url": "https://api.github.com/users/QiYueColdRain/following{/other_user}", "gists_url": "https://api.github.com/users/QiYueColdRain/gists{/gist_id}", "starred_url": "https://api.github.com/users/QiYueColdRain/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/QiYueColdRain/subscriptions", "organizations_url": "https://api.github.com/users/QiYueColdRain/orgs", "repos_url": "https://api.github.com/users/QiYueColdRain/repos", "events_url": "https://api.github.com/users/QiYueColdRain/events{/privacy}", "received_events_url": "https://api.github.com/users/QiYueColdRain/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-02-16T13:42:38Z", "updated_at": "2023-02-16T13:45:50Z", "closed_at": "2023-02-16T13:45:50Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nimport asyncio\r\nimport aiotieba as tb\r\n\r\n\r\nasync def main():\r\n    async with tb.Client(\"default\") as client:\r\n        user, result = await asyncio.gather(client.get_self_info(), client.get_fid('\u5929\u5802\u9e21\u6c64'))\r\n    print(f\"\u5f53\u524d\u7528\u6237\u4fe1\u606f: {user!r}\")\r\n    print(id)\r\n        \r\nasyncio.run(main())\n\n### To Reproduce\n\n    user, result = await asyncio.gather(client.get_self_info(), client.get_fid('\u5929\u5802\u9e21\u6c64'))\r\n  File \"/opt/homebrew/lib/python3.10/site-packages/aiotieba/client/_client.py\", line 357, in get_fid\r\n    fid = await get_fid.request(self._connector, self._core, fname)\r\n  File \"/opt/homebrew/lib/python3.10/site-packages/aiotieba/client/get_fid/_api.py\", line 29, in request\r\n    request = pack_web_get_request(\r\n  File \"/opt/homebrew/lib/python3.10/site-packages/aiotieba/client/_helper/_func.py\", line 231, in pack_web_get_request\r\n    cookies=core._web_core.cookie_jar.filter_cookies(url),\r\n  File \"/opt/homebrew/lib/python3.10/site-packages/aiohttp/cookiejar.py\", line 239, in filter_cookies\r\n    self._do_expiration()\r\n  File \"/opt/homebrew/lib/python3.10/site-packages/aiohttp/cookiejar.py\", line 150, in _do_expiration\r\n    self.clear(lambda x: False)\r\n  File \"/opt/homebrew/lib/python3.10/site-packages/aiohttp/cookiejar.py\", line 115, in clear\r\n    for (domain, path), cookie in self._cookies.items():\r\nValueError: too many values to unpack (expected 2)\n\n### Expected behavior\n\n\u83b7\u53d6\u8d34\u5427ID\n\n### Logs/tracebacks\n\n```python-traceback\nuser, result = await asyncio.gather(client.get_self_info(), client.get_fid('\u5929\u5802\u9e21\u6c64'))\r\n  File \"/opt/homebrew/lib/python3.10/site-packages/aiotieba/client/_client.py\", line 357, in get_fid\r\n    fid = await get_fid.request(self._connector, self._core, fname)\r\n  File \"/opt/homebrew/lib/python3.10/site-packages/aiotieba/client/get_fid/_api.py\", line 29, in request\r\n    request = pack_web_get_request(\r\n  File \"/opt/homebrew/lib/python3.10/site-packages/aiotieba/client/_helper/_func.py\", line 231, in pack_web_get_request\r\n    cookies=core._web_core.cookie_jar.filter_cookies(url),\r\n  File \"/opt/homebrew/lib/python3.10/site-packages/aiohttp/cookiejar.py\", line 239, in filter_cookies\r\n    self._do_expiration()\r\n  File \"/opt/homebrew/lib/python3.10/site-packages/aiohttp/cookiejar.py\", line 150, in _do_expiration\r\n    self.clear(lambda x: False)\r\n  File \"/opt/homebrew/lib/python3.10/site-packages/aiohttp/cookiejar.py\", line 115, in clear\r\n    for (domain, path), cookie in self._cookies.items():\r\nValueError: too many values to unpack (expected 2)\n```\n\n\n### Python Version\n\n```console\n$ python --version\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\n```\n\n\n### OS\n\nMac\n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7214/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7214/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7212", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7212/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7212/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7212/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7212", "id": 1585620493, "node_id": "I_kwDOAMpNN85egqYN", "number": 7212, "title": "RuntimeError: coroutine ignored GeneratorExit after ServerTimeoutError", "user": {"login": "pokotylo", "id": 10742825, "node_id": "MDQ6VXNlcjEwNzQyODI1", "avatar_url": "https://avatars.githubusercontent.com/u/10742825?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pokotylo", "html_url": "https://github.com/pokotylo", "followers_url": "https://api.github.com/users/pokotylo/followers", "following_url": "https://api.github.com/users/pokotylo/following{/other_user}", "gists_url": "https://api.github.com/users/pokotylo/gists{/gist_id}", "starred_url": "https://api.github.com/users/pokotylo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pokotylo/subscriptions", "organizations_url": "https://api.github.com/users/pokotylo/orgs", "repos_url": "https://api.github.com/users/pokotylo/repos", "events_url": "https://api.github.com/users/pokotylo/events{/privacy}", "received_events_url": "https://api.github.com/users/pokotylo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-02-15T10:39:24Z", "updated_at": "2023-02-15T13:39:03Z", "closed_at": "2023-02-15T11:57:22Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\n`asyncio.gather()` cancels submitted futures as soon as one of them raises an exception. This works with e.g. TimeoutError, but fails to cancel requests that generate `ServerTimeoutError: Connection timeout`.\r\n\r\nBeing called inside of a process pool, these ignored exceptions may lead to a `BrokenProcessPool` exception, or lead to a hanging process pool that does not exit the `with ProcessPoolExecutor` context after all futures have been completed.\r\n\r\n### To Reproduce\r\n\r\nThis test reproduces the `RuntimeError: coroutine ignored GeneratorExit` errors. It does not reproduce the `BrokenProcessPool` exception, or a hanging process pool on my system, which were observed in our app.\r\n\r\nConnection timeout is simulated with `http://example.com:81/` and the normal Timeout with `https://httpstat.us/200?sleep=60000`.\r\n\r\n<details>\r\n<summary> The reproducing test code</summary>\r\n\r\n``` python\r\nimport asyncio\r\nimport logging\r\nimport sys\r\nimport unittest\r\nfrom concurrent.futures import ProcessPoolExecutor\r\nfrom time import sleep\r\n\r\nimport aiohttp\r\nfrom aiohttp import ServerTimeoutError\r\nfrom asyncio import TimeoutError\r\n\r\nlogger = logging.getLogger(__name__)\r\n\r\ntimeout = aiohttp.ClientTimeout(total=5, connect=5)\r\n\r\nrequests_number = 20\r\n\r\nasync def async_request(file_url: str):\r\n    async with aiohttp.ClientSession(timeout=timeout) as session:\r\n        async with session.get(file_url) as response:\r\n            print(response, file=sys.stderr)\r\n\r\n\r\nclass TimeoutsTest(unittest.IsolatedAsyncioTestCase):\r\n    # both calls outside the process pool work fine, there are no ignored exceptions\r\n\r\n    async def test_timeout(self):\r\n        url = \"https://httpstat.us/200?sleep=60000\"\r\n        with self.assertRaises(TimeoutError):\r\n            await asyncio.gather(*[async_request(url) for _ in range(requests_number)])\r\n\r\n        # otherwise the exceptions occur during test shutdown\r\n        sleep(1)\r\n\r\n    async def test_connection_timeout(self):\r\n        url = \"http://example.com:81/\"\r\n        with self.assertRaises(ServerTimeoutError):\r\n            await asyncio.gather(*[async_request(url) for _ in range(requests_number)])\r\n\r\n        # otherwise the exceptions occur during test shutdown\r\n        sleep(1)\r\n\r\n\r\nmax_workers = 4\r\ntasks_number = max_workers * 4\r\n\r\n\r\ndef run_in_process_pool(file_url):\r\n    io_loop = asyncio.get_event_loop()\r\n    with ProcessPoolExecutor(max_workers=max_workers) as executor:\r\n        futures = [io_loop.run_in_executor(executor, process_task, file_url) for _ in range(tasks_number)]\r\n\r\n        for future in asyncio.as_completed(futures):\r\n            response = asyncio.get_event_loop().run_until_complete(future)\r\n            yield response\r\n\r\n\r\ndef process_task(file_url):\r\n    try:\r\n        # a new loop in each process\r\n        asyncio.set_event_loop(asyncio.new_event_loop())\r\n\r\n        return asyncio.get_event_loop().run_until_complete(asyncio.gather(*[async_request(file_url) for _ in range(requests_number)]))\r\n    except Exception as exception:\r\n        return exception\r\n\r\n\r\nclass TimeoutsProcessPoolTest(unittest.TestCase):\r\n    # when running the connection_timeout test, it generates the output seen below\r\n\r\n    def test_timeout_process_pool(self):\r\n        url = \"https://httpstat.us/200?sleep=60000\"\r\n        results = list(run_in_process_pool(url))\r\n\r\n        for result in results:\r\n            self.assertIsInstance(result, TimeoutError)\r\n        self.assertEqual(max_workers * 4, len(results))\r\n\r\n    def test_connection_timeout_process_pool(self):\r\n        url = \"http://example.com:81/\"\r\n        results = list(run_in_process_pool(url))\r\n\r\n        for result in results:\r\n            self.assertIsInstance(result, ServerTimeoutError)\r\n        self.assertEqual(max_workers * 4, len(results))\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    unittest.main()\r\n\r\n```\r\n</details>\r\n\r\n### Expected behavior\r\n\r\nIt is expected that all futures get cancelled.\r\n\r\n### Logs/tracebacks\r\n\r\nThe tests pass. All outputs happen outside the user code and cannot be handled:\r\n\r\n<details>\r\n<summary> The outputs of `test_connection_timeout_process_pool`</summary>\r\n\r\n```python-traceback\r\nTraceback (most recent call last):\r\n  File \"/test_timepouts.py\", line 20, in async_request\r\n    async with session.get(file_url) as response:\r\n  File \"/venv-3.9/lib/python3.9/site-packages/aiohttp/client.py\", line 1141, in __aenter__\r\n    self._resp = await self._coro\r\n  File \"/venv-3.9/lib/python3.9/site-packages/aiohttp/client.py\", line 540, in _request\r\n    raise ServerTimeoutError(\r\naiohttp.client_exceptions.ServerTimeoutError: Connection timeout to host http://example.com:81/\r\nTask exception was never retrieved\r\nfuture: <Task finished name='Task-97' coro=<async_request() done, defined at //test_timepouts.py:18> exception=ServerTimeoutError('Connection timeout to host http://example.com:81/')>\r\nTraceback (most recent call last):\r\n  File \"/venv-3.9/lib/python3.9/site-packages/aiohttp/client.py\", line 536, in _request\r\n    conn = await self._connector.connect(\r\n  File \"/venv-3.9/lib/python3.9/site-packages/aiohttp/connector.py\", line 540, in connect\r\n    proto = await self._create_connection(req, traces, timeout)\r\n  File \"/venv-3.9/lib/python3.9/site-packages/aiohttp/connector.py\", line 901, in _create_connection\r\n    _, proto = await self._create_direct_connection(req, traces, timeout)\r\n  File \"/venv-3.9/lib/python3.9/site-packages/aiohttp/connector.py\", line 1175, in _create_direct_connection\r\n    transp, proto = await self._wrap_create_connection(\r\n  File \"/venv-3.9/lib/python3.9/site-packages/aiohttp/connector.py\", line 980, in _wrap_create_connection\r\n    return await self._loop.create_connection(*args, **kwargs)  # type: ignore[return-value]  # noqa\r\n  File \"/opt/homebrew/Cellar/python@3.9/3.9.16/Frameworks/Python.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py\", line 1050, in create_connection\r\n    sock = await self._connect_sock(\r\n  File \"/opt/homebrew/Cellar/python@3.9/3.9.16/Frameworks/Python.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py\", line 961, in _connect_sock\r\n    await self.sock_connect(sock, address)\r\n  File \"/opt/homebrew/Cellar/python@3.9/3.9.16/Frameworks/Python.framework/Versions/3.9/lib/python3.9/asyncio/selector_events.py\", line 500, in sock_connect\r\n    return await fut\r\nasyncio.exceptions.CancelledError\r\n```\r\n\r\n```python-traceback\r\nTraceback (most recent call last):\r\n  File \"/test_timepouts.py\", line 20, in async_request\r\n    async with session.get(file_url) as response:\r\n  File \"/venv-3.9/lib/python3.9/site-packages/aiohttp/client.py\", line 1141, in __aenter__\r\n    self._resp = await self._coro\r\n  File \"/venv-3.9/lib/python3.9/site-packages/aiohttp/client.py\", line 540, in _request\r\n    raise ServerTimeoutError(\r\naiohttp.client_exceptions.ServerTimeoutError: Connection timeout to host http://example.com:81/\r\nException ignored in: <coroutine object async_request at 0x1184c2340>\r\nRuntimeError: coroutine ignored GeneratorExit\r\n```\r\n</details>\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n$ python --version\r\n3.9.16\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n$ python -m pip show aiohttp\r\n3.8.4\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n$ python -m pip show multidict\r\n6.0.4\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n$ python -m pip show yarl\r\n1.8.2\r\n```\r\n\r\n\r\n### OS\r\n\r\nThe issue was reproduced and the test outputs have been generated under macOS 12.6.2.\r\n\r\nThe original issue with the hanging process pool happened in kubernetes with the `python:3.9-slim` docker image.\r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7212/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7212/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7209", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7209/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7209/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7209/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7209", "id": 1581379471, "node_id": "I_kwDOAMpNN85eQe-P", "number": 7209, "title": "Fail to build in python3.12", "user": {"login": "neomachiney", "id": 118899053, "node_id": "U_kgDOBxZBbQ", "avatar_url": "https://avatars.githubusercontent.com/u/118899053?v=4", "gravatar_id": "", "url": "https://api.github.com/users/neomachiney", "html_url": "https://github.com/neomachiney", "followers_url": "https://api.github.com/users/neomachiney/followers", "following_url": "https://api.github.com/users/neomachiney/following{/other_user}", "gists_url": "https://api.github.com/users/neomachiney/gists{/gist_id}", "starred_url": "https://api.github.com/users/neomachiney/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/neomachiney/subscriptions", "organizations_url": "https://api.github.com/users/neomachiney/orgs", "repos_url": "https://api.github.com/users/neomachiney/repos", "events_url": "https://api.github.com/users/neomachiney/events{/privacy}", "received_events_url": "https://api.github.com/users/neomachiney/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-02-12T19:22:32Z", "updated_at": "2023-02-12T20:35:20Z", "closed_at": "2023-02-12T20:35:19Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n```\r\nrunning install\r\n/usr/local/lib/python3.12/site-packages/setuptools/command/install.py:34: SetuptoolsDeprecationWarning: setup.py install is deprecated. Use build and pip and other standards-based tools.\r\n  warnings.warn(\r\n/usr/local/lib/python3.12/site-packages/setuptools/command/easy_install.py:144: EasyInstallDeprecationWarning: easy_install command is deprecated. Use build and pip and other standards-based tools.\r\n  warnings.warn(\r\nrunning bdist_egg\r\nrunning egg_info\r\nwriting discord.py_self.egg-info/PKG-INFO\r\nwriting dependency_links to discord.py_self.egg-info/dependency_links.txt\r\nwriting requirements to discord.py_self.egg-info/requires.txt\r\nwriting top-level names to discord.py_self.egg-info/top_level.txt\r\nreading manifest file 'discord.py_self.egg-info/SOURCES.txt'\r\nreading manifest template 'MANIFEST.in'\r\nadding license file 'LICENSE'\r\nwriting manifest file 'discord.py_self.egg-info/SOURCES.txt'\r\ninstalling library code to build/bdist.linux-x86_64/egg\r\nrunning install_lib\r\nrunning build_py\r\n/usr/local/lib/python3.12/site-packages/setuptools/command/build_py.py:202: SetuptoolsDeprecationWarning:     Installing 'discord.bin' as data is deprecated, please list it in `packages`.\r\n    !!\r\n\r\n\r\n    ############################\r\n    # Package would be ignored #\r\n    ############################\r\n    Python recognizes 'discord.bin' as an importable package,\r\n    but it is not listed in the `packages` configuration of setuptools.\r\n\r\n    'discord.bin' has been automatically added to the distribution only\r\n    because it may contain data files, but this behavior is likely to change\r\n    in future versions of setuptools (and therefore is considered deprecated).\r\n\r\n    Please make sure that 'discord.bin' is included as a package by using\r\n    the `packages` configuration field or the proper discovery methods\r\n    (for example by using `find_namespace_packages(...)`/`find_namespace:`\r\n    instead of `find_packages(...)`/`find:`).\r\n\r\n    You can read more about \"package discovery\" and \"data files\" on setuptools\r\n    documentation page.\r\n\r\n\r\n!!\r\n\r\n  check.warn(importable)\r\ncreating build/bdist.linux-x86_64/egg\r\ncreating build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/utils.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/http.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/backoff.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/handlers.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/calls.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/billing.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/scheduled_event.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/client.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/flags.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/message.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/channel.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/partial_emoji.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/mentions.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/activity.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/__init__.py -> build/bdist.linux-x86_64/egg/discord\r\ncreating build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/billing.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/scheduled_event.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/webhook.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/message.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/channel.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/activity.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/__init__.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/entitlements.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/library.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/store.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/subscriptions.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/invite.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/audit_log.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/welcome_screen.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/command.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/threads.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/emoji.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/template.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/gateway.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/integration.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/interactions.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/role.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/promotions.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/appinfo.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/payments.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/snowflake.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/voice.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/team.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/widget.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/components.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/guild.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/embed.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/member.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/user.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/types/sticker.py -> build/bdist.linux-x86_64/egg/discord/types\r\ncopying build/lib/discord/entitlements.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/library.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/errors.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/state.py -> build/bdist.linux-x86_64/egg/discord\r\ncreating build/bdist.linux-x86_64/egg/discord/webhook\r\ncopying build/lib/discord/webhook/__init__.py -> build/bdist.linux-x86_64/egg/discord/webhook\r\ncopying build/lib/discord/webhook/sync.py -> build/bdist.linux-x86_64/egg/discord/webhook\r\ncopying build/lib/discord/webhook/async_.py -> build/bdist.linux-x86_64/egg/discord/webhook\r\ncopying build/lib/discord/store.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/commands.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/subscriptions.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/invite.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/embeds.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/abc.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/settings.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/permissions.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/guild_premium.py -> build/bdist.linux-x86_64/egg/discord\r\ncreating build/bdist.linux-x86_64/egg/discord/ext\r\ncreating build/bdist.linux-x86_64/egg/discord/ext/commands\r\ncopying build/lib/discord/ext/commands/flags.py -> build/bdist.linux-x86_64/egg/discord/ext/commands\r\ncopying build/lib/discord/ext/commands/_types.py -> build/bdist.linux-x86_64/egg/discord/ext/commands\r\ncopying build/lib/discord/ext/commands/bot.py -> build/bdist.linux-x86_64/egg/discord/ext/commands\r\ncopying build/lib/discord/ext/commands/__init__.py -> build/bdist.linux-x86_64/egg/discord/ext/commands\r\ncopying build/lib/discord/ext/commands/core.py -> build/bdist.linux-x86_64/egg/discord/ext/commands\r\ncopying build/lib/discord/ext/commands/errors.py -> build/bdist.linux-x86_64/egg/discord/ext/commands\r\ncopying build/lib/discord/ext/commands/cooldowns.py -> build/bdist.linux-x86_64/egg/discord/ext/commands\r\ncopying build/lib/discord/ext/commands/context.py -> build/bdist.linux-x86_64/egg/discord/ext/commands\r\ncopying build/lib/discord/ext/commands/parameters.py -> build/bdist.linux-x86_64/egg/discord/ext/commands\r\ncopying build/lib/discord/ext/commands/help.py -> build/bdist.linux-x86_64/egg/discord/ext/commands\r\ncopying build/lib/discord/ext/commands/cog.py -> build/bdist.linux-x86_64/egg/discord/ext/commands\r\ncopying build/lib/discord/ext/commands/view.py -> build/bdist.linux-x86_64/egg/discord/ext/commands\r\ncopying build/lib/discord/ext/commands/converter.py -> build/bdist.linux-x86_64/egg/discord/ext/commands\r\ncreating build/bdist.linux-x86_64/egg/discord/ext/tasks\r\ncopying build/lib/discord/ext/tasks/__init__.py -> build/bdist.linux-x86_64/egg/discord/ext/tasks\r\ncopying build/lib/discord/welcome_screen.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/mixins.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/tracking.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/file.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/raw_models.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/__main__.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/threads.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/emoji.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/integrations.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/template.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/gateway.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/interactions.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/enums.py -> build/bdist.linux-x86_64/egg/discord\r\ncreating build/bdist.linux-x86_64/egg/discord/bin\r\ncopying build/lib/discord/bin/libopus-0.x64.dll -> build/bdist.linux-x86_64/egg/discord/bin\r\ncopying build/lib/discord/bin/libopus-0.x86.dll -> build/bdist.linux-x86_64/egg/discord/bin\r\ncopying build/lib/discord/role.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/promotions.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/colour.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/appinfo.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/connections.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/opus.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/payments.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/player.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/voice_client.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/metadata.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/modal.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/asset.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/object.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/py.typed -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/audit_logs.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/team.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/widget.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/reaction.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/relationship.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/profile.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/oggparse.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/components.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/guild.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/guild_folder.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/stage_instance.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/member.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/user.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/sticker.py -> build/bdist.linux-x86_64/egg/discord\r\ncopying build/lib/discord/context_managers.py -> build/bdist.linux-x86_64/egg/discord\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/utils.py to utils.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/http.py to http.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/backoff.py to backoff.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/handlers.py to handlers.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/calls.py to calls.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/billing.py to billing.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/scheduled_event.py to scheduled_event.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/client.py to client.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/flags.py to flags.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/message.py to message.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/channel.py to channel.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/partial_emoji.py to partial_emoji.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/mentions.py to mentions.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/activity.py to activity.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/__init__.py to __init__.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/billing.py to billing.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/scheduled_event.py to scheduled_event.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/webhook.py to webhook.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/message.py to message.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/channel.py to channel.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/activity.py to activity.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/__init__.py to __init__.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/entitlements.py to entitlements.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/library.py to library.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/store.py to store.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/subscriptions.py to subscriptions.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/invite.py to invite.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/audit_log.py to audit_log.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/welcome_screen.py to welcome_screen.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/command.py to command.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/threads.py to threads.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/emoji.py to emoji.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/template.py to template.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/gateway.py to gateway.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/integration.py to integration.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/interactions.py to interactions.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/role.py to role.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/promotions.py to promotions.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/appinfo.py to appinfo.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/payments.py to payments.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/snowflake.py to snowflake.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/voice.py to voice.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/team.py to team.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/widget.py to widget.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/components.py to components.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/guild.py to guild.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/embed.py to embed.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/member.py to member.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/user.py to user.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/types/sticker.py to sticker.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/entitlements.py to entitlements.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/library.py to library.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/errors.py to errors.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/state.py to state.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/webhook/__init__.py to __init__.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/webhook/sync.py to sync.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/webhook/async_.py to async_.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/store.py to store.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/commands.py to commands.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/subscriptions.py to subscriptions.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/invite.py to invite.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/embeds.py to embeds.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/abc.py to abc.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/settings.py to settings.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/permissions.py to permissions.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/guild_premium.py to guild_premium.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/ext/commands/flags.py to flags.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/ext/commands/_types.py to _types.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/ext/commands/bot.py to bot.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/ext/commands/__init__.py to __init__.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/ext/commands/core.py to core.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/ext/commands/errors.py to errors.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/ext/commands/cooldowns.py to cooldowns.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/ext/commands/context.py to context.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/ext/commands/parameters.py to parameters.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/ext/commands/help.py to help.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/ext/commands/cog.py to cog.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/ext/commands/view.py to view.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/ext/commands/converter.py to converter.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/ext/tasks/__init__.py to __init__.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/welcome_screen.py to welcome_screen.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/mixins.py to mixins.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/tracking.py to tracking.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/file.py to file.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/raw_models.py to raw_models.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/__main__.py to __main__.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/threads.py to threads.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/emoji.py to emoji.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/integrations.py to integrations.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/template.py to template.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/gateway.py to gateway.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/interactions.py to interactions.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/enums.py to enums.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/role.py to role.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/promotions.py to promotions.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/colour.py to colour.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/appinfo.py to appinfo.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/connections.py to connections.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/opus.py to opus.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/payments.py to payments.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/player.py to player.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/voice_client.py to voice_client.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/metadata.py to metadata.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/modal.py to modal.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/asset.py to asset.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/object.py to object.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/audit_logs.py to audit_logs.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/team.py to team.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/widget.py to widget.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/reaction.py to reaction.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/relationship.py to relationship.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/profile.py to profile.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/oggparse.py to oggparse.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/components.py to components.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/guild.py to guild.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/guild_folder.py to guild_folder.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/stage_instance.py to stage_instance.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/member.py to member.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/user.py to user.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/sticker.py to sticker.cpython-312.pyc\r\nbyte-compiling build/bdist.linux-x86_64/egg/discord/context_managers.py to context_managers.cpython-312.pyc\r\ncreating build/bdist.linux-x86_64/egg/EGG-INFO\r\ncopying discord.py_self.egg-info/PKG-INFO -> build/bdist.linux-x86_64/egg/EGG-INFO\r\ncopying discord.py_self.egg-info/SOURCES.txt -> build/bdist.linux-x86_64/egg/EGG-INFO\r\ncopying discord.py_self.egg-info/dependency_links.txt -> build/bdist.linux-x86_64/egg/EGG-INFO\r\ncopying discord.py_self.egg-info/requires.txt -> build/bdist.linux-x86_64/egg/EGG-INFO\r\ncopying discord.py_self.egg-info/top_level.txt -> build/bdist.linux-x86_64/egg/EGG-INFO\r\nwriting build/bdist.linux-x86_64/egg/EGG-INFO/native_libs.txt\r\nzip_safe flag not set; analyzing archive contents...\r\ndiscord.__pycache__.__init__.cpython-312: module references __path__\r\ndiscord.__pycache__.opus.cpython-312: module references __file__\r\ncreating 'dist/discord.py_self-2.0.0a2-py3.12.egg' and adding 'build/bdist.linux-x86_64/egg' to it\r\nremoving 'build/bdist.linux-x86_64/egg' (and everything under it)\r\nProcessing discord.py_self-2.0.0a2-py3.12.egg\r\nremoving '/usr/local/lib/python3.12/site-packages/discord.py_self-2.0.0a2-py3.12.egg' (and everything under it)\r\ncreating /usr/local/lib/python3.12/site-packages/discord.py_self-2.0.0a2-py3.12.egg\r\nExtracting discord.py_self-2.0.0a2-py3.12.egg to /usr/local/lib/python3.12/site-packages\r\ndiscord.py-self 2.0.0a2 is already the active version in easy-install.pth\r\n\r\nInstalled /usr/local/lib/python3.12/site-packages/discord.py_self-2.0.0a2-py3.12.egg\r\nProcessing dependencies for discord.py-self==2.0.0a2\r\nSearching for aiohttp<4,>=3.7.4\r\nReading https://pypi.org/simple/aiohttp/\r\n/usr/local/lib/python3.12/site-packages/pkg_resources/__init__.py:123: PkgResourcesDeprecationWarning:  is an invalid version and will not be supported in a future release\r\n  warnings.warn(\r\nDownloading https://files.pythonhosted.org/packages/c2/fd/1ff4da09ca29d8933fda3f3514980357e25419ce5e0f689041edb8f17dab/aiohttp-3.8.4.tar.gz#sha256=bf2e1a9162c1e441bf805a1fd166e249d574ca04e03b34f97e2928769e91ab5c\r\nBest match: aiohttp 3.8.4\r\nProcessing aiohttp-3.8.4.tar.gz\r\nWriting /tmp/easy_install-f_5v6hb6/aiohttp-3.8.4/setup.cfg\r\nRunning aiohttp-3.8.4/setup.py -q bdist_egg --dist-dir /tmp/easy_install-f_5v6hb6/aiohttp-3.8.4/egg-dist-tmp-y3c8gn0x\r\n*********************\r\n* Accelerated build *\r\n*********************\r\nwarning: no files found matching 'aiohttp' anywhere in distribution\r\nwarning: no previously-included files matching '*.pyc' found anywhere in distribution\r\nwarning: no previously-included files matching '*.pyd' found anywhere in distribution\r\nwarning: no previously-included files matching '*.so' found anywhere in distribution\r\nwarning: no previously-included files matching '*.lib' found anywhere in distribution\r\nwarning: no previously-included files matching '*.dll' found anywhere in distribution\r\nwarning: no previously-included files matching '*.a' found anywhere in distribution\r\nwarning: no previously-included files matching '*.obj' found anywhere in distribution\r\nwarning: no previously-included files found matching 'aiohttp/*.html'\r\nno previously-included directories found matching 'docs/_build'\r\n/usr/local/lib/python3.12/site-packages/setuptools/command/install.py:34: SetuptoolsDeprecationWarning: setup.py install is deprecated. Use build and pip and other standards-based tools.\r\n  warnings.warn(\r\naiohttp/_websocket.c: In function \u2018__pyx_pf_7aiohttp_10_websocket__websocket_mask_cython\u2019:\r\naiohttp/_websocket.c:1475:3: warning: \u2018Py_OptimizeFlag\u2019 is deprecated [-Wdeprecated-declarations]\r\n 1475 |   if (unlikely(!Py_OptimizeFlag)) {\r\n      |   ^~\r\nIn file included from /usr/local/include/python3.12/Python.h:48,\r\n                 from aiohttp/_websocket.c:6:\r\n/usr/local/include/python3.12/cpython/pydebug.h:13:37: note: declared here\r\n   13 | Py_DEPRECATED(3.12) PyAPI_DATA(int) Py_OptimizeFlag;\r\n      |                                     ^~~~~~~~~~~~~~~\r\naiohttp/_websocket.c: In function \u2018__Pyx_get_tp_dict_version\u2019:\r\naiohttp/_websocket.c:2680:5: warning: \u2018ma_version_tag\u2019 is deprecated [-Wdeprecated-declarations]\r\n 2680 |     return likely(dict) ? __PYX_GET_DICT_VERSION(dict) : 0;\r\n      |     ^~~~~~\r\nIn file included from /usr/local/include/python3.12/dictobject.h:90,\r\n                 from /usr/local/include/python3.12/Python.h:61,\r\n                 from aiohttp/_websocket.c:6:\r\n/usr/local/include/python3.12/cpython/dictobject.h:22:34: note: declared here\r\n   22 |     Py_DEPRECATED(3.12) uint64_t ma_version_tag;\r\n      |                                  ^~~~~~~~~~~~~~\r\naiohttp/_websocket.c: In function \u2018__Pyx_get_object_dict_version\u2019:\r\naiohttp/_websocket.c:2692:5: warning: \u2018ma_version_tag\u2019 is deprecated [-Wdeprecated-declarations]\r\n 2692 |     return (dictptr && *dictptr) ? __PYX_GET_DICT_VERSION(*dictptr) : 0;\r\n      |     ^~~~~~\r\nIn file included from /usr/local/include/python3.12/dictobject.h:90,\r\n                 from /usr/local/include/python3.12/Python.h:61,\r\n                 from aiohttp/_websocket.c:6:\r\n/usr/local/include/python3.12/cpython/dictobject.h:22:34: note: declared here\r\n   22 |     Py_DEPRECATED(3.12) uint64_t ma_version_tag;\r\n      |                                  ^~~~~~~~~~~~~~\r\naiohttp/_websocket.c: In function \u2018__Pyx_object_dict_version_matches\u2019:\r\naiohttp/_websocket.c:2696:5: warning: \u2018ma_version_tag\u2019 is deprecated [-Wdeprecated-declarations]\r\n 2696 |     if (unlikely(!dict) || unlikely(tp_dict_version != __PYX_GET_DICT_VERSION(dict)))\r\n      |     ^~\r\nIn file included from /usr/local/include/python3.12/dictobject.h:90,\r\n                 from /usr/local/include/python3.12/Python.h:61,\r\n                 from aiohttp/_websocket.c:6:\r\n/usr/local/include/python3.12/cpython/dictobject.h:22:34: note: declared here\r\n   22 |     Py_DEPRECATED(3.12) uint64_t ma_version_tag;\r\n      |                                  ^~~~~~~~~~~~~~\r\naiohttp/_websocket.c: In function \u2018__Pyx_CLineForTraceback\u2019:\r\naiohttp/_websocket.c:2741:9: warning: \u2018ma_version_tag\u2019 is deprecated [-Wdeprecated-declarations]\r\n 2741 |         __PYX_PY_DICT_LOOKUP_IF_MODIFIED(\r\n      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\nIn file included from /usr/local/include/python3.12/dictobject.h:90,\r\n                 from /usr/local/include/python3.12/Python.h:61,\r\n                 from aiohttp/_websocket.c:6:\r\n/usr/local/include/python3.12/cpython/dictobject.h:22:34: note: declared here\r\n   22 |     Py_DEPRECATED(3.12) uint64_t ma_version_tag;\r\n      |                                  ^~~~~~~~~~~~~~\r\naiohttp/_websocket.c:2741:9: warning: \u2018ma_version_tag\u2019 is deprecated [-Wdeprecated-declarations]\r\n 2741 |         __PYX_PY_DICT_LOOKUP_IF_MODIFIED(\r\n      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\nIn file included from /usr/local/include/python3.12/dictobject.h:90,\r\n                 from /usr/local/include/python3.12/Python.h:61,\r\n                 from aiohttp/_websocket.c:6:\r\n/usr/local/include/python3.12/cpython/dictobject.h:22:34: note: declared here\r\n   22 |     Py_DEPRECATED(3.12) uint64_t ma_version_tag;\r\n      |                                  ^~~~~~~~~~~~~~\r\naiohttp/_websocket.c: In function \u2018__Pyx_PyInt_As_long\u2019:\r\naiohttp/_websocket.c:3042:53: error: \u2018PyLongObject\u2019 {aka \u2018struct _longobject\u2019} has no member named \u2018ob_digit\u2019\r\n 3042 |             const digit* digits = ((PyLongObject*)x)->ob_digit;\r\n      |                                                     ^~\r\naiohttp/_websocket.c:3097:53: error: \u2018PyLongObject\u2019 {aka \u2018struct _longobject\u2019} has no member named \u2018ob_digit\u2019\r\n 3097 |             const digit* digits = ((PyLongObject*)x)->ob_digit;\r\n      |                                                     ^~\r\naiohttp/_websocket.c: In function \u2018__Pyx_PyInt_As_int\u2019:\r\naiohttp/_websocket.c:3238:53: error: \u2018PyLongObject\u2019 {aka \u2018struct _longobject\u2019} has no member named \u2018ob_digit\u2019\r\n 3238 |             const digit* digits = ((PyLongObject*)x)->ob_digit;\r\n      |                                                     ^~\r\naiohttp/_websocket.c:3293:53: error: \u2018PyLongObject\u2019 {aka \u2018struct _longobject\u2019} has no member named \u2018ob_digit\u2019\r\n 3293 |             const digit* digits = ((PyLongObject*)x)->ob_digit;\r\n      |                                                     ^~\r\naiohttp/_websocket.c: In function \u2018__Pyx_PyIndex_AsSsize_t\u2019:\r\naiohttp/_websocket.c:3744:45: error: \u2018PyLongObject\u2019 {aka \u2018struct _longobject\u2019} has no member named \u2018ob_digit\u2019\r\n 3744 |     const digit* digits = ((PyLongObject*)b)->ob_digit;\r\n      |                                             ^~\r\nerror: Setup script exited with error: command '/usr/bin/gcc' failed with exit code 1\r\n```\r\n\r\n### To Reproduce\r\n\r\ngit clone cpython + ./configure --enable-optimizaitions + make + make altinstall \r\ngit clone https://github.com/dolfies/discord.py-self\r\npython3.12 setup.py install\r\n\r\n\r\n### Expected behavior\r\n\r\nShould be compiled successfully\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nGiven already\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n$ python --version\r\n python3.12 --version\r\nPython 3.12.0a5+\r\n(most recent commit) 6ef6915d3530e844243893f91bf4bd702dfef570\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n$ python -m pip show aiohttp\r\n\r\nWARNING: Package(s) not found: aiohttp\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n$ python -m pip show multidict\r\n\r\nWARNING: Package(s) not found: multidict\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n$ python -m pip show yarl\r\n\r\nWARNING: Package(s) not found: yarl\r\n```\r\n\r\n\r\n### OS\r\n\r\n\r\nLinux v2311 5.10.0-21-amd64 #1 SMP Debian 5.10.162-1 (2023-01-21) x86_64 GNU/Linux\r\n\r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7209/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7209/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7197", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7197/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7197/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7197/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7197", "id": 1580078598, "node_id": "I_kwDOAMpNN85eLhYG", "number": 7197, "title": "Project dependencies.", "user": {"login": "jackokring", "id": 594069, "node_id": "MDQ6VXNlcjU5NDA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/594069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jackokring", "html_url": "https://github.com/jackokring", "followers_url": "https://api.github.com/users/jackokring/followers", "following_url": "https://api.github.com/users/jackokring/following{/other_user}", "gists_url": "https://api.github.com/users/jackokring/gists{/gist_id}", "starred_url": "https://api.github.com/users/jackokring/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jackokring/subscriptions", "organizations_url": "https://api.github.com/users/jackokring/orgs", "repos_url": "https://api.github.com/users/jackokring/repos", "events_url": "https://api.github.com/users/jackokring/events{/privacy}", "received_events_url": "https://api.github.com/users/jackokring/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-02-10T17:33:34Z", "updated_at": "2023-02-12T21:09:07Z", "closed_at": "2023-02-12T21:09:07Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\n`aiohttp 3.8.3 has requirement charset-normalizer<3.0,>=2.0, but you have charset-normalizer 3.0.1.`\n\n### To Reproduce\n\n1. use upto date package.\n\n### Expected behavior\n\nNot using ....\n\n### Logs/tracebacks\n\n```python-traceback\naiohttp 3.8.3 has requirement charset-normalizer<3.0,>=2.0, but you have charset-normalizer 3.0.1.\n```\n\n\n### Python Version\n\n```console\n3.9\n```\n\n\n### aiohttp Version\n\n```console\n3.8.3\n```\n\n\n### multidict Version\n\n```console\n: multidict\r\nVersion: 6.0.4\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/jackokring/www/venv/lib/python3.9/site-packages\r\nRequires: \r\nRequired-by: aiohttp, yarl\n```\n\n\n### yarl Version\n\n```console\n: yarl\r\nVersion: 1.8.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/jackokring/www/venv/lib/python3.9/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\n```\n\n\n### OS\n\nLinux arm64\n\n### Related component\n\nServer, Client\n\n### Additional context\n\nAn updated one.\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7197/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7197/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7195", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7195/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7195/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7195/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7195", "id": 1576866370, "node_id": "I_kwDOAMpNN85d_RJC", "number": 7195, "title": "Update charset-normalizer", "user": {"login": "jackHedaya", "id": 20172754, "node_id": "MDQ6VXNlcjIwMTcyNzU0", "avatar_url": "https://avatars.githubusercontent.com/u/20172754?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jackHedaya", "html_url": "https://github.com/jackHedaya", "followers_url": "https://api.github.com/users/jackHedaya/followers", "following_url": "https://api.github.com/users/jackHedaya/following{/other_user}", "gists_url": "https://api.github.com/users/jackHedaya/gists{/gist_id}", "starred_url": "https://api.github.com/users/jackHedaya/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jackHedaya/subscriptions", "organizations_url": "https://api.github.com/users/jackHedaya/orgs", "repos_url": "https://api.github.com/users/jackHedaya/repos", "events_url": "https://api.github.com/users/jackHedaya/events{/privacy}", "received_events_url": "https://api.github.com/users/jackHedaya/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-02-08T22:09:42Z", "updated_at": "2023-02-12T21:09:06Z", "closed_at": "2023-02-12T21:09:06Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nHi!\r\n\r\nI'm having a dependency conflict where another package is using `charset-normalizer >3` and aiohttp is using `charset-normalizer<3`. Is there a way to resolve this?\n\n### To Reproduce\n\n+ Install `htmldate` \r\n+ Install `aiohttp`\n\n### Expected behavior\n\nDependencies to resolve\n\n### Logs/tracebacks\n\n```python-traceback\nERROR: Cannot install -r requirements.txt (line 2) and htmldate==1.4.1 because these package versions have conflicting dependencies.\r\n\r\nThe conflict is caused by:\r\n    aiohttp 3.8.3 depends on charset-normalizer<3.0 and >=2.0\r\n    htmldate 1.4.1 depends on charset-normalizer>=3.0.1\r\n\r\nTo fix this you could try to:\r\n1. loosen the range of package versions you've specified\r\n2. remove package versions to allow pip attempt to solve the dependency conflict\r\n\r\nERROR: ResolutionImpossible: for help visit https://pip.pypa.io/en/latest/topics/dependency-resolution/#dealing-with-dependency-conflicts\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\n3.11\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\n3.8.3\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\n6.0.4\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\n1.8.2\n```\n\n\n### OS\n\nmacOS Ventura, M1\n\n### Related component\n\nServer, Client\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7195/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7195/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7192", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7192/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7192/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7192/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7192", "id": 1572650372, "node_id": "I_kwDOAMpNN85dvL2E", "number": 7192, "title": "Enabling of responses compression causes blocking of the async loop", "user": {"login": "mykola-mokhnach", "id": 7767781, "node_id": "MDQ6VXNlcjc3Njc3ODE=", "avatar_url": "https://avatars.githubusercontent.com/u/7767781?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mykola-mokhnach", "html_url": "https://github.com/mykola-mokhnach", "followers_url": "https://api.github.com/users/mykola-mokhnach/followers", "following_url": "https://api.github.com/users/mykola-mokhnach/following{/other_user}", "gists_url": "https://api.github.com/users/mykola-mokhnach/gists{/gist_id}", "starred_url": "https://api.github.com/users/mykola-mokhnach/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mykola-mokhnach/subscriptions", "organizations_url": "https://api.github.com/users/mykola-mokhnach/orgs", "repos_url": "https://api.github.com/users/mykola-mokhnach/repos", "events_url": "https://api.github.com/users/mykola-mokhnach/events{/privacy}", "received_events_url": "https://api.github.com/users/mykola-mokhnach/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 13, "created_at": "2023-02-06T14:17:28Z", "updated_at": "2023-03-08T06:47:48Z", "closed_at": "2023-03-08T06:47:48Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nEnabling  `response.enable_compression()` on a `web.Response` instance causes async loop blocking delays up to 2 seconds long on our server. \r\n\r\nI assume the original issue is coming from the fact that the compression is synchronous and eats lots of CPU cycles in case of large chunks/high core load: https://github.com/aio-libs/aiohttp/blob/2a1024ff1e8f210c5d735f87cd3b408c9ceedd8e/aiohttp/http_writer.py#L97\r\n\r\nPerhaps it would be possible to \"offload\" the compression to another CPU core in order to unblock the main event loop.\r\n\r\n### To Reproduce\r\n\r\nCreate a simple GET endpoint, which returns a JSON response like \r\n\r\n```python\r\n            response = web.Response(\r\n                text=json.dumps(result_json, ensure_ascii=False), status=200, content_type='application/json'\r\n            )\r\n            response.enable_compression()\r\n            return response\r\n```\r\n\r\nThen fetch the endpoint multiple times with json payload large enough (up to 10 megabytes in my case) and deflate compression accepted in the request headers. Async event loop debug must be enabled on the server side to see blocking events occurrences\r\n\r\n### Expected behavior\r\n\r\nNo async loop blocks should be observed longer as 100ms, although our charts show delays up to 2 seconds. This is not observed if I disable the compression.\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\n[EventLoopBlockingTimeEvent] function RequestHandler._handle_request (<Handle <TaskWakeupMethWrapper object at 0x7fb12e614ee0>(<Task finishe...> result=None>)>) was blocking the loop for 168.54695370420814 ms, called with args self: <RequestHandler connected>, request: <Request GET /api/v1/files >, start_time: 2369932.481492733, request_handler: <bound method Application._handle of <Application 0x7fb12f8bd190>>\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n$ python --version\r\nPython 3.8.16\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n$ python -m pip show aiohttp\r\nVersion: 3.8.1\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n$ python -m pip show multidict\r\nVersion: 6.0.4\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n$ python -m pip show yarl\r\nVersion: 1.8.2\r\n```\r\n\r\n\r\n### OS\r\n\r\npython:3.8-slim-bullseye Docker image\r\n\r\n### Related component\r\n\r\nServer\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7192/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7192/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7179", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7179/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7179/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7179/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7179", "id": 1552174254, "node_id": "I_kwDOAMpNN85chEyu", "number": 7179, "title": "Add no-cache headers to static files", "user": {"login": "Dreamsorcerer", "id": 2203121, "node_id": "MDQ6VXNlcjIyMDMxMjE=", "avatar_url": "https://avatars.githubusercontent.com/u/2203121?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dreamsorcerer", "html_url": "https://github.com/Dreamsorcerer", "followers_url": "https://api.github.com/users/Dreamsorcerer/followers", "following_url": "https://api.github.com/users/Dreamsorcerer/following{/other_user}", "gists_url": "https://api.github.com/users/Dreamsorcerer/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dreamsorcerer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dreamsorcerer/subscriptions", "organizations_url": "https://api.github.com/users/Dreamsorcerer/orgs", "repos_url": "https://api.github.com/users/Dreamsorcerer/repos", "events_url": "https://api.github.com/users/Dreamsorcerer/events{/privacy}", "received_events_url": "https://api.github.com/users/Dreamsorcerer/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "jalajk24", "id": 52814518, "node_id": "MDQ6VXNlcjUyODE0NTE4", "avatar_url": "https://avatars.githubusercontent.com/u/52814518?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jalajk24", "html_url": "https://github.com/jalajk24", "followers_url": "https://api.github.com/users/jalajk24/followers", "following_url": "https://api.github.com/users/jalajk24/following{/other_user}", "gists_url": "https://api.github.com/users/jalajk24/gists{/gist_id}", "starred_url": "https://api.github.com/users/jalajk24/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jalajk24/subscriptions", "organizations_url": "https://api.github.com/users/jalajk24/orgs", "repos_url": "https://api.github.com/users/jalajk24/repos", "events_url": "https://api.github.com/users/jalajk24/events{/privacy}", "received_events_url": "https://api.github.com/users/jalajk24/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "jalajk24", "id": 52814518, "node_id": "MDQ6VXNlcjUyODE0NTE4", "avatar_url": "https://avatars.githubusercontent.com/u/52814518?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jalajk24", "html_url": "https://github.com/jalajk24", "followers_url": "https://api.github.com/users/jalajk24/followers", "following_url": "https://api.github.com/users/jalajk24/following{/other_user}", "gists_url": "https://api.github.com/users/jalajk24/gists{/gist_id}", "starred_url": "https://api.github.com/users/jalajk24/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jalajk24/subscriptions", "organizations_url": "https://api.github.com/users/jalajk24/orgs", "repos_url": "https://api.github.com/users/jalajk24/repos", "events_url": "https://api.github.com/users/jalajk24/events{/privacy}", "received_events_url": "https://api.github.com/users/jalajk24/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2023-01-22T16:02:17Z", "updated_at": "2023-02-02T20:42:47Z", "closed_at": "2023-02-02T20:42:46Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "When serving static files (via StaticResource) should we add no-cache headers to avoid caching of static files?\r\nIn: https://github.com/aio-libs/aiohttp/blob/4635161ee8e7ad321cca46e01ce5bfeb1ad8bf26/aiohttp/web_urldispatcher.py#L635\r\n\r\nReasoning is that all our documentation says that these should only be used for development, and it can be frustrating when files are cached during development.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7179/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7179/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7172", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7172/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7172/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7172/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7172", "id": 1536044828, "node_id": "I_kwDOAMpNN85bji8c", "number": 7172, "title": "StreamResponse write() does not raise an exception if client disconnects", "user": {"login": "erik-moqvist", "id": 83806942, "node_id": "MDQ6VXNlcjgzODA2OTQy", "avatar_url": "https://avatars.githubusercontent.com/u/83806942?v=4", "gravatar_id": "", "url": "https://api.github.com/users/erik-moqvist", "html_url": "https://github.com/erik-moqvist", "followers_url": "https://api.github.com/users/erik-moqvist/followers", "following_url": "https://api.github.com/users/erik-moqvist/following{/other_user}", "gists_url": "https://api.github.com/users/erik-moqvist/gists{/gist_id}", "starred_url": "https://api.github.com/users/erik-moqvist/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/erik-moqvist/subscriptions", "organizations_url": "https://api.github.com/users/erik-moqvist/orgs", "repos_url": "https://api.github.com/users/erik-moqvist/repos", "events_url": "https://api.github.com/users/erik-moqvist/events{/privacy}", "received_events_url": "https://api.github.com/users/erik-moqvist/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1831256427, "node_id": "MDU6TGFiZWwxODMxMjU2NDI3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/reproducer:%20present", "name": "reproducer: present", "color": "c2e0c6", "default": false, "description": "This PR or issue contains code, which reproduce the problem described or clearly understandable STR"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2023-01-17T09:25:22Z", "updated_at": "2023-02-10T20:11:10Z", "closed_at": "2023-02-10T20:11:10Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nHi!\r\n\r\nI have an application that uses a `StreamResponse` to continuously write data to the client by calling the `write()` method. The server stops sending data when the client disconnects. In version 3.8.1 the `write()` method raises an exception when the client disconnects, but in later version it does not. The commit that introduces the bug is 20c93656d18b50c17c85b7a1e234276fb1444f27.\r\n\r\nI've tested on Python 3.7, 3.8 and 3.10.\n\n### To Reproduce\n\nAdd later if really needed.\n\n### Expected behavior\n\nAn exception is raised when the client disconnects.\n\n### Logs/tracebacks\n\n```python-traceback\n-\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\nPython 3.10.7\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.8.3\r\n...\n```\n\n\n### multidict Version\n\n```console\n-\n```\n\n\n### yarl Version\n\n```console\n-\n```\n\n\n### OS\n\nLinux\n\n### Related component\n\nServer\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7172/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7172/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7163", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7163/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7163/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7163/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7163", "id": 1528518064, "node_id": "I_kwDOAMpNN85bG1Ww", "number": 7163, "title": "'Int or String expected' raised when passing ssl_context to TCPSite()", "user": {"login": "shaohme", "id": 21690272, "node_id": "MDQ6VXNlcjIxNjkwMjcy", "avatar_url": "https://avatars.githubusercontent.com/u/21690272?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shaohme", "html_url": "https://github.com/shaohme", "followers_url": "https://api.github.com/users/shaohme/followers", "following_url": "https://api.github.com/users/shaohme/following{/other_user}", "gists_url": "https://api.github.com/users/shaohme/gists{/gist_id}", "starred_url": "https://api.github.com/users/shaohme/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shaohme/subscriptions", "organizations_url": "https://api.github.com/users/shaohme/orgs", "repos_url": "https://api.github.com/users/shaohme/repos", "events_url": "https://api.github.com/users/shaohme/events{/privacy}", "received_events_url": "https://api.github.com/users/shaohme/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-01-11T06:45:10Z", "updated_at": "2023-01-11T17:59:07Z", "closed_at": "2023-01-11T17:59:07Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nWhen passing a ssl_context to TCPSite() the error below is raised.\r\n\r\nThe 'line 108' mentioined in the stack trace points to the 'await site.start()' in the code snippet below\r\n\r\n### To Reproduce\r\n\r\n```python\r\n    apprunner = web.AppRunner(app)\r\n    await apprunner.setup()\r\n\r\n    cert_file = tempfile.NamedTemporaryFile(mode=\"w+b\")\r\n    key_file = tempfile.NamedTemporaryFile(mode=\"w+b\")\r\n\r\n    key = rsa.generate_private_key(\r\n        public_exponent=65537,\r\n        key_size=2048,\r\n        backend=default_backend(),\r\n    )\r\n\r\n    name = x509.Name([x509.NameAttribute(NameOID.COMMON_NAME, HOSTNAME)])\r\n\r\n    alt_names = [x509.DNSName(HOSTNAME)]\r\n\r\n    san = x509.SubjectAlternativeName(alt_names)\r\n    # path_len=0 means this cert can only sign itself, not other certs.\r\n    basic_contraints = x509.BasicConstraints(ca=True, path_length=0)\r\n    now = datetime.utcnow()\r\n    cert = (\r\n        x509.CertificateBuilder()\r\n        .subject_name(name)\r\n        .issuer_name(name)\r\n        .public_key(key.public_key())\r\n        .serial_number(1000)\r\n        .not_valid_before(now)\r\n        .not_valid_after(now + timedelta(days=10 * 365))\r\n        .add_extension(basic_contraints, False)\r\n        .add_extension(san, False)\r\n        .sign(key, hashes.SHA256(), default_backend())\r\n    )\r\n    cert_pem = cert.public_bytes(encoding=serialization.Encoding.PEM)\r\n    cert_file.write(cert_pem)\r\n    cert_file.flush()\r\n\r\n\r\n    key_pem = key.private_bytes(\r\n        encoding=serialization.Encoding.PEM,\r\n        format=serialization.PrivateFormat.TraditionalOpenSSL,\r\n        encryption_algorithm=serialization.NoEncryption(),\r\n    )\r\n    key_file.write(key_pem)\r\n    key_file.flush()\r\n\r\n    ssl_ctx = ssl.create_default_context(\r\n        purpose=ssl.Purpose.SERVER_AUTH, cafile=cert_file.name\r\n    )\r\n    ssl_ctx.load_cert_chain(cert_file.name, key_file.name)\r\n    site = web.TCPSite(\r\n        apprunner, host=HOSTNAME, port=listen_port, ssl_context=ssl_ctx\r\n    )\r\n\r\n    await site.start()\r\n```\r\n\r\n### Expected behavior\r\n\r\nI would expect it just to use the ssl_context\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nTraceback (most recent call last):\r\n    File \"/usr/lib/python3.10/threading.py\", line 1016, in _bootstrap_inner\r\n      self.run()\r\n    File \"/usr/lib/python3.10/threading.py\", line 953, in run\r\n      self._target(*self._args, **self._kwargs)\r\n    File \"test_it_long.py\", line 127, in run_web_srvs\r\n      loop.run_until_complete(start_web(app, kill_q, port_q, listen_port, sslctx))\r\n    File \"/usr/lib/python3.10/asyncio/base_events.py\", line 649, in run_until_complete\r\n      return future.result()\r\n    File \"test_it_long.py\", line 108, in start_web\r\n      await site.start()\r\n    File \"/usr/lib/python3/dist-packages/aiohttp/web_runner.py\", line 121, in start\r\n      self._server = await loop.create_server(\r\n    File \"/usr/lib/python3.10/asyncio/base_events.py\", line 1479, in create_server\r\n      infos = await tasks.gather(*fs)\r\n    File \"/usr/lib/python3.10/asyncio/base_events.py\", line 1416, in _create_server_getaddrinfo\r\n      infos = await self._ensure_resolved((host, port), family=family,\r\n    File \"/usr/lib/python3.10/asyncio/base_events.py\", line 1412, in _ensure_resolved\r\n      return await loop.getaddrinfo(host, port, family=family, type=type,\r\n    File \"/usr/lib/python3.10/asyncio/base_events.py\", line 863, in getaddrinfo\r\n      return await self.run_in_executor(\r\n    File \"/usr/lib/python3.10/concurrent/futures/thread.py\", line 58, in run\r\n      result = self.fn(*self.args, **self.kwargs)\r\n    File \"/usr/lib/python3.10/socket.py\", line 955, in getaddrinfo\r\n      for res in _socket.getaddrinfo(host, port, family, type, proto, flags):\r\n  OSError: Int or String expected\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n3.10.9\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n3.8.3\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n6.0.4\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n1.8.1\r\n```\r\n\r\n\r\n### OS\r\n\r\nDevuan testing\r\n\r\n### Related component\r\n\r\nServer\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7163/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7163/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7159", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7159/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7159/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7159/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7159", "id": 1521754453, "node_id": "I_kwDOAMpNN85atCFV", "number": 7159, "title": "Client streaming uploads add `content-length` header note to avoid streaming upload failure", "user": {"login": "li1234yun", "id": 26505658, "node_id": "MDQ6VXNlcjI2NTA1NjU4", "avatar_url": "https://avatars.githubusercontent.com/u/26505658?v=4", "gravatar_id": "", "url": "https://api.github.com/users/li1234yun", "html_url": "https://github.com/li1234yun", "followers_url": "https://api.github.com/users/li1234yun/followers", "following_url": "https://api.github.com/users/li1234yun/following{/other_user}", "gists_url": "https://api.github.com/users/li1234yun/gists{/gist_id}", "starred_url": "https://api.github.com/users/li1234yun/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/li1234yun/subscriptions", "organizations_url": "https://api.github.com/users/li1234yun/orgs", "repos_url": "https://api.github.com/users/li1234yun/repos", "events_url": "https://api.github.com/users/li1234yun/events{/privacy}", "received_events_url": "https://api.github.com/users/li1234yun/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-01-06T02:06:32Z", "updated_at": "2023-01-29T05:37:15Z", "closed_at": "2023-01-29T05:37:15Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nWhen I refer the doc(https://docs.aiohttp.org/en/stable/client_quickstart.html#streaming-uploads) to stream upload my data, I always failed. When I add extra request header `Content-Length`, the failure is gone. So I think the doc should note the problem.\r\n\r\n`Additional context` will show my code.\n\n### To Reproduce\n\n1. Get one response with client\r\n2. Add extra data to response data \r\n3. Use async generator to send reqeust data\r\n\n\n### Expected behavior\n\nWhen I miss `Content-Length` header, the streaming upload will fail.\n\n### Logs/tracebacks\n\n```python-traceback\nNo\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\nPython 3.10.6\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.8.3\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: \r\nAuthor-email: \r\nLicense: Apache 2\r\nLocation: /home/lzy/Git/Work/cache_node_ngx_waf/.venv/lib/python3.10/site-packages\r\nRequires: aiosignal, async-timeout, attrs, charset-normalizer, frozenlist, multidict, yarl\r\nRequired-by:\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 6.0.3\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/lzy/Git/Work/cache_node_ngx_waf/.venv/lib/python3.10/site-packages\r\nRequires: \r\nRequired-by: aiohttp, yarl\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.8.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/lzy/Git/Work/cache_node_ngx_waf/.venv/lib/python3.10/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\n```\n\n\n### OS\n\nNo LSB modules are available.\r\nDistributor ID: Debian\r\nDescription:    Debian GNU/Linux 11 (bullseye)\r\nRelease:        11\r\nCodename:       bullseye\n\n### Related component\n\nClient\n\n### Additional context\n\nBelow code is my case.\r\n\r\n```python\r\nasync with self.session.get(url, headers=headers) as resp:\r\n    resp.raise_for_status()\r\n\r\n    content = io.BytesIO()\r\n    version: HttpVersion = resp.version  # type: ignore\r\n    content.write(\r\n        f\"{resp.url.scheme.upper()}/{version.major}.{version.minor} {resp.status} {resp.reason}\\r\\n\".encode(\r\n            \"ascii\"\r\n        )\r\n    )\r\n    for h in resp.headers:\r\n        content.write(f\"{h}: {resp.headers[h]}\\r\\n\".encode(\"ascii\"))\r\n    content.write(b\"\\r\\n\")\r\n    logging.debug(\r\n        f\"header length: {content.tell()}, header content: {content.getvalue().decode('utf-8')}\"\r\n    )\r\n\r\n    body_length = content.tell() + int(\r\n        resp.headers.get(HTTP_HEADER_NAME_CONTENT_LENGTH, \"0\")\r\n    )\r\n\r\n    async def read_response():\r\n        yield content.getvalue()\r\n        content.close()\r\n\r\n        length = 0\r\n        async for data, eof in resp.content.iter_chunks():\r\n            length += len(data)\r\n            logging.debug(\r\n                f\"trunk data length: {len(data)}, total length: {length}, is eof: {eof}\"\r\n            )\r\n            yield data\r\n\r\n    await self.request(\r\n        method=\"push\",\r\n        normal_status_codes=[200, 201],\r\n        data=read_response(),\r\n\r\n        # ----------------------------------------------------------------\r\n        # ******* When I miss the header, the request will fail *******\r\n        headers={HTTP_HEADER_NAME_CONTENT_LENGTH: str(body_length)},\r\n    )\r\n\r\n```\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7159/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7159/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7151", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7151/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7151/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7151/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7151", "id": 1513928443, "node_id": "I_kwDOAMpNN85aPLb7", "number": 7151, "title": "Doc: Typo ContentDisposition", "user": {"login": "solarjoe", "id": 10460113, "node_id": "MDQ6VXNlcjEwNDYwMTEz", "avatar_url": "https://avatars.githubusercontent.com/u/10460113?v=4", "gravatar_id": "", "url": "https://api.github.com/users/solarjoe", "html_url": "https://github.com/solarjoe", "followers_url": "https://api.github.com/users/solarjoe/followers", "following_url": "https://api.github.com/users/solarjoe/following{/other_user}", "gists_url": "https://api.github.com/users/solarjoe/gists{/gist_id}", "starred_url": "https://api.github.com/users/solarjoe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/solarjoe/subscriptions", "organizations_url": "https://api.github.com/users/solarjoe/orgs", "repos_url": "https://api.github.com/users/solarjoe/repos", "events_url": "https://api.github.com/users/solarjoe/events{/privacy}", "received_events_url": "https://api.github.com/users/solarjoe/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 277836062, "node_id": "MDU6TGFiZWwyNzc4MzYwNjI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/good%20first%20issue", "name": "good first issue", "color": "7057ff", "default": true, "description": "Good for newcomers"}, {"id": 445958404, "node_id": "MDU6TGFiZWw0NDU5NTg0MDQ=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/documentation", "name": "documentation", "color": "0075ca", "default": true, "description": "Improvements or additions to documentation"}, {"id": 1077350962, "node_id": "MDU6TGFiZWwxMDc3MzUwOTYy", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/Hacktoberfest", "name": "Hacktoberfest", "color": "d93f0b", "default": false, "description": "We think it's good for https://hacktoberfest.digitalocean.com/"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-12-29T17:37:52Z", "updated_at": "2022-12-30T20:37:07Z", "closed_at": "2022-12-30T20:37:07Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Describe the bug\n\nCurrent doc states `ContentDisposition` has a field `value`\r\n\r\nhttps://docs.aiohttp.org/en/stable/client_reference.html#aiohttp.ContentDisposition\r\nBut it is `type`. \r\n\r\nhttps://github.com/aio-libs/aiohttp/blob/5bf9b4aae7046704b418c16452c2d1ced934abfb/aiohttp/client_reqrep.py#L96\n\n### To Reproduce\n\nJust a typo.\r\n\n\n### Expected behavior\n\n-\n\n### Logs/tracebacks\n\n```python-traceback\n-\n```\n\n\n### Python Version\n\n```console\n-\n```\n\n\n### aiohttp Version\n\n```console\n-\n```\n\n\n### multidict Version\n\n```console\n-\n```\n\n\n### yarl Version\n\n```console\n-\n```\n\n\n### OS\n\n-\n\n### Related component\n\nClient\n\n### Additional context\n\n-\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7151/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7151/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7149", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7149/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7149/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7149/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7149", "id": 1512995098, "node_id": "I_kwDOAMpNN85aLnka", "number": 7149, "title": "client: unexpected timeouts with chunked uploads when setting sock_read timeout", "user": {"login": "dtrifiro", "id": 36171005, "node_id": "MDQ6VXNlcjM2MTcxMDA1", "avatar_url": "https://avatars.githubusercontent.com/u/36171005?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtrifiro", "html_url": "https://github.com/dtrifiro", "followers_url": "https://api.github.com/users/dtrifiro/followers", "following_url": "https://api.github.com/users/dtrifiro/following{/other_user}", "gists_url": "https://api.github.com/users/dtrifiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtrifiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtrifiro/subscriptions", "organizations_url": "https://api.github.com/users/dtrifiro/orgs", "repos_url": "https://api.github.com/users/dtrifiro/repos", "events_url": "https://api.github.com/users/dtrifiro/events{/privacy}", "received_events_url": "https://api.github.com/users/dtrifiro/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344995986, "node_id": "MDU6TGFiZWwzNDQ5OTU5ODY=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/client", "name": "client", "color": "bfd4f2", "default": false, "description": null}, {"id": 1831256427, "node_id": "MDU6TGFiZWwxODMxMjU2NDI3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/reproducer:%20present", "name": "reproducer: present", "color": "c2e0c6", "default": false, "description": "This PR or issue contains code, which reproduce the problem described or clearly understandable STR"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-12-28T17:14:23Z", "updated_at": "2023-02-11T16:54:39Z", "closed_at": "2023-02-11T16:54:39Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nUploading large files using `put`/`post` with chunked encoding AND setting `sock_read` timeout results in an unexpected timeout error. \r\n\r\nTraceback is provided below.\r\n\r\n### To Reproduce\r\n\r\nServer code (aiohttp):\r\n\r\n```python\r\nimport asyncio\r\nimport aiohttp\r\n\r\nPORT = 8472\r\nHOST = \"localhost\"\r\n\r\n\r\nasync def handler(request: aiohttp.web.Request) -> aiohttp.web.StreamResponse:\r\n    loop = asyncio.get_running_loop()\r\n    print(f\"[{loop.time()}] got request\")\r\n\r\n    response = aiohttp.web.StreamResponse()\r\n    response.enable_chunked_encoding()\r\n    writer = await response.prepare(request)\r\n\r\n    read_data = 0\r\n    print(f\"[{loop.time()}] started streaming body\")\r\n\r\n    async for data, _ in request.content.iter_chunks():\r\n        read_data += len(data)\r\n        print(f\"[{loop.time()}] {read_data=}\", end=\"\\r\")\r\n        await asyncio.sleep(1e-4)    # NOTE: tweaking this and/or the above print, along with `sock_read` in the client might yield different results (successful upload instead of timeout)\r\n\r\n    await writer.write_eof()\r\n    print(f\"\\n[{loop.time()}] finished\")\r\n\r\n    print(f\"[{loop.time()}] finished reading body {read_data=}\")\r\n    return response\r\n\r\n\r\nasync def main():\r\n    \"\"\" listens and streams the body of a chunked transfer upload \"\"\"\r\n    loop = asyncio.get_event_loop()\r\n\r\n    server = aiohttp.web.Server(handler)\r\n    await loop.create_server(server, HOST, PORT)\r\n    print(f\"Listening on http://{HOST}:{PORT}\")\r\n\r\n    try:\r\n        while True:\r\n            await asyncio.sleep(1)\r\n    except KeyboardInterrupt:\r\n        print(\"Shutting down\")\r\n        await server.shutdown(10)\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    asyncio.run(main())\r\n```\r\n\r\nClient code:\r\n\r\n```python\r\nimport asyncio\r\nimport aiohttp\r\n\r\nPORT = 8472\r\nHOST = \"localhost\"\r\n\r\n\r\nSOCK_READ_TIMEOUT = 5 # tweaking this and/or the sleep in the server implementation might yield different results\r\n\r\n\r\nasync def gen_chunks(\r\n    payload_size: int,\r\n    chunk_size: int = 0x1000,  # 4k\r\n):\r\n    processed = 0\r\n    while processed < payload_size:\r\n        if (processed + chunk_size) > payload_size:\r\n            # final chunk\r\n            chunk_size = payload_size - processed\r\n        yield b\"Z\" * chunk_size\r\n        processed += chunk_size\r\n\r\n\r\nasync def main(payload_size: int, method: str = \"put\", **kwargs):\r\n    url = f\"http://{HOST}:{PORT}\"\r\n    remote_path = \"file\"\r\n\r\n    timeout = aiohttp.ClientTimeout(\r\n        total=None,\r\n        connect=0,\r\n        sock_connect=0,\r\n        sock_read=SOCK_READ_TIMEOUT,\r\n    )\r\n    async with aiohttp.ClientSession(timeout=timeout) as session:\r\n        meth = getattr(session, method)\r\n        async with meth(\r\n            f\"{url}/{remote_path}\",\r\n            data=gen_chunks(payload_size),\r\n            **kwargs,\r\n        ) as resp:\r\n            resp.raise_for_status()\r\n            print(f\"{resp.status=}, {await resp.read()}\")\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    payload_1gb = 1024 * 0x100000\r\n\r\n    asyncio.run(main(payload_1gb))\r\n```\r\n\r\n\r\n### Expected behavior\r\n\r\nUpload should succeed with no timeout.\r\n\r\nIn particular, the `ServerTimeoutError` exception is raised because we're waiting to read from the protocol while `StreamWriter` is still sending data.\r\n\r\nWhen calling [`_request`](https://github.com/aio-libs/aiohttp/blob/7d1ada8ae598c61dcb087516358db3803ae105a6/aiohttp/client.py#L326), we call [`conn.protocol.set_response_params(..., read_timeout=real_timeout.sock_read, ...)`](https://github.com/aio-libs/aiohttp/blob/7d1ada8ae598c61dcb087516358db3803ae105a6/aiohttp/client.py#L515-L524) which sets up a timeout handler callback that fires in `real_timeout.sock_read`  seconds, although this is rescheduled whenever data is received ( see [`ResponseHandler.data_received`](https://github.com/aio-libs/aiohttp/blob/8e92c4c7c305f914c17f41539da20822ea7baddf/aiohttp/client_proto.py#L202), [`ResponseHandler._reschedule_timeout`](https://github.com/aio-libs/aiohttp/blob/8e92c4c7c305f914c17f41539da20822ea7baddf/aiohttp/client_proto.py#L185-L194). \r\n\r\nSince nothing will be read from the `ResponseHandler` until all of the chunks are sent to the server, any upload that takes longer than `sock_read` s to upload will fail with a timeout.\r\n\r\nA simple workaround for this is to reschedule the read timer after each chunk is sent through `StreamWriter`, something like this:\r\n```diff\r\ndiff --git a/aiohttp/http_writer.py b/aiohttp/http_writer.py\r\nindex db3d6a04..a5b241d8 100644\r\n--- a/aiohttp/http_writer.py\r\n+++ b/aiohttp/http_writer.py\r\n@@ -114,6 +114,7 @@ class StreamWriter(AbstractStreamWriter):\r\n                 chunk = chunk_len_pre + chunk + b\"\\r\\n\"\r\n \r\n             self._write(chunk)\r\n+            self.protocol._reschedule_timeout()\r\n \r\n             if self.buffer_size > LIMIT and drain:\r\n                 self.buffer_size = 0\r\n```\r\n\r\nOr, if we wish to avoid calling `_reschedule_timeout` directly:\r\n\r\n```diff\r\ndiff --git a/aiohttp/http_writer.py b/aiohttp/http_writer.py\r\nindex db3d6a04..7a274c56 100644\r\n--- a/aiohttp/http_writer.py\r\n+++ b/aiohttp/http_writer.py\r\n@@ -114,6 +114,7 @@ class StreamWriter(AbstractStreamWriter):\r\n                 chunk = chunk_len_pre + chunk + b\"\\r\\n\"\r\n \r\n             self._write(chunk)\r\n+            self.protocol.data_received(b\"\")\r\n \r\n             if self.buffer_size > LIMIT and drain:\r\n                 self.buffer_size = 0\r\n```\r\n \r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nTraceback (most recent call last):\r\n  File \"aiohttp/timeouts_investigation.py\", line 291, in <module>\r\n    asyncio.run(main_client(payload_size))\r\n  File \"/usr/lib/python3.10/asyncio/runners.py\", line 44, in run\r\n    return loop.run_until_complete(main)\r\n  File \"/usr/lib/python3.10/asyncio/base_events.py\", line 649, in run_until_complete\r\n    return future.result()\r\n  File \"aiohttp/timeouts_investigation.py\", line 140, in main_client\r\n    async with meth(\r\n  File \"aiohttp/aiohttp/client.py\", line 1141, in __aenter__\r\n    self._resp = await self._coro\r\n  File \"aiohttp/aiohttp/client.py\", line 560, in _request\r\n    await resp.start(conn)\r\n  File \"aiohttp/aiohttp/client_reqrep.py\", line 899, in start\r\n    message, payload = await protocol.read()  # type: ignore[union-attr]\r\n  File \"aiohttp/aiohttp/streams.py\", line 616, in read\r\n    await self._waiter\r\naiohttp.client_exceptions.ServerTimeoutError: Timeout on reading data from socket\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n3.10.8\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n3.8.3\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n5.2.0\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n1.8.1\r\n```\r\n\r\n\r\n### OS\r\n\r\nLinux\r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7149/reactions", "total_count": 3, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7149/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7145", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7145/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7145/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7145/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7145", "id": 1510546842, "node_id": "I_kwDOAMpNN85aCR2a", "number": 7145, "title": "An \u2018Task was destroyed but it is pending!\u2019\uff0cwhen I used aiohttp + aioredis ", "user": {"login": "bendd1", "id": 80678876, "node_id": "MDQ6VXNlcjgwNjc4ODc2", "avatar_url": "https://avatars.githubusercontent.com/u/80678876?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bendd1", "html_url": "https://github.com/bendd1", "followers_url": "https://api.github.com/users/bendd1/followers", "following_url": "https://api.github.com/users/bendd1/following{/other_user}", "gists_url": "https://api.github.com/users/bendd1/gists{/gist_id}", "starred_url": "https://api.github.com/users/bendd1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bendd1/subscriptions", "organizations_url": "https://api.github.com/users/bendd1/orgs", "repos_url": "https://api.github.com/users/bendd1/repos", "events_url": "https://api.github.com/users/bendd1/events{/privacy}", "received_events_url": "https://api.github.com/users/bendd1/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-12-26T03:19:07Z", "updated_at": "2022-12-26T13:36:51Z", "closed_at": "2022-12-26T13:36:51Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nclass AsyncRedisClient(object):\r\n    \"\"\" \u5f02\u6b65\u7684Redis\u5ba2\u6237\u7aef,\u57fa\u4e8e`aioredis`\r\n    \"\"\"\r\n    _instance = None\r\n\r\n    def __new__(cls, *args, **kwargs):\r\n        \"\"\"\r\n        :param args:\r\n        :param kwargs:\r\n        :return:\r\n        \"\"\"\r\n        if cls._instance is None:\r\n            cls._instance = super().__new__(cls)\r\n        return cls._instance\r\n\r\n    def __init__(self, host: str = None, port: int = None, db: int = None,\r\n                 password: str = None, io_loop=None,\r\n                 *args, **kwargs):\r\n        \"\"\" \u81ea\u5b9a\u4e49Host\u8fde\u63a5\u7684\u65b9\u5f0f\r\n        :param host:\r\n        :param port:\r\n        :param db:\r\n        :param password:\r\n        :param io_loop:\r\n        :param args:\r\n        :param kwargs:\r\n        \"\"\"\r\n        self._conn = {'host': host, 'port': port, 'db': db, 'password': password}\r\n        if host:\r\n\r\n            # TODO\uff1a\u53ef\u4ee5\u6269\u5c55\u652f\u6301\u81ea\u9002\u5e94\u96c6\u7fa4\u548c\u5355\u673a\u4e24\u79cd\u65b9\u5f0f\r\n            _conn = {}\r\n            self.url = _conn['url']\r\n            self.url_s = _conn['url_s']\r\n            self.sentinels = _conn['sentinels']\r\n            self.password = _conn['password']\r\n            self.port = int(_conn['port'])\r\n            self.db = int(_conn['db'])\r\n        else:\r\n            self.url = CFG.REDIS_SENTINEL_URL\r\n            self.db = int(CFG.REDIS_DB or 0)\r\n            self.password = CFG.REDIS_PASSWORD\r\n            self.sentinels = CFG.redis_sentinel_sentinels or ''\r\n\r\n        if not self.password:\r\n            self.password = None\r\n\r\n        self.io_loop = io_loop\r\n        if io_loop is None:\r\n            self.io_loop = asyncio.get_event_loop()\r\n        self._client = None\r\n\r\n    async def connection(self):\r\n        \"\"\"\r\n        :return:\r\n        \"\"\"\r\n        if self._client is not None:\r\n            return self._client\r\n\r\n        self.display(f'[start]\u521d\u59cb\u5316Redis\u8fde\u63a5[{self.url}]', level='debug')\r\n        print(f'[start]\u521d\u59cb\u5316Redis\u8fde\u63a5[{self.url}]')\r\n        if self.url.startswith('sentinel://'):\r\n            se = await aioredis.create_sentinel(sentinels=self.sentinels,\r\n                                                db=self.db,\r\n                                                password=self.password,\r\n                                                encoding='utf8',\r\n                                                loop=self.io_loop)\r\n            client = se.master_for(CFG.REDIS_SENTINEL_CLUSTER or 'mymaster')\r\n            self.display('[start]\u4f7f\u7528[sentinel]\u6a21\u5f0f!')\r\n\r\n        else:\r\n            client = await aioredis.create_redis(self.url,\r\n                                                 db=self.db,\r\n                                                 password=self.password,\r\n                                                 encoding='utf8',\r\n                                                 loop=self.io_loop)\r\n            self.display('[start]\u4f7f\u7528\u77ed\u8fde\u63a5\u6a21\u5f0f!')\r\n\r\n        self.display(f'[start]\u521d\u59cb\u5316 Redis\u8fde\u63a5[{self.url}]\u6210\u529f!',\r\n                     level='info')\r\n        self._client = client\r\n        return self._client\r\n\r\n    async def get_cli(self):\r\n        \"\"\"\r\n        :return:\r\n        \"\"\"\r\n        await self.connection()\r\n        return self._client\r\n\r\n    def close(self):\r\n        \"\"\"\r\n        :return:\r\n        \"\"\"\r\n        if self._client:\r\n            self._client.close()\r\n\r\n    def display(self, message, level='debug'):\r\n        \"\"\"\r\n        \u65e5\u5fd7\u56de\u663e\r\n        :param message:\r\n        :param level:\r\n        :return:\r\n        \"\"\"\r\n        pass\r\n\r\n    async def __aenter__(self):\r\n        \"\"\"\r\n        :return:\r\n        \"\"\"\r\n        if not self._client:\r\n            await self.connection()\r\n        return self\r\n\r\n    async def __aexit__(self, exc_type, exc_val, exc_tb):\r\n        \"\"\"\r\n        close\u6389\u94fe\u63a5\r\n        :param exc_type:\r\n        :param exc_val:\r\n        :param exc_tb:\r\n        :return:\r\n        \"\"\"\r\n        # todo: \u624b\u52a8\u5173\u95ed\u5931\u8d25\uff0c\u5f85\u8ddf\u8fdb\r\n        pass\r\n\r\n    async def get(self, key: str, *args, **kwargs) -> dict:\r\n        \"\"\"\r\n        :param key: \u7f13\u5b58KEY\r\n        :param args:\r\n        :param kwargs:\r\n        :return:\r\n        \"\"\"\r\n        await self.connection()\r\n        data = await self._client.get(key)\r\n        if data:\r\n            data = json.loads(data)\r\n        else:\r\n            data = {}\r\n\r\n        if kwargs.get('pop', False):\r\n            await self._client.delete(key)\r\n        return data\r\n\r\n    async def set(self, key, data, expire: int = None, *args, **kwargs):\r\n        \"\"\"\r\n        :param key:\r\n        :param data: \u9700\u8981\u7f13\u5b58\u7684\u6570\u636e\r\n        :param expire:\r\n        :return:\r\n        \"\"\"\r\n        if isinstance(data, (dict, list, tuple)):\r\n            data = json.dumps(data)\r\n        assert isinstance(data,\r\n                          six.string_types), 'cache_data foramt error, require dict'\r\n\r\n        await self.connection()\r\n        await self._client.set(key, data)\r\n        if expire:\r\n            await self._client.expire(key, expire)\n\n### To Reproduce\n\n  File \"/usr/local/lib/python3.7/site-packages/click/core.py\", line 754, in invoke\r\n    return __callback(*args, **kwargs)\r\n  File \"/home/app/fawo_bond/server.py\", line 99, in runserver\r\n    auto_reload=True\r\n  File \"/usr/local/lib/python3.7/site-packages/sanic/app.py\", line 1169, in run\r\n    serve_multiple(server_settings, workers)\r\n  File \"/usr/local/lib/python3.7/site-packages/sanic/server.py\", line 997, in serve_multiple\r\n    process.start()\r\n  File \"/usr/local/lib/python3.7/multiprocessing/process.py\", line 112, in start\r\n    self._popen = self._Popen(self)\r\n  File \"/usr/local/lib/python3.7/multiprocessing/context.py\", line 223, in _Popen\r\n    return _default_context.get_context().Process._Popen(process_obj)\r\n  File \"/usr/local/lib/python3.7/multiprocessing/context.py\", line 277, in _Popen\r\n    return Popen(process_obj)\r\n  File \"/usr/local/lib/python3.7/multiprocessing/popen_fork.py\", line 20, in __init__\r\n    self._launch(process_obj)\r\n  File \"/usr/local/lib/python3.7/multiprocessing/popen_fork.py\", line 74, in _launch\r\n    code = process_obj._bootstrap()\r\n  File \"/usr/local/lib/python3.7/multiprocessing/process.py\", line 297, in _bootstrap\r\n    self.run()\r\n  File \"/usr/local/lib/python3.7/multiprocessing/process.py\", line 99, in run\r\n    self._target(*self._args, **self._kwargs)\r\n  File \"/usr/local/lib/python3.7/site-packages/sanic/server.py\", line 920, in serve\r\n    loop.run_forever()\r\n  File \"/usr/local/lib/python3.7/site-packages/sanic/app.py\", line 976, in handle_request\r\n    response = await response\r\n  File \"/home/app/fawo_bond/base/auth_extensions.py\", line 56, in _deco\r\n    auth_header_key=auth_header_key)\r\n  File \"/home/app/fawo_bond/base/sanic_extensions.py\", line 90, in load_auth_user\r\n    user_data = await loader.load()\r\n  File \"/home/app/fawo_bond/base/auth_extensions.py\", line 169, in load\r\n    cache_data = await self.async_redis.get(key=cache_key)\r\n  File \"/home/app/fawo_bond/services/redis_service.py\", line 154, in get\r\n    await self.connection()\r\n  File \"/home/app/fawo_bond/services/redis_service.py\", line 88, in connection\r\n    loop=self.io_loop)\r\n  File \"/usr/local/lib/python3.7/site-packages/aioredis/sentinel/commands.py\", line 27, in create_sentinel\r\n    loop=loop)\r\n  File \"/usr/local/lib/python3.7/site-packages/aioredis/sentinel/pool.py\", line 45, in create_sentinel_pool\r\n    loop=loop)\r\n  File \"/usr/local/lib/python3.7/site-packages/aioredis/sentinel/pool.py\", line 107, in __init__\r\n    self._monitor_task = asyncio.ensure_future(echo_events())\r\ntask: <Task pending coro= wait_for=()] created at /usr/local/lib/python3.7/asyncio/locks.py:290> created at /usr/local/lib/python3.7/site-packages/aioredis/sentinel/pool.py:107>\r\nTask was destroyed but it is pending!\r\nsource_traceback: Object created at (most recent call last):\r\n  File \"/home/app/manage.py\", line 11, in <module>\r\n    manage()\r\n  File \"/usr/local/lib/python3.7/site-packages/click/core.py\", line 1128, in __call__\r\n    return self.main(*args, **kwargs)\r\n  File \"/usr/local/lib/python3.7/site-packages/click/core.py\", line 1053, in main\r\n    rv = self.invoke(ctx)\r\n  File \"/usr/local/lib/python3.7/site-packages/click/core.py\", line 1659, in invoke\r\n    return _process_result(sub_ctx.command.invoke(sub_ctx))\r\n  File \"/usr/local/lib/python3.7/site-packages/click/core.py\", line 1395, in invoke\r\n    return ctx.invoke(self.callback, **ctx.params)\r\n  File \"/usr/local/lib/python3.7/site-packages/click/core.py\", line 754, in invoke\r\n    return __callback(*args, **kwargs)\r\n  File \"/home/app/fawo_bond/server.py\", line 99, in runserver\r\n    auto_reload=True\r\n  File \"/usr/local/lib/python3.7/site-packages/sanic/app.py\", line 1169, in run\r\n    serve_multiple(server_settings, workers)\r\n  File \"/usr/local/lib/python3.7/site-packages/sanic/server.py\", line 997, in serve_multiple\r\n    process.start()\r\n  File \"/usr/local/lib/python3.7/multiprocessing/process.py\", line 112, in start\r\n    self._popen = self._Popen(self)\r\n  File \"/usr/local/lib/python3.7/multiprocessing/context.py\", line 223, in _Popen\r\n    return _default_context.get_context().Process._Popen(process_obj)\r\n  File \"/usr/local/lib/python3.7/multiprocessing/context.py\", line 277, in _Popen\r\n    return Popen(process_obj)\r\n  File \"/usr/local/lib/python3.7/multiprocessing/popen_fork.py\", line 20, in __init__\r\n    self._launch(process_obj)\r\n  File \"/usr/local/lib/python3.7/multiprocessing/popen_fork.py\", line 74, in _launch\r\n    code = process_obj._bootstrap()\r\n  File \"/usr/local/lib/python3.7/multiprocessing/process.py\", line 297, in _bootstrap\r\n    self.run()\r\n  File \"/usr/local/lib/python3.7/multiprocessing/process.py\", line 99, in run\r\n    self._target(*self._args, **self._kwargs)\r\n  File \"/usr/local/lib/python3.7/site-packages/sanic/server.py\", line 920, in serve\r\n    loop.run_forever()\r\n  File \"/usr/local/lib/python3.7/site-packages/sanic/app.py\", line 976, in handle_request\r\n    response = await response\r\n  File \"/home/app/fawo_bond/base/auth_extensions.py\", line 56, in _deco\r\n    auth_header_key=auth_header_key)\r\n  File \"/home/app/fawo_bond/base/sanic_extensions.py\", line 90, in load_auth_user\r\n    user_data = await loader.load()\r\n  File \"/home/app/fawo_bond/base/auth_extensions.py\", line 169, in load\r\n    cache_data = await self.async_redis.get(key=cache_key)\r\n  File \"/home/app/fawo_bond/services/redis_service.py\", line 154, in get\r\n    await self.connection()\r\n  File \"/home/app/fawo_bond/services/redis_service.py\", line 88, in connection\r\n    loop=self.io_loop)\r\n  File \"/usr/local/lib/python3.7/site-packages/aioredis/sentinel/commands.py\", line 27, in create_sentinel\r\n    loop=loop)\r\n  File \"/usr/local/lib/python3.7/site-packages/aioredis/sentinel/pool.py\", line 45, in create_sentinel_pool\r\n    loop=loop)\r\n  File \"/usr/local/lib/python3.7/site-packages/aioredis/sentinel/pool.py\", line 107, in __init__\r\n    self._monitor_task = asyncio.ensure_future(echo_events())\r\ntask: <Task pending coro= wait_for=()] created at /usr/local/lib/python3.7/asyncio/locks.py:290> created at /usr/local/lib/python3.7/site-packages/aioredis/sentinel/pool.py:107>\n\n### Expected behavior\n\n  File \"/usr/local/lib/python3.7/site-packages/click/core.py\", line 754, in invoke\r\n    return __callback(*args, **kwargs)\r\n  File \"/home/app/fawo_bond/server.py\", line 99, in runserver\r\n    auto_reload=True\r\n  File \"/usr/local/lib/python3.7/site-packages/sanic/app.py\", line 1169, in run\r\n    serve_multiple(server_settings, workers)\r\n  File \"/usr/local/lib/python3.7/site-packages/sanic/server.py\", line 997, in serve_multiple\r\n    process.start()\r\n  File \"/usr/local/lib/python3.7/multiprocessing/process.py\", line 112, in start\r\n    self._popen = self._Popen(self)\r\n  File \"/usr/local/lib/python3.7/multiprocessing/context.py\", line 223, in _Popen\r\n    return _default_context.get_context().Process._Popen(process_obj)\r\n  File \"/usr/local/lib/python3.7/multiprocessing/context.py\", line 277, in _Popen\r\n    return Popen(process_obj)\r\n  File \"/usr/local/lib/python3.7/multiprocessing/popen_fork.py\", line 20, in __init__\r\n    self._launch(process_obj)\r\n  File \"/usr/local/lib/python3.7/multiprocessing/popen_fork.py\", line 74, in _launch\r\n    code = process_obj._bootstrap()\r\n  File \"/usr/local/lib/python3.7/multiprocessing/process.py\", line 297, in _bootstrap\r\n    self.run()\r\n  File \"/usr/local/lib/python3.7/multiprocessing/process.py\", line 99, in run\r\n    self._target(*self._args, **self._kwargs)\r\n  File \"/usr/local/lib/python3.7/site-packages/sanic/server.py\", line 920, in serve\r\n    loop.run_forever()\r\n  File \"/usr/local/lib/python3.7/site-packages/sanic/app.py\", line 976, in handle_request\r\n    response = await response\r\n  File \"/home/app/fawo_bond/base/auth_extensions.py\", line 56, in _deco\r\n    auth_header_key=auth_header_key)\r\n  File \"/home/app/fawo_bond/base/sanic_extensions.py\", line 90, in load_auth_user\r\n    user_data = await loader.load()\r\n  File \"/home/app/fawo_bond/base/auth_extensions.py\", line 169, in load\r\n    cache_data = await self.async_redis.get(key=cache_key)\r\n  File \"/home/app/fawo_bond/services/redis_service.py\", line 154, in get\r\n    await self.connection()\r\n  File \"/home/app/fawo_bond/services/redis_service.py\", line 88, in connection\r\n    loop=self.io_loop)\r\n  File \"/usr/local/lib/python3.7/site-packages/aioredis/sentinel/commands.py\", line 27, in create_sentinel\r\n    loop=loop)\r\n  File \"/usr/local/lib/python3.7/site-packages/aioredis/sentinel/pool.py\", line 45, in create_sentinel_pool\r\n    loop=loop)\r\n  File \"/usr/local/lib/python3.7/site-packages/aioredis/sentinel/pool.py\", line 107, in __init__\r\n    self._monitor_task = asyncio.ensure_future(echo_events())\r\ntask: <Task pending coro= wait_for=()] created at /usr/local/lib/python3.7/asyncio/locks.py:290> created at /usr/local/lib/python3.7/site-packages/aioredis/sentinel/pool.py:107>\r\nTask was destroyed but it is pending!\r\nsource_traceback: Object created at (most recent call last):\r\n  File \"/home/app/manage.py\", line 11, in <module>\r\n    manage()\r\n  File \"/usr/local/lib/python3.7/site-packages/click/core.py\", line 1128, in __call__\r\n    return self.main(*args, **kwargs)\r\n  File \"/usr/local/lib/python3.7/site-packages/click/core.py\", line 1053, in main\r\n    rv = self.invoke(ctx)\r\n  File \"/usr/local/lib/python3.7/site-packages/click/core.py\", line 1659, in invoke\r\n    return _process_result(sub_ctx.command.invoke(sub_ctx))\r\n  File \"/usr/local/lib/python3.7/site-packages/click/core.py\", line 1395, in invoke\r\n    return ctx.invoke(self.callback, **ctx.params)\r\n  File \"/usr/local/lib/python3.7/site-packages/click/core.py\", line 754, in invoke\r\n    return __callback(*args, **kwargs)\r\n  File \"/home/app/fawo_bond/server.py\", line 99, in runserver\r\n    auto_reload=True\r\n  File \"/usr/local/lib/python3.7/site-packages/sanic/app.py\", line 1169, in run\r\n    serve_multiple(server_settings, workers)\r\n  File \"/usr/local/lib/python3.7/site-packages/sanic/server.py\", line 997, in serve_multiple\r\n    process.start()\r\n  File \"/usr/local/lib/python3.7/multiprocessing/process.py\", line 112, in start\r\n    self._popen = self._Popen(self)\r\n  File \"/usr/local/lib/python3.7/multiprocessing/context.py\", line 223, in _Popen\r\n    return _default_context.get_context().Process._Popen(process_obj)\r\n  File \"/usr/local/lib/python3.7/multiprocessing/context.py\", line 277, in _Popen\r\n    return Popen(process_obj)\r\n  File \"/usr/local/lib/python3.7/multiprocessing/popen_fork.py\", line 20, in __init__\r\n    self._launch(process_obj)\r\n  File \"/usr/local/lib/python3.7/multiprocessing/popen_fork.py\", line 74, in _launch\r\n    code = process_obj._bootstrap()\r\n  File \"/usr/local/lib/python3.7/multiprocessing/process.py\", line 297, in _bootstrap\r\n    self.run()\r\n  File \"/usr/local/lib/python3.7/multiprocessing/process.py\", line 99, in run\r\n    self._target(*self._args, **self._kwargs)\r\n  File \"/usr/local/lib/python3.7/site-packages/sanic/server.py\", line 920, in serve\r\n    loop.run_forever()\r\n  File \"/usr/local/lib/python3.7/site-packages/sanic/app.py\", line 976, in handle_request\r\n    response = await response\r\n  File \"/home/app/fawo_bond/base/auth_extensions.py\", line 56, in _deco\r\n    auth_header_key=auth_header_key)\r\n  File \"/home/app/fawo_bond/base/sanic_extensions.py\", line 90, in load_auth_user\r\n    user_data = await loader.load()\r\n  File \"/home/app/fawo_bond/base/auth_extensions.py\", line 169, in load\r\n    cache_data = await self.async_redis.get(key=cache_key)\r\n  File \"/home/app/fawo_bond/services/redis_service.py\", line 154, in get\r\n    await self.connection()\r\n  File \"/home/app/fawo_bond/services/redis_service.py\", line 88, in connection\r\n    loop=self.io_loop)\r\n  File \"/usr/local/lib/python3.7/site-packages/aioredis/sentinel/commands.py\", line 27, in create_sentinel\r\n    loop=loop)\r\n  File \"/usr/local/lib/python3.7/site-packages/aioredis/sentinel/pool.py\", line 45, in create_sentinel_pool\r\n    loop=loop)\r\n  File \"/usr/local/lib/python3.7/site-packages/aioredis/sentinel/pool.py\", line 107, in __init__\r\n    self._monitor_task = asyncio.ensure_future(echo_events())\r\ntask: <Task pending coro= wait_for=()] created at /usr/local/lib/python3.7/asyncio/locks.py:290> created at /usr/local/lib/python3.7/site-packages/aioredis/sentinel/pool.py:107>\n\n### Logs/tracebacks\n\n```python-traceback\nFile \"/usr/local/lib/python3.7/site-packages/click/core.py\", line 754, in invoke\r\n    return __callback(*args, **kwargs)\r\n  File \"/home/app/fawo_bond/server.py\", line 99, in runserver\r\n    auto_reload=True\r\n  File \"/usr/local/lib/python3.7/site-packages/sanic/app.py\", line 1169, in run\r\n    serve_multiple(server_settings, workers)\r\n  File \"/usr/local/lib/python3.7/site-packages/sanic/server.py\", line 997, in serve_multiple\r\n    process.start()\r\n  File \"/usr/local/lib/python3.7/multiprocessing/process.py\", line 112, in start\r\n    self._popen = self._Popen(self)\r\n  File \"/usr/local/lib/python3.7/multiprocessing/context.py\", line 223, in _Popen\r\n    return _default_context.get_context().Process._Popen(process_obj)\r\n  File \"/usr/local/lib/python3.7/multiprocessing/context.py\", line 277, in _Popen\r\n    return Popen(process_obj)\r\n  File \"/usr/local/lib/python3.7/multiprocessing/popen_fork.py\", line 20, in __init__\r\n    self._launch(process_obj)\r\n  File \"/usr/local/lib/python3.7/multiprocessing/popen_fork.py\", line 74, in _launch\r\n    code = process_obj._bootstrap()\r\n  File \"/usr/local/lib/python3.7/multiprocessing/process.py\", line 297, in _bootstrap\r\n    self.run()\r\n  File \"/usr/local/lib/python3.7/multiprocessing/process.py\", line 99, in run\r\n    self._target(*self._args, **self._kwargs)\r\n  File \"/usr/local/lib/python3.7/site-packages/sanic/server.py\", line 920, in serve\r\n    loop.run_forever()\r\n  File \"/usr/local/lib/python3.7/site-packages/sanic/app.py\", line 976, in handle_request\r\n    response = await response\r\n  File \"/home/app/fawo_bond/base/auth_extensions.py\", line 56, in _deco\r\n    auth_header_key=auth_header_key)\r\n  File \"/home/app/fawo_bond/base/sanic_extensions.py\", line 90, in load_auth_user\r\n    user_data = await loader.load()\r\n  File \"/home/app/fawo_bond/base/auth_extensions.py\", line 169, in load\r\n    cache_data = await self.async_redis.get(key=cache_key)\r\n  File \"/home/app/fawo_bond/services/redis_service.py\", line 154, in get\r\n    await self.connection()\r\n  File \"/home/app/fawo_bond/services/redis_service.py\", line 88, in connection\r\n    loop=self.io_loop)\r\n  File \"/usr/local/lib/python3.7/site-packages/aioredis/sentinel/commands.py\", line 27, in create_sentinel\r\n    loop=loop)\r\n  File \"/usr/local/lib/python3.7/site-packages/aioredis/sentinel/pool.py\", line 45, in create_sentinel_pool\r\n    loop=loop)\r\n  File \"/usr/local/lib/python3.7/site-packages/aioredis/sentinel/pool.py\", line 107, in __init__\r\n    self._monitor_task = asyncio.ensure_future(echo_events())\r\ntask: <Task pending coro= wait_for=()] created at /usr/local/lib/python3.7/asyncio/locks.py:290> created at /usr/local/lib/python3.7/site-packages/aioredis/sentinel/pool.py:107>\r\nTask was destroyed but it is pending!\r\nsource_traceback: Object created at (most recent call last):\r\n  File \"/home/app/manage.py\", line 11, in <module>\r\n    manage()\r\n  File \"/usr/local/lib/python3.7/site-packages/click/core.py\", line 1128, in __call__\r\n    return self.main(*args, **kwargs)\r\n  File \"/usr/local/lib/python3.7/site-packages/click/core.py\", line 1053, in main\r\n    rv = self.invoke(ctx)\r\n  File \"/usr/local/lib/python3.7/site-packages/click/core.py\", line 1659, in invoke\r\n    return _process_result(sub_ctx.command.invoke(sub_ctx))\r\n  File \"/usr/local/lib/python3.7/site-packages/click/core.py\", line 1395, in invoke\r\n    return ctx.invoke(self.callback, **ctx.params)\r\n  File \"/usr/local/lib/python3.7/site-packages/click/core.py\", line 754, in invoke\r\n    return __callback(*args, **kwargs)\r\n  File \"/home/app/fawo_bond/server.py\", line 99, in runserver\r\n    auto_reload=True\r\n  File \"/usr/local/lib/python3.7/site-packages/sanic/app.py\", line 1169, in run\r\n    serve_multiple(server_settings, workers)\r\n  File \"/usr/local/lib/python3.7/site-packages/sanic/server.py\", line 997, in serve_multiple\r\n    process.start()\r\n  File \"/usr/local/lib/python3.7/multiprocessing/process.py\", line 112, in start\r\n    self._popen = self._Popen(self)\r\n  File \"/usr/local/lib/python3.7/multiprocessing/context.py\", line 223, in _Popen\r\n    return _default_context.get_context().Process._Popen(process_obj)\r\n  File \"/usr/local/lib/python3.7/multiprocessing/context.py\", line 277, in _Popen\r\n    return Popen(process_obj)\r\n  File \"/usr/local/lib/python3.7/multiprocessing/popen_fork.py\", line 20, in __init__\r\n    self._launch(process_obj)\r\n  File \"/usr/local/lib/python3.7/multiprocessing/popen_fork.py\", line 74, in _launch\r\n    code = process_obj._bootstrap()\r\n  File \"/usr/local/lib/python3.7/multiprocessing/process.py\", line 297, in _bootstrap\r\n    self.run()\r\n  File \"/usr/local/lib/python3.7/multiprocessing/process.py\", line 99, in run\r\n    self._target(*self._args, **self._kwargs)\r\n  File \"/usr/local/lib/python3.7/site-packages/sanic/server.py\", line 920, in serve\r\n    loop.run_forever()\r\n  File \"/usr/local/lib/python3.7/site-packages/sanic/app.py\", line 976, in handle_request\r\n    response = await response\r\n  File \"/home/app/fawo_bond/base/auth_extensions.py\", line 56, in _deco\r\n    auth_header_key=auth_header_key)\r\n  File \"/home/app/fawo_bond/base/sanic_extensions.py\", line 90, in load_auth_user\r\n    user_data = await loader.load()\r\n  File \"/home/app/fawo_bond/base/auth_extensions.py\", line 169, in load\r\n    cache_data = await self.async_redis.get(key=cache_key)\r\n  File \"/home/app/fawo_bond/services/redis_service.py\", line 154, in get\r\n    await self.connection()\r\n  File \"/home/app/fawo_bond/services/redis_service.py\", line 88, in connection\r\n    loop=self.io_loop)\r\n  File \"/usr/local/lib/python3.7/site-packages/aioredis/sentinel/commands.py\", line 27, in create_sentinel\r\n    loop=loop)\r\n  File \"/usr/local/lib/python3.7/site-packages/aioredis/sentinel/pool.py\", line 45, in create_sentinel_pool\r\n    loop=loop)\r\n  File \"/usr/local/lib/python3.7/site-packages/aioredis/sentinel/pool.py\", line 107, in __init__\r\n    self._monitor_task = asyncio.ensure_future(echo_events())\r\ntask: <Task pending coro= wait_for=()] created at /usr/local/lib/python3.7/asyncio/locks.py:290> created at /usr/local/lib/python3.7/site-packages/aioredis/sentinel/pool.py:107>\n```\n\n\n### Python Version\n\n```console\npython==3.7.3\n```\n\n\n### aiohttp Version\n\n```console\naiohttp==3.6.2\n```\n\n\n### multidict Version\n\n```console\naiofiles==0.8.0\r\naiohttp==3.6.2\r\naioredis==1.3.1\r\nasync-timeout==3.0.1\r\nattrs==22.1.0\r\ncertifi==2022.9.24\r\nchardet==3.0.4\r\nclick==8.0.3\r\ndnspython==2.2.1\r\nh11==0.8.1\r\nh2==3.2.0\r\nhiredis==2.0.0\r\nhpack==3.0.0\r\nhstspreload==2022.11.1\r\nhttptools==0.5.0\r\nhttpx==0.9.3\r\nhyperframe==5.2.0\r\nidna==2.10\r\nimportlib-metadata==4.8.3\r\nmongoengine==0.24.2\r\nmultidict==4.7.6\r\npymongo==3.7.1\r\npython-box==6.0.0\r\npython-dateutil==2.8.2\r\nPyYAML==6.0\r\nrfc3986==1.5.0\r\nsanic==19.12.2\r\nsetuptools==59.6.0\r\nsix==1.14.0\r\nsniffio==1.2.0\r\ntyping_extensions==4.1.0\r\nujson==4.3.0\r\nuvloop==0.12.0\r\nwebsockets==8.1\r\nwheel==0.37.0\r\nyarl==1.7.0\r\nzipp==3.6.0\n```\n\n\n### yarl Version\n\n```console\naiofiles==0.8.0\r\naiohttp==3.6.2\r\naioredis==1.3.1\r\nasync-timeout==3.0.1\r\nattrs==22.1.0\r\ncertifi==2022.9.24\r\nchardet==3.0.4\r\nclick==8.0.3\r\ndnspython==2.2.1\r\nh11==0.8.1\r\nh2==3.2.0\r\nhiredis==2.0.0\r\nhpack==3.0.0\r\nhstspreload==2022.11.1\r\nhttptools==0.5.0\r\nhttpx==0.9.3\r\nhyperframe==5.2.0\r\nidna==2.10\r\nimportlib-metadata==4.8.3\r\nmongoengine==0.24.2\r\nmultidict==4.7.6\r\npymongo==3.7.1\r\npython-box==6.0.0\r\npython-dateutil==2.8.2\r\nPyYAML==6.0\r\nrfc3986==1.5.0\r\nsanic==19.12.2\r\nsetuptools==59.6.0\r\nsix==1.14.0\r\nsniffio==1.2.0\r\ntyping_extensions==4.1.0\r\nujson==4.3.0\r\nuvloop==0.12.0\r\nwebsockets==8.1\r\nwheel==0.37.0\r\nyarl==1.7.0\r\nzipp==3.6.0\n```\n\n\n### OS\n\nLinux version 3.10.0-1127.19.1.el7.x86_64 (mockbuild@kbuilder.bsys.centos.org) (gcc version 4.8.5 20150623 (Red Hat 4.8.5-39) (GCC) ) #1 SMP Tue Aug 25 17:23:54 UTC 2020\n\n### Related component\n\nServer\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7145/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7145/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7137", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7137/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7137/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7137/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7137", "id": 1505208497, "node_id": "I_kwDOAMpNN85Zt6ix", "number": 7137, "title": "Can't send request with proxy.", "user": {"login": "justNice", "id": 53212206, "node_id": "MDQ6VXNlcjUzMjEyMjA2", "avatar_url": "https://avatars.githubusercontent.com/u/53212206?v=4", "gravatar_id": "", "url": "https://api.github.com/users/justNice", "html_url": "https://github.com/justNice", "followers_url": "https://api.github.com/users/justNice/followers", "following_url": "https://api.github.com/users/justNice/following{/other_user}", "gists_url": "https://api.github.com/users/justNice/gists{/gist_id}", "starred_url": "https://api.github.com/users/justNice/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/justNice/subscriptions", "organizations_url": "https://api.github.com/users/justNice/orgs", "repos_url": "https://api.github.com/users/justNice/repos", "events_url": "https://api.github.com/users/justNice/events{/privacy}", "received_events_url": "https://api.github.com/users/justNice/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-12-20T20:22:10Z", "updated_at": "2022-12-21T18:50:53Z", "closed_at": "2022-12-21T18:50:49Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nI get this error `aiohttp.client_exceptions.ClientProxyConnectionError: Cannot connect to host xx.xx.xxx.xxx:xxxx ssl:default [None]`\r\nwhen trying to send again response with proxy.\r\n\r\nI use 3.8.3 aiohttp and python 3.11\r\n\r\nI have https private proxy.\r\n\n\n### To Reproduce\n\nI make request from the first proxy, then i switch to the second one and then i switch to the first one. The last request(which was tried with the first proxy) dont work and i get this error.\n\n### Expected behavior\n\nI expect to make a successful request.\n\n### Logs/tracebacks\n\n```python-traceback\nI dont have, if it is really needed i can reproduce by myself.\n```\n\n\n### Python Version\n\n```console\nPython 3.11.0\n```\n\n\n### aiohttp Version\n\n```console\nName: aiohttp\r\nVersion: 3.8.3\n```\n\n\n### multidict Version\n\n```console\nName: multidict\r\nVersion: 6.0.2\n```\n\n\n### yarl Version\n\n```console\nName: yarl\r\nVersion: 1.8.1\n```\n\n\n### OS\n\nWindows 10\n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [ ] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7137/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7137/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7136", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7136/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7136/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7136/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7136", "id": 1504070255, "node_id": "I_kwDOAMpNN85Zpkpv", "number": 7136, "title": "can  not conect to some page youtube", "user": {"login": "thedtvn", "id": 80153297, "node_id": "MDQ6VXNlcjgwMTUzMjk3", "avatar_url": "https://avatars.githubusercontent.com/u/80153297?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thedtvn", "html_url": "https://github.com/thedtvn", "followers_url": "https://api.github.com/users/thedtvn/followers", "following_url": "https://api.github.com/users/thedtvn/following{/other_user}", "gists_url": "https://api.github.com/users/thedtvn/gists{/gist_id}", "starred_url": "https://api.github.com/users/thedtvn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thedtvn/subscriptions", "organizations_url": "https://api.github.com/users/thedtvn/orgs", "repos_url": "https://api.github.com/users/thedtvn/repos", "events_url": "https://api.github.com/users/thedtvn/events{/privacy}", "received_events_url": "https://api.github.com/users/thedtvn/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-12-20T06:50:59Z", "updated_at": "2022-12-20T12:01:13Z", "closed_at": "2022-12-20T12:01:13Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nget timeout on connecting  but can get page if use curl or node js \r\n\n\n### To Reproduce\n\ninstall affter reinstall os \r\nthen got that\r\n`pip install aiohttp`\n\n### Expected behavior\n\ncan req\n\n### Logs/tracebacks\n\n```python-traceback\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/usr/lib/python3.8/asyncio/runners.py\", line 44, in run\r\n    return loop.run_until_complete(main)\r\n  File \"/usr/lib/python3.8/asyncio/base_events.py\", line 616, in run_until_complete\r\n    return future.result()\r\n  File \"<stdin>\", line 3, in main\r\n  File \"/home/pi/.local/lib/python3.8/site-packages/aiohttp/client.py\", line 1141, in __aenter__\r\n    self._resp = await self._coro\r\n  File \"/home/pi/.local/lib/python3.8/site-packages/aiohttp/client.py\", line 637, in _request\r\n    break\r\n  File \"/home/pi/.local/lib/python3.8/site-packages/aiohttp/helpers.py\", line 720, in __exit__\r\n    raise asyncio.TimeoutError from None\r\nasyncio.exceptions.TimeoutError\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\nPython 3.8.10\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.8.3\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: None\r\nAuthor-email: None\r\nLicense: Apache 2\r\nLocation: /home/pi/.local/lib/python3.8/site-packages\r\nRequires: yarl, attrs, async-timeout, frozenlist, aiosignal, charset-normalizer, multidict\r\nRequired-by: zingmp3py, statcord.py, soundcloud-lib, discord.py, chiasenhac.py\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 6.0.3\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/pi/.local/lib/python3.8/site-packages\r\nRequires:\r\nRequired-by: yarl, aiohttp\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.8.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/pi/.local/lib/python3.8/site-packages\r\nRequires: multidict, idna\r\nRequired-by: aiohttp\n```\n\n\n### OS\n\nubtuntu server 20.04.5 LTS (GNU/Linux 5.4.0-1077-raspi aarch64) for raspberry pi\n\n### Related component\n\nClient\n\n### Additional context\n\n![image](https://user-images.githubusercontent.com/80153297/208601623-169daa7c-8be6-4bfd-909c-8c604f827317.png)\r\naiohttp test code \r\n![image](https://user-images.githubusercontent.com/80153297/208601803-0ed77b71-ecf8-4e59-9588-603b65b90207.png)\r\n\r\n\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7136/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7136/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7116", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7116/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7116/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7116/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7116", "id": 1472738306, "node_id": "I_kwDOAMpNN85XyDQC", "number": 7116, "title": "Server examples are failing with AttributeError: module 'aiohttp' has no attribute 'web'", "user": {"login": "rutgerhendriks", "id": 3134550, "node_id": "MDQ6VXNlcjMxMzQ1NTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3134550?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rutgerhendriks", "html_url": "https://github.com/rutgerhendriks", "followers_url": "https://api.github.com/users/rutgerhendriks/followers", "following_url": "https://api.github.com/users/rutgerhendriks/following{/other_user}", "gists_url": "https://api.github.com/users/rutgerhendriks/gists{/gist_id}", "starred_url": "https://api.github.com/users/rutgerhendriks/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rutgerhendriks/subscriptions", "organizations_url": "https://api.github.com/users/rutgerhendriks/orgs", "repos_url": "https://api.github.com/users/rutgerhendriks/repos", "events_url": "https://api.github.com/users/rutgerhendriks/events{/privacy}", "received_events_url": "https://api.github.com/users/rutgerhendriks/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-12-02T11:45:20Z", "updated_at": "2022-12-02T17:46:51Z", "closed_at": "2022-12-02T17:46:51Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nI tried to follow the server examples in:\r\nhttps://docs.aiohttp.org/en/stable/web_quickstart.html\r\nbut there is no 'web' attribute on aiohttp\r\nIn __init__.py there is no mention of importing web, so that seems to be the issue to me\n\n### To Reproduce\n\n1. import aiohttp (v3.8.3)\r\n2. aiohttp.web gives attributeerror\n\n### Expected behavior\n\naiohttp.web exist\r\n\r\nManually editing __init__.py and adding:\r\nfrom . import web as web\r\nseems to solve my issue\n\n### Logs/tracebacks\n\n```python-traceback\n~$ python3\r\nPython 3.10.6 (main, Nov  2 2022, 18:53:38) [GCC 11.3.0] on linux\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import aiohttp\r\n>>> aiohttp.web\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\nAttributeError: module 'aiohttp' has no attribute 'web'\r\n>>>\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\n3.10.6\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\n3.8.3\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\n6.0.2\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\n1.7.2\n```\n\n\n### OS\n\nUbuntu 22.04\n\n### Related component\n\nServer\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7116/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7116/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7088", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7088/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7088/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7088/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7088", "id": 1453567636, "node_id": "I_kwDOAMpNN85Wo66U", "number": 7088, "title": "Request doesn't accept files parameter", "user": {"login": "Noman-Tanveer", "id": 46514771, "node_id": "MDQ6VXNlcjQ2NTE0Nzcx", "avatar_url": "https://avatars.githubusercontent.com/u/46514771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Noman-Tanveer", "html_url": "https://github.com/Noman-Tanveer", "followers_url": "https://api.github.com/users/Noman-Tanveer/followers", "following_url": "https://api.github.com/users/Noman-Tanveer/following{/other_user}", "gists_url": "https://api.github.com/users/Noman-Tanveer/gists{/gist_id}", "starred_url": "https://api.github.com/users/Noman-Tanveer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Noman-Tanveer/subscriptions", "organizations_url": "https://api.github.com/users/Noman-Tanveer/orgs", "repos_url": "https://api.github.com/users/Noman-Tanveer/repos", "events_url": "https://api.github.com/users/Noman-Tanveer/events{/privacy}", "received_events_url": "https://api.github.com/users/Noman-Tanveer/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-11-17T15:44:37Z", "updated_at": "2022-11-30T17:02:07Z", "closed_at": "2022-11-17T16:50:18Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nRequest doesn't accept files parameter\n\n### To Reproduce\n\nasync with retry_client.post(url, files=files, headers=headers, timeout=500) as resp:\n\n### Expected behavior\n\nShould return response\n\n### Logs/tracebacks\n\n```python-traceback\nasync with retry_client.post(url, files=files, headers=headers, timeout=500) as resp:\r\n  File \"/home/niche-4/anaconda3/envs/serv/lib/python3.8/site-packages/aiohttp_retry/client.py\", line 149, in __aenter__\r\n    return await self._do_request()\r\n  File \"/home/niche-4/anaconda3/envs/serv/lib/python3.8/site-packages/aiohttp_retry/client.py\", line 138, in _do_request\r\n    raise e\r\n  File \"/home/niche-4/anaconda3/envs/serv/lib/python3.8/site-packages/aiohttp_retry/client.py\", line 100, in _do_request\r\n    response: ClientResponse = await self._request_func(\r\n  File \"/home/niche-4/anaconda3/envs/serv/lib/python3.8/site-packages/aiohttp/client.py\", line 354, in request\r\n    return _RequestContextManager(self._request(method, url, **kwargs))\r\nTypeError: _request() got an unexpected keyword argument 'files'\r\n```\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\n3.8.13\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.8.3\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: \r\nAuthor-email: \r\nLicense: Apache 2\r\nLocation: /home/niche-4/anaconda3/envs/serv/lib/python3.8/site-packages\r\nRequires: aiosignal, async-timeout, attrs, charset-normalizer, frozenlist, multidict, yarl\r\nRequired-by: aiohttp-cors, aiohttp-retry, faust-streaming, ray\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 6.0.2\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/niche-4/anaconda3/envs/serv/lib/python3.8/site-packages\r\nRequires: \r\nRequired-by: aiohttp, yarl\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.8.1\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/niche-4/anaconda3/envs/serv/lib/python3.8/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp, faust-streaming\n```\n\n\n### OS\n\nUbuntu 20.04\n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7088/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7088/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7073", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7073/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7073/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7073/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7073", "id": 1442390803, "node_id": "I_kwDOAMpNN85V-SMT", "number": 7073, "title": "aiohttp-3.8.3 fails to compile on Gentoo Linux because Makefile shell is not bash", "user": {"login": "cengique", "id": 1424675, "node_id": "MDQ6VXNlcjE0MjQ2NzU=", "avatar_url": "https://avatars.githubusercontent.com/u/1424675?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cengique", "html_url": "https://github.com/cengique", "followers_url": "https://api.github.com/users/cengique/followers", "following_url": "https://api.github.com/users/cengique/following{/other_user}", "gists_url": "https://api.github.com/users/cengique/gists{/gist_id}", "starred_url": "https://api.github.com/users/cengique/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cengique/subscriptions", "organizations_url": "https://api.github.com/users/cengique/orgs", "repos_url": "https://api.github.com/users/cengique/repos", "events_url": "https://api.github.com/users/cengique/events{/privacy}", "received_events_url": "https://api.github.com/users/cengique/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2022-11-09T16:25:46Z", "updated_at": "2022-11-10T19:01:41Z", "closed_at": "2022-11-10T19:01:41Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nCompilation failure on Gentoo Linux (and potentially other systems, see below for logs and explanation)\n\n### To Reproduce\n\nBuild error\n\n### Expected behavior\n\nCompile without errors\n\n### Logs/tracebacks\n\n```python-traceback\nBuild fails because of the following error:\r\n\r\n\r\n>>> Emerging (1 of 3) dev-python/aiohttp-3.8.3-r1::gentoo\r\n * Fetching files in the background.\r\n * To view fetch progress, run in another terminal:\r\n * tail -f /var/log/emerge-fetch.log\r\n * aiohttp-3.8.3.tar.gz BLAKE2B SHA512 size ;-) ...                                                                                                                                                [ ok ]\r\n>>> Unpacking source...\r\n>>> Unpacking aiohttp-3.8.3.tar.gz to /var/tmp/portage/dev-python/aiohttp-3.8.3-r1/work\r\n>>> Source unpacked in /var/tmp/portage/dev-python/aiohttp-3.8.3-r1/work\r\n>>> Preparing source in /var/tmp/portage/dev-python/aiohttp-3.8.3-r1/work/aiohttp-3.8.3 ...\r\n * Build system packages:\r\n *   dev-python/gpep517            : 9\r\n *   dev-python/installer          : 0.5.1-r1\r\n *   dev-python/setuptools         : 65.5.1\r\n *   dev-python/setuptools_scm     : 7.0.5\r\n *   dev-python/wheel              : 0.37.1-r1\r\n>>> Source prepared.\r\n>>> Configuring source in /var/tmp/portage/dev-python/aiohttp-3.8.3-r1/work/aiohttp-3.8.3 ...\r\n * Checking whether python3_11 is suitable ...\r\n *   >=dev-lang/python-3.11.0_beta4:3.11 ...                                                                                                                                                       [ !! ]\r\n * Checking whether python3_10 is suitable ...\r\n *   >=dev-lang/python-3.10.4:3.10 ...                                                                                                                                                             [ ok ]\r\n *   python_check_deps ...                                                                                                                                                                         [ ok ]\r\n * Using python3.10 in global scope\r\n * python3_10: running distutils-r1_run_phase python_configure_all\r\nmake -j9 requirements/.hash/cython.txt.hash \r\nmake: command: Command not found\r\n/bin/sh: line 1: ./tools/check_sum.py: No such file or directory\r\n```\r\n\r\nIn the PyPI.org distro tar.gz file, there is no `tools/check_sum.py` included, so the `ifneq` statement on `Makefile:28` will fail on some systems. \r\n\r\nOn my system, I actually have `sha256sum` installed, but the if statement fails by not finding `command`, which is a Bash builtin command. This is because the default shell in the Makefile is not specified as Bash. It can be fixed by adding:\r\n\r\n```\r\nSHELL:=/bin/bash\r\n```\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\npython-3.10.4:3.10 .\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\naiohttp-3.8.3\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\nVersion: 6.0.2\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nVersion: 1.8.1\n```\n\n\n### OS\n\nDescription:    Gentoo Linux\r\nRelease:        2.8\r\n\n\n### Related component\n\nServer, Client\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7073/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7073/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7070", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7070/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7070/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7070/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7070", "id": 1438887357, "node_id": "I_kwDOAMpNN85Vw629", "number": 7070, "title": "Backslashes stripped from multipart form filenames", "user": {"login": "barneygale", "id": 960340, "node_id": "MDQ6VXNlcjk2MDM0MA==", "avatar_url": "https://avatars.githubusercontent.com/u/960340?v=4", "gravatar_id": "", "url": "https://api.github.com/users/barneygale", "html_url": "https://github.com/barneygale", "followers_url": "https://api.github.com/users/barneygale/followers", "following_url": "https://api.github.com/users/barneygale/following{/other_user}", "gists_url": "https://api.github.com/users/barneygale/gists{/gist_id}", "starred_url": "https://api.github.com/users/barneygale/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/barneygale/subscriptions", "organizations_url": "https://api.github.com/users/barneygale/orgs", "repos_url": "https://api.github.com/users/barneygale/repos", "events_url": "https://api.github.com/users/barneygale/events{/privacy}", "received_events_url": "https://api.github.com/users/barneygale/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2022-11-07T19:51:55Z", "updated_at": "2023-04-23T13:05:18Z", "closed_at": "2023-04-23T13:05:18Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nI'm dealing with a slightly wonky HTTP client that sends _full file paths_ in the 'filename' field of a form data part. Like:\r\n\r\n```\r\nPOST /test.html HTTP/1.1\r\nHost: example.org\r\nContent-Type: multipart/form-data;boundary=\"boundary\"\r\n\r\n--boundary\r\nContent-Disposition: form-data; name=\"uploadfile\"; filename=\"C:\\Users\\me\\example.txt\"\r\n\r\nvalue2\r\n--boundary--\r\n```\r\n\r\nHowever, when I read the request with `await request.post()`, I find that the filename has been mangled to `C:Usersmeexample.txt`, i.e. the backslashes have been removed.\r\n\r\n[The standards don't agree](https://github.com/curl/curl/issues/7789#issuecomment-930138204) on how backslashes should be supplied, but the [WHATWG spec](https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#multipart-form-data) seemed to be followed by the CURL folks, and it *doesn't* suggest that backslashes need to be doubled, nor escape-encoded. Therefore I think this is a bug in aiohttp.\n\n### To Reproduce\n\n1. Implement an HTTP client that sends a full Windows-style file path as the filename in a multipart form data request\r\n2. Call `data = await request.post()` and print `data['uploadfield'].filename`\n\n### Expected behavior\n\nThe original filename is reproduced\n\n### Logs/tracebacks\n\n```python-traceback\nActual behaviour: the backslashes are stripped.\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\nPython 3.10.4\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.8.1\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: \r\nAuthor-email: \r\nLicense: Apache 2\r\nRequires: aiosignal, async-timeout, attrs, charset-normalizer, frozenlist, multidict, yarl\r\nRequired-by: aiobotocore\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 6.0.2\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nRequires: \r\nRequired-by: aiohttp, yarl\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.8.1\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\n```\n\n\n### OS\n\nmacOS 12; CentOS 7\n\n### Related component\n\nServer\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7070/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7070/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7065", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7065/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7065/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7065/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7065", "id": 1433347232, "node_id": "I_kwDOAMpNN85VbySg", "number": 7065, "title": "AttributeError: '<class 'pydap.model.DatasetType'>' object has no attribute 'decode'", "user": {"login": "faridfarhat", "id": 93440204, "node_id": "U_kgDOBZHIzA", "avatar_url": "https://avatars.githubusercontent.com/u/93440204?v=4", "gravatar_id": "", "url": "https://api.github.com/users/faridfarhat", "html_url": "https://github.com/faridfarhat", "followers_url": "https://api.github.com/users/faridfarhat/followers", "following_url": "https://api.github.com/users/faridfarhat/following{/other_user}", "gists_url": "https://api.github.com/users/faridfarhat/gists{/gist_id}", "starred_url": "https://api.github.com/users/faridfarhat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/faridfarhat/subscriptions", "organizations_url": "https://api.github.com/users/faridfarhat/orgs", "repos_url": "https://api.github.com/users/faridfarhat/repos", "events_url": "https://api.github.com/users/faridfarhat/events{/privacy}", "received_events_url": "https://api.github.com/users/faridfarhat/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-11-02T15:24:04Z", "updated_at": "2022-11-02T17:46:08Z", "closed_at": "2022-11-02T17:46:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nI want to access GPM precipitation from NASA. But when I open the data with xarray, it returns this attribute error. I also updated xarray to the latest version, as was suggested in previous issues. Still it is not working. \r\n\r\n### To Reproduce\r\n\r\ndataset\r\n\r\n### Expected behavior\r\n\r\nxarray dataset\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nimport xarray as xr\r\nfrom pydap.client import open_url\r\nfrom pydap.cas.urs import setup_session\r\n\r\nurl='https://gpm1.gesdisc.eosdis.nasa.gov/opendap/GPM_L3/GPM_3IMERGDE.06/2000/06/3B-DAY-E.MS.MRG.3IMERG.20000601-S000000-E235959.V06.nc4'\r\n\r\nsession = setup_session('myusername, 'mypassword')\r\ndataset = open_url(url, session=session)\r\n\r\nxr.open_dataset(dataset,engine='pydap')\r\n\r\nAttributeError: '<class 'pydap.model.DatasetType'>' object has no attribute 'decode'\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n$ python --version\r\n3.10\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n$ python -m pip show aiohttp\r\nNA\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n$ python -m pip show multidict\r\nNA\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n$ python -m pip show yarl\r\nNA\r\n```\r\n\r\n\r\n### OS\r\n\r\nmacOS\r\n\r\n### Related component\r\n\r\nServer, Client\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7065/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7065/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7051", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7051/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7051/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7051/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7051", "id": 1424975161, "node_id": "I_kwDOAMpNN85U72U5", "number": 7051, "title": "pip install fails for python 3.11", "user": {"login": "ramezanifar", "id": 11685859, "node_id": "MDQ6VXNlcjExNjg1ODU5", "avatar_url": "https://avatars.githubusercontent.com/u/11685859?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ramezanifar", "html_url": "https://github.com/ramezanifar", "followers_url": "https://api.github.com/users/ramezanifar/followers", "following_url": "https://api.github.com/users/ramezanifar/following{/other_user}", "gists_url": "https://api.github.com/users/ramezanifar/gists{/gist_id}", "starred_url": "https://api.github.com/users/ramezanifar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ramezanifar/subscriptions", "organizations_url": "https://api.github.com/users/ramezanifar/orgs", "repos_url": "https://api.github.com/users/ramezanifar/repos", "events_url": "https://api.github.com/users/ramezanifar/events{/privacy}", "received_events_url": "https://api.github.com/users/ramezanifar/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2022-10-27T03:30:39Z", "updated_at": "2023-01-27T16:49:23Z", "closed_at": "2022-12-16T23:15:27Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nPython 3.11 is just out. I installed it and made a fresh virtual environment and first thing first tried to install aiohttp with:\r\n`pip install aiohttp`\r\nit failed. \r\nI also have python 3.10.8 and it was installed with no problem.\r\nLog is pasted in the **Logs/tracebacks** section below.\r\n\r\n\n\n### To Reproduce\n\ninstall python 3.11\r\nmake a virtual environment and activate(optional)\r\npip install aiohttp\r\n\n\n### Expected behavior\n\nTo be installed successfully \n\n### Logs/tracebacks\n\n```python-traceback\nCollecting aiohttp\r\n  Using cached aiohttp-3.8.3-cp311-cp311-win_amd64.whl (317 kB)\r\nCollecting attrs>=17.3.0\r\n  Using cached attrs-22.1.0-py2.py3-none-any.whl (58 kB)\r\nCollecting charset-normalizer<3.0,>=2.0\r\n  Using cached charset_normalizer-2.1.1-py3-none-any.whl (39 kB)\r\nCollecting multidict<7.0,>=4.5\r\n  Using cached multidict-6.0.2.tar.gz (50 kB)\r\n  Installing build dependencies ... done\r\n  Getting requirements to build wheel ... done\r\n  Preparing metadata (pyproject.toml) ... done\r\nCollecting async-timeout<5.0,>=4.0.0a3\r\n  Using cached async_timeout-4.0.2-py3-none-any.whl (5.8 kB)\r\nCollecting yarl<2.0,>=1.0\r\n  Using cached yarl-1.8.1.tar.gz (172 kB)\r\n  Installing build dependencies ... done\r\n  Getting requirements to build wheel ... done\r\n  Preparing metadata (pyproject.toml) ... done\r\nCollecting frozenlist>=1.1.1\r\n  Using cached frozenlist-1.3.1.tar.gz (66 kB)\r\n  Installing build dependencies ... done\r\n  Getting requirements to build wheel ... done\r\n  Preparing metadata (pyproject.toml) ... done\r\nCollecting aiosignal>=1.1.2\r\n  Using cached aiosignal-1.2.0-py3-none-any.whl (8.2 kB)\r\nCollecting idna>=2.0\r\n  Using cached idna-3.4-py3-none-any.whl (61 kB)\r\nBuilding wheels for collected packages: frozenlist, multidict, yarl\r\n  Building wheel for frozenlist (pyproject.toml) ... error\r\n  error: subprocess-exited-with-error\r\n\r\n  \u00d7 Building wheel for frozenlist (pyproject.toml) did not run successfully.\r\n  \u2502 exit code: 1\r\n  \u2570\u2500> [33 lines of output]\r\n      *********************\r\n      * Accelerated build *\r\n      *********************\r\n      running bdist_wheel\r\n      running build\r\n      running build_py\r\n      creating build\r\n      creating build\\lib.win-amd64-cpython-311\r\n      creating build\\lib.win-amd64-cpython-311\\frozenlist\r\n      copying frozenlist\\__init__.py -> build\\lib.win-amd64-cpython-311\\frozenlist\r\n      running egg_info\r\n      writing frozenlist.egg-info\\PKG-INFO\r\n      writing dependency_links to frozenlist.egg-info\\dependency_links.txt\r\n      writing top-level names to frozenlist.egg-info\\top_level.txt\r\n      reading manifest file 'frozenlist.egg-info\\SOURCES.txt'\r\n      reading manifest template 'MANIFEST.in'\r\n      warning: no previously-included files matching '*.pyc' found anywhere in distribution\r\n      warning: no previously-included files matching '*.pyd' found anywhere in distribution\r\n      warning: no previously-included files matching '*.so' found anywhere in distribution\r\n      warning: no previously-included files matching '*.lib' found anywhere in distribution\r\n      warning: no previously-included files matching '*.dll' found anywhere in distribution\r\n      warning: no previously-included files matching '*.a' found anywhere in distribution\r\n      warning: no previously-included files matching '*.obj' found anywhere in distribution\r\n      warning: no previously-included files found matching 'frozenlist\\*.html'\r\n      no previously-included directories found matching 'docs\\_build'\r\n      adding license file 'LICENSE'\r\n      writing manifest file 'frozenlist.egg-info\\SOURCES.txt'\r\n      copying frozenlist\\__init__.pyi -> build\\lib.win-amd64-cpython-311\\frozenlist\r\n      copying frozenlist\\_frozenlist.pyx -> build\\lib.win-amd64-cpython-311\\frozenlist\r\n      copying frozenlist\\py.typed -> build\\lib.win-amd64-cpython-311\\frozenlist\r\n      running build_ext\r\n      building 'frozenlist._frozenlist' extension\r\n      error: Microsoft Visual C++ 14.0 or greater is required. Get it with \"Microsoft C++ Build Tools\": https://visualstudio.microsoft.com/visual-cpp-build-tools/\r\n      [end of output]\r\n\r\n  note: This error originates from a subprocess, and is likely not a problem with pip.\r\n  ERROR: Failed building wheel for frozenlist\r\n  Building wheel for multidict (pyproject.toml) ... error\r\n  error: subprocess-exited-with-error\r\n\r\n  \u00d7 Building wheel for multidict (pyproject.toml) did not run successfully.\r\n  \u2502 exit code: 1\r\n  \u2570\u2500> [59 lines of output]\r\n      *********************\r\n      * Accelerated build *\r\n      *********************\r\n      running bdist_wheel\r\n      running build\r\n      running build_py\r\n      creating build\r\n      creating build\\lib.win-amd64-cpython-311\r\n      creating build\\lib.win-amd64-cpython-311\\multidict\r\n      copying multidict\\_abc.py -> build\\lib.win-amd64-cpython-311\\multidict\r\n      copying multidict\\_compat.py -> build\\lib.win-amd64-cpython-311\\multidict\r\n      copying multidict\\_multidict_base.py -> build\\lib.win-amd64-cpython-311\\multidict\r\n      copying multidict\\_multidict_py.py -> build\\lib.win-amd64-cpython-311\\multidict\r\n      copying multidict\\__init__.py -> build\\lib.win-amd64-cpython-311\\multidict\r\n      running egg_info\r\n      writing multidict.egg-info\\PKG-INFO\r\n      writing dependency_links to multidict.egg-info\\dependency_links.txt\r\n      writing top-level names to multidict.egg-info\\top_level.txt\r\n      reading manifest file 'multidict.egg-info\\SOURCES.txt'\r\n      reading manifest template 'MANIFEST.in'\r\n      warning: no previously-included files matching '*.pyc' found anywhere in distribution\r\n      warning: no previously-included files found matching 'multidict\\_multidict.html'\r\n      warning: no previously-included files found matching 'multidict\\*.so'\r\n      warning: no previously-included files found matching 'multidict\\*.pyd'\r\n      warning: no previously-included files found matching 'multidict\\*.pyd'\r\n      no previously-included directories found matching 'docs\\_build'\r\n      adding license file 'LICENSE'\r\n      writing manifest file 'multidict.egg-info\\SOURCES.txt'\r\n      C:\\Users\\amin.ramezanifar\\AppData\\Local\\Temp\\pip-build-env-8ge7rajw\\overlay\\Lib\\site-packages\\setuptools\\command\\build_py.py:202: SetuptoolsDeprecationWarning:     Installing 'multidict._multilib' as data is deprecated, please list it in `packages`.\r\n          !!\r\n\r\n\r\n          ############################\r\n          # Package would be ignored #\r\n          ############################\r\n          Python recognizes 'multidict._multilib' as an importable package,\r\n          but it is not listed in the `packages` configuration of setuptools.\r\n\r\n          'multidict._multilib' has been automatically added to the distribution only\r\n          because it may contain data files, but this behavior is likely to change\r\n          in future versions of setuptools (and therefore is considered deprecated).\r\n\r\n          Please make sure that 'multidict._multilib' is included as a package by using\r\n          the `packages` configuration field or the proper discovery methods\r\n          (for example by using `find_namespace_packages(...)`/`find_namespace:`\r\n          instead of `find_packages(...)`/`find:`).\r\n\r\n          You can read more about \"package discovery\" and \"data files\" on setuptools\r\n          documentation page.\r\n\r\n\r\n      !!\r\n\r\n        check.warn(importable)\r\n      copying multidict\\__init__.pyi -> build\\lib.win-amd64-cpython-311\\multidict\r\n      copying multidict\\py.typed -> build\\lib.win-amd64-cpython-311\\multidict\r\n      running build_ext\r\n      building 'multidict._multidict' extension\r\n      error: Microsoft Visual C++ 14.0 or greater is required. Get it with \"Microsoft C++ Build Tools\": https://visualstudio.microsoft.com/visual-cpp-build-tools/\r\n      [end of output]\r\n\r\n  note: This error originates from a subprocess, and is likely not a problem with pip.\r\n  ERROR: Failed building wheel for multidict\r\n  Building wheel for yarl (pyproject.toml) ... error\r\n  error: subprocess-exited-with-error\r\n\r\n  \u00d7 Building wheel for yarl (pyproject.toml) did not run successfully.\r\n  \u2502 exit code: 1\r\n  \u2570\u2500> [37 lines of output]\r\n      C:\\Users\\amin.ramezanifar\\AppData\\Local\\Temp\\pip-build-env-3fbg9xvq\\overlay\\Lib\\site-packages\\setuptools\\config\\setupcfg.py:508: SetuptoolsDeprecationWarning: The license_file parameter is deprecated, use license_files instead.\r\n        warnings.warn(msg, warning_class)\r\n      **********************\r\n      * Accelerated build *\r\n      **********************\r\n      running bdist_wheel\r\n      running build\r\n      running build_py\r\n      creating build\r\n      creating build\\lib.win-amd64-cpython-311\r\n      creating build\\lib.win-amd64-cpython-311\\yarl\r\n      copying yarl\\_quoting.py -> build\\lib.win-amd64-cpython-311\\yarl\r\n      copying yarl\\_quoting_py.py -> build\\lib.win-amd64-cpython-311\\yarl\r\n      copying yarl\\_url.py -> build\\lib.win-amd64-cpython-311\\yarl\r\n      copying yarl\\__init__.py -> build\\lib.win-amd64-cpython-311\\yarl\r\n      running egg_info\r\n      writing yarl.egg-info\\PKG-INFO\r\n      writing dependency_links to yarl.egg-info\\dependency_links.txt\r\n      writing requirements to yarl.egg-info\\requires.txt\r\n      writing top-level names to yarl.egg-info\\top_level.txt\r\n      reading manifest file 'yarl.egg-info\\SOURCES.txt'\r\n      reading manifest template 'MANIFEST.in'\r\n      warning: no previously-included files matching '*.pyc' found anywhere in distribution\r\n      warning: no previously-included files matching '*.cache' found anywhere in distribution\r\n      warning: no previously-included files found matching 'yarl\\*.html'\r\n      warning: no previously-included files found matching 'yarl\\*.so'\r\n      warning: no previously-included files found matching 'yarl\\*.pyd'\r\n      no previously-included directories found matching 'docs\\_build'\r\n      adding license file 'LICENSE'\r\n      writing manifest file 'yarl.egg-info\\SOURCES.txt'\r\n      copying yarl\\__init__.pyi -> build\\lib.win-amd64-cpython-311\\yarl\r\n      copying yarl\\_quoting_c.pyi -> build\\lib.win-amd64-cpython-311\\yarl\r\n      copying yarl\\_quoting_c.pyx -> build\\lib.win-amd64-cpython-311\\yarl\r\n      copying yarl\\py.typed -> build\\lib.win-amd64-cpython-311\\yarl\r\n      running build_ext\r\n      building 'yarl._quoting_c' extension\r\n      error: Microsoft Visual C++ 14.0 or greater is required. Get it with \"Microsoft C++ Build Tools\": https://visualstudio.microsoft.com/visual-cpp-build-tools/\r\n      [end of output]\r\n\r\n  note: This error originates from a subprocess, and is likely not a problem with pip.\r\n  ERROR: Failed building wheel for yarl\r\nFailed to build frozenlist multidict yarl\r\nERROR: Could not build wheels for frozenlist, multidict, yarl, which is required to install pyproject.toml-based projects\r\n```\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\n3.11\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\nnot installed\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\nnot installed. It also fails to install.\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nnot installed. It also fails to install.\n```\n\n\n### OS\n\nWindows 10\n\n### Related component\n\nServer, Client\n\n### Additional context\n\nNA\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7051/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7051/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7050", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7050/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7050/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7050/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7050", "id": 1424797985, "node_id": "I_kwDOAMpNN85U7LEh", "number": 7050, "title": "charset-normalizer 3.0.0-1 incompatibility", "user": {"login": "na-tt", "id": 49592997, "node_id": "MDQ6VXNlcjQ5NTkyOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/49592997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/na-tt", "html_url": "https://github.com/na-tt", "followers_url": "https://api.github.com/users/na-tt/followers", "following_url": "https://api.github.com/users/na-tt/following{/other_user}", "gists_url": "https://api.github.com/users/na-tt/gists{/gist_id}", "starred_url": "https://api.github.com/users/na-tt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/na-tt/subscriptions", "organizations_url": "https://api.github.com/users/na-tt/orgs", "repos_url": "https://api.github.com/users/na-tt/repos", "events_url": "https://api.github.com/users/na-tt/events{/privacy}", "received_events_url": "https://api.github.com/users/na-tt/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2022-10-26T23:04:25Z", "updated_at": "2022-11-03T18:37:28Z", "closed_at": "2022-10-29T00:04:10Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nHi, i'm on an arch based distro (garuda) and got python-aiohttp 3.8.3-1 and python-aiohttp-cors 0.7.0-7 installed as dependencies for gns3, upon launching gns3 i get the error message included in the Logs/tracebacks section.\r\n\r\nAs i understood aiohttp has a check in place so that charset-normalizer must be of version number greater than or equal than 2.0 and less than 3.0, however the 24th of october charset-normalizer got updated to 3.0.0-1 on the arch repository causing aiohttp to break.\r\n\r\nMeanwhile i have downgraded back to version 2.1.1-1 solving my problem but i thought i ought to let you know.\n\n### To Reproduce\n\non an arch based distro, install:\r\n\r\n- gns3-gui 2.2.34-2\r\n- gns3-server 2.2.34-2\r\n\r\nlaunch gns3\n\n### Expected behavior\n\ni expect aiohttp to work with python-charset-normalizer 3.0.0-1\n\n### Logs/tracebacks\n\n```python-traceback\nLog from gns3:\r\n\r\n> Local server process has stopped\r\n> Traceback (most recent call last):\r\n>   File \"/usr/lib/python3.10/site-packages/pkg_resources/__init__.py\", line 581, in _build_master\r\n>     ws.require(__requires__)\r\n>   File \"/usr/lib/python3.10/site-packages/pkg_resources/__init__.py\", line 909, in require\r\n>     needed = self.resolve(parse_requirements(requirements))\r\n>   File \"/usr/lib/python3.10/site-packages/pkg_resources/__init__.py\", line 800, in resolve\r\n>     raise VersionConflict(dist, req).with_context(dependent_req)\r\n> pkg_resources.ContextualVersionConflict: (charset-normalizer 3.0.0 (/usr/lib/python3.10/site-packages), Requirement.parse('charset-normalizer<3.0,>=2.0'), {'aiohttp'})\r\n> \r\n> During handling of the above exception, another exception occurred:\r\n> \r\n> Traceback (most recent call last):\r\n>   File \"/usr/bin/gns3server\", line 33, in <module>\r\n>     sys.exit(load_entry_point('gns3-server==2.2.34', 'console_scripts', 'gns3server')())\r\n>   File \"/usr/bin/gns3server\", line 25, in importlib_load_entry_point\r\n>     return next(matches).load()\r\n>   File \"/usr/lib/python3.10/importlib/metadata/__init__.py\", line 171, in load\r\n>     module = import_module(match.group('module'))\r\n>   File \"/usr/lib/python3.10/importlib/__init__.py\", line 126, in import_module\r\n>     return _bootstrap._gcd_import(name[level:], package, level)\r\n>   File \"<frozen importlib._bootstrap>\", line 1050, in _gcd_import\r\n>   File \"<frozen importlib._bootstrap>\", line 1027, in _find_and_load\r\n>   File \"<frozen importlib._bootstrap>\", line 1006, in _find_and_load_unlocked\r\n>   File \"<frozen importlib._bootstrap>\", line 688, in _load_unlocked\r\n>   File \"<frozen importlib._bootstrap_external>\", line 883, in exec_module\r\n>   File \"<frozen importlib._bootstrap>\", line 241, in _call_with_frames_removed\r\n>   File \"/usr/lib/python3.10/site-packages/gns3server/main.py\", line 29, in <module>\r\n>     import gns3server.utils.get_resource\r\n>   File \"/usr/lib/python3.10/site-packages/gns3server/utils/get_resource.py\", line 19, in <module>\r\n>     import pkg_resources\r\n>   File \"/usr/lib/python3.10/site-packages/pkg_resources/__init__.py\", line 3260, in <module>\r\n>     def _initialize_master_working_set():\r\n>   File \"/usr/lib/python3.10/site-packages/pkg_resources/__init__.py\", line 3234, in _call_aside\r\n>     f(*args, **kwargs)\r\n>   File \"/usr/lib/python3.10/site-packages/pkg_resources/__init__.py\", line 3272, in _initialize_master_working_set\r\n>     working_set = WorkingSet._build_master()\r\n>   File \"/usr/lib/python3.10/site-packages/pkg_resources/__init__.py\", line 583, in _build_master\r\n>     return cls._build_from_requirements(__requires__)\r\n>   File \"/usr/lib/python3.10/site-packages/pkg_resources/__init__.py\", line 596, in _build_from_requirements\r\n>     dists = ws.resolve(reqs, Environment())\r\n>   File \"/usr/lib/python3.10/site-packages/pkg_resources/__init__.py\", line 795, in resolve\r\n>     raise DistributionNotFound(req, requirers)\r\n> pkg_resources.DistributionNotFound: The 'charset-normalizer<3.0,>=2.0' distribution was not found and is required by aiohttp\r\n>\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\nPython 3.10.8\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.8.3\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor:\r\nAuthor-email:\r\nLicense: Apache 2\r\nLocation: /usr/lib/python3.10/site-packages\r\nRequires: aiosignal, async-timeout, attrs, charset-normalizer, frozenlist, multidict, yarl\r\nRequired-by: aiohttp-cors, gns3-server\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 6.0.2\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/lib/python3.10/site-packages\r\nRequires:\r\nRequired-by: aiohttp, yarl\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.8.1\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/lib/python3.10/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\n```\n\n\n### OS\n\nGaruda Linux x86_64\n\n### Related component\n\nServer, Client\n\n### Additional context\n\nIn related component i marked both since i don't really know which component gns3 is using.\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7050/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7050/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7030", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7030/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7030/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7030/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7030", "id": 1412294946, "node_id": "I_kwDOAMpNN85ULeki", "number": 7030, "title": "IPv6 and IPv4 DNS resolve conflict", "user": {"login": "hummelm10", "id": 10765528, "node_id": "MDQ6VXNlcjEwNzY1NTI4", "avatar_url": "https://avatars.githubusercontent.com/u/10765528?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hummelm10", "html_url": "https://github.com/hummelm10", "followers_url": "https://api.github.com/users/hummelm10/followers", "following_url": "https://api.github.com/users/hummelm10/following{/other_user}", "gists_url": "https://api.github.com/users/hummelm10/gists{/gist_id}", "starred_url": "https://api.github.com/users/hummelm10/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hummelm10/subscriptions", "organizations_url": "https://api.github.com/users/hummelm10/orgs", "repos_url": "https://api.github.com/users/hummelm10/repos", "events_url": "https://api.github.com/users/hummelm10/events{/privacy}", "received_events_url": "https://api.github.com/users/hummelm10/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-10-17T22:10:51Z", "updated_at": "2022-10-19T13:37:49Z", "closed_at": "2022-10-19T13:37:49Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nI have IPv6 and IPv4 internally on my network but my ISP doesn't support IPv6, just IPv4. It appears DNS resolution will fail and not be attempted using IPv4. I am able to fix the issue by forcing IPv4 using socket and the steps here https://github.com/aio-libs/aiohttp/issues/559#issuecomment-257674345 but this seems like an incorrect solution because if I have a network and ISP that fully supports IPv6 then I should be using that but if I hardcode IPv4 then I can't.\r\n\r\n### To Reproduce\r\n\r\nRun [this](https://github.com/TheLogicMaster/SDH-AnimationChanger) on a network which uses IPv6 internally ONLY along side IPv4 but IPv6 is not supported by the ISP. \n\r\nI originally had this issue with a SteamDeck plugin before I tracked it down to aiohttp\r\nhttps://github.com/TheLogicMaster/SDH-AnimationChanger/issues/20\r\n\r\n\r\n\r\n### Expected behavior\r\n\r\nExpected behavior would be to have a proper get request\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\n[Animation Changer] 2022-10-16 15:13:40,610 ERROR Failed to fetch steamdeckrepo\r\nTraceback (most recent call last):\r\n  File \"aiohttp/connector.py\", line 1154, in _create_direct_connection\r\n  File \"aiohttp/connector.py\", line 880, in _resolve_host\r\n  File \"aiohttp/resolver.py\", line 33, in resolve\r\n  File \"asyncio/base_events.py\", line 860, in getaddrinfo\r\n  File \"concurrent/futures/thread.py\", line 58, in run\r\n  File \"socket.py\", line 955, in getaddrinfo\r\nsocket.gaierror: [Errno -3] Temporary failure in name resolution\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/deck/homebrew/plugins/SDH-AnimationChanger/main.py\", line 47, in get_steamdeckrepo\r\n    async with web.request(\r\n  File \"aiohttp/client.py\", line 1138, in __aenter__\r\n  File \"aiohttp/client.py\", line 535, in _request\r\n  File \"aiohttp/connector.py\", line 542, in connect\r\n  File \"aiohttp/connector.py\", line 907, in _create_connection\r\n  File \"aiohttp/connector.py\", line 1166, in _create_direct_connection\r\naiohttp.client_exceptions.ClientConnectorError: Cannot connect to host steamdeckrepo.com:443 ssl:<ssl.SSLContext object at 0x7fc7a271dc40> [Temporary failure in name resolution]\r\n[Animation Changer] 2022-10-16 15:13:40,611 INFO Initialized\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n$ python --version\r\n3.10.2\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n$ python -m pip show aiohttp\r\naiohttp==3.8.1\r\naiohttp-jinja2==1.5.0\r\naiohttp_cors==0.7.0\r\ncertifi==2022.6.15\r\n```\r\n\r\n### OS\r\n\r\nSteamOS 3.3.2\r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7030/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7030/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7018", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7018/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7018/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7018/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7018", "id": 1408313361, "node_id": "I_kwDOAMpNN85T8SgR", "number": 7018, "title": "session.get raises ClientConnectorSSLError despite ssl=False", "user": {"login": "rbuffat", "id": 259530, "node_id": "MDQ6VXNlcjI1OTUzMA==", "avatar_url": "https://avatars.githubusercontent.com/u/259530?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rbuffat", "html_url": "https://github.com/rbuffat", "followers_url": "https://api.github.com/users/rbuffat/followers", "following_url": "https://api.github.com/users/rbuffat/following{/other_user}", "gists_url": "https://api.github.com/users/rbuffat/gists{/gist_id}", "starred_url": "https://api.github.com/users/rbuffat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rbuffat/subscriptions", "organizations_url": "https://api.github.com/users/rbuffat/orgs", "repos_url": "https://api.github.com/users/rbuffat/repos", "events_url": "https://api.github.com/users/rbuffat/events{/privacy}", "received_events_url": "https://api.github.com/users/rbuffat/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-10-13T19:23:08Z", "updated_at": "2022-10-14T19:28:06Z", "closed_at": "2022-10-14T12:15:06Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nI expected that aiohttp behaves similarly to requests `verify=False` in the respect that all SSL validation is ignored. However, for the following server still a ClientConnectorSSLError error is raised.\r\n\r\naiohttp documentations mentions for`ssl=False`:\r\n\r\n> By default aiohttp uses strict checks for HTTPS protocol. Certification checks can be relaxed by setting ssl to False:\r\n\r\nThis could invalidate my assumption about ssl=False ignoring all SSL-related errors.\r\n\n\n### To Reproduce\n\n```\r\nimport asyncio\r\nimport aiohttp\r\nfrom aiohttp import ClientSession\r\nimport requests\r\n\r\nprint(f\"aiohttp version: {aiohttp.__version__}\")\r\n\r\nurl = \"https://terkep.torokbalint.hu/mapproxy/service?SERVICE=WMS&REQUEST=GetCapabilities&VERSION=1.3.0\"\r\n\r\nprint(f\"requests.get: {requests.get(url, verify=False).status_code}\")\r\n\r\nasync def test_url():\r\n    async with ClientSession() as session:\r\n        async with session.get(url=url, ssl=False) as response:\r\n            print(response.status)\r\n\r\nasyncio.run(test_url())\r\n```\n\n### Expected behavior\n\nNo SSL error is raised\n\n### Logs/tracebacks\n\n```python-traceback\naiohttp version: 3.8.3\r\n/usr/lib/python3.10/site-packages/urllib3/connectionpool.py:1045: InsecureRequestWarning: Unverified HTTPS request is being made to host 'terkep.torokbalint.hu'. Adding certificate verification is strongly advised. See: https://urllib3.readthedocs.io/en/1.26.x/advanced-usage.html#ssl-warnings\r\n  warnings.warn(\r\nrequests.get: 200\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3.10/site-packages/aiohttp/connector.py\", line 980, in _wrap_create_connection\r\n    return await self._loop.create_connection(*args, **kwargs)  # type: ignore[return-value]  # noqa\r\n  File \"/usr/lib/python3.10/asyncio/base_events.py\", line 1092, in create_connection\r\n    transport, protocol = await self._create_connection_transport(\r\n  File \"/usr/lib/python3.10/asyncio/base_events.py\", line 1122, in _create_connection_transport\r\n    await waiter\r\n  File \"/usr/lib/python3.10/asyncio/sslproto.py\", line 534, in data_received\r\n    ssldata, appdata = self._sslpipe.feed_ssldata(data)\r\n  File \"/usr/lib/python3.10/asyncio/sslproto.py\", line 188, in feed_ssldata\r\n    self._sslobj.do_handshake()\r\n  File \"/usr/lib/python3.10/ssl.py\", line 975, in do_handshake\r\n    self._sslobj.do_handshake()\r\nssl.SSLError: [SSL: SSLV3_ALERT_HANDSHAKE_FAILURE] sslv3 alert handshake failure (_ssl.c:997)\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/rene/dev/aiohttp_bug/bug.py\", line 17, in <module>\r\n    asyncio.run(test_url())\r\n  File \"/usr/lib/python3.10/asyncio/runners.py\", line 44, in run\r\n    return loop.run_until_complete(main)\r\n  File \"/usr/lib/python3.10/asyncio/base_events.py\", line 649, in run_until_complete\r\n    return future.result()\r\n  File \"/home/rene/dev/aiohttp_bug/bug.py\", line 14, in test_url\r\n    async with session.get(url=url, ssl=False) as response:\r\n  File \"/usr/lib/python3.10/site-packages/aiohttp/client.py\", line 1141, in __aenter__\r\n    self._resp = await self._coro\r\n  File \"/usr/lib/python3.10/site-packages/aiohttp/client.py\", line 536, in _request\r\n    conn = await self._connector.connect(\r\n  File \"/usr/lib/python3.10/site-packages/aiohttp/connector.py\", line 540, in connect\r\n    proto = await self._create_connection(req, traces, timeout)\r\n  File \"/usr/lib/python3.10/site-packages/aiohttp/connector.py\", line 901, in _create_connection\r\n    _, proto = await self._create_direct_connection(req, traces, timeout)\r\n  File \"/usr/lib/python3.10/site-packages/aiohttp/connector.py\", line 1206, in _create_direct_connection\r\n    raise last_exc\r\n  File \"/usr/lib/python3.10/site-packages/aiohttp/connector.py\", line 1175, in _create_direct_connection\r\n    transp, proto = await self._wrap_create_connection(\r\n  File \"/usr/lib/python3.10/site-packages/aiohttp/connector.py\", line 984, in _wrap_create_connection\r\n    raise ClientConnectorSSLError(req.connection_key, exc) from exc\r\naiohttp.client_exceptions.ClientConnectorSSLError: Cannot connect to host terkep.torokbalint.hu:443 ssl:False [[SSL: SSLV3_ALERT_HANDSHAKE_FAILURE] sslv3 alert handshake failure (_ssl.c:997)]\r\n```\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\nPython 3.10.8\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.8.3\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: \r\nAuthor-email: \r\nLicense: Apache 2\r\nLocation: /usr/lib/python3.10/site-packages\r\nRequires: aiosignal, async-timeout, attrs, charset-normalizer, frozenlist, multidict, yarl\r\nRequired-by: aiobotocore, nextcord\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.6\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/lib/python3.10/site-packages\r\nRequires: \r\nRequired-by: aiohttp, yarl\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.8.1\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/lib/python3.10/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\n```\n\n\n### OS\n\nArch Linux\n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7018/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7018/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7010", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7010/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7010/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7010/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/7010", "id": 1403031664, "node_id": "I_kwDOAMpNN85ToJBw", "number": 7010, "title": "No info about request in access log if request is cancelled", "user": {"login": "ValeryVS", "id": 6702994, "node_id": "MDQ6VXNlcjY3MDI5OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/6702994?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ValeryVS", "html_url": "https://github.com/ValeryVS", "followers_url": "https://api.github.com/users/ValeryVS/followers", "following_url": "https://api.github.com/users/ValeryVS/following{/other_user}", "gists_url": "https://api.github.com/users/ValeryVS/gists{/gist_id}", "starred_url": "https://api.github.com/users/ValeryVS/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ValeryVS/subscriptions", "organizations_url": "https://api.github.com/users/ValeryVS/orgs", "repos_url": "https://api.github.com/users/ValeryVS/repos", "events_url": "https://api.github.com/users/ValeryVS/events{/privacy}", "received_events_url": "https://api.github.com/users/ValeryVS/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-10-10T11:36:50Z", "updated_at": "2022-10-14T19:31:45Z", "closed_at": "2022-10-14T19:31:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nHttp request is cancelled. For example, with [AbortController](https://developer.mozilla.org/en-US/docs/Web/API/AbortController) from browser. If there is no `except CancelledError` in handler, there will not be an access log entry about this request.\n\n### To Reproduce\n\n```\r\nfrom asyncio import CancelledError\r\n\r\nfrom aiohttp import web\r\n\r\nasync def handler(self, request: Request):\r\n    try:\r\n        # some code\r\n        return\r\n    except CancelledError:\r\n        logger.error('import location cancelled')\r\n\r\napi_router = web.Application()\r\n\r\napi_router.router.add_post(\r\n    '/do-something',\r\n    handler,\r\n)\r\n```\n\n### Expected behavior\n\nI'm not sure, but, probably, there should be access log entry about request even if there was CancelledError and it was not handled. Otherwise, how I should know about these requests?\n\n### Logs/tracebacks\n\n```python-traceback\n-\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\n3.10.4\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\n3.8.1\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\n6.0.2\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\n1.8.1\n```\n\n\n### OS\n\nhttps://hub.docker.com/layers/library/python/3.10.4/images/sha256-16f3cde3d42a8049c4668d85a874abd5684e2c634b189dfab30506d30495f408?context=explore\n\n### Related component\n\nServer\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7010/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/7010/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6997", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6997/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6997/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6997/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6997", "id": 1393867141, "node_id": "I_kwDOAMpNN85TFLmF", "number": 6997, "title": "Fails to build on Python 3.11 - longintrepr.h: No such file or directory", "user": {"login": "chris-dem", "id": 26067498, "node_id": "MDQ6VXNlcjI2MDY3NDk4", "avatar_url": "https://avatars.githubusercontent.com/u/26067498?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chris-dem", "html_url": "https://github.com/chris-dem", "followers_url": "https://api.github.com/users/chris-dem/followers", "following_url": "https://api.github.com/users/chris-dem/following{/other_user}", "gists_url": "https://api.github.com/users/chris-dem/gists{/gist_id}", "starred_url": "https://api.github.com/users/chris-dem/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chris-dem/subscriptions", "organizations_url": "https://api.github.com/users/chris-dem/orgs", "repos_url": "https://api.github.com/users/chris-dem/repos", "events_url": "https://api.github.com/users/chris-dem/events{/privacy}", "received_events_url": "https://api.github.com/users/chris-dem/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-10-02T19:05:44Z", "updated_at": "2022-10-02T20:53:24Z", "closed_at": "2022-10-02T20:53:24Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\n## Describe the bug\r\n Unable to find longinter when using `env CC=mpicxx pip3.11 install repast4py` on ubuntu WSL\n\n### To Reproduce\n\nI followed the tutorial on https://repast.github.io/repast4py.site/guide/user_guide.html\n\n### Expected behavior\n\nShould have installed normally\n\n### Logs/tracebacks\n\n```python-traceback\nIn file included from src/MPI.c:4:\r\n            src/mpi4py.MPI.c:198:12: fatal error: longintrepr.h: No such file or directory\r\n              198 |   #include \"longintrepr.h\"\r\n                  |            ^~~~~~~~~~~~~~~\r\n            compilation terminated.\r\n            error: command '/usr/bin/mpicc' failed with exit code 1\r\n            [end of output]\r\n\r\n        note: This error originates from a subprocess, and is likely not a problem with pip.\r\n        ERROR: Failed building wheel for mpi4py\r\n      Failed to build mpi4py\r\n      ERROR: Could not build wheels for mpi4py, which is required to install pyproject.toml-based projects\r\n      [end of output]\r\n\r\n  note: This error originates from a subprocess, and is likely not a problem with pip.\r\nerror: subprocess-exited-with-error\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\n3.11\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\nVersion: 3.8.3\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\nVersion: 6.0.2\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nVersion: 1.8.1\n```\n\n\n### OS\n\nUbuntu 20.04.5 LTS\n\n### Related component\n\nServer, Client\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6997/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6997/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6995", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6995/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6995/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6995/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6995", "id": 1393384090, "node_id": "I_kwDOAMpNN85TDVqa", "number": 6995, "title": "aiohttp.client_exceptions.ClientConnectionError: Connection closed", "user": {"login": "IIDarkNessYT", "id": 81167599, "node_id": "MDQ6VXNlcjgxMTY3NTk5", "avatar_url": "https://avatars.githubusercontent.com/u/81167599?v=4", "gravatar_id": "", "url": "https://api.github.com/users/IIDarkNessYT", "html_url": "https://github.com/IIDarkNessYT", "followers_url": "https://api.github.com/users/IIDarkNessYT/followers", "following_url": "https://api.github.com/users/IIDarkNessYT/following{/other_user}", "gists_url": "https://api.github.com/users/IIDarkNessYT/gists{/gist_id}", "starred_url": "https://api.github.com/users/IIDarkNessYT/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/IIDarkNessYT/subscriptions", "organizations_url": "https://api.github.com/users/IIDarkNessYT/orgs", "repos_url": "https://api.github.com/users/IIDarkNessYT/repos", "events_url": "https://api.github.com/users/IIDarkNessYT/events{/privacy}", "received_events_url": "https://api.github.com/users/IIDarkNessYT/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-10-01T12:23:58Z", "updated_at": "2022-10-01T13:45:48Z", "closed_at": "2022-10-01T13:45:48Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nMy code:\r\n\r\n    class request():\r\n\r\n        @classmethod\r\n        async def get(self, url, call, *, content=None, headers=None):\r\n            if content is not None:\r\n                if headers is not None:\r\n                    async with call.request(method='GET', url=url, json=content, headers=headers) as response:\r\n                        return response\r\n                else:\r\n                    async with call.request(method='GET', url=url, json=content) as response:\r\n                        return response\r\n            else:\r\n                if headers is not None:\r\n                    async with call.request(method='GET', url=url, headers=headers) as response:\r\n                        return response\r\n                else:\r\n                    async with call.request(method='GET', url=url) as response:\r\n                        return response\r\n\r\n    async def check_premium(guild, owner):\r\n        async with aiohttp.ClientSession() as call:\r\n            jsonstr = {\r\n                \"MY\": \"CONTENT\"\r\n            }\r\n            url = \"MY URL\"\r\n            result = await request.get(url, call, content=jsonstr)\r\n            print(await result.json())\r\n\r\n    async def test():\r\n        await check_premium('995048257447280770', '553960665581355009')\r\n\r\n    loop = asyncio.get_event_loop()\r\n    loop.run_until_complete(test())\r\n\r\n### To Reproduce\r\n\r\n1. I use client\r\n2. I'm run my classmethod in function\r\n\r\n### Expected behavior\r\n\r\n-\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nTraceback (most recent call last):\r\n  File \"func.py\", line 89, in <module>\r\n    loop.run_until_complete(test())\r\n  File \"/usr/lib/python3.8/asyncio/base_events.py\", line 616, in run_until_complete\r\n    return future.result()\r\n  File \"func.py\", line 86, in test\r\n    await check_premium('995048257447280770', '553960665581355009')\r\n  File \"func.py\", line 74, in check_premium\r\n    print(await result.json())\r\n  File \"/home/darkness/.local/lib/python3.8/site-packages/aiohttp/client_reqrep.py\", line 1092, in json\r\n    await self.read()\r\n  File \"/home/darkness/.local/lib/python3.8/site-packages/aiohttp/client_reqrep.py\", line 1032, in read\r\n    self._body = await self.content.read()\r\n  File \"/home/darkness/.local/lib/python3.8/site-packages/aiohttp/streams.py\", line 344, in read\r\n    raise self._exception\r\naiohttp.client_exceptions.ClientConnectionError: Connection closed\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\nPython 3.8.10\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\nName: aiohttp\r\nVersion: 3.7.4.post0\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/darkness/.local/lib/python3.8/site-packages\r\nRequires: chardet, attrs, async-timeout, typing-extensions, yarl, multidict\r\nRequired-by: py-cord, discord.py, discord-py-interactions, dhooks\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\nName: multidict\r\nVersion: 6.0.2\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/darkness/.local/lib/python3.8/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\nName: yarl\r\nVersion: 1.7.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/darkness/.local/lib/python3.8/site-packages\r\nRequires: multidict, idna\r\nRequired-by: aiohttp\r\n```\r\n\r\n\r\n### OS\r\n\r\nLinux Mint xfce\r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6995/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6995/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6917", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6917/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6917/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6917/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6917", "id": 1376835936, "node_id": "I_kwDOAMpNN85SENlg", "number": 6917, "title": "ClientSession.timeout has an incorrect typing", "user": {"login": "DevilXD", "id": 4180725, "node_id": "MDQ6VXNlcjQxODA3MjU=", "avatar_url": "https://avatars.githubusercontent.com/u/4180725?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DevilXD", "html_url": "https://github.com/DevilXD", "followers_url": "https://api.github.com/users/DevilXD/followers", "following_url": "https://api.github.com/users/DevilXD/following{/other_user}", "gists_url": "https://api.github.com/users/DevilXD/gists{/gist_id}", "starred_url": "https://api.github.com/users/DevilXD/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DevilXD/subscriptions", "organizations_url": "https://api.github.com/users/DevilXD/orgs", "repos_url": "https://api.github.com/users/DevilXD/repos", "events_url": "https://api.github.com/users/DevilXD/events{/privacy}", "received_events_url": "https://api.github.com/users/DevilXD/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2022-09-17T17:59:22Z", "updated_at": "2022-09-20T16:48:55Z", "closed_at": "2022-09-20T16:48:55Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nThe `aiohttp.ClientSession.timeout` attribute has a type of `Union[object, aiohttp.ClientTimeout]`, however the code logic will never actually assign a bare `object` type to the `self._timeout` attribute, making this typing quite over-inclusive. Trying to use this attribute in typed code results in having to use `cast(aiohttp.ClientTimeout, session.timeout)`, which is far from ideal considering one can just fix the typing in the library.\r\n\r\nI ran into this while using Python 3.8.10, but the exact same explanation above applies to the current master branch (and the version I'm using of course), as shown by the snippets below.\r\n\r\n3.8 branch `__init__` parameter:\r\nhttps://github.com/aio-libs/aiohttp/blob/6243204a6a6a0e5ff84ac754218381b44a841e72/aiohttp/client.py#L217\r\n\r\n3.8 branch `self._timeout` assignment:\r\nhttps://github.com/aio-libs/aiohttp/blob/6243204a6a6a0e5ff84ac754218381b44a841e72/aiohttp/client.py#L261-L290\r\nNote the `# type: ignore` comment on `L278` there - it's because the `timeout is sentinel` check does not narrow down the `timeout` type. The correct way to go about this would be to use a `cast` there instead of ignoring the issue like that.\r\n\r\n3.8 branch `timeout` attribute declaration:\r\nhttps://github.com/aio-libs/aiohttp/blob/6243204a6a6a0e5ff84ac754218381b44a841e72/aiohttp/client.py#L1029-L1032\r\n\r\nMaster branch `__init__` parameter:\r\nhttps://github.com/aio-libs/aiohttp/blob/52fa599c5637dd1a38761afb6829b0439b1cf505/aiohttp/client.py#L215\r\n\r\nMaster branch `self._timeout` assignment:\r\nhttps://github.com/aio-libs/aiohttp/blob/52fa599c5637dd1a38761afb6829b0439b1cf505/aiohttp/client.py#L260-L263\r\nDue to a different handling of the `sentinel` value via an `Enum` member, no `cast` is needed here.\r\n\r\nMaster branch `timeout` attribute declaration:\r\nhttps://github.com/aio-libs/aiohttp/blob/52fa599c5637dd1a38761afb6829b0439b1cf505/aiohttp/client.py#L1008-L1011\r\nThe attribute type is still over-inclusive here though.\r\n\r\nThe solution would be quite simple:\r\n\r\n```py\r\n    @property\r\n    def timeout(self) -> ClientTimeout:\r\n        \"\"\"Timeout for the session.\"\"\"\r\n        return self._timeout\r\n````\r\n\r\nPlease let me know if you'd welcome a PR for this. I'd like to get this backported back to 3.8 (that I'm using) if possible, but if not, just fixing it in the master branch so that it's correct going forward would be good enough for me.\r\n\r\n### To Reproduce\r\n\r\nUtilize some kind of a type checker like MyPy.\r\n\r\n```py\r\nimport asyncio\r\nimport aiohttp\r\n\r\nasync def main:\r\n    session = aiohttp.ClientSession(timeout=aiohttp.ClientTimeout(total=10))\r\n    # read back the total time attribute\r\n    total_time = session.timeout.total  # \"object\" type of \"Union[object, ClientTimeout]\" has no attribute \"total\"\r\n    print(total_time)\r\n\r\nasyncio.run(main())\r\n```\r\n\r\n### Expected behavior\r\n\r\nThe attribute having only the `aiohttp.ClientTimeout` type and not requiring `cast` usage when accessing the attribute during library usage in user code.\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nNot applicable\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\nPython 3.8.10\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\nVersion: 3.8.1\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\nVersion: 6.0.2\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\nVersion: 1.7.2\r\n```\r\n\r\n\r\n### OS\r\n\r\nWindows\r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\nRelated issues and PRs:\r\n\r\n#4191\r\n#4193\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6917/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6917/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6914", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6914/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6914/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6914/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6914", "id": 1368978915, "node_id": "I_kwDOAMpNN85RmPXj", "number": 6914, "title": "aiohttp 3.8.1 speedups still include cchardet", "user": {"login": "gilbahat", "id": 5927621, "node_id": "MDQ6VXNlcjU5Mjc2MjE=", "avatar_url": "https://avatars.githubusercontent.com/u/5927621?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gilbahat", "html_url": "https://github.com/gilbahat", "followers_url": "https://api.github.com/users/gilbahat/followers", "following_url": "https://api.github.com/users/gilbahat/following{/other_user}", "gists_url": "https://api.github.com/users/gilbahat/gists{/gist_id}", "starred_url": "https://api.github.com/users/gilbahat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gilbahat/subscriptions", "organizations_url": "https://api.github.com/users/gilbahat/orgs", "repos_url": "https://api.github.com/users/gilbahat/repos", "events_url": "https://api.github.com/users/gilbahat/events{/privacy}", "received_events_url": "https://api.github.com/users/gilbahat/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-09-11T15:23:22Z", "updated_at": "2022-09-11T15:33:12Z", "closed_at": "2022-09-11T15:33:11Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nIt appears that the fix in https://github.com/aio-libs/aiohttp/issues/6819 is incomplete or otherwise fails to register with pypi:\r\n\r\n$ curl -s https://pypi.org/pypi/aiohttp/json | jq \".info.requires_dist\"\r\n[\r\n  \"attrs (>=17.3.0)\",\r\n  \"charset-normalizer (<3.0,>=2.0)\",\r\n  \"multidict (<7.0,>=4.5)\",\r\n  \"async-timeout (<5.0,>=4.0.0a3)\",\r\n  \"yarl (<2.0,>=1.0)\",\r\n  \"frozenlist (>=1.1.1)\",\r\n  \"aiosignal (>=1.1.2)\",\r\n  \"idna-ssl (>=1.0) ; python_version < \\\"3.7\\\"\",\r\n  \"asynctest (==0.13.0) ; python_version < \\\"3.8\\\"\",\r\n  \"typing-extensions (>=3.7.4) ; python_version < \\\"3.8\\\"\",\r\n  \"aiodns ; extra == 'speedups'\",\r\n  \"Brotli ; extra == 'speedups'\",\r\n  \"cchardet ; extra == 'speedups'\"\r\n]\r\n\r\none would expect cchardet to be marked by a python_version marker, yet it is not.\r\nI suspect the problem might be with https://github.com/aio-libs/aiohttp/blob/master/requirements/constraints.txt#L27 which does not contain a marker.\r\n\r\nplease advise.\n\n### To Reproduce\n\nCreate a pyproject.toml with aiohttp version 3.8.1 with speedups in an environment with python3.10\r\nrun poetry update\n\n### Expected behavior\n\npoetry lock file does not contain cchardet\n\n### Logs/tracebacks\n\n```python-traceback\nn/a\n```\n\n\n### Python Version\n\n```console\n3.10\n```\n\n\n### aiohttp Version\n\n```console\n3.8.1\n```\n\n\n### multidict Version\n\n```console\nn/a\n```\n\n\n### yarl Version\n\n```console\nn/a\n```\n\n\n### OS\n\nMacOS X Monterey 12.5.1\n\n### Related component\n\nClient\n\n### Additional context\n\nI found out that cchardet was still being installed in my python 3.10 project.\r\nsurprisingly enough, it worked still.\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6914/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6914/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6905", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6905/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6905/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6905/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6905", "id": 1362204330, "node_id": "I_kwDOAMpNN85RMZaq", "number": 6905, "title": "cgi is deprecated and slated for removal in Python 3.13", "user": {"login": "cooperlees", "id": 3005596, "node_id": "MDQ6VXNlcjMwMDU1OTY=", "avatar_url": "https://avatars.githubusercontent.com/u/3005596?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cooperlees", "html_url": "https://github.com/cooperlees", "followers_url": "https://api.github.com/users/cooperlees/followers", "following_url": "https://api.github.com/users/cooperlees/following{/other_user}", "gists_url": "https://api.github.com/users/cooperlees/gists{/gist_id}", "starred_url": "https://api.github.com/users/cooperlees/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cooperlees/subscriptions", "organizations_url": "https://api.github.com/users/cooperlees/orgs", "repos_url": "https://api.github.com/users/cooperlees/repos", "events_url": "https://api.github.com/users/cooperlees/events{/privacy}", "received_events_url": "https://api.github.com/users/cooperlees/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-09-05T15:44:52Z", "updated_at": "2022-09-05T18:13:22Z", "closed_at": "2022-09-05T16:41:20Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nFound running black's tests with warnings on with Python 3.11 we get:\r\n\r\n```\r\n.tox/311/lib/python3.11/site-packages/aiohttp/helpers.py:6: in <module>\r\n    import cgi\r\n```\r\n\r\nThe deprecation PEP talks about options: https://peps.python.org/pep-0594/#cgi\r\n\r\n### To Reproduce\r\n\r\nInstall and run aiohttp (I did with with no extensions env var `AIOHTTP_NO_EXTENSIONS=1`) using something that includes the helpers module.\r\n\r\n### Expected behavior\r\n\r\nMove to non deprecated to avoid breakage in 3.13\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\ntests/test_blackd.py:13: in <module>\r\n    from aiohttp import web\r\n.tox/311/lib/python3.11/site-packages/aiohttp/__init__.py:6: in <module>\r\n    from .client import (\r\n.tox/311/lib/python3.11/site-packages/aiohttp/client.py:36: in <module>\r\n    from . import hdrs, http, payload\r\n.tox/311/lib/python3.11/site-packages/aiohttp/http.py:7: in <module>\r\n    from .http_parser import (\r\n.tox/311/lib/python3.11/site-packages/aiohttp/http_parser.py:29: in <module>\r\n    from .helpers import NO_EXTENSIONS, BaseTimerContext\r\n.tox/311/lib/python3.11/site-packages/aiohttp/helpers.py:6: in <module>\r\n    import cgi\r\n/usr/lib/python3.11/cgi.py:57: in <module>\r\n    warnings._deprecated(__name__, remove=(3,13))\r\n/usr/lib/python3.11/warnings.py:514: in _deprecated\r\n    warn(msg, DeprecationWarning, stacklevel=3)\r\nE   DeprecationWarning: 'cgi' is deprecated and slated for removal in Python 3.13\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\ncooper@home1:~/repos/black$ python3.11 --version --version\r\nPython 3.11.0rc1+ (main, Sep  5 2022, 08:58:54) [GCC 11.2.0]\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\ncooper@home1:~/repos/black$ /tmp/tb/bin/pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.8.1\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor:\r\nAuthor-email:\r\nLicense: Apache 2\r\nLocation: /tmp/tb/lib/python3.11/site-packages\r\nRequires: aiosignal, async-timeout, attrs, charset-normalizer, frozenlist, multidict, yarl\r\nRequired-by:\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\ncooper@home1:~/repos/black$ /tmp/tb/bin/pip show multidict\r\nName: multidict\r\nVersion: 6.0.2\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /tmp/tb/lib/python3.11/site-packages\r\nRequires:\r\nRequired-by: aiohttp, yarl\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\ncooper@home1:~/repos/black$ /tmp/tb/bin/pip show yarl\r\nName: yarl\r\nVersion: 1.8.1\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /tmp/tb/lib/python3.11/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\r\n### OS\r\n\r\n```console\r\ncooper@home1:~/repos/black$ uname -a\r\nLinux home1.cooperlees.com 5.15.0-46-generic #49-Ubuntu SMP Thu Aug 4 18:03:25 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux\r\n```\r\n\r\n### Related component\r\n\r\nServer\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6905/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6905/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6904", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6904/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6904/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6904/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6904", "id": 1359242031, "node_id": "I_kwDOAMpNN85RBGMv", "number": 6904, "title": "Host header position is locked", "user": {"login": "redacted-text", "id": 6215729, "node_id": "MDQ6VXNlcjYyMTU3Mjk=", "avatar_url": "https://avatars.githubusercontent.com/u/6215729?v=4", "gravatar_id": "", "url": "https://api.github.com/users/redacted-text", "html_url": "https://github.com/redacted-text", "followers_url": "https://api.github.com/users/redacted-text/followers", "following_url": "https://api.github.com/users/redacted-text/following{/other_user}", "gists_url": "https://api.github.com/users/redacted-text/gists{/gist_id}", "starred_url": "https://api.github.com/users/redacted-text/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/redacted-text/subscriptions", "organizations_url": "https://api.github.com/users/redacted-text/orgs", "repos_url": "https://api.github.com/users/redacted-text/repos", "events_url": "https://api.github.com/users/redacted-text/events{/privacy}", "received_events_url": "https://api.github.com/users/redacted-text/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-09-01T18:26:08Z", "updated_at": "2022-09-02T21:56:14Z", "closed_at": "2022-09-02T21:56:14Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nWhy did you implemented #3265?\r\nNow I need to move this header position, and you locked it.\n\n### To Reproduce\n\n-\n\n### Expected behavior\n\n-\n\n### Logs/tracebacks\n\n```python-traceback\n-\n```\n\n\n### Python Version\n\n```console\nany\n```\n\n\n### aiohttp Version\n\n```console\n-\n```\n\n\n### multidict Version\n\n```console\n-\n```\n\n\n### yarl Version\n\n```console\n-\n```\n\n\n### OS\n\n-\n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6904/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6904/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6902", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6902/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6902/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6902/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6902", "id": 1357787801, "node_id": "I_kwDOAMpNN85Q7jKZ", "number": 6902, "title": "UnicodeDecodeError: 'utf-8' codec can't decode byte... invalid start byte", "user": {"login": "desireewilliams", "id": 57154883, "node_id": "MDQ6VXNlcjU3MTU0ODgz", "avatar_url": "https://avatars.githubusercontent.com/u/57154883?v=4", "gravatar_id": "", "url": "https://api.github.com/users/desireewilliams", "html_url": "https://github.com/desireewilliams", "followers_url": "https://api.github.com/users/desireewilliams/followers", "following_url": "https://api.github.com/users/desireewilliams/following{/other_user}", "gists_url": "https://api.github.com/users/desireewilliams/gists{/gist_id}", "starred_url": "https://api.github.com/users/desireewilliams/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/desireewilliams/subscriptions", "organizations_url": "https://api.github.com/users/desireewilliams/orgs", "repos_url": "https://api.github.com/users/desireewilliams/repos", "events_url": "https://api.github.com/users/desireewilliams/events{/privacy}", "received_events_url": "https://api.github.com/users/desireewilliams/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2022-08-31T19:48:59Z", "updated_at": "2022-09-01T19:14:30Z", "closed_at": "2022-09-01T19:14:30Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nWhen sending a POST request to an API that returns a PDF response, I'm unable to receive the data as the response is automatically trying to be decoded instead of simply returning the content \n\n### To Reproduce\n\n> import os\r\nimport asyncio\r\nimport aiohttp\r\n\r\n\r\n> async def getReport(session,reportUrl:str,anItem:str) :\r\n    # the payload is application specific and in the correct format\r\n    payload = '{\"timezone\":\"local\",\"format\":\"pdf\",\"itemID\":\"'+ anItem + '\"}'\r\n    print(f'Starting a report')\r\n    async with session.post(url=reportUrl,data=payload,ssl=False) as resp: \r\n       response = await resp\r\n    print(f'Finishing a report')\r\n    return response.content\r\n\r\n\r\n> async def getAllReport(baseUrl:str,headers:str,itemList:list,path:str='/reportPath/'):\r\n    async with aiohttp.ClientSession(headers=headers) as session:\r\n        reportUrl = baseUrl + '/reportGenerationAPI'\r\n        tasks = []\r\n        for anItem in itemList:\r\n            tasks.append(asyncio.ensure_future(getReport(session=session,reportUrl=reportUrl,anItem=anItem)))\r\n        allReports = await asyncio.gather(*tasks)\r\n        n = 0\r\n        for aReport in allReports:\r\n            filename = f'{path}{n}.pdf' \r\n            n = n + 1\r\n            with open(filename,'wb') as f:\r\n                f.write(aReport)\r\n\r\n> baseUrl = 'https://myAPIurl'\r\nheaders = {'Authorization': 'Bearer ' + aToken,\r\n    'Content-Type': 'application/json'}\r\nitemList = []\r\nitemList.append('guid1')\r\nitemList.append(guid2')\r\n\r\n> asyncio.run(getAllReport((baseUrl=baseUrl,headers=headers,itemList=ids))\r\n\r\n\n\n### Expected behavior\n\nIf no method is called, I would expect that the response be what ever is received from the API.\n\n### Logs/tracebacks\n\n```python-traceback\n... lib\\site-packages\\aiohttp\\client_reqrep.py\", line 1119, in json\r\n    return loads(stripped.decode(encoding))\r\nUnicodeDecodeError: 'utf-8' codec can't decode byte 0xad in position 124: invalid start byte\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\nPython 3.10.6\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\naiohttp 3.8.1\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\nN/A\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nN/A\n```\n\n\n### OS\n\nWindows\n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6902/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6902/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6901", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6901/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6901/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6901/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6901", "id": 1357299337, "node_id": "I_kwDOAMpNN85Q5r6J", "number": 6901, "title": "Slow import time (http.server)", "user": {"login": "rafael-zilberman", "id": 39619603, "node_id": "MDQ6VXNlcjM5NjE5NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/39619603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rafael-zilberman", "html_url": "https://github.com/rafael-zilberman", "followers_url": "https://api.github.com/users/rafael-zilberman/followers", "following_url": "https://api.github.com/users/rafael-zilberman/following{/other_user}", "gists_url": "https://api.github.com/users/rafael-zilberman/gists{/gist_id}", "starred_url": "https://api.github.com/users/rafael-zilberman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rafael-zilberman/subscriptions", "organizations_url": "https://api.github.com/users/rafael-zilberman/orgs", "repos_url": "https://api.github.com/users/rafael-zilberman/repos", "events_url": "https://api.github.com/users/rafael-zilberman/events{/privacy}", "received_events_url": "https://api.github.com/users/rafael-zilberman/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 277836062, "node_id": "MDU6TGFiZWwyNzc4MzYwNjI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/good%20first%20issue", "name": "good first issue", "color": "7057ff", "default": true, "description": "Good for newcomers"}, {"id": 1077350962, "node_id": "MDU6TGFiZWwxMDc3MzUwOTYy", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/Hacktoberfest", "name": "Hacktoberfest", "color": "d93f0b", "default": false, "description": "We think it's good for https://hacktoberfest.digitalocean.com/"}], "state": "closed", "locked": false, "assignee": {"login": "Zeesky-code", "id": 71593672, "node_id": "MDQ6VXNlcjcxNTkzNjcy", "avatar_url": "https://avatars.githubusercontent.com/u/71593672?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Zeesky-code", "html_url": "https://github.com/Zeesky-code", "followers_url": "https://api.github.com/users/Zeesky-code/followers", "following_url": "https://api.github.com/users/Zeesky-code/following{/other_user}", "gists_url": "https://api.github.com/users/Zeesky-code/gists{/gist_id}", "starred_url": "https://api.github.com/users/Zeesky-code/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Zeesky-code/subscriptions", "organizations_url": "https://api.github.com/users/Zeesky-code/orgs", "repos_url": "https://api.github.com/users/Zeesky-code/repos", "events_url": "https://api.github.com/users/Zeesky-code/events{/privacy}", "received_events_url": "https://api.github.com/users/Zeesky-code/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "Zeesky-code", "id": 71593672, "node_id": "MDQ6VXNlcjcxNTkzNjcy", "avatar_url": "https://avatars.githubusercontent.com/u/71593672?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Zeesky-code", "html_url": "https://github.com/Zeesky-code", "followers_url": "https://api.github.com/users/Zeesky-code/followers", "following_url": "https://api.github.com/users/Zeesky-code/following{/other_user}", "gists_url": "https://api.github.com/users/Zeesky-code/gists{/gist_id}", "starred_url": "https://api.github.com/users/Zeesky-code/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Zeesky-code/subscriptions", "organizations_url": "https://api.github.com/users/Zeesky-code/orgs", "repos_url": "https://api.github.com/users/Zeesky-code/repos", "events_url": "https://api.github.com/users/Zeesky-code/events{/privacy}", "received_events_url": "https://api.github.com/users/Zeesky-code/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 15, "created_at": "2022-08-31T12:56:56Z", "updated_at": "2022-11-28T18:43:41Z", "closed_at": "2022-11-28T18:43:41Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nWhile using aiohttp in lambda functions we discovered that the import of the aiohttp packages takes nearly half a second (even more, but in our case some of the dependencies of aiohttp were already cached).\r\n![image](https://user-images.githubusercontent.com/39619603/187683113-a28b4e29-d5f1-4459-8390-71840fd5e748.png)\r\n![image](https://user-images.githubusercontent.com/39619603/187683156-150b7f6a-375b-42d1-8a41-4f483e3cbe0b.png)\r\n\r\n\r\n\r\n\r\n### To Reproduce\r\n\r\nYou can reprosude the import time diagram using the following bash commands:\r\n```bash\r\npip install tuna\r\npython -X importtime -c \"import aiohttp\" >> import.txt\r\ntuna import.txt\r\n```\r\n![image](https://user-images.githubusercontent.com/39619603/187682836-6c11b171-da79-462b-91fe-22dbbb272bd3.png)\r\n\r\n### Expected behavior\r\n\r\nA lot of packages are dependent on aiohttp (aiobotocore, elasticsearch, and more...) and the import time is too long for lambda functions.\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nimport time: self [us] | cumulative | imported package\r\nimport time:       714 |        714 | _frozen_importlib_external\r\nimport time:       875 |        875 |   time\r\nimport time:       549 |       1423 | zipimport\r\nimport time:       141 |        141 |     _codecs\r\nimport time:      2323 |       2464 |   codecs\r\nimport time:      1547 |       1547 |   encodings.aliases\r\nimport time:      3052 |       7062 | encodings\r\nimport time:       870 |        870 | encodings.utf_8\r\nimport time:       971 |        971 | encodings.cp1252\r\nimport time:       103 |        103 | _signal\r\nimport time:       892 |        892 | encodings.latin_1\r\nimport time:        69 |         69 |     _abc\r\nimport time:      1144 |       1212 |   abc\r\nimport time:      1388 |       2600 | io\r\nimport time:       197 |        197 |       _stat\r\nimport time:      1026 |       1222 |     stat\r\nimport time:      2129 |       2129 |     _collections_abc\r\nimport time:      1095 |       1095 |       genericpath\r\nimport time:      2514 |       3608 |     ntpath\r\nimport time:      2379 |       9337 |   os\r\nimport time:      1138 |       1138 |   _sitebuiltins\r\nimport time:       132 |        132 |     _locale\r\nimport time:      1163 |       1295 |   _bootlocale\r\nimport time:      1224 |       1224 |   types\r\nimport time:      1563 |       1563 |       warnings\r\nimport time:      2265 |       3827 |     importlib\r\nimport time:       997 |        997 |       importlib.machinery\r\nimport time:      1677 |       2674 |     importlib.abc\r\nimport time:       144 |        144 |           _operator\r\nimport time:      1559 |       1703 |         operator\r\nimport time:      1055 |       1055 |         keyword\r\nimport time:       123 |        123 |           _heapq\r\nimport time:      1952 |       2074 |         heapq\r\nimport time:       225 |        225 |         itertools\r\nimport time:      1192 |       1192 |         reprlib\r\nimport time:       966 |        966 |         _collections\r\nimport time:      4693 |      11905 |       collections\r\nimport time:       104 |        104 |         _functools\r\nimport time:      1891 |       1995 |       functools\r\nimport time:      2263 |      16162 |     contextlib\r\nimport time:      5297 |      27958 |   importlib.util\r\nimport time:      1296 |       1296 |     pywin32_system32\r\nimport time:      3651 |       4946 |   pywin32_bootstrap\r\nimport time:       750 |        750 |   sitecustomize\r\nimport time:       701 |        701 |   usercustomize\r\nimport time:     10919 |      58264 | site\r\nimport time:      1259 |       1259 |     collections.abc\r\nimport time:      2946 |       2946 |       enum\r\nimport time:       130 |        130 |         _sre\r\nimport time:      1535 |       1535 |           sre_constants\r\nimport time:      2732 |       4267 |         sre_parse\r\nimport time:     14121 |      18517 |       sre_compile\r\nimport time:      1429 |       1429 |       copyreg\r\nimport time:      4739 |      27630 |     re\r\nimport time:      4321 |      33209 |   typing\r\nimport time:      1494 |       1494 |       multidict._abc\r\nimport time:      4425 |       4425 |         platform\r\nimport time:      1085 |       1085 |           multidict._multidict_base\r\nimport time:      2352 |       3437 |         multidict._multidict\r\nimport time:      1701 |       9561 |       multidict._compat\r\nimport time:      2401 |      13456 |     multidict\r\nimport time:      2534 |      15990 |   aiohttp.hdrs\r\nimport time:      1150 |       1150 |           concurrent\r\nimport time:      1212 |       1212 |                     token\r\nimport time:      2655 |       3866 |                   tokenize\r\nimport time:      1344 |       5210 |                 linecache\r\nimport time:      2125 |       7334 |               traceback\r\nimport time:      1362 |       1362 |                 _weakrefset\r\nimport time:      1848 |       3209 |               weakref\r\nimport time:       110 |        110 |                 _string\r\nimport time:      2232 |       2342 |               string\r\nimport time:      2052 |       2052 |               threading\r\nimport time:        92 |         92 |               atexit\r\nimport time:      5852 |      20878 |             logging\r\nimport time:      2405 |      23283 |           concurrent.futures._base\r\nimport time:      1811 |      26243 |         concurrent.futures\r\nimport time:      3680 |       3680 |           _socket\r\nimport time:       248 |        248 |             math\r\nimport time:      1078 |       1078 |             select\r\nimport time:      2038 |       3363 |           selectors\r\nimport time:       141 |        141 |           errno\r\nimport time:      4273 |      11456 |         socket\r\nimport time:      1779 |       1779 |           signal\r\nimport time:       127 |        127 |           msvcrt\r\nimport time:       179 |        179 |           _winapi\r\nimport time:      3451 |       5535 |         subprocess\r\nimport time:      7550 |       7550 |           _ssl\r\nimport time:       137 |        137 |               _struct\r\nimport time:      1299 |       1435 |             struct\r\nimport time:       146 |        146 |             binascii\r\nimport time:      2566 |       4147 |           base64\r\nimport time:      6238 |      17934 |         ssl\r\nimport time:      1160 |       1160 |         asyncio.constants\r\nimport time:        83 |         83 |                 _opcode\r\nimport time:      1524 |       1606 |               opcode\r\nimport time:      2148 |       3753 |             dis\r\nimport time:      4072 |       7825 |           inspect\r\nimport time:      1238 |       1238 |             asyncio.format_helpers\r\nimport time:      1435 |       2673 |           asyncio.base_futures\r\nimport time:       958 |        958 |           asyncio.log\r\nimport time:      2191 |      13646 |         asyncio.coroutines\r\nimport time:        88 |         88 |             _contextvars\r\nimport time:      1316 |       1404 |           contextvars\r\nimport time:      1093 |       1093 |           asyncio.exceptions\r\nimport time:      1114 |       1114 |             asyncio.base_tasks\r\nimport time:      1860 |       2973 |           _asyncio\r\nimport time:      3008 |       8476 |         asyncio.events\r\nimport time:      1193 |       1193 |         asyncio.futures\r\nimport time:      1087 |       1087 |         asyncio.protocols\r\nimport time:      1253 |       1253 |           asyncio.transports\r\nimport time:      1504 |       2756 |         asyncio.sslproto\r\nimport time:      1230 |       1230 |           asyncio.locks\r\nimport time:      1252 |       1252 |           asyncio.tasks\r\nimport time:      1748 |       4230 |         asyncio.staggered\r\nimport time:      1156 |       1156 |         asyncio.trsock\r\nimport time:      8261 |     103126 |       asyncio.base_events\r\nimport time:      1258 |       1258 |       asyncio.runners\r\nimport time:      1177 |       1177 |       asyncio.queues\r\nimport time:      1290 |       1290 |       asyncio.streams\r\nimport time:      1216 |       1216 |       asyncio.subprocess\r\nimport time:      2351 |       2351 |         _overlapped\r\nimport time:      1468 |       1468 |         asyncio.base_subprocess\r\nimport time:      1656 |       1656 |         asyncio.proactor_events\r\nimport time:      1574 |       1574 |         asyncio.selector_events\r\nimport time:      1299 |       1299 |                 posixpath\r\nimport time:      1328 |       2627 |               fnmatch\r\nimport time:       176 |        176 |               zlib\r\nimport time:      1217 |       1217 |                 _compression\r\nimport time:      1538 |       1538 |                 _bz2\r\nimport time:      2114 |       4868 |               bz2\r\nimport time:      1268 |       1268 |                 _lzma\r\nimport time:      1824 |       3091 |               lzma\r\nimport time:       801 |        801 |               pwd\r\nimport time:       785 |        785 |               grp\r\nimport time:      7217 |      19562 |             shutil\r\nimport time:        78 |         78 |                 _bisect\r\nimport time:      1313 |       1391 |               bisect\r\nimport time:       101 |        101 |               _sha512\r\nimport time:       254 |        254 |               _random\r\nimport time:      5491 |       7236 |             random\r\nimport time:      2134 |      28931 |           tempfile\r\nimport time:      1567 |      30498 |         asyncio.windows_utils\r\nimport time:      3849 |      41394 |       asyncio.windows_events\r\nimport time:      5022 |     154480 |     asyncio\r\nimport time:      1588 |       1588 |       _hashlib\r\nimport time:       131 |        131 |       _blake2\r\nimport time:       128 |        128 |       _sha3\r\nimport time:      2500 |       4346 |     hashlib\r\nimport time:        96 |         96 |           _json\r\nimport time:      1660 |       1756 |         json.scanner\r\nimport time:      2492 |       4247 |       json.decoder\r\nimport time:      2780 |       2780 |       json.encoder\r\nimport time:      4439 |      11465 |     json\r\nimport time:      1202 |       1202 |       __future__\r\nimport time:       755 |        755 |                 org\r\nimport time:       455 |       1210 |               org.python\r\nimport time:      1673 |       2883 |             org.python.core\r\nimport time:      2185 |       5068 |           copy\r\nimport time:       776 |        776 |             _uuid\r\nimport time:      2074 |       2850 |           uuid\r\nimport time:      1061 |       1061 |           attr._config\r\nimport time:      1150 |       1150 |             attr.exceptions\r\nimport time:      1251 |       2401 |           attr.setters\r\nimport time:      1148 |       1148 |           attr._compat\r\nimport time:      8042 |      20567 |         attr._make\r\nimport time:      2222 |      22788 |       attr.converters\r\nimport time:      1250 |       1250 |       attr.filters\r\nimport time:      6467 |       6467 |       attr.validators\r\nimport time:      1149 |       1149 |       attr._funcs\r\nimport time:      1723 |       1723 |       attr._version_info\r\nimport time:      1156 |       1156 |       attr._next_gen\r\nimport time:      6857 |      42589 |     attr\r\nimport time:      2721 |       2721 |         ipaddress\r\nimport time:      1174 |       1174 |           urllib\r\nimport time:      2766 |       3940 |         urllib.parse\r\nimport time:      1448 |       1448 |           idna.package_data\r\nimport time:      1009 |       1009 |             idna.idnadata\r\nimport time:      1150 |       1150 |             unicodedata\r\nimport time:       901 |        901 |             idna.intranges\r\nimport time:      3530 |       6588 |           idna.core\r\nimport time:      2111 |      10145 |         idna\r\nimport time:       943 |        943 |           yarl._quoting_c\r\nimport time:       969 |       1911 |         yarl._quoting\r\nimport time:      2984 |      21699 |       yarl._url\r\nimport time:      1656 |      23355 |     yarl\r\nimport time:      1785 |       1785 |         http\r\nimport time:       169 |        169 |           _datetime\r\nimport time:      1948 |       2116 |         datetime\r\nimport time:       961 |        961 |           email\r\nimport time:      1557 |       1557 |               locale\r\nimport time:      1529 |       3086 |             calendar\r\nimport time:      1094 |       4180 |           email._parseaddr\r\nimport time:       739 |        739 |             email.base64mime\r\nimport time:       912 |        912 |             email.quoprimime\r\nimport time:      1028 |       1028 |             email.errors\r\nimport time:      1280 |       1280 |               quopri\r\nimport time:      1926 |       3205 |             email.encoders\r\nimport time:      4736 |      10618 |           email.charset\r\nimport time:      2612 |      18369 |         email.utils\r\nimport time:      2022 |       2022 |           html.entities\r\nimport time:      1753 |       3775 |         html\r\nimport time:      1434 |       1434 |                 email.header\r\nimport time:      1076 |       2509 |               email._policybase\r\nimport time:      1795 |       4304 |             email.feedparser\r\nimport time:      2348 |       6651 |           email.parser\r\nimport time:       914 |        914 |             uu\r\nimport time:       966 |        966 |             email._encoded_words\r\nimport time:       739 |        739 |             email.iterators\r\nimport time:      1894 |       4512 |           email.message\r\nimport time:      2734 |      13896 |         http.client\r\nimport time:      1041 |       1041 |         mimetypes\r\nimport time:      2082 |       2082 |         socketserver\r\nimport time:    238495 |     281554 |       http.server\r\nimport time:      1486 |       1486 |           pathlib\r\nimport time:      1131 |       2617 |         aiohttp.typedefs\r\nimport time:      1115 |       3731 |       aiohttp.http_exceptions\r\nimport time:       704 |        704 |           aiohttp.tcp_helpers\r\nimport time:       826 |       1529 |         aiohttp.base_protocol\r\nimport time:       852 |        852 |           cgi\r\nimport time:       828 |        828 |             shlex\r\nimport time:       842 |       1670 |           netrc\r\nimport time:       635 |        635 |               urllib.response\r\nimport time:       885 |       1520 |             urllib.error\r\nimport time:       752 |        752 |             nturl2path\r\nimport time:      2676 |       4947 |           urllib.request\r\nimport time:      1108 |       1108 |           async_timeout\r\nimport time:      1523 |       1523 |           typing_extensions\r\nimport time:       698 |        698 |           aiohttp.log\r\nimport time:       845 |        845 |           aiohttp._helpers\r\nimport time:      7605 |      19245 |         aiohttp.helpers\r\nimport time:      2323 |       2323 |             http.cookies\r\nimport time:      1486 |       3809 |           aiohttp.abc\r\nimport time:      1173 |       1173 |           aiohttp._http_writer\r\nimport time:      1522 |       6503 |         aiohttp.http_writer\r\nimport time:      1712 |       1712 |         aiohttp.streams\r\nimport time:       616 |        616 |         brotli\r\nimport time:       613 |        613 |           backports_abc\r\nimport time:      1564 |       2177 |         aiohttp._http_parser\r\nimport time:      4150 |      35929 |       aiohttp.http_parser\r\nimport time:       918 |        918 |         aiohttp._websocket\r\nimport time:      9480 |      10397 |       aiohttp.http_websocket\r\nimport time:      2135 |     333745 |     aiohttp.http\r\nimport time:      1897 |       1897 |     aiohttp.payload\r\nimport time:      1381 |       1381 |     aiohttp.client_exceptions\r\nimport time:      2132 |       2132 |       aiohttp.multipart\r\nimport time:       992 |        992 |       aiohttp.formdata\r\nimport time:       636 |        636 |       cchardet\r\nimport time:       927 |        927 |             chardet.enums\r\nimport time:       901 |        901 |             chardet.charsetprober\r\nimport time:      1303 |       3131 |           chardet.charsetgroupprober\r\nimport time:       916 |        916 |             chardet.codingstatemachine\r\nimport time:       843 |        843 |             chardet.escsm\r\nimport time:      1246 |       3003 |           chardet.escprober\r\nimport time:       885 |        885 |           chardet.latin1prober\r\nimport time:       906 |        906 |               chardet.mbcssm\r\nimport time:      1827 |       2733 |             chardet.utf8prober\r\nimport time:       857 |        857 |               chardet.mbcharsetprober\r\nimport time:      1042 |       1042 |                 chardet.euctwfreq\r\nimport time:       908 |        908 |                 chardet.euckrfreq\r\nimport time:       945 |        945 |                 chardet.gb2312freq\r\nimport time:      1030 |       1030 |                 chardet.big5freq\r\nimport time:      1000 |       1000 |                 chardet.jisfreq\r\nimport time:      1770 |       6693 |               chardet.chardistribution\r\nimport time:      1051 |       1051 |               chardet.jpcntx\r\nimport time:      1632 |      10231 |             chardet.sjisprober\r\nimport time:       866 |        866 |             chardet.eucjpprober\r\nimport time:       874 |        874 |             chardet.gb2312prober\r\nimport time:       864 |        864 |             chardet.euckrprober\r\nimport time:       846 |        846 |             chardet.cp949prober\r\nimport time:      1048 |       1048 |             chardet.big5prober\r\nimport time:       890 |        890 |             chardet.euctwprober\r\nimport time:      6301 |      24650 |           chardet.mbcsgroupprober\r\nimport time:       865 |        865 |             chardet.hebrewprober\r\nimport time:      1040 |       1040 |               chardet.sbcharsetprober\r\nimport time:      1263 |       2302 |             chardet.langbulgarianmodel\r\nimport time:      1050 |       1050 |             chardet.langgreekmodel\r\nimport time:      1087 |       1087 |             chardet.langhebrewmodel\r\nimport time:      1199 |       1199 |             chardet.langrussianmodel\r\nimport time:      1241 |       1241 |             chardet.langthaimodel\r\nimport time:      1099 |       1099 |             chardet.langturkishmodel\r\nimport time:      3687 |      12528 |           chardet.sbcsgroupprober\r\nimport time:      3395 |      47589 |         chardet.universaldetector\r\nimport time:       831 |        831 |         chardet.version\r\nimport time:      1725 |      50144 |       chardet\r\nimport time:      6613 |      60515 |     aiohttp.client_reqrep\r\nimport time:       997 |        997 |     aiohttp.client_ws\r\nimport time:      1103 |       1103 |       aiohttp.client_proto\r\nimport time:       848 |        848 |       aiohttp.locks\r\nimport time:       617 |        617 |         aiodns\r\nimport time:      2776 |       3393 |       aiohttp.resolver\r\nimport time:      3845 |       9187 |     aiohttp.connector\r\nimport time:      1037 |       1037 |         _compat_pickle\r\nimport time:       166 |        166 |         _pickle\r\nimport time:       587 |        587 |             org\r\nimport time:       182 |        768 |           org.python\r\nimport time:       522 |       1290 |         org.python.core\r\nimport time:      2887 |       5379 |       pickle\r\nimport time:      2579 |       7957 |     aiohttp.cookiejar\r\nimport time:       945 |        945 |           aiohttp._frozenlist\r\nimport time:      1175 |       2119 |         aiohttp.frozenlist\r\nimport time:      1334 |       3452 |       aiohttp.signals\r\nimport time:      9244 |      12696 |     aiohttp.tracing\r\nimport time:      7521 |     672127 |   aiohttp.client\r\nimport time:      1116 |       1116 |   aiohttp.payload_streamer\r\nimport time:       657 |        657 |       gunicorn\r\nimport time:       642 |       1298 |     gunicorn.config\r\nimport time:      4791 |       6089 |   aiohttp.worker\r\nimport time:      4018 |     732547 | aiohttp\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n$ python --version\r\nPython 3.8.9\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n$ python -m pip show aiohttp\r\n3.7.4.post0\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n$ python -m pip show multidict\r\n5.1.0\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n$ python -m pip show yarl\r\n1.6.3\r\n```\r\n\r\n\r\n### OS\r\n\r\nWindows 11\r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6901/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6901/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6898", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6898/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6898/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6898/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6898", "id": 1353134007, "node_id": "I_kwDOAMpNN85Qpy-3", "number": 6898, "title": "Fail to install on Python 3.10", "user": {"login": "haobibo", "id": 1597350, "node_id": "MDQ6VXNlcjE1OTczNTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1597350?v=4", "gravatar_id": "", "url": "https://api.github.com/users/haobibo", "html_url": "https://github.com/haobibo", "followers_url": "https://api.github.com/users/haobibo/followers", "following_url": "https://api.github.com/users/haobibo/following{/other_user}", "gists_url": "https://api.github.com/users/haobibo/gists{/gist_id}", "starred_url": "https://api.github.com/users/haobibo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/haobibo/subscriptions", "organizations_url": "https://api.github.com/users/haobibo/orgs", "repos_url": "https://api.github.com/users/haobibo/repos", "events_url": "https://api.github.com/users/haobibo/events{/privacy}", "received_events_url": "https://api.github.com/users/haobibo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-08-27T20:10:17Z", "updated_at": "2022-08-31T15:16:11Z", "closed_at": "2022-08-31T15:16:11Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\naiohttp install on Python 3.10.6 reports bug when compiling _http_parser\r\n\r\n### To Reproduce\r\n\r\nInstall on Python 3.10.6 on linux with: pip install aiohttp==4.0.0a1\r\n\r\n\r\n### Expected behavior\r\n\r\naiohttp can be successfully installed on Python 3.10.6\r\n\r\n### Logs/tracebacks\r\nRefer to: https://github.com/QPod/docker-images/runs/8052701739?check_suite_focus=true#step:3:1199\r\n\r\n```python-traceback\r\nFail to install on Python3.10 with the following compiling error:\r\n\r\n      aiohttp/_http_parser.c: In function \u2018__pyx_tp_dealloc_7aiohttp_12_http_parser_HttpParser\u2019:\r\n      aiohttp/_http_parser.c:16227:5: error: lvalue required as increment operand\r\n      16227 |     ++Py_REFCNT(o);\r\n            |     ^~\r\n      aiohttp/_http_parser.c:16229:5: error: lvalue required as decrement operand\r\n      16229 |     --Py_REFCNT(o);\r\n```\r\n```\r\n\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n4.0.0a1\r\n```\r\n\r\n### OS\r\n\r\nLinux\r\n\r\n### Related component\r\n\r\nServer, Client\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6898/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6898/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6897", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6897/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6897/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6897/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6897", "id": 1353061881, "node_id": "I_kwDOAMpNN85QphX5", "number": 6897, "title": "3.8.1: pytest is failing", "user": {"login": "kloczek", "id": 31284574, "node_id": "MDQ6VXNlcjMxMjg0NTc0", "avatar_url": "https://avatars.githubusercontent.com/u/31284574?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kloczek", "html_url": "https://github.com/kloczek", "followers_url": "https://api.github.com/users/kloczek/followers", "following_url": "https://api.github.com/users/kloczek/following{/other_user}", "gists_url": "https://api.github.com/users/kloczek/gists{/gist_id}", "starred_url": "https://api.github.com/users/kloczek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kloczek/subscriptions", "organizations_url": "https://api.github.com/users/kloczek/orgs", "repos_url": "https://api.github.com/users/kloczek/repos", "events_url": "https://api.github.com/users/kloczek/events{/privacy}", "received_events_url": "https://api.github.com/users/kloczek/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-08-27T14:36:09Z", "updated_at": "2022-09-12T12:04:47Z", "closed_at": "2022-09-12T01:32:43Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\npytest is failing in 7 units.\r\n\r\n\r\n### To Reproduce\r\n\r\nAs I'm packaging your module as an rpm package so I'm using the typical PEP517 based build, install and test cycle used on building packages from non-root account.\r\n- `python3 -sBm build -w --no-isolation`\r\n- because I'm calling `build` with `--no-isolation` I'm using during all processes only locally installed modules\r\n- install .whl file in </install/prefix>\r\n- run pytest with PYTHONPATH pointing to sitearch and sitelib inside </install/prefix>\r\n\r\n\r\n### Expected behavior\r\n\r\npytest should not fail.\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nWill include in next comment.\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n3.8.13\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n3.8.1\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n6.0.2\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n1.8.1\r\n```\r\n\r\n\r\n### OS\r\n\r\nLinux x86/64\r\n\r\n### Additional context\r\n\r\nHere is list of installed modules in build env\r\n<details>\r\n\r\n```console\r\nPackage                        Version\r\n------------------------------ -----------------\r\naiosignal                      1.2.0\r\nalabaster                      0.7.12\r\napeye                          1.2.0\r\nappdirs                        1.4.4\r\nasttokens                      2.0.5\r\nasync-generator                1.10\r\nasync-timeout                  4.0.2\r\nattrs                          22.1.0\r\nautodocsumm                    0.2.9\r\nBabel                          2.10.2\r\nbackcall                       0.2.0\r\nbeautifulsoup4                 4.11.1\r\nbleach                         5.0.0\r\nBrlapi                         0.8.3\r\nBrotli                         1.0.9\r\nbuild                          0.8.0\r\nCacheControl                   0.12.11\r\ncharset-normalizer             2.1.0\r\nclick                          8.1.3\r\ncodespell                      2.1.0\r\ncoincidence                    0.6.2\r\nconsolekit                     1.4.1\r\ncoverage                       6.4.4\r\ncssselect                      1.1.0\r\ncssutils                       2.6.0\r\nCython                         0.29.32\r\ndebugpy                        1.6.3\r\ndecorator                      5.1.1\r\ndefusedxml                     0.7.1\r\ndeprecation                    2.1.0\r\ndeprecation-alias              0.3.1\r\ndict2css                       0.3.0\r\ndist-meta                      0.5.0\r\ndistro                         1.7.0\r\ndocutils                       0.18.1\r\ndom_toml                       0.6.0\r\ndomdf-python-tools             3.2.2.post1\r\nentrypoints                    0.4\r\nexecuting                      0.8.3\r\nextras                         1.0.0\r\nextras-require                 0.4.3\r\nFaker                          14.1.0\r\nfastjsonschema                 2.16.1\r\nfixtures                       4.0.0\r\nfreezegun                      1.2.1\r\nfrozenlist                     1.3.1\r\nfuncy                          1.17\r\ngpg                            1.17.1-unknown\r\nhandy-archives                 0.1.2\r\nhtml5lib                       1.1\r\nidna                           3.3\r\nimagesize                      1.4.1\r\nimportlib-metadata             4.12.0\r\nimportlib-resources            5.9.0\r\niniconfig                      1.1.1\r\nipykernel                      6.15.1\r\nipython                        8.4.0\r\nipython-genutils               0.2.0\r\nipywidgets                     7.7.0\r\njedi                           0.18.1\r\nJinja2                         3.1.1\r\njsonschema                     4.13.0\r\njupyter_client                 7.3.5\r\njupyter_core                   4.11.1\r\njupyterlab-pygments            0.1.2\r\njupytext                       1.14.1\r\nlatexcodec                     2.0.1\r\nlibcomps                       0.1.18\r\nlockfile                       0.12.2\r\nlouis                          3.22.0\r\nlxml                           4.9.1\r\nmarkdown-it-py                 2.1.0\r\nMarkupSafe                     2.1.1\r\nmatplotlib-inline              0.1.5\r\nmdit-py-plugins                0.3.0\r\nmdurl                          0.1.1\r\nmistletoe                      0.9.0\r\nmistune                        2.0.3\r\nmsgpack                        1.0.4\r\nmultidict                      6.0.2\r\nnatsort                        8.0.2\r\nnbclient                       0.6.7\r\nnbconvert                      7.0.0\r\nnbformat                       5.4.0\r\nnest-asyncio                   1.5.5\r\nnumpy                          1.23.1\r\npackaging                      21.3\r\npandas                         1.4.2\r\npandocfilters                  1.5.0\r\nparso                          0.8.3\r\npbr                            5.9.0\r\npep517                         0.12.0\r\npexpect                        4.8.0\r\npickleshare                    0.7.5\r\npip                            22.2.1\r\npkgutil_resolve_name           1.3.10\r\nplatformdirs                   2.5.2\r\npluggy                         1.0.0\r\nprompt-toolkit                 3.0.29\r\npsutil                         5.9.0\r\nptyprocess                     0.7.0\r\npure-eval                      0.2.2\r\npy                             1.11.0\r\npybtex                         0.24.0\r\npybtex-docutils                1.0.2\r\nPygments                       2.13.0\r\nPyGObject                      3.42.2\r\npyparsing                      3.0.9\r\npyrsistent                     0.18.1\r\npytest                         7.1.2\r\npytest-cov                     3.0.0\r\npytest-datadir                 1.3.1\r\npytest-mock                    3.8.2\r\npytest-regressions             2.3.1\r\npytest-timeout                 2.1.0\r\npython-dateutil                2.8.2\r\npytz                           2022.1\r\nPyYAML                         6.0\r\npyzmq                          23.2.0\r\nre-assert                      1.1.0\r\nregex                          2022.6.2\r\nrequests                       2.28.1\r\nrpm                            4.17.0\r\nruamel.yaml                    0.17.21\r\nruamel.yaml.clib               0.2.6\r\nscour                          0.38.2\r\nsetuptools                     65.3.0\r\nshippinglabel                  1.4.1\r\nsix                            1.16.0\r\nsnowballstemmer                2.2.0\r\nsoupsieve                      2.3.2.post1\r\nSphinx                         5.1.1\r\nsphinx-autodoc-typehints       1.19.2\r\nsphinx-codeautolink            0.10.0\r\nsphinx-gallery                 0.11.1\r\nsphinx-jinja2-compat           0.1.2\r\nsphinx-last-updated-by-git     0.3.3\r\nsphinx-prompt                  1.4.0\r\nsphinx-pyproject               0.1.0\r\nsphinx-tabs                    3.4.1\r\nsphinx-toolbox                 3.1.2\r\nsphinxcontrib-applehelp        1.0.2.dev20220730\r\nsphinxcontrib-asyncio          0.3.0\r\nsphinxcontrib-bibtex           2.5.0\r\nsphinxcontrib-devhelp          1.0.2.dev20220730\r\nsphinxcontrib-htmlhelp         2.0.0\r\nsphinxcontrib-jsmath           1.0.1.dev20220730\r\nsphinxcontrib-qthelp           1.0.3.dev20220730\r\nsphinxcontrib-serializinghtml  1.1.5\r\nsphinxcontrib-svg2pdfconverter 1.2.0\r\nstack-data                     0.4.0\r\ntabulate                       0.8.9\r\ntesttools                      2.5.0\r\ntinycss2                       1.1.1\r\ntoml                           0.10.2\r\ntomli                          2.0.1\r\ntornado                        6.2\r\ntraitlets                      5.3.0\r\ntyping_extensions              4.2.0\r\nurllib3                        1.26.12\r\nwcwidth                        0.2.5\r\nwebencodings                   0.5.1\r\nwheel                          0.37.1\r\nwidgetsnbextension             4.0.2\r\nyarl                           1.8.1\r\nzipp                           3.8.1\r\n```\r\n</details>\r\n\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6897/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6897/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6885", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6885/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6885/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6885/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6885", "id": 1343161638, "node_id": "I_kwDOAMpNN85QDwUm", "number": 6885, "title": "aiohttp.web has no attribute 'AppKey'", "user": {"login": "fibbo", "id": 1519902, "node_id": "MDQ6VXNlcjE1MTk5MDI=", "avatar_url": "https://avatars.githubusercontent.com/u/1519902?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fibbo", "html_url": "https://github.com/fibbo", "followers_url": "https://api.github.com/users/fibbo/followers", "following_url": "https://api.github.com/users/fibbo/following{/other_user}", "gists_url": "https://api.github.com/users/fibbo/gists{/gist_id}", "starred_url": "https://api.github.com/users/fibbo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fibbo/subscriptions", "organizations_url": "https://api.github.com/users/fibbo/orgs", "repos_url": "https://api.github.com/users/fibbo/repos", "events_url": "https://api.github.com/users/fibbo/events{/privacy}", "received_events_url": "https://api.github.com/users/fibbo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-08-18T14:07:50Z", "updated_at": "2022-08-18T18:28:39Z", "closed_at": "2022-08-18T18:28:39Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nTrying to run the example `web_ws.py` and it fails with\r\n\r\n```\r\n\u279c python web_ws.py\r\nTraceback (most recent call last):\r\n  File \"/Users/philippg/tmp/ws_example/web_ws.py\", line 14, in <module>\r\n    sockets = web.AppKey(\"sockets\", List[web.WebSocketResponse])\r\nAttributeError: module 'aiohttp.web' has no attribute 'AppKey'\r\n```\r\n\r\n```\r\n\u276f pip list aiohttp\r\nPackage            Version\r\n------------------ ---------\r\naiohttp            3.8.1\r\n...\r\n```\n\n### To Reproduce\n\n1. Install `aiohttp` 3.8.1\r\n2. Run `https://github.com/aio-libs/aiohttp/blob/master/examples/web_srv.py`\n\n### Expected behavior\n\nRunning the application without exception\n\n### Logs/tracebacks\n\n```python-traceback\n\u279c python web_ws.py\r\nTraceback (most recent call last):\r\n  File \"/Users/philippg/tmp/ws_example/web_ws.py\", line 14, in <module>\r\n    sockets = web.AppKey(\"sockets\", List[web.WebSocketResponse])\r\nAttributeError: module 'aiohttp.web' has no attribute 'AppKey'\n```\n\n\n### Python Version\n\n```console\n\u279c python --version\r\nPython 3.10.6\n```\n\n\n### aiohttp Version\n\n```console\n\u279c python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.8.1\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor:\r\nAuthor-email:\r\nLicense: Apache 2\r\nLocation: /Users/philippg/venvs/venv/lib/python3.10/site-packages\r\nRequires: aiosignal, async-timeout, attrs, charset-normalizer, frozenlist, multidict, yarl\r\nRequired-by:\n```\n\n\n### multidict Version\n\n```console\n\u279c python -m pip show multidict\r\nName: multidict\r\nVersion: 6.0.2\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/philippg/venvs/venv/lib/python3.10/site-packages\r\nRequires:\r\nRequired-by: aiohttp, yarl\n```\n\n\n### yarl Version\n\n```console\n\u279c python -m pip show yarl\r\nName: yarl\r\nVersion: 1.8.1\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/philippg/venvs/venv/lib/python3.10/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\n```\n\n\n### OS\n\nMacOS Monterey, 12.5\n\n### Related component\n\nServer\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6885/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6885/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6881", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6881/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6881/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6881/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6881", "id": 1337135415, "node_id": "I_kwDOAMpNN85PsxE3", "number": 6881, "title": "We are getting random requests terminations on idling POST", "user": {"login": "mykola-mokhnach", "id": 7767781, "node_id": "MDQ6VXNlcjc3Njc3ODE=", "avatar_url": "https://avatars.githubusercontent.com/u/7767781?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mykola-mokhnach", "html_url": "https://github.com/mykola-mokhnach", "followers_url": "https://api.github.com/users/mykola-mokhnach/followers", "following_url": "https://api.github.com/users/mykola-mokhnach/following{/other_user}", "gists_url": "https://api.github.com/users/mykola-mokhnach/gists{/gist_id}", "starred_url": "https://api.github.com/users/mykola-mokhnach/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mykola-mokhnach/subscriptions", "organizations_url": "https://api.github.com/users/mykola-mokhnach/orgs", "repos_url": "https://api.github.com/users/mykola-mokhnach/repos", "events_url": "https://api.github.com/users/mykola-mokhnach/events{/privacy}", "received_events_url": "https://api.github.com/users/mykola-mokhnach/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2022-08-12T12:16:25Z", "updated_at": "2022-08-20T17:44:41Z", "closed_at": "2022-08-20T17:44:41Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nOur service is behind an API gateway. It server multiple endpoints and they work properly except of the one, which is responsible for file upload. This endpoint supports POST multipart/mixed file uploads, but it also stalls for a while after the request body is fully processed, so the server could process the uploaded file and return a response. \r\nRandomly HTTP clients observe 503 error responses similar to \r\n\r\n```\r\nACCESS [2022-08-12T11:26:17.296Z] \"POST /v1/storage/upload HTTP/1.1\" 503 UC 106754313 95 21212 - \"<ip>\" \"curl/7.29.0\" \"4f094110-cf38-4f45-88fa-c391744e85cb\" \"<host>\" \"<ip>\"\r\n```\r\n\r\n\"UC\" in such case means \"Upstream disconnect\" according to https://blog.getambassador.io/understanding-envoy-proxy-and-ambassador-http-access-logs-fee7802a2ec5\r\n\r\nAnd on the service side the exception is \r\n\r\n```\r\nasyncio.exceptions.CancelledError\r\n```\r\n\r\nInitially this looks like the request is being cancelled by a client, but even when I try to wrap the route handler into asyncio.shield like\r\n\r\n```\r\n    task = asyncio.start_task(yolo())\r\n    try:\r\n        await asyncio.shield(task)\r\n    except asyncio.CancelledError:\r\n        await task\r\n        raise\r\n```\r\n\r\nit still cancels the wrapped task. This does not happen for a \"normal\" client-initiated disconnect, where CancelledError is only raised once.\r\n\r\nThe common pattern for such disconnects is that they all happen when the body is fully fetched by the server and the file payload parsing starts (connection is idling from an HTTP client perspective during this time). I've tried to enable aihttp debug/access log, but to no extent.\r\n\r\n### To Reproduce\r\n\r\nSee above\r\n\r\n### Expected behavior\r\n\r\nSee above\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nSee above\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n$ python --version\r\nPython 3.9.13\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n$ python -m pip show aiohttp\r\n3.8.1\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n$ python -m pip show multidict\r\n6.0.2\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n$ python -m pip show yarl\r\n1.7.2\r\n```\r\n\r\n\r\n### OS\r\n\r\npython:3.9-slim-bullseye\r\n\r\n### Related component\r\n\r\nServer\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6881/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6881/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6868", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6868/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6868/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6868/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6868", "id": 1329037919, "node_id": "I_kwDOAMpNN85PN4Jf", "number": 6868, "title": "https://docs.aiohttp.org/en/stable/client_quickstart.html example is broken", "user": {"login": "Lambda-Logan", "id": 68832147, "node_id": "MDQ6VXNlcjY4ODMyMTQ3", "avatar_url": "https://avatars.githubusercontent.com/u/68832147?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Lambda-Logan", "html_url": "https://github.com/Lambda-Logan", "followers_url": "https://api.github.com/users/Lambda-Logan/followers", "following_url": "https://api.github.com/users/Lambda-Logan/following{/other_user}", "gists_url": "https://api.github.com/users/Lambda-Logan/gists{/gist_id}", "starred_url": "https://api.github.com/users/Lambda-Logan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Lambda-Logan/subscriptions", "organizations_url": "https://api.github.com/users/Lambda-Logan/orgs", "repos_url": "https://api.github.com/users/Lambda-Logan/repos", "events_url": "https://api.github.com/users/Lambda-Logan/events{/privacy}", "received_events_url": "https://api.github.com/users/Lambda-Logan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-08-04T18:36:36Z", "updated_at": "2022-08-04T19:54:11Z", "closed_at": "2022-08-04T19:54:11Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nI'm not sure where to report it, but the very first example on the docs website does not work. It should be `asyncio.run(main( ) ) `\r\n\r\nhttps://docs.aiohttp.org/en/stable/client_quickstart.html \r\n\r\n```\r\nasync def main():\r\n    async with aiohttp.ClientSession() as session:\r\n        async with session.get('http://httpbin.org/get') as resp:\r\n            print(resp.status)\r\n            print(await resp.text())\r\n\r\nasyncio.run(main)\r\n```\n\n### To Reproduce\n\n1. Visit docs page\r\n2. Run very first example\n\n### Expected behavior\n\nIt should print\r\n\r\n```\r\n200\r\n{\r\n  \"args\": {}, \r\n  \"headers\": {\r\n    \"Accept\": \"*/*\", \r\n    \"Accept-Encoding\": \"gzip, deflate\", \r\n    \"Host\": \"httpbin.org\", \r\n    \"User-Agent\": \"Python/3.9 aiohttp/3.8.1\", \r\n    \"X-Amzn-Trace-Id\": \"Root=1-62ec0fe8-538737e330f7eb824723f3c7\"\r\n  }, \r\n  \"origin\": \"72.44.116.142\", \r\n  \"url\": \"http://httpbin.org/get\"\r\n}\r\n\r\n```\n\n### Logs/tracebacks\n\n```python-traceback\n\"/home/linuxbrew/.linuxbrew/Cellar/python@3.9/3.9.13_1/lib/python3.9/asyncio/runners.py\", line 37, in run\r\n    raise ValueError(\"a coroutine was expected, got {!r}\".format(main))\r\nValueError: a coroutine was expected, got <function main at 0x7f0b78e67160>\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\nPython 3.9.13\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.8.1\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: \r\nAuthor-email: \r\nLicense: Apache 2\r\nLocation: /home/logan/.local/lib/python3.9/site-packages\r\nRequires: aiosignal, async-timeout, attrs, charset-normalizer, frozenlist, multidict, yarl\r\nRequired-by: aiohttp-socks\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.7.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/logan/.local/lib/python3.9/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\n```\n\n\n### OS\n\nUbuntu\n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6868/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6868/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6857", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6857/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6857/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6857/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/6857", "id": 1327329503, "node_id": "PR_kwDOAMpNN848lTUz", "number": 6857, "title": "Stop installing cchardet speedup under >Python 3.9", "user": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 58986077, "node_id": "MDU6TGFiZWw1ODk4NjA3Nw==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/enhancement", "name": "enhancement", "color": "84b6eb", "default": true, "description": null}, {"id": 743514498, "node_id": "MDU6TGFiZWw3NDM1MTQ0OTg=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/meta", "name": "meta", "color": "ccf794", "default": false, "description": null}, {"id": 1355573561, "node_id": "MDU6TGFiZWwxMzU1NTczNTYx", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/dependencies", "name": "dependencies", "color": "0025ff", "default": false, "description": "Pull requests that update a dependency file"}, {"id": 1472801557, "node_id": "MDU6TGFiZWwxNDcyODAxNTU3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bot:chronographer:provided", "name": "bot:chronographer:provided", "color": "ededed", "default": false, "description": "There is a change note present in this PR"}, {"id": 2451662697, "node_id": "MDU6TGFiZWwyNDUxNjYyNjk3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/backport-3.8", "name": "backport-3.8", "color": "000000", "default": false, "description": "Trigger automatic backporting to the 3.8 release branch by Patchback robot"}, {"id": 3507377261, "node_id": "LA_kwDOAMpNN87RDlRt", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/backport-3.9", "name": "backport-3.9", "color": "000000", "default": false, "description": "Trigger automatic backporting to the 3.9 release branch by Patchback robot"}], "state": "closed", "locked": false, "assignee": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 5, "created_at": "2022-08-03T14:42:09Z", "updated_at": "2022-08-03T16:17:11Z", "closed_at": "2022-08-03T15:55:32Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/6857", "html_url": "https://github.com/aio-libs/aiohttp/pull/6857", "diff_url": "https://github.com/aio-libs/aiohttp/pull/6857.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/6857.patch", "merged_at": "2022-08-03T15:55:32Z"}, "body": "## What do these changes do?\r\n`cchardet` stopped being maintained a while ago so this patch removes\r\nit from the `speedups` extra to keep it helpful. It also makes the\r\nsame adjustment in the CI under the most recent CPython versions to\r\nkeep the testing going.\r\n\r\n## Are there changes in behavior for the user?\r\n\r\n`pip install aiohttp[speedups]` will only request `cchardet` under CPython < 3.10\r\n\r\n## Related issue number\r\n\r\n* https://github.com/aio-libs/aiohttp/issues/6819#issuecomment-1181603136\r\n* https://github.com/PyYoshi/cChardet/issues/77\r\n\r\n## Checklist\r\n\r\n- [x] I think the code is well written\r\n- [x] Unit tests for the changes exist\r\n- [x] Documentation reflects the changes\r\n- [x] If you provide code modification, please add yourself to `CONTRIBUTORS.txt`\r\n  * The format is &lt;Name&gt; &lt;Surname&gt;.\r\n  * Please keep alphabetical order, the file is sorted by names.\r\n- [x] Add a new news fragment into the `CHANGES` folder\r\n  * name it `<issue_id>.<type>` for example (588.bugfix)\r\n  * if you don't have an `issue_id` change it to the pr id after creating the pr\r\n  * ensure type is one of the following:\r\n    * `.feature`: Signifying a new feature.\r\n    * `.bugfix`: Signifying a bug fix.\r\n    * `.doc`: Signifying a documentation improvement.\r\n    * `.removal`: Signifying a deprecation or removal of public API.\r\n    * `.misc`: A ticket has been closed, but it is not of interest to users.\r\n  * Make sure to use full sentences with correct case and punctuation, for example: \"Fix issue with non-ascii contents in doctest text files.\"\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6857/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6857/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6845", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6845/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6845/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6845/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6845", "id": 1317281513, "node_id": "I_kwDOAMpNN85OhB7p", "number": 6845, "title": "Pyright exception on ClientConnectorSSLError", "user": {"login": "woutercoppens", "id": 7490279, "node_id": "MDQ6VXNlcjc0OTAyNzk=", "avatar_url": "https://avatars.githubusercontent.com/u/7490279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/woutercoppens", "html_url": "https://github.com/woutercoppens", "followers_url": "https://api.github.com/users/woutercoppens/followers", "following_url": "https://api.github.com/users/woutercoppens/following{/other_user}", "gists_url": "https://api.github.com/users/woutercoppens/gists{/gist_id}", "starred_url": "https://api.github.com/users/woutercoppens/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/woutercoppens/subscriptions", "organizations_url": "https://api.github.com/users/woutercoppens/orgs", "repos_url": "https://api.github.com/users/woutercoppens/repos", "events_url": "https://api.github.com/users/woutercoppens/events{/privacy}", "received_events_url": "https://api.github.com/users/woutercoppens/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2022-07-25T19:39:29Z", "updated_at": "2023-02-08T08:50:45Z", "closed_at": "2023-02-08T08:50:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\n```python\r\nimport aiohttp\r\n...\r\n\r\n       except (aiohttp.ClientConnectorSSLError) as exception: \r\n            # Expired certificate / Date ISSUE\r\n            # pylint: disable=bad-exception-context\r\n            raise OpenMoticsConnectionSslError(\r\n                \"Error with SSL certificate.\"\r\n            ) from exception\r\n```\r\n```console\r\npyright 1.1.263\r\n/localgateway.py\r\n  /localgateway.py:157:17 - error: \"Type[ClientConnectorSSLError]\" is not valid exception class\r\n  /localgateway.py:162:20 - error: Expected exception object, exception class or None\r\n  \u00a0\u00a0\"ClientConnectorSSLError\" does not derive from BaseException\r\n```\r\n\r\n### To Reproduce\r\n\r\npip install pyright\r\npyright\r\n\r\n### Expected behavior\r\n\r\nNo error on pyright\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nN/A\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\npython --version\r\nPython 3.10.4\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\npython -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.8.1\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor:\r\nAuthor-email:\r\nLicense: Apache 2\r\nLocation: /home/homeassistant/Devel/homeassistant/core/venv/lib/python3.10/site-packages\r\nRequires: aiosignal, async-timeout, attrs, charset-normalizer, frozenlist, multidict, yarl\r\nRequired-by: aiohttp-cors, aresponses, async-upnp-client, hass-nabucasa, homeassistant, pyhaopenmotics\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\npython -m pip show multidict\r\nName: multidict\r\nVersion: 6.0.2\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/homeassistant/Devel/homeassistant/core/venv/lib/python3.10/site-packages\r\nRequires:\r\nRequired-by: aiohttp, yarl\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\npython -m pip show yarl\r\nName: yarl\r\nVersion: 1.7.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/homeassistant/Devel/homeassistant/core/venv/lib/python3.10/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp, homeassistant, pyhaopenmotics\r\n```\r\n\r\n\r\n### OS\r\n\r\nPop OS Linux (22.4 LTS)\r\n\r\n```\r\n$ cat /etc/lsb-release\r\nDISTRIB_ID=Pop\r\nDISTRIB_RELEASE=22.04\r\nDISTRIB_CODENAME=jammy\r\nDISTRIB_DESCRIPTION=\"Pop!_OS 22.04 LTS\"\r\n```\r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6845/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6845/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6837", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6837/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6837/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6837/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6837", "id": 1312623788, "node_id": "I_kwDOAMpNN85OPQys", "number": 6837, "title": "Threaded resolver threads are live indefinitely", "user": {"login": "Rustik665", "id": 23008933, "node_id": "MDQ6VXNlcjIzMDA4OTMz", "avatar_url": "https://avatars.githubusercontent.com/u/23008933?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rustik665", "html_url": "https://github.com/Rustik665", "followers_url": "https://api.github.com/users/Rustik665/followers", "following_url": "https://api.github.com/users/Rustik665/following{/other_user}", "gists_url": "https://api.github.com/users/Rustik665/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rustik665/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rustik665/subscriptions", "organizations_url": "https://api.github.com/users/Rustik665/orgs", "repos_url": "https://api.github.com/users/Rustik665/repos", "events_url": "https://api.github.com/users/Rustik665/events{/privacy}", "received_events_url": "https://api.github.com/users/Rustik665/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2022-07-21T05:11:45Z", "updated_at": "2022-08-02T17:18:23Z", "closed_at": "2022-08-02T17:18:23Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nWhen aiohttp uses ThreadedResolver, it creates new thread (uses ThreadPoolExecutor) every time for resolve. After finishing http request, these threads are live forever. Thus, the number of threads is constantly growing and leads to the fact that the system triggers a limit on the number of processes per user who launched the program with aionttp.\r\nClosing connections doesn't help. In other words, these threads will live while your program is running.\r\n\r\n### To Reproduce\r\n\r\n1. run a simple python program with aiohttp and without installing aiodns\r\n2. make a loop with http requests, closing connection after each request\r\n3. run a htop in another console\r\n4. filter by your program name and you'll see, that every request forks a new thread, that don't die after request finishes, even if we close connection\r\n\r\n### Expected behavior\r\n\r\nThreads for dns resolving die after request has finished\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nHere is simple script to reproduce, and output:\r\n\r\nimport asyncio\r\nimport aiohttp\r\nimport threading\r\nprint(aiohttp.DefaultResolver)\r\n\r\n\r\nasync def count_threads():\r\n    while True:\r\n        await asyncio.sleep(1)\r\n        print(f'threads count: {len(threading.enumerate())}')\r\n\r\n\r\nasync def make_requests():\r\n    for i in range(10):\r\n        async with aiohttp.ClientSession(timeout=aiohttp.ClientTimeout(total=10)) as session:\r\n            try:\r\n                async with session.get('https://www.google.ru') as response:\r\n                    await response.text()\r\n            except Exception as ex:\r\n                print(f'exc: {ex}')\r\n\r\n    print('requests have finished!')\r\n    for thread in threading.enumerate():\r\n        print(thread)\r\n\r\n\r\nasyncio.get_event_loop().run_until_complete(asyncio.gather(count_threads(), make_requests()))\r\n\r\n\r\n\r\nOutput:\r\n\r\n/opt/python3.7/bin/python3.7 /home/local/REGION/rr.fayzullin/PycharmProjects/TEST/test3.py\r\n<class 'aiohttp.resolver.ThreadedResolver'>\r\nthreads count: 5\r\nthreads count: 9\r\nrequests have finished!\r\n<_MainThread(MainThread, started 139807779043136)>\r\n<Thread(ThreadPoolExecutor-0_0, started daemon 139807493482240)>\r\n<Thread(ThreadPoolExecutor-0_1, started daemon 139807478413056)>\r\n<Thread(ThreadPoolExecutor-0_2, started daemon 139807470020352)>\r\n<Thread(ThreadPoolExecutor-0_3, started daemon 139807461627648)>\r\n<Thread(ThreadPoolExecutor-0_4, started daemon 139807453234944)>\r\n<Thread(ThreadPoolExecutor-0_5, started daemon 139807444842240)>\r\n<Thread(ThreadPoolExecutor-0_6, started daemon 139807436449536)>\r\n<Thread(ThreadPoolExecutor-0_7, started daemon 139806956844800)>\r\n<Thread(ThreadPoolExecutor-0_8, started daemon 139806948452096)>\r\n<Thread(ThreadPoolExecutor-0_9, started daemon 139806940059392)>\r\nthreads count: 11\r\nthreads count: 11\r\nthreads count: 11\r\nthreads count: 11\r\nthreads count: 11\r\nthreads count: 11\r\nTraceback (most recent call last):\r\n  File \"/home/local/REGION/rr.fayzullin/PycharmProjects/TEST/test3.py\", line 33, in <module>\r\n    asyncio.get_event_loop().run_until_complete(asyncio.gather(count_threads(), make_requests()))\r\n  File \"/opt/python3.7/lib64/python3.7/asyncio/base_events.py\", line 571, in run_until_complete\r\n    self.run_forever()\r\n  File \"/opt/python3.7/lib64/python3.7/asyncio/base_events.py\", line 539, in run_forever\r\n    self._run_once()\r\n  File \"/opt/python3.7/lib64/python3.7/asyncio/base_events.py\", line 1739, in _run_once\r\n    event_list = self._selector.select(timeout)\r\n  File \"/opt/python3.7/lib64/python3.7/selectors.py\", line 468, in select\r\n    fd_event_list = self._selector.poll(timeout, max_ev)\r\nKeyboardInterrupt\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n$ python --version\r\nPython 3.7.3\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.8.1\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: \r\nAuthor-email: \r\nLicense: Apache 2\r\nLocation: /home/local/REGION/rr.fayzullin/.local/lib/python3.7/site-packages\r\nRequires: aiosignal, async-timeout, asynctest, attrs, charset-normalizer, frozenlist, multidict, typing-extensions, yarl\r\nRequired-by: aioswagger11\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.6\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/local/REGION/rr.fayzullin/.local/lib/python3.7/site-packages\r\nRequires: \r\nRequired-by: aiohttp, yarl\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.0\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/local/REGION/rr.fayzullin/.local/lib/python3.7/site-packages\r\nRequires: idna, multidict, typing-extensions\r\nRequired-by: aiohttp\r\n```\r\n\r\n\r\n### OS\r\n\r\nCentOS 7 3.10.0-1127.18.2.el7.x86_64\r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6837/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6837/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6828", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6828/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6828/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6828/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6828", "id": 1307081227, "node_id": "I_kwDOAMpNN85N6HoL", "number": 6828, "title": "SSL verification is skipped even if ssl == True", "user": {"login": "huang-ann", "id": 104561740, "node_id": "U_kgDOBjt8TA", "avatar_url": "https://avatars.githubusercontent.com/u/104561740?v=4", "gravatar_id": "", "url": "https://api.github.com/users/huang-ann", "html_url": "https://github.com/huang-ann", "followers_url": "https://api.github.com/users/huang-ann/followers", "following_url": "https://api.github.com/users/huang-ann/following{/other_user}", "gists_url": "https://api.github.com/users/huang-ann/gists{/gist_id}", "starred_url": "https://api.github.com/users/huang-ann/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/huang-ann/subscriptions", "organizations_url": "https://api.github.com/users/huang-ann/orgs", "repos_url": "https://api.github.com/users/huang-ann/repos", "events_url": "https://api.github.com/users/huang-ann/events{/privacy}", "received_events_url": "https://api.github.com/users/huang-ann/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-07-17T12:19:16Z", "updated_at": "2022-07-17T14:35:15Z", "closed_at": "2022-07-17T14:34:13Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nWhen I tried to connect host without ssl verification, I learned that I could set `ssl` as `False` to skip verification from [this doc](https://docs.aiohttp.org/en/stable/client_reference.html).\r\n\r\nHowever, I found that ssl verification would be skipped even if I set `ssl` to `True`. Since the deprecated `verify_ssl` worked as I expected, it seems that there are bugs in `ssl`.\r\n\r\n| Parameter | True       | False | None (default) |\r\n|-----------|---------|------|----------------|\r\n| ssl              | skip        | skip  | not skip            |\r\n|verify_ssl    | not skip | skip  | not skip            |\r\n\r\nBTW, I also hope that the bug mentioned in this issue (https://github.com/aio-libs/aiohttp/issues/4099) could be addressed!\r\n\r\n### To Reproduce\r\n\r\n1. Enter `python` in terminal to test in interactive mode\r\n2. Use the following script, which is based on the examples in aiohttp doc\r\n```python\r\nimport asyncio\r\nimport aiohttp\r\n\r\nasync def main(ssl):\r\n    async with aiohttp.ClientSession() as session:\r\n        async with session.get(url='https://self-signed.badssl.com/', ssl=ssl) as resp:\r\n            print(resp.status)\r\n            print(await resp.text())\r\n\r\nasyncio.run(main(True))\r\n```\r\n\r\n### Expected behavior\r\n\r\nSince the website (https://self-signed.badssl.com/) is self-signed, I expect there are some errors occur. However, it works well. I will provide the logs when `ssl == True` and `ssl == None`, which I expect would be the same, in the following.\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\n1. ssl == True\r\n200\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n  <meta charset=\"utf-8\">\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\r\n  <link rel=\"shortcut icon\" href=\"/icons/favicon-red.ico\"/>\r\n  <link rel=\"apple-touch-icon\" href=\"/icons/icon-red.png\"/>\r\n  <title>self-signed.badssl.com</title>\r\n  <link rel=\"stylesheet\" href=\"/style.css\">\r\n  <style>body { background: red; }</style>\r\n</head>\r\n<body>\r\n<div id=\"content\">\r\n  <h1 style=\"font-size: 12vw;\">\r\n    self-signed.<br>badssl.com\r\n  </h1>\r\n</div>\r\n\r\n</body>\r\n</html>\r\n\r\n2. ssl == None\r\nTraceback (most recent call last):\r\n  File \"/Users/ann.huang/.pyenv/versions/aiqua-intel-backend/lib/python3.9/site-packages/aiohttp/connector.py\", line 986, in _wrap_create_connection\r\n    return await self._loop.create_connection(*args, **kwargs)  # type: ignore[return-value]  # noqa\r\n  File \"/Users/ann.huang/.pyenv/versions/3.9.6/lib/python3.9/asyncio/base_events.py\", line 1081, in create_connection\r\n    transport, protocol = await self._create_connection_transport(\r\n  File \"/Users/ann.huang/.pyenv/versions/3.9.6/lib/python3.9/asyncio/base_events.py\", line 1111, in _create_connection_transport\r\n    await waiter\r\n  File \"/Users/ann.huang/.pyenv/versions/3.9.6/lib/python3.9/asyncio/sslproto.py\", line 528, in data_received\r\n    ssldata, appdata = self._sslpipe.feed_ssldata(data)\r\n  File \"/Users/ann.huang/.pyenv/versions/3.9.6/lib/python3.9/asyncio/sslproto.py\", line 188, in feed_ssldata\r\n    self._sslobj.do_handshake()\r\n  File \"/Users/ann.huang/.pyenv/versions/3.9.6/lib/python3.9/ssl.py\", line 944, in do_handshake\r\n    self._sslobj.do_handshake()\r\nssl.SSLCertVerificationError: [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: self signed certificate (_ssl.c:1129)\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/Users/ann.huang/.pyenv/versions/3.9.6/lib/python3.9/asyncio/runners.py\", line 44, in run\r\n    return loop.run_until_complete(main)\r\n  File \"/Users/ann.huang/.pyenv/versions/3.9.6/lib/python3.9/asyncio/base_events.py\", line 642, in run_until_complete\r\n    return future.result()\r\n  File \"<stdin>\", line 3, in main\r\n  File \"/Users/ann.huang/.pyenv/versions/aiqua-intel-backend/lib/python3.9/site-packages/aiohttp/client.py\", line 1138, in __aenter__\r\n    self._resp = await self._coro\r\n  File \"/Users/ann.huang/.pyenv/versions/aiqua-intel-backend/lib/python3.9/site-packages/aiohttp/client.py\", line 535, in _request\r\n    conn = await self._connector.connect(\r\n  File \"/Users/ann.huang/.pyenv/versions/aiqua-intel-backend/lib/python3.9/site-packages/aiohttp/connector.py\", line 542, in connect\r\n    proto = await self._create_connection(req, traces, timeout)\r\n  File \"/Users/ann.huang/.pyenv/versions/aiqua-intel-backend/lib/python3.9/site-packages/aiohttp/connector.py\", line 907, in _create_connection\r\n    _, proto = await self._create_direct_connection(req, traces, timeout)\r\n  File \"/Users/ann.huang/.pyenv/versions/aiqua-intel-backend/lib/python3.9/site-packages/aiohttp/connector.py\", line 1206, in _create_direct_connection\r\n    raise last_exc\r\n  File \"/Users/ann.huang/.pyenv/versions/aiqua-intel-backend/lib/python3.9/site-packages/aiohttp/connector.py\", line 1175, in _create_direct_connection\r\n    transp, proto = await self._wrap_create_connection(\r\n  File \"/Users/ann.huang/.pyenv/versions/aiqua-intel-backend/lib/python3.9/site-packages/aiohttp/connector.py\", line 988, in _wrap_create_connection\r\n    raise ClientConnectorCertificateError(req.connection_key, exc) from exc\r\naiohttp.client_exceptions.ClientConnectorCertificateError: Cannot connect to host self-signed.badssl.com:443 ssl:True [SSLCertVerificationError: (1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: self signed certificate (_ssl.c:1129)')]\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n3.9.6\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n3.8.1\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n6.0.2\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n1.7.2\r\n```\r\n\r\n\r\n### OS\r\n\r\nmacOS\r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6828/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6828/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6813", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6813/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6813/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6813/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6813", "id": 1293311408, "node_id": "I_kwDOAMpNN85NFl2w", "number": 6813, "title": "session.get() proxy kwarg as a function is making requests timeout?", "user": {"login": "johndoeisabro", "id": 68341705, "node_id": "MDQ6VXNlcjY4MzQxNzA1", "avatar_url": "https://avatars.githubusercontent.com/u/68341705?v=4", "gravatar_id": "", "url": "https://api.github.com/users/johndoeisabro", "html_url": "https://github.com/johndoeisabro", "followers_url": "https://api.github.com/users/johndoeisabro/followers", "following_url": "https://api.github.com/users/johndoeisabro/following{/other_user}", "gists_url": "https://api.github.com/users/johndoeisabro/gists{/gist_id}", "starred_url": "https://api.github.com/users/johndoeisabro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/johndoeisabro/subscriptions", "organizations_url": "https://api.github.com/users/johndoeisabro/orgs", "repos_url": "https://api.github.com/users/johndoeisabro/repos", "events_url": "https://api.github.com/users/johndoeisabro/events{/privacy}", "received_events_url": "https://api.github.com/users/johndoeisabro/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-07-04T15:25:25Z", "updated_at": "2022-07-04T15:48:09Z", "closed_at": "2022-07-04T15:48:09Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nI was making a small test program for proxies, and 99% of the requests were timing out for some reason.\r\nHere is the code passing in q.get_nowait() as the proxy kwarg:\r\n```\r\n\r\n    import aiohttp,asyncio,requests,collections\r\n    import random\r\n    proxies = ['http://' +proxy for proxy in requests.get('https://raw.githubusercontent.com/TheSpeedX/PROXY-List/master/http.txt').text.split('\\n')]\r\n    random.shuffle(proxies)\r\n    statuses = collections.Counter()\r\n    \r\n    \r\n    \r\n    async def make_request(session,proxies_queue):\r\n        url = 'https://google.com'\r\n        try:\r\n            #proxy = proxies_queue.get_nowait()\r\n            async with session.get(url,proxy = proxies_queue.get_nowait()) as resp:\r\n                statuses[resp.status]+=1\r\n                print('status')\r\n        except Exception as e:\r\n            print(f'Exception: {e}')\r\n            statuses['exception']+=1\r\n    \r\n    async def make_requests(n,delay):\r\n        proxies_queue = asyncio.Queue()\r\n        for proxy in proxies:\r\n            proxies_queue.put_nowait(proxy)\r\n        tasks = []\r\n        timeout = aiohttp.ClientTimeout(total=10)\r\n        async with aiohttp.ClientSession(timeout=timeout) as session:\r\n            for i in range(n):\r\n                tasks.append(asyncio.create_task(make_request(session,proxies_queue)))\r\n                await asyncio.sleep(delay)\r\n            for task in asyncio.as_completed(tasks):\r\n                await task\r\n    \r\n    asyncio.run(make_requests(100,0.2))\r\n```\r\nIf you uncomment the comment above it and pass in proxy as the kwarg it suddenly works.\r\n\n\n### To Reproduce\n\n1. Make a session with ClientSession\r\n2. Get proxies in a queue\r\n3. Pass queue.get_nowait() or await queue.get() as proxy kwarg\r\n4. Requests are all timeouts or another exception\r\n\n\n### Expected behavior\n\nThe proxy kwarg should call the function for a value\n\n### Logs/tracebacks\n\n```python-traceback\nException: Server disconnected\r\nstatus\r\nException: 400, message='Bad Request', url=URL('http://5.252.161.48:3128')\r\nException: 400, message='Bad Request', url=URL('http://5.252.161.48:8080')\r\nException: Cannot connect to host 165.227.203.140:7497 ssl:default [Connect call failed ('165.227.203.140', 7497)]\r\nException: Server disconnected\r\nException: 400, message='Bad Request', url=URL('http://139.162.78.109:8080')\r\nException: \r\nException: \r\nException: Cannot connect to host 157.230.34.152:43861 ssl:default [Connect call failed ('157.230.34.152', 43861)]\r\nException: 400, message='Bad Request', url=URL('http://103.148.178.228:80')\r\nException: Cannot connect to host google.com:443 ssl:default [None]\r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: [WinError 10054] An existing connection was forcibly closed by the remote host\r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: Cannot connect to host 188.244.76.135:8000 ssl:default [Connect call failed ('188.244.76.135', 8000)]\r\nstatus\r\nException: \r\nException: \r\nException: \r\nException: \r\nException: Cannot connect to host 157.230.241.133:33381 ssl:default [Connect call failed ('157.230.241.133', 33381)]\r\nException: \r\nException: \r\nException: \r\nException: \r\nException: Cannot connect to host 185.14.255.106:7497 ssl:default [Connect call failed ('185.14.255.106', 7497)]\r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException: \r\nException:\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\nPython 3.7.7\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\n\r\nVersion: 3.8.1\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\n\r\nVersion: 6.0.2\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nVersion: 1.7.2\n```\n\n\n### OS\n\nWindows 7\n\n### Related component\n\nClient\n\n### Additional context\n\nPyCharm\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6813/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6813/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6801", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6801/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6801/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6801/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6801", "id": 1284602066, "node_id": "I_kwDOAMpNN85MkXjS", "number": 6801, "title": "pip-audit flagging aiohttp: https://github.com/advisories/GHSA-rwqr-c348-m5wr", "user": {"login": "jrobbins-LiveData", "id": 79278744, "node_id": "MDQ6VXNlcjc5Mjc4NzQ0", "avatar_url": "https://avatars.githubusercontent.com/u/79278744?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jrobbins-LiveData", "html_url": "https://github.com/jrobbins-LiveData", "followers_url": "https://api.github.com/users/jrobbins-LiveData/followers", "following_url": "https://api.github.com/users/jrobbins-LiveData/following{/other_user}", "gists_url": "https://api.github.com/users/jrobbins-LiveData/gists{/gist_id}", "starred_url": "https://api.github.com/users/jrobbins-LiveData/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jrobbins-LiveData/subscriptions", "organizations_url": "https://api.github.com/users/jrobbins-LiveData/orgs", "repos_url": "https://api.github.com/users/jrobbins-LiveData/repos", "events_url": "https://api.github.com/users/jrobbins-LiveData/events{/privacy}", "received_events_url": "https://api.github.com/users/jrobbins-LiveData/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 29, "created_at": "2022-06-25T13:32:08Z", "updated_at": "2022-11-28T20:59:36Z", "closed_at": "2022-11-22T11:02:05Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\n[pip-audit ](https://pypi.org/project/pip-audit/) is flagging `aiohttp` as having a `Moderate` vulnerability, apparently due to https://github.com/aio-libs/aiohttp/issues/6772.\r\n\r\nFound 1 known vulnerability in 1 package\r\nName    Version ID                  Fix Versions\r\n------- ------- ------------------- ------------\r\naiohttp 3.8.1   GHSA-rwqr-c348-m5wr\n\n### To Reproduce\n\n1. Install latest `pip-audit`\r\n2. run it (e.g. `pip-audit`) in an environment that has the latest `aiohttp` installed\n\n### Expected behavior\n\nThe `pip-audit` results should not flag `aiohttp` as having a security vulnerability.\n\n### Logs/tracebacks\n\n```python-traceback\nFound 1 known vulnerability in 1 package\r\nName    Version ID                  Fix Versions\r\n------- ------- ------------------- ------------\r\naiohttp 3.8.1   GHSA-rwqr-c348-m5wr\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\n\r\nPython 3.9.12\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\n\r\nName: aiohttp\r\nVersion: 3.8.1\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor:\r\nAuthor-email:\r\nLicense: Apache 2\r\nLocation: c:\\users\\jeff1\\documents\\projects\\git\\config-extension\\.venv\\lib\\site-packages\r\nRequires: aiosignal, async-timeout, attrs, charset-normalizer, frozenlist, multidict, yarl\r\nRequired-by: aioresponses, config-extension, extension-base\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\n\r\nName: multidict\r\nVersion: 6.0.2\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\users\\jeff1\\documents\\projects\\git\\config-extension\\.venv\\lib\\site-packages\r\nRequires:\r\nRequired-by: aiohttp, yarl\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\n\r\nName: yarl\r\nVersion: 1.7.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\users\\jeff1\\documents\\projects\\git\\config-extension\\.venv\\lib\\site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\n```\n\n\n### OS\n\nEdition\tWindows 10 Pro\r\nVersion\t21H2\r\nInstalled on\t\u200e5/\u200e1/\u200e2021\r\nOS build\t19044.1766\r\nExperience\tWindows Feature Experience Pack 120.2212.4180.0\r\n\n\n### Related component\n\nServer, Client\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6801/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 1, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6801/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6794", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6794/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6794/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6794/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6794", "id": 1276177538, "node_id": "I_kwDOAMpNN85MEOyC", "number": 6794, "title": "TypeError: function() argument 'code' must be code, not str", "user": {"login": "KINGMOHIT", "id": 103020687, "node_id": "U_kgDOBiP4jw", "avatar_url": "https://avatars.githubusercontent.com/u/103020687?v=4", "gravatar_id": "", "url": "https://api.github.com/users/KINGMOHIT", "html_url": "https://github.com/KINGMOHIT", "followers_url": "https://api.github.com/users/KINGMOHIT/followers", "following_url": "https://api.github.com/users/KINGMOHIT/following{/other_user}", "gists_url": "https://api.github.com/users/KINGMOHIT/gists{/gist_id}", "starred_url": "https://api.github.com/users/KINGMOHIT/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/KINGMOHIT/subscriptions", "organizations_url": "https://api.github.com/users/KINGMOHIT/orgs", "repos_url": "https://api.github.com/users/KINGMOHIT/repos", "events_url": "https://api.github.com/users/KINGMOHIT/events{/privacy}", "received_events_url": "https://api.github.com/users/KINGMOHIT/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2022-06-19T22:04:36Z", "updated_at": "2022-10-19T07:28:46Z", "closed_at": "2022-07-11T16:37:34Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nclass CeilTimeout(async_timeout.timeout):\r\n\r\n\r\n    def __enter__(self) -> async_timeout.timeout:\r\n        if self._timeout is not None:\r\n            self._task = current_task(loop=self._loop)\r\n            if self._task is None:\r\n                raise RuntimeError(\r\n                    'Timeout context manager should be used inside a task')\r\n            self._cancel_handler = self._loop.call_at(\r\n                ceil(self._loop.time() + self._timeout), self._cancel_task)\r\n        return self\r\n\r\nHere, on  class line, it gives me  TypeError: function() argument 'code' must be code, not str\n\n### To Reproduce\n\nimport python_weather\n\n### Expected behavior\n\nI am sure but at last it should forecast weather which works fine on windows but gives error on android\n\n### Logs/tracebacks\n\n```python-traceback\n06-19 15:59:58.408  6609  6645 I python  :    File \"/mnt/d/girlchat1/.buildozer/android/app/main.py\", line 74, in <module>\r\n06-19 15:59:58.410  6609  6645 I python  :    File \"/mnt/d/girlchat1/.buildozer/android/platform/build-arm64-v8a_armeabi-v7a/build/python-installs/Olivia/armeabi-v7a/python_weather/__init__.py\", line 28, in <module>\r\n06-19 15:59:58.411  6609  6645 I python  :    File \"/mnt/d/girlchat1/.buildozer/android/platform/build-arm64-v8a_armeabi-v7a/build/python-installs/Olivia/armeabi-v7a/python_weather/client.py\", line 1, in <module>\r\n06-19 15:59:58.412  6609  6645 I python  :    File \"/mnt/d/girlchat1/.buildozer/android/platform/build-arm64-v8a_armeabi-v7a/build/python-installs/Olivia/armeabi-v7a/python_weather/rest.py\", line 3, in <module>\r\n06-19 15:59:58.420  6609  6645 I python  :    File \"/mnt/d/girlchat1/.buildozer/android/platform/build-arm64-v8a_armeabi-v7a/build/python-installs/Olivia/armeabi-v7a/aiohttp/__init__.py\", line 6, in <module>\r\n06-19 15:59:58.421  6609  6645 I python  :    File \"/mnt/d/girlchat1/.buildozer/android/platform/build-arm64-v8a_armeabi-v7a/build/python-installs/Olivia/armeabi-v7a/aiohttp/client.py\", line 32, in <module>\r\n06-19 15:59:58.422  6609  6645 I python  :    File \"/mnt/d/girlchat1/.buildozer/android/platform/build-arm64-v8a_armeabi-v7a/build/python-installs/Olivia/armeabi-v7a/aiohttp/http.py\", line 7, in <module>\r\n06-19 15:59:58.423  6609  6645 I python  :    File \"/mnt/d/girlchat1/.buildozer/android/platform/build-arm64-v8a_armeabi-v7a/build/python-installs/Olivia/armeabi-v7a/aiohttp/http_parser.py\", line 15, in <module>\r\n06-19 15:59:58.424  6609  6645 I python  :    File \"/mnt/d/girlchat1/.buildozer/android/platform/build-arm64-v8a_armeabi-v7a/build/python-installs/Olivia/armeabi-v7a/aiohttp/helpers.py\", line 607, in <module>\n```\n\n\n### Python Version\n\n```console\nPython 3.9.0\n```\n\n\n### aiohttp Version\n\n```console\nVersion: 3.8.1\n```\n\n\n### multidict Version\n\n```console\nVersion: 6.0.2\n```\n\n\n### yarl Version\n\n```console\n1.7.2\n```\n\n\n### OS\n\nandroid\n\n### Related component\n\nClient\n\n### Additional context\n\nhttps://stackoverflow.com/questions/72676144/typeerror-function-argument-code-must-be-code-not-str/72676439?noredirect=1#comment128378227_72676439\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6794/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6794/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6788", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6788/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6788/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6788/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6788", "id": 1268736017, "node_id": "I_kwDOAMpNN85Ln2AR", "number": 6788, "title": "`cchardet` doesn't seem to work on python 3.10", "user": {"login": "Encryptize", "id": 46298681, "node_id": "MDQ6VXNlcjQ2Mjk4Njgx", "avatar_url": "https://avatars.githubusercontent.com/u/46298681?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Encryptize", "html_url": "https://github.com/Encryptize", "followers_url": "https://api.github.com/users/Encryptize/followers", "following_url": "https://api.github.com/users/Encryptize/following{/other_user}", "gists_url": "https://api.github.com/users/Encryptize/gists{/gist_id}", "starred_url": "https://api.github.com/users/Encryptize/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Encryptize/subscriptions", "organizations_url": "https://api.github.com/users/Encryptize/orgs", "repos_url": "https://api.github.com/users/Encryptize/repos", "events_url": "https://api.github.com/users/Encryptize/events{/privacy}", "received_events_url": "https://api.github.com/users/Encryptize/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-06-12T23:55:50Z", "updated_at": "2023-03-22T14:20:32Z", "closed_at": "2022-06-13T00:02:09Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\n`aiohttp[speedups]` cannot be installed on python 3.10 because `cChardet 2.1.7` does not work on this python version. \r\nhttps://github.com/PyYoshi/cChardet/issues/77\r\n\r\n\n\n### To Reproduce\n\n1. Run `pip install aiohttp[speedups]` with python 3.10\r\n\r\n2. An error occurs\n\n### Expected behavior\n\nJust installing `aiohttp[speedups]` without issue. \n\n### Logs/tracebacks\n\n```python-traceback\n$ pip install aiohttp[speedups]\r\nCollecting aiohttp[speedups]\r\n  Using cached aiohttp-3.8.1-cp310-cp310-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_12_x86_64.manylinux2010_x86_64.whl (1.2 MB)\r\nCollecting charset-normalizer<3.0,>=2.0\r\n  Using cached charset_normalizer-2.0.12-py3-none-any.whl (39 kB)\r\nCollecting async-timeout<5.0,>=4.0.0a3\r\n  Using cached async_timeout-4.0.2-py3-none-any.whl (5.8 kB)\r\nCollecting aiosignal>=1.1.2\r\n  Using cached aiosignal-1.2.0-py3-none-any.whl (8.2 kB)\r\nCollecting multidict<7.0,>=4.5\r\n  Using cached multidict-6.0.2-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (114 kB)\r\nCollecting frozenlist>=1.1.1\r\n  Using cached frozenlist-1.3.0-cp310-cp310-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl (157 kB)\r\nCollecting attrs>=17.3.0\r\n  Using cached attrs-21.4.0-py2.py3-none-any.whl (60 kB)\r\nCollecting yarl<2.0,>=1.0\r\n  Using cached yarl-1.7.2-cp310-cp310-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_12_x86_64.manylinux2010_x86_64.whl (305 kB)\r\nCollecting aiodns\r\n  Using cached aiodns-3.0.0-py3-none-any.whl (5.0 kB)\r\nCollecting Brotli\r\n  Using cached Brotli-1.0.9-cp310-cp310-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_12_x86_64.manylinux2010_x86_64.whl (2.7 MB)\r\nCollecting cchardet\r\n  Using cached cchardet-2.1.7.tar.gz (653 kB)\r\n  Preparing metadata (setup.py) ... done\r\nCollecting idna>=2.0\r\n  Using cached idna-3.3-py3-none-any.whl (61 kB)\r\nCollecting pycares>=4.0.0\r\n  Using cached pycares-4.1.2-cp310-cp310-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_12_x86_64.manylinux2010_x86_64.whl (291 kB)\r\nCollecting cffi>=1.5.0\r\n  Using cached cffi-1.15.0-cp310-cp310-manylinux_2_12_x86_64.manylinux2010_x86_64.whl (446 kB)\r\nCollecting pycparser\r\n  Using cached pycparser-2.21-py2.py3-none-any.whl (118 kB)\r\nBuilding wheels for collected packages: cchardet\r\n  Building wheel for cchardet (setup.py) ... error\r\n  error: subprocess-exited-with-error\r\n\r\n  \u00d7 python setup.py bdist_wheel did not run successfully.\r\n  \u2502 exit code: 1\r\n  \u2570\u2500> [21 lines of output]\r\n      running bdist_wheel\r\n      running build\r\n      running build_py\r\n      creating build\r\n      creating build/lib.linux-x86_64-3.10\r\n      creating build/lib.linux-x86_64-3.10/cchardet\r\n      copying src/cchardet/version.py -> build/lib.linux-x86_64-3.10/cchardet\r\n      copying src/cchardet/__init__.py -> build/lib.linux-x86_64-3.10/cchardet\r\n      running build_ext\r\n      building 'cchardet._cchardet' extension\r\n      creating build/temp.linux-x86_64-3.10\r\n      creating build/temp.linux-x86_64-3.10/src\r\n      creating build/temp.linux-x86_64-3.10/src/cchardet\r\n      creating build/temp.linux-x86_64-3.10/src/ext\r\n      creating build/temp.linux-x86_64-3.10/src/ext/uchardet\r\n      creating build/temp.linux-x86_64-3.10/src/ext/uchardet/src\r\n      creating build/temp.linux-x86_64-3.10/src/ext/uchardet/src/LangModels\r\n      x86_64-linux-gnu-gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O2 -Wall -g -fstack-protector-strong -Wformat -Werror=format-security -g -fwrapv -O2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -fPIC -Isrc/ext/uchardet/src -I/home/rjakub/sandbox/aiohttp/venv/include -I/usr/include/python3.10 -c src/cchardet/_cchardet.cpp -o build/temp.linux-x86_64-3.10/src/cchardet/_cchardet.o\r\n      x86_64-linux-gnu-gcc: fatal error: cannot execute \u2018cc1plus\u2019: execvp: No such file or directory\r\n      compilation terminated.\r\n      error: command '/usr/bin/x86_64-linux-gnu-gcc' failed with exit code 1\r\n      [end of output]\r\n\r\n  note: This error originates from a subprocess, and is likely not a problem with pip.\r\n  ERROR: Failed building wheel for cchardet\r\n  Running setup.py clean for cchardet\r\nFailed to build cchardet\r\nInstalling collected packages: cchardet, Brotli, pycparser, multidict, idna, frozenlist, charset-normalizer, attrs, async-timeout, yarl, cffi, aiosignal, pycares, aiohttp, aiodns\r\n  Running setup.py install for cchardet ... error\r\n  error: subprocess-exited-with-error\r\n\r\n  \u00d7 Running setup.py install for cchardet did not run successfully.\r\n  \u2502 exit code: 1\r\n  \u2570\u2500> [23 lines of output]\r\n      running install\r\n      /home/rjakub/sandbox/aiohttp/venv/lib/python3.10/site-packages/setuptools/command/install.py:34: SetuptoolsDeprecationWarning: setup.py install is deprecated. Use build and pip and other standards-based tools.\r\n        warnings.warn(\r\n      running build\r\n      running build_py\r\n      creating build\r\n      creating build/lib.linux-x86_64-3.10\r\n      creating build/lib.linux-x86_64-3.10/cchardet\r\n      copying src/cchardet/version.py -> build/lib.linux-x86_64-3.10/cchardet\r\n      copying src/cchardet/__init__.py -> build/lib.linux-x86_64-3.10/cchardet\r\n      running build_ext\r\n      building 'cchardet._cchardet' extension\r\n      creating build/temp.linux-x86_64-3.10\r\n      creating build/temp.linux-x86_64-3.10/src\r\n      creating build/temp.linux-x86_64-3.10/src/cchardet\r\n      creating build/temp.linux-x86_64-3.10/src/ext\r\n      creating build/temp.linux-x86_64-3.10/src/ext/uchardet\r\n      creating build/temp.linux-x86_64-3.10/src/ext/uchardet/src\r\n      creating build/temp.linux-x86_64-3.10/src/ext/uchardet/src/LangModels\r\n      x86_64-linux-gnu-gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O2 -Wall -g -fstack-protector-strong -Wformat -Werror=format-security -g -fwrapv -O2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -fPIC -Isrc/ext/uchardet/src -I/home/rjakub/sandbox/aiohttp/venv/include -I/usr/include/python3.10 -c src/cchardet/_cchardet.cpp -o build/temp.linux-x86_64-3.10/src/cchardet/_cchardet.o\r\n      x86_64-linux-gnu-gcc: fatal error: cannot execute \u2018cc1plus\u2019: execvp: No such file or directory\r\n      compilation terminated.\r\n      error: command '/usr/bin/x86_64-linux-gnu-gcc' failed with exit code 1\r\n      [end of output]\r\n\r\n  note: This error originates from a subprocess, and is likely not a problem with pip.\r\nerror: legacy-install-failure\r\n\r\n\u00d7 Encountered error while trying to install package.\r\n\u2570\u2500> cchardet\r\n\r\nnote: This is an issue with the package mentioned above, not pip.\r\nhint: See above for output from the failure.\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\nPython 3.10.4\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\nWARNING: Package(s) not found: aiohttp\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\nWARNING: Package(s) not found: multidict\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nWARNING: Package(s) not found: yarl\n```\n\n\n### OS\n\nUbuntu 22.04\n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6788/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6788/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6783", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6783/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6783/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6783/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6783", "id": 1266029463, "node_id": "I_kwDOAMpNN85LdhOX", "number": 6783, "title": "set_wakeup_fd only works in main thread", "user": {"login": "Timtaran", "id": 60805088, "node_id": "MDQ6VXNlcjYwODA1MDg4", "avatar_url": "https://avatars.githubusercontent.com/u/60805088?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Timtaran", "html_url": "https://github.com/Timtaran", "followers_url": "https://api.github.com/users/Timtaran/followers", "following_url": "https://api.github.com/users/Timtaran/following{/other_user}", "gists_url": "https://api.github.com/users/Timtaran/gists{/gist_id}", "starred_url": "https://api.github.com/users/Timtaran/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Timtaran/subscriptions", "organizations_url": "https://api.github.com/users/Timtaran/orgs", "repos_url": "https://api.github.com/users/Timtaran/repos", "events_url": "https://api.github.com/users/Timtaran/events{/privacy}", "received_events_url": "https://api.github.com/users/Timtaran/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-06-09T12:03:52Z", "updated_at": "2022-06-09T12:35:24Z", "closed_at": "2022-06-09T12:35:24Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nWebServer don't starts on Linux\r\n\r\n### To Reproduce\r\n\r\nuse this code:\r\n```python3\r\nroutes = web.RouteTableDef()\r\n@routes.get('/{nickname}')\r\nasync def hello(request):\r\n\tprint(\"I delete this code bcs it's dont except error\")\r\n\r\ndef start_http_server():\r\n\tapp = web.Application()\r\n\tapp.add_routes(routes)\r\n\tweb.run_app(app, port=25550)\r\nasync def pre_start_http_server():\r\n\tprint('hi')\r\n\tbot.loop.run_in_executor(None, start_http_server)\r\n\r\n@bot.event\r\nasync def on_ready():\r\n\tprint('bot started')\r\n\tbot.loop.create_task(pre_start_http_server())\r\n```\r\n\r\n### Expected behavior\r\n\r\npycord will work with aiohttp server together\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nunhandled exception during asyncio.run() shutdown\r\ntask: <Task finished name='Task-20' coro=<_run_app() done, defined at /home/container/.local/lib/python3.8/site-packages/aiohttp/web.py:287> exception=RuntimeError('set_wakeup_fd only works in main thread')>\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.8/asyncio/unix_events.py\", line 95, in add_signal_handler\r\n    signal.set_wakeup_fd(self._csock.fileno())\r\nValueError: set_wakeup_fd only works in main thread\r\nDuring handling of the above exception, another exception occurred:\r\nTraceback (most recent call last):\r\n  File \"/home/container/.local/lib/python3.8/site-packages/aiohttp/web.py\", line 514, in run_app\r\n    loop.run_until_complete(main_task)\r\n  File \"/usr/local/lib/python3.8/asyncio/base_events.py\", line 616, in run_until_complete\r\n    return future.result()\r\n  File \"/home/container/.local/lib/python3.8/site-packages/aiohttp/web.py\", line 321, in _run_app\r\n    await runner.setup()\r\n  File \"/home/container/.local/lib/python3.8/site-packages/aiohttp/web_runner.py\", line 273, in setup\r\n    loop.add_signal_handler(signal.SIGINT, _raise_graceful_exit)\r\n  File \"/usr/local/lib/python3.8/asyncio/unix_events.py\", line 97, in add_signal_handler\r\n    raise RuntimeError(str(exc))\r\nRuntimeError: set_wakeup_fd only works in main thread\r\nFuture exception was never retrieved\r\nfuture: <Future finished exception=RuntimeError('set_wakeup_fd only works in main thread')>\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.8/asyncio/unix_events.py\", line 95, in add_signal_handler\r\n    signal.set_wakeup_fd(self._csock.fileno())\r\nValueError: set_wakeup_fd only works in main thread\r\nDuring handling of the above exception, another exception occurred:\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.8/concurrent/futures/thread.py\", line 57, in run\r\n    result = self.fn(*self.args, **self.kwargs)\r\n  File \"/home/container/main.py\", line 60, in start_http_server\r\n    web.run_app(app, port=25550)\r\n  File \"/home/container/.local/lib/python3.8/site-packages/aiohttp/web.py\", line 514, in run_app\r\n    loop.run_until_complete(main_task)\r\n  File \"/usr/local/lib/python3.8/asyncio/base_events.py\", line 616, in run_until_complete\r\n    return future.result()\r\n  File \"/home/container/.local/lib/python3.8/site-packages/aiohttp/web.py\", line 321, in _run_app\r\n    await runner.setup()\r\n  File \"/home/container/.local/lib/python3.8/site-packages/aiohttp/web_runner.py\", line 273, in setup\r\n    loop.add_signal_handler(signal.SIGINT, _raise_graceful_exit)\r\n  File \"/usr/local/lib/python3.8/asyncio/unix_events.py\", line 97, in add_signal_handler\r\n    raise RuntimeError(str(exc))\r\nRuntimeError: set_wakeup_fd only works in main thread\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n$ python --version\r\nPython 3.8.13\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.8.1\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: \r\nAuthor-email: \r\nLicense: Apache 2\r\nLocation: /home/container/.local/lib/python3.8/site-packages\r\nRequires: aiosignal, async-timeout, attrs, charset-normalizer, frozenlist, multidict, yarl\r\nRequired-by:\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 6.0.2\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/container/.local/lib/python3.8/site-packages\r\nRequires: \r\nRequired-by: aiohttp, yarl\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.7.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/container/.local/lib/python3.8/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\r\n### OS\r\n\r\nLinux 20.04 LTS + Pterodactyl\r\n\r\n### Related component\r\n\r\nServer\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6783/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6783/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6768", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6768/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6768/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6768/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6768", "id": 1251902307, "node_id": "I_kwDOAMpNN85KnoNj", "number": 6768, "title": "'Client Quickstart' documentation out-of-sync, containing an erroneous snippet", "user": {"login": "alexpovel", "id": 48824213, "node_id": "MDQ6VXNlcjQ4ODI0MjEz", "avatar_url": "https://avatars.githubusercontent.com/u/48824213?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexpovel", "html_url": "https://github.com/alexpovel", "followers_url": "https://api.github.com/users/alexpovel/followers", "following_url": "https://api.github.com/users/alexpovel/following{/other_user}", "gists_url": "https://api.github.com/users/alexpovel/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexpovel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexpovel/subscriptions", "organizations_url": "https://api.github.com/users/alexpovel/orgs", "repos_url": "https://api.github.com/users/alexpovel/repos", "events_url": "https://api.github.com/users/alexpovel/events{/privacy}", "received_events_url": "https://api.github.com/users/alexpovel/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-05-29T14:20:18Z", "updated_at": "2022-05-29T14:38:15Z", "closed_at": "2022-05-29T14:38:14Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nThe [docs currently display this snippet](https://docs.aiohttp.org/en/stable/client_quickstart.html#make-a-request):\r\n\r\n```python\r\nimport aiohttp\r\nimport asyncio\r\n\r\nasync def main():\r\n    async with aiohttp.ClientSession() as session:\r\n        async with session.get('http://httpbin.org/get') as resp:\r\n            print(resp.status)\r\n            print(await resp.text())\r\n\r\nasyncio.run(main)\r\n```\r\n\r\nAs-is, this snippet won't run, yielding `ValueError: a coroutine was expected, got <function main at 0x000001FA5597B490>`. That's of course because we mustn't pass the function object `main` itself but the coroutine returned from calling it, `main()`.\r\n\r\nI wanted to create a short PR but this is actually already correct in the source:\r\n\r\nhttps://github.com/aio-libs/aiohttp/blob/72d3d4b1f68cca5ad15ef50bffb0419b798c7f23/docs/client_quickstart.rst?plain=1#L36\r\n\r\nSo the docs simply need to be updated/regenerated I reckon. Perhaps other items are out-of-sync as well?\r\n\r\n### To Reproduce\r\n\r\n1. Run the above code snippet.\r\n\r\n### Expected behavior\r\n\r\nIt prints a valid response.\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nValueError: a coroutine was expected, got <function main at 0x000001FA5597B490>\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n$ python --version\r\n3.10.4\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.8.1\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n$ python -m pip show multidict\r\n...\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n$ python -m pip show yarl\r\n...\r\n```\r\n\r\n\r\n### OS\r\n\r\n...\r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6768/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6768/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6757", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6757/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6757/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6757/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6757", "id": 1241649679, "node_id": "I_kwDOAMpNN85KAhIP", "number": 6757, "title": "Tests with Python 3.11.0b1: RuntimeError: no running event loop / There is no current event loop in thread 'MainThread'", "user": {"login": "hroncok", "id": 2401856, "node_id": "MDQ6VXNlcjI0MDE4NTY=", "avatar_url": "https://avatars.githubusercontent.com/u/2401856?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hroncok", "html_url": "https://github.com/hroncok", "followers_url": "https://api.github.com/users/hroncok/followers", "following_url": "https://api.github.com/users/hroncok/following{/other_user}", "gists_url": "https://api.github.com/users/hroncok/gists{/gist_id}", "starred_url": "https://api.github.com/users/hroncok/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hroncok/subscriptions", "organizations_url": "https://api.github.com/users/hroncok/orgs", "repos_url": "https://api.github.com/users/hroncok/repos", "events_url": "https://api.github.com/users/hroncok/events{/privacy}", "received_events_url": "https://api.github.com/users/hroncok/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2022-05-19T11:45:52Z", "updated_at": "2022-08-22T02:44:15Z", "closed_at": "2022-08-22T02:44:15Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nHello, in Fedora, we build all Python packages with pre-releases of Python 3.11. With Python 3.11.0b1, we see test failures of aiohttp 3.8.1, I can reproduce them with the current master barnch.\r\n\r\n### To Reproduce\r\n\r\n 1. git clone yarl (@ v1.7.2) , frozenlist (@ v1.3.0) and aiohttp (@ master)\r\n 2. `python3.11 -m venv venv` and `. venv/bin/activate`\r\n 3. In yarl and frozenlist, `make cythonize` with the recent cython version, then `pip install .`\r\n 4. In aiohttp I had to do some changes to make it build\r\n    1. I replaced `cython==0.29.27` with `cython==0.29.30` or just `cython` in `requirements/*`\r\n    2. I replaced the git-submodule copy of llhttp with the system one (6.0.6) as I was unable to make the nodejs build thing work, sorry\r\n    3. I removed the coverage pytest options, as coverage makes pytest fail immediately\r\n 5. `make cythonize`\r\n 6. `pip install . pytest pytest-mock`\r\n 7. run pytest, I've used `pytest tests/test_client_functional.py tests/test_client_request.py tests/test_loop.py tests/test_test_utils.py` as that is enough to get the failures\r\n\r\n```diff\r\ndiff --git a/aiohttp/_cparser.pxd b/aiohttp/_cparser.pxd\r\nindex 165dd61d..49055d6a 100644\r\n--- a/aiohttp/_cparser.pxd\r\n+++ b/aiohttp/_cparser.pxd\r\n@@ -10,7 +10,7 @@ from libc.stdint cimport (\r\n )\r\n \r\n \r\n-cdef extern from \"../vendor/llhttp/build/llhttp.h\":\r\n+cdef extern from \"llhttp.h\":\r\n \r\n     struct llhttp__internal_s:\r\n         int32_t _index\r\ndiff --git a/requirements/constraints.txt b/requirements/constraints.txt\r\nindex e1f6351b..26eed534 100644\r\n--- a/requirements/constraints.txt\r\n+++ b/requirements/constraints.txt\r\n@@ -60,7 +60,7 @@ cryptography==36.0.1 ; platform_machine != \"i686\"\r\n     #   -r requirements/test.txt\r\n     #   pyjwt\r\n     #   trustme\r\n-cython==0.29.27\r\n+cython==0.29.30\r\n     # via -r requirements/cython.txt\r\n distlib==0.3.3\r\n     # via virtualenv\r\ndiff --git a/requirements/cython.txt b/requirements/cython.txt\r\nindex 5cacc7e0..0a5b24bc 100644\r\n--- a/requirements/cython.txt\r\n+++ b/requirements/cython.txt\r\n@@ -1,3 +1,3 @@\r\n -r multidict.txt\r\n -r typing-extensions.txt  # required for parsing aiohttp/hdrs.py by tools/gen.py\r\n-cython==0.29.27\r\n+cython\r\ndiff --git a/setup.cfg b/setup.cfg\r\nindex e6dd14bc..e254f490 100644\r\n--- a/setup.cfg\r\n+++ b/setup.cfg\r\n@@ -123,10 +123,6 @@ addopts =\r\n     # show values of the local vars in errors:\r\n     --showlocals\r\n \r\n-    # `pytest-cov`:\r\n-    --cov=aiohttp\r\n-    --cov=tests/\r\n-\r\n     # run tests that are not marked with dev_mode\r\n     -m \"not dev_mode\"\r\n filterwarnings =\r\ndiff --git a/setup.py b/setup.py\r\nindex b27a54d6..0d70b1a7 100644\r\n--- a/setup.py\r\n+++ b/setup.py\r\n@@ -33,12 +33,8 @@ extensions = [\r\n         [\r\n             \"aiohttp/_http_parser.c\",\r\n             \"aiohttp/_find_header.c\",\r\n-            \"vendor/llhttp/build/c/llhttp.c\",\r\n-            \"vendor/llhttp/src/native/api.c\",\r\n-            \"vendor/llhttp/src/native/http.c\",\r\n         ],\r\n-        define_macros=[(\"LLHTTP_STRICT_MODE\", 0)],\r\n-        include_dirs=[\"vendor/llhttp/build\"],\r\n+        libraries=[\"llhttp\"],\r\n     ),\r\n     Extension(\"aiohttp._helpers\", [\"aiohttp/_helpers.c\"]),\r\n     Extension(\"aiohttp._http_writer\", [\"aiohttp/_http_writer.c\"]),\r\n```\r\n\r\n### Expected behavior\r\n\r\nTests pass.\r\n\r\n### Logs/tracebacks\r\n\r\nSee the next comment, the log was too long to paste here.\r\n\r\n### Python Version\r\n\r\n```console\r\n$ python --version\r\nPython 3.11.0b1\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 4.0.0a1\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: \r\nAuthor-email: \r\nLicense: Apache 2\r\nLocation: /home/churchyard/rpmbuild/fedora-scm/python-aiohttp/aiohttp/__venv__/lib64/python3.11/site-packages\r\nRequires: aiosignal, async-timeout, charset-normalizer, frozenlist, multidict, typing-extensions, yarl\r\nRequired-by:\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.2.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/churchyard/rpmbuild/fedora-scm/python-aiohttp/aiohttp/__venv__/lib64/python3.11/site-packages\r\nRequires: \r\nRequired-by: aiohttp, yarl\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.7.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/churchyard/rpmbuild/fedora-scm/python-aiohttp/aiohttp/__venv__/lib64/python3.11/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\r\n### OS\r\n\r\nFedora Linux 35 or 37\r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\nWe plan to update Fedora 37 to Python 3.11 after the second beta. Fedora 37 is the development version of Fedora.\r\nWhile testing things, we need to do that in dependency order. Unfortunately, this blocks us from testing many other packages, as this is quite a popular library.\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6757/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6757/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6755", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6755/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6755/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6755/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6755", "id": 1238414638, "node_id": "I_kwDOAMpNN85J0LUu", "number": 6755, "title": "Client example code is wrong in the stable version, but fixed in latest.", "user": {"login": "ikariwing", "id": 418952, "node_id": "MDQ6VXNlcjQxODk1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/418952?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ikariwing", "html_url": "https://github.com/ikariwing", "followers_url": "https://api.github.com/users/ikariwing/followers", "following_url": "https://api.github.com/users/ikariwing/following{/other_user}", "gists_url": "https://api.github.com/users/ikariwing/gists{/gist_id}", "starred_url": "https://api.github.com/users/ikariwing/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ikariwing/subscriptions", "organizations_url": "https://api.github.com/users/ikariwing/orgs", "repos_url": "https://api.github.com/users/ikariwing/repos", "events_url": "https://api.github.com/users/ikariwing/events{/privacy}", "received_events_url": "https://api.github.com/users/ikariwing/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-05-17T10:19:23Z", "updated_at": "2022-05-18T09:27:15Z", "closed_at": "2022-05-17T17:00:43Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nClient example code is wrong in the stable version doc:\r\n\r\n```asyncio.run(main)```\r\n\r\nhttps://docs.aiohttp.org/en/stable/client_quickstart.html\r\n\r\nAs a new comer, I spent some time to locate the reason.\r\nOriginally I'd like to write a PR to fix this but soon realized that this is already fixed in commit eef86e9e385e40e0b,\r\nwhich is 2021/12/02, more than 5 months ago.\r\n\r\nNow I am curious that how do we avoid the situation that somebody like me encountering the same issue repeatedly since I suppose we do have the need of keeping the corresponding doc for that version? \ud83e\udd14 \r\n\r\nMany thanks :) \n\n### To Reproduce\n\nthe example code in stable version is wrong.\r\nhttps://docs.aiohttp.org/en/stable/client_quickstart.html\r\n\r\n![CleanShot 2022-05-17 at 18 15 46@2x](https://user-images.githubusercontent.com/418952/168788746-591c54b8-84ea-48bc-ac1b-eb6201d129b1.png)\r\n\r\n\r\nand it's right in the latest version\r\nhttps://docs.aiohttp.org/en/latest/client_quickstart.html\r\n\r\n\r\n![CleanShot 2022-05-17 at 18 14 30@2x](https://user-images.githubusercontent.com/418952/168788529-0ab45f63-10ec-48a2-8b41-34e8afde461f.png)\r\n\n\n### Expected behavior\n\nWe can see the right doc for the previous version...\n\n### Logs/tracebacks\n\n```python-traceback\nN/A\n```\n\n\n### Python Version\n\n```console\nN/A\n```\n\n\n### aiohttp Version\n\n```console\nN/A\n```\n\n\n### multidict Version\n\n```console\nN/A\n```\n\n\n### yarl Version\n\n```console\nN/A\n```\n\n\n### OS\n\nN/A\n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6755/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6755/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6752", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6752/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6752/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6752/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6752", "id": 1236089841, "node_id": "I_kwDOAMpNN85JrTvx", "number": 6752, "title": "Python 3.10 - DeprecationWarning on example server sample", "user": {"login": "2-5", "id": 3753822, "node_id": "MDQ6VXNlcjM3NTM4MjI=", "avatar_url": "https://avatars.githubusercontent.com/u/3753822?v=4", "gravatar_id": "", "url": "https://api.github.com/users/2-5", "html_url": "https://github.com/2-5", "followers_url": "https://api.github.com/users/2-5/followers", "following_url": "https://api.github.com/users/2-5/following{/other_user}", "gists_url": "https://api.github.com/users/2-5/gists{/gist_id}", "starred_url": "https://api.github.com/users/2-5/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/2-5/subscriptions", "organizations_url": "https://api.github.com/users/2-5/orgs", "repos_url": "https://api.github.com/users/2-5/repos", "events_url": "https://api.github.com/users/2-5/events{/privacy}", "received_events_url": "https://api.github.com/users/2-5/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-05-14T18:13:28Z", "updated_at": "2022-05-14T18:19:17Z", "closed_at": "2022-05-14T18:19:17Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nIn Python 3.10 you'll get a DeprecationWarning If you run the server example \r\n\r\n\r\n### To Reproduce\r\n\r\nRun example code from documentation main page: https://docs.aiohttp.org/en/stable/index.html#server-example\r\n\r\n```python\r\nfrom aiohttp import web\r\n\r\nasync def handle(request):\r\n    name = request.match_info.get('name', \"Anonymous\")\r\n    text = \"Hello, \" + name\r\n    return web.Response(text=text)\r\n\r\napp = web.Application()\r\napp.add_routes([web.get('/', handle),\r\n                web.get('/{name}', handle)])\r\n\r\nif __name__ == '__main__':\r\n    web.run_app(app)  # <------- calls asyncio.get_event_loop() with no running loop\r\n```\r\n\r\n### Expected behavior\r\n\r\nNo DeprecationWarning, example modified to show the proper way to run it under Python 3.10\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\n/venv3/lib/site-packages/aiohttp/web.py:479: DeprecationWarning: There is no current event loop\r\n  loop = asyncio.get_event_loop()\r\n======== Running on http://0.0.0.0:8080 ========\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\nPython 3.10.4\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\naiohttp 3.7.4.post0\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n-\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n-\r\n```\r\n\r\n\r\n### OS\r\n\r\nWindows 10\r\n\r\n### Related component\r\n\r\nServer\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6752/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6752/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6730", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6730/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6730/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6730/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6730", "id": 1222786569, "node_id": "I_kwDOAMpNN85I4j4J", "number": 6730, "title": "Python 3.11 - error: _PyErr_StackItem {aka struct _err_stackitem} has no member named exc_type/exc_traceback", "user": {"login": "hrnciar", "id": 13086088, "node_id": "MDQ6VXNlcjEzMDg2MDg4", "avatar_url": "https://avatars.githubusercontent.com/u/13086088?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hrnciar", "html_url": "https://github.com/hrnciar", "followers_url": "https://api.github.com/users/hrnciar/followers", "following_url": "https://api.github.com/users/hrnciar/following{/other_user}", "gists_url": "https://api.github.com/users/hrnciar/gists{/gist_id}", "starred_url": "https://api.github.com/users/hrnciar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hrnciar/subscriptions", "organizations_url": "https://api.github.com/users/hrnciar/orgs", "repos_url": "https://api.github.com/users/hrnciar/repos", "events_url": "https://api.github.com/users/hrnciar/events{/privacy}", "received_events_url": "https://api.github.com/users/hrnciar/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-05-02T11:43:02Z", "updated_at": "2022-09-23T19:18:33Z", "closed_at": "2022-09-23T19:18:33Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\naiohttp doesn't build with Python 3.11\n\n### To Reproduce\n\nBuild aiohttp with Python 3.11\n\n### Expected behavior\n\nBuilds with Python 3.11\n\n### Logs/tracebacks\n\n```python-traceback\naiohttp/_http_writer.c: In function \u00e2\u20ac\u02dc__Pyx_ReraiseException\u00e2\u20ac\u2122:\r\naiohttp/_http_writer.c:4736:20: error: \u00e2\u20ac\u02dc_PyErr_StackItem\u00e2\u20ac\u2122 {aka \u00e2\u20ac\u02dcstruct _err_stackitem\u00e2\u20ac\u2122} has no member named \u00e2\u20ac\u02dcexc_type\u00e2\u20ac\u2122\r\n 4736 |     type = exc_info->exc_type;\r\n      |                    ^~\r\naiohttp/_http_writer.c:4738:18: error: \u00e2\u20ac\u02dc_PyErr_StackItem\u00e2\u20ac\u2122 {aka \u00e2\u20ac\u02dcstruct _err_stackitem\u00e2\u20ac\u2122} has no member named \u00e2\u20ac\u02dcexc_traceback\u00e2\u20ac\u2122\r\n 4738 |     tb = exc_info->exc_traceback;\r\n      |                  ^~\r\nerror: command '/usr/bin/gcc' failed with exit code 1\r\n\r\nFull log: https://download.copr.fedorainfracloud.org/results/@python/python3.11/fedora-rawhide-x86_64/04354617-python-aiohttp/builder-live.log.gz\n```\n\n\n### Python Version\n\n```console\nPython 3.11.0a7\n```\n\n\n### aiohttp Version\n\n```console\n3.8.1\n```\n\n\n### multidict Version\n\n```console\n6.0.2\n```\n\n\n### yarl Version\n\n```console\n1.8.0\n```\n\n\n### OS\n\nFedora rawhide\n\n### Related component\n\nServer, Client\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6730/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6730/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6724", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6724/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6724/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6724/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6724", "id": 1218858605, "node_id": "I_kwDOAMpNN85Ipk5t", "number": 6724, "title": "Header values allow newlines", "user": {"login": "Alainx277", "id": 26800509, "node_id": "MDQ6VXNlcjI2ODAwNTA5", "avatar_url": "https://avatars.githubusercontent.com/u/26800509?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Alainx277", "html_url": "https://github.com/Alainx277", "followers_url": "https://api.github.com/users/Alainx277/followers", "following_url": "https://api.github.com/users/Alainx277/following{/other_user}", "gists_url": "https://api.github.com/users/Alainx277/gists{/gist_id}", "starred_url": "https://api.github.com/users/Alainx277/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Alainx277/subscriptions", "organizations_url": "https://api.github.com/users/Alainx277/orgs", "repos_url": "https://api.github.com/users/Alainx277/repos", "events_url": "https://api.github.com/users/Alainx277/events{/privacy}", "received_events_url": "https://api.github.com/users/Alainx277/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-04-28T14:54:49Z", "updated_at": "2022-04-28T16:43:23Z", "closed_at": "2022-04-28T16:43:23Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nWhen setting a header on a request, the header value can contain a newline (also with CR LF). This is not allowed in the HTTP specification and prematurely ends the request.\r\n\r\n### To Reproduce\r\n\r\n1. Listen on a local port with netcat or similar\r\n  `nc -l 45328`\r\n2. Open a python async repl\r\n  `python -m asyncio`\r\n3. Enter the following\r\n  ```\r\n  import aiohttp\r\n  headers = { \"test\": \"with newline\\n\" }\r\n  async with aiohttp.ClientSession() as session:\r\n    await session.post(\"http://localhost:45328\", data=b\"test payload\", headers=headers)\r\n  ```\r\n4. Observe that the output from netcat shows an empty line in the middle of the request\r\n\r\n### Expected behavior\r\n\r\nI expect an error to be raised because the header value is not allowed.\r\n\r\n### Logs/tracebacks\r\n\r\nREPL:\r\n\r\n```\r\n> python -m asyncio\r\nasyncio REPL 3.9.9\r\n[Clang 13.0.0 (clang-1300.0.29.3)] on darwin\r\nUse \"await\" directly instead of \"asyncio.run()\".\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import asyncio\r\n>>> import aiohttp\r\n>>> headers = { \"test\": \"with newline\\n\" }\r\n>>> async with aiohttp.ClientSession() as session:\r\n...     await session.post(\"http://localhost:45328\", data=b\"test payload\", headers=headers)\r\n```\r\n\r\nNetcat:\r\n```\r\n> nc -l 45328\r\nPOST / HTTP/1.1\r\nHost: localhost:45328\r\ntest: with newline\r\n\r\nAccept: */*\r\nAccept-Encoding: gzip, deflate\r\nUser-Agent: Python/3.9 aiohttp/3.7.4.post0\r\nContent-Length: 12\r\nContent-Type: application/octet-stream\r\n\r\ntest payload%\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\nPython 3.9.9\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\nName: aiohttp\r\nVersion: 3.7.4.post0\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\nName: multidict\r\nVersion: 5.2.0\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\nName: yarl\r\nVersion: 1.7.2\r\n```\r\n\r\n\r\n### OS\r\n\r\nmacOS\r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6724/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6724/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6723", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6723/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6723/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6723/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6723", "id": 1217713328, "node_id": "I_kwDOAMpNN85IlNSw", "number": 6723, "title": "app.shutdown() hangs / isn't working", "user": {"login": "skewty", "id": 9087223, "node_id": "MDQ6VXNlcjkwODcyMjM=", "avatar_url": "https://avatars.githubusercontent.com/u/9087223?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skewty", "html_url": "https://github.com/skewty", "followers_url": "https://api.github.com/users/skewty/followers", "following_url": "https://api.github.com/users/skewty/following{/other_user}", "gists_url": "https://api.github.com/users/skewty/gists{/gist_id}", "starred_url": "https://api.github.com/users/skewty/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skewty/subscriptions", "organizations_url": "https://api.github.com/users/skewty/orgs", "repos_url": "https://api.github.com/users/skewty/repos", "events_url": "https://api.github.com/users/skewty/events{/privacy}", "received_events_url": "https://api.github.com/users/skewty/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-04-27T18:09:16Z", "updated_at": "2022-04-27T19:24:22Z", "closed_at": "2022-04-27T19:24:22Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\n`await app.shutdown()` finishes but the web server never shuts down\n\n### To Reproduce\n\n```python\r\n# Standard / Built-in\r\nimport asyncio\r\nimport logging.config\r\nimport sys\r\nimport traceback\r\nfrom random import randint\r\n\r\n# 3rd Party / PIP\r\nimport servicemanager\r\nimport win32event\r\nimport win32service\r\nimport win32serviceutil\r\nfrom aiohttp import web\r\nfrom aiohttp.web import Application, Request, Response, json_response\r\n\r\n\r\n# noinspection PyPep8Naming,PyBroadException\r\nclass WebService(win32serviceutil.ServiceFramework):\r\n    _svc_name_ = \"WebService\"\r\n    _svc_display_name_ = \"Web Service\"\r\n    _svc_description_ = \"Runs a web server.\"\r\n\r\n    def __init__(self, args):\r\n        win32serviceutil.ServiceFramework.__init__(self, args)\r\n        self.hWaitStop = win32event.CreateEvent(None, 0, 0, None)\r\n        self.bind_address = (\"127.0.0.1\", randint(1024, 65535))\r\n        self.logger = self.setup_logging()\r\n        self.web_app = self.prepare_web_service()\r\n\r\n    def SvcStop(self):\r\n        self.ReportServiceStatus(win32service.SERVICE_STOP_PENDING)\r\n        win32event.SetEvent(self.hWaitStop)\r\n\r\n    def SvcDoRun(self):\r\n        try:\r\n            servicemanager.LogMsg(\r\n                servicemanager.EVENTLOG_INFORMATION_TYPE, servicemanager.PYS_SERVICE_STARTED, (self._svc_name_, \"\")\r\n            )\r\n            self.run_web_service()\r\n        except Exception:\r\n            servicemanager.LogErrorMsg(traceback.format_exc())\r\n        finally:\r\n            servicemanager.LogMsg(\r\n                servicemanager.EVENTLOG_INFORMATION_TYPE, servicemanager.PYS_SERVICE_STOPPED, (self._svc_name_, \"\")\r\n            )\r\n\r\n    @classmethod\r\n    def setup_logging(cls) -> logging.Logger:\r\n        logging.config.dictConfig(\r\n            {\r\n                \"version\": 1,\r\n                \"disable_existing_loggers\": True,\r\n                \"formatters\": {\r\n                    \"default\": {\r\n                        # \"format\": \"{asctime} {levelname:8} {message}\",\r\n                        # \"style\": \"{\",\r\n                        \"datefmt\": \"%Y-%m-%d %H:%M:%S\",\r\n                    },\r\n                },\r\n                \"handlers\": {\r\n                    \"console\": {\r\n                        \"class\": \"logging.StreamHandler\",\r\n                        \"stream\": sys.stdout,\r\n                        \"formatter\": \"default\",\r\n                    },\r\n                },\r\n                \"loggers\": {\r\n                    cls._svc_name_: {\r\n                        \"handlers\": [\"console\"],\r\n                        \"level\": \"INFO\",\r\n                        \"propagate\": True,\r\n                    },\r\n                },\r\n            }\r\n        )\r\n        return logging.getLogger(cls._svc_name_)\r\n\r\n    def prepare_web_service(self) -> Application:\r\n        async def foo(request: Request) -> Response:\r\n            return json_response({\"result\": \"success\"}, status=200)\r\n\r\n        app = Application(logger=self.logger)\r\n        app.add_routes([web.post(\"/api/foo\", foo)])\r\n        return app\r\n\r\n    def run_web_service(self):\r\n        async def shutdown_server_on_stop():\r\n            self.logger.warning(\"waiting for service stop\")\r\n            while win32event.WaitForSingleObject(self.hWaitStop, 0) == win32event.WAIT_TIMEOUT:\r\n                await asyncio.sleep(1.0)\r\n            self.logger.warning(\"service is stopping; shutting down web server\")\r\n            await self.web_app.shutdown()  # ISSUE shutdown method doesn't work as expected\r\n            # web._cancel_tasks(asyncio.all_tasks(loop), loop)\r\n            self.logger.warning(\"service stop imminent\")\r\n\r\n        if sys.platform == \"win32\":\r\n            asyncio.set_event_loop_policy(asyncio.WindowsSelectorEventLoopPolicy())\r\n        loop = asyncio.new_event_loop()\r\n        asyncio.set_event_loop(loop)\r\n        loop.call_soon(loop.create_task, shutdown_server_on_stop())\r\n        web.run_app(\r\n            self.web_app, host=self.bind_address[0], port=self.bind_address[1], print=self.logger.info, loop=loop\r\n        )\r\n\r\n    @classmethod\r\n    def main(cls):\r\n        if len(sys.argv) == 1:\r\n            servicemanager.Initialize()\r\n            servicemanager.PrepareToHostSingle(cls)\r\n            servicemanager.StartServiceCtrlDispatcher()\r\n        else:\r\n            if \"debug\" in sys.argv[1:] and \"pydevd\" in sys.modules and hasattr(sys, \"frozen\") is False:\r\n                setattr(sys, \"frozen\", True)  # ensures code path that supports debugging\r\n            win32serviceutil.HandleCommandLine(cls)\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    WebService.main()\r\n```\r\n\r\nNOTE: the screen output issue is reported as https://github.com/mhammond/pywin32/issues/1866\n\n### Expected behavior\n\ncall `await app.shutdown()`\r\nthe web server stops serving web pages\n\n### Logs/tracebacks\n\n```python-traceback\nC:\\Python310\\python.exe C:/proj/fabric/test/webservice.py debug\r\nwaiting for service stop\r\n======== Running on http://127.0.0.1:36317 ========\r\n(Press CTRL+C to quit)\r\nservice is stopping; shutting down web server\r\nservice stop imminent\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\n\r\nPython 3.10.4\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\n\r\nName: aiohttp\r\nVersion: 3.8.1\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\n\r\nName: multidict\r\nVersion: 6.0.2\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\n\r\nName: yarl\r\nVersion: 1.7.2\n```\n\n\n### OS\n\nWindows 10\n\n### Related component\n\nServer\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6723/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6723/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6719", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6719/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6719/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6719/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6719", "id": 1216149153, "node_id": "I_kwDOAMpNN85IfPah", "number": 6719, "title": "CancelledError", "user": {"login": "H--o-l", "id": 10905922, "node_id": "MDQ6VXNlcjEwOTA1OTIy", "avatar_url": "https://avatars.githubusercontent.com/u/10905922?v=4", "gravatar_id": "", "url": "https://api.github.com/users/H--o-l", "html_url": "https://github.com/H--o-l", "followers_url": "https://api.github.com/users/H--o-l/followers", "following_url": "https://api.github.com/users/H--o-l/following{/other_user}", "gists_url": "https://api.github.com/users/H--o-l/gists{/gist_id}", "starred_url": "https://api.github.com/users/H--o-l/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/H--o-l/subscriptions", "organizations_url": "https://api.github.com/users/H--o-l/orgs", "repos_url": "https://api.github.com/users/H--o-l/repos", "events_url": "https://api.github.com/users/H--o-l/events{/privacy}", "received_events_url": "https://api.github.com/users/H--o-l/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 21, "created_at": "2022-04-26T15:42:32Z", "updated_at": "2023-01-18T17:57:55Z", "closed_at": "2022-05-08T11:40:53Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nUsing the aiohttp web server, I struggle with `asyncio.CancelledError()` when a client disconnect for some time.\r\nI shielded what needed to be but it has its limits.\r\nToday I found this old PR:\r\nhttps://github.com/aio-libs/aiohttp/pull/4080\r\n\r\nIt looks like my issue.\r\nIf I understand correctly  `asyncio.CancelledError()` was fixed at the beginning of v3.7.0 (1th October 2019).\r\nBut I still have frequent `asyncio.CancelledError()` in my server.\r\n\r\nI have investigated a bit more and I find another PR, at the end of v3.7.0 (just before v3.7.0b0 I think) that for me re-introduce the issue:\r\nhttps://github.com/aio-libs/aiohttp/pull/4415\r\n\r\nFor me the wrong code is the following:\r\n```py\r\n        if self._task_handler is not None:\r\n            self._task_handler.cancel()\r\n```    \r\n\r\nIt was removed by https://github.com/aio-libs/aiohttp/pull/4080 (and with all the documentation regarding this issue) but re-introduced silently by https://github.com/aio-libs/aiohttp/pull/4415.\r\n\r\nI'm clearly not an expert so I'm not sure of what I'm saying, but does it make sense for you?\r\n\r\n### To Reproduce\r\n\r\nNA\r\n\r\n### Expected behavior\r\n\r\nNA\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nNA\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n3.10.4\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n3.8.1\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n5.1.0\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n1.6.3\r\n```\r\n\r\n\r\n### OS\r\n\r\nFedora 35\r\n\r\n### Related component\r\n\r\nServer\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6719/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 1, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6719/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6707", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6707/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6707/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6707/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6707", "id": 1209813393, "node_id": "I_kwDOAMpNN85IHEmR", "number": 6707, "title": "async for message in ws exits for unknown reasons?", "user": {"login": "emanuele3d", "id": 6934584, "node_id": "MDQ6VXNlcjY5MzQ1ODQ=", "avatar_url": "https://avatars.githubusercontent.com/u/6934584?v=4", "gravatar_id": "", "url": "https://api.github.com/users/emanuele3d", "html_url": "https://github.com/emanuele3d", "followers_url": "https://api.github.com/users/emanuele3d/followers", "following_url": "https://api.github.com/users/emanuele3d/following{/other_user}", "gists_url": "https://api.github.com/users/emanuele3d/gists{/gist_id}", "starred_url": "https://api.github.com/users/emanuele3d/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/emanuele3d/subscriptions", "organizations_url": "https://api.github.com/users/emanuele3d/orgs", "repos_url": "https://api.github.com/users/emanuele3d/repos", "events_url": "https://api.github.com/users/emanuele3d/events{/privacy}", "received_events_url": "https://api.github.com/users/emanuele3d/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2022-04-20T14:58:58Z", "updated_at": "2022-04-22T16:17:52Z", "closed_at": "2022-04-20T16:45:36Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nThe \"async for message in ws\" loop ends inexplicably. \n\n### To Reproduce\n\nI'm using this code to connect with a wss:// address and process the messages it returns:\r\n```\r\nasync with aiohttp.ClientSession() as session:\r\n    async with session.ws_connect(url=self._config['wssAddress'],\r\n                                  autoping=True, autoclose=False,\r\n                                  ssl=True) as self._client:\r\n\r\n        await self.subscribe_to_streams(self._config['streams'])\r\n\r\n        async for message in self._client:\r\n            self.message_handler(message)\r\n```\r\n\r\nIf self._config['streams] contains a list of streams known to the server, everything works flawlessly. \r\n\r\nThe problem arises when I intentionally try to subscribe to a stream that the server doesn't know about. In this case I receive the following message from the server:\r\n\r\n```\r\nWSMessage(type=<WSMsgType.TEXT: 1 >, data='{\"error\":{\"code\":2,\"msg\":\"Invalid request: invalid stream\"},\"id\":2}', extra = '')\r\n```\r\n\r\nThe message itself is what I expect and doesn't seem to be special in any way. Mysteriously however, the flow of the program exits the loop and the connection is closed. \r\n\r\n(This happens irrespective of autoclose being set to True or False, but I don't know if this is relevant)\r\n\n\n### Expected behavior\n\nIf the server closed the connection, i.e. because its logic accepts absolutely zero errors from me, I would expect aiohttp to tell me the closure was caused by the server or see one last message from the server warning me about the closure.\r\n\r\nAnd there have been other instances of the loop exiting and the connection closing seemingly without reasons, at random times over multi-hours runs when everything seems to work. Attempting to subscribe to a stream that doesn't exist is just a way to trigger the issue reliably. \r\n\r\nIf something happened client side, I would also expect aiohttp to tell me, i.e. via an exception, but I get absolutely nothing. The loop just ends and the connection is closed.\r\n\r\nBasically I'm left wondering: is the loop exiting ONLY if the websocket connection is closed? If it is, how do I know if it's the client or the server that triggered the closure? If it isn't what are the other causes?\r\n\r\n\n\n### Logs/tracebacks\n\n```python-traceback\nNothing interesting at this point: one moment I get the expected error message quoted above and the next I get the logging expected after the flow of the program exits the loop, nothing in-between hinting at the cause. =(\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\nPython 3.9.9\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.8.1\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor:\r\nAuthor-email:\r\nLicense: Apache 2\r\nLocation: (...)\r\nRequires: aiosignal, async-timeout, attrs, charset-normalizer, frozenlist, multidict, yarl\r\nRequired-by:\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 6.0.2\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: (...)\r\nRequires:\r\nRequired-by: aiohttp, yarl\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.7.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: (...)\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\n```\n\n\n### OS\n\nWindows 10\n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6707/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6707/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6705", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6705/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6705/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6705/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6705", "id": 1206195282, "node_id": "I_kwDOAMpNN85H5RRS", "number": 6705, "title": "`content-encoding: br` header sent when brotli isn't installed.", "user": {"login": "TheOnlyWayUp", "id": 76237496, "node_id": "MDQ6VXNlcjc2MjM3NDk2", "avatar_url": "https://avatars.githubusercontent.com/u/76237496?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TheOnlyWayUp", "html_url": "https://github.com/TheOnlyWayUp", "followers_url": "https://api.github.com/users/TheOnlyWayUp/followers", "following_url": "https://api.github.com/users/TheOnlyWayUp/following{/other_user}", "gists_url": "https://api.github.com/users/TheOnlyWayUp/gists{/gist_id}", "starred_url": "https://api.github.com/users/TheOnlyWayUp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TheOnlyWayUp/subscriptions", "organizations_url": "https://api.github.com/users/TheOnlyWayUp/orgs", "repos_url": "https://api.github.com/users/TheOnlyWayUp/repos", "events_url": "https://api.github.com/users/TheOnlyWayUp/events{/privacy}", "received_events_url": "https://api.github.com/users/TheOnlyWayUp/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-04-16T19:10:19Z", "updated_at": "2022-04-19T18:17:51Z", "closed_at": "2022-04-19T18:17:51Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nBrotli's br header is used even when brotli isn't installed, and the error is quite misleading.\r\n```py\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\User\\ki\\discord.py-self\\examples\\reply.py\", line 19, in <module>\r\n    client.run('mytoken')\r\n  File \"C:\\Python310\\lib\\site-packages\\discord\\client.py\", line 715, in run\r\n    asyncio.run(runner())\r\n  File \"C:\\Python310\\lib\\asyncio\\runners.py\", line 44, in run\r\n    return loop.run_until_complete(main)\r\n  File \"C:\\Python310\\lib\\asyncio\\base_events.py\", line 646, in run_until_complete\r\n    return future.result()\r\n  File \"C:\\Python310\\lib\\site-packages\\discord\\client.py\", line 712, in runner\r\n    await self.start(*args, **kwargs)\r\n  File \"C:\\Python310\\lib\\site-packages\\discord\\client.py\", line 685, in start\r\n    await self.login(token)\r\n  File \"C:\\Python310\\lib\\site-packages\\discord\\client.py\", line 553, in login\r\n    data = await state.http.static_login(token.strip())\r\n  File \"C:\\Python310\\lib\\site-packages\\discord\\http.py\", line 650, in static_login\r\n    await self.startup()\r\n  File \"C:\\Python310\\lib\\site-packages\\discord\\http.py\", line 372, in startup\r\n    self.user_agent, self.browser_version, self.client_build_number = ua, bv, bn = await utils._get_info(session)\r\n  File \"C:\\Python310\\lib\\site-packages\\discord\\utils.py\", line 1242, in _get_info\r\n    bn = await _get_build_number(session)\r\n  File \"C:\\Python310\\lib\\site-packages\\discord\\utils.py\", line 1251, in _get_build_number\r\n    login_page = await login_page_request.text()\r\n  File \"C:\\Python310\\lib\\site-packages\\aiohttp\\client_reqrep.py\", line 1076, in text\r\n    await self.read()\r\n  File \"C:\\Python310\\lib\\site-packages\\aiohttp\\client_reqrep.py\", line 1032, in read\r\n    self._body = await self.content.read()\r\n  File \"C:\\Python310\\lib\\site-packages\\aiohttp\\streams.py\", line 344, in read\r\n    raise self._exception\r\naiohttp.client_exceptions.ClientPayloadError: 400, message='Can not decode content-encoding: br'\r\n```\r\nBrotli isn't installed on the system and it *doesn't* seem to be an issue with the webserver (discord) from my testing.\n\n### To Reproduce\n\nClone https://github.com/dolfies/discord.py-self/, cd into the examples directory, modify the reply.py to include your user token (last line) and run the file.\n\n### Expected behavior\n\nThe aiohttp client shouldn't send the `content-encoding: br` header to the webserver.\n\n### Logs/tracebacks\n\n```python-traceback\nTraceback (most recent call last):\r\n  File \"C:\\Users\\User\\ki\\discord.py-self\\examples\\reply.py\", line 19, in <module>\r\n    client.run('mytoken')\r\n  File \"C:\\Python310\\lib\\site-packages\\discord\\client.py\", line 715, in run\r\n    asyncio.run(runner())\r\n  File \"C:\\Python310\\lib\\asyncio\\runners.py\", line 44, in run\r\n    return loop.run_until_complete(main)\r\n  File \"C:\\Python310\\lib\\asyncio\\base_events.py\", line 646, in run_until_complete\r\n    return future.result()\r\n  File \"C:\\Python310\\lib\\site-packages\\discord\\client.py\", line 712, in runner\r\n    await self.start(*args, **kwargs)\r\n  File \"C:\\Python310\\lib\\site-packages\\discord\\client.py\", line 685, in start\r\n    await self.login(token)\r\n  File \"C:\\Python310\\lib\\site-packages\\discord\\client.py\", line 553, in login\r\n    data = await state.http.static_login(token.strip())\r\n  File \"C:\\Python310\\lib\\site-packages\\discord\\http.py\", line 650, in static_login\r\n    await self.startup()\r\n  File \"C:\\Python310\\lib\\site-packages\\discord\\http.py\", line 372, in startup\r\n    self.user_agent, self.browser_version, self.client_build_number = ua, bv, bn = await utils._get_info(session)\r\n  File \"C:\\Python310\\lib\\site-packages\\discord\\utils.py\", line 1242, in _get_info\r\n    bn = await _get_build_number(session)\r\n  File \"C:\\Python310\\lib\\site-packages\\discord\\utils.py\", line 1251, in _get_build_number\r\n    login_page = await login_page_request.text()\r\n  File \"C:\\Python310\\lib\\site-packages\\aiohttp\\client_reqrep.py\", line 1076, in text\r\n    await self.read()\r\n  File \"C:\\Python310\\lib\\site-packages\\aiohttp\\client_reqrep.py\", line 1032, in read\r\n    self._body = await self.content.read()\r\n  File \"C:\\Python310\\lib\\site-packages\\aiohttp\\streams.py\", line 344, in read\r\n    raise self._exception\r\naiohttp.client_exceptions.ClientPayloadError: 400, message='Can not decode content-encoding: br'\r\n\r\n\r\n```py\r\nTraceback (most recent call last):\r\n  File \"/home/user/Desktop/HTML/danktrivia/trivia.py\", line 27, in <module>\r\n    client.run(\"<REMOVED>\")\r\n  File \"/home/user/.local/lib/python3.9/site-packages/discord/client.py\", line 654, in run\r\n    return future.result()\r\n  File \"/home/user/.local/lib/python3.9/site-packages/discord/client.py\", line 633, in runner\r\n    await self.start(*args, **kwargs)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/discord/client.py\", line 596, in start\r\n    await self.login(token)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/discord/client.py\", line 471, in login\r\n    data = await state.http.static_login(token.strip())\r\n  File \"/home/user/.local/lib/python3.9/site-packages/discord/http.py\", line 452, in static_login\r\n    await self.startup()\r\n  File \"/home/user/.local/lib/python3.9/site-packages/discord/http.py\", line 207, in startup\r\n    self.user_agent, self.browser_version, self.client_build_number = ua, bv, bn = await utils._get_info(session)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/discord/utils.py\", line 1265, in _get_info\r\n    bn = await _get_build_number(session)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/discord/utils.py\", line 1274, in _get_build_number\r\n    login_page = await login_page_request.text()\r\n  File \"/home/user/.local/lib/python3.9/site-packages/aiohttp/client_reqrep.py\", line 1076, in text\r\n    await self.read()\r\n  File \"/home/user/.local/lib/python3.9/site-packages/aiohttp/client_reqrep.py\", line 1032, in read\r\n    self._body = await self.content.read()\r\n  File \"/home/user/.local/lib/python3.9/site-packages/aiohttp/streams.py\", line 344, in read\r\n    raise self._exception\r\naiohttp.client_exceptions.ClientPayloadError: 400, message='Can not decode content-encoding: br'\r\n```\n```\n\n\n### Python Version\n\n```console\nPython 3.10.4\n```\n\n\n### aiohttp Version\n\n```console\nName: aiohttp\r\nVersion: 3.8.1\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: \r\nAuthor-email: \r\nLicense: Apache 2\r\nLocation: /root/code/Bots/dpys_test/venv/lib/python3.10/site-packages\r\nRequires: aiosignal, async-timeout, attrs, charset-normalizer, frozenlist, multidict, yarl\r\nRequired-by: discord.py-self\n```\n\n\n### multidict Version\n\n```console\nName: multidict\r\nVersion: 6.0.2\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /root/code/Bots/dpys_test/venv/lib/python3.10/site-packages\r\nRequires: \r\nRequired-by: aiohttp, yarl\n```\n\n\n### yarl Version\n\n```console\nName: yarl\r\nVersion: 1.7.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /root/code/Bots/dpys_test/venv/lib/python3.10/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\n```\n\n\n### OS\n\nUbuntu\n\n### Related component\n\nClient\n\n### Additional context\n\ndolfies/discord.py-self#236\r\ndolfies/discord.py-self#275\r\nhave a bit more discussion on this.\r\n\r\nMade this issue mostly to figured out why this is happening and if it was fixed.\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6705/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6705/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6701", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6701/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6701/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6701/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6701", "id": 1204253410, "node_id": "I_kwDOAMpNN85Hx3Li", "number": 6701, "title": "Error in StreamReader#readuntil", "user": {"login": "vitaliihonta", "id": 17992745, "node_id": "MDQ6VXNlcjE3OTkyNzQ1", "avatar_url": "https://avatars.githubusercontent.com/u/17992745?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vitaliihonta", "html_url": "https://github.com/vitaliihonta", "followers_url": "https://api.github.com/users/vitaliihonta/followers", "following_url": "https://api.github.com/users/vitaliihonta/following{/other_user}", "gists_url": "https://api.github.com/users/vitaliihonta/gists{/gist_id}", "starred_url": "https://api.github.com/users/vitaliihonta/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vitaliihonta/subscriptions", "organizations_url": "https://api.github.com/users/vitaliihonta/orgs", "repos_url": "https://api.github.com/users/vitaliihonta/repos", "events_url": "https://api.github.com/users/vitaliihonta/events{/privacy}", "received_events_url": "https://api.github.com/users/vitaliihonta/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-04-14T09:05:15Z", "updated_at": "2022-11-10T19:27:49Z", "closed_at": "2022-11-10T19:27:49Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nHi there, it looks like StreamReader#readuntil function [here](https://github.com/aio-libs/aiohttp/blob/3.8/aiohttp/streams.py#L328) has an error.\r\n\r\nMy original use case was to read CSV files directly from ClientResponse line-by-line when the line terminator is `\\r\\n`.\r\nThe example I've provided is very similar.\r\n\r\nWhen the separator has more than one symbol, it splits lines in a strange way.\r\nFor instance, when separator is `b'ab'`, it splits as follows:\r\n```\r\nb'11a'\r\nb'b\\n22a'\r\nb'b\\n33a'\r\nb'b'\r\n```\r\ne.g. at the middle of the separator.\r\n\r\nI think that this part wasn't updated at the time when it was `readline` function with only `\\n` (one symbol length) separator available.\r\n\r\nProbably this line should be:\r\n```python\r\nichar = self._buffer[0].find(separator, offset) + len(separator) \r\n```\r\n\r\nso that it will contain the whole separator instead of 'splitting' it.\r\n\r\n### To Reproduce\r\n\r\nRun this thing https://gist.github.com/vitaliihonta/b9be77deb0dfea1e9a411e695e6f15c9\r\n\r\n### Expected behavior\r\n\r\nEach line should contain the whole separator\r\n```\r\nb'11ab'\r\nb'\\n22ab'\r\nb'\\n33ab'\r\n```\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nNone\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\nPython 3.8.9\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n3.8.1\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\nName: multidict\r\nVersion: 6.0.2\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\nName: yarl\r\nVersion: 1.7.2\r\n```\r\n\r\n\r\n### OS\r\n\r\nmacOS\r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6701/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6701/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6680", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6680/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6680/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6680/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6680", "id": 1195074855, "node_id": "I_kwDOAMpNN85HO2Un", "number": 6680, "title": "aiohttp.client_exceptions.ClientConnectionError when creating an async generator inside the request context manager", "user": {"login": "adnaanbheda", "id": 25040547, "node_id": "MDQ6VXNlcjI1MDQwNTQ3", "avatar_url": "https://avatars.githubusercontent.com/u/25040547?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adnaanbheda", "html_url": "https://github.com/adnaanbheda", "followers_url": "https://api.github.com/users/adnaanbheda/followers", "following_url": "https://api.github.com/users/adnaanbheda/following{/other_user}", "gists_url": "https://api.github.com/users/adnaanbheda/gists{/gist_id}", "starred_url": "https://api.github.com/users/adnaanbheda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adnaanbheda/subscriptions", "organizations_url": "https://api.github.com/users/adnaanbheda/orgs", "repos_url": "https://api.github.com/users/adnaanbheda/repos", "events_url": "https://api.github.com/users/adnaanbheda/events{/privacy}", "received_events_url": "https://api.github.com/users/adnaanbheda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-04-06T19:26:54Z", "updated_at": "2022-04-07T16:59:31Z", "closed_at": "2022-04-07T16:52:11Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\n```\r\n        async with aiohttp.ClientSession() as client:\r\n            async with client.get(url=URL) as resp:\r\n                async def generator():\r\n                    async for data, _ in resp.content.iter_chunks():\r\n                        yield data\r\n                return generator(), resp.status, resp.headers\r\n```\r\n\r\nThe purpose is to proxy requests from an ASGI server, the above snippet raises the exception but when you run the snippet without an ASGI server, it works fine, which is very weird. Disregarding the bug I just want to find a way in which I can stream responses along with their status codes and headers.\r\n\r\n### To Reproduce\r\n\r\n```\r\nimport quart\r\nimport aiohttp\r\n\r\n# import uvicorn\r\n\r\n# import fastapi\r\n# from fastapi.responses import StreamingResponse\r\n\r\nURL = \"https://httpbin.org/json\"\r\n\r\napp = quart.Quart(__name__)\r\n# app = fastapi.FastAPI()\r\n\r\n\r\n@app.get(\"/aiohttp\")\r\nasync def aiohttp_test():\r\n\r\n    session = aiohttp.ClientSession()\r\n    async with session.request(method=\"get\", url=URL) as resp:\r\n\r\n        async def generator():\r\n            async for data in resp.content.iter_any():\r\n                yield data\r\n\r\n        return generator(), resp.status, dict(resp.headers)\r\n        # return StreamingResponse(generator(), resp.status, dict(resp.headers))\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    app.run(port=5000)\r\n    # uvicorn.run(app, port=5000)\r\n\r\n\r\n```\r\n\r\nThe error occurs across frameworks like Quart, FastAPI and ASGI servers like Hypercorn and Uvicorn\r\n\r\n### Expected behavior\r\n\r\nTuple containing the async generator, status code, and headers, so as to create a \"Flask like\" response containing content, status, headers\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nTraceback (most recent call last):\r\n  File \"/home/adnaan/.local/share/virtualenvs/idk-P59nEHUL/lib/python3.9/site-packages/hypercorn/asyncio/task_group.py\", line 21, in _handle\r\n    await invoke_asgi(app, scope, receive, send)\r\n  File \"/home/adnaan/.local/share/virtualenvs/idk-P59nEHUL/lib/python3.9/site-packages/hypercorn/utils.py\", line 247, in invoke_asgi\r\n    await app(scope, receive, send)\r\n  File \"/home/adnaan/.local/share/virtualenvs/idk-P59nEHUL/lib/python3.9/site-packages/quart/app.py\", line 1741, in __call__\r\n    await self.asgi_app(scope, receive, send)\r\n  File \"/home/adnaan/.local/share/virtualenvs/idk-P59nEHUL/lib/python3.9/site-packages/quart/app.py\", line 1767, in asgi_app\r\n    await asgi_handler(receive, send)\r\n  File \"/home/adnaan/.local/share/virtualenvs/idk-P59nEHUL/lib/python3.9/site-packages/quart/asgi.py\", line 51, in __call__\r\n    _raise_exceptions(done)\r\n  File \"/home/adnaan/.local/share/virtualenvs/idk-P59nEHUL/lib/python3.9/site-packages/quart/asgi.py\", line 353, in _raise_exceptions\r\n    raise task.exception()\r\n  File \"/home/adnaan/.local/share/virtualenvs/idk-P59nEHUL/lib/python3.9/site-packages/quart/asgi.py\", line 102, in handle_request\r\n    await asyncio.wait_for(self._send_response(send, response), timeout=timeout)\r\n  File \"/home/adnaan/.pyenv/versions/3.9.10/lib/python3.9/asyncio/tasks.py\", line 479, in wait_for\r\n    return fut.result()\r\n  File \"/home/adnaan/.local/share/virtualenvs/idk-P59nEHUL/lib/python3.9/site-packages/quart/asgi.py\", line 131, in _send_response\r\n    async for data in response_body:\r\n  File \"/home/adnaan/klinify/deploy/global/idk/test_quart_aiohttp.py\", line 68, in generator\r\n    async for data, _ in resp.content.iter_chunks():\r\n  File \"/home/adnaan/.local/share/virtualenvs/idk-P59nEHUL/lib/python3.9/site-packages/aiohttp/streams.py\", line 51, in __anext__\r\n    rv = await self._stream.readchunk()\r\n  File \"/home/adnaan/.local/share/virtualenvs/idk-P59nEHUL/lib/python3.9/site-packages/aiohttp/streams.py\", line 411, in readchunk\r\n    raise self._exception\r\naiohttp.client_exceptions.ClientConnectionError: Connection closed\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n3.9\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n3.8.1\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n$ python -m pip show multidict\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n1.7.2\r\n```\r\n\r\n\r\n### OS\r\n\r\nWSL2 - Ubuntu 20.04 \r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6680/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6680/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6663", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6663/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6663/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6663/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6663", "id": 1183243555, "node_id": "I_kwDOAMpNN85Ght0j", "number": 6663, "title": "Failing test suite with pytest 7 due to deprecation warnings", "user": {"login": "bnavigator", "id": 4623504, "node_id": "MDQ6VXNlcjQ2MjM1MDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4623504?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bnavigator", "html_url": "https://github.com/bnavigator", "followers_url": "https://api.github.com/users/bnavigator/followers", "following_url": "https://api.github.com/users/bnavigator/following{/other_user}", "gists_url": "https://api.github.com/users/bnavigator/gists{/gist_id}", "starred_url": "https://api.github.com/users/bnavigator/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bnavigator/subscriptions", "organizations_url": "https://api.github.com/users/bnavigator/orgs", "repos_url": "https://api.github.com/users/bnavigator/repos", "events_url": "https://api.github.com/users/bnavigator/events{/privacy}", "received_events_url": "https://api.github.com/users/bnavigator/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2022-03-28T10:42:41Z", "updated_at": "2022-03-28T23:20:47Z", "closed_at": "2022-03-28T23:20:47Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nPytest 7 deprecates the usage of `pytest.warns(None)`. See https://github.com/pytest-dev/pytest/issues/9404 for a discussion about it.\r\n\r\nThe test suite erroring out on any warning fails with pytest 7.1.1\r\n\r\n\r\n### To Reproduce\r\n\r\n1. Install a recent pytest (7.1.1)\r\n2. Run pytest on the aiohttp source\r\n\r\n### Expected behavior\r\n\r\nClean pass\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\n[  106s] =================================== FAILURES ===================================\r\n[  106s] ___________________________ test_async_with_session ____________________________\r\n[  106s] \r\n[  106s]     async def test_async_with_session() -> None:\r\n[  106s] >       with pytest.warns(None) as cm:\r\n[  106s] \r\n[  106s] \r\n[  106s] tests/test_client_functional.py:2431: \r\n[  106s] _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n[  106s] \r\n[  106s] self = WarningsChecker(record=True), expected_warning = None, match_expr = None\r\n[  106s] \r\n[  106s]     def __init__(\r\n[  106s]         self,\r\n[  106s]         expected_warning: Optional[\r\n[  106s]             Union[Type[Warning], Tuple[Type[Warning], ...]]\r\n[  106s]         ] = Warning,\r\n[  106s]         match_expr: Optional[Union[str, Pattern[str]]] = None,\r\n[  106s]         *,\r\n[  106s]         _ispytest: bool = False,\r\n[  106s]     ) -> None:\r\n[  106s]         check_ispytest(_ispytest)\r\n[  106s]         super().__init__(_ispytest=True)\r\n[  106s]     \r\n[  106s]         msg = \"exceptions must be derived from Warning, not %s\"\r\n[  106s]         if expected_warning is None:\r\n[  106s] >           warnings.warn(WARNS_NONE_ARG, stacklevel=4)\r\n[  106s] E           pytest.PytestRemovedIn8Warning: Passing None has been deprecated.\r\n[  106s] E           See https://docs.pytest.org/en/latest/how-to/capture-warnings.html#additional-use-cases-of-warnings-in-tests for alternatives in common use cases.\r\n[  106s] \r\n[  106s] __class__  = <class '_pytest.recwarn.WarningsChecker'>\r\n[  106s] _ispytest  = True\r\n[  106s] expected_warning = None\r\n[  106s] match_expr = None\r\n[  106s] msg        = 'exceptions must be derived from Warning, not %s'\r\n[  106s] self       = WarningsChecker(record=True)\r\n[  106s] \r\n[  106s] /usr/lib/python3.9/site-packages/_pytest/recwarn.py:246: PytestRemovedIn8Warning\r\n[  106s] _________________________ test_session_close_awaitable _________________________\r\n[  106s] \r\n[  106s]     async def test_session_close_awaitable() -> None:\r\n[  106s]         session = aiohttp.ClientSession()\r\n[  106s] >       with pytest.warns(None) as cm:\r\n[  106s] \r\n[  106s] session    = <aiohttp.client.ClientSession object at 0x7f74353d5400>\r\n[  106s] \r\n[  106s] tests/test_client_functional.py:2441: \r\n[  106s] _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n[  106s] /usr/lib/python3.9/site-packages/_pytest/recwarn.py:246: in __init__\r\n[  106s]     warnings.warn(WARNS_NONE_ARG, stacklevel=4)\r\n[  106s]         __class__  = <class '_pytest.recwarn.WarningsChecker'>\r\n[  106s]         _ispytest  = True\r\n[  106s]         expected_warning = None\r\n[  106s]         match_expr = None\r\n[  106s]         msg        = 'exceptions must be derived from Warning, not %s'\r\n[  106s]         self       = WarningsChecker(record=True)\r\n[  106s] /usr/lib/python3.9/site-packages/_pytest/runner.py:338: in from_call\r\n[  106s]     result: Optional[TResult] = func()\r\n[  106s]         cls        = <class '_pytest.runner.CallInfo'>\r\n[  106s]         duration   = 0.0002979149999191577\r\n[  106s]         excinfo    = <ExceptionInfo PytestRemovedIn8Warning('Passing None has been deprecated.\\nSee https://docs.pytest.org/en/latest/how-to/capture-warnings.html#additional-use-cases-of-warnings-in-tests for alternatives in common use cases.') tblen=2>\r\n[  106s]         func       = <function call_runtest_hook.<locals>.<lambda> at 0x7f74333c05e0>\r\n[  106s]         precise_start = 880.992611685\r\n[  106s]         precise_stop = 880.9929096\r\n[  106s]         reraise    = (<class '_pytest.outcomes.Exit'>, <class 'KeyboardInterrupt'>)\r\n[  106s]         result     = None\r\n[  106s]         start      = 1648463406.1733868\r\n[  106s]         stop       = 1648463406.1736853\r\n[  106s]         when       = 'call'\r\n[  106s] /usr/lib/python3.9/site-packages/_pytest/runner.py:259: in <lambda>\r\n[  106s]     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\r\n[  106s]         ihook      = <_HookCaller 'pytest_runtest_call'>\r\n[  106s]         item       = <Function test_async_with_session>\r\n[  106s]         kwds       = {}\r\n[  106s] /usr/lib/python3.9/site-packages/pluggy/_hooks.py:265: in __call__\r\n[  106s]     return self._hookexec(self.name, self.get_hookimpls(), kwargs, firstresult)\r\n[  106s]         argname    = 'item'\r\n[  106s]         args       = ()\r\n[  106s]         firstresult = False\r\n[  106s]         kwargs     = {'item': <Function test_async_with_session>}\r\n[  106s]         self       = <_HookCaller 'pytest_runtest_call'>\r\n[  106s] /usr/lib/python3.9/site-packages/pluggy/_manager.py:80: in _hookexec\r\n[  106s]     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\r\n[  106s]         firstresult = False\r\n[  106s]         hook_name  = 'pytest_runtest_call'\r\n[  106s]         kwargs     = {'item': <Function test_async_with_session>}\r\n[  106s]         methods    = [<HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/usr/lib/python3.9/site-packages/_pytest/runner.py'>>,\r\n[  106s]  <HookImpl plugin_name='skipping', plugin=<module '_pytest.skipping' from '/usr/lib/python3.9/site-packages/_pytest/skipping.py'>>,\r\n[  106s]  <HookImpl plugin_name='timeout', plugin=<module 'pytest_timeout' from '/usr/lib/python3.9/site-packages/pytest_timeout.py'>>,\r\n[  106s]  <HookImpl plugin_name='capturemanager', plugin=<CaptureManager _method='fd' _global_capturing=<MultiCapture out=<FDCapture 1 oldfd=5 _state='suspended' tmpfile=<_io.TextIOWrapper name=\"<_io.FileIO name=6 mode='rb+' closefd=True>\" mode='r+' encoding='utf-8'>> err=<FDCapture 2 oldfd=7 _state='suspended' tmpfile=<_io.TextIOWrapper name=\"<_io.FileIO name=8 mode='rb+' closefd=True>\" mode='r+' encoding='utf-8'>> in_=<FDCapture 0 oldfd=3 _state='started' tmpfile=<_io.TextIOWrapper name='/dev/null' mode='r' encoding='UTF-8'>> _state='suspended' _in_suspended=False> _capture_fixture=None>>,\r\n[  106s]  <HookImpl plugin_name='logging-plugin', plugin=<_pytest.logging.LoggingPlugin object at 0x7f7435a2d910>>,\r\n[  106s]  <HookImpl plugin_name='unraisableexception', plugin=<module '_pytest.unraisableexception' from '/usr/lib/python3.9/site-packages/_pytest/unraisableexception.py'>>,\r\n[  106s]  <HookImpl plugin_name='threadexception', plugin=<module '_pytest.threadexception' from '/usr/lib/python3.9/site-packages/_pytest/threadexception.py'>>]\r\n[  106s]         self       = <_pytest.config.PytestPluginManager object at 0x7f7437ca8f70>\r\n[  106s] /usr/lib/python3.9/site-packages/_pytest/runner.py:174: in pytest_runtest_call\r\n[  106s]     raise e\r\n[  106s]         item       = <Function test_async_with_session>\r\n[  106s] /usr/lib/python3.9/site-packages/_pytest/runner.py:166: in pytest_runtest_call\r\n[  106s]     item.runtest()\r\n[  106s]         item       = <Function test_async_with_session>\r\n[  106s] /usr/lib/python3.9/site-packages/_pytest/python.py:1761: in runtest\r\n[  106s]     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\r\n[  106s]         self       = <Function test_async_with_session>\r\n[  106s] /usr/lib/python3.9/site-packages/pluggy/_hooks.py:265: in __call__\r\n[  106s]     return self._hookexec(self.name, self.get_hookimpls(), kwargs, firstresult)\r\n[  106s]         argname    = 'pyfuncitem'\r\n[  106s]         args       = ()\r\n[  106s]         firstresult = True\r\n[  106s]         kwargs     = {'pyfuncitem': <Function test_async_with_session>}\r\n[  106s]         self       = <_HookCaller 'pytest_pyfunc_call'>\r\n[  106s] /usr/lib/python3.9/site-packages/pluggy/_manager.py:80: in _hookexec\r\n[  106s]     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\r\n[  106s]         firstresult = True\r\n[  106s]         hook_name  = 'pytest_pyfunc_call'\r\n[  106s]         kwargs     = {'pyfuncitem': <Function test_async_with_session>}\r\n[  106s]         methods    = [<HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/usr/lib/python3.9/site-packages/_pytest/python.py'>>,\r\n[  106s]  <HookImpl plugin_name='aiohttp.pytest_plugin', plugin=<module 'aiohttp.pytest_plugin' from '/home/abuild/rpmbuild/BUILDROOT/python-aiohttp-3.8.1-0.x86_64/usr/lib64/python3.9/site-packages/aiohttp/pytest_plugin.py'>>]\r\n[  106s]         self       = <_pytest.config.PytestPluginManager object at 0x7f7437ca8f70>\r\n[  106s] ../../BUILDROOT/python-aiohttp-3.8.1-0.x86_64/usr/lib64/python3.9/site-packages/aiohttp/pytest_plugin.py:186: in pytest_pyfunc_call\r\n[  106s]     _loop.run_until_complete(pyfuncitem.obj(**testargs))\r\n[  106s]         _loop      = <_UnixSelectorEventLoop running=False closed=False debug=False>\r\n[  106s]         existing_loop = None\r\n[  106s]         fast       = False\r\n[  106s]         pyfuncitem = <Function test_async_with_session>\r\n[  106s]         testargs   = {}\r\n[  106s] /usr/lib64/python3.9/asyncio/base_events.py:642: in run_until_complete\r\n[  106s]     return future.result()\r\n[  106s]         future     = <Task finished name='Task-1096' coro=<test_async_with_session() done, defined at /home/abuild/rpmbuild/BUILD/aiohttp-3.8.1/tests/test_client_functional.py:2430> exception=PytestRemovedIn8Warning('Passing None has been deprecated.\\nSee https://docs.pytest.org/en/latest/how-to/capture-warnings.html#additional-use-cases-of-warnings-in-tests for alternatives in common use cases.')>\r\n[  106s]         new_task   = True\r\n[  106s]         self       = <_UnixSelectorEventLoop running=False closed=False debug=False>\r\n[  106s] tests/test_client_functional.py:2431: in test_async_with_session\r\n[  106s]     with pytest.warns(None) as cm:\r\n[  106s] _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n[  106s] \r\n[  106s] self = WarningsChecker(record=True), expected_warning = None, match_expr = None\r\n[  106s] \r\n[  106s]     def __init__(\r\n[  106s]         self,\r\n[  106s]         expected_warning: Optional[\r\n[  106s]             Union[Type[Warning], Tuple[Type[Warning], ...]]\r\n[  106s]         ] = Warning,\r\n[  106s]         match_expr: Optional[Union[str, Pattern[str]]] = None,\r\n[  106s]         *,\r\n[  106s]         _ispytest: bool = False,\r\n[  106s]     ) -> None:\r\n[  106s]         check_ispytest(_ispytest)\r\n[  106s]         super().__init__(_ispytest=True)\r\n[  106s]     \r\n[  106s]         msg = \"exceptions must be derived from Warning, not %s\"\r\n[  106s]         if expected_warning is None:\r\n[  106s] >           warnings.warn(WARNS_NONE_ARG, stacklevel=4)\r\n[  106s] E           pytest.PytestRemovedIn8Warning: Passing None has been deprecated.\r\n[  106s] E           See https://docs.pytest.org/en/latest/how-to/capture-warnings.html#additional-use-cases-of-warnings-in-tests for alternatives in common use cases.\r\n[  106s] \r\n[  106s] __class__  = <class '_pytest.recwarn.WarningsChecker'>\r\n[  106s] _ispytest  = True\r\n[  106s] expected_warning = None\r\n[  106s] match_expr = None\r\n[  106s] msg        = 'exceptions must be derived from Warning, not %s'\r\n[  106s] self       = WarningsChecker(record=True)\r\n[  106s] \r\n[  106s] /usr/lib/python3.9/site-packages/_pytest/recwarn.py:246: PytestRemovedIn8Warning\r\n[  106s] _________________ test_close_run_until_complete_not_deprecated _________________\r\n[  106s] \r\n[  106s]     async def test_close_run_until_complete_not_deprecated() -> None:\r\n[  106s]         session = aiohttp.ClientSession()\r\n[  106s]     \r\n[  106s] >       with pytest.warns(None) as cm:\r\n[  106s] \r\n[  106s] session    = <aiohttp.client.ClientSession object at 0x7f74330d5100>\r\n[  106s] \r\n[  106s] tests/test_client_functional.py:2451: \r\n[  106s] _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n[  106s] /usr/lib/python3.9/site-packages/_pytest/recwarn.py:246: in __init__\r\n[  106s]     warnings.warn(WARNS_NONE_ARG, stacklevel=4)\r\n[  106s]         __class__  = <class '_pytest.recwarn.WarningsChecker'>\r\n[  106s]         _ispytest  = True\r\n[  106s]         expected_warning = None\r\n[  106s]         match_expr = None\r\n[  106s]         msg        = 'exceptions must be derived from Warning, not %s'\r\n[  106s]         self       = WarningsChecker(record=True)\r\n[  106s] /usr/lib/python3.9/site-packages/_pytest/runner.py:338: in from_call\r\n[  106s]     result: Optional[TResult] = func()\r\n[  106s]         cls        = <class '_pytest.runner.CallInfo'>\r\n[  106s]         duration   = 0.00033854299999802606\r\n[  106s]         excinfo    = <ExceptionInfo PytestRemovedIn8Warning('Passing None has been deprecated.\\nSee https://docs.pytest.org/en/latest/how-to/capture-warnings.html#additional-use-cases-of-warnings-in-tests for alternatives in common use cases.') tblen=15>\r\n[  106s]         func       = <function call_runtest_hook.<locals>.<lambda> at 0x7f7434aa0dc0>\r\n[  106s]         precise_start = 881.032735979\r\n[  106s]         precise_stop = 881.033074522\r\n[  106s]         reraise    = (<class '_pytest.outcomes.Exit'>, <class 'KeyboardInterrupt'>)\r\n[  106s]         result     = None\r\n[  106s]         start      = 1648463406.2135112\r\n[  106s]         stop       = 1648463406.21385\r\n[  106s]         when       = 'call'\r\n[  106s] /usr/lib/python3.9/site-packages/_pytest/runner.py:259: in <lambda>\r\n[  106s]     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\r\n[  106s]         ihook      = <_HookCaller 'pytest_runtest_call'>\r\n[  106s]         item       = <Function test_session_close_awaitable>\r\n[  106s]         kwds       = {}\r\n[  106s] /usr/lib/python3.9/site-packages/pluggy/_hooks.py:265: in __call__\r\n[  106s]     return self._hookexec(self.name, self.get_hookimpls(), kwargs, firstresult)\r\n[  106s]         argname    = 'item'\r\n[  106s]         args       = ()\r\n[  106s]         firstresult = False\r\n[  106s]         kwargs     = {'item': <Function test_session_close_awaitable>}\r\n[  106s]         self       = <_HookCaller 'pytest_runtest_call'>\r\n[  106s] /usr/lib/python3.9/site-packages/pluggy/_manager.py:80: in _hookexec\r\n[  106s]     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\r\n[  106s]         firstresult = False\r\n[  106s]         hook_name  = 'pytest_runtest_call'\r\n[  106s]         kwargs     = {'item': <Function test_session_close_awaitable>}\r\n[  106s]         methods    = [<HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/usr/lib/python3.9/site-packages/_pytest/runner.py'>>,\r\n[  106s]  <HookImpl plugin_name='skipping', plugin=<module '_pytest.skipping' from '/usr/lib/python3.9/site-packages/_pytest/skipping.py'>>,\r\n[  106s]  <HookImpl plugin_name='timeout', plugin=<module 'pytest_timeout' from '/usr/lib/python3.9/site-packages/pytest_timeout.py'>>,\r\n[  106s]  <HookImpl plugin_name='capturemanager', plugin=<CaptureManager _method='fd' _global_capturing=<MultiCapture out=<FDCapture 1 oldfd=5 _state='suspended' tmpfile=<_io.TextIOWrapper name=\"<_io.FileIO name=6 mode='rb+' closefd=True>\" mode='r+' encoding='utf-8'>> err=<FDCapture 2 oldfd=7 _state='suspended' tmpfile=<_io.TextIOWrapper name=\"<_io.FileIO name=8 mode='rb+' closefd=True>\" mode='r+' encoding='utf-8'>> in_=<FDCapture 0 oldfd=3 _state='started' tmpfile=<_io.TextIOWrapper name='/dev/null' mode='r' encoding='UTF-8'>> _state='suspended' _in_suspended=False> _capture_fixture=None>>,\r\n[  106s]  <HookImpl plugin_name='logging-plugin', plugin=<_pytest.logging.LoggingPlugin object at 0x7f7435a2d910>>,\r\n[  106s]  <HookImpl plugin_name='unraisableexception', plugin=<module '_pytest.unraisableexception' from '/usr/lib/python3.9/site-packages/_pytest/unraisableexception.py'>>,\r\n[  106s]  <HookImpl plugin_name='threadexception', plugin=<module '_pytest.threadexception' from '/usr/lib/python3.9/site-packages/_pytest/threadexception.py'>>]\r\n[  106s]         self       = <_pytest.config.PytestPluginManager object at 0x7f7437ca8f70>\r\n[  106s] /usr/lib/python3.9/site-packages/_pytest/runner.py:174: in pytest_runtest_call\r\n[  106s]     raise e\r\n[  106s]         item       = <Function test_session_close_awaitable>\r\n[  106s] /usr/lib/python3.9/site-packages/_pytest/runner.py:166: in pytest_runtest_call\r\n[  106s]     item.runtest()\r\n[  106s]         item       = <Function test_session_close_awaitable>\r\n[  106s] /usr/lib/python3.9/site-packages/_pytest/python.py:1761: in runtest\r\n[  106s]     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\r\n[  106s]         self       = <Function test_session_close_awaitable>\r\n[  106s] /usr/lib/python3.9/site-packages/pluggy/_hooks.py:265: in __call__\r\n[  106s]     return self._hookexec(self.name, self.get_hookimpls(), kwargs, firstresult)\r\n[  106s]         argname    = 'pyfuncitem'\r\n[  106s]         args       = ()\r\n[  106s]         firstresult = True\r\n[  106s]         kwargs     = {'pyfuncitem': <Function test_session_close_awaitable>}\r\n[  106s]         self       = <_HookCaller 'pytest_pyfunc_call'>\r\n[  106s] /usr/lib/python3.9/site-packages/pluggy/_manager.py:80: in _hookexec\r\n[  106s]     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\r\n[  106s]         firstresult = True\r\n[  106s]         hook_name  = 'pytest_pyfunc_call'\r\n[  106s]         kwargs     = {'pyfuncitem': <Function test_session_close_awaitable>}\r\n[  106s]         methods    = [<HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/usr/lib/python3.9/site-packages/_pytest/python.py'>>,\r\n[  106s]  <HookImpl plugin_name='aiohttp.pytest_plugin', plugin=<module 'aiohttp.pytest_plugin' from '/home/abuild/rpmbuild/BUILDROOT/python-aiohttp-3.8.1-0.x86_64/usr/lib64/python3.9/site-packages/aiohttp/pytest_plugin.py'>>]\r\n[  106s]         self       = <_pytest.config.PytestPluginManager object at 0x7f7437ca8f70>\r\n[  106s] ../../BUILDROOT/python-aiohttp-3.8.1-0.x86_64/usr/lib64/python3.9/site-packages/aiohttp/pytest_plugin.py:186: in pytest_pyfunc_call\r\n[  106s]     _loop.run_until_complete(pyfuncitem.obj(**testargs))\r\n[  106s]         _loop      = <_UnixSelectorEventLoop running=False closed=False debug=False>\r\n[  106s]         existing_loop = None\r\n[  106s]         fast       = False\r\n[  106s]         pyfuncitem = <Function test_session_close_awaitable>\r\n[  106s]         testargs   = {}\r\n[  106s] /usr/lib64/python3.9/asyncio/base_events.py:642: in run_until_complete\r\n[  106s]     return future.result()\r\n[  106s]         future     = <Task finished name='Task-1097' coro=<test_session_close_awaitable() done, defined at /home/abuild/rpmbuild/BUILD/aiohttp-3.8.1/tests/test_client_functional.py:2439> exception=PytestRemovedIn8Warning('Passing None has been deprecated.\\nSee https://docs.pytest.org/en/latest/how-to/capture-warnings.html#additional-use-cases-of-warnings-in-tests for alternatives in common use cases.')>\r\n[  106s]         new_task   = True\r\n[  106s]         self       = <_UnixSelectorEventLoop running=False closed=False debug=False>\r\n[  106s] tests/test_client_functional.py:2441: in test_session_close_awaitable\r\n[  106s]     with pytest.warns(None) as cm:\r\n[  106s]         session    = <aiohttp.client.ClientSession object at 0x7f74353d5400>\r\n[  106s] /usr/lib/python3.9/site-packages/_pytest/recwarn.py:246: in __init__\r\n[  106s]     warnings.warn(WARNS_NONE_ARG, stacklevel=4)\r\n[  106s]         __class__  = <class '_pytest.recwarn.WarningsChecker'>\r\n[  106s]         _ispytest  = True\r\n[  106s]         expected_warning = None\r\n[  106s]         match_expr = None\r\n[  106s]         msg        = 'exceptions must be derived from Warning, not %s'\r\n[  106s]         self       = WarningsChecker(record=True)\r\n[  106s] /usr/lib/python3.9/site-packages/_pytest/runner.py:338: in from_call\r\n[  106s]     result: Optional[TResult] = func()\r\n[  106s]         cls        = <class '_pytest.runner.CallInfo'>\r\n[  106s]         duration   = 0.0002979149999191577\r\n[  106s]         excinfo    = <ExceptionInfo PytestRemovedIn8Warning('Passing None has been deprecated.\\nSee https://docs.pytest.org/en/latest/how-to/capture-warnings.html#additional-use-cases-of-warnings-in-tests for alternatives in common use cases.') tblen=2>\r\n[  106s]         func       = <function call_runtest_hook.<locals>.<lambda> at 0x7f74333c05e0>\r\n[  106s]         precise_start = 880.992611685\r\n[  106s]         precise_stop = 880.9929096\r\n[  106s]         reraise    = (<class '_pytest.outcomes.Exit'>, <class 'KeyboardInterrupt'>)\r\n[  106s]         result     = None\r\n[  106s]         start      = 1648463406.1733868\r\n[  106s]         stop       = 1648463406.1736853\r\n[  106s]         when       = 'call'\r\n[  106s] /usr/lib/python3.9/site-packages/_pytest/runner.py:259: in <lambda>\r\n[  106s]     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\r\n[  106s]         ihook      = <_HookCaller 'pytest_runtest_call'>\r\n[  106s]         item       = <Function test_async_with_session>\r\n[  106s]         kwds       = {}\r\n[  106s] /usr/lib/python3.9/site-packages/pluggy/_hooks.py:265: in __call__\r\n[  106s]     return self._hookexec(self.name, self.get_hookimpls(), kwargs, firstresult)\r\n[  106s]         argname    = 'item'\r\n[  106s]         args       = ()\r\n[  106s]         firstresult = False\r\n[  106s]         kwargs     = {'item': <Function test_async_with_session>}\r\n[  106s]         self       = <_HookCaller 'pytest_runtest_call'>\r\n[  106s] /usr/lib/python3.9/site-packages/pluggy/_manager.py:80: in _hookexec\r\n[  106s]     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\r\n[  106s]         firstresult = False\r\n[  106s]         hook_name  = 'pytest_runtest_call'\r\n[  106s]         kwargs     = {'item': <Function test_async_with_session>}\r\n[  106s]         methods    = [<HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/usr/lib/python3.9/site-packages/_pytest/runner.py'>>,\r\n[  106s]  <HookImpl plugin_name='skipping', plugin=<module '_pytest.skipping' from '/usr/lib/python3.9/site-packages/_pytest/skipping.py'>>,\r\n[  106s]  <HookImpl plugin_name='timeout', plugin=<module 'pytest_timeout' from '/usr/lib/python3.9/site-packages/pytest_timeout.py'>>,\r\n[  106s]  <HookImpl plugin_name='capturemanager', plugin=<CaptureManager _method='fd' _global_capturing=<MultiCapture out=<FDCapture 1 oldfd=5 _state='suspended' tmpfile=<_io.TextIOWrapper name=\"<_io.FileIO name=6 mode='rb+' closefd=True>\" mode='r+' encoding='utf-8'>> err=<FDCapture 2 oldfd=7 _state='suspended' tmpfile=<_io.TextIOWrapper name=\"<_io.FileIO name=8 mode='rb+' closefd=True>\" mode='r+' encoding='utf-8'>> in_=<FDCapture 0 oldfd=3 _state='started' tmpfile=<_io.TextIOWrapper name='/dev/null' mode='r' encoding='UTF-8'>> _state='suspended' _in_suspended=False> _capture_fixture=None>>,\r\n[  106s]  <HookImpl plugin_name='logging-plugin', plugin=<_pytest.logging.LoggingPlugin object at 0x7f7435a2d910>>,\r\n[  106s]  <HookImpl plugin_name='unraisableexception', plugin=<module '_pytest.unraisableexception' from '/usr/lib/python3.9/site-packages/_pytest/unraisableexception.py'>>,\r\n[  106s]  <HookImpl plugin_name='threadexception', plugin=<module '_pytest.threadexception' from '/usr/lib/python3.9/site-packages/_pytest/threadexception.py'>>]\r\n[  106s]         self       = <_pytest.config.PytestPluginManager object at 0x7f7437ca8f70>\r\n[  106s] /usr/lib/python3.9/site-packages/_pytest/runner.py:174: in pytest_runtest_call\r\n[  106s]     raise e\r\n[  106s]         item       = <Function test_async_with_session>\r\n[  106s] /usr/lib/python3.9/site-packages/_pytest/runner.py:166: in pytest_runtest_call\r\n[  106s]     item.runtest()\r\n[  106s]         item       = <Function test_async_with_session>\r\n[  106s] /usr/lib/python3.9/site-packages/_pytest/python.py:1761: in runtest\r\n[  106s]     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\r\n[  106s]         self       = <Function test_async_with_session>\r\n[  106s] /usr/lib/python3.9/site-packages/pluggy/_hooks.py:265: in __call__\r\n[  106s]     return self._hookexec(self.name, self.get_hookimpls(), kwargs, firstresult)\r\n[  106s]         argname    = 'pyfuncitem'\r\n[  106s]         args       = ()\r\n[  106s]         firstresult = True\r\n[  106s]         kwargs     = {'pyfuncitem': <Function test_async_with_session>}\r\n[  106s]         self       = <_HookCaller 'pytest_pyfunc_call'>\r\n[  106s] /usr/lib/python3.9/site-packages/pluggy/_manager.py:80: in _hookexec\r\n[  106s]     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\r\n[  106s]         firstresult = True\r\n[  106s]         hook_name  = 'pytest_pyfunc_call'\r\n[  106s]         kwargs     = {'pyfuncitem': <Function test_async_with_session>}\r\n[  106s]         methods    = [<HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/usr/lib/python3.9/site-packages/_pytest/python.py'>>,\r\n[  106s]  <HookImpl plugin_name='aiohttp.pytest_plugin', plugin=<module 'aiohttp.pytest_plugin' from '/home/abuild/rpmbuild/BUILDROOT/python-aiohttp-3.8.1-0.x86_64/usr/lib64/python3.9/site-packages/aiohttp/pytest_plugin.py'>>]\r\n[  106s]         self       = <_pytest.config.PytestPluginManager object at 0x7f7437ca8f70>\r\n[  106s] ../../BUILDROOT/python-aiohttp-3.8.1-0.x86_64/usr/lib64/python3.9/site-packages/aiohttp/pytest_plugin.py:186: in pytest_pyfunc_call\r\n[  106s]     _loop.run_until_complete(pyfuncitem.obj(**testargs))\r\n[  106s]         _loop      = <_UnixSelectorEventLoop running=False closed=False debug=False>\r\n[  106s]         existing_loop = None\r\n[  106s]         fast       = False\r\n[  106s]         pyfuncitem = <Function test_async_with_session>\r\n[  106s]         testargs   = {}\r\n[  106s] /usr/lib64/python3.9/asyncio/base_events.py:642: in run_until_complete\r\n[  106s]     return future.result()\r\n[  106s]         future     = <Task finished name='Task-1096' coro=<test_async_with_session() done, defined at /home/abuild/rpmbuild/BUILD/aiohttp-3.8.1/tests/test_client_functional.py:2430> exception=PytestRemovedIn8Warning('Passing None has been deprecated.\\nSee https://docs.pytest.org/en/latest/how-to/capture-warnings.html#additional-use-cases-of-warnings-in-tests for alternatives in common use cases.')>\r\n[  106s]         new_task   = True\r\n[  106s]         self       = <_UnixSelectorEventLoop running=False closed=False debug=False>\r\n[  106s] tests/test_client_functional.py:2431: in test_async_with_session\r\n[  106s]     with pytest.warns(None) as cm:\r\n[  106s] _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n[  106s] \r\n[  106s] self = WarningsChecker(record=True), expected_warning = None, match_expr = None\r\n[  106s] \r\n[  106s]     def __init__(\r\n[  106s]         self,\r\n[  106s]         expected_warning: Optional[\r\n[  106s]             Union[Type[Warning], Tuple[Type[Warning], ...]]\r\n[  106s]         ] = Warning,\r\n[  106s]         match_expr: Optional[Union[str, Pattern[str]]] = None,\r\n[  106s]         *,\r\n[  106s]         _ispytest: bool = False,\r\n[  106s]     ) -> None:\r\n[  106s]         check_ispytest(_ispytest)\r\n[  106s]         super().__init__(_ispytest=True)\r\n[  106s]     \r\n[  106s]         msg = \"exceptions must be derived from Warning, not %s\"\r\n[  106s]         if expected_warning is None:\r\n[  106s] >           warnings.warn(WARNS_NONE_ARG, stacklevel=4)\r\n[  106s] E           pytest.PytestRemovedIn8Warning: Passing None has been deprecated.\r\n[  106s] E           See https://docs.pytest.org/en/latest/how-to/capture-warnings.html#additional-use-cases-of-warnings-in-tests for alternatives in common use cases.\r\n[  106s] \r\n[  106s] __class__  = <class '_pytest.recwarn.WarningsChecker'>\r\n[  106s] _ispytest  = True\r\n[  106s] expected_warning = None\r\n[  106s] match_expr = None\r\n[  106s] msg        = 'exceptions must be derived from Warning, not %s'\r\n[  106s] self       = WarningsChecker(record=True)\r\n[  106s] \r\n[  106s] /usr/lib/python3.9/site-packages/_pytest/recwarn.py:246: PytestRemovedIn8Warning\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n[   22s] ============================= test session starts ==============================\r\n[   22s] platform linux -- Python 3.9.10, pytest-7.1.1, pluggy-1.0.0 -- /usr/bin/python3.9\r\n[   22s] cachedir: .pytest_cache\r\n[   22s] rootdir: /home/abuild/rpmbuild/BUILD/aiohttp-3.8.1, configfile: setup.cfg, testpaths: tests/\r\n[   22s] plugins: timeout-2.0.2, mock-3.6.1\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n3.8.1\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n6.0.2\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n1.7.2\r\n```\r\n\r\n\r\n### OS\r\n\r\nopenSUSE Tumbleweed Linux\r\n\r\n### Related component\r\n\r\nServer, Client\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6663/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6663/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6655", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6655/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6655/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6655/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6655", "id": 1167009107, "node_id": "I_kwDOAMpNN85FjyVT", "number": 6655, "title": "EmptyStreamReader instances raise an exception when printed", "user": {"login": "wmsmith", "id": 865121, "node_id": "MDQ6VXNlcjg2NTEyMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/865121?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wmsmith", "html_url": "https://github.com/wmsmith", "followers_url": "https://api.github.com/users/wmsmith/followers", "following_url": "https://api.github.com/users/wmsmith/following{/other_user}", "gists_url": "https://api.github.com/users/wmsmith/gists{/gist_id}", "starred_url": "https://api.github.com/users/wmsmith/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wmsmith/subscriptions", "organizations_url": "https://api.github.com/users/wmsmith/orgs", "repos_url": "https://api.github.com/users/wmsmith/repos", "events_url": "https://api.github.com/users/wmsmith/events{/privacy}", "received_events_url": "https://api.github.com/users/wmsmith/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-03-11T23:49:29Z", "updated_at": "2023-03-15T14:39:40Z", "closed_at": "2023-03-15T14:39:40Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nI have code that uses `aiohttp` and is attempting to log the body of responses.  If the response is an instance of `EmptyStreamReader`, an exception is raised.  \r\n\r\nThis happens because `EmptyStreamReader` does not define `__str__`, and thus falls back to the `__repr__` it inherits from its parent (`StreamReader`), which reads attributes defined in the parent's `__init__` but are not defined for `EmptyStreamReader` since version 3.8.0 (commit https://github.com/aio-libs/aiohttp/pull/5270/commits/dac7994d9afce3dd43948a47162f9c7633ecf38a) when code was added to prevent executing the parent's `__init__`.\n\n### To Reproduce\n\n1.  Create an instance of `EmptyStreamReader`\r\n2. Try to print the instance\r\n\r\nEg:\r\n```\r\n>>> from aiohttp.streams import EmptyStreamReader\r\n>>> es = EmptyStreamReader()\r\n>>> print(es)\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/home/wayne/development/aiohttp/aiohttp/streams.py\", line 130, in __repr__\r\n    if self._size:\r\nAttributeError: 'EmptyStreamReader' object has no attribute '_size'\r\n```\n\n### Expected behavior\n\nThe instance of `EmptyStreamReader` should not raise when printed.  \n\n### Logs/tracebacks\n\n```python-traceback\n[ERROR] AttributeError: 'EmptyStreamReader' object has no attribute '_size'\r\nTraceback (most recent call last):\r\n  File \"/var/task/main.py\", line 115, in handler\r\n    event_loop.run_until_complete(asyncio.gather(*tasks))\r\n  File \"/var/lang/lib/python3.7/asyncio/base_events.py\", line 587, in run_until_complete\r\n    return future.result()\r\n  File \"/var/task/aiobotocore/client.py\", line 89, in _make_api_call\r\n    operation_model, request_dict, request_context)\r\n  File \"/var/task/aiobotocore/client.py\", line 110, in _make_request\r\n    request_dict)\r\n  File \"/var/task/aiobotocore/endpoint.py\", line 73, in _send_request\r\n    request, operation_model, context)\r\n  File \"/var/task/aiobotocore/endpoint.py\", line 106, in _get_response\r\n    request, operation_model)\r\n  File \"/var/task/aiobotocore/endpoint.py\", line 164, in _do_get_response\r\n    response_dict, operation_model.output_shape)\r\n  File \"/var/task/botocore/parsers.py\", line 235, in parse\r\n    LOG.debug('Response body:\\n%s', response['body'])\r\n  File \"/var/lang/lib/python3.7/logging/__init__.py\", line 1366, in debug\r\n    self._log(DEBUG, msg, args, **kwargs)\r\n  File \"/var/lang/lib/python3.7/logging/__init__.py\", line 1514, in _log\r\n    self.handle(record)\r\n  File \"/var/lang/lib/python3.7/logging/__init__.py\", line 1524, in handle\r\n    self.callHandlers(record)\r\n  File \"/var/lang/lib/python3.7/logging/__init__.py\", line 1586, in callHandlers\r\n    hdlr.handle(record)\r\n  File \"/var/lang/lib/python3.7/logging/__init__.py\", line 894, in handle\r\n    self.emit(record)\r\n  File \"/var/runtime/bootstrap.py\", line 239, in emit\r\n    msg = self.format(record)\r\n  File \"/var/lang/lib/python3.7/logging/__init__.py\", line 869, in format\r\n    return fmt.format(record)\r\n  File \"/var/lang/lib/python3.7/logging/__init__.py\", line 608, in format\r\n    record.message = record.getMessage()\r\n  File \"/var/lang/lib/python3.7/logging/__init__.py\", line 369, in getMessage\r\n    msg = msg % self.args\r\n  File \"/var/task/wrapt/wrappers.py\", line 117, in __str__\r\n    return str(self.__wrapped__)\r\n  File \"/var/task/wrapt/wrappers.py\", line 117, in __str__\r\n    return str(self.__wrapped__)\r\n  File \"/var/task/aiohttp/streams.py\", line 132, in __repr__\r\n    if self._size:\r\n[ERROR] AttributeError: 'EmptyStreamReader' object has no attribute '_size' Traceback (most recent call last):   File \"/var/task/main.py\", line 115, in handler     event_loop.run_until_complete(asyncio.gather(*tasks))   File \"/var/lang/lib/python3.7/asyncio/base_events.py\", line 587, in run_until_complete     return future.result()   File \"/var/task/aiobotocore/client.py\", line 89, in _make_api_call     operation_model, request_dict, request_context)   File \"/var/task/aiobotocore/client.py\", line 110, in _make_request     request_dict)   File \"/var/task/aiobotocore/endpoint.py\", line 73, in _send_request     request, operation_model, context)   File \"/var/task/aiobotocore/endpoint.py\", line 106, in _get_response     request, operation_model)   File \"/var/task/aiobotocore/endpoint.py\", line 164, in _do_get_response     response_dict, operation_model.output_shape)   File \"/var/task/botocore/parsers.py\", line 235, in parse     LOG.debug('Response body:\\n%s', response['body'])   File \"/var/lang/lib/python3.7/logging/__init__.py\", line 1366, in debug     self._log(DEBUG, msg, args, **kwargs)   File \"/var/lang/lib/python3.7/logging/__init__.py\", line 1514, in _log     self.handle(record)   File \"/var/lang/lib/python3.7/logging/__init__.py\", line 1524, in handle     self.callHandlers(record)   File \"/var/lang/lib/python3.7/logging/__init__.py\", line 1586, in callHandlers     hdlr.handle(record)   File \"/var/lang/lib/python3.7/logging/__init__.py\", line 894, in handle     self.emit(record)   File \"/var/runtime/bootstrap.py\", line 239, in emit     msg = self.format(record)   File \"/var/lang/lib/python3.7/logging/__init__.py\", line 869, in format     return fmt.format(record)   File \"/var/lang/lib/python3.7/logging/__init__.py\", line 608, in format     record.message = record.getMessage()   File \"/var/lang/lib/python3.7/logging/__init__.py\", line 369, in getMessage     msg = msg % self.args   File \"/var/task/wrapt/wrappers.py\", line 117, in __str__     return str(self.__wrapped__)   File \"/var/task/wrapt/wrappers.py\", line 117, in __str__     return str(self.__wrapped__)   File \"/var/task/aiohttp/streams.py\", line 132, in __repr__     if self._size:\n```\n\n\n### Python Version\n\n```console\n3.7.12\n```\n\n\n### aiohttp Version\n\n```console\n3.8.1\n```\n\n\n### multidict Version\n\n```console\n6.0.2\n```\n\n\n### yarl Version\n\n```console\n1.7.2\n```\n\n\n### OS\n\nUbuntu\n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6655/reactions", "total_count": 3, "+1": 3, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6655/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6649", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6649/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6649/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6649/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6649", "id": 1159835389, "node_id": "I_kwDOAMpNN85FIa79", "number": 6649, "title": "TypeError: Cannot serialize non-str key None", "user": {"login": "shehrozkapoor", "id": 59894229, "node_id": "MDQ6VXNlcjU5ODk0MjI5", "avatar_url": "https://avatars.githubusercontent.com/u/59894229?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shehrozkapoor", "html_url": "https://github.com/shehrozkapoor", "followers_url": "https://api.github.com/users/shehrozkapoor/followers", "following_url": "https://api.github.com/users/shehrozkapoor/following{/other_user}", "gists_url": "https://api.github.com/users/shehrozkapoor/gists{/gist_id}", "starred_url": "https://api.github.com/users/shehrozkapoor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shehrozkapoor/subscriptions", "organizations_url": "https://api.github.com/users/shehrozkapoor/orgs", "repos_url": "https://api.github.com/users/shehrozkapoor/repos", "events_url": "https://api.github.com/users/shehrozkapoor/events{/privacy}", "received_events_url": "https://api.github.com/users/shehrozkapoor/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-03-04T16:39:24Z", "updated_at": "2022-03-04T16:53:21Z", "closed_at": "2022-03-04T16:53:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\n![Screenshot 2022-03-04 at 9 32 14 PM](https://user-images.githubusercontent.com/59894229/156802078-a7cc93fe-6fb1-42b0-a706-61b1379354c8.png)\r\ni am getting the response from the server but the response header is in multidict and it saying that cannot serialize non-str key but when i convert it to str it still gave the same that cannot serialize non-str key None\n\n### To Reproduce\n\n![Uploading Screenshot 2022-03-04 at 9.34.46 PM.png\u2026]()\r\n\n\n### Expected behavior\n\ni expected to get print the patients count that is received in the status line\n\n### Logs/tracebacks\n\n```python-traceback\n>>> from billing.fhir import main\r\n>>> import asyncio\r\n>>> loop = asyncio.new_event_loop()\r\n>>> loop.run_until_complete(main())\r\nthis is header i am recieving <CIMultiDict('Host': 'hapi.fhir.org', 'Authorization': None, 'Accept': 'application/json', 'Accept-Encoding': 'gzip, deflate', 'User-Agent': 'Python/3.8 aiohttp/3.8.1')>\r\nTraceback (most recent call last):\r\n  File \"<console>\", line 1, in <module>\r\n  File \"/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py\", line 616, in run_until_complete\r\n    return future.result()\r\n  File \"/Users/shehrozkapoor/Desktop/FIRST_CARE/firstcare/billing/fhir.py\", line 14, in main\r\n    resource_count = await resources.count()\r\n  File \"/Users/shehrozkapoor/Desktop/FIRST_CARE/firstcare/venv/lib/python3.8/site-packages/fhirpy/base/lib.py\", line 282, in count\r\n    await self.client._fetch_resource(self.resource_type, params=new_params)\r\n  File \"/Users/shehrozkapoor/Desktop/FIRST_CARE/firstcare/venv/lib/python3.8/site-packages/fhirpy/base/lib.py\", line 130, in _fetch_resource\r\n    return await self._do_request(\"get\", path, params=params)\r\n  File \"/Users/shehrozkapoor/Desktop/FIRST_CARE/firstcare/venv/lib/python3.8/site-packages/fhirpy/base/lib.py\", line 112, in _do_request\r\n    async with aiohttp.request(method, url, json=data, headers=headers) as r:\r\n  File \"/Users/shehrozkapoor/Desktop/FIRST_CARE/firstcare/venv/lib/python3.8/site-packages/aiohttp/client.py\", line 1186, in __aenter__\r\n    self._resp = await self._coro\r\n  File \"/Users/shehrozkapoor/Desktop/FIRST_CARE/firstcare/venv/lib/python3.8/site-packages/aiohttp/client.py\", line 557, in _request\r\n    resp = await req.send(conn)\r\n  File \"/Users/shehrozkapoor/Desktop/FIRST_CARE/firstcare/venv/lib/python3.8/site-packages/aiohttp/client_reqrep.py\", line 669, in send\r\n    await writer.write_headers(status_line, self.headers)\r\n  File \"/Users/shehrozkapoor/Desktop/FIRST_CARE/firstcare/venv/lib/python3.8/site-packages/aiohttp/http_writer.py\", line 139, in write_headers\r\n    buf = _serialize_headers(status_line, headers)\r\n  File \"aiohttp/_http_writer.pyx\", line 132, in aiohttp._http_writer._serialize_headers\r\n  File \"aiohttp/_http_writer.pyx\", line 109, in aiohttp._http_writer.to_str\r\nTypeError: Cannot serialize non-str key None\r\n>>> >>> .run_until_complete(main())n())\r\nthis is header i am recieving <CIMultiDict('Host': 'hapi.fhir.org', 'Authorization': None, 'Accept': 'application/json', 'Accept-Encoding': 'gzip, deflate', 'User-Agent': 'Python/3.8 aiohttp/3.8.1')>\r\nTraceback (most recent call last):\r\n  File \"<console>\", line 1, in <module>\r\n  File \"/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py\", line 616, in run_until_complete\r\n    return future.result()\r\n  File \"/Users/shehrozkapoor/Desktop/FIRST_CARE/firstcare/billing/fhir.py\", line 14, in main\r\n    resource_count = await resources.count()\r\n  File \"/Users/shehrozkapoor/Desktop/FIRST_CARE/firstcare/venv/lib/python3.8/site-packages/fhirpy/base/lib.py\", line 282, in count\r\n    await self.client._fetch_resource(self.resource_type, params=new_params)\r\n  File \"/Users/shehrozkapoor/Desktop/FIRST_CARE/firstcare/venv/lib/python3.8/site-packages/fhirpy/base/lib.py\", line 130, in _fetch_resource\r\n    return await self._do_request(\"get\", path, params=params)\r\n  File \"/Users/shehrozkapoor/Desktop/FIRST_CARE/firstcare/venv/lib/python3.8/site-packages/fhirpy/base/lib.py\", line 112, in _do_request\r\n    async with aiohttp.request(method, url, json=data, headers=headers) as r:\r\n  File \"/Users/shehrozkapoor/Desktop/FIRST_CARE/firstcare/venv/lib/python3.8/site-packages/aiohttp/client.py\", line 1186, in __aenter__\r\n    self._resp = await self._coro\r\n  File \"/Users/shehrozkapoor/Desktop/FIRST_CARE/firstcare/venv/lib/python3.8/site-packages/aiohttp/client.py\", line 557, in _request\r\n    resp = await req.send(conn)\r\n  File \"/Users/shehrozkapoor/Desktop/FIRST_CARE/firstcare/venv/lib/python3.8/site-packages/aiohttp/client_reqrep.py\", line 669, in send\r\n    await writer.write_headers(status_line, self.headers)\r\n  File \"/Users/shehrozkapoor/Desktop/FIRST_CARE/firstcare/venv/lib/python3.8/site-packages/aiohttp/http_writer.py\", line 139, in write_headers\r\n    buf = _serialize_headers(status_line, str(headers))\r\n  File \"aiohttp/_http_writer.pyx\", line 132, in aiohttp._http_writer._serialize_headers\r\n  File \"aiohttp/_http_writer.pyx\", line 109, in aiohttp._http_writer.to_str\r\nTypeError: Cannot serialize non-str key None\r\n>>> loop.run_until_complete(main())\r\nthis is header i am recieving <CIMultiDict('Host': 'hapi.fhir.org', 'Authorization': None, 'Accept': 'application/json', 'Accept-Encoding': 'gzip, deflate', 'User-Agent': 'Python/3.8 aiohttp/3.8.1')>\r\nTraceback (most recent call last):\r\n  File \"<console>\", line 1, in <module>\r\n  File \"/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py\", line 616, in run_until_complete\r\n    return future.result()\r\n  File \"/Users/shehrozkapoor/Desktop/FIRST_CARE/firstcare/billing/fhir.py\", line 14, in main\r\n    resource_count = await resources.count()\r\n  File \"/Users/shehrozkapoor/Desktop/FIRST_CARE/firstcare/venv/lib/python3.8/site-packages/fhirpy/base/lib.py\", line 282, in count\r\n    await self.client._fetch_resource(self.resource_type, params=new_params)\r\n  File \"/Users/shehrozkapoor/Desktop/FIRST_CARE/firstcare/venv/lib/python3.8/site-packages/fhirpy/base/lib.py\", line 130, in _fetch_resource\r\n    return await self._do_request(\"get\", path, params=params)\r\n  File \"/Users/shehrozkapoor/Desktop/FIRST_CARE/firstcare/venv/lib/python3.8/site-packages/fhirpy/base/lib.py\", line 112, in _do_request\r\n    async with aiohttp.request(method, url, json=data, headers=headers) as r:\r\n  File \"/Users/shehrozkapoor/Desktop/FIRST_CARE/firstcare/venv/lib/python3.8/site-packages/aiohttp/client.py\", line 1186, in __aenter__\r\n    self._resp = await self._coro\r\n  File \"/Users/shehrozkapoor/Desktop/FIRST_CARE/firstcare/venv/lib/python3.8/site-packages/aiohttp/client.py\", line 557, in _request\r\n    resp = await req.send(conn)\r\n  File \"/Users/shehrozkapoor/Desktop/FIRST_CARE/firstcare/venv/lib/python3.8/site-packages/aiohttp/client_reqrep.py\", line 669, in send\r\n    await writer.write_headers(status_line, self.headers)\r\n  File \"/Users/shehrozkapoor/Desktop/FIRST_CARE/firstcare/venv/lib/python3.8/site-packages/aiohttp/http_writer.py\", line 139, in write_headers\r\n    buf = _serialize_headers(status_line, str(headers))\r\n  File \"aiohttp/_http_writer.pyx\", line 132, in aiohttp._http_writer._serialize_headers\r\n  File \"aiohttp/_http_writer.pyx\", line 109, in aiohttp._http_writer.to_str\r\nTypeError: Cannot serialize non-str key None\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\nPython 3.8.9\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.8.1\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 6.0.2\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.7.2\n```\n\n\n### OS\n\nmacOS\n\n### Related component\n\nServer, Client\n\n### Additional context\n\ni am using the dajngo i need to implement the fhir i get the header response in multiDict but it cannot serialize the multiDict\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6649/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6649/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6639", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6639/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6639/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6639/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6639", "id": 1154817446, "node_id": "I_kwDOAMpNN85E1R2m", "number": 6639, "title": "Invalid Argument Error", "user": {"login": "Nebulizer1213", "id": 79063894, "node_id": "MDQ6VXNlcjc5MDYzODk0", "avatar_url": "https://avatars.githubusercontent.com/u/79063894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nebulizer1213", "html_url": "https://github.com/Nebulizer1213", "followers_url": "https://api.github.com/users/Nebulizer1213/followers", "following_url": "https://api.github.com/users/Nebulizer1213/following{/other_user}", "gists_url": "https://api.github.com/users/Nebulizer1213/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nebulizer1213/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nebulizer1213/subscriptions", "organizations_url": "https://api.github.com/users/Nebulizer1213/orgs", "repos_url": "https://api.github.com/users/Nebulizer1213/repos", "events_url": "https://api.github.com/users/Nebulizer1213/events{/privacy}", "received_events_url": "https://api.github.com/users/Nebulizer1213/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-03-01T03:31:35Z", "updated_at": "2022-05-30T21:01:02Z", "closed_at": "2022-03-12T21:20:24Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nI get this error in my console ```Traceback (most recent call last):\r\n  File \"/usr/local/lib/python3.9/dist-packages/aiohttp/connector.py\", line 1154, in _create_direct_connection\r\n  File \"/usr/local/lib/python3.9/dist-packages/aiohttp/connector.py\", line 880, in _resolve_host\r\n  File \"/usr/local/lib/python3.9/dist-packages/aiohttp/resolver.py\", line 33, in resolve\r\n  File \"/usr/lib/python3.9/asyncio/base_events.py\", line 856, in getaddrinfo\r\n  File \"/usr/lib/python3.9/concurrent/futures/thread.py\", line 52, in run\r\n  File \"/usr/lib/python3.9/socket.py\", line 953, in getaddrinfo\r\nOSError: [Errno 22] Invalid argument```\r\n\r\n### To Reproduce\r\n\r\nI am running a discord bot using disnake\r\n\r\n### Expected behavior\r\n\r\nI would expect this error not to occur\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\n(most recent call last):\r\n  File \"/usr/local/lib/python3.9/dist-packages/aiohttp/connector.py\", line 1154, in _create_direct_connection\r\n  File \"/usr/local/lib/python3.9/dist-packages/aiohttp/connector.py\", line 880, in _resolve_host\r\n  File \"/usr/local/lib/python3.9/dist-packages/aiohttp/resolver.py\", line 33, in resolve\r\n  File \"/usr/lib/python3.9/asyncio/base_events.py\", line 856, in getaddrinfo\r\n  File \"/usr/lib/python3.9/concurrent/futures/thread.py\", line 52, in run\r\n  File \"/usr/lib/python3.9/socket.py\", line 953, in getaddrinfo\r\nOSError: [Errno 22] Invalid argument\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n3.8.10\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n3.8.1\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n6.0.2\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n1.7.2\r\n```\r\n\r\n\r\n### OS\r\n\r\nubuntu 20.04\r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6639/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6639/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6635", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6635/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6635/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6635/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6635", "id": 1150398403, "node_id": "I_kwDOAMpNN85Eka_D", "number": 6635, "title": "Exception ignored in: <function _ProactorBasePipeTransport.__del__ ", "user": {"login": "5iddy", "id": 64490027, "node_id": "MDQ6VXNlcjY0NDkwMDI3", "avatar_url": "https://avatars.githubusercontent.com/u/64490027?v=4", "gravatar_id": "", "url": "https://api.github.com/users/5iddy", "html_url": "https://github.com/5iddy", "followers_url": "https://api.github.com/users/5iddy/followers", "following_url": "https://api.github.com/users/5iddy/following{/other_user}", "gists_url": "https://api.github.com/users/5iddy/gists{/gist_id}", "starred_url": "https://api.github.com/users/5iddy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/5iddy/subscriptions", "organizations_url": "https://api.github.com/users/5iddy/orgs", "repos_url": "https://api.github.com/users/5iddy/repos", "events_url": "https://api.github.com/users/5iddy/events{/privacy}", "received_events_url": "https://api.github.com/users/5iddy/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-02-25T12:38:12Z", "updated_at": "2022-03-15T18:27:13Z", "closed_at": "2022-03-15T18:27:13Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\n```\r\nException ignored in: <function _ProactorBasePipeTransport.__del__ at 0x00000280FF592C20>\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\mahchalla\\AppData\\Local\\Programs\\Python\\Python310\\lib\\asyncio\\proactor_events.py\", line 116, in __del__\r\n    self.close()\r\n  File \"C:\\Users\\mahchalla\\AppData\\Local\\Programs\\Python\\Python310\\lib\\asyncio\\proactor_events.py\", line 108, in close\r\n    self._loop.call_soon(self._call_connection_lost, None)\r\n  File \"C:\\Users\\mahchalla\\AppData\\Local\\Programs\\Python\\Python310\\lib\\asyncio\\base_events.py\", line 745, in call_soon\r\n    self._check_closed()\r\n  File \"C:\\Users\\mahchalla\\AppData\\Local\\Programs\\Python\\Python310\\lib\\asyncio\\base_events.py\", line 510, in _check_closed\r\n    raise RuntimeError('Event loop is closed')\r\nRuntimeError: Event loop is closed\r\n```\r\n\r\n\r\nEncountered this issue in Windows 10, with python version 3.10.1 and aiohttp version 3.8.1.\r\n\r\nThis error occurred after the script is finished and before exiting.\r\n\r\nWrote my script in Linux environment and faced no issues but encountered this error when the same script is executed in windows 10.\r\n\r\n### To Reproduce\r\n\r\n```\r\nimport aiohttp\r\nimport asyncio\r\nfrom bs4 import BeautifulSoup\r\nfrom aiofile import async_open\r\nimport threading\r\nfrom time import perf_counter\r\nfrom concurrent.futures import ThreadPoolExecutor, as_completed\r\nimport uvloop\r\n\r\n\r\nasync def get_image_urls(url):\r\n    async with aiohttp.ClientSession() as session:\r\n        async with session.get(url) as response:\r\n            html = await response.text()\r\n\r\n    soup = BeautifulSoup(html, 'html.parser')\r\n    image_urls = []\r\n    for img in soup.find_all(\"img\"):\r\n        try:\r\n            if img[\"class\"][0].startswith(\"wp-image-\"):\r\n                img_url = img[\"src\"].split(\"?\")[0]\r\n                image_urls.append(img_url)\r\n        except KeyError as exc:\r\n            pass\r\n    return image_urls\r\n\r\n\r\nasync def download_image(url, filename):\r\n    async with aiohttp.ClientSession() as session:\r\n        async with session.get(url) as response:\r\n            async with async_open(filename, 'wb+') as afp:\r\n                async for chunk in response.content.iter_chunked(16*1024):\r\n                    await afp.write(chunk)\r\n    thread = str(threading.current_thread())\r\n    print(f\"{filename} downloaded successfully from {url} on {thread}\")\r\n\r\n\r\nasync def async_download(urls):\r\n    tasks = []\r\n    for url in urls:\r\n        task = asyncio.create_task(download_image(url, url.split(\"/\")[-1]))\r\n        tasks.append(task)\r\n\r\n    await asyncio.gather(*tasks)\r\n\r\n\r\ndef main():\r\n    image_urls = asyncio.run(get_image_urls(\r\n        \"https://triponzy.com/blog/most-beautiful-tourist-places-in-india/\"))\r\n\r\n    max_workers = 6\r\n    for i in range(0, len(image_urls), max_workers):\r\n        with ThreadPoolExecutor(max_workers=max_workers) as executor:\r\n            executor.submit(asyncio.run, async_download(image_urls[i:i+max_workers]))\r\n\r\n\r\nasync def amain():\r\n    image_urls = await get_image_urls(\r\n        \"https://triponzy.com/blog/most-beautiful-tourist-places-in-india/\")\r\n    max_workers = 6\r\n    for i in range(0, len(image_urls), max_workers):\r\n        urls = image_urls[i:i+max_workers]\r\n        await async_download(urls)\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    asyncio.set_event_loop_policy(uvloop.EventLoopPolicy())\r\n    start_time = perf_counter()\r\n    #main()\r\n    asyncio.run(amain())\r\n    end_time = perf_counter()\r\n    time_lapsed = (end_time - start_time)\r\n    print(f\"finished executing in {time_lapsed}\")\r\n\r\n```\r\n\r\nNote: This is the code. I wrote this script for educational purposes to asyncio and basic web scraping.\r\n\r\n### Expected behavior\r\n\r\nscript to exit gracefully after its finished just like it did in my linux pc.\r\n\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nException ignored in: <function _ProactorBasePipeTransport.__del__ at 0x00000280FF592C20>\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\mahchalla\\AppData\\Local\\Programs\\Python\\Python310\\lib\\asyncio\\proactor_events.py\", line 116, in __del__\r\n    self.close()\r\n  File \"C:\\Users\\mahchalla\\AppData\\Local\\Programs\\Python\\Python310\\lib\\asyncio\\proactor_events.py\", line 108, in close\r\n    self._loop.call_soon(self._call_connection_lost, None)\r\n  File \"C:\\Users\\mahchalla\\AppData\\Local\\Programs\\Python\\Python310\\lib\\asyncio\\base_events.py\", line 745, in call_soon\r\n    self._check_closed()\r\n  File \"C:\\Users\\mahchalla\\AppData\\Local\\Programs\\Python\\Python310\\lib\\asyncio\\base_events.py\", line 510, in _check_closed\r\n    raise RuntimeError('Event loop is closed')\r\nRuntimeError: Event loop is closed\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n$ python --version\r\nversion 3.10.1\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n$ python -m pip show aiohttp\r\nversion 3.8.1\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n$ python -m pip show multidict\r\nVersion: 6.0.2\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n$ python -m pip show yarl\r\nVersion: 1.7.2\r\n```\r\n\r\n\r\n### OS\r\n\r\nWindows 10\r\n\r\nNote: Didnt experience this issue in ArchLinux (5.16.10-arch1-1)\r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\nNo issues in Linux. Only encountered in Windows 10.\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6635/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6635/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6609", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6609/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6609/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6609/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6609", "id": 1132790742, "node_id": "I_kwDOAMpNN85DhQPW", "number": 6609, "title": "The unittest testcase in the documentation doesn't work", "user": {"login": "stephan9mertel", "id": 42673985, "node_id": "MDQ6VXNlcjQyNjczOTg1", "avatar_url": "https://avatars.githubusercontent.com/u/42673985?v=4", "gravatar_id": "", "url": "https://api.github.com/users/stephan9mertel", "html_url": "https://github.com/stephan9mertel", "followers_url": "https://api.github.com/users/stephan9mertel/followers", "following_url": "https://api.github.com/users/stephan9mertel/following{/other_user}", "gists_url": "https://api.github.com/users/stephan9mertel/gists{/gist_id}", "starred_url": "https://api.github.com/users/stephan9mertel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/stephan9mertel/subscriptions", "organizations_url": "https://api.github.com/users/stephan9mertel/orgs", "repos_url": "https://api.github.com/users/stephan9mertel/repos", "events_url": "https://api.github.com/users/stephan9mertel/events{/privacy}", "received_events_url": "https://api.github.com/users/stephan9mertel/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-02-11T15:58:57Z", "updated_at": "2022-02-11T19:18:09Z", "closed_at": "2022-02-11T18:35:55Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nI copied and pasted the code from https://docs.aiohttp.org/en/stable/testing.html#unittest to my project. When running the test I get the following warning:\r\n```\r\ntests/flow/example/docu_test.py::MyAppTestCase::test_example\r\n  /usr/lib/python3.8/unittest/case.py:633: RuntimeWarning: coroutine 'MyAppTestCase.test_example' was never awaited\r\n    method()\r\n```\r\n\r\n### To Reproduce\r\n\r\n1. Copy the test case from https://docs.aiohttp.org/en/stable/testing.html#unittest\r\n2. Execute it with `pytest <the file where you pasted the code>`\r\n\r\n### Expected behavior\r\n\r\nThe async functions should be executed.\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\n====================================================================== test session starts =======================================================================\r\nplatform linux -- Python 3.8.0, pytest-6.2.5, py-1.11.0, pluggy-1.0.0\r\nrootdir: /home/stephan/roi/roi-services/metabox/metas-management-service\r\nplugins: aiohttp-0.3.0, cov-3.0.0, asyncio-0.16.0\r\ncollected 1 item                                                                                                                                                 \r\n\r\ntests/flow/example/docu_test.py .                                                                                                                          [100%]\r\n\r\n======================================================================== warnings summary ========================================================================\r\ntests/flow/example/docu_test.py::MyAppTestCase::test_example\r\n  /usr/lib/python3.8/unittest/case.py:633: RuntimeWarning: coroutine 'MyAppTestCase.test_example' was never awaited\r\n    method()\r\n\r\n-- Docs: https://docs.pytest.org/en/stable/warnings.html\r\n================================================================== 1 passed, 1 warning in 0.04s ==================================================================\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n3.8\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\naiohttp==3.7.4.post0\r\naiohttp-devtools==0.13.1\r\npytest-aiohttp==0.3.0\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\nmultidict==5.2.0\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\nyarl==1.7.2\r\n```\r\n\r\n\r\n### OS\r\n\r\nUbuntu\r\n\r\n### Related component\r\n\r\nServer, Client\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6609/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6609/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6600", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6600/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6600/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6600/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6600", "id": 1126989392, "node_id": "I_kwDOAMpNN85DLH5Q", "number": 6600, "title": "Fails to build on Python 3.11 - longintrepr.h: No such file or directory", "user": {"login": "gaborbernat", "id": 690238, "node_id": "MDQ6VXNlcjY5MDIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/690238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gaborbernat", "html_url": "https://github.com/gaborbernat", "followers_url": "https://api.github.com/users/gaborbernat/followers", "following_url": "https://api.github.com/users/gaborbernat/following{/other_user}", "gists_url": "https://api.github.com/users/gaborbernat/gists{/gist_id}", "starred_url": "https://api.github.com/users/gaborbernat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gaborbernat/subscriptions", "organizations_url": "https://api.github.com/users/gaborbernat/orgs", "repos_url": "https://api.github.com/users/gaborbernat/repos", "events_url": "https://api.github.com/users/gaborbernat/events{/privacy}", "received_events_url": "https://api.github.com/users/gaborbernat/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 53, "created_at": "2022-02-08T09:20:33Z", "updated_at": "2022-12-02T22:33:57Z", "closed_at": "2022-09-21T00:44:29Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nBecause of https://github.com/python/cpython/pull/28968, cython fixed it in https://github.com/cython/cython/pull/4428 and is released with 0.29.5\n\n### To Reproduce\n\npip install aiohttp\n\n### Expected behavior\n\nTo build the wheel.\n\n### Logs/tracebacks\n\n```console\nFailed to build aiohttp yarl\r\n  error: subprocess-exited-with-error\r\n\r\n  \u00d7 Building wheel for aiohttp (pyproject.toml) did not run successfully.\r\n  \u2502 exit code: 1\r\n  \u2570\u2500> [31 lines of output]\r\n      *********************\r\n      * Accelerated build *\r\n      *********************\r\n      running bdist_wheel\r\n      running build\r\n      running build_py\r\n      running egg_info\r\n      writing aiohttp.egg-info/PKG-INFO\r\n      writing dependency_links to aiohttp.egg-info/dependency_links.txt\r\n      writing requirements to aiohttp.egg-info/requires.txt\r\n      writing top-level names to aiohttp.egg-info/top_level.txt\r\n      reading manifest file 'aiohttp.egg-info/SOURCES.txt'\r\n      reading manifest template 'MANIFEST.in'\r\n      warning: no files found matching 'aiohttp' anywhere in distribution\r\n      warning: no previously-included files matching '*.pyc' found anywhere in distribution\r\n      warning: no previously-included files matching '*.pyd' found anywhere in distribution\r\n      warning: no previously-included files matching '*.so' found anywhere in distribution\r\n      warning: no previously-included files matching '*.lib' found anywhere in distribution\r\n      warning: no previously-included files matching '*.dll' found anywhere in distribution\r\n      warning: no previously-included files matching '*.a' found anywhere in distribution\r\n      warning: no previously-included files matching '*.obj' found anywhere in distribution\r\n      warning: no previously-included files found matching 'aiohttp/*.html'\r\n      no previously-included directories found matching 'docs/_build'\r\n      adding license file 'LICENSE.txt'\r\n      running build_ext\r\n      building 'aiohttp._websocket' extension\r\n      aiohttp/_websocket.c:198:12: fatal error: longintrepr.h: No such file or directory\r\n        198 |   #include \"longintrepr.h\"\r\n            |            ^~~~~~~~~~~~~~~\r\n      compilation terminated.\r\n      error: command '/usr/bin/gcc' failed with exit code 1\r\n      [end of output]\r\n\r\n```\n\n\n### Python Version\n\n```console\n3.11\n```\n\n\n### aiohttp Version\n\n```console\nlatest\n```\n\n\n### multidict Version\n\n```console\nn/a\n```\n\n\n### yarl Version\n\n```console\nlatest\n```\n\n\n### OS\n\nAny\n\n### Related component\n\nServer, Client\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6600/reactions", "total_count": 51, "+1": 51, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6600/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6576", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6576/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6576/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6576/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6576", "id": 1118420509, "node_id": "I_kwDOAMpNN85Cqb4d", "number": 6576, "title": "Website content is not up-to-date", "user": {"login": "tomzcn", "id": 6872889, "node_id": "MDQ6VXNlcjY4NzI4ODk=", "avatar_url": "https://avatars.githubusercontent.com/u/6872889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tomzcn", "html_url": "https://github.com/tomzcn", "followers_url": "https://api.github.com/users/tomzcn/followers", "following_url": "https://api.github.com/users/tomzcn/following{/other_user}", "gists_url": "https://api.github.com/users/tomzcn/gists{/gist_id}", "starred_url": "https://api.github.com/users/tomzcn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tomzcn/subscriptions", "organizations_url": "https://api.github.com/users/tomzcn/orgs", "repos_url": "https://api.github.com/users/tomzcn/repos", "events_url": "https://api.github.com/users/tomzcn/events{/privacy}", "received_events_url": "https://api.github.com/users/tomzcn/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2022-01-30T05:39:59Z", "updated_at": "2022-02-02T08:00:48Z", "closed_at": "2022-01-30T11:55:06Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nhttps://docs.aiohttp.org/en/stable/client_quickstart.html\r\n\r\n\u201casyncio.run(main)\u201d should be \u201casyncio.run(main()) \"\r\n\r\n20220130\n\n### To Reproduce\n\nnone\n\n### Expected behavior\n\nnone\n\n### Logs/tracebacks\n\n```python-traceback\nnone\n```\n\n\n### Python Version\n\n```console\nnone\n```\n\n\n### aiohttp Version\n\n```console\nnone\n```\n\n\n### multidict Version\n\n```console\nnone\n```\n\n\n### yarl Version\n\n```console\nnone\n```\n\n\n### OS\n\nmacOS\n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6576/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6576/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6539", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6539/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6539/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6539/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/6539", "id": 1109565043, "node_id": "PR_kwDOAMpNN84xVov6", "number": 6539, "title": "Recover missing import in circular import test", "user": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1831256427, "node_id": "MDU6TGFiZWwxODMxMjU2NDI3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/reproducer:%20present", "name": "reproducer: present", "color": "c2e0c6", "default": false, "description": "This PR or issue contains code, which reproduce the problem described or clearly understandable STR"}, {"id": 2425792478, "node_id": "MDU6TGFiZWwyNDI1NzkyNDc4", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bot:chronographer:skip", "name": "bot:chronographer:skip", "color": "ead777", "default": false, "description": "This PR does not need to include a change note"}, {"id": 2451662697, "node_id": "MDU6TGFiZWwyNDUxNjYyNjk3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/backport-3.8", "name": "backport-3.8", "color": "000000", "default": false, "description": "Trigger automatic backporting to the 3.8 release branch by Patchback robot"}, {"id": 3507377261, "node_id": "LA_kwDOAMpNN87RDlRt", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/backport-3.9", "name": "backport-3.9", "color": "000000", "default": false, "description": "Trigger automatic backporting to the 3.9 release branch by Patchback robot"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-01-20T17:17:25Z", "updated_at": "2022-01-20T17:44:11Z", "closed_at": "2022-01-20T17:43:50Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/6539", "html_url": "https://github.com/aio-libs/aiohttp/pull/6539", "diff_url": "https://github.com/aio-libs/aiohttp/pull/6539.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/6539.patch", "merged_at": "2022-01-20T17:43:50Z"}, "body": "This corrects the $sbj test by re-adding the import instruction that was lost during copy-paste from other projects to the invocation.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6539/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6539/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6525", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6525/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6525/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6525/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6525", "id": 1106261656, "node_id": "I_kwDOAMpNN85B8DaY", "number": 6525, "title": "invalid character in header ", "user": {"login": "saarsa", "id": 6289703, "node_id": "MDQ6VXNlcjYyODk3MDM=", "avatar_url": "https://avatars.githubusercontent.com/u/6289703?v=4", "gravatar_id": "", "url": "https://api.github.com/users/saarsa", "html_url": "https://github.com/saarsa", "followers_url": "https://api.github.com/users/saarsa/followers", "following_url": "https://api.github.com/users/saarsa/following{/other_user}", "gists_url": "https://api.github.com/users/saarsa/gists{/gist_id}", "starred_url": "https://api.github.com/users/saarsa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/saarsa/subscriptions", "organizations_url": "https://api.github.com/users/saarsa/orgs", "repos_url": "https://api.github.com/users/saarsa/repos", "events_url": "https://api.github.com/users/saarsa/events{/privacy}", "received_events_url": "https://api.github.com/users/saarsa/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2022-01-17T21:09:57Z", "updated_at": "2022-01-20T10:39:33Z", "closed_at": "2022-01-20T10:39:33Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nCan someone explain to me why my code does not work\r\nI get this error all the time `400, message='Invalid header value char', url=URL('https://mayaapi.tase.co.il/api/company/alldetails?companyId=373')\r\n`\r\n\r\nmy code:\r\n```import aiohttp\r\nimport asyncio\r\nimport os\r\n\r\nos.environ.setdefault('AIOHTTP_NO_EXTENSIONS', \"1\")\r\nasync def test():\r\n    url = 'https://mayaapi.tase.co.il/api/company/alldetails?companyId=373'\r\n    # url = 'https://www.google.com/'\r\n    headers={\"Accept-Language\": \"he-IL\",\"X-Maya-With\": \"allow\"}\r\n    async with aiohttp.request(method=\"get\", url=url, headers=headers) as respon:\r\n        x = await respon.json()\r\n    print(x)\r\n\r\nasyncio.run(test())\r\n```\r\nI use `os.environ.setdefault('AIOHTTP_NO_EXTENSIONS', \"1\")` but it still does not work \r\n\r\n### To Reproduce\r\n\r\n.\r\n\r\n### Expected behavior\r\n\r\nEverything but that \r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nException has occurred: ClientResponseError\r\n400, message='Invalid header value char', url=URL('https://mayaapi.tase.co.il/api/company/alldetails?companyId=373')\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\n  File \"/home/saar/stock/stock/test.py\", line 14, in test\r\n    x = await respon.json()\r\n  File \"/home/saar/stock/stock/test.py\", line 18, in <module>\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\nPython Version: 3.10.1\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\naiohttp Version: 3.8.1\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n$ python -m pip show multidict\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\nyarl Version: 1.7.2\r\n```\r\n\r\n\r\n### OS\r\n\r\nubuntu server 20.04.3\r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\n_No response_\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6525/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6525/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6518", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6518/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6518/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6518/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6518", "id": 1105237659, "node_id": "I_kwDOAMpNN85B4Jab", "number": 6518, "title": "Reload app / log background task exception", "user": {"login": "louisabraham", "id": 13174805, "node_id": "MDQ6VXNlcjEzMTc0ODA1", "avatar_url": "https://avatars.githubusercontent.com/u/13174805?v=4", "gravatar_id": "", "url": "https://api.github.com/users/louisabraham", "html_url": "https://github.com/louisabraham", "followers_url": "https://api.github.com/users/louisabraham/followers", "following_url": "https://api.github.com/users/louisabraham/following{/other_user}", "gists_url": "https://api.github.com/users/louisabraham/gists{/gist_id}", "starred_url": "https://api.github.com/users/louisabraham/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/louisabraham/subscriptions", "organizations_url": "https://api.github.com/users/louisabraham/orgs", "repos_url": "https://api.github.com/users/louisabraham/repos", "events_url": "https://api.github.com/users/louisabraham/events{/privacy}", "received_events_url": "https://api.github.com/users/louisabraham/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-01-17T00:34:31Z", "updated_at": "2022-01-17T17:25:59Z", "closed_at": "2022-01-17T17:24:39Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nA background task I had (registered with `app.on_startup`) had an exception.\r\n\r\nBut the app seemed to run normally. \r\n\r\nThis is my code (the report_task function has an error):\r\n\r\n```py\r\nasync def report_task():\r\n    schedule.every().day.at(\"03:00\").do(send_reports)\r\n    try:\r\n        while True:\r\n            schedule.run_pending()\r\n            await asyncio.sleep(5)\r\n    except asyncio.CancelledError:\r\n        pass\r\n\r\n\r\nasync def start_background_tasks(app):\r\n    app[\"report sender\"] = asyncio.create_task(report_task())\r\n\r\n\r\nasync def cleanup_background_tasks(app):\r\n    app[\"report sender\"].cancel()\r\n    await app[\"report sender\"]\r\n\r\n\r\nasync def make_app():\r\n    app = web.Application(middlewares=[auth])\r\n    app.add_routes(routes)\r\n    app.on_startup.append(start_background_tasks)\r\n    app.on_cleanup.append(cleanup_background_tasks)\r\n    return app\r\n```\r\n\r\nThe logs only appear when quitting the app:\r\n\r\n```\r\n[2022-01-17 01:21:13 +0100] [1457700] [ERROR] Exception in gunicorn worker\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3/dist-packages/aiohttp/worker.py\", line 58, in run\r\n    self.loop.run_until_complete(self._task)\r\n  File \"/usr/lib/python3.8/asyncio/base_events.py\", line 616, in run_until_complete\r\n    return future.result()\r\n  File \"/usr/lib/python3/dist-packages/aiohttp/worker.py\", line 116, in _run\r\n    await runner.cleanup()\r\n  File \"/usr/lib/python3/dist-packages/aiohttp/web_runner.py\", line 251, in cleanup\r\n    await self._cleanup_server()\r\n  File \"/usr/lib/python3/dist-packages/aiohttp/web_runner.py\", line 337, in _cleanup_server\r\n    await self._app.cleanup()\r\n  File \"/usr/lib/python3/dist-packages/aiohttp/web_app.py\", line 403, in cleanup\r\n    await self.on_cleanup.send(self)\r\n  File \"/usr/lib/python3/dist-packages/aiohttp/signals.py\", line 34, in send\r\n    await receiver(*args, **kwargs)  # type: ignore\r\n  File \"main.py\", line 222, in cleanup_background_tasks\r\n    await app[\"report sender\"]\r\n  File \"main.py\", line 210, in report_task\r\n    schedule.run_pending()\r\n```\n\n### To Reproduce\n\n1. Schedule a background task\r\n2. Raise an exception\r\n3. Nothing happens\n\n### Expected behavior\n\nI think there should be a mechanism in place to show the logs or that [the docs](https://docs.aiohttp.org/en/stable/web_advanced.html#background-tasks) should be more clear.\r\n\r\nThe best would be to have an option that causes the app to be reloaded when there is an exception in a background task.\n\n### Logs/tracebacks\n\n```python-traceback\nabove\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\nPython 3.8.5\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\nVersion: 3.6.2\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\n```\n\n\n### OS\n\nArch Linux\n\n### Related component\n\nServer\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [x] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6518/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6518/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6501", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6501/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6501/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6501/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6501", "id": 1098359652, "node_id": "I_kwDOAMpNN85Bd6Nk", "number": 6501, "title": "Graceful Shutdown example gives DeprecationWarning on Python 3.10", "user": {"login": "nihil-admirari", "id": 50202386, "node_id": "MDQ6VXNlcjUwMjAyMzg2", "avatar_url": "https://avatars.githubusercontent.com/u/50202386?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nihil-admirari", "html_url": "https://github.com/nihil-admirari", "followers_url": "https://api.github.com/users/nihil-admirari/followers", "following_url": "https://api.github.com/users/nihil-admirari/following{/other_user}", "gists_url": "https://api.github.com/users/nihil-admirari/gists{/gist_id}", "starred_url": "https://api.github.com/users/nihil-admirari/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nihil-admirari/subscriptions", "organizations_url": "https://api.github.com/users/nihil-admirari/orgs", "repos_url": "https://api.github.com/users/nihil-admirari/repos", "events_url": "https://api.github.com/users/nihil-admirari/events{/privacy}", "received_events_url": "https://api.github.com/users/nihil-admirari/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-01-10T20:51:07Z", "updated_at": "2022-01-19T14:45:34Z", "closed_at": "2022-01-19T14:45:34Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nAn example from [Graceful Shutdown](https://docs.aiohttp.org/en/stable/client_advanced.html#graceful-shutdown) uses `asyncio.get_event_loop()` which is deprecated as of [Python 3.10](https://docs.python.org/3.10/library/asyncio-eventloop.html#asyncio.get_event_loop).\n\n### To Reproduce\n\n1. Implement an example from the documentation\r\n```py\r\nimport asyncio\r\n\r\nimport aiohttp\r\n\r\n\r\nasync def read_website():\r\n    async with aiohttp.ClientSession() as session:\r\n        async with session.get('http://example.org/') as resp:\r\n            await resp.read()\r\n\r\nloop = asyncio.get_event_loop()\r\nloop.run_until_complete(read_website())\r\n# Zero-sleep to allow underlying connections to close\r\nloop.run_until_complete(asyncio.sleep(0))\r\nloop.close()\r\n```\r\n2. Run and see\r\n```\r\nDeprecationWarning: There is no current event loop\r\n  loop = asyncio.get_event_loop()\r\n```\n\n### Expected behavior\n\nDocumentation should provide an example of graceful shutdown without a `DeprecationWarning`.\n\n### Logs/tracebacks\n\n```python-traceback\nDeprecationWarning: There is no current event loop\r\n  loop = asyncio.get_event_loop()\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\nPython 3.10.1\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\nVersion: 3.8.1\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\nVersion: 5.2.0\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nVersion: 1.7.2\n```\n\n\n### OS\n\nLinux\n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6501/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6501/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6469", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6469/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6469/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6469/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6469", "id": 1090928901, "node_id": "I_kwDOAMpNN85BBkEF", "number": 6469, "title": "OSError: [Errno 99] Cannot assign requested address", "user": {"login": "mknithin", "id": 15276904, "node_id": "MDQ6VXNlcjE1Mjc2OTA0", "avatar_url": "https://avatars.githubusercontent.com/u/15276904?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mknithin", "html_url": "https://github.com/mknithin", "followers_url": "https://api.github.com/users/mknithin/followers", "following_url": "https://api.github.com/users/mknithin/following{/other_user}", "gists_url": "https://api.github.com/users/mknithin/gists{/gist_id}", "starred_url": "https://api.github.com/users/mknithin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mknithin/subscriptions", "organizations_url": "https://api.github.com/users/mknithin/orgs", "repos_url": "https://api.github.com/users/mknithin/repos", "events_url": "https://api.github.com/users/mknithin/events{/privacy}", "received_events_url": "https://api.github.com/users/mknithin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1831255463, "node_id": "MDU6TGFiZWwxODMxMjU1NDYz", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/reproducer:%20missing", "name": "reproducer: missing", "color": "e23c36", "default": false, "description": "This PR or issue lacks code, which reproduce the problem described or clearly understandable STR"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-12-30T07:36:51Z", "updated_at": "2022-01-29T12:47:33Z", "closed_at": "2022-01-29T12:47:33Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nI'm using aio http to make a post request, inside a http request  and I'm getting this error when making continues call \r\n\r\nthis is the code I'm using \r\n\r\nconn = aiohttp.TCPConnector(limit=0, ttl_dns_cache=300)\r\n    async with aiohttp.ClientSession(connector=conn) as session:\r\n        async with session.post(\"http://somethign\", json={'data': data}, ssl=False) as resp:\r\n            if resp.status == status.HTTP_200_OK:\r\n                ..\r\n            elif resp.status == status.HTTP_401_UNAUTHORIZED:\r\n                ..\r\n            elif resp.status == status.HTTP_404_NOT_FOUND:\r\n                `..```\n\n### To Reproduce\n\n1. call aio.http post request  with ulimited connection pool size\r\n2. the specified exception will occur\n\n### Expected behavior\n\nI think there should some way to handle this when making continues http requests\n\n### Logs/tracebacks\n\n```python-traceback\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.9/site-packages/aiohttp/connector.py\", line 986, in _wrap_create_connection\r\n    return await self._loop.create_connection(*args, **kwargs)  # type: ignore[return-value]  # noqa\r\n  File \"uvloop/loop.pyx\", line 2024, in create_connection\r\n  File \"uvloop/loop.pyx\", line 2000, in uvloop.loop.Loop.create_connection\r\n  File \"uvloop/handles/tcp.pyx\", line 182, in uvloop.loop.TCPTransport.connect\r\n  File \"uvloop/handles/tcp.pyx\", line 204, in uvloop.loop._TCPConnectRequest.connect\r\nOSError: [Errno 99] Cannot assign requested address\n```\n\n\n### Python Version\n\n```console\n$ python --version\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\n\r\nName: aiohttp\r\nVersion: 3.8.1\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: \r\nAuthor-email: \r\nLicense: Apache 2\r\nLocation: /Users/nithinmk/Library/Caches/pypoetry/virtualenvs/messaging-backend-QVw4N_6B-py3.9/lib/python3.9/site-packages\r\nRequires: aiosignal, async-timeout, attrs, charset-normalizer, frozenlist, multidict, yarl\r\nRequired-by:\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\n\r\nName: multidict\r\nVersion: 5.2.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/nithinmk/Library/Caches/pypoetry/virtualenvs/messaging-backend-QVw4N_6B-py3.9/lib/python3.9/site-packages\r\nRequires: \r\nRequired-by: aiohttp, yarl\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\n\r\nName: yarl\r\nVersion: 1.7.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/nithinmk/Library/Caches/pypoetry/virtualenvs/messaging-backend-QVw4N_6B-py3.9/lib/python3.9/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aio-pika, aiohttp, aiormq\n```\n\n\n### OS\n\nmac os Monterey\n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6469/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6469/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6466", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6466/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6466/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6466/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6466", "id": 1089988414, "node_id": "I_kwDOAMpNN85A9-c-", "number": 6466, "title": "Can't decompress gzip with auto_decompress set to False", "user": {"login": "dbatten5", "id": 17271241, "node_id": "MDQ6VXNlcjE3MjcxMjQx", "avatar_url": "https://avatars.githubusercontent.com/u/17271241?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dbatten5", "html_url": "https://github.com/dbatten5", "followers_url": "https://api.github.com/users/dbatten5/followers", "following_url": "https://api.github.com/users/dbatten5/following{/other_user}", "gists_url": "https://api.github.com/users/dbatten5/gists{/gist_id}", "starred_url": "https://api.github.com/users/dbatten5/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dbatten5/subscriptions", "organizations_url": "https://api.github.com/users/dbatten5/orgs", "repos_url": "https://api.github.com/users/dbatten5/repos", "events_url": "https://api.github.com/users/dbatten5/events{/privacy}", "received_events_url": "https://api.github.com/users/dbatten5/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2021-12-28T16:00:33Z", "updated_at": "2021-12-29T14:24:45Z", "closed_at": "2021-12-28T16:18:22Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nWhen the `auto_decompress` property in `ClientSession` is set to `False`, `gzip` encoded responses can't be decoded. With `auto_decompress=True` (the default behaviour), the response is decoded without issue.\r\n\r\n### To Reproduce\r\n\r\n```python\r\n#!/usr/bin/env python3\r\n\r\nimport asyncio\r\n\r\nfrom aiohttp import ClientSession\r\n\r\n\r\nasync def main():\r\n    async with ClientSession(auto_decompress=False) as session:\r\n        async with session.get(\"http://httpbin.org/gzip\") as resp:\r\n            text = await resp.text()\r\n            print(text)\r\n\r\n\r\nasyncio.run(main())\r\n```\r\n\r\n### Expected behavior\r\n\r\nI would expect the response to be decoded by `resp.text()`, especially as I note that the method can receive an encoding type argument to decode, however I get the error detailed below. I've tried adding an `encoding=` argument with values of `gzip` and `deflate` but then I get a `LookupError: unknown encoding: gzip/deflate`\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nTraceback (most recent call last):\r\n  File \"./script.py\", line 15, in <module>\r\n    asyncio.run(main())\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/asyncio/runners.py\", line 43, in run\r\n    return loop.run_until_complete(main)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/asyncio/base_events.py\", line 587, in run_until_complete\r\n    return future.result()\r\n  File \"./script.py\", line 11, in main\r\n    text = await resp.text()\r\n  File \"~/.../.venv/lib/python3.7/site-packages/aiohttp/client_reqrep.py\", line 1086, in text\r\n    encoding, errors=errors\r\nUnicodeDecodeError: 'utf-8' codec can't decode byte 0x8b in position 1: invalid start byte\r\n```\r\n\r\n### Python Version\r\n\r\n```console\r\n$ python --version\r\nPython 3.7.9\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.8.1\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: None\r\nAuthor-email: None\r\nLicense: Apache 2\r\nLocation: /~/.../.venv/lib/python3.7/site-packages\r\nRequires: aiosignal, typing-extensions, frozenlist, asynctest, async-timeout, attrs, yarl, multidict, charset-normalizer\r\nRequired-by:\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n$ python -m pip show multidict\r\nVersion: 5.2.0\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n$ python -m pip show yarl\r\nVersion: 1.7.2\r\n```\r\n\r\n\r\n### OS\r\n\r\nMac OSX Catalina 10.15.7\r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6466/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6466/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6422", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6422/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6422/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6422/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6422", "id": 1081855225, "node_id": "I_kwDOAMpNN85Ae8z5", "number": 6422, "title": "Mypy issue", "user": {"login": "painassasin", "id": 43952871, "node_id": "MDQ6VXNlcjQzOTUyODcx", "avatar_url": "https://avatars.githubusercontent.com/u/43952871?v=4", "gravatar_id": "", "url": "https://api.github.com/users/painassasin", "html_url": "https://github.com/painassasin", "followers_url": "https://api.github.com/users/painassasin/followers", "following_url": "https://api.github.com/users/painassasin/following{/other_user}", "gists_url": "https://api.github.com/users/painassasin/gists{/gist_id}", "starred_url": "https://api.github.com/users/painassasin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/painassasin/subscriptions", "organizations_url": "https://api.github.com/users/painassasin/orgs", "repos_url": "https://api.github.com/users/painassasin/repos", "events_url": "https://api.github.com/users/painassasin/events{/privacy}", "received_events_url": "https://api.github.com/users/painassasin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-12-16T07:22:24Z", "updated_at": "2021-12-16T13:56:09Z", "closed_at": "2021-12-16T13:56:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nMethod `_raise_allowed_methods` should return `NoReturn` instead of `None` for mypy compatibility\n\n### To Reproduce\n\nmypy 0.920\n\n### Expected behavior\n\n...\n\n### Logs/tracebacks\n\n```python-traceback\n...\n```\n\n\n### Python Version\n\n```console\n$ python --version\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\n```\n\n\n### OS\n\nmacOS\n\n### Related component\n\nServer\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6422/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6422/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6399", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6399/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6399/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6399/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6399", "id": 1074377388, "node_id": "I_kwDOAMpNN85ACbKs", "number": 6399, "title": " Binary distributions such as wheels include C sources", "user": {"login": "musicinmybrain", "id": 6898909, "node_id": "MDQ6VXNlcjY4OTg5MDk=", "avatar_url": "https://avatars.githubusercontent.com/u/6898909?v=4", "gravatar_id": "", "url": "https://api.github.com/users/musicinmybrain", "html_url": "https://github.com/musicinmybrain", "followers_url": "https://api.github.com/users/musicinmybrain/followers", "following_url": "https://api.github.com/users/musicinmybrain/following{/other_user}", "gists_url": "https://api.github.com/users/musicinmybrain/gists{/gist_id}", "starred_url": "https://api.github.com/users/musicinmybrain/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/musicinmybrain/subscriptions", "organizations_url": "https://api.github.com/users/musicinmybrain/orgs", "repos_url": "https://api.github.com/users/musicinmybrain/repos", "events_url": "https://api.github.com/users/musicinmybrain/events{/privacy}", "received_events_url": "https://api.github.com/users/musicinmybrain/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2021-12-08T12:51:21Z", "updated_at": "2021-12-09T02:14:42Z", "closed_at": "2021-12-09T02:14:42Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Describe the bug\n\nBinary distributions such as wheels include C sources (`_find_header.c`, `_find_header.h`, `_helpers.c`, `_http_parser.c`, `_http_writer.c`, and `_websocket.c`), but these sources don\u2019t provide value in binary distributions and their size is significant.\r\n\r\nSee also https://github.com/aio-libs/frozenlist/issues/250.\n\n### To Reproduce\n\n```\r\n$ python3 -m venv _e\r\n$ . _e/bin/activate\r\n(_e) $ pip install aiohttp\r\n(_e) $ ls -l _e/lib64/python*/site-packages/aiohttp/*.{c,h,pyx,px*}\r\n```\n\n### Expected behavior\n\nThe C sources should ideally be present in the sdist but not in the bdist, where they don\u2019t really provide any value.\n\n### Logs/tracebacks\n\n```python-traceback\n$ python3 -m venv _e\r\n$ . _e/bin/activate\r\n(_e) $ pip install aiohttp\r\n(_e) $ ls -l _e/lib64/python*/site-packages/aiohttp/*.{c,h,pyx,px*}\r\n-rw-rw-r--. 1 ben ben   4998 Dec  7 23:42 _e/lib64/python3.10/site-packages/aiohttp/_cparser.pxd\r\n-rw-rw-r--. 1 ben ben 187570 Dec  7 23:42 _e/lib64/python3.10/site-packages/aiohttp/_find_header.c\r\n-rw-rw-r--. 1 ben ben    170 Dec  7 23:42 _e/lib64/python3.10/site-packages/aiohttp/_find_header.h\r\n-rw-rw-r--. 1 ben ben     68 Dec  7 23:42 _e/lib64/python3.10/site-packages/aiohttp/_find_header.pxd\r\n-rw-rw-r--. 1 ben ben   2007 Dec  7 23:42 _e/lib64/python3.10/site-packages/aiohttp/_headers.pxi\r\n-rw-rw-r--. 1 ben ben 212982 Dec  7 23:42 _e/lib64/python3.10/site-packages/aiohttp/_helpers.c\r\n-rw-rw-r--. 1 ben ben   1049 Dec  7 23:42 _e/lib64/python3.10/site-packages/aiohttp/_helpers.pyx\r\n-rw-rw-r--. 1 ben ben 978187 Dec  7 23:42 _e/lib64/python3.10/site-packages/aiohttp/_http_parser.c\r\n-rw-rw-r--. 1 ben ben  26571 Dec  7 23:42 _e/lib64/python3.10/site-packages/aiohttp/_http_parser.pyx\r\n-rw-rw-r--. 1 ben ben 221270 Dec  7 23:42 _e/lib64/python3.10/site-packages/aiohttp/_http_writer.c\r\n-rw-rw-r--. 1 ben ben   4575 Dec  7 23:42 _e/lib64/python3.10/site-packages/aiohttp/_http_writer.pyx\r\n-rw-rw-r--. 1 ben ben 138420 Dec  7 23:42 _e/lib64/python3.10/site-packages/aiohttp/_websocket.c\r\n-rw-rw-r--. 1 ben ben   1561 Dec  7 23:42 _e/lib64/python3.10/site-packages/aiohttp/_websocket.pyx\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\nPython 3.10.0\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.8.1\r\n[\u2026]\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.2.0\r\n[\u2026]\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.7.2\r\n[\u2026]\n```\n\n\n### OS\n\nFedora Linux 35\u2014but this issue is platform-independent\n\n### Related component\n\nServer\n\n### Additional context\n\nA suggested fix is to add to `setup(\u2026)` in `setup.py`:\r\n\r\n```python\r\n    exclude_package_data={\"\": [\"*.c\", \"*.h\"]},\r\n```\r\n\r\nwhich will exclude these sources from binary distributions without affecting source distributions.\r\n\r\nIt\u2019s possible to exclude some of the Cython files as well, but in `frozenlist` the preference was to keep them in the bdist for debugging purposes.\r\n\r\nPR to follow.\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6399/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6399/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6372", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6372/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6372/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6372/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6372", "id": 1071174598, "node_id": "I_kwDOAMpNN84_2NPG", "number": 6372, "title": "There is inconsistency aiohttp.ClientSession.request's document and code.", "user": {"login": "agrexgh", "id": 47779973, "node_id": "MDQ6VXNlcjQ3Nzc5OTcz", "avatar_url": "https://avatars.githubusercontent.com/u/47779973?v=4", "gravatar_id": "", "url": "https://api.github.com/users/agrexgh", "html_url": "https://github.com/agrexgh", "followers_url": "https://api.github.com/users/agrexgh/followers", "following_url": "https://api.github.com/users/agrexgh/following{/other_user}", "gists_url": "https://api.github.com/users/agrexgh/gists{/gist_id}", "starred_url": "https://api.github.com/users/agrexgh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/agrexgh/subscriptions", "organizations_url": "https://api.github.com/users/agrexgh/orgs", "repos_url": "https://api.github.com/users/agrexgh/repos", "events_url": "https://api.github.com/users/agrexgh/events{/privacy}", "received_events_url": "https://api.github.com/users/agrexgh/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2021-12-04T10:09:52Z", "updated_at": "2021-12-06T05:17:04Z", "closed_at": "2021-12-04T12:30:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\n[Basic API doc](https://docs.aiohttp.org/en/stable/client_reference.html#basic-api) says `aiohttp.ClientSession.request()` returns `aiohttp.ClientResponse`,\r\nbut [source code](https://docs.aiohttp.org/en/stable/_modules/aiohttp/client.html) says it returns `aiohttp._RequestContextManager`,\r\n\r\nI guess this is problem of documentation, not that of software behavior.\n\n### To Reproduce\n\nNA\n\n### Expected behavior\n\n[Basic API doc](https://docs.aiohttp.org/en/stable/client_reference.html#basic-api) and [source code](https://docs.aiohttp.org/en/stable/_modules/aiohttp/client.html) say same thing.\n\n### Logs/tracebacks\n\n```python-traceback\nNA\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\nPython 3.9.9\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.8.1\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: \r\nAuthor-email: \r\nLicense: Apache 2\r\nLocation: /usr/local/lib/python3.9/site-packages\r\nRequires: aiosignal, async-timeout, attrs, charset-normalizer, frozenlist, multidict, yarl\r\nRequired-by: line-bot-sdk\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.2.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/local/lib/python3.9/site-packages\r\nRequires: \r\nRequired-by: aiohttp, yarl\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.7.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/local/lib/python3.9/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\n```\n\n\n### OS\n\nUbuntu 20.04 on WSL2\n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6372/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6372/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6369", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6369/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6369/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6369/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/6369", "id": 1071081219, "node_id": "PR_kwDOAMpNN84vYsWL", "number": 6369, "title": "Fix setting branch protection failure in GHA", "user": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 731921232, "node_id": "MDU6TGFiZWw3MzE5MjEyMzI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/infra", "name": "infra", "color": "e55e5b", "default": false, "description": null}, {"id": 743514498, "node_id": "MDU6TGFiZWw3NDM1MTQ0OTg=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/meta", "name": "meta", "color": "ccf794", "default": false, "description": null}, {"id": 1472801557, "node_id": "MDU6TGFiZWwxNDcyODAxNTU3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bot:chronographer:provided", "name": "bot:chronographer:provided", "color": "ededed", "default": false, "description": "There is a change note present in this PR"}, {"id": 2451662697, "node_id": "MDU6TGFiZWwyNDUxNjYyNjk3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/backport-3.8", "name": "backport-3.8", "color": "000000", "default": false, "description": "Trigger automatic backporting to the 3.8 release branch by Patchback robot"}, {"id": 3507377261, "node_id": "LA_kwDOAMpNN87RDlRt", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/backport-3.9", "name": "backport-3.9", "color": "000000", "default": false, "description": "Trigger automatic backporting to the 3.9 release branch by Patchback robot"}], "state": "closed", "locked": false, "assignee": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2021-12-04T01:13:11Z", "updated_at": "2021-12-04T01:32:21Z", "closed_at": "2021-12-04T01:32:01Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/6369", "html_url": "https://github.com/aio-libs/aiohttp/pull/6369", "diff_url": "https://github.com/aio-libs/aiohttp/pull/6369.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/6369.patch", "merged_at": "2021-12-04T01:32:01Z"}, "body": "## What do these changes do?\r\n\r\nThis is necessary to resolve the problem of GitHub treating the\r\n`skipped` `check` job result as an acceptable outcome and merging\r\nbroken Dependabot PRs with auto-merge. For example:\r\nhttps://github.com/aio-libs/aiohttp/pull/6330.\r\n\r\nInspired by:\r\nhttps://github.com/pyca/cryptography/pull/6512#discussion_r757982569\r\n\r\n## Are there changes in behavior for the user?\r\n\r\nNo, only for the maintainers.\r\n\r\n## Related issue number\r\n\r\n#6330 (among others)\r\n\r\n## Checklist\r\n\r\n- [x] I think the code is well written\r\n- [ ] Unit tests for the changes exist\r\n- [ ] Documentation reflects the changes\r\n- [x] If you provide code modification, please add yourself to `CONTRIBUTORS.txt`\r\n  * The format is &lt;Name&gt; &lt;Surname&gt;.\r\n  * Please keep alphabetical order, the file is sorted by names.\r\n- [ ] Add a new news fragment into the `CHANGES` folder\r\n  * name it `<issue_id>.<type>` for example (588.bugfix)\r\n  * if you don't have an `issue_id` change it to the pr id after creating the pr\r\n  * ensure type is one of the following:\r\n    * `.feature`: Signifying a new feature.\r\n    * `.bugfix`: Signifying a bug fix.\r\n    * `.doc`: Signifying a documentation improvement.\r\n    * `.removal`: Signifying a deprecation or removal of public API.\r\n    * `.misc`: A ticket has been closed, but it is not of interest to users.\r\n  * Make sure to use full sentences with correct case and punctuation, for example: \"Fix issue with non-ascii contents in doctest text files.\"\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6369/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6369/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6327", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6327/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6327/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6327/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6327", "id": 1058826296, "node_id": "I_kwDOAMpNN84_HGg4", "number": 6327, "title": "Confusing about python3.10 SSL certificates", "user": {"login": "deknowny", "id": 57015939, "node_id": "MDQ6VXNlcjU3MDE1OTM5", "avatar_url": "https://avatars.githubusercontent.com/u/57015939?v=4", "gravatar_id": "", "url": "https://api.github.com/users/deknowny", "html_url": "https://github.com/deknowny", "followers_url": "https://api.github.com/users/deknowny/followers", "following_url": "https://api.github.com/users/deknowny/following{/other_user}", "gists_url": "https://api.github.com/users/deknowny/gists{/gist_id}", "starred_url": "https://api.github.com/users/deknowny/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/deknowny/subscriptions", "organizations_url": "https://api.github.com/users/deknowny/orgs", "repos_url": "https://api.github.com/users/deknowny/repos", "events_url": "https://api.github.com/users/deknowny/events{/privacy}", "received_events_url": "https://api.github.com/users/deknowny/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2021-11-19T19:02:13Z", "updated_at": "2021-11-20T21:17:00Z", "closed_at": "2021-11-19T19:12:47Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\n`python3.10` drops support of creating `ssl.SSLContext()` without `protocol=` argument. It shows `DeprecationWarning`:\r\n```\r\n/some/my/path/file.py:63: DeprecationWarning: ssl.SSLContext() without protocol argument is deprecated.\r\n    url, ssl=ssl.SSLContext()\r\n```\r\nWhen I try to use `aiohttp` like this:\r\n```python\r\nasync with self.session.post(\r\n     url, data=form_data, ssl=ssl.SSLContext()\r\n) as response:\r\n```\r\n***\r\nI found a bug report about this: https://bugs.python.org/issue44362 \r\n> You either use TLS_PROTOCOL_CLIENT for a client-side socket or TLS_PROTOCOL_SERVER for a server-side socket. TLS_PROTOCOL_CLIENT gives you a secure context for client connections with cert and hostname verification.\r\n\r\nAnd there should be a solution if I will create context instance with this param (a mistake in his message: no `TLS_PROTOCOL_CLIENT` exists, only `PROTOCOL_TLS_CLIENT`):\r\n```python\r\nssl.SSLContext(protocol=ssl.PROTOCOL_TLS_CLIENT)\r\n```\r\nBut I get such error (full stack trace below in issue):\r\n```\r\nssl.SSLCertVerificationError: [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:997)\r\n```\r\n***\r\nI use MacOS and I found this question on stackoverflow: https://stackoverflow.com/questions/52805115/certificate-verify-failed-unable-to-get-local-issuer-certificate and I run `Install Certificates.command`. This doesn't work (because I used python in a venv, I recreate a venv but it doesn't help)\r\n\r\nIn `python3.9` and earlier `Install Certificates.command` works correctly and I could use `aiohttp` without `ssl.SSLContext()` at all.\r\n\r\nSo there is no way of correct ssl client usage without warning/errors\r\n\r\n### To Reproduce\r\n\r\n1. Try to make a request on MacOS like this with selected ssl protocol on `python3.10` as said in bug report response:\r\n```python\r\nasync with self.session.post(\r\n    url, data=form_data, ssl=ssl.SSLContext(protocol=ssl.PROTOCOL_TLS_CLIENT)\r\n) as response:\r\n    return await response.read()\r\n```\r\n\r\n### Expected behavior\r\n\r\nNo warnings and errors\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nTraceback (most recent call last):\r\n  File \"/Users/an/Desktop/demapi/.venv/lib/python3.10/site-packages/aiohttp/connector.py\", line 986, in _wrap_create_connection\r\n    return await self._loop.create_connection(*args, **kwargs)  # type: ignore[return-value]  # noqa\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py\", line 1080, in create_connection\r\n    transport, protocol = await self._create_connection_transport(\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py\", line 1110, in _create_connection_transport\r\n    await waiter\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/sslproto.py\", line 528, in data_received\r\n    ssldata, appdata = self._sslpipe.feed_ssldata(data)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/sslproto.py\", line 188, in feed_ssldata\r\n    self._sslobj.do_handshake()\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/ssl.py\", line 974, in do_handshake\r\n    self._sslobj.do_handshake()\r\nssl.SSLCertVerificationError: [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:997)\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"/Users/an/Desktop/demapi/examples/coroutine.py\", line 21, in <module>\r\n    asyncio.run(main())\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py\", line 44, in run\r\n    return loop.run_until_complete(main)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py\", line 641, in run_until_complete\r\n    return future.result()\r\n  File \"/Users/an/Desktop/demapi/examples/coroutine.py\", line 15, in main\r\n    image = await conf.coroutine_download()\r\n  File \"/Users/an/Desktop/demapi/demapi/configure/view.py\", line 64, in coroutine_download\r\n    return await self.loader.coroutine_download(payload, session)\r\n  File \"/Users/an/Desktop/demapi/demapi/loader.py\", line 47, in coroutine_download\r\n    preview_page = await connector.post(\r\n  File \"/Users/an/Desktop/demapi/demapi/connector/coroutine.py\", line 56, in post\r\n    async with self.session.post(\r\n  File \"/Users/an/Desktop/demapi/.venv/lib/python3.10/site-packages/aiohttp/client.py\", line 1138, in __aenter__\r\n    self._resp = await self._coro\r\n  File \"/Users/an/Desktop/demapi/.venv/lib/python3.10/site-packages/aiohttp/client.py\", line 535, in _request\r\n    conn = await self._connector.connect(\r\n  File \"/Users/an/Desktop/demapi/.venv/lib/python3.10/site-packages/aiohttp/connector.py\", line 542, in connect\r\n    proto = await self._create_connection(req, traces, timeout)\r\n  File \"/Users/an/Desktop/demapi/.venv/lib/python3.10/site-packages/aiohttp/connector.py\", line 907, in _create_connection\r\n    _, proto = await self._create_direct_connection(req, traces, timeout)\r\n  File \"/Users/an/Desktop/demapi/.venv/lib/python3.10/site-packages/aiohttp/connector.py\", line 1206, in _create_direct_connection\r\n    raise last_exc\r\n  File \"/Users/an/Desktop/demapi/.venv/lib/python3.10/site-packages/aiohttp/connector.py\", line 1175, in _create_direct_connection\r\n    transp, proto = await self._wrap_create_connection(\r\n  File \"/Users/an/Desktop/demapi/.venv/lib/python3.10/site-packages/aiohttp/connector.py\", line 988, in _wrap_create_connection\r\n    raise ClientConnectorCertificateError(req.connection_key, exc) from exc\r\naiohttp.client_exceptions.ClientConnectorCertificateError: Cannot connect to host www.imgonline.com.ua:443 ssl:True [SSLCertVerificationError: (1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:997)')]\r\n```\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n3.10\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n3.8.1\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n5.2.0\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n1.7.2\r\n```\r\n\r\n\r\n### OS\r\n\r\nmacOS\r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\nNo proxies. Everything works with `python3.9` and earlier and `ssl.SSLContext()` instance without protocol argument\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6327/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6327/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6326", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6326/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6326/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6326/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6326", "id": 1057528943, "node_id": "I_kwDOAMpNN84_CJxv", "number": 6326, "title": "Use of `base_url` causes `TypeError`", "user": {"login": "amikrop", "id": 24046, "node_id": "MDQ6VXNlcjI0MDQ2", "avatar_url": "https://avatars.githubusercontent.com/u/24046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/amikrop", "html_url": "https://github.com/amikrop", "followers_url": "https://api.github.com/users/amikrop/followers", "following_url": "https://api.github.com/users/amikrop/following{/other_user}", "gists_url": "https://api.github.com/users/amikrop/gists{/gist_id}", "starred_url": "https://api.github.com/users/amikrop/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/amikrop/subscriptions", "organizations_url": "https://api.github.com/users/amikrop/orgs", "repos_url": "https://api.github.com/users/amikrop/repos", "events_url": "https://api.github.com/users/amikrop/events{/privacy}", "received_events_url": "https://api.github.com/users/amikrop/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-11-18T16:05:58Z", "updated_at": "2021-11-18T22:04:21Z", "closed_at": "2021-11-18T22:04:21Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nPassing a base URL to `ClientSession` causes `TypeError: __init__() takes 1 positional argument but 2 were given`.\r\n\r\n### To Reproduce\r\n\r\n```\r\n$ python -m asyncio\r\nasyncio REPL 3.8.9 (default, Apr  3 2021, 01:02:10) \r\n[GCC 5.4.0 20160609] on linux\r\nUse \"await\" directly instead of \"asyncio.run()\".\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import asyncio\r\n>>> import aiohttp\r\n>>> async with aiohttp.ClientSession(\"http://google.com\") as session:\r\n...     pass\r\n... \r\n```\r\n\r\n### Expected behavior\r\n\r\nThat it actually works as demonstrated on https://docs.aiohttp.org/en/stable/client_quickstart.html#make-a-request (snippet above the Note).\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nException ignored in: <function ClientSession.__del__ at 0x7f2bec556b80>\r\nTraceback (most recent call last):\r\n  File \"/ommited/.venv/lib/python3.8/site-packages/aiohttp/client.py\", line 269, in __del__\r\n    if not self.closed:\r\n  File \"/ommited/.venv/lib/python3.8/site-packages/aiohttp/client.py\", line 894, in closed\r\n    return self._connector is None or self._connector.closed\r\nAttributeError: _connector\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3.8/concurrent/futures/_base.py\", line 444, in result\r\n    return self.__get_result()\r\n  File \"/usr/lib/python3.8/concurrent/futures/_base.py\", line 389, in __get_result\r\n    raise self._exception\r\n  File \"<console>\", line 1, in <module>\r\nTypeError: __init__() takes 1 positional argument but 2 were given\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n$ python --version\r\nPython 3.8.9\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 4.0.0a1\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /ommited/.venv/lib/python3.8/site-packages\r\nRequires: typing-extensions, multidict, chardet, async-timeout, yarl, attrs\r\nRequired-by:\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.6\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /ommited/.venv/lib/python3.8/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.7.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /ommited/.venv/lib/python3.8/site-packages\r\nRequires: multidict, idna\r\nRequired-by: aiohttp\r\n```\r\n\r\n\r\n### OS\r\n\r\nUbuntu 16.04\r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6326/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6326/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6324", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6324/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6324/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6324/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6324", "id": 1057029269, "node_id": "I_kwDOAMpNN84_APyV", "number": 6324, "title": "Cannot get the return from the server using ClientSession, resulting in concurrent.futures._base.TimeoutError", "user": {"login": "harrylyx", "id": 8840101, "node_id": "MDQ6VXNlcjg4NDAxMDE=", "avatar_url": "https://avatars.githubusercontent.com/u/8840101?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harrylyx", "html_url": "https://github.com/harrylyx", "followers_url": "https://api.github.com/users/harrylyx/followers", "following_url": "https://api.github.com/users/harrylyx/following{/other_user}", "gists_url": "https://api.github.com/users/harrylyx/gists{/gist_id}", "starred_url": "https://api.github.com/users/harrylyx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harrylyx/subscriptions", "organizations_url": "https://api.github.com/users/harrylyx/orgs", "repos_url": "https://api.github.com/users/harrylyx/repos", "events_url": "https://api.github.com/users/harrylyx/events{/privacy}", "received_events_url": "https://api.github.com/users/harrylyx/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-11-18T07:31:34Z", "updated_at": "2021-11-19T02:47:31Z", "closed_at": "2021-11-19T02:47:31Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Describe the bug\n\nWhen I use `ClientSession`, sometime send post request, server has returned message, but client did not receive, then client will be `TimeoutError`.In each test, the number of successes is random.\n\n### To Reproduce\n\n## A Simple Server\r\n```python\r\nfrom aiohttp import web\r\n\r\nasync def hello(request):\r\n    data = await request.text()\r\n    print(data)\r\n    return web.json_response(data)\r\n\r\n\r\napp = web.Application()\r\napp.add_routes([web.post(\"/\", hello)])\r\n\r\nweb.run_app(app, host=\"127.0.0.1\", port=5000)\r\n```\r\n\r\n## Client\r\n```python\r\nimport asyncio\r\nimport requests\r\nfrom aiohttp.client import ClientSession\r\n\r\n\r\nasync def make_request(*args, **kwargs):\r\n    async with ClientSession() as session:\r\n        response = await session.request(\r\n            method=\"post\",\r\n            url=\"http://127.0.0.1:5000/\",\r\n            allow_redirects=False,\r\n            timeout=1,\r\n            *args,\r\n            **kwargs\r\n        )\r\n    return await response.json()\r\n\r\n\r\nasync def generate_aiohttp(num):\r\n    headers = {\"Content-Type\": \"application/json\"}\r\n    features = {\"test\": \"test\"}\r\n    _res_json = await make_request(json={\"num\": num}, headers=headers)\r\n    print(_res_json)\r\n\r\n\r\ndef generate_requests(num):\r\n    headers = {\"Content-Type\": \"application/json\"}\r\n    features = {\"test\": \"test\"}\r\n    _res_json = requests.post(\r\n        \"http://127.0.0.1:5000/\", json={\"num\": num}, headers=headers\r\n    )\r\n    print(_res_json.text)\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    loop = asyncio.get_event_loop()\r\n    for i in range(100):\r\n        loop.run_until_complete(generate_aiohttp(i))\r\n\r\n    # for _ in range(100):\r\n    #     generate_requests()\r\n```\r\n\r\n## Run\r\nFirst run server, `python server.py`\r\nThen run client, `python client.py`\r\n\r\n\n\n### Expected behavior\n\nEvery request should return successfully\r\nI use `ClientSession`, it will be `TimeoutError`, but I use `requests.post`, it will be success.\n\n### Logs/tracebacks\n\n```python-traceback\n# server\r\n\u276f python -m tests.test_sever_bug\r\n======== Running on http://127.0.0.1:5000 ========\r\n(Press CTRL+C to quit)\r\n{\"num\": 0}\r\n{\"num\": 1}\r\n{\"num\": 2}\r\n{\"num\": 3}\r\n{\"num\": 4}\r\n{\"num\": 5}\r\n{\"num\": 6}\r\n{\"num\": 7}\r\n\r\n# client\r\n\u276f python -m tests.test_client_bug\r\n{\"num\": 0}\r\n{\"num\": 1}\r\n{\"num\": 2}\r\n{\"num\": 3}\r\n{\"num\": 4}\r\n{\"num\": 5}\r\n{\"num\": 6}\r\nTraceback (most recent call last):\r\n  File \"/anaconda3/envs/aiohttp/lib/python3.7/runpy.py\", line 193, in _run_module_as_main\r\n    \"__main__\", mod_spec)\r\n  File \"/anaconda3/envs/aiohttp/lib/python3.7/runpy.py\", line 85, in _run_code\r\n    exec(code, run_globals)\r\n  File \"/aiohttp/tests/test_client_bug.py\", line 38, in <module>\r\n    loop.run_until_complete(generate_aiohttp(i))\r\n  File \"/anaconda3/envs/aiohttp/lib/python3.7/asyncio/base_events.py\", line 587, in run_until_complete\r\n    return future.result()\r\n  File \"/aiohttp/tests/test_client_bug.py\", line 22, in generate_aiohttp\r\n    _res_json = await make_request(json={\"num\": num}, headers=headers)\r\n  File \"/aiohttp/tests/test_client_bug.py\", line 16, in make_request\r\n    return await response.json()\r\n  File \"/aiohttp/aiohttp/client_reqrep.py\", line 1024, in json\r\n    await self.read()\r\n  File \"/aiohttp/aiohttp/client_reqrep.py\", line 964, in read\r\n    self._body = await self.content.read()\r\n  File \"/aiohttp/aiohttp/streams.py\", line 367, in read\r\n    block = await self.readany()\r\n  File \"/aiohttp/aiohttp/streams.py\", line 389, in readany\r\n    await self._wait(\"readany\")\r\n  File \"/aiohttp/aiohttp/streams.py\", line 310, in _wait\r\n    await waiter\r\n  File \"/aiohttp/aiohttp/helpers.py\", line 694, in __exit__\r\n    raise asyncio.TimeoutError from None\r\nconcurrent.futures._base.TimeoutError\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\nPython 3.7.11\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\n4.0.0a1\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.2.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.7.0\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\n```\n\n\n### OS\n\nmacOS Big Sur 11.5.2 (20G95)\n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6324/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6324/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6323", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6323/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6323/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6323/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6323", "id": 1056832037, "node_id": "I_kwDOAMpNN84-_fol", "number": 6323, "title": "RouteTableDef.options() not available in 3.8.1 on PyPI", "user": {"login": "tstodden", "id": 60882720, "node_id": "MDQ6VXNlcjYwODgyNzIw", "avatar_url": "https://avatars.githubusercontent.com/u/60882720?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tstodden", "html_url": "https://github.com/tstodden", "followers_url": "https://api.github.com/users/tstodden/followers", "following_url": "https://api.github.com/users/tstodden/following{/other_user}", "gists_url": "https://api.github.com/users/tstodden/gists{/gist_id}", "starred_url": "https://api.github.com/users/tstodden/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tstodden/subscriptions", "organizations_url": "https://api.github.com/users/tstodden/orgs", "repos_url": "https://api.github.com/users/tstodden/repos", "events_url": "https://api.github.com/users/tstodden/events{/privacy}", "received_events_url": "https://api.github.com/users/tstodden/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2021-11-18T01:44:09Z", "updated_at": "2021-11-19T07:47:28Z", "closed_at": "2021-11-19T07:47:28Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nThere is an `options()` method available for `RouteTableDef` in `web_routedef.py` for 3.8.1, but when I go to use the decorator approach for creating a route I get a failure saying `AttributeError: 'RouteTableDef' object has no attribute 'options'`. I downloaded the source from PyPI and the options method seems to be missing.\r\n\r\nIs there some reason why this method would not be included in the package distributed on PyPI? Thanks!\n\n### To Reproduce\n\n1. Install aiohttp 3.8.1 from PyPI\r\n2. Attempt to create a route using the following approach\r\n ```\r\nroutes = web.RouteTableDef()\r\n\r\n@routes.options(\"/email\")\r\nasync def handle...\r\n```\n\n### Expected behavior\n\nTo be able to use the following approach to creating a route that can handle an OPTIONS request\r\n ```\r\nroutes = web.RouteTableDef()\r\n\r\n@routes.options(\"/email\")\r\nasync def handle...\r\n```\n\n### Logs/tracebacks\n\n```python-traceback\nTraceback (most recent call last):\r\n  File \"/home/tyler/.pyenv/versions/3.10.0/lib/python3.10/runpy.py\", line 196, in _run_module_as_main\r\n    return _run_code(code, main_globals, None,\r\n  File \"/home/tyler/.pyenv/versions/3.10.0/lib/python3.10/runpy.py\", line 86, in _run_code\r\n    exec(code, run_globals)\r\n  File \"/home/tyler/code/python/email-service/service/__main__.py\", line 12, in <module>\r\n    @routes.options(\"/email\")\r\nAttributeError: 'RouteTableDef' object has no attribute 'options'\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\nPython 3.10.0\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.8.1\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor:\r\nAuthor-email:\r\nLicense: Apache 2\r\nLocation: /home/tyler/.local/share/virtualenvs/email-service-fx4Px62o/lib/python3.10/site-packages\r\nRequires: frozenlist, aiosignal, yarl, attrs, async-timeout, multidict, charset-normalizer\r\nRequired-by:\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.2.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/tyler/.local/share/virtualenvs/email-service-fx4Px62o/lib/python3.10/site-packages\r\nRequires:\r\nRequired-by: yarl, aiohttp\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.7.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/tyler/.local/share/virtualenvs/email-service-fx4Px62o/lib/python3.10/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\n```\n\n\n### OS\n\nArch Linux\n\n### Related component\n\nServer\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6323/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6323/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6319", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6319/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6319/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6319/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6319", "id": 1056068136, "node_id": "I_kwDOAMpNN84-8lIo", "number": 6319, "title": "Pypi meta shows wrong python requirement", "user": {"login": "WisdomPill", "id": 5825811, "node_id": "MDQ6VXNlcjU4MjU4MTE=", "avatar_url": "https://avatars.githubusercontent.com/u/5825811?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WisdomPill", "html_url": "https://github.com/WisdomPill", "followers_url": "https://api.github.com/users/WisdomPill/followers", "following_url": "https://api.github.com/users/WisdomPill/following{/other_user}", "gists_url": "https://api.github.com/users/WisdomPill/gists{/gist_id}", "starred_url": "https://api.github.com/users/WisdomPill/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WisdomPill/subscriptions", "organizations_url": "https://api.github.com/users/WisdomPill/orgs", "repos_url": "https://api.github.com/users/WisdomPill/repos", "events_url": "https://api.github.com/users/WisdomPill/events{/privacy}", "received_events_url": "https://api.github.com/users/WisdomPill/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 58986078, "node_id": "MDU6TGFiZWw1ODk4NjA3OA==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/invalid", "name": "invalid", "color": "e4e669", "default": true, "description": "This doesn't seem right"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-11-17T12:23:01Z", "updated_at": "2021-11-17T18:05:50Z", "closed_at": "2021-11-17T13:57:13Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "### Describe the bug\n\nHaving a look [here](https://pypi.org/project/aiohttp/) on the meta section on the left side, there is written that python>=3.6 is supported, while it is only python>=3.7 is supported\n\n### To Reproduce\n\nHave a look [here](https://pypi.org/project/aiohttp/)\n\n### Expected behavior\n\nhaving the right python requirement on pipy\n\n### Logs/tracebacks\n\n```python-traceback\nnone\n```\n\n\n### Python Version\n\n```console\n$ python --version\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\n```\n\n\n### OS\n\nall\n\n### Related component\n\nServer, Client\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6319/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6319/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6250", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6250/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6250/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6250/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6250", "id": 1044693360, "node_id": "I_kwDOAMpNN84-RMFw", "number": 6250, "title": "Removal of signals module in 3.8 causing breaking changes downstream.", "user": {"login": "timothylunaxj4s", "id": 93391292, "node_id": "U_kgDOBZEJvA", "avatar_url": "https://avatars.githubusercontent.com/u/93391292?v=4", "gravatar_id": "", "url": "https://api.github.com/users/timothylunaxj4s", "html_url": "https://github.com/timothylunaxj4s", "followers_url": "https://api.github.com/users/timothylunaxj4s/followers", "following_url": "https://api.github.com/users/timothylunaxj4s/following{/other_user}", "gists_url": "https://api.github.com/users/timothylunaxj4s/gists{/gist_id}", "starred_url": "https://api.github.com/users/timothylunaxj4s/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/timothylunaxj4s/subscriptions", "organizations_url": "https://api.github.com/users/timothylunaxj4s/orgs", "repos_url": "https://api.github.com/users/timothylunaxj4s/repos", "events_url": "https://api.github.com/users/timothylunaxj4s/events{/privacy}", "received_events_url": "https://api.github.com/users/timothylunaxj4s/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 58986080, "node_id": "MDU6TGFiZWw1ODk4NjA4MA==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/wontfix", "name": "wontfix", "color": "b7942c", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2021-11-04T12:05:17Z", "updated_at": "2021-11-24T00:53:42Z", "closed_at": "2021-11-04T13:06:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nHello, I'm using aiohttp under the hood by the use of some higher level libraries, notably Ray and Modin. Ray started breaking on me a few days ago and the culprit appears to be that Ray is unable to access the aiohttp.signals module.\r\n\r\nRay workers are dying when they attempt to access the module with an Import error.\n\n### To Reproduce\n\n1. Use aiohttp > 3.7.4 (ideally 3.8)\r\n2. Attempt to import aiohttp.signals\n\n### Expected behavior\n\nNo ImportError\n\n### Logs/tracebacks\n\n```python-traceback\nNAN\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\nUsing both 3.8 and 3.9.\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\n# Failed version\r\naiohttp==3.8.0\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\nmultidict==5.2.0\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.7.0\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/local/lib/python3.9/site-packages\r\nRequires: multidict, idna\r\nRequired-by: aiohttp\n```\n\n\n### OS\n\nDebian / Ubuntu Linux\n\n### Related component\n\nServer, Client\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6250/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6250/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6236", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6236/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6236/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6236/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6236", "id": 1043529837, "node_id": "I_kwDOAMpNN84-MwBt", "number": 6236, "title": "Remove chardet from documentation and extra dependencies", "user": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 277836062, "node_id": "MDU6TGFiZWwyNzc4MzYwNjI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/good%20first%20issue", "name": "good first issue", "color": "7057ff", "default": true, "description": "Good for newcomers"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-11-03T12:39:52Z", "updated_at": "2021-11-14T12:47:34Z", "closed_at": "2021-11-14T12:47:34Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "### Describe the bug\n\nGrepping over the source code shows that chardet/cchardet is still present in codebase, but `chardet` was replaced with `charset-normalizer` by #5930\r\n\r\nA hero for dropping all remaining parts is wanted! \r\n\r\n:)\n\n### To Reproduce\n\ngrep over aiohttp cloned repo; or use github web search: https://github.com/aio-libs/aiohttp/search?q=chardet&type=code\n\n### Expected behavior\n\nNo chardet/cchardet in repo anymore\n\n### Logs/tracebacks\n\n```python-traceback\n---\n```\n\n\n### Python Version\n\n```console\nall\n```\n\n\n### aiohttp Version\n\n```console\nmaster, 3.8, 3.9\n```\n\n\n### multidict Version\n\n```console\n---\n```\n\n\n### yarl Version\n\n```console\n---\n```\n\n\n### OS\n\n---\n\n### Related component\n\nServer, Client\n\n### Additional context\n\nThe issue is easy\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6236/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6236/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6228", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6228/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6228/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6228/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6228", "id": 1042652748, "node_id": "I_kwDOAMpNN84-JZ5M", "number": 6228, "title": "[aiohttp==3.8.0] pip cannot install with `--no-index`", "user": {"login": "addyess", "id": 10090033, "node_id": "MDQ6VXNlcjEwMDkwMDMz", "avatar_url": "https://avatars.githubusercontent.com/u/10090033?v=4", "gravatar_id": "", "url": "https://api.github.com/users/addyess", "html_url": "https://github.com/addyess", "followers_url": "https://api.github.com/users/addyess/followers", "following_url": "https://api.github.com/users/addyess/following{/other_user}", "gists_url": "https://api.github.com/users/addyess/gists{/gist_id}", "starred_url": "https://api.github.com/users/addyess/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/addyess/subscriptions", "organizations_url": "https://api.github.com/users/addyess/orgs", "repos_url": "https://api.github.com/users/addyess/repos", "events_url": "https://api.github.com/users/addyess/events{/privacy}", "received_events_url": "https://api.github.com/users/addyess/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 9, "created_at": "2021-11-02T17:54:26Z", "updated_at": "2021-11-03T15:23:24Z", "closed_at": "2021-11-03T15:23:14Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nIn [this issue](https://github.com/pypa/setuptools/issues/1724) in setuptools project, it's shows that using \r\n\r\n```\r\nversion = attr: mypackage.__version__\r\n```\r\n\r\nmust import the `mypackage` module in order to find the version.  If that module imports dependencies which are not yet installed, the install process fails.\r\n\r\n### To Reproduce\r\n\r\n1) download version 3.8.0 of aiohttp and all downstream dependents \r\n2) create a virtualenv env\r\n3) pip install the package with `--find-links` pointing at the package directory containing all the dependant packages\r\n\r\n\r\n### Expected behavior\r\n\r\nThe expectation is that setuptools could install aiohttp because it lists it requirements in setup.cfg, but setuptools cannot read `setup.cfg` due to  trying to load the package version during `_parse_version`\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\n(venv) \u279c  /tmp pip freeze\r\n(venv) \u279c  /tmp ls wheelhouse \r\naiohttp-3.8.0.tar.gz        cached-property-1.5.2.tar.gz     frozenlist-1.2.0.tar.gz  Jinja2-2.10.1.tar.gz                 multidict-5.2.0.tar.gz               pbr-5.6.0.tar.gz      requests-2.26.0.tar.gz        tenacity-5.0.3.tar.gz\r\naiosignal-1.2.0.tar.gz      certifi-2021.10.8.tar.gz         gunicorn-20.1.0.tar.gz   loadbalancer_interface-1.1.1.tar.gz  netaddr-0.7.19.tar.gz                pip-18.1.tar.gz       setuptools-41.6.0.zip         typing_extensions-3.10.0.2.tar.gz\r\nasynctest-0.13.0.tar.gz     charmhelpers-0.20.23.tar.gz      hvac-0.11.2.tar.gz       MarkupSafe-1.1.1.tar.gz              netifaces-0.11.0.tar.gz              psutil-5.8.0.tar.gz   setuptools_scm-1.17.0.tar.gz  urllib3-1.26.7.tar.gz\r\nasync-timeout-4.0.0.tar.gz  charms.reactive-1.4.1.tar.gz     idna-3.3.tar.gz          marshmallow-3.14.0.tar.gz            ops-1.2.0.tar.gz                     pyaml-21.10.1.tar.gz  six-1.16.0.tar.gz             wheel-0.33.6.tar.gz\r\nattrs-21.2.0.tar.gz         charset-normalizer-2.0.7.tar.gz  idna-ssl-1.1.0.tar.gz    marshmallow-enum-1.5.1.tar.gz        ops_reactive_interface-1.0.1.tar.gz  PyYAML-5.2.tar.gz     Tempita-0.4.tar.gz            yarl-1.7.2.tar.gz\r\n(venv) \u279c  /tmp pip install --upgrade setuptools pip\r\nRequirement already satisfied: setuptools in ./venv/lib/python3.9/site-packages (58.4.0)\r\nRequirement already satisfied: pip in ./venv/lib/python3.9/site-packages (21.3.1)\r\n(venv) \u279c  /tmp pip install -U -f wheelhouse --no-index --no-cache-dir wheelhouse/aiohttp-3.8.0.tar.gz\r\nLooking in links: wheelhouse\r\nProcessing ./wheelhouse/aiohttp-3.8.0.tar.gz\r\n  Installing build dependencies ... done\r\n  Getting requirements to build wheel ... error\r\n  ERROR: Command errored out with exit status 1:\r\n   command: /tmp/venv/bin/python /tmp/venv/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py get_requires_for_build_wheel /tmp/tmpygjsimvg\r\n       cwd: /tmp/pip-req-build-3l4pzn_m\r\n  Complete output (53 lines):\r\n  *********************\r\n  * Accelerated build *\r\n  *********************\r\n  Traceback (most recent call last):\r\n    File \"/tmp/venv/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py\", line 363, in <module>\r\n      main()\r\n    File \"/tmp/venv/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py\", line 345, in main\r\n      json_out['return_val'] = hook(**hook_input['kwargs'])\r\n    File \"/tmp/venv/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py\", line 130, in get_requires_for_build_wheel\r\n      return hook(config_settings)\r\n    File \"/tmp/pip-build-env-46387wng/overlay/lib/python3.9/site-packages/setuptools/build_meta.py\", line 146, in get_requires_for_build_wheel\r\n      return self._get_build_requires(config_settings, requirements=['wheel'])\r\n    File \"/tmp/pip-build-env-46387wng/overlay/lib/python3.9/site-packages/setuptools/build_meta.py\", line 127, in _get_build_requires\r\n      self.run_setup()\r\n    File \"/tmp/pip-build-env-46387wng/overlay/lib/python3.9/site-packages/setuptools/build_meta.py\", line 236, in run_setup\r\n      super(_BuildMetaLegacyBackend,\r\n    File \"/tmp/pip-build-env-46387wng/overlay/lib/python3.9/site-packages/setuptools/build_meta.py\", line 142, in run_setup\r\n      exec(compile(code, __file__, 'exec'), locals())\r\n    File \"setup.py\", line 54, in <module>\r\n      setup(**setup_kwargs)\r\n    File \"/tmp/pip-build-env-46387wng/overlay/lib/python3.9/site-packages/setuptools/__init__.py\", line 145, in setup\r\n      return distutils.core.setup(**attrs)\r\n    File \"/usr/lib/python3.9/distutils/core.py\", line 121, in setup\r\n      dist.parse_config_files()\r\n    File \"/tmp/venv/lib/python3.9/site-packages/_virtualenv.py\", line 21, in parse_config_files\r\n      result = old_parse_config_files(self, *args, **kwargs)\r\n    File \"/tmp/pip-build-env-46387wng/overlay/lib/python3.9/site-packages/setuptools/dist.py\", line 700, in parse_config_files\r\n      parse_configuration(self, self.command_options,\r\n    File \"/tmp/pip-build-env-46387wng/overlay/lib/python3.9/site-packages/setuptools/config.py\", line 121, in parse_configuration\r\n      meta.parse()\r\n    File \"/tmp/pip-build-env-46387wng/overlay/lib/python3.9/site-packages/setuptools/config.py\", line 426, in parse\r\n      section_parser_method(section_options)\r\n    File \"/tmp/pip-build-env-46387wng/overlay/lib/python3.9/site-packages/setuptools/config.py\", line 399, in parse_section\r\n      self[name] = value\r\n    File \"/tmp/pip-build-env-46387wng/overlay/lib/python3.9/site-packages/setuptools/config.py\", line 184, in __setitem__\r\n      value = parser(value)\r\n    File \"/tmp/pip-build-env-46387wng/overlay/lib/python3.9/site-packages/setuptools/config.py\", line 514, in _parse_version\r\n      version = self._parse_attr(value, self.package_dir)\r\n    File \"/tmp/pip-build-env-46387wng/overlay/lib/python3.9/site-packages/setuptools/config.py\", line 349, in _parse_attr\r\n      module = import_module(module_name)\r\n    File \"/usr/lib/python3.9/importlib/__init__.py\", line 127, in import_module\r\n      return _bootstrap._gcd_import(name[level:], package, level)\r\n    File \"<frozen importlib._bootstrap>\", line 1030, in _gcd_import\r\n    File \"<frozen importlib._bootstrap>\", line 1007, in _find_and_load\r\n    File \"<frozen importlib._bootstrap>\", line 986, in _find_and_load_unlocked\r\n    File \"<frozen importlib._bootstrap>\", line 680, in _load_unlocked\r\n    File \"<frozen importlib._bootstrap_external>\", line 850, in exec_module\r\n    File \"<frozen importlib._bootstrap>\", line 228, in _call_with_frames_removed\r\n    File \"/tmp/pip-req-build-3l4pzn_m/aiohttp/__init__.py\", line 5, in <module>\r\n      from . import hdrs as hdrs\r\n    File \"/tmp/pip-req-build-3l4pzn_m/aiohttp/hdrs.py\", line 8, in <module>\r\n      from multidict import istr\r\n  ModuleNotFoundError: No module named 'multidict'\r\n  ----------------------------------------\r\nWARNING: Discarding file:///tmp/wheelhouse/aiohttp-3.8.0.tar.gz. Command errored out with exit status 1: /tmp/venv/bin/python /tmp/venv/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py get_requires_for_build_wheel /tmp/tmpygjsimvg Check the logs for full command output.\r\nERROR: Command errored out with exit status 1: /tmp/venv/bin/python /tmp/venv/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py get_requires_for_build_wheel /tmp/tmpygjsimvg Check the logs for full command output.\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n$ python --version\r\nPython 3.9.7\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\nfile:///tmp/wheelhouse/aiohttp-3.8.0.tar.gz\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\nfile:///tmp/wheelhouse/multidict-5.2.0.tar.gz\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\nfile:///tmp/wheelhouse/yarl-1.7.2.tar.gz\r\n```\r\n\r\n\r\n### OS\r\n\r\nUbuntu 21.10\r\n\r\n```\r\n(venv) \u279c  /tmp uname -a\r\nLinux addyesshp-lnx 5.13.0-20-generic #20-Ubuntu SMP Fri Oct 15 14:21:35 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux\r\n(venv) \u279c  /tmp cat /etc/os-release \r\nPRETTY_NAME=\"Ubuntu 21.10\"\r\nNAME=\"Ubuntu\"\r\nVERSION_ID=\"21.10\"\r\nVERSION=\"21.10 (Impish Indri)\"\r\nVERSION_CODENAME=impish\r\nID=ubuntu\r\nID_LIKE=debian\r\nHOME_URL=\"https://www.ubuntu.com/\"\r\nSUPPORT_URL=\"https://help.ubuntu.com/\"\r\nBUG_REPORT_URL=\"https://bugs.launchpad.net/ubuntu/\"\r\nPRIVACY_POLICY_URL=\"https://www.ubuntu.com/legal/terms-and-policies/privacy-policy\"\r\nUBUNTU_CODENAME=impish\r\n```\r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\nThis first fails in version 3.8.0 with the switch to defining more bits and bobs in `setup.cfg`.\r\n\r\nThe same process works fine with 3.7.4.post\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6228/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6228/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6227", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6227/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6227/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6227/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6227", "id": 1042585142, "node_id": "I_kwDOAMpNN84-JJY2", "number": 6227, "title": "aiohttp 3.8.0 wrong value of Request.rel_url.raw_path", "user": {"login": "ech0-py", "id": 415353, "node_id": "MDQ6VXNlcjQxNTM1Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/415353?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ech0-py", "html_url": "https://github.com/ech0-py", "followers_url": "https://api.github.com/users/ech0-py/followers", "following_url": "https://api.github.com/users/ech0-py/following{/other_user}", "gists_url": "https://api.github.com/users/ech0-py/gists{/gist_id}", "starred_url": "https://api.github.com/users/ech0-py/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ech0-py/subscriptions", "organizations_url": "https://api.github.com/users/ech0-py/orgs", "repos_url": "https://api.github.com/users/ech0-py/repos", "events_url": "https://api.github.com/users/ech0-py/events{/privacy}", "received_events_url": "https://api.github.com/users/ech0-py/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2021-11-02T16:37:47Z", "updated_at": "2021-12-13T13:21:18Z", "closed_at": "2021-12-13T13:21:18Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nWrong value of Request.rel_url.raw_path when request was made with url in absolute form\r\n\r\n### To Reproduce\r\n\r\n1. Make a simple server app with logging hook\r\n```\r\nfrom aiohttp import web\r\n\r\n\r\nasync def log(request, response):\r\n    print('rel_url:', request.rel_url)\r\n    print('raw_path:', request.rel_url.raw_path)\r\n\r\n\r\nasync def hello(request):\r\n    return web.Response(text=\"Hello, world\")\r\n\r\n\r\napp = web.Application()\r\napp.add_routes([web.get('/test', hello)])\r\napp.on_response_prepare.append(log)\r\nweb.run_app(app, host='127.0.0.1', port=3322)\r\n```\r\n2. Make a request using relative form of url:\r\n`echo -e \"GET /test HTTP/1.1\\r\\n\\r\\n\" | nc -N 127.0.0.1 3322`\r\n3. Make a request using absolute form of url:\r\n`echo -e \"GET http://aaa.com/test HTTP/1.1\\r\\n\\r\\n\" | nc -N 127.0.0.1 3322`\r\n\r\n### Expected behavior\r\n\r\nServer logs the \"raw_path\" as `/test` in both cases\r\n\r\n### Logs/tracebacks\r\n\r\n\r\naiohttp==3.8.0\r\n```python-traceback\r\nrel_url: /test\r\nraw_path: /test\r\n\r\nrel_url: http://abc.com/test\r\nraw_path: http://abc.com/test\r\n```\r\n\r\naiohttp==3.7.4\r\n```python-traceback\r\n\r\nrel_url: /test\r\nraw_path: /test\r\n\r\nrel_url: http://abc.com/test\r\nraw_path: /test\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\nPython 3.8.7\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\naiohttp==3.8.0\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\nmultidict==5.2.0\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\nyarl==1.7.2\r\n```\r\n\r\n\r\n### OS\r\n\r\nUbuntu 18.04\r\n\r\n### Related component\r\n\r\nServer\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [x] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6227/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6227/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6203", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6203/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6203/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6203/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6203", "id": 1041758087, "node_id": "I_kwDOAMpNN84-F_eH", "number": 6203, "title": "latest release (3.8.0) installs `examples` in site-packages", "user": {"login": "jieru-hu", "id": 4642412, "node_id": "MDQ6VXNlcjQ2NDI0MTI=", "avatar_url": "https://avatars.githubusercontent.com/u/4642412?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jieru-hu", "html_url": "https://github.com/jieru-hu", "followers_url": "https://api.github.com/users/jieru-hu/followers", "following_url": "https://api.github.com/users/jieru-hu/following{/other_user}", "gists_url": "https://api.github.com/users/jieru-hu/gists{/gist_id}", "starred_url": "https://api.github.com/users/jieru-hu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jieru-hu/subscriptions", "organizations_url": "https://api.github.com/users/jieru-hu/orgs", "repos_url": "https://api.github.com/users/jieru-hu/repos", "events_url": "https://api.github.com/users/jieru-hu/events{/privacy}", "received_events_url": "https://api.github.com/users/jieru-hu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-11-02T00:01:41Z", "updated_at": "2021-11-02T00:07:22Z", "closed_at": "2021-11-02T00:05:00Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nthe latest release installs a top level `examples` packages\r\n```\r\nls anaconda3/envs/p3711/lib/python3.7/site-packages/examples/\r\n```\r\nThis makes it not possible for me to use my own examples module. :( \n\n### To Reproduce\n\ninstall latest version\n\n### Expected behavior\n\ndo not install a top-level examples package. \n\n### Logs/tracebacks\n\n```python-traceback\nN/A\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\nPython 3.7.11\r\nand also python 3.8\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\n3.8.0\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\nVersion: 5.2.0\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nVersion: 1.7.2\n```\n\n\n### OS\n\nmacOS \n\n### Related component\n\nServer\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6203/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6203/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6197", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6197/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6197/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6197/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6197", "id": 1041465447, "node_id": "I_kwDOAMpNN84-E4Bn", "number": 6197, "title": "AttributeError: module 'aiohttp' has no attribute 'Signal'", "user": {"login": "NaokoReeves-BO", "id": 82063696, "node_id": "MDQ6VXNlcjgyMDYzNjk2", "avatar_url": "https://avatars.githubusercontent.com/u/82063696?v=4", "gravatar_id": "", "url": "https://api.github.com/users/NaokoReeves-BO", "html_url": "https://github.com/NaokoReeves-BO", "followers_url": "https://api.github.com/users/NaokoReeves-BO/followers", "following_url": "https://api.github.com/users/NaokoReeves-BO/following{/other_user}", "gists_url": "https://api.github.com/users/NaokoReeves-BO/gists{/gist_id}", "starred_url": "https://api.github.com/users/NaokoReeves-BO/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/NaokoReeves-BO/subscriptions", "organizations_url": "https://api.github.com/users/NaokoReeves-BO/orgs", "repos_url": "https://api.github.com/users/NaokoReeves-BO/repos", "events_url": "https://api.github.com/users/NaokoReeves-BO/events{/privacy}", "received_events_url": "https://api.github.com/users/NaokoReeves-BO/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-11-01T18:27:20Z", "updated_at": "2021-11-01T23:59:50Z", "closed_at": "2021-11-01T21:49:29Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\n```\r\nPython 3.7.10 (default, May  5 2021, 13:11:39) \r\n[Clang 12.0.0 (clang-1200.0.32.29)] on darwin\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> from aiohttp import *\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\nAttributeError: module 'aiohttp' has no attribute 'Signal'\r\n```\r\n\r\n### To Reproduce\r\n\r\n```\r\nPython 3.7.10 (default, May  5 2021, 13:11:39) \r\n[Clang 12.0.0 (clang-1200.0.32.29)] on darwin\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> from aiohttp import *\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\nAttributeError: module 'aiohttp' has no attribute 'Signal'\r\n```\r\n\r\n### Expected behavior\r\n\r\nNo error. \r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nPython 3.7.10 (default, May  5 2021, 13:11:39) \r\n[Clang 12.0.0 (clang-1200.0.32.29)] on darwin\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> from aiohttp import *\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\nAttributeError: module 'aiohttp' has no attribute 'Signal'\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n$ python --version\r\n3.7.10\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.8.0\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: \r\nAuthor-email: \r\nLicense: Apache 2\r\nLocation: /Users/naoko.reeves/.pyenv/versions/3.7.10/envs/mdl-pipelines-3.7.10/lib/python3.7/site-packages\r\nRequires: aiosignal, async-timeout, asynctest, attrs, charset-normalizer, frozenlist, multidict, typing-extensions, yarl\r\nRequired-by: pytest-aiohttp\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.2.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/naoko.reeves/.pyenv/versions/3.7.10/envs/mdl-pipelines-3.7.10/lib/python3.7/site-packages\r\nRequires: \r\nRequired-by: aiohttp, yarl\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.7.0\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/naoko.reeves/.pyenv/versions/3.7.10/envs/mdl-pipelines-3.7.10/lib/python3.7/site-packages\r\nRequires: idna, multidict, typing-extensions\r\nRequired-by: aiohttp\r\n```\r\n\r\n\r\n### OS\r\n\r\nmacOSX\r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6197/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6197/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6195", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6195/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6195/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6195/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6195", "id": 1041137312, "node_id": "I_kwDOAMpNN84-Dn6g", "number": 6195, "title": "Connecting to IPv6-only hosts fails with a `RuntimeError`", "user": {"login": "leenr", "id": 6132358, "node_id": "MDQ6VXNlcjYxMzIzNTg=", "avatar_url": "https://avatars.githubusercontent.com/u/6132358?v=4", "gravatar_id": "", "url": "https://api.github.com/users/leenr", "html_url": "https://github.com/leenr", "followers_url": "https://api.github.com/users/leenr/followers", "following_url": "https://api.github.com/users/leenr/following{/other_user}", "gists_url": "https://api.github.com/users/leenr/gists{/gist_id}", "starred_url": "https://api.github.com/users/leenr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/leenr/subscriptions", "organizations_url": "https://api.github.com/users/leenr/orgs", "repos_url": "https://api.github.com/users/leenr/repos", "events_url": "https://api.github.com/users/leenr/events{/privacy}", "received_events_url": "https://api.github.com/users/leenr/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344995986, "node_id": "MDU6TGFiZWwzNDQ5OTU5ODY=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/client", "name": "client", "color": "bfd4f2", "default": false, "description": null}, {"id": 1577406386, "node_id": "MDU6TGFiZWwxNTc3NDA2Mzg2", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/regression", "name": "regression", "color": "c62b3b", "default": false, "description": "Something that used to work stopped working \"as before\" after upgrade"}, {"id": 1831256427, "node_id": "MDU6TGFiZWwxODMxMjU2NDI3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/reproducer:%20present", "name": "reproducer: present", "color": "c2e0c6", "default": false, "description": "This PR or issue contains code, which reproduce the problem described or clearly understandable STR"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/24", "html_url": "https://github.com/aio-libs/aiohttp/milestone/24", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/24/labels", "id": 7208553, "node_id": "MI_kwDOAMpNN84Abf5p", "number": 24, "title": "3.8", "description": "aiohttp 3.8 release", "creator": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "open_issues": 2, "closed_issues": 20, "state": "open", "created_at": "2021-10-01T06:45:28Z", "updated_at": "2021-11-14T12:37:54Z", "due_on": null, "closed_at": null}, "comments": 6, "created_at": "2021-11-01T12:50:35Z", "updated_at": "2021-11-14T12:37:54Z", "closed_at": "2021-11-14T12:37:54Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nWhen aiohttp tries to connect to a host with only IPv6 address (with no IPv4 address), the exception `RuntimeError: coroutine raised StopIteration` is raised in [`TCPConnector._create_direct_connection`](https://github.com/aio-libs/aiohttp/blob/v3.8.0/aiohttp/connector.py#L1153) caused by the `StopIteration` in [`_DNSCacheTable.next_addrs`](https://github.com/aio-libs/aiohttp/blob/v3.8.0/aiohttp/connector.py#L716).\r\n\r\n### To Reproduce\r\n\r\n1. Create `aiohttp.ClientSession`.\r\n2. Try to request an URL with IPv6-only host, e.g. `ipv6.google.com`.\r\nE.g: `await ClientSession().get('https://ipv6.google.com')`\r\n\r\n### Expected behavior\r\n\r\n`await ClientSession().get('https://ipv6.google.com')` does not fail and returns a response.\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\n$ python -m asyncio\r\nasyncio REPL 3.9.7 (default, Oct 10 2021, 15:13:22)\r\n[GCC 11.1.0] on linux\r\n>>> import asyncio\r\n>>> from aiohttp import ClientSession\r\n>>> await ClientSession().get('https://ipv6.google.com')\r\nTraceback (most recent call last):\r\n  File \"/home/***/.local/lib/python3.9/site-packages/aiohttp/connector.py\", line 894, in _resolve_host\r\n    return self._cached_hosts.next_addrs(key)\r\n  File \"/home/***/.local/lib/python3.9/site-packages/aiohttp/connector.py\", line 716, in next_addrs\r\n    next(loop)\r\nStopIteration\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3.9/concurrent/futures/_base.py\", line 445, in result\r\n    return self.__get_result()\r\n  File \"/usr/lib/python3.9/concurrent/futures/_base.py\", line 390, in __get_result\r\n    raise self._exception\r\n  File \"<console>\", line 1, in <module>\r\n  File \"/home/***/.local/lib/python3.9/site-packages/aiohttp/client.py\", line 535, in _request\r\n    conn = await self._connector.connect(\r\n  File \"/home/***/.local/lib/python3.9/site-packages/aiohttp/connector.py\", line 543, in connect\r\n    proto = await self._create_connection(req, traces, timeout)\r\n  File \"/home/***/.local/lib/python3.9/site-packages/aiohttp/connector.py\", line 906, in _create_connection\r\n    _, proto = await self._create_direct_connection(req, traces, timeout)\r\n  File \"/home/***/.local/lib/python3.9/site-packages/aiohttp/connector.py\", line 1153, in _create_direct_connection\r\n    hosts = await asyncio.shield(host_resolved)\r\nRuntimeError: coroutine raised StopIteration\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n$ python --version\r\nPython 3.9.7\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.8.0\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor:\r\nAuthor-email:\r\nLicense: Apache 2\r\nLocation: /home/***/.local/lib/python3.9/site-packages\r\nRequires: aiosignal, async-timeout, attrs, charset-normalizer, frozenlist, multidict, yarl\r\nRequired-by:\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.1.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/***/.local/lib/python3.9/site-packages\r\nRequires:\r\nRequired-by: aiohttp, grpclib, yarl\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.3\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/***/.local/lib/python3.9/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\r\n### OS\r\n\r\nLinux\r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6195/reactions", "total_count": 3, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 3}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6195/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6153", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6153/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6153/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6153/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6153", "id": 1038531711, "node_id": "I_kwDOAMpNN8495rx_", "number": 6153, "title": "Build process is broken by README.rst linter check", "user": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-10-28T13:40:03Z", "updated_at": "2021-10-28T17:02:41Z", "closed_at": "2021-10-28T17:02:41Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "### Describe the bug\n\n`git://github.com/Lucas-C/pre-commit-hooks-markup` `rst-linter` cannot handle advanced sphinx roles added recently.  Ideas? \n\n### To Reproduce\n\nI\n\n### Expected behavior\n\ndon't\n\n### Logs/tracebacks\n\n```python-traceback\nlike\n```\n\n\n### Python Version\n\n```console\n$ python --version\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\n```\n\n\n### OS\n\nall these required form fields!!!!\n\n### Related component\n\nServer, Client\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6153/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6153/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6149", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6149/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6149/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6149/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6149", "id": 1037930030, "node_id": "I_kwDOAMpNN8493Y4u", "number": 6149, "title": "session.get with proxy doesn't work", "user": {"login": "wizzzz9", "id": 82789463, "node_id": "MDQ6VXNlcjgyNzg5NDYz", "avatar_url": "https://avatars.githubusercontent.com/u/82789463?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wizzzz9", "html_url": "https://github.com/wizzzz9", "followers_url": "https://api.github.com/users/wizzzz9/followers", "following_url": "https://api.github.com/users/wizzzz9/following{/other_user}", "gists_url": "https://api.github.com/users/wizzzz9/gists{/gist_id}", "starred_url": "https://api.github.com/users/wizzzz9/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wizzzz9/subscriptions", "organizations_url": "https://api.github.com/users/wizzzz9/orgs", "repos_url": "https://api.github.com/users/wizzzz9/repos", "events_url": "https://api.github.com/users/wizzzz9/events{/privacy}", "received_events_url": "https://api.github.com/users/wizzzz9/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 58986078, "node_id": "MDU6TGFiZWw1ODk4NjA3OA==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/invalid", "name": "invalid", "color": "e4e669", "default": true, "description": "This doesn't seem right"}, {"id": 344995986, "node_id": "MDU6TGFiZWwzNDQ5OTU5ODY=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/client", "name": "client", "color": "bfd4f2", "default": false, "description": null}, {"id": 1831255463, "node_id": "MDU6TGFiZWwxODMxMjU1NDYz", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/reproducer:%20missing", "name": "reproducer: missing", "color": "e23c36", "default": false, "description": "This PR or issue lacks code, which reproduce the problem described or clearly understandable STR"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-10-27T23:02:33Z", "updated_at": "2021-10-27T23:11:07Z", "closed_at": "2021-10-27T23:08:59Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nI don't understand what's the problem\r\nIt works without proxy, but doesn't work with proxy\r\n\r\n### To Reproduce\r\n\r\n```python\r\nimport aiohttp\r\nimport asyncio\r\n\r\n\r\n\r\nasync def main():\r\n    url = 'https://python.org'\r\n    async with aiohttp.ClientSession() as session:\r\n        async with session.get(url, proxy='http://85.209.199.231:30001') as response:\r\n\r\n            print(\"Status:\", response.status)\r\n            print(\"Content-type:\", response.headers['content-type'])\r\n\r\n            html = await response.text()\r\n            print(\"Body:\", html[:15], \"...\")\r\n\r\n\r\nres = asyncio.run(main())\r\nprint(res)\r\n```\r\n\r\n### Expected behavior\r\n\r\nI want to get a response.\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\patok\\AppData\\Local\\Programs\\Python\\Python38\\lib\\site-packages\\aiohttp\\connector.py\", line 969, in _wrap_create_connection\r\n    return await self._loop.create_connection(*args, **kwargs)  # type: ignore  # noqa\r\n  File \"C:\\Users\\patok\\AppData\\Local\\Programs\\Python\\Python38\\lib\\asyncio\\base_events.py\", line 1042, in create_connection\r\n    transport, protocol = await self._create_connection_transport(\r\n  File \"C:\\Users\\patok\\AppData\\Local\\Programs\\Python\\Python38\\lib\\asyncio\\base_events.py\", line 1072, in _create_connection_transport\r\n    await waiter\r\n  File \"C:\\Users\\patok\\AppData\\Local\\Programs\\Python\\Python38\\lib\\asyncio\\proactor_events.py\", line 395, in _loop_writing\r\n    self._write_fut = self._loop._proactor.send(self._sock, data)\r\n  File \"C:\\Users\\patok\\AppData\\Local\\Programs\\Python\\Python38\\lib\\asyncio\\windows_events.py\", line 525, in send\r\n    self._register_with_iocp(conn)\r\n  File \"C:\\Users\\patok\\AppData\\Local\\Programs\\Python\\Python38\\lib\\asyncio\\windows_events.py\", line 714, in _register_with_iocp\r\n    _overlapped.CreateIoCompletionPort(obj.fileno(), self._iocp, 0, 0)\r\nOSError: [WinError 87] \u041f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 \u0437\u0430\u0434\u0430\u043d \u043d\u0435\u0432\u0435\u0440\u043d\u043e\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"C:/Users/patok/Downloads/Telegram Desktop/test_proxy.py\", line 18, in <module>\r\n    res = asyncio.run(main())\r\n  File \"C:\\Users\\patok\\AppData\\Local\\Programs\\Python\\Python38\\lib\\asyncio\\runners.py\", line 43, in run\r\n    return loop.run_until_complete(main)\r\n  File \"C:\\Users\\patok\\AppData\\Local\\Programs\\Python\\Python38\\lib\\asyncio\\base_events.py\", line 608, in run_until_complete\r\n    return future.result()\r\n  File \"C:/Users/patok/Downloads/Telegram Desktop/test_proxy.py\", line 9, in main\r\n    async with session.get(url, proxy='http://85.209.199.231:30001') as response:\r\n  File \"C:\\Users\\patok\\AppData\\Local\\Programs\\Python\\Python38\\lib\\site-packages\\aiohttp\\client.py\", line 1117, in __aenter__\r\n    self._resp = await self._coro\r\n  File \"C:\\Users\\patok\\AppData\\Local\\Programs\\Python\\Python38\\lib\\site-packages\\aiohttp\\client.py\", line 520, in _request\r\n    conn = await self._connector.connect(\r\n  File \"C:\\Users\\patok\\AppData\\Local\\Programs\\Python\\Python38\\lib\\site-packages\\aiohttp\\connector.py\", line 535, in connect\r\n    proto = await self._create_connection(req, traces, timeout)\r\n  File \"C:\\Users\\patok\\AppData\\Local\\Programs\\Python\\Python38\\lib\\site-packages\\aiohttp\\connector.py\", line 890, in _create_connection\r\n    _, proto = await self._create_proxy_connection(req, traces, timeout)\r\n  File \"C:\\Users\\patok\\AppData\\Local\\Programs\\Python\\Python38\\lib\\site-packages\\aiohttp\\connector.py\", line 1139, in _create_proxy_connection\r\n    transport, proto = await self._wrap_create_connection(\r\n  File \"C:\\Users\\patok\\AppData\\Local\\Programs\\Python\\Python38\\lib\\site-packages\\aiohttp\\connector.py\", line 975, in _wrap_create_connection\r\n    raise client_error(req.connection_key, exc) from exc\r\naiohttp.client_exceptions.ClientConnectorError: Cannot connect to host python.org:443 ssl:default [\u041f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 \u0437\u0430\u0434\u0430\u043d \u043d\u0435\u0432\u0435\u0440\u043d\u043e]\r\n\r\nProcess finished with exit code 1\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\nPython 3.8.0 (tags/v3.8.0:fa919fd, Oct 14 2019, 19:37:50) [MSC v.1916 64 bit (AMD64)] on win32\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\naiohttp           3.7.4.post0\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\nmultidict         5.2.0\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\nyarl              1.7.0\r\n```\r\n\r\n\r\n### OS\r\n\r\nwindows 10\r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [x] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6149/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6149/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6130", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6130/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6130/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6130/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6130", "id": 1034865153, "node_id": "I_kwDOAMpNN849rsoB", "number": 6130, "title": "Subprocess returncode is not detected when running Gunicorn with aiohttp", "user": {"login": "harrylyx", "id": 8840101, "node_id": "MDQ6VXNlcjg4NDAxMDE=", "avatar_url": "https://avatars.githubusercontent.com/u/8840101?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harrylyx", "html_url": "https://github.com/harrylyx", "followers_url": "https://api.github.com/users/harrylyx/followers", "following_url": "https://api.github.com/users/harrylyx/following{/other_user}", "gists_url": "https://api.github.com/users/harrylyx/gists{/gist_id}", "starred_url": "https://api.github.com/users/harrylyx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harrylyx/subscriptions", "organizations_url": "https://api.github.com/users/harrylyx/orgs", "repos_url": "https://api.github.com/users/harrylyx/repos", "events_url": "https://api.github.com/users/harrylyx/events{/privacy}", "received_events_url": "https://api.github.com/users/harrylyx/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-10-25T09:01:14Z", "updated_at": "2021-10-27T17:10:18Z", "closed_at": "2021-10-27T17:10:18Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Describe the bug\n\nWhen starting Gunicorn with aiohttp worker(s), if the app uses `subprocess` to start other processes and captures the output, their `returncode` is in most cases `0`, even if the actual exit code was `1`.\n\n### To Reproduce\n\n```python\r\nimport asyncio\r\nimport subprocess\r\nfrom aiohttp import web\r\nfrom concurrent.futures import ProcessPoolExecutor\r\n\r\nEXECUTOR = ProcessPoolExecutor(4)\r\n\r\ndef create():\r\n    subprocess_run = subprocess.run(\r\n        \"pip install numpy==123\",\r\n        shell=True,\r\n        stdout=subprocess.PIPE,\r\n        stderr=subprocess.PIPE,\r\n    )\r\n    print(subprocess_run.returncode)\r\n    print(subprocess_run.stderr.decode(\"utf-8\"))\r\n    return f\"{subprocess_run.returncode}, {subprocess_run.stderr.decode('utf-8')}\"\r\n\r\n\r\nasync def index(request):\r\n    loop = asyncio.get_event_loop()\r\n    return web.Response(text=await loop.run_in_executor(EXECUTOR, create))\r\n\r\n\r\nasync def my_web_app():\r\n    app = web.Application()\r\n    app.router.add_get(\"/\", index)\r\n    return app\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    web.run_app(my_web_app())\r\n```\r\n\r\nThen run it with:\r\n```\r\ngunicorn start:my_web_app --bind localhost:8080 --worker-class aiohttp.GunicornWebWorker\r\n```\r\n\n\n### Expected behavior\n\nThe detected `returncode` should always be `1`, as the subprocess always exits with `1`.\n\n### Logs/tracebacks\n\n```python-traceback\n\u276f gunicorn start:my_web_app --bind localhost:8080 --worker-class aiohttp.GunicornWebWorker\r\n[2021-10-25 16:53:27 +0800] [4190] [INFO] Starting gunicorn 20.1.0\r\n[2021-10-25 16:53:27 +0800] [4190] [INFO] Listening at: http://127.0.0.1:8080 (4190)\r\n[2021-10-25 16:53:27 +0800] [4190] [INFO] Using worker: aiohttp.GunicornWebWorker\r\n[2021-10-25 16:53:27 +0800] [4193] [INFO] Booting worker with pid: 4193\r\n0\r\nERROR: Could not find a version that satisfies the requirement numpy==123 (from versions: 1.3.0, 1.4.1, 1.5.0, 1.5.1, 1.6.0, 1.6.1, 1.6.2, 1.7.0, 1.7.1, 1.7.2, 1.8.0, 1.8.1, 1.8.2, 1.9.0, 1.9.1, 1.9.2, 1.9.3, 1.10.0.post2, 1.10.1, 1.10.2, 1.10.4, 1.11.0, 1.11.1, 1.11.2, 1.11.3, 1.12.0, 1.12.1, 1.13.0rc1, 1.13.0rc2, 1.13.0, 1.13.1, 1.13.3, 1.14.0rc1, 1.14.0, 1.14.1, 1.14.2, 1.14.3, 1.14.4, 1.14.5, 1.14.6, 1.15.0rc1, 1.15.0rc2, 1.15.0, 1.15.1, 1.15.2, 1.15.3, 1.15.4, 1.16.0rc1, 1.16.0rc2, 1.16.0, 1.16.1, 1.16.2, 1.16.3, 1.16.4, 1.16.5, 1.16.6, 1.17.0rc1, 1.17.0rc2, 1.17.0, 1.17.1, 1.17.2, 1.17.3, 1.17.4, 1.17.5, 1.18.0rc1, 1.18.0, 1.18.1, 1.18.2, 1.18.3, 1.18.4, 1.18.5, 1.19.0rc1, 1.19.0rc2, 1.19.0, 1.19.1, 1.19.2, 1.19.3, 1.19.4, 1.19.5, 1.20.0rc1, 1.20.0rc2, 1.20.0, 1.20.1, 1.20.2, 1.20.3, 1.21.0rc1, 1.21.0rc2, 1.21.0, 1.21.1, 1.21.2, 1.21.3)\r\nERROR: No matching distribution found for numpy==123\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\nPython 3.7.10\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.4.post0\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/wj/tools/anaconda3/envs/py37/lib/python3.7/site-packages\r\nRequires: async-timeout, attrs, chardet, multidict, typing-extensions, yarl\r\nRequired-by: pytest-aiohttp\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.2.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/wj/tools/anaconda3/envs/py37/lib/python3.7/site-packages\r\nRequires: \r\nRequired-by: aiohttp, yarl\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.7.0\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/wj/tools/anaconda3/envs/py37/lib/python3.7/site-packages\r\nRequires: idna, multidict, typing-extensions\r\nRequired-by: aiohttp\n```\n\n\n### OS\n\nmacOS Big Sur 11.5.2 (20G95)\n\n### Related component\n\nServer, Client\n\n### Additional context\n\nYou can refer to the same question \r\nhttps://github.com/encode/uvicorn/issues/894\r\nhttps://github.com/encode/uvicorn/pull/895\r\n\r\nI guess bug in https://github.com/aio-libs/aiohttp/blob/master/aiohttp/worker.py\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6130/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6130/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6107", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6107/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6107/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6107/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/6107", "id": 1031300591, "node_id": "PR_kwDOAMpNN84tbyTZ", "number": 6107, "title": "Free resp conn @ `test_mark_formdata_as_processed`", "user": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 731921232, "node_id": "MDU6TGFiZWw3MzE5MjEyMzI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/infra", "name": "infra", "color": "e55e5b", "default": false, "description": null}, {"id": 2425792478, "node_id": "MDU6TGFiZWwyNDI1NzkyNDc4", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bot:chronographer:skip", "name": "bot:chronographer:skip", "color": "ead777", "default": false, "description": "This PR does not need to include a change note"}, {"id": 2451662697, "node_id": "MDU6TGFiZWwyNDUxNjYyNjk3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/backport-3.8", "name": "backport-3.8", "color": "000000", "default": false, "description": "Trigger automatic backporting to the 3.8 release branch by Patchback robot"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-10-20T11:34:07Z", "updated_at": "2021-10-20T11:44:02Z", "closed_at": "2021-10-20T11:43:50Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/6107", "html_url": "https://github.com/aio-libs/aiohttp/pull/6107", "diff_url": "https://github.com/aio-libs/aiohttp/pull/6107.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/6107.patch", "merged_at": "2021-10-20T11:43:50Z"}, "body": "## What do these changes do?\r\n\r\nThis patch attempts to make the tests more stable by explicitly closing the open resouces.\r\n\r\n## Are there changes in behavior for the user?\r\n\r\nNo.\r\n\r\n## Related issue number\r\n\r\nI saw this being flaky @ https://github.com/aio-libs/aiohttp/pull/5930 (before restarting the CI).\r\n\r\n## Checklist\r\n\r\n- [x] I think the code is well written\r\n- [x] Unit tests for the changes exist\r\n- [ ] Documentation reflects the changes\r\n- [x] If you provide code modification, please add yourself to `CONTRIBUTORS.txt`\r\n  * The format is &lt;Name&gt; &lt;Surname&gt;.\r\n  * Please keep alphabetical order, the file is sorted by names.\r\n- [ ] Add a new news fragment into the `CHANGES` folder\r\n  * name it `<issue_id>.<type>` for example (588.bugfix)\r\n  * if you don't have an `issue_id` change it to the pr id after creating the pr\r\n  * ensure type is one of the following:\r\n    * `.feature`: Signifying a new feature.\r\n    * `.bugfix`: Signifying a bug fix.\r\n    * `.doc`: Signifying a documentation improvement.\r\n    * `.removal`: Signifying a deprecation or removal of public API.\r\n    * `.misc`: A ticket has been closed, but it is not of interest to users.\r\n  * Make sure to use full sentences with correct case and punctuation, for example: \"Fix issue with non-ascii contents in doctest text files.\"\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6107/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6107/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6098", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6098/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6098/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6098/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6098", "id": 1029534631, "node_id": "I_kwDOAMpNN849XXOn", "number": 6098, "title": "Invalid documentation around request timeouts ", "user": {"login": "andre3racks", "id": 50502780, "node_id": "MDQ6VXNlcjUwNTAyNzgw", "avatar_url": "https://avatars.githubusercontent.com/u/50502780?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andre3racks", "html_url": "https://github.com/andre3racks", "followers_url": "https://api.github.com/users/andre3racks/followers", "following_url": "https://api.github.com/users/andre3racks/following{/other_user}", "gists_url": "https://api.github.com/users/andre3racks/gists{/gist_id}", "starred_url": "https://api.github.com/users/andre3racks/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andre3racks/subscriptions", "organizations_url": "https://api.github.com/users/andre3racks/orgs", "repos_url": "https://api.github.com/users/andre3racks/repos", "events_url": "https://api.github.com/users/andre3racks/events{/privacy}", "received_events_url": "https://api.github.com/users/andre3racks/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-10-18T19:56:48Z", "updated_at": "2021-10-21T16:15:15Z", "closed_at": "2021-10-21T16:15:15Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nIn [this documentation](https://docs.aiohttp.org/en/stable/client_quickstart.html#timeouts) describing timeout configuration, at the end of the section, it states: `All fields are floats, None or 0 disables a particular timeout check, see the ClientTimeout reference for defaults and additional details.`\r\n\r\nAfter some testing, this holds true if fields are `None`. However, it doesn't if these fields are set to 0. Setting these fields to 0 results in a timeout upon request. The doc should be updated to reflect this.\n\n### To Reproduce\n\nMake a request to some URL with the following timeout object:\r\n\r\n`timeout = aiohttp.ClientTimeout(\r\n        total=0,\r\n        sock_connect=0,\r\n        connect=0,\r\n        sock_read=0\r\n    )`\n\n### Expected behavior\n\naiohttp.client_exceptions.ServerTimeoutError: Connection timeout to host [URL]....\n\n### Logs/tracebacks\n\n```python-traceback\nTraceback (most recent call last):\r\n  File \"/home/andreas/.local/lib/python3.8/site-packages/aiohttp/client.py\", line 520, in _request\r\n    conn = await self._connector.connect(\r\n  File \"/home/andreas/.local/lib/python3.8/site-packages/aiohttp/connector.py\", line 535, in connect\r\n    proto = await self._create_connection(req, traces, timeout)\r\n  File \"/home/andreas/.local/lib/python3.8/site-packages/aiohttp/connector.py\", line 892, in _create_connection\r\n    _, proto = await self._create_direct_connection(req, traces, timeout)\r\n  File \"/home/andreas/.local/lib/python3.8/site-packages/aiohttp/connector.py\", line 999, in _create_direct_connection\r\n    hosts = await asyncio.shield(host_resolved)\r\nasyncio.exceptions.CancelledError\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/andreas/.local/lib/python3.8/site-packages/aiohttp/client.py\", line 520, in _request\r\n    conn = await self._connector.connect(\r\n  File \"/home/andreas/.local/lib/python3.8/site-packages/async_timeout/__init__.py\", line 45, in __exit__\r\n    self._do_exit(exc_type)\r\n  File \"/home/andreas/.local/lib/python3.8/site-packages/async_timeout/__init__.py\", line 92, in _do_exit\r\n    raise asyncio.TimeoutError\r\nasyncio.exceptions.TimeoutError\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"hit_bdProfile.py\", line 43, in <module>\r\n    loop.run_until_complete(coroutine)\r\n  File \"/usr/lib/python3.8/asyncio/base_events.py\", line 616, in run_until_complete\r\n    return future.result()\r\n  File \"hit_bdProfile.py\", line 29, in make_request\r\n    async with session.request(\r\n  File \"/home/andreas/.local/lib/python3.8/site-packages/aiohttp/client.py\", line 1117, in __aenter__\r\n    self._resp = await self._coro\r\n  File \"/home/andreas/.local/lib/python3.8/site-packages/aiohttp/client.py\", line 524, in _request\r\n    raise ServerTimeoutError(\r\naiohttp.client_exceptions.ServerTimeoutError: Connection timeout to host [URL]...\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\nPython 3.8.10\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.4.post0\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/andreas/.local/lib/python3.8/site-packages\r\nRequires: multidict, typing-extensions, async-timeout, chardet, attrs, yarl\r\nRequired-by:\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.2.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/andreas/.local/lib/python3.8/site-packages\r\nRequires:\r\nRequired-by: yarl, aiohttp\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.7.0\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/andreas/.local/lib/python3.8/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\n```\n\n\n### OS\n\nWindows 10, running through WSL1\n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6098/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6098/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6089", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6089/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6089/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6089/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6089", "id": 1028343591, "node_id": "I_kwDOAMpNN849S0cn", "number": 6089, "title": "undefined symbol '_PyGen_Send' for py3.10", "user": {"login": "sandeep-gh", "id": 24786309, "node_id": "MDQ6VXNlcjI0Nzg2MzA5", "avatar_url": "https://avatars.githubusercontent.com/u/24786309?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sandeep-gh", "html_url": "https://github.com/sandeep-gh", "followers_url": "https://api.github.com/users/sandeep-gh/followers", "following_url": "https://api.github.com/users/sandeep-gh/following{/other_user}", "gists_url": "https://api.github.com/users/sandeep-gh/gists{/gist_id}", "starred_url": "https://api.github.com/users/sandeep-gh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sandeep-gh/subscriptions", "organizations_url": "https://api.github.com/users/sandeep-gh/orgs", "repos_url": "https://api.github.com/users/sandeep-gh/repos", "events_url": "https://api.github.com/users/sandeep-gh/events{/privacy}", "received_events_url": "https://api.github.com/users/sandeep-gh/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-10-17T14:37:20Z", "updated_at": "2021-10-23T10:46:48Z", "closed_at": "2021-10-23T10:46:48Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nI have compiled aiohttp (from github) with latest cython. On runs I get error: \r\n```\r\npython3:/home/kabira/DrivingRange/asyncweb/py310async/lib/python3.10/site-packages/aiohttp-3.7.4.post0-py3.10-openbsd-7.0-arm64.egg/aiohttp/_http_parser.cpython-310.so: undefined symbol '_PyGen_Send'\r\n```\r\n\r\nAs I understand this was issue was patched and fixed. \r\n\n\n### To Reproduce\n\nDownload and install latest cython.\r\nDownload and install latest aiohttp.\r\nRun any example code. \n\n### Expected behavior\n\nAiohttp code should not refer to _PyGen_Send (I think).\n\n### Logs/tracebacks\n\n```python-traceback\nnot applicable\n```\n\n\n### Python Version\n\n```console\nPython 3.10.0\n```\n\n\n### aiohttp Version\n\n```console\nName: aiohttp\r\nVersion: 3.7.4.post0\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/kabira/DrivingRange/asyncweb/py310async/lib/python3.10/site-packages/aiohttp-3.7.4.post0-py3.10-openbsd-7.0-arm64.egg\r\nRequires: async_timeout, attrs, chardet, multidict, typing_extensions, yarl\r\nRequired-by:\n```\n\n\n### multidict Version\n\n```console\nName: multidict\r\nVersion: 5.2.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/kabira/DrivingRange/asyncweb/py310async/lib/python3.10/site-packages\r\nRequires: \r\nRequired-by: aiohttp, yarl\n```\n\n\n### yarl Version\n\n```console\nName: yarl\r\nVersion: 1.7.0\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/kabira/DrivingRange/asyncweb/py310async/lib/python3.10/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\n```\n\n\n### OS\n\nOpenBSD\n\n### Related component\n\nServer\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6089/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6089/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6081", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6081/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6081/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6081/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/6081", "id": 1023244884, "node_id": "PR_kwDOAMpNN84tC4J6", "number": 6081, "title": "[PR #5927/84babebc backport][3.8] Add support for Python 3.10 (#5927)", "user": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 731921232, "node_id": "MDU6TGFiZWw3MzE5MjEyMzI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/infra", "name": "infra", "color": "e55e5b", "default": false, "description": null}, {"id": 1472801557, "node_id": "MDU6TGFiZWwxNDcyODAxNTU3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bot:chronographer:provided", "name": "bot:chronographer:provided", "color": "ededed", "default": false, "description": "There is a change note present in this PR"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/24", "html_url": "https://github.com/aio-libs/aiohttp/milestone/24", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/24/labels", "id": 7208553, "node_id": "MI_kwDOAMpNN84Abf5p", "number": 24, "title": "3.8", "description": "aiohttp 3.8 release", "creator": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "open_issues": 2, "closed_issues": 20, "state": "open", "created_at": "2021-10-01T06:45:28Z", "updated_at": "2021-11-14T12:37:54Z", "due_on": null, "closed_at": null}, "comments": 2, "created_at": "2021-10-12T00:48:05Z", "updated_at": "2021-10-16T15:26:57Z", "closed_at": "2021-10-16T12:10:35Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/6081", "html_url": "https://github.com/aio-libs/aiohttp/pull/6081", "diff_url": "https://github.com/aio-libs/aiohttp/pull/6081.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/6081.patch", "merged_at": "2021-10-16T12:10:35Z"}, "body": "**This is a backport of PR #5927 as merged into master (84babebc96e08f1ea2b7c31406eb5a1ed20cd5c4).**\r\n\r\nCo-authored-by: Sviatoslav Sydorenko <webknjaz@redhat.com>\r\n(cherry picked from commit 84babebc96e08f1ea2b7c31406eb5a1ed20cd5c4)\r\n\r\n<!-- Thank you for your contribution! -->\r\n## What do these changes do?\r\n\r\nAdd Python 3.10 matrix in Github Action and fix something.\r\n\r\n<!-- Please give a short brief about these changes. -->\r\n\r\n## Are there changes in behavior for the user?\r\n\r\n<!-- Outline any notable behaviour for the end users. -->\r\n\r\n## Related issue number\r\n\r\nRelated to https://github.com/aio-libs/aiohttp/issues/5905\r\n\r\n<!-- Are there any issues opened that will be resolved by merging this change? -->\r\n\r\n## Checklist\r\n\r\n- [ ] I think the code is well written\r\n- [ ] Unit tests for the changes exist\r\n- [ ] Documentation reflects the changes\r\n- [ ] If you provide code modification, please add yourself to `CONTRIBUTORS.txt`\r\n  * The format is &lt;Name&gt; &lt;Surname&gt;.\r\n  * Please keep alphabetical order, the file is sorted by names.\r\n- [ ] Add a new news fragment into the `CHANGES` folder\r\n  * name it `<issue_id>.<type>` for example (588.bugfix)\r\n  * if you don't have an `issue_id` change it to the pr id after creating the pr\r\n  * ensure type is one of the following:\r\n    * `.feature`: Signifying a new feature.\r\n    * `.bugfix`: Signifying a bug fix.\r\n    * `.doc`: Signifying a documentation improvement.\r\n    * `.removal`: Signifying a deprecation or removal of public API.\r\n    * `.misc`: A ticket has been closed, but it is not of interest to users.\r\n  * Make sure to use full sentences with correct case and punctuation, for example: \"Fix issue with non-ascii contents in doctest text files.\"", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6081/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6081/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6071", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6071/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6071/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6071/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6071", "id": 1022099300, "node_id": "I_kwDOAMpNN8486_9k", "number": 6071, "title": "Random ResourceWarning: unclosed transport <asyncio.sslproto._SSLProtocolTransport...", "user": {"login": "JulienPalard", "id": 239510, "node_id": "MDQ6VXNlcjIzOTUxMA==", "avatar_url": "https://avatars.githubusercontent.com/u/239510?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JulienPalard", "html_url": "https://github.com/JulienPalard", "followers_url": "https://api.github.com/users/JulienPalard/followers", "following_url": "https://api.github.com/users/JulienPalard/following{/other_user}", "gists_url": "https://api.github.com/users/JulienPalard/gists{/gist_id}", "starred_url": "https://api.github.com/users/JulienPalard/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JulienPalard/subscriptions", "organizations_url": "https://api.github.com/users/JulienPalard/orgs", "repos_url": "https://api.github.com/users/JulienPalard/repos", "events_url": "https://api.github.com/users/JulienPalard/events{/privacy}", "received_events_url": "https://api.github.com/users/JulienPalard/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 303800438, "node_id": "MDU6TGFiZWwzMDM4MDA0Mzg=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/need%20pull%20request", "name": "need pull request", "color": "bfdadc", "default": false, "description": null}, {"id": 344995986, "node_id": "MDU6TGFiZWwzNDQ5OTU5ODY=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/client", "name": "client", "color": "bfd4f2", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2021-10-10T21:42:38Z", "updated_at": "2022-01-24T12:37:52Z", "closed_at": "2022-01-09T15:05:13Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nSince I recently learned that https://github.com/aio-libs/aiohttp/issues/1925 is closed, I happily poked around and boom got a new `RecourceWarning`.\r\n\r\nSadly it does not happen every time, it really depends on the number of domains I have in my list, if I try to reduce the list, in the hope to find a culpit domain, the warning vanishes.\r\n\r\n\r\n\r\n### To Reproduce\r\n\r\nHere's a reproducer (I'm sorry for the APHP, I have nothing against them, I hope some 10s of requests is not noticable in their load average, I am not trying to hurt in any way... just happen I reproduced the bug using a dataset of their URLs).\r\n\r\n<details>\r\n<summary>reproducer</summary>\r\n\r\n```python\r\nimport aiohttp\r\nimport asyncio\r\n\r\nurls = [\r\n    \"aaa.aphp.fr\",\r\n    \"addictovigilance.aphp.fr\",\r\n    \"administration-goodmeeting.aphp.fr\",\r\n    \"affairesjuridiques.aphp.fr\",\r\n    \"ageps.aphp.fr\",\r\n    \"ambroisepare.aphp.fr\",\r\n    \"ami-dd.aphp.fr\",\r\n    \"anomaliescervelet.aphp.fr\",\r\n    \"antithrombotiques.aphp.fr\",\r\n    \"aphp.aphp.fr\",\r\n    \"aphp.fr\",\r\n    \"archives.aphp.fr\",\r\n    \"blogs.aphp.fr\",\r\n    \"bo-myaphp.aphp.fr\",\r\n    \"campus.aphp.fr\",\r\n    \"cancer-estparisien.aphp.fr\",\r\n    \"cancer-ghparis10.aphp.fr\",\r\n    \"cancer-grossesse.aphp.fr\",\r\n    \"cancer.aphp.fr\",\r\n    \"cedit.aphp.fr\",\r\n    \"cfdc.aphp.fr\",\r\n    \"charlesfoix.aphp.fr\",\r\n    \"chirurgie-digestive-sat.aphp.fr\",\r\n    \"chirurgie-refractive.aphp.fr\",\r\n    \"chu-mondor.aphp.fr\",\r\n    \"chu93.aphp.fr\",\r\n    \"cleanweb.aphp.fr\",\r\n    \"cme.aphp.fr\",\r\n    \"cnr-escherichiacoli-robertdebre.aphp.fr\",\r\n    \"compare.aphp.fr\",\r\n    \"corevih-idfcentre.aphp.fr\",\r\n    \"covid-documentation.aphp.fr\",\r\n    \"darsaintantoine.aphp.fr\",\r\n    \"dhu.aphp.fr\",\r\n    \"diabete-robertdebre.aphp.fr\",\r\n    \"direct.aphp.fr\",\r\n    \"disphelif.aphp.fr\",\r\n    \"eds.aphp.fr\",\r\n    \"electionscommissionsoins.aphp.fr\",\r\n    \"endocrino-sat.aphp.fr\",\r\n    \"epilepsie-robertdebre.aphp.fr\",\r\n    \"espace-emploi.aphp.fr\",\r\n    \"ethique-clinique.aphp.fr\",\r\n    \"evenementiels.aphp.fr\",\r\n    \"fcm.aphp.fr\",\r\n    \"fertilite-bichat.aphp.fr\",\r\n    \"formulairesrendezvous.aphp.fr\",\r\n    \"frequentationdesurgences.aphp.fr\",\r\n    \"ghparis10.aphp.fr\",\r\n]\r\n\r\n\r\nasync def hit(url, session):\r\n    try:\r\n        async with session.head(f\"https://{url}/\") as r:\r\n            print(url, r.status)\r\n    except Exception as err:\r\n        print(url, err)\r\n\r\n\r\nasync def main():\r\n    async with aiohttp.ClientSession(\r\n        connector=aiohttp.TCPConnector(limit=10, limit_per_host=1),\r\n    ) as session:\r\n        await asyncio.gather(*[hit(url, session=session) for url in urls])\r\n\r\n\r\nasyncio.run(main())\r\n```\r\n</details>\r\n\r\nIt does **not** reproduce the bug every time (sorry again for the servers in front).\r\n\r\n### Expected behavior\r\n\r\nNo ResourceWarning, as they could lead in fd leaks on long running client apps.\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\n/home/mdk/.local/lib/python3.9/asyncio/sslproto.py:320: ResourceWarning: unclosed transport <asyncio.sslproto._SSLProtocolTransport object at 0x7fa436ef44b0>\r\n  _warn(f\"unclosed transport {self!r}\", ResourceWarning, source=self)\r\nObject allocated at (most recent call last):\r\n  File \"/home/mdk/clones/noms-de-domaine-organismes-publics/sources/.venv/lib/python3.9/site-packages/aiohttp/client.py\", lineno 1077\r\n    self._resp = await self._coro\r\n  File \"/home/mdk/clones/noms-de-domaine-organismes-publics/sources/.venv/lib/python3.9/site-packages/aiohttp/client.py\", lineno 479\r\n    conn = await self._connector.connect(\r\n  File \"/home/mdk/clones/noms-de-domaine-organismes-publics/sources/.venv/lib/python3.9/site-packages/aiohttp/connector.py\", lineno 508\r\n    proto = await self._create_connection(req, traces, timeout)\r\n  File \"/home/mdk/clones/noms-de-domaine-organismes-publics/sources/.venv/lib/python3.9/site-packages/aiohttp/connector.py\", lineno 869\r\n    _, proto = await self._create_direct_connection(req, traces, timeout)\r\n  File \"/home/mdk/clones/noms-de-domaine-organismes-publics/sources/.venv/lib/python3.9/site-packages/aiohttp/connector.py\", lineno 1093\r\n    transp, proto = await self._wrap_create_connection(\r\n  File \"/home/mdk/clones/noms-de-domaine-organismes-publics/sources/.venv/lib/python3.9/site-packages/aiohttp/connector.py\", lineno 948\r\n    return await self._loop.create_connection(*args, **kwargs)  # type: ignore[return-value]  # noqa\r\n  File \"/home/mdk/.local/lib/python3.9/asyncio/base_events.py\", lineno 1081\r\n    transport, protocol = await self._create_connection_transport(\r\n  File \"/home/mdk/.local/lib/python3.9/asyncio/base_events.py\", lineno 1103\r\n    transport = self._make_ssl_transport(\r\n  File \"/home/mdk/.local/lib/python3.9/asyncio/selector_events.py\", lineno 74\r\n    ssl_protocol = sslproto.SSLProtocol(\r\n  File \"/home/mdk/.local/lib/python3.9/asyncio/sslproto.py\", lineno 445\r\n    self._app_transport = _SSLProtocolTransport(self._loop, self)\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n3.9.7\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n4.0.0a1 from pip install --pre, also tried on `master` branch, at 4ebd52ed1c29c7db52039f213cd2ab268c85bc74.\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\nName: multidict\r\nVersion: 4.7.6\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/mdk/clones/noms-de-domaine-organismes-publics/sources/.venv/lib/python3.9/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\nName: yarl\r\nVersion: 1.7.0\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/mdk/clones/noms-de-domaine-organismes-publics/sources/.venv/lib/python3.9/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\r\n### OS\r\n\r\nDebian Bookworm\r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\nNo proxy, very good connection to the internet, but laptop on Wi-Fi so like 60Mbps up 60Mbps down.\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6071/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6071/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6066", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6066/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6066/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6066/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6066", "id": 1020307091, "node_id": "I_kwDOAMpNN8480KaT", "number": 6066, "title": "testsuite fails on python-3.9.7 due to new deprecation warnings (worked on 3.9.6)", "user": {"login": "trofi", "id": 226650, "node_id": "MDQ6VXNlcjIyNjY1MA==", "avatar_url": "https://avatars.githubusercontent.com/u/226650?v=4", "gravatar_id": "", "url": "https://api.github.com/users/trofi", "html_url": "https://github.com/trofi", "followers_url": "https://api.github.com/users/trofi/followers", "following_url": "https://api.github.com/users/trofi/following{/other_user}", "gists_url": "https://api.github.com/users/trofi/gists{/gist_id}", "starred_url": "https://api.github.com/users/trofi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/trofi/subscriptions", "organizations_url": "https://api.github.com/users/trofi/orgs", "repos_url": "https://api.github.com/users/trofi/repos", "events_url": "https://api.github.com/users/trofi/events{/privacy}", "received_events_url": "https://api.github.com/users/trofi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-10-07T17:51:02Z", "updated_at": "2021-10-07T18:27:57Z", "closed_at": "2021-10-07T18:27:56Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nAfter updating to `python-3.9.7` from `python-3.9.6` `aiohttp` testsuite started failing as:\r\n\r\n```\r\n    async def sleep(delay, result=None, *, loop=None):\r\n        \"\"\"Coroutine that completes after a given time (in seconds).\"\"\"\r\n        if loop is not None:\r\n>           warnings.warn(\"The loop argument is deprecated since Python 3.8, \"\r\n                          \"and scheduled for removal in Python 3.10.\",\r\n                          DeprecationWarning, stacklevel=2)\r\nE           DeprecationWarning: The loop argument is deprecated since Python 3.8, and scheduled for removal in Python 3.10.\r\n\r\n/nix/store/56c5lnijckyrvczz03sgqs236x693fjf-python3-3.9.7/lib/python3.9/asyncio/tasks.py:639: DeprecationWarning\r\n```\r\n\n\n### To Reproduce\n\nUpdate to `python-3.9.7` and run the testsuite.\n\n### Expected behavior\n\nThe tests should pass.\n\n### Logs/tracebacks\n\n```python-traceback\nExample failure of the first failing test:\r\n\r\n\r\n_______________________ ERROR at setup of test_get_route _______________________\r\n\r\nloop = <_UnixSelectorEventLoop running=False closed=False debug=False>\r\napp = <Application 0x7ffff3ac2670>\r\n\r\n    @pytest.fixture\r\n    def test_client(loop, app) -> None:\r\n        async def make_client():\r\n            return _TestClient(_TestServer(app, loop=loop), loop=loop)\r\n\r\n        client = loop.run_until_complete(make_client())\r\n\r\n>       loop.run_until_complete(client.start_server())\r\n\r\ntest_test_utils.py:73:\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\n/nix/store/56c5lnijckyrvczz03sgqs236x693fjf-python3-3.9.7/lib/python3.9/asyncio/base_events.py:642: in run_until_complete\r\n    return future.result()\r\n/nix/store/zrkj2d2mis6vmg360x6zdxl2pmghiili-python3.9-aiohttp-3.7.4.post0/lib/python3.9/site-packages/aiohttp/test_utils.py:268: in start_server\r\n    await self._server.start_server(loop=self._loop)\r\n/nix/store/zrkj2d2mis6vmg360x6zdxl2pmghiili-python3.9-aiohttp-3.7.4.post0/lib/python3.9/site-packages/aiohttp/test_utils.py:113: in start_server\r\n    await site.start()\r\n/nix/store/zrkj2d2mis6vmg360x6zdxl2pmghiili-python3.9-aiohttp-3.7.4.post0/lib/python3.9/site-packages/aiohttp/web_runner.py:230: in start\r\n    self._server = await loop.create_server(\r\n/nix/store/56c5lnijckyrvczz03sgqs236x693fjf-python3-3.9.7/lib/python3.9/asyncio/base_events.py:1518: in create_server\r\n    await tasks.sleep(0, loop=self)\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\n\r\ndelay = 0, result = None\r\n\r\n    async def sleep(delay, result=None, *, loop=None):\r\n        \"\"\"Coroutine that completes after a given time (in seconds).\"\"\"\r\n        if loop is not None:\r\n>           warnings.warn(\"The loop argument is deprecated since Python 3.8, \"\r\n                          \"and scheduled for removal in Python 3.10.\",\r\n                          DeprecationWarning, stacklevel=2)\r\nE           DeprecationWarning: The loop argument is deprecated since Python 3.8, and scheduled for removal in Python 3.10.\r\n\r\n/nix/store/56c5lnijckyrvczz03sgqs236x693fjf-python3-3.9.7/lib/python3.9/asyncio/tasks.py:639: DeprecationWarning\r\n```\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\nPython 3.9.7\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\nWARNING: Package(s) not found: aiohttp\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.1.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /nix/store/fdvkz2jvqc8ra426yp3m74ynq71g13vz-python3.9-multidict-5.1.0/lib/python3.9/site-packages\r\nRequires:\r\nRequired-by: yarl\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.3\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /nix/store/x5xcb256wikwbh2p443ximbbdn9l7h2h-python3.9-yarl-1.6.3/lib/python3.9/site-packages\r\nRequires: idna, multidict\r\nRequired-by:\n```\n\n\n### OS\n\nNixos x86_64-linux.\r\n\r\nFull build/test log: [python3.9-aiohttp-3.7.4.log.txt](https://github.com/aio-libs/aiohttp/files/7305933/python3.9-aiohttp-3.7.4.log.txt)\r\n\n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6066/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6066/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6020", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6020/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6020/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6020/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6020", "id": 1009114389, "node_id": "I_kwDOAMpNN848Jd0V", "number": 6020, "title": "file_sender", "user": {"login": "SafaSafari", "id": 29104726, "node_id": "MDQ6VXNlcjI5MTA0NzI2", "avatar_url": "https://avatars.githubusercontent.com/u/29104726?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SafaSafari", "html_url": "https://github.com/SafaSafari", "followers_url": "https://api.github.com/users/SafaSafari/followers", "following_url": "https://api.github.com/users/SafaSafari/following{/other_user}", "gists_url": "https://api.github.com/users/SafaSafari/gists{/gist_id}", "starred_url": "https://api.github.com/users/SafaSafari/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SafaSafari/subscriptions", "organizations_url": "https://api.github.com/users/SafaSafari/orgs", "repos_url": "https://api.github.com/users/SafaSafari/repos", "events_url": "https://api.github.com/users/SafaSafari/events{/privacy}", "received_events_url": "https://api.github.com/users/SafaSafari/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-09-28T03:28:19Z", "updated_at": "2021-09-28T18:13:29Z", "closed_at": "2021-09-28T18:13:29Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nhi\r\ni need to upload file with a specified key also need to tqdm :)))\r\nnot working and return <async_generator object file_sender at 0x7f7e6fbee550> as that key on server\n\n### To Reproduce\n\n```python\r\nasync with session.post(URL, data={\"KEY\": file_sender(file)}) as req:\r\n...\r\nasync def file_sender(file_name):\r\n    async with aiofiles.open(file_name, 'rb') as f:\r\n        with tqdm(total=os.path.getsize(file_name), unit='B', unit_scale=True, desc=file_name) as i:\r\n            chunk = await f.read(64*1024)\r\n            while chunk:\r\n                yield chunk\r\n                i.update(64*1024)\r\n                chunk = await f.read(64*1024)\r\n\r\n```\r\n\n\n### Expected behavior\n\nupload file with its key successfully\n\n### Logs/tracebacks\n\n```python-traceback\n.\n```\n\n\n### Python Version\n\n```console\nPython 3.8.10\n```\n\n\n### aiohttp Version\n\n```console\nVersion: 3.7.4.post0\n```\n\n\n### multidict Version\n\n```console\nVersion: 5.1.0\n```\n\n\n### yarl Version\n\n```console\nVersion: 1.6.3\n```\n\n\n### OS\n\nUbuntu\n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [x] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6020/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6020/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6018", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6018/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6018/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6018/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6018", "id": 1007025328, "node_id": "I_kwDOAMpNN848Bfyw", "number": 6018, "title": "AttributeError: module 'tempfile' has no attribute '_TemporaryFileWrapper'", "user": {"login": "Sengolda", "id": 79252176, "node_id": "MDQ6VXNlcjc5MjUyMTc2", "avatar_url": "https://avatars.githubusercontent.com/u/79252176?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Sengolda", "html_url": "https://github.com/Sengolda", "followers_url": "https://api.github.com/users/Sengolda/followers", "following_url": "https://api.github.com/users/Sengolda/following{/other_user}", "gists_url": "https://api.github.com/users/Sengolda/gists{/gist_id}", "starred_url": "https://api.github.com/users/Sengolda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Sengolda/subscriptions", "organizations_url": "https://api.github.com/users/Sengolda/orgs", "repos_url": "https://api.github.com/users/Sengolda/repos", "events_url": "https://api.github.com/users/Sengolda/events{/privacy}", "received_events_url": "https://api.github.com/users/Sengolda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-09-25T08:46:28Z", "updated_at": "2021-09-25T08:50:51Z", "closed_at": "2021-09-25T08:50:51Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Describe the bug\n\nOk so i only had this line of code `import aiohttp`\r\n\r\nBut i get this error\r\n```\r\nTraceback (most recent call last):\r\n  File \"/Users/senushka/Documents/learning/test.py\", line 1, in <module>\r\n    import aiohttp\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/site-packages/aiohttp/__init__.py\", line 6, in <module>\r\n    from .client import (\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/site-packages/aiohttp/client.py\", line 35, in <module>\r\n    from . import hdrs, http, payload\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/site-packages/aiohttp/http.py\", line 7, in <module>\r\n    from .http_parser import (\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/site-packages/aiohttp/http_parser.py\", line 15, in <module>\r\n    from .helpers import NO_EXTENSIONS, BaseTimerContext\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/site-packages/aiohttp/helpers.py\", line 43, in <module>\r\n    from urllib.request import getproxies\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/urllib/request.py\", line 102, in <module>\r\n    from urllib.error import URLError, HTTPError, ContentTooShortError\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/urllib/error.py\", line 14, in <module>\r\n    import urllib.response\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/urllib/response.py\", line 14, in <module>\r\n    class addbase(tempfile._TemporaryFileWrapper):\r\nAttributeError: module 'tempfile' has no attribute '_TemporaryFileWrapper'\r\n```\n\n### To Reproduce\n\n```py\r\nimport aiohttp\r\n# I'm assuming this isn't a problem with the lib as it worked in my shell when I just typed `python3` then ran `import aiohttp`\r\n```\n\n### Expected behavior\n\nI would have just expected the module to import.\n\n### Logs/tracebacks\n\n```python-traceback\nTraceback:\r\n\r\n\r\nTraceback (most recent call last):\r\n  File \"/Users/senushka/Documents/learning/test.py\", line 1, in <module>\r\n    import aiohttp\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/site-packages/aiohttp/__init__.py\", line 6, in <module>\r\n    from .client import (\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/site-packages/aiohttp/client.py\", line 35, in <module>\r\n    from . import hdrs, http, payload\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/site-packages/aiohttp/http.py\", line 7, in <module>\r\n    from .http_parser import (\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/site-packages/aiohttp/http_parser.py\", line 15, in <module>\r\n    from .helpers import NO_EXTENSIONS, BaseTimerContext\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/site-packages/aiohttp/helpers.py\", line 43, in <module>\r\n    from urllib.request import getproxies\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/urllib/request.py\", line 102, in <module>\r\n    from urllib.error import URLError, HTTPError, ContentTooShortError\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/urllib/error.py\", line 14, in <module>\r\n    import urllib.response\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/urllib/response.py\", line 14, in <module>\r\n    class addbase(tempfile._TemporaryFileWrapper):\r\nAttributeError: module 'tempfile' has no attribute '_TemporaryFileWrapper'\r\n```\n```\n\n\n### Python Version\n\n```console\n3.9.4\n```\n\n\n### aiohttp Version\n\n```console\n3.7.4.post0\n```\n\n\n### multidict Version\n\n```console\n4.7.6\n```\n\n\n### yarl Version\n\n```console\n1.5.1\n```\n\n\n### OS\n\nMacOS\n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6018/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6018/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6017", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6017/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6017/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6017/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6017", "id": 1002632529, "node_id": "I_kwDOAMpNN847wvVR", "number": 6017, "title": "URL raises InvalidURL even though the URL is valid", "user": {"login": "Lagicrus", "id": 24227350, "node_id": "MDQ6VXNlcjI0MjI3MzUw", "avatar_url": "https://avatars.githubusercontent.com/u/24227350?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Lagicrus", "html_url": "https://github.com/Lagicrus", "followers_url": "https://api.github.com/users/Lagicrus/followers", "following_url": "https://api.github.com/users/Lagicrus/following{/other_user}", "gists_url": "https://api.github.com/users/Lagicrus/gists{/gist_id}", "starred_url": "https://api.github.com/users/Lagicrus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Lagicrus/subscriptions", "organizations_url": "https://api.github.com/users/Lagicrus/orgs", "repos_url": "https://api.github.com/users/Lagicrus/repos", "events_url": "https://api.github.com/users/Lagicrus/events{/privacy}", "received_events_url": "https://api.github.com/users/Lagicrus/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-09-21T14:45:40Z", "updated_at": "2021-09-21T16:56:39Z", "closed_at": "2021-09-21T16:56:39Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nURL is marked as invalid, even though the validators package and browsing to it, work.\r\n\r\n\r\n\r\n### To Reproduce\r\n\r\n1. Use AIOHTTP to create a ClientSession\r\n2. Do a session.get on `https://2w8ov.2h4zh2chks.com/t/8f0d93c8664e/d6a8636e-1ae2-11ec-8a5c-55cdaa16b17d?fallback=1`\r\n3. Watch it fail\r\n\r\n### Expected behavior\r\n\r\nTo be able to fetch the specified URL\r\n\r\n### Logs/tracebacks\r\n\r\n<details><summary>Traceback</summary>\r\n\r\n```python-traceback\r\nTraceback (most recent call last):\r\n   File \"/app/spoopy/websocket.py\", line 49, in ws_spoopy\r\n     = await get_check_website(url, request.app.session, request.app.db, request.app.fish)\r\n   File \"/app/api/tool_check_website_wrapper.py\", line 15, in get_check_website\r\n     async with session.get(url, allow_redirects=False, headers={\"User-Agent\": get_random_user_agent()}) as resp:\r\n   File \"/usr/local/lib/python3.8/site-packages/aiohttp/client.py\", line 1117, in __aenter__\r\n     self._resp = await self._coro\r\n   File \"/usr/local/lib/python3.8/site-packages/aiohttp/client.py\", line 492, in _request\r\n     req = self._request_class(\r\n   File \"/usr/local/lib/python3.8/site-packages/aiohttp/client_reqrep.py\", line 305, in __init__\r\n     self.update_host(url)\r\n   File \"/usr/local/lib/python3.8/site-packages/aiohttp/client_reqrep.py\", line 366, in update_host\r\n     raise InvalidURL(URL)\r\n```\r\n\r\n</details>\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n$ python --version\r\nPython 3.8.11\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.4.post0\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/local/lib/python3.8/site-packages\r\nRequires: yarl, multidict, async-timeout, chardet, typing-extensions, attrs\r\nRequired-by:\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.1.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/local/lib/python3.8/site-packages\r\nRequires:\r\nRequired-by: yarl, sanic, aiohttp\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n$ python -m pip show yarl (this also broke on 1.6.3)\r\nName: yarl\r\nVersion: 1.6.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/local/lib/python3.8/site-packages\r\nRequires: multidict, idna\r\nRequired-by: aiohttp\r\n```\r\n\r\n\r\n### OS\r\n\r\nDocker Compose container\r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\nI have also tried doing the same as the internal yarl check, but this seems to succeed which is where I am confused.\r\n\r\n```python\r\nPython 3.8.11 (default, Aug 17 2021, 15:56:41)\r\n[GCC 10.2.1 20210110] on linux\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import yarl\r\n>>> yarl.URL(\"https://2w8ov.2h4zh2chks.com/t/8f0d93c8664e/d6a8636e-1ae2-11ec-8a5c-55cdaa16b17d?fallback=1\").raw_host\r\n'2w8ov.2h4zh2chks.com'\r\n```\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6017/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6017/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6016", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6016/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6016/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6016/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6016", "id": 1002117951, "node_id": "I_kwDOAMpNN847uxs_", "number": 6016, "title": "aiohttp.request fails on download with status code 404, but synchronous download succeed", "user": {"login": "meteoDaniel", "id": 27021858, "node_id": "MDQ6VXNlcjI3MDIxODU4", "avatar_url": "https://avatars.githubusercontent.com/u/27021858?v=4", "gravatar_id": "", "url": "https://api.github.com/users/meteoDaniel", "html_url": "https://github.com/meteoDaniel", "followers_url": "https://api.github.com/users/meteoDaniel/followers", "following_url": "https://api.github.com/users/meteoDaniel/following{/other_user}", "gists_url": "https://api.github.com/users/meteoDaniel/gists{/gist_id}", "starred_url": "https://api.github.com/users/meteoDaniel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/meteoDaniel/subscriptions", "organizations_url": "https://api.github.com/users/meteoDaniel/orgs", "repos_url": "https://api.github.com/users/meteoDaniel/repos", "events_url": "https://api.github.com/users/meteoDaniel/events{/privacy}", "received_events_url": "https://api.github.com/users/meteoDaniel/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-09-21T09:34:56Z", "updated_at": "2021-09-21T13:49:09Z", "closed_at": "2021-09-21T13:49:09Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nI am having a strange problem with an API request. \r\nThe problem is that using `requests` or browser, the url I am using works fine. But using an asynchronous servicer the URL fails and returns a status code 404.\n\n### To Reproduce\n\nHere is my code:\r\nI have build an asynch downloader function `get`:\r\n\r\n```python\r\n\"\"\" download functions for asynchronous download \"\"\"\r\nimport asyncio\r\nfrom pathlib import Path\r\nfrom typing import Union, Dict, Any\r\n\r\nimport aiohttp\r\n\r\nHTTP_DEFAULT_TIME_OUT = 60 * 10\r\n\r\n\r\nasync def _get(\r\n    url: Union[Path, str],\r\n    timeout: aiohttp.ClientTimeout = aiohttp.ClientTimeout(),\r\n    **kwargs: Union[aiohttp.BasicAuth, Dict[str, Any]]\r\n) -> bytes:\r\n    \"\"\"\r\n    Base function downloader with aiohttp and async session\r\n\r\n    Args:\r\n        url: remote path to file\r\n        timeout: how long should it max take to download the file\r\n        **kwargs: parameters to pass to the aiohttp get function:\r\n            auth: aiohttp.BasicAuth(\"\", \"\")\r\n            params: Dict[str, Any]\r\n            headers: Dict[str, Any]\r\n\r\n    Returns:\r\n        a bytes object\r\n    \"\"\"\r\n    kwargs[\"timeout\"] = timeout\r\n    async with aiohttp.request(\"GET\", url, **kwargs) as response:\r\n        return await response.read()\r\n\r\n\r\ndef get(\r\n    url: Union[Path, str],\r\n    timeout: int = HTTP_DEFAULT_TIME_OUT,\r\n    **kwargs: Union[aiohttp.BasicAuth, Dict[str, Any]]\r\n) -> bytes:\r\n    \"\"\"\r\n    download function handling async download with aiohttp\r\n\r\n    Args:\r\n        url: remote path to file\r\n        timeout: how long should it max take to download the file\r\n        **kwargs: parameters to pass to the aiohttp get function:\r\n            auth: aiohttp.BasicAuth(\"\", \"\")\r\n            params: Dict[str, Any]\r\n            headers: Dict[str, Any]\r\n\r\n    \"\"\"\r\n    return asyncio.get_event_loop().run_until_complete(\r\n        _get(url, aiohttp.ClientTimeout(timeout), **kwargs)\r\n    )\r\n```\r\n\r\n```python\r\nremote_file='https://api.eumetsat.int/data/download/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20210916121242.731000000Z-NA?access_token=43e1b232-02ed-30db-9d17-363f00a4a1f0'\r\n\r\n```\r\nNote: token will expire. Let me know If you need a new one.\r\n\r\nUsing `requests` works fine. But using my own `get` function yields to:\r\n\r\n```\r\nget(remote_file)\r\nb'<am:fault xmlns:am=\"http://wso2.org/apimanager\"><am:code>404</am:code><am:type>Status report</am:type><am:message>Runtime Error</am:message><am:description>No matching resource found for given API Request</am:description></am:fault>'\r\n``` \r\nDownloading other stuff with my `get` function works fine, too. \r\n\r\nSo does anyone know why the server returns a 404 when trying to access asynchronously ?\r\n\n\n### Expected behavior\n\naiohttp should download the data from the remote REST Api. But receives a 404. \n\n### Logs/tracebacks\n\n```python-traceback\nb'<am:fault xmlns:am=\"http://wso2.org/apimanager\"><am:code>404</am:code><am:type>Status report</am:type><am:message>Runtime Error</am:message><am:description>No matching resource found for given API Request</am:description></am:fault>'\n```\n\n\n### Python Version\n\n```console\npython==3.9.7\n```\n\n\n### aiohttp Version\n\n```console\naiohttp==3.7.4\n```\n\n\n### multidict Version\n\n```console\n5.1.0\n```\n\n\n### yarl Version\n\n```console\n1.6.3\n```\n\n\n### OS\n\nDocker env: osgeo/gdal:ubuntu-small-latest\n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6016/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6016/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6015", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6015/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6015/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6015/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/6015", "id": 1000439878, "node_id": "I_kwDOAMpNN847oYBG", "number": 6015, "title": "Adding middleware to server is changing the downstream request type", "user": {"login": "kabua", "id": 8376646, "node_id": "MDQ6VXNlcjgzNzY2NDY=", "avatar_url": "https://avatars.githubusercontent.com/u/8376646?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kabua", "html_url": "https://github.com/kabua", "followers_url": "https://api.github.com/users/kabua/followers", "following_url": "https://api.github.com/users/kabua/following{/other_user}", "gists_url": "https://api.github.com/users/kabua/gists{/gist_id}", "starred_url": "https://api.github.com/users/kabua/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kabua/subscriptions", "organizations_url": "https://api.github.com/users/kabua/orgs", "repos_url": "https://api.github.com/users/kabua/repos", "events_url": "https://api.github.com/users/kabua/events{/privacy}", "received_events_url": "https://api.github.com/users/kabua/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-09-19T22:46:09Z", "updated_at": "2021-09-19T23:28:20Z", "closed_at": "2021-09-19T23:28:20Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nWithout adding middleware, the request param to my handler is of type `<class 'aiohttp.web_request.Request'>`, which has a `query` attribute. However, if I add a middleware handler (derived from the [docs](https://docs.aiohttp.org/en/latest/web_advanced.html#aiohttp-web-middlewares)) the request param is now of type `<class 'aiohttp.web_app.Application'>`, which does not have a `query` attribute and thus my code is throwing an error.\r\n\r\n### To Reproduce\r\n\r\nHere's a simple example of the issue:\r\n```\r\nimport json\r\n\r\nfrom aiohttp import web\r\nfrom aiohttp.web_request import Request\r\n\r\nroutes = web.RouteTableDef()\r\n\r\n\r\nasync def exception_middleware(request, handler):\r\n    try:\r\n        print(type(request))\r\n        response = await handler(request)\r\n    except Exception as e:\r\n        response = web.json_response(e, status=400)\r\n    return response\r\n\r\n@routes.post('/user')\r\nasync def new_user(request: Request) -> web.Response:\r\n        print(type(request))\r\n        user = request.query['name']\r\n        print(\"Creating new user with name: \", user)\r\n\r\n        response_obj = {'status': 'success'}\r\n        return web.json_response(response_obj)\r\n\r\napp = web.Application(middlewares=[exception_middleware])\r\n#app = web.Application()\r\napp.add_routes(routes)\r\nweb.run_app(app)\r\n```\r\n\r\nRequest:\r\n```\r\nPost http://localhost:8080/user?name=Testing\r\n```\r\n\r\nActual output:\r\n```\r\n<class 'aiohttp.web_app.Application'>\r\n<class 'aiohttp.web_app.Application'>\r\nError handling request\r\nTraceback (most recent call last):\r\n  File \"C:\\scratch.py\", line 12, in exception_middleware\r\n    response = await handler(request)\r\n  File \"C:\\scratch.py\", line 20, in new_user\r\n    user = request.query['name']\r\nAttributeError: 'Application' object has no attribute 'query'\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"C:\\ProgramData\\Anaconda3\\envs\\DLAcquire\\lib\\site-packages\\aiohttp\\web_protocol.py\", line 422, in _handle_request\r\n    resp = await self._request_handler(request)\r\n  File \"C:\\ProgramData\\Anaconda3\\envs\\DLAcquire\\lib\\site-packages\\aiohttp\\web_app.py\", line 497, in _handle\r\n    handler = await m(app, handler)  # type: ignore\r\n  File \"C:\\Users\\tristen\\AppData\\Roaming\\JetBrains\\PyCharmCE2021.2\\scratches\\scratch.py\", line 14, in exception_middleware\r\n    response = web.json_response(e, status=400)\r\n  File \"C:\\ProgramData\\Anaconda3\\envs\\DLAcquire\\lib\\site-packages\\aiohttp\\web_response.py\", line 773, in json_response\r\n    text = dumps(data)\r\n  File \"C:\\ProgramData\\Anaconda3\\envs\\DLAcquire\\lib\\json\\__init__.py\", line 231, in dumps\r\n    return _default_encoder.encode(obj)\r\n  File \"C:\\ProgramData\\Anaconda3\\envs\\DLAcquire\\lib\\json\\encoder.py\", line 199, in encode\r\n    chunks = self.iterencode(o, _one_shot=True)\r\n  File \"C:\\ProgramData\\Anaconda3\\envs\\DLAcquire\\lib\\json\\encoder.py\", line 257, in iterencode\r\n    return _iterencode(o, 0)\r\n  File \"C:\\ProgramData\\Anaconda3\\envs\\DLAcquire\\lib\\json\\encoder.py\", line 179, in default\r\n    raise TypeError(f'Object of type {o.__class__.__name__} '\r\nTypeError: Object of type AttributeError is not JSON serializable\r\n```\r\n\r\n### Expected behavior\r\n\r\nHere's what I was expecting:\r\n```import json\r\n\r\nfrom aiohttp import web\r\nfrom aiohttp.web_request import Request\r\n\r\nroutes = web.RouteTableDef()\r\n\r\n\r\nasync def exception_middleware(request, handler):\r\n    try:\r\n        print(type(request))\r\n        response = await handler(request)\r\n    except Exception as e:\r\n        response = web.json_response(e, status=400)\r\n    return response\r\n\r\n@routes.post('/user')\r\nasync def new_user(request: Request) -> web.Response:\r\n        print(type(request))\r\n        user = request.query['name']\r\n        print(\"Creating new user with name: \", user)\r\n\r\n        response_obj = {'status': 'success'}\r\n        return web.json_response(response_obj)\r\n\r\n#app = web.Application(middlewares=[exception_middleware])\r\napp = web.Application()\r\napp.add_routes(routes)\r\nweb.run_app(app)\r\n```\r\n\r\nRequest:\r\n```\r\nPost http://localhost:8080/user?name=Testing\r\n```\r\n\r\nExpected output:\r\n```\r\n<class 'aiohttp.web_request.Request'>\r\nCreating new user with name:  Testing\r\n```\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\n<class 'aiohttp.web_app.Application'>\r\n<class 'aiohttp.web_app.Application'>\r\nError handling request\r\nTraceback (most recent call last):\r\n  File \"C:\\scratch.py\", line 12, in exception_middleware\r\n    response = await handler(request)\r\n  File \"C:\\scratch.py\", line 20, in new_user\r\n    user = request.query['name']\r\nAttributeError: 'Application' object has no attribute 'query'\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"C:\\ProgramData\\Anaconda3\\envs\\DLAcquire\\lib\\site-packages\\aiohttp\\web_protocol.py\", line 422, in _handle_request\r\n    resp = await self._request_handler(request)\r\n  File \"C:\\ProgramData\\Anaconda3\\envs\\DLAcquire\\lib\\site-packages\\aiohttp\\web_app.py\", line 497, in _handle\r\n    handler = await m(app, handler)  # type: ignore\r\n  File \"C:\\Users\\tristen\\AppData\\Roaming\\JetBrains\\PyCharmCE2021.2\\scratches\\scratch.py\", line 14, in exception_middleware\r\n    response = web.json_response(e, status=400)\r\n  File \"C:\\ProgramData\\Anaconda3\\envs\\DLAcquire\\lib\\site-packages\\aiohttp\\web_response.py\", line 773, in json_response\r\n    text = dumps(data)\r\n  File \"C:\\ProgramData\\Anaconda3\\envs\\DLAcquire\\lib\\json\\__init__.py\", line 231, in dumps\r\n    return _default_encoder.encode(obj)\r\n  File \"C:\\ProgramData\\Anaconda3\\envs\\DLAcquire\\lib\\json\\encoder.py\", line 199, in encode\r\n    chunks = self.iterencode(o, _one_shot=True)\r\n  File \"C:\\ProgramData\\Anaconda3\\envs\\DLAcquire\\lib\\json\\encoder.py\", line 257, in iterencode\r\n    return _iterencode(o, 0)\r\n  File \"C:\\ProgramData\\Anaconda3\\envs\\DLAcquire\\lib\\json\\encoder.py\", line 179, in default\r\n    raise TypeError(f'Object of type {o.__class__.__name__} '\r\nTypeError: Object of type AttributeError is not JSON serializable\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n$ python --version\r\nPython 3.9.6\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.4.post0\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\programdata\\anaconda3\\envs\\dlacquire\\lib\\site-packages\r\nRequires: async-timeout, multidict, chardet, attrs, typing-extensions, yarl\r\nRequired-by:\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.1.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\programdata\\anaconda3\\envs\\dlacquire\\lib\\site-packages\r\nRequires:\r\nRequired-by: yarl, aiohttp\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.3\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\programdata\\anaconda3\\envs\\dlacquire\\lib\\site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\r\n### OS\r\n\r\nWindows 10 Pro \r\nVersion\t10.0.19042 Build 19042\r\n\r\n\r\n### Related component\r\n\r\nServer\r\n\r\n### Additional context\r\n\r\nIs a simple scratch file, written and running in PyCharm.\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6015/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/6015/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5996", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5996/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5996/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5996/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5996", "id": 994116710, "node_id": "MDU6SXNzdWU5OTQxMTY3MTA=", "number": 5996, "title": "TypeError: gather() got an unexpected keyword argument 'loop' (Python 3.10+)", "user": {"login": "eXhumer", "id": 62310242, "node_id": "MDQ6VXNlcjYyMzEwMjQy", "avatar_url": "https://avatars.githubusercontent.com/u/62310242?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eXhumer", "html_url": "https://github.com/eXhumer", "followers_url": "https://api.github.com/users/eXhumer/followers", "following_url": "https://api.github.com/users/eXhumer/following{/other_user}", "gists_url": "https://api.github.com/users/eXhumer/gists{/gist_id}", "starred_url": "https://api.github.com/users/eXhumer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eXhumer/subscriptions", "organizations_url": "https://api.github.com/users/eXhumer/orgs", "repos_url": "https://api.github.com/users/eXhumer/repos", "events_url": "https://api.github.com/users/eXhumer/events{/privacy}", "received_events_url": "https://api.github.com/users/eXhumer/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2021-09-12T10:04:09Z", "updated_at": "2021-09-12T19:52:18Z", "closed_at": "2021-09-12T11:55:31Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\n[asyncio.gather's](https://docs.python.org/3/library/asyncio-task.html#asyncio.gather) `loop` keyword argument has been deprecated since 3.8+ and is scheduled to remove from 3.10+ (3.10 due to release in less than a month, final release candidate already published). Using Ctrl + C to quit server provides the error traceback which indicates a problem with `_cancel_tasks` method in web module of the aiohttp package.\n\n### To Reproduce\n\n1. Start a new server with the following code snippet.\r\n```python\r\nfrom aiohttp.web import (\r\n    Application,\r\n    get as get_route,\r\n    Response,\r\n    Request,\r\n    run_app,\r\n)\r\n\r\n\r\nasync def hello(request: Request) -> Response:\r\n    name = request.match_info.get('name', \"Anonymous\")\r\n    return Response(text=f\"Hello, {name}\")\r\n\r\n\r\nif __name__ == '__main__':\r\n    app = Application()\r\n    app.add_routes([\r\n        get_route(\"/{name}\", hello),\r\n    ])\r\n    run_app(app)\r\n\r\n```\r\n2. Use `Ctrl + C` to shut down server.\n\n### Expected behavior\n\nFor running server to exit cleanly.\n\n### Logs/tracebacks\n\n```python-traceback\nTraceback (most recent call last):  File \"C:\\Users\\eXhumer\\Projects\\AIOHTTPServer\\server.py\", line 15, in <module>\r\n    run_app(app)  File \"C:\\Users\\eXhumer\\Projects\\AIOHTTPServer-env\\lib\\site-packages\\aiohttp\\web.py\", line 512, in run_app\r\n    _cancel_tasks({main_task}, loop)  File \"C:\\Users\\eXhumer\\Projects\\AIOHTTPServer-env\\lib\\site-packages\\aiohttp\\web.py\", line 444, in _cancel_tasks\r\n    asyncio.gather(*to_cancel, loop=loop, return_exceptions=True)\r\nTypeError: gather() got an unexpected keyword argument 'loop'\n```\n\n\n### Python Version\n\n```console\nPython 3.10.0rc2\n```\n\n\n### aiohttp Version\n\n```console\nName: aiohttp\r\nVersion: 3.7.4.post0\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\users\\exhumer\\projects\\aiohttpserver-env\\lib\\site-packages\r\nRequires: chardet, yarl, typing-extensions, async-timeout, attrs, multidict\r\nRequired-by:\n```\n\n\n### multidict Version\n\n```console\nName: multidict\r\nVersion: 5.1.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\users\\exhumer\\projects\\aiohttpserver-env\\lib\\site-packages\r\nRequires:\r\nRequired-by: yarl, aiohttp\n```\n\n\n### yarl Version\n\n```console\nName: yarl\r\nVersion: 1.6.3\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\users\\exhumer\\projects\\aiohttpserver-env\\lib\\site-packages\r\nRequires: multidict, idna\r\nRequired-by: aiohttp\n```\n\n\n### OS\n\nWindows 11 Pro (Build 22454.rs_prerelease.210903-1516)\n\n### Related component\n\nServer\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5996/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5996/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5995", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5995/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5995/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5995/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5995", "id": 994101286, "node_id": "MDU6SXNzdWU5OTQxMDEyODY=", "number": 5995, "title": "The specified network name is no longer available when I spam requests to my aiohttp.web app", "user": {"login": "Nebulizer1213", "id": 79063894, "node_id": "MDQ6VXNlcjc5MDYzODk0", "avatar_url": "https://avatars.githubusercontent.com/u/79063894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nebulizer1213", "html_url": "https://github.com/Nebulizer1213", "followers_url": "https://api.github.com/users/Nebulizer1213/followers", "following_url": "https://api.github.com/users/Nebulizer1213/following{/other_user}", "gists_url": "https://api.github.com/users/Nebulizer1213/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nebulizer1213/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nebulizer1213/subscriptions", "organizations_url": "https://api.github.com/users/Nebulizer1213/orgs", "repos_url": "https://api.github.com/users/Nebulizer1213/repos", "events_url": "https://api.github.com/users/Nebulizer1213/events{/privacy}", "received_events_url": "https://api.github.com/users/Nebulizer1213/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-09-12T08:44:22Z", "updated_at": "2021-10-29T21:47:48Z", "closed_at": "2021-10-29T21:47:48Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nWhen I dos my app I get this error\r\nhttps://pastecord.com/ufenyhebog.txt\r\nThe error only seems to happen when I use the ratelimiter I made and I'm not sure why.\n\n### To Reproduce\n\nfrom aiohttp.web import Application, run_app, Response, Request, RouteTableDef\r\nfrom aiohttplimiter import Limiter, default_keyfunc\r\n\r\nroutes = RouteTableDef()\r\nlimiter = Limiter(keyfunc=default_keyfunc)\r\n\r\n@routes.get(\"/\")\r\n@limiter.limit(\"5/1\")\r\nasync def home(request: Request):\r\n    return Response(text=\"test\")\n\n### Expected behavior\n\nget this error https://pastecord.com/ufenyhebog.txt\n\n### Logs/tracebacks\n\n```python-traceback\nhttps://pastecord.com/ufenyhebog.txt\n```\n\n\n### Python Version\n\n```console\n3.9.6\n```\n\n\n### aiohttp Version\n\n```console\n3.7.4.post0\n```\n\n\n### multidict Version\n\n```console\n5.1.0\n```\n\n\n### yarl Version\n\n```console\n1.6.3\n```\n\n\n### OS\n\nWindows 10\n\n### Related component\n\nServer\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5995/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5995/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5991", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5991/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5991/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5991/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5991", "id": 991243947, "node_id": "MDU6SXNzdWU5OTEyNDM5NDc=", "number": 5991, "title": "Incorrect numbers of warnings makes some tests to fail (test_new_style_middleware_method[pyloop], test_old_style_middleware_class[pyloop], and test_mixed_middleware[pyloop])", "user": {"login": "mcepl", "id": 198999, "node_id": "MDQ6VXNlcjE5ODk5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/198999?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mcepl", "html_url": "https://github.com/mcepl", "followers_url": "https://api.github.com/users/mcepl/followers", "following_url": "https://api.github.com/users/mcepl/following{/other_user}", "gists_url": "https://api.github.com/users/mcepl/gists{/gist_id}", "starred_url": "https://api.github.com/users/mcepl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mcepl/subscriptions", "organizations_url": "https://api.github.com/users/mcepl/orgs", "repos_url": "https://api.github.com/users/mcepl/repos", "events_url": "https://api.github.com/users/mcepl/events{/privacy}", "received_events_url": "https://api.github.com/users/mcepl/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1831255463, "node_id": "MDU6TGFiZWwxODMxMjU1NDYz", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/reproducer:%20missing", "name": "reproducer: missing", "color": "e23c36", "default": false, "description": "This PR or issue lacks code, which reproduce the problem described or clearly understandable STR"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2021-09-08T15:07:14Z", "updated_at": "2021-09-09T20:08:20Z", "closed_at": "2021-09-08T20:31:54Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nWhen packaging for openSUSE/Factory five tests fail because numbers of warnings in tests don\u2019t correlate with reality:\r\n```\r\n[  261s] =================================== FAILURES ===================================\r\n[  261s] ______________________ test_old_style_middleware[pyloop] _______________________\r\n[  261s]\r\n[  261s] loop = <_UnixSelectorEventLoop running=False closed=False debug=False>\r\n[  261s] aiohttp_client = <function aiohttp_client.<locals>.go at 0x7fde94fd4280>\r\n[  261s]\r\n[  261s]     async def test_old_style_middleware(loop, aiohttp_client) -> None:\r\n[  261s]         async def handler(request):\r\n[  261s]             return web.Response(body=b\"OK\")\r\n[  261s]\r\n[  261s]         async def middleware_factory(app, handler):\r\n[  261s]             async def middleware(request):\r\n[  261s]                 resp = await handler(request)\r\n[  261s]                 assert 200 == resp.status\r\n[  261s]                 resp.set_status(201)\r\n[  261s]                 resp.text = resp.text + \"[old style middleware]\"\r\n[  261s]                 return resp\r\n[  261s]\r\n[  261s]             return middleware\r\n[  261s]\r\n[  261s]         with pytest.warns(DeprecationWarning) as warning_checker:\r\n[  261s]             app = web.Application()\r\n[  261s]             app.middlewares.append(middleware_factory)\r\n[  261s]             app.router.add_route(\"GET\", \"/\", handler)\r\n[  261s]             client = await aiohttp_client(app)\r\n[  261s]             resp = await client.get(\"/\")\r\n[  261s]             assert 201 == resp.status\r\n[  261s]             txt = await resp.text()\r\n[  261s]             assert \"OK[old style middleware]\" == txt\r\n[  261s]\r\n[  261s] >       assert len(warning_checker) == 1, f\"warning_checker:\\n{[str(x) for x in warning_checker.list]}\"\r\n[  261s] E       AssertionError: warning_checker:\r\n[  261s] E         ['{message : DeprecationWarning(\\'old-style middleware \"<function test_old_style_middleware.<locals>.middleware_factory at 0x7fde94fd4160>\" deprecated, see #2252\\'), category : \\'DeprecationWarning\\', filename : \\'/home/abuild/rpmbuild/BUILDROOT/python-aiohttp-3.7.4-0.x86_64/usr/lib64/python3.9/site-packages/aiohttp/web_app.py\\', lineno : 252, line : None}', \"{message : DeprecationWarning('The loop argument is deprecated since Python 3.8, and scheduled for removal in Python 3.10.'), category : 'DeprecationWarning', filename : '/usr/lib64/python3.9/asyncio/base_events.py', lineno : 1518, line : None}\"]\r\n[  261s] E       assert 2 == 1\r\n[  261s] E         +2\r\n[  261s] E         -1\r\n[  261s]\r\n[  261s] tests/test_web_middleware.py:413: AssertionError\r\n[  261s] ________________________ test_mixed_middleware[pyloop] _________________________\r\n[  261s]\r\n[  261s] loop = <_UnixSelectorEventLoop running=False closed=False debug=False>\r\n[  261s] aiohttp_client = <function aiohttp_client.<locals>.go at 0x7fde94fe3280>\r\n[  261s]\r\n[  261s]     async def test_mixed_middleware(loop, aiohttp_client) -> None:\r\n[  261s]         async def handler(request):\r\n[  261s]             return web.Response(body=b\"OK\")\r\n[  261s]\r\n[  261s]         async def m_old1(app, handler):\r\n[  261s]             async def middleware(request):\r\n[  261s]                 resp = await handler(request)\r\n[  261s]                 resp.text += \"[old style 1]\"\r\n[  261s]                 return resp\r\n[  261s]\r\n[  261s]             return middleware\r\n[  261s]\r\n[  261s]         @web.middleware\r\n[  261s]         async def m_new1(request, handler):\r\n[  261s]             resp = await handler(request)\r\n[  261s]             resp.text += \"[new style 1]\"\r\n[  261s]             return resp\r\n[  261s]\r\n[  261s]         async def m_old2(app, handler):\r\n[  261s]             async def middleware(request):\r\n[  261s]                 resp = await handler(request)\r\n[  261s]                 resp.text += \"[old style 2]\"\r\n[  261s]                 return resp\r\n[  261s]\r\n[  261s]             return middleware\r\n[  261s]\r\n[  261s]         @web.middleware\r\n[  261s]         async def m_new2(request, handler):\r\n[  261s]             resp = await handler(request)\r\n[  261s]             resp.text += \"[new style 2]\"\r\n[  261s]             return resp\r\n[  261s]\r\n[  261s]         middlewares = m_old1, m_new1, m_old2, m_new2\r\n[  261s]\r\n[  261s]         with pytest.warns(DeprecationWarning) as w:\r\n[  261s]             app = web.Application(middlewares=middlewares)\r\n[  261s]             app.router.add_route(\"GET\", \"/\", handler)\r\n[  261s]             client = await aiohttp_client(app)\r\n[  261s]             resp = await client.get(\"/\")\r\n[  261s]             assert 200 == resp.status\r\n[  261s]             txt = await resp.text()\r\n[  261s]             assert \"OK[new style 2][old style 2][new style 1][old style 1]\" == txt\r\n[  261s]\r\n[  261s] >       assert len(w) == 2\r\n[  261s] E       assert 3 == 2\r\n[  261s] E         +3\r\n[  261s] E         -2\r\n[  261s]\r\n[  261s] tests/test_web_middleware.py:467: AssertionError\r\n[  261s] ___________________ test_old_style_middleware_class[pyloop] ____________________\r\n[  261s]\r\n[  261s] loop = <_UnixSelectorEventLoop running=False closed=False debug=False>\r\n[  261s] aiohttp_client = <function aiohttp_client.<locals>.go at 0x7fde94fd4dc0>\r\n[  261s]\r\n[  261s]     async def test_old_style_middleware_class(loop, aiohttp_client) -> None:\r\n[  261s]         async def handler(request):\r\n[  261s]             return web.Response(body=b\"OK\")\r\n[  261s]\r\n[  261s]         class Middleware:\r\n[  261s]             async def __call__(self, app, handler):\r\n[  261s]                 async def middleware(request):\r\n[  261s]                     resp = await handler(request)\r\n[  261s]                     assert 200 == resp.status\r\n[  261s]                     resp.set_status(201)\r\n[  261s]                     resp.text = resp.text + \"[old style middleware]\"\r\n[  261s]                     return resp\r\n[  261s]\r\n[  261s]                 return middleware\r\n[  261s]\r\n[  261s]         with pytest.warns(DeprecationWarning) as warning_checker:\r\n[  261s]             app = web.Application()\r\n[  261s]             app.middlewares.append(Middleware())\r\n[  261s]             app.router.add_route(\"GET\", \"/\", handler)\r\n[  261s]             client = await aiohttp_client(app)\r\n[  261s]             resp = await client.get(\"/\")\r\n[  261s]             assert 201 == resp.status\r\n[  261s]             txt = await resp.text()\r\n[  261s]             assert \"OK[old style middleware]\" == txt\r\n[  261s]\r\n[  261s] >       assert len(warning_checker) == 1\r\n[  261s] E       assert 2 == 1\r\n[  261s] E         +2\r\n[  261s] E         -1\r\n[  261s]\r\n[  261s] tests/test_web_middleware.py:506: AssertionError\r\n[  261s] ___________________ test_new_style_middleware_class[pyloop] ____________________\r\n[  261s]\r\n[  261s] loop = <_UnixSelectorEventLoop running=False closed=False debug=False>\r\n[  261s] aiohttp_client = <function aiohttp_client.<locals>.go at 0x7fde94fe3940>\r\n[  261s]\r\n[  261s]     async def test_new_style_middleware_class(loop, aiohttp_client) -> None:\r\n[  261s]         async def handler(request):\r\n[  261s]             return web.Response(body=b\"OK\")\r\n[  261s]\r\n[  261s]         @web.middleware\r\n[  261s]         class Middleware:\r\n[  261s]             async def __call__(self, request, handler):\r\n[  261s]                 resp = await handler(request)\r\n[  261s]                 assert 200 == resp.status\r\n[  261s]                 resp.set_status(201)\r\n[  261s]                 resp.text = resp.text + \"[new style middleware]\"\r\n[  261s]                 return resp\r\n[  261s]\r\n[  261s]         with pytest.warns(None) as warning_checker:\r\n[  261s]             app = web.Application()\r\n[  261s]             app.middlewares.append(Middleware())\r\n[  261s]             app.router.add_route(\"GET\", \"/\", handler)\r\n[  261s]             client = await aiohttp_client(app)\r\n[  261s]             resp = await client.get(\"/\")\r\n[  261s]             assert 201 == resp.status\r\n[  261s]             txt = await resp.text()\r\n[  261s]             assert \"OK[new style middleware]\" == txt\r\n[  261s]\r\n[  261s] >       assert len(warning_checker) == 0\r\n[  261s] E       assert 1 == 0\r\n[  261s] E         +1\r\n[  261s] E         -0\r\n[  261s]\r\n[  261s] tests/test_web_middleware.py:540: AssertionError\r\n[  261s] ___________________ test_new_style_middleware_method[pyloop] ___________________\r\n[  261s]\r\n[  261s] loop = <_UnixSelectorEventLoop running=False closed=False debug=False>\r\n[  261s] aiohttp_client = <function aiohttp_client.<locals>.go at 0x7fde94fd4040>\r\n[  261s]\r\n[  261s]     async def test_new_style_middleware_method(loop, aiohttp_client) -> None:\r\n[  261s]         async def handler(request):\r\n[  261s]             return web.Response(body=b\"OK\")\r\n[  261s]\r\n[  261s]         class Middleware:\r\n[  261s]             @web.middleware\r\n[  261s]             async def call(self, request, handler):\r\n[  261s]                 resp = await handler(request)\r\n[  261s]                 assert 200 == resp.status\r\n[  261s]                 resp.set_status(201)\r\n[  261s]                 resp.text = resp.text + \"[new style middleware]\"\r\n[  261s]                 return resp\r\n[  261s]\r\n[  261s]         with pytest.warns(None) as warning_checker:\r\n[  261s]             app = web.Application()\r\n[  261s]             app.middlewares.append(Middleware().call)\r\n[  261s]             app.router.add_route(\"GET\", \"/\", handler)\r\n[  261s]             client = await aiohttp_client(app)\r\n[  261s]             resp = await client.get(\"/\")\r\n[  261s]             assert 201 == resp.status\r\n[  261s]             txt = await resp.text()\r\n[  261s]             assert \"OK[new style middleware]\" == txt\r\n[  261s]\r\n[  261s] >       assert len(warning_checker) == 0\r\n[  261s] E       assert 1 == 0\r\n[  261s] E         +1\r\n[  261s] E         -0\r\n[  261s]\r\n[  261s] tests/test_web_middleware.py:566: AssertionError\r\n[  261s] =============================== warnings summary ===============================\r\n[  261s] tests/test_client_session.py: 10 warnings\r\n[  261s]   /home/abuild/rpmbuild/BUILDROOT/python-aiohttp-3.7.4-0.x86_64/usr/lib64/python3.9/site-packages/aiohttp/connector.py:83: DeprecationWarning: Connector.close() is a coroutine, please use await connector.close()\r\n[  261s]     warnings.warn(\r\n[  261s]\r\n[  261s] tests/test_client_session.py::test_connector_loop[pyloop]\r\n[  261s]   /usr/lib/python3.9/site-packages/_pytest/unraisableexception.py:78: PytestUnraisableExceptionWarning: Exception ignored in: <function ClientSession.__del__ at 0x7fde982f7af0>\r\n[  261s]\r\n[  261s]   Traceback (most recent call last):\r\n[  261s]     File \"/home/abuild/rpmbuild/BUILDROOT/python-aiohttp-3.7.4-0.x86_64/usr/lib64/python3.9/site-packages/aiohttp/client.py\", line 326, in __del__\r\n[  261s]       if not self.closed:\r\n[  261s]     File \"/home/abuild/rpmbuild/BUILDROOT/python-aiohttp-3.7.4-0.x86_64/usr/lib64/python3.9/site-packages/aiohttp/client.py\", line 963, in closed\r\n[  261s]       return self._connector is None or self._connector.closed\r\n[  261s]   AttributeError: 'ClientSession' object has no attribute '_connector'\r\n[  261s]\r\n[  261s]     warnings.warn(pytest.PytestUnraisableExceptionWarning(msg))\r\n[  261s]\r\n[  261s] tests/test_loop.py: 2 warnings\r\n[  261s] tests/test_test_utils.py: 13 warnings\r\n[  261s]   /usr/lib64/python3.9/asyncio/base_events.py:1518: DeprecationWarning: The loop argument is deprecated since Python 3.8, and scheduled for removal in Python 3.10.\r\n[  261s]     await tasks.sleep(0, loop=self)\r\n[  261s]\r\n[  261s] tests/test_run_app.py: 46 warnings\r\n[  261s]   /home/abuild/rpmbuild/BUILDROOT/python-aiohttp-3.7.4-0.x86_64/usr/lib64/python3.9/site-packages/aiohttp/web.py:444: DeprecationWarning: The loop argument is deprecated since Python 3.8, and scheduled for removal in Python 3.10.\r\n[  261s]     asyncio.gather(*to_cancel, loop=loop, return_exceptions=True)\r\n[  261s]\r\n[  261s] -- Docs: https://docs.pytest.org/en/stable/warnings.html\r\n[  261s] =========================== short test summary info ============================\r\n[  261s] SKIPPED [1] tests/test_client_session.py:672: The check is applied in DEBUG mode only\r\n[  261s] SKIPPED [1] tests/test_connector.py:1932: Proactor Event loop present only in Windows\r\n[  261s] SKIPPED [1] tests/test_connector.py:1940: Proactor Event loop present only in Windows\r\n[  261s] SKIPPED [1] tests/test_connector.py:1951: Proactor Event loop present only in Windows\r\n[  261s] SKIPPED [1] tests/test_connector.py:2102: Proactor Event loop present only in Windows\r\n[  261s] SKIPPED [1] tests/test_http_parser.py:824: C based HTTP parser not available\r\n[  261s] SKIPPED [1] tests/test_multipart_helpers.py:99: need more smart parser which respects quoted text\r\n[  261s] SKIPPED [1] tests/test_multipart_helpers.py:446: should raise decoding error: %82 is invalid for latin1\r\n[  261s] SKIPPED [1] tests/test_multipart_helpers.py:455: should raise decoding error: %E4 is invalid for utf-8\r\n[  261s] SKIPPED [1] tests/test_multipart_helpers.py:510: urllib.parse.unquote is tolerate to standalone % chars\r\n[  261s] SKIPPED [1] tests/test_multipart_helpers.py:519: urllib.parse.unquote is tolerate to standalone % chars\r\n[  261s] SKIPPED [1] tests/test_proxy_functional.py:199: we need to reconsider how we test this\r\n[  261s] SKIPPED [1] tests/test_proxy_functional.py:223: we need to reconsider how we test this\r\n[  261s] SKIPPED [1] tests/test_web_app.py:297: The check is applied in DEBUG mode only\r\n[  261s] SKIPPED [1] tests/test_web_functional.py:1927: C based HTTP parser not available\r\n[  261s] SKIPPED [1] tests/test_web_request.py:681: The check is applied in DEBUG mode only\r\n[  261s] SKIPPED [1] tests/test_web_runner.py:124: Proactor Event loop present only in Windows\r\n[  261s] SKIPPED [1] tests/test_web_runner.py:134: Proactor Event loop present only in Windows\r\n[  261s] = 5 failed, 2438 passed, 18 skipped, 4 deselected, 3 xfailed, 72 warnings in 107.37s (0:01:47) =\r\n```\r\n\r\n[Complete build log](https://github.com/aio-libs/aiohttp/files/7129867/_log.txt) with all versions of packages used and steps taken.\r\n\n\n### To Reproduce\n\n1. Run test suite\n\n### Expected behavior\n\nAll tests should pass\n\n### Logs/tracebacks\n\n```python-traceback\nsee above\n```\n\n\n### Python Version\n\n```console\n[  153s] + PYTHONPATH=/home/abuild/rpmbuild/BUILDROOT/python-aiohttp-3.7.4-0.x86_64/usr/lib64/python3.9/site-packages\r\n[  153s] + PYTHONDONTWRITEBYTECODE=1\r\n[  153s] + pytest-3.9 --ignore=_build.python36 --ignore=_build.python39 --ignore=_build.python38 -v --ignore ./aiohttp -rs -k 'not (test_aiohttp_request_coroutine or test_mark_formdata_as_processed or test_aiohttp_plugin_async )'\r\n[  153s] ============================= test session starts ==============================\r\n[  153s] platform linux -- Python 3.9.7, pytest-6.2.4, py-1.10.0, pluggy-0.13.1 -- /usr/bin/python3.9\r\n[  153s] cachedir: .pytest_cache\r\n[  153s] rootdir: /home/abuild/rpmbuild/BUILD/aiohttp-3.7.4, configfile: pytest.ini\r\n[  153s] plugins: mock-3.6.1, timeout-1.4.2\r\n[  156s] collecting ... collected 2468 items / 4 deselected / 2464 selected\r\n```\n```\n\n\n### aiohttp Version\n\n```console\n3.7.4\n```\n\n\n### multidict Version\n\n```console\n5.1.0\n```\n\n\n### yarl Version\n\n```console\n1.6.3\n```\n\n\n### OS\n\nLinux/openSUSE\n\n### Related component\n\nServer\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5991/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5991/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5975", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5975/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5975/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5975/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5975", "id": 982302111, "node_id": "MDU6SXNzdWU5ODIzMDIxMTE=", "number": 5975, "title": "aiohttp.ClientSession(json_serialize=orjson.dumps).post(json={}) error: 'bytes' object has no attribute 'encode'", "user": {"login": "stringk245", "id": 11296126, "node_id": "MDQ6VXNlcjExMjk2MTI2", "avatar_url": "https://avatars.githubusercontent.com/u/11296126?v=4", "gravatar_id": "", "url": "https://api.github.com/users/stringk245", "html_url": "https://github.com/stringk245", "followers_url": "https://api.github.com/users/stringk245/followers", "following_url": "https://api.github.com/users/stringk245/following{/other_user}", "gists_url": "https://api.github.com/users/stringk245/gists{/gist_id}", "starred_url": "https://api.github.com/users/stringk245/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/stringk245/subscriptions", "organizations_url": "https://api.github.com/users/stringk245/orgs", "repos_url": "https://api.github.com/users/stringk245/repos", "events_url": "https://api.github.com/users/stringk245/events{/privacy}", "received_events_url": "https://api.github.com/users/stringk245/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-08-30T02:08:25Z", "updated_at": "2021-10-02T12:55:44Z", "closed_at": "2021-10-02T12:55:44Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\naiohttp.ClientSession(json_serialize=orjson.dumps).post(json={'xxx':'xxx'})\r\norjson.dumps is bytes, and  aiohttp/payload.py  JsonPayload super().__init__( dumps(value).encode(encoding),)  AttributeError: 'bytes' object has no attribute 'encode'\n\n### To Reproduce\n\naiohttp.ClientSession(json_serialize=orjson.dumps).post(url='',json={'xxx':'xxx'})\n\n### Expected behavior\n\naiohttp/payload.py  \r\nJsonPayload super().__init__( \r\n    dumps(value).encode(encoding) if not isinstance(value,bytes) else value\r\n)\n\n### Logs/tracebacks\n\n```python-traceback\nFile \"D:\\develop\\python37\\lib\\site-packages\\aiohttp\\client.py\", line 390, in _request\r\n    data = payload.JsonPayload(json, dumps=self._json_serialize)\r\n  File \"D:\\develop\\python37\\lib\\site-packages\\aiohttp\\payload.py\", line 381, in __init__\r\n    dumps(value).encode(encoding),\r\nAttributeError: 'bytes' object has no attribute 'encode'\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\n3.7.9\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.3\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: d:\\develop\\python37\\lib\\site-packages\r\nRequires: multidict, yarl, attrs, typing-extensions, chardet, async-timeout\r\nRequired-by:\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.1.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: d:\\develop\\python37\\lib\\site-packages\r\nRequires:\r\nRequired-by: yarl, sanic, aiohttp\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.3\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: d:\\develop\\python37\\lib\\site-packages\r\nRequires: idna, multidict, typing-extensions\r\nRequired-by: aiohttp\n```\n\n\n### OS\n\nwindows\n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5975/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5975/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5966", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5966/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5966/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5966/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5966", "id": 979215144, "node_id": "MDU6SXNzdWU5NzkyMTUxNDQ=", "number": 5966, "title": "Asyncronious DNS not working", "user": {"login": "arichr", "id": 87308853, "node_id": "MDQ6VXNlcjg3MzA4ODUz", "avatar_url": "https://avatars.githubusercontent.com/u/87308853?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arichr", "html_url": "https://github.com/arichr", "followers_url": "https://api.github.com/users/arichr/followers", "following_url": "https://api.github.com/users/arichr/following{/other_user}", "gists_url": "https://api.github.com/users/arichr/gists{/gist_id}", "starred_url": "https://api.github.com/users/arichr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arichr/subscriptions", "organizations_url": "https://api.github.com/users/arichr/orgs", "repos_url": "https://api.github.com/users/arichr/repos", "events_url": "https://api.github.com/users/arichr/events{/privacy}", "received_events_url": "https://api.github.com/users/arichr/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2021-08-25T14:28:10Z", "updated_at": "2021-08-29T16:41:01Z", "closed_at": "2021-08-29T16:37:54Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\naiodns is not working. I checked my Internet connection and DNS settings (by using `socket` and `aiodns` \r\n related functions). \r\n\r\nI tried to get a json file, but got: `OSError: [Errno 101] Network is unreachable`.\r\n\r\n\r\n### To Reproduce\r\n\r\n```python\r\nimport aiohttp\r\nfrom aiohttp.resolver import AsyncResolver\r\n\r\nasync def main():\r\n    resolver = AsyncResolver()\r\n    conn = aiohttp.TCPConnector(resolver=resolver)\r\n\r\n    async with aiohttp.ClientSession(connector=conn) as session:\r\n        inst_url = 'https://api.invidious.io/instances.json'\r\n        async with session.get(inst_url) as resp:\r\n            json = await resp.json()\r\n            print(json)\r\n```\r\n\r\n### Expected behavior\r\n\r\nThe content of https://api.invidious.io/instances.json\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nTraceback (most recent call last):\r\n  File \"/path/to/venv/lib/python3.9/site-packages/aiohttp/connector.py\", line 970, in _wrap_create_connection\r\n    return await self._loop.create_connection(*args, **kwargs)  # type: ignore  # noqa\r\n  File \"/usr/lib/python3.9/asyncio/base_events.py\", line 1056, in create_connection\r\n    raise exceptions[0]\r\n  File \"/usr/lib/python3.9/asyncio/base_events.py\", line 1041, in create_connection\r\n    sock = await self._connect_sock(\r\n  File \"/usr/lib/python3.9/asyncio/base_events.py\", line 955, in _connect_sock\r\n    await self.sock_connect(sock, address)\r\n  File \"/usr/lib/python3.9/asyncio/selector_events.py\", line 502, in sock_connect\r\n    return await fut\r\n  File \"/usr/lib/python3.9/asyncio/selector_events.py\", line 507, in _sock_connect\r\n    sock.connect(address)\r\nOSError: [Errno 101] Network is unreachable\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/usr/lib/python3.9/asyncio/base_events.py\", line 642, in run_until_complete\r\n    return future.result()\r\n  File \"<stdin>\", line 6, in main\r\n  File \"/path/to/venv/lib/python3.9/site-packages/aiohttp/client.py\", line 1117, in __aenter__\r\n    self._resp = await self._coro\r\n  File \"/path/to/venv/lib/python3.9/site-packages/aiohttp/client.py\", line 520, in _request\r\n    conn = await self._connector.connect(\r\n  File \"/path/to/venv/lib/python3.9/site-packages/aiohttp/connector.py\", line 535, in connect\r\n    proto = await self._create_connection(req, traces, timeout)\r\n  File \"/path/to/venv/lib/python3.9/site-packages/aiohttp/connector.py\", line 893, in _create_connection\r\n    _, proto = await self._create_direct_connection(req, traces, timeout)\r\n  File \"/path/to/venv/lib/python3.9/site-packages/aiohttp/connector.py\", line 1052, in _create_direct_connection\r\n    raise last_exc\r\n  File \"/path/to/venv/lib/python3.9/site-packages/aiohttp/connector.py\", line 1021, in _create_direct_connection\r\n    transp, proto = await self._wrap_create_connection(\r\n  File \"/path/to/venv/lib/python3.9/site-packages/aiohttp/connector.py\", line 976, in _wrap_create_connection\r\n    raise client_error(req.connection_key, exc) from exc\r\naiohttp.client_exceptions.ClientConnectorError: Cannot connect to host api.invidious.io:443 ssl:default [Network is unreachable]\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n(venv) $ python --version\r\nPython 3.9.6\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n(venv) $ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.4.post0\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /path/to/venv/lib/python3.9/site-packages\r\nRequires: typing-extensions, yarl, attrs, async-timeout, chardet, multidict\r\nRequired-by:\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.1.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /path/to/venv/lib/python3.9/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.3\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /path/to/venv/lib/python3.9/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\r\n### OS\r\n\r\nDistribution: Arch Linux\r\n```\r\n$ uname -srmo\r\nLinux 5.12.19-hardened1-1-hardened x86_64 GNU/Linux\r\n```\r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\nVirtual environment\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5966/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5966/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5942", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5942/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5942/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5942/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5942", "id": 966330133, "node_id": "MDU6SXNzdWU5NjYzMzAxMzM=", "number": 5942, "title": "GET redirects trouble", "user": {"login": "ghost", "id": 10137, "node_id": "MDQ6VXNlcjEwMTM3", "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghost", "html_url": "https://github.com/ghost", "followers_url": "https://api.github.com/users/ghost/followers", "following_url": "https://api.github.com/users/ghost/following{/other_user}", "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghost/subscriptions", "organizations_url": "https://api.github.com/users/ghost/orgs", "repos_url": "https://api.github.com/users/ghost/repos", "events_url": "https://api.github.com/users/ghost/events{/privacy}", "received_events_url": "https://api.github.com/users/ghost/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-08-11T09:30:37Z", "updated_at": "2021-08-11T11:40:27Z", "closed_at": "2021-08-11T11:40:27Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\n*Note: this issue is quite if not very similar to #3390 but I did not find a solution there so I created an issue*\r\n\r\nThere's a page ([dankapi.github.io/test](https://dankapi.github.io/test)) that when requested onto, redirects you to [some-random-api.ml/bottoken](https://some-random-api.ml/bottoken). This was made by me for testing redirects.\r\n\r\nUnfortunately when I request from dankapi.github.io, I was expecting the request to be carried forward to some-random-api.ml/bottoken, but the request did not do that. The request stayed on the initial dankapi.github.io/test page.\n\n### To Reproduce\n\nTry running this code:\r\n```python\r\nfrom aiohttp import ClientSession\r\nfrom asyncio import get_event_loop\r\n\r\nasync def main():\r\n    async with ClientSession() as s:\r\n        async with s.get('https://dankapi.github.io/test', allow_redirects = True) as r:\r\n            print('URL:', r.url)\r\n            print('Wanted URL: https://some-random-api.ml/bottoken')\r\n\r\nget_event_loop().run_until_complete(main())\r\n```\r\nResult:\r\n```python\r\n>>> URL: https://dankapi.github.io/test\r\n>>> Wanted URL: https://some-random-api.ml/bottoken\r\n```\n\n### Expected behavior\n\nI expected the URL to get redirected and the response's url to be https://some-random-api.ml/bottoken .\n\n### Logs/tracebacks\n\n```python-traceback\nN/A\n```\n\n\n### Python Version\n\n```console\npython 3.9.2\n```\n\n\n### aiohttp Version\n\n```console\n3.7.4.post0\n```\n\n\n### multidict Version\n\n```console\n5.1.0\n```\n\n\n### yarl Version\n\n```console\n1.6.3\n```\n\n\n### OS\n\nmacOS\n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [x] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5942/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5942/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5941", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5941/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5941/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5941/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5941", "id": 964975159, "node_id": "MDU6SXNzdWU5NjQ5NzUxNTk=", "number": 5941, "title": "AttributeError: 'NoneType' object has no attribute 'send'", "user": {"login": "justanotherbyte", "id": 62267480, "node_id": "MDQ6VXNlcjYyMjY3NDgw", "avatar_url": "https://avatars.githubusercontent.com/u/62267480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/justanotherbyte", "html_url": "https://github.com/justanotherbyte", "followers_url": "https://api.github.com/users/justanotherbyte/followers", "following_url": "https://api.github.com/users/justanotherbyte/following{/other_user}", "gists_url": "https://api.github.com/users/justanotherbyte/gists{/gist_id}", "starred_url": "https://api.github.com/users/justanotherbyte/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/justanotherbyte/subscriptions", "organizations_url": "https://api.github.com/users/justanotherbyte/orgs", "repos_url": "https://api.github.com/users/justanotherbyte/repos", "events_url": "https://api.github.com/users/justanotherbyte/events{/privacy}", "received_events_url": "https://api.github.com/users/justanotherbyte/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2021-08-10T13:18:05Z", "updated_at": "2021-10-30T13:42:45Z", "closed_at": "2021-10-30T13:42:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nWhen trying to send data through a websocket, the following error occurs:\r\n\r\n```sh\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\Happy\\OneDrive\\Documents\\Coding Projects\\Websites\\bbdash\\lib\\site-packages\\django\\core\\handlers\\exception.py\", line 47, in inner\r\n    response = get_response(request)\r\n  File \"C:\\Users\\Happy\\OneDrive\\Documents\\Coding Projects\\Websites\\bbdash\\lib\\site-packages\\django\\core\\handlers\\base.py\", line 181, in _get_response\r\n    response = wrapped_callback(request, *callback_args, **callback_kwargs)\r\n  File \"C:\\Users\\Happy\\OneDrive\\Documents\\Coding Projects\\Websites\\bbdash\\lib\\site-packages\\asgiref\\sync.py\", line 223, in __call__\r\n    return call_result.result()\r\n  File \"c:\\users\\happy\\appdata\\local\\programs\\python\\python38\\lib\\concurrent\\futures\\_base.py\", line 432, in result\r\n    return self.__get_result()\r\n  File \"c:\\users\\happy\\appdata\\local\\programs\\python\\python38\\lib\\concurrent\\futures\\_base.py\", line 388, in __get_result\r\n    raise self._exception\r\n  File \"C:\\Users\\Happy\\OneDrive\\Documents\\Coding Projects\\Websites\\bbdash\\lib\\site-packages\\asgiref\\sync.py\", line 292, in main_wrap\r\n    result = await self.awaitable(*args, **kwargs)\r\n  File \"C:\\Users\\Happy\\OneDrive\\Documents\\Coding Projects\\Websites\\bbdash\\core\\views.py\", line 110, in dashboard_welcoming\r\n    await WEBSOCKET.send_json({\r\n  File \"C:\\Users\\Happy\\OneDrive\\Documents\\Coding Projects\\Websites\\bbdash\\bbdash\\websocket.py\", line 42, in send_json\r\n    return await self.ws.send_str(string_data)\r\n  File \"C:\\Users\\Happy\\OneDrive\\Documents\\Coding Projects\\Websites\\bbdash\\lib\\site-packages\\aiohttp\\client_ws.py\", line 150, in send_str\r\n    await self._writer.send(data, binary=False, compress=compress)\r\n  File \"C:\\Users\\Happy\\OneDrive\\Documents\\Coding Projects\\Websites\\bbdash\\lib\\site-packages\\aiohttp\\http_websocket.py\", line 687, in send\r\n    await self._send_frame(message, WSMsgType.TEXT, compress)\r\n  File \"C:\\Users\\Happy\\OneDrive\\Documents\\Coding Projects\\Websites\\bbdash\\lib\\site-packages\\aiohttp\\http_websocket.py\", line 643, in _send_frame\r\n    self._write(header + mask + message)\r\n  File \"C:\\Users\\Happy\\OneDrive\\Documents\\Coding Projects\\Websites\\bbdash\\lib\\site-packages\\aiohttp\\http_websocket.py\", line 661, in _write\r\n    self.transport.write(data)\r\n  File \"c:\\users\\happy\\appdata\\local\\programs\\python\\python38\\lib\\asyncio\\proactor_events.py\", line 359, in write\r\n    self._loop_writing(data=bytes(data))\r\n  File \"c:\\users\\happy\\appdata\\local\\programs\\python\\python38\\lib\\asyncio\\proactor_events.py\", line 395, in _loop_writing\r\n    self._write_fut = self._loop._proactor.send(self._sock, data)\r\nAttributeError: 'NoneType' object has no attribute 'send'\r\n```\n\n### To Reproduce\n\n1. Create a django project\r\n2. Create a websocket class that handles websockets. Mine is shown below;\r\n```py\r\nclass WebsocketIO:\r\n    def __init__(self, ws: aiohttp.ClientWebSocketResponse, session: aiohttp.ClientSession):\r\n        self.ws = ws\r\n        self.session = session\r\n\r\n        self.initial_connect = False\r\n        self.failed_connect = False\r\n\r\n    \r\n    @property\r\n    def can_connect(self) -> bool:\r\n        if self.ws is None or self.ws.closed is True:\r\n            if self.failed_connect is False:\r\n                return True\r\n            \r\n        return False\r\n\r\n\r\n    async def send_json(self, data: dict):\r\n        string_data = json.dumps(data)\r\n        return await self.ws.send_str(string_data)\r\n\r\n    async def receive_json(self) -> dict:\r\n        string_data = await self.ws.receive_str()\r\n        data = json.loads(string_data)\r\n        return data\r\n\r\n    \r\n    @classmethod\r\n    def from_none(cls):\r\n        io = cls(None, None)\r\n        return io\r\n\r\n    async def ws_connect(self) -> Tuple[aiohttp.ClientWebSocketResponse, aiohttp.ClientSession]:\r\n        ws, session = await _ws_connect(WEBSOCKET_URL, headers = {\"Authorization\": WEBSOCKET_AUTH})\r\n        self.ws = ws\r\n        self.session = session\r\n        return (ws, session)\r\n```\r\n3. Try and send data through a websocket in an async django view.\r\n\n\n### Expected behavior\n\nThe library actually sends the data through the websocket instead of failing.\n\n### Logs/tracebacks\n\n```python-traceback\nTraceback (most recent call last):\r\n  File \"C:\\Users\\Happy\\OneDrive\\Documents\\Coding Projects\\Websites\\bbdash\\lib\\site-packages\\django\\core\\handlers\\exception.py\", line 47, in inner\r\n    response = get_response(request)\r\n  File \"C:\\Users\\Happy\\OneDrive\\Documents\\Coding Projects\\Websites\\bbdash\\lib\\site-packages\\django\\core\\handlers\\base.py\", line 181, in _get_response\r\n    response = wrapped_callback(request, *callback_args, **callback_kwargs)\r\n  File \"C:\\Users\\Happy\\OneDrive\\Documents\\Coding Projects\\Websites\\bbdash\\lib\\site-packages\\asgiref\\sync.py\", line 223, in __call__\r\n    return call_result.result()\r\n  File \"c:\\users\\happy\\appdata\\local\\programs\\python\\python38\\lib\\concurrent\\futures\\_base.py\", line 432, in result\r\n    return self.__get_result()\r\n  File \"c:\\users\\happy\\appdata\\local\\programs\\python\\python38\\lib\\concurrent\\futures\\_base.py\", line 388, in __get_result\r\n    raise self._exception\r\n  File \"C:\\Users\\Happy\\OneDrive\\Documents\\Coding Projects\\Websites\\bbdash\\lib\\site-packages\\asgiref\\sync.py\", line 292, in main_wrap\r\n    result = await self.awaitable(*args, **kwargs)\r\n  File \"C:\\Users\\Happy\\OneDrive\\Documents\\Coding Projects\\Websites\\bbdash\\core\\views.py\", line 110, in dashboard_welcoming\r\n    await WEBSOCKET.send_json({\r\n  File \"C:\\Users\\Happy\\OneDrive\\Documents\\Coding Projects\\Websites\\bbdash\\bbdash\\websocket.py\", line 42, in send_json\r\n    return await self.ws.send_str(string_data)\r\n  File \"C:\\Users\\Happy\\OneDrive\\Documents\\Coding Projects\\Websites\\bbdash\\lib\\site-packages\\aiohttp\\client_ws.py\", line 150, in send_str\r\n    await self._writer.send(data, binary=False, compress=compress)\r\n  File \"C:\\Users\\Happy\\OneDrive\\Documents\\Coding Projects\\Websites\\bbdash\\lib\\site-packages\\aiohttp\\http_websocket.py\", line 687, in send\r\n    await self._send_frame(message, WSMsgType.TEXT, compress)\r\n  File \"C:\\Users\\Happy\\OneDrive\\Documents\\Coding Projects\\Websites\\bbdash\\lib\\site-packages\\aiohttp\\http_websocket.py\", line 643, in _send_frame\r\n    self._write(header + mask + message)\r\n  File \"C:\\Users\\Happy\\OneDrive\\Documents\\Coding Projects\\Websites\\bbdash\\lib\\site-packages\\aiohttp\\http_websocket.py\", line 661, in _write\r\n    self.transport.write(data)\r\n  File \"c:\\users\\happy\\appdata\\local\\programs\\python\\python38\\lib\\asyncio\\proactor_events.py\", line 359, in write\r\n    self._loop_writing(data=bytes(data))\r\n  File \"c:\\users\\happy\\appdata\\local\\programs\\python\\python38\\lib\\asyncio\\proactor_events.py\", line 395, in _loop_writing\r\n    self._write_fut = self._loop._proactor.send(self._sock, data)\r\nAttributeError: 'NoneType' object has no attribute 'send'\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\nPython 3.8.7\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.4.post0\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\users\\happy\\onedrive\\documents\\coding projects\\websites\\bbdash\\lib\\site-packages\r\nRequires: yarl, async-timeout, multidict, typing-extensions, attrs, chardet\r\nRequired-by: discord-ext-oauth\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.1.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\users\\happy\\onedrive\\documents\\coding projects\\websites\\bbdash\\lib\\site-packages\r\nRequires:\r\nRequired-by: yarl, aiohttp\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.3\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\users\\happy\\onedrive\\documents\\coding projects\\websites\\bbdash\\lib\\site-packages\r\nRequires: multidict, idna\r\nRequired-by: aiohttp\n```\n\n\n### OS\n\nWindows\n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5941/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5941/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5927", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5927/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5927/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5927/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/5927", "id": 958322517, "node_id": "MDExOlB1bGxSZXF1ZXN0NzAxNjE5NjU3", "number": 5927, "title": "Add support for Python 3.10", "user": {"login": "Hanaasagi", "id": 9482395, "node_id": "MDQ6VXNlcjk0ODIzOTU=", "avatar_url": "https://avatars.githubusercontent.com/u/9482395?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Hanaasagi", "html_url": "https://github.com/Hanaasagi", "followers_url": "https://api.github.com/users/Hanaasagi/followers", "following_url": "https://api.github.com/users/Hanaasagi/following{/other_user}", "gists_url": "https://api.github.com/users/Hanaasagi/gists{/gist_id}", "starred_url": "https://api.github.com/users/Hanaasagi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Hanaasagi/subscriptions", "organizations_url": "https://api.github.com/users/Hanaasagi/orgs", "repos_url": "https://api.github.com/users/Hanaasagi/repos", "events_url": "https://api.github.com/users/Hanaasagi/events{/privacy}", "received_events_url": "https://api.github.com/users/Hanaasagi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 731921232, "node_id": "MDU6TGFiZWw3MzE5MjEyMzI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/infra", "name": "infra", "color": "e55e5b", "default": false, "description": null}, {"id": 1472801557, "node_id": "MDU6TGFiZWwxNDcyODAxNTU3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bot:chronographer:provided", "name": "bot:chronographer:provided", "color": "ededed", "default": false, "description": "There is a change note present in this PR"}, {"id": 2451662697, "node_id": "MDU6TGFiZWwyNDUxNjYyNjk3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/backport-3.8", "name": "backport-3.8", "color": "000000", "default": false, "description": "Trigger automatic backporting to the 3.8 release branch by Patchback robot"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/24", "html_url": "https://github.com/aio-libs/aiohttp/milestone/24", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/24/labels", "id": 7208553, "node_id": "MI_kwDOAMpNN84Abf5p", "number": 24, "title": "3.8", "description": "aiohttp 3.8 release", "creator": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "open_issues": 2, "closed_issues": 20, "state": "open", "created_at": "2021-10-01T06:45:28Z", "updated_at": "2021-11-14T12:37:54Z", "due_on": null, "closed_at": null}, "comments": 14, "created_at": "2021-08-02T16:48:02Z", "updated_at": "2021-10-27T00:44:23Z", "closed_at": "2021-10-08T23:41:32Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/5927", "html_url": "https://github.com/aio-libs/aiohttp/pull/5927", "diff_url": "https://github.com/aio-libs/aiohttp/pull/5927.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/5927.patch", "merged_at": "2021-10-08T23:41:32Z"}, "body": "<!-- Thank you for your contribution! -->\r\n## What do these changes do?\r\n\r\nAdd Python 3.10 matrix in Github Action and fix something.\r\n\r\n<!-- Please give a short brief about these changes. -->\r\n\r\n## Are there changes in behavior for the user?\r\n\r\n<!-- Outline any notable behaviour for the end users. -->\r\n\r\n## Related issue number\r\n\r\nRelated to https://github.com/aio-libs/aiohttp/issues/5905\r\n\r\n<!-- Are there any issues opened that will be resolved by merging this change? -->\r\n\r\n## Checklist\r\n\r\n- [ ] I think the code is well written\r\n- [ ] Unit tests for the changes exist\r\n- [ ] Documentation reflects the changes\r\n- [ ] If you provide code modification, please add yourself to `CONTRIBUTORS.txt`\r\n  * The format is &lt;Name&gt; &lt;Surname&gt;.\r\n  * Please keep alphabetical order, the file is sorted by names.\r\n- [ ] Add a new news fragment into the `CHANGES` folder\r\n  * name it `<issue_id>.<type>` for example (588.bugfix)\r\n  * if you don't have an `issue_id` change it to the pr id after creating the pr\r\n  * ensure type is one of the following:\r\n    * `.feature`: Signifying a new feature.\r\n    * `.bugfix`: Signifying a bug fix.\r\n    * `.doc`: Signifying a documentation improvement.\r\n    * `.removal`: Signifying a deprecation or removal of public API.\r\n    * `.misc`: A ticket has been closed, but it is not of interest to users.\r\n  * Make sure to use full sentences with correct case and punctuation, for example: \"Fix issue with non-ascii contents in doctest text files.\"\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5927/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5927/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5925", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5925/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5925/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5925/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5925", "id": 957551553, "node_id": "MDU6SXNzdWU5NTc1NTE1NTM=", "number": 5925, "title": "ValueError: year is out of range", "user": {"login": "TrueBrain", "id": 1663690, "node_id": "MDQ6VXNlcjE2NjM2OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1663690?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TrueBrain", "html_url": "https://github.com/TrueBrain", "followers_url": "https://api.github.com/users/TrueBrain/followers", "following_url": "https://api.github.com/users/TrueBrain/following{/other_user}", "gists_url": "https://api.github.com/users/TrueBrain/gists{/gist_id}", "starred_url": "https://api.github.com/users/TrueBrain/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TrueBrain/subscriptions", "organizations_url": "https://api.github.com/users/TrueBrain/orgs", "repos_url": "https://api.github.com/users/TrueBrain/repos", "events_url": "https://api.github.com/users/TrueBrain/events{/privacy}", "received_events_url": "https://api.github.com/users/TrueBrain/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-08-01T18:04:07Z", "updated_at": "2021-10-24T08:33:57Z", "closed_at": "2021-10-24T08:33:57Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nA bot is scanning one of my websites, and for some reason it is using this as header:\r\n\r\n`If-Modified-Since: Tue, 08 Oct 4446413 00:56:40 GMT`\r\n\r\nNot sure what the bot is smoking, but for sure that year is a bit odd. Now when I try `request.if_modified_since` `aiohttp` bails out with `ValueError: year 4447131 is out of range`.\r\n\r\nI am not completely sure if this is a bug you want to address in this library, or if I should just capture the `ValueError` and ignore the `if_modified_since` header with these kind of weird values, but I at least wanted to let you know about this issue.\r\n\n\n### To Reproduce\n\nGiven this server:\r\n```python\r\nfrom aiohttp import web\r\n\r\nasync def handle(request):\r\n    if_modified_since = request.if_modified_since\r\n    return web.Response(text=\"\")\r\n\r\napp = web.Application()\r\napp.add_routes([web.get('/', handle)])\r\nweb.run_app(app)\r\n```\r\n\r\nLaunch this curl against it:\r\n`curl -H \"If-Modified-Since: Tue, 08 Oct 4446413 00:56:40 GMT\" http://127.0.0.1:8080`\n\n### Expected behavior\n\nGraceful error, possibly even `None`, if the `If-Modified-Since` header cannot be parsed correctly.\n\n### Logs/tracebacks\n\n```python-traceback\nTraceback (most recent call last):\r\n  File \".env/lib/python3.8/site-packages/aiohttp/web_protocol.py\", line 422, in _handle_request\r\n    resp = await self._request_handler(request)\r\n  File \".env/lib/python3.8/site-packages/aiohttp/web_app.py\", line 499, in _handle\r\n    resp = await handler(request)\r\n  File \"demonstration.py\", line 4, in handle\r\n    if_modified_since = request.if_modified_since\r\n  File \"aiohttp/_helpers.pyx\", line 26, in aiohttp._helpers.reify.__get__\r\n  File \".env/lib/python3.8/site-packages/aiohttp/web_request.py\", line 484, in if_modified_since\r\n    return self._http_date(self.headers.get(hdrs.IF_MODIFIED_SINCE))\r\n  File \".env/lib/python3.8/site-packages/aiohttp/web_request.py\", line 475, in _http_date\r\n    return datetime.datetime(*timetuple[:6], tzinfo=datetime.timezone.utc)\r\nValueError: year 4446413 is out of range\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\nPython 3.8.5\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.4.post0\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: .env/lib/python3.8/site-packages\r\nRequires: async-timeout, attrs, multidict, yarl, typing-extensions, chardet\r\nRequired-by:\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.1.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: .env/lib/python3.8/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.3\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: .env/lib/python3.8/site-packages\r\nRequires: multidict, idna\r\nRequired-by: aiohttp\n```\n\n\n### OS\n\nLinux\n\n### Related component\n\nServer\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5925/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5925/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5905", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5905/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5905/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5905/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5905", "id": 949140465, "node_id": "MDU6SXNzdWU5NDkxNDA0NjU=", "number": 5905, "title": "Python 3.10 compatibility \u2014 deprecated loop argument for asnycio.sleep/gather calls", "user": {"login": "sbraz", "id": 4833332, "node_id": "MDQ6VXNlcjQ4MzMzMzI=", "avatar_url": "https://avatars.githubusercontent.com/u/4833332?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sbraz", "html_url": "https://github.com/sbraz", "followers_url": "https://api.github.com/users/sbraz/followers", "following_url": "https://api.github.com/users/sbraz/following{/other_user}", "gists_url": "https://api.github.com/users/sbraz/gists{/gist_id}", "starred_url": "https://api.github.com/users/sbraz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sbraz/subscriptions", "organizations_url": "https://api.github.com/users/sbraz/orgs", "repos_url": "https://api.github.com/users/sbraz/repos", "events_url": "https://api.github.com/users/sbraz/events{/privacy}", "received_events_url": "https://api.github.com/users/sbraz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "Hanaasagi", "id": 9482395, "node_id": "MDQ6VXNlcjk0ODIzOTU=", "avatar_url": "https://avatars.githubusercontent.com/u/9482395?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Hanaasagi", "html_url": "https://github.com/Hanaasagi", "followers_url": "https://api.github.com/users/Hanaasagi/followers", "following_url": "https://api.github.com/users/Hanaasagi/following{/other_user}", "gists_url": "https://api.github.com/users/Hanaasagi/gists{/gist_id}", "starred_url": "https://api.github.com/users/Hanaasagi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Hanaasagi/subscriptions", "organizations_url": "https://api.github.com/users/Hanaasagi/orgs", "repos_url": "https://api.github.com/users/Hanaasagi/repos", "events_url": "https://api.github.com/users/Hanaasagi/events{/privacy}", "received_events_url": "https://api.github.com/users/Hanaasagi/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "Hanaasagi", "id": 9482395, "node_id": "MDQ6VXNlcjk0ODIzOTU=", "avatar_url": "https://avatars.githubusercontent.com/u/9482395?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Hanaasagi", "html_url": "https://github.com/Hanaasagi", "followers_url": "https://api.github.com/users/Hanaasagi/followers", "following_url": "https://api.github.com/users/Hanaasagi/following{/other_user}", "gists_url": "https://api.github.com/users/Hanaasagi/gists{/gist_id}", "starred_url": "https://api.github.com/users/Hanaasagi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Hanaasagi/subscriptions", "organizations_url": "https://api.github.com/users/Hanaasagi/orgs", "repos_url": "https://api.github.com/users/Hanaasagi/repos", "events_url": "https://api.github.com/users/Hanaasagi/events{/privacy}", "received_events_url": "https://api.github.com/users/Hanaasagi/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 5, "created_at": "2021-07-20T22:02:03Z", "updated_at": "2021-08-03T18:39:22Z", "closed_at": "2021-08-03T18:39:22Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nHi,\r\nTests currently fail with Python 3.10 beta 4 because the loop attribute was removed.\r\n\r\n### To Reproduce\r\n\r\nRun tests with Python 3.10.\r\n\r\n### Expected behavior\r\n\r\nTests pass.\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nto_cancel = {<Task pending name='Task-1' coro=<_run_app() running at /var/tmp/portage/dev-python/aiohttp-3.7.4-r2/work/aiohttp-3.7.4-python3_10/lib/aiohttp/web.py:429> wait_for=<Future cancelled>>}\r\nloop = <_UnixSelectorEventLoop running=False closed=False debug=False>                                                                                                                                             \r\n                                                                                                                                                                                                                   \r\n    def _cancel_tasks(                                                                                   \r\n        to_cancel: Set[\"asyncio.Task[Any]\"], loop: asyncio.AbstractEventLoop                             \r\n    ) -> None:                                                                                                                                                                                                     \r\n        if not to_cancel:                                                                                \r\n            return                                                                                                                                                                                                 \r\n                                                                                                         \r\n        for task in to_cancel:                                                                           \r\n            task.cancel()                                                                                \r\n                                                                                                         \r\n        loop.run_until_complete(                                                                         \r\n>           asyncio.gather(*to_cancel, loop=loop, return_exceptions=True)                                \r\n        )                                                                                                                                                                                                          \r\nE       TypeError: gather() got an unexpected keyword argument 'loop'                                    \r\n\r\nself = <test_locks.TestEventResultOrError object at 0x7f49d37cfd00>, loop = <_UnixSelectorEventLoop running=False closed=False debug=False>                                                                        \r\n                                                                                                                                                                                                                   \r\n    async def test_cancel_waiters(self, loop) -> None:\r\n        ev = EventResultOrError(loop=loop)                                                                                                                                                                         \r\n                                                                                                                                                                                                                   \r\n        async def c():                                                                                   \r\n            await ev.wait()                                                                                                                                                                                        \r\n                                                                                                                                                                                                                   \r\n        t1 = loop.create_task(c())                                                                       \r\n        t2 = loop.create_task(c())                                                                                                                                                                                 \r\n>       await asyncio.sleep(0, loop=loop)                                                                                                                                                                          \r\nE       TypeError: sleep() got an unexpected keyword argument 'loop'                                                                                                                                               \r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n$ python --version\r\nPython 3.10.0b4\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.4\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/lib/python3.9/site-packages\r\nRequires: attrs, chardet, multidict, async-timeout, yarl, typing-extensions\r\nRequired-by: Electrum, aiohttp-socks\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.1.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/lib/python3.10/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.3\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/lib/python3.9/site-packages\r\nRequires: multidict, idna\r\nRequired-by: aiohttp\r\n```\r\n\r\n\r\n### OS\r\n\r\nGentoo unstable amd64.\r\n\r\n### Related component\r\n\r\nServer, Client\r\n\r\n### Additional context\r\n\r\nThis seems to fix the tests but I don't know asyncio well enough to be sure that this is the right fix. It also lacks fixes for `examples/legacy/crawl.py` which also uses the deprecated argument.\r\n```diff\r\ncommit ec87d9f2b6541599dd7fc8aaebf0fdfbb812ade7\r\nAuthor: Louis Sautier <sautier.louis@gmail.com>\r\nDate:   Tue Jul 20 23:37:27 2021 +0200\r\n\r\n    Remove deprecated loop argument from asyncio.sleep/gather calls\r\n\r\ndiff --git a/aiohttp/web.py b/aiohttp/web.py\r\nindex 557e3c3b..52dfdf93 100644\r\n--- a/aiohttp/web.py\r\n+++ b/aiohttp/web.py\r\n@@ -441,7 +441,7 @@ def _cancel_tasks(\r\n         task.cancel()\r\n \r\n     loop.run_until_complete(\r\n-        asyncio.gather(*to_cancel, loop=loop, return_exceptions=True)\r\n+        asyncio.gather(*to_cancel, return_exceptions=True)\r\n     )\r\n \r\n     for task in to_cancel:\r\ndiff --git a/tests/test_locks.py b/tests/test_locks.py\r\nindex 55fd2330..5f434eac 100644\r\n--- a/tests/test_locks.py\r\n+++ b/tests/test_locks.py\r\n@@ -18,7 +18,7 @@ class TestEventResultOrError:\r\n             return 1\r\n \r\n         t = loop.create_task(c())\r\n-        await asyncio.sleep(0, loop=loop)\r\n+        await asyncio.sleep(0)\r\n         e = Exception()\r\n         ev.set(exc=e)\r\n         assert (await t) == e\r\n@@ -31,7 +31,7 @@ class TestEventResultOrError:\r\n             return 1\r\n \r\n         t = loop.create_task(c())\r\n-        await asyncio.sleep(0, loop=loop)\r\n+        await asyncio.sleep(0)\r\n         ev.set()\r\n         assert (await t) == 1\r\n \r\n@@ -43,7 +43,7 @@ class TestEventResultOrError:\r\n \r\n         t1 = loop.create_task(c())\r\n         t2 = loop.create_task(c())\r\n-        await asyncio.sleep(0, loop=loop)\r\n+        await asyncio.sleep(0)\r\n         ev.cancel()\r\n         ev.set()\r\n \r\ndiff --git a/tests/test_proxy_functional.py b/tests/test_proxy_functional.py\r\nindex 68763cd4..65c773a1 100644\r\n--- a/tests/test_proxy_functional.py\r\n+++ b/tests/test_proxy_functional.py\r\n@@ -238,7 +238,7 @@ async def test_proxy_http_multi_conn_limit(proxy_test_server, loop) -> None:\r\n         resp = await sess.get(url, proxy=proxy.url)\r\n \r\n         current_pid = pid\r\n-        await asyncio.sleep(0.2, loop=loop)\r\n+        await asyncio.sleep(0.2)\r\n         assert current_pid == pid\r\n \r\n         await resp.release()\r\n@@ -443,7 +443,7 @@ async def xtest_proxy_https_multi_conn_limit(proxy_test_server, loop):\r\n         resp = await sess.get(url, proxy=proxy.url)\r\n \r\n         current_pid = pid\r\n-        await asyncio.sleep(0.2, loop=loop)\r\n+        await asyncio.sleep(0.2)\r\n         assert current_pid == pid\r\n \r\n         await resp.release()\r\n```\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5905/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5905/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5904", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5904/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5904/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5904/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5904", "id": 948971829, "node_id": "MDU6SXNzdWU5NDg5NzE4Mjk=", "number": 5904, "title": "stripping `\\t` from urls", "user": {"login": "iscai-msft", "id": 43154838, "node_id": "MDQ6VXNlcjQzMTU0ODM4", "avatar_url": "https://avatars.githubusercontent.com/u/43154838?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iscai-msft", "html_url": "https://github.com/iscai-msft", "followers_url": "https://api.github.com/users/iscai-msft/followers", "following_url": "https://api.github.com/users/iscai-msft/following{/other_user}", "gists_url": "https://api.github.com/users/iscai-msft/gists{/gist_id}", "starred_url": "https://api.github.com/users/iscai-msft/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iscai-msft/subscriptions", "organizations_url": "https://api.github.com/users/iscai-msft/orgs", "repos_url": "https://api.github.com/users/iscai-msft/repos", "events_url": "https://api.github.com/users/iscai-msft/events{/privacy}", "received_events_url": "https://api.github.com/users/iscai-msft/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 13, "created_at": "2021-07-20T19:06:02Z", "updated_at": "2021-07-22T17:20:58Z", "closed_at": "2021-07-22T17:20:57Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\naiohttp is stripping `\\t` from our tsv formatted URLs. For example, when I give aiohttp a url in the following format `http://localhost:3000/...\\tbegin...end\\t\\t`, when it [creates a URL object](https://github.com/aio-libs/aiohttp/blob/master/aiohttp/client.py#L366) out of my string, the `\\t` portions of the URL are stripped, and this information is no longer there when it makes it's way to the server\n\n### To Reproduce\n\n1. Send a request to a url with `\\t` in it, and during the call to `async def _request` when it creates a URL object, the `\\t` is stripped out\n\n### Expected behavior\n\nI would expect the `\\t`s to stay in the URL, this is the behavior I'm getting from requests\n\n### Logs/tracebacks\n\n```python-traceback\nI'm debugging, but the code that's getting rid of the `\\t` is the code that creates the URL object https://github.com/aio-libs/aiohttp/blob/master/aiohttp/client.py#L366\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\n3.9.5\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\n3.7.4.post0\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\n5.1.0\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\n1.6.3\n```\n\n\n### OS\n\nmacOS\n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5904/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5904/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5902", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5902/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5902/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5902/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5902", "id": 948323189, "node_id": "MDU6SXNzdWU5NDgzMjMxODk=", "number": 5902, "title": "Streamed response truncated on Alpine 3.13/3.14", "user": {"login": "dannmartens", "id": 263133, "node_id": "MDQ6VXNlcjI2MzEzMw==", "avatar_url": "https://avatars.githubusercontent.com/u/263133?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dannmartens", "html_url": "https://github.com/dannmartens", "followers_url": "https://api.github.com/users/dannmartens/followers", "following_url": "https://api.github.com/users/dannmartens/following{/other_user}", "gists_url": "https://api.github.com/users/dannmartens/gists{/gist_id}", "starred_url": "https://api.github.com/users/dannmartens/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dannmartens/subscriptions", "organizations_url": "https://api.github.com/users/dannmartens/orgs", "repos_url": "https://api.github.com/users/dannmartens/repos", "events_url": "https://api.github.com/users/dannmartens/events{/privacy}", "received_events_url": "https://api.github.com/users/dannmartens/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2021-07-20T06:31:37Z", "updated_at": "2021-07-21T15:56:19Z", "closed_at": "2021-07-21T11:05:20Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nThe stream from the response is truncated, systematically when running on Alpine 3.13/3.14. \r\n\r\nThe code is developed on Ubuntu 20.04.1 LTS where this issue does *not* occur.\r\n\r\nThe read content lengths do not correspond to the actual file sizes.\r\n\r\n### To Reproduce\r\n\r\nAll three strategies fail:\r\n\r\n# 1\r\n```\r\nasync for chunk in client_response.content.iter_chunked(config.CHUNK_SIZE):\r\n    yield chunk\r\n```\r\n# 2\r\n```\r\nbreaker = 3\r\nwhile True:\r\n    chunk = await client_response.content.read(config.CHUNK_SIZE)\r\n    print(f'CHUNK path={parsed_url.path} len={len(chunk)}')\r\n    if not chunk:\r\n        # (!) For observation only, logging empty streams (see logs)\r\n        breaker -= 1\r\n        if breaker == 0:\r\n            break\r\n    yield chunk\r\n```\r\n# 3\r\n```\r\nasync for chunk, end_of_http_chunk in client_response.content.iter_chunks():\r\n    yield chunk\r\n    if not end_of_http_chunk:\r\n        continue\r\n```\r\n### Expected behavior\r\n\r\nReading the response directly does not truncate:\r\n```\r\nentity = await client_response.read()\r\n```\r\nThis is the expected behaviour, but this incurs a performance penalty. \r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nThis is the output with the 'breaker' counter from strategy # 2\r\n\r\n2021-07-20 06:12:22,157 [DEBUG] proxy - Streaming http://192.168.8.1:3000/static/js/bundle.js\r\n2021-07-20 06:12:22,161 [DEBUG] proxy - Streaming http://192.168.8.1:3000/static/js/vendors~main.chunk.js for None\r\nCHUNK path=/static/js/bundle.js len=7066\r\nCHUNK path=/static/js/bundle.js len=0\r\nCHUNK path=/static/js/bundle.js len=0\r\nCHUNK path=/static/js/bundle.js len=0\r\nCHUNK path=/static/js/vendors~main.chunk.js len=14272\r\nCHUNK path=/static/js/vendors~main.chunk.js len=65536\r\nCHUNK path=/static/js/vendors~main.chunk.js len=2112\r\nCHUNK path=/static/js/vendors~main.chunk.js len=16384\r\n2021-07-20 06:12:22,209 [DEBUG] proxy - Streaming http://192.168.8.1:3000/static/js/main.chunk.js\r\nCHUNK path=/static/js/main.chunk.js len=14273\r\nCHUNK path=/static/js/main.chunk.js len=20841\r\nCHUNK path=/static/js/main.chunk.js len=0\r\nCHUNK path=/static/js/main.chunk.js len=0\r\nCHUNK path=/static/js/main.chunk.js len=0\r\n2021-07-20 06:12:22,300 [DEBUG] proxy - Streaming http://192.168.8.1:3000/manifest.json\r\n2021-07-20 06:12:22,302 [DEBUG] proxy - Streaming http://192.168.8.1:3000/assets/logo.svg\r\nCHUNK path=/manifest.json len=517\r\nCHUNK path=/manifest.json len=0\r\nCHUNK path=/manifest.json len=0\r\nCHUNK path=/manifest.json len=0\r\nCHUNK path=/assets/logo.svg len=906\r\nCHUNK path=/assets/logo.svg len=0\r\nCHUNK path=/assets/logo.svg len=0\r\nCHUNK path=/assets/logo.svg len=0\r\n2021-07-20 06:12:22,326 [DEBUG] proxy - Streaming http://192.168.8.1:3000/logo192.png\r\nCHUNK path=/logo192.png len=4153\r\nCHUNK path=/logo192.png len=0\r\nCHUNK path=/logo192.png len=0\r\nCHUNK path=/logo192.png len=0\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\nOn Ubuntu 20.04: 3.8.5\r\nOn Alpine 3.13: 3.8.11\r\nOn Alpine 3.14: 3.9.6\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\nName: aiohttp\r\nVersion: 3.7.4.post0\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/vagrant/.local/lib/python3.8/site-packages\r\nRequires: yarl, multidict, attrs, typing-extensions, async-timeout, charde\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\nName: multidict\r\nVersion: 5.1.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/vagrant/.local/lib/python3.8/site-packages\r\nRequires:\r\nRequired-by: yarl, aiohttp\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\nName: yarl\r\nVersion: 1.6.3\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/vagrant/.local/lib/python3.8/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\r\n### OS\r\n\r\nAlpine 3.13 and Alpine 3.14\r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\nawait content.read() reads partial content under high load #3881\r\nStreamReader.read truncates content #3926\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5902/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5902/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5901", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5901/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5901/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5901/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5901", "id": 947711833, "node_id": "MDU6SXNzdWU5NDc3MTE4MzM=", "number": 5901, "title": "resolver.py/ThreadResolver: address[3] does not exist", "user": {"login": "dilyanpalauzov", "id": 4992947, "node_id": "MDQ6VXNlcjQ5OTI5NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4992947?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dilyanpalauzov", "html_url": "https://github.com/dilyanpalauzov", "followers_url": "https://api.github.com/users/dilyanpalauzov/followers", "following_url": "https://api.github.com/users/dilyanpalauzov/following{/other_user}", "gists_url": "https://api.github.com/users/dilyanpalauzov/gists{/gist_id}", "starred_url": "https://api.github.com/users/dilyanpalauzov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dilyanpalauzov/subscriptions", "organizations_url": "https://api.github.com/users/dilyanpalauzov/orgs", "repos_url": "https://api.github.com/users/dilyanpalauzov/repos", "events_url": "https://api.github.com/users/dilyanpalauzov/events{/privacy}", "received_events_url": "https://api.github.com/users/dilyanpalauzov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1831255463, "node_id": "MDU6TGFiZWwxODMxMjU1NDYz", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/reproducer:%20missing", "name": "reproducer: missing", "color": "e23c36", "default": false, "description": "This PR or issue lacks code, which reproduce the problem described or clearly understandable STR"}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-07-19T14:26:28Z", "updated_at": "2021-07-19T20:44:12Z", "closed_at": "2021-07-19T18:19:10Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "### Describe the bug\n\nAs outlined at https://github.com/pimutils/vdirsyncer/issues/916, I use python 3.8 with aiohttp 3.8 branch (v3.7.4.post0-209-g22f8be99) .  In aiohttp/resolver.py:ThreadedResolver the line\r\n>    if family == socket.AF_INET6 and address[3]:  # type: ignore[misc]\r\n\r\nfails, as address has only two elements and address[3] is out of range.\r\n\r\nThe values of adress are:\r\n> AddressFamily.AF_INET ('142.250.185.238', 443)\r\n> AddressFamily.AF_INET6 (10, b'\\x01\\xbb\\x00\\x00\\x00\\x00*\\x00\\x14P@\\x01\\x08\\x13')\r\n\r\n\r\nThe system is not connected to IPv6, no routes, no iPv6 addressese etc, but the kernel understands IPv6.  I fixed it locally with:\r\n```diff\r\ndiff --git a/aiohttp/resolver.py b/aiohttp/resolver.py\r\nindex 2161c8fa..4e57b319 100644\r\n--- a/aiohttp/resolver.py\r\n+++ b/aiohttp/resolver.py\r\n@@ -38,16 +38,7 @@ class ThreadedResolver(AbstractResolver):\r\n \r\n         hosts = []\r\n         for family, _, proto, _, address in infos:\r\n-            if family == socket.AF_INET6 and address[3]:  # type: ignore[misc]\r\n-                # This is essential for link-local IPv6 addresses.\r\n-                # LL IPv6 is a VERY rare case. Strictly speaking, we should use\r\n-                # getnameinfo() unconditionally, but performance makes sense.\r\n-                host, _port = socket.getnameinfo(\r\n-                    address, socket.NI_NUMERICHOST | socket.NI_NUMERICSERV\r\n-                )\r\n-                port = int(_port)\r\n-            else:\r\n-                host, port = address[:2]\r\n+            host, port = address[:2]\r\n             hosts.append(\r\n                 {\r\n                     \"hostname\": hostname,\r\n```\n\n### To Reproduce\n\nSee above.\n\n### Expected behavior\n\nShall not read address[3], when address[3] does not exist.\n\n### Logs/tracebacks\n\n```python-traceback\nNot applicable.\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\n\r\nPython 3.8.8+\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\n\r\n3.8.0a0\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\n5.1.0\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\n\r\n1.6.3\n```\n\n\n### OS\n\nLinux from Scratch, python 3.8.8+\n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5901/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5901/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5896", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5896/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5896/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5896/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5896", "id": 947061174, "node_id": "MDU6SXNzdWU5NDcwNjExNzQ=", "number": 5896, "title": "Any media type starting with application/json treated as JSON", "user": {"login": "scop", "id": 109152, "node_id": "MDQ6VXNlcjEwOTE1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/109152?v=4", "gravatar_id": "", "url": "https://api.github.com/users/scop", "html_url": "https://github.com/scop", "followers_url": "https://api.github.com/users/scop/followers", "following_url": "https://api.github.com/users/scop/following{/other_user}", "gists_url": "https://api.github.com/users/scop/gists{/gist_id}", "starred_url": "https://api.github.com/users/scop/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/scop/subscriptions", "organizations_url": "https://api.github.com/users/scop/orgs", "repos_url": "https://api.github.com/users/scop/repos", "events_url": "https://api.github.com/users/scop/events{/privacy}", "received_events_url": "https://api.github.com/users/scop/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-07-18T15:35:45Z", "updated_at": "2021-10-31T06:10:20Z", "closed_at": "2021-10-30T13:35:38Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Describe the bug\n\nAny media type that starts with `application/json` is treated as JSON. This treatment should be limited to `application/json` and types with `+json` media type suffix. An example of a registered media type that triggers this problem is https://www.iana.org/assignments/media-types/application/json-seq\n\n### To Reproduce\n\nPR #5895 has a failing test case.\n\n### Expected behavior\n\nNot anything that begins with `application/json` should be treated as JSON.\n\n### Logs/tracebacks\n\n```python-traceback\n-\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\nPython 3.9.6\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\nWARNING: Package(s) not found: aiohttp\r\n\r\n(current git master)\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.1.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/scop/.pyenv/versions/3.9.6/envs/aiohttp/lib/python3.9/site-packages\r\nRequires: \r\nRequired-by: yarl\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nVersion: 1.6.3\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/scop/.pyenv/versions/3.9.6/envs/aiohttp/lib/python3.9/site-packages\r\nRequires: multidict, idna\r\nRequired-by:\n```\n\n\n### OS\n\nAny\n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5896/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5896/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5868", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5868/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5868/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5868/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5868", "id": 940577048, "node_id": "MDU6SXNzdWU5NDA1NzcwNDg=", "number": 5868, "title": "WebSocket client does not support query component", "user": {"login": "hoh", "id": 404665, "node_id": "MDQ6VXNlcjQwNDY2NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/404665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hoh", "html_url": "https://github.com/hoh", "followers_url": "https://api.github.com/users/hoh/followers", "following_url": "https://api.github.com/users/hoh/following{/other_user}", "gists_url": "https://api.github.com/users/hoh/gists{/gist_id}", "starred_url": "https://api.github.com/users/hoh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hoh/subscriptions", "organizations_url": "https://api.github.com/users/hoh/orgs", "repos_url": "https://api.github.com/users/hoh/repos", "events_url": "https://api.github.com/users/hoh/events{/privacy}", "received_events_url": "https://api.github.com/users/hoh/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-07-09T09:11:58Z", "updated_at": "2021-10-30T13:33:56Z", "closed_at": "2021-10-30T13:33:56Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Describe the bug\n\nAccording to [rfc6455 section 11.1.1](https://datatracker.ietf.org/doc/html/rfc6455#section-11.1.1), a \"ws\" URI Scheme supports a query component with the URI scheme syntax `\"ws:\" \"//\" authority path-abempty [ \"?\" query ]`.\r\n\r\nWhile the query component can be defined in `ClienSession.request` using the `params` argument, this argument is absent from `ClientSession.ws_connect`. \r\n\r\nThis requires users of `ws_connect` to build and embed the query component in the `url` agument  of `ws_connect.\n\n### To Reproduce\n\nTry running the following example:\r\n\r\n```python\r\nasync def main():\r\n    params = {'key1': 'value1', 'key2': 'value2'}\r\n    async with aiohttp.ClientSession() as session:\r\n        async with session.ws_connect('http://example.org/ws', params=params) as ws:\r\n            async for msg in ws:\r\n                if msg.type == aiohttp.WSMsgType.TEXT:\r\n                    if msg.data == 'close cmd':\r\n                        await ws.close()\r\n                        break\r\n                    else:\r\n                        await ws.send_str(msg.data + '/answer')\r\n                elif msg.type == aiohttp.WSMsgType.ERROR:\r\n                    break\r\n                    \r\nimport asyncio, aiohttp\r\nasyncio.run(main())\r\n```\n\n### Expected behavior\n\nThe expected result is a response for the url `http://example.org/ws?key1=value1&key2=value2`.\r\n\r\nUsing the example target, this would give:\r\n```\r\nTraceback (most recent call last):\r\n  File \"<input>\", line 1, in <module>\r\n  File \"/usr/lib/python3.8/asyncio/runners.py\", line 44, in run\r\n    return loop.run_until_complete(main)\r\n  File \"/usr/lib/python3.8/asyncio/base_events.py\", line 616, in run_until_complete\r\n    return future.result()\r\n  File \"<input>\", line 4, in do\r\n  File \"/home/hugo/Repos/Aleph/aiohttp/aiohttp/client.py\", line 1072, in __aenter__\r\n    self._resp = await self._coro\r\n  File \"/home/hugo/Repos/Aleph/aiohttp/aiohttp/client.py\", line 755, in _ws_connect\r\n    raise WSServerHandshakeError(\r\naiohttp.client_exceptions.WSServerHandshakeError: 404, message='Invalid response status', url=URL('http://example.org/ws?key1=value1&key2=value2')\r\n```\n\n### Logs/tracebacks\n\n```python-traceback\nTraceback (most recent call last):\r\n  File \"<input>\", line 1, in <module>\r\n  File \"/usr/lib/python3.8/asyncio/runners.py\", line 44, in run\r\n    return loop.run_until_complete(main)\r\n  File \"/usr/lib/python3.8/asyncio/base_events.py\", line 616, in run_until_complete\r\n    return future.result()\r\n  File \"<input>\", line 4, in do\r\nTypeError: ws_connect() got an unexpected keyword argument 'params'\r\n```\n```\n\n\n### Python Version\n\n```console\nPython 3.8.8\n```\n\n\n### aiohttp Version\n\n```console\naiohttp master on commit 3d73221072c350d973b2fb0c54c78ad30863d433\n```\n\n\n### multidict Version\n\n```console\nName: multidict\r\nVersion: 5.1.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /opt/venv/aiohttp/lib/python3.8/site-packages\r\nRequires: \r\nRequired-by: yarl\n```\n\n\n### yarl Version\n\n```console\nName: yarl\r\nVersion: 1.6.3\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /opt/venv/aiohttp/lib/python3.8/site-packages\r\nRequires: multidict, idna\r\nRequired-by:\n```\n\n\n### OS\n\nLinux 5.10.0-7-amd64 #1 SMP Debian 5.10.40-1 (2021-05-28) x86_64 GNU/Linux\r\n\n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5868/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5868/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5856", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5856/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5856/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5856/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5856", "id": 936539013, "node_id": "MDU6SXNzdWU5MzY1MzkwMTM=", "number": 5856, "title": "Fail to downloading large enough file from aiohttp based server", "user": {"login": "iradization", "id": 29353915, "node_id": "MDQ6VXNlcjI5MzUzOTE1", "avatar_url": "https://avatars.githubusercontent.com/u/29353915?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iradization", "html_url": "https://github.com/iradization", "followers_url": "https://api.github.com/users/iradization/followers", "following_url": "https://api.github.com/users/iradization/following{/other_user}", "gists_url": "https://api.github.com/users/iradization/gists{/gist_id}", "starred_url": "https://api.github.com/users/iradization/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iradization/subscriptions", "organizations_url": "https://api.github.com/users/iradization/orgs", "repos_url": "https://api.github.com/users/iradization/repos", "events_url": "https://api.github.com/users/iradization/events{/privacy}", "received_events_url": "https://api.github.com/users/iradization/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2021-07-04T20:59:46Z", "updated_at": "2021-07-05T15:04:31Z", "closed_at": "2021-07-05T15:04:31Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nTrying to download a file of size greater than 65839, cause the http session to run for a long time without any new data being copied. \r\n\n\n### To Reproduce\n\ntake the following minimal server implementation \r\n\r\n```\r\nimport aiohttp\r\nfrom aiohttp import web, WSCloseCode\r\nimport asyncio\r\nimport os\r\n\r\nFILE_PATH = \"./upgrades/file.bin\"\r\nasync def http_post_handler(request):\r\n    with open(FILE_PATH, 'rb') as f:\r\n        fs = os.fstat(f.fileno())\r\n        headers = {\"Content-Type\": 'application/octet-stream',\r\n                   \"Content-Disposition\": 'attachment; filename=\"{}\"'.format(os.path.basename(FILE_PATH)),\r\n                   \"Content-Length\": str(fs.st_size)}\r\n\r\n        return web.Response(body=f.read(), headers=headers)\r\n\r\n\r\ndef create_runner():\r\n    app = web.Application()\r\n    app.add_routes([\r\n        web.post('/{post:.*}', http_post_handler),\r\n    ])\r\n    return web.AppRunner(app)\r\n\r\nasync def start_server(host=\"192.168.1.1\", port=44444):\r\n    runner = create_runner()\r\n    await runner.setup()\r\n    site = web.TCPSite(runner, host, port)\r\n    await site.start()\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    loop = asyncio.get_event_loop()\r\n    loop.run_until_complete(start_server())\r\n    loop.run_forever()\r\n```\r\n\r\nand on client side do : \r\n\r\n`curl -X POST \"http://192.168.1.1:44444/post/upgrade\" --output /tmp/121`\r\n\r\n--> once where the file size is above the limit which trigger the halt\r\n`dd if=original of=file.bin  bs=1 count=65840`\r\n\r\n--> and another before that limit. \r\n`dd if=original of=file.bin  bs=1 count=65839`\r\n\r\nNotice that if the client will run on the same machine as the server listen to address 0.0.0.0 and client connect to loopback address, the problem wouldn't occur and both actions will terminate successfully in an instant. \r\n\r\nPerhaps it's the file size exceed threshold of http message ? but i'd expect that even in this case, the file will be split to chunks and will be able to download. \n\n### Expected behavior\n\nI except the operation to work on file size above the threshold of 65839\n\n### Logs/tracebacks\n\n```python-traceback\nirrelevant\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\nPython 3.9.5\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.4.post0\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/local/lib/python3.9/site-packages\r\nRequires: async-timeout, chardet, yarl, typing-extensions, attrs, multidict\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.1.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/local/lib/python3.9/site-packages\r\nRequires:\r\nRequired-by: yarl, aiohttp\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.3\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/local/lib/python3.9/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\n```\n\n\n### OS\n\nmacOS 11.4 (BigSur)\n\n### Related component\n\nServer\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5856/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5856/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5851", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5851/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5851/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5851/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5851", "id": 936292355, "node_id": "MDU6SXNzdWU5MzYyOTIzNTU=", "number": 5851, "title": "unexpected asyncio.exceptions.CancelledError", "user": {"login": "vitidev", "id": 2243958, "node_id": "MDQ6VXNlcjIyNDM5NTg=", "avatar_url": "https://avatars.githubusercontent.com/u/2243958?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vitidev", "html_url": "https://github.com/vitidev", "followers_url": "https://api.github.com/users/vitidev/followers", "following_url": "https://api.github.com/users/vitidev/following{/other_user}", "gists_url": "https://api.github.com/users/vitidev/gists{/gist_id}", "starred_url": "https://api.github.com/users/vitidev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vitidev/subscriptions", "organizations_url": "https://api.github.com/users/vitidev/orgs", "repos_url": "https://api.github.com/users/vitidev/repos", "events_url": "https://api.github.com/users/vitidev/events{/privacy}", "received_events_url": "https://api.github.com/users/vitidev/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-07-03T17:04:47Z", "updated_at": "2021-10-23T16:33:50Z", "closed_at": "2021-10-23T16:33:50Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nSometimes after raising `asyncio.exceptions.TimeoutError` next awaits of coroutines causes `asyncio.exceptions.CancelledError`\r\n\r\n### To Reproduce\r\n\r\nEmulate server with random timeouts\r\n\r\n```python\r\nimport asyncio\r\nimport datetime\r\nimport random\r\nfrom aiohttp import web\r\n\r\nasync def uptime_handler(request):\r\n    chance = random.randint(1, 4)\r\n    if chance == 0:\r\n        await asyncio.sleep(50)\r\n        return\r\n    response = web.StreamResponse()\r\n    response.headers['Content-Type'] = 'text/html'\r\n    await response.prepare(request)\r\n\r\n    for i in range(100000):\r\n        formatted_date = datetime.datetime.now().strftime(\"%Y-%m-%d %H:%M:%S\")\r\n        message = f'{formatted_date}<br>'\r\n        await response.write(message.encode('utf-8'))\r\n        await asyncio.sleep(0.01)\r\n\r\nif __name__ == '__main__':\r\n    app = web.Application()\r\n    app.add_routes([ web.get('/', uptime_handler),])\r\n    web.run_app(app)\r\n```\r\n\r\nand a client that \"downloads files\" in parallel\r\n\r\n```python\r\nimport asyncio\r\nimport random\r\nimport traceback\r\n\r\nimport aiohttp\r\n\r\nURL = 'http://127.0.0.1:8080/'\r\n\r\n__http__: aiohttp.ClientSession = None\r\n__semaphore__: asyncio.Semaphore = None\r\n\r\nasync def download_file(client, url: str):\r\n    try:\r\n        r = await client.get(url, timeout=random.randint(5, 15))\r\n        async for data in r.content.iter_chunked(8192):\r\n            await asyncio.sleep(0.01)\r\n        stub = 2 + 2\r\n        foo = \"bar\"  # garbage code\r\n    except asyncio.exceptions.TimeoutError:\r\n        try:\r\n            print(f'catch TIMEOUT in download_file')\r\n            await asyncio.sleep(5)\r\n        except asyncio.exceptions.CancelledError:\r\n            print('ALARM ' + traceback.format_exc())\r\n\r\nasync def _download(client, idx) -> int:\r\n    try:\r\n        for i in range(10):\r\n            print(f'{idx} start')\r\n            try:\r\n                await download_file(client, URL)\r\n            except aiohttp.client.ClientPayloadError:\r\n                break\r\n    except BaseException as e:\r\n        print('**********' + traceback.format_exc())\r\n    finally:\r\n        print(f'{idx} finish')\r\n        __semaphore__.release()\r\n    return idx\r\n\r\nasync def main():\r\n    global __semaphore__\r\n    __semaphore__ = asyncio.BoundedSemaphore(10)\r\n    async with aiohttp.ClientSession()as client:\r\n        i = 0\r\n        while True:\r\n            i += 1\r\n            await __semaphore__.acquire()\r\n            asyncio.ensure_future(_download(client, i % 10))\r\n\r\nif __name__ == '__main__':\r\n    asyncio.run(main())\r\n\r\n```\r\n\r\n### Expected behavior\r\n\r\nawait asyncio.sleep() in TimeoutError handler should not throw `asyncio.exceptions.CancelledError`, because no one cancels this coroutine. We should never see `ALARM` in output.\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\n1 start\r\n...\r\n0 start\r\ncatch TIMEOUT in download_file\r\ncatch TIMEOUT in download_file\r\ncatch TIMEOUT in download_file\r\n8 start\r\n...\r\n0 start\r\ncatch TIMEOUT in download_file\r\ncatch TIMEOUT in download_file\r\nALARM Traceback (most recent call last):\r\n  File \"F:\\dev\\test\\asynciotest\\test_sleep3.9.py\", line 15, in download_file\r\n    async for data in r.content.iter_chunked(8192):\r\n  File \"C:\\Python\\lib\\site-packages\\aiohttp\\streams.py\", line 39, in __anext__\r\n    rv = await self.read_func()\r\n  File \"C:\\Python\\lib\\site-packages\\aiohttp\\streams.py\", line 380, in read\r\n    await self._wait(\"read\")\r\n  File \"C:\\Python\\lib\\site-packages\\aiohttp\\streams.py\", line 305, in _wait\r\n    with self._timer:\r\n  File \"C:\\Python\\lib\\site-packages\\aiohttp\\helpers.py\", line 641, in __enter__\r\n    raise asyncio.TimeoutError from None\r\nasyncio.exceptions.TimeoutError\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"F:\\dev\\test\\asynciotest\\test_sleep3.9.py\", line 22, in download_file\r\n    await asyncio.sleep(5)\r\n  File \"C:\\Python\\lib\\asyncio\\tasks.py\", line 654, in sleep\r\n    return await future\r\nasyncio.exceptions.CancelledError\r\n\r\n3 start\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n$ python --version\r\nPython 3.7.9\r\nPython 3.9.5\r\nPython 3.9.6\r\nPython 3.8.3\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.4.post0\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\python\\lib\\site-packages\r\nRequires: chardet, typing-extensions, attrs, async-timeout, multidict, yarl\r\nRequired-by: aiohttp-proxy, aiocfscrape\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.1.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\python\\lib\\site-packages\r\nRequires:\r\nRequired-by: yarl, aiohttp\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.3\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\python\\lib\\site-packages\r\nRequires: multidict, idna\r\nRequired-by: aiohttp, aiohttp-proxy\r\n```\r\n\r\n\r\n### OS\r\n\r\nWin10x64 (1909)\r\nCentos 8\r\n\r\n### Related component\r\n\r\nClient\r\n\r\n### Additional context\r\n\r\nI'm not sure if this is a aiohttp issue, because if remove `await ...` from `async for`-scope, then the side effect magically disappears, but I already excluded `aiorun` and `aiofiles` and it's time for `aiohttp`\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5851/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5851/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5846", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5846/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5846/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5846/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5846", "id": 934420189, "node_id": "MDU6SXNzdWU5MzQ0MjAxODk=", "number": 5846, "title": "Download speed cannot be over a specific rate when concurrency number is over 9", "user": {"login": "meow-watermelon", "id": 16482594, "node_id": "MDQ6VXNlcjE2NDgyNTk0", "avatar_url": "https://avatars.githubusercontent.com/u/16482594?v=4", "gravatar_id": "", "url": "https://api.github.com/users/meow-watermelon", "html_url": "https://github.com/meow-watermelon", "followers_url": "https://api.github.com/users/meow-watermelon/followers", "following_url": "https://api.github.com/users/meow-watermelon/following{/other_user}", "gists_url": "https://api.github.com/users/meow-watermelon/gists{/gist_id}", "starred_url": "https://api.github.com/users/meow-watermelon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/meow-watermelon/subscriptions", "organizations_url": "https://api.github.com/users/meow-watermelon/orgs", "repos_url": "https://api.github.com/users/meow-watermelon/repos", "events_url": "https://api.github.com/users/meow-watermelon/events{/privacy}", "received_events_url": "https://api.github.com/users/meow-watermelon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2021-07-01T05:41:48Z", "updated_at": "2021-07-01T19:49:06Z", "closed_at": "2021-07-01T19:49:06Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nI have a HTTP client to download data. I noticed that when the concurrency number is less than 9, the total download speed rate is the same as what curl does with the same number of processes running, However, when the concurrency number is over 9, aiohttp client cannot over a specific speed rate, in my case it's ~115MB/sec. The client and server hosts are both using 10G NIC. \r\n\r\nI did use aiofiles to write data to /dev/null. And curl is also writing data to /dev/null. Here's the [code snippet](https://github.com/meow-watermelon/http_benchmarker/blob/main/http_benchmarker.py#L31-L38) that how my client is downloading data.\r\n\r\nIn summary, even I specify the concurrency number to 20, the total download speed is still at ~115MB/sec. But if I triggered 20 curl processes in parallel, I can see the total download speed is at linear speed easily. Both aiohttp and curl testing are within NIC bandwidth, no ethernet frame drop or errors.\n\n### To Reproduce\n\n1. Run 20 curl command to download the same large file(e.g. 1GB) to /dev/null in parallel. Simply using bash `for` loop to run those 20 curl commands background.\r\n2. Run the HTTP client [here](https://github.com/meow-watermelon/http_benchmarker/blob/main/http_benchmarker.py) to download the same file with the concurrency number 20.\r\n3. Compare both ethernet I/O usage. The curl example would show linear speed, but aiohttp client just shows ~115MB/sec ethernet IO usage. \n\n### Expected behavior\n\nI would expect what the download speed should be in linear when I bump up the concurrency number in aiohttp client, it should not be fixed at a specific speed.\n\n### Logs/tracebacks\n\n```python-traceback\nN/A\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\nPython 3.8.6\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\n3.7.4\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\n5.1.0\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\n1.6.3\n```\n\n\n### OS\n\nRHEL 7\n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5846/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5846/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5840", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5840/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5840/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5840/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5840", "id": 932950118, "node_id": "MDU6SXNzdWU5MzI5NTAxMTg=", "number": 5840, "title": "tests/test_formdata.py::test_mark_formdata_as_processed relies on external web server", "user": {"login": "derlih", "id": 254158, "node_id": "MDQ6VXNlcjI1NDE1OA==", "avatar_url": "https://avatars.githubusercontent.com/u/254158?v=4", "gravatar_id": "", "url": "https://api.github.com/users/derlih", "html_url": "https://github.com/derlih", "followers_url": "https://api.github.com/users/derlih/followers", "following_url": "https://api.github.com/users/derlih/following{/other_user}", "gists_url": "https://api.github.com/users/derlih/gists{/gist_id}", "starred_url": "https://api.github.com/users/derlih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/derlih/subscriptions", "organizations_url": "https://api.github.com/users/derlih/orgs", "repos_url": "https://api.github.com/users/derlih/repos", "events_url": "https://api.github.com/users/derlih/events{/privacy}", "received_events_url": "https://api.github.com/users/derlih/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-06-29T17:32:48Z", "updated_at": "2021-10-20T12:35:26Z", "closed_at": "2021-10-20T12:35:26Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Describe the bug\n\nThis test uses http://httpbin.org to send the request. If this server is not responding, the test will fail.\r\nActually I caught this problem in CI while I was working on a PR. This makes `aiohttp` CI not so reliable.\r\n\r\nhttps://github.com/postmanlabs/httpbin/issues/150#issuecomment-49462515\n\n### To Reproduce\n\nSometimes it just happen.\r\n\n\n### Expected behavior\n\nUse local instance of httpbin or use aiohttp test server if possible.\n\n### Logs/tracebacks\n\n```python-traceback\nn/a\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\nPython 3.8.5\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 4.0.0a1\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/dmitry/Sources/aiohttp\r\nRequires: chardet, multidict, async-timeout, yarl, typing-extensions, frozenlist, aiosignal\r\nRequired-by:\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.1.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/dmitry/Sources/aiohttp/venv/lib/python3.8/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.3\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/dmitry/Sources/aiohttp/venv/lib/python3.8/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\n```\n\n\n### OS\n\nubuntu 20.04\r\nbut happen in CI for mac \n\n### Related component\n\nClient\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5840/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5840/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5838", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5838/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5838/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5838/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5838", "id": 931930474, "node_id": "MDU6SXNzdWU5MzE5MzA0NzQ=", "number": 5838, "title": "Incorrect headers parsing", "user": {"login": "mashony", "id": 2342491, "node_id": "MDQ6VXNlcjIzNDI0OTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2342491?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mashony", "html_url": "https://github.com/mashony", "followers_url": "https://api.github.com/users/mashony/followers", "following_url": "https://api.github.com/users/mashony/following{/other_user}", "gists_url": "https://api.github.com/users/mashony/gists{/gist_id}", "starred_url": "https://api.github.com/users/mashony/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mashony/subscriptions", "organizations_url": "https://api.github.com/users/mashony/orgs", "repos_url": "https://api.github.com/users/mashony/repos", "events_url": "https://api.github.com/users/mashony/events{/privacy}", "received_events_url": "https://api.github.com/users/mashony/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2021-06-28T19:57:54Z", "updated_at": "2021-10-30T14:32:14Z", "closed_at": "2021-10-30T14:32:14Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nFaced with issue that if there is newline symbol (`\\n`) in headers `aiohttp` drops other headers in GET request. Seems like should be validation for custom headers when sending request. \r\nFor websocket connection this bug leads to handshake error `WSServerHandshakeError`.\r\n\r\nit's also possible to send extra data after new line which could be parsed by server as extra headers:\r\n```\r\n\"someheader\": \"some\\nsome: header\"\r\n```\r\n\r\nthis bug starts reproducing from `aiohttp==3.6.3; yarl==1.5.1; multidict==4.7.6` and could be reproduced with latest aiohtp version\r\neverything works as expected with `aiohttp==3.6.2` \r\n\r\n### To Reproduce\r\n\r\n1. Create simple client/server app (e.g. https://gist.github.com/mashony/cde3175da1e60d34d18cfe3a4669f41e)\r\n2. Send GET custom headers with `\\n` characters\r\n```\r\nheaders = {\r\n    \"SomeOtherHeader\": \"somecoolstr\",\r\n    \"CustomHeader\": \"somebrokenstr\\n\",\r\n    \"AHeader\": \"somecoolstr\",\r\n}\r\n```\r\n3. Print server`s request headers\r\n```\r\nRequest.headers {'Host': '0.0.0.0:8080', 'SomeOtherHeader': 'somecoolstr', 'CustomHeader': 'somebrokenstr'}\r\n```\r\n4. To reproduce handshake error for websocket connection use custom headers in ws_connect (e.g. https://gist.github.com/mashony/ea8891ffdd6457d18a853f61503e8a2b)\r\n\r\n### Expected behavior\r\n\r\nDo not drop headers after `\\n` characters. That should be parsed as `\"CustomHerder\": \"somebrokenstr\"` like it was so in 3.6.2 version\r\n\r\nOr raise validation error or warning message that tells about incorrect characters in headers or filter out such characters on client side\r\n\r\n### Logs/tracebacks\r\n\r\nclient\r\n```python-traceback\r\nWebsocket handshake error:\r\n\r\nTraceback (most recent call last):\r\n  File \"cli.py\", line 32, in <module>\r\n    loop.run_until_complete(main())\r\n  File \"python3.8/asyncio/base_events.py\", line 616, in run_until_complete\r\n    return future.result()\r\n  File \"cli.py\", line 19, in main\r\n    async with session.ws_connect(URL, headers=headers) as ws:\r\n  File \"python3.8/site-packages/aiohttp/client.py\", line 1014, in __aenter__\r\n    self._resp = await self._coro\r\n  File \"python3.8/site-packages/aiohttp/client.py\", line 723, in _ws_connect\r\n    resp = await self.request(method, url,\r\naiohttp.client_exceptions.WSServerHandshakeError: 400, message='Invalid response status', url=URL('ws://0.0.0.0:8080/ws')\r\n```\r\n\r\nserver\r\n```\r\nTraceback (most recent call last):\r\n  File \"python3.8/site-packages/aiohttp/web_protocol.py\", line 314, in data_received\r\n    messages, upgraded, tail = self._request_parser.feed_data(data)\r\n  File \"aiohttp/_http_parser.pyx\", line 546, in aiohttp._http_parser.HttpParser.feed_data\r\naiohttp.http_exceptions.BadStatusLine: 400, message=\"Bad status line 'invalid HTTP method'\"\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n$ python --version\r\nPython 3.8.5\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.4.post0\r\nSummary: Async http client/server framework (asyncio)\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.1.0\r\nSummary: multidict implementation\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.3\r\nSummary: Yet another URL library\r\n```\r\n\r\n\r\n### OS\r\n\r\nUbuntu 20.04.2 LTS\r\n\r\n### Related component\r\n\r\nServer, Client\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5838/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5838/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5833", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5833/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5833/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5833/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5833", "id": 930943627, "node_id": "MDU6SXNzdWU5MzA5NDM2Mjc=", "number": 5833, "title": "Flow controlled response blocks client connection reclamation", "user": {"login": "pbumbulis", "id": 525907, "node_id": "MDQ6VXNlcjUyNTkwNw==", "avatar_url": "https://avatars.githubusercontent.com/u/525907?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pbumbulis", "html_url": "https://github.com/pbumbulis", "followers_url": "https://api.github.com/users/pbumbulis/followers", "following_url": "https://api.github.com/users/pbumbulis/following{/other_user}", "gists_url": "https://api.github.com/users/pbumbulis/gists{/gist_id}", "starred_url": "https://api.github.com/users/pbumbulis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pbumbulis/subscriptions", "organizations_url": "https://api.github.com/users/pbumbulis/orgs", "repos_url": "https://api.github.com/users/pbumbulis/repos", "events_url": "https://api.github.com/users/pbumbulis/events{/privacy}", "received_events_url": "https://api.github.com/users/pbumbulis/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2021-06-27T14:24:10Z", "updated_at": "2022-02-10T19:17:21Z", "closed_at": "2021-06-27T18:25:35Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nIf the response from a server is large enough a client connection will not be reclaimed (until a timeout expires).\n\n### To Reproduce\n\nRun\r\n```\r\nfrom aiohttp import web\r\nimport aiohttp\r\n\r\nasync def big(request):\r\n    response = web.StreamResponse()\r\n    await response.prepare(request)\r\n    await response.write(500000*b\"x\")\r\n    await response.write_eof()\r\n    return response\r\n\r\napp = web.Application()\r\napp.add_routes([web.post('/', big),])\r\nweb.run_app(app)\r\n```\r\nin one session and then run\r\n```\r\nimport aiohttp\r\nimport asyncio\r\n\r\nasync def main():\r\n    async with aiohttp.ClientSession() as session:\r\n        for i in range(200):\r\n            response = await session.request(\r\n                method= \"POST\",\r\n                url= \"http://localhost:8080/\",\r\n                timeout= 60,\r\n                data= \"x\",\r\n            )\r\n            print(i)\r\n\r\nloop = asyncio.get_event_loop()\r\nloop.run_until_complete(main())\r\nloop.close()\r\n```\n\n### Expected behavior\n\nI would expect the client to finish in short order (as it does if the server response is set to `50*\"x\" `instead of `500000*\"x\"` or if we explicitly read the response).  Using the request as a context manager works as well (but not possible if using a 3rd party library that does not expose this).\n\n### Logs/tracebacks\n\n```python-traceback\nN/A\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\nPython 3.9.5\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.4\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/i826444/.virtualenvs/temp/lib/python3.9/site-packages\r\nRequires: async-timeout, multidict, typing-extensions, chardet, attrs, yarl\r\nRequired-by: pytest-containers, osb-asyncio, kubernetes-asyncio, k8s-toolkit, faust, cloudfoundry-client, aiohttp-cors, aiodocker\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.1.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/i826444/.virtualenvs/temp/lib/python3.9/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.3\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/i826444/.virtualenvs/temp/lib/python3.9/site-packages\r\nRequires: multidict, idna\r\nRequired-by: faust, aiohttp\n```\n\n\n### OS\n\nmacOS\n\n### Related component\n\nClient\n\n### Additional context\n\nLocal (issue is independent of environment).\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5833/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5833/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5832", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5832/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5832/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5832/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5832", "id": 930131425, "node_id": "MDU6SXNzdWU5MzAxMzE0MjU=", "number": 5832, "title": "Multi packet POST request triggers `invalid HTTP method`", "user": {"login": "iradization", "id": 29353915, "node_id": "MDQ6VXNlcjI5MzUzOTE1", "avatar_url": "https://avatars.githubusercontent.com/u/29353915?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iradization", "html_url": "https://github.com/iradization", "followers_url": "https://api.github.com/users/iradization/followers", "following_url": "https://api.github.com/users/iradization/following{/other_user}", "gists_url": "https://api.github.com/users/iradization/gists{/gist_id}", "starred_url": "https://api.github.com/users/iradization/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iradization/subscriptions", "organizations_url": "https://api.github.com/users/iradization/orgs", "repos_url": "https://api.github.com/users/iradization/repos", "events_url": "https://api.github.com/users/iradization/events{/privacy}", "received_events_url": "https://api.github.com/users/iradization/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-06-25T12:30:06Z", "updated_at": "2021-06-27T14:02:31Z", "closed_at": "2021-06-27T14:02:31Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\n\nI've got a client based on python3 native package `http.client.HTTPConnection` and a server that based on aiohttp.web. When I send http request from client, it seem to split the http command into 2 parts, one for the headers and another one for the body (represented by the json {\"current_config\": \"bla\"})\r\n\r\n```\r\n05:12:46.836684 IP 192.168.214.3.54490 > 192.168.214.1.44444: Flags [P.], seq 3569091528:3569091688, ack 1310633655, win 2058, options [nop,nop,TS val 2463825816 ecr 3230996309], length 160\r\n.fZ.7d..).....E.....@.@...................N......\r\n.......\r\n.......UPOST /keepalive HTTP/1.1\r\nHost: 192.168.214.1:444\r\nAccept-Encoding: identity\r\nContent-type: application/json\r\nAccept: application/json\r\nContent-Length: 20\r\n\r\n\r\n05:12:46.836756 IP 192.168.214.3.54490 > 192.168.214.1.44444: Flags [P.], seq 160:185, ack 1, win 2058, options [nop,nop,TS val 2463825816 ecr 3230996309], length 25\r\n.fZ.7d..).....E..M..@.@..................hN......\r\n-......\r\n.......U{\"param0\":\"pradeep\"}\r\n```\r\n\r\nThis triggers the following error on server side :\r\n\r\n```\r\nTraceback (most recent call last):\r\nfile \"/usr/local/lib/python3.9/site-packages/aiohttp/web_protocol.py\", line 314, in data_received\r\nmessages, upgraded, tail = self._request_parser.feed_data(data)\r\nFile \"aiohttp/_http_parser.pyx\", line 546, in aiohttp._http_parser.HttpParser.feed_data\r\naiohttp.http_exceptions.BadStatusLine: 400, message=\"Bad status line 'invalid HTTP method'\"````\r\n```\r\n\r\nBut when sending roughly the same POST  command using curl which doesn't split between the body and headers in different packets , the server replies as expected :\r\nHere's the POST command generated from POST  request :\r\n\r\n```\r\n05:19:47.514910 IP 192.168.214.3.54514 > 192.168.214.1.44444: Flags [P.], seq 219979840:219980013, ack 3474705214, win 2058, options [nop,nop,TS val 3057096618 ecr 2210798047], length 173\r\n.fZ.7d..).....E.....@.@..................@...>...\r\n.*.....\r\n.7......POST /post HTTP/1.1\r\nHost: 192.168.214.1:44444\r\nUser-Agent: curl/7.64.1\r\nContent-type: application/json\r\nAccept: application/json\r\nContent-Length: 20\r\n\r\n{\"param0\":\"pradeep\"}\r\n```\n\n### To Reproduce\n\nsimple server based on aiohttp with support on post requests \r\n\r\n1. send post command using curl \r\n2. send the same command using http.client.HTTPConnection\r\n\r\n\n\n### Expected behavior\n\nPost request should be properly receive by the server on both cases. \n\n### Logs/tracebacks\n\n```python-traceback\npacket trace and callstack are given in the bug description.\n```\n\n\n### Python Version\n\n```console\n$ python --version\r\npython 3.9.5\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\r\nM-C02F71G2MD6R:mac zkabeli$ python3 -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.4.post0\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/local/lib/python3.9/site-packages\r\nRequires: typing-extensions, yarl, chardet, async-timeout, attrs, multidict\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\r\nName: multidict\r\nVersion: 5.1.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/local/lib/python3.9/site-packages\r\nRequires:\r\nRequired-by: yarl, aiohttp\n```\n\n\n### OS\n\nmacOS\n\n### Related component\n\nServer\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5832/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5832/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5827", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5827/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5827/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5827/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5827", "id": 927419245, "node_id": "MDU6SXNzdWU5Mjc0MTkyNDU=", "number": 5827, "title": "`StreamResponse.set_cookie` `version` attribute wrong documentation", "user": {"login": "AustinScola", "id": 28766523, "node_id": "MDQ6VXNlcjI4NzY2NTIz", "avatar_url": "https://avatars.githubusercontent.com/u/28766523?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AustinScola", "html_url": "https://github.com/AustinScola", "followers_url": "https://api.github.com/users/AustinScola/followers", "following_url": "https://api.github.com/users/AustinScola/following{/other_user}", "gists_url": "https://api.github.com/users/AustinScola/gists{/gist_id}", "starred_url": "https://api.github.com/users/AustinScola/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AustinScola/subscriptions", "organizations_url": "https://api.github.com/users/AustinScola/orgs", "repos_url": "https://api.github.com/users/AustinScola/repos", "events_url": "https://api.github.com/users/AustinScola/events{/privacy}", "received_events_url": "https://api.github.com/users/AustinScola/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-06-22T16:19:12Z", "updated_at": "2021-07-18T20:27:56Z", "closed_at": "2021-07-18T20:27:56Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nThe documentation for [`StreamResponse.set_cookie`](https://docs.aiohttp.org/en/stable/web_reference.html?highlight=set_cookie#aiohttp.web.StreamResponse.set_cookie) shows that the default value for `version` is `None` in the signature (`version=None`) but that it is `1` under the bullet point (\"version=1 by default\"). It appears that the actual default is `None`. The bullet point should be fixed to reflect this.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5827/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5827/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5814", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5814/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5814/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5814/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5814", "id": 925480244, "node_id": "MDU6SXNzdWU5MjU0ODAyNDQ=", "number": 5814, "title": "Peer cancellation policy documentation unclear", "user": {"login": "Tinche", "id": 1909233, "node_id": "MDQ6VXNlcjE5MDkyMzM=", "avatar_url": "https://avatars.githubusercontent.com/u/1909233?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Tinche", "html_url": "https://github.com/Tinche", "followers_url": "https://api.github.com/users/Tinche/followers", "following_url": "https://api.github.com/users/Tinche/following{/other_user}", "gists_url": "https://api.github.com/users/Tinche/gists{/gist_id}", "starred_url": "https://api.github.com/users/Tinche/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Tinche/subscriptions", "organizations_url": "https://api.github.com/users/Tinche/orgs", "repos_url": "https://api.github.com/users/Tinche/repos", "events_url": "https://api.github.com/users/Tinche/events{/privacy}", "received_events_url": "https://api.github.com/users/Tinche/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 13, "created_at": "2021-06-19T22:44:18Z", "updated_at": "2022-09-21T09:47:28Z", "closed_at": "2022-09-21T09:47:27Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Describe the bug\r\n\r\nThe docs (https://docs.aiohttp.org/en/stable/web_advanced.html#peer-disconnection) clearly state:\r\n\r\n> When a client peer is gone a subsequent reading or writing raises OSError or more specific exception like ConnectionResetError.\r\n\r\nAs far as I understand, this behavior replaces the old behavior, which was to cancel the task running the handler as soon as a peer disconnected.\r\n\r\nBut if you curl what I've pasted in the To Reproduce section and kill curl after 1 second, the request handler will actually be cancelled, which is the old behavior. So which is correct?\r\n\r\n### To Reproduce\r\n```\r\nfrom asyncio import sleep\r\n\r\nfrom aiohttp import web\r\n\r\n\r\nasync def handle(request):\r\n    await sleep(3)\r\n    name = request.match_info.get(\"name\", \"Anonymous\")\r\n    text = \"Hello, \" + name\r\n    print(text)\r\n    return web.Response(text=text)\r\n\r\n\r\napp = web.Application()\r\napp.add_routes([web.get(\"/\", handle), web.get(\"/{name}\", handle)])\r\n\r\nif __name__ == \"__main__\":\r\n    web.run_app(app)\r\n```\r\n\r\n### Expected behavior\r\n\r\nNot sure.\r\n\r\n### Logs/tracebacks\r\n\r\n```python-traceback\r\nNone.\r\n```\r\n\r\n\r\n### Python Version\r\n\r\n```console\r\n$ python --version\r\nPython 3.9.2\r\n```\r\n\r\n\r\n### aiohttp Version\r\n\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.4.post0\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/tin/hr/feed-service/.venv/lib/python3.9/site-packages\r\nRequires: async-timeout, attrs, chardet, typing-extensions, multidict, yarl\r\nRequired-by: aiojobs, aioelasticsearch, aiobotocore\r\n```\r\n\r\n\r\n### multidict Version\r\n\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.1.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/tin/hr/feed-service/.venv/lib/python3.9/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n```\r\n\r\n\r\n### yarl Version\r\n\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.3\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/tin/hr/feed-service/.venv/lib/python3.9/site-packages\r\nRequires: idna, multidict\r\nRequired-by: feed-service, aiohttp\r\n```\r\n\r\n\r\n### OS\r\n\r\nUbuntu Linux\r\n\r\n### Related component\r\n\r\nServer\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5814/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5814/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5806", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5806/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5806/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5806/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5806", "id": 925049187, "node_id": "MDU6SXNzdWU5MjUwNDkxODc=", "number": 5806, "title": "[TODO] Finish wiping the attrs usage", "user": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 277836062, "node_id": "MDU6TGFiZWwyNzc4MzYwNjI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/good%20first%20issue", "name": "good first issue", "color": "7057ff", "default": true, "description": "Good for newcomers"}, {"id": 344996043, "node_id": "MDU6TGFiZWwzNDQ5OTYwNDM=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/server", "name": "server", "color": "006b75", "default": false, "description": null}, {"id": 1077350962, "node_id": "MDU6TGFiZWwxMDc3MzUwOTYy", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/Hacktoberfest", "name": "Hacktoberfest", "color": "d93f0b", "default": false, "description": "We think it's good for https://hacktoberfest.digitalocean.com/"}, {"id": 1577406386, "node_id": "MDU6TGFiZWwxNTc3NDA2Mzg2", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/regression", "name": "regression", "color": "c62b3b", "default": false, "description": "Something that used to work stopped working \"as before\" after upgrade"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2021-06-18T16:23:03Z", "updated_at": "2021-08-21T12:50:20Z", "closed_at": "2021-08-21T12:50:20Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "### Describe the bug\n\nOriginally, @asvetlov intended to delete any use of `attrs` from aiohttp 4.0+ series via https://github.com/aio-libs/aiohttp/pull/5284. He dropped it from the runtime deps too.\r\n\r\nBut there are some places that still rely on `attrs` meaning that this will cause failures in runtime because of the missing dep. The tests currently succeed because attrs is listed as a test dep.\r\n\r\nOne place where it's used is https://github.com/aio-libs/aiohttp/blob/4d58400477331704132cc9427d66699e5815ee25/aiohttp/web_protocol.py#L23.\n\n### To Reproduce\n\npip install the recent master w/o the test deps and it should fail\n\n### Expected behavior\n\naiohttp shouldn't rely on deps not declared in the metadata.\n\n### Logs/tracebacks\n\n```python-traceback\nN/A\n```\n\n\n### Python Version\n\n```console\n$ python --version\n```\n\n\n### aiohttp Version\n\n```console\n$ python -m pip show aiohttp\n```\n\n\n### multidict Version\n\n```console\n$ python -m pip show multidict\n```\n\n\n### yarl Version\n\n```console\n$ python -m pip show yarl\n```\n\n\n### OS\n\nN/A\n\n### Related component\n\nServer\n\n### Additional context\n\n_No response_\n\n### Code of Conduct\n\n- [X] I agree to follow the aio-libs Code of Conduct", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5806/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5806/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5791", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5791/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5791/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5791/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5791", "id": 918756572, "node_id": "MDU6SXNzdWU5MTg3NTY1NzI=", "number": 5791, "title": "No requests are logged for some calls and tasks appear to get lost", "user": {"login": "gboor", "id": 7305315, "node_id": "MDQ6VXNlcjczMDUzMTU=", "avatar_url": "https://avatars.githubusercontent.com/u/7305315?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gboor", "html_url": "https://github.com/gboor", "followers_url": "https://api.github.com/users/gboor/followers", "following_url": "https://api.github.com/users/gboor/following{/other_user}", "gists_url": "https://api.github.com/users/gboor/gists{/gist_id}", "starred_url": "https://api.github.com/users/gboor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gboor/subscriptions", "organizations_url": "https://api.github.com/users/gboor/orgs", "repos_url": "https://api.github.com/users/gboor/repos", "events_url": "https://api.github.com/users/gboor/events{/privacy}", "received_events_url": "https://api.github.com/users/gboor/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2021-06-11T13:30:53Z", "updated_at": "2021-06-16T10:09:42Z", "closed_at": "2021-06-16T10:09:42Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n\r\nUnder heavy load, it appears that some requests get \"lost\". They execute, but are not logged. This is indirectly messing with the cleanup of the database sessions, as those also get \"lost\".\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n\r\nCreate a simple aiohttp application with a handful of endpoints, stress test them and check the logs; not all calls are logged, even if they are executed in the client.\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n\r\nCalls to be logged and properly disposed\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n\r\nMy server uses SQLAlchemy with async and at first I thought it was an issue with SQLAlchemy, so I started logging every aspect of a call to an endpoint with the current_task() as prefix. Here is a call that works properly;\r\n\r\n```\r\nJun 11 15:07:56 Task-871: Connection <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_connection object at 0x000001B9DAF34840> checked out from pool\r\nJun 11 15:07:56 Task-871: BEGIN (implicit)\r\nJun 11 15:07:56 Task-871: SELECT countries_cities.countries.id, countries_cities.countries.iso2, countries_cities.countries.iso3, countries_cities.countries.name \r\nFROM countries_cities.countries ORDER BY countries_cities.countries.name\r\nJun 11 15:07:56 Task-871: [cached since 347.4s ago] ()\r\nJun 11 15:07:56 Task-871: ROLLBACK\r\nJun 11 15:07:56 Task-871: Connection <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_connection object at 0x000001B9DAF34840> being returned to pool\r\nJun 11 15:07:56 Task-871: Connection <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_connection object at 0x000001B9DAF34840> rollback-on-return\r\nJun 11 15:07:56 Task-871: Pool size: 20  Connections in pool: 4 Current Overflow: -15 Current Checked out connections: 1\r\nJun 11 15:07:56 Task-871: 127.0.0.1 [11/Jun/2021:13:07:56 +0000] \"GET /countries?include-unknown HTTP/1.1\" 200 8329 \"http://localhost:8081/?sku=12-5733&vendor_id=12\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/92.0.4512.0 Safari/537.36\"\r\n```\r\n\r\nYou can see that all the processing is done, DB connection etc. and finally it shows the GET request.\r\n\r\nHere is the SAME request when it fails;\r\n\r\n```\r\nJun 11 15:07:50 Task-843: Connection <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_connection object at 0x000001B9DAEE5F40> checked out from pool\r\nJun 11 15:07:50 Task-843: BEGIN (implicit)\r\nJun 11 15:07:50 Task-843: SELECT countries_cities.countries.id, countries_cities.countries.iso2, countries_cities.countries.iso3, countries_cities.countries.name \r\nFROM countries_cities.countries ORDER BY countries_cities.countries.name\r\nJun 11 15:07:50 Task-843: [cached since 341.4s ago] ()\r\nJun 11 15:07:51 Task-843: ROLLBACK\r\nJun 11 15:07:51 Task-843: Pool size: 20  Connections in pool: 4 Current Overflow: -15 Current Checked out connections: 1\r\n```\r\n\r\nAs you can see, it stops; the task gets \"lost\", there is no reporting on the actual GET request, even if everything else was done properly.\r\n\r\nI should note that after upgrading aiohttp from 3.7.3 to 3.7.4-post0, this started happening a lot LESS, but it still happens (logs are from 3.7.4-post0).\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.9.2\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.4.post0\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.1.0\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.3\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\n\r\nProblem occurs on both Windows with raw Python and on Linux when running Dockerized with gunicorn and uvloop, so it seems to be fairly consistent.\r\n\r\nProblem also occurs when stress testing without any database connections, those were just good for context. This issue is not all that problematic in itself (some missing logs), but it also means my DB connection teardown fails... which is very problematic.\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5791/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5791/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5787", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5787/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5787/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5787/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5787", "id": 915374034, "node_id": "MDU6SXNzdWU5MTUzNzQwMzQ=", "number": 5787, "title": "Few tests fail (perhaps because of pytest-asyncio 0.15.1?)", "user": {"login": "mcepl", "id": 198999, "node_id": "MDQ6VXNlcjE5ODk5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/198999?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mcepl", "html_url": "https://github.com/mcepl", "followers_url": "https://api.github.com/users/mcepl/followers", "following_url": "https://api.github.com/users/mcepl/following{/other_user}", "gists_url": "https://api.github.com/users/mcepl/gists{/gist_id}", "starred_url": "https://api.github.com/users/mcepl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mcepl/subscriptions", "organizations_url": "https://api.github.com/users/mcepl/orgs", "repos_url": "https://api.github.com/users/mcepl/repos", "events_url": "https://api.github.com/users/mcepl/events{/privacy}", "received_events_url": "https://api.github.com/users/mcepl/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-06-08T19:12:02Z", "updated_at": "2021-06-09T05:57:43Z", "closed_at": "2021-06-08T22:30:17Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n\r\nWhen running the test suite while packaging aiohttp 3.7.4 for openSUSE, I got few tests failing like this:\r\n```\r\n[  197s] _______________________ TestDataQueue.test_read[pyloop] ________________________\r\n[  197s] \r\n[  197s] pyfuncitem = <Function test_read[pyloop]>\r\n[  197s] \r\n[  197s]     def pytest_pyfunc_call(pyfuncitem):  # type: ignore\r\n[  197s]         \"\"\"\r\n[  197s]         Run coroutines in an event loop instead of a normal function call.\r\n[  197s]         \"\"\"\r\n[  197s]         fast = pyfuncitem.config.getoption(\"--aiohttp-fast\")\r\n[  197s]         if asyncio.iscoroutinefunction(pyfuncitem.function):\r\n[  197s]             existing_loop = pyfuncitem.funcargs.get(\r\n[  197s]                 \"proactor_loop\"\r\n[  197s]             ) or pyfuncitem.funcargs.get(\"loop\", None)\r\n[  197s]             with _runtime_warning_context():\r\n[  197s]                 with _passthrough_loop_context(existing_loop, fast=fast) as _loop:\r\n[  197s]                     testargs = {\r\n[  197s]                         arg: pyfuncitem.funcargs[arg]\r\n[  197s]                         for arg in pyfuncitem._fixtureinfo.argnames\r\n[  197s]                     }\r\n[  197s] >                   _loop.run_until_complete(pyfuncitem.obj(**testargs))\r\n[  197s] \r\n[  197s] ../../BUILDROOT/python-aiohttp-3.7.4-0.x86_64/usr/lib64/python3.6/site-packages/aiohttp/pytest_plugin.py:184: \r\n[  197s] _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n[  197s] /usr/lib64/python3.6/asyncio/base_events.py:464: in run_until_complete\r\n[  197s]     self._check_closed()\r\n[  197s] _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n[  197s] \r\n[  197s] self = <_UnixSelectorEventLoop running=False closed=True debug=False>\r\n[  197s] \r\n[  197s]     def _check_closed(self):\r\n[  197s]         if self._closed:\r\n[  197s] >           raise RuntimeError('Event loop is closed')\r\n[  197s] E           RuntimeError: Event loop is closed\r\n[  197s] \r\n[  197s] /usr/lib64/python3.6/asyncio/base_events.py:381: RuntimeError\r\n```\r\nSpecifically, the failing tests are:\r\n```\r\ntest_client_functional.py::test_broken_connection[pyloop]\r\ntest_connector.py::test_del_with_scheduled_cleanup[pyloop]\r\ntest_streams.py::TestDataQueue::test_read[pyloop]\r\ntest_streams.py::TestDataQueue::test_read_eof[pyloop]\r\ntest_streams.py::TestDataQueue::test_read_cancelled[pyloop]\r\ntest_streams.py::TestDataQueue::test_read_until_eof[pyloop]\r\ntest_streams.py::TestDataQueue::test_read_exc[pyloop]\r\ntest_streams.py::TestDataQueue::test_read_exception[pyloop]\r\ntest_streams.py::TestDataQueue::test_read_exception_with_data[pyloop]\r\ntest_streams.py::TestDataQueue::test_read_exception_on_wait[pyloop]\r\ntest_streams.py::TestDataQueue::test_exception_waiter[pyloop]\r\ntest_streams.py::test_feed_data_waiters\r\n```\r\n\r\nFull [log](https://github.com/aio-libs/aiohttp/files/6619025/_log.txt) with all details of used packages and steps leading to failures.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5787/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5787/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5783", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5783/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5783/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5783/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5783", "id": 914109699, "node_id": "MDU6SXNzdWU5MTQxMDk2OTk=", "number": 5783, "title": "[ClientSession behavior] Authorization header dropped during HTTP redirect", "user": {"login": "tonywu7", "id": 21234272, "node_id": "MDQ6VXNlcjIxMjM0Mjcy", "avatar_url": "https://avatars.githubusercontent.com/u/21234272?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tonywu7", "html_url": "https://github.com/tonywu7", "followers_url": "https://api.github.com/users/tonywu7/followers", "following_url": "https://api.github.com/users/tonywu7/following{/other_user}", "gists_url": "https://api.github.com/users/tonywu7/gists{/gist_id}", "starred_url": "https://api.github.com/users/tonywu7/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tonywu7/subscriptions", "organizations_url": "https://api.github.com/users/tonywu7/orgs", "repos_url": "https://api.github.com/users/tonywu7/repos", "events_url": "https://api.github.com/users/tonywu7/events{/privacy}", "received_events_url": "https://api.github.com/users/tonywu7/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2021-06-08T00:52:42Z", "updated_at": "2021-12-01T03:43:27Z", "closed_at": "2021-07-22T19:35:16Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the behavior**\r\n\r\nWhen using `aiohttp.ClientSession` to make a GET request that carries an `Authorization` header, the header is silently dropped whenever the remote server responds with HTTP 3xx redirections to the initial request.\r\n\r\n\ud83d\udccb **Versions**\r\n\r\n`python 3.8.1 aiohttp 3.7.4.post0 multidict 4.7.6 yarl 1.5.1`\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n\r\nScript to reproduce the behavior using the Discord HTTP API and a non-sensitive OAuth2 access token (note that the access tokens expires on Jun 14 2021, although the behavior should still be observable through `Response.request_info.headers`):\r\n\r\n```py\r\nimport asyncio, logging, sys\r\nimport aiohttp, multidict, yarl\r\n\r\n# Non-sensitive, expires on Jun 14 2021\r\nOAUTH2_ACCESS_TOKEN = 'UHwmFVVCnXiywoXp4WMAauaPLkIDzx'\r\nlog = logging.getLogger('debug')\r\n\r\nasync def make_request(url: str):\r\n    async with aiohttp.ClientSession() as session:\r\n        async with session.get(url, headers={\r\n            'Authorization': f'Bearer {OAUTH2_ACCESS_TOKEN}',  # Set Authorization header\r\n        }) as res:\r\n            log.info(f'Requested URL: {url}')\r\n            log.info(f'Real URL: {res.real_url}')\r\n            log.info(f'Request headers: { {**res.request_info.headers} }')\r\n            log.info(f'Status: {res.status}')\r\n\r\nasync def main(no_redirect: str, redirected: str):\r\n    logging.basicConfig(\r\n        level=logging.DEBUG, format='%(levelname)-8s [%(name)s] %(message)s',\r\n    )\r\n    log.info(f'aiohttp {aiohttp.__version__}')\r\n    log.info(f'multidict {multidict.__version__}')\r\n    log.info(f'yarl {yarl.__version__}')\r\n    await make_request(no_redirect)\r\n    await asyncio.sleep(1)\r\n    await make_request(redirected)\r\n\r\nif __name__ == '__main__':\r\n    asyncio.run(main(sys.argv[1], sys.argv[2]))\r\n```\r\n\r\nSave as `redirect.py` and run\r\n\r\n```\r\npython3 redirect.py https://discord.com/api/users/@me http://discord.com/api/users/@me\r\n```\r\n\r\nOutput:\r\n\r\n```\r\nINFO     [debug] aiohttp 3.7.4.post0\r\nINFO     [debug] multidict 4.7.6\r\nINFO     [debug] yarl 1.5.1\r\nINFO     [debug] Requested URL: https://discord.com/api/users/@me\r\nINFO     [debug] Real URL: https://discord.com/api/users/@me\r\nINFO     [debug] Request headers: {'Host': 'discord.com', 'Authorization': 'Bearer UHwmFVVCnXiywoXp4WMAauaPLkIDzx', 'Accept': '*/*', 'Accept-Encoding': 'gzip, deflate', 'User-Agent': 'Python/3.8 aiohttp/3.7.4.post0'}\r\nINFO     [debug] Status: 200\r\nINFO     [debug] Requested URL: http://discord.com/api/users/@me\r\nINFO     [debug] Real URL: https://discord.com/api/users/@me\r\nINFO     [debug] Request headers: {'Host': 'discord.com', 'Accept': '*/*', 'Accept-Encoding': 'gzip, deflate', 'User-Agent': 'Python/3.8 aiohttp/3.7.4.post0'}\r\nINFO     [debug] Status: 401\r\n```\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n\r\nProvided that the authorization info is valid, I expect that the remote server not return an HTTP 401 Unauthorized response due to `aiohttp` dropping the auth header.\r\n\r\n\ud83d\udccb **Additional context**\r\n\r\nThis was raised a year ago in #4568.\r\n\r\nThese are the specific lines causing this behavior for `3.7.4.post0`: https://github.com/aio-libs/aiohttp/blob/184274d9b28bbfa06ac60e48bf286a761c6a6cb0/aiohttp/client.py#L610-L612\r\n\r\nFor the test script, the first URL is HTTPS, for which Discord returns HTTP 200 directly, but for the second, HTTP version of the API, Discord issues an HTTP 301 first to redirect the client to the HTTPS version. `aiohttp` then proceeds to drop the `Authorization` header because it is being redirected to a different origin (from http://discord.com to http**s**://discord.com).\r\n\r\nThis seems to be done for security considerations, to prevent sending the authorization info to a different location. Notably this is also the behavior for the `requests` library (see [this SO](https://stackoverflow.com/a/60451840/10896407) and this [PR on `requests`](https://github.com/psf/requests/pull/5375)).\r\n\r\nHowever, for `aiohttp`, this is undocumented and is therefore surprising for developers, especially in this scenario when the remote server would like to simply upgrade from HTTP to HTTPS but stay on the same host. It is also surprising because it is different than the behaviors seen on major browsers (even though the goal of `aiohttp` is not to emulate browser behaviors). For browsers, the Fetch API spec decides that the same request info including non-forbidden headers should be reused for all redirections (see [issue 553 at whatwg/fetch](https://github.com/whatwg/fetch/issues/553)).\r\n\r\n---\r\n\r\nFor `aiohttp`, my opinion is that it seems less surprising to at least keep the header when the redirect is to the same host/authority as in the previous request, and is done to upgrade from HTTP to HTTPS (`http://discord.com` to `https://discord.com`), instead of dropping it whenever the origin changes (emulating `curl`, see below):\r\n\r\n```py\r\nif (\r\n    url.authority() != parsed_url.authority()\r\n    or url.scheme == 'https' and parsed_url.scheme == 'http'  # downgrade\r\n):\r\n    auth = None\r\n    headers.pop(hdrs.AUTHORIZATION, None)\r\n```\r\n\r\nand to perhaps provide some warning when it happens, or to document it somewhere.\r\n\r\n---\r\n\r\nI set up a test server at `https://aiohttp-issue4568.tonywu.org/` that unconditionally redirects any request to `https://discord.com/api/users/@me`. It is setup to respond correctly to CORS preflights.\r\n\r\nOn Chrome and Firefox, open the console while at `https://discord.com`, then run the following:\r\n\r\n```js\r\nawait fetch('https://aiohttp-issue4568.tonywu.org/', {mode: 'cors', headers: {'Authorization': 'Bearer UHwmFVVCnXiywoXp4WMAauaPLkIDzx'}})\r\n```\r\n\r\nThe fetch will succeed without receiving an HTTP 401, meaning the Authorization header survived through redirections.\r\n\r\nSafari on the other hand has the same behavior and drops the Authorization header.\r\n\r\n`curl` seems to be more specific: it seems to throw out the header when it is redirected to a different host, but keep it when it is upgrading on the same host:\r\n\r\n```\r\n$ curl -V\r\ncurl 7.77.0 (x86_64-apple-darwin20.4.0) libcurl/7.77.0 ...\r\n```\r\n\r\n```\r\n$ curl -Lv 'http://discord.com/api/users/@me' -H 'Authorization: Bearer UHwmFVVCnXiywoXp4WMAauaPLkIDzx'\r\n...\r\n< HTTP/1.1 301 Moved Permanently\r\n...\r\n* Issue another request to this URL: 'https://discord.com/api/users/@me'\r\n...\r\n> GET /api/users/@me HTTP/2\r\n> Host: discord.com\r\n> user-agent: curl/7.77.0\r\n> accept: */*\r\n> authorization: Bearer UHwmFVVCnXiywoXp4WMAauaPLkIDzx\r\n>\r\n* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):\r\n* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):\r\n* old SSL session ID is stale, removing\r\n* Connection state changed (MAX_CONCURRENT_STREAMS == 256)!\r\n< HTTP/2 200\r\n```\r\n\r\n```\r\n$ curl -Lv 'https://aiohttp-issue4568.tonywu.org/' -H 'Authorization: Bearer UHwmFVVCnXiywoXp4WMAauaPLkIDzx'\r\n...\r\n< HTTP/1.1 301 Moved Permanently\r\n...\r\n* Issue another request to this URL: 'https://discord.com/api/users/@me'\r\n...\r\n> GET /api/users/@me HTTP/2\r\n> Host: discord.com\r\n> user-agent: curl/7.77.0\r\n> accept: */*\r\n>\r\n* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):\r\n* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):\r\n* old SSL session ID is stale, removing\r\n* Connection state changed (MAX_CONCURRENT_STREAMS == 256)!\r\n< HTTP/2 401\r\n```", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5783/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5783/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5766", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5766/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5766/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5766/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5766", "id": 912302211, "node_id": "MDU6SXNzdWU5MTIzMDIyMTE=", "number": 5766, "title": "The heartbeat call to ping() sometimes occurs after the transport is closing", "user": {"login": "WillCodeCo", "id": 1413237, "node_id": "MDQ6VXNlcjE0MTMyMzc=", "avatar_url": "https://avatars.githubusercontent.com/u/1413237?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WillCodeCo", "html_url": "https://github.com/WillCodeCo", "followers_url": "https://api.github.com/users/WillCodeCo/followers", "following_url": "https://api.github.com/users/WillCodeCo/following{/other_user}", "gists_url": "https://api.github.com/users/WillCodeCo/gists{/gist_id}", "starred_url": "https://api.github.com/users/WillCodeCo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WillCodeCo/subscriptions", "organizations_url": "https://api.github.com/users/WillCodeCo/orgs", "repos_url": "https://api.github.com/users/WillCodeCo/repos", "events_url": "https://api.github.com/users/WillCodeCo/events{/privacy}", "received_events_url": "https://api.github.com/users/WillCodeCo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-06-05T15:04:00Z", "updated_at": "2021-06-07T09:26:35Z", "closed_at": "2021-06-07T09:26:35Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n\r\nWhen a websocket is setup with a `heartbeat` the `ClientWebSocketResponse._send_heartbeat()` function is periodically called, which creates a fire-and-forget task in order to call `self._writer.ping()`.\r\n\r\nThe problem is that this task does not check to see if the transport is closed/closing before calling `_writer.ping()`\r\n\r\n```python\r\n    def _send_heartbeat(self) -> None:\r\n        if self._heartbeat is not None and not self._closed:\r\n            # fire-and-forget a task is not perfect but maybe ok for\r\n            # sending ping. Otherwise we need a long-living heartbeat\r\n            # task in the class.\r\n            self._loop.create_task(self._writer.ping())\r\n\r\n            if self._pong_response_cb is not None:\r\n                self._pong_response_cb.cancel()\r\n            self._pong_response_cb = call_later(\r\n                self._pong_not_received, self._pong_heartbeat, self._loop\r\n            )\r\n           \r\n```\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n\r\n```python\r\nimport aiohttp\r\nfrom aiohttp import web\r\nimport asyncio\r\nimport random\r\n\r\nclass ExampleServer:\r\n    def __init__(self, host: str, port: int):\r\n        self._host = host\r\n        self._port = port\r\n        self._app = web.Application()\r\n        self._app.add_routes([web.get('/ws', self._get_ws_handler)])\r\n\r\n    @classmethod\r\n    async def _run_server(cls, web_app, host: str, port: int):\r\n        try:\r\n            runner = web.AppRunner(web_app)\r\n            await runner.setup()\r\n            site = web.TCPSite(runner, host, port)\r\n            await site.start()\r\n            print(f\"HTTP Server is starting at {host}:{port}\")\r\n            while True:\r\n                await asyncio.sleep(60)\r\n        finally:\r\n            print(\"HTTP Server is terminating\")\r\n            await runner.cleanup()\r\n\r\n    async def _get_ws_handler(self, request: web.Request) -> web.Response:\r\n        ws = web.WebSocketResponse(heartbeat=0.1)\r\n        await ws.prepare(request)\r\n        async for received_msg in ws:\r\n            print(f\"Server received: {received_msg.data}\")\r\n\r\n    async def run(self):\r\n        await self._run_server(self._app, self._host, self._port)\r\n\r\n\r\nasync def run_server():\r\n    server = ExampleServer('localhost', 8888)\r\n    await server.run()\r\n\r\n\r\nasync def run_client(session, rng, client_name):\r\n    async with session.ws_connect(url='ws://localhost:8888/ws', heartbeat=0.1) as ws:\r\n        await ws.send_bytes(b'hello from '+client_name.encode('ascii'))\r\n        await asyncio.sleep(rng.randint(100,1000)/1000)\r\n        await ws.close()\r\n\r\n\r\nasync def main():\r\n    rng = random.Random(42)\r\n    exceptions_raised = []\r\n    asyncio.get_event_loop().set_exception_handler(lambda loop, context: exceptions_raised.append(context.get('exception')))\r\n    asyncio.create_task(run_server())\r\n    await asyncio.sleep(0.5)\r\n    async with aiohttp.ClientSession() as session:\r\n        for x in range(1000):\r\n            asyncio.create_task(run_client(session, rng, f'client_{x}'))\r\n        await asyncio.sleep(5)\r\n        if exceptions_raised == []:\r\n            print(\"No exceptions were raised :)\")\r\n        else:\r\n            for e in exceptions_raised:\r\n                raise e\r\n\r\nloop = asyncio.get_event_loop()\r\nloop.run_until_complete(main())\r\n```\r\nAdd these steps below this comment: -->\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n\r\nNo exceptions should be raised\r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\nTraceback (most recent call last):\r\n  File \"/tmp/badping.py\", line 70, in <module>\r\n    loop.run_until_complete(main())\r\n  File \"/usr/lib/python3.9/asyncio/base_events.py\", line 642, in run_until_complete\r\n    return future.result()\r\n  File \"/tmp/badping.py\", line 67, in main\r\n    raise e\r\n  File \"/tmp/.env/lib/python3.9/site-packages/aiohttp/http_websocket.py\", line 673, in ping\r\n    await self._send_frame(message, WSMsgType.PING)\r\n  File \"/tmp/.env/lib/python3.9/site-packages/aiohttp/http_websocket.py\", line 643, in _send_frame\r\n    self._write(header + mask + message)\r\n  File \"/tmp/.env/lib/python3.9/site-packages/aiohttp/http_websocket.py\", line 660, in _write\r\n    raise ConnectionResetError(\"Cannot write to closing transport\")\r\nConnectionResetError: Cannot write to closing transport\r\n\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.9.3\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.4.post0\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /tmp/.env/lib/python3.9/site-packages\r\nRequires: chardet, yarl, typing-extensions, multidict, async-timeout, attrs\r\nRequired-by: \r\n\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.1.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /tmp/.env/lib/python3.9/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.3\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /tmp/.env/lib/python3.9/site-packages\r\nRequires: multidict, idna\r\nRequired-by: aiohttp\r\n\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\nRunning on 5.4.112-1-MANJARO\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5766/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5766/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5747", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5747/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5747/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5747/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5747", "id": 907376995, "node_id": "MDU6SXNzdWU5MDczNzY5OTU=", "number": 5747, "title": "Confusion with aiohttp", "user": {"login": "AeroActuallyDev", "id": 83130968, "node_id": "MDQ6VXNlcjgzMTMwOTY4", "avatar_url": "https://avatars.githubusercontent.com/u/83130968?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AeroActuallyDev", "html_url": "https://github.com/AeroActuallyDev", "followers_url": "https://api.github.com/users/AeroActuallyDev/followers", "following_url": "https://api.github.com/users/AeroActuallyDev/following{/other_user}", "gists_url": "https://api.github.com/users/AeroActuallyDev/gists{/gist_id}", "starred_url": "https://api.github.com/users/AeroActuallyDev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AeroActuallyDev/subscriptions", "organizations_url": "https://api.github.com/users/AeroActuallyDev/orgs", "repos_url": "https://api.github.com/users/AeroActuallyDev/repos", "events_url": "https://api.github.com/users/AeroActuallyDev/events{/privacy}", "received_events_url": "https://api.github.com/users/AeroActuallyDev/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 58986078, "node_id": "MDU6TGFiZWw1ODk4NjA3OA==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/invalid", "name": "invalid", "color": "e4e669", "default": true, "description": "This doesn't seem right"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-05-31T11:19:14Z", "updated_at": "2021-06-05T20:59:24Z", "closed_at": "2021-06-05T20:53:59Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hey, in the docs it says ProxyConnector is in \r\naiohttp.ProxyConnector\r\nBut now i have seen a post saying its embeded in TcpConnector?\r\nHow would i use it in this way\r\nconnector = ProxyConnector(\"http://1.1.1.1:1000\", proxy_auth=basic_auth)", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5747/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5747/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5746", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5746/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5746/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5746/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5746", "id": 906490495, "node_id": "MDU6SXNzdWU5MDY0OTA0OTU=", "number": 5746, "title": "'pip install aiohttp[speedups]' installs (deprecated) brotlipy, not Brotli or brotlicffi", "user": {"login": "sbaack", "id": 8274140, "node_id": "MDQ6VXNlcjgyNzQxNDA=", "avatar_url": "https://avatars.githubusercontent.com/u/8274140?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sbaack", "html_url": "https://github.com/sbaack", "followers_url": "https://api.github.com/users/sbaack/followers", "following_url": "https://api.github.com/users/sbaack/following{/other_user}", "gists_url": "https://api.github.com/users/sbaack/gists{/gist_id}", "starred_url": "https://api.github.com/users/sbaack/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sbaack/subscriptions", "organizations_url": "https://api.github.com/users/sbaack/orgs", "repos_url": "https://api.github.com/users/sbaack/repos", "events_url": "https://api.github.com/users/sbaack/events{/privacy}", "received_events_url": "https://api.github.com/users/sbaack/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2021-05-29T14:58:07Z", "updated_at": "2021-10-11T18:20:14Z", "closed_at": "2021-06-19T09:04:38Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n\r\nI'm a bit confused about these similarly named libraries, but installing `brotlipy` when using `pip install aiohttp[speedups]` def. seems to be wrong considering that [using `brotlipy` is deprecated because it has been renamed to `brotlicffi`](https://github.com/python-hyper/brotlicffi/blob/de7ee050f809448735f0f05a6379383b8cf4554f/HISTORY.rst#080-2020-11-30). According to #3803, `Brotli` should be installed?\r\n\r\nBTW, the [docs](https://docs.aiohttp.org/en/stable/index.html) also talk about `brotlipy`, which should be changed to either `Brotli` or `brotlicffi` (whatever is used now).\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n\r\n```bash\r\npython -m venv aiohttp_showcase\r\nsource aiohttp_showcase/bin/activate\r\npython -m pip install aiohttp[speedups]\r\n```\r\nThis installs `brotlipy`, here is the `pip list` output from a fresh venv:\r\n\r\n```\r\nPackage           Version\r\n----------------- -----------\r\naiodns            3.0.0\r\naiohttp           3.7.4.post0\r\nasync-timeout     3.0.1\r\nattrs             21.2.0\r\nbrotlipy          0.7.0\r\ncchardet          2.1.7\r\ncffi              1.14.5\r\nchardet           4.0.0\r\nidna              3.1\r\nmultidict         5.1.0\r\npip               21.1.2\r\npycares           4.0.0\r\npycparser         2.20\r\nsetuptools        57.0.0\r\ntyping-extensions 3.10.0.0\r\nwheel             0.36.2\r\nyarl              1.6.3\r\n```\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n\r\n`pip install aiohttp[speedups]` should install either `Brotli` or `brotlicffi` (again, whatever is currenty used).\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n\r\n```console\r\n$ python --version\r\nPython 3.9.5\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.4.post0\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/sb/.virtualenvs/aiohttp_showcase/lib/python3.9/site-packages\r\nRequires: yarl, async-timeout, multidict, typing-extensions, attrs, chardet\r\nRequired-by:\r\n...\r\n```", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5746/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5746/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5730", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5730/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5730/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5730/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5730", "id": 898692154, "node_id": "MDU6SXNzdWU4OTg2OTIxNTQ=", "number": 5730, "title": "invalid character in header url", "user": {"login": "saarsa", "id": 6289703, "node_id": "MDQ6VXNlcjYyODk3MDM=", "avatar_url": "https://avatars.githubusercontent.com/u/6289703?v=4", "gravatar_id": "", "url": "https://api.github.com/users/saarsa", "html_url": "https://github.com/saarsa", "followers_url": "https://api.github.com/users/saarsa/followers", "following_url": "https://api.github.com/users/saarsa/following{/other_user}", "gists_url": "https://api.github.com/users/saarsa/gists{/gist_id}", "starred_url": "https://api.github.com/users/saarsa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/saarsa/subscriptions", "organizations_url": "https://api.github.com/users/saarsa/orgs", "repos_url": "https://api.github.com/users/saarsa/repos", "events_url": "https://api.github.com/users/saarsa/events{/privacy}", "received_events_url": "https://api.github.com/users/saarsa/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2021-05-22T01:56:11Z", "updated_at": "2021-08-03T18:25:00Z", "closed_at": "2021-08-03T18:24:59Z", "author_association": "NONE", "active_lock_reason": null, "body": "my python env\r\nPython 3.8.5\r\naiohttp 3.7.4.post0\r\nmultidict 5.1.0\r\nyarl 1.6.3\r\nHi sorry for the question but I have an error that I can not understand \r\nI'm trying to run this code\r\n`async def main():\r\n    async with aiohttp.ClientSession() as session:\r\n        async with session.get(\"https://tase.co.il\") as resp:\r\n            print(resp.status)\r\n            print(await resp.text())\r\n\r\n\r\nloop = asyncio.get_event_loop()\r\nloop.run_until_complete(main())`\r\n\r\nBut it brings me back \r\nraise ClientResponseError(aiohttp.client_exceptions.ClientResponseError: 400, message='invalid character in header', url=URL('https://www.tase.co.il/')\r\nWhy is this happening to me?", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5730/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5730/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5708", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5708/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5708/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5708/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5708", "id": 891739255, "node_id": "MDU6SXNzdWU4OTE3MzkyNTU=", "number": 5708, "title": "raising HTTPFound will discard cookies silently", "user": {"login": "ygl-rg", "id": 13267776, "node_id": "MDQ6VXNlcjEzMjY3Nzc2", "avatar_url": "https://avatars.githubusercontent.com/u/13267776?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ygl-rg", "html_url": "https://github.com/ygl-rg", "followers_url": "https://api.github.com/users/ygl-rg/followers", "following_url": "https://api.github.com/users/ygl-rg/following{/other_user}", "gists_url": "https://api.github.com/users/ygl-rg/gists{/gist_id}", "starred_url": "https://api.github.com/users/ygl-rg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ygl-rg/subscriptions", "organizations_url": "https://api.github.com/users/ygl-rg/orgs", "repos_url": "https://api.github.com/users/ygl-rg/repos", "events_url": "https://api.github.com/users/ygl-rg/events{/privacy}", "received_events_url": "https://api.github.com/users/ygl-rg/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-05-14T08:45:56Z", "updated_at": "2021-05-14T22:48:18Z", "closed_at": "2021-05-14T22:48:18Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\n   raising a HTTPFound with some cookies will cause these cookies being discarded silently, return HTTPFound is fine.\r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n\r\n```python\r\n     async def goto(request):\r\n         f = web.HTTPFound(request.app.router['index'].url_for())\r\n         f.set_cookie('abc', 'ddd')\r\n         raise f\r\n    \r\n     async def index(request):\r\n         print(request.cookies) # abc is not here\r\n```\r\n\r\n```python\r\n    async def goto(request):\r\n         f = web.HTTPFound(request.app.router['index'].url_for())\r\n         f.set_cookie('abc', 'ddd')\r\n         return f\r\n    \r\n     async def index(request):\r\n         print(request.cookies) # abc is here\r\n```\r\n\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\n\r\n    request.cookies should contain the cookie value.\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\n\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n python 3.8.9\r\n...\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n 3.7.4.post0\r\n...\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5708/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5708/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5705", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5705/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5705/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5705/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5705", "id": 890756845, "node_id": "MDU6SXNzdWU4OTA3NTY4NDU=", "number": 5705, "title": "Not establishing connections after update of both aiorun and aiohttp ", "user": {"login": "pavka14", "id": 9179491, "node_id": "MDQ6VXNlcjkxNzk0OTE=", "avatar_url": "https://avatars.githubusercontent.com/u/9179491?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pavka14", "html_url": "https://github.com/pavka14", "followers_url": "https://api.github.com/users/pavka14/followers", "following_url": "https://api.github.com/users/pavka14/following{/other_user}", "gists_url": "https://api.github.com/users/pavka14/gists{/gist_id}", "starred_url": "https://api.github.com/users/pavka14/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pavka14/subscriptions", "organizations_url": "https://api.github.com/users/pavka14/orgs", "repos_url": "https://api.github.com/users/pavka14/repos", "events_url": "https://api.github.com/users/pavka14/events{/privacy}", "received_events_url": "https://api.github.com/users/pavka14/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2021-05-13T06:25:02Z", "updated_at": "2021-10-30T13:56:34Z", "closed_at": "2021-10-30T13:56:34Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nWe have several microservices running with aiorun and using aiohttp.\r\nAfter version update we get the following:\r\naiorun==2020.12.1 and aiohttp==3.6.2 -> works as before\r\naiorun==2019.4.1 and aiohttp==3.7.4 -> works as before\r\naiorun==2020.12.1 and aiohttp==3.7.4 -> outgoing requests do not work.\r\n\r\nUnfortunately, I cannot get any reason more specific than this trace:\r\n```python-traceback\r\nTraceback (most recent call last):\r\nFile \"/home/pavka/Documents/console/slayer2/venv/lib64/python3.9/site-packages/aiohttp/connector.py\", line 969, in _wrap_create_connection\r\nreturn await self._loop.create_connection(*args, **kwargs) # type: ignore # noqa\r\nFile \"/usr/lib64/python3.9/asyncio/base_events.py\", line 1056, in create_connection\r\nraise exceptions[0]\r\nFile \"/usr/lib64/python3.9/asyncio/base_events.py\", line 1041, in create_connection\r\nsock = await self._connect_sock(\r\nFile \"/usr/lib64/python3.9/asyncio/base_events.py\", line 955, in _connect_sock\r\nawait self.sock_connect(sock, address)\r\nFile \"/usr/lib64/python3.9/asyncio/selector_events.py\", line 502, in sock_connect\r\nreturn await fut\r\nFile \"/usr/lib64/python3.9/asyncio/selector_events.py\", line 537, in _sock_connect_cb\r\nraise OSError(err, f'Connect call failed {address}')\r\nConnectionRefusedError: [Errno 111] Connect call failed ('127.0.0.1', 8500)\r\n```\r\nIn the above instance, it is trying to talk to a local docker container but the same happens when trying to connect to external services:\r\n```python-traceback\r\nTraceback (most recent call last):\r\nFile \"/home/servicelayer/.local/lib/python3.7/site-packages/aiohttp/connector.py\", line 969, in _wrap_create_connection\r\nreturn await self._loop.create_connection(*args, **kwargs) # type: ignore # noqa\r\nFile \"/usr/local/lib/python3.7/asyncio/base_events.py\", line 954, in create_connection\r\nraise exceptions[0]\r\nFile \"/usr/local/lib/python3.7/asyncio/base_events.py\", line 941, in create_connection\r\nawait self.sock_connect(sock, address)\r\nFile \"/usr/local/lib/python3.7/asyncio/selector_events.py\", line 464, in sock_connect\r\nreturn await fut\r\nFile \"/usr/local/lib/python3.7/asyncio/selector_events.py\", line 494, in _sock_connect_cb\r\nraise OSError(err, f'Connect call failed {address}')\r\nConnectionRefusedError: [Errno 111] Connect call failed ('172.17.11.3', 8500)\r\n```\r\nI raised the issue with the aiorun project and their guess was that something replaces the event loop where the code is running but I have been unable to find anything like that, or to get the code to produce a more descriptive error.\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n```console\r\n$ python --version\r\nPython 3.9.4\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.4\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/pavka/Documents/console/slayer2/venv/lib/python3.9/site-packages\r\nRequires: chardet, typing-extensions, async-timeout, multidict, attrs, yarl\r\nRequired-by: \r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.6\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/pavka/Documents/console/slayer2/venv/lib/python3.9/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.3\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/pavka/Documents/console/slayer2/venv/lib/python3.9/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\nWe are running services in an endless loop, thus they are wrapped in aiorun.\r\nFrom aiohttp we only use the client part.\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5705/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5705/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5693", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5693/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5693/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5693/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5693", "id": 889414125, "node_id": "MDU6SXNzdWU4ODk0MTQxMjU=", "number": 5693, "title": "Unable to Stream Proxy Data", "user": {"login": "tebanep", "id": 6664744, "node_id": "MDQ6VXNlcjY2NjQ3NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/6664744?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tebanep", "html_url": "https://github.com/tebanep", "followers_url": "https://api.github.com/users/tebanep/followers", "following_url": "https://api.github.com/users/tebanep/following{/other_user}", "gists_url": "https://api.github.com/users/tebanep/gists{/gist_id}", "starred_url": "https://api.github.com/users/tebanep/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tebanep/subscriptions", "organizations_url": "https://api.github.com/users/tebanep/orgs", "repos_url": "https://api.github.com/users/tebanep/repos", "events_url": "https://api.github.com/users/tebanep/events{/privacy}", "received_events_url": "https://api.github.com/users/tebanep/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2021-05-12T01:01:02Z", "updated_at": "2021-05-18T00:06:52Z", "closed_at": "2021-05-18T00:06:52Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\n\r\nI'm trying to serve a stream of data downloaded from an external url. For that purpouse, I'm using aiohttp's server and client in combination. In my server handler, I'm returning a StreamResponse, writing to it in chunks. The response is correctly streamed when using static bytes data. However, if the data comes from ClientResponse.content (i.e. an aiohttp.StreamReader instance) an error is raised.\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?  -->\r\n\r\nYou might run the following server:\r\n\r\n```python\r\nfrom aiohttp import web, ClientSession\r\n\r\n\r\n# Proxy Streaming Download\r\n\r\nasync def _proxy_chunked_data() -> None:\r\n    url = ('https://images.unsplash.com/photo-1620330270596-0c559cb32a68?'\r\n        'ixlib=rb-1.2.1&q=80&fm=jpg&crop=entropy&'\r\n        'cs=tinysrgb&w=1080&fit=max')\r\n\r\n    size = 512 * 1024\r\n    \r\n    async with ClientSession() as session:\r\n        async with session.get(url) as response:\r\n            chunk = await response.content.read(size)\r\n            while chunk:\r\n                yield chunk\r\n                await response.content.read(size)\r\n\r\nasync def proxy_stream_download(request):\r\n    response = web.StreamResponse()\r\n    await response.prepare(request)\r\n\r\n    async for chunk in _proxy_chunked_data():\r\n        await response.write(chunk)\r\n\r\n    print('Proxy Stream Response Finished!')\r\n\r\n    return response\r\n\r\n\r\n# Bytes Streaming Download\r\n\r\nasync def _bytes_chunked_data() -> None:\r\n    size = 1\r\n    offset = 0\r\n    data = b'abracadabra\\n'\r\n    chunk = data[offset:offset + size]\r\n    while chunk:\r\n        yield chunk\r\n        offset += size\r\n        chunk = data[offset:offset + size]\r\n\r\nasync def bytes_stream_download(request):\r\n    response = web.StreamResponse()\r\n    await response.prepare(request)\r\n\r\n    async for chunk in _bytes_chunked_data():\r\n        await response.write(chunk)\r\n\r\n    print('Bytes Stream Response Finished!')\r\n\r\n    return response\r\n\r\n\r\napp = web.Application()\r\napp.add_routes([web.get('/proxy_download', proxy_stream_download)])\r\napp.add_routes([web.get('/bytes_download', bytes_stream_download)])\r\n\r\n\r\nif __name__ == '__main__':\r\n    web.run_app(app, port=7777)\r\n```\r\n\r\nThen, with **curl** you can perform requests to both endpoints, realizing that the **\"/proxy_download\"** raises an error.\r\n\r\nIn **client console (bytes_download):**\r\n```console\r\n(env) mediark@mediark:~$ curl localhost:7777/bytes_download\r\nabracadabra\r\n```\r\n\r\nIn **server console (bytes_download):**\r\n```console\r\n(env) mediark@mediark:~$ python read_wait_aiohttp_error.py\r\n======== Running on http://0.0.0.0:7777 ========\r\n(Press CTRL+C to quit)\r\nBytes Stream Response Finished!\r\n```\r\n\r\nIn **client console (proxy_download):**\r\n```console\r\n(env) mediark@mediark:~$ curl localhost:7777/proxy_download\r\nWarning: Binary output can mess up your terminal. Use \"--output -\" to tell\r\nWarning: curl to output it to your terminal anyway, or consider \"--output\r\nWarning: <FILE>\" to save to a file.\r\n\r\n(env) mediark@mediark:~$ curl localhost:7777/proxy_download --output /dev/null\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                                     Dload  Upload   Total   Spent    Left  Speed\r\n100 25.2M    0 25.2M    0     0  3273k      0 --:--:--  0:00:07 --:--:-- 3406k^C\r\n```\r\n\r\nIn **server console (proxy_download):**\r\n```console\r\n(env) mediark@mediark:~$ python read_wait_aiohttp_error.py \r\n======== Running on http://0.0.0.0:7777 ========\r\n(Press CTRL+C to quit)\r\nMultiple access to StreamReader in eof state, might be infinite loop.\r\nStack (most recent call last):\r\nFile \"read_wait_aiohttp_error.py\", line 62, in <module>\r\nweb.run_app(app, port=7777)\r\nFile \"/opt/mediark/env/lib/python3.8/site-packages/aiohttp/web.py\", line 508, in run_app\r\nloop.run_until_complete(main_task)\r\nFile \"/usr/lib/python3.8/asyncio/base_events.py\", line 603, in run_until_complete\r\nself.run_forever()\r\nFile \"/usr/lib/python3.8/asyncio/base_events.py\", line 570, in run_forever\r\nself._run_once()\r\nFile \"/usr/lib/python3.8/asyncio/base_events.py\", line 1859, in _run_once\r\nhandle._run()\r\nFile \"/usr/lib/python3.8/asyncio/events.py\", line 81, in _run\r\nself._context.run(self._callback, *self._args)\r\nFile \"/opt/mediark/env/lib/python3.8/site-packages/aiohttp/web_protocol.py\", line 422, in _handle_request\r\nresp = await self._request_handler(request)\r\nFile \"/opt/mediark/env/lib/python3.8/site-packages/aiohttp/web_app.py\", line 499, in _handle\r\nresp = await handler(request)\r\nFile \"read_wait_aiohttp_error.py\", line 24, in proxy_stream_download\r\nasync for chunk in _proxy_chunked_data():\r\nFile \"read_wait_aiohttp_error.py\", line 18, in _proxy_chunked_data\r\nawait response.content.read(size)\r\nFile \"/opt/mediark/env/lib/python3.8/site-packages/aiohttp/streams.py\", line 354, in read\r\ninternal_logger.warning(\r\nMultiple access to StreamReader in eof state, might be infinite loop.\r\n...\r\n```\r\n\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\n\r\nThe remote binary resource should be able to be downloaded and proxied by the server through streaming.\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\nMultiple access to StreamReader in eof state, might be infinite loop.\r\nStack (most recent call last):\r\nFile \"read_wait_aiohttp_error.py\", line 62, in <module>\r\nweb.run_app(app, port=7777)\r\nFile \"/opt/mediark/env/lib/python3.8/site-packages/aiohttp/web.py\", line 508, in run_app\r\nloop.run_until_complete(main_task)\r\nFile \"/usr/lib/python3.8/asyncio/base_events.py\", line 603, in run_until_complete\r\nself.run_forever()\r\nFile \"/usr/lib/python3.8/asyncio/base_events.py\", line 570, in run_forever\r\nself._run_once()\r\nFile \"/usr/lib/python3.8/asyncio/base_events.py\", line 1859, in _run_once\r\nhandle._run()\r\nFile \"/usr/lib/python3.8/asyncio/events.py\", line 81, in _run\r\nself._context.run(self._callback, *self._args)\r\nFile \"/opt/mediark/env/lib/python3.8/site-packages/aiohttp/web_protocol.py\", line 422, in _handle_request\r\nresp = await self._request_handler(request)\r\nFile \"/opt/mediark/env/lib/python3.8/site-packages/aiohttp/web_app.py\", line 499, in _handle\r\nresp = await handler(request)\r\nFile \"read_wait_aiohttp_error.py\", line 24, in proxy_stream_download\r\nasync for chunk in _proxy_chunked_data():\r\nFile \"read_wait_aiohttp_error.py\", line 18, in _proxy_chunked_data\r\nawait response.content.read(size)\r\nFile \"/opt/mediark/env/lib/python3.8/site-packages/aiohttp/streams.py\", line 354, in read\r\ninternal_logger.warning(\r\nError handling request\r\nTraceback (most recent call last):\r\nFile \"/opt/mediark/env/lib/python3.8/site-packages/aiohttp/web_protocol.py\", line 422, in _handle_request\r\nresp = await self._request_handler(request)\r\nFile \"/opt/mediark/env/lib/python3.8/site-packages/aiohttp/web_app.py\", line 499, in _handle\r\nresp = await handler(request)\r\nFile \"read_wait_aiohttp_error.py\", line 25, in proxy_stream_download\r\nawait response.write(chunk)\r\nFile \"/opt/mediark/env/lib/python3.8/site-packages/aiohttp/web_response.py\", line 470, in write\r\nawait self._payload_writer.write(data)\r\nFile \"/opt/mediark/env/lib/python3.8/site-packages/aiohttp/http_writer.py\", line 107, in write\r\nself._write(chunk)\r\nFile \"/opt/mediark/env/lib/python3.8/site-packages/aiohttp/http_writer.py\", line 67, in _write\r\nraise ConnectionResetError(\"Cannot write to closing transport\")\r\nConnectionResetError: Cannot write to closing transport\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.8.5\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.4.post0\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /opt/mediark/env/lib/python3.8/site-packages\r\nRequires: chardet, multidict, async-timeout, typing-extensions, attrs, yarl\r\nRequired-by: pytest-aiohttp, aiohttp-jinja2\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.1.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /opt/mediark/env/lib/python3.8/site-packages\r\nRequires:\r\nRequired-by: yarl, aiohttp\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.3\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /opt/mediark/env/lib/python3.8/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\nUsing **Ubuntu 20.04**\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\nThank you! :smiley:", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5693/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5693/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5667", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5667/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5667/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5667/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5667", "id": 875786260, "node_id": "MDU6SXNzdWU4NzU3ODYyNjA=", "number": 5667, "title": "Error occurs when Content-Type is not specified in the response header.", "user": {"login": "grarich", "id": 54613530, "node_id": "MDQ6VXNlcjU0NjEzNTMw", "avatar_url": "https://avatars.githubusercontent.com/u/54613530?v=4", "gravatar_id": "", "url": "https://api.github.com/users/grarich", "html_url": "https://github.com/grarich", "followers_url": "https://api.github.com/users/grarich/followers", "following_url": "https://api.github.com/users/grarich/following{/other_user}", "gists_url": "https://api.github.com/users/grarich/gists{/gist_id}", "starred_url": "https://api.github.com/users/grarich/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/grarich/subscriptions", "organizations_url": "https://api.github.com/users/grarich/orgs", "repos_url": "https://api.github.com/users/grarich/repos", "events_url": "https://api.github.com/users/grarich/events{/privacy}", "received_events_url": "https://api.github.com/users/grarich/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-05-04T19:58:02Z", "updated_at": "2021-05-04T20:57:42Z", "closed_at": "2021-05-04T20:57:42Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nError occurs when Content-Type is not specified in the response header.\r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n1. Open the REPL for asyncio\r\n2. Execute the following code\r\n3. See some behavior described\r\n\r\n```python\r\n>>>import asyncio\r\n>>>import aiohttp\r\n# JSON is returned, but Content-Type application/json is not specified in the response header.\r\n>>>url = 'https://example.com'\r\n>>>async with aiohttp.request('POST', url) as resp:\r\n...    data = await resp.json()\r\n...\r\n\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\user\\AppData\\Local\\Programs\\Python\\Python38\\lib\\concurrent\\futures\\_base.py\", line 439, in result\r\n    return self.__get_result()\r\n  File \"C:\\Users\\user\\AppData\\Local\\Programs\\Python\\Python38\\lib\\concurrent\\futures\\_base.py\", line 388, in __get_result\r\n    raise self._exception\r\n  File \"<console>\", line 2, in <module>\r\n  File \"C:\\Users\\user\\AppData\\Local\\Programs\\Python\\Python38\\lib\\site-packages\\aiohttp\\client_reqrep.py\", line 1026, in json\r\n    raise ContentTypeError(\r\naiohttp.client_exceptions.ContentTypeError: 0, message='Attempt to decode JSON with unexpected mimetype: ', url=URL('https://example.com')\r\n```\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\nSee the traceback above.\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n```console\r\n$ python --version\r\nPython 3.8.6\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nLocation: c:\\users\\user\\appdata\\local\\programs\\python\\python38\\lib\\site-packages\r\nRequires: async-timeout, chardet, attrs, multidict, yarl\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.6\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\users\\user\\appdata\\local\\programs\\python\\python38\\lib\\site-packages\r\nRequires:\r\nRequired-by: yarl, aiohttp\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.5.1\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\users\\user\\appdata\\local\\programs\\python\\python38\\lib\\site-packages\r\nRequires: multidict, idna\r\nRequired-by: aiohttp\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5667/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5667/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5665", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5665/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5665/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5665/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5665", "id": 875731463, "node_id": "MDU6SXNzdWU4NzU3MzE0NjM=", "number": 5665, "title": "Autosquash doesn't work for the Dependabot PRs", "user": {"login": "greshilov", "id": 814614, "node_id": "MDQ6VXNlcjgxNDYxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/814614?v=4", "gravatar_id": "", "url": "https://api.github.com/users/greshilov", "html_url": "https://github.com/greshilov", "followers_url": "https://api.github.com/users/greshilov/followers", "following_url": "https://api.github.com/users/greshilov/following{/other_user}", "gists_url": "https://api.github.com/users/greshilov/gists{/gist_id}", "starred_url": "https://api.github.com/users/greshilov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/greshilov/subscriptions", "organizations_url": "https://api.github.com/users/greshilov/orgs", "repos_url": "https://api.github.com/users/greshilov/repos", "events_url": "https://api.github.com/users/greshilov/events{/privacy}", "received_events_url": "https://api.github.com/users/greshilov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2021-05-04T18:40:34Z", "updated_at": "2021-06-22T19:34:26Z", "closed_at": "2021-05-05T00:00:26Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\n\r\nSince March 2021 workflows that are triggered by Dependabot are treated as they were opened from forks.\r\nThus, `secrets` context is not available for them, and that's why `Autosquash` job fails again and again for the Dependabot PRs.\r\n\r\nRead more on that topic [here](https://github.blog/changelog/2021-02-19-github-actions-workflows-triggered-by-dependabot-prs-will-run-with-read-only-permissions/).\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\n\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\nSee  #5664,  #5663 and others.\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\nShould work, maybe without `Autosquash` functionality.\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```\r\nRun tibdex/github-app-token@v1\r\nError: Error: Input required and not supplied: app_id\r\n```", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5665/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5665/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5659", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5659/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5659/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5659/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5659", "id": 873685857, "node_id": "MDU6SXNzdWU4NzM2ODU4NTc=", "number": 5659, "title": "Redirects do not use cookies from the main request's response", "user": {"login": "IamMusavaRibica", "id": 65848142, "node_id": "MDQ6VXNlcjY1ODQ4MTQy", "avatar_url": "https://avatars.githubusercontent.com/u/65848142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/IamMusavaRibica", "html_url": "https://github.com/IamMusavaRibica", "followers_url": "https://api.github.com/users/IamMusavaRibica/followers", "following_url": "https://api.github.com/users/IamMusavaRibica/following{/other_user}", "gists_url": "https://api.github.com/users/IamMusavaRibica/gists{/gist_id}", "starred_url": "https://api.github.com/users/IamMusavaRibica/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/IamMusavaRibica/subscriptions", "organizations_url": "https://api.github.com/users/IamMusavaRibica/orgs", "repos_url": "https://api.github.com/users/IamMusavaRibica/repos", "events_url": "https://api.github.com/users/IamMusavaRibica/events{/privacy}", "received_events_url": "https://api.github.com/users/IamMusavaRibica/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2021-05-01T14:21:19Z", "updated_at": "2022-02-19T12:47:27Z", "closed_at": "2022-02-19T12:47:26Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nSending a request that has redirects updates the cookies at the end of all redirects instead of immediately after the redirect (the old session cookies apply to all the redirects in the request)\r\n\r\nReal example:\r\nHaving a ClientSession and sending a GET request to specific website sets some cookies.\r\nNext request that is to be done with that session is a POST which is used to log in. It has to send the cookies from the first response. This request is a redirect, however after the first redirect server returns a new cookie with the **same keys** but **different values**. That new cookie has to be used in the redirect The aiohttp request just uses the old cookies from the first GET request and therefore the request fails.\r\nThe synchronous `requests` library does that correctly, though. \r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\nI cannot make full reproducing steps here because it involves passing some private data but my messages are open to aiohttp's devs.\r\n```python\r\nfrom aiohttp import ClientSession\r\nimport asyncio\r\nfrom bs4 import BeautifulSoup\r\n\r\nurl = \"https://ocjene.skole.hr/\"\r\n\r\nasync def main():\r\n    session = ClientSession()\r\n    r1 = await session.get(url + \"login\")\r\n    # The csrf token that is retrieved from the html form\r\n    csrf = BeautifulSoup(await r1.text(), 'html.parser')(\"input\", limit=3)[2][\"value\"]\r\n    data = {\"username\": \"foo\", \"password\": \"bar\", \"csrf_token\": csrf}\r\n\r\n    # Convert session cookies to a dictionary\r\n    cookies = {}\r\n    for c in session.cookie_jar:\r\n        cookies[c.key] = c.value\r\n\r\n    r2 = await session.post(url, data=data, cookies=cookies)\r\n    print(await r2.text())\r\n    await session.close()\r\n\r\nloop = asyncio.get_event_loop()\r\nloop.run_until_complete(main())\r\n```\r\nSince the second request (r2) consists of several redirects, the first request should modify the session's cookies which will be passed in the next redirects.\r\n[![Chrome Dev tools Network tab request screenshot](https://image.prntscr.com/image/mTYbkISNTZ_XSJAOrFHP-w.png)](https://image.prntscr.com/image/mTYbkISNTZ_XSJAOrFHP-w.png)\r\n\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\nSince the second request (r2) consists of several redirects, the first request should modify the session's cookies which will be passed in the next redirects, but those cookies update after **all** redirects. (Checked with `session.cookie_jar` before and after r2)\r\nCancelling redirects and making a third request manually that would be the same as the redirect works:\r\n```python\r\nr2 = await session.post(url, data=data, headers=r1headers, allow_redirects=False)\r\n# Modifying the old cookie with the new one\r\ncookies[\"cnOcjene\"] = dict(r2.cookies)[\"cnOcjene\"].value\r\n\r\n# url + 'class' is the URL of the first redirect in before example\r\nr3 = await session.get(url + 'class', cookies=cookies)\r\nprint(await r3.text())  # correct\r\n```\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\n\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.8.6\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.6.3\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\users\\iammusavaribica\\appdata\\local\\programs\\python\\python38\\lib\\site-packages\r\nRequires: chardet, async-timeout, attrs, yarl, multidict\r\nRequired-by: fortnitepy, discord.py\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.6\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\users\\iammusavaribica\\appdata\\local\\programs\\python\\python38\\lib\\site-packages\r\nRequires:\r\nRequired-by: yarl, aioxmpp, aiohttp\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.5.1\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\users\\iammusavaribica\\appdata\\local\\programs\\python\\python38\\lib\\site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5659/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5659/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5658", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5658/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5658/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5658/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5658", "id": 872683069, "node_id": "MDU6SXNzdWU4NzI2ODMwNjk=", "number": 5658, "title": "AttributeError: 'ClientSession' object has no attribute '_connector' on Google Dataproc", "user": {"login": "gndumbri", "id": 3864120, "node_id": "MDQ6VXNlcjM4NjQxMjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3864120?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gndumbri", "html_url": "https://github.com/gndumbri", "followers_url": "https://api.github.com/users/gndumbri/followers", "following_url": "https://api.github.com/users/gndumbri/following{/other_user}", "gists_url": "https://api.github.com/users/gndumbri/gists{/gist_id}", "starred_url": "https://api.github.com/users/gndumbri/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gndumbri/subscriptions", "organizations_url": "https://api.github.com/users/gndumbri/orgs", "repos_url": "https://api.github.com/users/gndumbri/repos", "events_url": "https://api.github.com/users/gndumbri/events{/privacy}", "received_events_url": "https://api.github.com/users/gndumbri/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-04-30T15:09:10Z", "updated_at": "2021-05-01T14:19:53Z", "closed_at": "2021-05-01T14:19:53Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nAttributeError: 'ClientSession' object has no attribute '_connector' \r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\n\r\n\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\n```\r\nimport pandas as pd\r\nimport numpy as np\r\nfrom sklearn.metrics.pairwise import cosine_similarity\r\nfrom sklearn.feature_extraction.text import TfidfVectorizer\r\nfrom sklearn.linear_model import LinearRegression\r\nfrom sklearn.metrics import r2_score\r\nimport scipy\r\nfrom scipy.sparse import csr_matrix\r\nimport pyspark\r\nfrom pyspark.sql import SparkSession\r\nimport sys\r\nimport time\r\nfrom datetime import datetime, date\r\n\r\ndef tfidf(path):\r\n    if '.csv' in path:\r\n        diags = pd.read_csv(path)\r\n    else:\r\n        diags = pd.read_parquet(path)\r\n\r\n    diags.dropna(inplace=True)\r\n\r\n    hicnos = diags['hicno'].unique().tolist()\r\n\r\n    diags['diags'] = (diags['diag']+' ')*diags['clm_cnt']\r\n    diags = pd.DataFrame(diags.groupby('hicno', sort=False)['diags'].apply(lambda x: x.tolist()))\r\n    diags.reset_index(inplace=True)\r\n    diags['diags'] = diags['diags'].apply(lambda x: ''.join(x).rstrip())\r\n\r\n    vectorizer = TfidfVectorizer(dtype=np.float32)\r\n    return hicnos, vectorizer.fit_transform(diags['diags'].tolist())\r\n\r\npath = sys.argv[1] # a gs://google-storage-bucket/file.csv link is what is given as sys.argv[1] in the pyspark jobs submit \r\n\r\ndf = tfidf(path)\r\n\r\n```\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\n\r\nAs of 4/20/21 my csv file would load as expected and there was no error. I have run this same code in a Google Colab notebook without error. The python version in the Colab notebook is  3.7. The python version is the only difference I see between the code that causes and error and the code that works as expected. The code I provided above causes the error whether my csv file is from an s3 or google storage bucket on Google Dataproc.  Python version is 3.8.8 on Google Compute Engine VM instance.\r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\nJob [6282a0c4e4be42ac87d678d43a2e520c] submitted.\r\nWaiting for job output...\r\nException ignored in: <function ClientSession.__del__ at 0x7f6880aef550>\r\nTraceback (most recent call last):\r\n  File \"/opt/conda/default/lib/python3.8/site-packages/aiohttp/client.py\", line 326, in __del__\r\n    if not self.closed:\r\n  File \"/opt/conda/default/lib/python3.8/site-packages/aiohttp/client.py\", line 963, in closed\r\n    return self._connector is None or self._connector.closed\r\nAttributeError: 'ClientSession' object has no attribute '_connector'\r\nTraceback (most recent call last):\r\n  File \"/tmp/6282a0c4e4be42ac87d678d43a2e520c/rap5.py\", line 221, in <module>\r\n    hicnos, x = tfidf(path)\r\n  File \"/tmp/6282a0c4e4be42ac87d678d43a2e520c/rap5.py\", line 21, in tfidf\r\n    diags = pd.read_csv(path).dropna()\r\n  File \"/opt/conda/default/lib/python3.8/site-packages/pandas/io/parsers.py\", line 610, in read_csv\r\n    return _read(filepath_or_buffer, kwds)\r\n  File \"/opt/conda/default/lib/python3.8/site-packages/pandas/io/parsers.py\", line 462, in _read\r\n    parser = TextFileReader(filepath_or_buffer, **kwds)\r\n  File \"/opt/conda/default/lib/python3.8/site-packages/pandas/io/parsers.py\", line 819, in __init__\r\n    self._engine = self._make_engine(self.engine)\r\n  File \"/opt/conda/default/lib/python3.8/site-packages/pandas/io/parsers.py\", line 1050, in _make_engine\r\n    return mapping[engine](self.f, **self.options)  # type: ignore[call-arg]\r\n  File \"/opt/conda/default/lib/python3.8/site-packages/pandas/io/parsers.py\", line 1867, in __init__\r\n    self._open_handles(src, kwds)\r\n  File \"/opt/conda/default/lib/python3.8/site-packages/pandas/io/parsers.py\", line 1362, in _open_handles\r\n    self.handles = get_handle(\r\n  File \"/opt/conda/default/lib/python3.8/site-packages/pandas/io/common.py\", line 558, in get_handle\r\n    ioargs = _get_filepath_or_buffer(\r\n  File \"/opt/conda/default/lib/python3.8/site-packages/pandas/io/common.py\", line 333, in _get_filepath_or_buffer\r\n    file_obj = fsspec.open(\r\n  File \"/opt/conda/default/lib/python3.8/site-packages/fsspec/core.py\", line 428, in open\r\n    return open_files(\r\n  File \"/opt/conda/default/lib/python3.8/site-packages/fsspec/core.py\", line 280, in open_files\r\n    fs, fs_token, paths = get_fs_token_paths(\r\n  File \"/opt/conda/default/lib/python3.8/site-packages/fsspec/core.py\", line 608, in get_fs_token_paths\r\n    fs = cls(**options)\r\n  File \"/opt/conda/default/lib/python3.8/site-packages/fsspec/spec.py\", line 69, in __call__\r\n    obj = super().__call__(*args, **kwargs)\r\n  File \"/opt/conda/default/lib/python3.8/site-packages/gcsfs/core.py\", line 269, in __init__\r\n    self._session = sync(\r\n  File \"/opt/conda/default/lib/python3.8/site-packages/fsspec/asyn.py\", line 53, in sync\r\n    raise result[0]\r\n  File \"/opt/conda/default/lib/python3.8/site-packages/fsspec/asyn.py\", line 20, in _runner\r\n    result[0] = await coro\r\n  File \"/opt/conda/default/lib/python3.8/site-packages/fsspec/implementations/http.py\", line 25, in get_client\r\n    return aiohttp.ClientSession(**kwargs)\r\nTypeError: __init__() got an unexpected keyword argument 'callback_timeout'\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n\r\n```console\r\nPython 3.8.8\r\n$ python --version\r\n...\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n3.7.4\r\n$ python -m pip show aiohttp\r\n...\r\n```\r\n```console\r\n5.1.0\r\n$ python -m pip show multidict\r\n...\r\n```\r\n```console\r\n1.6.3\r\n$ python -m pip show yarl\r\n...\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\nPython 3.8.8\r\nPyspark 3.1.1\r\nfsspec 0.9.0\r\ngcsfs 0.7.2\r\n2.0.9-debian10 master node for cluster\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5658/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5658/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5657", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5657/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5657/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5657/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5657", "id": 871299827, "node_id": "MDU6SXNzdWU4NzEyOTk4Mjc=", "number": 5657, "title": "Raising a HTTPUnauthorized caused error after upgrading from 3.6.2 to 3.7.4.post0", "user": {"login": "teslafields", "id": 24792806, "node_id": "MDQ6VXNlcjI0NzkyODA2", "avatar_url": "https://avatars.githubusercontent.com/u/24792806?v=4", "gravatar_id": "", "url": "https://api.github.com/users/teslafields", "html_url": "https://github.com/teslafields", "followers_url": "https://api.github.com/users/teslafields/followers", "following_url": "https://api.github.com/users/teslafields/following{/other_user}", "gists_url": "https://api.github.com/users/teslafields/gists{/gist_id}", "starred_url": "https://api.github.com/users/teslafields/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/teslafields/subscriptions", "organizations_url": "https://api.github.com/users/teslafields/orgs", "repos_url": "https://api.github.com/users/teslafields/repos", "events_url": "https://api.github.com/users/teslafields/events{/privacy}", "received_events_url": "https://api.github.com/users/teslafields/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1577406386, "node_id": "MDU6TGFiZWwxNTc3NDA2Mzg2", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/regression", "name": "regression", "color": "c62b3b", "default": false, "description": "Something that used to work stopped working \"as before\" after upgrade"}, {"id": 1831256427, "node_id": "MDU6TGFiZWwxODMxMjU2NDI3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/reproducer:%20present", "name": "reproducer: present", "color": "c2e0c6", "default": false, "description": "This PR or issue contains code, which reproduce the problem described or clearly understandable STR"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2021-04-29T18:09:53Z", "updated_at": "2021-06-07T17:47:42Z", "closed_at": "2021-06-07T17:47:42Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nRaising a HTTPUnauthorized with a body=\"string\" is giving an exception, as you can see in the traceback. This started to happen after I've upgraded from 3.6.2 to 3.7.4.post0. Looks to me that, as the body I return is **str**, it creates a StringPayload and still it tries to decode() it as it was **bytes-like** object\r\n\r\nMy piece of code that works in 3.6.2: `raise web.HTTPUnauthorized(body='Not logged in')`\r\nWorkaround to work in 3.7.4.post0: `raise web.HTTPUnauthorized(body=b'Not logged in')`\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\n\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\n1. Try to raise a HTTPUnauthorized with a string body\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\nTraceback (most recent call last):\r\n  File \"aiohttp/web_protocol.py\", line 422, in _handle_request\r\n  File \"aiohttp/web_app.py\", line 499, in _handle\r\n  File \"aiohttp/web_middlewares.py\", line 119, in impl\r\n  File \"aiohttp_session/__init__.py\", line 172, in factory\r\n  File \"aiohttp_session/__init__.py\", line 154, in factory\r\n  File \"http_server.py\", line 1869, in route_get_info\r\n  File \"http_server.py\", line 461, in validate_identity\r\naiohttp.web_exceptions.HTTPUnauthorized: Unauthorized\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"aiohttp/web_protocol.py\", line 485, in start\r\n  File \"aiohttp/web_protocol.py\", line 427, in _handle_request\r\n  File \"aiohttp/web_response.py\", line 650, in text\r\nAttributeError: 'StringPayload' object has no attribute 'decode'\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.8.0\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\naiohttp==3.7.4.post0\r\naiohttp-jinja2==1.4.2\r\naiohttp-security==0.4.0\r\naiohttp-session==2.9.0\r\nmultidict==5.1.0\r\nyarl==1.6.3\r\n```", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5657/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5657/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5648", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5648/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5648/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5648/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5648", "id": 867413013, "node_id": "MDU6SXNzdWU4Njc0MTMwMTM=", "number": 5648, "title": "Problems with pip upgrade on windows", "user": {"login": "greshilov", "id": 814614, "node_id": "MDQ6VXNlcjgxNDYxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/814614?v=4", "gravatar_id": "", "url": "https://api.github.com/users/greshilov", "html_url": "https://github.com/greshilov", "followers_url": "https://api.github.com/users/greshilov/followers", "following_url": "https://api.github.com/users/greshilov/following{/other_user}", "gists_url": "https://api.github.com/users/greshilov/gists{/gist_id}", "starred_url": "https://api.github.com/users/greshilov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/greshilov/subscriptions", "organizations_url": "https://api.github.com/users/greshilov/orgs", "repos_url": "https://api.github.com/users/greshilov/repos", "events_url": "https://api.github.com/users/greshilov/events{/privacy}", "received_events_url": "https://api.github.com/users/greshilov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-04-26T08:19:47Z", "updated_at": "2021-04-26T14:06:23Z", "closed_at": "2021-04-26T14:06:23Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nWe use the following command to update pip, but looks like it doesn't work on windows machines.\r\n```\r\npip install -U 'pip'\r\n```\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\n\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\nTry to run `make install` on windows machine with old pip.\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\nRequirement already satisfied: pip in c:\\hostedtoolcache\\windows\\python\\3.6.8\\x64\\lib\\site-packages (21.0.1)\r\nCollecting pip\r\n  Downloading pip-21.1-py3-none-any.whl (1.5 MB)\r\nInstalling collected packages: pip\r\n  Attempting uninstall: pip\r\n    Found existing installation: pip 21.0.1\r\n    Uninstalling pip-21.0.1:\r\n      Successfully uninstalled pip-21.0.1\r\nERROR: Could not install packages due to an OSError: [WinError 5] Access is denied: 'C:\\\\Users\\\\RUNNER~1\\\\AppData\\\\Local\\\\Temp\\\\pip-uninstall-2oiyo4b8\\\\pip.exe'\r\nConsider using the `--user` option or check the permissions.\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.9.3\r\n```\r\n\r\n**Possible solution**\r\nUse the command suggested in official pip docs:\r\nhttps://pip.pypa.io/en/stable/installing/#upgrading-pip \r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5648/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5648/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5624", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5624/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5624/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5624/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5624", "id": 859536057, "node_id": "MDU6SXNzdWU4NTk1MzYwNTc=", "number": 5624, "title": "Forbidden error raised by aiohttp used in dask-gateway", "user": {"login": "aravindrp", "id": 29331442, "node_id": "MDQ6VXNlcjI5MzMxNDQy", "avatar_url": "https://avatars.githubusercontent.com/u/29331442?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aravindrp", "html_url": "https://github.com/aravindrp", "followers_url": "https://api.github.com/users/aravindrp/followers", "following_url": "https://api.github.com/users/aravindrp/following{/other_user}", "gists_url": "https://api.github.com/users/aravindrp/gists{/gist_id}", "starred_url": "https://api.github.com/users/aravindrp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aravindrp/subscriptions", "organizations_url": "https://api.github.com/users/aravindrp/orgs", "repos_url": "https://api.github.com/users/aravindrp/repos", "events_url": "https://api.github.com/users/aravindrp/events{/privacy}", "received_events_url": "https://api.github.com/users/aravindrp/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1831255463, "node_id": "MDU6TGFiZWwxODMxMjU1NDYz", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/reproducer:%20missing", "name": "reproducer: missing", "color": "e23c36", "default": false, "description": "This PR or issue lacks code, which reproduce the problem described or clearly understandable STR"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-04-16T07:15:48Z", "updated_at": "2021-04-16T09:41:32Z", "closed_at": "2021-04-16T09:41:31Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nI am trying to setup dask-gateway in kubernetes and it uses aiohttp internally for connecting with api server. While trying to connect with dask-gateway from a jupyter notebook, I am getting the following error:\r\n\r\n![image](https://user-images.githubusercontent.com/29331442/114976921-6918f300-9ea4-11eb-8594-fb2900dfe638.png)\r\n\r\napi server is hosted in another namespace within the same kubernetes cluster. First I thought that it was an issue with k8 setup or dask-gateway. But the same code worked, when I tried to curl the same url. Also from the same jupter notebook I tried to connect with url using urllib3 library then also it worked without any issues. So it seems like a behavior related to aiohttp.\r\n\r\n![image](https://user-images.githubusercontent.com/29331442/114977011-94034700-9ea4-11eb-9454-f360eb9fc9db.png)\r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\n\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\n\r\n---------------------------------------------------------------------------\r\nClientResponseError                       Traceback (most recent call last)\r\n<ipython-input-8-f8cbd85b6152> in <module>\r\n----> 1 gateway.list_clusters()\r\n\r\n/opt/conda/lib/python3.7/site-packages/dask_gateway/client.py in list_clusters(self, status, **kwargs)\r\n    453         clusters : list of ClusterReport\r\n    454         \"\"\"\r\n--> 455         return self.sync(self._clusters, status=status, **kwargs)\r\n    456 \r\n    457     def get_cluster(self, cluster_name, **kwargs):\r\n\r\n/opt/conda/lib/python3.7/site-packages/dask_gateway/client.py in sync(self, func, *args, **kwargs)\r\n    341             )\r\n    342             try:\r\n--> 343                 return future.result()\r\n    344             except BaseException:\r\n    345                 future.cancel()\r\n\r\n/opt/conda/lib/python3.7/concurrent/futures/_base.py in result(self, timeout)\r\n    433                 raise CancelledError()\r\n    434             elif self._state == FINISHED:\r\n--> 435                 return self.__get_result()\r\n    436             else:\r\n    437                 raise TimeoutError()\r\n\r\n/opt/conda/lib/python3.7/concurrent/futures/_base.py in __get_result(self)\r\n    382     def __get_result(self):\r\n    383         if self._exception:\r\n--> 384             raise self._exception\r\n    385         else:\r\n    386             return self._result\r\n\r\n/opt/conda/lib/python3.7/site-packages/dask_gateway/client.py in _clusters(self, status)\r\n    432 \r\n    433         url = \"%s/api/v1/clusters/%s\" % (self.address, query)\r\n--> 434         resp = await self._request(\"GET\", url)\r\n    435         data = await resp.json()\r\n    436         return [\r\n\r\n/opt/conda/lib/python3.7/site-packages/dask_gateway/client.py in _request(self, method, url, json)\r\n    417                 raise GatewayServerError(msg)\r\n    418             else:\r\n--> 419                 resp.raise_for_status()\r\n    420         else:\r\n    421             return resp\r\n\r\n/opt/conda/lib/python3.7/site-packages/aiohttp/client_reqrep.py in raise_for_status(self)\r\n   1003                 status=self.status,\r\n   1004                 message=self.reason,\r\n-> 1005                 headers=self.headers,\r\n   1006             )\r\n   1007 \r\n\r\nClientResponseError: 403, message='Forbidden', url=URL('http://dask-gateway.<namespace>.svc:8000/api/v1/clusters/')\r\n\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\n...\r\n\r\npython version - 3.7.9\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\n...\r\n\r\naiohttp version : 3.7.2\r\n```\r\n\r\n```console\r\n$ python -m pip show multidict\r\n...\r\n```\r\n```console\r\n$ python -m pip show yarl\r\n...\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5624/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5624/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5616", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5616/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5616/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5616/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5616", "id": 857061748, "node_id": "MDU6SXNzdWU4NTcwNjE3NDg=", "number": 5616, "title": "Webserver crashes when a client connects using HTTPS", "user": {"login": "Aed3r", "id": 29704944, "node_id": "MDQ6VXNlcjI5NzA0OTQ0", "avatar_url": "https://avatars.githubusercontent.com/u/29704944?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aed3r", "html_url": "https://github.com/Aed3r", "followers_url": "https://api.github.com/users/Aed3r/followers", "following_url": "https://api.github.com/users/Aed3r/following{/other_user}", "gists_url": "https://api.github.com/users/Aed3r/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aed3r/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aed3r/subscriptions", "organizations_url": "https://api.github.com/users/Aed3r/orgs", "repos_url": "https://api.github.com/users/Aed3r/repos", "events_url": "https://api.github.com/users/Aed3r/events{/privacy}", "received_events_url": "https://api.github.com/users/Aed3r/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2021-04-13T15:13:03Z", "updated_at": "2021-04-16T09:50:52Z", "closed_at": "2021-04-13T19:04:28Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nI set up a simple HTTP web server using aiohttp. Since it doesn't need secure communications with it's clients I didn't set up SSL. Unfortunately, this means that as soon as someone tries connecting using HTTPS the program crashes. The crash report indicates this happens entirely inside aiohttp, so I see no way of handling this in my program.\r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n\r\n1. Create a simple server. Eg :\r\n```python\r\nfrom aiohttp import web\r\n\r\nasync def hello(request):\r\n    return web.Response(text=\"Hello, world\")\r\n\r\napp = web.Application()\r\napp.add_routes([web.get('/', hello)])\r\n\r\nweb.run_app(app)\r\n```\r\n\r\n2. Run the program and go to `https://0.0.0.0:8080/`\r\n\r\n3. The server crashes with :\r\n```python-traceback\r\nError handling request\r\nTraceback (most recent call last):\r\n  File \"/home/aeder/.local/lib/python3.9/site-packages/aiohttp/web_protocol.py\", line 314, in data_received\r\n    messages, upgraded, tail = self._request_parser.feed_data(data)\r\n  File \"aiohttp/_http_parser.pyx\", line 546, in aiohttp._http_parser.HttpParser.feed_data\r\naiohttp.http_exceptions.BadStatusLine: 400, message=\"Bad status line 'invalid HTTP method'\"`\r\n```\r\n\r\n\ud83d\udca1 **Expected behavior**\r\nNot immediately crashing, or having a way to catch the error without setting up HTTPS\r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n\r\n```python-traceback\r\nError handling request\r\nTraceback (most recent call last):\r\n  File \"/home/aeder/.local/lib/python3.9/site-packages/aiohttp/web_protocol.py\", line 314, in data_received\r\n    messages, upgraded, tail = self._request_parser.feed_data(data)\r\n  File \"aiohttp/_http_parser.pyx\", line 546, in aiohttp._http_parser.HttpParser.feed_data\r\naiohttp.http_exceptions.BadStatusLine: 400, message=\"Bad status line 'invalid HTTP method'\"\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.9.2\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.4.post0\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/aeder/.local/lib/python3.9/site-packages\r\nRequires: chardet, typing-extensions, multidict, attrs, async-timeout, yarl\r\nRequired-by: \r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.1.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/aeder/.local/lib/python3.9/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.3\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/aeder/.local/lib/python3.9/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\nOS: Manjaro\r\nNo proxy\r\naiohttp server framework\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5616/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5616/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5606", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5606/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5606/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5606/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5606", "id": 855304416, "node_id": "MDU6SXNzdWU4NTUzMDQ0MTY=", "number": 5606, "title": "Autobahn test needs updating", "user": {"login": "Dreamsorcerer", "id": 2203121, "node_id": "MDQ6VXNlcjIyMDMxMjE=", "avatar_url": "https://avatars.githubusercontent.com/u/2203121?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dreamsorcerer", "html_url": "https://github.com/Dreamsorcerer", "followers_url": "https://api.github.com/users/Dreamsorcerer/followers", "following_url": "https://api.github.com/users/Dreamsorcerer/following{/other_user}", "gists_url": "https://api.github.com/users/Dreamsorcerer/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dreamsorcerer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dreamsorcerer/subscriptions", "organizations_url": "https://api.github.com/users/Dreamsorcerer/orgs", "repos_url": "https://api.github.com/users/Dreamsorcerer/repos", "events_url": "https://api.github.com/users/Dreamsorcerer/events{/privacy}", "received_events_url": "https://api.github.com/users/Dreamsorcerer/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 277836062, "node_id": "MDU6TGFiZWwyNzc4MzYwNjI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/good%20first%20issue", "name": "good first issue", "color": "7057ff", "default": true, "description": "Good for newcomers"}, {"id": 1077350962, "node_id": "MDU6TGFiZWwxMDc3MzUwOTYy", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/Hacktoberfest", "name": "Hacktoberfest", "color": "d93f0b", "default": false, "description": "We think it's good for https://hacktoberfest.digitalocean.com/"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-04-11T13:15:03Z", "updated_at": "2021-05-16T16:49:08Z", "closed_at": "2021-05-16T16:49:08Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The `_make_handler()` method was removed in this PR: https://github.com/aio-libs/aiohttp/pull/3939\r\n\r\nBut, is still used at: https://github.com/aio-libs/aiohttp/blob/master/tests/autobahn/server.py#L37\r\n\r\nThis needs updating, if anybody would like to take on this small task.\r\n\r\nReferences to `aiohttp.ws_connect()` appear to also need updating:\r\nhttps://github.com/aio-libs/aiohttp/blob/master/tests/autobahn/client.py#L9", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5606/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5606/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5604", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5604/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5604/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5604/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5604", "id": 854417196, "node_id": "MDU6SXNzdWU4NTQ0MTcxOTY=", "number": 5604, "title": "Unable to install with speedups in CPython 3.10.0-alpha-7 due to failures with pycares", "user": {"login": "davfsa", "id": 29100934, "node_id": "MDQ6VXNlcjI5MTAwOTM0", "avatar_url": "https://avatars.githubusercontent.com/u/29100934?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davfsa", "html_url": "https://github.com/davfsa", "followers_url": "https://api.github.com/users/davfsa/followers", "following_url": "https://api.github.com/users/davfsa/following{/other_user}", "gists_url": "https://api.github.com/users/davfsa/gists{/gist_id}", "starred_url": "https://api.github.com/users/davfsa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davfsa/subscriptions", "organizations_url": "https://api.github.com/users/davfsa/orgs", "repos_url": "https://api.github.com/users/davfsa/repos", "events_url": "https://api.github.com/users/davfsa/events{/privacy}", "received_events_url": "https://api.github.com/users/davfsa/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2021-04-09T11:00:59Z", "updated_at": "2021-04-23T15:32:32Z", "closed_at": "2021-04-23T15:32:32Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nWhen installing aiohttp with speedupds, it installs `aiodns`, which itself relies on `pycares`. These two libs are currently unmaintained as stated here: https://github.com/saghul/pycares/issues/139. This will make installing aiohttp with speedups impossible in CPython 3.10. \r\n\r\n\ud83d\udca1 **To Reproduce**\r\nInstall CPython 3.10 and try to install aiohttp with speedups.\r\n\r\nExamples:\r\n- https://github.com/hikari-py/hikari/pull/516/checks?check_run_id=2305172086 (Linux)\r\n- https://github.com/hikari-py/hikari/pull/516/checks?check_run_id=2305172150 (MacOS)\r\n- https://github.com/hikari-py/hikari/pull/516/checks?check_run_id=2305172240 (Windows)\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\nInstallation with speedups succeeds. This might require looking for a different package or maintaining that package.\r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\nCheck links above\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n```console\r\n$ python --version\r\nPython 3.10.0a7\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\nUnable to install, but the version that we are trying to install is `3.7.4.post0`\r\n\r\n\ud83d\udccb **Additional context**\r\nNone\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5604/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5604/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5599", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5599/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5599/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5599/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5599", "id": 852131032, "node_id": "MDU6SXNzdWU4NTIxMzEwMzI=", "number": 5599, "title": "AioHttp gets an error for a page that requests can access without problem", "user": {"login": "Mattlau04", "id": 37871312, "node_id": "MDQ6VXNlcjM3ODcxMzEy", "avatar_url": "https://avatars.githubusercontent.com/u/37871312?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mattlau04", "html_url": "https://github.com/Mattlau04", "followers_url": "https://api.github.com/users/Mattlau04/followers", "following_url": "https://api.github.com/users/Mattlau04/following{/other_user}", "gists_url": "https://api.github.com/users/Mattlau04/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mattlau04/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mattlau04/subscriptions", "organizations_url": "https://api.github.com/users/Mattlau04/orgs", "repos_url": "https://api.github.com/users/Mattlau04/repos", "events_url": "https://api.github.com/users/Mattlau04/events{/privacy}", "received_events_url": "https://api.github.com/users/Mattlau04/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-04-07T08:01:40Z", "updated_at": "2021-04-07T10:52:54Z", "closed_at": "2021-04-07T10:52:54Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nAioHttp gets an error for a page that requests can access without problem\r\n\r\n\ud83d\udca1 **To Reproduce**\r\nrun the following code:\r\n```py\r\nasync with aiohttp.ClientSession() as session:\r\n    async with session.get(\"https://images-ext-2.discordapp.net/external/Z_CwC1okQAqpckGQwR1eKJ1_IsslKIfd7vcnShRCD1g/https/pbs.twimg.com/media/EySPEwzUYAYVboD.jpg%3Alarge\") as resp: \r\n        print(resp.status)\r\nprint(requests.get(\"https://images-ext-2.discordapp.net/external/Z_CwC1okQAqpckGQwR1eKJ1_IsslKIfd7vcnShRCD1g/https/pbs.twimg.com/media/EySPEwzUYAYVboD.jpg%3Alarge\").status_code  )\r\n```\r\n\r\nrequests will give a 200 and aiohttp a 401\r\nhowever, doing\r\n```py\r\nprint(requests.get(\"https://images-ext-2.discordapp.net/external/Z_CwC1okQAqpckGQwR1eKJ1_IsslKIfd7vcnShRCD1g/https/pbs.twimg.com/media/EySPEwzUYAYVboD.jpg:large\").status_code  )\r\n```\r\ngives a 401, so i'm suspecting aiohttp is decoding the url and that's what make it not work\r\n\r\n\ud83d\udca1 **Expected behavior**\r\naiohttp giving the correct 200 response\r\n\r\n\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n\r\n3.9.1\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n\r\naiohttp: 3.7.4.post0\r\n\r\nmultidict: 4.7.6\r\n\r\nyarl: 1.5.1\r\n\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n    i'm on windows 10, and using aiohttp as client", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5599/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5599/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5584", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5584/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5584/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5584/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5584", "id": 849155272, "node_id": "MDU6SXNzdWU4NDkxNTUyNzI=", "number": 5584, "title": "Unexpected client timeouts (race condition processing chunked responses?)", "user": {"login": "pbumbulis", "id": 525907, "node_id": "MDQ6VXNlcjUyNTkwNw==", "avatar_url": "https://avatars.githubusercontent.com/u/525907?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pbumbulis", "html_url": "https://github.com/pbumbulis", "followers_url": "https://api.github.com/users/pbumbulis/followers", "following_url": "https://api.github.com/users/pbumbulis/following{/other_user}", "gists_url": "https://api.github.com/users/pbumbulis/gists{/gist_id}", "starred_url": "https://api.github.com/users/pbumbulis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pbumbulis/subscriptions", "organizations_url": "https://api.github.com/users/pbumbulis/orgs", "repos_url": "https://api.github.com/users/pbumbulis/repos", "events_url": "https://api.github.com/users/pbumbulis/events{/privacy}", "received_events_url": "https://api.github.com/users/pbumbulis/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-04-02T11:07:37Z", "updated_at": "2021-06-27T14:28:35Z", "closed_at": "2021-06-27T14:28:34Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nWhen issuing requests to a Kubernetes API server requests sometimes time out for no explicable reason.  The request that timed out was processed but the response was not acted on.\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\n\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\nTo date the most reliable repro has been to run k3s (https://github.com/k3s-io/k3s/releases/download/v1.20.5%2Bk3s1/k3s) in docker on macos, with flags set to disable everything but API server.  Then start issuing post requests to create resources but without awaiting response.text() or response.json() to materialize the body of the response.  On average, every third to fifth run usually fails (a post request will time out after about 20 or so successful post requests).  The posts are issued sequentially by a single task (with nothing else active in the python instance).  Pretty much every aiohttp parameter that has a default was left that way.  Simply modifying the loop to await .text() after awaiting the response is enough to fix things in the test (I have not seen any timeouts when run this way).\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\nAll post requests to succeed without a time out.\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```\r\n* dtrace trace from instrumented python starting from parameter building for failing session.request\r\n* script used is https://github.com/paulross/dtrace-py/blob/master/d_demo/a_py_flowinfo.d\r\n* trace is from a single task that does posts sequentially (nothing else active)\r\n* the feed_eof processing is different than for requests that succeed\r\n\r\n8  66611         29            k8s.py:125  func                     -> create\r\n8  66611         21            k8s.py:163  func                       -> endpoint_for_create\r\n8  66611         24         addict.py:66   func                         -> __getattr__\r\n8  66611         25         addict.py:67   func                         <- __getattr__\r\n8  66611         42         addict.py:66   func                         -> __getattr__\r\n8  66611         26         addict.py:67   func                         <- __getattr__\r\n8  66611         29         addict.py:66   func                         -> __getattr__\r\n8  66611         25         addict.py:67   func                         <- __getattr__\r\n8  66611         36            k8s.py:153  func                         -> endpoint_for_collection\r\n8  66611         28            k8s.py:156  func                         <- endpoint_for_collection\r\n8  66611         25            k8s.py:164  func                       <- endpoint_for_create\r\n8  66611         29       __init__.py:183  func                       -> dumps\r\n8  66611         32        encoder.py:182  func                         -> encode\r\n8  66611         29        encoder.py:204  func                           -> iterencode\r\n8  66611        108        encoder.py:257  func                           <- iterencode\r\n8  66611         38        encoder.py:202  func                         <- encode\r\n8  66611         27       __init__.py:231  func                       <- dumps\r\n8  66611         27            k8s.py:97   func                       -> call_api\r\n8  66611         31         client.py:339  func                         -> request\r\n8  66611         33         client.py:1097 func                           -> __init__\r\n8  66611         28         client.py:1098 func                           <- __init__\r\n8  66611         23         client.py:343  func                         <- request\r\n8  66611         24            k8s.py:116  func                       <- call_api\r\n8  66611         22         client.py:1109 func                       -> __await__\r\n8  66611         32         client.py:1111 func                       <- __await__\r\n8  66611         21         client.py:345  func                       -> _request\r\n8  66611         28         client.py:957  func                         -> closed\r\n8  66611         32      connector.py:444  func                           -> closed\r\n8  66611         24      connector.py:450  func                           <- closed\r\n8  66611         30         client.py:963  func                         <- closed\r\n8  66611         28  client_reqrep.py:146  func                         -> _merge_ssl_params\r\n8  66611         38  client_reqrep.py:196  func                         <- _merge_ssl_params\r\n8  66611         34         client.py:875  func                         -> _prepare_headers\r\n8  66611         54         client.py:889  func                         <- _prepare_headers\r\n8  66611         30         client.py:875  func                         -> _prepare_headers\r\n8  66611         29         client.py:889  func                         <- _prepare_headers\r\n8  66611         28           _url.py:145  func                         -> __new__\r\n8  66611         24          parse.py:434  func                           -> urlsplit\r\n8  66611         18          parse.py:111  func                             -> _coerce_args\r\n8  66611         25          parse.py:124  func                             <- _coerce_args\r\n9  66611         52          parse.py:408  func                             -> _splitnetloc\r\n1  66611         81          parse.py:414  func                             <- _splitnetloc\r\n1  66611         31          parse.py:416  func                             -> _checknetloc\r\n1  66611         27          parse.py:418  func                             <- _checknetloc\r\n3  66611         51          <string>:1    func                             -> <lambda>\r\n3  66611         35          <string>:1    func                             <- <lambda>\r\n3  66611         23          parse.py:100  func                             -> _noop\r\n3  66611         19          parse.py:101  func                             <- _noop\r\n3  66611         21          parse.py:484  func                           <- urlsplit\r\n10  66611         56          parse.py:156  func                           -> hostname\r\n10  66611         22          parse.py:198  func                             -> _hostinfo\r\n10  66611         27          parse.py:210  func                             <- _hostinfo\r\n10  66611         25          parse.py:165  func                           <- hostname\r\n10  66611         20          parse.py:167  func                           -> port\r\n10  66611         19          parse.py:198  func                             -> _hostinfo\r\n10  66611         24          parse.py:210  func                             <- _hostinfo\r\n10  66611         25          parse.py:178  func                           <- port\r\n10  66611         22          parse.py:148  func                           -> username\r\n10  66611         21          parse.py:186  func                             -> _userinfo\r\n10  66611         34          parse.py:196  func                             <- _userinfo\r\n10  66611         27          parse.py:150  func                           <- username\r\n10  66611         25          parse.py:152  func                           -> password\r\n10  66611         19          parse.py:186  func                             -> _userinfo\r\n10  66611         25          parse.py:196  func                             <- _userinfo\r\n10  66611         22          parse.py:154  func                           <- password\r\n10  66611         25           _url.py:759  func                           -> _make_netloc\r\n10  66611         33           _url.py:711  func                             -> _encode_host\r\n10  66611         30      ipaddress.py:27   func                               -> ip_address\r\n10  66611         15      ipaddress.py:1269 func                                 -> __init__\r\n10  66611         22      ipaddress.py:1175 func                                   -> _ip_int_from_string\r\n10  66611         33      ipaddress.py:1201 func                                     -> _parse_octet\r\n10  66611         26      ipaddress.py:1230 func                                     <- _parse_octet\r\n10  66611         21      ipaddress.py:1201 func                                     -> _parse_octet\r\n10  66611         22      ipaddress.py:1230 func                                     <- _parse_octet\r\n10  66611         24      ipaddress.py:1201 func                                     -> _parse_octet\r\n10  66611         22      ipaddress.py:1230 func                                     <- _parse_octet\r\n10  66611         22      ipaddress.py:1201 func                                     -> _parse_octet\r\n10  66611         31      ipaddress.py:1230 func                                     <- _parse_octet\r\n10  66611         31      ipaddress.py:1197 func                                   <- _ip_int_from_string\r\n10  66611         25      ipaddress.py:1302 func                                 <- __init__\r\n10  66611         25      ipaddress.py:44   func                               <- ip_address\r\n10  66611         19      ipaddress.py:396  func                               -> compressed\r\n10  66611         25      ipaddress.py:611  func                                 -> __str__\r\n10  66611         27      ipaddress.py:1232 func                                   -> _string_from_ip_int\r\n10  66611         32      ipaddress.py:1243 func                                   <- _string_from_ip_int\r\n11  66611         56      ipaddress.py:612  func                                 <- __str__\r\n11  66611         27      ipaddress.py:399  func                               <- compressed\r\n11  66611         23      ipaddress.py:1258 func                               -> version\r\n11  66611         25      ipaddress.py:1260 func                               <- version\r\n11  66611         26           _url.py:731  func                             <- _encode_host\r\n11  66611         35           _url.py:783  func                           <- _make_netloc\r\n11  66611         30           _url.py:680  func                           -> _normalize_path\r\n11  66611         37           _url.py:707  func                           <- _normalize_path\r\n11  66611         35           _url.py:669  func                           -> _validate_authority_uri_abs_path\r\n1  66611         57           _url.py:676  func                           <- _validate_authority_uri_abs_path\r\n1  66611         40          <string>:1    func                           -> <lambda>\r\n1  66611         20          <string>:1    func                           <- <lambda>\r\n1  66611         20           _url.py:191  func                         <- __new__\r\n1  66611         37  <attrs generated init aiohttp.client.ClientTimeout>:1    func                         -> __init__\r\n1  66611         38  <attrs generated init aiohttp.client.ClientTimeout>:6    func                         <- __init__\r\n1  66611         38        helpers.py:563  func                         -> __init__\r\n1  66611         31        helpers.py:568  func                         <- __init__\r\n1  66611         26        helpers.py:580  func                         -> start\r\n1  66611         33    base_events.py:689  func                           -> time\r\n1  66611         27    base_events.py:696  func                           <- time\r\n1  66611         31    base_events.py:720  func                           -> call_at\r\n11  66611         54    base_events.py:508  func                             -> _check_closed\r\n11  66611         26    base_events.py:510  func                             <- _check_closed\r\n11  66611         45         events.py:103  func                             -> __init__\r\n11  66611         34         events.py:31   func                               -> __init__\r\n11  66611         30    base_events.py:1908 func                                 -> get_debug\r\n11  66611         19    base_events.py:1909 func                                 <- get_debug\r\n11  66611         40         events.py:44   func                               <- __init__\r\n3  66611        130         events.py:109  func                             <- __init__\r\n3  66611         33         events.py:120  func                             -> __lt__\r\n3  66611         25         events.py:122  func                             <- __lt__\r\n3  66611         21    base_events.py:734  func                           <- call_at\r\n3  66611         23        helpers.py:586  func                         <- start\r\n3  66611         29         client.py:434  func                         -> <listcomp>\r\n11  66611         52         client.py:435  func                         <- <listcomp>\r\n11  66611         31        helpers.py:590  func                         -> timer\r\n11  66611         28        helpers.py:626  func                           -> __init__\r\n11  66611         24        helpers.py:629  func                           <- __init__\r\n1  66611         48        helpers.py:572  func                           -> register\r\n1  66611         42        helpers.py:575  func                           <- register\r\n1  66611         27        helpers.py:594  func                         <- timer\r\n1  66611         28        helpers.py:631  func                         -> __enter__\r\n1  66611         27        helpers.py:270  func                           -> current_task\r\n1  66611         28          tasks.py:34   func                             -> current_task\r\n1  66611         25          tasks.py:38   func                             <- current_task\r\n1  66611         20        helpers.py:274  func                           <- current_task\r\n1  66611         24        helpers.py:644  func                         <- __enter__\r\n1  66611         18        helpers.py:191  func                         -> strip_auth_from_url\r\n1  66611         17        helpers.py:176  func                           -> from_url\r\n1  66611         16           _url.py:44   func                             -> __get__\r\n1  66611         14           _url.py:451  func                               -> user\r\n1  66611         13           _url.py:438  func                                 -> raw_user\r\n1  66611         14          parse.py:148  func                                   -> username\r\n1  66611         12          parse.py:186  func                                     -> _userinfo\r\n1  66611         14          parse.py:196  func                                     <- _userinfo\r\n1  66611         12          parse.py:150  func                                   <- username\r\n1  66611         12           _url.py:448  func                                 <- raw_user\r\n1  66611         13           _url.py:458  func                               <- user\r\n1  66611         13           _url.py:52   func                             <- __get__\r\n1  66611         18        helpers.py:182  func                           <- from_url\r\n1  66611         22        helpers.py:194  func                         <- strip_auth_from_url\r\n0  66611         36      cookiejar.py:212  func                         -> filter_cookies\r\n0  66611         17      cookiejar.py:104  func                           -> _do_expiration\r\n0  66611         38      cookiejar.py:109  func                           <- _do_expiration\r\n0  66611         27           _url.py:145  func                           -> __new__\r\n0  66611         20           _url.py:149  func                           <- __new__\r\n0  66611         22        cookies.py:481  func                           -> __init__\r\n0  66611         18        cookies.py:483  func                           <- __init__\r\n0  66611         19           _url.py:478  func                           -> raw_host\r\n0  66611         21          parse.py:156  func                             -> hostname\r\n0  66611         22          parse.py:198  func                               -> _hostinfo\r\n0  66611         25          parse.py:210  func                               <- _hostinfo\r\n0  66611         24          parse.py:165  func                             <- hostname\r\n0  66611         20           _url.py:487  func                           <- raw_host\r\n10  66611         43           _url.py:409  func                           -> scheme\r\n10  66611         30           _url.py:416  func                           <- scheme\r\n10  66611         30      cookiejar.py:96   func                           -> __iter__\r\n10  66611         28      cookiejar.py:104  func                             -> _do_expiration\r\n10  66611         36      cookiejar.py:109  func                             <- _do_expiration\r\n10  66611         30      cookiejar.py:99   func                           <- __iter__\r\n10  66611         28      cookiejar.py:254  func                         <- filter_cookies\r\n10  66611         39  client_reqrep.py:247  func                         -> __init__\r\n10  66611         34         typing.py:1333 func                           -> cast\r\n10  66611         21         typing.py:1341 func                           <- cast\r\n10  66611         24           _url.py:997  func                           -> with_fragment\r\n10  66611         26           _url.py:589  func                             -> raw_fragment\r\n10  66611         25           _url.py:596  func                             <- raw_fragment\r\n10  66611         25           _url.py:1013 func                           <- with_fragment\r\n10  66611         30    base_events.py:1908 func                           -> get_debug\r\n10  66611         26    base_events.py:1909 func                           <- get_debug\r\n10  66611         26  client_reqrep.py:373  func                           -> update_version\r\n10  66611         32  client_reqrep.py:386  func                           <- update_version\r\n10  66611         30  client_reqrep.py:362  func                           -> update_host\r\n10  66611         29           _url.py:478  func                             -> raw_host\r\n10  66611         25          parse.py:156  func                               -> hostname\r\n10  66611         22          parse.py:198  func                                 -> _hostinfo\r\n10  66611         26          parse.py:210  func                                 <- _hostinfo\r\n10  66611         26          parse.py:165  func                               <- hostname\r\n10  66611         24           _url.py:487  func                             <- raw_host\r\n10  66611         26           _url.py:44   func                             -> __get__\r\n10  66611         27           _url.py:49   func                             <- __get__\r\n10  66611         25           _url.py:44   func                             -> __get__\r\n10  66611         25           _url.py:469  func                               -> password\r\n10  66611         25           _url.py:460  func                                 -> raw_password\r\n10  66611         26          parse.py:152  func                                   -> password\r\n10  66611         23          parse.py:186  func                                     -> _userinfo\r\n10  66611         24          parse.py:196  func                                     <- _userinfo\r\n10  66611         23          parse.py:154  func                                   <- password\r\n10  66611         24           _url.py:467  func                                 <- raw_password\r\n10  66611         26           _url.py:476  func                               <- password\r\n10  66611         26           _url.py:52   func                             <- __get__\r\n10  66611         24  client_reqrep.py:371  func                           <- update_host\r\n10  66611         30  client_reqrep.py:388  func                           -> update_headers\r\n10  66611         33           _url.py:478  func                             -> raw_host\r\n10  66611         24          parse.py:156  func                               -> hostname\r\n10  66611         23          parse.py:198  func                                 -> _hostinfo\r\n10  66611         24          parse.py:210  func                                 <- _hostinfo\r\n10  66611         26          parse.py:165  func                               <- hostname\r\n10  66611         23           _url.py:487  func                             <- raw_host\r\n10  66611         25         typing.py:1333 func                             -> cast\r\n10  66611         21         typing.py:1341 func                             <- cast\r\n10  66611         24        helpers.py:463  func                             -> _is_ip_address\r\n10  66611         40        helpers.py:469  func                             <- _is_ip_address\r\n10  66611         29           _url.py:506  func                             -> port\r\n10  66611         25          parse.py:167  func                               -> port\r\n10  66611         22          parse.py:198  func                                 -> _hostinfo\r\n10  66611         25          parse.py:210  func                                 <- _hostinfo\r\n10  66611         27          parse.py:178  func                               <- port\r\n10  66611         22           _url.py:514  func                             <- port\r\n10  66611         25           _url.py:367  func                             -> is_default_port\r\n10  66611         26           _url.py:506  func                               -> port\r\n10  66611         24          parse.py:167  func                                 -> port\r\n10  66611         22          parse.py:198  func                                   -> _hostinfo\r\n10  66611         25          parse.py:210  func                                   <- _hostinfo\r\n10  66611         25          parse.py:178  func                                 <- port\r\n10  66611         22           _url.py:514  func                               <- port\r\n10  66611         25           _url.py:409  func                               -> scheme\r\n10  66611         24           _url.py:416  func                               <- scheme\r\n10  66611         26           _url.py:506  func                               -> port\r\n10  66611         23          parse.py:167  func                                 -> port\r\n10  66611         22          parse.py:198  func                                   -> _hostinfo\r\n10  66611         25          parse.py:210  func                                   <- _hostinfo\r\n10  66611         25          parse.py:178  func                                 <- port\r\n10  66611         23           _url.py:514  func                               <- port\r\n10  66611         25           _url.py:380  func                             <- is_default_port\r\n10  66611         32           _url.py:506  func                             -> port\r\n10  66611         28          parse.py:167  func                               -> port\r\n10  66611         20          parse.py:198  func                                 -> _hostinfo\r\n10  66611         26          parse.py:210  func                                 <- _hostinfo\r\n5  66611         52          parse.py:178  func                               <- port\r\n5  66611         28           _url.py:514  func                             <- port\r\n5  66611         47  client_reqrep.py:409  func                           <- update_headers\r\n5  66611         28  client_reqrep.py:411  func                           -> update_auto_headers\r\n5  66611         43  client_reqrep.py:412  func                             -> <genexpr>\r\n5  66611         26  client_reqrep.py:413  func                             <- <genexpr>\r\n5  66611         46  client_reqrep.py:423  func                           <- update_auto_headers\r\n5  66611         32  client_reqrep.py:425  func                           -> update_cookies\r\n5  66611         27  client_reqrep.py:428  func                           <- update_cookies\r\n5  66611         29  client_reqrep.py:450  func                           -> update_content_encoding\r\n5  66611         34  client_reqrep.py:465  func                           <- update_content_encoding\r\n5  66611         28  client_reqrep.py:489  func                           -> update_auth\r\n5  66611         29  client_reqrep.py:494  func                           <- update_auth\r\n7  66611         52  client_reqrep.py:544  func                           -> update_proxy\r\n7  66611         31  client_reqrep.py:556  func                           <- update_proxy\r\n7  66611         26  client_reqrep.py:501  func                           -> update_body_from_data\r\n7  66611         37        payload.py:103  func                             -> get\r\n7  66611         30            abc.py:96   func                               -> __instancecheck__\r\n7  66611         31            abc.py:98   func                               <- __instancecheck__\r\n7  66611         41        payload.py:209  func                               -> __init__\r\n2  66611         52        payload.py:132  func                                 -> __init__\r\n2  66611         44        payload.py:156  func                                 <- __init__\r\n7  66611         44        payload.py:230  func                               <- __init__\r\n11  66611         42        payload.py:110  func                             <- get\r\n11  66611         32        payload.py:158  func                             -> size\r\n11  66611         24        payload.py:161  func                             <- size\r\n11  66611         30        payload.py:168  func                             -> headers\r\n11  66611         27        payload.py:171  func                             <- headers\r\n9  66611         43        payload.py:168  func                             -> headers\r\n9  66611         31        payload.py:171  func                             <- headers\r\n9  66611         33  client_reqrep.py:533  func                           <- update_body_from_data\r\n9  66611         28  client_reqrep.py:467  func                           -> update_transfer_encoding\r\n9  66611         50  client_reqrep.py:487  func                           <- update_transfer_encoding\r\n9  66611         32  client_reqrep.py:535  func                           -> update_expect_continue\r\n9  66611         40  client_reqrep.py:542  func                           <- update_expect_continue\r\n9  66611         37  client_reqrep.py:319  func                         <- __init__\r\n9  66611         47       __init__.py:27   func                         -> __init__\r\n9  66611         32       __init__.py:36   func                         <- __init__\r\n9  66611         33        helpers.py:668  func                         -> __enter__\r\n9  66611         35        helpers.py:681  func                         <- __enter__\r\n9  66611         43      connector.py:485  func                         -> connect\r\n9  66611         21  client_reqrep.py:328  func                           -> connection_key\r\n9  66611         34  client_reqrep.py:347  func                             -> host\r\n9  66611         31           _url.py:478  func                               -> raw_host\r\n9  66611         24          parse.py:156  func                                 -> hostname\r\n9  66611         19          parse.py:198  func                                   -> _hostinfo\r\n9  66611         26          parse.py:210  func                                   <- _hostinfo\r\n9  66611         30          parse.py:165  func                                 <- hostname\r\n9  66611         23           _url.py:487  func                               <- raw_host\r\n9  66611         26  client_reqrep.py:351  func                             <- host\r\n9  66611         31  client_reqrep.py:353  func                             -> port\r\n9  66611         30           _url.py:506  func                               -> port\r\n9  66611         25          parse.py:167  func                                 -> port\r\n9  66611         22          parse.py:198  func                                   -> _hostinfo\r\n9  66611         26          parse.py:210  func                                   <- _hostinfo\r\n9  66611         27          parse.py:178  func                                 <- port\r\n9  66611         23           _url.py:514  func                               <- port\r\n9  66611         25  client_reqrep.py:355  func                             <- port\r\n9  66611         30  client_reqrep.py:321  func                             -> is_ssl\r\n9  66611         31           _url.py:409  func                               -> scheme\r\n9  66611         26           _url.py:416  func                               <- scheme\r\n9  66611         28  client_reqrep.py:322  func                             <- is_ssl\r\n9  66611         35  client_reqrep.py:324  func                             -> ssl\r\n9  66611         32  client_reqrep.py:326  func                             <- ssl\r\n9  66611         36  <attrs generated init aiohttp.client_reqrep.ConnectionKey>:1    func                             -> __init__\r\n9  66611         47  <attrs generated init aiohttp.client_reqrep.ConnectionKey>:9    func                             <- __init__\r\n9  66611         42  client_reqrep.py:337  func                           <- connection_key\r\n9  66611         36      connector.py:452  func                           -> _available_connections\r\n9  66611         39      connector.py:483  func                           <- _available_connections\r\n9  66611         37  <attrs generated hash aiohttp.client_reqrep.ConnectionKey>:1    func                           -> __hash__\r\n9  66611         48  <attrs generated hash aiohttp.client_reqrep.ConnectionKey>:2    func                           <- __hash__\r\n9  66611         43      connector.py:562  func                           -> _get\r\n9  66611         32  <attrs generated hash aiohttp.client_reqrep.ConnectionKey>:1    func                             -> __hash__\r\n9  66611         41  <attrs generated hash aiohttp.client_reqrep.ConnectionKey>:2    func                             <- __hash__\r\n9  66611         42  <attrs generated eq aiohttp.client_reqrep.ConnectionKey>:1    func                             -> __eq__\r\n9  66611         44  <attrs generated eq aiohttp.client_reqrep.ConnectionKey>:4    func                             <- __eq__\r\n9  66611         45    base_events.py:689  func                             -> time\r\n9  66611         32    base_events.py:696  func                             <- time\r\n9  66611         33   client_proto.py:68   func                             -> is_connected\r\n3  66611         56       sslproto.py:304  func                               -> is_closing\r\n3  66611         31       sslproto.py:305  func                               <- is_closing\r\n3  66611         28   client_proto.py:69   func                             <- is_connected\r\n3  66611         33  <attrs generated hash aiohttp.client_reqrep.ConnectionKey>:1    func                             -> __hash__\r\n3  66611         41  <attrs generated hash aiohttp.client_reqrep.ConnectionKey>:2    func                             <- __hash__\r\n3  66611         42  <attrs generated eq aiohttp.client_reqrep.ConnectionKey>:1    func                             -> __eq__\r\n3  66611         37  <attrs generated eq aiohttp.client_reqrep.ConnectionKey>:4    func                             <- __eq__\r\n3  66611         39      connector.py:582  func                           <- _get\r\n3  66611         38  <attrs generated hash aiohttp.client_reqrep.ConnectionKey>:1    func                           -> __hash__\r\n3  66611         35  <attrs generated hash aiohttp.client_reqrep.ConnectionKey>:2    func                           <- __hash__\r\n3  66611         34  <attrs generated eq aiohttp.client_reqrep.ConnectionKey>:1    func                           -> __eq__\r\n3  66611         37  <attrs generated eq aiohttp.client_reqrep.ConnectionKey>:4    func                           <- __eq__\r\n3  66611         40      connector.py:95   func                           -> __init__\r\n3  66611         35    base_events.py:1908 func                             -> get_debug\r\n3  66611         27    base_events.py:1909 func                             <- get_debug\r\n3  66611         26      connector.py:109  func                           <- __init__\r\n3  66611         28      connector.py:560  func                         <- connect\r\n3  66611         31       __init__.py:41   func                         -> __exit__\r\n3  66611         31       __init__.py:88   func                           -> _do_exit\r\n3  66611         31       __init__.py:97   func                           <- _do_exit\r\n3  66611         29       __init__.py:46   func                         <- __exit__\r\n3  66611         30      connector.py:138  func                         -> transport\r\n3  66611         28      connector.py:142  func                         <- transport\r\n3  66611         28      connector.py:144  func                         -> protocol\r\n3  66611         31      connector.py:146  func                         <- protocol\r\n3  66611         28      connector.py:144  func                         -> protocol\r\n3  66611         25      connector.py:146  func                         <- protocol\r\n3  66611         36   client_proto.py:137  func                         -> set_response_params\r\n3  66611         35   client_proto.py:172  func                           -> _reschedule_timeout\r\n3  66611         28   client_proto.py:182  func                           <- _reschedule_timeout\r\n3  66611         46   client_proto.py:165  func                         <- set_response_params\r\n3  66611         33  client_reqrep.py:609  func                         -> send\r\n3  66611         33           _url.py:525  func                           -> raw_path\r\n3  66611         26           _url.py:535  func                           <- raw_path\r\n3  66611         27           _url.py:557  func                           -> raw_query_string\r\n3  66611         26           _url.py:564  func                           <- raw_query_string\r\n3  66611         26      connector.py:144  func                           -> protocol\r\n3  66611         26      connector.py:146  func                           <- protocol\r\n3  66611         36    http_writer.py:25   func                           -> __init__\r\n3  66611         64    http_writer.py:44   func                           <- __init__\r\n3  66611         43  client_reqrep.py:558  func                           -> keep_alive\r\n3  66611         36  client_reqrep.py:570  func                           <- keep_alive\r\n3  66611         41    http_writer.py:113  func                           -> write_headers\r\n3  66611         41    http_writer.py:61   func                             -> _write\r\n3  66611         30       sslproto.py:304  func                               -> is_closing\r\n3  66611         24       sslproto.py:305  func                               <- is_closing\r\n3  66611         26       sslproto.py:375  func                               -> write\r\n3  66611         30       sslproto.py:595  func                                 -> _write_appdata\r\n3  66611         27       sslproto.py:665  func                                   -> _process_write_backlog\r\n3  66611         32       sslproto.py:231  func                                     -> feed_appdata\r\n3  66611         36            ssl.py:891  func                                       -> write\r\n3  66611         42            ssl.py:897  func                                       <- write\r\n3  66611         28       sslproto.py:280  func                                     <- feed_appdata\r\n3  66611         29  selector_events.py:898  func                                     -> write\r\n3  66611         89  selector_events.py:929  func                                     <- write\r\n3  66611         32       sslproto.py:706  func                                   <- _process_write_backlog\r\n3  66611         25       sslproto.py:598  func                                 <- _write_appdata\r\n3  66611         25       sslproto.py:386  func                               <- write\r\n7  66611         44    http_writer.py:68   func                             <- _write\r\n3  66611         65    http_writer.py:119  func                           <- write_headers\r\n3  66611         39    base_events.py:426  func                           -> create_task\r\n3  66611         28    base_events.py:508  func                             -> _check_closed\r\n3  66611         26    base_events.py:510  func                             <- _check_closed\r\n3  66611         34    base_events.py:1908 func                             -> get_debug\r\n3  66611         25    base_events.py:1909 func                             <- get_debug\r\n3  66611         35    base_events.py:736  func                             -> call_soon\r\n3  66611         42    base_events.py:508  func                               -> _check_closed\r\n3  66611         24    base_events.py:510  func                               <- _check_closed\r\n3  66611         27    base_events.py:765  func                               -> _call_soon\r\n3  66611         29         events.py:31   func                                 -> __init__\r\n3  66611         27    base_events.py:1908 func                                   -> get_debug\r\n3  66611         24    base_events.py:1909 func                                   <- get_debug\r\n3  66611         25         events.py:44   func                                 <- __init__\r\n3  66611         27    base_events.py:770  func                               <- _call_soon\r\n3  66611         26    base_events.py:753  func                             <- call_soon\r\n3  66611         27    _weakrefset.py:82   func                             -> add\r\n3  66611         28    _weakrefset.py:85   func                             <- add\r\n3  66611         25    base_events.py:440  func                           <- create_task\r\n3  66611         29  client_reqrep.py:357  func                           -> request_info\r\n3  66611         33  <attrs generated init aiohttp.client_reqrep.RequestInfo>:1    func                             -> __init__\r\n3  66611         40  <attrs generated init aiohttp.client_reqrep.RequestInfo>:9    func                             <- __init__\r\n3  66611         36  client_reqrep.py:360  func                           <- request_info\r\n3  66611         34  client_reqrep.py:723  func                           -> __init__\r\n3  66611         32        cookies.py:481  func                             -> __init__\r\n3  66611         23        cookies.py:483  func                             <- __init__\r\n3  66611         26           _url.py:997  func                             -> with_fragment\r\n3  66611         26           _url.py:589  func                               -> raw_fragment\r\n3  66611         26           _url.py:596  func                               <- raw_fragment\r\n3  66611         28           _url.py:1013 func                             <- with_fragment\r\n3  66611         30    base_events.py:1908 func                             -> get_debug\r\n3  66611         24    base_events.py:1909 func                             <- get_debug\r\n3  66611         25  client_reqrep.py:756  func                           <- __init__\r\n3  66611         31  client_reqrep.py:685  func                         <- send\r\n3  66611         32  client_reqrep.py:880  func                         -> start\r\n3  66611         29      connector.py:144  func                           -> protocol\r\n3  66611         27      connector.py:146  func                           <- protocol\r\n3  66611         35        helpers.py:631  func                           -> __enter__\r\n3  66611         26        helpers.py:270  func                             -> current_task\r\n3  66611         25          tasks.py:34   func                               -> current_task\r\n3  66611         22          tasks.py:38   func                               <- current_task\r\n3  66611         27        helpers.py:274  func                             <- current_task\r\n3  66611         35        helpers.py:644  func                           <- __enter__\r\n3  66611         30        streams.py:599  func                           -> read\r\n3  66611         31    base_events.py:422  func                             -> create_future\r\n3  66611         23    base_events.py:1908 func                               -> get_debug\r\n3  66611         27    base_events.py:1909 func                               <- get_debug\r\n3  66611         26    base_events.py:424  func                             <- create_future\r\n3  66611         28        streams.py:604  func                           <- read\r\n3  66611         31  client_reqrep.py:890  func                         <- start\r\n3  66611         26         client.py:544  func                       <- _request\r\n3  66611         22            k8s.py:126  func                     <- create\r\n3  66611         21           doit.py:139  func                   <- create_resources\r\n3  66611         20           doit.py:242  func                 <- run_container\r\n3  66611         25         events.py:95   func               <- _run\r\n3  66611         29         events.py:78   func               -> _run\r\n3  66611         29  selector_events.py:812  func                 -> _read_ready\r\n3  66611         27  selector_events.py:852  func                   -> _read_ready__data_received\r\n3  66611         75       sslproto.py:518  func                     -> data_received\r\n3  66611         28       sslproto.py:156  func                       -> feed_ssldata\r\n3  66611         34            ssl.py:879  func                         -> read\r\n3  66611         33            ssl.py:889  func                         <- read\r\n3  66611         24            ssl.py:879  func                         -> read\r\n3  66611         42            ssl.py:888  func                         <- read\r\n3  66611         31       sslproto.py:229  func                       <- feed_ssldata\r\n3  66611         29   client_proto.py:190  func                       -> data_received\r\n3  66611         28   client_proto.py:172  func                         -> _reschedule_timeout\r\n3  66611         30   client_proto.py:182  func                         <- _reschedule_timeout\r\n3  66611         36        streams.py:261  func                         -> end_http_chunk_receiving\r\n3  66611         31        streams.py:289  func                         <- end_http_chunk_receiving\r\n3  66611         29        streams.py:253  func                         -> begin_http_chunk_receiving\r\n3  66611         29        streams.py:259  func                         <- begin_http_chunk_receiving\r\n3  66611         28        streams.py:261  func                         -> end_http_chunk_receiving\r\n3  66611         28        streams.py:281  func                         <- end_http_chunk_receiving\r\n3  66611         29        streams.py:175  func                         -> feed_eof\r\n3  66611         28   client_proto.py:167  func                           -> _drop_timeout\r\n3  66611         30   client_proto.py:170  func                           <- _drop_timeout\r\n3  66611         23  client_reqrep.py:930  func                           -> _response_eof\r\n3  66611         56      connector.py:144  func                             -> protocol\r\n3  66611         27      connector.py:146  func                             <- protocol\r\n3  66611         28      connector.py:144  func                             -> protocol\r\n3  66611         25      connector.py:146  func                             <- protocol\r\n3  66611         26   client_proto.py:39   func                             -> upgraded\r\n3  66611         28   client_proto.py:41   func                             <- upgraded\r\n3  66611         29      connector.py:166  func                             -> release\r\n3  66611         26      connector.py:152  func                               -> _notify_release\r\n3  66611         36     contextlib.py:357  func                                 -> __init__\r\n3  66611         24     contextlib.py:358  func                                 <- __init__\r\n3  66611         25     contextlib.py:360  func                                 -> __enter__\r\n3  66611         23     contextlib.py:361  func                                 <- __enter__\r\n3  66611         26         events.py:148  func                                 -> cancel\r\n3  66611         25    base_events.py:1810 func                                   -> _timer_handle_cancelled\r\n3  66611         30    base_events.py:1813 func                                   <- _timer_handle_cancelled\r\n3  66611         33         events.py:64   func                                   -> cancel\r\n3  66611         25    base_events.py:1908 func                                     -> get_debug\r\n3  66611         26    base_events.py:1909 func                                     <- get_debug\r\n3  66611         29         events.py:73   func                                   <- cancel\r\n3  66611         23         events.py:151  func                                 <- cancel\r\n3  66611         22     contextlib.py:363  func                                 -> __exit__\r\n3  66611         24     contextlib.py:373  func                                 <- __exit__\r\n3  66611         25      connector.py:157  func                               <- _notify_release\r\n3  66611         32   client_proto.py:43   func                               -> should_close\r\n3  66611         31        streams.py:196  func                                 -> is_eof\r\n3  66611         26        streams.py:198  func                                 <- is_eof\r\n3  66611         30        streams.py:570  func                                 -> exception\r\n3  66611         27        streams.py:571  func                                 <- exception\r\n3  66611         27        streams.py:561  func                                 -> __len__\r\n3  66611         27        streams.py:562  func                                 <- __len__\r\n3  66611         28   client_proto.py:48   func                               <- should_close\r\n3  66611         31      connector.py:632  func                               -> _release\r\n2  66611         39      connector.py:617  func                                 -> _release_acquired\r\n2  66611         38      connector.py:373  func                                   -> _drop_acquired_per_host\r\n2  66611         30  <attrs generated hash aiohttp.client_reqrep.ConnectionKey>:1    func                                     -> __hash__\r\n2  66611         45  <attrs generated hash aiohttp.client_reqrep.ConnectionKey>:2    func                                     <- __hash__\r\n2  66611         40  <attrs generated hash aiohttp.client_reqrep.ConnectionKey>:1    func                                     -> __hash__\r\n10  66611         87  <attrs generated hash aiohttp.client_reqrep.ConnectionKey>:2    func                                     <- __hash__\r\n10  66611         26      connector.py:382  func                                   <- _drop_acquired_per_host\r\n10  66611         18      connector.py:593  func                                   -> _release_waiter\r\n11  66611         26      connector.py:599  func                                   <- _release_waiter\r\n11  66611         20      connector.py:630  func                                 <- _release_acquired\r\n11  66611         26   client_proto.py:43   func                                 -> should_close\r\n11  66611         28        streams.py:196  func                                   -> is_eof\r\n11  66611         25        streams.py:198  func                                   <- is_eof\r\n11  66611         27        streams.py:570  func                                   -> exception\r\n11  66611         24        streams.py:571  func                                   <- exception\r\n11  66611         26        streams.py:561  func                                   -> __len__\r\n11  66611         25        streams.py:562  func                                   <- __len__\r\n11  66611         25   client_proto.py:48   func                                 <- should_close\r\n11  66611         27  <attrs generated hash aiohttp.client_reqrep.ConnectionKey>:1    func                                 -> __hash__\r\n11  66611         37  <attrs generated hash aiohttp.client_reqrep.ConnectionKey>:2    func                                 <- __hash__\r\n11  66611         38  <attrs generated hash aiohttp.client_reqrep.ConnectionKey>:1    func                                 -> __hash__\r\n11  66611         38  <attrs generated hash aiohttp.client_reqrep.ConnectionKey>:2    func                                 <- __hash__\r\n11  66611         39    base_events.py:689  func                                 -> time\r\n11  66611         27    base_events.py:696  func                                 <- time\r\n11  66611         26      connector.py:661  func                               <- _release\r\n11  66611         28      connector.py:173  func                             <- release\r\n11  66611         27      connector.py:114  func                             -> __del__\r\n11  66611         23      connector.py:129  func                             <- __del__\r\n11  66611         18  client_reqrep.py:1008 func                             -> _cleanup_writer\r\n11  66611         18    _weakrefset.py:39   func                               -> _remove\r\n11  66611         16    _weakrefset.py:45   func                               <- _remove\r\n11  66611         15  client_reqrep.py:1012 func                             <- _cleanup_writer\r\n11  66611         19  client_reqrep.py:947  func                           <- _response_eof\r\n11  66611         22        streams.py:194  func                         <- feed_eof\r\n11  66611         19   client_proto.py:251  func                       <- data_received\r\n11  66611         16       sslproto.py:554  func                     <- data_received\r\n11  66611         19  selector_events.py:874  func                   <- _read_ready__data_received\r\n11  66611         16  selector_events.py:813  func                 <- _read_ready\r\n11  66611         16         events.py:95   func               <- _run\r\n11  66611         13    base_events.py:1891 func             <- _run_once\r\n11  66611         15    base_events.py:1815 func             -> _run_once\r\n11  66611         22      selectors.py:554  func               -> select\r\n3  66611         46      selectors.py:577  func               <- select\r\n3  66611         31  selector_events.py:594  func               -> _process_events\r\n3  66611         27  selector_events.py:606  func               <- _process_events\r\n3  66611         30    base_events.py:689  func               -> time\r\n3  66611         27    base_events.py:696  func               <- time\r\n3  66611         36         events.py:78   func               -> _run\r\n3  66611         27  client_reqrep.py:572  func                 -> write_bytes\r\n3  66611         28      connector.py:144  func                   -> protocol\r\n3  66611         25      connector.py:146  func                   <- protocol\r\n3  66611         29            abc.py:96   func                   -> __instancecheck__\r\n3  66611         25            abc.py:98   func                   <- __instancecheck__\r\n3  66611         23        payload.py:238  func                   -> write\r\n3  66611         25    http_writer.py:70   func                     -> write\r\n3  66611         27  client_reqrep.py:700  func                       -> _on_chunk_request_sent\r\n3  66611         24  client_reqrep.py:702  func                       <- _on_chunk_request_sent\r\n3  66611         31    http_writer.py:61   func                       -> _write\r\n3  66611         28       sslproto.py:304  func                         -> is_closing\r\n3  66611         22       sslproto.py:305  func                         <- is_closing\r\n3  66611         23       sslproto.py:375  func                         -> write\r\n3  66611         24       sslproto.py:595  func                           -> _write_appdata\r\n3  66611         27       sslproto.py:665  func                             -> _process_write_backlog\r\n3  66611         28       sslproto.py:231  func                               -> feed_appdata\r\n3  66611         35            ssl.py:891  func                                 -> write\r\n3  66611         44            ssl.py:897  func                                 <- write\r\n3  66611         27       sslproto.py:280  func                               <- feed_appdata\r\n3  66611         27  selector_events.py:898  func                               -> write\r\n3  66611         79  selector_events.py:929  func                               <- write\r\n3  66611         30       sslproto.py:706  func                             <- _process_write_backlog\r\n3  66611         28       sslproto.py:598  func                           <- _write_appdata\r\n0  66611         36       sslproto.py:386  func                         <- write\r\n0  66611         26    http_writer.py:68   func                       <- _write\r\n0  66611         26    http_writer.py:111  func                     <- write\r\n0  66611         36        payload.py:239  func                   <- write\r\n0  66611         40    http_writer.py:121  func                   -> write_eof\r\n0  66611         42    http_writer.py:152  func                     -> drain\r\n0  66611         56  base_protocol.py:78   func                       -> _drain_helper\r\n0  66611         27  base_protocol.py:82   func                       <- _drain_helper\r\n0  66611         17    http_writer.py:161  func                     <- drain\r\n0  66611         15    http_writer.py:150  func                   <- write_eof\r\n0  66611         16  client_reqrep.py:607  func                 <- write_bytes\r\n0  66611         19         events.py:95   func               <- _run\r\n0  66611         14    base_events.py:1891 func             <- _run_once\r\n0  66611         22    base_events.py:1815 func             -> _run_once\r\n0  66611         36    base_events.py:689  func               -> time\r\n0  66611         29    base_events.py:696  func               <- time\r\n0  66611         35      selectors.py:554  func               -> select\r\n11  66611   14046370      selectors.py:577  func               <- select\r\n11  66611         34  selector_events.py:594  func               -> _process_events\r\n11  66611         20  selector_events.py:606  func               <- _process_events\r\n11  66611         27    base_events.py:689  func               -> time\r\n2  66611         30    base_events.py:696  func               <- time\r\n2  66611         35         events.py:120  func               -> __lt__\r\n2  66611         23         events.py:122  func               <- __lt__\r\n2  66611         11         events.py:120  func               -> __lt__\r\n2  66611         10         events.py:122  func               <- __lt__\r\n2  66611          9         events.py:120  func               -> __lt__\r\n2  66611          9         events.py:122  func               <- __lt__\r\n2  66611         11         events.py:120  func               -> __lt__\r\n2  66611          9         events.py:122  func               <- __lt__\r\n2  66611          9         events.py:120  func               -> __lt__\r\n2  66611          9         events.py:122  func               <- __lt__\r\n9  66611         31         events.py:78   func               -> _run\r\n9  66611         24        helpers.py:535  func                 -> _weakref_handle\r\n9  66611         22     contextlib.py:357  func                   -> __init__\r\n9  66611         16     contextlib.py:358  func                   <- __init__\r\n9  66611         14     contextlib.py:360  func                   -> __enter__\r\n9  66611         12     contextlib.py:361  func                   <- __enter__\r\n9  66611         14      connector.py:332  func                   -> _cleanup\r\n9  66611         17         events.py:148  func                     -> cancel\r\n9  66611         15    base_events.py:1810 func                       -> _timer_handle_cancelled\r\n9  66611         17    base_events.py:1813 func                       <- _timer_handle_cancelled\r\n9  66611         24         events.py:64   func                       -> cancel\r\n9  66611         24    base_events.py:1908 func                         -> get_debug\r\n9  66611         30    base_events.py:1909 func                         <- get_debug\r\n9  66611         28         events.py:73   func                       <- cancel\r\n9  66611         16         events.py:151  func                     <- cancel\r\n9  66611         27    base_events.py:689  func                     -> time\r\n9  66611         21    base_events.py:696  func                     <- time\r\n9  66611         26   client_proto.py:68   func                     -> is_connected\r\n9  66611         24       sslproto.py:304  func                       -> is_closing\r\n9  66611         16       sslproto.py:305  func                       <- is_closing\r\n9  66611         18   client_proto.py:69   func                     <- is_connected\r\n9  66611         22  <attrs generated hash aiohttp.client_reqrep.ConnectionKey>:1    func                     -> __hash__\r\n9  66611         27  <attrs generated hash aiohttp.client_reqrep.ConnectionKey>:2    func                     <- __hash__\r\n6  66611         44        helpers.py:543  func                     -> weakref_handle\r\n6  66611         25    base_events.py:689  func                       -> time\r\n6  66611         19    base_events.py:696  func                       <- time\r\n6  66611         35    base_events.py:720  func                       -> call_at\r\n6  66611         20    base_events.py:508  func                         -> _check_closed\r\n6  66611         19    base_events.py:510  func                         <- _check_closed\r\n6  66611         15         events.py:103  func                         -> __init__\r\n6  66611         12         events.py:31   func                           -> __init__\r\n6  66611         13    base_events.py:1908 func                             -> get_debug\r\n6  66611         10    base_events.py:1909 func                             <- get_debug\r\n6  66611         10         events.py:44   func                           <- __init__\r\n6  66611         10         events.py:109  func                         <- __init__\r\n6  66611         13         events.py:120  func                         -> __lt__\r\n6  66611         10         events.py:122  func                         <- __lt__\r\n6  66611          9         events.py:120  func                         -> __lt__\r\n6  66611          9         events.py:122  func                         <- __lt__\r\n6  66611          9         events.py:120  func                         -> __lt__\r\n6  66611          9         events.py:122  func                         <- __lt__\r\n6  66611          9         events.py:120  func                         -> __lt__\r\n6  66611          9         events.py:122  func                         <- __lt__\r\n6  66611          9         events.py:120  func                         -> __lt__\r\n6  66611         10         events.py:122  func                         <- __lt__\r\n6  66611          9    base_events.py:734  func                       <- call_at\r\n6  66611         10        helpers.py:549  func                     <- weakref_handle\r\n6  66611         12      connector.py:369  func                   <- _cleanup\r\n6  66611         14     contextlib.py:363  func                   -> __exit__\r\n6  66611         10     contextlib.py:373  func                   <- __exit__\r\n6  66611         11        helpers.py:540  func                 <- _weakref_handle\r\n6  66611         12         events.py:95   func               <- _run\r\n6  66611         11    base_events.py:1891 func             <- _run_once\r\n6  66611         11    base_events.py:1815 func             -> _run_once\r\n6  66611         13    base_events.py:689  func               -> time\r\n6  66611         10    base_events.py:696  func               <- time\r\n6  66611         15      selectors.py:554  func               -> select\r\n\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.9.2\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.4.post0\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/i826444/.virtualenvs/dtrace/lib/python3.9/site-packages\r\nRequires: multidict, typing-extensions, yarl, chardet, async-timeout, attrs\r\nRequired-by: osb-asyncio, aiodocker\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.1.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/i826444/.virtualenvs/dtrace/lib/python3.9/site-packages\r\nRequires:\r\nRequired-by: yarl, aiohttp\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.3\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/i826444/.virtualenvs/dtrace/lib/python3.9/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\nmacos aiohttp 3.7.4.post0 client", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5584/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5584/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5571", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5571/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5571/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5571/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5571", "id": 843487460, "node_id": "MDU6SXNzdWU4NDM0ODc0NjA=", "number": 5571, "title": "Client: ClientSession will not send secure cookie to localhost on unsecure connection.", "user": {"login": "DanielDewberry", "id": 14042932, "node_id": "MDQ6VXNlcjE0MDQyOTMy", "avatar_url": "https://avatars.githubusercontent.com/u/14042932?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DanielDewberry", "html_url": "https://github.com/DanielDewberry", "followers_url": "https://api.github.com/users/DanielDewberry/followers", "following_url": "https://api.github.com/users/DanielDewberry/following{/other_user}", "gists_url": "https://api.github.com/users/DanielDewberry/gists{/gist_id}", "starred_url": "https://api.github.com/users/DanielDewberry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DanielDewberry/subscriptions", "organizations_url": "https://api.github.com/users/DanielDewberry/orgs", "repos_url": "https://api.github.com/users/DanielDewberry/repos", "events_url": "https://api.github.com/users/DanielDewberry/events{/privacy}", "received_events_url": "https://api.github.com/users/DanielDewberry/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 303800438, "node_id": "MDU6TGFiZWwzMDM4MDA0Mzg=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/need%20pull%20request", "name": "need pull request", "color": "bfdadc", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2021-03-29T15:28:58Z", "updated_at": "2021-10-24T09:47:33Z", "closed_at": "2021-10-24T09:47:33Z", "author_association": "NONE", "active_lock_reason": null, "body": "A ClientSession with an unsafe cookiejar will not send a secure cookie to a localhost endpoint, when that connection is over http (i,e. unsecure).\r\n\r\nAccording to [Mozilla documentation](https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies#restrict_access_to_cookies):\r\n\r\n> A cookie with the Secure attribute is sent to the server only with an encrypted request over the HTTPS protocol, never with unsecured HTTP (except on localhost), and therefore can't easily be accessed by a man-in-the-middle attacker. Insecure sites (with http: in the URL) can't set cookies with the Secure attribute\r\n\r\nNote the **(except on localhost)** clause.\r\n\r\n\ud83d\udca1 **To Reproduce**\r\nThe following example sets up a test (`TestIntegration::test_cookie_is_sent_server`) which fails.  Supplementary tests are included to demonstrate the setup operates as expected.  Scroll to the end of the codeblock to see that particular test.\r\n\r\n```py\r\n#! /usr/bin/env pytest\r\n# -*- coding: utf-8 -*-\r\n\r\n\"\"\"Test module.\"\"\"\r\n\r\nimport base64\r\nimport http\r\nfrom typing import cast\r\n\r\nfrom aiohttp import ClientSession\r\nfrom aiohttp import web\r\nfrom aiohttp.cookiejar import CookieJar\r\nfrom aiohttp.test_utils import TestClient\r\n\r\nfrom aiohttp_session import get_session, setup\r\nfrom aiohttp_session.cookie_storage import EncryptedCookieStorage\r\n\r\nfrom cryptography import fernet\r\n\r\nimport pytest\r\n\r\n\r\nfernet_key = fernet.Fernet.generate_key()\r\n\r\n\r\nasync def index_get_handler(request: web.Request) -> web.Response:\r\n    session = await get_session(request)\r\n    secret_key = session.get('session_id') or 'not set'\r\n    key = 'key: {}'.format(secret_key)\r\n\r\n    response = web.Response(\r\n        status=http.HTTPStatus(200),\r\n        headers={'Content-Type': 'text/plain; charset=UTF-8',\r\n                 },\r\n        body=key,\r\n    )\r\n\r\n    return response\r\n\r\n\r\nasync def login_post_handler(request: web.Request) -> web.Response:\r\n    session = await get_session(request)\r\n    session['session_id'] = 'some secret data'\r\n\r\n    response = web.Response(\r\n        status=http.HTTPStatus(303),\r\n        headers={'Content-Type': 'text/plain; charset=UTF-8',\r\n                 'Location': '/',\r\n                 },\r\n    )\r\n\r\n    return response\r\n\r\n\r\n@pytest.fixture\r\ndef application_instance() -> web.Application:\r\n    \"\"\"Generate the application instance.\"\"\"\r\n    application = web.Application()\r\n\r\n    application.add_routes(\r\n        [\r\n            web.get('/', index_get_handler, name='index'),\r\n            web.post('/login', login_post_handler, name='login'),\r\n        ]\r\n    )\r\n\r\n    setup(\r\n        app=application,\r\n        storage=EncryptedCookieStorage(\r\n            secret_key=base64.urlsafe_b64decode(fernet_key),\r\n            cookie_name='session_data',\r\n            secure=True,\r\n        ),\r\n    )\r\n\r\n    return application\r\n\r\n\r\n# Tests\r\n\r\nclass TestIndexHandlerGetMethod:\r\n    async def test_index_handler_returns_default_key_text(\r\n        self,\r\n        aiohttp_client,\r\n        loop,\r\n        application_instance,\r\n    ):\r\n        \"\"\"index handler returns default text when session cookie not present.\"\"\"\r\n        jar = CookieJar(unsafe=True)\r\n        client: TestClient = await aiohttp_client(\r\n            application_instance,\r\n            cookie_jar=jar,\r\n        )\r\n        url = 'http://127.0.0.1:{}/'.format(client.port)\r\n\r\n        async with client.session as session:\r\n            cast(ClientSession, session)\r\n\r\n            response = await session.get(\r\n                url=url,\r\n                allow_redirects=False,\r\n            )\r\n            body = await response.text()\r\n        assert 'key: not set' == body\r\n\r\n\r\n    async def test_index_page_returns_no_session_cookie(\r\n        self,\r\n        aiohttp_client,\r\n        loop,\r\n        application_instance,\r\n    ):\r\n        \"\"\"index handler does not set a session cookie.\"\"\"\r\n        jar = CookieJar(unsafe=True)\r\n        client: TestClient = await aiohttp_client(\r\n            application_instance,\r\n            cookie_jar=jar,\r\n        )\r\n        url = 'http://127.0.0.1:{}/'.format(client.port)\r\n\r\n        async with client.session as session:\r\n            cast(ClientSession, session)\r\n\r\n            response = await session.get(\r\n                url=url,\r\n                allow_redirects=False,\r\n            )\r\n\r\n            assert response.cookies.get('session_data') is None\r\n\r\n\r\n    async def test_index_page_returns_200_status(\r\n        self,\r\n        aiohttp_client,\r\n        loop,\r\n        application_instance,\r\n    ):\r\n        \"\"\"index handler returns 200 status.\"\"\"\r\n        jar = CookieJar(unsafe=True)\r\n        client: TestClient = await aiohttp_client(\r\n            application_instance,\r\n            cookie_jar=jar,\r\n        )\r\n        url = 'http://127.0.0.1:{}/'.format(client.port)\r\n\r\n        async with client.session as session:\r\n            cast(ClientSession, session)\r\n\r\n            response = await session.get(\r\n                url=url,\r\n                allow_redirects=False,\r\n            )\r\n\r\n            assert response.status == 200\r\n\r\n\r\nclass TestLoginHandlerPostMethod:\r\n    async def test_handler_sets_cookie(\r\n        self,\r\n        aiohttp_client,\r\n        loop,\r\n        application_instance,\r\n    ):\r\n        \"\"\"login handler sets session cookie.\"\"\"\r\n        jar = CookieJar(unsafe=True)\r\n        client: TestClient = await aiohttp_client(\r\n            application_instance,\r\n            cookie_jar=jar,\r\n        )\r\n        url = 'http://127.0.0.1:{}/login'.format(client.port)\r\n\r\n        async with client.session as session:\r\n            cast(ClientSession, session)\r\n\r\n            response = await session.post(\r\n                url=url,\r\n                allow_redirects=False,\r\n            )\r\n            assert response.cookies.get('session_data') is not None\r\n\r\n    async def test_handler_redirects_to_index(\r\n        self,\r\n        aiohttp_client,\r\n        loop,\r\n        application_instance,\r\n    ):\r\n        \"\"\"login handler redirects to the index page.\"\"\"\r\n        jar = CookieJar(unsafe=True)\r\n        client: TestClient = await aiohttp_client(\r\n            application_instance,\r\n            cookie_jar=jar,\r\n        )\r\n        url = 'http://127.0.0.1:{}/login'.format(client.port)\r\n\r\n        async with client.session as session:\r\n            cast(ClientSession, session)\r\n\r\n            response = await session.post(\r\n                url=url,\r\n                allow_redirects=False,\r\n            )\r\n\r\n            assert response.status == 303\r\n            assert response.headers.get('location') == '/'\r\n\r\n\r\nclass TestIntegration:\r\n\r\n    async def test_cookie_is_sent_server(\r\n            self,\r\n            aiohttp_client,\r\n            loop,\r\n            application_instance,\r\n        ):\r\n        \"\"\"A session cookie sent to index handler returns the session secret in response body.\r\n\r\n        This test fails as the cookie storate filters away the secure cookied when the request\r\n        asked to send cookies over an unsecure connection.\"\"\"\r\n        jar = CookieJar(unsafe=True)\r\n        client: TestClient = await aiohttp_client(\r\n            application_instance,\r\n            cookie_jar=jar,\r\n        )\r\n\r\n        async with client.session as session:\r\n            cast(ClientSession, session)\r\n\r\n            assert session.cookie_jar is jar\r\n\r\n            login_post_url = 'http://127.0.0.1:{}/login'.format(client.port)\r\n            response = await session.post(\r\n                url=login_post_url,\r\n            )\r\n\r\n            assert response.status == 200\r\n            body = await response.text()\r\n            assert body is not None\r\n            assert body == 'key: some secret data'\r\n```\r\n\r\nRequirements:\r\n\r\n```\r\naiohttp           == 3.7.4\r\naiohttp-session   == 2.9.0\r\ncryptography      == 3.4.6\r\nmultidict         == 5.1.0\r\npackaging         == 20.9\r\npy                == 1.10.0\r\nsetuptools        == 53.0.0\r\nyarl              == 1.6.3\r\npytest            == 6.2.2\r\npytest-aiohttp    ==  0.3.0\r\n```\r\n\r\n\ud83d\udca1 **Expected behavior**\r\nSecure cookies should be sent to localhost/ 127.0.0.1 on unsecure connection (http)\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n```console\r\npython 3.8.5\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n```console\r\naiohttp: 3.7.4\r\nmultidict: 5.1.0\r\nyarl: 1.6.3\r\n\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\nThis is a client issue.\r\n\r\nProposed Solution: \r\n\r\nchange this [line](https://github.com/aio-libs/aiohttp/blob/e74d40cffd1cb352639466e6e3cd830abd99d442/aiohttp/cookiejar.py#L253) of `aiohttp/cookiejar.py`\r\nfrom \r\n```py\r\nif is_not_secure and cookie[\"secure\"]:\r\n```\r\nto\r\n\r\n```py\r\nif is_not_secure and cookie[\"secure\"] and domain not in ['localhost', '127.0.0.1']:\r\n```\r\nor provide a way to influence the `is_not_secure` variable in order to proceed to sending the cookie, whether the connection is secure or not.  The latter would allow for the ipv4 and ipv6 loopbacks to be affected without exceptional cases (as was the case in the former proposal), and would also provide a way for hosts in `/etc/hosts` to be included in the unsecured requests.\r\n\r\nFurther rationale:\r\n\r\n[This interpretation](https://security.stackexchange.com/a/140944) shows the [RFC section](https://tools.ietf.org/html/rfc6265#section-4.1.2.5) that states:\r\n> The Secure attribute limits the scope of the cookie to \"secure\"\r\n   channels (where \"secure\" is defined by the user agent).  When a\r\n   cookie has the Secure attribute, the user agent will include the\r\n   cookie in an HTTP request only if the request is transmitted over a\r\n   secure channel (typically HTTP over Transport Layer Security (TLS)\r\n   [RFC2818]).\r\n >  Although seemingly useful for protecting cookies from active network\r\n   attackers, the Secure attribute protects only the cookie's\r\n   confidentiality\r\n\r\nI, the user agent, consider the sending and receipt of a request on a single machine, not across a network, to be secure.  Particularly when performing unit testing.\r\n \r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5571/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5571/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5558", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5558/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5558/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5558/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5558", "id": 838287822, "node_id": "MDU6SXNzdWU4MzgyODc4MjI=", "number": 5558, "title": "Could not find starting boundary", "user": {"login": "zhoujinhai", "id": 20365125, "node_id": "MDQ6VXNlcjIwMzY1MTI1", "avatar_url": "https://avatars.githubusercontent.com/u/20365125?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zhoujinhai", "html_url": "https://github.com/zhoujinhai", "followers_url": "https://api.github.com/users/zhoujinhai/followers", "following_url": "https://api.github.com/users/zhoujinhai/following{/other_user}", "gists_url": "https://api.github.com/users/zhoujinhai/gists{/gist_id}", "starred_url": "https://api.github.com/users/zhoujinhai/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zhoujinhai/subscriptions", "organizations_url": "https://api.github.com/users/zhoujinhai/orgs", "repos_url": "https://api.github.com/users/zhoujinhai/repos", "events_url": "https://api.github.com/users/zhoujinhai/events{/privacy}", "received_events_url": "https://api.github.com/users/zhoujinhai/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-03-23T02:22:30Z", "updated_at": "2021-10-30T14:33:34Z", "closed_at": "2021-10-30T14:33:34Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nI am used `aiohttp` as a client and a server to File Uploads\uff0cThe server raised an error when I add headers in post request\u3002\r\n```bash\r\nCould not find starting boundary b'--dd7db5e4c3bd4d5187bb978aef4d85b1'\r\n``` \r\n\r\n\ud83d\udca1 **To Reproduce**\r\n### environment\r\n  > python: 3.7.4\r\n  > aiohttp: 3.7.4.post0\r\n  > windows10 \r\n\r\n### server\r\n```python\r\n...\r\nprint(\"Enter form-data\")\r\nprint(\"req header: \", request.headers)\r\ndata = await request.post()\r\nfile_data = data[\"file\"]\r\n```\r\n\r\n### client\r\n#### 1\u3001Not work\r\n```python\r\nasync with aiohttp.ClientSession() as session:\r\n    async with session.post(\r\n            url='http://{}:{}/mesh/recognize'.format(web_ip, web_port),\r\n            data=file_data,\r\n            headers={'Content-Type': 'multipart/form-data; boundary=dd7db5e4c3bd4d5187bb978aef4d85b1'}\r\n    ) as resp:\r\n```\r\n\r\n**console**:\r\n> Enter form-data\r\n> req header:  <CIMultiDictProxy('Host': '192.168.102.116:8000', 'Content-Type': 'multipart/form-data; boundary=dd7db5e4c3bd4d5187bb978aef4d85b1',  'Accept': '*/*', 'Accept-Encoding': 'gzip, deflate', 'User-Agent': 'Python/3.7 aiohttp/3.7.4.post0', 'Content-Length': '364927')>\r\nCould not find starting boundary b'--dd7db5e4c3bd4d5187bb978aef4d85b1'\r\n---** predict is Failed **---\r\n\r\n#### 2\u3001 work\r\n```python\r\nasync with aiohttp.ClientSession() as session:\r\n    async with session.post(\r\n            url='http://{}:{}/mesh/recognize'.format(web_ip, web_port),\r\n            data=file_data) as resp:\r\n```\r\n\r\n**console**:\r\n> Enter form-data\r\n>req header:  <CIMultiDictProxy('Host': '192.168.102.116:8000', 'Accept': '*/*', 'Accept-Encoding': 'gzip, deflate', 'User-Agent': 'Python/3.7 aiohttp/3.7.4.post0', 'Content-Length': '364927', 'Content-Type': 'multipart/form-data; boundary=dd7db5e4c3bd4d5187bb978aef4d85b1')>\r\nout:  torch.float32\r\nPredict result :tensor([[[0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],\r\n         [5.0122, 4.7581, 4.8532,  ..., 4.7490, 4.6256, 4.8851]]]),\r\nrun time is 3054.393768310547ms\r\n---** predict is Successed! **---", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5558/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5558/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5554", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5554/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5554/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5554/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5554", "id": 837918261, "node_id": "MDU6SXNzdWU4Mzc5MTgyNjE=", "number": 5554, "title": "Setting Environment Proxy (HTTP_PROXY etc.) breaks Some Tests", "user": {"login": "scirelli", "id": 1542072, "node_id": "MDQ6VXNlcjE1NDIwNzI=", "avatar_url": "https://avatars.githubusercontent.com/u/1542072?v=4", "gravatar_id": "", "url": "https://api.github.com/users/scirelli", "html_url": "https://github.com/scirelli", "followers_url": "https://api.github.com/users/scirelli/followers", "following_url": "https://api.github.com/users/scirelli/following{/other_user}", "gists_url": "https://api.github.com/users/scirelli/gists{/gist_id}", "starred_url": "https://api.github.com/users/scirelli/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/scirelli/subscriptions", "organizations_url": "https://api.github.com/users/scirelli/orgs", "repos_url": "https://api.github.com/users/scirelli/repos", "events_url": "https://api.github.com/users/scirelli/events{/privacy}", "received_events_url": "https://api.github.com/users/scirelli/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "scirelli", "id": 1542072, "node_id": "MDQ6VXNlcjE1NDIwNzI=", "avatar_url": "https://avatars.githubusercontent.com/u/1542072?v=4", "gravatar_id": "", "url": "https://api.github.com/users/scirelli", "html_url": "https://github.com/scirelli", "followers_url": "https://api.github.com/users/scirelli/followers", "following_url": "https://api.github.com/users/scirelli/following{/other_user}", "gists_url": "https://api.github.com/users/scirelli/gists{/gist_id}", "starred_url": "https://api.github.com/users/scirelli/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/scirelli/subscriptions", "organizations_url": "https://api.github.com/users/scirelli/orgs", "repos_url": "https://api.github.com/users/scirelli/repos", "events_url": "https://api.github.com/users/scirelli/events{/privacy}", "received_events_url": "https://api.github.com/users/scirelli/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "scirelli", "id": 1542072, "node_id": "MDQ6VXNlcjE1NDIwNzI=", "avatar_url": "https://avatars.githubusercontent.com/u/1542072?v=4", "gravatar_id": "", "url": "https://api.github.com/users/scirelli", "html_url": "https://github.com/scirelli", "followers_url": "https://api.github.com/users/scirelli/followers", "following_url": "https://api.github.com/users/scirelli/following{/other_user}", "gists_url": "https://api.github.com/users/scirelli/gists{/gist_id}", "starred_url": "https://api.github.com/users/scirelli/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/scirelli/subscriptions", "organizations_url": "https://api.github.com/users/scirelli/orgs", "repos_url": "https://api.github.com/users/scirelli/repos", "events_url": "https://api.github.com/users/scirelli/events{/privacy}", "received_events_url": "https://api.github.com/users/scirelli/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2021-03-22T16:52:02Z", "updated_at": "2021-10-31T19:24:48Z", "closed_at": "2021-10-31T19:24:48Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nTests break when proxy environment variables (HTTP_PROXY, HTTPS_PROXY, etc.) are set.\r\n\r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\n\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\n```\r\nexport http_proxy='http://www.example.com,http://proxy.com'\r\nmake test\r\n```\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\nTests should pass.\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\nFAILED tests/test_helpers.py::test_proxies_from_env[https] - AssertionError: assert dict_keys(['http', 'https']) == {'https'}\r\nFAILED tests/test_helpers.py::test_proxies_from_env[ws] - AssertionError: assert dict_keys(['http', 'ws']) == {'ws'}\r\nFAILED tests/test_helpers.py::test_proxies_from_env[wss] - AssertionError: assert dict_keys(['http', 'wss']) == {'wss'}\r\nFAILED tests/test_helpers.py::test_proxies_from_env_skipped[https] - AssertionError: assert {'http': ProxyInfo(proxy=URL('http://www.example.com,http//proxy.com'), proxy_auth=None)} == {}\r\nFAILED tests/test_helpers.py::test_proxies_from_env_skipped[wss] - AssertionError: assert {'http': ProxyInfo(proxy=URL('http://www.example.com,http//proxy.com'), proxy_auth=None)} == {}\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.8.7\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 4.0.0a1\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/cirelli/Projects/aiohttp\r\nRequires: chardet, multidict, async-timeout, yarl, typing-extensions, frozenlist, aiosignal\r\nRequired-by: \r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.1.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/cirelli/Projects/aiohttp/.venv/lib/python3.8/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.3\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/cirelli/Projects/aiohttp/.venv/lib/python3.8/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\nMac OS", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5554/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 1}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5554/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5527", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5527/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5527/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5527/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5527", "id": 826392738, "node_id": "MDU6SXNzdWU4MjYzOTI3Mzg=", "number": 5527, "title": "ClientTimeout values of 0 don't disable timeouts", "user": {"login": "rmoe", "id": 26524, "node_id": "MDQ6VXNlcjI2NTI0", "avatar_url": "https://avatars.githubusercontent.com/u/26524?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rmoe", "html_url": "https://github.com/rmoe", "followers_url": "https://api.github.com/users/rmoe/followers", "following_url": "https://api.github.com/users/rmoe/following{/other_user}", "gists_url": "https://api.github.com/users/rmoe/gists{/gist_id}", "starred_url": "https://api.github.com/users/rmoe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rmoe/subscriptions", "organizations_url": "https://api.github.com/users/rmoe/orgs", "repos_url": "https://api.github.com/users/rmoe/repos", "events_url": "https://api.github.com/users/rmoe/events{/privacy}", "received_events_url": "https://api.github.com/users/rmoe/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "Dreamsorcerer", "id": 2203121, "node_id": "MDQ6VXNlcjIyMDMxMjE=", "avatar_url": "https://avatars.githubusercontent.com/u/2203121?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dreamsorcerer", "html_url": "https://github.com/Dreamsorcerer", "followers_url": "https://api.github.com/users/Dreamsorcerer/followers", "following_url": "https://api.github.com/users/Dreamsorcerer/following{/other_user}", "gists_url": "https://api.github.com/users/Dreamsorcerer/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dreamsorcerer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dreamsorcerer/subscriptions", "organizations_url": "https://api.github.com/users/Dreamsorcerer/orgs", "repos_url": "https://api.github.com/users/Dreamsorcerer/repos", "events_url": "https://api.github.com/users/Dreamsorcerer/events{/privacy}", "received_events_url": "https://api.github.com/users/Dreamsorcerer/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "Dreamsorcerer", "id": 2203121, "node_id": "MDQ6VXNlcjIyMDMxMjE=", "avatar_url": "https://avatars.githubusercontent.com/u/2203121?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dreamsorcerer", "html_url": "https://github.com/Dreamsorcerer", "followers_url": "https://api.github.com/users/Dreamsorcerer/followers", "following_url": "https://api.github.com/users/Dreamsorcerer/following{/other_user}", "gists_url": "https://api.github.com/users/Dreamsorcerer/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dreamsorcerer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dreamsorcerer/subscriptions", "organizations_url": "https://api.github.com/users/Dreamsorcerer/orgs", "repos_url": "https://api.github.com/users/Dreamsorcerer/repos", "events_url": "https://api.github.com/users/Dreamsorcerer/events{/privacy}", "received_events_url": "https://api.github.com/users/Dreamsorcerer/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 9, "created_at": "2021-03-09T18:07:06Z", "updated_at": "2021-10-30T14:53:35Z", "closed_at": "2021-10-30T14:53:35Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n`ClientTimeout` values of 0 and `None` are treated differently. The docs [here](https://docs.aiohttp.org/en/stable/client_quickstart.html#timeouts) state:\r\n\r\n> All fields are floats, None or 0 disables a particular timeout check\r\n\r\nand versions 3.6.3 and earlier do work this way. After #5091 this behavior was changed.\r\n\r\n\ud83d\udca1 **To Reproduce**\r\nThis simple example illustrates the issue:\r\n\r\n```python\r\ntimeout = aiohttp.ClientTimeout(\r\n    total=90,\r\n    connect=0,\r\n    sock_connect=0,\r\n    sock_read=0\r\n)\r\n\r\nasync with aiohttp.ClientSession(timeout=timeout) as session:\r\n    print(await session.get(\"https://google.com\"))\r\n```\r\n\r\nWith v3.6.3:\r\n\r\n```bash\r\nryan@debian:~$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.6.3\r\n\r\nryan@debian:~$ python test.py\r\n<ClientResponse(https://www.google.com/) [200 OK]>\r\n```\r\n\r\nWith v3.7.4:\r\n\r\n```bash\r\nryan@debian:~$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.4\r\n\r\nryan@debian:~$ python test.py\r\n```\r\n\r\n```python\r\nTraceback (most recent call last):\r\n  File \"/home/ryan/.virtualenvs/aio-test/lib/python3.9/site-packages/aiohttp/client.py\", line 520, in _request\r\n    conn = await self._connector.connect(\r\n  File \"/home/ryan/.virtualenvs/aio-test/lib/python3.9/site-packages/aiohttp/connector.py\", line 535, in connect\r\n    proto = await self._create_connection(req, traces, timeout)\r\n  File \"/home/ryan/.virtualenvs/aio-test/lib/python3.9/site-packages/aiohttp/connector.py\", line 892, in _create_connection\r\n    _, proto = await self._create_direct_connection(req, traces, timeout)\r\n  File \"/home/ryan/.virtualenvs/aio-test/lib/python3.9/site-packages/aiohttp/connector.py\", line 999, in _create_direct_connection\r\n    hosts = await asyncio.shield(host_resolved)\r\nasyncio.exceptions.CancelledError\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/ryan/.virtualenvs/aio-test/lib/python3.9/site-packages/aiohttp/client.py\", line 520, in _request\r\n    conn = await self._connector.connect(\r\n  File \"/home/ryan/.virtualenvs/aio-test/lib/python3.9/site-packages/async_timeout/__init__.py\", line 45, in __exit__\r\n    self._do_exit(exc_type)\r\n  File \"/home/ryan/.virtualenvs/aio-test/lib/python3.9/site-packages/async_timeout/__init__.py\", line 92, in _do_exit\r\n    raise asyncio.TimeoutError\r\nasyncio.exceptions.TimeoutError\r\n\r\n...\r\n\r\nFile \"/home/ryan/.virtualenvs/aio-test/lib/python3.9/site-packages/aiohttp/client.py\", line 524, in _request\r\n    raise ServerTimeoutError(\r\naiohttp.client_exceptions.ServerTimeoutError: Connection timeout to host https://google.com\r\n```\r\nThis timeout happens immediately.\r\n\r\nWith 3.7.4 if I change the timeout values from 0 to `None` it works correctly.\r\n\r\n```\r\nryan@debian:~$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.4\r\n\r\nryan@debian:~$ python test.py\r\n<ClientResponse(https://www.google.com/) [200 OK]>\r\n```\r\n\r\n\ud83d\udca1 **Expected behavior**\r\nTimeouts with values of 0 should be ignored (or the docs updated to say 0 doesn't disable the timeouts).\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5527/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5527/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5518", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5518/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5518/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5518/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5518", "id": 823731420, "node_id": "MDU6SXNzdWU4MjM3MzE0MjA=", "number": 5518, "title": "Fix missing references in docs", "user": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 58986077, "node_id": "MDU6TGFiZWw1ODk4NjA3Nw==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/enhancement", "name": "enhancement", "color": "84b6eb", "default": true, "description": null}, {"id": 277836062, "node_id": "MDU6TGFiZWwyNzc4MzYwNjI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/good%20first%20issue", "name": "good first issue", "color": "7057ff", "default": true, "description": "Good for newcomers"}, {"id": 445958404, "node_id": "MDU6TGFiZWw0NDU5NTg0MDQ=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/documentation", "name": "documentation", "color": "0075ca", "default": true, "description": "Improvements or additions to documentation"}, {"id": 731921232, "node_id": "MDU6TGFiZWw3MzE5MjEyMzI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/infra", "name": "infra", "color": "e55e5b", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "l1storez", "id": 52452803, "node_id": "MDQ6VXNlcjUyNDUyODAz", "avatar_url": "https://avatars.githubusercontent.com/u/52452803?v=4", "gravatar_id": "", "url": "https://api.github.com/users/l1storez", "html_url": "https://github.com/l1storez", "followers_url": "https://api.github.com/users/l1storez/followers", "following_url": "https://api.github.com/users/l1storez/following{/other_user}", "gists_url": "https://api.github.com/users/l1storez/gists{/gist_id}", "starred_url": "https://api.github.com/users/l1storez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/l1storez/subscriptions", "organizations_url": "https://api.github.com/users/l1storez/orgs", "repos_url": "https://api.github.com/users/l1storez/repos", "events_url": "https://api.github.com/users/l1storez/events{/privacy}", "received_events_url": "https://api.github.com/users/l1storez/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "l1storez", "id": 52452803, "node_id": "MDQ6VXNlcjUyNDUyODAz", "avatar_url": "https://avatars.githubusercontent.com/u/52452803?v=4", "gravatar_id": "", "url": "https://api.github.com/users/l1storez", "html_url": "https://github.com/l1storez", "followers_url": "https://api.github.com/users/l1storez/followers", "following_url": "https://api.github.com/users/l1storez/following{/other_user}", "gists_url": "https://api.github.com/users/l1storez/gists{/gist_id}", "starred_url": "https://api.github.com/users/l1storez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/l1storez/subscriptions", "organizations_url": "https://api.github.com/users/l1storez/orgs", "repos_url": "https://api.github.com/users/l1storez/repos", "events_url": "https://api.github.com/users/l1storez/events{/privacy}", "received_events_url": "https://api.github.com/users/l1storez/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 26, "created_at": "2021-03-06T19:43:51Z", "updated_at": "2021-06-06T20:00:59Z", "closed_at": "2021-06-06T20:00:59Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "**:wave:  THIS IS A GOOD FIRST ISSUE**\r\n\r\n\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nI noticed that the docs have some RST references to internal and external intersphinx objects. We should fix those and enable `nitpicky = True` by default.\r\n\r\n_P.S. It is okay to send small PRs to fix references gradually_\r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n\r\nUncomment `nitpicky = True` in `docs/conf.py` and run `make doc`.\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\nNo errors.\r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```console\r\n/home/wk/src/github/aio-libs/aiohttp/docs/abc.rst:22: WARNING: py:class reference target not found: AbstractRouter\r\n/home/wk/src/github/aio-libs/aiohttp/docs/abc.rst:22: WARNING: py:meth reference target not found: AbstractRouter.resolve\r\n/home/wk/src/github/aio-libs/aiohttp/docs/abc.rst:22: WARNING: py:class reference target not found: AbstractMatchInfo\r\n/home/wk/src/github/aio-libs/aiohttp/docs/abc.rst:26: WARNING: py:meth reference target not found: AbstractMatchInfo.handler\r\n/home/wk/src/github/aio-libs/aiohttp/docs/abc.rst:26: WARNING: py:attr reference target not found: AbstractMatchInfo.http_exception\r\n/home/wk/src/github/aio-libs/aiohttp/docs/abc.rst:30: WARNING: py:attr reference target not found: AbstractMatchInfo.http_exception\r\n/home/wk/src/github/aio-libs/aiohttp/docs/abc.rst:30: WARNING: py:meth reference target not found: AbstractMatchInfo.handler\r\n/home/wk/src/github/aio-libs/aiohttp/docs/abc.rst:30: WARNING: py:attr reference target not found: AbstractMatchInfo.http_exception\r\n/home/wk/src/github/aio-libs/aiohttp/docs/abc.rst:52: WARNING: py:class reference target not found: AbstractMatchInfo\r\n/home/wk/src/github/aio-libs/aiohttp/docs/abc.rst:57: WARNING: py:meth reference target not found: AbstractRouter.resolve\r\n/home/wk/src/github/aio-libs/aiohttp/docs/abc.rst:105: WARNING: py:attr reference target not found: ClientSession.cookie_jar\r\n/home/wk/src/github/aio-libs/aiohttp/docs/abc.rst:169: WARNING: py:class reference target not found: RequestHandler\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_advanced.rst:190: WARNING: py:class reference target not found: aiohttp.SimpleCookie\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_advanced.rst:296: WARNING: py:class reference target not found: SimpleNamespace\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_advanced.rst:312: WARNING: py:class reference target not found: SimpleNampespace\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_advanced.rst:425: WARNING: py:class reference target not found: aiohttp.NamedPipeConnector\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_advanced.rst:588: WARNING: py:class reference target not found: aiohttp.connector.BaseConnector\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_quickstart.rst:102: WARNING: py:class reference target not found: MultiDict\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_quickstart.rst:320: WARNING: py:class reference target not found: aiohttp.streams.StreamReader\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_quickstart.rst:330: WARNING: py:mod reference target not found: aiohttp\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_quickstart.rst:369: WARNING: py:mod reference target not found: aiohttp\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:91: WARNING: py:class reference target not found: aiohttp.istr\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:98: WARNING: py:class reference target not found: AbstractCookieJar\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:779: WARNING: py:class reference target not found: callable\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:213: WARNING: py:class reference target not found: aiohttp.AbstractCookieJar\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:264: WARNING: py:class reference target not found: aiohttp.istr\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:296: WARNING: py:class reference target not found: callable\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:353: WARNING: py:class reference target not found: aiohttp.MultiDict\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:353: WARNING: py:class reference target not found: aiohttp.MultiDictProxy\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:389: WARNING: py:class reference target not found: aiohttp.istr\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:: WARNING: py:class reference target not found: abc.Mapping\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:516: WARNING: py:meth reference target not found: aiohttp.ClientSession.request\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:534: WARNING: py:meth reference target not found: aiohttp.ClientSession.request\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:541: WARNING: py:meth reference target not found: aiohttp.ClientSession.request\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:554: WARNING: py:meth reference target not found: aiohttp.ClientSession.request\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:561: WARNING: py:meth reference target not found: aiohttp.ClientSession.request\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:574: WARNING: py:meth reference target not found: aiohttp.ClientSession.request\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:589: WARNING: py:meth reference target not found: aiohttp.ClientSession.request\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:607: WARNING: py:meth reference target not found: aiohttp.ClientSession.request\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:626: WARNING: py:meth reference target not found: aiohttp.ClientSession.request\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:632: WARNING: py:meth reference target not found: aiohttp.ClientSession.request\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:: WARNING: py:class reference target not found: aiohttp.protocol.HttpVersion\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:991: WARNING: py:class reference target not found: aiohttp.ClientRequest\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:1137: WARNING: py:class reference target not found: aiohttp.abc.AbstractResolver\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:1084: WARNING: py:const reference target not found: socket.AF_INET\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:1084: WARNING: py:const reference target not found: socket.AF_INET6\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:1088: WARNING: py:const reference target not found: socket.AF_INET\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:1088: WARNING: py:const reference target not found: socket.AF_INET6\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:1113: WARNING: py:const reference target not found: socket.AF_INET\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:1113: WARNING: py:const reference target not found: socket.AF_INET6\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:1216: WARNING: py:meth reference target not found: ClientSession.request\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:1232: WARNING: py:class reference target not found: HttpVersion\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:1441: WARNING: py:class reference target not found: callable\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:1444: WARNING: py:class reference target not found: ClientRequest\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:1467: WARNING: py:func reference target not found: aiohttp.ws_connect\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:1483: WARNING: py:meth reference target not found: start\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:1580: WARNING: py:class reference target not found: callable\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:1641: WARNING: py:class reference target not found: callable\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:1713: WARNING: py:class reference target not found: ClientRequest\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:1747: WARNING: py:meth reference target not found: ClientSession.request\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:1798: WARNING: py:class reference target not found: aiohttp.AbstractCookieJar\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:1813: WARNING: py:class reference target not found: aiohttp.abc.AbstractCookieJar\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:1920: WARNING: py:class reference target not found: Payload\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:1955: WARNING: py:class reference target not found: bytesarray\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:1962: WARNING: py:class reference target not found: bytesarray\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:2105: WARNING: py:meth reference target not found: aiohttp.ClientSession.request\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:2166: WARNING: py:exc reference target not found: ServerDisconnectionError\r\n/home/wk/src/github/aio-libs/aiohttp/docs/client_reference.rst:2195: WARNING: py:exc reference target not found: ClientHttpProxyError\r\n/home/wk/src/github/aio-libs/aiohttp/docs/faq.rst:288: WARNING: py:meth reference target not found: aiohttp.web.Response.write_eof\r\n/home/wk/src/github/aio-libs/aiohttp/docs/logging.rst:41: WARNING: py:obj reference target not found: logging.DEBUG\r\n/home/wk/src/github/aio-libs/aiohttp/docs/logging.rst:128: WARNING: py:class reference target not found: aiohttp.abc.AbstractAsyncAccessLogger\r\n/home/wk/src/github/aio-libs/aiohttp/docs/multipart.rst:154: WARNING: py:class reference target not found: Payload\r\n/home/wk/src/github/aio-libs/aiohttp/docs/multipart.rst:154: WARNING: py:meth reference target not found: Payload.set_content_disposition\r\n/home/wk/src/github/aio-libs/aiohttp/docs/multipart.rst:177: WARNING: py:meth reference target not found: aiohttp.ClientSession.request\r\n/home/wk/src/github/aio-libs/aiohttp/docs/multipart.rst:218: WARNING: py:class reference target not found: cgi.FieldStorage\r\n/home/wk/src/github/aio-libs/aiohttp/docs/multipart_reference.rst:10: WARNING: py:class reference target not found: MultipartBodyReader\r\n/home/wk/src/github/aio-libs/aiohttp/docs/multipart_reference.rst:138: WARNING: py:class reference target not found: aiohttp.client.ClientResponse\r\n/home/wk/src/github/aio-libs/aiohttp/docs/new_router.rst:47: WARNING: py:class reference target not found: aiohttp.web.Route\r\n/home/wk/src/github/aio-libs/aiohttp/docs/new_router.rst:68: WARNING: py:class reference target not found: aiohttp.web.BaseResource\r\n/home/wk/src/github/aio-libs/aiohttp/docs/new_router.rst:68: WARNING: py:class reference target not found: aiohttp.web.Route\r\n/home/wk/src/github/aio-libs/aiohttp/docs/new_router.rst:83: WARNING: py:class reference target not found: aiohttp.web.ResourceAdapter\r\n/home/wk/src/github/aio-libs/aiohttp/docs/streams.rst:9: WARNING: py:attr reference target not found: aiohttp.web.Request.content\r\n/home/wk/src/github/aio-libs/aiohttp/docs/streams.rst:18: WARNING: py:attr reference target not found: aiohttp.web.Request.content\r\n/home/wk/src/github/aio-libs/aiohttp/docs/testing.rst:43: WARNING: py:mod reference target not found: aiohttp.test_tools\r\n/home/wk/src/github/aio-libs/aiohttp/docs/testing.rst:58: WARNING: py:class reference target not found: aiohttp.web.WebServer\r\n/home/wk/src/github/aio-libs/aiohttp/docs/testing.rst:341: WARNING: py:meth reference target not found: get_app\r\n/home/wk/src/github/aio-libs/aiohttp/docs/testing.rst:562: WARNING: py:class reference target not found: list of pairs\r\n/home/wk/src/github/aio-libs/aiohttp/docs/testing.rst:562: WARNING: py:class reference target not found: aiohttp.protocol.HttpVersion\r\n/home/wk/src/github/aio-libs/aiohttp/docs/testing.rst:562: WARNING: py:class reference target not found: aiohttp.StreamWriter\r\n/home/wk/src/github/aio-libs/aiohttp/docs/testing.rst:562: WARNING: py:class reference target not found: asyncio.transports.Transport\r\n/home/wk/src/github/aio-libs/aiohttp/docs/testing.rst:625: WARNING: py:meth reference target not found: aiohttp.test_utils.TestServer.start_server\r\n/home/wk/src/github/aio-libs/aiohttp/docs/testing.rst:625: WARNING: py:meth reference target not found: aiohttp.test_utils.TestServer.close\r\n/home/wk/src/github/aio-libs/aiohttp/docs/testing.rst:663: WARNING: py:class reference target not found: aiohttp.web.WebServer\r\n/home/wk/src/github/aio-libs/aiohttp/docs/testing.rst:667: WARNING: py:class reference target not found: asyncio.AbstractServer\r\n/home/wk/src/github/aio-libs/aiohttp/docs/testing.rst:775: WARNING: py:attr reference target not found: self.server.app\r\n/home/wk/src/github/aio-libs/aiohttp/docs/testing.rst:803: WARNING: py:meth reference target not found: aiohttp.ClientSession.request\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_advanced.rst:437: WARNING: py:class reference target not found: RequestHandler\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_advanced.rst:751: WARNING: py:meth reference target not found: UrlDispatcher.register_resource\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_advanced.rst:851: WARNING: py:data reference target not found: zmq.SUB\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_advanced.rst:851: WARNING: py:obj reference target not found: application['websockets']\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_advanced.rst:896: WARNING: py:func reference target not found: listen_to_redis\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_advanced.rst:971: WARNING: py:func reference target not found: aiohttp_debugtoolbar.setup\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_exceptions.rst:481: WARNING: py:class reference target not found: URL\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_exceptions.rst:488: WARNING: py:class reference target not found: URL\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_lowlevel.rst:20: WARNING: py:meth reference target not found: asyncio.AbstractEventLoop.create_server\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_quickstart.rst:139: WARNING: py:attr reference target not found: Request.method\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_quickstart.rst:358: WARNING: py:meth reference target not found: aiohttp.web.UrlDispather.add_routes\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_quickstart.rst:401: WARNING: py:meth reference target not found: aiohttp.web.UrlDispather.add_routes\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_quickstart.rst:470: WARNING: py:attr reference target not found: Request.query\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_quickstart.rst:473: WARNING: py:meth reference target not found: Request.post\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_quickstart.rst:473: WARNING: py:meth reference target not found: Request.multipart\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_quickstart.rst:476: WARNING: py:meth reference target not found: Request.post\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_quickstart.rst:476: WARNING: py:meth reference target not found: Request.multipart\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_quickstart.rst:554: WARNING: py:meth reference target not found: Request.post\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_quickstart.rst:554: WARNING: py:meth reference target not found: Request.multipart\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:32: WARNING: py:class reference target not found: aiohttp.protocol.HttpVersion\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:121: WARNING: py:func reference target not found: socket.gtfqdn\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:323: WARNING: py:class reference target not found: ETag\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:326: WARNING: py:class reference target not found: ETag\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:333: WARNING: py:class reference target not found: ETag\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:336: WARNING: py:class reference target not found: ETag\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:387: WARNING: py:meth reference target not found: Request.read\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:399: WARNING: py:meth reference target not found: Request.text\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:405: WARNING: py:class reference target not found: web.HTTPBadRequest\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:421: WARNING: py:class reference target not found: callable\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:418: WARNING: py:meth reference target not found: Request.json\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:424: WARNING: py:class reference target not found: aiohttp.multipart.MultipartReader\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:462: WARNING: py:meth reference target not found: Request.post\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:473: WARNING: py:meth reference target not found: Request.release\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:502: WARNING: py:class reference target not found: aiohttp.abc.AbstractMatchInfo\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:634: WARNING: py:attr reference target not found: Request.keep_alive\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:801: WARNING: py:class reference target not found: ETag\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:898: WARNING: py:class reference target not found: aiohttp.payload.StringPayload\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:912: WARNING: py:attr reference target not found: StreamResponse.body\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:930: WARNING: py:attr reference target not found: body\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:1053: WARNING: py:meth reference target not found: start\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:1153: WARNING: py:class reference target not found: callable\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:1250: WARNING: py:class reference target not found: callable\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:1325: WARNING: py:meth reference target not found: Application.copy\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:1476: WARNING: py:class reference target not found: MatchedSubAppResource\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:1529: WARNING: py:class reference target not found: AbstractRouter\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:1529: WARNING: py:meth reference target not found: AbstractRouter.resolve\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:1542: WARNING: py:meth reference target not found: asyncio.AbstreactEventLoop.create_server\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:1570: WARNING: py:class reference target not found: AbstractRouter\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:1574: WARNING: py:meth reference target not found: router\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:1639: WARNING: py:class reference target not found: callable\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:1639: WARNING: py:class reference target not found: coroutine\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:1638: WARNING: py:class reference target not found: PlainRoute\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:1638: WARNING: py:class reference target not found: DynamicRoute\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:1762: WARNING: py:class reference target not found: coroutine\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:1754: WARNING: py:meth reference target not found: StaticRoute.url\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:1754: WARNING: py:meth reference target not found: StaticRoute.url_for\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:1761: WARNING: py:class reference target not found: StaticRoute\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:1765: WARNING: py:class reference target not found: AbstractMatchInfo\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:1768: WARNING: py:class reference target not found: AbstractMatchInfo\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:1771: WARNING: py:attr reference target not found: AbstractMatchInfo.http_exception\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:1773: WARNING: py:attr reference target not found: AbstractMatchInfo.handler\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:1782: WARNING: py:attr reference target not found: Request.raw_path\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:1813: WARNING: py:class reference target not found: BaseResource\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:1847: WARNING: py:class reference target not found: AbstractMatchInfo\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:1847: WARNING: py:attr reference target not found: AbstractMatchInfo.http_exception\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:1847: WARNING: py:attr reference target not found: AbstractMatchInfo.handler\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:1952: WARNING: py:class reference target not found: callable\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:1952: WARNING: py:class reference target not found: coroutine\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:2334: WARNING: py:class reference target not found: abc.collections.Sequence\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:2418: WARNING: py:class reference target not found: AbstractMatchInfo\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:2424: WARNING: py:class reference target not found: AbstractMatchInfo\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:2437: WARNING: py:class reference target not found: Route\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:2445: WARNING: py:class reference target not found: AbstractView\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:2522: WARNING: py:meth reference target not found: socket.getsockname\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:2562: WARNING: py:data reference target not found: aiohttp.log.server_logger\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:2564: WARNING: py:data reference target not found: aiohttp.log.access_logger\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:2566: WARNING: py:data reference target not found: aiohttp.helpers.AccessLogger\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:2566: WARNING: py:class reference target not found: aiohttp.abc.AbstractAccessLogger\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:2569: WARNING: py:attr reference target not found: helpers.AccessLogger.LOG_FORMAT\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:2668: WARNING: py:meth reference target not found: socket.listen\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:2703: WARNING: py:meth reference target not found: socket.listen\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:2729: WARNING: py:class reference target not found: socket.socket\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:2739: WARNING: py:meth reference target not found: socket.listen\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:2750: WARNING: py:class reference target not found: collections.namedtuple\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:2750: WARNING: py:meth reference target not found: Request.POST\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:2883: WARNING: py:class reference target not found: socket\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:2848: WARNING: py:data reference target not found: aiohttp.helpers.AccessLogger\r\n/home/wk/src/github/aio-libs/aiohttp/docs/web_reference.rst:2848: WARNING: py:class reference target not found: aiohttp.abc.AbstractAccessLogger\r\n/home/wk/src/github/aio-libs/aiohttp/docs/websocket_utilities.rst:42: WARNING: py:attr reference target not found: WSCloseCode.unsupported_data\r\n/home/wk/src/github/aio-libs/aiohttp/docs/websocket_utilities.rst:42: WARNING: py:attr reference target not found: WSCloseCode.message_too_big\r\n/home/wk/src/github/aio-libs/aiohttp/docs/whats_new_1_1.rst:23: WARNING: py:class reference target not found: web.Request.url\r\n/home/wk/src/github/aio-libs/aiohttp/docs/whats_new_1_1.rst:23: WARNING: py:class reference target not found: web.Request.rel_url\r\n/home/wk/src/github/aio-libs/aiohttp/docs/whats_new_1_1.rst:35: WARNING: py:class reference target not found: aiohttp.web.Request.url_for(name, **kwargs)\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\nN/A\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\nN/A\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\nAll the existing references can be found at https://webknjaz.github.io/intersphinx-untangled/", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5518/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5518/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5513", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5513/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5513/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5513/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5513", "id": 820392974, "node_id": "MDU6SXNzdWU4MjAzOTI5NzQ=", "number": 5513, "title": "Client: Range/Partial content not working", "user": {"login": "MerlijnWajer", "id": 517897, "node_id": "MDQ6VXNlcjUxNzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/517897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MerlijnWajer", "html_url": "https://github.com/MerlijnWajer", "followers_url": "https://api.github.com/users/MerlijnWajer/followers", "following_url": "https://api.github.com/users/MerlijnWajer/following{/other_user}", "gists_url": "https://api.github.com/users/MerlijnWajer/gists{/gist_id}", "starred_url": "https://api.github.com/users/MerlijnWajer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MerlijnWajer/subscriptions", "organizations_url": "https://api.github.com/users/MerlijnWajer/orgs", "repos_url": "https://api.github.com/users/MerlijnWajer/repos", "events_url": "https://api.github.com/users/MerlijnWajer/events{/privacy}", "received_events_url": "https://api.github.com/users/MerlijnWajer/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1831256427, "node_id": "MDU6TGFiZWwxODMxMjU2NDI3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/reproducer:%20present", "name": "reproducer: present", "color": "c2e0c6", "default": false, "description": "This PR or issue contains code, which reproduce the problem described or clearly understandable STR"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2021-03-02T21:10:10Z", "updated_at": "2021-03-07T07:46:53Z", "closed_at": "2021-03-07T07:46:53Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n\r\nI'm trying to specify the \"Range:\" header to fetch partial content from a server. This works with curl, but I cannot get it to work with aiohttp - the full document is returned, and the status code is 200, not 206. Perhaps the headers aren't passed properly to the remote server, since the status code is 200.\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n\r\nCheck that curl works:\r\n\r\n```\r\ncurl -v https://ia801507.us.archive.org/28/items/sim_english-illustrated-magazine_1884-12_2_15/sim_english-illustrated-magazine_1884-12_2_15_hocr.html  -H 'Range: bytes=406259-541176'\r\n```\r\n\r\nPython code:\r\n\r\n```\r\nimport aiohttp\r\nimport asyncio\r\n\r\nasync def main():\r\n    url = 'https://ia801507.us.archive.org/28/items/sim_english-illustrated-magazine_1884-12_2_15/sim_english-illustrated-magazine_1884-12_2_15_hocr.html'\r\n    headers={'Range': 'bytes=406259-541176'}\r\n\r\n    async with aiohttp.ClientSession(headers=headers) as session:\r\n        async with session.get(url) as response:\r\n\r\n            print(\"Status:\", response.status)\r\n            print(\"Content-type:\", response.headers['content-type'])\r\n\r\n            html = await response.text()\r\n            print('Body length:', len(html))\r\n\r\nloop = asyncio.get_event_loop()\r\nloop.run_until_complete(main())\r\n```\r\n\r\nResults in:\r\n\r\n```\r\n$ python3 /tmp/aio-example.py\r\nStatus: 200\r\nContent-type: text/html; charset=utf-8\r\nBody length: 12419537\r\n```\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n\r\nThe response should return a 206 as status and only the partial content is returned.\r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\n\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n\r\n```console\r\n$ python --version\r\nPython 3.6.12\r\n\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n\r\naiohttp `3.7.3`\r\n\r\n\ud83d\udccb **Additional context**\r\n\r\nUsing Linux, on Gentoo. But the same problem exists in a alpine docker container.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5513/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5513/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5497", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5497/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5497/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5497/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5497", "id": 816317087, "node_id": "MDU6SXNzdWU4MTYzMTcwODc=", "number": 5497, "title": "[GHSA-v6wp-4m6f-gcjg] Open redirect vulnerability in `normalize_path_middleware` middleware", "user": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344996043, "node_id": "MDU6TGFiZWwzNDQ5OTYwNDM=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/server", "name": "server", "color": "006b75", "default": false, "description": null}, {"id": 1831256427, "node_id": "MDU6TGFiZWwxODMxMjU2NDI3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/reproducer:%20present", "name": "reproducer: present", "color": "c2e0c6", "default": false, "description": "This PR or issue contains code, which reproduce the problem described or clearly understandable STR"}], "state": "closed", "locked": true, "assignee": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2021-02-25T10:45:52Z", "updated_at": "2021-02-25T19:00:45Z", "closed_at": "2021-02-25T10:45:55Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\n$sbj. A maliciously constructed link could trick an aiohttp app using `normalize_path_middleware` to issue an HTTP redirect to a foreign website. But not anymore. Fixed in v3.7.4.\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\nSee https://github.com/aio-libs/aiohttp/security/advisories/GHSA-v6wp-4m6f-gcjg.\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\nOWASP: https://cheatsheetseries.owasp.org/cheatsheets/Unvalidated_Redirects_and_Forwards_Cheat_Sheet.html\r\n\r\nOur security policy: https://github.com/aio-libs/aiohttp/security/policy (TL;DR \u2014 never report security bugs in public, use designated emails for this)\r\n\r\n\ud83d\udc4f **Credits**\r\n\r\nThanks to @jelmer and @g147 for reporting and fixing this.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5497/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5497/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5494", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5494/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5494/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5494/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/5494", "id": 815340800, "node_id": "MDExOlB1bGxSZXF1ZXN0NTc5MTg2MTQx", "number": 5494, "title": "Release all forgotten resources in tests", "user": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 731921232, "node_id": "MDU6TGFiZWw3MzE5MjEyMzI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/infra", "name": "infra", "color": "e55e5b", "default": false, "description": null}, {"id": 1472801557, "node_id": "MDU6TGFiZWwxNDcyODAxNTU3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bot:chronographer:provided", "name": "bot:chronographer:provided", "color": "ededed", "default": false, "description": "There is a change note present in this PR"}, {"id": 2451662697, "node_id": "MDU6TGFiZWwyNDUxNjYyNjk3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/backport-3.8", "name": "backport-3.8", "color": "000000", "default": false, "description": "Trigger automatic backporting to the 3.8 release branch by Patchback robot"}], "state": "closed", "locked": false, "assignee": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2021-02-24T10:28:19Z", "updated_at": "2021-04-18T22:44:11Z", "closed_at": "2021-02-24T11:27:07Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/5494", "html_url": "https://github.com/aio-libs/aiohttp/pull/5494", "diff_url": "https://github.com/aio-libs/aiohttp/pull/5494.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/5494.patch", "merged_at": "2021-02-24T11:27:07Z"}, "body": "## What do these changes do?\r\n\r\nEver since pytest got updated to v6.2, it started emitting resource\r\nwarnings under new Pythons 3.8+ which results in a failed status.\r\n\r\nThis change addresses this issue by properly most of the resources\r\nso they don't even appear and ignoring the rest in cases of race\r\nconditions and other cases that are hard to track down.\r\n\r\n## Are there changes in behavior for the user?\r\n\r\nNo.\r\n\r\n## Related issue number\r\n\r\nN/A\r\n\r\n## Checklist\r\n\r\n- [x] I think the code is well written\r\n- [x] Unit tests for the changes exist\r\n- [ ] Documentation reflects the changes\r\n- [x] If you provide code modification, please add yourself to `CONTRIBUTORS.txt`\r\n  * The format is &lt;Name&gt; &lt;Surname&gt;.\r\n  * Please keep alphabetical order, the file is sorted by names.\r\n- [x] Add a new news fragment into the `CHANGES` folder\r\n  * name it `<issue_id>.<type>` for example (588.bugfix)\r\n  * if you don't have an `issue_id` change it to the pr id after creating the pr\r\n  * ensure type is one of the following:\r\n    * `.feature`: Signifying a new feature.\r\n    * `.bugfix`: Signifying a bug fix.\r\n    * `.doc`: Signifying a documentation improvement.\r\n    * `.removal`: Signifying a deprecation or removal of public API.\r\n    * `.misc`: A ticket has been closed, but it is not of interest to users.\r\n  * Make sure to use full sentences with correct case and punctuation, for example: \"Fix issue with non-ascii contents in doctest text files.\"\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5494/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5494/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5447", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5447/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5447/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5447/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5447", "id": 796188795, "node_id": "MDU6SXNzdWU3OTYxODg3OTU=", "number": 5447, "title": "Fix test run on python3.6 on 3.8 branch after type annotations for mypy --strict", "user": {"login": "derlih", "id": 254158, "node_id": "MDQ6VXNlcjI1NDE1OA==", "avatar_url": "https://avatars.githubusercontent.com/u/254158?v=4", "gravatar_id": "", "url": "https://api.github.com/users/derlih", "html_url": "https://github.com/derlih", "followers_url": "https://api.github.com/users/derlih/followers", "following_url": "https://api.github.com/users/derlih/following{/other_user}", "gists_url": "https://api.github.com/users/derlih/gists{/gist_id}", "starred_url": "https://api.github.com/users/derlih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/derlih/subscriptions", "organizations_url": "https://api.github.com/users/derlih/orgs", "repos_url": "https://api.github.com/users/derlih/repos", "events_url": "https://api.github.com/users/derlih/events{/privacy}", "received_events_url": "https://api.github.com/users/derlih/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-01-28T17:04:43Z", "updated_at": "2021-10-30T14:48:33Z", "closed_at": "2021-10-30T14:48:33Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nAfter 9e3a28a pytest fails on python 3.6\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\n\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\nrun `make vvtest` on 3.8 branch using python.36\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\ntests should pass\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\nImportError while loading conftest '/home/runner/work/aiohttp/aiohttp/tests/conftest.py'.\r\ntests/conftest.py:12: in <module>\r\n    from aiohttp.test_utils import loop_context\r\naiohttp/__init__.py:6: in <module>\r\n    from .client import (\r\naiohttp/client.py:36: in <module>\r\n    from . import hdrs, http, payload\r\naiohttp/http.py:7: in <module>\r\n    from .http_parser import (\r\naiohttp/http_parser.py:75: in <module>\r\n    class RawRequestMessage(NamedTuple):\r\naiohttp/http_parser.py:79: in RawRequestMessage\r\n    headers: CIMultiDictProxy[str]\r\nE   TypeError: 'type' object is not subscriptable\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\n3.6\r\n```", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5447/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5447/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5432", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5432/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5432/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5432/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5432", "id": 793728662, "node_id": "MDU6SXNzdWU3OTM3Mjg2NjI=", "number": 5432, "title": "URL querystring missing in tracer", "user": {"login": "DurandA", "id": 3709037, "node_id": "MDQ6VXNlcjM3MDkwMzc=", "avatar_url": "https://avatars.githubusercontent.com/u/3709037?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DurandA", "html_url": "https://github.com/DurandA", "followers_url": "https://api.github.com/users/DurandA/followers", "following_url": "https://api.github.com/users/DurandA/following{/other_user}", "gists_url": "https://api.github.com/users/DurandA/gists{/gist_id}", "starred_url": "https://api.github.com/users/DurandA/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DurandA/subscriptions", "organizations_url": "https://api.github.com/users/DurandA/orgs", "repos_url": "https://api.github.com/users/DurandA/repos", "events_url": "https://api.github.com/users/DurandA/events{/privacy}", "received_events_url": "https://api.github.com/users/DurandA/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2021-01-25T21:11:44Z", "updated_at": "2021-10-30T10:33:52Z", "closed_at": "2021-10-30T10:33:52Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nThe URL querystring is not propagated to `params.url` in tracer callbacks.\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\n\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\n\r\n```python\r\nimport aiohttp\r\nimport asyncio\r\n\r\nasync def on_request_start(session, trace_config_ctx, params):\r\n    print(f'{repr(params.url)}')\r\n\r\nasync def main():\r\n    trace_config = aiohttp.TraceConfig()\r\n    trace_config.on_request_start.append(on_request_start)\r\n    session = aiohttp.ClientSession(trace_configs=[trace_config])\r\n    async with session:\r\n        params = {'key1': 'value1', 'key2': 'value2'}\r\n        async with session.get('http://httpbin.org/get', params=params) as resp:\r\n            print(resp.url)\r\n\r\nloop = asyncio.get_event_loop()\r\nloop.run_until_complete(main())\r\n```\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\n`parms.url` should contain the query string (e.g. `http://httpbin.org/get?key1=value1&key2=value2`).\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\nPython 3.8.5\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\naiohttp 3.6.2\r\nmultidict 4.7.6\r\nyarl 1.6.3", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5432/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5432/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5417", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5417/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5417/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5417/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5417", "id": 788345194, "node_id": "MDU6SXNzdWU3ODgzNDUxOTQ=", "number": 5417, "title": "Changed case of Connection: Upgrade header causing problems", "user": {"login": "L-Henke", "id": 7975219, "node_id": "MDQ6VXNlcjc5NzUyMTk=", "avatar_url": "https://avatars.githubusercontent.com/u/7975219?v=4", "gravatar_id": "", "url": "https://api.github.com/users/L-Henke", "html_url": "https://github.com/L-Henke", "followers_url": "https://api.github.com/users/L-Henke/followers", "following_url": "https://api.github.com/users/L-Henke/following{/other_user}", "gists_url": "https://api.github.com/users/L-Henke/gists{/gist_id}", "starred_url": "https://api.github.com/users/L-Henke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/L-Henke/subscriptions", "organizations_url": "https://api.github.com/users/L-Henke/orgs", "repos_url": "https://api.github.com/users/L-Henke/repos", "events_url": "https://api.github.com/users/L-Henke/events{/privacy}", "received_events_url": "https://api.github.com/users/L-Henke/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-01-18T15:09:37Z", "updated_at": "2023-04-27T16:25:35Z", "closed_at": "2023-04-27T16:25:35Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nWith the commit https://github.com/aio-libs/aiohttp/commit/3c4ba8f2c5076a3937e7249903bda47add4220b9 the header `Connection: Upgrade` for a websocket connection was changed to `Connection: upgrade`. If I read the [RFC](https://tools.ietf.org/html/rfc6455#section-2.1) correct, this is absolutely valid since the strings should be handled case insensitive. \r\n\r\nBut this change was introduced in a patch version (3.7.2 to 3.7.3). Although this is compliant to the RFC, I think this should be considered a breaking change, since the behavior of the library changes and thus has to go into a minor or even major version update.\r\n\r\nIt seems that the jsonrpc-API I'm connecting to isn't compliant to the RFC and thus the connection via aiohttp hangs indefinitely until the timeout. Of course I'll try to get this fixed in the called API, but nevertheless the changed behavior of aiohttp in a patch version should be reconsidered.\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\n\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\n\r\nThis issue can be reproduced if you connect to a websocket and inspect the header set by aiohttp.\r\n\r\nIn version 3.7.2 this would be: `Connection: Upgrade`\r\nIn version 3.7.3 this would be: `Connection: upgrade`\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\n\r\nIt is expected, that a patch-level update doesn't change the behavior of a library without a valid reason, even if the change is compliant to the related RFC. Many consumers of this api might update to another patch-level without expecting undocumented changes.\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\n\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.8.2\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\n3.7.3\r\n```\r\n```console\r\n$ python -m pip show multidict\r\n5.1.0\r\n```\r\n```console\r\n$ python -m pip show yarl\r\n1.6.3\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5417/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5417/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5409", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5409/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5409/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5409/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5409", "id": 786503896, "node_id": "MDU6SXNzdWU3ODY1MDM4OTY=", "number": 5409, "title": "program got stuck after a while when sending many requests continually, with many `unclosed transport` warning", "user": {"login": "sify21", "id": 11829223, "node_id": "MDQ6VXNlcjExODI5MjIz", "avatar_url": "https://avatars.githubusercontent.com/u/11829223?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sify21", "html_url": "https://github.com/sify21", "followers_url": "https://api.github.com/users/sify21/followers", "following_url": "https://api.github.com/users/sify21/following{/other_user}", "gists_url": "https://api.github.com/users/sify21/gists{/gist_id}", "starred_url": "https://api.github.com/users/sify21/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sify21/subscriptions", "organizations_url": "https://api.github.com/users/sify21/orgs", "repos_url": "https://api.github.com/users/sify21/repos", "events_url": "https://api.github.com/users/sify21/events{/privacy}", "received_events_url": "https://api.github.com/users/sify21/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2021-01-15T03:30:22Z", "updated_at": "2021-01-20T02:14:03Z", "closed_at": "2021-01-20T02:14:02Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nI use aiohttp as a client to crawl online resources continually. I started the program last night and it works perfectly at first, fetching resources piece by piece. But this morning the program got totally stuck, and there are hundreds of resource warnings at the end of the log file:\r\n```python\r\n/usr/lib/python3.9/asyncio/sslproto.py:320: ResourceWarning: unclosed transport <asyncio.sslproto._SSLProtocolTransport object at 0x7efefb9aa520>\r\n  _warn(f\"unclosed transport {self!r}\", ResourceWarning, source=self)\r\nResourceWarning: Enable tracemalloc to get the object allocation traceback\r\n/usr/lib/python3.9/asyncio/sslproto.py:320: ResourceWarning: unclosed transport <asyncio.sslproto._SSLProtocolTransport object at 0x7eff0160fad0>\r\n  _warn(f\"unclosed transport {self!r}\", ResourceWarning, source=self)\r\nResourceWarning: Enable tracemalloc to get the object allocation traceback\r\n```\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\n\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\ncode sample\r\n```python\r\n  async def fetch(self):\r\n        conn = TCPConnector(limit=100, ttl_dns_cache=300, keepalive_timeout=60)                                                             \r\n        tt = ClientTimeout()\r\n        async with ClientSession(raise_for_status=False, connector=conn, timeout=tt) as self.session:\r\n              await self.fetch_resources_recursively(url)\r\n\r\n  async def fetch_resources_recursively(self, url: str):\r\n        tasks = []\r\n        resp_page = None\r\n        while resp_page is None:\r\n            try:\r\n                async with self.session.request(method=\"GET\", url=url) as response:\r\n                    if response.status == 404:\r\n                        print(f\"not found: {url}\")\r\n                        return\r\n                    resp_page = await response.text()\r\n                    if response.status != 200:\r\n                        print(f\"response error: {response}\\nbody: {resp_page}\")\r\n                        resp_page = None\r\n                        await asyncio.sleep(2)\r\n                        continue\r\n            except ClientError as ex:\r\n                print(f\"client error for {url}: {ex}\")\r\n                await asyncio.sleep(2)\r\n            except asyncio.TimeoutError as ex:\r\n                print(f\"timeout error for {url}: {ex}\")\r\n                await asyncio.sleep(2)\r\n        all_href = re.findall(r'<a[^>]+href=\"(.+)\">[^<>]+</a>', resp_page)\r\n        for e in all_href:\r\n                tasks.append(asyncio.create_task(self.fetch_resources_recursively(e)))\r\n        await asyncio.gather(*tasks, return_exceptions=True)\r\n        print(f\"{url} processed complete.\")\r\n```\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\nthe aiohttp client runs continually without stuck\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n`(gdb) bt`\r\n<details>    \r\n\r\n```gdb (paste your traceback in the next line)\r\n(gdb) bt\r\n#0  0x00007eff8b038ad3 in epoll_wait () at ../sysdeps/unix/syscall-template.S:84\r\n#1  0x00000000005d8bfe in select_epoll_poll_impl (self=self@entry=0x7eff8056beb0, timeout_obj=timeout_obj@entry=-1, maxevents=maxevents@entry=1)\r\n    at ../Modules/selectmodule.c:1609\r\n#2  0x00000000005d8e63 in select_epoll_poll (self=0x7eff8056beb0, args=args@entry=0x2e2ac50, nargs=nargs@entry=2, kwnames=kwnames@entry=0x0)\r\n    at ../Modules/clinic/selectmodule.c.h:863\r\n#3  0x000000000062cf67 in method_vectorcall_FASTCALL_KEYWORDS (func=<optimized out>, args=0x2e2ac48, nargsf=<optimized out>, kwnames=0x0)\r\n    at ../Objects/descrobject.c:407\r\n#4  0x00000000004de7ed in _PyObject_VectorcallTstate (kwnames=0x0, nargsf=9223372036854775811, args=<optimized out>, \r\n    callable=<method_descriptor at remote 0x7eff8aacead0>, tstate=0x2b09e10) at ../Include/cpython/abstract.h:118\r\n#5  PyObject_Vectorcall (kwnames=0x0, nargsf=9223372036854775811, args=<optimized out>, callable=<method_descriptor at remote 0x7eff8aacead0>)\r\n    at ../Include/cpython/abstract.h:127\r\n#6  call_function (kwnames=0x0, oparg=<optimized out>, pp_stack=<synthetic pointer>, tstate=0x2b09e10) at ../Python/ceval.c:5072\r\n#7  _PyEval_EvalFrameDefault (tstate=0x2b09e10, \r\n    f=Frame 0x2e2aa90, for file /usr/lib/python3.9/selectors.py, line 469, in select (self=<EpollSelector(_fd_to_key={9: <SelectorKey at remote 0x7eff7f9336e0>}, _map=<_SelectorMapping(_selector=<...>) at remote 0x7eff87313c80>, _selector=<select.epoll at remote 0x7eff8056beb0>) at remote 0x7eff80b04230>, timeout=-1, max_ev=1, ready=[]), throwflag=<optimized out>) at ../Python/ceval.c:3504\r\n#8  0x00000000004d5aa8 in _PyEval_EvalFrame (throwflag=0, \r\n    f=Frame 0x2e2aa90, for file /usr/lib/python3.9/selectors.py, line 469, in select (self=<EpollSelector(_fd_to_key={9: <SelectorKey at remote 0x7eff7f9336e0>}, _map=<_SelectorMapping(_selector=<...>) at remote 0x7eff87313c80>, _selector=<select.epoll at remote 0x7eff8056beb0>) at remote 0x7eff80b04230>, timeout=-1, max_ev=1, ready=[]), tstate=0x2b09e10) at ../Include/internal/pycore_ceval.h:40\r\n#9  _PyEval_EvalCode (tstate=0x2b09e10, _co=_co@entry=<code at remote 0x7eff8aad62b0>, globals=<optimized out>, locals=locals@entry=0x0, args=<optimized out>, \r\n    argcount=<optimized out>, kwnames=0x0, kwargs=0x3808640, kwcount=0, kwstep=1, defs=0x7eff8aad53d8, defcount=1, kwdefs=0x0, closure=0x0, name='select', \r\n    qualname='EpollSelector.select') at ../Python/ceval.c:4327\r\n#10 0x000000000042ee4a in _PyFunction_Vectorcall (func=<optimized out>, stack=<optimized out>, nargsf=<optimized out>, kwnames=<optimized out>) at ../Objects/call.c:395\r\n#11 0x00000000004de7ed in _PyObject_VectorcallTstate (kwnames=0x0, nargsf=9223372036854775810, args=<optimized out>, callable=<function at remote 0x7eff8aa5ccd0>, \r\n    tstate=0x2b09e10) at ../Include/cpython/abstract.h:118\r\n#12 PyObject_Vectorcall (kwnames=0x0, nargsf=9223372036854775810, args=<optimized out>, callable=<function at remote 0x7eff8aa5ccd0>)\r\n    at ../Include/cpython/abstract.h:127\r\n#13 call_function (kwnames=0x0, oparg=<optimized out>, pp_stack=<synthetic pointer>, tstate=0x2b09e10) at ../Python/ceval.c:5072\r\n#14 _PyEval_EvalFrameDefault (tstate=0x2b09e10, \r\n    f=Frame 0x3808460, for file /usr/lib/python3.9/asyncio/base_events.py, line 2366, in _run_once (self=<_UnixSelectorEventLoop(_timer_cancelled_count=0, _closed=False, _stopping=False, _ready=<collections.deque at remote 0x7eff7f86ebd0>, _scheduled=[], _default_executor=<ThreadPoolExecutor(_max_workers=8, _work_queue=<_queue.SimpleQueue at remote 0x7eff8033fbf0>, _idle_semaphore=<Semaphore(_cond=<Condition(_lock=<_thread.lock at remote 0x7eff8731a540>, acquire=<built-in method acquire of _thread.lock object at remote 0x7eff8731a540>, release=<built-in method release of _thread.lock object at remote 0x7eff8731a540>, _waiters=<collections.deque at remote 0x7eff872eb650>) at remote 0x7eff8731f780>, _value=1) at remote 0x7eff8731f820>, _threads={<Thread(_target=<function at remote 0x7eff874de4b0>, _name='asyncio_0', _args=(<weakref at remote 0x7eff872ea710>, <_queue.SimpleQueue at remote 0x7eff8033fbf0>, None, ()), _kwargs={}, _daemonic=False, _ident=139635812992768, _native_id=17002, _tstate_lock=<_thread.lock at re...(truncated), throwflag=<optimized out>) at ../Python/ceval.c:3504\r\n#15 0x000000000042ef14 in _PyEval_EvalFrame (throwflag=0, \r\n    f=Frame 0x3808460, for file /usr/lib/python3.9/asyncio/base_events.py, line 2366, in _run_once (self=<_UnixSelectorEventLoop(_timer_cancelled_count=0, _closed=False, _stopping=False, _ready=<collections.deque at remote 0x7eff7f86ebd0>, _scheduled=[], _default_executor=<ThreadPoolExecutor(_max_workers=8, _work_queue=<_queue.SimpleQueue at remote 0x7eff8033fbf0>, _idle_semaphore=<Semaphore(_cond=<Condition(_lock=<_thread.lock at remote 0x7eff8731a540>, acquire=<built-in method acquire of _thread.lock object at remote 0x7eff8731a540>, release=<built-in method release of _thread.lock object at remote 0x7eff8731a540>, _waiters=<collections.deque at remote 0x7eff872eb650>) at remote 0x7eff8731f780>, _value=1) at remote 0x7eff8731f820>, _threads={<Thread(_target=<function at remote 0x7eff874de4b0>, _name='asyncio_0', _args=(<weakref at remote 0x7eff872ea710>, <_queue.SimpleQueue at remote 0x7eff8033fbf0>, None, ()), _kwargs={}, _daemonic=False, _ident=139635812992768, _native_id=17002, _tstate_lock=<_t---Type <return> to continue, or q <return> to quit---\r\nhread.lock at re...(truncated), tstate=0x2b09e10) at ../Include/internal/pycore_ceval.h:40\r\n#16 function_code_fastcall (tstate=0x2b09e10, co=co@entry=0x7eff879eb6c0, args=0x7eff873157a8, nargs=1, globals=<optimized out>) at ../Objects/call.c:329\r\n#17 0x000000000042ecae in _PyFunction_Vectorcall (func=<optimized out>, stack=<optimized out>, nargsf=<optimized out>, kwnames=<optimized out>) at ../Objects/call.c:366\r\n#18 0x00000000004de7ed in _PyObject_VectorcallTstate (kwnames=0x0, nargsf=9223372036854775809, args=<optimized out>, callable=<function at remote 0x7eff87576d70>, \r\n    tstate=0x2b09e10) at ../Include/cpython/abstract.h:118\r\n#19 PyObject_Vectorcall (kwnames=0x0, nargsf=9223372036854775809, args=<optimized out>, callable=<function at remote 0x7eff87576d70>)\r\n    at ../Include/cpython/abstract.h:127\r\n#20 call_function (kwnames=0x0, oparg=<optimized out>, pp_stack=<synthetic pointer>, tstate=0x2b09e10) at ../Python/ceval.c:5072\r\n#21 _PyEval_EvalFrameDefault (tstate=0x2b09e10, \r\n    f=Frame 0x7eff87315620, for file /usr/lib/python3.9/asyncio/base_events.py, line 852, in run_forever (self=<_UnixSelectorEventLoop(_timer_cancelled_count=0, _closed=False, _stopping=False, _ready=<collections.deque at remote 0x7eff7f86ebd0>, _scheduled=[], _default_executor=<ThreadPoolExecutor(_max_workers=8, _work_queue=<_queue.SimpleQueue at remote 0x7eff8033fbf0>, _idle_semaphore=<Semaphore(_cond=<Condition(_lock=<_thread.lock at remote 0x7eff8731a540>, acquire=<built-in method acquire of _thread.lock object at remote 0x7eff8731a540>, release=<built-in method release of _thread.lock object at remote 0x7eff8731a540>, _waiters=<collections.deque at remote 0x7eff872eb650>) at remote 0x7eff8731f780>, _value=1) at remote 0x7eff8731f820>, _threads={<Thread(_target=<function at remote 0x7eff874de4b0>, _name='asyncio_0', _args=(<weakref at remote 0x7eff872ea710>, <_queue.SimpleQueue at remote 0x7eff8033fbf0>, None, ()), _kwargs={}, _daemonic=False, _ident=139635812992768, _native_id=17002, _tstate_lock=<_thread.lock...(truncated), throwflag=<optimized out>) at ../Python/ceval.c:3504\r\n#22 0x000000000042ef14 in _PyEval_EvalFrame (throwflag=0, \r\n    f=Frame 0x7eff87315620, for file /usr/lib/python3.9/asyncio/base_events.py, line 852, in run_forever (self=<_UnixSelectorEventLoop(_timer_cancelled_count=0, _closed=False, _stopping=False, _ready=<collections.deque at remote 0x7eff7f86ebd0>, _scheduled=[], _default_executor=<ThreadPoolExecutor(_max_workers=8, _work_queue=<_queue.SimpleQueue at remote 0x7eff8033fbf0>, _idle_semaphore=<Semaphore(_cond=<Condition(_lock=<_thread.lock at remote 0x7eff8731a540>, acquire=<built-in method acquire of _thread.lock object at remote 0x7eff8731a540>, release=<built-in method release of _thread.lock object at remote 0x7eff8731a540>, _waiters=<collections.deque at remote 0x7eff872eb650>) at remote 0x7eff8731f780>, _value=1) at remote 0x7eff8731f820>, _threads={<Thread(_target=<function at remote 0x7eff874de4b0>, _name='asyncio_0', _args=(<weakref at remote 0x7eff872ea710>, <_queue.SimpleQueue at remote 0x7eff8033fbf0>, None, ()), _kwargs={}, _daemonic=False, _ident=139635812992768, _native_id=17002, _tstate_lock=<_thread.lock...(truncated), tstate=0x2b09e10) at ../Include/internal/pycore_ceval.h:40\r\n#23 function_code_fastcall (tstate=0x2b09e10, co=co@entry=0x7eff879dc2b0, args=0x7eff80b639e0, nargs=1, globals=<optimized out>) at ../Objects/call.c:329\r\n#24 0x000000000042ecae in _PyFunction_Vectorcall (func=<optimized out>, stack=<optimized out>, nargsf=<optimized out>, kwnames=<optimized out>) at ../Objects/call.c:366\r\n#25 0x00000000004de7ed in _PyObject_VectorcallTstate (kwnames=0x0, nargsf=9223372036854775809, args=<optimized out>, callable=<function at remote 0x7eff87573eb0>, \r\n    tstate=0x2b09e10) at ../Include/cpython/abstract.h:118\r\n#26 PyObject_Vectorcall (kwnames=0x0, nargsf=9223372036854775809, args=<optimized out>, callable=<function at remote 0x7eff87573eb0>)\r\n    at ../Include/cpython/abstract.h:127\r\n#27 call_function (kwnames=0x0, oparg=<optimized out>, pp_stack=<synthetic pointer>, tstate=0x2b09e10) at ../Python/ceval.c:5072\r\n#28 _PyEval_EvalFrameDefault (tstate=0x2b09e10, \r\n    f=Frame 0x7eff80b63850, for file /usr/lib/python3.9/asyncio/base_events.py, line 629, in run_until_complete (self=<_UnixSelectorEventLoop(_timer_cancelled_count=0, _closed=False, _stopping=False, _ready=<collections.deque at remote 0x7eff7f86ebd0>, _scheduled=[], _default_executor=<ThreadPoolExecutor(_max_workers=8, _work_queue=<_queue.SimpleQueue at remote 0x7eff8033fbf0>, _idle_semaphore=<Semaphore(_cond=<Condition(_lock=<_thread.lock at remote 0x7eff8731a540>, acquire=<built-in method acquire of _thread.lock object at remote 0x7eff8731a540>, release=<built-in method release of _thread.lock object at remote 0x7eff8731a540>, _waiters=<collections.deque at remote 0x7eff872eb650>) at remote 0x7eff8731f780>, _value=1) at remote 0x7eff8731f820>, _threads={<Thread(_target=<function at remote 0x7eff874de4b0>, _name='asyncio_0', _args=(<weakref at remote 0x7eff872ea710>, <_queue.SimpleQueue at remote 0x7eff8033fbf0>, None, ()), _kwargs={}, _daemonic=False, _ident=139635812992768, _native_id=17002, _tstate_lock=<_thre...(truncated), throwflag=<optimized out>) at ../Python/ceval.c:3504\r\n#29 0x000000000042ef14 in _PyEval_EvalFrame (throwflag=0, \r\n    f=Frame 0x7eff80b63850, for file /usr/lib/python3.9/asyncio/base_events.py, line 629, in run_until_complete (self=<_UnixSelectorEventLoop(_timer_cancelled_count=0, _closed=False, _stopping=False, _ready=<collections.deque at remote 0x7eff7f86ebd0>, _scheduled=[], _default_executor=<ThreadPoolExecutor(_max_workers=8, _work_queue=<_queue.SimpleQueue at remote 0x7eff8033fbf0>, _idle_semaphore=<Semaphore(_cond=<Condition(_lock=<_thread.lock at remote 0x7eff8731a540>, acquire=<built-in method acquire of _thread.lock object at remote 0x7eff8731a540>, release=<built-in method release of _thread.lock object at remote 0x7eff8731a540>, _waiters=<collections.deque at remote ---Type <return> to continue, or q <return> to quit---\r\n0x7eff872eb650>) at remote 0x7eff8731f780>, _value=1) at remote 0x7eff8731f820>, _threads={<Thread(_target=<function at remote 0x7eff874de4b0>, _name='asyncio_0', _args=(<weakref at remote 0x7eff872ea710>, <_queue.SimpleQueue at remote 0x7eff8033fbf0>, None, ()), _kwargs={}, _daemonic=False, _ident=139635812992768, _native_id=17002, _tstate_lock=<_thre...(truncated), tstate=0x2b09e10) at ../Include/internal/pycore_ceval.h:40\r\n#30 function_code_fastcall (tstate=0x2b09e10, co=co@entry=0x7eff879dc380, args=0x3754ff8, nargs=2, globals=<optimized out>) at ../Objects/call.c:329\r\n#31 0x000000000042ecae in _PyFunction_Vectorcall (func=<optimized out>, stack=<optimized out>, nargsf=<optimized out>, kwnames=<optimized out>) at ../Objects/call.c:366\r\n#32 0x00000000004de7ed in _PyObject_VectorcallTstate (kwnames=0x0, nargsf=9223372036854775810, args=<optimized out>, callable=<function at remote 0x7eff87573f50>, \r\n    tstate=0x2b09e10) at ../Include/cpython/abstract.h:118\r\n#33 PyObject_Vectorcall (kwnames=0x0, nargsf=9223372036854775810, args=<optimized out>, callable=<function at remote 0x7eff87573f50>)\r\n    at ../Include/cpython/abstract.h:127\r\n#34 call_function (kwnames=0x0, oparg=<optimized out>, pp_stack=<synthetic pointer>, tstate=0x2b09e10) at ../Python/ceval.c:5072\r\n#35 _PyEval_EvalFrameDefault (tstate=0x2b09e10, \r\n    f=Frame 0x3754e60, for file /usr/lib/python3.9/asyncio/runners.py, line 300, in run (main=<coroutine at remote 0x7eff7f924a70>, debug=None, loop=<_UnixSelectorEventLoop(_timer_cancelled_count=0, _closed=False, _stopping=False, _ready=<collections.deque at remote 0x7eff7f86ebd0>, _scheduled=[], _default_executor=<ThreadPoolExecutor(_max_workers=8, _work_queue=<_queue.SimpleQueue at remote 0x7eff8033fbf0>, _idle_semaphore=<Semaphore(_cond=<Condition(_lock=<_thread.lock at remote 0x7eff8731a540>, acquire=<built-in method acquire of _thread.lock object at remote 0x7eff8731a540>, release=<built-in method release of _thread.lock object at remote 0x7eff8731a540>, _waiters=<collections.deque at remote 0x7eff872eb650>) at remote 0x7eff8731f780>, _value=1) at remote 0x7eff8731f820>, _threads={<Thread(_target=<function at remote 0x7eff874de4b0>, _name='asyncio_0', _args=(<weakref at remote 0x7eff872ea710>, <_queue.SimpleQueue at remote 0x7eff8033fbf0>, None, ()), _kwargs={}, _daemonic=False, _ident=139635812992768, _nativ...(truncated), throwflag=<optimized out>) at ../Python/ceval.c:3504\r\n#36 0x00000000004d5aa8 in _PyEval_EvalFrame (throwflag=0, \r\n    f=Frame 0x3754e60, for file /usr/lib/python3.9/asyncio/runners.py, line 300, in run (main=<coroutine at remote 0x7eff7f924a70>, debug=None, loop=<_UnixSelectorEventLoop(_timer_cancelled_count=0, _closed=False, _stopping=False, _ready=<collections.deque at remote 0x7eff7f86ebd0>, _scheduled=[], _default_executor=<ThreadPoolExecutor(_max_workers=8, _work_queue=<_queue.SimpleQueue at remote 0x7eff8033fbf0>, _idle_semaphore=<Semaphore(_cond=<Condition(_lock=<_thread.lock at remote 0x7eff8731a540>, acquire=<built-in method acquire of _thread.lock object at remote 0x7eff8731a540>, release=<built-in method release of _thread.lock object at remote 0x7eff8731a540>, _waiters=<collections.deque at remote 0x7eff872eb650>) at remote 0x7eff8731f780>, _value=1) at remote 0x7eff8731f820>, _threads={<Thread(_target=<function at remote 0x7eff874de4b0>, _name='asyncio_0', _args=(<weakref at remote 0x7eff872ea710>, <_queue.SimpleQueue at remote 0x7eff8033fbf0>, None, ()), _kwargs={}, _daemonic=False, _ident=139635812992768, _nativ...(truncated), tstate=0x2b09e10) at ../Include/internal/pycore_ceval.h:40\r\n#37 _PyEval_EvalCode (tstate=0x2b09e10, _co=_co@entry=<code at remote 0x7eff87a2b860>, globals=<optimized out>, locals=locals@entry=0x0, args=<optimized out>, \r\n    argcount=<optimized out>, kwnames=0x0, kwargs=0x7eff80b025d8, kwcount=0, kwstep=1, defs=0x0, defcount=0, kwdefs={'debug': None}, closure=0x0, name='run', \r\n    qualname='run') at ../Python/ceval.c:4327\r\n#38 0x000000000042ee4a in _PyFunction_Vectorcall (func=<optimized out>, stack=<optimized out>, nargsf=<optimized out>, kwnames=<optimized out>) at ../Objects/call.c:395\r\n#39 0x00000000004de591 in _PyObject_VectorcallTstate (kwnames=0x0, nargsf=9223372036854775809, args=<optimized out>, callable=<function at remote 0x7eff879e85f0>, \r\n    tstate=0x2b09e10) at ../Include/cpython/abstract.h:118\r\n#40 PyObject_Vectorcall (kwnames=0x0, nargsf=9223372036854775809, args=<optimized out>, callable=<function at remote 0x7eff879e85f0>)\r\n    at ../Include/cpython/abstract.h:127\r\n#41 call_function (kwnames=0x0, oparg=<optimized out>, pp_stack=<synthetic pointer>, tstate=0x2b09e10) at ../Python/ceval.c:5072\r\n#42 _PyEval_EvalFrameDefault (tstate=0x2b09e10, \r\n    f=Frame 0x7eff80b02450, for file /home/sec-ops/crawler/fetch.py, line 61, in fetch_resource (self=<Crawler(...(truncated), throwflag=<optimized out>) at ../Python/ceval.c:3487\r\n#43 0x000000000042ef14 in _PyEval_EvalFrame (throwflag=0, \r\n---Type <return> to continue, or q <return> to quit---\r\n    f=Frame 0x7eff80b02450, for file /home/sec-ops/crawler/fetch.py, line 61, in fetch_resource (self=<Crawler(...(truncated), tstate=0x2b09e10) at ../Include/internal/pycore_ceval.h:40\r\n#44 function_code_fastcall (tstate=0x2b09e10, co=co@entry=0x7eff7f92e2b0, args=0x3780b68, nargs=1, globals=<optimized out>) at ../Objects/call.c:329\r\n#45 0x000000000042ecae in _PyFunction_Vectorcall (func=<optimized out>, stack=<optimized out>, nargsf=<optimized out>, kwnames=<optimized out>) at ../Objects/call.c:366\r\n#46 0x00000000004de7ed in _PyObject_VectorcallTstate (kwnames=0x0, nargsf=9223372036854775809, args=<optimized out>, callable=<function at remote 0x7eff87319410>, \r\n    tstate=0x2b09e10) at ../Include/cpython/abstract.h:118\r\n#47 PyObject_Vectorcall (kwnames=0x0, nargsf=9223372036854775809, args=<optimized out>, callable=<function at remote 0x7eff87319410>)\r\n    at ../Include/cpython/abstract.h:127\r\n#48 call_function (kwnames=0x0, oparg=<optimized out>, pp_stack=<synthetic pointer>, tstate=0x2b09e10) at ../Python/ceval.c:5072\r\n```    \r\n\r\n</details>    \r\n\r\n`(gdb) py-bt`    \r\n<details>    \r\n\r\n```gdb\r\n(gdb) py-bt\r\nTraceback (most recent call first):\r\n  File \"/usr/lib/python3.9/selectors.py\", line 469, in select\r\n    fd_event_list = self._selector.poll(timeout, max_ev)\r\n  File \"/usr/lib/python3.9/asyncio/base_events.py\", line 2366, in _run_once\r\n  File \"/usr/lib/python3.9/asyncio/base_events.py\", line 852, in run_forever\r\n    getaddr_func = self._getaddrinfo_debug\r\n  File \"/usr/lib/python3.9/asyncio/base_events.py\", line 629, in run_until_complete\r\n    self.run_forever()\r\n  File \"/usr/lib/python3.9/asyncio/runners.py\", line 300, in run\r\n  File \"/home/sec-ops/crawler/fetch.py\", line 59, in run\r\n    asyncio.run(self.fetch_recursively(url))\r\n```    \r\n\r\n</details>\r\n\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.9.1\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.6.2\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/sec-ops/crawler/venv/lib/python3.9/site-packages\r\nRequires: chardet, multidict, async-timeout, attrs, yarl\r\nRequired-by:\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.6\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/sec-ops/crawler/venv/lib/python3.9/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.3\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/sec-ops/crawler/venv/lib/python3.9/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\nOS: Ubuntu 16.04.5 LTS (GNU/Linux 4.4.0-131-generic x86_64)\r\nI used python3.9-dbg to create the venv, so I can use gdb to attach to process and print thread stacks\r\n```console\r\n$ gdb --version\r\nGNU gdb (Ubuntu 7.11.1-0ubuntu1~16.5) 7.11.1\r\n```", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5409/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5409/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5403", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5403/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5403/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5403/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5403", "id": 785069797, "node_id": "MDU6SXNzdWU3ODUwNjk3OTc=", "number": 5403, "title": "Can't read response content after checking response.ok", "user": {"login": "adamko147", "id": 6449059, "node_id": "MDQ6VXNlcjY0NDkwNTk=", "avatar_url": "https://avatars.githubusercontent.com/u/6449059?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adamko147", "html_url": "https://github.com/adamko147", "followers_url": "https://api.github.com/users/adamko147/followers", "following_url": "https://api.github.com/users/adamko147/following{/other_user}", "gists_url": "https://api.github.com/users/adamko147/gists{/gist_id}", "starred_url": "https://api.github.com/users/adamko147/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adamko147/subscriptions", "organizations_url": "https://api.github.com/users/adamko147/orgs", "repos_url": "https://api.github.com/users/adamko147/repos", "events_url": "https://api.github.com/users/adamko147/events{/privacy}", "received_events_url": "https://api.github.com/users/adamko147/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344995986, "node_id": "MDU6TGFiZWwzNDQ5OTU5ODY=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/client", "name": "client", "color": "bfd4f2", "default": false, "description": null}, {"id": 1831256427, "node_id": "MDU6TGFiZWwxODMxMjU2NDI3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/reproducer:%20present", "name": "reproducer: present", "color": "c2e0c6", "default": false, "description": "This PR or issue contains code, which reproduce the problem described or clearly understandable STR"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2021-01-13T12:38:27Z", "updated_at": "2021-01-14T11:14:19Z", "closed_at": "2021-01-14T11:14:19Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nFor failed requests, ClientResponse is \"released\" after calling to `resposne.ok` and therefore can't read `response.text()` after checking `response.ok`\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n```python\r\nasync with session.get(\"url-returning-400+\") as response:\r\n    if not response.ok:\r\n       msg = await response.text() # raises ClientConnectionError('Connection closed')\r\n```\r\ndoes not work, while\r\n```python\r\nasync with session.get(\"url-returning-400+\") as response:\r\n    if response.status != 200:\r\n        msg = await response.text() # works just fine\r\n```\r\nworks just fine\r\n\r\n\ud83d\udca1 **Expected behavior**\r\nI'm not sure this is expected behaviour. `response.ok` is read-only property and I believe it should not change the state of the response object. Also, failed requests may contain response body, e.g. with error description, so I'm expecting `await response.text()` to work properly after checking `response.ok`\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.8.6\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.3\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/I028910/sbn/job-context-store/.venv/lib/python3.8/site-packages\r\nRequires: async-timeout, attrs, typing-extensions, chardet, yarl, multidict\r\nRequired-by: sbn-aio-utils, aioresponses, aiohttp-retry\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.1.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/I028910/sbn/job-context-store/.venv/lib/python3.8/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.3\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/I028910/sbn/job-context-store/.venv/lib/python3.8/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5403/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5403/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5392", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5392/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5392/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5392/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5392", "id": 782770443, "node_id": "MDU6SXNzdWU3ODI3NzA0NDM=", "number": 5392, "title": "Setting empty str as data does not set text/plain header", "user": {"login": "spacemanspiff2007", "id": 10754716, "node_id": "MDQ6VXNlcjEwNzU0NzE2", "avatar_url": "https://avatars.githubusercontent.com/u/10754716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spacemanspiff2007", "html_url": "https://github.com/spacemanspiff2007", "followers_url": "https://api.github.com/users/spacemanspiff2007/followers", "following_url": "https://api.github.com/users/spacemanspiff2007/following{/other_user}", "gists_url": "https://api.github.com/users/spacemanspiff2007/gists{/gist_id}", "starred_url": "https://api.github.com/users/spacemanspiff2007/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spacemanspiff2007/subscriptions", "organizations_url": "https://api.github.com/users/spacemanspiff2007/orgs", "repos_url": "https://api.github.com/users/spacemanspiff2007/repos", "events_url": "https://api.github.com/users/spacemanspiff2007/events{/privacy}", "received_events_url": "https://api.github.com/users/spacemanspiff2007/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-01-10T08:34:56Z", "updated_at": "2021-10-24T07:58:27Z", "closed_at": "2021-10-24T07:58:27Z", "author_association": "NONE", "active_lock_reason": null, "body": "Setting empty str as data does not set text/plain header\r\n```\r\nawait session.post(url, data='')\r\n```\r\nwill set\r\n```\r\n'Content-Type': 'application/octet-stream'\r\n```\r\nin the header.\r\n\r\nExpected would be\r\n```\r\n'Content-Type': 'text/plain'\r\n```\r\n\r\nThis is also described in the [docs](https://docs.aiohttp.org/en/stable/client_advanced.html#custom-request-headers).\r\nIt shows ``data`` as a shortcut for ``text/plain``.\r\n\r\n\ud83d\udccb **Versions**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\nPython/3.8\r\naiohttp/3.7.3\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5392/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5392/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5390", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5390/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5390/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5390/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5390", "id": 782667844, "node_id": "MDU6SXNzdWU3ODI2Njc4NDQ=", "number": 5390, "title": "Version 3.7.3 requires requires chardet<4.0,>=2.0, while having installed chardet 4.0.0", "user": {"login": "BKPepe", "id": 4096468, "node_id": "MDQ6VXNlcjQwOTY0Njg=", "avatar_url": "https://avatars.githubusercontent.com/u/4096468?v=4", "gravatar_id": "", "url": "https://api.github.com/users/BKPepe", "html_url": "https://github.com/BKPepe", "followers_url": "https://api.github.com/users/BKPepe/followers", "following_url": "https://api.github.com/users/BKPepe/following{/other_user}", "gists_url": "https://api.github.com/users/BKPepe/gists{/gist_id}", "starred_url": "https://api.github.com/users/BKPepe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/BKPepe/subscriptions", "organizations_url": "https://api.github.com/users/BKPepe/orgs", "repos_url": "https://api.github.com/users/BKPepe/repos", "events_url": "https://api.github.com/users/BKPepe/events{/privacy}", "received_events_url": "https://api.github.com/users/BKPepe/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 58986076, "node_id": "MDU6TGFiZWw1ODk4NjA3Ng==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/duplicate", "name": "duplicate", "color": "cccccc", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-01-09T19:10:45Z", "updated_at": "2021-01-10T14:14:37Z", "closed_at": "2021-01-10T09:26:27Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n\r\nWhile using pip, it throws this error:\r\n\r\naiohttp 3.7.3 requires chardet<4.0,>=2.0, but you'll have chardet 4.0.0 which is incompatible.\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n\r\n- Install aiohttp version 3.7.3\r\n- Install chardet 4.0.0\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n\r\naiohttp 3.7.x is compatible with chardet 4.0.0\r\nThe same PR https://github.com/aio-libs/aiohttp/pull/5334 should be merged into 3.7 branch as well.\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\npython3 --version\r\nPython 3.9.1\r\n```", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5390/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5390/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5389", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5389/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5389/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5389/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5389", "id": 782201499, "node_id": "MDU6SXNzdWU3ODIyMDE0OTk=", "number": 5389, "title": "[maintenance] Adjust test job timeouts in GitHub Actions CI/CD jobs", "user": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 277836062, "node_id": "MDU6TGFiZWwyNzc4MzYwNjI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/good%20first%20issue", "name": "good first issue", "color": "7057ff", "default": true, "description": "Good for newcomers"}, {"id": 303800438, "node_id": "MDU6TGFiZWwzMDM4MDA0Mzg=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/need%20pull%20request", "name": "need pull request", "color": "bfdadc", "default": false, "description": null}, {"id": 731921232, "node_id": "MDU6TGFiZWw3MzE5MjEyMzI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/infra", "name": "infra", "color": "e55e5b", "default": false, "description": null}, {"id": 743514498, "node_id": "MDU6TGFiZWw3NDM1MTQ0OTg=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/meta", "name": "meta", "color": "ccf794", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-01-08T15:34:04Z", "updated_at": "2021-01-18T12:23:31Z", "closed_at": "2021-01-18T12:23:31Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nThe CI doesn't complete currently because the test jobs are capped to run under 15 minutes and they now get killed on timeout. I believe this is called by the new pip resolver doing backtracking which is rather time-consuming.\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n\r\nIt's visible in any recent CI build.\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\nThe jobs should complete. Carefully bumping the timeout in the workflow file should be enough.\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\nExample: https://github.com/aio-libs/aiohttp/runs/1669008218?check_suite_focus=true\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\nN/A\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\nrepo master\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\nN/A", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5389/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5389/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5373", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5373/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5373/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5373/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5373", "id": 775073067, "node_id": "MDU6SXNzdWU3NzUwNzMwNjc=", "number": 5373, "title": "AssertionError in _sendfile_system: assert transport is not None", "user": {"login": "bitnom", "id": 14287229, "node_id": "MDQ6VXNlcjE0Mjg3MjI5", "avatar_url": "https://avatars.githubusercontent.com/u/14287229?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bitnom", "html_url": "https://github.com/bitnom", "followers_url": "https://api.github.com/users/bitnom/followers", "following_url": "https://api.github.com/users/bitnom/following{/other_user}", "gists_url": "https://api.github.com/users/bitnom/gists{/gist_id}", "starred_url": "https://api.github.com/users/bitnom/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bitnom/subscriptions", "organizations_url": "https://api.github.com/users/bitnom/orgs", "repos_url": "https://api.github.com/users/bitnom/repos", "events_url": "https://api.github.com/users/bitnom/events{/privacy}", "received_events_url": "https://api.github.com/users/bitnom/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-12-27T17:01:52Z", "updated_at": "2020-12-28T06:03:55Z", "closed_at": "2020-12-28T06:03:55Z", "author_association": "NONE", "active_lock_reason": null, "body": "aiohttp 4.0.0a1\r\npython 3.9.0\r\nLinux x64\r\n\r\nI think this is just a basic demo setup with a route using jinja2. Upon visiting the page/route, I see:\r\n\r\n```\r\nUnhandled exception\r\nTraceback (most recent call last):\r\n  File \"/home/user/.cache/pypoetry/virtualenvs/website--1hV_kTf-py3.9/lib/python3.9/site-packages/aiohttp/web_protocol.py\", line 480, in start\r\n    resp, reset = await task\r\n  File \"/home/user/.cache/pypoetry/virtualenvs/website--1hV_kTf-py3.9/lib/python3.9/site-packages/aiohttp/web_protocol.py\", line 433, in _handle_request\r\n    reset = await self.finish_response(request, resp, start_time)\r\n  File \"/home/user/.cache/pypoetry/virtualenvs/website--1hV_kTf-py3.9/lib/python3.9/site-packages/aiohttp/web_protocol.py\", line 580, in finish_response\r\n    await prepare_meth(request)\r\n  File \"/home/user/.cache/pypoetry/virtualenvs/website--1hV_kTf-py3.9/lib/python3.9/site-packages/aiohttp/web_fileresponse.py\", line 344, in prepare\r\n    return await self._sendfile(request, fobj, count)\r\n  File \"/home/user/.cache/pypoetry/virtualenvs/website--1hV_kTf-py3.9/lib/python3.9/site-packages/aiohttp/web_fileresponse.py\", line 155, in _sendfile_system\r\n    assert transport is not None\r\nAssertionError\r\n```\r\n\r\nThis does not happen in stable version", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5373/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5373/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5355", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5355/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5355/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5355/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5355", "id": 770266019, "node_id": "MDU6SXNzdWU3NzAyNjYwMTk=", "number": 5355, "title": "ClientResponseError on header values with non-printable characters", "user": {"login": "smola", "id": 23248, "node_id": "MDQ6VXNlcjIzMjQ4", "avatar_url": "https://avatars.githubusercontent.com/u/23248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/smola", "html_url": "https://github.com/smola", "followers_url": "https://api.github.com/users/smola/followers", "following_url": "https://api.github.com/users/smola/following{/other_user}", "gists_url": "https://api.github.com/users/smola/gists{/gist_id}", "starred_url": "https://api.github.com/users/smola/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/smola/subscriptions", "organizations_url": "https://api.github.com/users/smola/orgs", "repos_url": "https://api.github.com/users/smola/repos", "events_url": "https://api.github.com/users/smola/events{/privacy}", "received_events_url": "https://api.github.com/users/smola/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 12, "created_at": "2020-12-17T18:18:10Z", "updated_at": "2021-10-30T15:10:48Z", "closed_at": "2021-10-30T15:10:48Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n\r\nWhen a server replies with a header value including non-printable characters, `ClientResponseError`is thrown with the message `invalid character in header`. This is an issue in the http-parser library.\r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n\r\n```python\r\nimport aiohttp\r\nasync with aiohttp.ClientSession() as sess:\r\n    await sess.get('https://www.dezeen.com/')\r\n```\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n\r\nOther HTTP clients work just fine with these responses (e.g. CPython, curl, web browsers).\r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n\r\n_See above._\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n\r\n```console\r\n$ python --version\r\nPython 3.8.5\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.3\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /venv/lib/python3.8/site-packages\r\nRequires: chardet, multidict, attrs, async-timeout, yarl, typing-extensions\r\nRequired-by: mypkg\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.1.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /venv/lib/python3.8/site-packages\r\nRequires:\r\nRequired-by: yarl, aiohttp\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.3\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /venv/lib/python3.8/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n\r\nThis may be a duplicate of #5269. It's hard to tell given the context given on that issue.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5355/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5355/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5345", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5345/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5345/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5345/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5345", "id": 768079039, "node_id": "MDU6SXNzdWU3NjgwNzkwMzk=", "number": 5345, "title": "trace_request_start does not include auto-generated headers", "user": {"login": "hashstat", "id": 1288789, "node_id": "MDQ6VXNlcjEyODg3ODk=", "avatar_url": "https://avatars.githubusercontent.com/u/1288789?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hashstat", "html_url": "https://github.com/hashstat", "followers_url": "https://api.github.com/users/hashstat/followers", "following_url": "https://api.github.com/users/hashstat/following{/other_user}", "gists_url": "https://api.github.com/users/hashstat/gists{/gist_id}", "starred_url": "https://api.github.com/users/hashstat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hashstat/subscriptions", "organizations_url": "https://api.github.com/users/hashstat/orgs", "repos_url": "https://api.github.com/users/hashstat/repos", "events_url": "https://api.github.com/users/hashstat/events{/privacy}", "received_events_url": "https://api.github.com/users/hashstat/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-12-15T19:27:55Z", "updated_at": "2021-10-30T15:07:51Z", "closed_at": "2021-10-30T15:07:51Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nTracing requests using the `TraceConfig` signals is essential for insight into what is sent over the wire, especially for encrypted https traffic. The trouble is that some of the data is incomplete. The request headers passed to `trace_request_start` handlers is missing auto-generated headers, making diagnosing failed requests more difficult.\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\n\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\n1. Create a virtual environment\r\n2. Install aiohttp, pytest, and pytest-aiohttp\r\n3. Save the script below as test_auto_headers.py\r\n4. Run the tests: `pytest test_auto_headers.py`\r\n\r\n```python\r\n# test_auto_headers.py\r\n\r\nimport aiohttp\r\nfrom aiohttp import web\r\n\r\nasync def test_trace_headers_match_auto_headers(aiohttp_client):\r\n    request_headers: dict\r\n    trace_headers: dict\r\n\r\n    async def local_request(request):\r\n        nonlocal request_headers\r\n        request_headers = dict(request.headers)\r\n        return web.Response()\r\n\r\n    app = web.Application()\r\n    app.router.add_get('/local', local_request)\r\n\r\n    async def on_request_start(session, context, params):\r\n        nonlocal trace_headers\r\n        trace_headers = dict(params.headers)\r\n\r\n    trace_config = aiohttp.TraceConfig()\r\n    trace_config.on_request_start.append(on_request_start)\r\n\r\n    client = await aiohttp_client(app, trace_configs=[trace_config])\r\n\r\n    data = {'request': 'add', 'id': 1234, 'value': 'Hello World!'}\r\n\r\n    async with client.get('/local', json=data) as response:\r\n        assert response.status == 200\r\n    assert trace_headers == request_headers\r\n```\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\nThe test should succeed, indicating that the headers passed to `trace_request_start` handlers are identical to those received by the test server.\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```console\r\n$ pytest test_auto_headers.py -vv\r\n==================================================================== test session starts =====================================================================\r\nplatform linux -- Python 3.7.7, pytest-6.0.2, py-1.9.0, pluggy-0.13.1\r\ncachedir: .pytest_cache\r\nplugins: aiohttp-0.3.0\r\ncollected 1 item                                                                                                                                             \r\n\r\ntest_auto_headers.py::test_trace_headers_match_auto_headers[pyloop] FAILED                                                                             [100%]\r\n\r\n========================================================================== FAILURES ==========================================================================\r\n_______________________________________________________ test_trace_headers_match_auto_headers[pyloop] ________________________________________________________\r\n\r\naiohttp_client = <function aiohttp_client.<locals>.go at 0x7f8eee0724d0>\r\n\r\n    async def test_trace_headers_match_auto_headers(aiohttp_client):\r\n        request_headers: dict\r\n        trace_headers: dict\r\n    \r\n        async def local_request(request):\r\n            nonlocal request_headers\r\n            request_headers = dict(request.headers)\r\n            return web.Response()\r\n    \r\n        app = web.Application()\r\n        app.router.add_get('/local', local_request)\r\n    \r\n        async def on_request_start(session, context, params):\r\n            nonlocal trace_headers\r\n            trace_headers = dict(params.headers)\r\n    \r\n        trace_config = aiohttp.TraceConfig()\r\n        trace_config.on_request_start.append(on_request_start)\r\n    \r\n        client = await aiohttp_client(app, trace_configs=[trace_config])\r\n    \r\n        data = {'request': 'add', 'id': 1234, 'value': 'Hello World!'}\r\n    \r\n        async with client.get('/local', json=data) as response:\r\n            assert response.status == 200\r\n>       assert trace_headers == request_headers\r\nE       AssertionError: assert {} == {'Accept': '*/*',\\n 'Accept-Encoding': 'gzip, deflate',\\n 'Content-Length': '55',\\n 'Content-Type': 'application/json',\\n 'Host': '127.0.0.1:40225',\\n 'User-Agent': 'Python/3.7 aiohttp/3.7.2'}\r\nE         Right contains 6 more items:\r\nE         {'Accept': '*/*',\r\nE          'Accept-Encoding': 'gzip, deflate',\r\nE          'Content-Length': '55',\r\nE          'Content-Type': 'application/json',\r\nE          'Host': '127.0.0.1:40225',\r\nE          'User-Agent': 'Python/3.7 aiohttp/3.7.2'}\r\nE         Full diff:\r\nE           {\r\nE         +  ,\r\nE         -  'Accept': '*/*',\r\nE         -  'Accept-Encoding': 'gzip, deflate',\r\nE         -  'Content-Length': '55',\r\nE         -  'Content-Type': 'application/json',\r\nE         -  'Host': '127.0.0.1:40225',\r\nE         -  'User-Agent': 'Python/3.7 aiohttp/3.7.2',\r\nE           }\r\n\r\ntest_auto_headers.py:29: AssertionError\r\n================================================================== short test summary info ===================================================================\r\nFAILED test_auto_headers.py::test_trace_headers_match_auto_headers[pyloop] - AssertionError: assert {} == {'Accept': '*/*',\\n 'Accept-Encoding': 'gzip, def...\r\n===================================================================== 1 failed in 0.09s ======================================================================\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n3.7.7\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ pip show aiohttp multidict yarl\r\nName: aiohttp\r\nVersion: 3.7.2\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nRequires: attrs, yarl, chardet, async-timeout, multidict, typing-extensions\r\nRequired-by: pytest-aiohttp, aioresponses, aiohttp-retry, idt\r\n---\r\nName: multidict\r\nVersion: 4.7.6\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n---\r\nName: yarl\r\nVersion: 1.5.1\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nRequires: multidict, typing-extensions, idna\r\nRequired-by: aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\nclient", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5345/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5345/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5338", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5338/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5338/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5338/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5338", "id": 763683524, "node_id": "MDU6SXNzdWU3NjM2ODM1MjQ=", "number": 5338, "title": "Async blocks from Curl, not from a Browser", "user": {"login": "matclayton", "id": 126218, "node_id": "MDQ6VXNlcjEyNjIxOA==", "avatar_url": "https://avatars.githubusercontent.com/u/126218?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matclayton", "html_url": "https://github.com/matclayton", "followers_url": "https://api.github.com/users/matclayton/followers", "following_url": "https://api.github.com/users/matclayton/following{/other_user}", "gists_url": "https://api.github.com/users/matclayton/gists{/gist_id}", "starred_url": "https://api.github.com/users/matclayton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matclayton/subscriptions", "organizations_url": "https://api.github.com/users/matclayton/orgs", "repos_url": "https://api.github.com/users/matclayton/repos", "events_url": "https://api.github.com/users/matclayton/events{/privacy}", "received_events_url": "https://api.github.com/users/matclayton/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2020-12-12T12:10:49Z", "updated_at": "2020-12-14T12:38:30Z", "closed_at": "2020-12-12T18:30:59Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nUsing the following minimal PoC, when running `curl -X GET http://localhost:8080/` you will see the server entering the sleep state, but it will never awaken again, on a browser however this works as expected, it will sleep and wake back up.\r\n```\r\n#!/usr/bin/env python\r\nfrom aiohttp import web\r\nimport asyncio\r\nimport logging\r\n\r\n\r\nasync def async_test(request: web.Request) -> web.Response:\r\n    resp = web.Response(text=\"0\")\r\n    await resp.prepare(request)\r\n    await resp.write_eof()\r\n\r\n    logging.info(\"sleep\")\r\n    await asyncio.sleep(0.1)\r\n    logging.info(\"awake\")\r\n\r\n    return resp\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    # Configure Logger\r\n    logging.basicConfig(\r\n        format=\"%(asctime)s %(levelname)s %(message)s\", level=logging.INFO,\r\n    )\r\n    # Setup Webapp\r\n    app = web.Application()\r\n    app.router.add_get(\"/\", async_test)\r\n    web.run_app(app, port=8080)\r\n```\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\n\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\nSee Above PoC\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\nBrowser and Curl to behave identically and both log awake\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n3.9.1\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n(3.9.0/envs/live-3.9.0) \u279c  src git:(mc-transcode-manager) \u2717 python -m pip show aiohttp  \r\nName: aiohttp\r\nVersion: 3.7.3\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/mclayton/.pyenv/versions/3.9.0/envs/live-3.9.0/lib/python3.9/site-packages\r\nRequires: typing-extensions, chardet, attrs, async-timeout, multidict, yarl\r\nRequired-by: gcloud-aio-auth\r\n```\r\n```console\r\n(3.9.0/envs/live-3.9.0) \u279c  src git:(mc-transcode-manager) \u2717 python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.6\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/mclayton/.pyenv/versions/3.9.0/envs/live-3.9.0/lib/python3.9/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n```\r\n```console\r\n$ (3.9.0/envs/live-3.9.0) \u279c  src git:(mc-transcode-manager) \u2717 python -m pip show yarl\r\nName: yarl\r\nVersion: 1.4.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/mclayton/.pyenv/versions/3.9.0/envs/live-3.9.0/lib/python3.9/site-packages\r\nRequires: multidict, idna\r\nRequired-by: aiohttp\r\n...\r\n```\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5338/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5338/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5336", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5336/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5336/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5336/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5336", "id": 762433315, "node_id": "MDU6SXNzdWU3NjI0MzMzMTU=", "number": 5336, "title": "aiohttp server causing asyncio.create_subprocess_exec to hang", "user": {"login": "matclayton", "id": 126218, "node_id": "MDQ6VXNlcjEyNjIxOA==", "avatar_url": "https://avatars.githubusercontent.com/u/126218?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matclayton", "html_url": "https://github.com/matclayton", "followers_url": "https://api.github.com/users/matclayton/followers", "following_url": "https://api.github.com/users/matclayton/following{/other_user}", "gists_url": "https://api.github.com/users/matclayton/gists{/gist_id}", "starred_url": "https://api.github.com/users/matclayton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matclayton/subscriptions", "organizations_url": "https://api.github.com/users/matclayton/orgs", "repos_url": "https://api.github.com/users/matclayton/repos", "events_url": "https://api.github.com/users/matclayton/events{/privacy}", "received_events_url": "https://api.github.com/users/matclayton/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-12-11T14:56:41Z", "updated_at": "2022-12-14T03:49:55Z", "closed_at": "2020-12-12T12:07:16Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nWhen running a aiohttp server, upon calling \r\n\r\n```\r\nprocess = await asyncio.create_subprocess_exec(\r\n        *args,\r\n        stdout=asyncio.subprocess.PIPE,\r\n        stderr=asyncio.subprocess.PIPE,\r\n        # stdin=asyncio.subprocess.DEVNULL,\r\n    )\r\n```\r\n\r\nWe never see this complete, outside of aiohttp this seems to work fine, and if we use DEVNULL for stdout and stderr it also appears to run the subprocess and output the results to the screen. I think something might be up with either the asyncio loop or the handling of pipes, but we're somewhat stumped by this. Any advice or suggestions would be welcome!\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\n\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\nNo traceback\r\n\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n3.9.1\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```\r\naiohttp == 3.7.3\r\n...\r\n```\r\n```console\r\n(3.9.0/envs/live-3.9.0) \u279c  src git:(mc-transcode-manager) \u2717 python -m pip show multidict        \r\nName: multidict\r\nVersion: 4.7.6\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/mclayton/.pyenv/versions/3.9.0/envs/live-3.9.0/lib/python3.9/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n...\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.4.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/mclayton/.pyenv/versions/3.9.0/envs/live-3.9.0/lib/python3.9/site-packages\r\nRequires: multidict, idna\r\nRequired-by: aiohttp\r\n...\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5336/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5336/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5332", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5332/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5332/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5332/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5332", "id": 761924912, "node_id": "MDU6SXNzdWU3NjE5MjQ5MTI=", "number": 5332, "title": "Returned Response object is None from session.get()", "user": {"login": "PythonCoderAS", "id": 13932583, "node_id": "MDQ6VXNlcjEzOTMyNTgz", "avatar_url": "https://avatars.githubusercontent.com/u/13932583?v=4", "gravatar_id": "", "url": "https://api.github.com/users/PythonCoderAS", "html_url": "https://github.com/PythonCoderAS", "followers_url": "https://api.github.com/users/PythonCoderAS/followers", "following_url": "https://api.github.com/users/PythonCoderAS/following{/other_user}", "gists_url": "https://api.github.com/users/PythonCoderAS/gists{/gist_id}", "starred_url": "https://api.github.com/users/PythonCoderAS/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/PythonCoderAS/subscriptions", "organizations_url": "https://api.github.com/users/PythonCoderAS/orgs", "repos_url": "https://api.github.com/users/PythonCoderAS/repos", "events_url": "https://api.github.com/users/PythonCoderAS/events{/privacy}", "received_events_url": "https://api.github.com/users/PythonCoderAS/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-12-11T05:37:14Z", "updated_at": "2020-12-12T15:09:35Z", "closed_at": "2020-12-12T15:09:35Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\n\r\nOn a request that I made to a server, the Response object that should be returned was replaced with `None`.\r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\n\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\n\r\nI'm not really sure how this happened, because the cause was a long-running task that made a request every 5 minutes. However, I suspect that the server was having major issues, although my logs cannot tell me exactly what happened.\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\n\r\nA Response object is returned, regardless of server status.\r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\nTraceback (most recent call last):\r\n  File \"/home/PokestarFan/PokestarBot/bot_data/extensions/updates.py\", line 419, in mangadex_update\r\n    request.raise_for_status()\r\nAttributeError: 'NoneType' object has no attribute 'raise_for_status'\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/PokestarFan/.local/share/virtualenvs/PokestarBot-NMj7rRyG/lib/python3.8/site-packages/discord/ext/tasks/__init__.py\", line 101, in _loop\r\n    await self.coro(*args, **kwargs)\r\n  File \"/home/PokestarFan/PokestarBot/bot_data/extensions/updates.py\", line 569, in check_for_updates\r\n    await self.mangadex_update(manga_id, name)\r\n  File \"/home/PokestarFan/PokestarBot/bot_data/extensions/updates.py\", line 420, in mangadex_update\r\n    json = await request.json()\r\n  File \"/home/PokestarFan/.local/share/virtualenvs/PokestarBot-NMj7rRyG/lib/python3.8/site-packages/aiohttp/client.py\", line 1026, in __aexit__\r\n    self._resp.release()\r\nAttributeError: 'NoneType' object has no attribute 'release'\r\n```\r\nIssue tied with log entry: https://github.com/PythonCoderAS/PokestarBot/issues/718\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\n...\r\n```\r\n\r\nPython 3.8.6\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\n...\r\n```\r\n```console\r\n$ python -m pip show multidict\r\n...\r\n```\r\n```console\r\n$ python -m pip show yarl\r\n...\r\n```\r\n\r\n```\r\nName: aiohttp\r\nVersion: 3.6.3\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/PokestarFan/.local/share/virtualenvs/PokestarBot-NMj7rRyG/lib/python3.8/site-packages\r\nRequires: attrs, multidict, async-timeout, chardet, yarl\r\nRequired-by: discord.py, asyncprawcore\r\n\r\nName: multidict\r\nVersion: 4.7.6\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/PokestarFan/.local/share/virtualenvs/PokestarBot-NMj7rRyG/lib/python3.8/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n\r\nName: yarl\r\nVersion: 1.5.1\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/PokestarFan/.local/share/virtualenvs/PokestarBot-NMj7rRyG/lib/python3.8/site-packages\r\nRequires: idna, multidict\r\nRequired-by: asyncprawcore, aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\nClient session\r\n\r\nRelevant code: https://github.com/PythonCoderAS/PokestarBot/blob/e4245558826898332e2d0e3753b62614f5260f78/bot_data/extensions/updates.py#L417-L420", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5332/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5332/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5281", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5281/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5281/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5281/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5281", "id": 749072428, "node_id": "MDU6SXNzdWU3NDkwNzI0Mjg=", "number": 5281, "title": "AttributeError: object has no attribute 'decode' for PAYLOAD_REGISTRY class", "user": {"login": "folt", "id": 3757488, "node_id": "MDQ6VXNlcjM3NTc0ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/3757488?v=4", "gravatar_id": "", "url": "https://api.github.com/users/folt", "html_url": "https://github.com/folt", "followers_url": "https://api.github.com/users/folt/followers", "following_url": "https://api.github.com/users/folt/following{/other_user}", "gists_url": "https://api.github.com/users/folt/gists{/gist_id}", "starred_url": "https://api.github.com/users/folt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/folt/subscriptions", "organizations_url": "https://api.github.com/users/folt/orgs", "repos_url": "https://api.github.com/users/folt/repos", "events_url": "https://api.github.com/users/folt/events{/privacy}", "received_events_url": "https://api.github.com/users/folt/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2020-11-23T19:38:45Z", "updated_at": "2021-10-15T18:40:48Z", "closed_at": "2021-10-15T18:36:54Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nWhile working with `PAYLOAD_REGISTRY` I came across a problem. After examining the information, I found an error. The fact is that the Response class implements a property that calls the [self._body.decode](https://github.com/aio-libs/aiohttp/blob/master/aiohttp/web_response.py#L587) method expecting a string there. But when using `PAYLOAD_REGISTRY` (I used `JsonPayload`) in `self._body` there is an instance of the payload class where there is no implementation of the `decode` method.\r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n```\r\nfrom typing import Mapping, Optional\r\nfrom types import MappingProxyType\r\nfrom http import HTTPStatus\r\n\r\nfrom aiohttp import web\r\nfrom aiohttp import payload\r\nfrom aiohttp import web_request\r\nfrom aiohttp import web_middlewares\r\nfrom aiohttp import PAYLOAD_REGISTRY\r\nfrom aiohttp import web_exceptions\r\n\r\n\r\ndef format_http_error(http_error_cls, message: Optional[str] = None,\r\n                      ) -> web_exceptions.HTTPException:\r\n    status = HTTPStatus(http_error_cls.status_code)\r\n\r\n    error = {\r\n        'code': status.name.lower(),\r\n        'message': message or status.description\r\n    }\r\n\r\n    return http_error_cls(body={'error': error})\r\n\r\n\r\nasync def handle():\r\n    raise web_exceptions.HTTPNotFound()\r\n\r\n\r\n@web_middlewares.middleware\r\nasync def error_middleware(request: web_request.Request, handler):\r\n    try:\r\n        return await handler(request)\r\n    except web_exceptions.HTTPException as err:\r\n        err = format_http_error(err.__class__, err.text)\r\n        raise err\r\n\r\n\r\napp = web.Application(\r\n    middlewares=[error_middleware]\r\n)\r\n\r\nPAYLOAD_REGISTRY.register(payload.JsonPayload, (Mapping, MappingProxyType))\r\n\r\napp.add_routes([web.get('/', handle)])\r\n\r\nif __name__ == '__main__':\r\n    web.run_app(app)\r\n```\r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n```\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/Users/folt/Documents/Work/geodb/.venv/lib/python3.8/site-packages/aiohttp/web_protocol.py\", line 422, in _handle_request\r\n    resp = await self._request_handler(request)\r\n  File \"/Users/folt/Documents/Work/geodb/.venv/lib/python3.8/site-packages/aiohttp/web_app.py\", line 499, in _handle\r\n    resp = await handler(request)\r\n  File \"/Users/folt/Documents/Work/geodb/.venv/lib/python3.8/site-packages/aiohttp/web_middlewares.py\", line 118, in impl\r\n    return await handler(request)\r\n  File \"/Users/folt/Documents/Work/geodb/qq.py\", line 35, in error_middleware\r\n    raise err\r\naiohttp.web_exceptions.HTTPNotFound: Not Found\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/Users/folt/Documents/Work/geodb/.venv/lib/python3.8/site-packages/aiohttp/web_protocol.py\", line 485, in start\r\n    resp, reset = await task\r\n  File \"/Users/folt/Documents/Work/geodb/.venv/lib/python3.8/site-packages/aiohttp/web_protocol.py\", line 427, in _handle_request\r\n    status=exc.status, reason=exc.reason, text=exc.text, headers=exc.headers\r\n  File \"/Users/folt/Documents/Work/geodb/.venv/lib/python3.8/site-packages/aiohttp/web_response.py\", line 650, in text\r\n    return self._body.decode(self.charset or \"utf-8\")\r\nAttributeError: 'JsonPayload' object has no attribute 'decode'\r\n```\r\n\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n`\r\nPython 3.8.5\r\n`\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n$ python -m pip show aiohttp\r\n```\r\nName: aiohttp\r\nVersion: 3.7.2\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/folt/Documents/Work/geodb/.venv/lib/python3.8/site-packages\r\nRequires: async-timeout, multidict, typing-extensions, chardet, attrs, yarl\r\nRequired-by: aiohttp-jinja2, aiohttp-debugtoolbar, aiohttp-apispec\r\n```\r\n\r\n$ python -m pip show multidict\r\n```\r\nName: multidict\r\nVersion: 5.0.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/folt/Documents/Work/geodb/.venv/lib/python3.8/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n```\r\n\r\n$ python -m pip show yarl\r\n```\r\nName: yarl\r\nVersion: 1.6.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/folt/Documents/Work/geodb/.venv/lib/python3.8/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\nAlso found a related issue #2928 . I solved the error by implementing my JsonPayload.\r\nI see 2 ways to solve this error.\r\n1. Implement the `decode` method in the `JsonPayload` class\r\n2. In the `def text(self)` method, check the type of `_body` and, based on this check, decide whether to call the `decode` method for `_body`.\r\n\r\nI am ready to contribute, but I would like to discuss possible solutions.\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5281/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5281/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5277", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5277/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5277/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5277/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5277", "id": 748847937, "node_id": "MDU6SXNzdWU3NDg4NDc5Mzc=", "number": 5277, "title": "\"Unclosed connection\" warning, but close method was awaited", "user": {"login": "artkom911", "id": 7835250, "node_id": "MDQ6VXNlcjc4MzUyNTA=", "avatar_url": "https://avatars.githubusercontent.com/u/7835250?v=4", "gravatar_id": "", "url": "https://api.github.com/users/artkom911", "html_url": "https://github.com/artkom911", "followers_url": "https://api.github.com/users/artkom911/followers", "following_url": "https://api.github.com/users/artkom911/following{/other_user}", "gists_url": "https://api.github.com/users/artkom911/gists{/gist_id}", "starred_url": "https://api.github.com/users/artkom911/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/artkom911/subscriptions", "organizations_url": "https://api.github.com/users/artkom911/orgs", "repos_url": "https://api.github.com/users/artkom911/repos", "events_url": "https://api.github.com/users/artkom911/events{/privacy}", "received_events_url": "https://api.github.com/users/artkom911/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2020-11-23T14:27:17Z", "updated_at": "2021-11-01T11:15:01Z", "closed_at": "2020-11-23T15:46:41Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nDespite context manager using, after some amount of new sessions, getting warning of Unclosed connection \r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n\r\n```\r\nimport asyncio\r\nimport aiohttp\r\n\r\n\r\nasync def main(i=100):\r\n    for j in range(i):\r\n        async with aiohttp.ClientSession(connector=aiohttp.TCPConnector(limit=200)) as session:\r\n            await session.get('http://127.0.0.1:6000')\r\n        print(j, session.closed)\r\n    print('done {}'.format(i))\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    asyncio.run(main())\r\n```\r\n\r\njust run script above\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\nI understand that creating a new session each time is not a good idea, still, I'm not expecting any warnings in this case\r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```\r\n\r\n0 True\r\n..\r\n99 True\r\ndone 100\r\n\r\nUnclosed connection\r\nclient_connection: Connection<ConnectionKey(host='127.0.0.1', port=6000, is_ssl=False, ssl=None, proxy=None, proxy_auth=None, proxy_headers_hash=None)>\r\nUnclosed connection\r\nclient_connection: Connection<ConnectionKey(host='127.0.0.1', port=6000, is_ssl=False, ssl=None, proxy=None, proxy_auth=None, proxy_headers_hash=None)>\r\nUnclosed connection\r\nclient_connection: Connection<ConnectionKey(host='127.0.0.1', port=6000, is_ssl=False, ssl=None, proxy=None, proxy_auth=None, proxy_headers_hash=None)>\r\nUnclosed connection\r\nclient_connection: Connection<ConnectionKey(host='127.0.0.1', port=6000, is_ssl=False, ssl=None, proxy=None, proxy_auth=None, proxy_headers_hash=None)>\r\n\r\n```\r\nOne more thing is that there may be situations when there are no warnings or their amount changes from time to time.\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n\r\n```console\r\n$ python --version\r\nPython 3.9.0\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n\r\n```console\r\n$ python -m pip show aiohttp\r\nVersion: 3.7.2\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nVersion: 5.0.2\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nVersion: 1.6.3\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\nclient\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5277/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5277/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5260", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5260/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5260/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5260/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5260", "id": 747066438, "node_id": "MDU6SXNzdWU3NDcwNjY0Mzg=", "number": 5260, "title": "_http_parser.HttpResponseParser.__init__ got multiple values for keyword argument 'timer'", "user": {"login": "SomberNight", "id": 29142493, "node_id": "MDQ6VXNlcjI5MTQyNDkz", "avatar_url": "https://avatars.githubusercontent.com/u/29142493?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SomberNight", "html_url": "https://github.com/SomberNight", "followers_url": "https://api.github.com/users/SomberNight/followers", "following_url": "https://api.github.com/users/SomberNight/following{/other_user}", "gists_url": "https://api.github.com/users/SomberNight/gists{/gist_id}", "starred_url": "https://api.github.com/users/SomberNight/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SomberNight/subscriptions", "organizations_url": "https://api.github.com/users/SomberNight/orgs", "repos_url": "https://api.github.com/users/SomberNight/repos", "events_url": "https://api.github.com/users/SomberNight/events{/privacy}", "received_events_url": "https://api.github.com/users/SomberNight/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-11-20T01:33:26Z", "updated_at": "2020-11-20T13:26:13Z", "closed_at": "2020-11-20T13:26:13Z", "author_association": "NONE", "active_lock_reason": null, "body": "[We](https://github.com/spesmilo/electrum) use aiohttp as a client to fetch json files from remote webservers.\r\nAfter recently releasing a new version that included newer aiohttp than before (3.6.3->3.7.2), some users on Windows [started getting errors](https://github.com/spesmilo/electrum/issues/6748#issuecomment-730730346).\r\n\r\nThe users are running pyinstaller frozen binaries, on Windows 10, that [bundle](https://github.com/spesmilo/electrum/blob/6f105ae43bb624654fbe74a976c439f5fb75efd7/contrib/deterministic-build/requirements.txt):\r\n```\r\nPython 3.7.9 (win32)\r\naiohttp==3.7.2\r\nmultidict==4.7.6\r\nyarl==1.5.1\r\n```\r\nThe affected users can reliably reproduce the error using this binary, however not with the previous binary that contained aiohttp 3.6.3.\r\n\r\nLog/traceback:\r\n```\r\n20201120T004731.576120Z |    ERROR | exchange_rate.CoinGecko | Exception in get_rates: TypeError(\"__init__() got multiple values for keyword argument 'timer'\")\r\nTraceback (most recent call last):\r\n  File \"electrum\\util.py\", line 1039, in wrapper\r\n  File \"electrum\\exchange_rate.py\", line 302, in get_rates\r\n  File \"electrum\\exchange_rate.py\", line 64, in get_json\r\n  File \"aiohttp\\client.py\", line 1124, in __aenter__\r\n  File \"aiohttp\\client.py\", line 544, in _request\r\n  File \"aiohttp\\client_proto.py\", line 160, in set_response_params\r\n  File \"aiohttp\\_http_parser.pyx\", line 566, in aiohttp._http_parser.HttpResponseParser.__init__\r\nTypeError: __init__() got multiple values for keyword argument 'timer'\r\n20201120T004731.579047Z |     INFO | exchange_rate.CoinGecko | failed fx quotes: TypeError(\"__init__() got multiple values for keyword argument 'timer'\")\r\n20201120T004731.579047Z |    ERROR | asyncio | Unclosed connection\r\nclient_connection: Connection<ConnectionKey(host='api.coingecko.com', port=443, is_ssl=True, ssl=None, proxy=None, proxy_auth=None, proxy_headers_hash=892630978)>\r\n```\r\nSome mentioned and related lines:\r\nhttps://github.com/spesmilo/electrum/blob/6f105ae43bb624654fbe74a976c439f5fb75efd7/electrum/exchange_rate.py#L63-L64\r\nhttps://github.com/spesmilo/electrum/blob/6f105ae43bb624654fbe74a976c439f5fb75efd7/electrum/util.py#L1098\r\n\r\n(note that code above supports using a socks proxy via [aiohttp-socks](https://github.com/romis2012/aiohttp-socks) but the reporting users are not using one)\r\n\r\nUnfortunately I cannot reproduce the error using the same binary on Windows 10, or indeed when running from source on Windows, or on Linux.\r\n\r\nI have been trying to identify the cause, e.g. looking at exactly how the 'timer' arg is being passed around, but could not find the issue so far.\r\nAlso a bit confused why I cannot reproduce using the same frozen binary...\r\nAny help would be appreciated!", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5260/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5260/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5259", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5259/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5259/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5259/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5259", "id": 746896129, "node_id": "MDU6SXNzdWU3NDY4OTYxMjk=", "number": 5259, "title": "BaseConnector limit and limit_per_host don't work with tracing enabled", "user": {"login": "bobh66", "id": 4935304, "node_id": "MDQ6VXNlcjQ5MzUzMDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4935304?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bobh66", "html_url": "https://github.com/bobh66", "followers_url": "https://api.github.com/users/bobh66/followers", "following_url": "https://api.github.com/users/bobh66/following{/other_user}", "gists_url": "https://api.github.com/users/bobh66/gists{/gist_id}", "starred_url": "https://api.github.com/users/bobh66/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bobh66/subscriptions", "organizations_url": "https://api.github.com/users/bobh66/orgs", "repos_url": "https://api.github.com/users/bobh66/repos", "events_url": "https://api.github.com/users/bobh66/events{/privacy}", "received_events_url": "https://api.github.com/users/bobh66/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-11-19T20:23:29Z", "updated_at": "2020-11-28T07:50:18Z", "closed_at": "2020-11-26T14:46:26Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nThe BaseConnector limit and limit_per_host attributes don't function properly when tracing is enabled and the connection is being reused.   BaseConnector.connect() calls _available_connections(), and when it gets back a number > 0, it will await any configured traces before acquiring the connection.  That is enough time for another thread to jump in and acquire the same connection, allowing more than the configured number of connections to exist simultaneously.  connect() needs to acquire the connection, possibly with a placeholder, before awaiting the traces.\r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n1. Configure a limit and/or limit_per_host on a TCPConnection\r\n2. Configure tracing for on_connection_reuseconn()\r\n3. Queue up a large number of requests that exceed the limits specified\r\n4. Observe that more than the configured limit number of queries are run simultaneously\r\n\r\n\ud83d\udca1 **Expected behavior**\r\nThere should not be more than the configured limit number of connections active at any given time\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\n\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.7.3\r\n...\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.6.2\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/local/lib/python3.7/site-packages\r\nRequires: chardet, yarl, attrs, async-timeout, multidict\r\nRequired-by: spe, faust, bravado-asyncio, aiohttp-cors\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.5\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/local/lib/python3.7/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n\r\n```\r\n```console\r\n$ python -m pip show yarl\r\n\r\nName: yarl\r\nVersion: 1.4.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/local/lib/python3.7/site-packages\r\nRequires: idna, multidict\r\nRequired-by: faust, aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\nclient\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5259/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5259/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5258", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5258/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5258/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5258/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5258", "id": 746308056, "node_id": "MDU6SXNzdWU3NDYzMDgwNTY=", "number": 5258, "title": "Pre-commit workflows runs on forks", "user": {"login": "WisdomPill", "id": 5825811, "node_id": "MDQ6VXNlcjU4MjU4MTE=", "avatar_url": "https://avatars.githubusercontent.com/u/5825811?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WisdomPill", "html_url": "https://github.com/WisdomPill", "followers_url": "https://api.github.com/users/WisdomPill/followers", "following_url": "https://api.github.com/users/WisdomPill/following{/other_user}", "gists_url": "https://api.github.com/users/WisdomPill/gists{/gist_id}", "starred_url": "https://api.github.com/users/WisdomPill/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WisdomPill/subscriptions", "organizations_url": "https://api.github.com/users/WisdomPill/orgs", "repos_url": "https://api.github.com/users/WisdomPill/repos", "events_url": "https://api.github.com/users/WisdomPill/events{/privacy}", "received_events_url": "https://api.github.com/users/WisdomPill/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1363888951, "node_id": "MDU6TGFiZWwxMzYzODg4OTUx", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/pr-available", "name": "pr-available", "color": "363396", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2020-11-19T07:03:37Z", "updated_at": "2020-11-22T08:19:06Z", "closed_at": "2020-11-22T08:19:05Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nThe pre-commit auto-update workflow runs on forks too, to me it seems unnecessary also because I get an email about a failed job every night, since I do not have secrets set for the bot. In my opinion this workflow should run only on the main repository.\r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\n\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\n\r\nJust clone the repo and wait for the schedule of []() to kick in\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\n\r\nThe auto-update should not run on forks, it should work only on the main repository.\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\nJust have a look at my fork, (here)[https://github.com/WisdomPill/aiohttp/actions]\r\n\r\n\ud83d\udca1 **Proposed solutions**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n1. Everybody can disable actions on their fork, but it does not seem a viable solution because people will encounter the problem often.\r\n\r\n2. Although github actions does not support to add conditionals on the event, it supports them only in the steps, so an if on every step is what can be done. [here](https://github.com/prisma/prisma/issues/3539#issuecomment-689104691)\r\n\r\nI would be more than happy to contribute to the repo and fix this if the second proposed solution works for you, otherwise let's discuss it and find a more elegant solution to this annoying problem.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5258/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5258/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5250", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5250/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5250/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5250/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5250", "id": 744189003, "node_id": "MDU6SXNzdWU3NDQxODkwMDM=", "number": 5250, "title": "router.add_static is greedy", "user": {"login": "redsquirrel", "id": 2512, "node_id": "MDQ6VXNlcjI1MTI=", "avatar_url": "https://avatars.githubusercontent.com/u/2512?v=4", "gravatar_id": "", "url": "https://api.github.com/users/redsquirrel", "html_url": "https://github.com/redsquirrel", "followers_url": "https://api.github.com/users/redsquirrel/followers", "following_url": "https://api.github.com/users/redsquirrel/following{/other_user}", "gists_url": "https://api.github.com/users/redsquirrel/gists{/gist_id}", "starred_url": "https://api.github.com/users/redsquirrel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/redsquirrel/subscriptions", "organizations_url": "https://api.github.com/users/redsquirrel/orgs", "repos_url": "https://api.github.com/users/redsquirrel/repos", "events_url": "https://api.github.com/users/redsquirrel/events{/privacy}", "received_events_url": "https://api.github.com/users/redsquirrel/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-11-16T21:04:21Z", "updated_at": "2021-10-30T15:44:34Z", "closed_at": "2021-10-30T15:44:34Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n\r\nThe first argument for `add_static` matches on any path that starts with that string. For instance, if you specify \"h\", then `add_static` will match on \"h\" or \"help\" or \"hoover\".\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n\r\nRun this code:\r\n\r\n```\r\nfrom aiohttp import web\r\n\r\nasync def handle(request):\r\n    name = request.match_info.get('name', \"Anonymous\")\r\n    text = \"Hello, \" + name\r\n    return web.Response(text=text)\r\n\r\napp = web.Application()\r\n\r\nrouter = app.router\r\n\r\nrouter.add_static(\"/h\", \"./\")\r\n\r\nrouter.add_routes([web.get('/', handle),\r\n                web.get('/{name}', handle)])\r\n\r\nif __name__ == '__main__':\r\n    web.run_app(app)\r\n```\r\n\r\nAdd a text file in the current working directory named `test.txt` and put some text in there.\r\n\r\nThen navigate to the following URLs to demonstrate the issue:\r\n\r\n* http://0.0.0.0:8080/\r\n* http://0.0.0.0:8080/groot\r\n* http://0.0.0.0:8080/h/test.txt\r\n* http://0.0.0.0:8080/hoover\r\n\r\nThe last link unexpectedly returns a 404.\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n\r\nI would have expected http://0.0.0.0:8080/hoover to have similar behavior to http://0.0.0.0:8080/groot, and render \"Hello, hoover\".\r\n\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n\r\n3.8\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n\r\naiohttp 3.7.2\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5250/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5250/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5239", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5239/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5239/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5239/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5239", "id": 743220326, "node_id": "MDU6SXNzdWU3NDMyMjAzMjY=", "number": 5239, "title": "aiohttp client get request - exception without error message", "user": {"login": "esundberg", "id": 14306155, "node_id": "MDQ6VXNlcjE0MzA2MTU1", "avatar_url": "https://avatars.githubusercontent.com/u/14306155?v=4", "gravatar_id": "", "url": "https://api.github.com/users/esundberg", "html_url": "https://github.com/esundberg", "followers_url": "https://api.github.com/users/esundberg/followers", "following_url": "https://api.github.com/users/esundberg/following{/other_user}", "gists_url": "https://api.github.com/users/esundberg/gists{/gist_id}", "starred_url": "https://api.github.com/users/esundberg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/esundberg/subscriptions", "organizations_url": "https://api.github.com/users/esundberg/orgs", "repos_url": "https://api.github.com/users/esundberg/repos", "events_url": "https://api.github.com/users/esundberg/events{/privacy}", "received_events_url": "https://api.github.com/users/esundberg/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 15, "created_at": "2020-11-15T09:43:38Z", "updated_at": "2020-11-18T09:03:20Z", "closed_at": "2020-11-18T09:03:20Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nI have been having problems with a section of my code that uses aiohttp client to request phone number information from a API. The API Server has been tested to well over 600 queries per second and it's two servers behind a load balancer.\r\n\r\nThe program goes like this. We query a FastAPI Endpoint, the FastAPI Endpoint runs a function that queries another API using aiohttp client, processes the data, and then returns the result. We were noticing under some some load that aiohttp would create an exception without any errors. I have narrowed it down to the following section of code where the issues is and removed FastAPI from the mix. \r\n\r\nI created a infinite loop that creates an asyncio task that calls the same function that does the aiohttp client request over and over again, sleeping for .01 seconds per per loop cycle. I see 51 aiohttp requests go out and receive good responses, then from session 52 onwards we get a aiohttp exception with no errors.\r\n\r\nI am also getting different results on different environments.\r\n\r\nDigital Ocean Server (shared 8vCPU, 16G RAM or dedicated 16 CPU, 65G RAM) - Ubuntu  20.04 python 3.8.5, aiohttp - 3.7.2, yarl, 1.6.3, multidict 5.0.2 - Issue Happens\r\n-Side note CPU only gets to 6-7%\r\n\r\nDigital Ocean Server (shared 4vCPU, 8G RAM) - Ubuntu 18.04, python 3.8.6, aiohttp -3.7.2, yarl 1.6.3, multidict 5.0.2 - No Issue\r\n\r\nMy PC - Windows 10, Python 3.8.2, aiohttp - 3.6.3, yarl, 1.5.1, multidict 4.7.6 - No Issue\r\n\r\nVMWare Server- Ubuntu 18.05 (4 vCPU, 8G RAM) - Python 3.8.6, aiohttp 3.7.2, yarl 1.6.2, multidict, 5.0.0 - No Issue\r\n\r\nVMWare Server - Ubuntu 20.04 (4 vCPU, 16G RAM) - Python 3.8.5 aiohttp 3.7.2, yarl 1.6.2, multidict 5.0.0 - No Issue\r\n\r\n```\r\nimport aiohttp\r\nimport asyncio\r\nimport config as cfg\r\n\r\nasync def main():\r\n    x = 0\r\n    while True:\r\n        x += 1\r\n        asyncio.create_task(carrier_lookup(x, '3127100000'))\r\n        await asyncio.sleep(.01)\r\n\r\nasync def carrier_lookup(id, number):\r\n    status = False\r\n    message = None\r\n    response = None\r\n\r\n    # Build URL Params\r\n    params = {\r\n        \"apikey\": cfg.api[\"apikey\"],\r\n        \"number\": number\r\n    }\r\n\r\n    try: \r\n        async with aiohttp.ClientSession() as session:\r\n            async with session.get(cfg.api[\"url\"], params=params, timeout=3) as resp:\r\n                status = resp.status\r\n                response = await resp.json()\r\n    except Exception as e:\r\n        print(f'AIOHTTP Session Exception:')\r\n        print(e)\r\n\r\n    print(f'{id} | Status: ({status}) | {response}')\r\n    return response\r\n\r\nif __name__ == '__main__':\r\n    asyncio.run(main())\r\n```\r\n\r\nOutput\r\n```\r\n1 | Status: (200) | {'query': '3127100000', 'number': '3127100000', 'source': 'LRN', 'record': '3127100', 'carrier': 'AT&T Wireline (Ameritech)', 'type': 'landline', 'timestamp': '2020-11-15T08:51:20.116907', 'load_time': '0.001271'}\r\n2 | Status: (200) | {'query': '3127100000', 'number': '3127100000', 'source': 'LRN', 'record': '3127100', 'carrier': 'AT&T Wireline (Ameritech)', 'type': 'landline', 'timestamp': '2020-11-15T08:51:20.124436', 'load_time': '0.001247'}\r\n~~~~snip~~~~\r\n50 | Status: (200) | {'query': '3127100000', 'number': '3127100000', 'source': 'LRN', 'record': '3127100', 'carrier': 'AT&T Wireline (Ameritech)', 'type': 'landline', 'timestamp': '2020-11-15T08:51:20.639200', 'load_time': '0.001341'}\r\n51 | Status: (200) | {'query': '3127100000', 'number': '3127100000', 'source': 'LRN', 'record': '3127100', 'carrier': 'AT&T Wireline (Ameritech)', 'type': 'landline', 'timestamp': '2020-11-15T08:51:20.648929', 'load_time': '0.001200'}\r\nAIOHTTP Session Exception:\r\n\r\n52 | Status: (False) | None\r\nAIOHTTP Session Exception:\r\n\r\n53 | Status: (False) | None\r\nAIOHTTP Session Exception:\r\n\r\n54 | Status: (False) | None\r\nAIOHTTP Session Exception:\r\n\r\n55 | Status: (False) | None\r\nAIOHTTP Session Exception:\r\n\r\n```\r\n\r\n\ud83d\udca1 **To Reproduce**\r\nRun the code above\r\n\r\nRunning on Digitial Ocean Server\r\n\r\nUbuntu 20.04.1\r\nPython 3.8.5\r\naiohttp==3.7.2\r\n\r\n\ud83d\udca1 **Expected behavior**\r\nAIOHTTP requests should not stop\r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\n\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.8.5\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.2\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /opt/lrg-rvm-api/venv/lib/python3.8/site-packages\r\nRequires: typing-extensions, yarl, async-timeout, chardet, multidict, attrs\r\nRequired-by: \r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.0.2\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /opt/lrg-rvm-api/venv/lib/python3.8/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.3\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /opt/lrg-rvm-api/venv/lib/python3.8/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\nThis is a pretty big bug for us. Any help would be greatly appreacited.\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5239/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5239/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5230", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5230/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5230/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5230/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5230", "id": 742993657, "node_id": "MDU6SXNzdWU3NDI5OTM2NTc=", "number": 5230, "title": "Provide win32 binary wheels", "user": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-11-14T12:17:44Z", "updated_at": "2020-11-14T22:42:37Z", "closed_at": "2020-11-14T22:42:37Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Currently, we build only 64-bit Windows binaries, this is an oversight that could be fixed easily.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5230/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5230/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5226", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5226/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5226/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5226/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5226", "id": 742551868, "node_id": "MDU6SXNzdWU3NDI1NTE4Njg=", "number": 5226, "title": "ClientSession timeout issue", "user": {"login": "levsh", "id": 3469898, "node_id": "MDQ6VXNlcjM0Njk4OTg=", "avatar_url": "https://avatars.githubusercontent.com/u/3469898?v=4", "gravatar_id": "", "url": "https://api.github.com/users/levsh", "html_url": "https://github.com/levsh", "followers_url": "https://api.github.com/users/levsh/followers", "following_url": "https://api.github.com/users/levsh/following{/other_user}", "gists_url": "https://api.github.com/users/levsh/gists{/gist_id}", "starred_url": "https://api.github.com/users/levsh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/levsh/subscriptions", "organizations_url": "https://api.github.com/users/levsh/orgs", "repos_url": "https://api.github.com/users/levsh/repos", "events_url": "https://api.github.com/users/levsh/events{/privacy}", "received_events_url": "https://api.github.com/users/levsh/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2020-11-13T15:47:10Z", "updated_at": "2020-11-13T19:07:49Z", "closed_at": "2020-11-13T18:13:26Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi!\r\nIs this a bug or i am doing something wrong?\r\n```python\r\nimport asyncio\r\nimport aiohttp\r\n\r\nprint(aiohttp.__version__)\r\n\r\nasync def main():\r\n    async with aiohttp.ClientSession(timeout=1) as s:\r\n        await s.get(\"http://example.com\")\r\n\r\nif __name__ == '__main__':\r\n    asyncio.run(main())\r\n```\r\n\r\n```\r\n3.7.2\r\nTraceback (most recent call last):\r\n  File \"test.py\", line 15, in <module>\r\n    asyncio.run(main())\r\n  File \"/Users/levsh/.pyenv/versions/3.8.6/lib/python3.8/asyncio/runners.py\", line 44, in run\r\n    return loop.run_until_complete(main)\r\n  File \"/Users/levsh/.pyenv/versions/3.8.6/lib/python3.8/asyncio/base_events.py\", line 616, in run_until_complete\r\n    return future.result()\r\n  File \"test.py\", line 11, in main\r\n    await s.get(\"http://example.com\")\r\n  File \"/Users/levsh/.pyenv/versions/3.8.6/lib/python3.8/site-packages/aiohttp/client.py\", line 435, in _request\r\n    tm = TimeoutHandle(self._loop, real_timeout.total)\r\nAttributeError: 'int' object has no attribute 'total'\r\n```\r\n\r\npython version - 3.8.6\r\naiohttp version - 3.7.2\r\n\r\nI think the problem is here  https://github.com/aio-libs/aiohttp/blob/v3.7.2/aiohttp/client.py#L274 and here https://github.com/aio-libs/aiohttp/blob/v3.7.2/aiohttp/client.py#L427\r\n\r\nThank you!\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5226/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5226/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5217", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5217/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5217/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5217/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5217", "id": 740653679, "node_id": "MDU6SXNzdWU3NDA2NTM2Nzk=", "number": 5217, "title": "Crash on import (python 3.9.0a5)", "user": {"login": "cglacet", "id": 28622118, "node_id": "MDQ6VXNlcjI4NjIyMTE4", "avatar_url": "https://avatars.githubusercontent.com/u/28622118?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cglacet", "html_url": "https://github.com/cglacet", "followers_url": "https://api.github.com/users/cglacet/followers", "following_url": "https://api.github.com/users/cglacet/following{/other_user}", "gists_url": "https://api.github.com/users/cglacet/gists{/gist_id}", "starred_url": "https://api.github.com/users/cglacet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cglacet/subscriptions", "organizations_url": "https://api.github.com/users/cglacet/orgs", "repos_url": "https://api.github.com/users/cglacet/repos", "events_url": "https://api.github.com/users/cglacet/events{/privacy}", "received_events_url": "https://api.github.com/users/cglacet/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 58986080, "node_id": "MDU6TGFiZWw1ODk4NjA4MA==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/wontfix", "name": "wontfix", "color": "b7942c", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-11-11T10:28:02Z", "updated_at": "2020-11-11T11:49:16Z", "closed_at": "2020-11-11T11:49:16Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n\r\n```python\r\n>>> import aiohttp \r\nline 11, in <module>\r\n    import aiohttp\r\n File \"/lib/python3.9/site-packages/aiohttp/__init__.py\", line 6, in <module>\r\n    from .client import (\r\n File \"lib/python3.9/site-packages/aiohttp/client.py\", line 35, in <module>\r\n    from . import hdrs, http, payload\r\n File \"lib/python3.9/site-packages/aiohttp/http_parser.py\", line 15, in <module>\r\n    from .helpers import NO_EXTENSIONS, BaseTimerContext\r\n File \"/lib/python3.9/site-packages/aiohttp/helpers.py\", line 48, in <module>\r\n    from typing_extensions import Protocol\r\n  File \"/lib/python3.9/site-packages/typing_extensions.py\", line 2084, in <module>\r\n    def TypeAlias(self, parameters):\r\nTypeError: __init__() missing 1 required positional argument: 'doc'\r\n```\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n\r\n```bash\r\n$ pyenv install 3.9.0a5\r\n$ pyenv shell 3.9.0a5\r\n$ pip install aiohttp\r\n$ python -c \"import aiohttp\"\r\n```\r\n\r\nThe version of `aiohttp` this installs is `3.7.2`: \r\n\r\n```bash\r\n$ pip show aiotthp\r\nName: aiohttp\r\nVersion: 3.7.2\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nRequires: chardet, multidict, async-timeout, attrs, yarl, typing-extensions\r\nRequired-by: kune.api-tools, kune-api-tools, aiohttp-asynctools\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5217/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5217/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5215", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5215/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5215/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5215/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5215", "id": 740273008, "node_id": "MDU6SXNzdWU3NDAyNzMwMDg=", "number": 5215, "title": "aiohttp shouldn't invoke the exception handler for unexceptional situations", "user": {"login": "sersorrel", "id": 9433472, "node_id": "MDQ6VXNlcjk0MzM0NzI=", "avatar_url": "https://avatars.githubusercontent.com/u/9433472?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sersorrel", "html_url": "https://github.com/sersorrel", "followers_url": "https://api.github.com/users/sersorrel/followers", "following_url": "https://api.github.com/users/sersorrel/following{/other_user}", "gists_url": "https://api.github.com/users/sersorrel/gists{/gist_id}", "starred_url": "https://api.github.com/users/sersorrel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sersorrel/subscriptions", "organizations_url": "https://api.github.com/users/sersorrel/orgs", "repos_url": "https://api.github.com/users/sersorrel/repos", "events_url": "https://api.github.com/users/sersorrel/events{/privacy}", "received_events_url": "https://api.github.com/users/sersorrel/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 58986080, "node_id": "MDU6TGFiZWw1ODk4NjA4MA==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/wontfix", "name": "wontfix", "color": "b7942c", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-11-10T21:59:37Z", "updated_at": "2020-11-13T14:55:13Z", "closed_at": "2020-11-11T10:46:13Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nWhen certain objects from aiohttp get leaked, they invoke the asyncio exception handler, which in some environments (e.g. when using [aiorun](https://github.com/cjrh/aiorun), with `stop_on_unhandled_errors=True`) means the entire program is stopped.\r\n\r\nFor example, here is the relevant code in `ClientResponse`:\r\n\r\nhttps://github.com/aio-libs/aiohttp/blob/a8d9ec3f1667463e80545b1cacc7833d1ff305e9/aiohttp/client_reqrep.py#L748-L751\r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\nLeak an aiohttp object that does this.\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\nLeaking objects should not cause an exception, for the same reason that `open()`ing a file and not `.close()`ing it does not raise an exception.\r\n\r\nAll objects that do this appear to already raise a warning about the resource leakage \u2013 I don't see a reason for them to invoke the exception handler as well.\r\n\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.8.6\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.6.2\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.6\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.5.1\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\ncjrh/aiorun#56", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5215/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5215/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5214", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5214/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5214/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5214/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5214", "id": 740158008, "node_id": "MDU6SXNzdWU3NDAxNTgwMDg=", "number": 5214, "title": "[docs] is web socket read really required to happen from the request handler task?", "user": {"login": "danking", "id": 106194, "node_id": "MDQ6VXNlcjEwNjE5NA==", "avatar_url": "https://avatars.githubusercontent.com/u/106194?v=4", "gravatar_id": "", "url": "https://api.github.com/users/danking", "html_url": "https://github.com/danking", "followers_url": "https://api.github.com/users/danking/followers", "following_url": "https://api.github.com/users/danking/following{/other_user}", "gists_url": "https://api.github.com/users/danking/gists{/gist_id}", "starred_url": "https://api.github.com/users/danking/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/danking/subscriptions", "organizations_url": "https://api.github.com/users/danking/orgs", "repos_url": "https://api.github.com/users/danking/repos", "events_url": "https://api.github.com/users/danking/events{/privacy}", "received_events_url": "https://api.github.com/users/danking/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-11-10T18:48:34Z", "updated_at": "2020-11-11T20:53:33Z", "closed_at": "2020-11-11T20:53:33Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "(I asked [this question on the discourse forum](https://aio-libs.discourse.group/t/why-can-a-web-socket-only-be-read-from-the-request-handler-task/154) and received no response for 11 days, so I'm escalating it to a docs bug)\r\n\r\n\ud83d\udc1e **Describe the bug**\r\n\r\nThe docs [currently state](https://docs.aiohttp.org/en/stable/web_advanced.html#reading-from-the-same-task-in-websockets):\r\n\r\n> Reading from the WebSocket ( await ws.receive() ) must only be done inside the request handler task\r\n\r\nThat verbiage was introduced in this PR: https://github.com/aio-libs/aiohttp/pull/647. Before that PR the verbiage was:\r\n\r\n> You must use the only websocket task for both reading (e.g await ws.receive()) and writing but may have multiple writer tasks which can only send data asynchronously (by ws.send_str('data') for example).\r\n\r\n\r\nCan someone confirm or deny if I am allowed to call receive from a task other than the request handling task? Only one task will call receive in this setting.\r\n\r\nSpecifically, I want to write the following code. Is this code invalid because the receive occurs inside a task *other than the request handling task*?\r\n\r\n```python3\r\nclass WebSocketKeepAliveContextManager:\r\n    def __init__(self, ws):\r\n        self.ws = ws\r\n        self.task = None\r\n\r\n    async def __aenter__(self):\r\n        self.task = asyncio.create_task(self.ws.receive())\r\n\r\n    async def __aexit__(self, exc_type, exc, tb):\r\n        if self.task.done():\r\n            message = self.task.result()\r\n            raise ValueError(f'unexpected message during keepalive: {message}')\r\n        else:\r\n            self.task.cancel()\r\n\r\ndef keep_ws_alive(ws):\r\n    return WebSocketKeepAliveContextManager(ws)\r\n\r\ndef some_request_handler(request):\r\n    # ... create a web socket ...\r\n    async with keep_ws_alive(ws):\r\n        await long_running_activity()\r\n```\r\n\r\n\ud83d\udca1 **To Reproduce**\r\nN/A\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n\r\nI expect the docs to state that no more than one coroutine may await `receive` at any given time. The identity of the coroutine that awaits receive is irrelevant.\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n\r\nN/A\r\n\ud83d\udccb **Your version of the Python**\r\nN/A\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\nI looked at the docs website on 2020-11-10.\r\n\r\n\ud83d\udccb **Additional context**\r\nN/A", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5214/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5214/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5205", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5205/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5205/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5205/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5205", "id": 737337227, "node_id": "MDU6SXNzdWU3MzczMzcyMjc=", "number": 5205, "title": "It raises HTTPRequestEntityTooLarge (web_request.py) not following the param of Application client_max_size", "user": {"login": "huogerac", "id": 962233, "node_id": "MDQ6VXNlcjk2MjIzMw==", "avatar_url": "https://avatars.githubusercontent.com/u/962233?v=4", "gravatar_id": "", "url": "https://api.github.com/users/huogerac", "html_url": "https://github.com/huogerac", "followers_url": "https://api.github.com/users/huogerac/followers", "following_url": "https://api.github.com/users/huogerac/following{/other_user}", "gists_url": "https://api.github.com/users/huogerac/gists{/gist_id}", "starred_url": "https://api.github.com/users/huogerac/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/huogerac/subscriptions", "organizations_url": "https://api.github.com/users/huogerac/orgs", "repos_url": "https://api.github.com/users/huogerac/repos", "events_url": "https://api.github.com/users/huogerac/events{/privacy}", "received_events_url": "https://api.github.com/users/huogerac/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-11-05T23:21:34Z", "updated_at": "2020-11-22T08:31:54Z", "closed_at": "2020-11-22T08:31:54Z", "author_association": "NONE", "active_lock_reason": null, "body": "The Application is created using the client_max_size > the default (1024 ** 2)\r\nIt seems the parameter is set properly, however, the BaseRequest is created using (1024 ** 2) that is also default in the BaseRequest rather than use the client_max_size from the Application.\r\nThen, when I send a request sending a binary in the RequestBody, it always raises the HTTPRequestEntityTooLarge (web_request.py:L597)\r\n\r\nTo reproceduce:\r\nCreate a AioHttpApp(client_max_size=1024 ** 2 * 10)\r\nCreate a request sending a file > 1MB and it should raises the 413 Error (Request Too Large)\r\n\r\nAioHttp version 3.7.2\r\n\r\nNote: If someone could confirm this is a real bug, I'd be happy to try to dig in the code to find out more details and possible solutions, otherwise, please let me know what am I missing here.\r\n\r\nCheers\r\nRoger.\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5205/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5205/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5192", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5192/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5192/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5192/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5192", "id": 734213550, "node_id": "MDU6SXNzdWU3MzQyMTM1NTA=", "number": 5192, "title": "Missing close status codes for websockets", "user": {"login": "achimnol", "id": 555156, "node_id": "MDQ6VXNlcjU1NTE1Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/555156?v=4", "gravatar_id": "", "url": "https://api.github.com/users/achimnol", "html_url": "https://github.com/achimnol", "followers_url": "https://api.github.com/users/achimnol/followers", "following_url": "https://api.github.com/users/achimnol/following{/other_user}", "gists_url": "https://api.github.com/users/achimnol/gists{/gist_id}", "starred_url": "https://api.github.com/users/achimnol/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/achimnol/subscriptions", "organizations_url": "https://api.github.com/users/achimnol/orgs", "repos_url": "https://api.github.com/users/achimnol/repos", "events_url": "https://api.github.com/users/achimnol/events{/privacy}", "received_events_url": "https://api.github.com/users/achimnol/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2020-11-02T06:08:03Z", "updated_at": "2020-11-23T14:51:59Z", "closed_at": "2020-11-23T14:51:59Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n\r\nref: https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent\r\ncurrent: https://github.com/aio-libs/aiohttp/blob/707736b/aiohttp/http_websocket.py#L31-L42\r\n\r\nThe close code 1014, 1015 is missing, and one of my use case (websocket proxy) involves 1014,\r\nwhich results in an unexpected error \"Invalid close code: 1014\".\r\n\r\nI think we need to update the list.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5192/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5192/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5163", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5163/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5163/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5163/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5163", "id": 731248436, "node_id": "MDU6SXNzdWU3MzEyNDg0MzY=", "number": 5163, "title": "\"Iterator[BodyPartReader]\" has no attribute \"__anext__\"", "user": {"login": "blazewicz", "id": 13185945, "node_id": "MDQ6VXNlcjEzMTg1OTQ1", "avatar_url": "https://avatars.githubusercontent.com/u/13185945?v=4", "gravatar_id": "", "url": "https://api.github.com/users/blazewicz", "html_url": "https://github.com/blazewicz", "followers_url": "https://api.github.com/users/blazewicz/followers", "following_url": "https://api.github.com/users/blazewicz/following{/other_user}", "gists_url": "https://api.github.com/users/blazewicz/gists{/gist_id}", "starred_url": "https://api.github.com/users/blazewicz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/blazewicz/subscriptions", "organizations_url": "https://api.github.com/users/blazewicz/orgs", "repos_url": "https://api.github.com/users/blazewicz/repos", "events_url": "https://api.github.com/users/blazewicz/events{/privacy}", "received_events_url": "https://api.github.com/users/blazewicz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-10-28T09:05:19Z", "updated_at": "2020-10-28T15:36:19Z", "closed_at": "2020-10-28T15:36:19Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\n`BodyPartReader.__aiter__()` is declared to return `Iterator` instead of `AsyncIterator`. Introduced in https://github.com/aio-libs/aiohttp/commit/3b70bad264da8e47974264863a09d6a5fc808b39 (#4931).\r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\n\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\n\r\nSnippet to reproduce:\r\n\r\n```Python\r\n# rep.py\r\nfrom aiohttp import web\r\n\r\nasync def handler(request: web.Request) -> None:\r\n    reader = await request.multipart()\r\n    async for field in reader:\r\n        ...\r\n```\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\n\r\nNo errors returned by mypy.\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\n$ mypy rep.py\r\nrep.py:5: error: \"Iterator[BodyPartReader]\" has no attribute \"__anext__\"; maybe \"__next__\"?\r\nFound 1 error in 1 file (checked 1 source file)\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.8.6\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.2\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /private/tmp/aiohttpbug/.venv/lib/python3.8/site-packages\r\nRequires: multidict, chardet, yarl, async-timeout, typing-extensions, attrs\r\nRequired-by:\r\n```\r\n```console\r\n$ python -m pip show multidict\r\n# irrelevant\r\n```\r\n```console\r\n$ python -m pip show yarl\r\n# irrelevant\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\n\r\nVersion of mypy:\r\n\r\n```console\r\n$ python -m pip show mypy\r\nName: mypy\r\nVersion: 0.790\r\nSummary: Optional static typing for Python\r\nHome-page: http://www.mypy-lang.org/\r\nAuthor: Jukka Lehtosalo\r\nAuthor-email: jukka.lehtosalo@iki.fi\r\nLicense: MIT License\r\nLocation: /private/tmp/aiohttpbug/.venv/lib/python3.8/site-packages\r\nRequires: typed-ast, typing-extensions, mypy-extensions\r\nRequired-by:\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5163/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5163/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5156", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5156/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5156/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5156/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5156", "id": 729942883, "node_id": "MDU6SXNzdWU3Mjk5NDI4ODM=", "number": 5156, "title": "Tuple index out of range with 3.7.1 and no IPv6", "user": {"login": "danielnelson", "id": 1048079, "node_id": "MDQ6VXNlcjEwNDgwNzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1048079?v=4", "gravatar_id": "", "url": "https://api.github.com/users/danielnelson", "html_url": "https://github.com/danielnelson", "followers_url": "https://api.github.com/users/danielnelson/followers", "following_url": "https://api.github.com/users/danielnelson/following{/other_user}", "gists_url": "https://api.github.com/users/danielnelson/gists{/gist_id}", "starred_url": "https://api.github.com/users/danielnelson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/danielnelson/subscriptions", "organizations_url": "https://api.github.com/users/danielnelson/orgs", "repos_url": "https://api.github.com/users/danielnelson/repos", "events_url": "https://api.github.com/users/danielnelson/events{/privacy}", "received_events_url": "https://api.github.com/users/danielnelson/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 303800438, "node_id": "MDU6TGFiZWwzMDM4MDA0Mzg=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/need%20pull%20request", "name": "need pull request", "color": "bfdadc", "default": false, "description": null}, {"id": 1577406386, "node_id": "MDU6TGFiZWwxNTc3NDA2Mzg2", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/regression", "name": "regression", "color": "c62b3b", "default": false, "description": "Something that used to work stopped working \"as before\" after upgrade"}, {"id": 1831256427, "node_id": "MDU6TGFiZWwxODMxMjU2NDI3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/reproducer:%20present", "name": "reproducer: present", "color": "c2e0c6", "default": false, "description": "This PR or issue contains code, which reproduce the problem described or clearly understandable STR"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 23, "created_at": "2020-10-26T22:09:12Z", "updated_at": "2021-10-24T12:06:33Z", "closed_at": "2021-10-24T12:06:32Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nAfter upgrading to aiohttp==3.7.1, dns resolution fails with an exception.\r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\n\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\n\r\n1. I believe this is due to not have IPV6 enabled in my kernel, which is custom compiled with.\r\n   `CONFIG_IPV6=n`\r\n2. Run:\r\n   ```python\r\n   import asyncio\r\n   import aiohttp\r\n\r\n\r\n   async def main():\r\n       async with aiohttp.ClientSession() as session:\r\n           async with session.get('http://python.org') as response:\r\n               print(response.status)\r\n\r\n\r\n   asyncio.run(main())\r\n   ```\r\n3. Actual behavior\r\n   ```python-traceback\r\n   $ python bug.py\r\n   Traceback (most recent call last):\r\n     File \"bug.py\", line 11, in <module>\r\n       asyncio.run(main())\r\n     File \"/usr/lib/python3.7/asyncio/runners.py\", line 43, in run\r\n       return loop.run_until_complete(main)\r\n     File \"/usr/lib/python3.7/asyncio/base_events.py\", line 587, in run_until_complete\r\n       return future.result()\r\n     File \"bug.py\", line 7, in main\r\n       async with session.get('http://python.org') as response:\r\n     File \"/home/dbn/usr/py37/lib/python3.7/site-packages/aiohttp/client.py\", line 1124, in __aenter__\r\n       self._resp = await self._coro\r\n     File \"/home/dbn/usr/py37/lib/python3.7/site-packages/aiohttp/client.py\", line 528, in _request\r\n       req, traces=traces, timeout=real_timeout\r\n     File \"/home/dbn/usr/py37/lib/python3.7/site-packages/aiohttp/connector.py\", line 541, in connect\r\n       proto = await self._create_connection(req, traces, timeout)\r\n     File \"/home/dbn/usr/py37/lib/python3.7/site-packages/aiohttp/connector.py\", line 898, in _create_connection\r\n       _, proto = await self._create_direct_connection(req, traces, timeout)\r\n     File \"/home/dbn/usr/py37/lib/python3.7/site-packages/aiohttp/connector.py\", line 1005, in _create_direct_connection\r\n       hosts = await asyncio.shield(host_resolved)\r\n     File \"/home/dbn/usr/py37/lib/python3.7/site-packages/aiohttp/connector.py\", line 871, in _resolve_host\r\n       addrs = await self._resolver.resolve(host, port, family=self._family)\r\n     File \"/home/dbn/usr/py37/lib/python3.7/site-packages/aiohttp/resolver.py\", line 37, in resolve\r\n       if family == socket.AF_INET6 and address[3]:  # type: ignore\r\n   IndexError: tuple index out of range\r\n   ```\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\nShould print `200`.\r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\n\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.7.9\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.1\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/dbn/usr/py37/lib/python3.7/site-packages\r\nRequires: multidict, async-timeout, typing-extensions, yarl, chardet, attrs\r\nRequired-by: replay-proxy\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.6\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/dbn/usr/py37/lib/python3.7/site-packages\r\nRequires:\r\nRequired-by: yarl, aiohttp\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.5.1\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/dbn/usr/py37/lib/python3.7/site-packages\r\nRequires: typing-extensions, multidict, idna\r\nRequired-by: aiohttp, replay-proxy\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5156/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5156/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5155", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5155/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5155/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5155/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5155", "id": 729777874, "node_id": "MDU6SXNzdWU3Mjk3Nzc4NzQ=", "number": 5155, "title": "aiohttp.client_exceptions.ClientConnectorError: Cannot connect to host 0.0.0.0:7000 ssl:default [Name or service not known]", "user": {"login": "lpkeates", "id": 60580452, "node_id": "MDQ6VXNlcjYwNTgwNDUy", "avatar_url": "https://avatars.githubusercontent.com/u/60580452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lpkeates", "html_url": "https://github.com/lpkeates", "followers_url": "https://api.github.com/users/lpkeates/followers", "following_url": "https://api.github.com/users/lpkeates/following{/other_user}", "gists_url": "https://api.github.com/users/lpkeates/gists{/gist_id}", "starred_url": "https://api.github.com/users/lpkeates/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lpkeates/subscriptions", "organizations_url": "https://api.github.com/users/lpkeates/orgs", "repos_url": "https://api.github.com/users/lpkeates/repos", "events_url": "https://api.github.com/users/lpkeates/events{/privacy}", "received_events_url": "https://api.github.com/users/lpkeates/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1831255463, "node_id": "MDU6TGFiZWwxODMxMjU1NDYz", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/reproducer:%20missing", "name": "reproducer: missing", "color": "e23c36", "default": false, "description": "This PR or issue lacks code, which reproduce the problem described or clearly understandable STR"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2020-10-26T17:49:06Z", "updated_at": "2023-03-10T10:47:24Z", "closed_at": "2023-03-10T10:47:06Z", "author_association": "NONE", "active_lock_reason": null, "body": "```python-traceback\r\nTraceback (most recent call last):\r\n  File \"/home/container/.local/lib/python3.8/site-packages/aiohttp/connector.py\", line 936, in _wrap_create_connection\r\n    return await self._loop.create_connection(*args, **kwargs)  # type: ignore  # noqa\r\n  File \"/usr/lib/python3.8/asyncio/base_events.py\", line 1017, in create_connection\r\n    raise exceptions[0]\r\n  File \"/usr/lib/python3.8/asyncio/base_events.py\", line 1002, in create_connection\r\n    sock = await self._connect_sock(\r\n  File \"/usr/lib/python3.8/asyncio/base_events.py\", line 916, in _connect_sock\r\n    await self.sock_connect(sock, address)\r\n  File \"/usr/lib/python3.8/asyncio/selector_events.py\", line 485, in sock_connect\r\n    return await fut\r\n  File \"/usr/lib/python3.8/asyncio/selector_events.py\", line 517, in _sock_connect_cb\r\n    raise OSError(err, f'Connect call failed {address}')\r\nConnectionRefusedError: [Errno 111] Connect call failed ('0.0.0.0', 7000)\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/container/.local/lib/python3.8/site-packages/wavelink/websocket.py\", line 76, in _connect\r\n    self._websocket = await self._node.session.ws_connect(uri, headers=self.headers, heartbeat=self._node.heartbeat)\r\n  File \"/home/container/.local/lib/python3.8/site-packages/aiohttp/client.py\", line 721, in _ws_connect\r\n    resp = await self.request(method, url,\r\n  File \"/home/container/.local/lib/python3.8/site-packages/aiohttp/client.py\", line 480, in _request\r\n    conn = await self._connector.connect(\r\n  File \"/home/container/.local/lib/python3.8/site-packages/aiohttp/connector.py\", line 523, in connect\r\n    proto = await self._create_connection(req, traces, timeout)\r\n  File \"/home/container/.local/lib/python3.8/site-packages/aiohttp/connector.py\", line 858, in _create_connection\r\n    _, proto = await self._create_direct_connection(\r\n  File \"/home/container/.local/lib/python3.8/site-packages/aiohttp/connector.py\", line 1004, in _create_direct_connection\r\n    raise last_exc\r\n  File \"/home/container/.local/lib/python3.8/site-packages/aiohttp/connector.py\", line 980, in _create_direct_connection\r\n    transp, proto = await self._wrap_create_connection(\r\n  File \"/home/container/.local/lib/python3.8/site-packages/aiohttp/connector.py\", line 943, in _wrap_create_connection\r\n    raise client_error(req.connection_key, exc) from exc\r\naiohttp.client_exceptions.ClientConnectorError: Cannot connect to host 0.0.0.0:7000 ssl:default [Connect call failed ('0.0.0.0', 7000)]\r\n```\r\n\r\nMy Code (wavelink)\r\n```python\r\n        nodes = {'MAIN': {'host': '0.0.0.0',\r\n                          'port': 7000,\r\n                          'rest_uri': 'http://0.0.0.0:7000',\r\n                          'password': 'testing',\r\n                          'identifier': 'REST',\r\n                          'region': 'us_central'\r\n                          }}\r\n```\r\nMy Code (application.yml)\r\n```yaml\r\nserver: # REST and WS server\r\n  port: 7000\r\n  address: 0.0.0.0\r\nlavalink:\r\n  server:\r\n    password: \"testing\"\r\n    sources:\r\n      youtube: true\r\n      bandcamp: true\r\n      soundcloud: true\r\n      twitch: true\r\n      vimeo: true\r\n      mixer: true\r\n      http: true\r\n      local: false\r\n    bufferDurationMs: 400\r\n    youtubePlaylistLoadLimit: 6 # Number of pages at 100 each\r\n    youtubeSearchEnabled: true\r\n    soundcloudSearchEnabled: true\r\n    gc-warnings: true\r\n\r\nmetrics:\r\n  prometheus:\r\n    enabled: false\r\n    endpoint: /metrics\r\n\r\nsentry:\r\n  dsn: \"\"\r\nlogging:\r\n  file:\r\n    max-history: 30\r\n    max-size: 1GB\r\n  path: ./logs/\r\n\r\n  level:\r\n   root: INFO\r\n    lavalink: INFO\r\n```\r\n\r\n### My environment\r\nPython: `3.8.6`\r\nAiohttp: `3.6.2`\r\nOS: N/A", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5155/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5155/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5149", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5149/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5149/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5149/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5149", "id": 729193227, "node_id": "MDU6SXNzdWU3MjkxOTMyMjc=", "number": 5149, "title": "An error occurred when publishing a static file using uvloop", "user": {"login": "hoto17296", "id": 1976227, "node_id": "MDQ6VXNlcjE5NzYyMjc=", "avatar_url": "https://avatars.githubusercontent.com/u/1976227?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hoto17296", "html_url": "https://github.com/hoto17296", "followers_url": "https://api.github.com/users/hoto17296/followers", "following_url": "https://api.github.com/users/hoto17296/following{/other_user}", "gists_url": "https://api.github.com/users/hoto17296/gists{/gist_id}", "starred_url": "https://api.github.com/users/hoto17296/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hoto17296/subscriptions", "organizations_url": "https://api.github.com/users/hoto17296/orgs", "repos_url": "https://api.github.com/users/hoto17296/repos", "events_url": "https://api.github.com/users/hoto17296/events{/privacy}", "received_events_url": "https://api.github.com/users/hoto17296/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 303800438, "node_id": "MDU6TGFiZWwzMDM4MDA0Mzg=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/need%20pull%20request", "name": "need pull request", "color": "bfdadc", "default": false, "description": null}, {"id": 344996043, "node_id": "MDU6TGFiZWwzNDQ5OTYwNDM=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/server", "name": "server", "color": "006b75", "default": false, "description": null}, {"id": 1577406386, "node_id": "MDU6TGFiZWwxNTc3NDA2Mzg2", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/regression", "name": "regression", "color": "c62b3b", "default": false, "description": "Something that used to work stopped working \"as before\" after upgrade"}, {"id": 1831256427, "node_id": "MDU6TGFiZWwxODMxMjU2NDI3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/reproducer:%20present", "name": "reproducer: present", "color": "c2e0c6", "default": false, "description": "This PR or issue contains code, which reproduce the problem described or clearly understandable STR"}, {"id": 2451662697, "node_id": "MDU6TGFiZWwyNDUxNjYyNjk3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/backport-3.8", "name": "backport-3.8", "color": "000000", "default": false, "description": "Trigger automatic backporting to the 3.8 release branch by Patchback robot"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-10-26T02:50:27Z", "updated_at": "2020-10-27T07:24:31Z", "closed_at": "2020-10-27T07:24:31Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nAn error occurred when publishing a static file using aiohttp 3.7.x and uvloop.\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n``` Dockerfile\r\n# Dockerfile\r\n\r\nFROM python:3.8.6\r\n\r\nWORKDIR /work\r\n\r\nRUN pip install aiohttp==3.7.1 uvloop==0.14.0\r\n\r\nADD app.py .\r\n\r\nRUN mkdir static && echo \"/* DUMMY */\" > static/index.css\r\n\r\nCMD [\"python\", \"app.py\"]\r\n```\r\n\r\n``` python\r\n# app.py\r\n\r\nimport uvloop\r\nfrom aiohttp import web\r\n\r\nuvloop.install()\r\n\r\napp = web.Application()\r\napp.add_routes([web.static(\"/static\", \"/work/static\")])\r\n\r\nif __name__ == \"__main__\":\r\n    web.run_app(app)\r\n```\r\n\r\nThen, build and run server.\r\n\r\n``` console\r\n$ docker build . -t tmp\r\n$ docker run --rm -it -p 8080:8080 tmp\r\n```\r\n\r\nFinally, try to access http://localhost:8080/static/index.css .\r\n\r\nWhen accessed from a browser, the following error is displayed in the developer console.\r\n\r\n> net::ERR_CONTENT_LENGTH_MISMATCH 200 (OK)\r\n\r\nWhen accessed from a cURL, the following error is displayed.\r\n\r\n> curl: (18) transfer closed with 12 bytes remaining to read\r\n\r\nIt looks like the connection was closed before sending the response body.\r\n\r\n\ud83d\udca1 **Expected behavior**\r\nNo error occurs.\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\nNo messages are displayed in the Python log at all.\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n```console\r\n$ docker run --rm tmp python --version       \r\nPython 3.8.6\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ docker run --rm tmp python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.1\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/local/lib/python3.8/site-packages\r\nRequires: chardet, multidict, attrs, async-timeout, typing-extensions, yarl\r\nRequired-by:\r\n```\r\n\r\n```console\r\n$ docker run --rm tmp python -m pip show multidict\r\nName: multidict\r\nVersion: 5.0.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/local/lib/python3.8/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n```\r\n\r\n```console\r\n$ docker run --rm tmp python -m pip show yarl     \r\nName: yarl\r\nVersion: 1.6.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/local/lib/python3.8/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n- When aiphttp==3.6.*, it works fine\r\n- When uvloop disabled, it works fine", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5149/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5149/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5128", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5128/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5128/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5128/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5128", "id": 728930043, "node_id": "MDU6SXNzdWU3Mjg5MzAwNDM=", "number": 5128, "title": "ClientConnectorCertificateError raised when reading parquet file from GCS using pandas and aiohttp==3.7.0", "user": {"login": "sm-hawkfish", "id": 58445518, "node_id": "MDQ6VXNlcjU4NDQ1NTE4", "avatar_url": "https://avatars.githubusercontent.com/u/58445518?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sm-hawkfish", "html_url": "https://github.com/sm-hawkfish", "followers_url": "https://api.github.com/users/sm-hawkfish/followers", "following_url": "https://api.github.com/users/sm-hawkfish/following{/other_user}", "gists_url": "https://api.github.com/users/sm-hawkfish/gists{/gist_id}", "starred_url": "https://api.github.com/users/sm-hawkfish/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sm-hawkfish/subscriptions", "organizations_url": "https://api.github.com/users/sm-hawkfish/orgs", "repos_url": "https://api.github.com/users/sm-hawkfish/repos", "events_url": "https://api.github.com/users/sm-hawkfish/events{/privacy}", "received_events_url": "https://api.github.com/users/sm-hawkfish/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-10-25T03:24:53Z", "updated_at": "2020-10-25T06:38:22Z", "closed_at": "2020-10-25T06:38:22Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nWhen reading parquet files from Google Cloud Storage using Pandas and aiohttp==3.7.0, the following error is thrown:\r\n```\r\naiohttp.client_exceptions.ClientConnectorCertificateError: Cannot connect to host www.googleapis.com:443 ssl:True [SSLCertVerificationError: (1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: self signed certificate (_ssl.c:1108)')]\r\n```\r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\n\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\n\r\n```\r\npython3 -m venv venv\r\nsource venv/bin/activate\r\n\r\npip install pandas pyarrow fsspec gcsfs\r\n```\r\n\r\nAnd attempt to download any file from GCS using `pd.read_parquet(\"gs://..\")`. \r\n\r\nFor example, the file `gs://gcp-public-data-landsat/LC08/01/044/034/LC08_L1GT_044034_20130330_20170310_01_T2/LC08_L1GT_044034_20130330_20170310_01_T2_ANG.txt` is publicly available so we can use it as a test case. Even though it is not valid parquet, it will crash on the reported error before complaining about the file format.\r\n\r\n```python\r\nimport pandas as pd\r\n\r\nfile_uri = \"gs://gcp-public-data-landsat/LC08/01/044/034/LC08_L1GT_044034_20130330_20170310_01_T2/LC08_L1GT_044034_20130330_20170310_01_T2_ANG.txt\"\r\n\r\npd.read_parquet(file_uri).head()\r\n``` \r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\nThe file was able to be downloaded successfully (or, in the above test case, should crash with `OSError: Could not open parquet input source ... Either the file is corrupted or this is not a parquet file.`)\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/Users/steve/venv/lib/python3.8/site-packages/pandas/io/parquet.py\", line 317, in read_parquet\r\n    return impl.read(path, columns=columns, **kwargs)\r\n  File \"/Users/steve/venv/lib/python3.8/site-packages/pandas/io/parquet.py\", line 141, in read\r\n    result = self.api.parquet.read_table(\r\n  File \"/Users/steve/venv/lib/python3.8/site-packages/pyarrow/parquet.py\", line 1607, in read_table\r\n    dataset = _ParquetDatasetV2(\r\n  File \"/Users/steve/venv/lib/python3.8/site-packages/pyarrow/parquet.py\", line 1439, in __init__\r\n    if filesystem.get_file_info(path).is_file:\r\n  File \"pyarrow/_fs.pyx\", line 438, in pyarrow._fs.FileSystem.get_file_info\r\n  File \"pyarrow/error.pxi\", line 122, in pyarrow.lib.pyarrow_internal_check_status\r\n  File \"pyarrow/_fs.pyx\", line 1004, in pyarrow._fs._cb_get_file_info\r\n  File \"/Users/steve/venv/lib/python3.8/site-packages/pyarrow/fs.py\", line 195, in get_file_info\r\n    info = self.fs.info(path)\r\n  File \"/Users/steve/venv/lib/python3.8/site-packages/fsspec/asyn.py\", line 121, in wrapper\r\n    return maybe_sync(func, self, *args, **kwargs)\r\n  File \"/Users/steve/venv/lib/python3.8/site-packages/fsspec/asyn.py\", line 100, in maybe_sync\r\n    return sync(loop, func, *args, **kwargs)\r\n  File \"/Users/steve/venv/lib/python3.8/site-packages/fsspec/asyn.py\", line 71, in sync\r\n    raise exc.with_traceback(tb)\r\n  File \"/Users/steve/venv/lib/python3.8/site-packages/fsspec/asyn.py\", line 55, in f\r\n    result[0] = await future\r\n  File \"/Users/steve/venv/lib/python3.8/site-packages/gcsfs/core.py\", line 781, in _info\r\n    return await self._get_object(path)\r\n  File \"/Users/steve/venv/lib/python3.8/site-packages/gcsfs/core.py\", line 576, in _get_object\r\n    bucket, await self._call(\"GET\", \"b/{}/o/{}\", bucket, key, json_out=True)\r\n  File \"/Users/steve/venv/lib/python3.8/site-packages/gcsfs/core.py\", line 487, in _call\r\n    async with self.session.request(\r\n  File \"/Users/steve/venv/lib/python3.8/site-packages/aiohttp/client.py\", line 1083, in __aenter__\r\n    self._resp = await self._coro\r\n  File \"/Users/steve/venv/lib/python3.8/site-packages/aiohttp/client.py\", line 490, in _request\r\n    conn = await self._connector.connect(\r\n  File \"/Users/steve/venv/lib/python3.8/site-packages/aiohttp/connector.py\", line 528, in connect\r\n    proto = await self._create_connection(req, traces, timeout)\r\n  File \"/Users/steve/venv/lib/python3.8/site-packages/aiohttp/connector.py\", line 868, in _create_connection\r\n    _, proto = await self._create_direct_connection(\r\n  File \"/Users/steve/venv/lib/python3.8/site-packages/aiohttp/connector.py\", line 1023, in _create_direct_connection\r\n    raise last_exc\r\n  File \"/Users/steve/venv/lib/python3.8/site-packages/aiohttp/connector.py\", line 999, in _create_direct_connection\r\n    transp, proto = await self._wrap_create_connection(\r\n  File \"/Users/steve/venv/lib/python3.8/site-packages/aiohttp/connector.py\", line 948, in _wrap_create_connection\r\n    raise ClientConnectorCertificateError(\r\naiohttp.client_exceptions.ClientConnectorCertificateError: Cannot connect to host www.googleapis.com:443 ssl:True [SSLCertVerificationError: (1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: self signed certificate (_ssl.c:1108)')]\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.8.2\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.0\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/steve/venv/lib/python3.8/site-packages\r\nRequires: async-timeout, multidict, attrs, yarl, chardet\r\nRequired-by: gcsfs\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.0.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/steve/venv/lib/python3.8/site-packages\r\nRequires:\r\nRequired-by: yarl, aiohttp\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/steve/venv/lib/python3.8/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\n**Downgrading aiohttp to 3.6.3 fixes the issue**\r\n\r\n```\r\npython3 -m venv venv\r\nsource venv/bin/activate\r\n\r\npip install pandas pyarrow fsspec gcsfs\r\npip freeze > bad.txt\r\n\r\nrm -rf venv\r\npython3 -m venv venv\r\nsource venv/bin/activate\r\n\r\npip install pandas pyarrow fsspec gcsfs aiohttp==3.6.3\r\npip freeze > good.txt\r\n\r\ndiff <(<bad.txt) <(<good.txt)\r\n```\r\nGives\r\n```\r\n1c1\r\n< aiohttp==3.7.0\r\n---\r\n> aiohttp==3.6.3\r\n13c13\r\n< multidict==5.0.0\r\n---\r\n> multidict==4.7.6\r\n27c27\r\n< yarl==1.6.2\r\n---\r\n> yarl==1.5.1\r\n```\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\n```\r\n   System Version: macOS 10.15.7 (19H2)\r\n      Kernel Version: Darwin 19.6.0\r\n```", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5128/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5128/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5127", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5127/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5127/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5127/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5127", "id": 728928062, "node_id": "MDU6SXNzdWU3Mjg5MjgwNjI=", "number": 5127, "title": "TypeError in web.py - '<' not supported between instances of 'sys.version_info' and 'float'", "user": {"login": "kevn845150", "id": 73413360, "node_id": "MDQ6VXNlcjczNDEzMzYw", "avatar_url": "https://avatars.githubusercontent.com/u/73413360?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kevn845150", "html_url": "https://github.com/kevn845150", "followers_url": "https://api.github.com/users/kevn845150/followers", "following_url": "https://api.github.com/users/kevn845150/following{/other_user}", "gists_url": "https://api.github.com/users/kevn845150/gists{/gist_id}", "starred_url": "https://api.github.com/users/kevn845150/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kevn845150/subscriptions", "organizations_url": "https://api.github.com/users/kevn845150/orgs", "repos_url": "https://api.github.com/users/kevn845150/repos", "events_url": "https://api.github.com/users/kevn845150/events{/privacy}", "received_events_url": "https://api.github.com/users/kevn845150/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-10-25T03:10:07Z", "updated_at": "2020-10-25T06:58:49Z", "closed_at": "2020-10-25T06:58:49Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n\r\n1. Windows, Python 3.9.0 x64\r\n2. \"from aiohttp import web\"\r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\n File \"C:\\_dev\\.venv\\lib\\site-packages\\aiohttp\\web.py\", line 379, in _run_app\r\n    if sys.platform == \"win32\" and sys.version_info < 3.8:\r\nTypeError: '<' not supported between instances of 'sys.version_info' and 'float'\r\n\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.9.0\r\n...\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.0\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\_dev\\.venv\\lib\\site-packages\r\nRequires: async-timeout, multidict, chardet, yarl, attrs\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.0.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\_dev\\.venv\\lib\\site-packages\r\nRequires:\r\nRequired-by: yarl, aiohttp\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\_dev\\.venv\\lib\\site-packages\r\nRequires: multidict, idna\r\nRequired-by: aiormq, aiohttp, aio-pika\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\nThis can be reproduced by simply doing:\r\nimport sys\r\nprint(sys.version_info < 3.8)\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5127/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5127/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5124", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5124/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5124/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5124/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5124", "id": 728892030, "node_id": "MDU6SXNzdWU3Mjg4OTIwMzA=", "number": 5124, "title": "Sending 0 byte files now triggers an exception in 3.7.0", "user": {"login": "bdraco", "id": 663432, "node_id": "MDQ6VXNlcjY2MzQzMg==", "avatar_url": "https://avatars.githubusercontent.com/u/663432?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bdraco", "html_url": "https://github.com/bdraco", "followers_url": "https://api.github.com/users/bdraco/followers", "following_url": "https://api.github.com/users/bdraco/following{/other_user}", "gists_url": "https://api.github.com/users/bdraco/gists{/gist_id}", "starred_url": "https://api.github.com/users/bdraco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bdraco/subscriptions", "organizations_url": "https://api.github.com/users/bdraco/orgs", "repos_url": "https://api.github.com/users/bdraco/repos", "events_url": "https://api.github.com/users/bdraco/events{/privacy}", "received_events_url": "https://api.github.com/users/bdraco/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-10-24T22:37:57Z", "updated_at": "2020-10-25T06:41:23Z", "closed_at": "2020-10-25T06:41:23Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\n#4517 caused a regression with 0 byte files.\r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n\r\nSend a 0 byte file with `aiohttp.web.FileResponse` on python 3.7 or later\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n\r\nNo exception\r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\nTraceback (most recent call last):\r\n  File \"/__w/core/core/venv/lib/python3.7/site-packages/aiohttp/web_protocol.py\", line 461, in start\r\n    resp, reset = await task\r\n  File \"/__w/core/core/venv/lib/python3.7/site-packages/aiohttp/web_protocol.py\", line 414, in _handle_request\r\n    reset = await self.finish_response(request, resp, start_time)\r\n  File \"/__w/core/core/venv/lib/python3.7/site-packages/aiohttp/web_protocol.py\", line 568, in finish_response\r\n    await prepare_meth(request)\r\n  File \"/__w/core/core/venv/lib/python3.7/site-packages/aiohttp/web_fileresponse.py\", line 373, in prepare\r\n    return await self._sendfile(request, fobj, offset, count)\r\n  File \"/__w/core/core/venv/lib/python3.7/site-packages/aiohttp/web_fileresponse.py\", line 191, in _sendfile_system\r\n    await writer.sendfile()\r\n  File \"/__w/core/core/venv/lib/python3.7/site-packages/aiohttp/web_fileresponse.py\", line 107, in sendfile\r\n    self._count\r\n  File \"/usr/local/lib/python3.7/asyncio/base_events.py\", line 1044, in sendfile\r\n    offset, count)\r\n  File \"/usr/local/lib/python3.7/asyncio/selector_events.py\", line 551, in _sendfile_native\r\n    fallback=False)\r\n  File \"/usr/local/lib/python3.7/asyncio/base_events.py\", line 788, in sock_sendfile\r\n    self._check_sendfile_params(sock, file, offset, count)\r\n  File \"/usr/local/lib/python3.7/asyncio/base_events.py\", line 842, in _check_sendfile_params\r\n    \"count must be a positive integer (got {!r})\".format(count))\r\nValueError: count must be a positive integer (got 0)\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.8.1\r\n...\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\n...\r\n```\r\n```console\r\n$ python -m pip show multidict\r\n...\r\n```\r\n```console\r\n$ python -m pip show yarl\r\n...\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5124/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5124/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5116", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5116/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5116/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5116/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5116", "id": 728803120, "node_id": "MDU6SXNzdWU3Mjg4MDMxMjA=", "number": 5116, "title": "test_when_timeout_smaller_second is flaky", "user": {"login": "derlih", "id": 254158, "node_id": "MDQ6VXNlcjI1NDE1OA==", "avatar_url": "https://avatars.githubusercontent.com/u/254158?v=4", "gravatar_id": "", "url": "https://api.github.com/users/derlih", "html_url": "https://github.com/derlih", "followers_url": "https://api.github.com/users/derlih/followers", "following_url": "https://api.github.com/users/derlih/following{/other_user}", "gists_url": "https://api.github.com/users/derlih/gists{/gist_id}", "starred_url": "https://api.github.com/users/derlih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/derlih/subscriptions", "organizations_url": "https://api.github.com/users/derlih/orgs", "repos_url": "https://api.github.com/users/derlih/repos", "events_url": "https://api.github.com/users/derlih/events{/privacy}", "received_events_url": "https://api.github.com/users/derlih/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-10-24T14:41:03Z", "updated_at": "2020-10-24T16:25:50Z", "closed_at": "2020-10-24T16:25:50Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nSometimes test_when_timeout_smaller_second fails\r\n\r\n\ud83d\udca1 **To Reproduce**\r\nRun this test multiple times\r\n```\r\npip install pytest-repeat\r\npytest -q tests/test_helpers.py::test_when_timeout_smaller_second --count 1000 -x\r\n```\r\n\ud83d\udca1 **Expected behavior**\r\nTest shouldn't fail\r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n```python-traceback\r\nloop = <_UnixSelectorEventLoop running=False closed=False debug=False>\r\n\r\n    def test_when_timeout_smaller_second(loop) -> None:\r\n        timeout = 0.1\r\n        timer = loop.time() + timeout\r\n    \r\n        handle = helpers.TimeoutHandle(loop, timeout)\r\n        when = handle.start()._when\r\n        handle.close()\r\n    \r\n        assert isinstance(when, float)\r\n>       assert f\"{when:.3f}\" == f\"{timer:.3f}\"\r\nE       AssertionError: assert '151331.472' == '151331.471'\r\nE         - 151331.471\r\nE         ?          ^\r\nE         + 151331.472\r\nE         ?          ^\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.8.5\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\n4.0.0a1\r\n```\r\n```console\r\n$ python -m pip show multidict\r\n5.0.0\r\n```\r\n```console\r\n$ python -m pip show yarl\r\n1.6.1\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5116/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5116/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5112", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5112/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5112/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5112/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5112", "id": 728772646, "node_id": "MDU6SXNzdWU3Mjg3NzI2NDY=", "number": 5112, "title": "Network is unreachable with IPv6 enabled sites and no local IPv6 route", "user": {"login": "lilydjwg", "id": 440661, "node_id": "MDQ6VXNlcjQ0MDY2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/440661?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lilydjwg", "html_url": "https://github.com/lilydjwg", "followers_url": "https://api.github.com/users/lilydjwg/followers", "following_url": "https://api.github.com/users/lilydjwg/following{/other_user}", "gists_url": "https://api.github.com/users/lilydjwg/gists{/gist_id}", "starred_url": "https://api.github.com/users/lilydjwg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lilydjwg/subscriptions", "organizations_url": "https://api.github.com/users/lilydjwg/orgs", "repos_url": "https://api.github.com/users/lilydjwg/repos", "events_url": "https://api.github.com/users/lilydjwg/events{/privacy}", "received_events_url": "https://api.github.com/users/lilydjwg/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-10-24T11:45:47Z", "updated_at": "2021-01-02T12:31:33Z", "closed_at": "2020-10-25T06:37:59Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n\r\nWhen requesting HTTPS, IPv6 enabled sites but without local IPv6 route, I get Network is unreachable errors.\r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n\r\n\r\n1. `python3 -m venv venv` and `. venv/bin/activate`\r\n2. `pip install -U aiohttp`\r\n3. Run code:\r\n```python\r\nimport asyncio\r\nimport aiohttp\r\n\r\nasync def main():\r\n  async with aiohttp.ClientSession() as session:\r\n    r = await session.get('https://www.cloudflare.com/cdn-cgi/trace')\r\n    print(await r.text())\r\n\r\nif __name__ == '__main__':\r\n  asyncio.run(main())\r\n```\r\n4. See error.\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n\r\n```python-traceback (paste your traceback in the next line)\r\nTraceback (most recent call last):                                                                                                      \r\n  File \"/home/lilydjwg/tmpfs/venv/lib/python3.8/site-packages/aiohttp/connector.py\", line 946, in _wrap_create_connection\r\n    return await self._loop.create_connection(*args, **kwargs)  # type: ignore  # noqa                                   \r\n  File \"/usr/lib/python3.8/asyncio/base_events.py\", line 1025, in create_connection\r\n    raise exceptions[0]                                                                                                                 \r\n  File \"/usr/lib/python3.8/asyncio/base_events.py\", line 1010, in create_connection\r\n    sock = await self._connect_sock(        \r\n  File \"/usr/lib/python3.8/asyncio/base_events.py\", line 924, in _connect_sock\r\n    await self.sock_connect(sock, address)\r\n  File \"/usr/lib/python3.8/asyncio/selector_events.py\", line 496, in sock_connect                                                      \r\n    return await fut\r\n  File \"/usr/lib/python3.8/asyncio/selector_events.py\", line 501, in _sock_connect\r\n    sock.connect(address)\r\nOSError: [Errno 101] Network is unreachable\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"t.py\", line 12, in <module>\r\n    asyncio.run(main())\r\n  File \"/usr/lib/python3.8/asyncio/runners.py\", line 44, in run\r\n    return loop.run_until_complete(main)\r\n  File \"/usr/lib/python3.8/asyncio/base_events.py\", line 616, in run_until_complete\r\n    return future.result()\r\n  File \"t.py\", line 8, in main\r\n    r = await session.get('https://www.cloudflare.com/cdn-cgi/trace')\r\n  File \"/home/lilydjwg/tmpfs/venv/lib/python3.8/site-packages/aiohttp/client.py\", line 490, in _request\r\n    conn = await self._connector.connect(\r\n  File \"/home/lilydjwg/tmpfs/venv/lib/python3.8/site-packages/aiohttp/connector.py\", line 528, in connect\r\n    proto = await self._create_connection(req, traces, timeout)\r\n  File \"/home/lilydjwg/tmpfs/venv/lib/python3.8/site-packages/aiohttp/connector.py\", line 868, in _create_connection\r\n    _, proto = await self._create_direct_connection(\r\n  File \"/home/lilydjwg/tmpfs/venv/lib/python3.8/site-packages/aiohttp/connector.py\", line 1023, in _create_direct_connection\r\n    raise last_exc\r\n  File \"/home/lilydjwg/tmpfs/venv/lib/python3.8/site-packages/aiohttp/connector.py\", line 999, in _create_direct_connection\r\n    transp, proto = await self._wrap_create_connection(\r\n  File \"/home/lilydjwg/tmpfs/venv/lib/python3.8/site-packages/aiohttp/connector.py\", line 953, in _wrap_create_connection\r\n    raise client_error(req.connection_key, exc) from exc\r\naiohttp.client_exceptions.ClientConnectorError: Cannot connect to host www.cloudflare.com:443 ssl:default [Network is unreachable]\r\n\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.8.6\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.0\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/lilydjwg/tmpfs/venv/lib/python3.8/site-packages\r\nRequires: yarl, attrs, async-timeout, chardet, multidict\r\nRequired-by: \r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.0.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/lilydjwg/tmpfs/venv/lib/python3.8/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/lilydjwg/tmpfs/venv/lib/python3.8/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n\r\nThis errors caused my tests to fail on Travis-CI.\r\n\r\nThere is no issue with HTTP.  There is #5110 when IPv6 is accessible.\r\n\r\nI switched to www.cloudflare.com because pypi.org reidrects http to https.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5112/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5112/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5110", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5110/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5110/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5110/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5110", "id": 728771371, "node_id": "MDU6SXNzdWU3Mjg3NzEzNzE=", "number": 5110, "title": "certificate is not valid for IP", "user": {"login": "lilydjwg", "id": 440661, "node_id": "MDQ6VXNlcjQ0MDY2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/440661?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lilydjwg", "html_url": "https://github.com/lilydjwg", "followers_url": "https://api.github.com/users/lilydjwg/followers", "following_url": "https://api.github.com/users/lilydjwg/following{/other_user}", "gists_url": "https://api.github.com/users/lilydjwg/gists{/gist_id}", "starred_url": "https://api.github.com/users/lilydjwg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lilydjwg/subscriptions", "organizations_url": "https://api.github.com/users/lilydjwg/orgs", "repos_url": "https://api.github.com/users/lilydjwg/repos", "events_url": "https://api.github.com/users/lilydjwg/events{/privacy}", "received_events_url": "https://api.github.com/users/lilydjwg/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-10-24T11:37:52Z", "updated_at": "2020-10-24T18:47:46Z", "closed_at": "2020-10-24T18:47:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n\r\nWhen requesting with IPv6 enabled, I get this weird exception.\r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n\r\n\r\n1. `python3 -m venv venv` and `. venv/bin/activate`\r\n2. `pip install -U aiohttp`\r\n3. Run code:\r\n```python\r\nimport asyncio\r\nimport aiohttp\r\n\r\nasync def main():\r\n  async with aiohttp.ClientSession() as session:\r\n    r = await session.get('https://pypi.org/')\r\n    print(await r.text())\r\n\r\nif __name__ == '__main__':\r\n  asyncio.run(main())\r\n```\r\n4. See error.\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n\r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n\r\n```python-traceback (paste your traceback in the next line)\r\nTraceback (most recent call last): \r\n  File \"/home/lilydjwg/tmpfs/venv/lib/python3.8/site-packages/aiohttp/connector.py\", line 946, in _wrap_create_connection  \r\n    return await self._loop.create_connection(*args, **kwargs)  # type: ignore  # noqa\r\n  File \"/usr/lib/python3.8/asyncio/base_events.py\", line 1050, in create_connection                                      \r\n    transport, protocol = await self._create_connection_transport(\r\n  File \"/usr/lib/python3.8/asyncio/base_events.py\", line 1080, in _create_connection_transport                                              await waiter                                                                                                                          File \"/usr/lib/python3.8/asyncio/sslproto.py\", line 529, in data_received\r\n    ssldata, appdata = self._sslpipe.feed_ssldata(data)\r\n  File \"/usr/lib/python3.8/asyncio/sslproto.py\", line 189, in feed_ssldata                                                             \r\n    self._sslobj.do_handshake()\r\n  File \"/usr/lib/python3.8/ssl.py\", line 944, in do_handshake\r\n    self._sslobj.do_handshake()\r\nssl.SSLCertVerificationError: [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: IP address mismatch, certificate is not valid \r\nfor '151.101.128.223'. (_ssl.c:1124)\r\n\r\nThe above exception was the direct cause of the following exception: \r\n\r\nTraceback (most recent call last):\r\n  File \"t.py\", line 12, in <module>\r\n    asyncio.run(main())\r\n  File \"/usr/lib/python3.8/asyncio/runners.py\", line 44, in run\r\n    return loop.run_until_complete(main)\r\n  File \"/usr/lib/python3.8/asyncio/base_events.py\", line 616, in run_until_complete\r\n    return future.result()\r\n  File \"t.py\", line 8, in main\r\n    r = await session.get('https://pypi.org/')\r\n  File \"/home/lilydjwg/tmpfs/venv/lib/python3.8/site-packages/aiohttp/client.py\", line 490, in _request\r\n    conn = await self._connector.connect(\r\n  File \"/home/lilydjwg/tmpfs/venv/lib/python3.8/site-packages/aiohttp/connector.py\", line 528, in connect\r\n    proto = await self._create_connection(req, traces, timeout)\r\n  File \"/home/lilydjwg/tmpfs/venv/lib/python3.8/site-packages/aiohttp/connector.py\", line 868, in _create_connection\r\n    _, proto = await self._create_direct_connection(\r\n  File \"/home/lilydjwg/tmpfs/venv/lib/python3.8/site-packages/aiohttp/connector.py\", line 1023, in _create_direct_connection\r\n    raise last_exc\r\n  File \"/home/lilydjwg/tmpfs/venv/lib/python3.8/site-packages/aiohttp/connector.py\", line 999, in _create_direct_connection\r\n    transp, proto = await self._wrap_create_connection(\r\n  File \"/home/lilydjwg/tmpfs/venv/lib/python3.8/site-packages/aiohttp/connector.py\", line 948, in _wrap_create_connection\r\n    raise ClientConnectorCertificateError(\r\naiohttp.client_exceptions.ClientConnectorCertificateError: Cannot connect to host pypi.org:443 ssl:True [SSLCertVerificationError: (1, \"[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: IP address mismatch, certificate is not valid for '151.101.128.223'. (_ssl.c:1124)\")]\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.8.6\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.7.0\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/lilydjwg/tmpfs/venv/lib/python3.8/site-packages\r\nRequires: yarl, attrs, async-timeout, chardet, multidict\r\nRequired-by: \r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 5.0.0\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/lilydjwg/tmpfs/venv/lib/python3.8/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/lilydjwg/tmpfs/venv/lib/python3.8/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n\r\nI find this when I'm trying to reproduce another error.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5110/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5110/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5107", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5107/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5107/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5107/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5107", "id": 728756931, "node_id": "MDU6SXNzdWU3Mjg3NTY5MzE=", "number": 5107, "title": "ModuleNotFoundError: No module named 'typing_extensions'", "user": {"login": "leszekhanusz", "id": 4641499, "node_id": "MDQ6VXNlcjQ2NDE0OTk=", "avatar_url": "https://avatars.githubusercontent.com/u/4641499?v=4", "gravatar_id": "", "url": "https://api.github.com/users/leszekhanusz", "html_url": "https://github.com/leszekhanusz", "followers_url": "https://api.github.com/users/leszekhanusz/followers", "following_url": "https://api.github.com/users/leszekhanusz/following{/other_user}", "gists_url": "https://api.github.com/users/leszekhanusz/gists{/gist_id}", "starred_url": "https://api.github.com/users/leszekhanusz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/leszekhanusz/subscriptions", "organizations_url": "https://api.github.com/users/leszekhanusz/orgs", "repos_url": "https://api.github.com/users/leszekhanusz/repos", "events_url": "https://api.github.com/users/leszekhanusz/events{/privacy}", "received_events_url": "https://api.github.com/users/leszekhanusz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2020-10-24T10:10:11Z", "updated_at": "2021-01-20T13:06:10Z", "closed_at": "2020-10-25T06:38:54Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\n\r\nAfter updating aiohttp from 3.6.2 to 3.7.0, the [gql](https://github.com/graphql-python/gql) tests are failing on python 3.8 with the Exception `ModuleNotFoundError: No module named 'typing_extensions'`\r\n\r\n```\r\ntests/conftest.py:15: in <module>\r\n    from aiohttp.test_utils import TestServer as AIOHTTPTestServer\r\n.tox/py38/lib/python3.8/site-packages/aiohttp/test_utils.py:43: in <module>\r\n    from .web import (\r\n.tox/py38/lib/python3.8/site-packages/aiohttp/web.py:23: in <module>\r\n    from .web_app import Application as Application\r\n.tox/py38/lib/python3.8/site-packages/aiohttp/web_app.py:39: in <module>\r\n    from .web_middlewares import _fix_request_current_app\r\n.tox/py38/lib/python3.8/site-packages/aiohttp/web_middlewares.py:7: in <module>\r\n    from .web_urldispatcher import SystemRoute\r\n.tox/py38/lib/python3.8/site-packages/aiohttp/web_urldispatcher.py:36: in <module>\r\n    from typing_extensions import TypedDict\r\nE   ModuleNotFoundError: No module named 'typing_extensions'\r\n\r\n```\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n\r\nCheck the PR [#156](https://github.com/graphql-python/gql/pull/156)", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5107/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 1}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5107/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5106", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5106/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5106/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5106/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5106", "id": 728309700, "node_id": "MDU6SXNzdWU3MjgzMDk3MDA=", "number": 5106, "title": "StreamResponse use Transfer-Encoding: chunked for 204 responses", "user": {"login": "arthurdarcet", "id": 973454, "node_id": "MDQ6VXNlcjk3MzQ1NA==", "avatar_url": "https://avatars.githubusercontent.com/u/973454?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arthurdarcet", "html_url": "https://github.com/arthurdarcet", "followers_url": "https://api.github.com/users/arthurdarcet/followers", "following_url": "https://api.github.com/users/arthurdarcet/following{/other_user}", "gists_url": "https://api.github.com/users/arthurdarcet/gists{/gist_id}", "starred_url": "https://api.github.com/users/arthurdarcet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arthurdarcet/subscriptions", "organizations_url": "https://api.github.com/users/arthurdarcet/orgs", "repos_url": "https://api.github.com/users/arthurdarcet/repos", "events_url": "https://api.github.com/users/arthurdarcet/events{/privacy}", "received_events_url": "https://api.github.com/users/arthurdarcet/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-10-23T15:22:25Z", "updated_at": "2020-10-26T09:51:54Z", "closed_at": "2020-10-26T09:51:54Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "\ud83d\udc1e\r\nThis server :\r\n```python\r\nfrom aiohttp import web\r\n\r\nasync def hello(request):\r\n\treturn web.StreamResponse(status=204)\r\n\t\r\napp = web.Application()\r\napp.add_routes([web.get('/', hello)])\r\nweb.run_app(app)\r\n```\r\n\r\nreturns invalid HTTP responses:\r\n\r\n```\r\n% echo -ne 'GET / HTTP/1.1\\r\\n\\r\\n' | nc -i 1 127.0.0.1 8080\r\nHTTP/1.1 204 No Content\r\nTransfer-Encoding: chunked\r\nContent-Type: application/octet-stream\r\nDate: Fri, 23 Oct 2020 14:14:39 GMT\r\nServer: Python/3.8 aiohttp/3.6.3\r\n\r\n0\r\n\r\n```\r\n\r\n(i am using OSX, so netcat is the BSD variant, the `-i 1` is not needed on linux)\r\n\r\n\r\nThe HTTP RFC specifies that a 204 response `MUST NOT` contain a body and is considered done after the first empty line after the headers.\r\n\r\nAlthough I'm not exactly sure whether or not a `0\\r\\n\\r\\n` body is consider an empty body or not when using `Transfer-Encoding: chunked` - so your call whether or not this should be fixed here.\r\n\r\n\r\nThe eventual bug for us is caused more by this issue https://trac.nginx.org/nginx/ticket/2066#ticket , which stacks with this one to crash our node clients.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5106/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5106/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5103", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5103/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5103/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5103/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5103", "id": 727345664, "node_id": "MDU6SXNzdWU3MjczNDU2NjQ=", "number": 5103, "title": "Aiohttp does not decode percentage url.", "user": {"login": "santasdi", "id": 29476878, "node_id": "MDQ6VXNlcjI5NDc2ODc4", "avatar_url": "https://avatars.githubusercontent.com/u/29476878?v=4", "gravatar_id": "", "url": "https://api.github.com/users/santasdi", "html_url": "https://github.com/santasdi", "followers_url": "https://api.github.com/users/santasdi/followers", "following_url": "https://api.github.com/users/santasdi/following{/other_user}", "gists_url": "https://api.github.com/users/santasdi/gists{/gist_id}", "starred_url": "https://api.github.com/users/santasdi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/santasdi/subscriptions", "organizations_url": "https://api.github.com/users/santasdi/orgs", "repos_url": "https://api.github.com/users/santasdi/repos", "events_url": "https://api.github.com/users/santasdi/events{/privacy}", "received_events_url": "https://api.github.com/users/santasdi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1831255463, "node_id": "MDU6TGFiZWwxODMxMjU1NDYz", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/reproducer:%20missing", "name": "reproducer: missing", "color": "e23c36", "default": false, "description": "This PR or issue lacks code, which reproduce the problem described or clearly understandable STR"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-10-22T12:31:23Z", "updated_at": "2020-10-22T15:00:39Z", "closed_at": "2020-10-22T15:00:39Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nAiohttp under hood use YARL for URL processing. 12.10.2020 was released latest version of YARL 1.6.2. With this version of yarl aiohttp ignore encoded params in url that was passed to request.query\r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n\r\n```\r\nfrom aiohttp import web\r\n\r\n\r\nasync def handler(request):\r\n    type_as_str = request.query['type__in']\r\n    type_as_list = [int(v) for v in type_as_str.split(',')]\r\n    return web.json_response({'result': type_as_list})\r\n\r\n\r\napp = web.Application()\r\napp.add_routes([\r\n    web.get(r'/material', handler)\r\n])\r\n\r\n\r\nif __name__ == '__main__':\r\n    web.run_app(app, host='127.0.0.1')\r\n```\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\n```\r\nRequest:\r\ncurl --location --request GET 'http://127.0.0.1:8080/material?type__in=1%2C2%2C3'\r\n\r\nResponse:\r\n{\"result\": [1, 2, 3]}\r\n```\r\n\ud83d\udccb **Logs/tracebacks**\r\n\r\n```\r\nError handling request\r\nTraceback (most recent call last):\r\n  File \"/home/santasdi/.pyenv/versions/project/lib/python3.6/site-packages/aiohttp/web_protocol.py\", line 418, in start\r\n    resp = await task\r\n  File \"/home/santasdi/.pyenv/versions/project/lib/python3.6/site-packages/aiohttp/web_app.py\", line 458, in _handle\r\n    resp = await handler(request)\r\n  File \"/home/santasdi/bugs/url_error.py\", line 6, in handler\r\n    type_as_list = [int(v) for v in type_as_str.split(',')]\r\n  File \"/home/santasdi/bugs/url_error.py\", line 6, in <listcomp>\r\n    type_as_list = [int(v) for v in type_as_str.split(',')]\r\nValueError: invalid literal for int() with base 10: '1%2C2%2C3'\r\n\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\npython 3.6.4\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\nName: aiohttp\r\nVersion: 3.6.2\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/santasdi/.pyenv/versions/3.6.4/envs/project/lib/python3.6/site-packages\r\nRequires: yarl, chardet, async-timeout, attrs, typing-extensions, multidict, idna-ssl\r\n...\r\n```\r\n```console\r\nName: multidict\r\nVersion: 4.7.6\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/santasdi/.pyenv/versions/3.6.4/envs/project/lib/python3.6/site-packages\r\n\r\n...\r\n```\r\n```console\r\nName: yarl\r\nVersion: 1.6.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/santasdi/.pyenv/versions/3.6.4/envs/project/lib/python3.6/site-packages\r\nRequires: multidict, idna, typing-extensions\r\n\r\n...\r\n```\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5103/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5103/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5059", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5059/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5059/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5059/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5059", "id": 723095018, "node_id": "MDU6SXNzdWU3MjMwOTUwMTg=", "number": 5059, "title": "Can't import ProxyConnector", "user": {"login": "geazersb", "id": 72651083, "node_id": "MDQ6VXNlcjcyNjUxMDgz", "avatar_url": "https://avatars.githubusercontent.com/u/72651083?v=4", "gravatar_id": "", "url": "https://api.github.com/users/geazersb", "html_url": "https://github.com/geazersb", "followers_url": "https://api.github.com/users/geazersb/followers", "following_url": "https://api.github.com/users/geazersb/following{/other_user}", "gists_url": "https://api.github.com/users/geazersb/gists{/gist_id}", "starred_url": "https://api.github.com/users/geazersb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/geazersb/subscriptions", "organizations_url": "https://api.github.com/users/geazersb/orgs", "repos_url": "https://api.github.com/users/geazersb/repos", "events_url": "https://api.github.com/users/geazersb/events{/privacy}", "received_events_url": "https://api.github.com/users/geazersb/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-10-16T10:20:07Z", "updated_at": "2020-10-16T16:05:07Z", "closed_at": "2020-10-16T16:05:06Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nWhilst trying to use a HTTP proxy with a connector for discord.py, I found out that I can't import ProxyConnector\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\nNot sure, I couldn't fix this at all.\r\n\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\nI am running Python 3.8.5 on Windows 10 pro, with aiohttp version 3.6.3\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\nI want to connect using a HTTP proxy\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\n`ImportError: cannot import name 'ProxyConnector' from 'aiohttp'` \r\n`AttributeError: module 'aiohttp' has no attribute 'ProxyConnector'`\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\npy --version\r\nPython 3.8.5\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\npython -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.6.3\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\users\\pepij\\appdata\\roaming\\python\\python38\\site-packages\r\nRequires: chardet, attrs, async-timeout, multidict, yarl\r\nRequired-by: discord.py\r\n```\r\n```console\r\npython -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.6\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\users\\pepij\\appdata\\roaming\\python\\python38\\site-packages\r\nRequires:\r\nRequired-by: yarl, aiohttp\r\n```\r\n```console\r\npython -m pip show yarl\r\nName: yarl\r\nVersion: 1.5.1\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\users\\pepij\\appdata\\roaming\\python\\python38\\site-packages\r\nRequires: multidict, idna\r\nRequired-by: aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\nI am on Windows 10 pro.\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5059/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5059/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5011", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5011/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5011/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5011/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5011", "id": 720453127, "node_id": "MDU6SXNzdWU3MjA0NTMxMjc=", "number": 5011, "title": "v3.6.3: aiohttp.http_exceptions.BadStatusLine: invalid HTTP method", "user": {"login": "bashalex", "id": 4807867, "node_id": "MDQ6VXNlcjQ4MDc4Njc=", "avatar_url": "https://avatars.githubusercontent.com/u/4807867?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bashalex", "html_url": "https://github.com/bashalex", "followers_url": "https://api.github.com/users/bashalex/followers", "following_url": "https://api.github.com/users/bashalex/following{/other_user}", "gists_url": "https://api.github.com/users/bashalex/gists{/gist_id}", "starred_url": "https://api.github.com/users/bashalex/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bashalex/subscriptions", "organizations_url": "https://api.github.com/users/bashalex/orgs", "repos_url": "https://api.github.com/users/bashalex/repos", "events_url": "https://api.github.com/users/bashalex/events{/privacy}", "received_events_url": "https://api.github.com/users/bashalex/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-10-13T15:49:03Z", "updated_at": "2020-10-21T09:03:15Z", "closed_at": "2020-10-21T09:03:15Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nAfter the update to 3.6.3, this error gets constantly raised when a python app with the `aiohttp` dependency is deployed to a Kubernetes cluster. No such exception was noticed with 3.6.2 and the same environment.\r\n\r\nI believe it has something to do with telemetry that Kubernetes tries to collect. From the log itself it's pretty much impossible to determine what exact requests cause this behavior.\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n```\r\n13.10.2020[15:41:48] [6    ] aiohttp.server           ERROR Error handling request\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.8/site-packages/aiohttp/web_protocol.py\", line 275, in data_received\r\n    messages, upgraded, tail = self._request_parser.feed_data(data)\r\n  File \"aiohttp/_http_parser.pyx\", line 523, in aiohttp._http_parser.HttpParser.feed_data\r\naiohttp.http_exceptions.BadStatusLine: invalid HTTP method\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n3.8.6\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\n3.6.3\r\n```\r\n```console\r\n$ python -m pip show multidict\r\n4.7.6\r\n```\r\n```console\r\n$ python -m pip show yarl\r\n1.5.1\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\nP.S. Is there any available changelog between v3.6.3 and v3.6.2?\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5011/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5011/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5000", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5000/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5000/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5000/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/5000", "id": 717903028, "node_id": "MDU6SXNzdWU3MTc5MDMwMjg=", "number": 5000, "title": "Server could not parse post nested dict data", "user": {"login": "tiantian1645", "id": 26370840, "node_id": "MDQ6VXNlcjI2MzcwODQw", "avatar_url": "https://avatars.githubusercontent.com/u/26370840?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tiantian1645", "html_url": "https://github.com/tiantian1645", "followers_url": "https://api.github.com/users/tiantian1645/followers", "following_url": "https://api.github.com/users/tiantian1645/following{/other_user}", "gists_url": "https://api.github.com/users/tiantian1645/gists{/gist_id}", "starred_url": "https://api.github.com/users/tiantian1645/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tiantian1645/subscriptions", "organizations_url": "https://api.github.com/users/tiantian1645/orgs", "repos_url": "https://api.github.com/users/tiantian1645/repos", "events_url": "https://api.github.com/users/tiantian1645/events{/privacy}", "received_events_url": "https://api.github.com/users/tiantian1645/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-10-09T06:52:00Z", "updated_at": "2020-10-09T06:56:06Z", "closed_at": "2020-10-09T06:56:06Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nClient post a nested data like \r\n```python\r\ndata = dict(\r\n    torrent=[\r\n        dict(domain=\"AA\", t_id=1222, title=\"title 1\"),\r\n        dict(domain=\"AB\", t_id=23333, title=\"title 2\"),\r\n        dict(domain=\"AC\", t_id=35555, title=\"title 3\"),\r\n        dict(domain=\"AD\", t_id=488888),\r\n    ]\r\n)\r\n```\r\nBut in server site will get data like this\r\n```python\r\n<MultiDictProxy('torrent': \"{'domain': 'AA', 't_id': 1222, 'title': 'title 1'}\", 'torrent': \"{'domain': 'AB', 't_id': 23333, 'title': 'title 2'}\", 'torrent': \"{'domain': 'AC', 't_id': 35555, 'title': 'title 3'}\", 'torrent': \"{'domain': 'AD', 't_id': 488888}\")>\r\n\r\n# I must use this to parse data\r\ndata = await request.post()\r\nfor torrent_data in data.getall(\"torrent\"):\r\n    torrent_data = json.loads(torrent_data.replace(\"'\", '\"'))\r\n```\r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n```python\r\n\r\n# Server\r\nfrom aiohttp import web\r\nimport json\r\n\r\nroutes = web.RouteTableDef()\r\n\r\n\r\n@routes.post(\"/new_hash\")\r\nasync def new_hash(request):\r\n    data = await request.post()\r\n    for torrent_data in data.getall(\"torrent\"):\r\n        torrent_data = json.loads(torrent_data)\r\n    return web.json_response(dict(result=\"success))\r\n\r\napp = web.Application()\r\napp.add_routes(routes)\r\nweb.run_app(app, port=5000)\r\n\r\n# client\r\nimport httpx\r\n\r\ndata = dict(\r\n    torrent=[\r\n        dict(domain=\"AA\", t_id=1222, title=\"title 1\"),\r\n        dict(domain=\"AB\", t_id=23333, title=\"title 2\"),\r\n        dict(domain=\"AC\", t_id=35555, title=\"title 3\"),\r\n        dict(domain=\"AD\", t_id=488888),\r\n    ]\r\n)\r\n\r\nresp = httpx.post(\"http://127.0.0.1:5000/new_hash\", data=data)\r\nprint(resp.text)\r\n\r\n\r\n```\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\nSuccess Work\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\nERROR:aiohttp.server:Error handling request\r\nTraceback (most recent call last):\r\n  File \"C:\\Program Files\\Python37\\lib\\site-packages\\aiohttp\\web_protocol.py\", line 418, in start\r\n    resp = await task\r\n  File \"C:\\Program Files\\Python37\\lib\\site-packages\\aiohttp\\web_app.py\", line 458, in _handle\r\n    resp = await handler(request)\r\n  File \"info_hash_server.py\", line 44, in new_hash\r\n    torrent_data = json.loads(torrent_data)\r\n  File \"C:\\Program Files\\Python37\\lib\\json\\__init__.py\", line 348, in loads\r\n    return _default_decoder.decode(s)\r\n  File \"C:\\Program Files\\Python37\\lib\\json\\decoder.py\", line 337, in decode\r\n    obj, end = self.raw_decode(s, idx=_w(s, 0).end())\r\n  File \"C:\\Program Files\\Python37\\lib\\json\\decoder.py\", line 353, in raw_decode\r\n    obj, end = self.scan_once(s, idx)\r\njson.decoder.JSONDecodeError: Expecting property name enclosed in double quotes: line 1 column 2 (char 1)\r\n\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\nPython 3.7.5\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.6.2\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\program files\\python37\\lib\\site-packages\r\nRequires: attrs, multidict, yarl, chardet, async-timeout\r\nRequired-by:\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.6\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\program files\\python37\\lib\\site-packages\r\nRequires:\r\nRequired-by: yarl, aiohttp\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.0\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\program files\\python37\\lib\\site-packages\r\nRequires: typing-extensions, idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\nWindows 7 64\r\n\r\nWhen server get post data , event it could not parse nested data to dict, but '\"'  is better than \"'\".\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5000/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/5000/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4987", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4987/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4987/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4987/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4987", "id": 713872272, "node_id": "MDU6SXNzdWU3MTM4NzIyNzI=", "number": 4987, "title": "Patch update to older branches (2.0, 3.6, etc), to address yarl API-breaking minor update", "user": {"login": "besfahbod", "id": 45701775, "node_id": "MDQ6VXNlcjQ1NzAxNzc1", "avatar_url": "https://avatars.githubusercontent.com/u/45701775?v=4", "gravatar_id": "", "url": "https://api.github.com/users/besfahbod", "html_url": "https://github.com/besfahbod", "followers_url": "https://api.github.com/users/besfahbod/followers", "following_url": "https://api.github.com/users/besfahbod/following{/other_user}", "gists_url": "https://api.github.com/users/besfahbod/gists{/gist_id}", "starred_url": "https://api.github.com/users/besfahbod/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/besfahbod/subscriptions", "organizations_url": "https://api.github.com/users/besfahbod/orgs", "repos_url": "https://api.github.com/users/besfahbod/repos", "events_url": "https://api.github.com/users/besfahbod/events{/privacy}", "received_events_url": "https://api.github.com/users/besfahbod/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2020-10-02T20:04:32Z", "updated_at": "2020-10-16T16:17:38Z", "closed_at": "2020-10-16T16:17:38Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\n\r\nWith yarl 1.6.0 breaking relied-on behavior of `URL.build()` API, we now have a problem where `pip install aiohttp` would receive a broken package configuratoin: aiohttp 3.6.2 with yarl 1.6.0.\r\n\r\nTo address this issue, I think we need a Patch update to the 3.6 branch, like 3.6.3.\r\n\r\nRelated/Blocking issues are:\r\n- https://github.com/aio-libs/aiohttp/issues/4972\r\n- https://github.com/aio-libs/aiohttp/issues/4880", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4987/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4987/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4984", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4984/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4984/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4984/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4984", "id": 712294841, "node_id": "MDU6SXNzdWU3MTIyOTQ4NDE=", "number": 4984, "title": "Unix connect errors use host/port which is not useful", "user": {"login": "zealws", "id": 794008, "node_id": "MDQ6VXNlcjc5NDAwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/794008?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zealws", "html_url": "https://github.com/zealws", "followers_url": "https://api.github.com/users/zealws/followers", "following_url": "https://api.github.com/users/zealws/following{/other_user}", "gists_url": "https://api.github.com/users/zealws/gists{/gist_id}", "starred_url": "https://api.github.com/users/zealws/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zealws/subscriptions", "organizations_url": "https://api.github.com/users/zealws/orgs", "repos_url": "https://api.github.com/users/zealws/repos", "events_url": "https://api.github.com/users/zealws/events{/privacy}", "received_events_url": "https://api.github.com/users/zealws/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1363888951, "node_id": "MDU6TGFiZWwxMzYzODg4OTUx", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/pr-available", "name": "pr-available", "color": "363396", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-09-30T21:31:33Z", "updated_at": "2021-01-11T08:45:57Z", "closed_at": "2021-01-11T08:45:57Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nA ConnectionRefusedError using UnixConnector results in an error message such as this:\r\n\r\n```\r\naiohttp.client_exceptions.ClientConnectorError: Cannot connect to host host:80 ssl:default [Connection refused]\r\n```\r\n\r\nThe error message specifies the host/port of the connection. However, for Unix sockets, the host/port are not useful. They're still provided as part of the HTTP request, but they do not define the connection from client to server.\r\n\r\nFor unix sockets, ideally the error message would include the socket path on disk instead.\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n\r\nRun this code:\r\nNote: don't create `/tmp/server.sock` to get a Connection Refused.\r\n```\r\nimport aiohttp\r\nimport asyncio\r\n\r\n\r\nasync def main():\r\n    async with aiohttp.ClientSession(\r\n        connector=aiohttp.UnixConnector(path='/tmp/server.sock'),\r\n    ) as session:\r\n        r = await session.get('http://host/')\r\n        print(\"Status:\", r.status)\r\n        print(\"Text:\")\r\n        print((await r.text()).strip())\r\n\r\n\r\nasyncio.get_event_loop().run_until_complete(main())\r\n```\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n\r\nIdeally, the exception would include the socket path on disk, which (for Unix sockets) is the primary way of identifying the connection, not host/port.\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n\r\nOutput of the sample script I pasted above:\r\n\r\n```python-traceback\r\nTraceback (most recent call last):\r\n  File \"/home/zeal/dev/aiohttp/venv/lib/python3.8/site-packages/aiohttp-4.0.0a1-py3.8-linux-x86_64.egg/aiohttp/connector.py\", line 1112, in _create_connection\r\n    _, proto = await self._loop.create_unix_connection(\r\n  File \"/usr/lib/python3.8/asyncio/unix_events.py\", line 244, in create_unix_connection\r\n    await self.sock_connect(sock, path)\r\n  File \"/usr/lib/python3.8/asyncio/selector_events.py\", line 494, in sock_connect\r\n    return await fut\r\n  File \"/usr/lib/python3.8/asyncio/selector_events.py\", line 499, in _sock_connect\r\n    sock.connect(address)\r\nConnectionRefusedError: [Errno 111] Connection refused\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"client.py\", line 15, in <module>\r\n    asyncio.get_event_loop().run_until_complete(main())\r\n  File \"/usr/lib/python3.8/asyncio/base_events.py\", line 616, in run_until_complete\r\n    return future.result()\r\n  File \"client.py\", line 9, in main\r\n    r = await session.get('http://host/')\r\n  File \"/home/zeal/dev/aiohttp/venv/lib/python3.8/site-packages/aiohttp-4.0.0a1-py3.8-linux-x86_64.egg/aiohttp/client.py\", line 446, in _request\r\n    conn = await self._connector.connect(\r\n  File \"/home/zeal/dev/aiohttp/venv/lib/python3.8/site-packages/aiohttp-4.0.0a1-py3.8-linux-x86_64.egg/aiohttp/connector.py\", line 506, in connect\r\n    proto = await self._create_connection(req, traces, timeout)\r\n  File \"/home/zeal/dev/aiohttp/venv/lib/python3.8/site-packages/aiohttp-4.0.0a1-py3.8-linux-x86_64.egg/aiohttp/connector.py\", line 1115, in _create_connection\r\n    raise ClientConnectorError(req.connection_key, exc) from exc\r\naiohttp.client_exceptions.ClientConnectorError: Cannot connect to host host:80 ssl:default [Connection refused]\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n\r\n```console\r\n$ python --version\r\nPython 3.8.5\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n\r\nInstalled from source at commit 90acab1c42eed1984bdd4201bd082c5983213ffc, so the versions below are not correct, but attaching them anyway.\r\n\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 4.0.0a1\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/zeal/dev/aiohttp\r\nRequires: attrs, chardet, multidict, async-timeout, yarl, typing-extensions\r\nRequired-by: \r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.6\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/zeal/dev/aiohttp/venv/lib/python3.8/site-packages/multidict-4.7.6-py3.8-linux-x86_64.egg\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.4.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/zeal/dev/aiohttp/venv/lib/python3.8/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n\r\nNone\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4984/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4984/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4981", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4981/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4981/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4981/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4981", "id": 711431563, "node_id": "MDU6SXNzdWU3MTE0MzE1NjM=", "number": 4981, "title": "Query parameters remain encoded since yarl==1.6.0", "user": {"login": "deansg", "id": 10351933, "node_id": "MDQ6VXNlcjEwMzUxOTMz", "avatar_url": "https://avatars.githubusercontent.com/u/10351933?v=4", "gravatar_id": "", "url": "https://api.github.com/users/deansg", "html_url": "https://github.com/deansg", "followers_url": "https://api.github.com/users/deansg/followers", "following_url": "https://api.github.com/users/deansg/following{/other_user}", "gists_url": "https://api.github.com/users/deansg/gists{/gist_id}", "starred_url": "https://api.github.com/users/deansg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/deansg/subscriptions", "organizations_url": "https://api.github.com/users/deansg/orgs", "repos_url": "https://api.github.com/users/deansg/repos", "events_url": "https://api.github.com/users/deansg/events{/privacy}", "received_events_url": "https://api.github.com/users/deansg/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-09-29T20:32:40Z", "updated_at": "2020-09-30T05:45:22Z", "closed_at": "2020-09-30T05:45:22Z", "author_association": "NONE", "active_lock_reason": null, "body": "I apologize in advance if this is not a bug, or alternatively, a bug which isn't in aiohttp. I'm reporting it here since I'm not familiar with the aiohttp code and I experienced this unexpected change in behaviour by using aiohttp.\r\n\r\n\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nThe query parameters from a Request object now appear in their url encoded form rather than the previously decoded form. \r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior? -->\r\n1. Install aiohttp with yarl version 1.6.0 (came out in September 23)\r\n2. Write a simple http service with a controller\r\n3. Send a request with query parameters which include characters that get encoded in urls (such as spaces)\r\n4. Attempt to retrieve the query parameter objects and see that they are in an encoded form\r\n\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\nThe query parameters should be decoded, as before.\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\n...\r\n```\r\n3.7.9\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\n...\r\n```\r\n```console\r\n$ python -m pip show multidict\r\n...\r\n```\r\n```console\r\n$ python -m pip show yarl\r\n...\r\n```\r\nyarl==1.6.0\r\naiohttp==3.6.2\r\nmultidict==4.7.4 ", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4981/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4981/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4972", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4972/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4972/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4972/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4972", "id": 708592891, "node_id": "MDU6SXNzdWU3MDg1OTI4OTE=", "number": 4972, "title": "inconsistent query arg handling between python and C http request parsers with yarl 1.6.0", "user": {"login": "mwhudson", "id": 672022, "node_id": "MDQ6VXNlcjY3MjAyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/672022?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mwhudson", "html_url": "https://github.com/mwhudson", "followers_url": "https://api.github.com/users/mwhudson/followers", "following_url": "https://api.github.com/users/mwhudson/following{/other_user}", "gists_url": "https://api.github.com/users/mwhudson/gists{/gist_id}", "starred_url": "https://api.github.com/users/mwhudson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mwhudson/subscriptions", "organizations_url": "https://api.github.com/users/mwhudson/orgs", "repos_url": "https://api.github.com/users/mwhudson/repos", "events_url": "https://api.github.com/users/mwhudson/events{/privacy}", "received_events_url": "https://api.github.com/users/mwhudson/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1363888951, "node_id": "MDU6TGFiZWwxMzYzODg4OTUx", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/pr-available", "name": "pr-available", "color": "363396", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-09-25T02:30:27Z", "updated_at": "2020-10-21T06:14:54Z", "closed_at": "2020-10-21T06:14:54Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n\r\nIf you upgrade to yarl 1.6.0 and are using the C HttpRequestParser class, your query arguments are not dequoted (by which I mean, request.query['foo'] is something like `%7B%22val%22: 3%7D` and not `{\"val\": 3}`). If you use the Python HttpRequestParser class, yarl 1.6.0 does not change the behaviour.\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n\r\n```\r\n>>> from aiohttp import http_parser\r\n>>> p = http_parser.HttpRequestParserC(1, None); p.feed_data(b'GET /test?b=%22val%22 HTTP/1.1\\r\\n\\r\\n')[0][0][0].url.query['b']\r\n'%22val%22'\r\n>>> p = http_parser.HttpRequestParserPy(1, None); p.feed_data(b'GET /test?b=%22val%22 HTTP/1.1\\r\\n\\r\\n')[0][0][0].url.query['b']\r\n'\"val\"'\r\n```\r\n\r\n(with yarl 1.5.1 both return \"val\").\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n\r\n3.6 and 3.8 at least -- don't think it matters\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.6.2\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/local/lib/python3.6/dist-packages\r\nRequires: attrs, async-timeout, yarl, multidict, chardet, typing-extensions, idna-ssl\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.6\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/local/lib/python3.6/dist-packages\r\nRequires: \r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.6.0\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/local/lib/python3.6/dist-packages\r\nRequires: idna, multidict, typing-extensions\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n\r\nThe reason for the inconsistency is that the Python parser calls URL(path) whereas the C parser calls URL.build(path=path) and the latter appears to have changed behaviour in 1.6.0.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4972/reactions", "total_count": 7, "+1": 7, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4972/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4958", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4958/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4958/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4958/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4958", "id": 698973391, "node_id": "MDU6SXNzdWU2OTg5NzMzOTE=", "number": 4958, "title": "Raising a ConnectionError inside a request handler causes client disconnection", "user": {"login": "pgkos", "id": 11692818, "node_id": "MDQ6VXNlcjExNjkyODE4", "avatar_url": "https://avatars.githubusercontent.com/u/11692818?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pgkos", "html_url": "https://github.com/pgkos", "followers_url": "https://api.github.com/users/pgkos/followers", "following_url": "https://api.github.com/users/pgkos/following{/other_user}", "gists_url": "https://api.github.com/users/pgkos/gists{/gist_id}", "starred_url": "https://api.github.com/users/pgkos/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pgkos/subscriptions", "organizations_url": "https://api.github.com/users/pgkos/orgs", "repos_url": "https://api.github.com/users/pgkos/repos", "events_url": "https://api.github.com/users/pgkos/events{/privacy}", "received_events_url": "https://api.github.com/users/pgkos/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-09-11T07:47:17Z", "updated_at": "2020-11-23T10:26:44Z", "closed_at": "2020-11-23T10:26:44Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nRaising a ConnectionError inside a request handler causes client disconnection. No errors are logged.\r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n```python\r\nimport logging\r\n\r\nfrom aiohttp import web\r\n\r\n\r\nroutes = web.RouteTableDef()\r\n\r\n@routes.get('/')\r\nasync def foo(request):\r\n    raise ConnectionError()\r\n\r\napp = web.Application()\r\napp.add_routes(routes)\r\n\r\nlogging.basicConfig(level=logging.DEBUG)\r\n\r\nweb.run_app(app)\r\n```\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\nThe server should respond with a 500 Internal Server Error.\r\n\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.8.5\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.6.2\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.6\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.5.1\r\n```", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4958/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4958/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4957", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4957/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4957/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4957/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4957", "id": 698572937, "node_id": "MDU6SXNzdWU2OTg1NzI5Mzc=", "number": 4957, "title": "run_app has incorrect typing", "user": {"login": "iawells", "id": 1719713, "node_id": "MDQ6VXNlcjE3MTk3MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1719713?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iawells", "html_url": "https://github.com/iawells", "followers_url": "https://api.github.com/users/iawells/followers", "following_url": "https://api.github.com/users/iawells/following{/other_user}", "gists_url": "https://api.github.com/users/iawells/gists{/gist_id}", "starred_url": "https://api.github.com/users/iawells/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iawells/subscriptions", "organizations_url": "https://api.github.com/users/iawells/orgs", "repos_url": "https://api.github.com/users/iawells/repos", "events_url": "https://api.github.com/users/iawells/events{/privacy}", "received_events_url": "https://api.github.com/users/iawells/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 303800438, "node_id": "MDU6TGFiZWwzMDM4MDA0Mzg=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/need%20pull%20request", "name": "need pull request", "color": "bfdadc", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-09-10T22:38:49Z", "updated_at": "2020-10-24T19:06:31Z", "closed_at": "2020-10-24T19:06:31Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\n\r\n```python\r\nasync def _run_app(app: Union[Application, Awaitable[Application]], *,\r\n                   host: Optional[str]=None,\r\n```\r\nThe documentation is a bit woolly:\r\n\r\n> \"host (str) \u2013 TCP/IP host or a sequence of hosts for HTTP server. Default is '0.0.0.0' if port has been specified or if path is not supplied.\"\r\n\r\n('(str)' excludes 'None' and excludes 'a sequence of hosts'.  Also, I don't think you mean 'sequence' literally.)\r\n\r\nBut it's clear from reading the code that an iterable of strings is planned for (along with several other types).\r\n\r\nI would think you want Optional[Union[str, Iterable[str]]] - though given the following code it's maybe unclear if you think other types are also acceptable.\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\n\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\nWrite some code like this and then run it though mypy\r\n\r\n```python\r\nfrom aiohttp.web import run_app\r\n\r\nhosts: List[str] = ['a', 'b']\r\n\r\nrun_app(host=hosts)\r\n```\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\nIf a list of strings is acceptable, then the attribute is wrong.  I'm surprised mypy didn't spot it during CI, actually.\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.6.9\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.6.2\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.6\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.5.1\r\n```", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4957/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4957/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4945", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4945/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4945/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4945/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4945", "id": 691310488, "node_id": "MDU6SXNzdWU2OTEzMTA0ODg=", "number": 4945, "title": "`GET` within a task raises SSL Error with TestClient/Server within docker", "user": {"login": "EricHorvat", "id": 6731707, "node_id": "MDQ6VXNlcjY3MzE3MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/6731707?v=4", "gravatar_id": "", "url": "https://api.github.com/users/EricHorvat", "html_url": "https://github.com/EricHorvat", "followers_url": "https://api.github.com/users/EricHorvat/followers", "following_url": "https://api.github.com/users/EricHorvat/following{/other_user}", "gists_url": "https://api.github.com/users/EricHorvat/gists{/gist_id}", "starred_url": "https://api.github.com/users/EricHorvat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/EricHorvat/subscriptions", "organizations_url": "https://api.github.com/users/EricHorvat/orgs", "repos_url": "https://api.github.com/users/EricHorvat/repos", "events_url": "https://api.github.com/users/EricHorvat/events{/privacy}", "received_events_url": "https://api.github.com/users/EricHorvat/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-09-02T18:35:42Z", "updated_at": "2020-11-23T17:02:48Z", "closed_at": "2020-11-23T17:02:48Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nRunning a GET request to a TestServer with TestClient with SSL activated within docker fails. Without the task, works normally and the tests pass.\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\n\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\n\r\n1. Wrap a session's get of `/` within a task, with a SSL configuration\r\n2. Write a test for that code, which sets the same SSL self-signed certificates (for SSL testing), these certs should be used in the code too. \r\n3. You should use TestServer/TestClient, and pass the TestClient instance's session to the tested code. Be aware to add a handler for `/` in the TestServer\r\n4. Run the tests within docker.\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\nThe test should pass, both in local enviroment as in docker enviroment.\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\nERROR    asyncio:base_events.py:1619 Exception in callback BaseSelectorEventLoop._sock_connect_done(11)(<Future finis... descriptor')>)\r\nhandle: <Handle BaseSelectorEventLoop._sock_connect_done(11)(<Future finis... descriptor')>)>\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.7/asyncio/events.py\", line 88, in _run\r\n    self._context.run(self._callback, *self._args)\r\n  File \"/usr/local/lib/python3.7/asyncio/selector_events.py\", line 493, in _sock_connect_done\r\n    self.remove_writer(fd)\r\n  File \"/usr/local/lib/python3.7/asyncio/selector_events.py\", line 343, in remove_writer\r\n    self._ensure_fd_no_transport(fd)\r\n  File \"/usr/local/lib/python3.7/asyncio/selector_events.py\", line 249, in _ensure_fd_no_transport\r\n    f'File descriptor {fd!r} is used by transport '\r\nRuntimeError: File descriptor 11 is used by transport <_SelectorSocketTransport fd=11 read=idle write=<polling, bufsize=0>>\r\nERROR    asyncio:base_events.py:1619 Exception in callback _SelectorTransport._add_reader(11, <bound method..., bufsize=0>>>)\r\nhandle: <Handle _SelectorTransport._add_reader(11, <bound method..., bufsize=0>>>)>\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.7/asyncio/events.py\", line 88, in _run\r\n    self._context.run(self._callback, *self._args)\r\n  File \"/usr/local/lib/python3.7/asyncio/selector_events.py\", line 718, in _add_reader\r\n    self._loop._add_reader(fd, callback, *args)\r\n  File \"/usr/local/lib/python3.7/asyncio/selector_events.py\", line 263, in _add_reader\r\n    (handle, writer))\r\n  File \"/usr/local/lib/python3.7/selectors.py\", line 389, in modify\r\n    self._selector.modify(key.fd, selector_events)\r\nFileNotFoundError: [Errno 2] No such file or directory\r\nException ignored in: <function _SSLProtocolTransport.__del__ at 0x7f5a22913dd0>\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.7/asyncio/sslproto.py\", line 323, in __del__\r\n    self.close()\r\n  File \"/usr/local/lib/python3.7/asyncio/sslproto.py\", line 317, in close\r\n    self._ssl_protocol._start_shutdown()\r\n  File \"/usr/local/lib/python3.7/asyncio/sslproto.py\", line 588, in _start_shutdown\r\n    self._abort()\r\n  File \"/usr/local/lib/python3.7/asyncio/sslproto.py\", line 725, in _abort\r\n    self._transport.abort()\r\n  File \"/usr/local/lib/python3.7/asyncio/selector_events.py\", line 643, in abort\r\n    self._force_close(None)\r\n  File \"/usr/local/lib/python3.7/asyncio/selector_events.py\", line 695, in _force_close\r\n    self._loop.call_soon(self._call_connection_lost, exc)\r\n  File \"/usr/local/lib/python3.7/asyncio/base_events.py\", line 691, in call_soon\r\n    self._check_closed()\r\n  File \"/usr/local/lib/python3.7/asyncio/base_events.py\", line 479, in _check_closed\r\n    raise RuntimeError('Event loop is closed')\r\nRuntimeError: Event loop is closed\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.7.9\r\n```\r\n```console\r\npython --version\r\nPython 3.8.5\r\n```\r\n```console\r\npython --version\r\nPython 3.9.0rc1\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\nThe same package version for each python version\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.6.2\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /builds/faradaysec/cloud/faraday_agent_dispatcher/faraday_venv/lib/python3.7/site-packages\r\nRequires: yarl, multidict, chardet, attrs, async-timeout\r\nRequired-by: faraday-agent-dispatcher\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.6\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /builds/faradaysec/cloud/faraday_agent_dispatcher/faraday_venv/lib/python3.7/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.5.1\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /builds/faradaysec/cloud/faraday_agent_dispatcher/faraday_venv/lib/python3.7/site-packages\r\nRequires: idna, typing-extensions, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\n1. Clone https://github.com/infobyte/faraday_agent_dispatcher.git\r\n2. Run `git checkout feature_improve_signal_and_disconnection`\r\n3. Run `pip install .[test]`\r\n4. Run `pytest tests/unitests/` within a GitlabCI instance\r\n\r\nYou can see over [our public repo](https://github.com/infobyte/faraday_agent_dispatcher/tree/feature_improve_signal_and_disconnection/), if you want, [our code](\r\nhttps://github.com/infobyte/faraday_agent_dispatcher/blob/feature_improve_signal_and_disconnection/faraday_agent_dispatcher/dispatcher.py#L529), this is the code working,; if you uncomment the task wrapping code, and comment the coroutine awaiting, the tests fails.\r\n\r\nSorry for not being available to share our private repo CI runs. However, I can bring the raw of the CI runs if you wants.\r\n\r\nThanks for the help in advance and for your work on the lib!\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4945/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4945/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4936", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4936/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4936/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4936/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4936", "id": 686616096, "node_id": "MDU6SXNzdWU2ODY2MTYwOTY=", "number": 4936, "title": "Race condition in BaseConnector leads to exceeding connection limit", "user": {"login": "PandaWill", "id": 7403300, "node_id": "MDQ6VXNlcjc0MDMzMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/7403300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/PandaWill", "html_url": "https://github.com/PandaWill", "followers_url": "https://api.github.com/users/PandaWill/followers", "following_url": "https://api.github.com/users/PandaWill/following{/other_user}", "gists_url": "https://api.github.com/users/PandaWill/gists{/gist_id}", "starred_url": "https://api.github.com/users/PandaWill/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/PandaWill/subscriptions", "organizations_url": "https://api.github.com/users/PandaWill/orgs", "repos_url": "https://api.github.com/users/PandaWill/repos", "events_url": "https://api.github.com/users/PandaWill/events{/privacy}", "received_events_url": "https://api.github.com/users/PandaWill/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-08-26T21:06:20Z", "updated_at": "2020-10-15T16:22:41Z", "closed_at": "2020-10-15T16:21:41Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nIt is possible for BaseConnector to exceed the limited number of connections. This is a result of a race condition/TOC-TOU bug on the available connections.\r\n\r\nThe bug arises from the following situation:\r\n```python\r\nbc = BaseConnector(limit=1)\r\n\r\ncon1 = bc.connect(...) # makes first connection\r\ncon2 = bc.connect(...) # joins waiters queue\r\ncon1.release( ) # releases connection\r\ncon3 = bc.connect(...) # takes available connection\r\n# con2 is resumed because of `set_result` call and creates second connection\r\n...\r\ncon2.release()\r\ncon3.release()\r\n```\r\nNote that the bug is only present if connection 3 is initiated before connection 2 resumes. The ordering of these two events is non-deterministic.\r\n\r\n**In Depth**\r\nWhen releasing a connection, `_release_waiter` will check that there is an available connection and call `set_result` to mark the future as done. This is assuming that this task will be resumed immediately but this isn't always the case: https://github.com/aio-libs/aiohttp/blob/3.7/aiohttp/connector.py#L588\r\n\r\nIf a coroutine is ran that calls `connect`, it will find there is an available connection and take it.\r\nThis will drop the key from `BaseConnect._conns` as it has taken the last connection: https://github.com/aio-libs/aiohttp/blob/3.7/aiohttp/connector.py#L569\r\n\r\nIf the future (triggered by `set_result`) now resumes, then `proto = self._get(key)` will be `None`, because the key was deleted above. Hence it will now create a new connection object.\r\nhttps://github.com/aio-libs/aiohttp/blob/3.7/aiohttp/connector.py#L512\r\n\r\nWe have now created a second connection when limit was set to 1.\r\n\r\n\ud83d\udca1 **To Reproduce**\r\nSee pull request containing failing unit test.\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\nLimit is observed appropriately\r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n3.8.2\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\nName: aiohttp\r\nVersion: 3.6.2\r\n\r\nName: multidict\r\nVersion: 4.7.6\r\n\r\nName: yarl\r\nVersion: 1.5.1\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4936/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4936/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4932", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4932/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4932/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4932/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4932", "id": 684898741, "node_id": "MDU6SXNzdWU2ODQ4OTg3NDE=", "number": 4932, "title": "How to properly store the aiohttp.ClientSession()", "user": {"login": "vgoklani", "id": 180487, "node_id": "MDQ6VXNlcjE4MDQ4Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/180487?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vgoklani", "html_url": "https://github.com/vgoklani", "followers_url": "https://api.github.com/users/vgoklani/followers", "following_url": "https://api.github.com/users/vgoklani/following{/other_user}", "gists_url": "https://api.github.com/users/vgoklani/gists{/gist_id}", "starred_url": "https://api.github.com/users/vgoklani/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vgoklani/subscriptions", "organizations_url": "https://api.github.com/users/vgoklani/orgs", "repos_url": "https://api.github.com/users/vgoklani/repos", "events_url": "https://api.github.com/users/vgoklani/events{/privacy}", "received_events_url": "https://api.github.com/users/vgoklani/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2020-08-24T19:08:34Z", "updated_at": "2022-03-16T05:35:49Z", "closed_at": "2020-10-16T16:09:55Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hey there,\r\n\r\nI need to store the ClientSession() object for easy-reuse: \r\n\r\n\r\n    class MySession(object):\r\n        def __init__(self):\r\n            self._session = asyncio.ClientSession() # ideally\r\n\r\n\r\nUnfortunately I'm unable to store the session object directly, even with an async call, as the ClientSession() object can't be awaited.\r\n\r\nHowever, I see that it's possible via the documentation, but I'm unable to replicate those snippets. Please see the links below:\r\n\r\n1. https://docs.aiohttp.org/en/stable/client_advanced.html#connectors\r\n\r\n    ```python\r\n    conn = aiohttp.TCPConnector()\r\n    session = aiohttp.ClientSession(connector=conn)\r\n\r\n     # DeprecationWarning: The object should be created from async function\r\n    ```\r\n\r\n2. https://docs.aiohttp.org/en/stable/client_reference.html#aiohttp.ClientSession\r\nsame issue, unable to replicate this line:\r\n\r\n    ```python\r\n    client_session = aiohttp.ClientSession(raise_for_status=True)\r\n\r\n     # DeprecationWarning: The object should be created from async function\r\n    ```\r\n\r\n---\r\n\r\nHere's my more general attempt:\r\n\r\n\r\n   ```python\r\n\timport asyncio\r\n\timport aiohttp\r\n\r\n\tloop = asyncio.get_event_loop()\r\n\r\n\r\n\tasync def get_session1():\r\n\t\tawait aiohttp.ClientSession()\r\n\r\n\r\n\tasync def get_session2(self):\r\n\t\treturn aiohttp.ClientSession()\r\n\r\n\r\n\t# Fails, DeprecationWarning: The object should be created from async function\r\n\tsession = aiohttp.ClientSession()\r\n\r\n\t# Fails, ClientSession can't be used in 'await' expression\r\n\tsession = loop.run_until_complete(get_session1())\r\n\r\n\t# Fails, An asyncio.Future, a coroutine or an awaitable is required\r\n\tsession = loop.run_until_complete(get_session2())\r\n\r\n    ```\r\n\r\n\r\nI'm using aiohttp.__version__ = 3.6.2 with Python 3.7.7 on Ubuntu.\r\n\r\nHow do I properly store the session object so it's easy to reuse, without re-creating a separate instance each time? Thanks!\r\n\r\nNote: This was also asked here: https://github.com/aio-libs/aiohttp/issues/3658\r\n\r\ncc: @asvetlov \r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4932/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4932/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4930", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4930/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4930/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4930/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4930", "id": 684042732, "node_id": "MDU6SXNzdWU2ODQwNDI3MzI=", "number": 4930, "title": "aiohttp.client_exceptions.ClientPayloadError: 400, message='Can not decode content-encoding: deflate'", "user": {"login": "bouwew", "id": 11290930, "node_id": "MDQ6VXNlcjExMjkwOTMw", "avatar_url": "https://avatars.githubusercontent.com/u/11290930?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bouwew", "html_url": "https://github.com/bouwew", "followers_url": "https://api.github.com/users/bouwew/followers", "following_url": "https://api.github.com/users/bouwew/following{/other_user}", "gists_url": "https://api.github.com/users/bouwew/gists{/gist_id}", "starred_url": "https://api.github.com/users/bouwew/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bouwew/subscriptions", "organizations_url": "https://api.github.com/users/bouwew/orgs", "repos_url": "https://api.github.com/users/bouwew/repos", "events_url": "https://api.github.com/users/bouwew/events{/privacy}", "received_events_url": "https://api.github.com/users/bouwew/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-08-22T18:31:47Z", "updated_at": "2020-12-09T12:17:03Z", "closed_at": "2020-12-09T12:17:03Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nThis error-message is reported by a Home Assistant user that tries to use the Plugwise-beta custom_component:\r\n```\r\n2020-08-21 23:20:18 ERROR (MainThread) [custom_components.plugwise.config_flow] Unexpected exception\r\nTraceback (most recent call last):\r\n  File \"/config/custom_components/plugwise/config_flow.py\", line 130, in async_step_user\r\n    api = await validate_input(self.hass, user_input)\r\n  File \"/config/custom_components/plugwise/config_flow.py\", line 74, in validate_input\r\n    await api.connect()\r\n  File \"/usr/local/lib/python3.8/site-packages/Plugwise_Smile/Smile.py\", line 161, in connect\r\n    result = await resp.text()\r\n  File \"/usr/local/lib/python3.8/site-packages/aiohttp/client_reqrep.py\", line 1009, in text\r\n    await self.read()\r\n  File \"/usr/local/lib/python3.8/site-packages/aiohttp/client_reqrep.py\", line 973, in read\r\n    self._body = await self.content.read()\r\n  File \"/usr/local/lib/python3.8/site-packages/aiohttp/streams.py\", line 358, in read\r\n    block = await self.readany()\r\n  File \"/usr/local/lib/python3.8/site-packages/aiohttp/streams.py\", line 380, in readany\r\n    await self._wait('readany')\r\n  File \"/usr/local/lib/python3.8/site-packages/aiohttp/streams.py\", line 296, in _wait\r\n    await waiter\r\naiohttp.client_exceptions.ClientPayloadError: 400, message='Can not decode content-encoding: deflate'\r\n```\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\n\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\nTry to add the Plugwise Stretch integration in Home Assistant Core v0.114.3 (with aiohttp v3.6.2):\r\n![image](https://user-images.githubusercontent.com/11290930/90962964-605a5380-e4b4-11ea-966b-193c22a78921.png)\r\nWhen trying to troubleshoot the 'Unexpected Error' he found the above error-message in the HA Core Logs.\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\nThe integration should be added successfully.\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\n\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n3.8.3\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\n3.6.2\r\n```\r\n```console\r\n$ python -m pip show multidict\r\n4.7.6\r\n```\r\n```console\r\n$ python -m pip show yarl\r\n1.4.2\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\nI've found this issue: https://github.com/aio-libs/aiohttp/issues/1918\r\nI'm not sure whether the problem I'm reporting is a duplicate? If yes, please let me know, thanks!\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\nThe Home Assistant Core Plugwise-beta custom_component, as a client, tries to connect to a web-server that is running on a local connected device, using an `aiohttp.ClientSession`. The setup of the connection fails with the error as shown above as the result.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4930/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4930/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4926", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4926/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4926/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4926/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4926", "id": 683855750, "node_id": "MDU6SXNzdWU2ODM4NTU3NTA=", "number": 4926, "title": "Stuck while retriving data from Twitter in Ubuntu 20.04", "user": {"login": "hadisfr", "id": 24562441, "node_id": "MDQ6VXNlcjI0NTYyNDQx", "avatar_url": "https://avatars.githubusercontent.com/u/24562441?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hadisfr", "html_url": "https://github.com/hadisfr", "followers_url": "https://api.github.com/users/hadisfr/followers", "following_url": "https://api.github.com/users/hadisfr/following{/other_user}", "gists_url": "https://api.github.com/users/hadisfr/gists{/gist_id}", "starred_url": "https://api.github.com/users/hadisfr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hadisfr/subscriptions", "organizations_url": "https://api.github.com/users/hadisfr/orgs", "repos_url": "https://api.github.com/users/hadisfr/repos", "events_url": "https://api.github.com/users/hadisfr/events{/privacy}", "received_events_url": "https://api.github.com/users/hadisfr/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-08-21T22:20:13Z", "updated_at": "2020-10-25T13:00:48Z", "closed_at": "2020-10-25T13:00:48Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nWhile trying to send request to some URLs such as Twitter, the library gives `TimeoutError`.\r\n\r\nThis is happening only in Ubuntu 20.04, and only with Twitter URLs (such as https://twitter.com/), while everything is OK with e.g. https://google.com/, or with Twitter in Ubuntu 18.04.\r\n\r\nThis **may** be related to https://github.com/aio-libs/aiohttp/issues/3676.\r\n\r\nAlso, `curl` works good for the aforementioned URL.\r\n\r\n\ud83d\udca1 **To Reproduce**\r\nRun the following code (_tw.py_) in the described environment:\r\n```python\r\n#!/usr/bin/env python3\r\n\r\nimport aiohttp\r\nimport asyncio\r\n\r\n\r\nasync def main():\r\n    async with aiohttp.ClientSession() as session:\r\n        async with session.get('https://twitter.com/') as resp:\r\n            print(await resp.text())\r\n\r\nif __name__ == '__main__':\r\n    loop = asyncio.get_event_loop()\r\n    loop.run_until_complete(main())\r\n    loop.close()\r\n```\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\nGets HTML of https://twitter.com/.\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\nTraceback (most recent call last):\r\n  File \"./tw.py\", line 14, in <module>\r\n    loop.run_until_complete(main())\r\n  File \"/usr/lib/python3.8/asyncio/base_events.py\", line 616, in run_until_complete\r\n    return future.result()\r\n  File \"./tw.py\", line 10, in main\r\n    print(await resp.text())\r\n  File \"***/.env/lib/python3.8/site-packages/aiohttp/client_reqrep.py\", line 1009, in text\r\n    await self.read()\r\n  File \"***/.env/lib/python3.8/site-packages/aiohttp/client_reqrep.py\", line 973, in read\r\n    self._body = await self.content.read()\r\n  File \"***/.env/lib/python3.8/site-packages/aiohttp/streams.py\", line 358, in read\r\n    block = await self.readany()\r\n  File \"***/.env/lib/python3.8/site-packages/aiohttp/streams.py\", line 380, in readany\r\n    await self._wait('readany')\r\n  File \"***/.env/lib/python3.8/site-packages/aiohttp/streams.py\", line 296, in _wait\r\n    await waiter\r\n  File \"***/.env/lib/python3.8/site-packages/aiohttp/helpers.py\", line 596, in __exit__\r\n    raise asyncio.TimeoutError from None\r\nasyncio.exceptions.TimeoutError\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.8.2\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.6.2\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: ***/.env/lib/python3.8/site-packages\r\nRequires: chardet, yarl, async-timeout, multidict, attrs\r\nRequired-by: twint, aiohttp-socks\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.5\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: ***/.env/lib/python3.8/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.4.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: ***/.env/lib/python3.8/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\n```console\r\n$ lsb_release -a\r\nNo LSB modules are available.\r\nDistributor ID:\tUbuntu\r\nDescription:\tUbuntu 20.04.1 LTS\r\nRelease:\t20.04\r\nCodename:\tfocal\r\n```\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4926/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4926/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4901", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4901/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4901/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4901/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4901", "id": 675120856, "node_id": "MDU6SXNzdWU2NzUxMjA4NTY=", "number": 4901, "title": "MUST NOT send Content-Length/Transfer-Encoding for 1xx or 204 ", "user": {"login": "damb", "id": 2012488, "node_id": "MDQ6VXNlcjIwMTI0ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/2012488?v=4", "gravatar_id": "", "url": "https://api.github.com/users/damb", "html_url": "https://github.com/damb", "followers_url": "https://api.github.com/users/damb/followers", "following_url": "https://api.github.com/users/damb/following{/other_user}", "gists_url": "https://api.github.com/users/damb/gists{/gist_id}", "starred_url": "https://api.github.com/users/damb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/damb/subscriptions", "organizations_url": "https://api.github.com/users/damb/orgs", "repos_url": "https://api.github.com/users/damb/repos", "events_url": "https://api.github.com/users/damb/events{/privacy}", "received_events_url": "https://api.github.com/users/damb/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1831256427, "node_id": "MDU6TGFiZWwxODMxMjU2NDI3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/reproducer:%20present", "name": "reproducer: present", "color": "c2e0c6", "default": false, "description": "This PR or issue contains code, which reproduce the problem described or clearly understandable STR"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-08-07T16:15:03Z", "updated_at": "2020-10-26T10:38:28Z", "closed_at": "2020-10-24T17:13:51Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n\r\nAccording to RFC7230 (https://tools.ietf.org/html/rfc7230#section-3.3.2 and https://tools.ietf.org/html/rfc7230#section-3.3.1) a server must not send neither the `Content-Length` nor the `Transfer-Encoding` header field for **1xx** and **204** responses.\r\n\r\nNote that in practice clients and proxies might get into trouble when receiving such a response. E.g. with a [nginx](http://nginx.org/) reverse proxy this behaviour leads to the following error: `upstream prematurely closed connection ...`\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n\r\nExemplary for `web.Response`:\r\n\r\n```python\r\nfrom aiohttp import web\r\n\r\nasync def reproduce(request):\r\n    return web.Response(status=204)\r\n\r\napp = web.Application()\r\napp.add_routes([web.get('/', reproduce)])\r\n\r\nweb.run_app(app, host='localhost', port=8080)\r\n```\r\n\r\n```console\r\n\r\n$ curl -v -o - \"http://localhost:8080/\"\r\n*   Trying 127.0.0.1:8080...\r\n* TCP_NODELAY set\r\n* Connected to localhost (127.0.0.1) port 8080 (#0)\r\n> GET / HTTP/1.1\r\n> Host: localhost:8080\r\n> User-Agent: curl/7.68.0\r\n> Accept: */*\r\n> \r\n* Mark bundle as not supporting multiuse\r\n< HTTP/1.1 204 No Content\r\n< Content-Length: 0\r\n< Content-Type: application/octet-stream\r\n< Date: Fri, 07 Aug 2020 16:16:33 GMT\r\n< Server: Python/3.8 aiohttp/4.0.0a1\r\n< \r\n* Connection #0 to host localhost left intact\r\n```\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n\r\nDo not ship the headers mentioned above.\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n\r\n```console\r\n$ python --version\r\nPython 3.8.2\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n\r\n```console\r\n pip freeze | grep aiohttp\r\n-e git+https://github.com/aio-libs/aiohttp.git@1d296d549050aa335ef542421b8b7dad788246d5#egg=aiohttp\r\n```\r\nThe `aiohttp` version should agree with the current `master`.\r\n\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.6\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/ubuntu/work/projects/aiohttp-reproducer/venv/lib/python3.8/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.4.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/ubuntu/work/projects/aiohttp-reproducer/venv/lib/python3.8/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4901/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4901/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4900", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4900/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4900/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4900/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4900", "id": 675114505, "node_id": "MDU6SXNzdWU2NzUxMTQ1MDU=", "number": 4900, "title": "Invalid exceptions handling or asyncio bug in Windows 10  [WinError 52] duplicate name in network", "user": {"login": "ChameleonRed", "id": 1080880, "node_id": "MDQ6VXNlcjEwODA4ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1080880?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ChameleonRed", "html_url": "https://github.com/ChameleonRed", "followers_url": "https://api.github.com/users/ChameleonRed/followers", "following_url": "https://api.github.com/users/ChameleonRed/following{/other_user}", "gists_url": "https://api.github.com/users/ChameleonRed/gists{/gist_id}", "starred_url": "https://api.github.com/users/ChameleonRed/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ChameleonRed/subscriptions", "organizations_url": "https://api.github.com/users/ChameleonRed/orgs", "repos_url": "https://api.github.com/users/ChameleonRed/repos", "events_url": "https://api.github.com/users/ChameleonRed/events{/privacy}", "received_events_url": "https://api.github.com/users/ChameleonRed/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-08-07T16:07:13Z", "updated_at": "2020-11-23T17:17:52Z", "closed_at": "2020-11-23T17:17:51Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nI wrote some program which setup 8-16 process with servers using aiohttp.web.Server all of then is sending heartbeats.\r\n\r\nMaybe problem is with too many open connections but with reported as duplicate name in network what is wrong.\r\n\r\naiohttp.client_exceptions.ClientConnectorError: Cannot connect to host 127.0.0.1:8002 ssl:default [Po\u0142\u0105czenie nie zosta\u0142o nawi\u0105zane, poniewa\u017c w sieci istnieje duplikat nazwy. Je\u015bli przy\u0142\u0105czasz si\u0119 do domeny, przejd\u017a do apletu System w Panelu sterowania, aby zmieni\u0107 nazw\u0119 komputera, i spr\u00f3buj ponownie. Je\u015bli przy\u0142\u0105czasz si\u0119 do grupy roboczej, wybierz inn\u0105 nazw\u0119 grupy]\r\n9744:peer_2:ERROR:__mp_main__:Send heartbeat ServerAddress(host='127.0.0.1', port=8009).:s01_distributed_farm:212\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\Cezary.Wagner\\PycharmProjects\\medptr2\\venv\\lib\\site-packages\\aiohttp\\connector.py\", line 936, in _wrap_create_connection\r\n    return await self._loop.create_connection(*args, **kwargs)  # type: ignore  # noqa\r\n  File \"C:\\root\\Python38\\lib\\asyncio\\base_events.py\", line 1025, in create_connection\r\n    raise exceptions[0]\r\n  File \"C:\\root\\Python38\\lib\\asyncio\\base_events.py\", line 1010, in create_connection\r\n    sock = await self._connect_sock(\r\n  File \"C:\\root\\Python38\\lib\\asyncio\\base_events.py\", line 924, in _connect_sock\r\n    await self.sock_connect(sock, address)\r\n  File \"C:\\root\\Python38\\lib\\asyncio\\proactor_events.py\", line 702, in sock_connect\r\n    return await self._proactor.connect(sock, address)\r\n  File \"C:\\root\\Python38\\lib\\asyncio\\windows_events.py\", line 808, in _poll\r\n    value = callback(transferred, key, ov)\r\n  File \"C:\\root\\Python38\\lib\\asyncio\\windows_events.py\", line 595, in finish_connect\r\n    ov.getresult()\r\nOSError: [WinError 52] Po\u0142\u0105czenie nie zosta\u0142o nawi\u0105zane, poniewa\u017c w sieci istnieje duplikat nazwy. Je\u015bli przy\u0142\u0105czasz si\u0119 do domeny, przejd\u017a do apletu System w Panelu sterowania, aby zmieni\u0107 nazw\u0119 komputera, i spr\u00f3buj ponownie. Je\u015bli przy\u0142\u0105czasz si\u0119 do grupy roboczej, wybierz inn\u0105 nazw\u0119 grupy\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\Cezary.Wagner\\PycharmProjects\\medptr2\\sandbox\\distributed\\s01_distributed_farm.py\", line 196, in send_heartbeat\r\n    async with session.get(f'http://{server_address.host}:{server_address.port}/heartbeat',\r\n  File \"C:\\Users\\Cezary.Wagner\\PycharmProjects\\medptr2\\venv\\lib\\site-packages\\aiohttp\\client.py\", line 1012, in __aenter__\r\n    self._resp = await self._coro\r\n  File \"C:\\Users\\Cezary.Wagner\\PycharmProjects\\medptr2\\venv\\lib\\site-packages\\aiohttp\\client.py\", line 480, in _request\r\n    conn = await self._connector.connect(\r\n  File \"C:\\Users\\Cezary.Wagner\\PycharmProjects\\medptr2\\venv\\lib\\site-packages\\aiohttp\\connector.py\", line 523, in connect\r\n    proto = await self._create_connection(req, traces, timeout)\r\n  File \"C:\\Users\\Cezary.Wagner\\PycharmProjects\\medptr2\\venv\\lib\\site-packages\\aiohttp\\connector.py\", line 858, in _create_connection\r\n    _, proto = await self._create_direct_connection(\r\n  File \"C:\\Users\\Cezary.Wagner\\PycharmProjects\\medptr2\\venv\\lib\\site-packages\\aiohttp\\connector.py\", line 1004, in _create_direct_connection\r\n    raise last_exc\r\n  File \"C:\\Users\\Cezary.Wagner\\PycharmProjects\\medptr2\\venv\\lib\\site-packages\\aiohttp\\connector.py\", line 980, in _create_direct_connection\r\n    transp, proto = await self._wrap_create_connection(\r\n  File \"C:\\Users\\Cezary.Wagner\\PycharmProjects\\medptr2\\venv\\lib\\site-packages\\aiohttp\\connector.py\", line 943, in _wrap_create_connection\r\n    raise client_error(req.connection_key, exc) from exc\r\naiohttp.client_exceptions.ClientConnectorError: Cannot connect to host 127.0.0.1:8009 ssl:default [Po\u0142\u0105czenie nie zosta\u0142o nawi\u0105zane, poniewa\u017c w sieci istnieje duplikat nazwy. Je\u015bli przy\u0142\u0105czasz si\u0119 do domeny, przejd\u017a do apletu System w Panelu sterowania, aby zmieni\u0107 nazw\u0119 komputera, i spr\u00f3buj ponownie. Je\u015bli przy\u0142\u0105czasz si\u0119 do grupy roboczej, wybierz inn\u0105 nazw\u0119 grupy]\r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\n\r\n\r\n\r\nFor example:\r\n1. Have certain environment\r\nPython 3.8.5 64bit Windows 10 2004, Slow CPU 2 cores.\r\n2. Run given code snippet in a certain way\r\nJust run.\r\n3. See some behavior described\r\nWait little. Ignore connection timeout that is normal.\r\n\r\nAdd these steps below this comment: -->\r\nRun this:\r\n```\r\n\"\"\"\r\nSetup some distributed servers. Two of all are seed servers rest should be learned.\r\nIt uses multiprocessing to spawn servers.\r\n\"\"\"\r\n\r\nimport abc\r\nimport asyncio\r\nimport logging\r\nimport multiprocessing\r\nimport random\r\nfrom typing import Iterable, Set, List\r\n\r\nimport aiohttp.web\r\nimport aiohttp.client_exceptions\r\n\r\n_logger = logging.getLogger(__name__)\r\n\r\n\r\nclass ServerAddress:\r\n    def __init__(self, host, port):\r\n        self.host = host\r\n        self.port = port\r\n\r\n    def __lt__(self, other: 'ServerAddress'):\r\n        if type(self) is not type(other):\r\n            raise TypeError()\r\n        if self.host < other.host:\r\n            return True\r\n        if self.port < other.port:\r\n            return True\r\n        return False\r\n\r\n    def __eq__(self, other: 'ServerAddress') -> bool:\r\n        if type(self) is not type(other):\r\n            raise TypeError()\r\n        if self.host != other.host:\r\n            return False\r\n        if self.port != other.port:\r\n            return False\r\n        return True\r\n\r\n    def __hash__(self):\r\n        return hash(tuple(sorted(vars(self).items())))\r\n\r\n    def __repr__(self):\r\n        kwargs = ', '.join(f'{k}={v!r}' for k, v in vars(self).items())\r\n        return f'{self.__class__.__qualname__}(' + kwargs + ')'\r\n\r\n\r\nclass BaseSend(abc.ABC):\r\n    def __init__(self, target_server_address: ServerAddress):\r\n        self.server_address = target_server_address\r\n        self.retries = 0\r\n\r\n    def add_retry(self):\r\n        self.retries += 1\r\n\r\n\r\nclass SendHeartbeat(BaseSend):\r\n    def __init__(self, target_server_address: ServerAddress, from_server_address: ServerAddress):\r\n        super().__init__(target_server_address=target_server_address)\r\n\r\n        self.from_server_address = from_server_address\r\n\r\n    def __eq__(self, other: 'SendHeartbeat') -> bool:\r\n        if type(self) is not type(other):\r\n            raise TypeError()\r\n        if self.server_address != other.server_address:\r\n            return False\r\n        if self.from_server_address != other.from_server_address:\r\n            return False\r\n        return True\r\n\r\n    def __hash__(self):\r\n        return hash((\r\n            self.server_address,\r\n            self.from_server_address,\r\n        ))\r\n\r\n\r\nclass SendNewPeer(BaseSend):\r\n    def __init__(self, target_server_address: ServerAddress, new_server_address: ServerAddress):\r\n        super().__init__(target_server_address=target_server_address)\r\n\r\n        self.new_server_address = new_server_address\r\n\r\n    def __eq__(self, other: 'SendNewPeer') -> bool:\r\n        if type(self) is not type(other):\r\n            raise TypeError()\r\n        if self.server_address != other.server_address:\r\n            return False\r\n        if self.new_server_address != other.new_server_address:\r\n            return False\r\n        return True\r\n\r\n    def __hash__(self):\r\n        return hash((\r\n            self.server_address,\r\n            self.new_server_address,\r\n        ))\r\n\r\n\r\nclass DistributedServer:\r\n    HEARTBEAT_SLEEP_SECONDS = 1.0\r\n    HEARTBEAT_SLEEP_SECONDS_RANDOM = HEARTBEAT_SLEEP_SECONDS * 0.05\r\n    HEARTBEAT_CONNECTION_TIMEOUT = 0.010\r\n\r\n    NEW_PEER_CONNECTION_TIMEOUT = 0.010\r\n\r\n    CLIENT_CONNECTION_LIMIT = 50\r\n\r\n    def __init__(self, host: str, port: int, seed_server_addresses: Iterable[ServerAddress]):\r\n        self.server_address = ServerAddress(host=host, port=port)\r\n        self.seed_server_addresses: Set[ServerAddress] = set(seed_server_addresses)\r\n        self.active_peer_server_addresses: Set[ServerAddress] = set()\r\n        self.dead_peer_server_addresses: Set[ServerAddress] = set()\r\n\r\n        self.client_session_new_peer = aiohttp.ClientSession(conn_timeout=self.NEW_PEER_CONNECTION_TIMEOUT)\r\n        self.client_session_heartbeat = aiohttp.ClientSession(conn_timeout=self.HEARTBEAT_CONNECTION_TIMEOUT)\r\n\r\n        self.retries = set()\r\n\r\n        self.heartbeats_queue = asyncio.Queue()\r\n        self.heartbeats_send = 0\r\n        self.heartbeats_succeed = 0\r\n        self.heartbeats_failed = 0\r\n        self.heartbeats_timeout = 0\r\n\r\n        self.new_peer_queue = asyncio.Queue()\r\n\r\n        self.dead_peer_queue = asyncio.Queue()\r\n\r\n    def other_servers(self) -> Set[ServerAddress]:\r\n        server_addresses = set()\r\n        server_addresses.update(self.seed_server_addresses)\r\n        server_addresses.update(self.active_peer_server_addresses)\r\n        server_addresses.update(self.dead_peer_server_addresses)\r\n        server_addresses.discard(self.server_address)\r\n        return server_addresses\r\n\r\n    async def handle_new_peer(self, request: aiohttp.web.Request):\r\n        host = request.query.get('host')\r\n        port = request.query.get('port')\r\n        server_address = ServerAddress(host=host, port=int(port))\r\n        _logger.debug('Handle new peer %s.', server_address)\r\n        if server_address != self.server_address:\r\n            self.active_peer_server_addresses.add(server_address)\r\n\r\n        return aiohttp.web.Response()\r\n\r\n    async def send_new_peer(self, server_address: ServerAddress, new_server_address: ServerAddress):\r\n        try:\r\n            async with aiohttp.ClientSession(conn_timeout=self.NEW_PEER_CONNECTION_TIMEOUT) as session:\r\n                async with session.get(f'http://{server_address.host}:{server_address.port}/new_peer',\r\n                                       params={'host': new_server_address.host, 'port': new_server_address.port}) as response:\r\n                    _logger.debug('Send new peer %s %s.', server_address, new_server_address)\r\n                    if response.status != 200:\r\n                        self.dead_peer_server_addresses.add(server_address)\r\n                        self.active_peer_server_addresses.discard(server_address)\r\n                        _logger.error('Error %s write new peer %s %s.', response.status, server_address, new_server_address)\r\n                    else:\r\n                        self.dead_peer_server_addresses.discard(server_address)\r\n                        self.active_peer_server_addresses.add(server_address)\r\n                    await response.read()\r\n        except:\r\n            _logger.exception('Send new peer %s %s.', response.status, server_address, new_server_address)\r\n            self.retries.add(SendNewPeer(target_server_address=server_address, new_server_address=new_server_address))\r\n        else:\r\n            self.retries.discard(SendNewPeer(target_server_address=server_address, new_server_address=new_server_address))\r\n\r\n    async def handle_heartbeat(self, request: aiohttp.web.Request):\r\n        host = request.query.get('host')\r\n        port = request.query.get('port')\r\n        new_server_address = ServerAddress(host=host, port=int(port))\r\n\r\n        if new_server_address != self.server_address:\r\n            before_active_peer_servers = len(self.active_peer_server_addresses)\r\n            self.active_peer_server_addresses.add(new_server_address)\r\n            after_active_peer_servers = len(self.active_peer_server_addresses)\r\n\r\n            # new peer\r\n            if before_active_peer_servers != after_active_peer_servers:\r\n                for server_address in self.other_servers():\r\n                    await self.send_new_peer(server_address=server_address, new_server_address=new_server_address)\r\n        else:\r\n            retry = self.retries.pop()\r\n            if type(retry) is SendNewPeer:\r\n                await self.send_new_peer(server_address=retry.server_address,\r\n                                         new_server_address=retry.new_server_address)\r\n\r\n        return aiohttp.web.Response()\r\n\r\n    async def send_heartbeat(self, server_address: ServerAddress):\r\n        try:\r\n            async with aiohttp.ClientSession(conn_timeout=self.HEARTBEAT_CONNECTION_TIMEOUT) as session:\r\n                async with session.get(f'http://{server_address.host}:{server_address.port}/heartbeat',\r\n                                       params={'host': self.server_address.host, 'port': self.server_address.port}) as response:\r\n                    if response.status != 200:\r\n                        self.dead_peer_server_addresses.add(server_address)\r\n                        self.active_peer_server_addresses.discard(server_address)\r\n                        self.heartbeats_failed += 1\r\n                    else:\r\n                        self.dead_peer_server_addresses.discard(server_address)\r\n                        self.active_peer_server_addresses.add(server_address)\r\n                        self.heartbeats_succeed += 1\r\n                    await response.read()\r\n        except aiohttp.client_exceptions.ServerTimeoutError:\r\n            self.heartbeats_timeout += 1\r\n            self.heartbeats_failed += 1\r\n        except:\r\n            self.heartbeats_failed += 1\r\n            _logger.exception('Send heartbeat %s.', server_address)\r\n        finally:\r\n            self.heartbeats_send += 1\r\n\r\n    async def heartbeat_send_task(self):\r\n        try:\r\n            while True:\r\n                send_heartbeat: SendHeartbeat = await self.heartbeats_queue.get()\r\n                await self.send_heartbeat(server_address=send_heartbeat.server_address)\r\n                self.heartbeats_queue.task_done()\r\n        except asyncio.CancelledError:\r\n            pass\r\n\r\n    async def heart_task(self):\r\n        try:\r\n            while True:\r\n                if self.heartbeats_queue.empty():\r\n                    for server_address in self.other_servers():\r\n                        await self.heartbeats_queue.put(SendHeartbeat(\r\n                            target_server_address=server_address,\r\n                            from_server_address=self.server_address))\r\n                else:\r\n                    _logger.debug('Heartbeat queue is full.')\r\n                await asyncio.sleep(self.HEARTBEAT_SLEEP_SECONDS\r\n                                    + random.random() * self.HEARTBEAT_SLEEP_SECONDS_RANDOM)\r\n        except asyncio.CancelledError:\r\n            pass\r\n\r\n    async def start_heart(self, app: aiohttp.web.Application):\r\n        heart_task = asyncio.create_task(self.heart_task())\r\n        app['heart_task'] = heart_task\r\n        heartbeat_send_task = asyncio.create_task(self.heartbeat_send_task())\r\n        app['heartbeat_send_task'] = heartbeat_send_task\r\n\r\n    async def stop_heart(self, app: aiohttp.web.Application):\r\n        heart_task = app['heart_task']\r\n        heart_task.cancel()\r\n        heartbeat_send_task = app['heartbeat_send_task']\r\n        heartbeat_send_task.cancel()\r\n        await heart_task\r\n\r\n    async def handle_state(self, request: aiohttp.web.Request):\r\n        lines = [\r\n            f'{self.seed_server_addresses=}',\r\n            f'{self.active_peer_server_addresses=}',\r\n            f'{self.dead_peer_server_addresses=}',\r\n            f'{self.heartbeats_send=}',\r\n            f'{self.heartbeats_failed=}',\r\n            f'{self.heartbeats_succeed=}',\r\n        ]\r\n        return aiohttp.web.Response(body='\\n'.join(lines))\r\n\r\n    async def handle_main(self, request: aiohttp.web.Request):\r\n        body = f'''\\\r\n<html>\r\n    <head>\r\n        <title>Distributed Server</title>\r\n    </head>\r\n    <body>\r\n        <pre style=\"max-width: 120em; white-space: pre-wrap; margin: auto\">\r\n{len(self.seed_server_addresses)=} {sorted(self.seed_server_addresses)=}\r\n{len(self.active_peer_server_addresses)=} {sorted(self.active_peer_server_addresses)=}\r\n{len(self.dead_peer_server_addresses)=} {sorted(self.dead_peer_server_addresses)=}\r\n\r\n{self.heartbeats_send=}\r\n{self.heartbeats_failed=}\r\n{self.heartbeats_succeed=}\r\n{self.heartbeats_timeout=}\r\n        </pre>\r\n    </body>\r\n</html>\r\n'''\r\n        return aiohttp.web.Response(body=body, content_type='text/html')\r\n\r\n    def run(self, debug: bool):\r\n        logging.debug('run')\r\n        app = aiohttp.web.Application()\r\n        app.add_routes([\r\n            aiohttp.web.get('/', self.handle_main),\r\n            aiohttp.web.get('/state', self.handle_state),\r\n            aiohttp.web.get('/heartbeat', self.handle_heartbeat),\r\n            aiohttp.web.get('/new_peer', self.handle_new_peer),\r\n        ])\r\n        app.on_startup.append(self.start_heart)\r\n        app.on_cleanup.append(self.stop_heart)\r\n        asyncio.get_event_loop().set_debug(debug)\r\n        aiohttp.web.run_app(app=app, host=self.server_address.host, port=self.server_address.port,\r\n                            access_log=None)\r\n\r\n\r\ndef create_distributed_server_process(host: str, port: int, seed_server_addresses: Iterable[ServerAddress], debug: bool):\r\n    server = DistributedServer(host=host, port=port, seed_server_addresses=seed_server_addresses)\r\n    server.run(debug=debug)\r\n\r\n\r\nclass DistributedFarm:\r\n    def __init__(self, seed_server_addresses: Iterable[ServerAddress],\r\n                 worker_server_addresses: Iterable[ServerAddress]):\r\n        self.seed_peer_server_addresses = seed_server_addresses\r\n        self.peer_server_addresses = worker_server_addresses\r\n        self.processes: List[multiprocessing.Process] = []\r\n\r\n    def run(self, debug):\r\n        server_addresses = []\r\n        server_addresses.extend(self.seed_peer_server_addresses)\r\n        server_addresses.extend(self.peer_server_addresses)\r\n        for i, server_address in enumerate(server_addresses):\r\n            p = multiprocessing.Process(name=f'peer_{i}',\r\n                                        target=create_distributed_server_process,\r\n                                        kwargs={\r\n                                            'debug': debug,\r\n                                            'host': server_address.host,\r\n                                            'port': server_address.port,\r\n                                            'seed_server_addresses': self.seed_peer_server_addresses\r\n                                        })\r\n            p.start()\r\n            self.processes.append(p)\r\n\r\n    def stop(self):\r\n        for process in self.processes:\r\n            process.terminate()\r\n            process.join()\r\n\r\n\r\nasync def main():\r\n    server_addresses = [ServerAddress(host='127.0.0.1', port=x) for x in range(8000, 8016)]\r\n    seed_server_addresses = server_addresses[0:2]\r\n    worker_server_addresses = server_addresses[2:]\r\n    farm = DistributedFarm(seed_server_addresses=seed_server_addresses, worker_server_addresses=worker_server_addresses)\r\n    farm.run(debug=False)\r\n    try:\r\n        while True:\r\n            await asyncio.sleep(0.5)\r\n    except KeyboardInterrupt:\r\n        farm.stop()\r\n\r\n\r\nif __name__ == '__main__':\r\n    asyncio.run(main())\r\n\r\n\r\ndef mp_main():\r\n    logging.basicConfig(\r\n        level=logging.DEBUG,\r\n        format='%(process)s:%(processName)s:%(levelname)s:%(name)s:%(message)s:%(module)s:%(lineno)s'\r\n    )\r\n    pass\r\n\r\n\r\nif __name__ == '__mp_main__':\r\n    mp_main()\r\n```\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\n [WinError 52] duplicate name in network should not happen on closing connection.\r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\n\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\n3.8.5\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\n3.6.3\r\n```\r\n```console\r\n$ python -m pip show multidict\r\n4.7.6\r\n```\r\n```console\r\n$ python -m pip show yarl\r\n1.4.2\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\nboth", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4900/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4900/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4880", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4880/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4880/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4880/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4880", "id": 666386462, "node_id": "MDU6SXNzdWU2NjYzODY0NjI=", "number": 4880, "title": "Yarl >= 1.5.0 breaks aiohttp", "user": {"login": "kirknorthrop", "id": 1581341, "node_id": "MDQ6VXNlcjE1ODEzNDE=", "avatar_url": "https://avatars.githubusercontent.com/u/1581341?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kirknorthrop", "html_url": "https://github.com/kirknorthrop", "followers_url": "https://api.github.com/users/kirknorthrop/followers", "following_url": "https://api.github.com/users/kirknorthrop/following{/other_user}", "gists_url": "https://api.github.com/users/kirknorthrop/gists{/gist_id}", "starred_url": "https://api.github.com/users/kirknorthrop/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kirknorthrop/subscriptions", "organizations_url": "https://api.github.com/users/kirknorthrop/orgs", "repos_url": "https://api.github.com/users/kirknorthrop/repos", "events_url": "https://api.github.com/users/kirknorthrop/events{/privacy}", "received_events_url": "https://api.github.com/users/kirknorthrop/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1831255463, "node_id": "MDU6TGFiZWwxODMxMjU1NDYz", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/reproducer:%20missing", "name": "reproducer: missing", "color": "e23c36", "default": false, "description": "This PR or issue lacks code, which reproduce the problem described or clearly understandable STR"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2020-07-27T15:32:17Z", "updated_at": "2020-11-22T13:35:14Z", "closed_at": "2020-08-01T07:22:17Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nBreaking change in yarl 1.5.0 breaks aiohttp.\r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\nInstall aiohttp via pip, then `from aiohttp import web`\r\n\r\n\ud83d\udca1 **Expected behavior**\r\nIt should import `web`\r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\n File \"/usr/local/lib/python3.7/site-packages/myprojectnamehere/services/application/product_service.py\", line 3, in <module>\r\n    from aiohttp import web\r\n  File \"/usr/local/lib/python3.7/site-packages/aiohttp/__init__.py\", line 6, in <module>\r\n    from .client import BaseConnector as BaseConnector\r\n  File \"/usr/local/lib/python3.7/site-packages/aiohttp/client.py\", line 30, in <module>\r\n    from yarl import URL\r\n  File \"/usr/local/lib/python3.7/site-packages/yarl/__init__.py\", line 1, in <module>\r\n    from ._url import URL, cache_clear, cache_configure, cache_info\r\n  File \"/usr/local/lib/python3.7/site-packages/yarl/_url.py\", line 56, in <module>\r\n    @rewrite_module\r\n  File \"/usr/local/lib/python3.7/site-packages/yarl/_url.py\", line 132, in URL\r\n    _QUERY_PART_QUOTER = _Quoter(safe=\"?/:@\", qs=True, requote=False)\r\n  File \"yarl/_quoting.pyx\", line 192, in yarl._quoting._Quoter.__init__\r\nTypeError: __init__() got an unexpected keyword argument 'requote'\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\npython 3.7.4\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\naiohttp==3.6.2\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nmultidict==4.5.2\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nyarl==1.5.0\r\n```", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4880/reactions", "total_count": 3, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 1, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4880/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4876", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4876/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4876/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4876/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4876", "id": 665792794, "node_id": "MDU6SXNzdWU2NjU3OTI3OTQ=", "number": 4876, "title": "Aiohttp server randomly stops with winerror 64", "user": {"login": "dl250123", "id": 66424145, "node_id": "MDQ6VXNlcjY2NDI0MTQ1", "avatar_url": "https://avatars.githubusercontent.com/u/66424145?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dl250123", "html_url": "https://github.com/dl250123", "followers_url": "https://api.github.com/users/dl250123/followers", "following_url": "https://api.github.com/users/dl250123/following{/other_user}", "gists_url": "https://api.github.com/users/dl250123/gists{/gist_id}", "starred_url": "https://api.github.com/users/dl250123/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dl250123/subscriptions", "organizations_url": "https://api.github.com/users/dl250123/orgs", "repos_url": "https://api.github.com/users/dl250123/repos", "events_url": "https://api.github.com/users/dl250123/events{/privacy}", "received_events_url": "https://api.github.com/users/dl250123/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-07-26T14:31:48Z", "updated_at": "2022-06-21T18:49:39Z", "closed_at": "2020-10-16T16:13:22Z", "author_association": "NONE", "active_lock_reason": null, "body": "Aiohttp server randomly stops with a OSError: [WinError 64] The specified network name is no longer available\r\n\r\nsee https://stackoverflow.com/questions/61120572/aiohttp-server-critical-error-when-disconnecting-from-clients\r\n\r\nOS: Windows 10 - Python: 3.8.4 - aiohttp: 3.6.2\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4876/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4876/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4856", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4856/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4856/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4856/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4856", "id": 657603309, "node_id": "MDU6SXNzdWU2NTc2MDMzMDk=", "number": 4856, "title": "Server with default SSL context aborts all connections", "user": {"login": "gdmoore", "id": 586753, "node_id": "MDQ6VXNlcjU4Njc1Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/586753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gdmoore", "html_url": "https://github.com/gdmoore", "followers_url": "https://api.github.com/users/gdmoore/followers", "following_url": "https://api.github.com/users/gdmoore/following{/other_user}", "gists_url": "https://api.github.com/users/gdmoore/gists{/gist_id}", "starred_url": "https://api.github.com/users/gdmoore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gdmoore/subscriptions", "organizations_url": "https://api.github.com/users/gdmoore/orgs", "repos_url": "https://api.github.com/users/gdmoore/repos", "events_url": "https://api.github.com/users/gdmoore/events{/privacy}", "received_events_url": "https://api.github.com/users/gdmoore/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-07-15T19:39:32Z", "updated_at": "2020-07-15T19:45:01Z", "closed_at": "2020-07-15T19:45:01Z", "author_association": "NONE", "active_lock_reason": null, "body": "withdrawn", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4856/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 1, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4856/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4850", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4850/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4850/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4850/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4850", "id": 650901117, "node_id": "MDU6SXNzdWU2NTA5MDExMTc=", "number": 4850, "title": "Timeouts checked once a second (?)", "user": {"login": "haizaar", "id": 58201, "node_id": "MDQ6VXNlcjU4MjAx", "avatar_url": "https://avatars.githubusercontent.com/u/58201?v=4", "gravatar_id": "", "url": "https://api.github.com/users/haizaar", "html_url": "https://github.com/haizaar", "followers_url": "https://api.github.com/users/haizaar/followers", "following_url": "https://api.github.com/users/haizaar/following{/other_user}", "gists_url": "https://api.github.com/users/haizaar/gists{/gist_id}", "starred_url": "https://api.github.com/users/haizaar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/haizaar/subscriptions", "organizations_url": "https://api.github.com/users/haizaar/orgs", "repos_url": "https://api.github.com/users/haizaar/repos", "events_url": "https://api.github.com/users/haizaar/events{/privacy}", "received_events_url": "https://api.github.com/users/haizaar/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2020-07-04T14:32:33Z", "updated_at": "2020-10-20T15:06:40Z", "closed_at": "2020-10-20T15:06:40Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\n`aiohttp.ClientTimeout.total` is annotated to accept floats, yet my observations are that timeout condition is checked once a second. Is it a bug or feature?  E.g. requests library does not have this limitation and easily works with 0.01 timeouts in my tests. I realize that sub-second timeouts are quite synthetic, but very useful for tests.\r\n\r\n\ud83d\udca1 **To Reproduce**\r\naiohttp 3.6.2 on Ubuntu 18.04 amd64 with CPython 3.8.3.\r\n\r\nConsider the below code:\r\n```python\r\nimport asyncio\r\nimport socket\r\nimport sys\r\nimport time\r\n\r\nimport aiohttp\r\nfrom aiohttp import web\r\n\r\n\r\nasync def hello(request):\r\n    await asyncio.sleep(10)\r\n    return web.Response(text=\"Hello, world\")\r\n\r\n\r\nasync def run_client(port: int, timeout: float):\r\n    async with aiohttp.ClientSession() as session:\r\n        while True:\r\n            start = time.monotonic()\r\n            try:\r\n                await session.get(f\"http://localhost:{port}/\",\r\n                                  timeout=aiohttp.ClientTimeout(total=timeout))\r\n            except asyncio.TimeoutError:\r\n                pass\r\n            took = time.monotonic() - start\r\n            print(f\"expected={timeout}, took={took:.3f}, skew={took-timeout:.3f}\")\r\n\r\n\r\nasync def amain(timeout: float):\r\n    app = web.Application()\r\n    app.add_routes([web.get('/', hello)])\r\n    runner = web.AppRunner(app)\r\n    await runner.setup()\r\n\r\n    sock = socket.socket(socket.AF_INET, type=socket.SOCK_STREAM)\r\n    sock.bind((\"localhost\", 0))\r\n    _, port = sock.getsockname()\r\n\r\n    site = web.SockSite(runner=runner, sock=sock)\r\n    await site.start()\r\n\r\n    await run_client(port, timeout)\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    asyncio.run(amain(float(sys.argv[1])))\r\n\r\n```\r\nNo matter what the timeout value is, the actual timeout is always in multiples of 1 second as you can see in the `took` value below:\r\n```\r\n$ python /tmp/timeout-bug.py 0.1\r\nexpected=0.1, took=0.726, skew=0.626\r\nexpected=0.1, took=1.000, skew=0.900\r\nexpected=0.1, took=1.000, skew=0.900\r\npython /tmp/timeout-bug.py 0.8\r\nexpected=0.8, took=1.414, skew=0.614\r\nexpected=0.8, took=0.999, skew=0.199\r\nexpected=0.8, took=1.000, skew=0.200\r\nexpected=0.8, took=1.001, skew=0.201\r\npython /tmp/timeout-bug.py 1.1\r\nexpected=1.1, took=1.473, skew=0.373\r\nexpected=1.1, took=2.000, skew=0.900\r\nexpected=1.1, took=2.000, skew=0.900\r\nexpected=1.1, took=2.000, skew=0.900\r\npython /tmp/timeout-bug.py 2.1\r\nexpected=2.1, took=2.158, skew=0.058\r\nexpected=2.1, took=2.999, skew=0.899\r\nexpected=2.1, took=3.001, skew=0.901\r\nexpected=2.1, took=2.998, skew=0.898\r\n```\r\n\ud83d\udca1 **Expected behavior**\r\nIs this intentional or a bug?\r\n\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.8.3\r\n...\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.6.2\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/.../lib/python3.8/site-packages\r\nRequires: multidict, chardet, async-timeout, attrs, yarl\r\nRequired-by: \r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: aiohttp\r\nVersion: 3.6.2\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/.../lib/python3.8/site-packages\r\nRequires: multidict, chardet, async-timeout, attrs, yarl\r\nRequired-by: \r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.6\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/.../lib/python3.8/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.4.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/.../lib/python3.8/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4850/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4850/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4849", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4849/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4849/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4849/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4849", "id": 650760185, "node_id": "MDU6SXNzdWU2NTA3NjAxODU=", "number": 4849, "title": "tests/test_web_protocol.py::test_close[pyloop] fails in CI for Py38-Cython-Mac and Py38-Cython-Win", "user": {"login": "derlih", "id": 254158, "node_id": "MDQ6VXNlcjI1NDE1OA==", "avatar_url": "https://avatars.githubusercontent.com/u/254158?v=4", "gravatar_id": "", "url": "https://api.github.com/users/derlih", "html_url": "https://github.com/derlih", "followers_url": "https://api.github.com/users/derlih/followers", "following_url": "https://api.github.com/users/derlih/following{/other_user}", "gists_url": "https://api.github.com/users/derlih/gists{/gist_id}", "starred_url": "https://api.github.com/users/derlih/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/derlih/subscriptions", "organizations_url": "https://api.github.com/users/derlih/orgs", "repos_url": "https://api.github.com/users/derlih/repos", "events_url": "https://api.github.com/users/derlih/events{/privacy}", "received_events_url": "https://api.github.com/users/derlih/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-07-03T20:42:11Z", "updated_at": "2020-10-21T09:05:22Z", "closed_at": "2020-10-21T09:05:22Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\ntests/test_web_protocol.py::test_close[pyloop] should be fixed or removed\r\n\r\n\ud83d\udca1 **To Reproduce**\r\nCheck azure pipelines status for master commit 385b03ef21415d062886e1caab74eb5b93fdb887\r\nhttps://github.com/aio-libs/aiohttp/runs/725234241\r\nhttps://dev.azure.com/aio-libs/aiohttp/_build/results?buildId=3150&view=logs&jobId=9ea5551e-117e-538b-80fb-c12f8c2efcc0\r\n\r\nBut this commit doesn't contain any code change. Looks like something was changed in the CI env.\r\n\r\n\ud83d\udca1 **Expected behavior**\r\nAll CI tests on master branch should pass\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n```\r\nsrv = <RequestHandler connected>, transport = <Mock id='4397689680'>\r\n\r\n    async def test_close(srv, transport) -> None:\r\n        transport.close.side_effect = partial(srv.connection_lost, None)\r\n        srv.connection_made(transport)\r\n        await asyncio.sleep(0)\r\n    \r\n        handle_request = mock.Mock()\r\n        handle_request.side_effect = helpers.noop\r\n        with mock.patch.object(\r\n            web.RequestHandler,\r\n            'handle_request',\r\n            create=True,\r\n            new=handle_request\r\n        ):\r\n            assert transport is srv.transport\r\n    \r\n            srv._keepalive = True\r\n            srv.data_received(\r\n                b'GET / HTTP/1.1\\r\\n'\r\n                b'Host: example.com\\r\\n'\r\n                b'Content-Length: 0\\r\\n\\r\\n'\r\n                b'GET / HTTP/1.1\\r\\n'\r\n                b'Host: example.com\\r\\n'\r\n                b'Content-Length: 0\\r\\n\\r\\n')\r\n    \r\n            await asyncio.sleep(0.1)\r\n            assert srv._task_handler\r\n>           assert srv._waiter\r\nE           assert None\r\nE            +  where None = <RequestHandler connected>._waiter\r\n\r\ntests/test_web_protocol.py:651: AssertionError\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n3.8 on Mac and Win CI VMs\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4849/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4849/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4843", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4843/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4843/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4843/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4843", "id": 645445401, "node_id": "MDU6SXNzdWU2NDU0NDU0MDE=", "number": 4843, "title": "aiohttp.client_exceptions.ClientPayloadError: Response payload is not completed", "user": {"login": "kholmatov", "id": 7079631, "node_id": "MDQ6VXNlcjcwNzk2MzE=", "avatar_url": "https://avatars.githubusercontent.com/u/7079631?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kholmatov", "html_url": "https://github.com/kholmatov", "followers_url": "https://api.github.com/users/kholmatov/followers", "following_url": "https://api.github.com/users/kholmatov/following{/other_user}", "gists_url": "https://api.github.com/users/kholmatov/gists{/gist_id}", "starred_url": "https://api.github.com/users/kholmatov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kholmatov/subscriptions", "organizations_url": "https://api.github.com/users/kholmatov/orgs", "repos_url": "https://api.github.com/users/kholmatov/repos", "events_url": "https://api.github.com/users/kholmatov/events{/privacy}", "received_events_url": "https://api.github.com/users/kholmatov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-06-25T10:21:11Z", "updated_at": "2022-09-15T13:42:15Z", "closed_at": "2020-07-09T09:39:43Z", "author_association": "NONE", "active_lock_reason": null, "body": "I have some problem wit ClientSession get\r\n\r\n```\r\n        async with ClientSession() as session:\r\n            async with session.get(\"https://www.deluxemusic.tv/wp-admin/admin-ajax.php?action=get_programs\",\r\n                                   headers=self.headers) as resp:\r\n                if resp.status == HTTPStatus.OK:\r\n                    json_data = await resp.json()\r\n```\r\n        \r\n\r\n```\r\napp_1       | File \"/usr/share/python3/app/lib/python3.8/site-packages/aiohttp/client_reqrep.py\", line 973, in read\r\napp_1       |     self._body = await self.content.read()\r\napp_1       |   File \"/usr/share/python3/app/lib/python3.8/site-packages/aiohttp/streams.py\", line 358, in read\r\napp_1       |     block = await self.readany()\r\napp_1       |   File \"/usr/share/python3/app/lib/python3.8/site-packages/aiohttp/streams.py\", line 380, in readany\r\napp_1       |     await self._wait('readany')\r\napp_1       |   File \"/usr/share/python3/app/lib/python3.8/site-packages/aiohttp/streams.py\", line 296, in _wait\r\napp_1       |     await waiter\r\napp_1       | aiohttp.client_exceptions.ClientPayloadError: Response payload is not completed\r\n```\r\n\r\n```\r\ncurl -I https://www.deluxemusic.tv/wp-admin/admin-ajax.php?action=get_programs\r\nHTTP/2 200 \r\ndate: Thu, 25 Jun 2020 10:23:25 GMT\r\nserver: Apache\r\npragma: no-cache\r\nx-robots-tag: noindex\r\nx-content-type-options: nosniff\r\nx-frame-options: SAMEORIGIN\r\nreferrer-policy: strict-origin-when-cross-origin\r\nexpires: Wed, 11 Jan 1984 05:00:00 GMT\r\ncache-control: no-cache, must-revalidate, max-age=0\r\nset-cookie: PHPSESSID=11042fa2b3071b5dd04c4ca705bd4b99; path=/\r\nreferrer-policy: no-referrer-when-downgrade\r\ncontent-type: application/json\r\n```", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4843/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4843/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4842", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4842/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4842/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4842/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4842", "id": 644944513, "node_id": "MDU6SXNzdWU2NDQ5NDQ1MTM=", "number": 4842, "title": "Deprecation: @coroutine\" decorator is deprecated since Python 3.8, use \"async def\" instead.", "user": {"login": "thorwhalen", "id": 1906276, "node_id": "MDQ6VXNlcjE5MDYyNzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1906276?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thorwhalen", "html_url": "https://github.com/thorwhalen", "followers_url": "https://api.github.com/users/thorwhalen/followers", "following_url": "https://api.github.com/users/thorwhalen/following{/other_user}", "gists_url": "https://api.github.com/users/thorwhalen/gists{/gist_id}", "starred_url": "https://api.github.com/users/thorwhalen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thorwhalen/subscriptions", "organizations_url": "https://api.github.com/users/thorwhalen/orgs", "repos_url": "https://api.github.com/users/thorwhalen/repos", "events_url": "https://api.github.com/users/thorwhalen/events{/privacy}", "received_events_url": "https://api.github.com/users/thorwhalen/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2020-06-24T20:42:14Z", "updated_at": "2020-10-21T10:04:50Z", "closed_at": "2020-10-21T10:04:50Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nUse of aiohttp issuing deprecation warnings for python 3.8 and will result in error in 3.10. \r\nApparently, changing do `async def` has no negative impact on the user.\r\n\r\n\ud83d\udca1 **To Reproduce**\r\nCall any function that is decorated by `@coroutine`. \r\nFor example `aiohttp/helpers.py:107`\r\n\r\n\ud83d\udca1 **Expected behavior**\r\nGet a deprecation warning:\r\n```\r\n  \"@coroutine\" decorator is deprecated since Python 3.8, use \"async def\" instead\r\n-- Docs: https://docs.pytest.org/en/latest/warnings.html\r\n```\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\n\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$  python --version\r\nPython 3.8.2\r\n...\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.6.2\r\n...\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.6\r\n...\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.4.2\r\n...\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4842/reactions", "total_count": 7, "+1": 7, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4842/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4819", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4819/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4819/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4819/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4819", "id": 637830600, "node_id": "MDU6SXNzdWU2Mzc4MzA2MDA=", "number": 4819, "title": "TestFrozenList.test_iface fails with Python 3.9", "user": {"login": "mgorny", "id": 110765, "node_id": "MDQ6VXNlcjExMDc2NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/110765?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mgorny", "html_url": "https://github.com/mgorny", "followers_url": "https://api.github.com/users/mgorny/followers", "following_url": "https://api.github.com/users/mgorny/following{/other_user}", "gists_url": "https://api.github.com/users/mgorny/gists{/gist_id}", "starred_url": "https://api.github.com/users/mgorny/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mgorny/subscriptions", "organizations_url": "https://api.github.com/users/mgorny/orgs", "repos_url": "https://api.github.com/users/mgorny/repos", "events_url": "https://api.github.com/users/mgorny/events{/privacy}", "received_events_url": "https://api.github.com/users/mgorny/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-06-12T15:24:59Z", "updated_at": "2020-10-24T19:03:19Z", "closed_at": "2020-10-24T19:03:10Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nThe listed test fails on Python 3.9.0b3.\r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n1. Build aiohttp using Python 3.9.\r\n2. Run `pytest tests/test_frozenlist.py`\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\nTests passing.\r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n```python-traceback\r\n==================================================================== FAILURES =====================================================================\r\n____________________________________________________________ TestFrozenList.test_iface ____________________________________________________________\r\n\r\nself = <test_frozenlist.TestFrozenList object at 0x7f275e513b20>\r\n\r\n    def test_iface(self) -> None:\r\n        for name in set(dir(MutableSequence)) - self.SKIP_METHODS:\r\n            if name.startswith('_') and not name.endswith('_'):\r\n                continue\r\n>           assert hasattr(self.FrozenList, name)\r\nE           AssertionError: assert False\r\nE            +  where False = hasattr(<class 'aiohttp._frozenlist.FrozenList'>, '__class_getitem__')\r\nE            +    where <class 'aiohttp._frozenlist.FrozenList'> = <test_frozenlist.TestFrozenList object at 0x7f275e513b20>.FrozenList\r\n\r\ntests/test_frozenlist.py:20: AssertionError\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.9.0b3\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n(git 385b03ef21415d062886e1caab74eb5b93fdb887)\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 4.0.0a1\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /tmp/aiohttp\r\nRequires: attrs, chardet, multidict, async-timeout, yarl, typing-extensions\r\nRequired-by: \r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.6\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /tmp/aiohttp/.venv/lib/python3.9/site-packages\r\nRequires: \r\nRequired-by: aiohttp, yarl\r\n\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.4.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /tmp/aiohttp/.venv/lib/python3.9/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\nGentoo Linux\r\nConfirmed in git checkout with dedicated venv.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4819/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4819/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4810", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4810/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4810/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4810/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4810", "id": 636219201, "node_id": "MDU6SXNzdWU2MzYyMTkyMDE=", "number": 4810, "title": "Error building from sources.", "user": {"login": "LuckyDenis", "id": 41421345, "node_id": "MDQ6VXNlcjQxNDIxMzQ1", "avatar_url": "https://avatars.githubusercontent.com/u/41421345?v=4", "gravatar_id": "", "url": "https://api.github.com/users/LuckyDenis", "html_url": "https://github.com/LuckyDenis", "followers_url": "https://api.github.com/users/LuckyDenis/followers", "following_url": "https://api.github.com/users/LuckyDenis/following{/other_user}", "gists_url": "https://api.github.com/users/LuckyDenis/gists{/gist_id}", "starred_url": "https://api.github.com/users/LuckyDenis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/LuckyDenis/subscriptions", "organizations_url": "https://api.github.com/users/LuckyDenis/orgs", "repos_url": "https://api.github.com/users/LuckyDenis/repos", "events_url": "https://api.github.com/users/LuckyDenis/events{/privacy}", "received_events_url": "https://api.github.com/users/LuckyDenis/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 58986078, "node_id": "MDU6TGFiZWw1ODk4NjA3OA==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/invalid", "name": "invalid", "color": "e4e669", "default": true, "description": "This doesn't seem right"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 13, "created_at": "2020-06-10T12:49:57Z", "updated_at": "2020-10-24T21:31:21Z", "closed_at": "2020-10-24T21:31:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nWhen building according to the [instructions](https://docs.aiohttp.org/en/stable/contributing.html), an error occurs.\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\nFollow the [instructions](https://docs.aiohttp.org/en/stable/contributing.html).\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\nCorrect code build.\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\n...\r\n...\r\n...\r\nRequirement already satisfied, skipping upgrade: PyJWT[crypto] in ./venv/lib/python3.8/site-packages (from gidgethub->cherry_picker==1.3.2->-r requirements/dev.txt (line 3)) (1.7.1)\r\nInstalling collected packages: aiohttp\r\n  Attempting uninstall: aiohttp\r\n    Found existing installation: aiohttp 3.6.2\r\n    Uninstalling aiohttp-3.6.2:\r\n      Successfully uninstalled aiohttp-3.6.2\r\n  Running setup.py develop for aiohttp\r\n    ERROR: Command errored out with exit status 1:\r\n     command: /home/denis/Project/aiohttp/venv/bin/python -c 'import sys, setuptools, tokenize; sys.argv[0] = '\"'\"'/home/denis/Project/aiohttp/setup.py'\"'\"'; __file__='\"'\"'/home/denis/Project/aiohttp/setup.py'\"'\"';f=getattr(tokenize, '\"'\"'open'\"'\"', open)(__file__);code=f.read().replace('\"'\"'\\r\\n'\"'\"', '\"'\"'\\n'\"'\"');f.close();exec(compile(code, __file__, '\"'\"'exec'\"'\"'))' develop --no-deps\r\n         cwd: /home/denis/Project/aiohttp/\r\n    Complete output (29 lines):\r\n    **********************\r\n    * Accellerated build *\r\n    **********************\r\n    running develop\r\n    running egg_info\r\n    writing aiohttp.egg-info/PKG-INFO\r\n    writing dependency_links to aiohttp.egg-info/dependency_links.txt\r\n    writing requirements to aiohttp.egg-info/requires.txt\r\n    writing top-level names to aiohttp.egg-info/top_level.txt\r\n    reading manifest file 'aiohttp.egg-info/SOURCES.txt'\r\n    reading manifest template 'MANIFEST.in'\r\n    warning: no files found matching 'aiohttp' anywhere in distribution\r\n    warning: no previously-included files matching '*.pyc' found anywhere in distribution\r\n    warning: no previously-included files matching '*.pyd' found anywhere in distribution\r\n    warning: no previously-included files matching '*.so' found anywhere in distribution\r\n    warning: no previously-included files matching '*.lib' found anywhere in distribution\r\n    warning: no previously-included files matching '*.dll' found anywhere in distribution\r\n    warning: no previously-included files matching '*.a' found anywhere in distribution\r\n    warning: no previously-included files matching '*.obj' found anywhere in distribution\r\n    warning: no previously-included files found matching 'aiohttp/*.html'\r\n    no previously-included directories found matching 'docs/_build'\r\n    writing manifest file 'aiohttp.egg-info/SOURCES.txt'\r\n    running build_ext\r\n    building 'aiohttp._websocket' extension\r\n    x86_64-linux-gnu-gcc -pthread -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O2 -Wall -g -fstack-protector-strong -Wformat -Werror=format-security -g -fwrapv -O2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -fPIC -I/home/denis/Project/aiohttp/venv/include -I/usr/include/python3.8 -c aiohttp/_websocket.c -o build/temp.linux-x86_64-3.8/aiohttp/_websocket.o\r\n    x86_64-linux-gnu-gcc: error: aiohttp/_websocket.c: \u041d\u0435\u0442 \u0442\u0430\u043a\u043e\u0433\u043e \u0444\u0430\u0439\u043b\u0430 \u0438\u043b\u0438 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0430\r\n    x86_64-linux-gnu-gcc: fatal error: no input files\r\n    compilation terminated.\r\n    error: command 'x86_64-linux-gnu-gcc' failed with exit status 1\r\n    ----------------------------------------\r\n  Rolling back uninstall of aiohttp\r\n  Moving to /home/denis/Project/aiohttp/venv/lib/python3.8/site-packages/aiohttp-3.6.2.dist-info/\r\n   from /home/denis/Project/aiohttp/venv/lib/python3.8/site-packages/~iohttp-3.6.2.dist-info\r\n  Moving to /home/denis/Project/aiohttp/venv/lib/python3.8/site-packages/aiohttp/\r\n   from /home/denis/Project/aiohttp/venv/lib/python3.8/site-packages/~iohttp\r\nERROR: Command errored out with exit status 1: /home/denis/Project/aiohttp/venv/bin/python -c 'import sys, setuptools, tokenize; sys.argv[0] = '\"'\"'/home/denis/Project/aiohttp/setup.py'\"'\"'; __file__='\"'\"'/home/denis/Project/aiohttp/setup.py'\"'\"';f=getattr(tokenize, '\"'\"'open'\"'\"', open)(__file__);code=f.read().replace('\"'\"'\\r\\n'\"'\"', '\"'\"'\\n'\"'\"');f.close();exec(compile(code, __file__, '\"'\"'exec'\"'\"'))' develop --no-deps Check the logs for full command output.\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.8.2\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.6.2\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/denis/Project/aiohttp/venv/lib/python3.8/site-packages\r\nRequires: attrs, async-timeout, chardet, multidict, yarl\r\nRequired-by: pytest-aiohttp\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.6\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/denis/Project/aiohttp/venv/lib/python3.8/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.4.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/denis/Project/aiohttp/venv/lib/python3.8/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\nOS: Ubuntu 20.04 LTS", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4810/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4810/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4809", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4809/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4809/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4809/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4809", "id": 636124758, "node_id": "MDU6SXNzdWU2MzYxMjQ3NTg=", "number": 4809, "title": "Server static handler includes body for HEAD response", "user": {"login": "bmerry", "id": 1963944, "node_id": "MDQ6VXNlcjE5NjM5NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1963944?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bmerry", "html_url": "https://github.com/bmerry", "followers_url": "https://api.github.com/users/bmerry/followers", "following_url": "https://api.github.com/users/bmerry/following{/other_user}", "gists_url": "https://api.github.com/users/bmerry/gists{/gist_id}", "starred_url": "https://api.github.com/users/bmerry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bmerry/subscriptions", "organizations_url": "https://api.github.com/users/bmerry/orgs", "repos_url": "https://api.github.com/users/bmerry/repos", "events_url": "https://api.github.com/users/bmerry/events{/privacy}", "received_events_url": "https://api.github.com/users/bmerry/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-06-10T10:16:31Z", "updated_at": "2020-10-15T13:17:44Z", "closed_at": "2020-10-15T13:17:44Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nWhen using `web.static` to serve static content, the server responds to HEAD requests as if they were GET requests i.e. it includes a body with the file content. Apart from wasting bandwidth, this completely breaks pipelined connections because the content appears where the client is expecting to see the response headers for the next request. Possibly it may cause security issues too if an attacker can control the content because they could then deliver arbitrary headers to a client.\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n\r\nPut the script below in a file called `ah.py` and run it (it will serve the directory it is in on :8080).\r\n\r\n```python\r\n#!/usr/bin/env python3\r\n\r\nimport os\r\nimport aiohttp.web as web\r\n\r\napp = web.Application()\r\napp.add_routes([web.static('/', os.path.dirname(os.path.realpath(__file__)))])\r\nweb.run_app(app)\r\n```\r\n\r\nWhile it's running, run `echo -e 'HEAD /ah.py HTTP/1.1\\nHost: localhost:8080\\n' | nc localhost 8080` (assumes bash shell for `echo -e`). It will output something like\r\n\r\n```\r\nHTTP/1.1 200 OK\r\nContent-Type: text/x-python\r\nLast-Modified: Wed, 10 Jun 2020 10:02:34 GMT\r\nContent-Length: 182\r\nAccept-Ranges: bytes\r\nDate: Wed, 10 Jun 2020 10:11:13 GMT\r\nServer: Python/3.6 aiohttp/3.6.2\r\n\r\n#!/usr/bin/env python3\r\n\r\nimport os\r\nimport aiohttp.web as web\r\n\r\n\r\napp = web.Application()\r\napp.add_routes([web.static('/', os.path.dirname(os.path.realpath(__file__)))])\r\nweb.run_app(app)\r\n```\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n\r\nIt should not output any body because it is a HEAD request.\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\npython 3.6.6\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nVersion: 3.6.2\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nVersion: 4.7.6\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nVersion: 1.4.2\r\n```", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4809/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4809/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4805", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4805/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4805/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4805/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4805", "id": 634809020, "node_id": "MDU6SXNzdWU2MzQ4MDkwMjA=", "number": 4805, "title": "CLOSE_WAIT socket status after calling ws.close()", "user": {"login": "TheSlackOne", "id": 13991630, "node_id": "MDQ6VXNlcjEzOTkxNjMw", "avatar_url": "https://avatars.githubusercontent.com/u/13991630?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TheSlackOne", "html_url": "https://github.com/TheSlackOne", "followers_url": "https://api.github.com/users/TheSlackOne/followers", "following_url": "https://api.github.com/users/TheSlackOne/following{/other_user}", "gists_url": "https://api.github.com/users/TheSlackOne/gists{/gist_id}", "starred_url": "https://api.github.com/users/TheSlackOne/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TheSlackOne/subscriptions", "organizations_url": "https://api.github.com/users/TheSlackOne/orgs", "repos_url": "https://api.github.com/users/TheSlackOne/repos", "events_url": "https://api.github.com/users/TheSlackOne/events{/privacy}", "received_events_url": "https://api.github.com/users/TheSlackOne/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-06-08T17:39:57Z", "updated_at": "2020-06-10T21:58:34Z", "closed_at": "2020-06-10T21:58:34Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nAfter calling `ws.close()`, the server side keeps the socket in CLOSE_WAIT status for same seconds.\r\n\r\n```\r\nasync with ClientSession(connector=TCPConnector(limit=0)) as session:\r\n    try:\r\n        async with session.ws_connect(streamer_host,\r\n                                      protocols=(streamer_protocol,), ssl=True) as ws:\r\n            try:\r\n                  await ws.send_json(init_metadata)\r\n                  await ws.send_json(codec_change)\r\n                  while not ws.closed:\r\n                        buf = load_buffer()\r\n                        await ws.send_bytes(buf)\r\n                  await ws.close()\r\n```\r\nAfter calling `ws.close()`, the websocket is effectively closed (`ws.closed` is `True`), but the server accuses CLOSE_WAIT status for about 10 secs. This is a problem because the sockets in this state make the server keep the FD open demanding more resources until they get closed.\r\nSo where I should have `x` simultaneous connection, I get `2x`, because I launch new connections when they are done (after `ws.close()`). So my server needs twice RAM when clients use `aiohttp`.\r\n\r\nThis is reproducible in MacOS 10 and modern Linux, at least.\r\n\r\nThis does not happens with other websocket implementations, like the C++ libwebsocket.\r\n\r\nMy expectations is the get the sockets closed immediately after calling `ws.close()`.\r\n\r\n\r\nEnvironment\r\n\r\n```console\r\n$ python --version\r\nPython 3.6.8\r\n```\r\n\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.6.2\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/emessina/.pyenv/versions/3.6.8/lib/python3.6/site-packages\r\nRequires: typing-extensions, chardet, idna-ssl, async-timeout, multidict, yarl, attrs\r\nRequired-by: asapp-serverbase, asapp-pyproto\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.4\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/emessina/.pyenv/versions/3.6.8/lib/python3.6/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.4.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/emessina/.pyenv/versions/3.6.8/lib/python3.6/site-packages\r\nRequires: multidict, idna\r\nRequired-by: aiohttp\r\n```\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4805/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4805/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4799", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4799/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4799/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4799/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4799", "id": 632635701, "node_id": "MDU6SXNzdWU2MzI2MzU3MDE=", "number": 4799, "title": "Cleanup doesn't run when exception occurs in startup.", "user": {"login": "Dreamsorcerer", "id": 2203121, "node_id": "MDQ6VXNlcjIyMDMxMjE=", "avatar_url": "https://avatars.githubusercontent.com/u/2203121?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dreamsorcerer", "html_url": "https://github.com/Dreamsorcerer", "followers_url": "https://api.github.com/users/Dreamsorcerer/followers", "following_url": "https://api.github.com/users/Dreamsorcerer/following{/other_user}", "gists_url": "https://api.github.com/users/Dreamsorcerer/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dreamsorcerer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dreamsorcerer/subscriptions", "organizations_url": "https://api.github.com/users/Dreamsorcerer/orgs", "repos_url": "https://api.github.com/users/Dreamsorcerer/repos", "events_url": "https://api.github.com/users/Dreamsorcerer/events{/privacy}", "received_events_url": "https://api.github.com/users/Dreamsorcerer/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1363888951, "node_id": "MDU6TGFiZWwxMzYzODg4OTUx", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/pr-available", "name": "pr-available", "color": "363396", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-06-06T18:06:23Z", "updated_at": "2020-12-05T07:46:16Z", "closed_at": "2020-12-05T07:46:16Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "When an exception occurs in startup, the cleanup is never run.\r\n\r\nExpected behaviour: Any cleanup steps added should be run, especially when using the cleanup-context.\r\n\r\ne.g.\r\nTask A = Setup DB as cleanup context.\r\nTask B = Setup a remote connection as cleanup context. This throws an exception.\r\n\r\nActual behaviour:\r\n  Task A is successfully setup.\r\n  Task B creates an exception.\r\n  No cleanup happens.\r\n\r\nExpected behaviour:\r\n  Task A is successfully setup.\r\n  Task B creates an exception.\r\n  Task A cleanup happens.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4799/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4799/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4798", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4798/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4798/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4798/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4798", "id": 632318590, "node_id": "MDU6SXNzdWU2MzIzMTg1OTA=", "number": 4798, "title": "Aiohttp doesn't return any error on invalid request methods", "user": {"login": "grossmj", "id": 4752614, "node_id": "MDQ6VXNlcjQ3NTI2MTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4752614?v=4", "gravatar_id": "", "url": "https://api.github.com/users/grossmj", "html_url": "https://github.com/grossmj", "followers_url": "https://api.github.com/users/grossmj/followers", "following_url": "https://api.github.com/users/grossmj/following{/other_user}", "gists_url": "https://api.github.com/users/grossmj/gists{/gist_id}", "starred_url": "https://api.github.com/users/grossmj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/grossmj/subscriptions", "organizations_url": "https://api.github.com/users/grossmj/orgs", "repos_url": "https://api.github.com/users/grossmj/repos", "events_url": "https://api.github.com/users/grossmj/events{/privacy}", "received_events_url": "https://api.github.com/users/grossmj/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-06-06T09:13:08Z", "updated_at": "2020-10-18T09:21:46Z", "closed_at": "2020-10-18T09:21:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n\r\nI ran the simple server example located in https://github.com/aio-libs/aiohttp/blob/master/examples/server_simple.py\r\n\r\nThen sent an invalid GET1 request using CURL. There is no response from aiohttp and curl is blocked.\r\n\r\nThe original error was reported there: https://github.com/GNS3/gns3-server/issues/1766 (GNS3 server uses aiohttp).\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n\r\n```console\r\n$ curl -X GET1 http://0.0.0.0:8080/\r\n<no response, blocks until killed>\r\n```\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n\r\nAn HTTP error.\r\n\r\n\r\n\ud83d\udccb **Your version of the aiohttp distribution**\r\n\r\n```console\r\n$ python3 -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.6.2\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/local/lib/python3.6/dist-packages\r\nRequires: typing-extensions, chardet, multidict, idna-ssl, attrs, async-timeout, yarl\r\nRequired-by: aiohttp-cors, pytest-aiohttp, gns3-server\r\n```", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4798/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4798/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4792", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4792/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4792/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4792/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4792", "id": 630865933, "node_id": "MDU6SXNzdWU2MzA4NjU5MzM=", "number": 4792, "title": "aiohttp messing up with given URL", "user": {"login": "thekillgfx", "id": 39156526, "node_id": "MDQ6VXNlcjM5MTU2NTI2", "avatar_url": "https://avatars.githubusercontent.com/u/39156526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thekillgfx", "html_url": "https://github.com/thekillgfx", "followers_url": "https://api.github.com/users/thekillgfx/followers", "following_url": "https://api.github.com/users/thekillgfx/following{/other_user}", "gists_url": "https://api.github.com/users/thekillgfx/gists{/gist_id}", "starred_url": "https://api.github.com/users/thekillgfx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thekillgfx/subscriptions", "organizations_url": "https://api.github.com/users/thekillgfx/orgs", "repos_url": "https://api.github.com/users/thekillgfx/repos", "events_url": "https://api.github.com/users/thekillgfx/events{/privacy}", "received_events_url": "https://api.github.com/users/thekillgfx/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-06-04T14:17:29Z", "updated_at": "2020-06-04T18:11:10Z", "closed_at": "2020-06-04T18:11:10Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nI'm passing a certain url to `aiohttp get` function but somehow it change the link itself\r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\n\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\n```\r\nlink = 'https://www.instagram.com/p/BwS9uRnAodb/'\r\nurl = link + '?__a=1'\r\nprint(url)\r\n>>> https://www.instagram.com/p/BwS9uRnAodb?__a=1\r\nasync with aiohttp.ClientSession() as session:\r\n    async with session.get(url) as resp:\r\n        if resp and resp.status == 200:\r\n            print(resp.url)\r\n            >>> https://www.instagram.com/accounts/login/?next=/p/BwS9uRnAodb/?__a%3D1  \r\n            data = await resp.json()\r\n```\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\nSince a few days this is not working anymore: I was used to pass a `link` to the function and it was returning me the content of the given page in JSON format so I can extrapolate images link, nicknames or other things. From the given url (https://www.instagram.com/p/BwS9uRnAodb?__a=1) aiohttps was reaching the given page but in JSON format but from the one that it's creating(https://www.instagram.com/accounts/login/?next=/p/BwS9uRnAodb/?__a%3D1) using Chrome I reach the same page but seems not working anymore on aiohttp.\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\nFile \"main.py\", line 86, in instagramPost\r\n    data = await resp.json()\r\nFile \"/opt/virtualenvs/python3/lib/python3.8/site-packages/aiohttp/client_reqrep.py\", line \r\n1026, in json\r\n    raise ContentTypeError(\r\naiohttp.client_exceptions.ContentTypeError: 0, message='Attempt to decode JSON with unexpecte\r\nd mimetype: text/html; charset=utf-8', url=URL('https://www.instagram.com/accounts/login/?nex\r\nt=/p/BwS9uRnAodb/?__a%3D1')\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\npython = \"^3.7\"\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\naiohttp = \"^3.6\"\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nmultidict = \"4.7.5\"\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nyarl= \"1.4.2\"\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->client\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4792/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4792/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4791", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4791/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4791/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4791/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4791", "id": 630724652, "node_id": "MDU6SXNzdWU2MzA3MjQ2NTI=", "number": 4791, "title": "Why reuqests succeed, but aiohttp fails\uff1f", "user": {"login": "importTthis", "id": 55172427, "node_id": "MDQ6VXNlcjU1MTcyNDI3", "avatar_url": "https://avatars.githubusercontent.com/u/55172427?v=4", "gravatar_id": "", "url": "https://api.github.com/users/importTthis", "html_url": "https://github.com/importTthis", "followers_url": "https://api.github.com/users/importTthis/followers", "following_url": "https://api.github.com/users/importTthis/following{/other_user}", "gists_url": "https://api.github.com/users/importTthis/gists{/gist_id}", "starred_url": "https://api.github.com/users/importTthis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/importTthis/subscriptions", "organizations_url": "https://api.github.com/users/importTthis/orgs", "repos_url": "https://api.github.com/users/importTthis/repos", "events_url": "https://api.github.com/users/importTthis/events{/privacy}", "received_events_url": "https://api.github.com/users/importTthis/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-06-04T11:01:42Z", "updated_at": "2020-06-04T11:24:46Z", "closed_at": "2020-06-04T11:24:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "# requests code\r\nfrom requests import Session\r\n\r\nsession = Session()\r\n\r\n\r\nheaders = {\r\n    \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.61 Safari/537.36\",\r\n    \"Accept-Encoding\": \"gzip, deflate, br\",\r\n    \"Accept-Language\": \"zh-CN,zh;q=0.9\",\r\n    \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\",\r\n}\r\n\r\nr = session.get('https://www.amazon.com/', headers=headers)\r\nprint(r.text)\r\n\r\n# aiohttp code\r\nimport aiohttp\r\nimport asyncio\r\n\r\n\r\nasync def async_test():\r\n    headers = {\r\n        \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.61 Safari/537.36\",\r\n        \"Accept-Encoding\": \"gzip, deflate, br\",\r\n        \"Accept-Language\": \"zh-CN,zh;q=0.9\",\r\n        \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\",\r\n    }\r\n    async with aiohttp.ClientSession(headers=headers) as session:\r\n        async  with session.get(\"https://www.amazon.com/\", headers=headers) as resp:\r\n            tet = await resp.text()\r\n            print(tet)\r\n\r\nasyncio.run(async_test())\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4791/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4791/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4779", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4779/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4779/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4779/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4779", "id": 627477096, "node_id": "MDU6SXNzdWU2Mjc0NzcwOTY=", "number": 4779, "title": "ResourceWarning when accessing response content", "user": {"login": "RyadIso", "id": 66138445, "node_id": "MDQ6VXNlcjY2MTM4NDQ1", "avatar_url": "https://avatars.githubusercontent.com/u/66138445?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RyadIso", "html_url": "https://github.com/RyadIso", "followers_url": "https://api.github.com/users/RyadIso/followers", "following_url": "https://api.github.com/users/RyadIso/following{/other_user}", "gists_url": "https://api.github.com/users/RyadIso/gists{/gist_id}", "starred_url": "https://api.github.com/users/RyadIso/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RyadIso/subscriptions", "organizations_url": "https://api.github.com/users/RyadIso/orgs", "repos_url": "https://api.github.com/users/RyadIso/repos", "events_url": "https://api.github.com/users/RyadIso/events{/privacy}", "received_events_url": "https://api.github.com/users/RyadIso/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2020-05-29T19:07:06Z", "updated_at": "2021-10-10T21:11:40Z", "closed_at": "2021-10-10T21:11:40Z", "author_association": "NONE", "active_lock_reason": null, "body": "ResourceWarning when accessing response content\r\n\r\n\r\nWhen trying to access the response content, aiohttp will always return a ResourceWarning:\r\n\r\nSimple reproducer:\r\n\r\n```\r\n#!/usr/bin/env python3\r\n\r\nimport aiohttp\r\nimport asyncio\r\nimport warnings\r\n\r\nwarnings.simplefilter('default', category=ResourceWarning)\r\n\r\n\r\nasync def main():\r\n    async with aiohttp.ClientSession() as session:\r\n        async with session.get(\"https://github.com/\") as r:\r\n            await r.content.read()\r\n            print(\"Status code: %d\" % r.status)\r\n\r\n\r\nasyncio.run(main())\r\n```\r\n\r\n\r\nThis script will output a ResourceWarning:\r\n```\r\nStatus code: 200\r\n/usr/lib/python3.8/asyncio/selector_events.py:694: ResourceWarning: unclosed transport <_SelectorSocketTransport fd=6>\r\n  _warn(f\"unclosed transport {self!r}\", ResourceWarning, source=self)\r\nResourceWarning: Enable tracemalloc to get the object allocation traceback\r\n```\r\n\r\n\r\nEnvironment:\r\nUbuntu 20.04\r\nPython 3.8.2\r\n\r\nPackage versions (in a minimal venv with just aiohttp + dependencies installed):\r\n```\r\n$ pip freeze\r\naiohttp==3.6.2\r\nasync-timeout==3.0.1\r\nattrs==19.3.0\r\nchardet==3.0.4\r\nidna==2.9\r\nmultidict==4.7.6\r\nyarl==1.4.2\r\n```", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4779/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4779/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4773", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4773/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4773/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4773/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4773", "id": 623999636, "node_id": "MDU6SXNzdWU2MjM5OTk2MzY=", "number": 4773, "title": "request.write_eof() blocks subsequent async processing, when requesting from CUI HTTP client", "user": {"login": "hoto17296", "id": 1976227, "node_id": "MDQ6VXNlcjE5NzYyMjc=", "avatar_url": "https://avatars.githubusercontent.com/u/1976227?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hoto17296", "html_url": "https://github.com/hoto17296", "followers_url": "https://api.github.com/users/hoto17296/followers", "following_url": "https://api.github.com/users/hoto17296/following{/other_user}", "gists_url": "https://api.github.com/users/hoto17296/gists{/gist_id}", "starred_url": "https://api.github.com/users/hoto17296/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hoto17296/subscriptions", "organizations_url": "https://api.github.com/users/hoto17296/orgs", "repos_url": "https://api.github.com/users/hoto17296/repos", "events_url": "https://api.github.com/users/hoto17296/events{/privacy}", "received_events_url": "https://api.github.com/users/hoto17296/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-05-25T02:03:34Z", "updated_at": "2020-06-02T01:07:17Z", "closed_at": "2020-06-02T01:07:16Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n- I am implementing a web application with aiohttp server.\r\n- When requesting from client, the server responds with \"200 ok\" immediately and runs a slow async job after the http connection has closed.\r\n- When requesting from Google Chrome, the server works expectly.\r\n- However, when requesting from CUI client (wget or curl), the server stops at the first `await ...` line after the `await request.write_eof()`, and displays no error message.\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n``` python\r\n\"\"\"app.py\"\"\"\r\n\r\nfrom asyncio import sleep\r\nfrom aiohttp import web\r\n\r\n\r\nasync def handler(request):\r\n    print(f'\\n# Request from {request.headers[\"User-Agent\"]}')\r\n\r\n    # Response '200 OK' immediately\r\n    response = web.Response(text='ok')\r\n    await response.prepare(request)\r\n    await response.write_eof()\r\n    print('Response has returned')\r\n\r\n    # Execute slow job\r\n    await sleep(1)  # some async job\r\n    print('Job has completed')\r\n\r\n\r\napp = web.Application()\r\n\r\napp.add_routes([web.get('/', handler)])\r\n\r\nif __name__ == '__main__':\r\n    web.run_app(app)\r\n```\r\n\r\n``` console\r\n$ python app.py\r\n```\r\n\r\nThen, access to http://localhost:8080/ from both **Google Chrome** and **cURL**.\r\n\r\n\ud83d\udca1 **Expected behavior**\r\nA \"Job completed\" message is displayed for requests from any HTTP client.\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n```\r\n======== Running on http://0.0.0.0:8080 ========\r\n(Press CTRL+C to quit)\r\n\r\n# Request from Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.61 Safari/537.36\r\nResponse has returned\r\nJob has completed\r\n\r\n# Request from curl/7.64.1\r\nResponse has returned\r\n```\r\n\r\n``` console\r\n$ curl -v http://localhost:8080/\r\n*   Trying ::1...\r\n* TCP_NODELAY set\r\n* Connection failed\r\n* connect to ::1 port 8080 failed: Connection refused\r\n*   Trying 127.0.0.1...\r\n* TCP_NODELAY set\r\n* Connected to localhost (127.0.0.1) port 8080 (#0)\r\n> GET / HTTP/1.1\r\n> Host: localhost:8080\r\n> User-Agent: curl/7.64.1\r\n> Accept: */*\r\n> \r\n< HTTP/1.1 200 OK\r\n< Content-Type: text/plain; charset=utf-8\r\n< Content-Length: 2\r\n< Date: Mon, 25 May 2020 01:22:30 GMT\r\n< Server: Python/3.7 aiohttp/3.6.2\r\n< \r\n* Connection #0 to host localhost left intact\r\nok* Closing connection 0\r\n```\r\n\r\nWhen requesting from Google Chrome, the server runs the job (`await sleep(1)`) completely and displays \"Job has completed\" message.\r\n\r\nHowever, when requesting from cURL, the server doesn't display \"Job has completed\" message and no error message.\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.7.7\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.6.2\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/local/lib/python3.7/site-packages\r\nRequires: multidict, chardet, async-timeout, yarl, attrs\r\nRequired-by:\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.6\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/local/lib/python3.7/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.4.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/local/lib/python3.7/site-packages\r\nRequires: multidict, idna\r\nRequired-by: aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n- This issue is reproduced on macOS and Linux (Ubuntu).\r\n- This issue is reproduced both in Python's default event loop and uvloop.\r\n- I tried request from cURL with the same request header as Google Chrome, and the issue was reproduced.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4773/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4773/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4750", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4750/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4750/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4750/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4750", "id": 619647216, "node_id": "MDU6SXNzdWU2MTk2NDcyMTY=", "number": 4750, "title": "keep proxy connection", "user": {"login": "geekboood", "id": 23272969, "node_id": "MDQ6VXNlcjIzMjcyOTY5", "avatar_url": "https://avatars.githubusercontent.com/u/23272969?v=4", "gravatar_id": "", "url": "https://api.github.com/users/geekboood", "html_url": "https://github.com/geekboood", "followers_url": "https://api.github.com/users/geekboood/followers", "following_url": "https://api.github.com/users/geekboood/following{/other_user}", "gists_url": "https://api.github.com/users/geekboood/gists{/gist_id}", "starred_url": "https://api.github.com/users/geekboood/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/geekboood/subscriptions", "organizations_url": "https://api.github.com/users/geekboood/orgs", "repos_url": "https://api.github.com/users/geekboood/repos", "events_url": "https://api.github.com/users/geekboood/events{/privacy}", "received_events_url": "https://api.github.com/users/geekboood/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-05-17T08:51:14Z", "updated_at": "2023-04-29T10:40:50Z", "closed_at": "2023-04-29T10:40:50Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nHi, I try to use the proxy with aiohttp but encounter a problem, that aiohttp close the connection to the proxy every time it finished the post request through the proxy.  \r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\n\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\n\r\nThe code I used look like this (only the key logic):\r\n```conn = aiohttp.TCPConnector(ssl=False, limit=None)\r\nasync with aiohttp.ClientSession(loop=loop, connector=conn) as session:\r\n    tasks = [asyncio.create_task(get(queue)) for _ in range(256)]\r\n```\r\nand the core of get function look like this:\r\n`\r\nasync with session.post(url, proxy=proxy_url) as resp:\r\n`\r\nwith the command `netstat -npt | grep $PID | wc -l`, I can always observe the result is less than or equal to 256. \r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\n\r\nI want to keep the proxy connection. I have over 1000 IP in the proxy pool, so the result of command `netstat -npt | grep $PID | wc -l` could be over 1000. ", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4750/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4750/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4748", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4748/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4748/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4748/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4748", "id": 619522349, "node_id": "MDU6SXNzdWU2MTk1MjIzNDk=", "number": 4748, "title": "mypy AbstractMatchInfo has no attribute \"route\"", "user": {"login": "Dreamsorcerer", "id": 2203121, "node_id": "MDQ6VXNlcjIyMDMxMjE=", "avatar_url": "https://avatars.githubusercontent.com/u/2203121?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dreamsorcerer", "html_url": "https://github.com/Dreamsorcerer", "followers_url": "https://api.github.com/users/Dreamsorcerer/followers", "following_url": "https://api.github.com/users/Dreamsorcerer/following{/other_user}", "gists_url": "https://api.github.com/users/Dreamsorcerer/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dreamsorcerer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dreamsorcerer/subscriptions", "organizations_url": "https://api.github.com/users/Dreamsorcerer/orgs", "repos_url": "https://api.github.com/users/Dreamsorcerer/repos", "events_url": "https://api.github.com/users/Dreamsorcerer/events{/privacy}", "received_events_url": "https://api.github.com/users/Dreamsorcerer/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-05-16T17:40:00Z", "updated_at": "2021-10-27T11:41:38Z", "closed_at": "2021-10-27T11:41:38Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "When running mypy, I get the error:\r\n`error: \"AbstractMatchInfo\" has no attribute \"route\"  [attr-defined]`\r\n\r\nFrom this code:\r\n```\r\n        match_info = await request.app.router.resolve(request_clone)\r\n        if isinstance(match_info.route, web.ResourceRoute):\r\n```\r\n\r\nBut, looking at the code, it looks to me like everything is actually returning a `UrlMappingMatchInfo`, which does have this attribute.\r\n\r\nWould it make sense to just change the return to `UrlMappingMatchInfo`? I can't see why you would get another type returned from this function.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4748/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4748/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4747", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4747/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4747/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4747/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4747", "id": 619464994, "node_id": "MDU6SXNzdWU2MTk0NjQ5OTQ=", "number": 4747, "title": "read_chunk wait forever when client aborts file uploading", "user": {"login": "yanxurui", "id": 12461110, "node_id": "MDQ6VXNlcjEyNDYxMTEw", "avatar_url": "https://avatars.githubusercontent.com/u/12461110?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yanxurui", "html_url": "https://github.com/yanxurui", "followers_url": "https://api.github.com/users/yanxurui/followers", "following_url": "https://api.github.com/users/yanxurui/following{/other_user}", "gists_url": "https://api.github.com/users/yanxurui/gists{/gist_id}", "starred_url": "https://api.github.com/users/yanxurui/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yanxurui/subscriptions", "organizations_url": "https://api.github.com/users/yanxurui/orgs", "repos_url": "https://api.github.com/users/yanxurui/repos", "events_url": "https://api.github.com/users/yanxurui/events{/privacy}", "received_events_url": "https://api.github.com/users/yanxurui/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2020-05-16T12:40:56Z", "updated_at": "2020-05-23T12:23:29Z", "closed_at": "2020-05-23T12:23:29Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nWhen I am uploading files to the server using ajax,the server's `read_chunk` does not raise any exception when client ajax aborts. That is, the server's handler will wait foreever.\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\n\r\nQuickstart -> File Uploads\r\nhttps://docs.aiohttp.org/en/stable/web_quickstart.html#file-uploads\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\nAn exception should be raised\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\n\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.8.1\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.6.2\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/yxr/.pyenv/versions/3.8.1/lib/python3.8/site-packages\r\nRequires: attrs, chardet, async-timeout, yarl, multidict\r\nRequired-by: aiohttp-session, aiohttp-security, aiohttp-jinja2, aiohttpdemo-chat, snapfile\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.5\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/yxr/.pyenv/versions/3.8.1/lib/python3.8/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.4.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/yxr/.pyenv/versions/3.8.1/lib/python3.8/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\nserver", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4747/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4747/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4746", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4746/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4746/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4746/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4746", "id": 619024623, "node_id": "MDU6SXNzdWU2MTkwMjQ2MjM=", "number": 4746, "title": "Mypy reports wrong type hints for BodyPartReader", "user": {"login": "otahontas", "id": 43019238, "node_id": "MDQ6VXNlcjQzMDE5MjM4", "avatar_url": "https://avatars.githubusercontent.com/u/43019238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/otahontas", "html_url": "https://github.com/otahontas", "followers_url": "https://api.github.com/users/otahontas/followers", "following_url": "https://api.github.com/users/otahontas/following{/other_user}", "gists_url": "https://api.github.com/users/otahontas/gists{/gist_id}", "starred_url": "https://api.github.com/users/otahontas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/otahontas/subscriptions", "organizations_url": "https://api.github.com/users/otahontas/orgs", "repos_url": "https://api.github.com/users/otahontas/repos", "events_url": "https://api.github.com/users/otahontas/events{/privacy}", "received_events_url": "https://api.github.com/users/otahontas/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-05-15T14:46:03Z", "updated_at": "2020-11-23T10:01:58Z", "closed_at": "2020-11-23T10:01:58Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n\r\nI was following [File Uploads -section in aiohttp docs](https://docs.aiohttp.org/en/stable/web_quickstart.html?highlight=multipart#file-uploads) to create a multipart request parser to work with multiple file forms in one request. However, when running the example snippet through mypy, I'm getting complains about non-existent attributes. To my understanding it seems like mypy doesn't recognise object returned from `field = await reader.next()` as BodyPartReader. \r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\n\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\n\r\n1. Install latest aiohttp (3.6.2) and mypy (0.770) with python 3.7.7\r\n2. Run multipart-reader example found from [File Uploads -section in aiohttp docs](https://docs.aiohttp.org/en/stable/web_quickstart.html?highlight=multipart#file-uploads) through mypy\r\n3. Mypy returns bunch of errors (see traceback below)\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n- Mypy shouldn't report any errors\r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```\r\nmetadata_backend/api/views.py:24: error: Item \"MultipartReader\" of \"Union[MultipartReader, BodyPartReader, None]\" has no attribute \"name\"\r\nmetadata_backend/api/views.py:24: error: Item \"None\" of \"Union[MultipartReader, BodyPartReader, None]\" has no attribute \"name\"\r\nmetadata_backend/api/views.py:25: error: Item \"MultipartReader\" of \"Union[MultipartReader, BodyPartReader, None]\" has no attribute \"read\"\r\nmetadata_backend/api/views.py:25: error: Item \"None\" of \"Union[MultipartReader, BodyPartReader, None]\" has no attribute \"read\"\r\nmetadata_backend/api/views.py:28: error: Item \"MultipartReader\" of \"Union[MultipartReader, BodyPartReader, None]\" has no attribute \"name\"\r\nmetadata_backend/api/views.py:28: error: Item \"None\" of \"Union[MultipartReader, BodyPartReader, None]\" has no attribute \"name\"\r\nmetadata_backend/api/views.py:29: error: Item \"MultipartReader\" of \"Union[MultipartReader, BodyPartReader, None]\" has no attribute \"filename\"\r\nmetadata_backend/api/views.py:29: error: Item \"None\" of \"Union[MultipartReader, BodyPartReader, None]\" has no attribute \"filename\"\r\nmetadata_backend/api/views.py:34: error: Item \"MultipartReader\" of \"Union[MultipartReader, BodyPartReader, None]\" has no attribute \"read_chunk\"\r\nmetadata_backend/api/views.py:34: error: Item \"None\" of \"Union[MultipartReader, BodyPartReader, None]\" has no attribute \"read_chunk\"\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.7.7\r\n...\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\n...\r\nName: aiohttp\r\nVersion: 3.6.2\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/otahontas/.cache/pyenv/versions/3.7.7/envs/metadata-submitter-37/lib/python3.7/site-packages\r\nRequires: async-timeout, attrs, yarl, multidict, chardet\r\nRequired-by: metadata-backend, aiohttp-devtools\r\n```\r\n```console\r\n$ python -m pip show multidict\r\n...\r\nName: multidict\r\nVersion: 4.7.5\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/otahontas/.cache/pyenv/versions/3.7.7/envs/metadata-submitter-37/lib/python3.7/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n```\r\n```console\r\n$ python -m pip show yarl\r\n...\r\nName: yarl\r\nVersion: 1.4.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/otahontas/.cache/pyenv/versions/3.7.7/envs/metadata-submitter-37/lib/python3.7/site-packages\r\nRequires: multidict, idna\r\nRequired-by: aiohttp\r\n\r\n```", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4746/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4746/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4745", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4745/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4745/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4745/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4745", "id": 618655580, "node_id": "MDU6SXNzdWU2MTg2NTU1ODA=", "number": 4745, "title": "Unclosed client session warning", "user": {"login": "hn-sl", "id": 48025074, "node_id": "MDQ6VXNlcjQ4MDI1MDc0", "avatar_url": "https://avatars.githubusercontent.com/u/48025074?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hn-sl", "html_url": "https://github.com/hn-sl", "followers_url": "https://api.github.com/users/hn-sl/followers", "following_url": "https://api.github.com/users/hn-sl/following{/other_user}", "gists_url": "https://api.github.com/users/hn-sl/gists{/gist_id}", "starred_url": "https://api.github.com/users/hn-sl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hn-sl/subscriptions", "organizations_url": "https://api.github.com/users/hn-sl/orgs", "repos_url": "https://api.github.com/users/hn-sl/repos", "events_url": "https://api.github.com/users/hn-sl/events{/privacy}", "received_events_url": "https://api.github.com/users/hn-sl/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-05-15T02:38:14Z", "updated_at": "2020-05-15T03:38:33Z", "closed_at": "2020-05-15T03:37:15Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nWe see rare logs with error level ERROR saying Unclosed client session which is very hard to reproduce, during normal operation.\r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\nRun below codes for a long time, at least few hours. The code is from my production application after removing all irrelevant codes.\r\n```\r\nimport aiohttp\r\nimport asyncio\r\n\r\nURL = \"Some URL\"\r\n\r\n\r\nclass Client:\r\n    def __init__(self):\r\n        self._session = aiohttp.ClientSession()\r\n\r\n    async def get(self, url: str):\r\n        async with self._session.get(url) as response:\r\n            assert response.status == 200\r\n            return await response.text()\r\n\r\n    async def close(self):\r\n        await self._session.close()\r\n\r\n\r\nasync def main():\r\n    client = Client()\r\n\r\n    try:\r\n        while True:\r\n            data = await client.get(URL)\r\n            await asyncio.sleep(10)\r\n\r\n    finally:\r\n        await client.close()\r\n\r\n\r\nif __name__ == '__main__':\r\n    asyncio.run(main())\r\n```\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\nNo log\r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\nUnclosed client session\r\nclient_session: <aiohttp.client.ClientSession object at 0x7ffb55b20d90>\"\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.8.2\r\n...\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.6.2\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/ec2-user/anaconda3/envs/py38/lib/python3.8/site-packages\r\nRequires: yarl, multidict, async-timeout, attrs, chardet\r\nRequired-by: slackclient\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.5\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/ec2-user/anaconda3/envs/py38/lib/python3.8/site-packages\r\nRequires:\r\nRequired-by: yarl, aiohttp\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.4.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/ec2-user/anaconda3/envs/py38/lib/python3.8/site-packages\r\nRequires: multidict, idna\r\nRequired-by: aiohttp\r\n```\r\n\r\n\ud83d\udccb **OS**\r\nNAME=\"Amazon Linux\"\r\nVERSION=\"2\"\r\nID=\"amzn\"\r\nID_LIKE=\"centos rhel fedora\"\r\nVERSION_ID=\"2\"\r\nPRETTY_NAME=\"Amazon Linux 2\"\r\nANSI_COLOR=\"0;33\"\r\nCPE_NAME=\"cpe:2.3:o:amazon:amazon_linux:2\"\r\nHOME_URL=\"https://amazonlinux.com/\"\r\nAmazon Linux release 2 (Karoo)\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4745/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4745/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4727", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4727/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4727/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4727/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4727", "id": 614201749, "node_id": "MDU6SXNzdWU2MTQyMDE3NDk=", "number": 4727, "title": "TooManyRedirects Exception from aiohttp through Proxy but works in cURL", "user": {"login": "bokklu", "id": 26428189, "node_id": "MDQ6VXNlcjI2NDI4MTg5", "avatar_url": "https://avatars.githubusercontent.com/u/26428189?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bokklu", "html_url": "https://github.com/bokklu", "followers_url": "https://api.github.com/users/bokklu/followers", "following_url": "https://api.github.com/users/bokklu/following{/other_user}", "gists_url": "https://api.github.com/users/bokklu/gists{/gist_id}", "starred_url": "https://api.github.com/users/bokklu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bokklu/subscriptions", "organizations_url": "https://api.github.com/users/bokklu/orgs", "repos_url": "https://api.github.com/users/bokklu/repos", "events_url": "https://api.github.com/users/bokklu/events{/privacy}", "received_events_url": "https://api.github.com/users/bokklu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-05-07T16:50:41Z", "updated_at": "2020-05-07T19:34:37Z", "closed_at": "2020-05-07T19:34:37Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nExplanation should be straight forward. All I am trying to do is to website in my case http://example.com via an HTTP proxy via the aiohttp package. Through this package it doesn't seem to work and I am getting TooManyRedirects exception. Strangely enough, I tried the same connect in cURL cmd on windows, and it works every time.\r\n\r\nThis behaviour only happens on some proxies, but I find it strange that these set of proxies work manually from curl but not from aiohttp. Am I maybe missing something?\r\n\r\nPython Exception Example:\r\n![image](https://user-images.githubusercontent.com/26428189/81320937-38c0b600-9092-11ea-80cb-f5b1bd3660e8.png)\r\n\r\ncURL cmd Example:\r\n![image](https://user-images.githubusercontent.com/26428189/81320961-41b18780-9092-11ea-8288-6928e08cbfe8.png)\r\n\r\n\r\nTried on both Python 3.8.2 and Python 3.7.x and it resulted in the same exception.\r\naiohttp version: 3.6.2\r\nasyncio version: 3.4.3\r\nPlatform: Windows 10\r\n\r\nSimilar proxies which have the same behaviour where they work on cURL but fail in aiohttp:\r\n188.226.141.211:3128\r\n5.252.161.48:8080\r\n188.166.83.17:8080\r\n154.16.202.22:8080\r\n188.226.141.211:3128\r\n188.226.141.211:8080\r\n5.252.161.48:3128\r\n\r\n(I can provide more if needed)\r\n\r\n\ud83d\udca1 **To Reproduce**\r\nRun the given script:\r\n\r\n\r\n```\r\nimport asyncio\r\nimport aiohttp\r\nimport async_timeout\r\n\r\n\r\nasync def check_http():\r\n    async with aiohttp.ClientSession() as session:\r\n        try:\r\n            async with async_timeout.timeout(8):\r\n                async with session.get('http://example.com', proxy=f'http://207.154.231.213:8080') as response:\r\n                    await response\r\n        except Exception as ex:\r\n            print(ex)\r\n\r\n\r\nasync def fetch():\r\n    tasks = []\r\n    for i in range(100):\r\n        tasks.append(asyncio.create_task(check_http()))\r\n\r\n    await asyncio.gather(*tasks)\r\n\r\nloop = asyncio.get_event_loop()\r\nloop.run_until_complete(fetch())\r\n```\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\nI expected that the connection in aiohttp would return a status 200 OK .\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n\r\n`Python 3.8.2`\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n...\r\nName: aiohttp\r\nVersion: 3.6.2\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: e:\\applications\\python 3.8\\lib\\site-packages\r\nRequires: async-timeout, attrs, yarl, multidict, chardet\r\nRequired-by: aiosocks\r\n\r\nName: multidict\r\nVersion: 4.7.5\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: e:\\applications\\python 3.8\\lib\\site-packages\r\nRequires:\r\nRequired-by: yarl, aiohttp\r\n\r\nName: yarl\r\nVersion: 1.4.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: e:\\applications\\python 3.8\\lib\\site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4727/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4727/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4723", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4723/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4723/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4723/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4723", "id": 609296335, "node_id": "MDU6SXNzdWU2MDkyOTYzMzU=", "number": 4723, "title": "False warning and failure: The object should be created from async function", "user": {"login": "AndreVallestero", "id": 39736205, "node_id": "MDQ6VXNlcjM5NzM2MjA1", "avatar_url": "https://avatars.githubusercontent.com/u/39736205?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AndreVallestero", "html_url": "https://github.com/AndreVallestero", "followers_url": "https://api.github.com/users/AndreVallestero/followers", "following_url": "https://api.github.com/users/AndreVallestero/following{/other_user}", "gists_url": "https://api.github.com/users/AndreVallestero/gists{/gist_id}", "starred_url": "https://api.github.com/users/AndreVallestero/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AndreVallestero/subscriptions", "organizations_url": "https://api.github.com/users/AndreVallestero/orgs", "repos_url": "https://api.github.com/users/AndreVallestero/repos", "events_url": "https://api.github.com/users/AndreVallestero/events{/privacy}", "received_events_url": "https://api.github.com/users/AndreVallestero/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-04-29T19:18:10Z", "updated_at": "2020-11-23T09:52:34Z", "closed_at": "2020-11-23T09:52:34Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nReviving warning \"The object should be created from async function\" even though it is inside an async function. This results in `session.request()` to fail.\r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n1. Install ProxyBroker\r\n2. Try running `broker.find()` within a `coro`\r\n3. Warning raised on session object creation line 79 of https://github.com/constverum/ProxyBroker/blob/master/proxybroker/providers.py\r\n4. Call `session.request()` or request family and it will fail every time\r\n\r\n\ud83d\udccb Logs/tracebacks\r\n```console\r\nC:\\Program Files\\Python37\\lib\\site-packages\\proxybroker\\providers.py:78: DeprecationWarning: The object should be created from async function\r\n  headers=get_headers(), cookies=self._cookies, loop=self._loop\r\nC:\\Program Files\\Python37\\lib\\site-packages\\aiohttp\\connector.py:731: DeprecationWarning: The object should be created from async function\r\n  loop=loop)\r\nC:\\Program Files\\Python37\\lib\\site-packages\\aiohttp\\cookiejar.py:55: DeprecationWarning: The object should be created from async function\r\n  super().__init__(loop=loop)\r\n```\r\n\r\n\ud83d\udca1 **Expected behavior**\r\nNo warning is raised on session creation and `session.request()` works as intended\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n```console\r\n$ python --version\r\nPython 3.7.7\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.6.2\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\program files\\python37\\lib\\site-packages\r\nRequires: async-timeout, multidict, chardet, yarl, attrs\r\nRequired-by: proxybroker\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.5\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\program files\\python37\\lib\\site-packages\r\nRequires:\r\nRequired-by: yarl, aiohttp\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.4.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\program files\\python37\\lib\\site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\naiohttp[speedups]\r\nWindows 10\r\nClient\r\n\r\nThis bug seems to be the main cause for issue #135 of ProxyBroker:\r\nhttps://github.com/constverum/ProxyBroker/issues/135", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4723/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4723/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4722", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4722/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4722/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4722/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4722", "id": 609043457, "node_id": "MDU6SXNzdWU2MDkwNDM0NTc=", "number": 4722, "title": "Incorrect case in document docs/tracing_reference.rst", "user": {"login": "WH-2099", "id": 24429314, "node_id": "MDQ6VXNlcjI0NDI5MzE0", "avatar_url": "https://avatars.githubusercontent.com/u/24429314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WH-2099", "html_url": "https://github.com/WH-2099", "followers_url": "https://api.github.com/users/WH-2099/followers", "following_url": "https://api.github.com/users/WH-2099/following{/other_user}", "gists_url": "https://api.github.com/users/WH-2099/gists{/gist_id}", "starred_url": "https://api.github.com/users/WH-2099/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WH-2099/subscriptions", "organizations_url": "https://api.github.com/users/WH-2099/orgs", "repos_url": "https://api.github.com/users/WH-2099/repos", "events_url": "https://api.github.com/users/WH-2099/events{/privacy}", "received_events_url": "https://api.github.com/users/WH-2099/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-04-29T13:08:06Z", "updated_at": "2021-01-29T23:02:39Z", "closed_at": "2021-01-29T23:02:39Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nIncorrect case in document `docs/tracing_reference.rst`.\r\nAttribute **Host** should be **host**.\r\n```\r\nTraceDnsResolveHostStartParams\r\n------------------------------\r\n\r\n.. class:: TraceDnsResolveHostStartParams\r\n\r\n   See :attr:`TraceConfig.on_dns_resolvehost_start` for details.\r\n\r\n   .. attribute:: Host\r\n\r\n       Host that will be resolved.\r\n\r\nTraceDnsResolveHostEndParams\r\n----------------------------\r\n\r\n.. class:: TraceDnsResolveHostEndParams\r\n\r\n   See :attr:`TraceConfig.on_dns_resolvehost_end` for details.\r\n\r\n   .. attribute:: Host\r\n\r\n       Host that has been resolved.\r\n\r\nTraceDnsCacheHitParams\r\n----------------------\r\n\r\n.. class:: TraceDnsCacheHitParams\r\n\r\n   See :attr:`TraceConfig.on_dns_cache_hit` for details.\r\n\r\n   .. attribute:: Host\r\n\r\n       Host found in the cache.\r\n\r\nTraceDnsCacheMissParams\r\n-----------------------\r\n\r\n.. class:: TraceDnsCacheMissParams\r\n\r\n   See :attr:`TraceConfig.on_dns_cache_miss` for details.\r\n\r\n   .. attribute:: Host\r\n\r\n       Host didn't find the cache.\r\n```\r\n\r\n\ud83d\udca1 **Source code**\r\nsource code file: `aiohttp/aiohttp/tracing.py`\r\nline: 233-254\r\n```python\r\n@attr.s(frozen=True, slots=True)\r\nclass TraceDnsResolveHostStartParams:\r\n    \"\"\" Parameters sent by the `on_dns_resolvehost_start` signal\"\"\"\r\n    host = attr.ib(type=str)\r\n\r\n\r\n@attr.s(frozen=True, slots=True)\r\nclass TraceDnsResolveHostEndParams:\r\n    \"\"\" Parameters sent by the `on_dns_resolvehost_end` signal\"\"\"\r\n    host = attr.ib(type=str)\r\n\r\n\r\n@attr.s(frozen=True, slots=True)\r\nclass TraceDnsCacheHitParams:\r\n    \"\"\" Parameters sent by the `on_dns_cache_hit` signal\"\"\"\r\n    host = attr.ib(type=str)\r\n\r\n\r\n@attr.s(frozen=True, slots=True)\r\nclass TraceDnsCacheMissParams:\r\n    \"\"S\" Parameters sent by the `on_dns_cache_miss` signal\"\"\"\r\n    host = attr.ib(type=str)\r\n```\r\n\r\n\r\n\ud83d\udc1e **Supplement**\r\nAnd there is a wrong attribute name.\r\nThe second `TraceRequestChunkSentParams` should be `TraceResponseChunkReceivedParams`.\r\n```\r\nTraceRequestChunkSentParams\r\n---------------------------\r\n\r\n.. class:: TraceRequestChunkSentParams\r\n\r\n   .. versionadded:: 3.1\r\n\r\n   See :attr:`TraceConfig.on_request_chunk_sent` for details.\r\n\r\n   .. attribute:: chunk\r\n\r\n       Bytes of chunk sent\r\n\r\n\r\nTraceResponseChunkSentParams\r\n----------------------------\r\n\r\n.. class:: TraceResponseChunkSentParams\r\n\r\n   .. versionadded:: 3.1\r\n\r\n   See :attr:`TraceConfig.on_response_chunk_received` for details.\r\n\r\n   .. attribute:: chunk\r\n\r\n       Bytes of chunk received\r\n```\r\n\r\n\r\n\r\n\ud83d\udccb **Pull  Request**\r\nBoth fixed in #4721 \r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4722/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4722/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4703", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4703/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4703/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4703/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4703", "id": 603989545, "node_id": "MDU6SXNzdWU2MDM5ODk1NDU=", "number": 4703, "title": "ResourceWarning:unclosed transport", "user": {"login": "spacemanspiff2007", "id": 10754716, "node_id": "MDQ6VXNlcjEwNzU0NzE2", "avatar_url": "https://avatars.githubusercontent.com/u/10754716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spacemanspiff2007", "html_url": "https://github.com/spacemanspiff2007", "followers_url": "https://api.github.com/users/spacemanspiff2007/followers", "following_url": "https://api.github.com/users/spacemanspiff2007/following{/other_user}", "gists_url": "https://api.github.com/users/spacemanspiff2007/gists{/gist_id}", "starred_url": "https://api.github.com/users/spacemanspiff2007/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spacemanspiff2007/subscriptions", "organizations_url": "https://api.github.com/users/spacemanspiff2007/orgs", "repos_url": "https://api.github.com/users/spacemanspiff2007/repos", "events_url": "https://api.github.com/users/spacemanspiff2007/events{/privacy}", "received_events_url": "https://api.github.com/users/spacemanspiff2007/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 303800438, "node_id": "MDU6TGFiZWwzMDM4MDA0Mzg=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/need%20pull%20request", "name": "need pull request", "color": "bfdadc", "default": false, "description": null}, {"id": 344995986, "node_id": "MDU6TGFiZWwzNDQ5OTU5ODY=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/client", "name": "client", "color": "bfd4f2", "default": false, "description": null}, {"id": 1831256427, "node_id": "MDU6TGFiZWwxODMxMjU2NDI3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/reproducer:%20present", "name": "reproducer: present", "color": "c2e0c6", "default": false, "description": "This PR or issue contains code, which reproduce the problem described or clearly understandable STR"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2020-04-21T13:16:00Z", "updated_at": "2020-10-22T08:27:47Z", "closed_at": "2020-10-21T18:41:33Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nI have a long running application that creates requests with aiohttp.\r\nSome requests have a long time between them. \r\nAfter a certain time without a request a ResourceWarning appears in the log:\r\n```\r\nC:\\venv\\lib\\asyncio\\sslproto.py:322: ResourceWarning:unclosed transport <asyncio.sslproto._SSLProtocolTransport object at 0x0000000003FA9A88>\r\n```\r\nIt is server depended, my guess is that the server closes the connection.\r\nFor ``https://heise.de`` the time is at around 125secs.\r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n```python\r\nimport asyncio\r\nimport datetime\r\nimport warnings\r\n\r\nimport aiohttp\r\n\r\n\r\ndef get_ts():\r\n    return f'{datetime.datetime.now()} |'\r\n\r\n\r\ndef print_warnings(message, category, filename, lineno, file=None, line=None):\r\n    print('%s %s:%s: %s:%s' % (get_ts(), filename, lineno, category.__name__, message))\r\n    return\r\n\r\n\r\n# Setup deprecation warnings\r\nwarnings.simplefilter('default')\r\nwarnings.showwarning = print_warnings\r\n\r\n\r\nloop = asyncio.get_event_loop()\r\n\r\n\r\nasync def run():\r\n    sleep = 55\r\n    client = aiohttp.ClientSession(loop=loop)\r\n    \r\n    while True:\r\n        async with client.get('https://creativecommons.tankerkoenig.de/json/list.php?lat=52.521&lng=13.438&rad=1.5&sort=dist&type=all&apikey=00000000-0000-0000-0000-000000000002') as resp:\r\n            status = resp.status\r\n            data = await resp.text()\r\n        \r\n        print(f'{get_ts()} sleep: {sleep}, Status: {status}')\r\n        sleep += 5\r\n        await asyncio.sleep(sleep)\r\n\r\n\r\nloop.run_until_complete(run())\r\n```\r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\n2020-04-21 15:05:10.750123 | sleep: 55, Status: 200\r\n2020-04-21 15:06:10.857561 | sleep: 60, Status: 200\r\n2020-04-21 15:07:16.039289 | sleep: 65, Status: 200\r\n2020-04-21 15:08:21.037007 | C:\\venv\\lib\\asyncio\\sslproto.py:322: ResourceWarning:unclosed transport <asyncio.sslproto._SSLProtocolTransport object at 0x0000000003FA9A88>\r\n2020-04-21 15:08:26.135299 | sleep: 70, Status: 200\r\n```\r\n\r\n\ud83d\udccb **Versions**\r\n```console\r\nPython 3.7.4\r\n```\r\n```console\r\nName: aiohttp\r\nVersion: 3.6.2\r\n```\r\n```console\r\nName: yarl\r\nVersion: 1.3.0\r\n```", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4703/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4703/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4695", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4695/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4695/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4695/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4695", "id": 601808827, "node_id": "MDU6SXNzdWU2MDE4MDg4Mjc=", "number": 4695, "title": "Unable to patch with decorator using unittest_run_loop", "user": {"login": "WisdomPill", "id": 5825811, "node_id": "MDQ6VXNlcjU4MjU4MTE=", "avatar_url": "https://avatars.githubusercontent.com/u/5825811?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WisdomPill", "html_url": "https://github.com/WisdomPill", "followers_url": "https://api.github.com/users/WisdomPill/followers", "following_url": "https://api.github.com/users/WisdomPill/following{/other_user}", "gists_url": "https://api.github.com/users/WisdomPill/gists{/gist_id}", "starred_url": "https://api.github.com/users/WisdomPill/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WisdomPill/subscriptions", "organizations_url": "https://api.github.com/users/WisdomPill/orgs", "repos_url": "https://api.github.com/users/WisdomPill/repos", "events_url": "https://api.github.com/users/WisdomPill/events{/privacy}", "received_events_url": "https://api.github.com/users/WisdomPill/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-04-17T08:48:03Z", "updated_at": "2020-04-20T19:46:29Z", "closed_at": "2020-04-20T19:46:28Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n\r\npatch using decorators is not possible while using unittest_run_loop, \r\nto overcome this issue patching with context manager is needed, it can be a real pain to do it multiple times in the same test case. The arguments are not passed to the unittest test case method.\r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n\r\n```python\r\nfrom unittest.mock import patch\r\n\r\nfrom aiohttp.test_utils import AioHTTPTestCase, make_mocked_coro, unittest_run_loop\r\nfrom aiohttp.web_app import Application\r\nfrom aiohttp.web_request import Request\r\nfrom aiohttp.web_response import Response\r\nfrom aiohttp.web_routedef import get\r\n\r\n\r\nasync def do_something():\r\n    print('something')\r\n\r\n\r\nasync def ping(request: Request) -> Response:\r\n    await do_something()\r\n    return Response(text='pong')\r\n\r\n\r\nclass TestApplication(AioHTTPTestCase):\r\n    def get_app(self) -> Application:\r\n        app = Application()\r\n        app.router.add_routes([\r\n            get('/ping/', ping)\r\n        ])\r\n\r\n        return app\r\n\r\n    @unittest_run_loop\r\n    async def test_ping(self):\r\n        resp = await self.client.get('/ping/')\r\n\r\n        self.assertEqual(resp.status, 200)\r\n        self.assertEqual(await resp.text(), 'pong')\r\n\r\n    @unittest_run_loop\r\n    async def test_ping_mocked_do_something(self):\r\n        with patch('test_bug.do_something', make_mocked_coro()) as do_something_patch:\r\n            resp = await self.client.get('/ping/')\r\n\r\n            self.assertEqual(resp.status, 200)\r\n            self.assertEqual(await resp.text(), 'pong')\r\n\r\n            self.assertTrue(do_something_patch.called)\r\n\r\n    @unittest_run_loop\r\n    @patch('test_bug.do_something', make_mocked_coro())\r\n    async def test_ping_mocked_do_something_decorated(self, do_something_patch):\r\n        resp = await self.client.get('/ping/')\r\n\r\n        self.assertEqual(resp.status, 200)\r\n        self.assertEqual(await resp.text(), 'pong')\r\n\r\n        self.assertTrue(do_something_patch.called)\r\n\r\n```\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n\r\nI expect to be able to use decorators to patch or mock a module/function\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\nsomething\r\n\r\n\r\nRan 3 tests in 0.080s\r\n\r\nFAILED (errors=1)\r\n\r\nError\r\nTraceback (most recent call last):\r\n  File \"/usr/local/Cellar/python/3.7.6_1/Frameworks/Python.framework/Versions/3.7/lib/python3.7/unittest/case.py\", line 59, in testPartExecutor\r\n    yield\r\n  File \"/usr/local/Cellar/python/3.7.6_1/Frameworks/Python.framework/Versions/3.7/lib/python3.7/unittest/case.py\", line 628, in run\r\n    testMethod()\r\n  File \"/Users/anas/.envs/timing_router/lib/python3.7/site-packages/aiohttp/test_utils.py\", line 488, in new_func\r\n    func(self, *inner_args, **inner_kwargs))\r\n  File \"/usr/local/Cellar/python/3.7.6_1/Frameworks/Python.framework/Versions/3.7/lib/python3.7/unittest/mock.py\", line 1255, in patched\r\n    return func(*args, **keywargs)\r\nTypeError: test_ping_mocked_do_something_decorated() missing 1 required positional argument: 'do_something_patch'\r\n\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n\r\n```console\r\n$ python --version\r\nPython 3.7.6\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.6.2\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/anas/.envs/timing_router/lib/python3.7/site-packages\r\nRequires: chardet, yarl, attrs, multidict, async-timeout\r\nRequired-by: \r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.5\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/anas/.envs/timing_router/lib/python3.7/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.4.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /Users/anas/.envs/timing_router/lib/python3.7/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\nmacOS catalina\r\naiohttp - server", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4695/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4695/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4694", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4694/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4694/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4694/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4694", "id": 600782137, "node_id": "MDU6SXNzdWU2MDA3ODIxMzc=", "number": 4694, "title": "Event loop closed error comes when trying to get multiple requests", "user": {"login": "HarsheetKakar", "id": 42893005, "node_id": "MDQ6VXNlcjQyODkzMDA1", "avatar_url": "https://avatars.githubusercontent.com/u/42893005?v=4", "gravatar_id": "", "url": "https://api.github.com/users/HarsheetKakar", "html_url": "https://github.com/HarsheetKakar", "followers_url": "https://api.github.com/users/HarsheetKakar/followers", "following_url": "https://api.github.com/users/HarsheetKakar/following{/other_user}", "gists_url": "https://api.github.com/users/HarsheetKakar/gists{/gist_id}", "starred_url": "https://api.github.com/users/HarsheetKakar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/HarsheetKakar/subscriptions", "organizations_url": "https://api.github.com/users/HarsheetKakar/orgs", "repos_url": "https://api.github.com/users/HarsheetKakar/repos", "events_url": "https://api.github.com/users/HarsheetKakar/events{/privacy}", "received_events_url": "https://api.github.com/users/HarsheetKakar/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344995986, "node_id": "MDU6TGFiZWwzNDQ5OTU5ODY=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/client", "name": "client", "color": "bfd4f2", "default": false, "description": null}, {"id": 1831255463, "node_id": "MDU6TGFiZWwxODMxMjU1NDYz", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/reproducer:%20missing", "name": "reproducer: missing", "color": "e23c36", "default": false, "description": "This PR or issue lacks code, which reproduce the problem described or clearly understandable STR"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2020-04-16T06:30:40Z", "updated_at": "2020-04-28T11:31:21Z", "closed_at": "2020-04-28T11:31:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nI tried using `gather` instead of `wait` the result was same\r\n\ud83d\udca1 **To Reproduce**\r\n```python\r\nimport asyncio\r\nimport aiohttp\r\n\r\nasync def fetch(session, url):\r\n    async with session.get(\r\n            url) as resp:\r\n        print(resp.status)\r\n        data = await resp.text()\r\n        return (data)\r\n\r\nasync def go():\r\n    async with aiohttp.ClientSession() as session:\r\n        return await fetch(session, 'https://www.google.com/')\r\n\r\nasync def now():\r\n    async with aiohttp.ClientSession() as session:\r\n        return await fetch(session, 'https://www.google.com/')\r\n\r\n\r\nloop = asyncio.new_event_loop()\r\ncoroutine1 = go()\r\ncoroutine2 = now()\r\ntask1 = loop.create_task(coroutine1)\r\ntask2 = loop.create_task(coroutine2)\r\nloop.run_until_complete(asyncio.wait([task1, task2]))\r\nprint('task1 result:', task1.result())\r\nprint('task2 result:', task2.result())\r\nloop.close()\r\n```\r\n<!-- How to reproduce the behavior?\r\n\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\nNo error\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\nTraceback (most recent call last):\r\nFile \"C:\\Users\\Hitman\\AppData\\Local\\Programs\\Python\\Python38\\lib\\asyncio\\proactor_events.py\", line 116, in del\r\nself.close()\r\nFile \"C:\\Users\\Hitman\\AppData\\Local\\Programs\\Python\\Python38\\lib\\asyncio\\proactor_events.py\", line 108, in close\r\nself._loop.call_soon(self._call_connection_lost, None)\r\nFile \"C:\\Users\\Hitman\\AppData\\Local\\Programs\\Python\\Python38\\lib\\asyncio\\base_events.py\", line 719, in call_soon\r\nself._check_closed()\r\nFile \"C:\\Users\\Hitman\\AppData\\Local\\Programs\\Python\\Python38\\lib\\asyncio\\base_events.py\", line 508, in _check_closed\r\nraise RuntimeError('Event loop is closed')\r\nRuntimeError: Event loop is closed\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.8.2\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.6.2\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: c:\\users\\hitman\\appdata\\local\\programs\\python\\python38\\lib\\site-packages\r\nRequires: yarl, chardet, attrs, async-timeout, multidict\r\nRequired-by:\r\n```\r\n\r\n```console\r\n$ python -m pip show multidict\r\nName: aiohttp\r\nVersion: 3.0.9\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp/\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: d:\\projects\\asyncio\\venv\\lib\\site-packages\r\nRequires: attrs, chardet, async-timeout, multidict, yarl\r\nRequired-by:\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.4.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: d:\\projects\\asyncio\\venv\\lib\\site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4694/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4694/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4691", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4691/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4691/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4691/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4691", "id": 599214337, "node_id": "MDU6SXNzdWU1OTkyMTQzMzc=", "number": 4691, "title": "Cannot have python keyword in route name", "user": {"login": "jrozentur", "id": 42448528, "node_id": "MDQ6VXNlcjQyNDQ4NTI4", "avatar_url": "https://avatars.githubusercontent.com/u/42448528?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jrozentur", "html_url": "https://github.com/jrozentur", "followers_url": "https://api.github.com/users/jrozentur/followers", "following_url": "https://api.github.com/users/jrozentur/following{/other_user}", "gists_url": "https://api.github.com/users/jrozentur/gists{/gist_id}", "starred_url": "https://api.github.com/users/jrozentur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jrozentur/subscriptions", "organizations_url": "https://api.github.com/users/jrozentur/orgs", "repos_url": "https://api.github.com/users/jrozentur/repos", "events_url": "https://api.github.com/users/jrozentur/events{/privacy}", "received_events_url": "https://api.github.com/users/jrozentur/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344996043, "node_id": "MDU6TGFiZWwzNDQ5OTYwNDM=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/server", "name": "server", "color": "006b75", "default": false, "description": null}, {"id": 1363888951, "node_id": "MDU6TGFiZWwxMzYzODg4OTUx", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/pr-available", "name": "pr-available", "color": "363396", "default": false, "description": null}, {"id": 1831255463, "node_id": "MDU6TGFiZWwxODMxMjU1NDYz", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/reproducer:%20missing", "name": "reproducer: missing", "color": "e23c36", "default": false, "description": "This PR or issue lacks code, which reproduce the problem described or clearly understandable STR"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-04-14T00:27:06Z", "updated_at": "2020-10-15T17:10:09Z", "closed_at": "2020-10-15T17:10:09Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nThis code is rejected with 'Incorrect route name':\r\n```python\r\n@app_routes.get('/result/', name='check-for-result')\r\nasync def result(request):\r\n```\r\n\r\nThis is because 'for' is a keyword, and the check rejects any keywords for some strange reason:\r\nin https://github.com/aio-libs/aiohttp/blob/master/aiohttp/web_urldispatcher.py#L982\r\n```python\r\nparts = self.NAME_SPLIT_RE.split(name)\r\nfor part in parts:\r\n      if not part.isidentifier() or keyword.iskeyword(part):\r\n           raise ValueError\r\n```\r\nI think the intention was to have:\r\n```python\r\nif not (part.isidentifier() or keyword.iskeyword(part))\r\n```\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\n\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\nShould accept route names containing python keywords\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\n\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.7.4\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nVersion: 3.6.2\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nVersion: 4.7.5\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nVersion: 1.3.0\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4691/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4691/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4678", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4678/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4678/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4678/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4678", "id": 597188532, "node_id": "MDU6SXNzdWU1OTcxODg1MzI=", "number": 4678, "title": "\"Malformed multipart body.\" when uploading to VirusTotal", "user": {"login": "lilydjwg", "id": 440661, "node_id": "MDQ6VXNlcjQ0MDY2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/440661?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lilydjwg", "html_url": "https://github.com/lilydjwg", "followers_url": "https://api.github.com/users/lilydjwg/followers", "following_url": "https://api.github.com/users/lilydjwg/following{/other_user}", "gists_url": "https://api.github.com/users/lilydjwg/gists{/gist_id}", "starred_url": "https://api.github.com/users/lilydjwg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lilydjwg/subscriptions", "organizations_url": "https://api.github.com/users/lilydjwg/orgs", "repos_url": "https://api.github.com/users/lilydjwg/repos", "events_url": "https://api.github.com/users/lilydjwg/events{/privacy}", "received_events_url": "https://api.github.com/users/lilydjwg/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2020-04-09T10:36:46Z", "updated_at": "2023-04-29T03:53:56Z", "closed_at": "2023-04-29T03:53:56Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n\r\nWhen uploading large files to VirusTotal I get `Malformed multipart body.` Removing https://github.com/aio-libs/aiohttp/blob/50753eace15da24a9fb9774bcfcaa1dc7650164e/aiohttp/helpers.py#L371-L372 and it worked.\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n\r\n1. Register and get an API key from VirusTotal\r\n2. Try to upload a file with this API: https://developers.virustotal.com/v3.0/reference#files-upload-url\r\n```python\r\n    data = FormData()\r\n    data.add_field(\r\n      'file', content,\r\n      filename = filename,\r\n      content_type = 'application/octet-stream',\r\n    )\r\n```\r\n3. Get a plain text error message `Malformed multipart body.`\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\n\r\nFile should be accepted and a JSON be returned.\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\n\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n\r\nPython 3.7.3\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.5.1\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/lib/python3/dist-packages\r\nRequires:\r\nRequired-by:\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.5.2\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/lib/python3/dist-packages\r\nRequires: \r\nRequired-by: \r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.3.0\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/lib/python3/dist-packages\r\nRequires: \r\nRequired-by: \r\n\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\nSearching Google for the error message and it seems that Google Drive and YouTube might be using the same server API.\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4678/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4678/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4677", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4677/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4677/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4677/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4677", "id": 596396477, "node_id": "MDU6SXNzdWU1OTYzOTY0Nzc=", "number": 4677, "title": "ClientPayloadError on some website", "user": {"login": "ZeusFSX", "id": 22007867, "node_id": "MDQ6VXNlcjIyMDA3ODY3", "avatar_url": "https://avatars.githubusercontent.com/u/22007867?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ZeusFSX", "html_url": "https://github.com/ZeusFSX", "followers_url": "https://api.github.com/users/ZeusFSX/followers", "following_url": "https://api.github.com/users/ZeusFSX/following{/other_user}", "gists_url": "https://api.github.com/users/ZeusFSX/gists{/gist_id}", "starred_url": "https://api.github.com/users/ZeusFSX/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ZeusFSX/subscriptions", "organizations_url": "https://api.github.com/users/ZeusFSX/orgs", "repos_url": "https://api.github.com/users/ZeusFSX/repos", "events_url": "https://api.github.com/users/ZeusFSX/events{/privacy}", "received_events_url": "https://api.github.com/users/ZeusFSX/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-04-08T08:19:32Z", "updated_at": "2020-10-16T09:23:49Z", "closed_at": "2020-10-16T09:23:49Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nWhen I try to get some data from the website, I get error __Response payload is not completed__.\r\nBut when I use python-requests all is OK.\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n````\r\nimport aiohttp\r\nimport asyncio\r\n\r\n\r\nasync def fetch():\r\n    async with aiohttp.ClientSession() as session:\r\n        headers = {\r\n            \"User-Agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_3) AppleWebKit/537.36 (KHTML, like Gecko) \"\r\n                          \"Chrome/80.0.3987.132 Safari/537.36\",\r\n            \"Accept-Language\": \"uk-UA,uk;q=0.9,ru-RU,ru;q=0.8,en-US;q=0.7,en;q=0.6,*;q=0.5\"\r\n        }\r\n        remote_resp = await session.request(\"GET\", \"https://11tv.dp.ua/\", ssl=False, headers=headers)\r\n        print(remote_resp)\r\n        await remote_resp.text()\r\n\r\n\r\nloop = asyncio.get_event_loop()\r\ntask = asyncio.wait([fetch()])\r\nloop.run_until_complete(task)\r\n````\r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```\r\n<ClientResponse(https://11tv.dp.ua/) [200 OK]>\r\n<CIMultiDictProxy('Date': 'Wed, 08 Apr 2020 08:08:51 GMT', 'Server': 'Apache', 'Vary': 'Accept-Encoding,Cookie', 'Upgrade': 'h2,h2c', 'Connection': 'Upgrade', 'Accept-Ranges': 'bytes', 'X-Mod-Pagespeed': '1.12.34.2-0', 'Cache-Control': 'max-age=0, no-cache, must-revalidate', 'Content-Encoding': 'gzip', 'Strict-Transport-Security': 'max-age=31536000; includeSubDomains; preload', 'X-XSS-Protection': '1; mode=block', 'Referrer-Policy': 'no-referrer-when-downgrade', 'X-Pingback': 'https://11tv.dp.ua/xmlrpc.php', 'Pragma': 'public', 'Link': '</wp-content/cache/minify/78a52.js?x64856>; rel=preload; as=script', 'Link': '</wp-content/cache/minify/545b0.js?x64856>; rel=preload; as=script', 'Link': '</wp-content/cache/minify/ba52a.js?x64856>; rel=preload; as=script', 'Link': '</wp-content/cache/minify/adbfe.js?x64856>; rel=preload; as=script', 'Link': '</wp-content/cache/minify/a0a57.js?x64856>; rel=preload; as=script', 'Link': '</wp-content/cache/minify/b7ead.js?x64856>; rel=preload; as=script', 'Link': '</wp-content/cache/minify/846ca.css?x64856>; rel=preload; as=style', 'Link': '</wp-content/cache/minify/aa7db.css?x64856>; rel=preload; as=style', 'Link': '</wp-content/cache/minify/39d39.css?x64856>; rel=preload; as=style', 'Transfer-Encoding': 'chunked', 'Content-Type': 'text/html; charset=UTF-8', 'Content-Language': 'uk')>\r\n\r\n\r\nTask exception was never retrieved\r\nfuture: <Task finished name='Task-2' coro=<fetch() done, defined at test_async.py:5> exception=ClientPayloadError('Response payload is not completed')>\r\nTraceback (most recent call last):\r\n  File \"test_async.py\", line 13, in fetch\r\n    await remote_resp.text()\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/site-packages/aiohttp/client_reqrep.py\", line 1009, in text\r\n    await self.read()\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/site-packages/aiohttp/client_reqrep.py\", line 973, in read\r\n    self._body = await self.content.read()\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/site-packages/aiohttp/streams.py\", line 358, in read\r\n    block = await self.readany()\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/site-packages/aiohttp/streams.py\", line 380, in readany\r\n    await self._wait('readany')\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/site-packages/aiohttp/streams.py\", line 296, in _wait\r\n    await waiter\r\naiohttp.client_exceptions.ClientPayloadError: Response payload is not completed\r\n\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\n3.8.2\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\n3.6.2\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nVersion: 4.7.4\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nVersion: 1.4.2\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4677/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4677/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4666", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4666/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4666/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4666/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4666", "id": 590979431, "node_id": "MDU6SXNzdWU1OTA5Nzk0MzE=", "number": 4666, "title": "'Fatal Python error: deallocating None' when requesting large number of URLs via proxy", "user": {"login": "callumapplsys", "id": 31479067, "node_id": "MDQ6VXNlcjMxNDc5MDY3", "avatar_url": "https://avatars.githubusercontent.com/u/31479067?v=4", "gravatar_id": "", "url": "https://api.github.com/users/callumapplsys", "html_url": "https://github.com/callumapplsys", "followers_url": "https://api.github.com/users/callumapplsys/followers", "following_url": "https://api.github.com/users/callumapplsys/following{/other_user}", "gists_url": "https://api.github.com/users/callumapplsys/gists{/gist_id}", "starred_url": "https://api.github.com/users/callumapplsys/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/callumapplsys/subscriptions", "organizations_url": "https://api.github.com/users/callumapplsys/orgs", "repos_url": "https://api.github.com/users/callumapplsys/repos", "events_url": "https://api.github.com/users/callumapplsys/events{/privacy}", "received_events_url": "https://api.github.com/users/callumapplsys/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 303800438, "node_id": "MDU6TGFiZWwzMDM4MDA0Mzg=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/need%20pull%20request", "name": "need pull request", "color": "bfdadc", "default": false, "description": null}, {"id": 344995986, "node_id": "MDU6TGFiZWwzNDQ5OTU5ODY=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/client", "name": "client", "color": "bfd4f2", "default": false, "description": null}, {"id": 1831256427, "node_id": "MDU6TGFiZWwxODMxMjU2NDI3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/reproducer:%20present", "name": "reproducer: present", "color": "c2e0c6", "default": false, "description": "This PR or issue contains code, which reproduce the problem described or clearly understandable STR"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-03-31T10:20:53Z", "updated_at": "2020-10-24T19:02:22Z", "closed_at": "2020-10-24T19:02:22Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nAfter making lots of subsequent HTTP requests (using a proxy server, in my case Squid 4.10) aiohttp client crashes Python with a fatal error: ```deallocating None```\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\n\r\n\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\nTo make it simpler, we've got a server called `binserve` which is also written using aiohttp server. If you make a HTTP `GET` request to /234 for example it will return a random binary string exactly 234 bytes in length (excluding the headers). This runs on a different machine in a different environment to isolate it from this issue; in other words any server should cause the same behaviour. Using that we make multiple requests using `random.randint(1,1000000)` to get a large sample.\r\n\r\nRunning the following code in our environment triggers the fatal error:\r\n```python\r\nimport aiohttp\r\nimport asyncio\r\nimport random\r\n\r\nBASE_SERVER = 'http://192.168.1.179:8080/'\r\nPROXY = 'http://192.168.1.181:800/'\r\n\r\nasync def fetch(session, url):\r\n    async with session.get(url, proxy=PROXY) as response:\r\n        return await response.text()\r\n\r\nasync def main():\r\n    async with aiohttp.ClientSession() as session:\r\n        for i in range(120000):\r\n            size = random.randint(1, 100000)\r\n            resp = await fetch(session, BASE_SERVER + str(size))\r\n            print(len(resp))\r\n\r\nif __name__ == '__main__':\r\n    loop = asyncio.get_event_loop()\r\n    loop.run_until_complete(main())\r\n```\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\nNo fatal error, it should continue execution as normal.\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\nPython error:\r\n```python\r\nFatal Python error: deallocating None\r\n\r\nCurrent thread 0x00007fceaaa87700 (most recent call first):\r\n  File \"/usr/lib/python3.7/selectors.py\", line 192 in get_key\r\n  File \"/usr/lib/python3.7/asyncio/selector_events.py\", line 287 in _add_writer\r\n  File \"/usr/lib/python3.7/asyncio/selector_events.py\", line 334 in add_writer\r\n  File \"/usr/lib/python3.7/asyncio/selector_events.py\", line 477 in _sock_connect\r\n  File \"/usr/lib/python3.7/asyncio/selector_events.py\", line 463 in sock_connect\r\n  File \"/usr/lib/python3.7/asyncio/base_events.py\", line 946 in create_connection\r\n  File \"/usr/lib/python3.7/site-packages/aiohttp/connector.py\", line 936 in _wrap_create_connection\r\n  File \"/usr/lib/python3.7/site-packages/aiohttp/connector.py\", line 986 in _create_direct_connection\r\n  File \"/usr/lib/python3.7/site-packages/aiohttp/connector.py\", line 1028 in _create_proxy_connection\r\n  File \"/usr/lib/python3.7/site-packages/aiohttp/connector.py\", line 856 in _create_connection\r\n  File \"/usr/lib/python3.7/site-packages/aiohttp/connector.py\", line 523 in connect\r\n  File \"/usr/lib/python3.7/site-packages/aiohttp/client.py\", line 483 in _request\r\n  File \"/usr/lib/python3.7/site-packages/aiohttp/client.py\", line 1012 in __aenter__\r\n  File \"rep.py\", line 9 in fetch\r\n  File \"rep.py\", line 16 in main\r\n  File \"/usr/lib/python3.7/asyncio/events.py\", line 88 in _run\r\n  File \"/usr/lib/python3.7/asyncio/base_events.py\", line 1775 in _run_once\r\n  File \"/usr/lib/python3.7/asyncio/base_events.py\", line 539 in run_forever\r\n  File \"/usr/lib/python3.7/asyncio/base_events.py\", line 571 in run_until_complete\r\n  File \"rep.py\", line 21 in <module>\r\nAborted (core dumped)\r\n```\r\nFrom gdb:\r\n```console\r\n[New LWP 13699]\r\n[Thread debugging using libthread_db enabled]\r\nUsing host libthread_db library \"/lib64/libthread_db.so.1\".\r\nCore was generated by `appliance: downloader     '.\r\nProgram terminated with signal SIGABRT, Aborted.\r\n#0  0x00007ff64eb733f8 in raise () from /lib64/libc.so.6\r\n#0  0x00007ff64eb733f8 in raise () from /lib64/libc.so.6\r\n#1  0x00007ff64eb74ffa in abort () from /lib64/libc.so.6\r\n#2  0x00007ff64fbdb3d8 in fatal_error (prefix=prefix@entry=0x0, msg=msg@entry=0x7ff64fc57999 \"deallocating None\", status=status@entry=-1) at Python/pylifecycle.c:2179\r\n#3  0x00007ff64fbdc273 in Py_FatalError (msg=msg@entry=0x7ff64fc57999 \"deallocating None\") at Python/pylifecycle.c:2189\r\n#4  0x00007ff64fb34cf0 in none_dealloc (ignore=<optimized out>) at Objects/object.c:1548\r\n#5  0x00007ff64fc3ca6a in buffered_flush_and_rewind_unlocked (self=self@entry=0x7ff6500c4a98) at ./Modules/_io/bufferedio.c:813\r\n#6  0x00007ff64fc3ccac in buffered_flush (self=0x7ff6500c4a98, args=<optimized out>) at ./Modules/_io/bufferedio.c:837\r\n#7  0x00007ff64fafcfe8 in _PyMethodDef_RawFastCallDict (method=<optimized out>, self=0x7ff6500c4a98, args=0x0, nargs=0, kwargs=<optimized out>) at Objects/call.c:482\r\n#8  0x00007ff64fafd03d in _PyCFunction_FastCallDict (func=func@entry=0x7ff643b73dc8, args=<optimized out>, nargs=<optimized out>, kwargs=<optimized out>) at Objects/call.c:582\r\n#9  0x00007ff64fafd1e0 in _PyObject_FastCallDict (callable=callable@entry=0x7ff643b73dc8, args=args@entry=0x0, nargs=nargs@entry=0, kwargs=kwargs@entry=0x0) at Objects/call.c:101\r\n#10 0x00007ff64fafd516 in _PyObject_CallFunctionVa (callable=0x7ff643b73dc8, format=<optimized out>, va=<optimized out>, is_size_t=<optimized out>) at Objects/call.c:931\r\n#11 0x00007ff64fafd751 in callmethod (callable=0x7ff643b73dc8, format=0x0, va=0x7ffefd2f6868, is_size_t=1) at Objects/call.c:1027\r\n#12 0x00007ff64fafdc94 in _PyObject_CallMethodId_SizeT (obj=<optimized out>, name=name@entry=0x7ff64ff4b200 <PyId_flush>, format=format@entry=0x0) at Objects/call.c:1145\r\n#13 0x00007ff64fc41799 in _io_TextIOWrapper_flush_impl (self=0x7ff6500ea630) at ./Modules/_io/textio.c:2915\r\n#14 _io_TextIOWrapper_flush (self=0x7ff6500ea630, _unused_ignored=<optimized out>) at ./Modules/_io/clinic/textio.c.h:488\r\n#15 0x00007ff64fafcfe8 in _PyMethodDef_RawFastCallDict (method=<optimized out>, self=0x7ff6500ea630, args=0x0, nargs=0, kwargs=<optimized out>) at Objects/call.c:482\r\n#16 0x00007ff64fafd03d in _PyCFunction_FastCallDict (func=func@entry=0x7ff6493ef798, args=<optimized out>, nargs=<optimized out>, kwargs=<optimized out>) at Objects/call.c:582\r\n#17 0x00007ff64fafd1e0 in _PyObject_FastCallDict (callable=callable@entry=0x7ff6493ef798, args=args@entry=0x0, nargs=nargs@entry=0, kwargs=kwargs@entry=0x0) at Objects/call.c:101\r\n#18 0x00007ff64fafd516 in _PyObject_CallFunctionVa (callable=0x7ff6493ef798, format=<optimized out>, va=<optimized out>, is_size_t=<optimized out>) at Objects/call.c:931\r\n#19 0x00007ff64fafd751 in callmethod (callable=0x7ff6493ef798, format=0x0, va=0x7ffefd2f6b08, is_size_t=0) at Objects/call.c:1027\r\n#20 0x00007ff64fafda61 in _PyObject_CallMethodId (obj=obj@entry=0x7ff6500ea630, name=name@entry=0x7ff64ff19860 <PyId_flush>, format=format@entry=0x0) at Objects/call.c:1096\r\n#21 0x00007ff64fbdb091 in flush_std_files () at Python/pylifecycle.c:1083\r\n#22 0x00007ff64fbdb3ce in fatal_error (prefix=prefix@entry=0x0, msg=msg@entry=0x7ff64fc57999 \"deallocating None\", status=status@entry=-1) at Python/pylifecycle.c:2167\r\n#23 0x00007ff64fbdc273 in Py_FatalError (msg=msg@entry=0x7ff64fc57999 \"deallocating None\") at Python/pylifecycle.c:2189\r\n#24 0x00007ff64fb34cf0 in none_dealloc (ignore=<optimized out>) at Objects/object.c:1548\r\n#25 0x00007ff64fb44388 in clear_slots (type=type@entry=0x1b40508, self=self@entry=0x7ff64472ee58) at Objects/typeobject.c:1073\r\n#26 0x00007ff64fb452ca in subtype_dealloc (self=0x7ff64472ee58) at Objects/typeobject.c:1230\r\n#27 0x00007ff64fb15aa7 in list_dealloc (op=0x7ff6493e50c8) at Objects/listobject.c:324\r\n#28 0x00007ff64fb25c17 in insertdict (mp=mp@entry=0x7ff6493e3120, key=key@entry=0x7ff64cb382b0, hash=-2919758158610674453, value=value@entry=0x7ff643b74348) at Objects/dictobject.c:1076\r\n#29 0x00007ff64fb281bf in PyDict_SetItem (op=0x7ff6493e3120, key=0x7ff64cb382b0, value=0x7ff643b74348) at Objects/dictobject.c:1463\r\n#30 0x00007ff64fb2adab in _PyObjectDict_SetItem (tp=tp@entry=0x1b20f48, dictptr=<optimized out>, key=key@entry=0x7ff64cb382b0, value=value@entry=0x7ff643b74348) at Objects/dictobject.c:4333\r\n#31 0x00007ff64fb36a46 in _PyObject_GenericSetAttrWithDict (obj=0x7ff6493e1588, name=0x7ff64cb382b0, value=<optimized out>, dict=dict@entry=0x0) at Objects/object.c:1357\r\n#32 0x00007ff64fb36adb in PyObject_GenericSetAttr (obj=<optimized out>, name=<optimized out>, value=<optimized out>) at Objects/object.c:1379\r\n#33 0x00007ff64fb35de2 in PyObject_SetAttr (v=v@entry=0x7ff6493e1588, name=<optimized out>, value=value@entry=0x7ff643b74348) at Objects/object.c:1016\r\n#34 0x00007ff64fad768b in _PyEval_EvalFrameDefault (f=<optimized out>, throwflag=<optimized out>) at Python/ceval.c:2015\r\n#35 0x00007ff64fbb981c in PyEval_EvalFrameEx (f=f@entry=0x1ddb748, throwflag=throwflag@entry=0) at Python/ceval.c:547\r\n#36 0x00007ff64fad3993 in function_code_fastcall (co=<optimized out>, args=<optimized out>, args@entry=0x7ff64941b948, nargs=1, globals=<optimized out>) at Objects/call.c:283\r\n#37 0x00007ff64fafc3dc in _PyFunction_FastCallKeywords (func=<optimized out>, stack=0x7ff64941b948, nargs=<optimized out>, kwnames=<optimized out>) at Objects/call.c:408\r\n#38 0x00007ff64fada5f5 in call_function (kwnames=0x0, oparg=<optimized out>, pp_stack=<synthetic pointer>) at Python/ceval.c:4616\r\n#39 _PyEval_EvalFrameDefault (f=<optimized out>, throwflag=<optimized out>) at Python/ceval.c:3110\r\n#40 0x00007ff64fbb981c in PyEval_EvalFrameEx (f=f@entry=0x7ff64941b7c8, throwflag=throwflag@entry=0) at Python/ceval.c:547\r\n#41 0x00007ff64fad3993 in function_code_fastcall (co=<optimized out>, args=<optimized out>, args@entry=0x7ff6447fd3b8, nargs=1, globals=<optimized out>) at Objects/call.c:283\r\n#42 0x00007ff64fafc3dc in _PyFunction_FastCallKeywords (func=<optimized out>, stack=0x7ff6447fd3b8, nargs=<optimized out>, kwnames=<optimized out>) at Objects/call.c:408\r\n#43 0x00007ff64fada5f5 in call_function (kwnames=0x0, oparg=<optimized out>, pp_stack=<synthetic pointer>) at Python/ceval.c:4616\r\n#44 _PyEval_EvalFrameDefault (f=<optimized out>, throwflag=<optimized out>) at Python/ceval.c:3110\r\n#45 0x00007ff64fbb981c in PyEval_EvalFrameEx (f=f@entry=0x7ff6447fd230, throwflag=throwflag@entry=0) at Python/ceval.c:547\r\n#46 0x00007ff64fad3993 in function_code_fastcall (co=<optimized out>, args=<optimized out>, args@entry=0x19a0fa8, nargs=2, globals=<optimized out>) at Objects/call.c:283\r\n#47 0x00007ff64fafc3dc in _PyFunction_FastCallKeywords (func=<optimized out>, stack=0x19a0fa8, nargs=<optimized out>, kwnames=<optimized out>) at Objects/call.c:408\r\n#48 0x00007ff64fada5f5 in call_function (kwnames=0x0, oparg=<optimized out>, pp_stack=<synthetic pointer>) at Python/ceval.c:4616\r\n#49 _PyEval_EvalFrameDefault (f=<optimized out>, throwflag=<optimized out>) at Python/ceval.c:3110\r\n#50 0x00007ff64fbb981c in PyEval_EvalFrameEx (f=f@entry=0x19a0e28, throwflag=throwflag@entry=0) at Python/ceval.c:547\r\n#51 0x00007ff64fad3993 in function_code_fastcall (co=<optimized out>, args=<optimized out>, args@entry=0x7ff6500efb70, nargs=0, globals=<optimized out>) at Objects/call.c:283\r\n#52 0x00007ff64fafc3dc in _PyFunction_FastCallKeywords (func=<optimized out>, stack=0x7ff6500efb70, nargs=<optimized out>, kwnames=<optimized out>) at Objects/call.c:408\r\n#53 0x00007ff64fada33d in call_function (kwnames=0x0, oparg=<optimized out>, pp_stack=<synthetic pointer>) at Python/ceval.c:4616\r\n#54 _PyEval_EvalFrameDefault (f=<optimized out>, throwflag=<optimized out>) at Python/ceval.c:3124\r\n#55 0x00007ff64fbb981c in PyEval_EvalFrameEx (f=f@entry=0x7ff6500ef9f8, throwflag=throwflag@entry=0) at Python/ceval.c:547\r\n#56 0x00007ff64fbba298 in _PyEval_EvalCodeWithName (_co=_co@entry=0x7ff650012540, globals=globals@entry=0x7ff650043168, locals=locals@entry=0x7ff650043168, args=args@entry=0x0, argcount=argcount@entry=0, kwnames=kwnames@entry=0x0, kwargs=0x0, kwcount=0, kwstep=2, defs=0x0, defcount=0, kwdefs=0x0, closure=0x0, name=0x0, qualname=0x0) at Python/ceval.c:3930\r\n#57 0x00007ff64fbba3bd in PyEval_EvalCodeEx (_co=_co@entry=0x7ff650012540, globals=globals@entry=0x7ff650043168, locals=locals@entry=0x7ff650043168, args=args@entry=0x0, argcount=argcount@entry=0, kws=kws@entry=0x0, kwcount=0, defs=0x0, defcount=0, kwdefs=0x0, closure=0x0) at Python/ceval.c:3959\r\n#58 0x00007ff64fbba3ef in PyEval_EvalCode (co=co@entry=0x7ff650012540, globals=globals@entry=0x7ff650043168, locals=locals@entry=0x7ff650043168) at Python/ceval.c:524\r\n#59 0x00007ff64fbe2bb9 in run_mod (mod=mod@entry=0x1999400, filename=filename@entry=0x7ff64ea977c8, globals=globals@entry=0x7ff650043168, locals=locals@entry=0x7ff650043168, flags=flags@entry=0x7ffefd2f794c, arena=arena@entry=0x7ff65013d0a8) at Python/pythonrun.c:1035\r\n#60 0x00007ff64fbe4f36 in PyRun_FileExFlags (fp=fp@entry=0x1a1d300, filename_str=filename_str@entry=0x7ff65002fbb0 \"/usr/bin/downloader\", start=start@entry=257, globals=globals@entry=0x7ff650043168, locals=locals@entry=0x7ff650043168, closeit=closeit@entry=1, flags=0x7ffefd2f794c) at Python/pythonrun.c:988\r\n#61 0x00007ff64fbe5098 in PyRun_SimpleFileExFlags (fp=fp@entry=0x1a1d300, filename=<optimized out>, filename@entry=0x7ff65002fbb0 \"/usr/bin/downloader\", closeit=closeit@entry=1, flags=flags@entry=0x7ffefd2f794c) at Python/pythonrun.c:429\r\n#62 0x00007ff64fbe5539 in PyRun_AnyFileExFlags (fp=fp@entry=0x1a1d300, filename=0x7ff65002fbb0 \"/usr/bin/downloader\", closeit=closeit@entry=1, flags=flags@entry=0x7ffefd2f794c) at Python/pythonrun.c:84\r\n#63 0x00007ff64fbfdf0d in pymain_run_file (p_cf=0x7ffefd2f794c, filename=0x193e540 L\"/usr/bin/downloader\", fp=0x1a1d300) at Modules/main.c:427\r\n#64 pymain_run_filename (cf=0x7ffefd2f794c, pymain=0x7ffefd2f7a20) at Modules/main.c:1627\r\n#65 pymain_run_python (pymain=0x7ffefd2f7a20) at Modules/main.c:2877\r\n#66 pymain_main (pymain=pymain@entry=0x7ffefd2f7a20) at Modules/main.c:3038\r\n#67 0x00007ff64fbfe15f in _Py_UnixMain (argc=<optimized out>, argv=<optimized out>) at Modules/main.c:3073\r\n#68 0x0000000000400759 in main (argc=<optimized out>, argv=<optimized out>) at ./Programs/python.c:15\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.7.3\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.6.2\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/lib/python3.7/site-packages\r\nRequires: attrs, yarl, chardet, multidict, async-timeout\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.5\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/lib/python3.7/site-packages\r\nRequires: \r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.4.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/lib/python3.7/site-packages\r\nRequires: idna, multidict\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\nLinux 4.14.127, Slackware 14.2, Squid 4.10, Python 3.7.3, aiohttp 3.6.2\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4666/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4666/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4663", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4663/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4663/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4663/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4663", "id": 588194719, "node_id": "MDU6SXNzdWU1ODgxOTQ3MTk=", "number": 4663, "title": "RouteTableDef can't register OPTIONS request handlers", "user": {"login": "meetmangukiya", "id": 7620533, "node_id": "MDQ6VXNlcjc2MjA1MzM=", "avatar_url": "https://avatars.githubusercontent.com/u/7620533?v=4", "gravatar_id": "", "url": "https://api.github.com/users/meetmangukiya", "html_url": "https://github.com/meetmangukiya", "followers_url": "https://api.github.com/users/meetmangukiya/followers", "following_url": "https://api.github.com/users/meetmangukiya/following{/other_user}", "gists_url": "https://api.github.com/users/meetmangukiya/gists{/gist_id}", "starred_url": "https://api.github.com/users/meetmangukiya/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/meetmangukiya/subscriptions", "organizations_url": "https://api.github.com/users/meetmangukiya/orgs", "repos_url": "https://api.github.com/users/meetmangukiya/repos", "events_url": "https://api.github.com/users/meetmangukiya/events{/privacy}", "received_events_url": "https://api.github.com/users/meetmangukiya/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1363888987, "node_id": "MDU6TGFiZWwxMzYzODg4OTg3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/pr-merged", "name": "pr-merged", "color": "363396", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-03-26T06:48:08Z", "updated_at": "2020-03-26T12:34:49Z", "closed_at": "2020-03-26T12:34:41Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nCurrently it gives an AttributeError: 'RouteTableDef' object has no attribute 'options'\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n\r\n```py\r\n@route.options('/path')\r\ndef opts(request):\r\n   ...\r\n```\r\n\r\n\ud83d\udca1 **Expected behavior**\r\nIt should register decorated function as the OPTIONS request handler for that path", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4663/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4663/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4657", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4657/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4657/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4657/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4657", "id": 586571409, "node_id": "MDU6SXNzdWU1ODY1NzE0MDk=", "number": 4657, "title": "how to config `max_field_size` on server side", "user": {"login": "bmbouter", "id": 180319, "node_id": "MDQ6VXNlcjE4MDMxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/180319?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bmbouter", "html_url": "https://github.com/bmbouter", "followers_url": "https://api.github.com/users/bmbouter/followers", "following_url": "https://api.github.com/users/bmbouter/following{/other_user}", "gists_url": "https://api.github.com/users/bmbouter/gists{/gist_id}", "starred_url": "https://api.github.com/users/bmbouter/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bmbouter/subscriptions", "organizations_url": "https://api.github.com/users/bmbouter/orgs", "repos_url": "https://api.github.com/users/bmbouter/repos", "events_url": "https://api.github.com/users/bmbouter/events{/privacy}", "received_events_url": "https://api.github.com/users/bmbouter/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 303800438, "node_id": "MDU6TGFiZWwzMDM4MDA0Mzg=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/need%20pull%20request", "name": "need pull request", "color": "bfdadc", "default": false, "description": null}, {"id": 344996043, "node_id": "MDU6TGFiZWwzNDQ5OTYwNDM=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/server", "name": "server", "color": "006b75", "default": false, "description": null}, {"id": 1831255463, "node_id": "MDU6TGFiZWwxODMxMjU1NDYz", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/reproducer:%20missing", "name": "reproducer: missing", "color": "e23c36", "default": false, "description": "This PR or issue lacks code, which reproduce the problem described or clearly understandable STR"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-03-23T22:58:22Z", "updated_at": "2020-03-25T13:42:15Z", "closed_at": "2020-03-25T13:42:15Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nI tried to configure `max_field_size` using the docs for make_handler. I understand it's deprecated, but I'm not sure what is replacing it.\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n\r\nSay you want to set it to 9000. I've tried two ways:\r\n\r\n1. I tried adding it using the handler_args, and in my testing this still raises the exception when I submit a header larger than 8190 bytes (the default)\r\n\r\n```\r\napp = web.Application(handler_args={'max_line_size': 9000})\r\n```\r\n\r\n2. I also tried calling app.make_handler explicitly which completes but then my app.add_route calls fail complaining of a frozen router\r\n\r\nSpecifically I have: \r\n\r\n```\r\napp = web.Application()\r\napp.make_handler(max_line_size=9000)\r\n```\r\n\r\nWon't start and raises this exception:\r\n\r\n```\r\n[2020-03-23 22:55:06 +0000] [38721] [ERROR] Exception in gunicorn worker\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/pulp/lib64/python3.7/site-packages/aiohttp/worker.py\", line 58, in run\r\n    self.loop.run_until_complete(self._task)\r\n  File \"/usr/lib64/python3.7/asyncio/base_events.py\", line 583, in run_until_complete\r\n    return future.result()\r\n  File \"/usr/local/lib/pulp/lib64/python3.7/site-packages/aiohttp/worker.py\", line 71, in _run\r\n    app = await self.wsgi()\r\n  File \"/home/vagrant/devel/pulpcore/pulpcore/content/__init__.py\", line 52, in server\r\n    app.add_routes([web.get(settings.CONTENT_PATH_PREFIX, Handler().list_distributions)])\r\n  File \"/usr/local/lib/pulp/lib64/python3.7/site-packages/aiohttp/web_app.py\", line 314, in add_routes\r\n    self.router.add_routes(routes)\r\n  File \"/usr/local/lib/pulp/lib64/python3.7/site-packages/aiohttp/web_urldispatcher.py\", line 1135, in add_routes\r\n    route_def.register(self)\r\n  File \"/usr/local/lib/pulp/lib64/python3.7/site-packages/aiohttp/web_routedef.py\", line 65, in register\r\n    reg(self.path, self.handler, **self.kwargs)\r\n  File \"/usr/local/lib/pulp/lib64/python3.7/site-packages/aiohttp/web_urldispatcher.py\", line 1084, in add_get\r\n    resource = self.add_resource(path, name=name)\r\n  File \"/usr/local/lib/pulp/lib64/python3.7/site-packages/aiohttp/web_urldispatcher.py\", line 1023, in add_resource\r\n    self.register_resource(resource)\r\n  File \"/usr/local/lib/pulp/lib64/python3.7/site-packages/aiohttp/web_urldispatcher.py\", line 992, in register_resource\r\n    \"Cannot register a resource into frozen router.\")\r\nRuntimeError: Cannot register a resource into frozen router.\r\n```\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\nI expect some reasonable documented way to configure max_line_size.\r\n\r\nPython 3.7.6 on Fedora 31. I am using aiohttp==3.6.2\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4657/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4657/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4656", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4656/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4656/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4656/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4656", "id": 585994688, "node_id": "MDU6SXNzdWU1ODU5OTQ2ODg=", "number": 4656, "title": "aiohttp.pytest_plugin suppresses all the warnings", "user": {"login": "vitek", "id": 489439, "node_id": "MDQ6VXNlcjQ4OTQzOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/489439?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vitek", "html_url": "https://github.com/vitek", "followers_url": "https://api.github.com/users/vitek/followers", "following_url": "https://api.github.com/users/vitek/following{/other_user}", "gists_url": "https://api.github.com/users/vitek/gists{/gist_id}", "starred_url": "https://api.github.com/users/vitek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vitek/subscriptions", "organizations_url": "https://api.github.com/users/vitek/orgs", "repos_url": "https://api.github.com/users/vitek/repos", "events_url": "https://api.github.com/users/vitek/events{/privacy}", "received_events_url": "https://api.github.com/users/vitek/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 303800438, "node_id": "MDU6TGFiZWwzMDM4MDA0Mzg=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/need%20pull%20request", "name": "need pull request", "color": "bfdadc", "default": false, "description": null}, {"id": 1363888987, "node_id": "MDU6TGFiZWwxMzYzODg4OTg3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/pr-merged", "name": "pr-merged", "color": "363396", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-03-23T07:37:27Z", "updated_at": "2020-03-26T21:01:53Z", "closed_at": "2020-03-26T21:01:45Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\n\r\n`aiohttp.pytest_plugin` suppresses warnings issued from test. It looks like _runtime_warning_context() catches all the warnings so no warning reaches pytest.warnings plugin.\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior?\r\n\r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\n\r\nSimple testcase that shows how pytest works with warnings. It would print warning for test_foo only.\r\n\r\n```python\r\nimport warnings\r\n\r\ndef test_foo():\r\n    warnings.warn('sync warning')\r\n\r\n\r\nasync def test_afoo():\r\n    warnings.warn('async warning')\r\n```\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\n\r\npytest catches warning.\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\n========================= test session starts ==========================\r\nplatform linux -- Python 3.7.3, pytest-5.3.5, py-1.8.1, pluggy-0.13.1 -- python3.7\r\ncachedir: .pytest_cache\r\nrootdir: ..., inifile: pytest.ini\r\nplugins: aiohttp-0.3.0\r\ncollected 2 items                                                      \r\n\r\ntests/test_foo.py::test_foo PASSED\r\ntests/test_foo.py::test_afoo \r\nPASSED\r\n\r\n=========================== warnings summary ===========================\r\ntests/test_foo.py::test_foo\r\n  test_foo.py:4: UserWarning: sync warning\r\n    warnings.warn('sync warning')\r\n\r\n-- Docs: https://docs.pytest.org/en/latest/warnings.html\r\n===================== 2 passed, 1 warning in 0.02s =====================\r\n\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.7.3\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.6.2\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/vitja/work/testsuite/.venv-docs/lib/python3.7/site-packages\r\nRequires: yarl, multidict, chardet, attrs, async-timeout\r\nRequired-by: testsuite, pytest-aiohttp\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.5\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/vitja/work/testsuite/.venv-docs/lib/python3.7/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.4.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /home/vitja/work/testsuite/.venv-docs/lib/python3.7/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4656/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4656/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4648", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4648/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4648/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4648/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4648", "id": 584174984, "node_id": "MDU6SXNzdWU1ODQxNzQ5ODQ=", "number": 4648, "title": "ws_connect doesn't follow proxy from environment", "user": {"login": "lookis", "id": 445022, "node_id": "MDQ6VXNlcjQ0NTAyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/445022?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lookis", "html_url": "https://github.com/lookis", "followers_url": "https://api.github.com/users/lookis/followers", "following_url": "https://api.github.com/users/lookis/following{/other_user}", "gists_url": "https://api.github.com/users/lookis/gists{/gist_id}", "starred_url": "https://api.github.com/users/lookis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lookis/subscriptions", "organizations_url": "https://api.github.com/users/lookis/orgs", "repos_url": "https://api.github.com/users/lookis/repos", "events_url": "https://api.github.com/users/lookis/events{/privacy}", "received_events_url": "https://api.github.com/users/lookis/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1363888987, "node_id": "MDU6TGFiZWwxMzYzODg4OTg3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/pr-merged", "name": "pr-merged", "color": "363396", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-03-19T05:36:56Z", "updated_at": "2020-03-26T09:55:45Z", "closed_at": "2020-03-26T09:55:37Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n<!-- A clear and concise description of what the bug is, on the next line. -->\r\nI have set both http_proxy and https_proxy, with trust_env=True when create ClientSession,\r\neverything is ok when get or post with this session, but for the ws_connect, It doesn't run with proxy.\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n<!-- How to reproduce the behavior? \r\nFor example:\r\n1. Have certain environment\r\n2. Run given code snippet in a certain way\r\n3. See some behavior described\r\n\r\nAdd these steps below this comment: -->\r\nbackground: I cann't visit wss://stream.binance.com:9443/ws under my network but it's ok with proxy\r\n1. prepare a proxy at port 1086\r\n1. http_proxy=\"http://127.0.0.1:1086\"\r\n2. https_proxy=\"https://127.0.0.1:1086\"\r\n\r\n``` python\r\nimport asyncio\r\nimport aiohttp\r\nasync def main():\r\n    async with aiohttp.ClientSession(trust_env=True) as client:\r\n        await client.ws_connect('wss://stream.binance.com:9443/ws')\r\n        print('ok')\r\n\r\nloop = asyncio.get_event_loop()\r\nloop.run_until_complete(main())\r\n\r\n```\r\nand it block forever (with a tcp handshake timeout exception)\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\njust connect with proxy\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\n\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.7.6\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nVersion: 3.6.2\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nVersion: 4.7.5\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nVersion: 1.1.0\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\nhttps://github.com/aio-libs/aiohttp/blob/bb7a4eaf21782612cc4c24fa75b9368ddb204cc7/aiohttp/client.py#L426\r\nscheme of websocket is ws or wss, url.scheme will always be http or https and ignore any other proxy here \r\nhttps://github.com/aio-libs/aiohttp/blob/bb7a4eaf21782612cc4c24fa75b9368ddb204cc7/aiohttp/helpers.py#L232\r\n\r\nbut it's ok for ws/wss to use http proxy\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case.\r\n\r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4648/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4648/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4644", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4644/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4644/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4644/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4644", "id": 583753538, "node_id": "MDU6SXNzdWU1ODM3NTM1Mzg=", "number": 4644, "title": "on_request_redirect params.headers is empty", "user": {"login": "deed02392", "id": 3536087, "node_id": "MDQ6VXNlcjM1MzYwODc=", "avatar_url": "https://avatars.githubusercontent.com/u/3536087?v=4", "gravatar_id": "", "url": "https://api.github.com/users/deed02392", "html_url": "https://github.com/deed02392", "followers_url": "https://api.github.com/users/deed02392/followers", "following_url": "https://api.github.com/users/deed02392/following{/other_user}", "gists_url": "https://api.github.com/users/deed02392/gists{/gist_id}", "starred_url": "https://api.github.com/users/deed02392/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/deed02392/subscriptions", "organizations_url": "https://api.github.com/users/deed02392/orgs", "repos_url": "https://api.github.com/users/deed02392/repos", "events_url": "https://api.github.com/users/deed02392/events{/privacy}", "received_events_url": "https://api.github.com/users/deed02392/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-03-18T14:06:23Z", "updated_at": "2021-11-14T12:49:58Z", "closed_at": "2021-11-14T12:49:58Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nWhen handling the request redirect signal, the `params.headers` dict is empty.\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n```python\r\nimport asyncio\r\nimport json\r\n\r\nimport aiohttp\r\n\r\n\r\nasync def on_request_start(session, trace_config_ctx, params):\r\n    print(\"Starting request\")\r\n\r\n\r\nasync def on_request_end(session, trace_config_ctx, params):\r\n    print(\"Ending request\")\r\n\r\n\r\nasync def on_request_redirect(session, trace_config_ctx, params):\r\n    print(f\"Redirect from: {params.method} {params.url}\")\r\n\r\n\r\n\r\ntrace_config = aiohttp.TraceConfig()\r\ntrace_config.on_request_start.append(on_request_start)\r\ntrace_config.on_request_end.append(on_request_end)\r\ntrace_config.on_request_redirect.append(on_request_redirect)\r\n\r\n\r\nasync def main():\r\n    async with aiohttp.ClientSession(trace_configs=[trace_config]) as session:\r\n        try:\r\n            r = await session.get('http://google.com', trace_request_ctx={'foo': 'bar'}, ssl=False)\r\n            headers = [(k.decode('utf-8', errors='surrogateescape'), v.decode('utf-8', errors='surrogateescape')) for\r\n                       k, v in r.raw_headers]\r\n            print(f\"{r.status}, {json.dumps(headers)}\")\r\n        except aiohttp.ClientConnectorError as exc:\r\n            print(f\"Connection failed: {exc}\")\r\n\r\nasyncio.run(main())\r\n```\r\n\r\n\ud83d\udca1 **Expected behavior**\r\nThe documentation is not clear, but my understanding is that the `headers` property of `params` should contain the headers that `aiohttp` used to determine that it should redirect the request.\r\n\r\nhttps://docs.aiohttp.org/en/stable/tracing_reference.html#tracerequestredirectparams\r\n\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n```console\r\n$ python --version\r\nPython 3.7.6\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.6.2\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.4\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.4.2\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\nClient request. I want to log redirects and am doing so by tracing the request redirect signal. I can access the headers in the `params.response` object.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4644/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4644/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4630", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4630/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4630/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4630/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4630", "id": 581944309, "node_id": "MDU6SXNzdWU1ODE5NDQzMDk=", "number": 4630, "title": "HttpPayloadParser fails with \"Not enough data for satisfy transfer length header\" on chunked transfer encoding if the data is split exactly where trailers could occur", "user": {"login": "JustAnotherArchivist", "id": 29556373, "node_id": "MDQ6VXNlcjI5NTU2Mzcz", "avatar_url": "https://avatars.githubusercontent.com/u/29556373?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JustAnotherArchivist", "html_url": "https://github.com/JustAnotherArchivist", "followers_url": "https://api.github.com/users/JustAnotherArchivist/followers", "following_url": "https://api.github.com/users/JustAnotherArchivist/following{/other_user}", "gists_url": "https://api.github.com/users/JustAnotherArchivist/gists{/gist_id}", "starred_url": "https://api.github.com/users/JustAnotherArchivist/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JustAnotherArchivist/subscriptions", "organizations_url": "https://api.github.com/users/JustAnotherArchivist/orgs", "repos_url": "https://api.github.com/users/JustAnotherArchivist/repos", "events_url": "https://api.github.com/users/JustAnotherArchivist/events{/privacy}", "received_events_url": "https://api.github.com/users/JustAnotherArchivist/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 303800438, "node_id": "MDU6TGFiZWwzMDM4MDA0Mzg=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/need%20pull%20request", "name": "need pull request", "color": "bfdadc", "default": false, "description": null}, {"id": 1831256427, "node_id": "MDU6TGFiZWwxODMxMjU2NDI3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/reproducer:%20present", "name": "reproducer: present", "color": "c2e0c6", "default": false, "description": "This PR or issue contains code, which reproduce the problem described or clearly understandable STR"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2020-03-16T02:32:26Z", "updated_at": "2020-10-16T09:13:53Z", "closed_at": "2020-10-16T09:13:52Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nIf the response data is fed into `HttpPayloadParser.feed_data` in a particular way, the parser is unable to successfully parse chunked data. Specifically, this happens when one call to the function contains the last `0\\r\\n` chunk but the following `\\r\\n` is supplied in a separate call.\r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n```python\r\nimport aiohttp.http_parser\r\nimport io\r\n\r\n\r\nclass Payload: # A minimal payload implementation\r\n        def __init__(self):\r\n                self.data = io.BytesIO()\r\n                self.exc = None\r\n\r\n        def feed_data(self, data, size):\r\n                self.data.write(data)\r\n\r\n        def feed_eof(self):\r\n                pass\r\n\r\n        def set_exception(self, exc):\r\n                self.exc = exc\r\n\r\n        def begin_http_chunk_receiving(self):\r\n                pass\r\n\r\n        def end_http_chunk_receiving(self):\r\n                pass\r\n\r\n\r\npayload = Payload()\r\nparser = aiohttp.http_parser.HttpPayloadParser(payload, length = None, chunked = True, compression = None, code = 200, method = 'GET')\r\nprint(repr(parser.feed_data(b'4\\r\\nasdf\\r\\n0\\r\\n')))\r\neof, data = parser.feed_data(b'\\r\\n')\r\nprint(repr((eof, data)))\r\nif not eof:\r\n        print(repr(parser.feed_eof()))\r\nprint(repr(payload.data.getvalue()))\r\n```\r\n\r\nI added print statements here to debug what exactly aiohttp is returning compared to the simple `feed_data(b'4\\r\\nasdf\\r\\n0\\r\\n\\r\\n')` call (which works fine).\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\nThe parser is able to process the data, and the last line produces `b'asdf'`.\r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n```python-traceback\r\n(False, b'')\r\n(False, b'')\r\nTraceback (most recent call last):\r\n  File \"aiohttp-test.py\", line 32, in <module>\r\n    print(repr(parser.feed_eof()))\r\n  File \".../lib/python3.6/site-packages/aiohttp/http_parser.py\", line 575, in feed_eof\r\n    \"Not enough data for satisfy transfer length header.\")\r\naiohttp.http_exceptions.TransferEncodingError: 400, message='Not enough data for satisfy transfer length header.'\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n```console\r\n$ python --version\r\nPython 3.6.10\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n```console\r\n$ python -m pip show aiohttp | grep Version\r\nVersion: 3.6.2\r\n```\r\n```console\r\n$ python -m pip show multidict | grep Version\r\nVersion: 4.7.5\r\n```\r\n```console\r\n$ python -m pip show yarl | grep Version\r\nVersion: 1.4.2\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\nDiscovered with aiohttp 2.3.10 due to errors in qwarc, which definitely uses aiohttp in weird, undocumented, and unsupported ways. But I believe the error could happen also in normal aiohttp usage if the data returned from the server is just the right size, namely two bytes over a multiple of the internal buffer size.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4630/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4630/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4627", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4627/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4627/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4627/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4627", "id": 580553057, "node_id": "MDU6SXNzdWU1ODA1NTMwNTc=", "number": 4627, "title": "`aiohttp.ClientSession().get()` takes around 30secs to make a request to `localhost` (unlike `127.0.0.1`)", "user": {"login": "Joacchim", "id": 404509, "node_id": "MDQ6VXNlcjQwNDUwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/404509?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Joacchim", "html_url": "https://github.com/Joacchim", "followers_url": "https://api.github.com/users/Joacchim/followers", "following_url": "https://api.github.com/users/Joacchim/following{/other_user}", "gists_url": "https://api.github.com/users/Joacchim/gists{/gist_id}", "starred_url": "https://api.github.com/users/Joacchim/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Joacchim/subscriptions", "organizations_url": "https://api.github.com/users/Joacchim/orgs", "repos_url": "https://api.github.com/users/Joacchim/repos", "events_url": "https://api.github.com/users/Joacchim/events{/privacy}", "received_events_url": "https://api.github.com/users/Joacchim/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 58986079, "node_id": "MDU6TGFiZWw1ODk4NjA3OQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/question", "name": "question", "color": "cc317c", "default": true, "description": "StackOverflow"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-03-13T11:53:01Z", "updated_at": "2020-03-13T14:48:07Z", "closed_at": "2020-03-13T14:48:07Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\n\r\nThis bug was observed on isolated servers we were preparing for soon-to-be production (ie: There's network setup, with isolation etc., but I don't have all the details at hand, though I can ask if it sounds relevant).\r\n\r\nWhen using `localhost` instead of an ip (ie `127.0.0.1`) to make an async request to a \"local\" HTTP server, we're observing very odd behaviors, such as a very long time to connect to the server and run the request.\r\n\r\nIn our situation, we're reaching out to a data-providing server through a HAProxy, but I do not think it is relevant to this issue, as I could reproduce it with a simple `python3 -m http.server` as the local HTTP server.\r\n\r\nSwitching our configurations from `localhost` to `127.0.0.1` solved the issue, and fixed any odd behavior previously observed.\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n\r\nRun a simple http server:\r\n```console\r\n$> python3 -m http.server\r\n```\r\n\r\nThen run the following code against it:\r\n```python3\r\nimport aiohttp\r\nfrom datetime import datetime\r\nimport asyncio\r\nasync def do(host):\r\n    async with aiohttp.ClientSession() as client:\r\n        async with client.get(f'http://{host}/data/91a6570c981c96a35cffc819b203115085e7293c02f3196bd5566bc10b6c1663') as response:\r\n            print(datetime.utcnow())\r\n            print(response)\r\n\r\nloop = asyncio.get_event_loop()\r\nprint(datetime.utcnow()) ; loop.run_until_complete(do('127.0.0.1:22023'))\r\n\r\nprint(datetime.utcnow()) ; loop.run_until_complete(do('0:22023'))\r\nprint(datetime.utcnow()) ; loop.run_until_complete(do('localhost:22023'))\r\n```\r\n\r\nYou should get an output similar to the following :\r\n```console\r\n$> python3 reproductible.py\r\n2020-03-13 11:30:35.297674\r\n2020-03-13 11:30:35.302617\r\n<ClientResponse(http://127.0.0.1:22023/data/91a6570c981c96a35cffc819b203115085e7293c02f3196bd5566bc10b6c1663) [400 Bad Request]>\r\n<CIMultiDictProxy('x-request-id': '0', 'Content-Type': 'text/plain', 'Content-Length': '41')>\r\n\r\n2020-03-13 11:30:35.297674\r\n2020-03-13 11:30:35.302617\r\n<ClientResponse(http://127.0.0.1:22023/data/91a6570c981c96a35cffc819b203115085e7293c02f3196bd5566bc10b6c1663) [400 Bad Request]>\r\n<CIMultiDictProxy('x-request-id': '0', 'Content-Type': 'text/plain', 'Content-Length': '41')>\r\n\r\n2020-03-13 11:32:06.165579\r\n2020-03-13 11:32:37.738726\r\n<ClientResponse(http://localhost:22023/data/91a6570c981c96a35cffc819b203115085e7293c02f3196bd5566bc10b6c1663) [400 Bad Request]>\r\n<CIMultiDictProxy('x-request-id': '0', 'Content-Type': 'text/plain', 'Content-Length': '41')>\r\n\r\n```\r\n\r\nAs you can see, in our server Setup, it took ~30 seconds to handle the request through `localhost`, while it was instanteneous with `127.0.0.1`.\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n\r\nWe expect both `localhost` and `127.0.0.1` to behave the same in terms of connecting to the remote server and running the request.\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n\r\n```console\r\n$ python --version\r\nPython 3.7.3\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.6.2\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /opt/shadow.services/scripts/data_manager/venv/lib/python3.7/site-packages\r\nRequires: async-timeout, attrs, multidict, yarl, chardet\r\n```\r\n\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.5\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /opt/shadow.services/scripts/data_manager/venv/lib/python3.7/site-packages\r\nRequires: \r\nRequired-by: yarl, aiohttp\r\n```\r\n\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.4.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /opt/shadow.services/scripts/data_manager/venv/lib/python3.7/site-packages\r\nRequires: multidict, idna\r\nRequired-by: aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n\r\nAs stated in the bug description, this bug happens in our production-ready servers, and I cannot reproduce it on my laptop, for instance.\r\n\r\nAs I may not be knowledgeable enough in network, I did not know what could be relevant to this, and chose to turn to the community/developers of aiohttp (you), with which I observed the issue.\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4627/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4627/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4626", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4626/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4626/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4626/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4626", "id": 580263369, "node_id": "MDU6SXNzdWU1ODAyNjMzNjk=", "number": 4626, "title": "Parameter \"loop_factory\" should be declared explicitly via indirect or in function itself", "user": {"login": "dcramer", "id": 23610, "node_id": "MDQ6VXNlcjIzNjEw", "avatar_url": "https://avatars.githubusercontent.com/u/23610?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dcramer", "html_url": "https://github.com/dcramer", "followers_url": "https://api.github.com/users/dcramer/followers", "following_url": "https://api.github.com/users/dcramer/following{/other_user}", "gists_url": "https://api.github.com/users/dcramer/gists{/gist_id}", "starred_url": "https://api.github.com/users/dcramer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dcramer/subscriptions", "organizations_url": "https://api.github.com/users/dcramer/orgs", "repos_url": "https://api.github.com/users/dcramer/repos", "events_url": "https://api.github.com/users/dcramer/events{/privacy}", "received_events_url": "https://api.github.com/users/dcramer/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-03-12T22:40:16Z", "updated_at": "2020-03-12T23:12:57Z", "closed_at": "2020-03-12T23:12:57Z", "author_association": "NONE", "active_lock_reason": null, "body": "Attempting to upgrade from 3.7.2 to 3.8.1 and I started seeing the following in py.test with test discovery:\r\n\r\nParameter \"loop_factory\" should be declared explicitly via indirect or in function itself\r\n\r\nThe commonality it turns out were async functions, and it appears to be caused somewhere within aiohttp. I'm not that familiar with asyncio or aiohttp, so I'm happy to debug more with guidance, but I'm hoping someone might have more thoughts here.\r\n\r\nRelated packages:\r\n\r\n```\r\naiohttp==3.6.2\r\npytest==5.4.0\r\npytest-aiohttp==0.3.0\r\npytest-cov==2.8.1\r\npytest-forked==1.1.3\r\npytest-mock==2.0.0\r\npytest-responses==0.4.0\r\npytest-xdist==1.31.0\r\n```\r\n\r\nSome detail around the callstack:\r\n\r\n```\r\n\u279c  ~/D/zeus (feat/increase-lru-cache) \u2717 py.test -x --pdb\r\n=========================================================================================== test session starts ============================================================================================\r\nplatform darwin -- Python 3.8.1, pytest-5.4.0, py-1.8.1, pluggy-0.13.1\r\nrootdir: /Users/dcramer/Development/zeus, inifile: setup.cfg\r\nplugins: mock-2.0.0, celery-4.1.1, xdist-1.31.0, aiohttp-0.3.0, forked-1.1.3, responses-0.4.0, cov-2.8.1\r\ncollecting 186 items\r\n>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> traceback >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>\r\nIn function \"test_health_check\":\r\nParameter \"loop_factory\" should be declared explicitly via indirect or in function itself\r\n>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> entering PDB >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>\r\n\r\n>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> PDB post_mortem (IO-capturing turned off) >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>\r\n> /Users/dcramer/Development/zeus/.venv/lib/python3.8/site-packages/_pytest/python.py(1144)_validate_explicit_parameters()\r\n-> fail(msg, pytrace=False)\r\n(Pdb) l\r\n1139 \t                func_name = self.function.__name__\r\n1140 \t                msg = (\r\n1141 \t                    'In function \"{func_name}\":\\n'\r\n1142 \t                    'Parameter \"{arg}\" should be declared explicitly via indirect or in function itself'\r\n1143 \t                ).format(func_name=func_name, arg=arg)\r\n1144 ->\t                fail(msg, pytrace=False)\r\n1145\r\n1146\r\n1147 \tdef _find_parametrized_scope(argnames, arg2fixturedefs, indirect):\r\n1148 \t    \"\"\"Find the most appropriate scope for a parametrized call based on its arguments.\r\n1149\r\n(Pdb) u\r\n> /Users/dcramer/Development/zeus/.venv/lib/python3.8/site-packages/_pytest/python.py(939)parametrize()\r\n-> self._validate_explicit_parameters(argnames, indirect)\r\n(Pdb) l\r\n934\r\n935  \t        self._validate_if_using_arg_names(argnames, indirect)\r\n936\r\n937  \t        arg_values_types = self._resolve_arg_value_types(argnames, indirect)\r\n938\r\n939  ->\t        self._validate_explicit_parameters(argnames, indirect)\r\n940\r\n941  \t        # Use any already (possibly) generated ids with parametrize Marks.\r\n942  \t        if _param_mark and _param_mark._param_ids_from:\r\n943  \t            generated_ids = _param_mark._param_ids_from._param_ids_generated\r\n944  \t            if generated_ids is not None:\r\n(Pdb) u\r\n> /Users/dcramer/Development/zeus/.venv/lib/python3.8/site-packages/aiohttp/pytest_plugin.py(203)pytest_generate_tests()\r\n-> metafunc.parametrize(\"loop_factory\",\r\n(Pdb) l\r\n198  \t                    \"Unknown loop '%s', available loops: %s\" % (\r\n199  \t                        name, list(factories.keys())))\r\n200  \t            else:\r\n201  \t                continue\r\n202  \t        factories[name] = avail_factories[name]\r\n203  ->\t    metafunc.parametrize(\"loop_factory\",\r\n204  \t                         list(factories.values()),\r\n205  \t                         ids=list(factories.keys()))\r\n206\r\n207\r\n208  \t@pytest.fixture\r\n```", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4626/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4626/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4622", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4622/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4622/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4622/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4622", "id": 579232316, "node_id": "MDU6SXNzdWU1NzkyMzIzMTY=", "number": 4622, "title": "Charset is not taken from HTTP headers during multipart requests", "user": {"login": "andrew-diamondj", "id": 62059625, "node_id": "MDQ6VXNlcjYyMDU5NjI1", "avatar_url": "https://avatars.githubusercontent.com/u/62059625?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andrew-diamondj", "html_url": "https://github.com/andrew-diamondj", "followers_url": "https://api.github.com/users/andrew-diamondj/followers", "following_url": "https://api.github.com/users/andrew-diamondj/following{/other_user}", "gists_url": "https://api.github.com/users/andrew-diamondj/gists{/gist_id}", "starred_url": "https://api.github.com/users/andrew-diamondj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andrew-diamondj/subscriptions", "organizations_url": "https://api.github.com/users/andrew-diamondj/orgs", "repos_url": "https://api.github.com/users/andrew-diamondj/repos", "events_url": "https://api.github.com/users/andrew-diamondj/events{/privacy}", "received_events_url": "https://api.github.com/users/andrew-diamondj/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1831256427, "node_id": "MDU6TGFiZWwxODMxMjU2NDI3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/reproducer:%20present", "name": "reproducer: present", "color": "c2e0c6", "default": false, "description": "This PR or issue contains code, which reproduce the problem described or clearly understandable STR"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2020-03-11T12:35:05Z", "updated_at": "2020-03-13T17:11:57Z", "closed_at": "2020-03-13T17:11:57Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nIf multipart request is received with some dedicated charset, described in \"Content-Type\" header, and content type header is missing in a boundary field, charset should be taken from request header as a default encoding. But it is ignored, and default UTF-8 charset is used for decoding.\r\nSo if request has for example cyrillic symbols in boundary field and field is encoded to windows-1251, we have aiohttp exception\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n1. Have environment on python 3.7 with `aiohttp==3.6.2`\r\n2. Run script\r\n```python\r\nfrom aiohttp import web\r\n\r\nasync def handle(request):\r\n    _post = await request.post()\r\n    text = \"Responce\"\r\n    return web.Response(text=text)\r\n\r\napp = web.Application()\r\napp.add_routes([web.post('/service_info', handle)])\r\n\r\nif __name__ == '__main__':\r\n    web.run_app(app, port=8081)\r\n```\r\n3. Post request to server:\r\nHeaders:\r\n```python\r\n'Host': 'request.sender.com',\r\n'Content-Length': '448', \r\n'Content-Type': 'multipart/form-data; charset=windows-1251; boundary=BS_20200311145724'\r\n```\r\nBody:\r\n```console\r\n--BS_20200311145724\r\nContent-Disposition: form-data; name=\"XML\"\r\n\r\n<?xml version=\"1.0\" encoding=\"windows-1251\" ?>\r\n..... Some XML with cyrillic chars\r\n\r\n--BS_20200311145724--\r\n```\r\n\r\n4. See exception below.\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\nRequest should be decoded in right way. \r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n```python-traceback\r\nTraceback (most recent call last):\r\n  File \"/home/user/PycharmProjects/project/venv/lib/python3.7/site-packages/aiohttp/web_protocol.py\", line 418, in start\r\n    resp = await task\r\n  File \"/home/user/PycharmProjects/project/venv/lib/python3.7/site-packages/aiohttp/web_app.py\", line 458, in _handle\r\n    resp = await handler(request)\r\n  File \"/home/user/PycharmProjects/project/venv/lib/python3.7/site-packages/aiohttp/web_urldispatcher.py\", line 892, in _iter\r\n    resp = await method()\r\n  File \"/home/user/PycharmProjects/project/handlers/views.py\", line 33, in post\r\n    req = await self.request.post()\r\n  File \"/home/user/PycharmProjects/project/venv/lib/python3.7/site-packages/aiohttp/web_request.py\", line 643, in post.\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\nWhen parsing multipart fields, aiohttp tries to get charset from content-type header of THIS field. And if no charset is found default value \"utf-8\" is taken. So charset in a request header is ignored.\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4622/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4622/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4605", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4605/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4605/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4605/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4605", "id": 573284718, "node_id": "MDU6SXNzdWU1NzMyODQ3MTg=", "number": 4605, "title": "A few client tests fail with PyPy3", "user": {"login": "Traktormaster", "id": 9530287, "node_id": "MDQ6VXNlcjk1MzAyODc=", "avatar_url": "https://avatars.githubusercontent.com/u/9530287?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Traktormaster", "html_url": "https://github.com/Traktormaster", "followers_url": "https://api.github.com/users/Traktormaster/followers", "following_url": "https://api.github.com/users/Traktormaster/following{/other_user}", "gists_url": "https://api.github.com/users/Traktormaster/gists{/gist_id}", "starred_url": "https://api.github.com/users/Traktormaster/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Traktormaster/subscriptions", "organizations_url": "https://api.github.com/users/Traktormaster/orgs", "repos_url": "https://api.github.com/users/Traktormaster/repos", "events_url": "https://api.github.com/users/Traktormaster/events{/privacy}", "received_events_url": "https://api.github.com/users/Traktormaster/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-02-29T12:20:29Z", "updated_at": "2020-10-21T10:15:49Z", "closed_at": "2020-10-21T10:15:49Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I wanted to try aiohttp with PyPy to see how it performs. I decided to run the testsuite before performance testing and found 3 tests that consistently fail with PyPy but not with CPython.\r\n\r\n\r\n\ud83d\udca1 **To Reproduce**\r\nCreate environment and acquire latest stable version.\r\n```\r\npypy3 -m venv /tmp/ee\r\nsource /tmp/ee/bin/activate\r\ncd /tmp\r\ngit clone https://github.com/aio-libs/aiohttp.git --branch v3.6.2 --recurse-submodules\r\ncd aiohttp\r\npip install -r requirements/dev.txt\r\nmake test\r\n```\r\nNOTE: mypy will not work with pypy so make will terminate without running the tests.\r\nThis will run the tests related to this bug report: `py.test tests -k test_unicode_get`\r\nExcerpt of what the failing tests are:\r\n```\r\ncollected 2473 items / 2469 deselected / 4 selected                                           \r\n\r\ntests/test_client_request.py::test_unicode_get1[pyloop] FAILED                          [ 25%]\r\ntests/test_client_request.py::test_unicode_get2[pyloop] FAILED                          [ 50%]\r\ntests/test_client_request.py::test_unicode_get3[pyloop] PASSED                          [ 75%]\r\ntests/test_client_request.py::test_unicode_get4[pyloop] FAILED                          [100%]\r\n\r\n========================================== FAILURES ===========================================\r\n__________________________________ test_unicode_get1[pyloop] __________________________________\r\n\r\nmake_request = <function make_request.<locals>.maker at 0x000055f90a81eac0>\r\n\r\n    def test_unicode_get1(make_request) -> None:\r\n        req = make_request('get', 'http://python.org',\r\n                           params={'foo': 'f\\xf8\\xf8'})\r\n>       assert 'http://python.org/?foo=f%C3%B8%C3%B8' == str(req.url)\r\nE       AssertionError: assert 'http://pytho...f%C3%B8%C3%B8' == 'http://pytho...f%C3%83%C2%83'\r\nE         - http://python.org/?foo=f%C3%B8%C3%B8\r\nE         ?                             -    ---\r\nE         + http://python.org/?foo=f%C3%83%C2%83\r\nE         ?                              +  +++\r\n\r\ntests/test_client_request.py:468: AssertionError\r\n__________________________________ test_unicode_get2[pyloop] __________________________________\r\n\r\nmake_request = <function make_request.<locals>.maker at 0x000055f90badff60>\r\n\r\n    def test_unicode_get2(make_request) -> None:\r\n        req = make_request('', 'http://python.org',\r\n                           params={'f\\xf8\\xf8': 'f\\xf8\\xf8'})\r\n    \r\n>       assert 'http://python.org/?f%C3%B8%C3%B8=f%C3%B8%C3%B8' == str(req.url)\r\nE       AssertionError: assert 'http://pytho...f%C3%B8%C3%B8' == 'http://pytho...f%C3%83%C2%83'\r\nE         - http://python.org/?f%C3%B8%C3%B8=f%C3%B8%C3%B8\r\nE         ?                         -    ---      -    ---\r\nE         + http://python.org/?f%C3%83%C2%83=f%C3%83%C2%83\r\nE         ?                          +  +++        +  +++\r\n\r\ntests/test_client_request.py:475: AssertionError\r\n__________________________________ test_unicode_get4[pyloop] __________________________________\r\n\r\nmake_request = <function make_request.<locals>.maker at 0x000055f90a176d40>\r\n\r\n    def test_unicode_get4(make_request) -> None:\r\n        def join(*suffix):\r\n            return urllib.parse.urljoin('http://python.org/', '/'.join(suffix))\r\n    \r\n        req = make_request('', join('\\xf8'), params={'foo': 'foo'})\r\n>       assert 'http://python.org/%C3%B8?foo=foo' == str(req.url)\r\nE       AssertionError: assert 'http://pytho...C3%B8?foo=foo' == 'http://pytho...C3%83?foo=foo'\r\nE         - http://python.org/%C3%B8?foo=foo\r\nE         ?                       -\r\nE         + http://python.org/%C3%83?foo=foo\r\nE         ?                        +\r\n\r\ntests/test_client_request.py:488: AssertionError\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n```\r\nPython 3.6.9 (1608da62bfc71e8ac775121dd0b21bb72e61c6ea, Dec 25 2019, 02:47:23)\r\n[PyPy 7.3.0 with GCC 9.2.0]\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.6.2\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /tmp/aiohttp\r\nRequires: attrs, chardet, multidict, async-timeout, yarl, idna-ssl, typing-extensions\r\nRequired-by:\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.5.2\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /tmp/ee/site-packages\r\nRequires: \r\nRequired-by: aiohttp, yarl\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.3.0\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /tmp/ee/site-packages\r\nRequires: multidict, idna\r\nRequired-by: aiohttp\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4605/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4605/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4603", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4603/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4603/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4603/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4603", "id": 572948958, "node_id": "MDU6SXNzdWU1NzI5NDg5NTg=", "number": 4603, "title": "Docstring inaccurate; aiohttp.client.request", "user": {"login": "wereii", "id": 8504482, "node_id": "MDQ6VXNlcjg1MDQ0ODI=", "avatar_url": "https://avatars.githubusercontent.com/u/8504482?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wereii", "html_url": "https://github.com/wereii", "followers_url": "https://api.github.com/users/wereii/followers", "following_url": "https://api.github.com/users/wereii/following{/other_user}", "gists_url": "https://api.github.com/users/wereii/gists{/gist_id}", "starred_url": "https://api.github.com/users/wereii/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wereii/subscriptions", "organizations_url": "https://api.github.com/users/wereii/orgs", "repos_url": "https://api.github.com/users/wereii/repos", "events_url": "https://api.github.com/users/wereii/events{/privacy}", "received_events_url": "https://api.github.com/users/wereii/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1363888987, "node_id": "MDU6TGFiZWwxMzYzODg4OTg3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/pr-merged", "name": "pr-merged", "color": "363396", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-02-28T19:10:12Z", "updated_at": "2020-03-19T22:19:05Z", "closed_at": "2020-03-19T22:19:05Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nIf you see the \"Usage\" part docstring of [`aiohttp.client.request`(or also `aiohttp.request`)](https://github.com/aio-libs/aiohttp/blob/v4.0.0a1/aiohttp/client.py#L1068) there is\r\n```\r\n...\r\n    Usage::\r\n      >>> import aiohttp\r\n      >>> resp = await aiohttp.request('GET', 'http://python.org/')\r\n      >>> resp\r\n      <ClientResponse(python.org/) [200]>\r\n      >>> data = await resp.read()\r\n    \"\"\"\r\n```\r\nWhich as it seems isn't really reflecting of how this function should be used (ie context manager). Also see comments on issue #4065.\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n\r\nThe \"Usage\" part of the docstring shoud probably look something like this ...\r\n\r\n```\r\n...\r\n    Usage:\r\n      >>> import aiohttp\r\n      >>> async with aiohttp.request('GET', 'http://python.org/') as resp:\r\n      ...     print(resp)\r\n      ...     data = await resp.read()\r\n      <ClientResponse(https://www.python.org/) [200 OK]>\r\n    \"\"\"\r\n```\r\n\r\n\ud83d\udccb **My version of the Python**\r\n\r\n```console\r\n$ python3 --version\r\nPython 3.7.5\r\n```\r\n\r\n\ud83d\udccb **My version of the aiohttp/yarl/multidict distributions**\r\n\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.6.2\r\n...\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.5\r\n...\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.4.2\r\n...\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n- Context: client\r\n- Ubuntu 19.10\r\n- All packages from pip, no version pinning (latest avaliable?), running from virtualenv", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4603/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4603/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4600", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4600/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4600/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4600/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4600", "id": 572391224, "node_id": "MDU6SXNzdWU1NzIzOTEyMjQ=", "number": 4600, "title": "Cannot access an error message when receive 400", "user": {"login": "yeralin", "id": 8620461, "node_id": "MDQ6VXNlcjg2MjA0NjE=", "avatar_url": "https://avatars.githubusercontent.com/u/8620461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yeralin", "html_url": "https://github.com/yeralin", "followers_url": "https://api.github.com/users/yeralin/followers", "following_url": "https://api.github.com/users/yeralin/following{/other_user}", "gists_url": "https://api.github.com/users/yeralin/gists{/gist_id}", "starred_url": "https://api.github.com/users/yeralin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yeralin/subscriptions", "organizations_url": "https://api.github.com/users/yeralin/orgs", "repos_url": "https://api.github.com/users/yeralin/repos", "events_url": "https://api.github.com/users/yeralin/events{/privacy}", "received_events_url": "https://api.github.com/users/yeralin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2020-02-27T22:08:21Z", "updated_at": "2021-09-29T17:03:22Z", "closed_at": "2020-03-03T16:26:44Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nWhile using `aiohttp.client.ClientSession` to send requests and receive responses, I found out that I cannot access a bad response's error message while catching `ClientResponseError` because `aiohttp` simply does not propagate the response content when raising `ClientResponseError` here: https://github.com/aio-libs/aiohttp/blob/63a0d1040533947ef4973b3baed87e5fb7870e5a/aiohttp/client_reqrep.py#L879-L889\r\nIt only passes `self.status == 400` and `self.reason == \"BAD REQUEST\"`.\r\n\r\n\ud83d\udca1 **To Reproduce**\r\n```\r\nfrom aiohttp import ClientResponseError, ClientSession\r\n\r\nsession = ClientSession(raise_for_status=True)\r\n\r\ntry:\r\n    # assuming that the request will result in 400 BAD REQUEST with a specific error message\r\n    async with session.post(**kwargs) as response: \r\n        # handle response\r\nexcept ClientResponseError as ex:\r\n    print(ex.__dict__) \r\n    \"\"\"\r\n        {'request_info': RequestInfo(...), \r\n        'status': 400, \r\n        'message': 'BAD REQUEST', \r\n        'headers': ..., \r\n        'history': ()}\r\n    \"\"\"\r\n```\r\n\r\n\ud83d\udca1 **Expected behavior**\r\nReceived `ClientResponseError` should contain a response message received along with 400 response.\r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n> Not applicable\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n$ python --version\r\nPython 3.7.6\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\n$ python -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.5.4\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /Applications/miniconda3/envs/sw-asyncher-services/lib/python3.7/site-packages\r\nRequires: yarl, async-timeout, attrs, multidict, chardet\r\nRequired-by: aiojobs, aiohttp-apispec\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.5\r\nSummary: multidict implementation\r\nHome-page: https://github.com/aio-libs/multidict\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /Applications/miniconda3/envs/sw-asyncher-services/lib/python3.7/site-packages\r\nRequires:\r\nRequired-by: yarl, aiohttp\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.4.2\r\nSummary: Yet another URL library\r\nHome-page: https://github.com/aio-libs/yarl/\r\nAuthor: Andrew Svetlov\r\nAuthor-email: andrew.svetlov@gmail.com\r\nLicense: Apache 2\r\nLocation: /Applications/miniconda3/envs/sw-asyncher-services/lib/python3.7/site-packages\r\nRequires: idna, multidict\r\nRequired-by: aiohttp\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\nOn the server side, when I change the response from 400 to any non-bad response say 200, I can access passed error message.\r\n\r\nCurrent workaround would be to have `session = ClientSession(raise_for_status=False)`, and handle bad responses manually.\r\n\r\n\ud83d\udd37 **Possible solution**\r\nModify `ClientResponseError` exception to include an error message, convert `raise_for_status` method to be async to be able to read the response message, and raise `ClientResponseError` with the read message.\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4600/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4600/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4597", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4597/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4597/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4597/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4597", "id": 571143464, "node_id": "MDU6SXNzdWU1NzExNDM0NjQ=", "number": 4597, "title": "client : No data can be obtained using aiohttp, the request can be", "user": {"login": "isleifeng", "id": 9168146, "node_id": "MDQ6VXNlcjkxNjgxNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/9168146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/isleifeng", "html_url": "https://github.com/isleifeng", "followers_url": "https://api.github.com/users/isleifeng/followers", "following_url": "https://api.github.com/users/isleifeng/following{/other_user}", "gists_url": "https://api.github.com/users/isleifeng/gists{/gist_id}", "starred_url": "https://api.github.com/users/isleifeng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/isleifeng/subscriptions", "organizations_url": "https://api.github.com/users/isleifeng/orgs", "repos_url": "https://api.github.com/users/isleifeng/repos", "events_url": "https://api.github.com/users/isleifeng/events{/privacy}", "received_events_url": "https://api.github.com/users/isleifeng/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 58986078, "node_id": "MDU6TGFiZWw1ODk4NjA3OA==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/invalid", "name": "invalid", "color": "e4e669", "default": true, "description": "This doesn't seem right"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-02-26T08:11:55Z", "updated_at": "2020-10-27T06:44:03Z", "closed_at": "2020-02-26T13:09:07Z", "author_association": "NONE", "active_lock_reason": null, "body": "close", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4597/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4597/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4587", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4587/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4587/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4587/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4587", "id": 568767794, "node_id": "MDU6SXNzdWU1Njg3Njc3OTQ=", "number": 4587, "title": "Cannot write to closing transport", "user": {"login": "ajay1mg", "id": 36618391, "node_id": "MDQ6VXNlcjM2NjE4Mzkx", "avatar_url": "https://avatars.githubusercontent.com/u/36618391?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ajay1mg", "html_url": "https://github.com/ajay1mg", "followers_url": "https://api.github.com/users/ajay1mg/followers", "following_url": "https://api.github.com/users/ajay1mg/following{/other_user}", "gists_url": "https://api.github.com/users/ajay1mg/gists{/gist_id}", "starred_url": "https://api.github.com/users/ajay1mg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ajay1mg/subscriptions", "organizations_url": "https://api.github.com/users/ajay1mg/orgs", "repos_url": "https://api.github.com/users/ajay1mg/repos", "events_url": "https://api.github.com/users/ajay1mg/events{/privacy}", "received_events_url": "https://api.github.com/users/ajay1mg/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2020-02-21T06:48:12Z", "updated_at": "2020-10-31T10:13:10Z", "closed_at": "2020-10-21T10:18:37Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nEvery few minutes we get **Cannot write to closing transport** exception on our gateway service which is a part of our microservices infrastructure.\r\n\r\nGateway service calls all other services with a timeout of 10 seconds. The other service that gateway calls are also based on aiohttp framework. One such service which is giving most of the exceptions doesn't raise any on its own server.\r\n\r\nWe are on ubuntu 16.04 LTS\r\n\r\n\ud83d\udca1 **Expected behavior**\r\nOur gateway service should be able to handle the timeouts.\r\n\r\n\r\nWe are getting the following exception on our server every few minutes:\r\n\ud83d\udccb **Logs/tracebacks**\r\n<!-- If applicable, add logs/tracebacks to help explain your problem. -->\r\n```python-traceback (paste your traceback in the next line)\r\nTraceback (most recent call last):\r\n  File \"/home/ubuntu/.pyenv/versions/gateway/lib/python3.7/site-packages/aiohttp/client.py\", line 502, in _request\r\n    resp = await req.send(conn)\r\n  File \"/home/ubuntu/.pyenv/versions/gateway/lib/python3.7/site-packages/aiohttp/client_reqrep.py\", line 629, in send\r\n    await writer.write_headers(status_line, self.headers)\r\n  File \"/home/ubuntu/.pyenv/versions/gateway/lib/python3.7/site-packages/aiohttp/http_writer.py\", line 112, in write_headers\r\n    self._write(buf)\r\n  File \"/home/ubuntu/.pyenv/versions/gateway/lib/python3.7/site-packages/aiohttp/http_writer.py\", line 67, in _write\r\n    raise ConnectionResetError('Cannot write to closing transport')\r\nConnectionResetError: Cannot write to closing transport\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/ubuntu/.pyenv/versions/gateway/lib/python3.7/site-packages/hydra/base_api_request.py\", line 75, in request\r\n    timeout=cls.request_timeout(timeout))\r\n  File \"<string>\", line 5, in wrapper\r\n  File \"/home/ubuntu/.pyenv/versions/3.7.2/envs/gateway/lib/python3.7/site-packages/newrelic/hooks/framework_aiohttp.py\", line 260, in _coro\r\n    response = yield from wrapped(*args, **kwargs)\r\n  File \"/home/ubuntu/.pyenv/versions/gateway/lib/python3.7/site-packages/aiohttp/client.py\", line 514, in _request\r\n    raise ClientOSError(*exc.args) from exc\r\naiohttp.client_exceptions.ClientOSError: Cannot write to closing transport\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/ubuntu/.pyenv/versions/gateway/lib/python3.7/site-packages/hydra/decorators/http.py\", line 41, in f\r\n    result = await wait_for(shield(wrapped_func(self, *args, **kwargs)), api_timeout)\r\n  File \"/home/ubuntu/.pyenv/versions/3.7.2/lib/python3.7/asyncio/tasks.py\", line 416, in wait_for\r\n    return fut.result()\r\n  File \"/home/ubuntu/1mg/API-Gateway/gateway/utils.py\", line 189, in wrapper\r\n    result = await func(*args, **kwargs)\r\n  File \"/home/ubuntu/1mg/API-Gateway/gateway/managers/app_context_manager.py\", line 98, in _build_shared_context\r\n    result = await func(*args, **kwargs)\r\n  File \"/home/ubuntu/1mg/API-Gateway/gateway/handlers/mingler/service_handler.py\", line 14, in services\r\n    response = await Services.get_services(params)\r\n  File \"/home/ubuntu/1mg/API-Gateway/gateway/service_clients/mingler/services.py\", line 13, in get_services\r\n    result = await cls.post(path, data=params, headers=headers)\r\n  File \"/home/ubuntu/.pyenv/versions/gateway/lib/python3.7/site-packages/hydra/base_api_request.py\", line 144, in post\r\n    response_headers_list=response_headers_list)\r\n  File \"/home/ubuntu/.pyenv/versions/gateway/lib/python3.7/site-packages/hydra/base_api_request.py\", line 93, in request\r\n    raise HTTPRequestException(error={'message': exception_message})\r\nhydra.exceptions.HTTPRequestException\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n<!-- Attach your version of the Python. -->\r\n```console\r\n3.7.2\r\n```\r\n\r\n\ud83d\udccb **Your version of the ubuntu/aiohttp/yarl/multidict distributions**\r\n<!-- Attach your version of the distributions in the code blocks below. -->\r\n```console\r\naiohttp==3.6.2\r\n```\r\n```console\r\nmultidict==4.5.2\r\n```\r\n```console\r\nyarl==1.3.0\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\n<!-- Add any other context about the problem here, in the next line. -->\r\nThis issue is already tracked in a number of threads on issue tracker on GitHub like:\r\nhttps://github.com/ITISFoundation/osparc-simcore/issues/1100\r\nhttps://github.com/aio-libs/aiohttp/issues/3648\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4587/reactions", "total_count": 7, "+1": 7, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4587/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4580", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4580/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4580/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4580/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4580", "id": 565955288, "node_id": "MDU6SXNzdWU1NjU5NTUyODg=", "number": 4580, "title": "web access log request.remote not right", "user": {"login": "cole-dda", "id": 1077830, "node_id": "MDQ6VXNlcjEwNzc4MzA=", "avatar_url": "https://avatars.githubusercontent.com/u/1077830?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cole-dda", "html_url": "https://github.com/cole-dda", "followers_url": "https://api.github.com/users/cole-dda/followers", "following_url": "https://api.github.com/users/cole-dda/following{/other_user}", "gists_url": "https://api.github.com/users/cole-dda/gists{/gist_id}", "starred_url": "https://api.github.com/users/cole-dda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cole-dda/subscriptions", "organizations_url": "https://api.github.com/users/cole-dda/orgs", "repos_url": "https://api.github.com/users/cole-dda/repos", "events_url": "https://api.github.com/users/cole-dda/events{/privacy}", "received_events_url": "https://api.github.com/users/cole-dda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 58986080, "node_id": "MDU6TGFiZWw1ODk4NjA4MA==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/wontfix", "name": "wontfix", "color": "b7942c", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-02-16T19:23:14Z", "updated_at": "2020-10-24T09:00:08Z", "closed_at": "2020-10-24T09:00:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nweb access log request.remote \uff0cbut always use origin request object\uff0cnot modified by middlewares the one\u3002 so\uff0cwhen behind on reverse proxy\uff0crequest.remote always  the proxy address\u3002\r\n \r\n\r\n\ud83d\udca1 **To Reproduce**\r\n\r\naccess a aiohttp app server\uff0c view log\r\n\r\n<img width=\"742\" alt=\"screenshot_3134\" src=\"https://user-images.githubusercontent.com/1077830/74611143-41a98780-5134-11ea-9f97-032382e67b76.png\">\r\n\r\n\r\n\ud83d\udca1 **Expected behavior**\r\n\r\nthe ip should use real remote\u3002\r\n\r\nI already setup middlewares \uff0csuch as aiohttp-remotes\u3002\r\n\r\n<img width=\"853\" alt=\"screenshot_3132\" src=\"https://user-images.githubusercontent.com/1077830/74611182-91884e80-5134-11ea-9df8-fcf95310e4b5.png\">\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4580/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4580/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4558", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4558/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4558/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4558/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4558", "id": 560789278, "node_id": "MDU6SXNzdWU1NjA3ODkyNzg=", "number": 4558, "title": "client_max_size  behavior not same", "user": {"login": "cole-dda", "id": 1077830, "node_id": "MDQ6VXNlcjEwNzc4MzA=", "avatar_url": "https://avatars.githubusercontent.com/u/1077830?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cole-dda", "html_url": "https://github.com/cole-dda", "followers_url": "https://api.github.com/users/cole-dda/followers", "following_url": "https://api.github.com/users/cole-dda/following{/other_user}", "gists_url": "https://api.github.com/users/cole-dda/gists{/gist_id}", "starred_url": "https://api.github.com/users/cole-dda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cole-dda/subscriptions", "organizations_url": "https://api.github.com/users/cole-dda/orgs", "repos_url": "https://api.github.com/users/cole-dda/repos", "events_url": "https://api.github.com/users/cole-dda/events{/privacy}", "received_events_url": "https://api.github.com/users/cole-dda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1363888987, "node_id": "MDU6TGFiZWwxMzYzODg4OTg3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/pr-merged", "name": "pr-merged", "color": "363396", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-02-06T05:31:12Z", "updated_at": "2020-10-16T15:14:53Z", "closed_at": "2020-10-16T15:14:53Z", "author_association": "NONE", "active_lock_reason": null, "body": "\r\n\r\nweb_request.py\r\n\r\n<img width=\"666\" alt=\"screenshot_3109\" src=\"https://user-images.githubusercontent.com/1077830/73392665-345b6300-4315-11ea-8cfa-7d5097920421.png\">\r\n\r\n<img width=\"666\" alt=\"screenshot_3110\" src=\"https://user-images.githubusercontent.com/1077830/73392792-74bae100-4315-11ea-85a0-1ea57b62a95d.png\">\r\n\r\n\r\n## Expected behaviour\r\n\r\nimage1,line 565 , I think use **\">\"** is better.\r\n\r\nimage2,line 625, is right.\r\n\r\n## Your environment\r\naiohttp 3.6.2\r\npython 3.6.8\r\nmac\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4558/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4558/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4554", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4554/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4554/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4554/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4554", "id": 559341845, "node_id": "MDU6SXNzdWU1NTkzNDE4NDU=", "number": 4554, "title": "GET Requests to link-local IPv6 addresses don't work on Python 3.7+", "user": {"login": "mjonuschat", "id": 203423, "node_id": "MDQ6VXNlcjIwMzQyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/203423?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mjonuschat", "html_url": "https://github.com/mjonuschat", "followers_url": "https://api.github.com/users/mjonuschat/followers", "following_url": "https://api.github.com/users/mjonuschat/following{/other_user}", "gists_url": "https://api.github.com/users/mjonuschat/gists{/gist_id}", "starred_url": "https://api.github.com/users/mjonuschat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mjonuschat/subscriptions", "organizations_url": "https://api.github.com/users/mjonuschat/orgs", "repos_url": "https://api.github.com/users/mjonuschat/repos", "events_url": "https://api.github.com/users/mjonuschat/events{/privacy}", "received_events_url": "https://api.github.com/users/mjonuschat/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344995986, "node_id": "MDU6TGFiZWwzNDQ5OTU5ODY=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/client", "name": "client", "color": "bfd4f2", "default": false, "description": null}, {"id": 1363888951, "node_id": "MDU6TGFiZWwxMzYzODg4OTUx", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/pr-available", "name": "pr-available", "color": "363396", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-02-03T21:21:48Z", "updated_at": "2020-10-16T13:27:22Z", "closed_at": "2020-10-16T13:27:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc1e **Describe the bug**\r\nThe aiohttp resolver loses information related to linklocal IPv6 addresses on Python 3.7+ due to a changes in the representation returned by `socket.getaddrinfo()`\r\n\r\n\ud83d\udca1 **To Reproduce**\r\nTry to get an URL like `http://[fe80::1%eth0]:8080/`, it will result in an OSError (Invalid argument) exception.\r\n\r\nThis seems to be due to the way that scopeid's are handled in [resolver.py](https://github.com/aio-libs/aiohttp/blob/72c2acd4850b1cbc638b413a7c28d96882b4d7e8/aiohttp/resolver.py#L31-L37):\r\n\r\nRun `socket.getaddrinfo('fe80::1%eth0', 8080, family=socket.AF_INET6, proto=socket.IPPROTO_TCP)[0][4]` on python 3.6:\r\n```python\r\nsocket.getaddrinfo('fe80::1%eth0', 8080, family=socket.AF_INET6, proto=socket.IPPROTO_TCP)[0][4]\r\n>>> socket.getaddrinfo('fe80::1%eth0', 8080, family=socket.AF_INET6, proto=socket.IPPROTO_TCP)[0][4]\r\n('fe80::1%eth0', 8080, 0, 4)\r\n```\r\n\r\nRun it on python 3.7:\r\n```python\r\n>>> socket.getaddrinfo('fe80::1%eth0', 8080, family=socket.AF_INET6, proto=socket.IPPROTO_TCP)[0][4]\r\n('fe80::1', 8080, 0, 4)y\r\n```\r\n\r\nThe `address` element of the tuple no longer includes the textual representation of the scope id, it's only contained in the matching scope_id element of the tuple - which then is missing when later callings _loop.create_connection().\r\n\r\n\ud83d\udca1 **Expected behavior**\r\nThe URL is successfully retrieved for link local IPv6 addresses.\r\n\r\n\r\n\ud83d\udccb **Logs/tracebacks**\r\n```python-traceback (paste your traceback in the next line)\r\nN/A\r\n```\r\n\r\n\ud83d\udccb **Your version of the Python**\r\n```console\r\n$ python3 --version\r\nPython 3.6.6\r\n$ python3.7 --version\r\nPython 3.7.5\r\n```\r\n\r\n\ud83d\udccb **Your version of the aiohttp/yarl/multidict distributions**\r\n```console\r\n$ python -m pip show aiohttp\r\npython -m pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.6.2\r\n```\r\n```console\r\n$ python -m pip show multidict\r\nName: multidict\r\nVersion: 4.7.4\r\n```\r\n```console\r\n$ python -m pip show yarl\r\nName: yarl\r\nVersion: 1.4.2\r\n```\r\n\r\n\ud83d\udccb **Additional context**\r\nOS: Centos7 Linux\r\nProxy Server: No\r\nRelated to: client", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4554/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4554/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4536", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4536/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4536/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4536/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4536", "id": 556045630, "node_id": "MDU6SXNzdWU1NTYwNDU2MzA=", "number": 4536, "title": "Problems when using proxy under Windows", "user": {"login": "libra146", "id": 17448639, "node_id": "MDQ6VXNlcjE3NDQ4NjM5", "avatar_url": "https://avatars.githubusercontent.com/u/17448639?v=4", "gravatar_id": "", "url": "https://api.github.com/users/libra146", "html_url": "https://github.com/libra146", "followers_url": "https://api.github.com/users/libra146/followers", "following_url": "https://api.github.com/users/libra146/following{/other_user}", "gists_url": "https://api.github.com/users/libra146/gists{/gist_id}", "starred_url": "https://api.github.com/users/libra146/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/libra146/subscriptions", "organizations_url": "https://api.github.com/users/libra146/orgs", "repos_url": "https://api.github.com/users/libra146/repos", "events_url": "https://api.github.com/users/libra146/events{/privacy}", "received_events_url": "https://api.github.com/users/libra146/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344996043, "node_id": "MDU6TGFiZWwzNDQ5OTYwNDM=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/server", "name": "server", "color": "006b75", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2020-01-28T08:06:32Z", "updated_at": "2021-01-18T19:46:01Z", "closed_at": "2020-12-05T10:03:55Z", "author_association": "NONE", "active_lock_reason": "off-topic", "body": "## Long story short\r\n\r\nI get an error when running the following code under Python 3.8.1 and aiohttp3.6.2 under Windows\r\n```\r\nimport aiohttp\r\nimport asyncio\r\n\r\n\r\nasync def main():\r\n    async with aiohttp.ClientSession() as session:\r\n        async with session.get('https://python.org', proxy='http://127.0.0.1:8888') as response:\r\n            print(\"Status:\", response.status)\r\n            print(\"Content-type:\", response.headers['content-type'])\r\n\r\n            html = await response.text()\r\n            print(\"Body:\", html[:15], \"...\")\r\n\r\n\r\nloop = asyncio.get_event_loop()\r\nloop.run_until_complete(main())\r\n\r\n```\r\n\r\n## Expected behaviour\r\n\r\n```\r\nStatus: 200\r\nContent-type: text/html; charset=utf-8\r\nBody: <!doctype html> ...\r\n```\r\n\r\n## Actual behaviour\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"C:\\Python38\\lib\\site-packages\\aiohttp\\connector.py\", line 936, in _wrap_\r\ncreate_connection\r\n    return await self._loop.create_connection(*args, **kwargs)  # type: ignore\r\n# noqa\r\n  File \"C:\\Python38\\lib\\asyncio\\base_events.py\", line 1046, in create_connection\r\n\r\n    transport, protocol = await self._create_connection_transport(\r\n  File \"C:\\Python38\\lib\\asyncio\\base_events.py\", line 1076, in _create_connectio\r\nn_transport\r\n    await waiter\r\n  File \"C:\\Python38\\lib\\asyncio\\proactor_events.py\", line 395, in _loop_writing\r\n    self._write_fut = self._loop._proactor.send(self._sock, data)\r\n  File \"C:\\Python38\\lib\\asyncio\\windows_events.py\", line 525, in send\r\n    self._register_with_iocp(conn)\r\n  File \"C:\\Python38\\lib\\asyncio\\windows_events.py\", line 714, in _register_with_\r\niocp\r\n    _overlapped.CreateIoCompletionPort(obj.fileno(), self._iocp, 0, 0)\r\nOSError: [WinError 87] The parameter is incorrect\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"test5.py\", line 16, in <module>\r\n    loop.run_until_complete(main())\r\n  File \"C:\\Python38\\lib\\asyncio\\base_events.py\", line 612, in run_until_complete\r\n\r\n    return future.result()\r\n  File \"test5.py\", line 7, in main\r\n    async with session.get('https://python.org', proxy='http://192.168.233.1:108\r\n8') as response:\r\n  File \"C:\\Python38\\lib\\site-packages\\aiohttp\\client.py\", line 1012, in __aenter\r\n__\r\n    self._resp = await self._coro\r\n  File \"C:\\Python38\\lib\\site-packages\\aiohttp\\client.py\", line 480, in _request\r\n    conn = await self._connector.connect(\r\n  File \"C:\\Python38\\lib\\site-packages\\aiohttp\\connector.py\", line 523, in connec\r\nt\r\n    proto = await self._create_connection(req, traces, timeout)\r\n  File \"C:\\Python38\\lib\\site-packages\\aiohttp\\connector.py\", line 855, in _creat\r\ne_connection\r\n    _, proto = await self._create_proxy_connection(\r\n  File \"C:\\Python38\\lib\\site-packages\\aiohttp\\connector.py\", line 1093, in _crea\r\nte_proxy_connection\r\n    transport, proto = await self._wrap_create_connection(\r\n  File \"C:\\Python38\\lib\\site-packages\\aiohttp\\connector.py\", line 943, in _wrap_\r\ncreate_connection\r\n    raise client_error(req.connection_key, exc) from exc\r\naiohttp.client_exceptions.ClientConnectorError: Cannot connect to host python.or\r\ng:443 ssl:default [The parameter is incorrect]\r\n```\r\n\r\n## Steps to reproduce\r\n\r\nRun the above code\r\n\r\n## Your environment\r\nOS: windows7\r\nproxy: v2ray\r\naiohttp: 3.6.2(client)\r\npython: 3.8.1\r\n\r\n**When I remove the proxy parameter, it works fine**\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4536/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4536/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4515", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4515/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4515/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4515/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4515", "id": 551888211, "node_id": "MDU6SXNzdWU1NTE4ODgyMTE=", "number": 4515, "title": "time in cookiejar.py tests reaches to far in to the future on some systems ", "user": {"login": "bqv", "id": 822863, "node_id": "MDQ6VXNlcjgyMjg2Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/822863?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bqv", "html_url": "https://github.com/bqv", "followers_url": "https://api.github.com/users/bqv/followers", "following_url": "https://api.github.com/users/bqv/following{/other_user}", "gists_url": "https://api.github.com/users/bqv/gists{/gist_id}", "starred_url": "https://api.github.com/users/bqv/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bqv/subscriptions", "organizations_url": "https://api.github.com/users/bqv/orgs", "repos_url": "https://api.github.com/users/bqv/repos", "events_url": "https://api.github.com/users/bqv/events{/privacy}", "received_events_url": "https://api.github.com/users/bqv/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 277836062, "node_id": "MDU6TGFiZWwyNzc4MzYwNjI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/good%20first%20issue", "name": "good first issue", "color": "7057ff", "default": true, "description": "Good for newcomers"}, {"id": 1363888951, "node_id": "MDU6TGFiZWwxMzYzODg4OTUx", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/pr-available", "name": "pr-available", "color": "363396", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-01-19T08:49:23Z", "updated_at": "2020-10-16T08:02:15Z", "closed_at": "2020-10-16T08:02:15Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Long story short\r\n\r\nRegression of #1188\r\n\r\n## Expected behaviour\r\n\r\nTests pass on armv7l\r\n\r\n## Actual behaviour\r\n\r\nTest run fails at test_cookiejar.py:383: OverflowError\r\n\r\n## Steps to reproduce\r\n\r\nRun tests\r\n\r\n## Your environment\r\n\r\nlinux 4.19\r\nnixos 20.03\r\narm v7l\r\npython 3.7\r\naiohttp client-3.6.2\r\n\r\n## Log\r\n\r\n```\r\n        ts_before = datetime.datetime(\r\n            1975, 1, 1, tzinfo=datetime.timezone.utc).timestamp()\r\n\r\n        ts_after = datetime.datetime(\r\n            2115, 1, 1, tzinfo=datetime.timezone.utc).timestamp()\r\n\r\n        cookies_sent = self.timed_request(\r\n            \"http://expirestest.com/\", ts_before, ts_before)\r\n\r\n        self.assertEqual(set(cookies_sent.keys()), {\r\n            \"shared-cookie\",\r\n            \"expires-cookie\"\r\n        })\r\n\r\n        cookies_sent = self.timed_request(\r\n>           \"http://expirestest.com/\", ts_before, ts_after)\r\n\r\ntest_cookiejar.py:590:\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\n\r\nself = <test_cookiejar.TestCookieJarSafe testMethod=test_expires>\r\nurl = 'http://expirestest.com/'\r\nupdate_time = datetime.datetime(1975, 1, 1, 0, 0), send_time = 4575744000.0\r\n\r\n    def timed_request(self, url, update_time, send_time):\r\n        if isinstance(update_time, int):\r\n            update_time = datetime.timedelta(seconds=update_time)\r\n        elif isinstance(update_time, float):\r\n            update_time = datetime.datetime.fromtimestamp(update_time)\r\n        if isinstance(send_time, int):\r\n            send_time = datetime.timedelta(seconds=send_time)\r\n        elif isinstance(send_time, float):\r\n>           send_time = datetime.datetime.fromtimestamp(send_time)\r\nE           OverflowError: timestamp out of range for platform time_t\r\n\r\ntest_cookiejar.py:383: OverflowError\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4515/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4515/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4478", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4478/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4478/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4478/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4478", "id": 544170119, "node_id": "MDU6SXNzdWU1NDQxNzAxMTk=", "number": 4478, "title": "Potential memory leak in aiohttp server", "user": {"login": "mvalkon", "id": 4346211, "node_id": "MDQ6VXNlcjQzNDYyMTE=", "avatar_url": "https://avatars.githubusercontent.com/u/4346211?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mvalkon", "html_url": "https://github.com/mvalkon", "followers_url": "https://api.github.com/users/mvalkon/followers", "following_url": "https://api.github.com/users/mvalkon/following{/other_user}", "gists_url": "https://api.github.com/users/mvalkon/gists{/gist_id}", "starred_url": "https://api.github.com/users/mvalkon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mvalkon/subscriptions", "organizations_url": "https://api.github.com/users/mvalkon/orgs", "repos_url": "https://api.github.com/users/mvalkon/repos", "events_url": "https://api.github.com/users/mvalkon/events{/privacy}", "received_events_url": "https://api.github.com/users/mvalkon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344996043, "node_id": "MDU6TGFiZWwzNDQ5OTYwNDM=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/server", "name": "server", "color": "006b75", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, {"login": "gyermolenko", "id": 10965580, "node_id": "MDQ6VXNlcjEwOTY1NTgw", "avatar_url": "https://avatars.githubusercontent.com/u/10965580?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gyermolenko", "html_url": "https://github.com/gyermolenko", "followers_url": "https://api.github.com/users/gyermolenko/followers", "following_url": "https://api.github.com/users/gyermolenko/following{/other_user}", "gists_url": "https://api.github.com/users/gyermolenko/gists{/gist_id}", "starred_url": "https://api.github.com/users/gyermolenko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gyermolenko/subscriptions", "organizations_url": "https://api.github.com/users/gyermolenko/orgs", "repos_url": "https://api.github.com/users/gyermolenko/repos", "events_url": "https://api.github.com/users/gyermolenko/events{/privacy}", "received_events_url": "https://api.github.com/users/gyermolenko/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 6, "created_at": "2019-12-31T11:47:20Z", "updated_at": "2020-01-07T14:27:16Z", "closed_at": "2020-01-07T14:27:16Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Long story short\r\nI have a small HTTP API written with aiohttp as the backend. I am seeing a constantly growing memory footprint which results in segmentation faults in production. The segfaults seem to occur somewhat randomly. I am not able to get the core dumps at the moment for analysis, so I have resorted to debugging this locally. I do not have conclusive proof, but I am looking for some pointers on where to go from here.\r\n\r\nThe API makes two external calls per request; one to external API using `aiottp.ClientSession` and another to DynamoDB to fetch data. In both cases we maintain a separate session for the lifetime of the application.\r\n\r\n## Expected behaviour\r\nStable memory consumption \r\n\r\n## Actual behaviour\r\nGrowing memory footprint at low rps. The following graph and tracemalloc data is from a short test where the API was run locally and traffic was generated at roughly 45 requests per second.\r\n\r\n![leak](https://user-images.githubusercontent.com/4346211/71620032-36c08500-2bd0-11ea-93c1-16ff8bcf2f5b.png)\r\n\r\nTracemalloc snapshot comparison between test start and finish points to [`RequestHandler.data_received()`](https://github.com/aio-libs/aiohttp/blob/3.6/aiohttp/web_protocol.py#L275)-method and [`TCPConnector._wrap_create_connection()`](https://github.com/aio-libs/aiohttp/blob/3.6/aiohttp/connector.py#L936)-method having the largest increase in memory.\r\n\r\n```\r\naiohttp/web_protocol.py:275: size=86.3 MiB (+81.0 MiB), count=316057 (+295361), average=286 B\r\naiohttp/connector.py:936: size=13.1 MiB (+2577 KiB), count=765 (+109), average=17.6 KiB\r\nbasictracer/text_propagator.py:30: size=2454 KiB (+2306 KiB), count=44869 (+42176), average=56 B\r\ntraceback.py:357: size=797 KiB (+207 KiB), count=9108 (+2303), average=90 B\r\nthrift/transport/THttpClient.py:153: size=0 B (-183 KiB), count=0 (-1)\r\nlightstep/tracer.py:106: size=287 KiB (+143 KiB), count=1296 (+670), average=227 B\r\ntraceback.py:285: size=385 KiB (+141 KiB), count=4552 (+1678), average=87 B\r\nlightstep/thrift_converter.py:61: size=40.8 KiB (-136 KiB), count=713 (-2378), average=59 B\r\nlightstep/util.py:37: size=37.7 KiB (-126 KiB), count=594 (-1984), average=65 B\r\njson/decoder.py:353: size=5208 KiB (+91.4 KiB), count=51545 (+1052), average=103 B\r\n```\r\n\r\nOjbgraph points to a large number of `CIMultiDict`-objects in memory and the following object graph can be generated (not sure how helpful this is)\r\n\r\n![test](https://user-images.githubusercontent.com/4346211/71620186-35438c80-2bd1-11ea-9a42-8856384685ab.png)\r\n\r\nAdditionally I am seeing errors reported in https://github.com/aio-libs/aiohttp/issues/3535 when traffic generation stops. \r\n```\r\n<uvloop.loop.SSLProtocol object at 0x108602bd0>: Fatal error on transport\r\nTraceback (most recent call last):\r\n  File \"uvloop/sslproto.pyx\", line 571, in uvloop.loop.SSLProtocol._do_shutdown\r\n  File \"/usr/local/opt/pyenv/versions/3.7.5/lib/python3.7/ssl.py\", line 778, in unwrap\r\n    return self._sslobj.shutdown()\r\nssl.SSLError: [SSL: KRB5_S_INIT] application data after close notify (_ssl.c:2629)\r\n```\r\nAny pointers on where to go from here for further debugging would be much appreciated.\r\n\r\n## Steps to reproduce\r\n\r\nUnfortunately none at the moment. I will try to isolate a reproduceable snippet.\r\n\r\n## Your environment\r\n\r\nThe memory consumption is increased on both os x (my laptop) and on an ubuntu based docker image running on Kubernetes. \r\n\r\naiohttp version is 3.6.2 with uvloop on python 3.7.5, server and client.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4478/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4478/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4463", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4463/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4463/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4463/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/4463", "id": 541000007, "node_id": "MDExOlB1bGxSZXF1ZXN0MzU1NzM0NjQz", "number": 4463, "title": "Fix python 3.8 tests under Windows ", "user": {"login": "hh-h", "id": 8166963, "node_id": "MDQ6VXNlcjgxNjY5NjM=", "avatar_url": "https://avatars.githubusercontent.com/u/8166963?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hh-h", "html_url": "https://github.com/hh-h", "followers_url": "https://api.github.com/users/hh-h/followers", "following_url": "https://api.github.com/users/hh-h/following{/other_user}", "gists_url": "https://api.github.com/users/hh-h/gists{/gist_id}", "starred_url": "https://api.github.com/users/hh-h/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hh-h/subscriptions", "organizations_url": "https://api.github.com/users/hh-h/orgs", "repos_url": "https://api.github.com/users/hh-h/repos", "events_url": "https://api.github.com/users/hh-h/events{/privacy}", "received_events_url": "https://api.github.com/users/hh-h/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 731921232, "node_id": "MDU6TGFiZWw3MzE5MjEyMzI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/infra", "name": "infra", "color": "e55e5b", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, {"login": "hh-h", "id": 8166963, "node_id": "MDQ6VXNlcjgxNjY5NjM=", "avatar_url": "https://avatars.githubusercontent.com/u/8166963?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hh-h", "html_url": "https://github.com/hh-h", "followers_url": "https://api.github.com/users/hh-h/followers", "following_url": "https://api.github.com/users/hh-h/following{/other_user}", "gists_url": "https://api.github.com/users/hh-h/gists{/gist_id}", "starred_url": "https://api.github.com/users/hh-h/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hh-h/subscriptions", "organizations_url": "https://api.github.com/users/hh-h/orgs", "repos_url": "https://api.github.com/users/hh-h/repos", "events_url": "https://api.github.com/users/hh-h/events{/privacy}", "received_events_url": "https://api.github.com/users/hh-h/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 14, "created_at": "2019-12-20T13:39:50Z", "updated_at": "2020-01-18T19:16:34Z", "closed_at": "2020-01-18T19:16:33Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/4463", "html_url": "https://github.com/aio-libs/aiohttp/pull/4463", "diff_url": "https://github.com/aio-libs/aiohttp/pull/4463.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/4463.patch", "merged_at": null}, "body": "<!-- Thank you for your contribution! -->\r\n\r\n## What do these changes do?\r\n\r\nIt should fix tests for python 3.8 under Windows\r\n\r\n## Are there changes in behavior for the user?\r\n\r\nNo\r\n\r\n## Related issue number\r\n\r\nNo\r\n\r\n## Checklist\r\n\r\n- [x] I think the code is well written\r\n- [ ] Unit tests for the changes exist\r\n- [ ] Documentation reflects the changes\r\n- [ ] If you provide code modification, please add yourself to `CONTRIBUTORS.txt`\r\n  * The format is &lt;Name&gt; &lt;Surname&gt;.\r\n  * Please keep alphabetical order, the file is sorted by names. \r\n- [ ] Add a new news fragment into the `CHANGES` folder\r\n  * name it `<issue_id>.<type>` for example (588.bugfix)\r\n  * if you don't have an `issue_id` change it to the pr id after creating the pr\r\n  * ensure type is one of the following:\r\n    * `.feature`: Signifying a new feature.\r\n    * `.bugfix`: Signifying a bug fix.\r\n    * `.doc`: Signifying a documentation improvement.\r\n    * `.removal`: Signifying a deprecation or removal of public API.\r\n    * `.misc`: A ticket has been closed, but it is not of interest to users.\r\n  * Make sure to use full sentences with correct case and punctuation, for example: \"Fix issue with non-ascii contents in doctest text files.\"\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4463/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4463/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4376", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4376/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4376/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4376/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4376", "id": 527646683, "node_id": "MDU6SXNzdWU1Mjc2NDY2ODM=", "number": 4376, "title": "Host header should have port 443", "user": {"login": "ionling", "id": 20399569, "node_id": "MDQ6VXNlcjIwMzk5NTY5", "avatar_url": "https://avatars.githubusercontent.com/u/20399569?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ionling", "html_url": "https://github.com/ionling", "followers_url": "https://api.github.com/users/ionling/followers", "following_url": "https://api.github.com/users/ionling/following{/other_user}", "gists_url": "https://api.github.com/users/ionling/gists{/gist_id}", "starred_url": "https://api.github.com/users/ionling/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ionling/subscriptions", "organizations_url": "https://api.github.com/users/ionling/orgs", "repos_url": "https://api.github.com/users/ionling/repos", "events_url": "https://api.github.com/users/ionling/events{/privacy}", "received_events_url": "https://api.github.com/users/ionling/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 58986079, "node_id": "MDU6TGFiZWw1ODk4NjA3OQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/question", "name": "question", "color": "cc317c", "default": true, "description": "StackOverflow"}, {"id": 344995986, "node_id": "MDU6TGFiZWwzNDQ5OTU5ODY=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/client", "name": "client", "color": "bfd4f2", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2019-11-24T04:10:33Z", "updated_at": "2020-01-26T11:00:55Z", "closed_at": "2020-01-26T11:00:55Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Long story short\r\n\r\nIf I access a https website via http tunnel (connect method, `CONNECT www.bilibili.com:443 HTTP/1.1\\r\\n\\r\\n`), the request's `Host` header should be `www.bilibili.com:443` not `www.bilibili.com` which `aiohttp` actually does.\r\n\r\nFor more info,  just see  RFC https://tools.ietf.org/html/rfc7230#section-5.4.\r\n\r\n## Expected behaviour\r\n\r\nThe request's `Host` header should be `www.bilibili.com:443`.\r\n\r\n## Actual behaviour\r\n\r\nThe request's `Host` is `www.bilibili.com`.\r\n\r\n## Steps to reproduce\r\n\r\n```\r\nsession.get('https://www.bilibili.com', proxy='http://localhost:8889')\r\n```\r\n\r\n## Your environment\r\n\r\n- Manjaro 18.1.13\r\n- Python 3.7.4\r\n- aiohttp client 3.6.2\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4376/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4376/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4370", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4370/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4370/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4370/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4370", "id": 526768972, "node_id": "MDU6SXNzdWU1MjY3Njg5NzI=", "number": 4370, "title": "web.Request and web.Response are no longer weak referenceable", "user": {"login": "Fogapod", "id": 22667809, "node_id": "MDQ6VXNlcjIyNjY3ODA5", "avatar_url": "https://avatars.githubusercontent.com/u/22667809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Fogapod", "html_url": "https://github.com/Fogapod", "followers_url": "https://api.github.com/users/Fogapod/followers", "following_url": "https://api.github.com/users/Fogapod/following{/other_user}", "gists_url": "https://api.github.com/users/Fogapod/gists{/gist_id}", "starred_url": "https://api.github.com/users/Fogapod/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Fogapod/subscriptions", "organizations_url": "https://api.github.com/users/Fogapod/orgs", "repos_url": "https://api.github.com/users/Fogapod/repos", "events_url": "https://api.github.com/users/Fogapod/events{/privacy}", "received_events_url": "https://api.github.com/users/Fogapod/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1363888987, "node_id": "MDU6TGFiZWwxMzYzODg4OTg3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/pr-merged", "name": "pr-merged", "color": "363396", "default": false, "description": null}, {"id": 1577406386, "node_id": "MDU6TGFiZWwxNTc3NDA2Mzg2", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/regression", "name": "regression", "color": "c62b3b", "default": false, "description": "Something that used to work stopped working \"as before\" after upgrade"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-11-21T18:32:06Z", "updated_at": "2019-11-25T17:06:41Z", "closed_at": "2019-11-25T17:06:29Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## Long story short\r\n\r\nhttps://github.com/aio-libs/aiohttp/pull/3942 added `__slots__` to request and response classes. This made it impossible to create weak references to them.\r\nIn some cases this might be useful. Example: https://github.com/getsentry/sentry-python/issues/560\r\n\r\nPossible solution is adding `__weakref__` to `__slots__` in `web.BaseRequest` and `web.StreamResponse`.\r\n\r\n## Expected behaviour\r\n\r\nweb.Request and web.Response to be valid targets for weak references.\r\n\r\n## Actual behaviour\r\n\r\nweb.Request and web.Response are no longer valid targets for weak references.\r\n\r\n## Steps to reproduce\r\n\r\n```python\r\nimport weakref\r\n\r\nwekref.ref(request)\r\n# TypeError: cannot create weak reference to 'Request' object\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4370/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4370/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4326", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4326/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4326/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4326/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4326", "id": 518406220, "node_id": "MDU6SXNzdWU1MTg0MDYyMjA=", "number": 4326, "title": "DeprecationWarning: Changing state of started or joined application is deprecated", "user": {"login": "albertodonato", "id": 3472143, "node_id": "MDQ6VXNlcjM0NzIxNDM=", "avatar_url": "https://avatars.githubusercontent.com/u/3472143?v=4", "gravatar_id": "", "url": "https://api.github.com/users/albertodonato", "html_url": "https://github.com/albertodonato", "followers_url": "https://api.github.com/users/albertodonato/followers", "following_url": "https://api.github.com/users/albertodonato/following{/other_user}", "gists_url": "https://api.github.com/users/albertodonato/gists{/gist_id}", "starred_url": "https://api.github.com/users/albertodonato/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/albertodonato/subscriptions", "organizations_url": "https://api.github.com/users/albertodonato/orgs", "repos_url": "https://api.github.com/users/albertodonato/repos", "events_url": "https://api.github.com/users/albertodonato/events{/privacy}", "received_events_url": "https://api.github.com/users/albertodonato/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 58986079, "node_id": "MDU6TGFiZWw1ODk4NjA3OQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/question", "name": "question", "color": "cc317c", "default": true, "description": "StackOverflow"}, {"id": 344996043, "node_id": "MDU6TGFiZWwzNDQ5OTYwNDM=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/server", "name": "server", "color": "006b75", "default": false, "description": null}, {"id": 445958404, "node_id": "MDU6TGFiZWw0NDU5NTg0MDQ=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/documentation", "name": "documentation", "color": "0075ca", "default": true, "description": "Improvements or additions to documentation"}], "state": "closed", "locked": false, "assignee": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 9, "created_at": "2019-11-06T11:16:41Z", "updated_at": "2021-05-06T06:01:32Z", "closed_at": "2019-11-08T08:35:50Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## Long story short\r\n\r\nI'm seeing something very similar as #1947.\r\n\r\nIn my app setup I connect to the database in an `on_startup` signal (which is what https://docs.aiohttp.org/en/stable/web_advanced.html#background-tasks suggests).\r\n\r\nIs this no longer the right way to perform tasks at application startup?\r\n\r\n## Expected behaviour\r\n\r\nNo warning should be raised.\r\n\r\n## Actual behaviour\r\n<!-- What's actually happening? -->\r\nWhen running tests I get a warning like:\r\n\r\n```python-traceback\r\nDeprecationWarning: Changing state of started or joined application is deprecated\r\n    app[\"db\"] = engine\r\n```\r\n\r\n## Steps to reproduce\r\n\r\n<!-- Please describe steps to reproduce the issue.\r\n     If you have a script that does that please include it here within\r\n     markdown code markup -->\r\n\r\n```python\r\ndef create_app():\r\n    app = web.Application()\r\n    app.on_startup.append(_create_db)\r\n    app.on_cleanup.append(_close_db)\r\n    return app\r\n\r\nasync def _create_db(app: Application):\r\n    app[\"db\"] = await create_engine(DSN)\r\n```\r\n\r\n## Your environment\r\n\r\n- Ubuntu 18.04\r\n- Python 3.6.8\r\n- aiohttp 3.6.2\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4326/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4326/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4178", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4178/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4178/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4178/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4178", "id": 506010140, "node_id": "MDU6SXNzdWU1MDYwMTAxNDA=", "number": 4178, "title": "Sending text file hangs on Windows", "user": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344995986, "node_id": "MDU6TGFiZWwzNDQ5OTU5ODY=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/client", "name": "client", "color": "bfd4f2", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2019-10-11T19:02:25Z", "updated_at": "2019-11-21T12:22:34Z", "closed_at": "2019-11-21T12:22:34Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "```\r\n    with fname.open('r') as f:\r\n        resp = await client.post('/', data=f)\r\n```\r\n\r\nA file opened in binary mode (`fname.open('r')`) works well.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4178/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4178/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4052", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4052/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4052/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4052/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/4052", "id": 491345138, "node_id": "MDExOlB1bGxSZXF1ZXN0MzE1NzMxMDU0", "number": 4052, "title": "Emit warning when there's no ssl.OP_NO_COMPRESSION", "user": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 58986077, "node_id": "MDU6TGFiZWw1ODk4NjA3Nw==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/enhancement", "name": "enhancement", "color": "84b6eb", "default": true, "description": null}, {"id": 344996043, "node_id": "MDU6TGFiZWwzNDQ5OTYwNDM=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/server", "name": "server", "color": "006b75", "default": false, "description": null}, {"id": 1472801557, "node_id": "MDU6TGFiZWwxNDcyODAxNTU3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bot:chronographer:provided", "name": "bot:chronographer:provided", "color": "ededed", "default": false, "description": "There is a change note present in this PR"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2019-09-09T21:52:44Z", "updated_at": "2019-09-09T22:01:08Z", "closed_at": "2019-09-09T22:01:07Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/4052", "html_url": "https://github.com/aio-libs/aiohttp/pull/4052", "diff_url": "https://github.com/aio-libs/aiohttp/pull/4052.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/4052.patch", "merged_at": "2019-09-09T22:01:07Z"}, "body": "This prevents AttributeError under python.org interpreter builds for macOS linked against ``OpenSSL<1.0.0``.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4052/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4052/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4018", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4018/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4018/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4018/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4018", "id": 487528283, "node_id": "MDU6SXNzdWU0ODc1MjgyODM=", "number": 4018, "title": "i686 manylinux build fails due to missing cryptography wheel", "user": {"login": "mjpieters", "id": 46775, "node_id": "MDQ6VXNlcjQ2Nzc1", "avatar_url": "https://avatars.githubusercontent.com/u/46775?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mjpieters", "html_url": "https://github.com/mjpieters", "followers_url": "https://api.github.com/users/mjpieters/followers", "following_url": "https://api.github.com/users/mjpieters/following{/other_user}", "gists_url": "https://api.github.com/users/mjpieters/gists{/gist_id}", "starred_url": "https://api.github.com/users/mjpieters/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mjpieters/subscriptions", "organizations_url": "https://api.github.com/users/mjpieters/orgs", "repos_url": "https://api.github.com/users/mjpieters/repos", "events_url": "https://api.github.com/users/mjpieters/events{/privacy}", "received_events_url": "https://api.github.com/users/mjpieters/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 277836062, "node_id": "MDU6TGFiZWwyNzc4MzYwNjI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/good%20first%20issue", "name": "good first issue", "color": "7057ff", "default": true, "description": "Good for newcomers"}, {"id": 303800438, "node_id": "MDU6TGFiZWwzMDM4MDA0Mzg=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/need%20pull%20request", "name": "need pull request", "color": "bfdadc", "default": false, "description": null}, {"id": 1363888987, "node_id": "MDU6TGFiZWwxMzYzODg4OTg3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/pr-merged", "name": "pr-merged", "color": "363396", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2019-08-30T14:56:02Z", "updated_at": "2019-08-31T07:57:44Z", "closed_at": "2019-08-31T07:57:37Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The manylinux build step fails for arch=\"i686\", as there is no `manylinux1_i686` wheel for `cryptography` version 2.7.\r\n\r\nI filed pyca/cryptography#4978 to ask why no wheel is available.\r\n\r\nThis ticket is mostly to track the issue on the aiohttp side, but it may be that cryptography has to be downgraded to 2.6.1 if new aiohttp wheels need to be built (the cryptography dependency is only needed to run the tests, I think).\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4018/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4018/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4009", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4009/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4009/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4009/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/4009", "id": 486074491, "node_id": "MDU6SXNzdWU0ODYwNzQ0OTE=", "number": 4009, "title": "SSL self signed certificate / Python 3.8.0b3", "user": {"login": "bcroston", "id": 7353646, "node_id": "MDQ6VXNlcjczNTM2NDY=", "avatar_url": "https://avatars.githubusercontent.com/u/7353646?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bcroston", "html_url": "https://github.com/bcroston", "followers_url": "https://api.github.com/users/bcroston/followers", "following_url": "https://api.github.com/users/bcroston/following{/other_user}", "gists_url": "https://api.github.com/users/bcroston/gists{/gist_id}", "starred_url": "https://api.github.com/users/bcroston/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bcroston/subscriptions", "organizations_url": "https://api.github.com/users/bcroston/orgs", "repos_url": "https://api.github.com/users/bcroston/repos", "events_url": "https://api.github.com/users/bcroston/events{/privacy}", "received_events_url": "https://api.github.com/users/bcroston/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344996043, "node_id": "MDU6TGFiZWwzNDQ5OTYwNDM=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/server", "name": "server", "color": "006b75", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 11, "created_at": "2019-08-27T22:58:58Z", "updated_at": "2019-09-28T17:21:20Z", "closed_at": "2019-09-27T15:48:09Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Long story short\r\n\r\nUsing a self-signed SSL certificate, it works with Python 3.7 but not Python 3.8.0b3.\r\n\r\n## Expected behaviour\r\n\r\n```$ wget --no-check-certificate https://localhost:8443```\r\nindex.html downloaded, containing 'Hello, World!'.\r\n\r\n## Actual behaviour\r\n\r\n```--2019-08-27 23:35:04--  https://localhost:8443/  \r\nResolving localhost (localhost)... ::1, 127.0.0.1  \r\nConnecting to localhost (localhost)|::1|:8443... failed: Connection refused.  \r\nConnecting to localhost (localhost)|127.0.0.1|:8443... connected.  \r\nGnuTLS: The TLS connection was non-properly terminated.  \r\nUnable to establish SSL connection.  \r\n```\r\n\r\n## Steps to reproduce\r\n\r\nCreate certificate:\r\n\r\n```bash\r\n$ openssl req -new -newkey rsa:4096 -x509 -sha256 -days 365 -nodes \\\r\n -out sslcert.crt -keyout sslcert.key\r\n```\r\n\r\nPython code:\r\n\r\n```python\r\nimport ssl\r\nfrom aiohttp import web\r\n\r\nasync def handle(request):\r\n    text = 'Hello world!'\r\n    return web.Response(text=text)\r\n\r\nif __name__ == '__main__':\r\n    ssl_context = ssl.create_default_context(ssl.Purpose.CLIENT_AUTH)\r\n    ssl_context.check_hostname = False\r\n    ssl_context.load_cert_chain('sslcert.crt','sslcert.key')\r\n    app = web.Application()\r\n    app.add_routes( [web.get('/',handle), ] )\r\n    web.run_app(app, ssl_context=ssl_context)\r\n```\r\n\r\n## Your environment\r\n\r\nRaspbian Buster / Debian Stretch\r\nPython 3.8.0b3\r\naiohttp 3.5.4 (server)\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4009/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/4009/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3852", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3852/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3852/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3852/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3852", "id": 457128507, "node_id": "MDU6SXNzdWU0NTcxMjg1MDc=", "number": 3852, "title": "TestClient.request doesn't return a context manager", "user": {"login": "nicktimko", "id": 5297556, "node_id": "MDQ6VXNlcjUyOTc1NTY=", "avatar_url": "https://avatars.githubusercontent.com/u/5297556?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nicktimko", "html_url": "https://github.com/nicktimko", "followers_url": "https://api.github.com/users/nicktimko/followers", "following_url": "https://api.github.com/users/nicktimko/following{/other_user}", "gists_url": "https://api.github.com/users/nicktimko/gists{/gist_id}", "starred_url": "https://api.github.com/users/nicktimko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nicktimko/subscriptions", "organizations_url": "https://api.github.com/users/nicktimko/orgs", "repos_url": "https://api.github.com/users/nicktimko/repos", "events_url": "https://api.github.com/users/nicktimko/events{/privacy}", "received_events_url": "https://api.github.com/users/nicktimko/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 277836062, "node_id": "MDU6TGFiZWwyNzc4MzYwNjI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/good%20first%20issue", "name": "good first issue", "color": "7057ff", "default": true, "description": "Good for newcomers"}, {"id": 303800438, "node_id": "MDU6TGFiZWwzMDM4MDA0Mzg=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/need%20pull%20request", "name": "need pull request", "color": "bfdadc", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-06-17T20:16:15Z", "updated_at": "2019-08-30T19:27:20Z", "closed_at": "2019-08-30T19:27:20Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## Long story short\r\n\r\n`aiohttp.test_utils.TestClient.request` seems to be an odd-man out in not returning a context manager.\r\n\r\n## Expected behaviour\r\n\r\nReturns a context manager.\r\n\r\n## Actual behaviour\r\n\r\nWhen calling the `.request()` method of `TestClient`, it doesn't seem to return a `_RequestContextManager` like the other 3 permutations.\r\n\r\n* `ClientSession.request()` -> `aiohttp.client._RequestContextManager`\r\n* `ClientSession.<verb>()` -> `aiohttp.client._RequestContextManager`\r\n* `TestClient.request()` -> `aiohttp.client._RequestContextManager`\r\n* `TestClient.<verb>()` -> `coroutine`\r\n\r\n```\r\n\u279c python methodtests.py \r\nmethodtests.py:18: RuntimeWarning: coroutine 'TestClient.request' was never awaited\r\n  async with client.request(method, url) as resp:\r\nRuntimeWarning: Enable tracemalloc to get the object allocation traceback\r\nTraceback (most recent call last):\r\n  File \"methodtests.py\", line 43, in <module>\r\n    loop.run_until_complete(main())\r\n  File \"/home/nick/.pyenv/versions/3.7.2/lib/python3.7/asyncio/base_events.py\", line 584, in run_until_complete\r\n    return future.result()\r\n  File \"methodtests.py\", line 40, in main\r\n    await check_client(client, \"/\")  # XXX dies\r\n  File \"methodtests.py\", line 18, in check_client\r\n    async with client.request(method, url) as resp:  # YYY dies\r\nAttributeError: __aexit__\r\n```\r\n\r\n## Steps to reproduce\r\n\r\n```\r\nimport asyncio\r\nimport aiohttp.test_utils\r\nimport aiohttp.web\r\n\r\nasync def handleall(request):\r\n    return aiohttp.web.Response()\r\n\r\nasync def check_client(client, base_url):\r\n    for method in [\"GET\", \"POST\", \"PUT\", \"DELETE\"]:\r\n        url = base_url + method.lower()\r\n\r\n        # slightly awkward, but works with both client types\r\n        clientmethod = getattr(client, method.lower())\r\n        async with clientmethod(url) as resp:\r\n            assert resp.status == 200\r\n\r\n        # fails with test clients\r\n        async with client.request(method, url) as resp:  # YYY dies\r\n            assert resp.status == 200\r\n\r\nasync def main():\r\n    # a \"regular\" ClientSession\r\n    base_url = \"https://httpbin.org/\"\r\n    async with aiohttp.ClientSession() as client:\r\n        await check_client(client, base_url)\r\n\r\n    app = aiohttp.web.Application()\r\n    app.router.add_route(\"*\", \"/{verb}\", handleall)\r\n\r\n    async with aiohttp.test_utils.TestServer(app) as server:\r\n        async with aiohttp.test_utils.TestClient(server) as test_client:\r\n            base_url = str(test_client.make_url(\"/\"))\r\n            # a \"regular\" client created from the test client\r\n            client = test_client.session\r\n            await check_client(client, base_url)\r\n\r\n    async with aiohttp.test_utils.TestServer(app) as server:\r\n        async with aiohttp.test_utils.TestClient(server) as client:\r\n            # just the test client\r\n            await check_client(client, \"/\")  # XXX dies\r\n\r\nloop = asyncio.get_event_loop()\r\nloop.run_until_complete(main())\r\n```\r\n\r\n## Your environment\r\n\r\nPython 3.7.2\r\naiohttp 3.5.4", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3852/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3852/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3832", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3832/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3832/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3832/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/3832", "id": 453887534, "node_id": "MDExOlB1bGxSZXF1ZXN0Mjg2NDY0MTA4", "number": 3832, "title": "Shorten too long test UNIX socket path", "user": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 2451662697, "node_id": "MDU6TGFiZWwyNDUxNjYyNjk3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/backport-3.8", "name": "backport-3.8", "color": "000000", "default": false, "description": "Trigger automatic backporting to the 3.8 release branch by Patchback robot"}, {"id": 3507377261, "node_id": "LA_kwDOAMpNN87RDlRt", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/backport-3.9", "name": "backport-3.9", "color": "000000", "default": false, "description": "Trigger automatic backporting to the 3.9 release branch by Patchback robot"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2019-06-09T11:13:35Z", "updated_at": "2022-09-06T16:32:59Z", "closed_at": "2019-06-11T13:24:05Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/3832", "html_url": "https://github.com/aio-libs/aiohttp/pull/3832", "diff_url": "https://github.com/aio-libs/aiohttp/pull/3832.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/3832.patch", "merged_at": "2019-06-11T13:24:05Z"}, "body": "## What do these changes do?\r\n\r\nMake tmp unix sock path fit the kernel limits\r\n\r\n## Are there changes in behavior for the user?\r\n\r\n<!-- Outline any notable behaviour for the end users. -->\r\n\r\n## Related issue number\r\n\r\nFixes #3572\r\n\r\n## Checklist\r\n\r\n- [x] I think the code is well written\r\n- [x] Unit tests for the changes exist\r\n- [ ] Documentation reflects the changes\r\n- [x] If you provide code modification, please add yourself to `CONTRIBUTORS.txt`\r\n  * The format is &lt;Name&gt; &lt;Surname&gt;.\r\n  * Please keep alphabetical order, the file is sorted by names. \r\n- [ ] Add a new news fragment into the `CHANGES` folder\r\n  * name it `<issue_id>.<type>` for example (588.bugfix)\r\n  * if you don't have an `issue_id` change it to the pr id after creating the pr\r\n  * ensure type is one of the following:\r\n    * `.feature`: Signifying a new feature.\r\n    * `.bugfix`: Signifying a bug fix.\r\n    * `.doc`: Signifying a documentation improvement.\r\n    * `.removal`: Signifying a deprecation or removal of public API.\r\n    * `.misc`: A ticket has been closed, but it is not of interest to users.\r\n  * Make sure to use full sentences with correct case and punctuation, for example: \"Fix issue with non-ascii contents in doctest text files.\"\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3832/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3832/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3776", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3776/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3776/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3776/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3776", "id": 445026655, "node_id": "MDU6SXNzdWU0NDUwMjY2NTU=", "number": 3776, "title": "asyncio.coroutine is deprecated in 3.8", "user": {"login": "tirkarthi", "id": 3972343, "node_id": "MDQ6VXNlcjM5NzIzNDM=", "avatar_url": "https://avatars.githubusercontent.com/u/3972343?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tirkarthi", "html_url": "https://github.com/tirkarthi", "followers_url": "https://api.github.com/users/tirkarthi/followers", "following_url": "https://api.github.com/users/tirkarthi/following{/other_user}", "gists_url": "https://api.github.com/users/tirkarthi/gists{/gist_id}", "starred_url": "https://api.github.com/users/tirkarthi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tirkarthi/subscriptions", "organizations_url": "https://api.github.com/users/tirkarthi/orgs", "repos_url": "https://api.github.com/users/tirkarthi/repos", "events_url": "https://api.github.com/users/tirkarthi/events{/privacy}", "received_events_url": "https://api.github.com/users/tirkarthi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 303800438, "node_id": "MDU6TGFiZWwzMDM4MDA0Mzg=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/need%20pull%20request", "name": "need pull request", "color": "bfdadc", "default": false, "description": null}, {"id": 344996043, "node_id": "MDU6TGFiZWwzNDQ5OTYwNDM=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/server", "name": "server", "color": "006b75", "default": false, "description": null}, {"id": 743514498, "node_id": "MDU6TGFiZWw3NDM1MTQ0OTg=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/meta", "name": "meta", "color": "ccf794", "default": false, "description": null}, {"id": 1363888987, "node_id": "MDU6TGFiZWwxMzYzODg4OTg3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/pr-merged", "name": "pr-merged", "color": "363396", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2019-05-16T15:38:16Z", "updated_at": "2019-09-17T20:10:44Z", "closed_at": "2019-09-17T20:10:36Z", "author_association": "NONE", "active_lock_reason": null, "body": "`asyncio.coroutine` decorator is deprecated with 3.8 and is used in some of the code. DeprecationWarnings could be fixed.\r\n\r\nUpstream CPython PR : https://github.com/python/cpython/pull/13346\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3776/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3776/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3707", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3707/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3707/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3707/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3707", "id": 435428142, "node_id": "MDU6SXNzdWU0MzU0MjgxNDI=", "number": 3707, "title": "Wrong return type annotathion for json of WSMessage in http_websocket.py", "user": {"login": "olned", "id": 22174154, "node_id": "MDQ6VXNlcjIyMTc0MTU0", "avatar_url": "https://avatars.githubusercontent.com/u/22174154?v=4", "gravatar_id": "", "url": "https://api.github.com/users/olned", "html_url": "https://github.com/olned", "followers_url": "https://api.github.com/users/olned/followers", "following_url": "https://api.github.com/users/olned/following{/other_user}", "gists_url": "https://api.github.com/users/olned/gists{/gist_id}", "starred_url": "https://api.github.com/users/olned/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/olned/subscriptions", "organizations_url": "https://api.github.com/users/olned/orgs", "repos_url": "https://api.github.com/users/olned/repos", "events_url": "https://api.github.com/users/olned/events{/privacy}", "received_events_url": "https://api.github.com/users/olned/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 277836062, "node_id": "MDU6TGFiZWwyNzc4MzYwNjI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/good%20first%20issue", "name": "good first issue", "color": "7057ff", "default": true, "description": "Good for newcomers"}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-04-20T18:55:36Z", "updated_at": "2020-05-05T22:01:35Z", "closed_at": "2019-05-06T18:04:04Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "The json method of the WSMessage class returns parsed JSON data but declared as return None.\r\n\r\n[aio-libs/aiohttp/http_websocket.py](https://github.com/aio-libs/aiohttp/blob/master/aiohttp/http_websocket.py#L86)\r\n> Line 86 \r\n```\r\n85    def json(self, *,  # type: ignore\r\n86             loads: Callable[[Any], Any]=json.loads) -> None:\r\n87        \"\"\"Return parsed JSON data.\r\n88        .. versionadded:: 0.22\r\n89        \"\"\"\r\n90        return loads(self.data)\r\n```\r\n\r\nMay be it would be better if it return type was absent? \r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3707/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3707/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3673", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3673/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3673/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3673/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3673", "id": 427270288, "node_id": "MDU6SXNzdWU0MjcyNzAyODg=", "number": 3673, "title": "stream response memory leak", "user": {"login": "odysseusmax", "id": 35767464, "node_id": "MDQ6VXNlcjM1NzY3NDY0", "avatar_url": "https://avatars.githubusercontent.com/u/35767464?v=4", "gravatar_id": "", "url": "https://api.github.com/users/odysseusmax", "html_url": "https://github.com/odysseusmax", "followers_url": "https://api.github.com/users/odysseusmax/followers", "following_url": "https://api.github.com/users/odysseusmax/following{/other_user}", "gists_url": "https://api.github.com/users/odysseusmax/gists{/gist_id}", "starred_url": "https://api.github.com/users/odysseusmax/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/odysseusmax/subscriptions", "organizations_url": "https://api.github.com/users/odysseusmax/orgs", "repos_url": "https://api.github.com/users/odysseusmax/repos", "events_url": "https://api.github.com/users/odysseusmax/events{/privacy}", "received_events_url": "https://api.github.com/users/odysseusmax/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2019-03-30T10:52:09Z", "updated_at": "2020-04-15T07:55:43Z", "closed_at": "2019-04-15T04:36:09Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\nI'm using aiohttp for downloading files. From my experience I found that the chunked stream requests are causing memory leaks. I'm working with large files and i have very limited memory. When i make a request, it completes the request succesfully, but the response is loaded into memory and not released causing memory overflow.\r\n\r\n\r\n## Expected behaviour\r\n\r\nLoad chunked responses and release it to avoid memory leak.\r\n\r\n## Actual behaviour\r\n\r\nLoads response content as chunks and not releasing.\r\n\r\n## Steps to reproduce\r\n\r\nThis is what i use.\r\n```\r\nurl = 'some direct download link'\r\nfilename = 'some file name'\r\nasync with aiohttp.ClientSession() as session:\r\n                async with session.get(url) as r:\r\n                    if(r.status < 400):\r\n                          with open(filename, 'wb') as fd:\r\n                                        async for chunk in r.content.iter_any():\r\n                                            fd.write(chunk)\r\n```\r\n\r\n## Your environment\r\nusing aiohttp-client\r\nscript running on heroku\r\nlatest aiohttp (as of now)\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3673/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3673/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3672", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3672/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3672/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3672/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3672", "id": 426879853, "node_id": "MDU6SXNzdWU0MjY4Nzk4NTM=", "number": 3672, "title": "aiohttp.client_exceptions.ClientConnectorError Cannot connect to host xxx ssl:None [None]", "user": {"login": "pytomtoto", "id": 35906996, "node_id": "MDQ6VXNlcjM1OTA2OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/35906996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pytomtoto", "html_url": "https://github.com/pytomtoto", "followers_url": "https://api.github.com/users/pytomtoto/followers", "following_url": "https://api.github.com/users/pytomtoto/following{/other_user}", "gists_url": "https://api.github.com/users/pytomtoto/gists{/gist_id}", "starred_url": "https://api.github.com/users/pytomtoto/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pytomtoto/subscriptions", "organizations_url": "https://api.github.com/users/pytomtoto/orgs", "repos_url": "https://api.github.com/users/pytomtoto/repos", "events_url": "https://api.github.com/users/pytomtoto/events{/privacy}", "received_events_url": "https://api.github.com/users/pytomtoto/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2019-03-29T08:51:37Z", "updated_at": "2022-03-09T17:57:01Z", "closed_at": "2019-03-30T15:29:30Z", "author_association": "NONE", "active_lock_reason": null, "body": "```\r\nTraceback (most recent call last):\r\n  File \"F:\\tmp\\alter-svc\\venv\\lib\\site-packages\\aiohttp\\connector.py\", line 924, in _wrap_create_connection\r\n    await self._loop.create_connection(*args, **kwargs))\r\n  File \"C:\\Users\\Administrator\\AppData\\Local\\Programs\\Python\\Python37-32\\lib\\asyncio\\base_events.py\", line 970, in create_connection\r\n    ssl_handshake_timeout=ssl_handshake_timeout)\r\n  File \"C:\\Users\\Administrator\\AppData\\Local\\Programs\\Python\\Python37-32\\lib\\asyncio\\base_events.py\", line 998, in _create_connection_transport\r\n    await waiter\r\nConnectionResetError\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"E:/code/alter-svc/api/test.py\", line 22, in <module>\r\n    loop.run_until_complete(test())\r\n  File \"C:\\Users\\Administrator\\AppData\\Local\\Programs\\Python\\Python37-32\\lib\\asyncio\\base_events.py\", line 568, in run_until_complete\r\n    return future.result()\r\n  File \"E:/code/alter-svc/api/test.py\", line 14, in test\r\n    r = await session.get('https://www.mdnkids.com/news/?Serial_NO=108552')\r\n  File \"F:\\tmp\\alter-svc\\venv\\lib\\site-packages\\aiohttp\\client.py\", line 466, in _request\r\n    timeout=real_timeout\r\n  File \"F:\\tmp\\alter-svc\\venv\\lib\\site-packages\\aiohttp\\connector.py\", line 522, in connect\r\n    proto = await self._create_connection(req, traces, timeout)\r\n  File \"F:\\tmp\\alter-svc\\venv\\lib\\site-packages\\aiohttp\\connector.py\", line 854, in _create_connection\r\n    req, traces, timeout)\r\n  File \"F:\\tmp\\alter-svc\\venv\\lib\\site-packages\\aiohttp\\connector.py\", line 992, in _create_direct_connection\r\n    raise last_exc\r\n  File \"F:\\tmp\\alter-svc\\venv\\lib\\site-packages\\aiohttp\\connector.py\", line 974, in _create_direct_connection\r\n    req=req, client_error=client_error)\r\n  File \"F:\\tmp\\alter-svc\\venv\\lib\\site-packages\\aiohttp\\connector.py\", line 931, in _wrap_create_connection\r\n    raise client_error(req.connection_key, exc) from exc\r\naiohttp.client_exceptions.ClientConnectorError: Cannot connect to host www.mdnkids.com:443 ssl:None [None]\r\n```\r\n\r\nMy Code\r\n```\r\nimport aiohttp\r\nimport asyncio\r\n\r\n\r\nasync def test():\r\n\r\n    async with aiohttp.ClientSession() as session:\r\n        r = await session.get('https://www.mdnkids.com/news/?Serial_NO=108552')\r\n        print(await r.text())\r\n\r\nif __name__ == \"__main__\":\r\n    loop = asyncio.get_event_loop()\r\n    loop.run_until_complete(test())\r\n```\r\n\r\n## Your environment\r\n\r\n```\r\nwindows 10/centos 7.2\r\npython 3.7\r\naiohttp 3.5.4 /4.0.0a0\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3672/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3672/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3669", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3669/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3669/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3669/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3669", "id": 425811884, "node_id": "MDU6SXNzdWU0MjU4MTE4ODQ=", "number": 3669, "title": "broken interface normalize_path_middleware", "user": {"login": "vir-mir", "id": 2296252, "node_id": "MDQ6VXNlcjIyOTYyNTI=", "avatar_url": "https://avatars.githubusercontent.com/u/2296252?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vir-mir", "html_url": "https://github.com/vir-mir", "followers_url": "https://api.github.com/users/vir-mir/followers", "following_url": "https://api.github.com/users/vir-mir/following{/other_user}", "gists_url": "https://api.github.com/users/vir-mir/gists{/gist_id}", "starred_url": "https://api.github.com/users/vir-mir/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vir-mir/subscriptions", "organizations_url": "https://api.github.com/users/vir-mir/orgs", "repos_url": "https://api.github.com/users/vir-mir/repos", "events_url": "https://api.github.com/users/vir-mir/events{/privacy}", "received_events_url": "https://api.github.com/users/vir-mir/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2019-03-27T07:55:28Z", "updated_at": "2020-03-27T08:18:14Z", "closed_at": "2019-03-27T13:54:38Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nmiddleware `normalize_path_middleware` is not working properly\r\n\r\n## Expected behaviour\r\n\r\nI appeal to `/paymethods`, there is an endpoint `/paymethod`\r\n\r\n`/paymethod` -> 200\r\n`/paymethods` -> 301 -> `/paymethod`\r\n\r\nsettings: `normalize_path_middleware(remove_slash=True, append_slash=False)`\r\n\r\nif switch off \r\n`/paymethod` -> 200\r\n`/paymethods` -> 404\r\n\r\nI think the problem is in the last `if merge_slashes and remove_slash`\r\n\r\n```python\r\n\r\n            if merge_slashes:\r\n                paths_to_check.append(re.sub('//+', '/', path))\r\n            if append_slash and not request.path.endswith('/'):\r\n                paths_to_check.append(path + '/')\r\n            if remove_slash and request.path.endswith('/'):\r\n                paths_to_check.append(path[:-1])\r\n            if merge_slashes and append_slash:\r\n                paths_to_check.append(\r\n                    re.sub('//+', '/', path + '/'))\r\n            if merge_slashes and remove_slash:\r\n                merged_slashes = re.sub('//+', '/', path)\r\n                paths_to_check.append(merged_slashes[:-1])\r\n\r\n```\r\n\r\naiohttp == 3.5.4\r\n## Your environment\r\nserver\r\n\r\n\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3669/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3669/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3655", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3655/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3655/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3655/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/3655", "id": 422210752, "node_id": "MDExOlB1bGxSZXF1ZXN0MjYyMDUwMDE1", "number": 3655, "title": "fix handler argument annotations", "user": {"login": "Hanaasagi", "id": 9482395, "node_id": "MDQ6VXNlcjk0ODIzOTU=", "avatar_url": "https://avatars.githubusercontent.com/u/9482395?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Hanaasagi", "html_url": "https://github.com/Hanaasagi", "followers_url": "https://api.github.com/users/Hanaasagi/followers", "following_url": "https://api.github.com/users/Hanaasagi/following{/other_user}", "gists_url": "https://api.github.com/users/Hanaasagi/gists{/gist_id}", "starred_url": "https://api.github.com/users/Hanaasagi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Hanaasagi/subscriptions", "organizations_url": "https://api.github.com/users/Hanaasagi/orgs", "repos_url": "https://api.github.com/users/Hanaasagi/repos", "events_url": "https://api.github.com/users/Hanaasagi/events{/privacy}", "received_events_url": "https://api.github.com/users/Hanaasagi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-03-18T13:14:16Z", "updated_at": "2020-03-21T19:47:42Z", "closed_at": "2019-03-20T01:30:30Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/3655", "html_url": "https://github.com/aio-libs/aiohttp/pull/3655", "diff_url": "https://github.com/aio-libs/aiohttp/pull/3655.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/3655.patch", "merged_at": null}, "body": "This pull request wants to make `handler` annotation correct.\r\n\r\nWhen using Mypy to check following code,\r\n\r\n```Python\r\nfrom aiohttp import web\r\n\r\n\r\nclass MyView(web.View):\r\n    async def get(self):\r\n        return web.Response(text=\"Hello world\")\r\n\r\n\r\napp = web.Application()\r\napp.add_routes([web.view('/', MyView)])  # line 10\r\nweb.run_app(app)\r\n```\r\n\r\nIt will report\r\n\r\n```\r\nt.py:10: error: Argument 2 to \"view\" has incompatible type \"Type[MyView]\"; expected \"AbstractView\"                                                                                           \r\n```\r\n\r\n`web.view` accepts subclass of `AbstractView` type variable as `handler`, instead of an instance.\r\n\r\nresolve #3653", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3655/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3655/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3654", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3654/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3654/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3654/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3654", "id": 422159474, "node_id": "MDU6SXNzdWU0MjIxNTk0NzQ=", "number": 3654, "title": "aiohttp client closes files after sending", "user": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-03-18T11:06:27Z", "updated_at": "2020-03-17T14:03:12Z", "closed_at": "2019-03-18T11:30:01Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\n`aiohttp` seems to close files after the request is over, meaning a file object cannot be reused once a request is sent.\r\n\r\n## Expected behaviour\r\n\r\nThe file should not be closed and I can reuse my file objects following a `seek` call.\r\n\r\n## Actual behaviour\r\n\r\n`aiohttp` closes the file instead.\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"test.py\", line 31, in <module>\r\n    asyncio.get_event_loop().run_until_complete(run())\r\n  File \"...\\Python36\\lib\\asyncio\\base_events.py\", line 466, in run_until_complete\r\n    return future.result()\r\n  File \"test.py\", line 27, in run\r\n    b.seek(0)\r\nValueError: I/O operation on closed file.\r\n```\r\n\r\n## Steps to reproduce\r\n\r\n```py\r\nimport asyncio\r\nimport io\r\nimport aiohttp\r\n\r\nasync def run():\r\n    b = io.BytesIO(b'test')\r\n    async with aiohttp.ClientSession() as sess:\r\n        for _ in range(2):\r\n            b.seek(0)\r\n            async with sess.post('https://httpbin.org/post', data=b) as resp:\r\n                print(await resp.text())\r\n\r\nasyncio.get_event_loop().run_until_complete(run())\r\n```\r\n\r\nThe equivalent `requests` code does not error:\r\n\r\n```py\r\nb = io.BytesIO(b'test')\r\nfor _ in range(2):\r\n    b.seek(0)\r\n    r = requests.post('https://httpbin.org/post', data=b)\r\n    print(r.text)\r\n```\r\n\r\n## Your environment\r\n\r\naiohttp version: 3.5.4\r\nPython version: 3.6.1\r\nOS: Windows 8.1", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3654/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3654/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3653", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3653/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3653/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3653/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3653", "id": 421792484, "node_id": "MDU6SXNzdWU0MjE3OTI0ODQ=", "number": 3653, "title": "web.view should accept Type[AbstractView] as handler instead of AbstractView", "user": {"login": "trim21", "id": 13553903, "node_id": "MDQ6VXNlcjEzNTUzOTAz", "avatar_url": "https://avatars.githubusercontent.com/u/13553903?v=4", "gravatar_id": "", "url": "https://api.github.com/users/trim21", "html_url": "https://github.com/trim21", "followers_url": "https://api.github.com/users/trim21/followers", "following_url": "https://api.github.com/users/trim21/following{/other_user}", "gists_url": "https://api.github.com/users/trim21/gists{/gist_id}", "starred_url": "https://api.github.com/users/trim21/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/trim21/subscriptions", "organizations_url": "https://api.github.com/users/trim21/orgs", "repos_url": "https://api.github.com/users/trim21/repos", "events_url": "https://api.github.com/users/trim21/events{/privacy}", "received_events_url": "https://api.github.com/users/trim21/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1363888987, "node_id": "MDU6TGFiZWwxMzYzODg4OTg3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/pr-merged", "name": "pr-merged", "color": "363396", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-03-16T10:21:28Z", "updated_at": "2019-07-05T08:46:54Z", "closed_at": "2019-07-05T08:46:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Long story short\r\n\r\naccording to [aiohttp's documents](https://docs.aiohttp.org/en/stable/web_quickstart.html#class-based-views), `web.view(path, handler)` hanlder should be a `class` inherit from `web.View`\r\n\r\nhttps://github.com/aio-libs/aiohttp/blob/master/aiohttp/web_routedef.py#L123 \r\n```python\r\ndef view(path: str, handler: AbstractView, **kwargs: Any) -> RouteDef:\r\n    return route(hdrs.METH_ANY, path, handler, **kwargs)\r\n```\r\nbut type annotation means that `handler` should be a instance of `AbstractView` instead of a class.\r\n\r\n## Expected behaviour\r\n\r\n`web.view`'s handler annotation should be `Type[AbstractView]`\r\n\r\n## Actual behaviour\r\n\r\n`web.view`'s handler annotation should be `AbstractView`\r\n\r\n## Steps to reproduce\r\n\r\nno\r\n\r\n## Your environment\r\n\r\nserver: aiohttp==3.5.4\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3653/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3653/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3652", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3652/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3652/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3652/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3652", "id": 421745175, "node_id": "MDU6SXNzdWU0MjE3NDUxNzU=", "number": 3652, "title": "TypeError: Can not serialize value type: <class 'int'>", "user": {"login": "hfldqwe", "id": 35399781, "node_id": "MDQ6VXNlcjM1Mzk5Nzgx", "avatar_url": "https://avatars.githubusercontent.com/u/35399781?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hfldqwe", "html_url": "https://github.com/hfldqwe", "followers_url": "https://api.github.com/users/hfldqwe/followers", "following_url": "https://api.github.com/users/hfldqwe/following{/other_user}", "gists_url": "https://api.github.com/users/hfldqwe/gists{/gist_id}", "starred_url": "https://api.github.com/users/hfldqwe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hfldqwe/subscriptions", "organizations_url": "https://api.github.com/users/hfldqwe/orgs", "repos_url": "https://api.github.com/users/hfldqwe/repos", "events_url": "https://api.github.com/users/hfldqwe/events{/privacy}", "received_events_url": "https://api.github.com/users/hfldqwe/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 16, "created_at": "2019-03-16T00:09:02Z", "updated_at": "2019-10-15T08:27:57Z", "closed_at": "2019-10-15T08:27:57Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Long story short\r\n\r\n<!-- Please describe your problem and why the fix is important. -->\r\n\r\nWhen using a post request, I want to upload both file and form data. Now I have a problem. When I am working at the same time, there will be an error that the integer cannot be serialized, and I can't find the cause of the problem. Although the integer is replaced by a string, this problem is solved. I suspect that the code in the process of encoding or converting data data is not very robust.\r\n\r\n## Expected behaviour\r\n\r\n<!-- What is the behaviour you expect? -->\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/home/py/.virtualenv/youka/lib/python3.7/site-packages/aiohttp/client_reqrep.py\", line 482, in update_body_from_data\r\n    body = payload.PAYLOAD_REGISTRY.get(body, disposition=None)\r\n  File \"/home/py/.virtualenv/youka/lib/python3.7/site-packages/aiohttp/payload.py\", line 106, in get\r\n    raise LookupError()\r\naiohttp.payload.LookupError\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/py/.virtualenv/youka/lib/python3.7/site-packages/aiohttp/formdata.py\", line 126, in _gen_form_data\r\n    value, headers=headers, encoding=self._charset)\r\n  File \"/home/py/.virtualenv/youka/lib/python3.7/site-packages/aiohttp/payload.py\", line 63, in get_payload\r\n    return PAYLOAD_REGISTRY.get(data, *args, **kwargs)\r\n  File \"/home/py/.virtualenv/youka/lib/python3.7/site-packages/aiohttp/payload.py\", line 106, in get\r\n    raise LookupError()\r\naiohttp.payload.LookupError\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/py/project/chd_youka/async_spider/chaojiying.py\", line 65, in <module>\r\n    loop.run_until_complete(main())                 #1902 \u9a8c\u8bc1\u7801\u7c7b\u578b  \u5b98\u65b9\u7f51\u7ad9>>\u4ef7\u683c\u4f53\u7cfb 3.4+\u7248 print \u540e\u8981\u52a0()\r\n  File \"/usr/local/lib/python3.7/asyncio/base_events.py\", line 568, in run_until_complete\r\n    return future.result()\r\n  File \"/home/py/project/chd_youka/async_spider/chaojiying.py\", line 54, in main\r\n    code = await chaojiying.PostPic(im, 4004,session)\r\n  File \"/home/py/project/chd_youka/async_spider/chaojiying.py\", line 38, in PostPic\r\n    async with session.post(url='http://upload.chaojiying.net/Upload/Processing.php', data=params, headers=self.headers) as response:\r\n  File \"/home/py/.virtualenv/youka/lib/python3.7/site-packages/aiohttp/client.py\", line 1005, in __aenter__\r\n    self._resp = await self._coro\r\n  File \"/home/py/.virtualenv/youka/lib/python3.7/site-packages/aiohttp/client.py\", line 466, in _request\r\n    ssl=ssl, proxy_headers=proxy_headers, traces=traces)\r\n  File \"/home/py/.virtualenv/youka/lib/python3.7/site-packages/aiohttp/client_reqrep.py\", line 294, in __init__\r\n    self.update_body_from_data(data)\r\n  File \"/home/py/.virtualenv/youka/lib/python3.7/site-packages/aiohttp/client_reqrep.py\", line 484, in update_body_from_data\r\n    body = FormData(body)()\r\n  File \"/home/py/.virtualenv/youka/lib/python3.7/site-packages/aiohttp/formdata.py\", line 148, in __call__\r\n    return self._gen_form_data()\r\n  File \"/home/py/.virtualenv/youka/lib/python3.7/site-packages/aiohttp/formdata.py\", line 131, in _gen_form_data\r\n    type(value), headers, value)) from exc\r\nTypeError: Can not serialize value type: <class 'int'>\r\n headers: {}\r\n value: 4004\r\n```\r\n\r\n## Actual behaviour\r\n\r\n<!-- What's actually happening? -->\r\n\r\nWhen the form data contains both file objects (perhaps binary objects) and integers\r\n\r\n```\r\n    async def PostPic(self, im, codetype, session):\r\n        \"\"\"\r\n        im: Picture byte\r\n        codetype: http://www.chaojiying.com/price.html\r\n        \"\"\"\r\n        params = {\r\n            'codetype': codetype,\r\n        }\r\n        params.update(self.base_params)\r\n        files = {'userfile':im}\r\n        params.update(files)\r\n        print(params)\r\n        async with session.post(url='http://upload.chaojiying.net/Upload/Processing.php', data=params, headers=self.headers) as response:\r\n            return await response.text()\r\n```\r\n![image](https://user-images.githubusercontent.com/35399781/54467796-6b3e8e00-47c2-11e9-9ce1-e4292338b472.png)\r\n\r\n## Steps to reproduce\r\n\r\n<!-- Please describe steps to reproduce the issue.\r\n     If you have a script that does that please include it here within\r\n     markdown code markup -->\r\n\r\n## Your environment\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case. \r\n     \r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\nLinux version 4.4.0-116-generic (buildd@lgw01-amd64-021) (gcc version 5.4.0 20160609 (Ubuntu 5.4.0-6ubuntu1~16.04.9) ) #140-Ubuntu SMP Mon Feb 12 21:23:04 UTC 2018\r\n\r\nPython3.7\r\n\r\naiohttp3.5.4\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3652/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3652/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3651", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3651/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3651/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3651/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3651", "id": 421619240, "node_id": "MDU6SXNzdWU0MjE2MTkyNDA=", "number": 3651, "title": "ConnectionAbortedError: SSL handshake is taking longer than 60.0 seconds: aborting the connection", "user": {"login": "MtzwOsk", "id": 17458136, "node_id": "MDQ6VXNlcjE3NDU4MTM2", "avatar_url": "https://avatars.githubusercontent.com/u/17458136?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MtzwOsk", "html_url": "https://github.com/MtzwOsk", "followers_url": "https://api.github.com/users/MtzwOsk/followers", "following_url": "https://api.github.com/users/MtzwOsk/following{/other_user}", "gists_url": "https://api.github.com/users/MtzwOsk/gists{/gist_id}", "starred_url": "https://api.github.com/users/MtzwOsk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MtzwOsk/subscriptions", "organizations_url": "https://api.github.com/users/MtzwOsk/orgs", "repos_url": "https://api.github.com/users/MtzwOsk/repos", "events_url": "https://api.github.com/users/MtzwOsk/events{/privacy}", "received_events_url": "https://api.github.com/users/MtzwOsk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-03-15T17:07:08Z", "updated_at": "2020-06-24T20:28:14Z", "closed_at": "2019-06-14T12:19:38Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nTho many requests as a client are closed by handshake timeout in ssl connection.\r\n\r\n## Actual behaviour\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/home/mtzw/projects/get_book/env/lib/python3.7/site-packages/aiohttp/connector.py\", line 924, in _wrap_create_connection\r\n    await self._loop.create_connection(*args, **kwargs))\r\n  File \"/usr/local/lib/python3.7/asyncio/base_events.py\", line 970, in create_connection\r\n    ssl_handshake_timeout=ssl_handshake_timeout)\r\n  File \"/usr/local/lib/python3.7/asyncio/base_events.py\", line 998, in _create_connection_transport\r\n    await waiter\r\nConnectionAbortedError: SSL handshake is taking longer than 60.0 seconds: aborting the connection\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/mtzw/programs/pycharm-2018.2.3/helpers/pydev/pydevd.py\", line 1664, in <module>\r\n    main()\r\n  File \"/home/mtzw/programs/pycharm-2018.2.3/helpers/pydev/pydevd.py\", line 1658, in main\r\n    globals = debugger.run(setup['file'], None, None, is_module)\r\n  File \"/home/mtzw/programs/pycharm-2018.2.3/helpers/pydev/pydevd.py\", line 1068, in run\r\n    pydev_imports.execfile(file, globals, locals)  # execute the script\r\n  File \"/home/mtzw/programs/pycharm-2018.2.3/helpers/pydev/_pydev_imps/_pydev_execfile.py\", line 18, in execfile\r\n    exec(compile(contents+\"\\n\", file, 'exec'), glob, loc)\r\n  File \"/home/mtzw/projects/get_book/backend/main.py\", line 125, in <module>\r\n    results = asyncio.run(main(get_book_titles_list()))\r\n  File \"/usr/local/lib/python3.7/asyncio/runners.py\", line 43, in run\r\n    return loop.run_until_complete(main)\r\n  File \"/usr/local/lib/python3.7/asyncio/base_events.py\", line 568, in run_until_complete\r\n    return future.result()\r\n  File \"/home/mtzw/projects/get_book/backend/main.py\", line 121, in main\r\n    return await asyncio.gather(*title_request)\r\n  File \"/home/mtzw/projects/get_book/backend/main.py\", line 105, in get_books\r\n    html = await fetch(session, BASE_URL, params=query_params)\r\n  File \"/home/mtzw/projects/get_book/backend/main.py\", line 57, in fetch\r\n    async with session.get(url, params=params) as response:\r\n  File \"/home/mtzw/projects/get_book/env/lib/python3.7/site-packages/aiohttp/client.py\", line 1005, in __aenter__\r\n    self._resp = await self._coro\r\n  File \"/home/mtzw/projects/get_book/env/lib/python3.7/site-packages/aiohttp/client.py\", line 476, in _request\r\n    timeout=real_timeout\r\n  File \"/home/mtzw/projects/get_book/env/lib/python3.7/site-packages/aiohttp/connector.py\", line 522, in connect\r\n    proto = await self._create_connection(req, traces, timeout)\r\n  File \"/home/mtzw/projects/get_book/env/lib/python3.7/site-packages/aiohttp/connector.py\", line 854, in _create_connection\r\n    req, traces, timeout)\r\n  File \"/home/mtzw/projects/get_book/env/lib/python3.7/site-packages/aiohttp/connector.py\", line 992, in _create_direct_connection\r\n    raise last_exc\r\n  File \"/home/mtzw/projects/get_book/env/lib/python3.7/site-packages/aiohttp/connector.py\", line 974, in _create_direct_connection\r\n    req=req, client_error=client_error)\r\n  File \"/home/mtzw/projects/get_book/env/lib/python3.7/site-packages/aiohttp/connector.py\", line 931, in _wrap_create_connection\r\n    raise client_error(req.connection_key, exc) from exc\r\naiohttp.client_exceptions.ClientConnectorError: Cannot connect to host aleph.koszykowa.pl:443 ssl:None [None]\r\n```\r\n\r\n## Steps to reproduce\r\n```\r\n\r\nimport aiohttp\r\nimport asyncio\r\nimport math\r\nimport time\r\n\r\nfrom bs4 import BeautifulSoup as bs\r\nfrom yarl import URL\r\n\r\nfrom backend.lubimy import get_book_titles_list\r\n\r\nBEGIN_COUNTER: int = 11\r\nTABLE_PAGINATION: int = 10\r\n\r\nBASE_URL = 'https://aleph.koszykowa.pl/F'\r\n\r\n\r\ndef has_valign(tag):\r\n    return tag.get('valign', '') == 'baseline'\r\n\r\n\r\ndef extend_session(session, soup):\r\n    # cookies from HTML\r\n    meta_tags = soup.find_all('meta')\r\n    for meta in meta_tags:\r\n        if meta.attrs.get('http-equiv') == 'Set-Cookie':\r\n            key, value, *_ = meta.attrs.get('content').replace(' = ', ';').split(';')\r\n            session.cookie_jar.update_cookies(\r\n                {key: value},\r\n                response_url=URL('https://aleph.koszykowa.pl'))\r\n\r\n\r\ndef get_library_name(soup, title):\r\n    table = soup.find(id='short_table')\r\n    if table:\r\n        libraries = []\r\n        rows = table.find_all(has_valign)\r\n        for row in rows:\r\n            library_name_row = row.find_all('td')[-1]\r\n            libraries_a_tags = library_name_row.find_all('a')\r\n            [libraries.append(library_name.text) for library_name in libraries_a_tags]\r\n        \r\n        for library in libraries:\r\n            name, availability = library.split('(')\r\n            number, lend = availability.replace(' ', '').replace(')', '').split('/')\r\n            print(f'{title}, {name}, availability {number != lend}')\r\n            \r\n        return True\r\n    else:\r\n        try:\r\n            print(f'Brak {title}', soup.find('div', class_='title').text)\r\n        except AttributeError:\r\n            pass\r\n        return False\r\n\r\n\r\nasync def fetch(session, url, params=None):\r\n    async with session.get(url, params=params) as response:\r\n        response._content_type = 'text/html; charset=UTF-8'\r\n        response_text = await response.text()\r\n    soup = bs(response_text, 'html.parser')\r\n    meta_tags = soup.find_all('meta')\r\n    for meta in meta_tags:\r\n        if meta.attrs.get('http-equiv') == 'Set-Cookie':\r\n            key, value, *_ = meta.attrs.get('content').replace(' = ', ';').split(';')\r\n            session.cookie_jar.update_cookies(\r\n                {key: value},\r\n                response_url=URL('https://aleph.koszykowa.pl'))\r\n    return response_text\r\n\r\n\r\nasync def fetch_table(session, url, title: str, params: dict=None):\r\n    async with session.get(url, params=params) as response:\r\n        soup = create_soup(await response.text())\r\n    get_library_name(soup, title)\r\n\r\n\r\ndef create_soup(html):\r\n    return bs(html, 'lxml')\r\n\r\n\r\ndef get_number_of_tables(soup):\r\n    try:\r\n        books_number = int(list(filter(None, soup.find(class_='text3').text.split(' ')))[6])  # math.ceil\r\n        if books_number > 10:\r\n            return math.ceil(books_number / TABLE_PAGINATION)\r\n        return 0\r\n    except (IndexError, AttributeError) as error:\r\n        print(f'Not more tables. {error}')\r\n        return 0\r\n\r\n\r\nasync def get_books(title: str):\r\n    async with aiohttp.ClientSession(\r\n            timeout=aiohttp.ClientTimeout(total=900, connect=900, sock_connect=900, sock_read=900),\r\n            connector=aiohttp.TCPConnector(force_close=True)) as session:\r\n        query_params = {\r\n            'func': 'find-b',\r\n            'find_code': 'WTI',\r\n            'adjacent': 'Y',\r\n            'local_base': 'SROBK',\r\n            # 'find_code': 'WAU',\r\n            # 'request': 'Henryk Sienkiewicz',\r\n        }\r\n        query_params['request'] = title\r\n        html = await fetch(session, BASE_URL, params=query_params)\r\n        soup = create_soup(html)\r\n        # get number from first page\r\n\r\n        if get_library_name(soup, title):\r\n            tables_number = get_number_of_tables(soup)\r\n            if tables_number >= 1:\r\n                jumps = [{'func': 'short-jump', 'jump': BEGIN_COUNTER + 10 * number} for number in range(tables_number)]\r\n                tables_request = [asyncio.ensure_future(fetch_table(session, BASE_URL, jump)) for jump in jumps]\r\n                results = await asyncio.gather(*tables_request)\r\n                return results\r\n        return None\r\n\r\n\r\nasync def main(titles: list = None):\r\n    title_request = [asyncio.ensure_future(get_books(title)) for title in titles]\r\n    return await asyncio.gather(*title_request)\r\n\r\n\r\nif __name__ == '__main__':\r\n    results = asyncio.run(main(get_book_titles_list())) \r\n# If list to long bugs ConnectionAbortedError: SSL handshake is taking longer than 60.0 seconds: aborting the connection\r\n\r\n\r\n```\r\n\r\n## Your environment\r\n\r\nPython 3.7\r\naiohttp 3.5.4\r\nUbuntu 16.04\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3651/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3651/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3648", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3648/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3648/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3648/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3648", "id": 420124341, "node_id": "MDU6SXNzdWU0MjAxMjQzNDE=", "number": 3648, "title": "Handle ConnectionResetError", "user": {"login": "decaz", "id": 31096, "node_id": "MDQ6VXNlcjMxMDk2", "avatar_url": "https://avatars.githubusercontent.com/u/31096?v=4", "gravatar_id": "", "url": "https://api.github.com/users/decaz", "html_url": "https://github.com/decaz", "followers_url": "https://api.github.com/users/decaz/followers", "following_url": "https://api.github.com/users/decaz/following{/other_user}", "gists_url": "https://api.github.com/users/decaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/decaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/decaz/subscriptions", "organizations_url": "https://api.github.com/users/decaz/orgs", "repos_url": "https://api.github.com/users/decaz/repos", "events_url": "https://api.github.com/users/decaz/events{/privacy}", "received_events_url": "https://api.github.com/users/decaz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2019-03-12T17:49:51Z", "updated_at": "2020-06-24T18:24:54Z", "closed_at": "2019-05-07T19:38:15Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nThere was introduced `ConnectionResetError` within #2989. What is the preferable way to handle this exception on the server side?\r\n\r\n## Expected behaviour\r\n\r\nNo exceptions or all exceptions are catched and handled.\r\n\r\n## Actual behaviour\r\n\r\n```\r\nUnhandled exception\r\nTraceback (most recent call last):\r\n  File \"/home/decaz/.virtualenvs/test-aiohttp/lib/python3.6/site-packages/aiohttp/web_protocol.py\", line 448, in start\r\n    await resp.write_eof()\r\n  File \"/usr/lib/python3.6/asyncio/coroutines.py\", line 110, in __next__\r\n    return self.gen.send(None)\r\n  File \"/home/decaz/.virtualenvs/test-aiohttp/lib/python3.6/site-packages/aiohttp/web_response.py\", line 444, in write_eof\r\n    await self._payload_writer.write_eof(data)\r\n  File \"/usr/lib/python3.6/asyncio/coroutines.py\", line 110, in __next__\r\n    return self.gen.send(None)\r\n  File \"/home/decaz/.virtualenvs/test-aiohttp/lib/python3.6/site-packages/aiohttp/http_writer.py\", line 138, in write_eof\r\n    self._write(chunk)\r\n  File \"/home/decaz/.virtualenvs/test-aiohttp/lib/python3.6/site-packages/aiohttp/http_writer.py\", line 67, in _write\r\n    raise ConnectionResetError('Cannot write to closing transport')\r\nConnectionResetError: Cannot write to closing transport\r\n```\r\n\r\n## Steps to reproduce\r\n\r\nClose client connection while there is running coroutine on the server side.\r\n\r\n## Your environment\r\n\r\nServer: aiohttp==3.5.4", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3648/reactions", "total_count": 5, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 5, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3648/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3644", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3644/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3644/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3644/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3644", "id": 419147564, "node_id": "MDU6SXNzdWU0MTkxNDc1NjQ=", "number": 3644, "title": "BUG, EASY, PY38: web_protocol.RequestHandler mismatch _keepalive field with __slots__ ", "user": {"login": "cjrh", "id": 480395, "node_id": "MDQ6VXNlcjQ4MDM5NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/480395?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjrh", "html_url": "https://github.com/cjrh", "followers_url": "https://api.github.com/users/cjrh/followers", "following_url": "https://api.github.com/users/cjrh/following{/other_user}", "gists_url": "https://api.github.com/users/cjrh/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjrh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjrh/subscriptions", "organizations_url": "https://api.github.com/users/cjrh/orgs", "repos_url": "https://api.github.com/users/cjrh/repos", "events_url": "https://api.github.com/users/cjrh/events{/privacy}", "received_events_url": "https://api.github.com/users/cjrh/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 277836062, "node_id": "MDU6TGFiZWwyNzc4MzYwNjI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/good%20first%20issue", "name": "good first issue", "color": "7057ff", "default": true, "description": "Good for newcomers"}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-03-10T05:07:13Z", "updated_at": "2020-05-05T21:59:13Z", "closed_at": "2019-05-06T18:04:31Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nIn `RequestHandler`, the spelling in `__slots__` is `_keep_alive` but in the default assignment in `__init__()`, the name of the field is `_keepalive`. The latter is what actually gets used in the module, not the slots name.\r\n\r\nIn Python 3.7, this appears to be ok because instances are getting a `__dict__` from somewhere (presumably from an ancestor in the MRO chain). However, in Python 3.8 it seems that instances of `RequestHandler` are _not_ getting a `__dict__` attached to them, which is why an `AttributeError` gets raised.\r\n\r\nThe slots declaration in `aiohttp/web_protocol.py`:\r\n\r\n```\r\nclass RequestHandler(BaseProtocol):\r\n    KEEPALIVE_RESCHEDULE_DELAY = 1\r\n\r\n    __slots__ = ('_request_count', '_keep_alive', '_manager',\r\n                 '_request_handler', '_request_factory', '_tcp_keepalive',\r\n                 '_keepalive_time', '_keepalive_handle', '_keepalive_timeout',\r\n                 '_lingering_time', '_messages', '_message_tail',\r\n                 '_waiter', '_error_handler', '_task_handler',\r\n                 '_upgrade', '_payload_parser', '_request_parser',\r\n                 '_reading_paused', 'logger', 'debug', 'access_log',\r\n                 'access_logger', '_close', '_force_close')\r\n\r\n    def __init__(self, manager: 'Server', *,\r\n                 loop: asyncio.AbstractEventLoop,\r\n                 keepalive_timeout: float=75.,  # NGINX default is 75 secs\r\n                 tcp_keepalive: bool=True,\r\n                 logger: Logger=server_logger,\r\n                 access_log_class: Type[AbstractAccessLogger]=AccessLogger,\r\n                 access_log: Logger=access_logger,\r\n                 access_log_format: str=AccessLogger.LOG_FORMAT,\r\n                 debug: bool=False,\r\n                 max_line_size: int=8190,\r\n                 max_headers: int=32768,\r\n                 max_field_size: int=8190,\r\n                 lingering_time: float=10.0):\r\n\r\n        super().__init__(loop)\r\n\r\n        self._request_count = 0\r\n\r\n        self._keepalive = False      # <----- NAME DIFFERS TO _keep_alive IN SLOTS\r\n\r\n        self._manager = manager  # type: Optional[Server]\r\n        self._request_handler = manager.request_handler  # type: Optional[_RequestHandler]  # noqa\r\n        self._request_factory = manager.request_factory  # type: Optional[_RequestFactory]  # noqa\r\n\r\n```\r\n\r\nThis code was added in #3095.\r\n\r\n## Expected behaviour\r\n\r\nIn Python 3.8 requests to the aiohttp web server should succeed.\r\n\r\n## Actual behaviour\r\n\r\nIn Python 3.8, requests fail with this traceback:\r\n\r\n```\r\nException in callback BaseProactorEventLoop._start_serving.<locals>.loop(<_OverlappedF...0.1', 64284))>) at G:\\Programs\\Python38\\lib\\asyncio\\proactor_events.py:651\r\nhandle: <Handle BaseProactorEventLoop._start_serving.<locals>.loop(<_OverlappedF...0.1', 64284))>) at G:\\Programs\\Python38\\lib\\asyncio\\proactor_events.py:651>\r\nTraceback (most recent call last):\r\n  File \"G:\\Programs\\Python38\\lib\\asyncio\\events.py\", line 81, in _run\r\n    self._context.run(self._callback, *self._args)\r\n  File \"G:\\Programs\\Python38\\lib\\asyncio\\proactor_events.py\", line 658, in loop\r\n    protocol = protocol_factory()\r\n  File \"G:\\Documents\\repos\\blah\\venv\\lib\\site-packages\\aiohttp\\web_server.py\", line 57, in __call__\r\n    return RequestHandler(self, loop=self._loop, **self._kwargs)\r\n  File \"G:\\Documents\\repos\\blah\\venv\\lib\\site-packages\\aiohttp\\web_protocol.py\", line 136, in __init__\r\n    self._keepalive = False\r\nAttributeError: 'RequestHandler' object has no attribute '_keepalive'\r\n```\r\n\r\nImmediately at the offending line (in a debugger), the `__mro__` for the `RequestHandler` instance appears to be the same when running under Python 3.7 and Python 3.8:\r\n\r\n```\r\n[\r\n    <class 'tuple'>: (<class 'aiohttp.web_protocol.RequestHandler'>, \r\n    <class 'aiohttp.base_protocol.BaseProtocol'>, \r\n    <class 'asyncio.protocols.Protocol'>, \r\n    <class 'asyncio.protocols.BaseProtocol'>, \r\n    <class 'object'>)\r\n]\r\n```\r\nThis leads me to suspect that something might have changed with either `Protocol` or `BaseProtocol` in upstream asyncio (i.e. declaring slots so as to prevent `__dict__` appearing on the instance), but I've not confirmed this.\r\n\r\nRegardless, the name mismatch of the field must still be fixed.\r\n\r\n## Steps to reproduce\r\n\r\nServer code with:\r\n\r\n```\r\nimport sys\r\nfrom aiohttp import web\r\nroutes = web.RouteTableDef()\r\nFILENAME = 'reveal/reveal.js-3.6.0/index.html'  # Or whatever\r\n\r\n@routes.get('/')\r\nasync def handle(request):\r\n    return web.FileResponse(FILENAME)\r\n\r\napp = web.Application()\r\napp.router.add_static('/js', 'reveal/reveal.js-3.6.0/js')\r\napp.router.add_static('/css', 'reveal/reveal.js-3.6.0/css')\r\napp.router.add_static('/img', 'reveal/reveal.js-3.6.0/img')\r\napp.router.add_static('/lib', 'reveal/reveal.js-3.6.0/lib')\r\napp.router.add_static('/plugin', 'reveal/reveal.js-3.6.0/plugin')\r\napp.router.add_routes(routes)\r\nweb.run_app(app)\r\n```\r\n\r\nThen open `localhost:8080` in a browser.\r\n\r\n## Your environment\r\n\r\n- Windows 10 x64\r\n- Python 3.8.0a2 (downloaded installer from python.org), with `requirements.txt`:\r\n\r\n```\r\naiohttp==3.5.4\r\nasync-timeout==3.0.1\r\nattrs==19.1.0\r\nchardet==3.0.4\r\nCython==0.29.6\r\ndominate==2.3.5\r\nidna==2.8\r\nmultidict==4.5.2\r\nnumpy==1.16.2\r\nyarl==1.3.0\r\n```", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3644/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3644/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3639", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3639/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3639/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3639/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3639", "id": 417751828, "node_id": "MDU6SXNzdWU0MTc3NTE4Mjg=", "number": 3639, "title": "Wrong type annotation for local_addr in TCPConnector.__init__", "user": {"login": "quonb", "id": 881040, "node_id": "MDQ6VXNlcjg4MTA0MA==", "avatar_url": "https://avatars.githubusercontent.com/u/881040?v=4", "gravatar_id": "", "url": "https://api.github.com/users/quonb", "html_url": "https://github.com/quonb", "followers_url": "https://api.github.com/users/quonb/followers", "following_url": "https://api.github.com/users/quonb/following{/other_user}", "gists_url": "https://api.github.com/users/quonb/gists{/gist_id}", "starred_url": "https://api.github.com/users/quonb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/quonb/subscriptions", "organizations_url": "https://api.github.com/users/quonb/orgs", "repos_url": "https://api.github.com/users/quonb/repos", "events_url": "https://api.github.com/users/quonb/events{/privacy}", "received_events_url": "https://api.github.com/users/quonb/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-03-06T11:17:36Z", "updated_at": "2020-05-20T20:44:55Z", "closed_at": "2019-05-07T19:51:11Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "https://github.com/aio-libs/aiohttp/blob/f489a927a84bf37c6c49e0c31f9228adc31d6058/aiohttp/connector.py#L717\r\nShould not it be `Optional[Tuple[str, int]]`?", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3639/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3639/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3628", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3628/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3628/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3628/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3628", "id": 415220658, "node_id": "MDU6SXNzdWU0MTUyMjA2NTg=", "number": 3628, "title": "Session not closed in aiohttp.request after exception", "user": {"login": "fried-sausage", "id": 16693787, "node_id": "MDQ6VXNlcjE2NjkzNzg3", "avatar_url": "https://avatars.githubusercontent.com/u/16693787?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fried-sausage", "html_url": "https://github.com/fried-sausage", "followers_url": "https://api.github.com/users/fried-sausage/followers", "following_url": "https://api.github.com/users/fried-sausage/following{/other_user}", "gists_url": "https://api.github.com/users/fried-sausage/gists{/gist_id}", "starred_url": "https://api.github.com/users/fried-sausage/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fried-sausage/subscriptions", "organizations_url": "https://api.github.com/users/fried-sausage/orgs", "repos_url": "https://api.github.com/users/fried-sausage/repos", "events_url": "https://api.github.com/users/fried-sausage/events{/privacy}", "received_events_url": "https://api.github.com/users/fried-sausage/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-02-27T16:44:27Z", "updated_at": "2019-07-19T14:49:24Z", "closed_at": "2019-07-19T14:49:24Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## Long story short\r\n\r\nsubj\r\nFirst I get ClientConnectorError (connection-related errors are expected in my application), after that i see `Unclosed client session` warning.\r\n\r\n## Expected behaviour\r\n\r\nClientSession, created inside aiohttp.request, is closed after programm leaves `async with` block.\r\n\r\n## Actual behaviour\r\n\r\nClientSession is not closed.\r\n\r\n## Steps to reproduce\r\n\r\n```\r\nimport asyncio\r\nimport aiohttp\r\n\r\n\r\nasync def main():\r\n    async with aiohttp.request(\"GET\", \"http://127.0.0.1:8080\") as resp:\r\n        pass\r\n\r\n\r\nloop = asyncio.get_event_loop()\r\ntry:\r\n    loop.run_until_complete(main())\r\nfinally:\r\n    loop.close()\r\n```\r\n## Your environment\r\naiohttp 3.5.4\r\npython 3.5\r\ndebian stretch\r\n\r\n## Why use aiohttp.request at all, opening new connection for every request is bad\r\nI need to open new connection anyway:\r\n1) server i talk to does not support keep-alive\r\n2) i programm client that runs on a moving device using wifi network so connection failures are expected", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3628/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3628/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3621", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3621/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3621/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3621/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3621", "id": 413742289, "node_id": "MDU6SXNzdWU0MTM3NDIyODk=", "number": 3621, "title": "`multipart.py` type annotations mismatch documentation", "user": {"login": "kornicameister", "id": 1029674, "node_id": "MDQ6VXNlcjEwMjk2NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1029674?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kornicameister", "html_url": "https://github.com/kornicameister", "followers_url": "https://api.github.com/users/kornicameister/followers", "following_url": "https://api.github.com/users/kornicameister/following{/other_user}", "gists_url": "https://api.github.com/users/kornicameister/gists{/gist_id}", "starred_url": "https://api.github.com/users/kornicameister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kornicameister/subscriptions", "organizations_url": "https://api.github.com/users/kornicameister/orgs", "repos_url": "https://api.github.com/users/kornicameister/repos", "events_url": "https://api.github.com/users/kornicameister/events{/privacy}", "received_events_url": "https://api.github.com/users/kornicameister/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 445958404, "node_id": "MDU6TGFiZWw0NDU5NTg0MDQ=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/documentation", "name": "documentation", "color": "0075ca", "default": true, "description": "Improvements or additions to documentation"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-02-23T21:25:47Z", "updated_at": "2019-07-19T14:48:50Z", "closed_at": "2019-07-19T14:48:49Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## Long story short\r\n\r\nProblem lies in a mismatch between the documentation of multipart [here](https://docs.aiohttp.org/en/stable/multipart.html#aiohttp-multipart) and the actual code execution around courotines `__anext__`, `next`. \r\n\r\n## Expected behaviour\r\n\r\nCode annotations are matching the documentation and therefore expected behavior.\r\n\r\n## Actual behaviour\r\n\r\nAs a developer, I didn't notice that multipart reader behavior is actually not as straightforward as it seemed to be. Reading the documentation again, revealed to me what should be expected in here however I would expect that `mypy` tells me that I need to account for that behavior.\r\n\r\n## Steps to reproduce\r\n\r\nNone that I can think of. Code works fine, only annotations need tuning.\r\n\r\n## Your environment\r\n\r\n- aiohttp (3.5.4)\r\n- server", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3621/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3621/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3620", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3620/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3620/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3620/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3620", "id": 413477516, "node_id": "MDU6SXNzdWU0MTM0Nzc1MTY=", "number": 3620, "title": "Long network delay", "user": {"login": "rickcoup", "id": 13991148, "node_id": "MDQ6VXNlcjEzOTkxMTQ4", "avatar_url": "https://avatars.githubusercontent.com/u/13991148?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rickcoup", "html_url": "https://github.com/rickcoup", "followers_url": "https://api.github.com/users/rickcoup/followers", "following_url": "https://api.github.com/users/rickcoup/following{/other_user}", "gists_url": "https://api.github.com/users/rickcoup/gists{/gist_id}", "starred_url": "https://api.github.com/users/rickcoup/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rickcoup/subscriptions", "organizations_url": "https://api.github.com/users/rickcoup/orgs", "repos_url": "https://api.github.com/users/rickcoup/repos", "events_url": "https://api.github.com/users/rickcoup/events{/privacy}", "received_events_url": "https://api.github.com/users/rickcoup/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2019-02-22T16:23:14Z", "updated_at": "2021-10-30T18:18:04Z", "closed_at": "2021-10-30T18:18:04Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Long story short\r\n\r\nUnder load around 6 transactions per second, our http requests and asyncio calls are timeout'd at 10 seconds. It makes our API unusable.\r\n\r\n## Expected behaviour\r\n\r\nThe http request should be responded within 1 second or hundreds of milliseconds.\r\n\r\n## Actual behaviour\r\n\r\nFrom cProfiler, it shows\r\n\r\n> ncalls tottime percall cumtime percall filename:lineno(function)\r\n> \r\n>  1375 73906.971   53.751 73906.971   53.751 {method 'poll' of 'select.epoll' objects}\r\n\r\nThe network connections are increased\r\nfrom\r\n\r\n> (app-root) sh-4.2$ ss -s\r\n> Total: 10042 (kernel 0)\r\n> TCP:   711 (estab 11, closed 698, orphaned 0, synrecv 0, timewait 210/0), ports 0\r\n> \r\n> Transport Total     IP        IPv6\r\n> *         0         -         -\r\n> RAW       0         0         0\r\n> UDP       0         0         0\r\n> TCP       13        13        0\r\n> INET      13        13        0\r\n> FRAG      0         0         0\r\n\r\nto\r\n\r\n> (app-root) sh-4.2$ ss -s\r\n> Total: 10065 (kernel 0)\r\n> TCP:   800 (estab 54, closed 744, orphaned 0, synrecv 0, timewait 259/0), ports 0\r\n> \r\n> Transport Total     IP        IPv6\r\n> *         0         -         -\r\n> RAW       0         0         0\r\n> UDP       0         0         0\r\n> TCP       56        56        0\r\n> INET      56        56        0\r\n> FRAG      0         0         0\r\n\r\n## Steps to reproduce\r\n\r\n```\r\nasync def fetch(method, session, url, pData, head, timeout):\r\n''' send reqest by async session with timeout '''\r\n#async with getattr(session, method)(url, data=pData, headers=head, timeout=timeout) as response:\r\n    #return {'data': await response.json(), 'status': response.status}\r\n#Trying to change, to check the performance\r\nif method == 'get':\r\n    async with session.get(url, data=pData, headers=head, timeout=timeout) as response:\r\n        return {'data': await response.json(), 'status': response.status}\r\nelif method == 'post':\r\n    async with session.post(url, data=pData, headers=head, timeout=timeout) as response:\r\n        return {'data': await response.json(), 'status': response.status}\r\nelif method == 'delete':\r\n    async with session.delete(url, data=pData, headers=head, timeout=timeout) as response:\r\n        return {'data': await response.json(), 'status': response.status}\r\nelif method == 'put':\r\n    async with session.delete(url, data=pData, headers=head, timeout=timeout) as response:\r\n        return {'data': await response.json(), 'status': response.status}\r\n```\r\n\r\n## Your environment\r\npython 3.6.3, aiohttp==3.5.4 and asyncio==3.4.3 in openshift 3.9", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3620/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3620/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3611", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3611/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3611/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3611/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3611", "id": 410633658, "node_id": "MDU6SXNzdWU0MTA2MzM2NTg=", "number": 3611, "title": "Timeouterror", "user": {"login": "ThreadShakur", "id": 17909421, "node_id": "MDQ6VXNlcjE3OTA5NDIx", "avatar_url": "https://avatars.githubusercontent.com/u/17909421?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ThreadShakur", "html_url": "https://github.com/ThreadShakur", "followers_url": "https://api.github.com/users/ThreadShakur/followers", "following_url": "https://api.github.com/users/ThreadShakur/following{/other_user}", "gists_url": "https://api.github.com/users/ThreadShakur/gists{/gist_id}", "starred_url": "https://api.github.com/users/ThreadShakur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ThreadShakur/subscriptions", "organizations_url": "https://api.github.com/users/ThreadShakur/orgs", "repos_url": "https://api.github.com/users/ThreadShakur/repos", "events_url": "https://api.github.com/users/ThreadShakur/events{/privacy}", "received_events_url": "https://api.github.com/users/ThreadShakur/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-02-15T07:06:52Z", "updated_at": "2020-06-24T19:49:18Z", "closed_at": "2019-06-14T12:24:45Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nIs session reconnect after TimeoutError? If not, how i can do that? Bcs aiohttp gives too much timeouterrors\r\n\r\nLatest version of aiohttp, client\r\n    \r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3611/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3611/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3606", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3606/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3606/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3606/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3606", "id": 409641545, "node_id": "MDU6SXNzdWU0MDk2NDE1NDU=", "number": 3606, "title": "Failing test in Python 3.8", "user": {"login": "Mariatta", "id": 5844587, "node_id": "MDQ6VXNlcjU4NDQ1ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/5844587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mariatta", "html_url": "https://github.com/Mariatta", "followers_url": "https://api.github.com/users/Mariatta/followers", "following_url": "https://api.github.com/users/Mariatta/following{/other_user}", "gists_url": "https://api.github.com/users/Mariatta/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mariatta/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mariatta/subscriptions", "organizations_url": "https://api.github.com/users/Mariatta/orgs", "repos_url": "https://api.github.com/users/Mariatta/repos", "events_url": "https://api.github.com/users/Mariatta/events{/privacy}", "received_events_url": "https://api.github.com/users/Mariatta/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 12, "created_at": "2019-02-13T06:02:15Z", "updated_at": "2020-05-20T20:07:27Z", "closed_at": "2019-05-13T19:33:49Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nI'm seeing tests related to aiohttp that fail in Python 3.8+, but pass in Python 3.7.2.\r\nI encountered this in bedevere, you can check the travis CI log in there. (https://github.com/python/bedevere/pull/154)\r\n\r\n## Expected behaviour\r\n\r\nTests should be passing.\r\n\r\n## Actual behaviour\r\n\r\nThe tests pass for Python 3.7.2, but fail for Python 3.8\r\n\r\n## Steps to reproduce\r\n\r\nI created the following test case: (copy pasted from the docs: https://docs.aiohttp.org/en/stable/testing.html#pytest)\r\n\r\n```python\r\nfrom aiohttp import web\r\n\r\nasync def hello(request):\r\n    return web.Response(text='Hello, world')\r\n\r\nasync def test_hello(aiohttp_client):\r\n    app = web.Application()\r\n    app.router.add_get('/', hello)\r\n    client = await aiohttp_client(app)\r\n    resp = await client.get('/')\r\n    assert resp.status == 200\r\n    text = await resp.text()\r\n    assert 'Hello, world' in text\r\n```\r\n\r\n```python-traceback\r\n$ pytest -k test_hello\r\n=========================================================================================================== test session starts ===========================================================================================================\r\nplatform darwin -- Python 3.8.0a1, pytest-4.2.0, py-1.7.0, pluggy-0.8.1\r\nrootdir: /Users/mariatta/python_github/bedevere, inifile: pytest.ini\r\nplugins: asyncio-0.10.0, aiohttp-0.3.0\r\ncollected 126 items / 125 deselected / 1 selected                                                                                                                                                                                         \r\n\r\ntests/test___main__.py F                                                                                                                                                                                                            [100%]\r\n\r\n================================================================================================================ FAILURES =================================================================================================================\r\n___________________________________________________________________________________________________________ test_hello[pyloop] ____________________________________________________________________________________________________________\r\n\r\naiohttp_client = <function aiohttp_client.<locals>.go at 0x103232040>\r\n\r\n    async def test_hello(aiohttp_client):\r\n        app = web.Application()\r\n        app.router.add_get('/', hello)\r\n        client = await aiohttp_client(app)\r\n>       resp = await client.get('/')\r\n\r\ntests/test___main__.py:51: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\nvenv/lib/python3.8/site-packages/aiohttp/test_utils.py:294: in request\r\n    resp = await self._session.request(\r\nvenv/lib/python3.8/site-packages/aiohttp/client.py:497: in _request\r\n    await resp.start(conn)\r\nvenv/lib/python3.8/site-packages/aiohttp/client_reqrep.py:844: in start\r\n    message, payload = await self._protocol.read()  # type: ignore  # noqa\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\n\r\nself = <aiohttp.client_proto.ResponseHandler object at 0x1034937d0>\r\n\r\n    async def read(self) -> _T:\r\n        if not self._buffer and not self._eof:\r\n            assert not self._waiter\r\n            self._waiter = self._loop.create_future()\r\n            try:\r\n>               await self._waiter\r\nE               aiohttp.client_exceptions.ClientOSError: [Errno 54] Connection reset by peer\r\n\r\nvenv/lib/python3.8/site-packages/aiohttp/streams.py:588: ClientOSError\r\n---------------------------------------------------------------------------------------------------------- Captured stderr call -----------------------------------------------------------------------------------------------------------\r\nException ignored in: <socket.socket fd=15, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 58013), raddr=('127.0.0.1', 58014)>\r\nResourceWarning: unclosed <socket.socket fd=15, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 58013), raddr=('127.0.0.1', 58014)>\r\n```\r\n\r\n\r\n## Your environment\r\n\r\nMac OS Mojave 10.14.3 Python 3.8.0a1.\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3606/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 1}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3606/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3603", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3603/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3603/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3603/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3603", "id": 408491321, "node_id": "MDU6SXNzdWU0MDg0OTEzMjE=", "number": 3603, "title": "Serving static files is broken with a directory under /", "user": {"login": "kccqzy", "id": 10167149, "node_id": "MDQ6VXNlcjEwMTY3MTQ5", "avatar_url": "https://avatars.githubusercontent.com/u/10167149?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kccqzy", "html_url": "https://github.com/kccqzy", "followers_url": "https://api.github.com/users/kccqzy/followers", "following_url": "https://api.github.com/users/kccqzy/following{/other_user}", "gists_url": "https://api.github.com/users/kccqzy/gists{/gist_id}", "starred_url": "https://api.github.com/users/kccqzy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kccqzy/subscriptions", "organizations_url": "https://api.github.com/users/kccqzy/orgs", "repos_url": "https://api.github.com/users/kccqzy/repos", "events_url": "https://api.github.com/users/kccqzy/events{/privacy}", "received_events_url": "https://api.github.com/users/kccqzy/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-02-10T01:54:20Z", "updated_at": "2020-11-23T17:23:25Z", "closed_at": "2020-11-23T17:23:25Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Long story short\r\n\r\nServing static files is a feature of `aiohttp` that can greatly make development more convenient. Unfortunately, the behavior is broken when the directory is a relative path AND `follow_symlinks` is False AND the current directory is `/`.\r\n\r\n## Expected behaviour\r\n\r\nAll static files could be served specified in the directory normally.\r\n\r\n## Actual behaviour\r\n\r\nNone of the static files could be served. `aiohttp` returns 404.\r\n\r\n## Steps to reproduce\r\n\r\nOn a Linux machine or container, prepare the following file called `serve.py` at the root of the file system\r\n\r\n```\r\nfrom aiohttp import web\r\napp = web.Application()\r\napp.add_routes([web.static('/ui', './ui')])\r\nweb.run_app(app)\r\n```\r\n\r\nCreate a file under the `/ui` directory, e.g. `mkdir /ui && echo Hello > /ui/a.txt`.\r\n\r\nUse `curl` or any HTTP client to fetch `localhost:8080/ui/a.txt`.\r\n\r\nI expect the file to be returned, but 404 is returned.\r\n\r\n### strace\r\n\r\nRunning it under `strace`, it uses `readlink(2)` on the file path. But the file is not a symlink. The Linux kernel returns EINVAL. \r\n\r\n### Relevant code\r\n\r\nThe relevant code causing the bug is here in `web_urldispatcher.py`:\r\n\r\n```\r\n    async def _handle(self, request: Request) -> StreamResponse:\r\n        rel_url = request.match_info['filename']\r\n        try:\r\n            filename = Path(rel_url)\r\n            if filename.anchor:\r\n                # rel_url is an absolute name like\r\n                # /static/\\\\machine_name\\c$ or /static/D:\\path\r\n                # where the static dir is totally different\r\n                raise HTTPForbidden()\r\n            filepath = self._directory.joinpath(filename).resolve()\r\n            if not self._follow_symlinks:\r\n                filepath.relative_to(self._directory)\r\n        except (ValueError, FileNotFoundError) as error:\r\n            # relatively safe\r\n            raise HTTPNotFound() from error\r\n        except HTTPForbidden:\r\n            raise\r\n        except Exception as error:\r\n            # perm error or other kind!\r\n            request.app.logger.exception(error)\r\n            raise HTTPNotFound() from error\r\n```\r\n\r\nWhen the `self._follow_symlinks` is False, it calls ` filepath.relative_to(self._directory)` which raises a `ValueError`. Indeed I have confirmed that `self._directory` starts with two slashes. Here's why there are two slashes:\r\n\r\n```\r\n>>> import pathlib, os\r\n>>> os.chdir('/')\r\n>>> pathlib.Path('./ui').resolve()\r\nPosixPath('//ui')\r\n```\r\n\r\nSince there are two slashes, the call to `relative_to` then raises an exception, which gets interpreted as a non-existent file. \r\n\r\n\r\n## Your environment\r\n\r\n* Debian Linux (stretch)\r\n* aiohttp-3.5.4", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3603/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3603/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3601", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3601/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3601/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3601/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3601", "id": 407840234, "node_id": "MDU6SXNzdWU0MDc4NDAyMzQ=", "number": 3601, "title": "Cannot send GET request with url-encode", "user": {"login": "ZeroTworu", "id": 17995677, "node_id": "MDQ6VXNlcjE3OTk1Njc3", "avatar_url": "https://avatars.githubusercontent.com/u/17995677?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ZeroTworu", "html_url": "https://github.com/ZeroTworu", "followers_url": "https://api.github.com/users/ZeroTworu/followers", "following_url": "https://api.github.com/users/ZeroTworu/following{/other_user}", "gists_url": "https://api.github.com/users/ZeroTworu/gists{/gist_id}", "starred_url": "https://api.github.com/users/ZeroTworu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ZeroTworu/subscriptions", "organizations_url": "https://api.github.com/users/ZeroTworu/orgs", "repos_url": "https://api.github.com/users/ZeroTworu/repos", "events_url": "https://api.github.com/users/ZeroTworu/events{/privacy}", "received_events_url": "https://api.github.com/users/ZeroTworu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-02-07T18:38:29Z", "updated_at": "2020-02-14T03:32:04Z", "closed_at": "2019-02-14T03:19:00Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "Request string before 359 client.py\r\n![default](https://user-images.githubusercontent.com/17995677/52434449-26736780-2b31-11e9-8d10-01c140ea0c84.png)\r\nAnd after 369 i see\r\n![default](https://user-images.githubusercontent.com/17995677/52434526-5ae72380-2b31-11e9-952f-ed1cf26e73ae.png)\r\nHow this work?\r\ninb4: i read docs, and see sources", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3601/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3601/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3599", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3599/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3599/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3599/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3599", "id": 407668700, "node_id": "MDU6SXNzdWU0MDc2Njg3MDA=", "number": 3599, "title": "Bump trustme dep to v0.5.0", "user": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 58986077, "node_id": "MDU6TGFiZWw1ODk4NjA3Nw==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/enhancement", "name": "enhancement", "color": "84b6eb", "default": true, "description": null}, {"id": 731921232, "node_id": "MDU6TGFiZWw3MzE5MjEyMzI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/infra", "name": "infra", "color": "e55e5b", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2019-02-07T12:08:31Z", "updated_at": "2020-02-14T14:26:40Z", "closed_at": "2019-02-14T12:50:25Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nRevert #3506 and bump dep to `trustme==0.5.0`.\r\nRef: python-trio/trustme#41 && python-trio/trustme#42\r\n\r\n## Expected behaviour\r\n\r\nlinux32 tests will be green and release flow will be unblocked\r\n\r\n## Actual behaviour\r\n\r\nlinux32 manulinux1 image tests traceback\r\n\r\n## Steps to reproduce\r\n\r\nN/A\r\n\r\n## Your environment\r\n\r\ndocker manylinux1_i686 linux32", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3599/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3599/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3598", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3598/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3598/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3598/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3598", "id": 407622830, "node_id": "MDU6SXNzdWU0MDc2MjI4MzA=", "number": 3598, "title": "Counting bytes in a forwarded stream ", "user": {"login": "drtpotter", "id": 20216405, "node_id": "MDQ6VXNlcjIwMjE2NDA1", "avatar_url": "https://avatars.githubusercontent.com/u/20216405?v=4", "gravatar_id": "", "url": "https://api.github.com/users/drtpotter", "html_url": "https://github.com/drtpotter", "followers_url": "https://api.github.com/users/drtpotter/followers", "following_url": "https://api.github.com/users/drtpotter/following{/other_user}", "gists_url": "https://api.github.com/users/drtpotter/gists{/gist_id}", "starred_url": "https://api.github.com/users/drtpotter/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/drtpotter/subscriptions", "organizations_url": "https://api.github.com/users/drtpotter/orgs", "repos_url": "https://api.github.com/users/drtpotter/repos", "events_url": "https://api.github.com/users/drtpotter/events{/privacy}", "received_events_url": "https://api.github.com/users/drtpotter/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2019-02-07T10:09:33Z", "updated_at": "2022-04-01T02:34:03Z", "closed_at": "2022-04-01T02:34:03Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi there,\r\n\r\nIn the [documentation](https://docs.aiohttp.org/en/stable/client_quickstart.html?highlight=complex%20file%20upload) I see that I can open a connection from one source and pass the content to another stream as follows:\r\n\r\nresp = await session.get('http://python.org')\r\nawait session.post('http://httpbin.org/post', data=resp.content)\r\n\r\nIn my implementation of this I will be forwarding streams of potentially very large files with unknown length. I need to be able to count the bytes that is transferred in resp.content without dumping resp.content to a local file. How can I do this?\r\n\r\nThankyou in advance! \r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3598/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3598/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3597", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3597/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3597/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3597/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3597", "id": 407437980, "node_id": "MDU6SXNzdWU0MDc0Mzc5ODA=", "number": 3597, "title": "ServerDisconnectedError if view don't read POST body", "user": {"login": "Cykooz", "id": 163725, "node_id": "MDQ6VXNlcjE2MzcyNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/163725?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Cykooz", "html_url": "https://github.com/Cykooz", "followers_url": "https://api.github.com/users/Cykooz/followers", "following_url": "https://api.github.com/users/Cykooz/following{/other_user}", "gists_url": "https://api.github.com/users/Cykooz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Cykooz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Cykooz/subscriptions", "organizations_url": "https://api.github.com/users/Cykooz/orgs", "repos_url": "https://api.github.com/users/Cykooz/repos", "events_url": "https://api.github.com/users/Cykooz/events{/privacy}", "received_events_url": "https://api.github.com/users/Cykooz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2019-02-06T21:26:31Z", "updated_at": "2020-11-23T17:24:21Z", "closed_at": "2020-11-23T17:24:21Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "## Long story short\r\n\r\nIf I use `ClientSession` with persistent connection (keep-alive) and sends two POST-requests with form-data that contains a file represented as `io.BytesIO()`, and `web.Application()` don't reads body of  request, then second client's request fails with exception `ServerDisconnectedError`.\r\n\r\n## Steps to reproduce\r\n\r\nShot example to reproduce the problem:\r\n```python\r\nimport asyncio\r\nfrom io import BytesIO\r\n\r\nfrom aiohttp import FormData, web\r\nfrom aiohttp.test_utils import TestServer, TestClient\r\n\r\n\r\nasync def view(request):\r\n    return web.Response(body=b'')\r\n\r\n\r\nasync def test_example():\r\n    app = web.Application()\r\n    app.router.add_post('/', view)\r\n    async with TestClient(TestServer(app)) as client:\r\n        for i in range(3):\r\n            print(f'Send request {i + 1}')\r\n            form_data = FormData([('file', BytesIO(b'*'))])\r\n            res = await client.post('/', data=form_data)\r\n            assert res.status == 200\r\n        print('Done')\r\n\r\n\r\nasyncio.run(test_example())\r\n```\r\n```\r\n$ python3.7 example.py\r\nSend request 1\r\nSend request 2\r\nTraceback (most recent call last):\r\n  File \"example.py\", line 28, in <module>\r\n    asyncio.run(test_example())\r\n  File \"/usr/lib/python3.7/asyncio/runners.py\", line 43, in run\r\n    return loop.run_until_complete(main)\r\n  File \"/usr/lib/python3.7/asyncio/base_events.py\", line 573, in run_until_complete\r\n    return future.result()\r\n  File \"test_example.py\", line 23, in test_example\r\n    res = await client.post('/', data=form_data)\r\n  File \"/home/cykooz/buildout-eggs/cp37m/aiohttp-3.5.4-py3.7-linux-x86_64.egg/aiohttp/test_utils.py\", line 295, in request\r\n    method, self.make_url(path), **kwargs\r\n  File \"/home/cykooz/buildout-eggs/cp37m/aiohttp-3.5.4-py3.7-linux-x86_64.egg/aiohttp/client.py\", line 497, in _request\r\n    await resp.start(conn)\r\n  File \"/home/cykooz/buildout-eggs/cp37m/aiohttp-3.5.4-py3.7-linux-x86_64.egg/aiohttp/client_reqrep.py\", line 844, in start\r\n    message, payload = await self._protocol.read()  # type: ignore  # noqa\r\n  File \"/home/cykooz/buildout-eggs/cp37m/aiohttp-3.5.4-py3.7-linux-x86_64.egg/aiohttp/streams.py\", line 588, in read\r\n    await self._waiter\r\naiohttp.client_exceptions.ServerDisconnectedError: None\r\n```\r\n\r\n## Your environment\r\n\r\nUbuntu 18.04\r\nPython 3.7.1\r\naiohttp 3.5.4\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3597/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3597/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3596", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3596/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3596/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3596/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/3596", "id": 407033692, "node_id": "MDExOlB1bGxSZXF1ZXN0MjUwNTk5MjI1", "number": 3596, "title": "Fix type hint for tracing Signal sequence content", "user": {"login": "stj", "id": 66305, "node_id": "MDQ6VXNlcjY2MzA1", "avatar_url": "https://avatars.githubusercontent.com/u/66305?v=4", "gravatar_id": "", "url": "https://api.github.com/users/stj", "html_url": "https://github.com/stj", "followers_url": "https://api.github.com/users/stj/followers", "following_url": "https://api.github.com/users/stj/following{/other_user}", "gists_url": "https://api.github.com/users/stj/gists{/gist_id}", "starred_url": "https://api.github.com/users/stj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/stj/subscriptions", "organizations_url": "https://api.github.com/users/stj/orgs", "repos_url": "https://api.github.com/users/stj/repos", "events_url": "https://api.github.com/users/stj/events{/privacy}", "received_events_url": "https://api.github.com/users/stj/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 58986077, "node_id": "MDU6TGFiZWw1ODk4NjA3Nw==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/enhancement", "name": "enhancement", "color": "84b6eb", "default": true, "description": null}, {"id": 731921232, "node_id": "MDU6TGFiZWw3MzE5MjEyMzI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/infra", "name": "infra", "color": "e55e5b", "default": false, "description": null}, {"id": 1472801557, "node_id": "MDU6TGFiZWwxNDcyODAxNTU3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bot:chronographer:provided", "name": "bot:chronographer:provided", "color": "ededed", "default": false, "description": "There is a change note present in this PR"}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 6, "created_at": "2019-02-06T00:27:29Z", "updated_at": "2020-05-20T23:14:45Z", "closed_at": "2019-05-08T18:37:42Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/3596", "html_url": "https://github.com/aio-libs/aiohttp/pull/3596", "diff_url": "https://github.com/aio-libs/aiohttp/pull/3596.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/3596.patch", "merged_at": "2019-05-08T18:37:42Z"}, "body": "The Signal is instantiated with a TraceConfig object but does not store\r\nit in its mutable sequence. Fixed hinting to reflect what is expected to\r\nbe added as signal handler.\r\n\r\n<!-- Thank you for your contribution! -->\r\n\r\n## What do these changes do?\r\n\r\nFix type hint for tracing Signal contents. They got very long with the last argument being a `Union`, maybe an `Any` would do instead?\r\n\r\n## Are there changes in behavior for the user?\r\n\r\nmypy does not report an error of\r\n```error: List item 0 has incompatible type \"Callable[[ClientSession, SimpleNamespace, TraceConnectionCreateEndParams], Coroutine[Any, Any, None]]\"; expected \"Callable[[TraceConfig], Awaitable[None]]\"```\r\n\r\n## Related issue number\r\n\r\n#3595\r\n\r\n## Checklist\r\n\r\n- [ ] I think the code is well written\r\n- [ ] Unit tests for the changes exist\r\n- [ ] Documentation reflects the changes\r\n- [ ] If you provide code modification, please add yourself to `CONTRIBUTORS.txt`\r\n- [x] Add a new news fragment into the `CHANGES` folder\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3596/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3596/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3595", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3595/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3595/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3595/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3595", "id": 407033531, "node_id": "MDU6SXNzdWU0MDcwMzM1MzE=", "number": 3595, "title": "Wrong type hint for tracing Signal sequence", "user": {"login": "stj", "id": 66305, "node_id": "MDQ6VXNlcjY2MzA1", "avatar_url": "https://avatars.githubusercontent.com/u/66305?v=4", "gravatar_id": "", "url": "https://api.github.com/users/stj", "html_url": "https://github.com/stj", "followers_url": "https://api.github.com/users/stj/followers", "following_url": "https://api.github.com/users/stj/following{/other_user}", "gists_url": "https://api.github.com/users/stj/gists{/gist_id}", "starred_url": "https://api.github.com/users/stj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/stj/subscriptions", "organizations_url": "https://api.github.com/users/stj/orgs", "repos_url": "https://api.github.com/users/stj/repos", "events_url": "https://api.github.com/users/stj/events{/privacy}", "received_events_url": "https://api.github.com/users/stj/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-02-06T00:26:46Z", "updated_at": "2020-10-22T07:28:39Z", "closed_at": "2020-10-22T07:28:38Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## Long story short\r\n\r\nType hints for tracing Signal contents look wrong.\r\n\r\n## Expected behaviour\r\n\r\nmypy does not report an error when adding handlers to a signal object.\r\n\r\n## Actual behaviour\r\n\r\nmypy reports an error of\r\n```bash\r\nerror: List item 0 has incompatible type \"Callable[[ClientSession, SimpleNamespace, TraceConnectionCreateEndParams], Coroutine[Any, Any, None]]\"; expected \"Callable[[TraceConfig], Awaitable[None]]\"\r\n```\r\n\r\n## Steps to reproduce\r\n\r\nRun mypy over this snippet\r\n```python\r\nimport types\r\n\r\nimport aiohttp\r\nimport datadog\r\n\r\nasync def reuse_keepalive_connection(\r\n    session: aiohttp.ClientSession,\r\n    trace_config_ctx: types.SimpleNamespace,\r\n    params: aiohttp.TraceConnectionReuseconnParams,\r\n) -> None:\r\n    \"\"\"statsd counter; how often has a connection been reused\"\"\"\r\n    datadog.statsd.increment(\"client.request.connection.reuse\")\r\n\r\ntracer = aiohttp.TraceConfig()\r\ntracer.on_connection_reuseconn.extend([reuse_keepalive_connection])\r\n```\r\n\r\n## Your environment\r\n\r\naiohttp 3.5.4\r\npython 3.7.2\r\nmypy 0.660\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3595/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3595/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3584", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3584/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3584/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3584/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3584", "id": 404153898, "node_id": "MDU6SXNzdWU0MDQxNTM4OTg=", "number": 3584, "title": "Unable to install dev requirements", "user": {"login": "modelmat", "id": 25718989, "node_id": "MDQ6VXNlcjI1NzE4OTg5", "avatar_url": "https://avatars.githubusercontent.com/u/25718989?v=4", "gravatar_id": "", "url": "https://api.github.com/users/modelmat", "html_url": "https://github.com/modelmat", "followers_url": "https://api.github.com/users/modelmat/followers", "following_url": "https://api.github.com/users/modelmat/following{/other_user}", "gists_url": "https://api.github.com/users/modelmat/gists{/gist_id}", "starred_url": "https://api.github.com/users/modelmat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/modelmat/subscriptions", "organizations_url": "https://api.github.com/users/modelmat/orgs", "repos_url": "https://api.github.com/users/modelmat/repos", "events_url": "https://api.github.com/users/modelmat/events{/privacy}", "received_events_url": "https://api.github.com/users/modelmat/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-01-29T07:19:34Z", "updated_at": "2020-01-29T10:21:05Z", "closed_at": "2019-01-29T08:12:35Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\nFor some reason I am unable to install the dev requirements, as the `pip install -e .` command executed by them fails with this code:\r\n```py\r\nif (here / '.git').exists() and not USE_CYTHON:\r\n    print(\"Install cython when building from git clone\", file=sys.stderr)\r\n    print(\"Hint:\", file=sys.stderr)\r\n    print(\"  pip install cython\", file=sys.stderr)\r\n    sys.exit(1)\r\n```\r\nYet, opening the python terminal and typing `from Cython.Build import cythonize` works just fine, and `pip freeze` shows `Cython==0.29.2`. This makes me unable to run any tests. Commenting out these lines results in a fully working pip install & `make test`.\r\n\r\n## Expected behaviour\r\n\r\nInstalls fine.\r\n\r\n## Actual behaviour\r\nI receive this error.\r\n```\r\n  Installing build dependencies ... done\r\n  Getting requirements to build wheel ... error\r\n  Complete output from command \"/home/modelmat/Documents/GitHub Projects/aiohttp/venv/bin/python3\" \"/home/modelmat/Documents/GitHub Projects/aiohttp/venv/lib/python3.7/site-packages/pip/_vendor/pep517/_in_process.py\" get_requires_for_build_wheel /tmp/tmpqx4ffm0k:\r\n  Install cython when building from git clone\r\n  Hint:\r\n    pip install cython\r\n```\r\n\r\n\r\n## Steps to reproduce\r\nFollow the exact steps as shown in CONTRIBUTING.md.\r\n\r\n## Your environment\r\naiohttp: `c145bd8416b1edb11214254e07013f92d91b6537`\r\nuname -a: `Linux desktop 4.20.0-arch1-1-ARCH #1 SMP PREEMPT Mon Dec 24 03:00:40 UTC 2018 x86_64 GNU/Linux`", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3584/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3584/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3581", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3581/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3581/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3581/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3581", "id": 403690185, "node_id": "MDU6SXNzdWU0MDM2OTAxODU=", "number": 3581, "title": "sdist build gets crashed under pip>=19 in dev mode", "user": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 731921232, "node_id": "MDU6TGFiZWw3MzE5MjEyMzI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/infra", "name": "infra", "color": "e55e5b", "default": false, "description": null}, {"id": 743514498, "node_id": "MDU6TGFiZWw3NDM1MTQ0OTg=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/meta", "name": "meta", "color": "ccf794", "default": false, "description": null}, {"id": 1363889009, "node_id": "MDU6TGFiZWwxMzYzODg5MDA5", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/pr-rejected", "name": "pr-rejected", "color": "363396", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2019-01-28T08:01:46Z", "updated_at": "2019-07-19T13:42:47Z", "closed_at": "2019-05-10T06:17:10Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "## Long story short\r\n\r\nWe have `cython` as an optional dependency. That's why we install it as a pre-requisite in the CI, as a separate step.\r\nNew pip creates a separate build virtualenv which doesn't have access to the place with cython installed which causes it to crash.\r\n\r\n## Expected behaviour\r\n\r\nIt succeeds\r\n\r\n## Actual behaviour\r\n\r\nIt tracebacks\r\n\r\n## Steps to reproduce\r\n\r\n* https://travis-ci.com/aio-libs/aiohttp/jobs/172249543#L198-L219\r\n* https://ci.appveyor.com/project/aio-libs/aiohttp/build/job/uppd0qqw2sbisqtn#L46\r\n\r\n## Your environment\r\n\r\nTravis CI (doesn't really matter actually)", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3581/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3581/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3578", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3578/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3578/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3578/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3578", "id": 402960727, "node_id": "MDU6SXNzdWU0MDI5NjA3Mjc=", "number": 3578, "title": "normalize_path_middleware uses 301 redirect", "user": {"login": "dtkav", "id": 610121, "node_id": "MDQ6VXNlcjYxMDEyMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/610121?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtkav", "html_url": "https://github.com/dtkav", "followers_url": "https://api.github.com/users/dtkav/followers", "following_url": "https://api.github.com/users/dtkav/following{/other_user}", "gists_url": "https://api.github.com/users/dtkav/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtkav/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtkav/subscriptions", "organizations_url": "https://api.github.com/users/dtkav/orgs", "repos_url": "https://api.github.com/users/dtkav/repos", "events_url": "https://api.github.com/users/dtkav/events{/privacy}", "received_events_url": "https://api.github.com/users/dtkav/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-01-25T00:56:24Z", "updated_at": "2020-06-24T20:51:07Z", "closed_at": "2019-06-11T11:11:36Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "## Long story short\r\nThe normalize_path_middleware in default configuration returns a 301 redirect to append a slash like so:\r\n`POST /api/v0/data/` -> `{\"some\": \"data\"}`\r\n`POST /api/v0/data` -> `301 /api/v0/data/`\r\n\r\nIf a client tries to `POST` some data to the endpoint without the trailing slash, then a redirect will take place and it will become a `GET` request. This is due to client implementations of `301`, `302`, and `303` redirects.\r\n\r\nThe `308` redirect introduced in https://tools.ietf.org/html/rfc7538 works around this problem, as it forbids clients from changing the method on redirect.\r\n\r\n`308` redirect in the aiohttp client was added in #2134\r\n\r\n## Expected behaviour\r\n\r\nFollowing a trailing slash redirect should still work with POST/PUT methods.\r\nTrailing slash redirect should be a 308 redirect.\r\n\r\nFor comparison, werkzeug uses a 308 redirect for `strict_slashes` https://github.com/pallets/werkzeug/blob/master/werkzeug/routing.py#L227\r\n\r\nrelevant werkzeug PR: https://github.com/pallets/werkzeug/commit/fd6eb30574c1586c80a6de53602739d6f8c1c211\r\n\r\n## Actual behaviour\r\n\r\n301 redirect is returned, causing the aiohttp client to send a GET request instead of the intended POST request with data.\r\nThis behavior is also seen with requests and curl (although slightly different).\r\n\r\n## Steps to reproduce\r\nserver\r\n``` python\r\nfrom aiohttp import web\r\nfrom aiohttp.web_middlewares import normalize_path_middleware\r\n\r\nasync def handle(request):\r\n    try:\r\n        j = await request.json()\r\n    except Exception:\r\n        return web.json_response({\"error\": f\"no data from {request.method}\"})\r\n    return web.json_response(j)\r\n\r\ntrailing_slash_redirect = normalize_path_middleware(append_slash=True)\r\napp = web.Application(middlewares=[trailing_slash_redirect])\r\napp.add_routes([web.post('/data/', handle),\r\n                web.get('/data/', handle)])\r\n\r\nweb.run_app(app)\r\n\r\n```\r\nserver test with  `curl -X POST`\r\n``` bash\r\ncurl -v -L -H 'Content-Type: application/json' -X POST localhost:8080/data -d '{\"echo\": \"me\"}'\r\nNote: Unnecessary use of -X or --request, POST is already inferred.\r\n*   Trying 127.0.0.1...\r\n* TCP_NODELAY set\r\n* Connected to localhost (127.0.0.1) port 8080 (#0)\r\n> POST /data HTTP/1.1\r\n> Host: localhost:8080\r\n> User-Agent: curl/7.58.0\r\n> Accept: */*\r\n> Content-Type: application/json\r\n> Content-Length: 14\r\n> \r\n* upload completely sent off: 14 out of 14 bytes\r\n< HTTP/1.1 301 Moved Permanently\r\n< Content-Type: text/plain; charset=utf-8\r\n< Location: /data/\r\n< Content-Length: 22\r\n< Date: Fri, 25 Jan 2019 00:39:26 GMT\r\n< Server: Python/3.6 aiohttp/3.5.4\r\n< \r\n* Ignoring the response-body\r\n* Connection #0 to host localhost left intact\r\n* Issue another request to this URL: 'http://localhost:8080/data/'\r\n* Switch from POST to GET\r\n* Found bundle for host localhost: 0x559b853e36a0 [can pipeline]\r\n* Re-using existing connection! (#0) with host localhost\r\n* Connected to localhost (127.0.0.1) port 8080 (#0)\r\n> POST /data/ HTTP/1.1\r\n> Host: localhost:8080\r\n> User-Agent: curl/7.58.0\r\n> Accept: */*\r\n> Content-Type: application/json\r\n> \r\n< HTTP/1.1 200 OK\r\n< Content-Type: application/json; charset=utf-8\r\n< Content-Length: 30\r\n< Date: Fri, 25 Jan 2019 00:39:26 GMT\r\n< Server: Python/3.6 aiohttp/3.5.4\r\n< \r\n* Connection #0 to host localhost left intact\r\n{\"error\": \"no data from POST\"}\r\n```\r\n\r\nserver test with `curl  --post301`:\r\n``` bash\r\ncurl -v -L -H 'Content-Type: application/json' --post301 localhost:8080/data -d '{\"echo\": \"me\"}'\r\n*   Trying 127.0.0.1...\r\n* TCP_NODELAY set\r\n* Connected to localhost (127.0.0.1) port 8080 (#0)\r\n> POST /data HTTP/1.1\r\n> Host: localhost:8080\r\n> User-Agent: curl/7.58.0\r\n> Accept: */*\r\n> Content-Type: application/json\r\n> Content-Length: 14\r\n> \r\n* upload completely sent off: 14 out of 14 bytes\r\n< HTTP/1.1 301 Moved Permanently\r\n< Content-Type: text/plain; charset=utf-8\r\n< Location: /data/\r\n< Content-Length: 22\r\n< Date: Thu, 24 Jan 2019 10:52:26 GMT\r\n< Server: Python/3.6 aiohttp/3.5.4\r\n< \r\n* Ignoring the response-body\r\n* Connection #0 to host localhost left intact\r\n* Issue another request to this URL: 'http://localhost:8080/data/'\r\n* Found bundle for host localhost: 0x56164d97d6a0 [can pipeline]\r\n* Re-using existing connection! (#0) with host localhost\r\n* Connected to localhost (127.0.0.1) port 8080 (#0)\r\n> POST /data/ HTTP/1.1\r\n> Host: localhost:8080\r\n> User-Agent: curl/7.58.0\r\n> Accept: */*\r\n> Content-Type: application/json\r\n> Content-Length: 14\r\n> \r\n* upload completely sent off: 14 out of 14 bytes\r\n< HTTP/1.1 200 OK\r\n< Content-Type: application/json; charset=utf-8\r\n< Content-Length: 14\r\n< Date: Thu, 24 Jan 2019 10:52:26 GMT\r\n< Server: Python/3.6 aiohttp/3.5.4\r\n< \r\n* Connection #0 to host localhost left intact\r\n{\"echo\": \"me\"}\r\n```\r\n\r\naiohttp client test\r\n``` python\r\nimport aiohttp\r\nimport asyncio\r\n\r\n\r\nasync def main():\r\n    async with aiohttp.ClientSession() as session:\r\n        url = 'http://localhost:8080/data'\r\n        response = await session.post(url, data=b'{\"echo\": \"me\"}')\r\n        print(url, await response.text())\r\n        url += '/'\r\n        response = await session.post(url, data=b'{\"echo\": \"me\"}')\r\n        print(url, await response.text())\r\n\r\nloop = asyncio.get_event_loop()\r\nloop.run_until_complete(main())\r\n\r\n```\r\noutput\r\n```\r\nhttp://localhost:8080/data {\"error\": \"no data from GET\"}\r\nhttp://localhost:8080/data/ {\"echo\": \"me\"}\r\n```\r\n\r\n## Your environment\r\nLinux, Python 3.6.7, aiohttp 3.5.4 client\r\n\r\npip freeze\r\n```\r\naiohttp==3.5.4\r\nasync-timeout==3.0.1\r\nattrs==18.2.0\r\nchardet==3.0.4\r\nidna==2.8\r\nidna-ssl==1.1.0\r\nmultidict==4.5.2\r\npkg-resources==0.0.0\r\ntyping-extensions==3.7.2\r\nyarl==1.3.0\r\n```\r\n\r\npython --version\r\n```\r\nPython 3.6.7\r\n```", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3578/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3578/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3573", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3573/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3573/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3573/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3573", "id": 402022573, "node_id": "MDU6SXNzdWU0MDIwMjI1NzM=", "number": 3573, "title": "custom DNS server with aiodns got err: ot Future <Future pending> attached to a different loop", "user": {"login": "gainskills", "id": 1937472, "node_id": "MDQ6VXNlcjE5Mzc0NzI=", "avatar_url": "https://avatars.githubusercontent.com/u/1937472?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gainskills", "html_url": "https://github.com/gainskills", "followers_url": "https://api.github.com/users/gainskills/followers", "following_url": "https://api.github.com/users/gainskills/following{/other_user}", "gists_url": "https://api.github.com/users/gainskills/gists{/gist_id}", "starred_url": "https://api.github.com/users/gainskills/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gainskills/subscriptions", "organizations_url": "https://api.github.com/users/gainskills/orgs", "repos_url": "https://api.github.com/users/gainskills/repos", "events_url": "https://api.github.com/users/gainskills/events{/privacy}", "received_events_url": "https://api.github.com/users/gainskills/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 58986078, "node_id": "MDU6TGFiZWw1ODk4NjA3OA==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/invalid", "name": "invalid", "color": "e4e669", "default": true, "description": "This doesn't seem right"}, {"id": 344995986, "node_id": "MDU6TGFiZWwzNDQ5OTU5ODY=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/client", "name": "client", "color": "bfd4f2", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2019-01-23T01:01:31Z", "updated_at": "2020-01-23T13:48:35Z", "closed_at": "2019-01-23T13:35:54Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n<!-- Please describe your problem and why the fix is important. -->\r\n\r\naiohttp doesn't work with custom DNS Server.\r\n\r\n<!-- What is the behaviour you expect? -->\r\nThe DNS Resolver should works without error\r\n\r\n<!-- What's actually happening? -->\r\nWith the error:\r\n\r\n```\r\n/aiohttp-1.py:38: DeprecationWarning: The object should be created from async function\r\n  resolver = AsyncResolver(nameservers=[\"114.114.114.114\"])\r\n/aiohttp-1.py:41: DeprecationWarning: verify_ssl is deprecated, use ssl=False instead\r\n  async with aiohttp.ClientSession(connector=aiohttp.TCPConnector(verify_ssl=False, use_dns_cache=False, resolver=resolver)) assession:\r\nTraceback (most recent call last):\r\n  File \"/aiohttp-1.py\", line 51, in <module>\r\n    asyncio.run(dnstesting())\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/asyncio/runners.py\", line 43, in run\r\n    return loop.run_until_complete(main)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/asyncio/base_events.py\", line 584, in run_until_complete\r\n    return future.result()\r\n  File \"/aiohttp-1.py\", line 42, in dnstesting\r\n    r = await session.get(\"http://google.com\")\r\n  File \"/pyvenvs/aiohttp/venv/lib/python3.7/site-packages/aiohttp/client.py\", line 476, in _request\r\n    timeout=real_timeout\r\n  File \"/pyvenvs/aiohttp/venv/lib/python3.7/site-packages/aiohttp/connector.py\", line 522, in connect\r\n    proto = await self._create_connection(req, traces, timeout)\r\n  File \"/pyvenvs/aiohttp/venv/lib/python3.7/site-packages/aiohttp/connector.py\", line 854, in _create_connection\r\n    req, traces, timeout)\r\n  File \"/pyvenvs/aiohttp/venv/lib/python3.7/site-packages/aiohttp/connector.py\", line 955, in _create_d/aiohttp-1.py:38: DeprecationWarning: The object should be created from async function\r\n  resolver = AsyncResolver(nameservers=[\"114.114.114.114\"])\r\n/aiohttp-1.py:41: DeprecationWarning: verify_ssl is deprecated, use ssl=False instead\r\n  async with aiohttp.ClientSession(connector=aiohttp.TCPConnector(verify_ssl=False, use_dns_cache=False, resolver=resolver)) assession:\r\nTraceback (most recent call last):\r\n  File \"/aiohttp-1.py\", line 51, in <module>\r\n    asyncio.run(dnstesting())\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/asyncio/runners.py\", line 43, in run\r\n    return loop.run_until_complete(main)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/asyncio/base_events.py\", line 584, in run_until_complete\r\n    return future.result()\r\n  File \"/aiohttp-1.py\", line 42, in dnstesting\r\n    r = await session.get(\"http://google.com\")\r\n  File \"/pyvenvs/aiohttp/venv/lib/python3.7/site-packages/aiohttp/client.py\", line 476, in _request\r\n    timeout=real_timeout\r\n  File \"/pyvenvs/aiohttp/venv/lib/python3.7/site-packages/aiohttp/connector.py\", line 522, in connect\r\n    proto = await self._create_connection(req, traces, timeout)\r\n  File \"/pyvenvs/aiohttp/venv/lib/python3.7/site-packages/aiohttp/connector.py\", line 854, in _create_connection\r\n    req, traces, timeout)\r\n  File \"/pyvenvs/aiohttp/venv/lib/python3.7/site-packages/aiohttp/connector.py\", line 955, in _create_direct_connection\r\n    traces=traces), loop=self._loop)\r\n  File \"/pyvenvs/aiohttp/venv/lib/python3.7/site-packages/aiohttp/connector.py\", line 788, in _resolve_host\r\n    host, port, family=self._family))\r\n  File \"/pyvenvs/aiohttp/venv/lib/python3.7/site-packages/aiohttp/resolver.py\", line 64, in resolve\r\n    resp = await self._resolver.gethostbyname(host, family)\r\nRuntimeError: Task <Task pending coro=<TCPConnector._resolve_host() running at /pyvenvs/aiohttp/venv/lib/python3.7/site-packages/aiohttp/connector.py:788> cb=[shield.<locals>._done_callback() at /Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/asyncio/tasks.py:776]> got Future <Future pending> attached to a different loop\r\npython3(38437,0x107b185c0) malloc: *** error for object 0x9000000000000000: pointer being freed was not allocated\r\npython3(38437,0x107b185c0) malloc: *** set a breakpoint in malloc_error_break to debug\r\nAbort trap: 6irect_connection\r\n    traces=traces), loop=self._loop)\r\n  File \"/pyvenvs/aiohttp/venv/lib/python3.7/site-packages/aiohttp/connector.py\", line 788, in _resolve_host\r\n    host, port, family=self._family))\r\n  File \"/pyvenvs/aiohttp/venv/lib/python3.7/site-packages/aiohttp/resolver.py\", line 64, in resolve\r\n    resp = await self._resolver.gethostbyname(host, family)\r\nRuntimeError: Task <Task pending coro=<TCPConnector._resolve_host() running at /pyvenvs/aiohttp/venv/lib/python3.7/site-packages/aiohttp/connector.py:788> cb=[shield.<locals>._done_callback() at /Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/asyncio/tasks.py:776]> got Future <Future pending> attached to a different loop\r\npython3(38437,0x107b185c0) malloc: *** error for object 0x9000000000000000: pointer being freed was not allocated\r\npython3(38437,0x107b185c0) malloc: *** set a breakpoint in malloc_error_break to debug\r\nAbort trap: 6\r\n```\r\n\r\n## Steps to reproduce\r\n<!-- Please describe steps to reproduce the issue.\r\n     If you have a script that does that please include it here within\r\n     markdown code markup -->\r\n\r\nRun the code:\r\n\r\n```\r\nimport aiohttp\r\nfrom aiohttp.resolver import AsyncResolver\r\n\r\nresolver = AsyncResolver(nameservers=[\"114.114.114.114\"])\r\n\r\nasync def dnstesting():\r\n    async with aiohttp.ClientSession(connector=aiohttp.TCPConnector(verify_ssl=False, use_dns_cache=False, resolver=resolver)) as session:\r\n        r = await session.get(\"http://google.com\")\r\n        print(r.header)\r\n\r\nasyncio.run(dnstesting())\r\n```\r\n\r\n## Your environment\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case. \r\n     \r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\n\r\nHere are the packages I'm using:\r\nPackage       Version\r\n------------- -------\r\naiohttp       3.5.4\r\naiodns       2.0.0b0\r\nasync-timeout 3.0.1\r\nattrs         18.2.0\r\ncffi          1.11.5\r\nchardet       3.0.4\r\nidna          2.8\r\nmultidict     4.5.2\r\npip           18.1\r\npycares       3.0.0b2\r\npycparser     2.19\r\nsetuptools    40.6.3\r\ntyping        3.6.6\r\nwheel         0.32.3\r\nyarl          1.3.0\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3573/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3573/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3571", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3571/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3571/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3571/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3571", "id": 401862806, "node_id": "MDU6SXNzdWU0MDE4NjI4MDY=", "number": 3571, "title": "[SOLVED] How to send files and data in the same request", "user": {"login": "sevaho", "id": 10941956, "node_id": "MDQ6VXNlcjEwOTQxOTU2", "avatar_url": "https://avatars.githubusercontent.com/u/10941956?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sevaho", "html_url": "https://github.com/sevaho", "followers_url": "https://api.github.com/users/sevaho/followers", "following_url": "https://api.github.com/users/sevaho/following{/other_user}", "gists_url": "https://api.github.com/users/sevaho/gists{/gist_id}", "starred_url": "https://api.github.com/users/sevaho/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sevaho/subscriptions", "organizations_url": "https://api.github.com/users/sevaho/orgs", "repos_url": "https://api.github.com/users/sevaho/repos", "events_url": "https://api.github.com/users/sevaho/events{/privacy}", "received_events_url": "https://api.github.com/users/sevaho/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2019-01-22T17:03:13Z", "updated_at": "2020-02-03T18:17:39Z", "closed_at": "2019-02-03T16:27:35Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nI want to send files (binary data) and json data in the same request but failing to grasp the documentation or see any examples in github issues.\r\n\r\n## Expected behaviour\r\n\r\nSend file(s) and post data\r\n\r\n## Actual behaviour\r\n\r\nIt doesn't seem to include post parameters\r\n\r\n## Steps to reproduce\r\n\r\n```python\r\nattachment = open(\"/tmp/some.pdf\", \"rb\")\r\n\r\nmailgun_data = {\r\n    \"from\": \"test@test.com\",\r\n    \"to\": \"sebastiaan@sevaho.io\",\r\n    \"subject\": \"testje\",\r\n    \"html\": \"testje\",\r\n}\r\n\r\nasync def main():\r\n    auth = aiohttp.BasicAuth(login=\"api\", password=API_MAILGUN)\r\n    try:\r\n        async with aiohttp.ClientSession(auth=auth) as session:\r\n            with aiohttp.MultipartWriter(\"mixed\") as mpwriter:\r\n\r\n                mpwriter.append(attachment, {\"Content-Type\": \"multipart/form-data\"})\r\n                mpwriter.append_json(mailgun_data)\r\n\r\n                async with session.post(\r\n                    f\"https://api.mailgun.net/v3/{ API_MAILGUN_DOMAIN }/messages\",\r\n                    data=mpwriter,\r\n                ) as resp:\r\n                    response = await resp.text()\r\n                    print(response)\r\n\r\n    except Exception as e:\r\n        print(e)\r\n        raise Exception(\"something went wrong while sending email\")\r\n\r\n\r\nasyncio.run(main())\r\n```\r\n\r\noutput:\r\n\r\n```\r\n{\r\n  \"message\": \"'from' parameter is missing\"\r\n}\r\n```\r\n\r\nwithout the file the request works.\r\n\r\n## Your environment\r\n\r\nI use aiohttp client, on arch linux 4.20.3 aiohttp version: 3.4.4\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3571/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3571/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3570", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3570/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3570/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3570/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3570", "id": 401742723, "node_id": "MDU6SXNzdWU0MDE3NDI3MjM=", "number": 3570, "title": "Pytest fixture aiohttp_raw_server not cleaning up properly", "user": {"login": "simonschmidt", "id": 2243140, "node_id": "MDQ6VXNlcjIyNDMxNDA=", "avatar_url": "https://avatars.githubusercontent.com/u/2243140?v=4", "gravatar_id": "", "url": "https://api.github.com/users/simonschmidt", "html_url": "https://github.com/simonschmidt", "followers_url": "https://api.github.com/users/simonschmidt/followers", "following_url": "https://api.github.com/users/simonschmidt/following{/other_user}", "gists_url": "https://api.github.com/users/simonschmidt/gists{/gist_id}", "starred_url": "https://api.github.com/users/simonschmidt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/simonschmidt/subscriptions", "organizations_url": "https://api.github.com/users/simonschmidt/orgs", "repos_url": "https://api.github.com/users/simonschmidt/repos", "events_url": "https://api.github.com/users/simonschmidt/events{/privacy}", "received_events_url": "https://api.github.com/users/simonschmidt/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2019-01-22T12:30:47Z", "updated_at": "2020-12-24T00:43:08Z", "closed_at": "2020-12-24T00:40:16Z", "author_association": "NONE", "active_lock_reason": null, "body": "When using `aiohttp_raw_server` under some circumstances the listening socket\r\nis not closed properly during fixture teardown.\r\n\r\n\r\n```python\r\nimport pytest\r\nfrom aiohttp.test_utils import unused_port\r\nfrom aiohttp import ClientSession, web\r\n\r\nPORT = unused_port()\r\n\r\nasync def handler(request):\r\n    return web.Response(text=\"hello\")\r\n\r\n@pytest.mark.parametrize('dummy', (1, 2))\r\nasync def test_reuse_port(aiohttp_raw_server, dummy):\r\n    server = await aiohttp_raw_server(handler, port=PORT)\r\n\r\n    async with ClientSession() as session:\r\n        await session.get(f'http://127.0.0.1:{PORT}', headers={'connection': 'close'})\r\n\r\n```\r\n\r\n<details>\r\n<summary>E  OSError: [Errno 98] Address already in use</summary>\r\n\r\n```\r\n================================================================ test session starts =================================================================\r\nplatform linux -- Python 3.6.5, pytest-4.1.1, py-1.7.0, pluggy-0.8.1\r\nrootdir: /src/bug-reproduce, inifile:\r\nplugins: aiohttp-0.3.0\r\ncollected 2 items                                                                                                                                    \r\n\r\ntest_case.py .F                                                                                                                                [100%]\r\n\r\n====================================================================== FAILURES ======================================================================\r\n_____________________________________________________________ test_reuse_port[pyloop-2] ______________________________________________________________\r\n\r\naiohttp_raw_server = <function aiohttp_raw_server.<locals>.go at 0x7fe99e5b76a8>, dummy = 2\r\n\r\n    @pytest.mark.parametrize(\r\n        'dummy', (1, 2)\r\n    )\r\n    async def test_reuse_port(aiohttp_raw_server, dummy):\r\n>       server = await aiohttp_raw_server(handler, port=PORT)\r\n\r\ntest_case.py:15: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n../../.local/share/virtualenvs/bug-reproduce-gswYhaAD/lib/python3.6/site-packages/aiohttp/pytest_plugin.py:272: in go\r\n    await server.start_server(loop=loop, **kwargs)\r\n../../.local/share/virtualenvs/bug-reproduce-gswYhaAD/lib/python3.6/site-packages/aiohttp/test_utils.py:105: in start_server\r\n    _sock = get_port_socket(self.host, self.port)\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nhost = '127.0.0.1', port = 46319\r\n\r\n    def get_port_socket(host: str, port: int) -> socket.socket:\r\n        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\r\n>       s.bind((host, port))\r\nE       OSError: [Errno 98] Address already in use\r\n\r\n../../.local/share/virtualenvs/bug-reproduce-gswYhaAD/lib/python3.6/site-packages/aiohttp/test_utils.py:65: OSError\r\n========================================================= 1 failed, 1 passed in 0.09 seconds =========================================================\r\n\r\n```\r\n\r\n</details>\r\n\r\n---\r\n\r\nTested inside the current `python:3.6` docker image with the following packages:\r\n\r\n<details>\r\n<summary>Pipfile.lock</summary>\r\n<pre>\r\n<code>\r\n{\r\n    \"_meta\": {\r\n        \"hash\": {\r\n            \"sha256\": \"480206feb9c5eb57a9e87d602e5d92c7863406651e887b99c3c9e4645c0d1f83\"\r\n        },\r\n        \"pipfile-spec\": 6,\r\n        \"requires\": {\r\n            \"python_version\": \"3.6\"\r\n        },\r\n        \"sources\": [\r\n            {\r\n                \"name\": \"pypi\",\r\n                \"url\": \"https://pypi.org/simple\",\r\n                \"verify_ssl\": true\r\n            }\r\n        ]\r\n    },\r\n    \"default\": {\r\n        \"aiohttp\": {\r\n            \"hashes\": [\r\n                \"sha256:00d198585474299c9c3b4f1d5de1a576cc230d562abc5e4a0e81d71a20a6ca55\",\r\n                \"sha256:0155af66de8c21b8dba4992aaeeabf55503caefae00067a3b1139f86d0ec50ed\",\r\n                \"sha256:09654a9eca62d1bd6d64aa44db2498f60a5c1e0ac4750953fdd79d5c88955e10\",\r\n                \"sha256:199f1d106e2b44b6dacdf6f9245493c7d716b01d0b7fbe1959318ba4dc64d1f5\",\r\n                \"sha256:296f30dedc9f4b9e7a301e5cc963012264112d78a1d3094cd83ef148fdf33ca1\",\r\n                \"sha256:368ed312550bd663ce84dc4b032a962fcb3c7cae099dbbd48663afc305e3b939\",\r\n                \"sha256:40d7ea570b88db017c51392349cf99b7aefaaddd19d2c78368aeb0bddde9d390\",\r\n                \"sha256:629102a193162e37102c50713e2e31dc9a2fe7ac5e481da83e5bb3c0cee700aa\",\r\n                \"sha256:6d5ec9b8948c3d957e75ea14d41e9330e1ac3fed24ec53766c780f82805140dc\",\r\n                \"sha256:87331d1d6810214085a50749160196391a712a13336cd02ce1c3ea3d05bcf8d5\",\r\n                \"sha256:9a02a04bbe581c8605ac423ba3a74999ec9d8bce7ae37977a3d38680f5780b6d\",\r\n                \"sha256:9c4c83f4fa1938377da32bc2d59379025ceeee8e24b89f72fcbccd8ca22dc9bf\",\r\n                \"sha256:9cddaff94c0135ee627213ac6ca6d05724bfe6e7a356e5e09ec57bd3249510f6\",\r\n                \"sha256:a25237abf327530d9561ef751eef9511ab56fd9431023ca6f4803f1994104d72\",\r\n                \"sha256:a5cbd7157b0e383738b8e29d6e556fde8726823dae0e348952a61742b21aeb12\",\r\n                \"sha256:a97a516e02b726e089cffcde2eea0d3258450389bbac48cbe89e0f0b6e7b0366\",\r\n                \"sha256:acc89b29b5f4e2332d65cd1b7d10c609a75b88ef8925d487a611ca788432dfa4\",\r\n                \"sha256:b05bd85cc99b06740aad3629c2585bda7b83bd86e080b44ba47faf905fdf1300\",\r\n                \"sha256:c2bec436a2b5dafe5eaeb297c03711074d46b6eb236d002c13c42f25c4a8ce9d\",\r\n                \"sha256:cc619d974c8c11fe84527e4b5e1c07238799a8c29ea1c1285149170524ba9303\",\r\n                \"sha256:d4392defd4648badaa42b3e101080ae3313e8f4787cb517efd3f5b8157eaefd6\",\r\n                \"sha256:e1c3c582ee11af7f63a34a46f0448fca58e59889396ffdae1f482085061a2889\"\r\n            ],\r\n            \"index\": \"pypi\",\r\n            \"version\": \"==3.5.4\"\r\n        },\r\n        \"async-timeout\": {\r\n            \"hashes\": [\r\n                \"sha256:0c3c816a028d47f659d6ff5c745cb2acf1f966da1fe5c19c77a70282b25f4c5f\",\r\n                \"sha256:4291ca197d287d274d0b6cb5d6f8f8f82d434ed288f962539ff18cc9012f9ea3\"\r\n            ],\r\n            \"version\": \"==3.0.1\"\r\n        },\r\n        \"atomicwrites\": {\r\n            \"hashes\": [\r\n                \"sha256:0312ad34fcad8fac3704d441f7b317e50af620823353ec657a53e981f92920c0\",\r\n                \"sha256:ec9ae8adaae229e4f8446952d204a3e4b5fdd2d099f9be3aaf556120135fb3ee\"\r\n            ],\r\n            \"version\": \"==1.2.1\"\r\n        },\r\n        \"attrs\": {\r\n            \"hashes\": [\r\n                \"sha256:10cbf6e27dbce8c30807caf056c8eb50917e0eaafe86347671b57254006c3e69\",\r\n                \"sha256:ca4be454458f9dec299268d472aaa5a11f67a4ff70093396e1ceae9c76cf4bbb\"\r\n            ],\r\n            \"version\": \"==18.2.0\"\r\n        },\r\n        \"chardet\": {\r\n            \"hashes\": [\r\n                \"sha256:84ab92ed1c4d4f16916e05906b6b75a6c0fb5db821cc65e70cbd64a3e2a5eaae\",\r\n                \"sha256:fc323ffcaeaed0e0a02bf4d117757b98aed530d9ed4531e3e15460124c106691\"\r\n            ],\r\n            \"version\": \"==3.0.4\"\r\n        },\r\n        \"idna\": {\r\n            \"hashes\": [\r\n                \"sha256:c357b3f628cf53ae2c4c05627ecc484553142ca23264e593d327bcde5e9c3407\",\r\n                \"sha256:ea8b7f6188e6fa117537c3df7da9fc686d485087abf6ac197f9c46432f7e4a3c\"\r\n            ],\r\n            \"version\": \"==2.8\"\r\n        },\r\n        \"idna-ssl\": {\r\n            \"hashes\": [\r\n                \"sha256:a933e3bb13da54383f9e8f35dc4f9cb9eb9b3b78c6b36f311254d6d0d92c6c7c\"\r\n            ],\r\n            \"markers\": \"python_version < '3.7'\",\r\n            \"version\": \"==1.1.0\"\r\n        },\r\n        \"more-itertools\": {\r\n            \"hashes\": [\r\n                \"sha256:38a936c0a6d98a38bcc2d03fdaaedaba9f412879461dd2ceff8d37564d6522e4\",\r\n                \"sha256:c0a5785b1109a6bd7fac76d6837fd1feca158e54e521ccd2ae8bfe393cc9d4fc\",\r\n                \"sha256:fe7a7cae1ccb57d33952113ff4fa1bc5f879963600ed74918f1236e212ee50b9\"\r\n            ],\r\n            \"version\": \"==5.0.0\"\r\n        },\r\n        \"multidict\": {\r\n            \"hashes\": [\r\n                \"sha256:024b8129695a952ebd93373e45b5d341dbb87c17ce49637b34000093f243dd4f\",\r\n                \"sha256:041e9442b11409be5e4fc8b6a97e4bcead758ab1e11768d1e69160bdde18acc3\",\r\n                \"sha256:045b4dd0e5f6121e6f314d81759abd2c257db4634260abcfe0d3f7083c4908ef\",\r\n                \"sha256:047c0a04e382ef8bd74b0de01407e8d8632d7d1b4db6f2561106af812a68741b\",\r\n                \"sha256:068167c2d7bbeebd359665ac4fff756be5ffac9cda02375b5c5a7c4777038e73\",\r\n                \"sha256:148ff60e0fffa2f5fad2eb25aae7bef23d8f3b8bdaf947a65cdbe84a978092bc\",\r\n                \"sha256:1d1c77013a259971a72ddaa83b9f42c80a93ff12df6a4723be99d858fa30bee3\",\r\n                \"sha256:1d48bc124a6b7a55006d97917f695effa9725d05abe8ee78fd60d6588b8344cd\",\r\n                \"sha256:31dfa2fc323097f8ad7acd41aa38d7c614dd1960ac6681745b6da124093dc351\",\r\n                \"sha256:34f82db7f80c49f38b032c5abb605c458bac997a6c3142e0d6c130be6fb2b941\",\r\n                \"sha256:3d5dd8e5998fb4ace04789d1d008e2bb532de501218519d70bb672c4c5a2fc5d\",\r\n                \"sha256:4a6ae52bd3ee41ee0f3acf4c60ceb3f44e0e3bc52ab7da1c2b2aa6703363a3d1\",\r\n                \"sha256:4b02a3b2a2f01d0490dd39321c74273fed0568568ea0e7ea23e02bd1fb10a10b\",\r\n                \"sha256:4b843f8e1dd6a3195679d9838eb4670222e8b8d01bc36c9894d6c3538316fa0a\",\r\n                \"sha256:5de53a28f40ef3c4fd57aeab6b590c2c663de87a5af76136ced519923d3efbb3\",\r\n                \"sha256:61b2b33ede821b94fa99ce0b09c9ece049c7067a33b279f343adfe35108a4ea7\",\r\n                \"sha256:6a3a9b0f45fd75dc05d8e93dc21b18fc1670135ec9544d1ad4acbcf6b86781d0\",\r\n                \"sha256:76ad8e4c69dadbb31bad17c16baee61c0d1a4a73bed2590b741b2e1a46d3edd0\",\r\n                \"sha256:7ba19b777dc00194d1b473180d4ca89a054dd18de27d0ee2e42a103ec9b7d014\",\r\n                \"sha256:7c1b7eab7a49aa96f3db1f716f0113a8a2e93c7375dd3d5d21c4941f1405c9c5\",\r\n                \"sha256:7fc0eee3046041387cbace9314926aa48b681202f8897f8bff3809967a049036\",\r\n                \"sha256:8ccd1c5fff1aa1427100ce188557fc31f1e0a383ad8ec42c559aabd4ff08802d\",\r\n                \"sha256:8e08dd76de80539d613654915a2f5196dbccc67448df291e69a88712ea21e24a\",\r\n                \"sha256:c18498c50c59263841862ea0501da9f2b3659c00db54abfbf823a80787fde8ce\",\r\n                \"sha256:c49db89d602c24928e68c0d510f4fcf8989d77defd01c973d6cbe27e684833b1\",\r\n                \"sha256:ce20044d0317649ddbb4e54dab3c1bcc7483c78c27d3f58ab3d0c7e6bc60d26a\",\r\n                \"sha256:d1071414dd06ca2eafa90c85a079169bfeb0e5f57fd0b45d44c092546fcd6fd9\",\r\n                \"sha256:d3be11ac43ab1a3e979dac80843b42226d5d3cccd3986f2e03152720a4297cd7\",\r\n                \"sha256:db603a1c235d110c860d5f39988ebc8218ee028f07a7cbc056ba6424372ca31b\"\r\n            ],\r\n            \"version\": \"==4.5.2\"\r\n        },\r\n        \"pluggy\": {\r\n            \"hashes\": [\r\n                \"sha256:8ddc32f03971bfdf900a81961a48ccf2fb677cf7715108f85295c67405798616\",\r\n                \"sha256:980710797ff6a041e9a73a5787804f848996ecaa6f8a1b1e08224a5894f2074a\"\r\n            ],\r\n            \"version\": \"==0.8.1\"\r\n        },\r\n        \"py\": {\r\n            \"hashes\": [\r\n                \"sha256:bf92637198836372b520efcba9e020c330123be8ce527e535d185ed4b6f45694\",\r\n                \"sha256:e76826342cefe3c3d5f7e8ee4316b80d1dd8a300781612ddbc765c17ba25a6c6\"\r\n            ],\r\n            \"version\": \"==1.7.0\"\r\n        },\r\n        \"pytest\": {\r\n            \"hashes\": [\r\n                \"sha256:41568ea7ecb4a68d7f63837cf65b92ce8d0105e43196ff2b26622995bb3dc4b2\",\r\n                \"sha256:c3c573a29d7c9547fb90217ece8a8843aa0c1328a797e200290dc3d0b4b823be\"\r\n            ],\r\n            \"version\": \"==4.1.1\"\r\n        },\r\n        \"pytest-aiohttp\": {\r\n            \"hashes\": [\r\n                \"sha256:0b9b660b146a65e1313e2083d0d2e1f63047797354af9a28d6b7c9f0726fa33d\",\r\n                \"sha256:c929854339637977375838703b62fef63528598bc0a9d451639eba95f4aaa44f\"\r\n            ],\r\n            \"index\": \"pypi\",\r\n            \"version\": \"==0.3.0\"\r\n        },\r\n        \"six\": {\r\n            \"hashes\": [\r\n                \"sha256:3350809f0555b11f552448330d0b52d5f24c91a322ea4a15ef22629740f3761c\",\r\n                \"sha256:d16a0141ec1a18405cd4ce8b4613101da75da0e9a7aec5bdd4fa804d0e0eba73\"\r\n            ],\r\n            \"version\": \"==1.12.0\"\r\n        },\r\n        \"typing-extensions\": {\r\n            \"hashes\": [\r\n                \"sha256:07b2c978670896022a43c4b915df8958bec4a6b84add7f2c87b2b728bda3ba64\",\r\n                \"sha256:f3f0e67e1d42de47b5c67c32c9b26641642e9170fe7e292991793705cd5fef7c\",\r\n                \"sha256:fb2cd053238d33a8ec939190f30cfd736c00653a85a2919415cecf7dc3d9da71\"\r\n            ],\r\n            \"markers\": \"python_version < '3.7'\",\r\n            \"version\": \"==3.7.2\"\r\n        },\r\n        \"yarl\": {\r\n            \"hashes\": [\r\n                \"sha256:024ecdc12bc02b321bc66b41327f930d1c2c543fa9a561b39861da9388ba7aa9\",\r\n                \"sha256:2f3010703295fbe1aec51023740871e64bb9664c789cba5a6bdf404e93f7568f\",\r\n                \"sha256:3890ab952d508523ef4881457c4099056546593fa05e93da84c7250516e632eb\",\r\n                \"sha256:3e2724eb9af5dc41648e5bb304fcf4891adc33258c6e14e2a7414ea32541e320\",\r\n                \"sha256:5badb97dd0abf26623a9982cd448ff12cb39b8e4c94032ccdedf22ce01a64842\",\r\n                \"sha256:73f447d11b530d860ca1e6b582f947688286ad16ca42256413083d13f260b7a0\",\r\n                \"sha256:7ab825726f2940c16d92aaec7d204cfc34ac26c0040da727cf8ba87255a33829\",\r\n                \"sha256:b25de84a8c20540531526dfbb0e2d2b648c13fd5dd126728c496d7c3fea33310\",\r\n                \"sha256:c6e341f5a6562af74ba55205dbd56d248daf1b5748ec48a0200ba227bb9e33f4\",\r\n                \"sha256:c9bb7c249c4432cd47e75af3864bc02d26c9594f49c82e2a28624417f0ae63b8\",\r\n                \"sha256:e060906c0c585565c718d1c3841747b61c5439af2211e185f6739a9412dfbde1\"\r\n            ],\r\n            \"version\": \"==1.3.0\"\r\n        }\r\n    },\r\n    \"develop\": {}\r\n}\r\n</code>\r\n</pre>\r\n</summary>", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3570/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3570/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3562", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3562/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3562/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3562/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3562", "id": 401341512, "node_id": "MDU6SXNzdWU0MDEzNDE1MTI=", "number": 3562, "title": "Request header  \"Content-Type: application/json; charset=test\" cause an error", "user": {"login": "Pentusha", "id": 1904496, "node_id": "MDQ6VXNlcjE5MDQ0OTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1904496?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Pentusha", "html_url": "https://github.com/Pentusha", "followers_url": "https://api.github.com/users/Pentusha/followers", "following_url": "https://api.github.com/users/Pentusha/following{/other_user}", "gists_url": "https://api.github.com/users/Pentusha/gists{/gist_id}", "starred_url": "https://api.github.com/users/Pentusha/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Pentusha/subscriptions", "organizations_url": "https://api.github.com/users/Pentusha/orgs", "repos_url": "https://api.github.com/users/Pentusha/repos", "events_url": "https://api.github.com/users/Pentusha/events{/privacy}", "received_events_url": "https://api.github.com/users/Pentusha/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-01-21T12:56:02Z", "updated_at": "2020-05-20T20:40:57Z", "closed_at": "2019-05-10T16:31:30Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "## Long story short\r\nRequest's header Content-Type encoding have not validated properly.\r\nbytes_body.decode(encoding) raise as error \"LookupError: unknown encoding: test\"\r\n\r\n## Expected behaviour\r\nStatus code 415 or 422\r\nEncoding have to be limited with [standard encodings](https://docs.python.org/3/library/codecs.html#standard-encodings).\r\n\r\n## Actual behaviour\r\n```text\r\n500 Internal Server Error\r\n\r\nServer got itself in trouble\r\n```\r\n\r\n```python\r\nError handling request\r\nTraceback (most recent call last):\r\n  File \"/home/pentusha/.venvs/test/lib/python3.7/site-packages/aiohttp/web_protocol.py\", line 418, in start\r\n    resp = await task\r\n  File \"/home/pentusha/.venvs/test/lib/python3.7/site-packages/aiohttp/web_app.py\", line 458, in _handle\r\n    resp = await handler(request)\r\n  File \"/home/pentusha/projects/test/api/app2.py\", line 5, in post_handler\r\n    body = await request.text()\r\n  File \"/home/pentusha/.venvs/test/lib/python3.7/site-packages/aiohttp/web_request.py\", line 579, in text\r\n    return bytes_body.decode(encoding)\r\nLookupError: unknown encoding: test\r\n```\r\n## Steps to reproduce\r\n\r\n```python\r\nfrom aiohttp import web\r\n\r\nasync def post_handler(request):\r\n    body = await request.text()\r\n    return web.Response(body)\r\n\r\ndef main():\r\n    app = web.Application()\r\n    app.add_routes([\r\n        web.post('/', post_handler)\r\n    ])\r\n    web.run_app(app, host='0.0.0.0', port=8000)\r\n\r\nif __name__ == '__main__':\r\n    main()\r\n```\r\n\r\n```bash\r\ncurl 'http://0:8000/' -H 'Content-Type: application/json; charset=test' -d '{}'\r\n```\r\n## Your environment\r\naiohttp==3.5.4\r\nPython 3.7.0", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3562/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3562/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3549", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3549/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3549/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3549/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3549", "id": 399620258, "node_id": "MDU6SXNzdWUzOTk2MjAyNTg=", "number": 3549, "title": "Concurrent GET requests lead to ClientConnectorError(8, 'nodename nor servname provided, or not known')", "user": {"login": "bsolomon1124", "id": 25164676, "node_id": "MDQ6VXNlcjI1MTY0Njc2", "avatar_url": "https://avatars.githubusercontent.com/u/25164676?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bsolomon1124", "html_url": "https://github.com/bsolomon1124", "followers_url": "https://api.github.com/users/bsolomon1124/followers", "following_url": "https://api.github.com/users/bsolomon1124/following{/other_user}", "gists_url": "https://api.github.com/users/bsolomon1124/gists{/gist_id}", "starred_url": "https://api.github.com/users/bsolomon1124/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bsolomon1124/subscriptions", "organizations_url": "https://api.github.com/users/bsolomon1124/orgs", "repos_url": "https://api.github.com/users/bsolomon1124/repos", "events_url": "https://api.github.com/users/bsolomon1124/events{/privacy}", "received_events_url": "https://api.github.com/users/bsolomon1124/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 13, "created_at": "2019-01-16T02:27:46Z", "updated_at": "2022-12-20T10:25:23Z", "closed_at": "2019-01-16T17:51:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Long story short\r\n\r\nI am stumped by a problem seemingly related to `asyncio` + `aiohttp` whereby, when sending a large number of concurrent GET requests, over 85% of the requests raise an `aiohttp.client_exceptions.ClientConnectorError` exception that ultimately stems from\r\n\r\n    socket.gaierror(8, 'nodename nor servname provided, or not known')\r\n\r\nwhile sending single GET requests or doing the underlying DNS resolution on the host/port does not raise this exception.\r\n\r\n(But hey, at least we know that [#2423](https://github.com/aio-libs/aiohttp/issues/2423) is working \ud83d\ude09 .)\r\n\r\n## Expected behaviour\r\n\r\nSuccessful DNS resolution.\r\n\r\n## Actual behaviour\r\n\r\n**Currently, 21205 of 24934 input URLs fail resolution, raising from `aiohttp.TCPConnector._resolve_host()` coroutine.**\r\n\r\n## Steps to reproduce\r\n\r\nWhile in my real code I'm doing a good amount of customization such as using a custom [`TCPConnector`](https://github.com/aio-libs/aiohttp/blob/master/aiohttp/connector.py) instance, I can reproduce the issue using just the \"default\" `aiohttp` class instances & arguments, exactly as below.\r\n\r\nI've followed the traceback and the root of the exception is related to DNS resolution.  It comes from the [`_create_direct_connection`](https://github.com/aio-libs/aiohttp/blob/18a64b2309a1d8aa32f61f4030a5d05560f8de91/aiohttp/connector.py#L933) method of `aiohttp.TCPConnector`, which calls [`._resolve_host()`](https://github.com/aio-libs/aiohttp/blob/18a64b2309a1d8aa32f61f4030a5d05560f8de91/aiohttp/connector.py#L773).\r\n\r\nI have also tried:\r\n\r\n- Using (and not using) `aiodns`\r\n- `sudo killall -HUP mDNSResponder`\r\n- Using `family=socket.AF_INET` as an argument to `TCPConnector` (though I am fairly sure this is used by `aiodns` anyway)\r\n- With `ssl=True` and `ssl=False`\r\n\r\nAll to no avail.\r\n\r\n----\r\n\r\nFull code to reproduce is below.  The input URLs are at https://gist.github.com/bsolomon1124/fc625b624dd26ad9b5c39ccb9e230f5a.\r\n\r\n\timport asyncio\r\n\timport itertools\r\n\r\n\timport aiohttp\r\n\timport aiohttp.client_exceptions\r\n\r\n\tfrom yarl import URL\r\n\r\n\tua = itertools.cycle(\r\n\t    (\r\n\t        \"Mozilla/5.0 (X11; Linux i686; rv:64.0) Gecko/20100101 Firefox/64.0\",\r\n\t        \"Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.10; rv:62.0) Gecko/20100101 Firefox/62.0\",\r\n\t        \"Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.13; ko; rv:1.9.1b2) Gecko/20081201 Firefox/60.0\",\r\n\t        \"Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2228.0 Safari/537.36\"\r\n\t    )\r\n\t)\r\n\r\n\tasync def get(url, session) -> str:\r\n\t    async with await session.request(\r\n\t        \"GET\",\r\n\t        url=url,\r\n\t        raise_for_status=True,\r\n\t        headers={'User-Agent': next(ua)},\r\n\t        ssl=False\r\n\t    ) as resp:\r\n\t        text = await resp.text(encoding=\"utf-8\", errors=\"replace\")\r\n\t        print(\"Got text for URL\", url)\r\n\t        return text\r\n\r\n\tasync def bulk_get(urls) -> list:\r\n\t    async with aiohttp.ClientSession() as session:\r\n\t        htmls = await asyncio.gather(\r\n\t            *(\r\n\t                get(url=url, session=session)\r\n\t                for url in urls\r\n\t            ),\r\n\t            return_exceptions=True\r\n\t        )\r\n\t        return htmls\r\n\r\n\r\n    # See https://gist.github.com/bsolomon1124/fc625b624dd26ad9b5c39ccb9e230f5a\r\n\twith open(\"/path/to/urls.txt\") as f:\r\n\t    urls = tuple(URL(i.strip()) for i in f)\r\n\r\n\tres = asyncio.run(bulk_get(urls))  # urls: Tuple[yarl.URL]\r\n\r\n\tc = 0\r\n\tfor i in res:\r\n\t    if isinstance(i, aiohttp.client_exceptions.ClientConnectorError):\r\n\t        print(i)\r\n\t        c += 1\r\n\r\n\tprint(c)  # 21205 !!!!! (85% failure rate)\r\n\tprint(len(urls))  # 24934\r\n\r\nPrinting each exception string from `res` looks like:\r\n\r\n    Cannot connect to host sigmainvestments.com:80 ssl:False [nodename nor servname provided, or not known]\r\n    Cannot connect to host giaoducthoidai.vn:443 ssl:False [nodename nor servname provided, or not known]\r\n    Cannot connect to host chauxuannguyen.org:80 ssl:False [nodename nor servname provided, or not known]\r\n    Cannot connect to host www.baohomnay.com:443 ssl:False [nodename nor servname provided, or not known]\r\n    Cannot connect to host www.soundofhope.org:80 ssl:False [nodename nor servname provided, or not known]\r\n    # And so on...\r\n\r\n----\r\n\r\nWhat's frustrating is that I can `ping` these hosts with no problem and even call the underlying `._resolve_host()`:\r\n\r\nBash/shell:\r\n\r\n\t [~/] $ ping -c 5 www.hongkongfp.com\r\n\tPING www.hongkongfp.com (104.20.232.8): 56 data bytes\r\n\t64 bytes from 104.20.232.8: icmp_seq=0 ttl=56 time=11.667 ms\r\n\t64 bytes from 104.20.232.8: icmp_seq=1 ttl=56 time=12.169 ms\r\n\t64 bytes from 104.20.232.8: icmp_seq=2 ttl=56 time=12.135 ms\r\n\t64 bytes from 104.20.232.8: icmp_seq=3 ttl=56 time=12.235 ms\r\n\t64 bytes from 104.20.232.8: icmp_seq=4 ttl=56 time=14.252 ms\r\n\r\n\t--- www.hongkongfp.com ping statistics ---\r\n\t5 packets transmitted, 5 packets received, 0.0% packet loss\r\n\tround-trip min/avg/max/stddev = 11.667/12.492/14.252/0.903 ms\r\n\r\nPython:\r\n\r\n\tIn [1]: import asyncio \r\n\t   ...: from aiohttp.connector import TCPConnector \r\n\t   ...: from clipslabapp.ratemgr import default_aiohttp_tcpconnector \r\n\t   ...:  \r\n\t   ...:  \r\n\t   ...: async def main(): \r\n\t   ...:     conn = default_aiohttp_tcpconnector() \r\n\t   ...:     i = await asyncio.create_task(conn._resolve_host(host='www.hongkongfp.com', port=443)) \r\n\t   ...:     return i \r\n\t   ...:  \r\n\t   ...: i = asyncio.run(main())                                                                                                                               \r\n\r\n\tIn [2]: i                                                                                                                                                     \r\n\tOut[2]: \r\n\t[{'hostname': 'www.hongkongfp.com',\r\n\t  'host': '104.20.232.8',\r\n\t  'port': 443,\r\n\t  'family': <AddressFamily.AF_INET: 2>,\r\n\t  'proto': 6,\r\n\t  'flags': <AddressInfo.AI_NUMERICHOST: 4>},\r\n\t {'hostname': 'www.hongkongfp.com',\r\n\t  'host': '104.20.233.8',\r\n\t  'port': 443,\r\n\t  'family': <AddressFamily.AF_INET: 2>,\r\n\t  'proto': 6,\r\n\t  'flags': <AddressInfo.AI_NUMERICHOST: 4>}]\r\n\r\n----\r\n\r\nInformation on the exception itself:\r\n\r\nThe exception is `aiohttp.client_exceptions.ClientConnectorError`, which wraps `socket.gaierror` as the underlying `OSError`.\r\n\r\nSince I have `return_exceptions=True` in `asyncio.gather()`, I can get the exception instances themselves for inspection.  Here is one example:\r\n\r\n\tIn [18]: i\r\n\tOut[18]:\r\n\taiohttp.client_exceptions.ClientConnectorError(8,\r\n\t                                               'nodename nor servname provided, or not known')\r\n\r\n\tIn [19]: i.host, i.port\r\n\tOut[19]: ('www.hongkongfp.com', 443)\r\n\r\n\tIn [20]: i._conn_key\r\n\tOut[20]: ConnectionKey(host='www.hongkongfp.com', port=443, is_ssl=True, ssl=False, proxy=None, proxy_auth=None, proxy_headers_hash=None)\r\n\r\n\tIn [21]: i._os_error\r\n\tOut[21]: socket.gaierror(8, 'nodename nor servname provided, or not known')\r\n\r\n\tIn [22]: raise i.with_traceback(i.__traceback__)\r\n\t---------------------------------------------------------------------------\r\n\tgaierror                                  Traceback (most recent call last)\r\n\t~/Scripts/python/projects/clab/lib/python3.7/site-packages/aiohttp/connector.py in _create_direct_connection(self, req, traces, timeout, client_error)\r\n\t    954                 port,\r\n\t--> 955                 traces=traces), loop=self._loop)\r\n\t    956         except OSError as exc:\r\n\r\n\t~/Scripts/python/projects/clab/lib/python3.7/site-packages/aiohttp/connector.py in _resolve_host(self, host, port, traces)\r\n\t    824                 addrs = await \\\r\n\t--> 825                     self._resolver.resolve(host, port, family=self._family)\r\n\t    826                 if traces:\r\n\r\n\t~/Scripts/python/projects/clab/lib/python3.7/site-packages/aiohttp/resolver.py in resolve(self, host, port, family)\r\n\t     29         infos = await self._loop.getaddrinfo(\r\n\t---> 30             host, port, type=socket.SOCK_STREAM, family=family)\r\n\t     31\r\n\r\n\t/usr/local/Cellar/python/3.7.0/Frameworks/Python.framework/Versions/3.7/lib/python3.7/asyncio/base_events.py in getaddrinfo(self, host, port, family, type, proto, flags)\r\n\t    772         return await self.run_in_executor(\r\n\t--> 773             None, getaddr_func, host, port, family, type, proto, flags)\r\n\t    774\r\n\r\n\t/usr/local/Cellar/python/3.7.0/Frameworks/Python.framework/Versions/3.7/lib/python3.7/concurrent/futures/thread.py in run(self)\r\n\t     56         try:\r\n\t---> 57             result = self.fn(*self.args, **self.kwargs)\r\n\t     58         except BaseException as exc:\r\n\r\n\t/usr/local/Cellar/python/3.7.0/Frameworks/Python.framework/Versions/3.7/lib/python3.7/socket.py in getaddrinfo(host, port, family, type, proto, flags)\r\n\t    747     addrlist = []\r\n\t--> 748     for res in _socket.getaddrinfo(host, port, family, type, proto, flags):\r\n\t    749         af, socktype, proto, canonname, sa = res\r\n\r\n\tgaierror: [Errno 8] nodename nor servname provided, or not known\r\n\r\n\tThe above exception was the direct cause of the following exception:\r\n\r\n\tClientConnectorError                      Traceback (most recent call last)\r\n\t<ipython-input-22-72402d8c3b31> in <module>\r\n\t----> 1 raise i.with_traceback(i.__traceback__)\r\n\r\n\t<ipython-input-1-2bc0f5172de7> in get(url, session)\r\n\t     19         raise_for_status=True,\r\n\t     20         headers={'User-Agent': next(ua)},\r\n\t---> 21         ssl=False\r\n\t     22     ) as resp:\r\n\t     23         return await resp.text(encoding=\"utf-8\", errors=\"replace\")\r\n\r\n\t~/Scripts/python/projects/clab/lib/python3.7/site-packages/aiohttp/client.py in _request(self, method, str_or_url, params, data, json, cookies, headers, skip_auto_headers, auth, allow_redirects, max_redirects, compress, chunked, expect100, raise_for_status, read_until_eof, proxy, proxy_auth, timeout, verify_ssl, fingerprint, ssl_context, ssl, proxy_headers, trace_request_ctx)\r\n\t    474                                 req,\r\n\t    475                                 traces=traces,\r\n\t--> 476                                 timeout=real_timeout\r\n\t    477                             )\r\n\t    478                     except asyncio.TimeoutError as exc:\r\n\r\n\t~/Scripts/python/projects/clab/lib/python3.7/site-packages/aiohttp/connector.py in connect(self, req, traces, timeout)\r\n\t    520\r\n\t    521             try:\r\n\t--> 522                 proto = await self._create_connection(req, traces, timeout)\r\n\t    523                 if self._closed:\r\n\t    524                     proto.close()\r\n\r\n\t~/Scripts/python/projects/clab/lib/python3.7/site-packages/aiohttp/connector.py in _create_connection(self, req, traces, timeout)\r\n\t    852         else:\r\n\t    853             _, proto = await self._create_direct_connection(\r\n\t--> 854                 req, traces, timeout)\r\n\t    855\r\n\t    856         return proto\r\n\r\n\t~/Scripts/python/projects/clab/lib/python3.7/site-packages/aiohttp/connector.py in _create_direct_connection(self, req, traces, timeout, client_error)\r\n\t    957             # in case of proxy it is not ClientProxyConnectionError\r\n\t    958             # it is problem of resolving proxy ip itself\r\n\t--> 959             raise ClientConnectorError(req.connection_key, exc) from exc\r\n\t    960\r\n\t    961         last_exc = None  # type: Optional[Exception]\r\n\r\n\tClientConnectorError: Cannot connect to host www.hongkongfp.com:443 ssl:False [nodename nor servname provided, or not known\r\n\r\n## Your environment\r\n\r\n- Python 3.7.1\r\n- aiohttp client 3.5.4 \r\n- Occurs on Mac OSX High Sierra and Ubuntu 18.04\r\n\r\n----\r\n\r\n## DNS info\r\n\r\nWhy do I not think this is a problem with DNS resolution at the OS level itself?\r\n\r\nI can successfully ping the IP address of my ISP\u2019s DNS Servers, which are given in (Mac OSX) System Preferences > Network > DNS:\r\n\r\n     [~/] $ ping -c 2 75.75.75.75\r\n    PING 75.75.75.75 (75.75.75.75): 56 data bytes\r\n    64 bytes from 75.75.75.75: icmp_seq=0 ttl=57 time=16.478 ms\r\n    64 bytes from 75.75.75.75: icmp_seq=1 ttl=57 time=21.042 ms\r\n    \r\n    --- 75.75.75.75 ping statistics ---\r\n    2 packets transmitted, 2 packets received, 0.0% packet loss\r\n    round-trip min/avg/max/stddev = 16.478/18.760/21.042/2.282 ms\r\n     [~/] $ ping -c 2 75.75.76.76\r\n    PING 75.75.76.76 (75.75.76.76): 56 data bytes\r\n    64 bytes from 75.75.76.76: icmp_seq=0 ttl=54 time=33.904 ms\r\n    64 bytes from 75.75.76.76: icmp_seq=1 ttl=54 time=32.788 ms\r\n    \r\n    --- 75.75.76.76 ping statistics ---\r\n    2 packets transmitted, 2 packets received, 0.0% packet loss\r\n    round-trip min/avg/max/stddev = 32.788/33.346/33.904/0.558 ms\r\n\r\n     [~/] $ ping6 -c 2 2001:558:feed::1\r\n    PING6(56=40+8+8 bytes) 2601:14d:8b00:7d0:6587:7cfc:e2cc:82a0 --> 2001:558:feed::1\r\n    16 bytes from 2001:558:feed::1, icmp_seq=0 hlim=57 time=14.927 ms\r\n    16 bytes from 2001:558:feed::1, icmp_seq=1 hlim=57 time=14.585 ms\r\n    \r\n    --- 2001:558:feed::1 ping6 statistics ---\r\n    2 packets transmitted, 2 packets received, 0.0% packet loss\r\n    round-trip min/avg/max/std-dev = 14.585/14.756/14.927/0.171 ms\r\n     [~/] $ ping6 -c 2 2001:558:feed::2\r\n    PING6(56=40+8+8 bytes) 2601:14d:8b00:7d0:6587:7cfc:e2cc:82a0 --> 2001:558:feed::2\r\n    16 bytes from 2001:558:feed::2, icmp_seq=0 hlim=54 time=12.694 ms\r\n    16 bytes from 2001:558:feed::2, icmp_seq=1 hlim=54 time=11.555 ms\r\n    \r\n    --- 2001:558:feed::2 ping6 statistics ---\r\n    2 packets transmitted, 2 packets received, 0.0% packet loss\r\n    round-trip min/avg/max/std-dev = 11.555/12.125/12.694/0.569 ms", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3549/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3549/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3544", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3544/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3544/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3544/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3544", "id": 399582322, "node_id": "MDU6SXNzdWUzOTk1ODIzMjI=", "number": 3544, "title": "Could not find starting boundary in request.post() and reader.next()", "user": {"login": "The-CJ", "id": 24255160, "node_id": "MDQ6VXNlcjI0MjU1MTYw", "avatar_url": "https://avatars.githubusercontent.com/u/24255160?v=4", "gravatar_id": "", "url": "https://api.github.com/users/The-CJ", "html_url": "https://github.com/The-CJ", "followers_url": "https://api.github.com/users/The-CJ/followers", "following_url": "https://api.github.com/users/The-CJ/following{/other_user}", "gists_url": "https://api.github.com/users/The-CJ/gists{/gist_id}", "starred_url": "https://api.github.com/users/The-CJ/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/The-CJ/subscriptions", "organizations_url": "https://api.github.com/users/The-CJ/orgs", "repos_url": "https://api.github.com/users/The-CJ/repos", "events_url": "https://api.github.com/users/The-CJ/events{/privacy}", "received_events_url": "https://api.github.com/users/The-CJ/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2019-01-15T23:32:03Z", "updated_at": "2021-03-22T10:53:52Z", "closed_at": "2019-11-19T11:02:51Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Long story short\r\n\r\nI want to upload a image and one or multiple arguments to it.\r\nSeems to work on some images, some have empty payload and some throwing \"Could not find starting boundary\" error\r\n\r\n## Expected behaviour\r\n\r\nIt reads the post content if possible and :\r\n- throws a HTTPRequestEntityTooLarge if to large, or\r\n- have a finished post body to work\r\n\r\nsame for the multipart() , reader.next() method\r\n\r\n## Actual behaviour\r\n\r\nrequest.post() throws a \"ValueError: Could not find starting boundary b'------stuff'\"\r\nrequest.multipart() -> reader.next() throws a \"ValueError: Could not find starting boundary b'------stuff'\"\r\nrequests with a body > 2,8MB image have a empty request.post() and return reader.next() = None should  trow a HTTPRequestEntityTooLarge error\r\n\r\nSeems to work find if no file is involved or file < 1MB\r\n(no, i never changed the client_max_size, should be 1024*2)\r\n\r\n\r\nClient (Chrome)\r\n<pre>\r\naction: change_avatar\r\nfile: (binary)\r\n</pre>\r\nClient Raw\r\n<pre>\r\n------WebKitFormBoundaryRyPZoBqLT0tIpjV2\r\nContent-Disposition: form-data; name=\"action\"\r\n\r\nchange_avatar\r\n------WebKitFormBoundaryRyPZoBqLT0tIpjV2\r\nContent-Disposition: form-data; name=\"file\"; filename=\"example_file.png\"\r\nContent-Type: image/png\r\n\r\n\r\n------WebKitFormBoundaryRyPZoBqLT0tIpjV2--\r\n</pre>\r\n\r\nServer\r\n<pre>Error handling request\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.6/dist-packages/aiohttp/web_protocol.py\", line 418, in start\r\n    resp = await task\r\n  File \"/usr/local/lib/python3.6/dist-packages/aiohttp/web_app.py\", line 458, in _handle\r\n    resp = await handler(request)\r\n  File \"/root/Dev/Phaazebot_dev/_API_/Admin.py\", line 105, in control\r\n    r = await reader.next()\r\n  File \"/usr/local/lib/python3.6/dist-packages/aiohttp/multipart.py\", line 561, in next\r\n    await self._read_until_first_boundary()\r\n  File \"/usr/local/lib/python3.6/dist-packages/aiohttp/multipart.py\", line 627, in _read_until_first_boundary\r\n    % (self._boundary))\r\nValueError: Could not find starting boundary b'------WebKitFormBoundaryRyPZoBqLT0tIpjV2'\r\n</pre>\r\n\r\n## Steps to reproduce\r\n Client\r\n```js\r\nfunction upload_avatar() {\r\n  var f = $('#new_avatar');\r\n  var u = {\r\n    \"action\": \"change_avatar\",\r\n    \"file\": f[0].files[0],\r\n  };\r\n  var p = \"/api/admin/control\";\r\n  function s(data) {\r\n    _hide_loading();\r\n    _show_message(data.msg, \"green\");\r\n  }\r\n  function fa(data) {\r\n    _hide_loading();\r\n    _show_message(data.msg ? data.msg : \"Critical Error\", \"red\");\r\n  }\r\n  _show_loading(\"Uploading...\");\r\n  upload_file(u, p, s, fa);\r\n}\r\n\r\nfunction upload_file(args, url, success_function, fail_function) {\r\n  if (!(url && args)) {return false;}\r\n\r\n  var formData = new FormData();\r\n  for (var upl in args) {\r\n    formData.append(upl, args[upl]);\r\n  }\r\n  var request = new XMLHttpRequest();\r\n  request.onload = function () {\r\n    if (200 <= request.status && request.status < 300) {\r\n      success_function( JSON.parse(request.responseText) );\r\n    } else if (request.status >= 500) {\r\n      fail_function( Array() );\r\n    } else {\r\n      fail_function( JSON.parse(request.responseText) );\r\n    }\r\n  }\r\n  request.onerror = function () {\r\n    fail_function(JSON.parse(request.responseText));\r\n  }\r\n  request.open(\"POST\", url);\r\n  request.send(formData);\r\n}\r\n```\r\n\r\nServer\r\n```py\r\nfrom aiohttp import web\r\nserver = web.Application()\r\nserver.router.add_route('*',   '/api/admin/control', example_upload)\r\n\r\n#example 1\r\nasync def example_upload(request):\r\n        post = await request.post() # <- Critical Error here\r\n\r\n       action = post[\"action\"]\r\n       file = post[\"file\"]\r\n\r\n       . . .\r\n\r\n       return web.Response(\r\n                 body=json.dumps(dict(msg=\"stuff\", status=400)),\r\n                 status=400,\r\n                 content_type='application/json'\r\n        )\r\n\r\n#example 2\r\nasync def example_upload(request):\r\n        reader = await request.multipart()\r\n        r = await reader.next() # <-- Critical Error here#\r\n\r\n       . . .\r\n\r\n        return web.Response(\r\n                 body=json.dumps(dict(msg=\"stuff\", status=400)),\r\n                 status=400,\r\n                 content_type='application/json'\r\n        )\r\n\r\n\r\n\r\nweb.run_app(server, handle_signals=False, ssl_context=get_ssl_stuff(), port=443, print=False)\r\n```\r\n\r\n## Your environment\r\n\r\nUbuntu 18.04.1 LTS (GNU/Linux 4.15.0-42-generic x86_64)\r\nVM Server\r\nPython 3.6.7\r\naiohttp 3.5.4\r\n     \r\nserver", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3544/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 1, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3544/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3537", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3537/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3537/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3537/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3537", "id": 398916137, "node_id": "MDU6SXNzdWUzOTg5MTYxMzc=", "number": 3537, "title": "Disable github actions", "user": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2019-01-14T14:37:19Z", "updated_at": "2020-06-24T20:14:39Z", "closed_at": "2019-06-14T12:22:45Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "body": "Now any PR fails on manylinux1 github action check.\r\nIt is very annoying.\r\n@webknjaz can we temporarily disable the feature until it will work?", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3537/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3537/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3535", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3535/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3535/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3535/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3535", "id": 398839760, "node_id": "MDU6SXNzdWUzOTg4Mzk3NjA=", "number": 3535, "title": "ssl.SSLError: [SSL: KRB5_S_INIT] application data after close notify (_ssl.c:2605)", "user": {"login": "bortzmeyer", "id": 103188, "node_id": "MDQ6VXNlcjEwMzE4OA==", "avatar_url": "https://avatars.githubusercontent.com/u/103188?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bortzmeyer", "html_url": "https://github.com/bortzmeyer", "followers_url": "https://api.github.com/users/bortzmeyer/followers", "following_url": "https://api.github.com/users/bortzmeyer/following{/other_user}", "gists_url": "https://api.github.com/users/bortzmeyer/gists{/gist_id}", "starred_url": "https://api.github.com/users/bortzmeyer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bortzmeyer/subscriptions", "organizations_url": "https://api.github.com/users/bortzmeyer/orgs", "repos_url": "https://api.github.com/users/bortzmeyer/repos", "events_url": "https://api.github.com/users/bortzmeyer/events{/privacy}", "received_events_url": "https://api.github.com/users/bortzmeyer/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 40, "created_at": "2019-01-14T11:04:21Z", "updated_at": "2020-11-23T11:35:40Z", "closed_at": "2019-05-27T19:57:17Z", "author_association": "NONE", "active_lock_reason": "off-topic", "body": "The following very simple aiohttp client:\r\n\r\n```python\r\n#!/usr/bin/env python3\r\n\r\nimport aiohttp\r\nimport asyncio\r\n\r\nasync def fetch(session, url):\r\n    async with session.get(url) as response:\r\n        print(\"%s launched\" % url)\r\n        return response\r\n\r\nasync def main():\r\n    async with aiohttp.ClientSession() as session:\r\n        python = await fetch(session, 'https://python.org')\r\n        print(\"Python: %s\" % python.status)\r\n        \r\nloop = asyncio.get_event_loop()\r\nloop.run_until_complete(main())\r\n```\r\n \r\nproduces the following exception:\r\n\r\n```\r\nhttps://python.org launched\r\nPython: 200\r\nSSL error in data received\r\nprotocol: <asyncio.sslproto.SSLProtocol object at 0x7fdec8d42208>\r\ntransport: <_SelectorSocketTransport fd=8 read=polling write=<idle, bufsize=0>>\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3.7/asyncio/sslproto.py\", line 526, in data_received\r\n    ssldata, appdata = self._sslpipe.feed_ssldata(data)\r\n  File \"/usr/lib/python3.7/asyncio/sslproto.py\", line 207, in feed_ssldata\r\n    self._sslobj.unwrap()\r\n  File \"/usr/lib/python3.7/ssl.py\", line 767, in unwrap\r\n    return self._sslobj.shutdown()\r\nssl.SSLError: [SSL: KRB5_S_INIT] application data after close notify (_ssl.c:2605)\r\n```\r\n\r\nI noticed bug #3477 but it is closed and the problem is still there (I have the latest pip version).\r\n\r\n```\r\n% python --version\r\nPython 3.7.2\r\n\r\n% pip show aiohttp\r\nName: aiohttp\r\nVersion: 3.5.4\r\nSummary: Async http client/server framework (asyncio)\r\nHome-page: https://github.com/aio-libs/aiohttp\r\nAuthor: Nikolay Kim\r\nAuthor-email: fafhrd91@gmail.com\r\nLicense: Apache 2\r\nLocation: /usr/lib/python3.7/site-packages\r\nRequires: chardet, multidict, attrs, async-timeout, yarl\r\nRequired-by: \r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3535/reactions", "total_count": 23, "+1": 23, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3535/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3533", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3533/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3533/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3533/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/3533", "id": 398686112, "node_id": "MDExOlB1bGxSZXF1ZXN0MjQ0Mjk2ODc3", "number": 3533, "title": "Permit empty reason strings in ClientResponse.raise_for_status()", "user": {"login": "rhwlo", "id": 315383, "node_id": "MDQ6VXNlcjMxNTM4Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/315383?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rhwlo", "html_url": "https://github.com/rhwlo", "followers_url": "https://api.github.com/users/rhwlo/followers", "following_url": "https://api.github.com/users/rhwlo/following{/other_user}", "gists_url": "https://api.github.com/users/rhwlo/gists{/gist_id}", "starred_url": "https://api.github.com/users/rhwlo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rhwlo/subscriptions", "organizations_url": "https://api.github.com/users/rhwlo/orgs", "repos_url": "https://api.github.com/users/rhwlo/repos", "events_url": "https://api.github.com/users/rhwlo/events{/privacy}", "received_events_url": "https://api.github.com/users/rhwlo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 11, "created_at": "2019-01-13T18:37:41Z", "updated_at": "2023-01-26T23:23:12Z", "closed_at": "2019-01-14T21:53:33Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/3533", "html_url": "https://github.com/aio-libs/aiohttp/pull/3533", "diff_url": "https://github.com/aio-libs/aiohttp/pull/3533.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/3533.patch", "merged_at": "2019-01-14T21:53:33Z"}, "body": "<!-- Thank you for your contribution! -->\r\n\r\n## What do these changes do?\r\n\r\n* Allows `ClientResponse.raise_for_status` to raise a `ClientResponseError` in the case of an HTTP Reason-Phrase that is an empty string\r\n* Raises a `TypeError` if the `ClientResponse.reason` is `None` (since we can\u2019t make a `ClientResponseError` with a message of `None`)\r\n* Fixes https://github.com/aio-libs/aiohttp/issues/3532\r\n<!-- Please give a short brief about these changes. -->\r\n\r\n## Are there changes in behavior for the user?\r\n\r\n* Calling `raise_for_status` on a status with a reason phrase that\u2019s an empty string will raise a `ClientResponseError` now instead of an `AssertionError`\r\n<!-- Outline any notable behaviour for the end users. -->\r\n\r\n## Related issue number\r\n\r\nhttps://github.com/aio-libs/aiohttp/issues/3532\r\n\r\n<!-- Are there any issues opened that will be resolved by merging this change? -->\r\n\r\n## Checklist\r\n\r\n- [x] I think the code is well written\r\n- [x] Unit tests for the changes exist\r\n- [x] Documentation reflects the changes\r\n- [x] If you provide code modification, please add yourself to `CONTRIBUTORS.txt`\r\n  * The format is &lt;Name&gt; &lt;Surname&gt;.\r\n  * Please keep alphabetical order, the file is sorted by names. \r\n- [x] Add a new news fragment into the `CHANGES` folder\r\n  * name it `<issue_id>.<type>` for example (588.bugfix)\r\n  * if you don't have an `issue_id` change it to the pr id after creating the pr\r\n  * ensure type is one of the following:\r\n    * `.feature`: Signifying a new feature.\r\n    * `.bugfix`: Signifying a bug fix.\r\n    * `.doc`: Signifying a documentation improvement.\r\n    * `.removal`: Signifying a deprecation or removal of public API.\r\n    * `.misc`: A ticket has been closed, but it is not of interest to users.\r\n  * Make sure to use full sentences with correct case and punctuation, for example: \"Fix issue with non-ascii contents in doctest text files.\"\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3533/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3533/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3532", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3532/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3532/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3532/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3532", "id": 398685124, "node_id": "MDU6SXNzdWUzOTg2ODUxMjQ=", "number": 3532, "title": "ClientResponse.raise_for_status() raises an AssertionError for empty reason", "user": {"login": "rhwlo", "id": 315383, "node_id": "MDQ6VXNlcjMxNTM4Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/315383?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rhwlo", "html_url": "https://github.com/rhwlo", "followers_url": "https://api.github.com/users/rhwlo/followers", "following_url": "https://api.github.com/users/rhwlo/following{/other_user}", "gists_url": "https://api.github.com/users/rhwlo/gists{/gist_id}", "starred_url": "https://api.github.com/users/rhwlo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rhwlo/subscriptions", "organizations_url": "https://api.github.com/users/rhwlo/orgs", "repos_url": "https://api.github.com/users/rhwlo/repos", "events_url": "https://api.github.com/users/rhwlo/events{/privacy}", "received_events_url": "https://api.github.com/users/rhwlo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-01-13T18:26:02Z", "updated_at": "2020-01-14T22:49:59Z", "closed_at": "2019-01-14T21:53:33Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\n`ClientResponse.raise_for_status()` raises an `AssertionError` for a >= 400 status code if its `reason` is an empty string.\r\n\r\n## Expected behaviour\r\n\r\nI expect `ClientResponse.raise_for_status()` to raise a `ClientResponseError` if it\u2019s invoked on a `ClientResponse` with a status >= 400, and to either:\r\n\r\n* raise a `ClientError` (or some subclass of `ClientError`) if it\u2019s called on a `ClientResponse` with a `reason = None`, regardless of the HTTP status code, if this can only happen when `raise_for_status()` has been called before `start()` has been called; or\r\n* convert a `ClientResponse.reason` of `None` into `\"\"` if `None` is a valid value for `ClientResponse.reason`\r\n\r\n## Actual behaviour\r\n\r\n* `ClientResponse.raise_for_status()` raises an AssertionError if it\u2019s invoked on a `ClientResponse` when a status >= 400 and `bool(reason)` is `False`, which includes `reason == \"\"`\r\n* `ClientResponse.raise_for_status()` raises a ClientResponseError if it\u2019s invoked on a `ClientResponse` with a status >= 400 if the `reason` is not falsey\r\n* `ClientResponse.raise_for_status()` raises no error if it\u2019s invoked on a `ClientResponse` with a status < 400 and a `reason = None`\r\n<!-- What's actually happening? -->\r\n\r\n## Steps to reproduce\r\n\r\nA colleague and I uncovered this using [aioresponses](https://github.com/pnuckowski/aioresponses), which currently doesn\u2019t set a `reason` on the `ClientResponse` at all \u2013 see https://github.com/pnuckowski/aioresponses/issues/114.\r\n\r\nYou can reproduce this with the example client and server in this gist: https://gist.github.com/rhwlo/5ff3cb6bae8deb6abb4a1e527ad9583e\r\n\r\n<!-- Please describe steps to reproduce the issue.\r\n     If you have a script that does that please include it here within\r\n     markdown code markup -->\r\n\r\n## Your environment\r\n\r\nI\u2019m using the latest `aiohttp` from the repository, but this problem shows up only in `v3.5.0` and newer.\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case. \r\n     \r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3532/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3532/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3530", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3530/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3530/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3530/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3530", "id": 398627648, "node_id": "MDU6SXNzdWUzOTg2Mjc2NDg=", "number": 3530, "title": "Concurrent clients in a single session raise ServerDisconnectedError: None", "user": {"login": "messa", "id": 115487, "node_id": "MDQ6VXNlcjExNTQ4Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/115487?v=4", "gravatar_id": "", "url": "https://api.github.com/users/messa", "html_url": "https://github.com/messa", "followers_url": "https://api.github.com/users/messa/followers", "following_url": "https://api.github.com/users/messa/following{/other_user}", "gists_url": "https://api.github.com/users/messa/gists{/gist_id}", "starred_url": "https://api.github.com/users/messa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/messa/subscriptions", "organizations_url": "https://api.github.com/users/messa/orgs", "repos_url": "https://api.github.com/users/messa/repos", "events_url": "https://api.github.com/users/messa/events{/privacy}", "received_events_url": "https://api.github.com/users/messa/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2019-01-13T07:32:05Z", "updated_at": "2020-01-14T01:29:18Z", "closed_at": "2019-01-13T21:24:17Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "It looks like the ClientSession connection pool does not handle correctly concurrent requests (but it's just my guess).\r\n\r\nServer:\r\n\r\n```python\r\nimport asyncio\r\nfrom aiohttp import web\r\n\r\nasync def index_handler(request):\r\n    await asyncio.sleep(.5)\r\n    return web.Response(text='Test')\r\n\r\napp = web.Application()\r\napp.router.add_get('/', index_handler)\r\n\r\nweb.run_app(app)\r\n```\r\n\r\nClient:\r\n\r\n```python\r\nimport aiohttp\r\nimport asyncio\r\n\r\nasync def check_link(session):\r\n    async with session.get('http://127.0.0.1:8080/') as response:\r\n        content = await response.text()\r\n        print(repr(content))\r\n\r\nasync def main():\r\n    while True:\r\n        async with aiohttp.ClientSession() as session:\r\n            asyncio.create_task(check_link(session))\r\n            await asyncio.sleep(.1)\r\n\r\nasyncio.run(main())\r\n```\r\n\r\nOutput:\r\n\r\n```\r\n(venv) root@d93855937cfe:/xx# python3 simple_server.py  &\r\n[1] 4568\r\n======== Running on http://0.0.0.0:8080 ========\r\n(Press CTRL+C to quit)\r\n\r\n(venv) root@d93855937cfe:/xx# python3 client.py\r\nTask exception was never retrieved\r\nfuture: <Task finished coro=<check_link() done, defined at client.py:4> exception=ServerDisconnectedError(None)>\r\nTraceback (most recent call last):\r\n  File \"client.py\", line 5, in check_link\r\n    async with session.get('http://127.0.0.1:8080/') as response:\r\n  File \"/xx/venv/lib/python3.7/site-packages/aiohttp/client.py\", line 1005, in __aenter__\r\n    self._resp = await self._coro\r\n  File \"/xx/venv/lib/python3.7/site-packages/aiohttp/client.py\", line 497, in _request\r\n    await resp.start(conn)\r\n  File \"/xx/venv/lib/python3.7/site-packages/aiohttp/client_reqrep.py\", line 844, in start\r\n    message, payload = await self._protocol.read()  # type: ignore  # noqa\r\n  File \"/xx/venv/lib/python3.7/site-packages/aiohttp/streams.py\", line 588, in read\r\n    await self._waiter\r\naiohttp.client_exceptions.ServerDisconnectedError: None\r\nTask exception was never retrieved\r\n```\r\n\r\nThe exception repeats many times.\r\n\r\nIf remove the `await asyncio.sleep(.5)` or make it .01  then it works correctly, without any errors.\r\n\r\n## Your environment\r\n\r\nTested on clean Docker image debian:buster with python3-venv. Same behavior observed also on macOS.\r\n\r\n```\r\n(venv) root@d93855937cfe:/xx# pip freeze\r\naiohttp==3.5.4\r\nasync-timeout==3.0.1\r\nattrs==18.2.0\r\nchardet==3.0.4\r\nidna==2.8\r\nmultidict==4.5.2\r\npkg-resources==0.0.0\r\nyarl==1.3.0\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3530/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3530/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3525", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3525/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3525/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3525/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3525", "id": 398359096, "node_id": "MDU6SXNzdWUzOTgzNTkwOTY=", "number": 3525, "title": "Receiving zero byte chunks under certain conditions", "user": {"login": "marconfus", "id": 591709, "node_id": "MDQ6VXNlcjU5MTcwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/591709?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marconfus", "html_url": "https://github.com/marconfus", "followers_url": "https://api.github.com/users/marconfus/followers", "following_url": "https://api.github.com/users/marconfus/following{/other_user}", "gists_url": "https://api.github.com/users/marconfus/gists{/gist_id}", "starred_url": "https://api.github.com/users/marconfus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marconfus/subscriptions", "organizations_url": "https://api.github.com/users/marconfus/orgs", "repos_url": "https://api.github.com/users/marconfus/repos", "events_url": "https://api.github.com/users/marconfus/events{/privacy}", "received_events_url": "https://api.github.com/users/marconfus/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2019-01-11T16:24:41Z", "updated_at": "2020-01-14T11:31:34Z", "closed_at": "2019-01-14T08:54:41Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nWhen running under \"Red Hat Enterprise Linux Server release 7.5\" the client only gets a partial result from an https URL using chunked transfer encoding.\r\n\r\nIn another ticket I found the following testcode:\r\n\r\n```python\r\nimport asyncio\r\nimport aiohttp\r\nimport ssl\r\n\r\nasync def main():\r\n    async with aiohttp.ClientSession() as session:\r\n        async with session.get(url=INTERNALURL, timeout=None, ssl=False) as resp:\r\n            buffer = b\"\"\r\n            async for raw_data, end_of_http_chunk in resp.content.iter_chunks():\r\n                print('chunk received', len(raw_data))\r\n                buffer += raw_data\r\n                if not end_of_http_chunk:\r\n                    continue\r\n            print(\"len(buffer)\", len(buffer))\r\n\r\nprint(ssl.OPENSSL_VERSION)\r\nloop = asyncio.get_event_loop()\r\nloop.run_until_complete(main())\r\n```\r\n\r\n## Expected behaviour\r\nOutput of Python 3.6.6 in an up-to-date alpine docker container:\r\n\r\n```\r\nLibreSSL 2.7.4\r\nchunk received 8184\r\nchunk received 8184\r\nchunk received 8184\r\nchunk received 8184\r\nchunk received 8184\r\nchunk received 8184\r\nchunk received 8184\r\nchunk received 8184\r\nchunk received 8184\r\nchunk received 8184\r\nchunk received 8184\r\nchunk received 8184\r\nchunk received 8184\r\nchunk received 5491\r\nlen(buffer) 111883\r\n```\r\n\r\n## Actual behaviour\r\nOuput under RHEL7.5 with Python 3.6.3:\r\n```\r\nOpenSSL 1.0.1e-fips 11 Feb 2013\r\nchunk received 8184\r\nchunk received 0\r\nchunk received 8184\r\nchunk received 0\r\nchunk received 8184\r\nchunk received 0\r\nchunk received 8184\r\nchunk received 0\r\nchunk received 8184\r\nchunk received 0\r\nchunk received 8184\r\nchunk received 0\r\nchunk received 8184\r\nchunk received 0\r\nchunk received 8184\r\nchunk received 0\r\nchunk received 8184\r\nchunk received 0\r\nchunk received 8184\r\nchunk received 0\r\nchunk received 8184\r\nchunk received 0\r\nchunk received 8184\r\nchunk received 0\r\nchunk received 8184\r\nchunk received 5491\r\nchunk received 0\r\nlen(buffer) 111883\r\n```\r\nThe amount and position of zero byte length chunks is sometimes varying from call to call.\r\nOf course, awaiting response.text() I get only 8184 (or a multiple) bytes of content instead of the expected 111883.\r\nCalling the same URL over http I get varying chunk sizes, but never a zero length one before the end, so everything is good.\r\nUsing the Requests library in the same environment using the same https URL I also get the correct result.\r\n\r\n## Steps to reproduce\r\n\r\nUnfortunately the URL is not publicly reachable. It's a webservice with many clients on different platforms (curl, wget, Java, Firefox) and noone else has the problem.\r\n\r\n## Your environment\r\naiohttp 3.5.3 (client)\r\nThe only obvious difference between the working/nonworking environment is the ssl library.\r\n\r\nIs there anything else I can contribute to find the error?", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3525/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3525/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3523", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3523/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3523/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3523/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3523", "id": 398328316, "node_id": "MDU6SXNzdWUzOTgzMjgzMTY=", "number": 3523, "title": "aiohttp not forwarding cookies with Session requests", "user": {"login": "daredevil82", "id": 1406974, "node_id": "MDQ6VXNlcjE0MDY5NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1406974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/daredevil82", "html_url": "https://github.com/daredevil82", "followers_url": "https://api.github.com/users/daredevil82/followers", "following_url": "https://api.github.com/users/daredevil82/following{/other_user}", "gists_url": "https://api.github.com/users/daredevil82/gists{/gist_id}", "starred_url": "https://api.github.com/users/daredevil82/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/daredevil82/subscriptions", "organizations_url": "https://api.github.com/users/daredevil82/orgs", "repos_url": "https://api.github.com/users/daredevil82/repos", "events_url": "https://api.github.com/users/daredevil82/events{/privacy}", "received_events_url": "https://api.github.com/users/daredevil82/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2019-01-11T15:10:53Z", "updated_at": "2022-02-03T10:10:09Z", "closed_at": "2020-11-23T17:25:59Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'm working on an api gateway service with aiohttp that executes an aggregate operation across a number of internal services and packages them up into a 207 bulk response.\r\n\r\nInternally, we use a Django session cookie for the primary means of authentication (planning to move to JWTs in Q2 this year), which means that for the services being hit with this gateway, I need to pass through the cookie from the browser or rest API request.\r\n\r\nIt seems aiohttp is not doing this at all, nor is it making any cookies available in the Postman `Cookies` headers available.  However, if I hit the service directly with the same cookies, I get the expected response back.\r\n\r\nCode right now:\r\n\r\n```\r\nclass AggregateView(BaseView):\r\n    async def post(self):\r\n        requests = await self.request.json()\r\n        logger.debug(f'Making [{len(requests)}] service calls at [{datetime.now()}]')\r\n        queries = []\r\n        async with ClientSession(cookie_jar=CookieJar(unsafe=True)) as session:\r\n            for req in requests:\r\n                queries.append(self._retrieve(req, session))\r\n                \r\n            logger.debug(f'Async calls created [{datetime.now()}]')\r\n            results = await asyncio.gather(*queries)\r\n            logger.debug(f'Async calls completed and aggregated [{datetime.now()}]')\r\n            \r\n        return web.json_response(\r\n                status=207,\r\n                data=results\r\n        )\r\n\r\nclass BaseView(web.View):\r\n    @cache\r\n    async def _retrieve(self, req, session):\r\n        \"\"\"\r\n        Unpacks a request body and executes the appropriate service call\r\n        :param request: request body as dictionary\r\n        :param session: aiohttp ClientSession\r\n        :return:\r\n        \"\"\"\r\n        url, path, query_params = await self._unpack_request(req)\r\n        \r\n        logger.info(f'{url}/{path}\\t{query_params}')\r\n        logger.info(f'Starting request for url [{url}/{path}] at [{datetime.now()}]')\r\n        logger.info(f'with query params {query_params}')\r\n        \r\n        func = session.get\r\n        params = {\r\n            'url': f'{url}/{path}',\r\n            'params': query_params,\r\n            'headers': {\r\n                'Vary': 'Accept, Origin, Accept, Accept-Encoding, Authorization, Cookie'\r\n            }\r\n        }\r\n        \r\n        async with AsyncBreaker(circuit_breaker, params['url'], func, **params) as resp:\r\n            logger.info(f'received request for url [{url}/{path}] at [{datetime.now()}]')\r\n            logger.info(resp.headers)\r\n            logger.info(resp.cookies)\r\n            return {\r\n                'url': f'{url}/{path}',\r\n                'status': resp.status,\r\n                'response': await resp.json()\r\n            }\r\n\r\n\r\ndef cache(func):\r\n    @functools.wraps(func)\r\n    async def wrapper(*args, **kwargs):\r\n        request = args[1]\r\n        access_logger.info(args[2].cookie_jar._cookies.keys())\r\n        \r\n        requested_service = request.get('service').upper()\r\n        service = SERVICES.get(requested_service)\r\n        if service and service.get('cache'):\r\n            access_logger.info('This response is cacheable.')\r\n            pass\r\n        \r\n        return await func(*args, **kwargs)\r\n        \r\n    return wrapper\r\n\r\n```\r\n\r\n```\r\ndict_keys([]) # output in #cache for cookie jar inspection\r\nThis response is cacheable.\r\nStarting request for url [https://service.company.com/api/v1/home-editorial/]\r\n at [2019-01-11 15:01:03.983993]\r\nwith query params None\r\nreceived request for url [https://service.company.com/api/v1/home-editorial/]\r\n at [2019-01-11 15:01:04.434696]\r\nHeader output: <CIMultiDictProxy('Server': 'nginx/1.11.3', 'Content-Type': \r\n'application/json', 'Www-Authenticate': 'Token', 'Allow': 'GET, HEAD, \r\nOPTIONS', 'X-Frame-Options': 'SAMEORIGIN', 'Strict-Transport-Security': \r\n'max-age=15724800; includeSubDomains; preload', 'Accept-Ranges': 'bytes',\r\n 'Content-Length': '58', 'Accept-Ranges': 'bytes', 'Date': \r\n'Fri, 11 Jan 2019 15:01:04 GMT', 'Via': '1.1 varnish', 'Connection': \r\n'keep-alive', 'X-Client-IP': '192.150.73.149', 'X-Served-By': \r\n'cache-bos8232-BOS', 'X-Cache': 'MISS', 'X-Cache-Hits': '0', \r\n'X-Timer': 'S1547218864.246313,VS0,VE152', 'Vary': 'Accept, Origin')>\r\n\r\n```\r\n\r\nNotes: \r\n\r\n* `AsyncBreaker` uses `aiobreaker` to use the Circuit Breaker pattern for protecting services from overload\r\n* `@cache` decorator is currently just wrapping the retrieve method and being used to inspect the attributes of `AggregateView` and `ClientSession`.  Its going to be more full featured with aiocache once this issue is resolved.\r\n\r\nWhat do I need to do to ensure cookie headers from the incoming request get passed to the subsequent session calls?", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3523/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3523/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3522", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3522/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3522/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3522/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3522", "id": 398317410, "node_id": "MDU6SXNzdWUzOTgzMTc0MTA=", "number": 3522, "title": "How to debug local running app (not tests)?", "user": {"login": "daredevil82", "id": 1406974, "node_id": "MDQ6VXNlcjE0MDY5NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1406974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/daredevil82", "html_url": "https://github.com/daredevil82", "followers_url": "https://api.github.com/users/daredevil82/followers", "following_url": "https://api.github.com/users/daredevil82/following{/other_user}", "gists_url": "https://api.github.com/users/daredevil82/gists{/gist_id}", "starred_url": "https://api.github.com/users/daredevil82/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/daredevil82/subscriptions", "organizations_url": "https://api.github.com/users/daredevil82/orgs", "repos_url": "https://api.github.com/users/daredevil82/repos", "events_url": "https://api.github.com/users/daredevil82/events{/privacy}", "received_events_url": "https://api.github.com/users/daredevil82/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2019-01-11T14:44:13Z", "updated_at": "2020-01-11T20:55:56Z", "closed_at": "2019-01-11T19:13:59Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "How do you use ipdb to debug a local running application?  The only reference in the docs are focused on tests, which are less than helpful in my case.\r\n\r\n    class AggregateView(BaseView):  # BaseView inherits from `aiohttp.web.View`\r\n        async def post(self):\r\n            import ipdb\r\n            ipdb.set_trace()\r\n            requests = await self.request.json()\r\n            logger.debug(f'Making [{len(requests)}] service calls at [{datetime.now()}]')\r\n            queries = []\r\n            async with ClientSession(cookie_jar=CookieJar(unsafe=True)) as session:\r\n                for req in requests:\r\n                    queries.append(self._retrieve(req, session))\r\n                \r\n                logger.debug(f'Async calls created [{datetime.now()}]')\r\n                results = await asyncio.gather(*queries)\r\n                logger.debug(f'Async calls completed and aggregated [{datetime.now()}]')\r\n            \r\n            return web.json_response(\r\n                    status=207,\r\n                    data=results\r\n            )\r\n\r\nRunning with command line `docker-compose run --rm --service-ports aiohttp` results in this output:\r\n\r\n```> /orm/service/api/views.py(90)post()\r\n     89         import ipdb; ipdb.set_trace()\r\n---> 90         ipdb.set_trace()\r\n     91         requests = await self.request.json().\r\n\r\nError handling request\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.6/site-packages/prompt_toolkit/application/application.py\", line 652, in _run_async2\r\n    result = yield f\r\n  File \"/usr/local/lib/python3.6/site-packages/prompt_toolkit/eventloop/coroutine.py\", line 86, in step_next\r\n    new_f = coroutine.send(None)\r\n  File \"/usr/local/lib/python3.6/site-packages/prompt_toolkit/application/application.py\", line 591, in _run_async\r\n    with self.input.raw_mode():\r\n  File \"/usr/local/lib/python3.6/site-packages/prompt_toolkit/input/vt100.py\", line 231, in __enter__\r\n    os.write(self.fileno, b'\\x1b[?1l')\r\nOSError: [Errno 9] Bad file descriptor\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.6/site-packages/aiohttp/web_protocol.py\", line 390, in start\r\n    resp = await self._request_handler(request)\r\n  File \"/usr/local/lib/python3.6/site-packages/aiohttp/web_app.py\", line 366, in _handle\r\n    resp = await handler(request)\r\n  File \"/usr/local/lib/python3.6/site-packages/aiohttp/web_urldispatcher.py\", line 740, in _iter\r\n    resp = await method()\r\n  File \"/orm/service/api/views.py\", line 90, in post\r\n    ipdb.set_trace()\r\n  File \"/orm/service/api/views.py\", line 90, in post\r\n    ipdb.set_trace()\r\n  File \"/usr/local/lib/python3.6/bdb.py\", line 51, in trace_dispatch\r\n    return self.dispatch_line(frame)\r\n  File \"/usr/local/lib/python3.6/bdb.py\", line 69, in dispatch_line\r\n    self.user_line(frame)\r\n  File \"/usr/local/lib/python3.6/pdb.py\", line 261, in user_line\r\n    self.interaction(frame, None)\r\n  File \"/usr/local/lib/python3.6/site-packages/IPython/core/debugger.py\", line 297, in interaction\r\n    OldPdb.interaction(self, frame, traceback)\r\n  File \"/usr/local/lib/python3.6/pdb.py\", line 352, in interaction\r\n    self._cmdloop()\r\n  File \"/usr/local/lib/python3.6/pdb.py\", line 321, in _cmdloop\r\n    self.cmdloop()\r\n  File \"/usr/local/lib/python3.6/site-packages/IPython/terminal/debugger.py\", line 88, in cmdloop\r\n    line = self.pt_app.prompt() # reset_current_buffer=True)\r\n  File \"/usr/local/lib/python3.6/site-packages/prompt_toolkit/shortcuts/prompt.py\", line 733, in prompt\r\n    return run_sync()\r\n  File \"/usr/local/lib/python3.6/site-packages/prompt_toolkit/shortcuts/prompt.py\", line 722, in run_sync\r\n    return self.app.run(inputhook=self.inputhook, pre_run=pre_run2)\r\n  File \"/usr/local/lib/python3.6/site-packages/prompt_toolkit/application/application.py\", line 699, in run\r\n    return run()\r\n  File \"/usr/local/lib/python3.6/site-packages/prompt_toolkit/application/application.py\", line 673, in run\r\n    return f.result()\r\n  File \"/usr/local/lib/python3.6/site-packages/prompt_toolkit/eventloop/future.py\", line 149, in result\r\n    raise self._exception\r\n  File \"/usr/local/lib/python3.6/site-packages/prompt_toolkit/eventloop/coroutine.py\", line 90, in step_next\r\n    new_f = coroutine.throw(exc)\r\n  File \"/usr/local/lib/python3.6/site-packages/prompt_toolkit/application/application.py\", line 654, in _run_async2\r\n    assert not self._is_running\r\nAssertionError\r\n[14:38:31]\u25cf POST /aggregate 500 3.5KB 623ms\r\n\r\n```\r\n\r\nmy web application is started with:\r\n\r\n```\r\nfrom dashboard_service import aiohttp_settings as settings\r\nfrom api.routes import setup_routes\r\n\r\n\r\nasync def create_app():\r\n    app = web.Application()\r\n    app['config'] = settings\r\n    setup_routes(app)\r\n    return app\r\n\r\n\r\ndef main():\r\n    logging.basicConfig(level=logging.DEBUG)\r\n    app = create_app()\r\n    web.run_app(app, host=settings.HOST, port=settings.PORT)\r\n```\r\n\r\nOther things I've tried are from https://docs.python.org/3.6/library/asyncio-dev.html, including\r\n\r\n```\r\necho $PYTHONASYNCIODEBUG\r\n1\r\n```\r\n\r\nWith this kind of project, how do we get ipdb breakpoints to work with no exception stack traces?\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3522/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3522/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3521", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3521/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3521/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3521/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3521", "id": 398115290, "node_id": "MDU6SXNzdWUzOTgxMTUyOTA=", "number": 3521, "title": "Invalid syntax", "user": {"login": "nn-user", "id": 36260850, "node_id": "MDQ6VXNlcjM2MjYwODUw", "avatar_url": "https://avatars.githubusercontent.com/u/36260850?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nn-user", "html_url": "https://github.com/nn-user", "followers_url": "https://api.github.com/users/nn-user/followers", "following_url": "https://api.github.com/users/nn-user/following{/other_user}", "gists_url": "https://api.github.com/users/nn-user/gists{/gist_id}", "starred_url": "https://api.github.com/users/nn-user/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nn-user/subscriptions", "organizations_url": "https://api.github.com/users/nn-user/orgs", "repos_url": "https://api.github.com/users/nn-user/repos", "events_url": "https://api.github.com/users/nn-user/events{/privacy}", "received_events_url": "https://api.github.com/users/nn-user/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-01-11T03:20:00Z", "updated_at": "2020-01-11T08:42:00Z", "closed_at": "2019-01-11T08:21:00Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"main.py\", line 1, in <module>\r\n    import aiohttp\r\n  File \"/usr/local/lib/python3.7/dist-packages/aiohttp/__init__.py\", line 10, in <module>\r\n    from .protocol import *  # noqa\r\n  File \"/usr/local/lib/python3.7/dist-packages/aiohttp/protocol.py\", line 18, in <module>\r\n    from .helpers import reify\r\n  File \"/usr/local/lib/python3.7/dist-packages/aiohttp/helpers.py\", line 25\r\n    ensure_future = asyncio.async\r\n                                ^\r\nSyntaxError: invalid syntax\r\nError in sys.excepthook:\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3/dist-packages/apport_python_hook.py\", line 63, in apport_excepthook\r\n    from apport.fileutils import likely_packaged, get_recent_crashes\r\n  File \"/usr/lib/python3/dist-packages/apport/__init__.py\", line 5, in <module>\r\n    from apport.report import Report\r\n  File \"/usr/lib/python3/dist-packages/apport/report.py\", line 30, in <module>\r\n    import apport.fileutils\r\n  File \"/usr/lib/python3/dist-packages/apport/fileutils.py\", line 23, in <module>\r\n    from apport.packaging_impl import impl as packaging\r\n  File \"/usr/lib/python3/dist-packages/apport/packaging_impl.py\", line 24, in <module>\r\n    import apt\r\n  File \"/usr/lib/python3/dist-packages/apt/__init__.py\", line 23, in <module>\r\n    import apt_pkg\r\nModuleNotFoundError: No module named 'apt_pkg'\r\n\r\nOriginal exception was:\r\nTraceback (most recent call last):\r\n  File \"checker.py\", line 1, in <module>\r\n    import aiohttp\r\n  File \"/usr/local/lib/python3.7/dist-packages/aiohttp/__init__.py\", line 10, in <module>\r\n    from .protocol import *  # noqa\r\n  File \"/usr/local/lib/python3.7/dist-packages/aiohttp/protocol.py\", line 18, in <module>\r\n    from .helpers import reify\r\n  File \"/usr/local/lib/python3.7/dist-packages/aiohttp/helpers.py\", line 25\r\n    ensure_future = asyncio.async\r\n```\r\n\r\n## Expected behaviour\r\n\r\nNot crash my script\r\n\r\n## Actual behaviour\r\n\r\nCrash, not worked with python3.7\r\n\r\n## Steps to reproduce\r\n\r\nUsed module aiohttp\r\n\r\n## Your environment\r\n\r\nI use this module in my program, but after the update it stopped working\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3521/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3521/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3515", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3515/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3515/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3515/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/3515", "id": 397756882, "node_id": "MDExOlB1bGxSZXF1ZXN0MjQzNjI4MzAw", "number": 3515, "title": "Send custom per-request cookies even if session jar is empty", "user": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1472801557, "node_id": "MDU6TGFiZWwxNDcyODAxNTU3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bot:chronographer:provided", "name": "bot:chronographer:provided", "color": "ededed", "default": false, "description": "There is a change note present in this PR"}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-01-10T10:08:32Z", "updated_at": "2020-05-20T22:01:14Z", "closed_at": "2019-01-10T12:00:35Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/3515", "html_url": "https://github.com/aio-libs/aiohttp/pull/3515", "diff_url": "https://github.com/aio-libs/aiohttp/pull/3515.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/3515.patch", "merged_at": "2019-01-10T12:00:35Z"}, "body": "The issue was reported in gitter chat", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3515/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3515/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3514", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3514/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3514/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3514/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3514", "id": 397550082, "node_id": "MDU6SXNzdWUzOTc1NTAwODI=", "number": 3514, "title": "Seems to be mention of a flag --no-user in 3.5.2 that is not a supported option on python3", "user": {"login": "scottidler", "id": 2927688, "node_id": "MDQ6VXNlcjI5Mjc2ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/2927688?v=4", "gravatar_id": "", "url": "https://api.github.com/users/scottidler", "html_url": "https://github.com/scottidler", "followers_url": "https://api.github.com/users/scottidler/followers", "following_url": "https://api.github.com/users/scottidler/following{/other_user}", "gists_url": "https://api.github.com/users/scottidler/gists{/gist_id}", "starred_url": "https://api.github.com/users/scottidler/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/scottidler/subscriptions", "organizations_url": "https://api.github.com/users/scottidler/orgs", "repos_url": "https://api.github.com/users/scottidler/repos", "events_url": "https://api.github.com/users/scottidler/events{/privacy}", "received_events_url": "https://api.github.com/users/scottidler/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 58986078, "node_id": "MDU6TGFiZWw1ODk4NjA3OA==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/invalid", "name": "invalid", "color": "e4e669", "default": true, "description": "This doesn't seem right"}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-01-09T20:30:09Z", "updated_at": "2020-01-10T00:56:53Z", "closed_at": "2019-01-09T22:36:06Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nSeems to be mention of a flag --no-user in 3.5.2 that is not a supported option on python3\r\n\r\n## Expected behaviour\r\n\r\n```\r\n$ sudo -H pip3 install aiohttp==3.5.1\r\nCollecting aiohttp==3.5.1\r\n  Downloading https://files.pythonhosted.org/packages/b2/1b/77c21d6bc5ce567e12a7fd6a79cca109188baafaa625238cc22bfaffda73/aiohttp-3.5.1-cp36-cp36m-manylinux1_x86_64.whl (1.2MB)\r\n    100% |\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588| 1.2MB 20.9MB/s\r\nRequirement already satisfied: async-timeout<4.0,>=3.0 in /usr/local/lib/python3.6/dist-packages (from aiohttp==3.5.1) (3.0.1)\r\nRequirement already satisfied: multidict<5.0,>=4.0 in /usr/local/lib/python3.6/dist-packages (from aiohttp==3.5.1) (4.4.2)\r\nRequirement already satisfied: idna-ssl>=1.0; python_version < \"3.7\" in /usr/local/lib/python3.6/dist-packages (from aiohttp==3.5.1) (1.1.0)\r\nRequirement already satisfied: chardet<4.0,>=2.0 in /usr/lib/python3/dist-packages (from aiohttp==3.5.1) (3.0.4)\r\nCollecting typing-extensions>=3.6.5; python_version < \"3.7\" (from aiohttp==3.5.1)\r\n  Downloading https://files.pythonhosted.org/packages/62/4f/392a1fa2873e646f5990eb6f956e662d8a235ab474450c72487745f67276/typing_extensions-3.6.6-py3-none-any.whl\r\nRequirement already satisfied: yarl<2.0,>=1.0 in /usr/local/lib/python3.6/dist-packages (from aiohttp==3.5.1) (1.2.6)\r\nRequirement already satisfied: attrs>=17.3.0 in /usr/local/lib/python3.6/dist-packages (from aiohttp==3.5.1) (18.2.0)\r\nRequirement already satisfied: idna>=2.0 in /usr/local/lib/python3.6/dist-packages (from idna-ssl>=1.0; python_version < \"3.7\"->aiohttp==3.5.1) (2.7)\r\nInstalling collected packages: typing-extensions, aiohttp\r\nSuccessfully installed aiohttp-3.5.1 typing-extensions-3.6.6\r\n```\r\n## Actual behaviour\r\n\r\n```\r\n$ sudo -H pip3 install aiohttp==3.5.2\r\nCollecting aiohttp==3.5.2\r\n  Using cached https://files.pythonhosted.org/packages/ab/b2/cebdde1822389fce7d273e228dd8319c669663378020ca6e876d12904bf6/aiohttp-3.5.2.tar.gz\r\n  Installing build dependencies ... error\r\n  Complete output from command /usr/bin/python3 -m pip install --ignore-installed --no-user --prefix /tmp/pip-build-env-kuv91y2q --no-warn-script-location --no-binary :none: --only-binary :none: -i https://pypi.org/simple -- setuptools>=38.2.5 wheel:\r\n\r\n  Usage:\r\n    /usr/bin/python3 -m pip install [options] <requirement specifier> [package-index-options] ...\r\n    /usr/bin/python3 -m pip install [options] -r <requirements file> [package-index-options] ...\r\n    /usr/bin/python3 -m pip install [options] [-e] <vcs project url> ...\r\n    /usr/bin/python3 -m pip install [options] [-e] <local project path> ...\r\n    /usr/bin/python3 -m pip install [options] <archive url/path> ...\r\n\r\n  no such option: --no-user\r\n\r\n  ----------------------------------------\r\nCommand \"/usr/bin/python3 -m pip install --ignore-installed --no-user --prefix /tmp/pip-build-env-kuv91y2q --no-warn-script-location --no-binary :none: --only-binary :none: -i https://pypi.org/simple -- setuptools>=38.2.5 wheel\" failed with error code 2 in None\r\n```\r\n<!-- What's actually happening? -->\r\n\r\ntry to install aiohttp 3.5.2 using pip3 in a Linux distro\r\n\r\n## Your environment\r\n\r\nMint 19, Python3.6.7, Pip3 18.1", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3514/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3514/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3508", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3508/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3508/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3508/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3508", "id": 397297490, "node_id": "MDU6SXNzdWUzOTcyOTc0OTA=", "number": 3508, "title": "Improve error reporting when None is mistakenly passed as a URL on client requests", "user": {"login": "liberforce", "id": 252242, "node_id": "MDQ6VXNlcjI1MjI0Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/252242?v=4", "gravatar_id": "", "url": "https://api.github.com/users/liberforce", "html_url": "https://github.com/liberforce", "followers_url": "https://api.github.com/users/liberforce/followers", "following_url": "https://api.github.com/users/liberforce/following{/other_user}", "gists_url": "https://api.github.com/users/liberforce/gists{/gist_id}", "starred_url": "https://api.github.com/users/liberforce/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/liberforce/subscriptions", "organizations_url": "https://api.github.com/users/liberforce/orgs", "repos_url": "https://api.github.com/users/liberforce/repos", "events_url": "https://api.github.com/users/liberforce/events{/privacy}", "received_events_url": "https://api.github.com/users/liberforce/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-01-09T10:08:35Z", "updated_at": "2020-01-11T14:15:37Z", "closed_at": "2019-01-11T13:30:43Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nWhile reusing some code I didn't notice that it required an environment variable to be defined.\r\nThis led to the URL used for the requests being None. However, calling `ClientSession.request` with `str_or_url` equal to `None` doesn't trigger an `InvalidURL` exception, but a TypeError on `URL(str_or_url)`.\r\n\r\nhttps://github.com/aio-libs/aiohttp/blob/master/aiohttp/client.py#L361\r\n\r\n## Expected behaviour\r\n\r\nConsider None as an invalid URL and raise an according exception (InvalidURL)\r\n## Actual behaviour\r\n\r\nTypeError is rased in `yarl.URL.__new__`\r\n\r\n## Steps to reproduce\r\n\r\nCall `ClientSession.request(method='GET', str_or_url=None, ...)`\r\n\r\n## Your environment\r\n\r\nPython 3.7 and aiohttp 3.5.2 in a virtualenv.\r\nRunning Ubuntu 18.04.\r\nclient.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3508/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3508/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3505", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3505/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3505/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3505/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3505", "id": 396872230, "node_id": "MDU6SXNzdWUzOTY4NzIyMzA=", "number": 3505, "title": "trustme failed on 32 bit linux", "user": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 303800438, "node_id": "MDU6TGFiZWwzMDM4MDA0Mzg=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/need%20pull%20request", "name": "need pull request", "color": "bfdadc", "default": false, "description": null}, {"id": 731921232, "node_id": "MDU6TGFiZWw3MzE5MjEyMzI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/infra", "name": "infra", "color": "e55e5b", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2019-01-08T11:49:33Z", "updated_at": "2020-01-14T12:38:37Z", "closed_at": "2019-01-14T10:34:52Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "body": "It prevents from publishing binary linux wheels: https://api.travis-ci.com/v3/job/168850920/log.txt\r\n```\r\n==================================== ERRORS ====================================\r\n__________________ ERROR at setup of test_ssl_client[pyloop] ___________________\r\n\r\n    @pytest.fixture\r\n    def tls_certificate_authority():\r\n>       return trustme.CA()\r\n\r\nio/tests/conftest.py:25: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\nopt/_internal/cpython-3.5.6/lib/python3.5/site-packages/trustme/__init__.py:212: in __init__\r\n    backend=default_backend(),\r\nopt/_internal/cpython-3.5.6/lib/python3.5/site-packages/cryptography/x509/base.py:595: in sign\r\n    return backend.create_x509_certificate(self, private_key, algorithm)\r\nopt/_internal/cpython-3.5.6/lib/python3.5/site-packages/cryptography/hazmat/backends/openssl/backend.py:804: in create_x509_certificate\r\n    self._lib.X509_get_notAfter(x509_cert), builder._not_valid_after\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nself = <cryptography.hazmat.backends.openssl.backend.Backend object at 0xf6e759ec>\r\nasn1_time = <cdata 'struct asn1_string_st *' 0x90f5ab0>\r\ntime = datetime.datetime(3000, 1, 1, 0, 0)\r\n\r\n    def _set_asn1_time(self, asn1_time, time):\r\n        timestamp = calendar.timegm(time.timetuple())\r\n>       res = self._lib.ASN1_TIME_set(asn1_time, timestamp)\r\nE       OverflowError: integer 32503680000 does not fit '32-bit int'\r\n\r\nopt/_internal/cpython-3.5.6/lib/python3.5/site-packages/cryptography/hazmat/backends/openssl/backend.py:840: OverflowError\r\n```\r\n\r\nThe simplest workaround can be skipping SSL tests on 32-bit linux box.\r\n\r\n@webknjaz what do you think?", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3505/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3505/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3504", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3504/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3504/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3504/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/3504", "id": 396847300, "node_id": "MDExOlB1bGxSZXF1ZXN0MjQyOTI5MDc0", "number": 3504, "title": "Allow run_app(access_log=None)", "user": {"login": "hynek", "id": 41240, "node_id": "MDQ6VXNlcjQxMjQw", "avatar_url": "https://avatars.githubusercontent.com/u/41240?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hynek", "html_url": "https://github.com/hynek", "followers_url": "https://api.github.com/users/hynek/followers", "following_url": "https://api.github.com/users/hynek/following{/other_user}", "gists_url": "https://api.github.com/users/hynek/gists{/gist_id}", "starred_url": "https://api.github.com/users/hynek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hynek/subscriptions", "organizations_url": "https://api.github.com/users/hynek/orgs", "repos_url": "https://api.github.com/users/hynek/repos", "events_url": "https://api.github.com/users/hynek/events{/privacy}", "received_events_url": "https://api.github.com/users/hynek/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344996043, "node_id": "MDU6TGFiZWwzNDQ5OTYwNDM=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/server", "name": "server", "color": "006b75", "default": false, "description": null}, {"id": 1472801557, "node_id": "MDU6TGFiZWwxNDcyODAxNTU3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bot:chronographer:provided", "name": "bot:chronographer:provided", "color": "ededed", "default": false, "description": "There is a change note present in this PR"}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-01-08T10:41:35Z", "updated_at": "2020-01-09T13:04:44Z", "closed_at": "2019-01-09T12:15:04Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/3504", "html_url": "https://github.com/aio-libs/aiohttp/pull/3504", "diff_url": "https://github.com/aio-libs/aiohttp/pull/3504.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/3504.patch", "merged_at": "2019-01-09T12:15:04Z"}, "body": "## What do these changes do?\r\n\r\nThe docs suggest that you can disable request logging by passing `access_log=None` to run_app.\r\n\r\nHowever:\r\n\r\n1. It breaks when loop's debug is True\r\n2. The type stubs don't reflect that\r\n\r\nThis PR fixes both.\r\n\r\n## Are there changes in behavior for the user?\r\n\r\nDocumented behavior works under more conditions now. :)\r\n\r\n## Checklist\r\n\r\n- [x] I think the code is well written\r\n- [ ] Unit tests for the changes exist\r\n- [x] Documentation reflects the changes\r\n- [x] Add a new news fragment into the `CHANGES` folder\r\n  * name it `<issue_id>.<type>` for example (588.bugfix)\r\n  * if you don't have an `issue_id` change it to the pr id after creating the pr\r\n  * ensure type is one of the following:\r\n    * `.feature`: Signifying a new feature.\r\n    * `.bugfix`: Signifying a bug fix.\r\n    * `.doc`: Signifying a documentation improvement.\r\n    * `.removal`: Signifying a deprecation or removal of public API.\r\n    * `.misc`: A ticket has been closed, but it is not of interest to users.\r\n  * Make sure to use full sentences with correct case and punctuation, for example: \"Fix issue with non-ascii contents in doctest text files.\"", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3504/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3504/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3503", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3503/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3503/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3503/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/3503", "id": 396779487, "node_id": "MDExOlB1bGxSZXF1ZXN0MjQyODc4NTcz", "number": 3503, "title": "[3.5] Ignore done tasks (#3500)", "user": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1472801557, "node_id": "MDU6TGFiZWwxNDcyODAxNTU3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bot:chronographer:provided", "name": "bot:chronographer:provided", "color": "ededed", "default": false, "description": "There is a change note present in this PR"}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-01-08T07:22:21Z", "updated_at": "2020-01-08T11:03:46Z", "closed_at": "2019-01-08T09:36:01Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/3503", "html_url": "https://github.com/aio-libs/aiohttp/pull/3503", "diff_url": "https://github.com/aio-libs/aiohttp/pull/3503.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/3503.patch", "merged_at": "2019-01-08T09:36:01Z"}, "body": "* Fix #3497: Ignore done tasks when cancels pending activities on web.run_app finalization.\r\n(cherry picked from commit 4e99e817)\r\n\r\nCo-authored-by: Andrew Svetlov <andrew.svetlov@gmail.com>\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3503/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3503/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3502", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3502/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3502/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3502/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3502", "id": 396743576, "node_id": "MDU6SXNzdWUzOTY3NDM1NzY=", "number": 3502, "title": "BUG. ssl.SSLError: [SSL: KRB5_S_INIT] application data after close notify", "user": {"login": "ghost", "id": 10137, "node_id": "MDQ6VXNlcjEwMTM3", "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghost", "html_url": "https://github.com/ghost", "followers_url": "https://api.github.com/users/ghost/followers", "following_url": "https://api.github.com/users/ghost/following{/other_user}", "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghost/subscriptions", "organizations_url": "https://api.github.com/users/ghost/orgs", "repos_url": "https://api.github.com/users/ghost/repos", "events_url": "https://api.github.com/users/ghost/events{/privacy}", "received_events_url": "https://api.github.com/users/ghost/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-01-08T04:10:15Z", "updated_at": "2020-01-08T08:38:31Z", "closed_at": "2019-01-08T07:18:26Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nIf assert is between function where I use ClientSession() -> this give error to me:\r\n```\r\nSSL error in data received  \r\nprotocol: <asyncio.sslproto.SSLProtocol object at 0x7f27f8585ac8>  \r\ntransport: <_SelectorSocketTransport fd=38 read=polling write=<idle, bufsize=0>>  \r\nTraceback (most recent call last):  \r\n  File \"/usr/lib/python3.7/asyncio/sslproto.py\", line 526, in data_received\r\n    ssldata, appdata = self._sslpipe.feed_ssldata(data)\r\n  File \"/usr/lib/python3.7/asyncio/sslproto.py\", line 207, in feed_ssldata\r\n    self._sslobj.unwrap()\r\n  File \"/usr/lib/python3.7/ssl.py\", line 767, in unwrap\r\n    return self._sslobj.shutdown()\r\nssl.SSLError: [SSL: KRB5_S_INIT] application data after close notify (_ssl.c:2592)\r\n```\r\n\r\n## Expected behaviour\r\n\r\nNo errors, I am using try..catch\r\n\r\n## Actual behaviour\r\n\r\nShow me error message in console.\r\n\r\n## Steps to reproduce\r\n\r\n```python\r\nimport asyncio\r\nfrom aiohttp import ClientSession, ClientTimeout\r\n\r\n\r\nasync def fun3(url):\r\n    try:\r\n        async with ClientSession(timeout=timeout) as s:\r\n            async with s.get(url) as r:\r\n                if r.status == 200:\r\n                    return True\r\n                else:\r\n                    return False\r\n    except:\r\n        return False\r\n\r\n\r\nasync def fun1(session, url):\r\n    try:\r\n        async with session.get(url) as r:\r\n            # Make assert here, special. And error displayed\r\n            assert 'A77er1 9rr0r' in await r.text()\r\n\r\n        return [True, url]\r\n    except:\r\n        return [False, '']\r\n\r\n\r\nasync def fun0(url):\r\n    url = url if 'http' in url else 'http://' + url\r\n\r\n    # If I remove this function - all good\r\n    if await fun3(url):\r\n        return\r\n\r\n    async with ClientSession(timeout=timeout) as s:\r\n        temp = await fun1(s, url)\r\n\r\n        if temp[0]:\r\n            print('Good')\r\n\r\n\r\nasync def main():\r\n    tasks = []\r\n    # I have many items, just add to simulate real behavior\r\n    task = asyncio.create_task(\r\n        fun0(\r\n            'https://python.org'\r\n        )\r\n    )\r\n    tasks.append(task)\r\n\r\n    await asyncio.gather(*tasks)\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    timeout = ClientTimeout(total=10)\r\n\r\n    asyncio.run(main())\r\n\r\n```\r\n\r\n## Your environment\r\n- [x] Ubuntu 18.04\r\n- [x] Python 3.7.1\r\n- [x] GCC 8.2.0\r\n\r\n- [x] asyncio v3.4.3\r\n- [x] aiohttp v3.5.1\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3502/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3502/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3500", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3500/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3500/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3500/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/3500", "id": 396702964, "node_id": "MDExOlB1bGxSZXF1ZXN0MjQyODIyODU1", "number": 3500, "title": "Ignore done tasks", "user": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1472801557, "node_id": "MDU6TGFiZWwxNDcyODAxNTU3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bot:chronographer:provided", "name": "bot:chronographer:provided", "color": "ededed", "default": false, "description": "There is a change note present in this PR"}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-01-08T00:26:56Z", "updated_at": "2020-01-08T08:49:15Z", "closed_at": "2019-01-08T07:21:29Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/3500", "html_url": "https://github.com/aio-libs/aiohttp/pull/3500", "diff_url": "https://github.com/aio-libs/aiohttp/pull/3500.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/3500.patch", "merged_at": "2019-01-08T07:21:28Z"}, "body": "Fixes #3497 ", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3500/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3500/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3497", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3497/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3497/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3497/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3497", "id": 396484918, "node_id": "MDU6SXNzdWUzOTY0ODQ5MTg=", "number": 3497, "title": "web._cancel_all_tasks causes spurious errors on Python <3.7", "user": {"login": "sgentle", "id": 441426, "node_id": "MDQ6VXNlcjQ0MTQyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/441426?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sgentle", "html_url": "https://github.com/sgentle", "followers_url": "https://api.github.com/users/sgentle/followers", "following_url": "https://api.github.com/users/sgentle/following{/other_user}", "gists_url": "https://api.github.com/users/sgentle/gists{/gist_id}", "starred_url": "https://api.github.com/users/sgentle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sgentle/subscriptions", "organizations_url": "https://api.github.com/users/sgentle/orgs", "repos_url": "https://api.github.com/users/sgentle/repos", "events_url": "https://api.github.com/users/sgentle/events{/privacy}", "received_events_url": "https://api.github.com/users/sgentle/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-01-07T13:22:02Z", "updated_at": "2020-01-08T08:38:28Z", "closed_at": "2019-01-08T07:21:28Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nPython 3.5's `asyncio.Task.all_tasks` differs from Python 3.7's `asyncio.all_tasks` in that it [includes completed tasks](https://github.com/python/cpython/blob/ddc613f20394eba25f2420f6d2fa62b277c95058/Lib/asyncio/tasks.py#L42). However, the `all_tasks` helper uses them interchangeably.\r\n\r\nThis means that when you shutdown a server started with `web.run_app` on Python 3.5 or 3.6, failed requests are rethrown as exceptions in [`web._cancel_all_tasks`](https://github.com/aio-libs/aiohttp/blob/7a324fd46ff7dc9bb0bb1bc5afb326e04cf7cef0/aiohttp/web.py#L353), whether they were handled or not.\r\n\r\n## Steps to reproduce\r\n1. `python3.5 -c 'from aiohttp import web; web.run_app(web.Application())'`\r\n2. visit http://localhost:8080\r\n3. ctrl+c the server\r\n\r\n## Expected behaviour\r\n\r\n```\r\n```\r\n\r\n## Actual behaviour\r\n```\r\nunhandled exception during asyncio.run() shutdown\r\ntask: <Task finished coro=<Application._handle() done, defined at /usr/lib/python3.5/site-packages/aiohttp/web_app.py:405> exception=<HTTPNotFound Not Found eof>\r\n  File \"/usr/lib/python3.5/site-packages/aiohttp/web_protocol.py\", line 406, in start\r\n    resp = await task\r\n  File \"/usr/lib/python3.5/asyncio/futures.py\", line 380, in __iter__\r\n    yield self  # This tells Task to wait for completion.\r\n  File \"/usr/lib/python3.5/asyncio/tasks.py\", line 304, in _wakeup\r\n    future.result()\r\n  File \"/usr/lib/python3.5/asyncio/futures.py\", line 293, in result\r\n    raise self._exception\r\n  File \"/usr/lib/python3.5/asyncio/tasks.py\", line 239, in _step\r\n    result = coro.send(None)\r\n  File \"/usr/lib/python3.5/site-packages/aiohttp/web_app.py\", line 435, in _handle\r\n    resp = await handler(request)\r\n  File \"/usr/lib/python3.5/site-packages/aiohttp/web_urldispatcher.py\", line 848, in _handle\r\n    raise self._http_exception\r\naiohttp.web_exceptions.HTTPNotFound: Not Found\r\n```", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3497/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3497/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3482", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3482/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3482/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3482/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3482", "id": 395925318, "node_id": "MDU6SXNzdWUzOTU5MjUzMTg=", "number": 3482, "title": "Don't replace empty BODY with empty dict on resp.json() call", "user": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 277836062, "node_id": "MDU6TGFiZWwyNzc4MzYwNjI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/good%20first%20issue", "name": "good first issue", "color": "7057ff", "default": true, "description": "Good for newcomers"}, {"id": 344995986, "node_id": "MDU6TGFiZWwzNDQ5OTU5ODY=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/client", "name": "client", "color": "bfd4f2", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/20", "html_url": "https://github.com/aio-libs/aiohttp/milestone/20", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/20/labels", "id": 3189877, "node_id": "MDk6TWlsZXN0b25lMzE4OTg3Nw==", "number": 20, "title": "4.0", "description": "A cut-off for pending deprecations.\r\n\r\nNo schedule date yet, the milestone is a mark for API removal issues.", "creator": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "open_issues": 19, "closed_issues": 12, "state": "open", "created_at": "2018-03-15T09:41:46Z", "updated_at": "2021-10-07T14:43:33Z", "due_on": null, "closed_at": null}, "comments": 8, "created_at": "2019-01-04T13:27:50Z", "updated_at": "2020-01-05T14:31:14Z", "closed_at": "2019-01-05T09:27:05Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "body": "See https://github.com/aio-libs/aiohttp/pull/3362#issuecomment-451442605 note.\r\n\r\nThe change breaks backward compatibility but now the great chance to do it in aiohttp 4.0 :)", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3482/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3482/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3481", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3481/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3481/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3481/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/3481", "id": 395710072, "node_id": "MDExOlB1bGxSZXF1ZXN0MjQyMDk5NDE1", "number": 3481, "title": "Remove deprecation warning", "user": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1472801557, "node_id": "MDU6TGFiZWwxNDcyODAxNTU3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bot:chronographer:provided", "name": "bot:chronographer:provided", "color": "ededed", "default": false, "description": "There is a change note present in this PR"}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-01-03T20:15:34Z", "updated_at": "2020-01-04T20:37:10Z", "closed_at": "2019-01-04T16:04:28Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/3481", "html_url": "https://github.com/aio-libs/aiohttp/pull/3481", "diff_url": "https://github.com/aio-libs/aiohttp/pull/3481.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/3481.patch", "merged_at": "2019-01-04T16:04:28Z"}, "body": "Fixes #3480", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3481/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3481/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3480", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3480/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3480/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3480/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3480", "id": 395596096, "node_id": "MDU6SXNzdWUzOTU1OTYwOTY=", "number": 3480, "title": "Deprecation warning in web_response.py with Python 3.7", "user": {"login": "dmajda", "id": 18821, "node_id": "MDQ6VXNlcjE4ODIx", "avatar_url": "https://avatars.githubusercontent.com/u/18821?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dmajda", "html_url": "https://github.com/dmajda", "followers_url": "https://api.github.com/users/dmajda/followers", "following_url": "https://api.github.com/users/dmajda/following{/other_user}", "gists_url": "https://api.github.com/users/dmajda/gists{/gist_id}", "starred_url": "https://api.github.com/users/dmajda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dmajda/subscriptions", "organizations_url": "https://api.github.com/users/dmajda/orgs", "repos_url": "https://api.github.com/users/dmajda/repos", "events_url": "https://api.github.com/users/dmajda/events{/privacy}", "received_events_url": "https://api.github.com/users/dmajda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-01-03T14:39:33Z", "updated_at": "2020-01-07T10:26:36Z", "closed_at": "2019-01-04T16:04:28Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nWhen warnings are enabled, a warning like this is printed on importing `aiohttp.web` with Python 3.7:\r\n\r\n```\r\n/Users/dmajda/tmp/warnings/aiohttp/.venv/lib/python3.7/site-packages/aiohttp/web_response.py:33: DeprecationWarning: Using or importing the ABCs from 'collections' instead of from 'collections.abc' is deprecated, and in 3.8 it will stop working\r\n  BaseClass = collections.MutableMapping\r\n```\r\n\r\nThis pullutes the output of our test suite (for which we have warnings enabled).\r\n\r\n## Expected behaviour\r\n\r\nNo warning gets printed when importing `aiohttp.web`.\r\n\r\n## Actual behaviour\r\n\r\nA warning gets printed when importing `aiohttp.web`.\r\n\r\n## Steps to reproduce\r\n\r\n```console\r\n$ python3 --version\r\nPython 3.7.0\r\n$ python3 -m venv .venv\r\n[...]\r\n$ . .venv/bin/activate\r\n$ pip3 install aiohttp\r\n[...]\r\n$ python3 -Wall -c 'import aiohttp.web'\r\n/Users/dmajda/tmp/warnings/aiohttp/.venv/lib/python3.7/site-packages/aiohttp/web_response.py:33: DeprecationWarning: Using or importing the ABCs from 'collections' instead of from 'collections.abc' is deprecated, and in 3.8 it will stop working\r\n  BaseClass = collections.MutableMapping\r\n```\r\n\r\n## Your environment\r\n\r\naiohttp version: 3.5.1\r\nPython version: 3.7.0\r\nOS: macOS Mojave\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3480/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3480/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3477", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3477/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3477/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3477/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3477", "id": 395355060, "node_id": "MDU6SXNzdWUzOTUzNTUwNjA=", "number": 3477, "title": "\"Application data after close notify\" regression in 3.5.0 with SSL connection", "user": {"login": "K900", "id": 386765, "node_id": "MDQ6VXNlcjM4Njc2NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/386765?v=4", "gravatar_id": "", "url": "https://api.github.com/users/K900", "html_url": "https://github.com/K900", "followers_url": "https://api.github.com/users/K900/followers", "following_url": "https://api.github.com/users/K900/following{/other_user}", "gists_url": "https://api.github.com/users/K900/gists{/gist_id}", "starred_url": "https://api.github.com/users/K900/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/K900/subscriptions", "organizations_url": "https://api.github.com/users/K900/orgs", "repos_url": "https://api.github.com/users/K900/repos", "events_url": "https://api.github.com/users/K900/events{/privacy}", "received_events_url": "https://api.github.com/users/K900/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 31, "created_at": "2019-01-02T19:35:31Z", "updated_at": "2020-06-24T22:15:09Z", "closed_at": "2019-01-05T11:08:35Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "I'm running this code:\r\n\r\n```python\r\nimport aiohttp\r\nimport asyncio\r\n\r\nasync def main():\r\n    async with aiohttp.ClientSession() as sess:\r\n        async with sess.get('https://api.scryfall.com/cards/random') as resp:\r\n            print(await resp.json())\r\n\r\nasyncio.run(main())\r\n```\r\n\r\nWith aiohttp 3.5.1 on Arch Linux testing (Python 3.7.2, OpenSSL 1.1.1a).\r\n\r\nThe request to the same URL goes through correctly with curl, and sometimes (_very_ rarely) with aiohttp, but most of the time aiohttp returns `None` and produces the following error:\r\n\r\n```\r\nSSL error in data received\r\nprotocol: <asyncio.sslproto.SSLProtocol object at 0x7fa5894fc080>\r\ntransport: <_SelectorSocketTransport fd=6 read=polling write=<idle, bufsize=0>>\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3.7/asyncio/sslproto.py\", line 526, in data_received\r\n    ssldata, appdata = self._sslpipe.feed_ssldata(data)\r\n  File \"/usr/lib/python3.7/asyncio/sslproto.py\", line 207, in feed_ssldata\r\n    self._sslobj.unwrap()\r\n  File \"/usr/lib/python3.7/ssl.py\", line 767, in unwrap\r\n    return self._sslobj.shutdown()\r\nssl.SSLError: [SSL: KRB5_S_INIT] application data after close notify (_ssl.c:2605)\r\n```\r\n\r\n**Edit**: this is a regression between 3.4.4 and 3.5.0", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3477/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3477/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3468", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3468/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3468/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3468/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3468", "id": 394362665, "node_id": "MDU6SXNzdWUzOTQzNjI2NjU=", "number": 3468, "title": "mypy error - Module 'aiohttp' has no attribute 'ClientTimeout'", "user": {"login": "thanosexcite", "id": 6570753, "node_id": "MDQ6VXNlcjY1NzA3NTM=", "avatar_url": "https://avatars.githubusercontent.com/u/6570753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thanosexcite", "html_url": "https://github.com/thanosexcite", "followers_url": "https://api.github.com/users/thanosexcite/followers", "following_url": "https://api.github.com/users/thanosexcite/following{/other_user}", "gists_url": "https://api.github.com/users/thanosexcite/gists{/gist_id}", "starred_url": "https://api.github.com/users/thanosexcite/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thanosexcite/subscriptions", "organizations_url": "https://api.github.com/users/thanosexcite/orgs", "repos_url": "https://api.github.com/users/thanosexcite/repos", "events_url": "https://api.github.com/users/thanosexcite/events{/privacy}", "received_events_url": "https://api.github.com/users/thanosexcite/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/23", "html_url": "https://github.com/aio-libs/aiohttp/milestone/23", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/23/labels", "id": 3750427, "node_id": "MDk6TWlsZXN0b25lMzc1MDQyNw==", "number": 23, "title": "3.5", "description": "aiohttp 3.5 release", "creator": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 10, "state": "closed", "created_at": "2018-10-18T20:38:29Z", "updated_at": "2020-10-24T09:08:08Z", "due_on": null, "closed_at": "2019-10-12T16:34:27Z"}, "comments": 8, "created_at": "2018-12-27T10:51:55Z", "updated_at": "2019-12-28T20:43:31Z", "closed_at": "2018-12-28T19:40:26Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nI have the following example Python file:\r\n\r\nexample.py\r\n```py\r\nfrom aiohttp import ClientSession\r\nfrom aiohttp import ClientTimeout\r\n\r\ntimeout = ClientTimeout()\r\nprint(timeout)\r\n```\r\n\r\n## Expected behaviour\r\n\r\nMypy returns no errors.\r\n\r\n## Actual behaviour\r\n\r\nRunning mypy on the above example file returns the following error:\r\n\r\n```\r\nexample.py:2: error: Module 'aiohttp' has no attribute 'ClientTimeout'\r\n```\r\n\r\n## Steps to reproduce\r\n\r\n```\r\n$ docker run --rm -it -v `pwd`:`pwd` python:3.6.7-slim bash\r\nroot@8a1b86a205ee:/# pip install mypy aiohttp\r\n...\r\nSuccessfully installed aiohttp-3.5.1 async-timeout-3.0.1 attrs-18.2.0 chardet-3.0.4 idna-2.8 idna-ssl-1.1.0 multidict-4.5.2 mypy-0.650 mypy-extensions-0.4.1 typed-ast-1.1.1 typing-extensions-3.6.6 yarl-1.3.0\r\nroot@8a1b86a205ee:/# python /home/thanos/Dev/example/example.py \r\nClientTimeout(total=None, connect=None, sock_read=None, sock_connect=None)\r\nroot@8a1b86a205ee:/# mypy /home/thanos/Dev/example/example.py \r\nhome/thanos/Dev/example/example.py:2: error: Module 'aiohttp' has no attribute 'ClientTimeout'\r\n\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3468/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3468/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3466", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3466/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3466/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3466/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3466", "id": 394029046, "node_id": "MDU6SXNzdWUzOTQwMjkwNDY=", "number": 3466, "title": "Do all async operations in the same task in gunicorn workers", "user": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-12-25T15:00:57Z", "updated_at": "2020-01-04T20:35:59Z", "closed_at": "2019-01-03T20:21:11Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "body": "Like we do for `web.run_app()` already.\r\n\r\nThe reason is: on every `loop.run_until_complete()` a new contextvars context copy is created (and deleted on task exit).\r\nIt leads to the situation when context var changed on `app.on_startup()` stage is not visible in web-handler etc.\r\n\r\nP.S. \r\nThe fix worth to be backported to 3.5", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3466/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3466/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3465", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3465/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3465/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3465/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/3465", "id": 394001366, "node_id": "MDExOlB1bGxSZXF1ZXN0MjQwODYwMTA2", "number": 3465, "title": "Log suppressed exceptions in GunicornWebWorker (fixes #3464)", "user": {"login": "ods", "id": 254298, "node_id": "MDQ6VXNlcjI1NDI5OA==", "avatar_url": "https://avatars.githubusercontent.com/u/254298?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ods", "html_url": "https://github.com/ods", "followers_url": "https://api.github.com/users/ods/followers", "following_url": "https://api.github.com/users/ods/following{/other_user}", "gists_url": "https://api.github.com/users/ods/gists{/gist_id}", "starred_url": "https://api.github.com/users/ods/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ods/subscriptions", "organizations_url": "https://api.github.com/users/ods/orgs", "repos_url": "https://api.github.com/users/ods/repos", "events_url": "https://api.github.com/users/ods/events{/privacy}", "received_events_url": "https://api.github.com/users/ods/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1472801557, "node_id": "MDU6TGFiZWwxNDcyODAxNTU3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bot:chronographer:provided", "name": "bot:chronographer:provided", "color": "ededed", "default": false, "description": "There is a change note present in this PR"}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-12-25T10:17:40Z", "updated_at": "2019-12-27T21:11:35Z", "closed_at": "2018-12-27T19:23:17Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/3465", "html_url": "https://github.com/aio-libs/aiohttp/pull/3465", "diff_url": "https://github.com/aio-libs/aiohttp/pull/3465.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/3465.patch", "merged_at": "2018-12-27T19:23:17Z"}, "body": "Log traceback for exceptions instead of just ignoring them.\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3465/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3465/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3464", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3464/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3464/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3464/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3464", "id": 393996027, "node_id": "MDU6SXNzdWUzOTM5OTYwMjc=", "number": 3464, "title": "Cleanup errors are silenced by gunicorn worke", "user": {"login": "ods", "id": 254298, "node_id": "MDQ6VXNlcjI1NDI5OA==", "avatar_url": "https://avatars.githubusercontent.com/u/254298?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ods", "html_url": "https://github.com/ods", "followers_url": "https://api.github.com/users/ods/followers", "following_url": "https://api.github.com/users/ods/following{/other_user}", "gists_url": "https://api.github.com/users/ods/gists{/gist_id}", "starred_url": "https://api.github.com/users/ods/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ods/subscriptions", "organizations_url": "https://api.github.com/users/ods/orgs", "repos_url": "https://api.github.com/users/ods/repos", "events_url": "https://api.github.com/users/ods/events{/privacy}", "received_events_url": "https://api.github.com/users/ods/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-12-25T09:41:31Z", "updated_at": "2019-12-27T21:03:26Z", "closed_at": "2018-12-27T19:23:22Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "GunicornWebWorker explicitly suppresses all exceptions when calling `_run` method. Thus any exception in on_cleanup handler passes silently and farther handlers of the signal (if any) are not called. \r\n\r\nThere is a plenty of places in aiohttp probably with the same problem:\r\n```\r\n$ grep --include='*.py' -nF 'with suppress(Exception)' -R aiohttp\r\naiohttp/client_proto.py:70:            with suppress(Exception):\r\naiohttp/connector.py:139:            with suppress(Exception):\r\naiohttp/helpers.py:464:        with suppress(Exception):\r\naiohttp/helpers.py:517:            with suppress(Exception):\r\naiohttp/web_protocol.py:518:                with suppress(Exception):\r\naiohttp/worker.py:71:        with suppress(Exception):  # ignore all finalization problems\r\n```", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3464/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3464/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3456", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3456/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3456/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3456/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/3456", "id": 392726475, "node_id": "MDExOlB1bGxSZXF1ZXN0MjM5OTM0MTM5", "number": 3456, "title": "use Host header to check certificate, closes #3455", "user": {"login": "arthru", "id": 1155063, "node_id": "MDQ6VXNlcjExNTUwNjM=", "avatar_url": "https://avatars.githubusercontent.com/u/1155063?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arthru", "html_url": "https://github.com/arthru", "followers_url": "https://api.github.com/users/arthru/followers", "following_url": "https://api.github.com/users/arthru/following{/other_user}", "gists_url": "https://api.github.com/users/arthru/gists{/gist_id}", "starred_url": "https://api.github.com/users/arthru/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arthru/subscriptions", "organizations_url": "https://api.github.com/users/arthru/orgs", "repos_url": "https://api.github.com/users/arthru/repos", "events_url": "https://api.github.com/users/arthru/events{/privacy}", "received_events_url": "https://api.github.com/users/arthru/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 58986078, "node_id": "MDU6TGFiZWw1ODk4NjA3OA==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/invalid", "name": "invalid", "color": "e4e669", "default": true, "description": "This doesn't seem right"}, {"id": 1472801557, "node_id": "MDU6TGFiZWwxNDcyODAxNTU3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bot:chronographer:provided", "name": "bot:chronographer:provided", "color": "ededed", "default": false, "description": "There is a change note present in this PR"}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-12-19T18:31:41Z", "updated_at": "2019-12-26T03:56:56Z", "closed_at": "2018-12-25T00:45:47Z", "author_association": "NONE", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/3456", "html_url": "https://github.com/aio-libs/aiohttp/pull/3456", "diff_url": "https://github.com/aio-libs/aiohttp/pull/3456.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/3456.patch", "merged_at": null}, "body": "## What do these changes do?\r\n\r\nThis Pull Request aims at fixing issue \r\n\r\nWhen an host header is set, aiohttp will use it to check the certificate hostnames\r\n\r\n## Are there changes in behavior for the user?\r\n\r\nIn that particular case, (ip in url + host header + sslcontext), the ssl handshake will be made and the request done\r\n\r\n## Related issue number\r\n\r\n#3455\r\n\r\n## Checklist\r\n\r\n- [X] I think the code is well written\r\n- [ ] Unit tests for the changes exist\r\n- [ ] Documentation reflects the changes\r\n- [X] If you provide code modification, please add yourself to `CONTRIBUTORS.txt`\r\n- [X] Add a new news fragment into the `CHANGES` folder", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3456/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3456/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3455", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3455/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3455/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3455/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3455", "id": 392720632, "node_id": "MDU6SXNzdWUzOTI3MjA2MzI=", "number": 3455, "title": "Should use Host header to check server_hostname when using SSLContext", "user": {"login": "arthru", "id": 1155063, "node_id": "MDQ6VXNlcjExNTUwNjM=", "avatar_url": "https://avatars.githubusercontent.com/u/1155063?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arthru", "html_url": "https://github.com/arthru", "followers_url": "https://api.github.com/users/arthru/followers", "following_url": "https://api.github.com/users/arthru/following{/other_user}", "gists_url": "https://api.github.com/users/arthru/gists{/gist_id}", "starred_url": "https://api.github.com/users/arthru/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arthru/subscriptions", "organizations_url": "https://api.github.com/users/arthru/orgs", "repos_url": "https://api.github.com/users/arthru/repos", "events_url": "https://api.github.com/users/arthru/events{/privacy}", "received_events_url": "https://api.github.com/users/arthru/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2018-12-19T18:14:30Z", "updated_at": "2019-12-26T03:55:24Z", "closed_at": "2018-12-25T00:37:16Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nWhen I use both an IP in the URL, a Host header, and a SSLContext that is configured to check the hostname, it checks the hostname using the IP \r\n\r\n## Expected behaviour\r\n\r\nChecks the certificate using the hostname in the Host header, if it exists\r\n\r\n## Actual behaviour\r\n\r\nChecks the certificate using the hostname in the URL that is actually the IP and fails with the following exception :\r\n\r\n```\r\nSSL handshake failed on verifying the certificate\r\nprotocol: <asyncio.sslproto.SSLProtocol object at 0x7fb9db5c9ba8>\r\ntransport: <_SelectorSocketTransport fd=6 read=polling write=<idle, bufsize=0>>\r\nTraceback (most recent call last):\r\n  File \"/usr/lib64/python3.7/asyncio/sslproto.py\", line 625, in _on_handshake_complete\r\n    raise handshake_exc\r\n  File \"/usr/lib64/python3.7/asyncio/sslproto.py\", line 189, in feed_ssldata\r\n    self._sslobj.do_handshake()\r\n  File \"/usr/lib64/python3.7/ssl.py\", line 763, in do_handshake\r\n    self._sslobj.do_handshake()\r\nssl.SSLCertVerificationError: [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: IP address mismatch, certificate is not valid for '151.101.120.223'. (_ssl.c:1051)\r\nSSL error in data received\r\nprotocol: <asyncio.sslproto.SSLProtocol object at 0x7fb9db5c9ba8>\r\ntransport: <_SelectorSocketTransport closing fd=6 read=idle write=<idle, bufsize=0>>\r\nTraceback (most recent call last):\r\n  File \"/usr/lib64/python3.7/asyncio/sslproto.py\", line 526, in data_received\r\n    ssldata, appdata = self._sslpipe.feed_ssldata(data)\r\n  File \"/usr/lib64/python3.7/asyncio/sslproto.py\", line 189, in feed_ssldata\r\n    self._sslobj.do_handshake()\r\n  File \"/usr/lib64/python3.7/ssl.py\", line 763, in do_handshake\r\n    self._sslobj.do_handshake()\r\nssl.SSLCertVerificationError: [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: IP address mismatch, certificate is not valid for '151.101.120.223'. (_ssl.c:1051)\r\nTraceback (most recent call last):\r\n  File \"/home/arthur/.virtualenvs/watchghost/lib/python3.7/site-packages/aiohttp/connector.py\", line 822, in _wrap_create_connection\r\n    return await self._loop.create_connection(*args, **kwargs)\r\n  File \"/usr/lib64/python3.7/asyncio/base_events.py\", line 975, in create_connection\r\n    ssl_handshake_timeout=ssl_handshake_timeout)\r\n  File \"/usr/lib64/python3.7/asyncio/base_events.py\", line 1003, in _create_connection_transport\r\n    await waiter\r\n  File \"/usr/lib64/python3.7/asyncio/sslproto.py\", line 526, in data_received\r\n    ssldata, appdata = self._sslpipe.feed_ssldata(data)\r\n  File \"/usr/lib64/python3.7/asyncio/sslproto.py\", line 189, in feed_ssldata\r\n    self._sslobj.do_handshake()\r\n  File \"/usr/lib64/python3.7/ssl.py\", line 763, in do_handshake\r\n    self._sslobj.do_handshake()\r\nssl.SSLCertVerificationError: [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: IP address mismatch, certificate is not valid for '151.101.120.223'. (_ssl.c:1051)\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"aiohttp_ip_host.py\", line 25, in <module>\r\n    asyncio.run(failing_https_request())\r\n  File \"/usr/lib64/python3.7/asyncio/runners.py\", line 43, in run\r\n    return loop.run_until_complete(main)\r\n  File \"/usr/lib64/python3.7/asyncio/base_events.py\", line 573, in run_until_complete\r\n    return future.result()\r\n  File \"aiohttp_ip_host.py\", line 20, in failing_https_request\r\n    ssl=context,\r\n  File \"/home/arthur/.virtualenvs/watchghost/lib/python3.7/site-packages/aiohttp/client.py\", line 370, in _request\r\n    timeout=timeout\r\n  File \"/home/arthur/.virtualenvs/watchghost/lib/python3.7/site-packages/aiohttp/connector.py\", line 445, in connect\r\n    proto = await self._create_connection(req, traces, timeout)\r\n  File \"/home/arthur/.virtualenvs/watchghost/lib/python3.7/site-packages/aiohttp/connector.py\", line 757, in _create_connection\r\n    req, traces, timeout)\r\n  File \"/home/arthur/.virtualenvs/watchghost/lib/python3.7/site-packages/aiohttp/connector.py\", line 879, in _create_direct_connection\r\n    raise last_exc\r\n  File \"/home/arthur/.virtualenvs/watchghost/lib/python3.7/site-packages/aiohttp/connector.py\", line 862, in _create_direct_connection\r\n    req=req, client_error=client_error)\r\n  File \"/home/arthur/.virtualenvs/watchghost/lib/python3.7/site-packages/aiohttp/connector.py\", line 825, in _wrap_create_connection\r\n    req.connection_key, exc) from exc\r\naiohttp.client_exceptions.ClientConnectorCertificateError: Cannot connect to host 151.101.120.223:443 ssl:True [SSLCertVerificationError: (1, \"[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: IP address mismatch, certificate is not valid for '151.101.120.223'. (_ssl.c:1051)\")]\r\n\r\n```\r\n\r\n## Steps to reproduce\r\n\r\n```python\r\nimport asyncio\r\nimport aiohttp\r\nimport ssl\r\n\r\n\r\nasync def failing_https_request():\r\n    url = 'https://151.101.120.223/'\r\n    hostname = 'www.python.org'\r\n\r\n    context = ssl.SSLContext(ssl.PROTOCOL_TLS_CLIENT)\r\n    context.verify_mode = ssl.CERT_REQUIRED\r\n    context.check_hostname = True\r\n    context.load_default_certs()\r\n\r\n    headers = {'Host': hostname}\r\n    async with aiohttp.ClientSession() as session:\r\n        response = await session.get(\r\n            url,\r\n            headers=headers,\r\n            ssl=context,\r\n        )\r\n        print(response.status)\r\n\r\n\r\nasyncio.run(failing_https_request())\r\n```\r\n\r\n## Your environment\r\n\r\n- Archlinux\r\n- Python 3.7.1\r\n- aiohttp 3.4.4 and master (da2457463f75b559f39bbdef2276e97e1edde151)", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3455/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3455/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3453", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3453/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3453/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3453/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3453", "id": 391975931, "node_id": "MDU6SXNzdWUzOTE5NzU5MzE=", "number": 3453, "title": "[Documentation and/or web.run_app] Default host is 0.0.0.0", "user": {"login": "coxley", "id": 8285973, "node_id": "MDQ6VXNlcjgyODU5NzM=", "avatar_url": "https://avatars.githubusercontent.com/u/8285973?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coxley", "html_url": "https://github.com/coxley", "followers_url": "https://api.github.com/users/coxley/followers", "following_url": "https://api.github.com/users/coxley/following{/other_user}", "gists_url": "https://api.github.com/users/coxley/gists{/gist_id}", "starred_url": "https://api.github.com/users/coxley/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coxley/subscriptions", "organizations_url": "https://api.github.com/users/coxley/orgs", "repos_url": "https://api.github.com/users/coxley/repos", "events_url": "https://api.github.com/users/coxley/events{/privacy}", "received_events_url": "https://api.github.com/users/coxley/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2018-12-18T02:57:11Z", "updated_at": "2019-12-18T18:38:38Z", "closed_at": "2018-12-18T16:17:05Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\n* Warnings for moving away from [`make_handler`](http://docs.aiohttp.org/en/stable/web_reference.html#aiohttp.web.Application.make_handler) suggest Application Runners as the replacement\r\n\r\n* `make_handler` returned a protocol factory. This factory could be provided to `loop.create_server`\r\n* `loop.create_server` when `host=None` [assumes all interfaces and will return multiple sockets](https://docs.python.org/3/library/asyncio-eventloop.html#asyncio.loop.create_server) (usually one for each address family)\r\n* Both `web.run_app` and `web.TCPSite` when `host=None` assume `0.0.0.0`\r\n  * Confusingly, `web.run_app` states:\r\n\r\n> The server will listen on any host or Unix domain socket path you supply. If no hosts or paths are supplied, or only a port is supplied, a TCP server listening on 0.0.0.0 (all hosts) will be launched.\r\n\r\n* `0.0.0.0` is not inclusive of \"all hosts\" unless in an IPv4-only environment\r\n\r\n## Expected behaviour\r\n\r\nTwo sockets created per port/`TCPSite`, matching (or at least getting close) the event loop behavior. Using `host=localhost`  does the correct thing in my environments\r\n\r\n```\r\nI1217 165618 base_events.py:1068] <Server sockets=[<socket.socket fd=25, family=AddressFamily.AF_INET, type=2049, proto=6, laddr=('127.0.0.1', 8888)>, <socket.socket fd=27, family=AddressFamily.AF_INET6, type=2049, proto=6, laddr=('::1', 8888, 0, 0)>]> is serving\r\n\r\n```\r\n\r\n\r\n## Actual behaviour\r\n\r\nOne socket is created per `TCPSite` for 0.0.0.0\r\n\r\n## Steps to reproduce\r\n\r\n```\r\nimport asyncio\r\nimport logging\r\nfrom aiohttp import web\r\n\r\n\r\nlogger = logging.getLogger()\r\nlogger.setLevel(logging.DEBUG)\r\n\r\n\r\nasync def sup():\r\n    return web.Response(text=\"Sup\")\r\n\r\n\r\nasync def setup():\r\n    app = web.Application()\r\n    app.add_routes([web.get(\"/\", sup)])\r\n\r\n    logging.debug(\"setting up test servers\")\r\n    server_fs = []\r\n    single = web.AppRunner(app)\r\n    await single.setup()\r\n    server_fs.append(web.TCPSite(single, port=8080).start())\r\n    logging.debug(\"AF_INET to start on: 8080\")\r\n\r\n    double = web.AppRunner(app)\r\n    await double.setup()\r\n    server_fs.append(web.TCPSite(double, host=\"localhost\", port=8081).start())\r\n    logging.debug(\"AF_INET + AF_INET6 to start on: 8081\")\r\n    return asyncio.ensure_future(asyncio.gather(*server_fs))\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    loop = asyncio.get_event_loop()\r\n    loop.set_debug(True)\r\n    srv = loop.run_until_complete(setup())\r\n    loop.run_forever()\r\n\r\n```\r\n\r\n\r\nOutput:\r\n\r\n```\r\n\r\n$ python  /tmp/whatever.py\r\nDEBUG:root:setting up test servers\r\nDEBUG:root:AF_INET to start on: 8080\r\nDEBUG:root:AF_INET + AF_INET6 to start on: 8081\r\nDEBUG:asyncio:Get address info localhost:8081, type=<SocketKind.SOCK_STREAM: 1>, flags=<AddressInfo.AI_PASSIVE: 1>\r\nINFO:asyncio:<Server sockets=[<socket.socket fd=7, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('0.0.0.0', 8080)>]> is serving\r\nDEBUG:asyncio:Getting address info localhost:8081, type=<SocketKind.SOCK_STREAM: 1>, flags=<AddressInfo.AI_PASSIVE: 1> took 1.300ms: [(<AddressFamily.AF_INET6: 10>, <SocketKind.SOCK_STREAM: 1>, 6, '', ('::1', 8081, 0, 0)), (<AddressFamily.AF_INET: 2>, <SocketKind.SOCK_STREAM: 1>, 6, '', ('127.0.0.1', 8081))]\r\nDEBUG:asyncio:poll took 0.033 ms: 1 events\r\nINFO:asyncio:<Server sockets=[<socket.socket fd=6, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('::1', 8081, 0, 0)>, <socket.socket fd=8, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8081)>]> is serving\r\n\r\n```\r\n\r\n## Your environment\r\n\r\nLinux, 4.11", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3453/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3453/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3450", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3450/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3450/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3450/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3450", "id": 390755506, "node_id": "MDU6SXNzdWUzOTA3NTU1MDY=", "number": 3450, "title": "pytest-aiohttp + pytest-xdist cause RuntimeError: set_wakeup_fd only works in main thread", "user": {"login": "JoseKilo", "id": 4922058, "node_id": "MDQ6VXNlcjQ5MjIwNTg=", "avatar_url": "https://avatars.githubusercontent.com/u/4922058?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JoseKilo", "html_url": "https://github.com/JoseKilo", "followers_url": "https://api.github.com/users/JoseKilo/followers", "following_url": "https://api.github.com/users/JoseKilo/following{/other_user}", "gists_url": "https://api.github.com/users/JoseKilo/gists{/gist_id}", "starred_url": "https://api.github.com/users/JoseKilo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JoseKilo/subscriptions", "organizations_url": "https://api.github.com/users/JoseKilo/orgs", "repos_url": "https://api.github.com/users/JoseKilo/repos", "events_url": "https://api.github.com/users/JoseKilo/events{/privacy}", "received_events_url": "https://api.github.com/users/JoseKilo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-12-13T16:23:18Z", "updated_at": "2019-12-26T03:55:27Z", "closed_at": "2018-12-25T00:32:35Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nCombining `pytest-aiohttp` and `pytest-xdist` an error is triggered sometimes from the `loop` fixture.\r\n\r\nLet me know if you think the issue is more on the pytest(-xdist) side.\r\n\r\n## Expected behaviour\r\n\r\nNo error.\r\n\r\n## Actual behaviour\r\n\r\n```\r\n=================================================================================================================== ERRORS ====================================================================================================================\r\n_____________________________________________________________________________________________________ ERROR at setup of test_foo[pyloop] ______________________________________________________________________________________________________\r\n[gw6] linux -- Python 3.7.0 /home/merlin/workspace/pytest-test/.venv/bin/python3.7\r\n\r\nloop_factory = <class 'asyncio.unix_events._UnixDefaultEventLoopPolicy'>, fast = False, loop_debug = False\r\n\r\n    @pytest.fixture\r\n    def loop(loop_factory, fast, loop_debug):\r\n        \"\"\"Return an instance of the event loop.\"\"\"\r\n        policy = loop_factory()\r\n        asyncio.set_event_loop_policy(policy)\r\n>       with loop_context(fast=fast) as _loop:\r\n\r\n.venv/lib/python3.7/site-packages/aiohttp/pytest_plugin.py:205:\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\n/usr/local/lib/python3.7/contextlib.py:112: in __enter__\r\n    return next(self.gen)\r\n.venv/lib/python3.7/site-packages/aiohttp/test_utils.py:404: in loop_context\r\n    loop = setup_test_loop(loop_factory)\r\n.venv/lib/python3.7/site-packages/aiohttp/test_utils.py:427: in setup_test_loop\r\n    watcher.attach_loop(loop)\r\n/usr/local/lib/python3.7/asyncio/unix_events.py:868: in attach_loop\r\n    loop.add_signal_handler(signal.SIGCHLD, self._sig_chld)\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\n\r\nself = <_UnixSelectorEventLoop running=False closed=False debug=False>, sig = <Signals.SIGCHLD: 17>, callback = <bound method BaseChildWatcher._sig_chld of <asyncio.unix_events.SafeChildWatcher object at 0x7fbf10c9b048>>, args = ()\r\n\r\n    def add_signal_handler(self, sig, callback, *args):\r\n        \"\"\"Add a handler for a signal.  UNIX only.\r\n    \r\n        Raise ValueError if the signal number is invalid or uncatchable.\r\n        Raise RuntimeError if there is a problem setting up the handler.\r\n        \"\"\"\r\n        if (coroutines.iscoroutine(callback) or\r\n                coroutines.iscoroutinefunction(callback)):\r\n            raise TypeError(\"coroutines cannot be used \"\r\n                            \"with add_signal_handler()\")\r\n        self._check_signal(sig)\r\n        self._check_closed()\r\n        try:\r\n            # set_wakeup_fd() raises ValueError if this is not the\r\n            # main thread.  By calling it early we ensure that an\r\n            # event loop running in another thread cannot add a signal\r\n            # handler.\r\n            signal.set_wakeup_fd(self._csock.fileno())\r\n        except (ValueError, OSError) as exc:\r\n>           raise RuntimeError(str(exc))\r\nE           RuntimeError: set_wakeup_fd only works in main thread\r\n\r\n/usr/local/lib/python3.7/asyncio/unix_events.py:94: RuntimeError\r\n===================================================================================================== 10 passed, 1 error in 0.93 seconds ======================================================================================================\r\n```\r\n\r\n## Steps to reproduce\r\n\r\nI've copied the same test file 10 times (just to have some tests to work with).\r\n\r\n```python\r\nasync def test_foo(loop):\r\n    assert 42 == 42\r\n```\r\n\r\nI use bash in order to run pytest several times until it fails:\r\n\r\n```bash\r\nwhile pytest tests/ -n auto -v; do :; done\r\n```\r\n\r\nNot sure why, but the verbose flag seems to affect it: `-v`\r\n\r\n## Your environment\r\n\r\nTested on 3.6 and 3.7.\r\n8 Cores CPU\r\n\r\n```\r\nPython 3.6.7\r\nPython 3.7.0b5\r\n```\r\n\r\n```\r\naiohttp==3.4.4\r\npytest==4.0.1\r\npytest-aiohttp==0.3.0\r\npytest-xdist==1.25.0\r\n```", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3450/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3450/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3432", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3432/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3432/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3432/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3432", "id": 388125011, "node_id": "MDU6SXNzdWUzODgxMjUwMTE=", "number": 3432, "title": "Aiohttp failing to get response on awaited urls", "user": {"login": "ChakshuGautam", "id": 7413816, "node_id": "MDQ6VXNlcjc0MTM4MTY=", "avatar_url": "https://avatars.githubusercontent.com/u/7413816?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ChakshuGautam", "html_url": "https://github.com/ChakshuGautam", "followers_url": "https://api.github.com/users/ChakshuGautam/followers", "following_url": "https://api.github.com/users/ChakshuGautam/following{/other_user}", "gists_url": "https://api.github.com/users/ChakshuGautam/gists{/gist_id}", "starred_url": "https://api.github.com/users/ChakshuGautam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ChakshuGautam/subscriptions", "organizations_url": "https://api.github.com/users/ChakshuGautam/orgs", "repos_url": "https://api.github.com/users/ChakshuGautam/repos", "events_url": "https://api.github.com/users/ChakshuGautam/events{/privacy}", "received_events_url": "https://api.github.com/users/ChakshuGautam/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2018-12-06T09:27:08Z", "updated_at": "2019-12-07T05:22:39Z", "closed_at": "2018-12-07T04:33:48Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\nAiohttp failing to get response on awaited urls\r\n``` python\r\n    allUrls = await getAllUrls(a, b, c);\r\n    urls = ['url1', 'url3'];\r\n    result = await fetchAll(session, tasks, urls);\r\n    return json(result);\r\n```\r\nWhen using awaited `allUrls` I am getting the following error\r\n`aiohttp.client_exceptions.ContentTypeError: 0, message='Attempt to decode JSON with unexpected mimetype: '`\r\n\r\nWhen I hardcode the urls (by printing them previously) in the variable `urls`, it gives the expected output\r\n\r\n## Expected behaviour\r\n\r\nIt should be same in both cases. I am dynamically generating the urls and I might be missing something really basic.\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3432/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3432/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3430", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3430/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3430/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3430/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/3430", "id": 387940035, "node_id": "MDExOlB1bGxSZXF1ZXN0MjM2MzE4MjQw", "number": 3430, "title": "Rename request fixture for compatibility with a new pytest", "user": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-12-05T20:50:37Z", "updated_at": "2019-12-07T17:03:27Z", "closed_at": "2018-12-07T16:41:10Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/3430", "html_url": "https://github.com/aio-libs/aiohttp/pull/3430", "diff_url": "https://github.com/aio-libs/aiohttp/pull/3430.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/3430.patch", "merged_at": "2018-12-07T16:41:10Z"}, "body": "Fixes #3392 ", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3430/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3430/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3429", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3429/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3429/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3429/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3429", "id": 387925870, "node_id": "MDU6SXNzdWUzODc5MjU4NzA=", "number": 3429, "title": "CI is broken", "user": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 731921232, "node_id": "MDU6TGFiZWw3MzE5MjEyMzI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/infra", "name": "infra", "color": "e55e5b", "default": false, "description": null}, {"id": 743514498, "node_id": "MDU6TGFiZWw3NDM1MTQ0OTg=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/meta", "name": "meta", "color": "ccf794", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-12-05T20:11:39Z", "updated_at": "2019-12-26T03:55:21Z", "closed_at": "2018-12-25T00:38:16Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "body": "The reason is a new `idna` release which is not compatible with `requests`.\r\n\r\nTrack https://github.com/requests/requests/issues/4890 for the issue", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3429/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3429/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3428", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3428/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3428/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3428/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3428", "id": 387782165, "node_id": "MDU6SXNzdWUzODc3ODIxNjU=", "number": 3428, "title": "ImportWarning when importing aiohttp with warnings enabled", "user": {"login": "Norrius", "id": 1355305, "node_id": "MDQ6VXNlcjEzNTUzMDU=", "avatar_url": "https://avatars.githubusercontent.com/u/1355305?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Norrius", "html_url": "https://github.com/Norrius", "followers_url": "https://api.github.com/users/Norrius/followers", "following_url": "https://api.github.com/users/Norrius/following{/other_user}", "gists_url": "https://api.github.com/users/Norrius/gists{/gist_id}", "starred_url": "https://api.github.com/users/Norrius/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Norrius/subscriptions", "organizations_url": "https://api.github.com/users/Norrius/orgs", "repos_url": "https://api.github.com/users/Norrius/repos", "events_url": "https://api.github.com/users/Norrius/events{/privacy}", "received_events_url": "https://api.github.com/users/Norrius/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-12-05T14:28:53Z", "updated_at": "2019-12-05T16:16:38Z", "closed_at": "2018-12-05T15:12:46Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nImporting `aiohttp` results in a lot of ImportWarnings.\r\n\r\nWhile cleaning the app from warnings I noticed that a lot of them stem from aiohttp. To my surprise, simply importing the library results in 10 warning. Of these, DeprecationWarnings are addressed in #3275, but I don't see anything about ImportWarnings.\r\n\r\n## Expected behaviour\r\n\r\nExpected no warnings on library import.\r\n\r\n## Actual behaviour\r\n\r\n`ImportWarning: can't resolve package from __spec__ or __package__, falling back on __name__ and __path__`\r\n\r\n## Steps to reproduce\r\n\r\n```\r\n$ python -Wall -c \"import aiohttp\"\r\n/usr/lib/python3.7/importlib/_bootstrap.py:219: ImportWarning: can't resolve package from __spec__ or __package__, falling back on __name__ and __path__\r\n  return f(*args, **kwds)\r\n/usr/lib/python3.7/importlib/_bootstrap.py:219: ImportWarning: can't resolve package from __spec__ or __package__, falling back on __name__ and __path__\r\n  return f(*args, **kwds)\r\n/usr/lib/python3.7/importlib/_bootstrap.py:219: ImportWarning: can't resolve package from __spec__ or __package__, falling back on __name__ and __path__\r\n  return f(*args, **kwds)\r\n/usr/lib/python3.7/importlib/_bootstrap.py:219: ImportWarning: can't resolve package from __spec__ or __package__, falling back on __name__ and __path__\r\n  return f(*args, **kwds)\r\n/usr/lib/python3.7/importlib/_bootstrap.py:219: ImportWarning: can't resolve package from __spec__ or __package__, falling back on __name__ and __path__\r\n  return f(*args, **kwds)\r\n/usr/lib/python3.7/importlib/_bootstrap.py:219: ImportWarning: can't resolve package from __spec__ or __package__, falling back on __name__ and __path__\r\n  return f(*args, **kwds)\r\n/usr/lib/python3.7/importlib/_bootstrap.py:219: ImportWarning: can't resolve package from __spec__ or __package__, falling back on __name__ and __path__\r\n  return f(*args, **kwds)\r\nproject_root/venv/lib/python3.7/site-packages/aiohttp/multipart.py:8: DeprecationWarning: Using or importing the ABCs from 'collections' instead of from 'collections.abc' is deprecated, and in 3.8 it will stop working\r\n  from collections import Mapping, Sequence, deque\r\nproject_root/venv/lib/python3.7/site-packages/aiohttp/multipart.py:8: DeprecationWarning: Using or importing the ABCs from 'collections' instead of from 'collections.abc' is deprecated, and in 3.8 it will stop working\r\n  from collections import Mapping, Sequence, deque\r\n/usr/lib/python3.7/importlib/_bootstrap.py:219: ImportWarning: can't resolve package from __spec__ or __package__, falling back on __name__ and __path__\r\n  return f(*args, **kwds)\r\n```\r\n\r\n## Your environment\r\n\r\nLinux Mint 18.3, Python 3.7.1, aiohttp 3.4.4.\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3428/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3428/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3420", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3420/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3420/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3420/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/3420", "id": 386511749, "node_id": "MDExOlB1bGxSZXF1ZXN0MjM1MjI3OTU4", "number": 3420, "title": "Deprecate body argument for http web excepions", "user": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 58986077, "node_id": "MDU6TGFiZWw1ODk4NjA3Nw==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/enhancement", "name": "enhancement", "color": "84b6eb", "default": true, "description": null}, {"id": 277836062, "node_id": "MDU6TGFiZWwyNzc4MzYwNjI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/good%20first%20issue", "name": "good first issue", "color": "7057ff", "default": true, "description": "Good for newcomers"}, {"id": 1472801557, "node_id": "MDU6TGFiZWwxNDcyODAxNTU3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bot:chronographer:provided", "name": "bot:chronographer:provided", "color": "ededed", "default": false, "description": "There is a change note present in this PR"}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2018-12-02T00:14:17Z", "updated_at": "2020-05-20T22:38:41Z", "closed_at": "2018-12-02T15:24:47Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/3420", "html_url": "https://github.com/aio-libs/aiohttp/pull/3420", "diff_url": "https://github.com/aio-libs/aiohttp/pull/3420.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/3420.patch", "merged_at": "2018-12-02T15:24:46Z"}, "body": "Fixes #3385 ", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3420/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3420/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3408", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3408/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3408/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3408/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3408", "id": 384109070, "node_id": "MDU6SXNzdWUzODQxMDkwNzA=", "number": 3408, "title": "when I use the proxy option for client get method, I got 'Constructor parameter must be string'", "user": {"login": "xgnit", "id": 13747985, "node_id": "MDQ6VXNlcjEzNzQ3OTg1", "avatar_url": "https://avatars.githubusercontent.com/u/13747985?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xgnit", "html_url": "https://github.com/xgnit", "followers_url": "https://api.github.com/users/xgnit/followers", "following_url": "https://api.github.com/users/xgnit/following{/other_user}", "gists_url": "https://api.github.com/users/xgnit/gists{/gist_id}", "starred_url": "https://api.github.com/users/xgnit/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xgnit/subscriptions", "organizations_url": "https://api.github.com/users/xgnit/orgs", "repos_url": "https://api.github.com/users/xgnit/repos", "events_url": "https://api.github.com/users/xgnit/events{/privacy}", "received_events_url": "https://api.github.com/users/xgnit/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-11-25T19:15:46Z", "updated_at": "2019-11-25T20:01:18Z", "closed_at": "2018-11-25T19:49:20Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "Code ist simple\r\n\r\n    async def run(self, proxy):\r\n        proxy_for_requests = {'https': proxy}\r\n        try:\r\n            async with aiohttp.ClientSession() as session:\r\n                async with session.get(url='https://www.google.com', proxy=proxy_for_requests,\r\n                                                    timeout=5, headers=self.get_headers()) as resp:\r\n                    return proxy\r\n        except Exception as e:\r\n            print(str(e))\r\n            return None\r\n\r\nExpected:\r\nWhen it's a timeout problem, it returns None.\r\n\r\nActual:\r\nthis function always raises the error: \"Constructor parameter should be str\". I removed the option timeout and headers, but it still the same case.  Only when I left the only option url, it can run correctly.\r\nIt seems the options for this session.get are not available.\r\n\r\nmy aiohttp is 3.4.4 and my OS is windows 10.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3408/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3408/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3402", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3402/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3402/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3402/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3402", "id": 382810708, "node_id": "MDU6SXNzdWUzODI4MTA3MDg=", "number": 3402, "title": "3.4.4 - invalid constant string when no response headers.", "user": {"login": "niemyjski", "id": 1020579, "node_id": "MDQ6VXNlcjEwMjA1Nzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1020579?v=4", "gravatar_id": "", "url": "https://api.github.com/users/niemyjski", "html_url": "https://github.com/niemyjski", "followers_url": "https://api.github.com/users/niemyjski/followers", "following_url": "https://api.github.com/users/niemyjski/following{/other_user}", "gists_url": "https://api.github.com/users/niemyjski/gists{/gist_id}", "starred_url": "https://api.github.com/users/niemyjski/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/niemyjski/subscriptions", "organizations_url": "https://api.github.com/users/niemyjski/orgs", "repos_url": "https://api.github.com/users/niemyjski/repos", "events_url": "https://api.github.com/users/niemyjski/events{/privacy}", "received_events_url": "https://api.github.com/users/niemyjski/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 58986080, "node_id": "MDU6TGFiZWw1ODk4NjA4MA==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/wontfix", "name": "wontfix", "color": "b7942c", "default": true, "description": ""}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2018-11-20T19:16:50Z", "updated_at": "2019-11-22T08:01:17Z", "closed_at": "2018-11-22T07:53:23Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "I noticed that my request are failing and that no response headers are returned when this happens. If I go into chrome and click copy response headers it gives me `HTTP/0.9 200 OK`\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/Users/blake/Code/home-assistant-fork/lib/python3.7/site-packages/aiohttp/client_reqrep.py\", line 757, in start\r\n    message, payload = await self._protocol.read()\r\n  File \"/Users/blake/Code/home-assistant-fork/lib/python3.7/site-packages/aiohttp/streams.py\", line 543, in read\r\n    await self._waiter\r\n  File \"/Users/blake/Code/home-assistant-fork/lib/python3.7/site-packages/aiohttp/client_proto.py\", line 195, in data_received\r\n    messages, upgraded, tail = self._parser.feed_data(data)\r\n  File \"aiohttp/_http_parser.pyx\", line 523, in aiohttp._http_parser.HttpParser.feed_data\r\naiohttp.http_exceptions.BadHttpMessage: 400, message='invalid constant string'\r\n```\r\n\r\n![image](https://user-images.githubusercontent.com/1020579/48796872-5d6e7580-ecc6-11e8-92cc-a2fa135e759e.png)\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3402/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3402/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3400", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3400/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3400/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3400/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3400", "id": 382750729, "node_id": "MDU6SXNzdWUzODI3NTA3Mjk=", "number": 3400, "title": "Any way to declare type of path parameters ?", "user": {"login": "buxx", "id": 1104637, "node_id": "MDQ6VXNlcjExMDQ2Mzc=", "avatar_url": "https://avatars.githubusercontent.com/u/1104637?v=4", "gravatar_id": "", "url": "https://api.github.com/users/buxx", "html_url": "https://github.com/buxx", "followers_url": "https://api.github.com/users/buxx/followers", "following_url": "https://api.github.com/users/buxx/following{/other_user}", "gists_url": "https://api.github.com/users/buxx/gists{/gist_id}", "starred_url": "https://api.github.com/users/buxx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/buxx/subscriptions", "organizations_url": "https://api.github.com/users/buxx/orgs", "repos_url": "https://api.github.com/users/buxx/repos", "events_url": "https://api.github.com/users/buxx/events{/privacy}", "received_events_url": "https://api.github.com/users/buxx/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 58986079, "node_id": "MDU6TGFiZWw1ODk4NjA3OQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/question", "name": "question", "color": "cc317c", "default": true, "description": "StackOverflow"}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-11-20T16:40:16Z", "updated_at": "2019-11-21T08:01:14Z", "closed_at": "2018-11-21T07:50:59Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Story\r\n\r\nWhen declare a path with regex, parameters can't be delcared with a type.\r\n\r\n## Actual behaviour\r\n\r\nAll path parameters are string.\r\n\r\n## Steps to reproduce\r\n\r\n``` python\r\nfrom aiohttp import web\r\n\r\n\r\nasync def handle(request):\r\n    name = request.match_info.get('id', 42)\r\n    text = str(type(name))\r\n    return web.Response(text=text)\r\n\r\napp = web.Application()\r\napp.add_routes([web.get('/', handle),\r\n                web.get(r'/{id:\\d+}', handle)])\r\n\r\nweb.run_app(app)\r\n```\r\n\r\n``` bash\r\n$ http :8080/42\r\nHTTP/1.1 200 OK\r\nContent-Length: 13\r\nContent-Type: text/plain; charset=utf-8\r\nDate: Tue, 20 Nov 2018 16:33:58 GMT\r\nServer: Python/3.7 aiohttp/3.4.4\r\n\r\n<class 'str'>\r\n```\r\n## My question/issue\r\n\r\nIt exist a way to declare the type of path parameters ? I would like obtain an `int` in this example.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3400/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3400/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3394", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3394/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3394/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3394/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3394", "id": 381878385, "node_id": "MDU6SXNzdWUzODE4NzgzODU=", "number": 3394, "title": "Process ETIMEDOUT (TimeoutError) on both server and client sides", "user": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/23", "html_url": "https://github.com/aio-libs/aiohttp/milestone/23", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/23/labels", "id": 3750427, "node_id": "MDk6TWlsZXN0b25lMzc1MDQyNw==", "number": 23, "title": "3.5", "description": "aiohttp 3.5 release", "creator": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 10, "state": "closed", "created_at": "2018-10-18T20:38:29Z", "updated_at": "2020-10-24T09:08:08Z", "due_on": null, "closed_at": "2019-10-12T16:34:27Z"}, "comments": 2, "created_at": "2018-11-17T16:34:15Z", "updated_at": "2020-06-24T20:01:54Z", "closed_at": "2019-06-14T12:23:52Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "body": "See https://github.com/aio-libs/aiohttp/issues/3202#issuecomment-439629500\r\n\r\nBasically, we have to close the connection if TCP keepalive timeout was expired.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3394/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3394/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3393", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3393/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3393/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3393/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3393", "id": 381815244, "node_id": "MDU6SXNzdWUzODE4MTUyNDQ=", "number": 3393, "title": "Fatal error on SSL transport", "user": {"login": "yjqiang", "id": 8900942, "node_id": "MDQ6VXNlcjg5MDA5NDI=", "avatar_url": "https://avatars.githubusercontent.com/u/8900942?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yjqiang", "html_url": "https://github.com/yjqiang", "followers_url": "https://api.github.com/users/yjqiang/followers", "following_url": "https://api.github.com/users/yjqiang/following{/other_user}", "gists_url": "https://api.github.com/users/yjqiang/gists{/gist_id}", "starred_url": "https://api.github.com/users/yjqiang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yjqiang/subscriptions", "organizations_url": "https://api.github.com/users/yjqiang/orgs", "repos_url": "https://api.github.com/users/yjqiang/repos", "events_url": "https://api.github.com/users/yjqiang/events{/privacy}", "received_events_url": "https://api.github.com/users/yjqiang/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 15, "created_at": "2018-11-17T01:42:49Z", "updated_at": "2019-11-26T13:01:18Z", "closed_at": "2018-11-26T11:43:42Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "Fatal error on SSL transport\r\nprotocol: <asyncio.sslproto.SSLProtocol object at 0x114b81518>\r\ntransport: <_SelectorSocketTransport fd=132 read=polling write=<idle, bufsize=0>>\r\nTraceback (most recent call last):\r\n  File \"/private/var/mobile/Containers/Shared/AppGroup/383B28C1-6DCF-40D8-AB53-B5F7548B7F79/Pythonista3/Documents/site-packages-3/aiohttp/client.py\", line 391, in _request\r\n    await resp.start(conn)\r\n  File \"/private/var/mobile/Containers/Shared/AppGroup/383B28C1-6DCF-40D8-AB53-B5F7548B7F79/Pythonista3/Documents/site-packages-3/aiohttp/client_reqrep.py\", line 770, in start\r\n    self._continue = None\r\n  File \"/private/var/mobile/Containers/Shared/AppGroup/383B28C1-6DCF-40D8-AB53-B5F7548B7F79/Pythonista3/Documents/site-packages-3/aiohttp/helpers.py\", line 673, in __exit__\r\n    raise asyncio.TimeoutError from None\r\nconcurrent.futures._base.TimeoutError\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/var/containers/Bundle/Application/84DF3BDF-B442-41B6-93B3-AB45EDA9E5FC/Pythonista3.app/Frameworks/Py3Kit.framework/pylib/asyncio/sslproto.py\", line 640, in _process_write_backlog\r\n    ssldata = self._sslpipe.shutdown(self._finalize)\r\n  File \"/var/containers/Bundle/Application/84DF3BDF-B442-41B6-93B3-AB45EDA9E5FC/Pythonista3.app/Frameworks/Py3Kit.framework/pylib/asyncio/sslproto.py\", line 156, in shutdown\r\n    ssldata, appdata = self.feed_ssldata(b'')\r\n  File \"/var/containers/Bundle/Application/84DF3BDF-B442-41B6-93B3-AB45EDA9E5FC/Pythonista3.app/Frameworks/Py3Kit.framework/pylib/asyncio/sslproto.py\", line 220, in feed_ssldata\r\n    self._sslobj.unwrap()\r\n  File \"/var/containers/Bundle/Application/84DF3BDF-B442-41B6-93B3-AB45EDA9E5FC/Pythonista3.app/Frameworks/Py3Kit.framework/pylib/ssl.py\", line 692, in unwrap\r\n    return self._sslobj.shutdown()\r\nssl.SSLError: [SSL] called a function you should not call (_ssl.c:2299)", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3393/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3393/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3392", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3392/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3392/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3392/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3392", "id": 381636548, "node_id": "MDU6SXNzdWUzODE2MzY1NDg=", "number": 3392, "title": "Testsuite fails with latest pytest version", "user": {"login": "glaubitz", "id": 1647645, "node_id": "MDQ6VXNlcjE2NDc2NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/1647645?v=4", "gravatar_id": "", "url": "https://api.github.com/users/glaubitz", "html_url": "https://github.com/glaubitz", "followers_url": "https://api.github.com/users/glaubitz/followers", "following_url": "https://api.github.com/users/glaubitz/following{/other_user}", "gists_url": "https://api.github.com/users/glaubitz/gists{/gist_id}", "starred_url": "https://api.github.com/users/glaubitz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/glaubitz/subscriptions", "organizations_url": "https://api.github.com/users/glaubitz/orgs", "repos_url": "https://api.github.com/users/glaubitz/repos", "events_url": "https://api.github.com/users/glaubitz/events{/privacy}", "received_events_url": "https://api.github.com/users/glaubitz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-11-16T15:06:19Z", "updated_at": "2019-12-07T17:02:16Z", "closed_at": "2018-12-07T16:41:10Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "The testsuite fails when using a recent version of ```pytest``` with:\r\n\r\n```\r\n[  106s] ============================= test session starts ==============================\r\n[  106s] platform linux -- Python 3.6.5, pytest-3.10.0, py-1.7.0, pluggy-0.8.0\r\n[  106s] rootdir: /home/abuild/rpmbuild/BUILD/aiohttp-3.4.4, inifile: setup.cfg\r\n[  106s] plugins: timeout-1.3.2, mock-1.10.0\r\n[  113s] collected 2320 items / 2 errors\r\n[  113s] \r\n[  113s] ==================================== ERRORS ====================================\r\n[  113s] _______________ ERROR collecting tests/test_client_connection.py _______________\r\n[  113s] tests/test_client_connection.py:14: in <module>\r\n[  113s]     @pytest.fixture\r\n[  113s] /usr/lib/python3.6/site-packages/_pytest/fixtures.py:1094: in fixture\r\n[  113s]     return FixtureFunctionMarker(\"function\", params, autouse, name=name)(scope)\r\n[  113s] /usr/lib/python3.6/site-packages/_pytest/fixtures.py:1042: in __call__\r\n[  113s]     warnings.warn(FIXTURE_NAMED_REQUEST)\r\n[  113s] E   _pytest.warning_types.PytestDeprecationWarning: 'request' is a reserved name for fixtures and will raise an error in future versions\r\n[  113s] ________________ ERROR collecting tests/test_web_exceptions.py _________________\r\n[  113s] tests/test_web_exceptions.py:17: in <module>\r\n[  113s]     @pytest.fixture\r\n[  113s] /usr/lib/python3.6/site-packages/_pytest/fixtures.py:1094: in fixture\r\n[  113s]     return FixtureFunctionMarker(\"function\", params, autouse, name=name)(scope)\r\n[  113s] /usr/lib/python3.6/site-packages/_pytest/fixtures.py:1042: in __call__\r\n[  113s]     warnings.warn(FIXTURE_NAMED_REQUEST)\r\n[  113s] /usr/lib/python3.6/site-packages/_pytest/runner.py:212: in __init__\r\n[  113s]     self.result = func()\r\n[  113s] /usr/lib/python3.6/site-packages/_pytest/runner.py:272: in <lambda>\r\n[  113s]     call = CallInfo(lambda: list(collector.collect()), \"collect\")\r\n[  113s] /usr/lib/python3.6/site-packages/_pytest/python.py:443: in collect\r\n[  113s]     self.session._fixturemanager.parsefactories(self)\r\n[  113s] /usr/lib/python3.6/site-packages/_pytest/fixtures.py:1301: in parsefactories\r\n[  113s]     holderobj = node_or_obj.obj\r\n[  113s] /usr/lib/python3.6/site-packages/_pytest/python.py:248: in fget\r\n[  113s]     self._obj = obj = self._getobj()\r\n[  113s] /usr/lib/python3.6/site-packages/_pytest/python.py:440: in _getobj\r\n[  113s]     return self._importtestmodule()\r\n[  113s] /usr/lib/python3.6/site-packages/_pytest/python.py:450: in _importtestmodule\r\n[  113s]     mod = self.fspath.pyimport(ensuresyspath=importmode)\r\n[  113s] /usr/lib/python3.6/site-packages/py/_path/local.py:668: in pyimport\r\n[  113s]     __import__(modname)\r\n[  113s] <frozen importlib._bootstrap>:971: in _find_and_load\r\n[  113s]     ???\r\n[  113s] <frozen importlib._bootstrap>:955: in _find_and_load_unlocked\r\n[  113s]     ???\r\n[  113s] <frozen importlib._bootstrap>:656: in _load_unlocked\r\n[  113s]     ???\r\n[  113s] <frozen importlib._bootstrap>:626: in _load_backward_compatible\r\n[  113s]     ???\r\n[  113s] /usr/lib/python3.6/site-packages/_pytest/assertion/rewrite.py:294: in load_module\r\n[  113s]     six.exec_(co, mod.__dict__)\r\n[  113s] tests/test_client_connection.py:14: in <module>\r\n[  113s]     @pytest.fixture\r\n[  113s] /usr/lib/python3.6/site-packages/_pytest/fixtures.py:1094: in fixture\r\n[  113s]     return FixtureFunctionMarker(\"function\", params, autouse, name=name)(scope)\r\n[  113s] /usr/lib/python3.6/site-packages/_pytest/fixtures.py:1042: in __call__\r\n[  113s]     warnings.warn(FIXTURE_NAMED_REQUEST)\r\n[  113s] E   _pytest.warning_types.PytestDeprecationWarning: 'request' is a reserved name for fixtures and will raise an error in future versions\r\n[  113s] !!!!!!!!!!!!!!!!!!! Interrupted: 2 errors during collection !!!!!!!!!!!!!!!!!!!!\r\n[  113s] =========================== 2 error in 7.04 seconds ============================\r\n```\r\n\r\nThis seems to be a result of ```aiohttp``` using deprecated features of ```pytest```.\r\n\r\nFull build log available at: https://build.opensuse.org/build/devel:languages:python/openSUSE_Tumbleweed/x86_64/python-aiohttp/_log", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3392/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3392/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3390", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3390/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3390/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3390/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3390", "id": 381250690, "node_id": "MDU6SXNzdWUzODEyNTA2OTA=", "number": 3390, "title": "redirects?", "user": {"login": "jrmlhermitte", "id": 705366, "node_id": "MDQ6VXNlcjcwNTM2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/705366?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jrmlhermitte", "html_url": "https://github.com/jrmlhermitte", "followers_url": "https://api.github.com/users/jrmlhermitte/followers", "following_url": "https://api.github.com/users/jrmlhermitte/following{/other_user}", "gists_url": "https://api.github.com/users/jrmlhermitte/gists{/gist_id}", "starred_url": "https://api.github.com/users/jrmlhermitte/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jrmlhermitte/subscriptions", "organizations_url": "https://api.github.com/users/jrmlhermitte/orgs", "repos_url": "https://api.github.com/users/jrmlhermitte/repos", "events_url": "https://api.github.com/users/jrmlhermitte/events{/privacy}", "received_events_url": "https://api.github.com/users/jrmlhermitte/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 445958404, "node_id": "MDU6TGFiZWw0NDU5NTg0MDQ=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/documentation", "name": "documentation", "color": "0075ca", "default": true, "description": "Improvements or additions to documentation"}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2018-11-15T16:52:42Z", "updated_at": "2019-11-21T17:01:14Z", "closed_at": "2018-11-21T16:31:50Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\n\r\nI am trying to get url resolution after redirects to work with aiohttp.\r\nWithout, it is simple:\r\n```py3\r\nimport requests\r\n\r\nresolved_url = requests.get(url).url\r\n```\r\n\r\nHowever, when I try to do the same sort of thing with aiohttp, the url I am getting is not the resolved url after redirects. Here is the code:\r\n\r\n```py3\r\nimport asyncio\r\nfrom aiohttp import ClientSession\r\n\r\nfrom charybdis.utils.web_utils import resolve_url\r\nasync def fetch(url, session):\r\n    async with session.get(url, allow_redirects=True) as response:\r\n        return response.url\r\n\r\nasync def resolve_urls(urls):\r\n    tasks = []\r\n    async with ClientSession() as session:\r\n        for url in urls:\r\n            task = asyncio.ensure_future(fetch(url, session))\r\n            tasks.append(task)\r\n\r\n        urls = await asyncio.gather(*tasks)\r\n        # you now have all response bodies in this variable\r\n        print(urls)\r\n        return urls\r\n\r\n\r\nloop = asyncio.get_event_loop()\r\nfuture = asyncio.ensure_future(resolve_urls(urls))\r\nloop.run_until_complete(future)\r\n```\r\n\r\n\r\nIs this a bug or intended?", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3390/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3390/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3387", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3387/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3387/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3387/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3387", "id": 379079735, "node_id": "MDU6SXNzdWUzNzkwNzk3MzU=", "number": 3387, "title": "DeprecationWarning: router argument is deprecated", "user": {"login": "rob-blackbourn", "id": 2880305, "node_id": "MDQ6VXNlcjI4ODAzMDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2880305?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rob-blackbourn", "html_url": "https://github.com/rob-blackbourn", "followers_url": "https://api.github.com/users/rob-blackbourn/followers", "following_url": "https://api.github.com/users/rob-blackbourn/following{/other_user}", "gists_url": "https://api.github.com/users/rob-blackbourn/gists{/gist_id}", "starred_url": "https://api.github.com/users/rob-blackbourn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rob-blackbourn/subscriptions", "organizations_url": "https://api.github.com/users/rob-blackbourn/orgs", "repos_url": "https://api.github.com/users/rob-blackbourn/repos", "events_url": "https://api.github.com/users/rob-blackbourn/events{/privacy}", "received_events_url": "https://api.github.com/users/rob-blackbourn/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 58986079, "node_id": "MDU6TGFiZWw1ODk4NjA3OQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/question", "name": "question", "color": "cc317c", "default": true, "description": "StackOverflow"}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2018-11-09T09:11:24Z", "updated_at": "2019-11-11T14:00:56Z", "closed_at": "2018-11-11T13:16:21Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "Fantastic project!\r\n\r\nI have a project [aiohttp-route-middleware](https://github.com/rob-blackbourn/aiohttp-route-middleware) which uses the `router` parameter on the `aiohttp.web.Application` class constructor.\r\n\r\n```python\r\nfrom aiohttp import web\r\nfrom aiohttp_route_middleware import UrlDispatcherEx\r\napp = web.Application(router=UrlDispatcherEx())\r\n```\r\n\r\nI've just noticed this parameter has become deprecated. \r\n\r\nWhat should I do instead?\r\n\r\nThanks,\r\n\r\nRob\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3387/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3387/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3386", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3386/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3386/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3386/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3386", "id": 378737197, "node_id": "MDU6SXNzdWUzNzg3MzcxOTc=", "number": 3386, "title": "How to get the IP of a web page visitor", "user": {"login": "LeeYuze", "id": 21166839, "node_id": "MDQ6VXNlcjIxMTY2ODM5", "avatar_url": "https://avatars.githubusercontent.com/u/21166839?v=4", "gravatar_id": "", "url": "https://api.github.com/users/LeeYuze", "html_url": "https://github.com/LeeYuze", "followers_url": "https://api.github.com/users/LeeYuze/followers", "following_url": "https://api.github.com/users/LeeYuze/following{/other_user}", "gists_url": "https://api.github.com/users/LeeYuze/gists{/gist_id}", "starred_url": "https://api.github.com/users/LeeYuze/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/LeeYuze/subscriptions", "organizations_url": "https://api.github.com/users/LeeYuze/orgs", "repos_url": "https://api.github.com/users/LeeYuze/repos", "events_url": "https://api.github.com/users/LeeYuze/events{/privacy}", "received_events_url": "https://api.github.com/users/LeeYuze/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-11-08T13:44:41Z", "updated_at": "2019-11-08T14:00:53Z", "closed_at": "2018-11-08T13:53:57Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "My English is not good. I hope you can give the code directly. If someone visits the website I built with aiohttp, how can I get his IP address?\r\n\u8fd8\u6709\u5982\u4f55\u9650\u5236\u4e00\u4e2aIP\u8bbf\u95ee\u591a\u6b21", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3386/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3386/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3385", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3385/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3385/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3385/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3385", "id": 378675962, "node_id": "MDU6SXNzdWUzNzg2NzU5NjI=", "number": 3385, "title": "Disable body parameter in HTTPException constructor", "user": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 58986077, "node_id": "MDU6TGFiZWw1ODk4NjA3Nw==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/enhancement", "name": "enhancement", "color": "84b6eb", "default": true, "description": null}, {"id": 277836062, "node_id": "MDU6TGFiZWwyNzc4MzYwNjI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/good%20first%20issue", "name": "good first issue", "color": "7057ff", "default": true, "description": "Good for newcomers"}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2018-11-08T10:47:44Z", "updated_at": "2020-05-20T20:32:03Z", "closed_at": "2018-12-02T15:24:46Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "body": "Now the exception can be created with either `body` or `text`.\r\nIt over complicates things in a light of removing inheritance from `web.Response`.\r\n\r\nLet's deprecate `body` before changing the inheritance hierarchy.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3385/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3385/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3380", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3380/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3380/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3380/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3380", "id": 377247058, "node_id": "MDU6SXNzdWUzNzcyNDcwNTg=", "number": 3380, "title": "aiohttp server hangs when nginx try to mixin plain http request with failed websocket connection upgrade in one tcp stream.", "user": {"login": "zTrix", "id": 471934, "node_id": "MDQ6VXNlcjQ3MTkzNA==", "avatar_url": "https://avatars.githubusercontent.com/u/471934?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zTrix", "html_url": "https://github.com/zTrix", "followers_url": "https://api.github.com/users/zTrix/followers", "following_url": "https://api.github.com/users/zTrix/following{/other_user}", "gists_url": "https://api.github.com/users/zTrix/gists{/gist_id}", "starred_url": "https://api.github.com/users/zTrix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zTrix/subscriptions", "organizations_url": "https://api.github.com/users/zTrix/orgs", "repos_url": "https://api.github.com/users/zTrix/repos", "events_url": "https://api.github.com/users/zTrix/events{/privacy}", "received_events_url": "https://api.github.com/users/zTrix/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 15, "created_at": "2018-11-05T04:31:47Z", "updated_at": "2019-10-26T10:51:31Z", "closed_at": "2019-10-26T10:51:31Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Long story short\r\n\r\naiohttp server hangs when nginx try to mixin plain http request with failed websocket connection upgrade in one tcp stream.\r\n\r\nThe following tcpdump capture shows what happens in detail.\r\n\r\n![deepinscreenshot_select-area_20181105120935](https://user-images.githubusercontent.com/471934/47977582-df21a900-e0f3-11e8-9153-41ecec704508.png)\r\n\r\n## Expected behaviour\r\n\r\nServer returns something.\r\n\r\n## Actual behaviour\r\n\r\nServer hangs forever without closing tcp connection. Nginx return 504 Gateway timeout to end user.\r\n\r\n## Steps to reproduce\r\n\r\n1. write a simple api server using aiohttp (version 3.4.4 in my case), implement some /api/xxx for testing, leave /ws unimplemented.\r\n2. using nginx to reverse proxy to this api server.\r\n3. user open browser targeting a web page which contains both ws request and api request. Then api query will gateway timeout.\r\n\r\n![deepinscreenshot_select-area_20181105122712](https://user-images.githubusercontent.com/471934/47978021-493b4d80-e0f6-11e8-9a8c-8cc234193467.png)\r\n\r\nExample nginx.conf:\r\n\r\n```\r\n    ...\r\n    location /api/ {\r\n        proxy_pass http://server_backend;\r\n        proxy_http_version 1.1;\r\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\r\n    }\r\n\r\n    location /ws {\r\n        proxy_pass http://server_backend;\r\n        proxy_http_version 1.1;\r\n        proxy_set_header Upgrade $http_upgrade;\r\n        proxy_set_header Connection \"upgrade\";\r\n    }\r\n```\r\n\r\naiohttp server serves `/api/` request, but leave `/ws` unimplemented.\r\n\r\nThen this issue could be reproduced.\r\n\r\n## Your environment\r\n\r\nDocker: nginx:latest\r\nDocker: aiohttp3.4.4 on python:3.7-alpine3.7\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3380/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3380/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3371", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3371/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3371/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3371/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3371", "id": 375481928, "node_id": "MDU6SXNzdWUzNzU0ODE5Mjg=", "number": 3371, "title": "wrong cookies when i use aiohttp.ClientSession(cookies=cookies)", "user": {"login": "KChanDev", "id": 13376295, "node_id": "MDQ6VXNlcjEzMzc2Mjk1", "avatar_url": "https://avatars.githubusercontent.com/u/13376295?v=4", "gravatar_id": "", "url": "https://api.github.com/users/KChanDev", "html_url": "https://github.com/KChanDev", "followers_url": "https://api.github.com/users/KChanDev/followers", "following_url": "https://api.github.com/users/KChanDev/following{/other_user}", "gists_url": "https://api.github.com/users/KChanDev/gists{/gist_id}", "starred_url": "https://api.github.com/users/KChanDev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/KChanDev/subscriptions", "organizations_url": "https://api.github.com/users/KChanDev/orgs", "repos_url": "https://api.github.com/users/KChanDev/repos", "events_url": "https://api.github.com/users/KChanDev/events{/privacy}", "received_events_url": "https://api.github.com/users/KChanDev/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2018-10-30T13:13:25Z", "updated_at": "2020-05-20T19:28:44Z", "closed_at": "2019-05-21T04:47:13Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "I try to update my eBay watch list with the code , i try many time but all failed. btw i use same cookies on `requests` and it done.\r\n\r\n\tproduct_link = \"https://www.ebay.com/itm/PlayStation-4-1TB-Console-Call-of-Duty-Black-Ops-3-Limited-Edition-PS4-w-game/253956457448?epid=218347966&hash=item3b20fc03e8:g:uh0AAOSwQrVb190x:rk:11:pf:0\"\r\n\r\n\tasync def main():\r\n\t\tasync with aiohttp.ClientSession(cookies=cookies,headers=headers) as sessions:\r\n\t\t\tasync with sessions.get(product_link) as resp:\r\n\t\t\t\tr = await resp.text()\r\n\t\t\t\twatch_link = soup(r, \"lxml\").find(\"div\", {\"id\": \"vi-atl-lnk\"}).a.get(\"href\")\r\n\t\t\t\tprint(watch_link)\r\n\t\t\t\t\r\n\t\t\tasync with sessions.get(watch_link) as resp:\r\n\t\t\t\tpass\r\n\t\t\tasync with sessions.get(watch_link) as resp:\r\n\t\t\t\tpass\r\n\r\nBut i successfully update my watch list with `aiohttp.ClientSession(headers=headers)` , the cookies contain in variable `heades`. \r\n\r\nI compared the get request between them , problem may be that cookies convert ; to \\073.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3371/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3371/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3364", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3364/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3364/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3364/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3364", "id": 374338676, "node_id": "MDU6SXNzdWUzNzQzMzg2NzY=", "number": 3364, "title": "HTTP response not released with raise_for_status=True", "user": {"login": "Grendel7", "id": 1823324, "node_id": "MDQ6VXNlcjE4MjMzMjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1823324?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Grendel7", "html_url": "https://github.com/Grendel7", "followers_url": "https://api.github.com/users/Grendel7/followers", "following_url": "https://api.github.com/users/Grendel7/following{/other_user}", "gists_url": "https://api.github.com/users/Grendel7/gists{/gist_id}", "starred_url": "https://api.github.com/users/Grendel7/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Grendel7/subscriptions", "organizations_url": "https://api.github.com/users/Grendel7/orgs", "repos_url": "https://api.github.com/users/Grendel7/repos", "events_url": "https://api.github.com/users/Grendel7/events{/privacy}", "received_events_url": "https://api.github.com/users/Grendel7/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-10-26T11:16:45Z", "updated_at": "2021-01-13T12:57:17Z", "closed_at": "2018-12-01T10:18:01Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nWhen using ClientSession with `raise_for_status=True`, HTTP responses are not released. This means the related TCP connection will remain in `CLOSE_WAIT` state indefinitely, when the called server returns an error status code and a large body. Eventually, these waiting connections will hit the connection limit and cause timeout errors on ALL open connections.\r\n\r\n## Expected behaviour\r\n\r\nWhen using Client Session with `raise_for_status=True`, TCP connections are released properly and they are either closed or reused (depending on keep alive configuration).\r\n\r\n## Actual behaviour\r\n\r\nWhen using Client Session with `raise_for_status=True`, the TCP connections \r\n\r\n## Steps to reproduce\r\n\r\nclient.py\r\n```\r\nfrom aiohttp import ClientSession, ClientResponseError\r\nimport asyncio\r\n\r\n\r\nasync def send_request():\r\n    client = ClientSession(raise_for_status=True)\r\n\r\n    try:\r\n        async with client.get('http://hansadema.com/404.php') as response:\r\n            print('Received good status %d' % response.status)\r\n    except ClientResponseError as e:\r\n        print('Received bad status %d' % e.status)\r\n\r\n\r\nloop = asyncio.get_event_loop()\r\nasyncio.ensure_future(send_request())\r\nloop.run_forever()\r\n```\r\n\r\nDockerfile\r\n```\r\nFROM python:3.6-slim\r\n\r\nCOPY . /usr/src/app\r\nRUN pip install aiohttp\r\n\r\nCMD python /usr/src/app/client.py\r\n```\r\n\r\nCommands:\r\n```\r\n$ docker build -t aiohttp-test .\r\n$ docker run --rm --name aiohttp-test aiohttp-test\r\n# Linux command to check open connections\r\n$ sudo nsenter -t (docker inspect -f '{{.State.Pid}}' \"aiohttp-test\") -n ss --numeric --tcp\r\n```\r\n\r\n## Your environment\r\n\r\naiohttp 3.4.4\r\nPython 3.6.6\r\nDebian 9.5", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3364/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3364/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3361", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3361/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3361/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3361/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3361", "id": 373332201, "node_id": "MDU6SXNzdWUzNzMzMzIyMDE=", "number": 3361, "title": "StreamReader.readchunk returns false-negative indicator end_of_HTTP_chunk", "user": {"login": "mnacharov", "id": 1246847, "node_id": "MDQ6VXNlcjEyNDY4NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/1246847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mnacharov", "html_url": "https://github.com/mnacharov", "followers_url": "https://api.github.com/users/mnacharov/followers", "following_url": "https://api.github.com/users/mnacharov/following{/other_user}", "gists_url": "https://api.github.com/users/mnacharov/gists{/gist_id}", "starred_url": "https://api.github.com/users/mnacharov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mnacharov/subscriptions", "organizations_url": "https://api.github.com/users/mnacharov/orgs", "repos_url": "https://api.github.com/users/mnacharov/repos", "events_url": "https://api.github.com/users/mnacharov/events{/privacy}", "received_events_url": "https://api.github.com/users/mnacharov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2018-10-24T06:58:25Z", "updated_at": "2019-12-05T22:17:25Z", "closed_at": "2018-12-05T21:12:53Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\n[readchunk](https://docs.aiohttp.org/en/stable/streams.html#aiohttp.StreamReader.readchunk) function returns False after full chunk received. \r\nIt causes unexpected delays and complicated chunk parser in chunk-dependent protocols (In our case: \"Watch keys\" in [etcd HTTP API](https://github.com/etcd-io/etcd/blob/master/Documentation/dev-guide/api_grpc_gateway.md))\r\n\r\n## Expected behaviour\r\n\r\n`end_of_HTTP_chunk` indicator equals `True` when full chunk received.\r\n\r\n## Actual behaviour\r\n\r\nindicator equals `False` when tail of chunk ('\\r\\n') comes separately or with next chunk\r\n\r\n## Steps to reproduce\r\n\r\nSimple web-server to reproduce the issue:\r\n```python\r\nimport socket\r\nimport time\r\n\r\n\r\ndef main():\r\n    ls = socket.socket()\r\n    ls.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)\r\n    ls.bind(('0.0.0.0', 1234))\r\n    ls.listen(1)\r\n    print('server is up')\r\n    while True:\r\n        s, addr = ls.accept()\r\n        s.setsockopt(socket.SOL_TCP, socket.TCP_NODELAY, 1)\r\n        # read request\r\n        request = b''\r\n        while True:\r\n            data = s.recv(65536)\r\n            if not data:\r\n                print('err')\r\n                return\r\n            request += data\r\n            if b'\\r\\n\\r\\n' in request:\r\n                break\r\n        print('read complete')\r\n        # send headers\r\n        s.send(b'\\r\\n'.join([\r\n            b'HTTP/1.0 200 OK',\r\n            b'transfer-encoding: chunked',\r\n            b'connection: close',\r\n            b'',\r\n            b'',\r\n        ]))\r\n        # send first part of the chunk\r\n        s.send(b'3\\r\\n***')\r\n        time.sleep(0.1)\r\n        # end of chunk\r\n        s.send(b'\\r\\n')\r\n        # time.sleep(0.1)   # uncomment to send end of chunk separately\r\n        # next chunk\r\n        s.send(b'5\\r\\n@@@@@\\r\\n')\r\n        s.send(b'0\\r\\n\\r\\n')\r\n        s.close()\r\n\r\nmain()\r\n```\r\n\r\nClient side:\r\n```python\r\nimport asyncio\r\nimport aiohttp\r\n\r\n\r\nasync def main():\r\n    async with aiohttp.ClientSession() as session:\r\n        async with session.get(url='http://localhost:1234/', timeout=None) as resp:\r\n            buffer = b\"\"\r\n            async for raw_data, end_of_http_chunk in resp.content.iter_chunks():\r\n                print(raw_data, end_of_http_chunk)\r\n                buffer += raw_data\r\n                if not end_of_http_chunk:\r\n                    continue\r\n                print('full chunk received', buffer)\r\n                buffer = b\"\"\r\n            print('stop iteration', buffer)\r\n\r\nloop = asyncio.get_event_loop()\r\nloop.run_until_complete(main())\r\n```\r\n\r\nExpected result:\r\n```\r\nb'***' True\r\nfull chunk received b'***'\r\nb'@@@@@' True\r\nfull chunk received b'@@@@@'\r\nstop iteration b''\r\n```\r\nActual:\r\n```\r\nb'***' False\r\nb'@@@@@' True\r\nfull chunk received b'***@@@@@'\r\nstop iteration b''\r\n```\r\n\r\n## Environment\r\n\r\nclient side issue\r\naiohttp: 3.2.0, 3.4.4, master\r\nOS: linux", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3361/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3361/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3359", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3359/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3359/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3359/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3359", "id": 372739527, "node_id": "MDU6SXNzdWUzNzI3Mzk1Mjc=", "number": 3359, "title": "window10 ProactorEventLoop does't not exit normally when task has finished", "user": {"login": "woshimanong1990", "id": 13585117, "node_id": "MDQ6VXNlcjEzNTg1MTE3", "avatar_url": "https://avatars.githubusercontent.com/u/13585117?v=4", "gravatar_id": "", "url": "https://api.github.com/users/woshimanong1990", "html_url": "https://github.com/woshimanong1990", "followers_url": "https://api.github.com/users/woshimanong1990/followers", "following_url": "https://api.github.com/users/woshimanong1990/following{/other_user}", "gists_url": "https://api.github.com/users/woshimanong1990/gists{/gist_id}", "starred_url": "https://api.github.com/users/woshimanong1990/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/woshimanong1990/subscriptions", "organizations_url": "https://api.github.com/users/woshimanong1990/orgs", "repos_url": "https://api.github.com/users/woshimanong1990/repos", "events_url": "https://api.github.com/users/woshimanong1990/events{/privacy}", "received_events_url": "https://api.github.com/users/woshimanong1990/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2018-10-22T23:22:17Z", "updated_at": "2019-10-28T00:01:32Z", "closed_at": "2018-10-23T05:37:06Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\n<!-- Please describe your problem and why the fix is important. -->\r\n\r\n## Expected behaviour\r\n`# coding:utf-8\r\n\r\nimport aiohttp\r\nimport asyncio\r\n\r\n\r\nasync def fetch(session, url):\r\n    async with session.get(url) as response:\r\n        return await response.text()\r\n\r\n\r\nasync def main():\r\n    async with aiohttp.ClientSession() as session:\r\n        html = await fetch(session, 'http://python.org')\r\n        print(html)\r\n\r\nloop = asyncio.ProactorEventLoop()\r\nasyncio.set_event_loop(loop)\r\nloop = asyncio.get_event_loop()\r\nloop.run_until_complete(main())`\r\n<!-- What is the behaviour you expect? -->\r\nIt exits normalley; However, when I use SelectorEventLoop, it works!\r\n## Actual behaviour\r\nIn face ,the program does't not exit; When I write result to a file, the content is not written to file;\r\n<!-- What's actually happening? -->\r\nIt does't exit; when I attempt to close the loop, Error happen;\r\n`Exception ignored in: <bound method _ProactorBasePipeTransport.__del__ of <_ProactorSocketTransport closing fd=836 read=<_OverlappedFuture cancelled>>>\r\nTraceback (most recent call last):\r\n  File \"d:\\software\\programe\\python35\\Lib\\asyncio\\proactor_events.py\", line 96, in __del__\r\n    self.close()\r\n  File \"d:\\software\\programe\\python35\\Lib\\asyncio\\proactor_events.py\", line 84, in close\r\n    self._loop.call_soon(self._call_connection_lost, None)\r\n  File \"d:\\software\\programe\\python35\\Lib\\asyncio\\base_events.py\", line 572, in call_soon\r\n    self._check_closed()\r\n  File \"d:\\software\\programe\\python35\\Lib\\asyncio\\base_events.py\", line 357, in _check_closed\r\n    raise RuntimeError('Event loop is closed')\r\nRuntimeError: Event loop is closed\r\nException ignored in: <bound method _ProactorBasePipeTransport.__del__ of <_ProactorSocketTransport closing fd=876 read=<_OverlappedFuture cancelled>>>\r\nTraceback (most recent call last):\r\n  File \"d:\\software\\programe\\python35\\Lib\\asyncio\\proactor_events.py\", line 96, in __del__\r\n    self.close()\r\n  File \"d:\\software\\programe\\python35\\Lib\\asyncio\\proactor_events.py\", line 84, in close\r\n    self._loop.call_soon(self._call_connection_lost, None)\r\n  File \"d:\\software\\programe\\python35\\Lib\\asyncio\\base_events.py\", line 572, in call_soon\r\n    self._check_closed()\r\n  File \"d:\\software\\programe\\python35\\Lib\\asyncio\\base_events.py\", line 357, in _check_closed\r\n    raise RuntimeError('Event loop is closed')\r\nRuntimeError: Event loop is closed\r\n`\r\n## Steps to reproduce\r\nrun the code \r\n`# coding:utf-8\r\n\r\nimport aiohttp\r\nimport asyncio\r\n\r\n\r\nasync def fetch(session, url):\r\n    async with session.get(url) as response:\r\n        return await response.text()\r\n\r\n\r\nasync def main():\r\n    async with aiohttp.ClientSession() as session:\r\n        html = await fetch(session, 'http://python.org')\r\n        print(html)\r\n\r\nloop = asyncio.ProactorEventLoop()\r\nasyncio.set_event_loop(loop)\r\nloop = asyncio.get_event_loop()\r\nloop.run_until_complete(main())\r\nloop.close()`\r\n<!-- Please describe steps to reproduce the issue.\r\n     If you have a script that does that please include it here within\r\n     markdown code markup -->\r\n\r\n## Your environment\r\nwindow10 +  python 3.5.3\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case. \r\n     \r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3359/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3359/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3347", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3347/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3347/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3347/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3347", "id": 370582429, "node_id": "MDU6SXNzdWUzNzA1ODI0Mjk=", "number": 3347, "title": "`aiohttp.ClientSession.get` context manager gives `AttributeError: __aexit__`", "user": {"login": "bradwood", "id": 3472045, "node_id": "MDQ6VXNlcjM0NzIwNDU=", "avatar_url": "https://avatars.githubusercontent.com/u/3472045?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bradwood", "html_url": "https://github.com/bradwood", "followers_url": "https://api.github.com/users/bradwood/followers", "following_url": "https://api.github.com/users/bradwood/following{/other_user}", "gists_url": "https://api.github.com/users/bradwood/gists{/gist_id}", "starred_url": "https://api.github.com/users/bradwood/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bradwood/subscriptions", "organizations_url": "https://api.github.com/users/bradwood/orgs", "repos_url": "https://api.github.com/users/bradwood/repos", "events_url": "https://api.github.com/users/bradwood/events{/privacy}", "received_events_url": "https://api.github.com/users/bradwood/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2018-10-16T12:15:34Z", "updated_at": "2019-10-28T00:01:57Z", "closed_at": "2018-10-16T14:11:34Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nIt appears as if the context manager on `aiohttp.ClientSession.get` is failing for some reason.\r\nIt works in an isolated test, but when i run it here I get this.  I tried the `get()` without headers too to see if that was upsetting it -- no difference, yet the session looks okay. Timeout is set to 60 sec and it fails well before that. \r\n\r\n## Expected behaviour\r\n\r\nI expect `__aexit__()` to be there and the `async with` to work as normal.\r\n## Actual behaviour\r\n\r\npytest output:\r\n```\r\n        LOGGER.debug(f'Fetch({self}) called started.')\r\n        to_ = ClientTimeout(total=timeout)\r\n        async with ClientSession(timeout=to_) as session:\r\n            LOGGER.debug(f'Client session created: {session}. About to fetch url={self._url}')\r\n            byte_start = 0\r\n            byte_stop = range_size - 1 # as we count from 0\r\n            with open(self._full_path, 'wb') as file_desc:  #TODO: use aiofile\r\n                while True:\r\n                    req_header = {\"Range\": f'bytes={byte_start}-{byte_stop}'}\r\n>                   async with session.get(self._url, headers=req_header) as resp:\r\nE                   AttributeError: __aexit__\r\n\r\nsrc/pyskyq/xmltvlisting.py:183: AttributeError\r\n```\r\n\r\nLog:\r\n```\r\n------------------------------------------------------------ Captured log call ------------------------------------------------------------\r\nepg.py                      66 DEBUG    Initialised EPG object using SkyQ box=test_load_channel_list_fake_host\r\nepg.py                      93 DEBUG    Fetching channel list from http://test_load_channel_list_fake_host:9006/as/services\r\nxmltvlisting.py             76 DEBUG    XMLTVListing initialised: <List: url='http://foo.com/feed/6715', path='.epg_data', filename='ea51e77b9fdede19528d599f50182d37edcdbc082b06358146041fe446f6a855.xml'>\r\nselector_events.py          64 DEBUG    Using selector: KqueueSelector\r\nasyncthread.py             128 DEBUG    Event loop still running in thread: pyskyq.asyncthread\r\nselector_events.py          64 DEBUG    Using selector: KqueueSelector\r\nepg.py                     293 DEBUG    Listing = <List: url='http://foo.com/feed/6715', path='.epg_data', filename='ea51e77b9fdede19528d599f50182d37edcdbc082b06358146041fe446f6a855.xml'>\r\nxmltvlisting.py            174 DEBUG    Fetch(<List: url='http://foo.com/feed/6715', path='.epg_data', filename='ea51e77b9fdede19528d599f50182d37edcdbc082b06358146041fe446f6a855.xml'>) called started.\r\nxmltvlisting.py            177 DEBUG    Client session created: <aiohttp.client.ClientSession object at 0x104e79a90>. About to fetch url=http://foo.com/feed/6715\r\n```\r\n## Steps to reproduce\r\n\r\nAs illustrated above.\r\n\r\n## Your environment\r\nMacOS mojave\r\naiohttp==3.4.4\r\nPython 3.7.0\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3347/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3347/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3345", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3345/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3345/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3345/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3345", "id": 370371691, "node_id": "MDU6SXNzdWUzNzAzNzE2OTE=", "number": 3345, "title": "Fix flake8 dependency for dev environment", "user": {"login": "dbohomiakov", "id": 14893836, "node_id": "MDQ6VXNlcjE0ODkzODM2", "avatar_url": "https://avatars.githubusercontent.com/u/14893836?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dbohomiakov", "html_url": "https://github.com/dbohomiakov", "followers_url": "https://api.github.com/users/dbohomiakov/followers", "following_url": "https://api.github.com/users/dbohomiakov/following{/other_user}", "gists_url": "https://api.github.com/users/dbohomiakov/gists{/gist_id}", "starred_url": "https://api.github.com/users/dbohomiakov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dbohomiakov/subscriptions", "organizations_url": "https://api.github.com/users/dbohomiakov/orgs", "repos_url": "https://api.github.com/users/dbohomiakov/repos", "events_url": "https://api.github.com/users/dbohomiakov/events{/privacy}", "received_events_url": "https://api.github.com/users/dbohomiakov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-10-15T22:42:25Z", "updated_at": "2019-10-28T00:02:03Z", "closed_at": "2018-10-16T08:40:14Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "## Long story short\r\nThere is an inconsistency in the requirements files. In the `requirements/ci-wheel.txt` explicitly defined `pyflakes` with version `2.0.0` but `flake8` which uses `pyflakes` as dependency requires version from the range `>= 1.5.0, < 1.7.0`. The newest version overwrites the required one.\r\n## Expected behaviour\r\n\r\n## Actual behaviour\r\n\r\n## Steps to reproduce\r\n`pip install -r requirements/dev.txt`\r\n## Your environment\r\nMacOS 10.14, python 3.6.5, aiohttp 3.4.4\r\nboth\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3345/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3345/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3335", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3335/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3335/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3335/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3335", "id": 367792430, "node_id": "MDU6SXNzdWUzNjc3OTI0MzA=", "number": 3335, "title": "AttributeError: 'NoneType' object has no attribute 'get_extra_info'", "user": {"login": "vangheem", "id": 524413, "node_id": "MDQ6VXNlcjUyNDQxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/524413?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vangheem", "html_url": "https://github.com/vangheem", "followers_url": "https://api.github.com/users/vangheem/followers", "following_url": "https://api.github.com/users/vangheem/following{/other_user}", "gists_url": "https://api.github.com/users/vangheem/gists{/gist_id}", "starred_url": "https://api.github.com/users/vangheem/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vangheem/subscriptions", "organizations_url": "https://api.github.com/users/vangheem/orgs", "repos_url": "https://api.github.com/users/vangheem/repos", "events_url": "https://api.github.com/users/vangheem/events{/privacy}", "received_events_url": "https://api.github.com/users/vangheem/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2018-10-08T13:32:34Z", "updated_at": "2019-10-28T00:01:54Z", "closed_at": "2018-10-16T19:22:56Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nWhen request object is closed, `request.transport` is set to `None` which causes errors if you want to do any introspection on the request afterwards(like simply doing `request.url`)\r\n\r\n## Expected behaviour\r\n\r\nTo be able to call `request.url` object after it is closed.\r\n\r\n## Actual behaviour\r\n\r\n`request.url` gives:\r\n```\r\nFile \"aiohttp/_helpers.pyx\", line 32, in aiohttp._helpers.reify.__get__\r\n  File \"aiohttp/_helpers.pyx\", line 26, in aiohttp._helpers.reify.__get__\r\n  File \"/Users/nathan/wildcard/castle/lib/python3.6/site-packages/aiohttp/web_request.py\", line 351, in url\r\n    url = URL.build(scheme=self.scheme, host=self.host)\r\n  File \"aiohttp/_helpers.pyx\", line 32, in aiohttp._helpers.reify.__get__\r\n  File \"aiohttp/_helpers.pyx\", line 26, in aiohttp._helpers.reify.__get__\r\n  File \"/Users/nathan/wildcard/castle/lib/python3.6/site-packages/aiohttp/web_request.py\", line 295, in scheme\r\n    if self.transport.get_extra_info('sslcontext'):\r\nAttributeError: 'NoneType' object has no attribute 'get_extra_info'\r\n```\r\n\r\n## Steps to reproduce\r\n\r\n- create server\r\n- finish request\r\n- create new asyncio task with reference request object\r\n\r\n## Your environment\r\n\r\n- Python 3.3.6\r\n- aiohttp 3.4.4\r\n\r\n\r\n## extra\r\n\r\nSimilar to https://github.com/aio-libs/aiohttp/issues/816\r\n\r\n## workaround\r\n\r\nIf you call `request.url` before the request is closed, it will be cached and you will not get this error.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3335/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3335/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3325", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3325/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3325/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3325/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3325", "id": 367439834, "node_id": "MDU6SXNzdWUzNjc0Mzk4MzQ=", "number": 3325, "title": "Tests failing dues to incorrect escaping of RE strings", "user": {"login": "mcepl", "id": 198999, "node_id": "MDQ6VXNlcjE5ODk5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/198999?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mcepl", "html_url": "https://github.com/mcepl", "followers_url": "https://api.github.com/users/mcepl/followers", "following_url": "https://api.github.com/users/mcepl/following{/other_user}", "gists_url": "https://api.github.com/users/mcepl/gists{/gist_id}", "starred_url": "https://api.github.com/users/mcepl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mcepl/subscriptions", "organizations_url": "https://api.github.com/users/mcepl/orgs", "repos_url": "https://api.github.com/users/mcepl/repos", "events_url": "https://api.github.com/users/mcepl/events{/privacy}", "received_events_url": "https://api.github.com/users/mcepl/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1077350962, "node_id": "MDU6TGFiZWwxMDc3MzUwOTYy", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/Hacktoberfest", "name": "Hacktoberfest", "color": "d93f0b", "default": false, "description": "We think it's good for https://hacktoberfest.digitalocean.com/"}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": {"login": "mcepl", "id": 198999, "node_id": "MDQ6VXNlcjE5ODk5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/198999?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mcepl", "html_url": "https://github.com/mcepl", "followers_url": "https://api.github.com/users/mcepl/followers", "following_url": "https://api.github.com/users/mcepl/following{/other_user}", "gists_url": "https://api.github.com/users/mcepl/gists{/gist_id}", "starred_url": "https://api.github.com/users/mcepl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mcepl/subscriptions", "organizations_url": "https://api.github.com/users/mcepl/orgs", "repos_url": "https://api.github.com/users/mcepl/repos", "events_url": "https://api.github.com/users/mcepl/events{/privacy}", "received_events_url": "https://api.github.com/users/mcepl/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "mcepl", "id": 198999, "node_id": "MDQ6VXNlcjE5ODk5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/198999?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mcepl", "html_url": "https://github.com/mcepl", "followers_url": "https://api.github.com/users/mcepl/followers", "following_url": "https://api.github.com/users/mcepl/following{/other_user}", "gists_url": "https://api.github.com/users/mcepl/gists{/gist_id}", "starred_url": "https://api.github.com/users/mcepl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mcepl/subscriptions", "organizations_url": "https://api.github.com/users/mcepl/orgs", "repos_url": "https://api.github.com/users/mcepl/repos", "events_url": "https://api.github.com/users/mcepl/events{/privacy}", "received_events_url": "https://api.github.com/users/mcepl/received_events", "type": "User", "site_admin": false}, {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 10, "created_at": "2018-10-06T09:19:52Z", "updated_at": "2020-01-14T12:38:27Z", "closed_at": "2019-01-14T10:40:25Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\n```\r\n[   53s] platform linux -- Python 3.6.5, pytest-3.8.1, py-1.5.4, pluggy-0.7.1\r\n[   53s] rootdir: /home/abuild/rpmbuild/BUILD/aiohttp-3.4.4, inifile: setup.cfg\r\n[   53s] plugins: timeout-1.3.2, mock-1.10.0\r\n...\r\nbuild/rpmbuild/BUILD/aiohttp-3.4.4/aiohttp/_http_writer.cpython-36m-x86_64-linux-gnu.so\r\n[   70s] ============================= test session starts ==============================\r\n[   70s] platform linux -- Python 3.6.5, pytest-3.8.1, py-1.5.4, pluggy-0.7.1\r\n[   70s] rootdir: /home/abuild/rpmbuild/BUILD/aiohttp-3.4.4, inifile: setup.cfg\r\n[   70s] plugins: timeout-1.3.2, mock-1.10.0\r\n[   77s] collected 1910 items / 4 errors\r\n[   77s] \r\n[   77s] ==================================== ERRORS ====================================\r\n[   77s] __________________ ERROR collecting tests/test_http_parser.py __________________\r\n[   77s] /usr/lib/python3.6/site-packages/_pytest/python.py:482: in _importtestmodule\r\n[   77s]     mod = self.fspath.pyimport(ensuresyspath=importmode)\r\n[   77s] /usr/lib/python3.6/site-packages/py/_path/local.py:668: in pyimport\r\n[   77s]     __import__(modname)\r\n[   77s] E     File \"/home/abuild/rpmbuild/BUILD/aiohttp-3.4.4/tests/test_http_parser.py\", line 372\r\n[   77s] E       match = (\"400, message='Got more than 8190 bytes \\({}\\) when reading\"\r\n[   77s] E               ^\r\n[   77s] E   SyntaxError: invalid escape sequence \\(\r\n[   77s] ____________________ ERROR collecting tests/test_streams.py ____________________\r\n[   77s] /usr/lib/python3.6/site-packages/_pytest/python.py:482: in _importtestmodule\r\n[   77s]     mod = self.fspath.pyimport(ensuresyspath=importmode)\r\n[   77s] /usr/lib/python3.6/site-packages/py/_path/local.py:668: in pyimport\r\n[   77s]     __import__(modname)\r\n[   77s] E     File \"/home/abuild/rpmbuild/BUILD/aiohttp-3.4.4/tests/test_streams.py\", line 724\r\n[   77s] E       assert re.search(\"<StreamReader w=<Future pending[\\S ]*>>\",\r\n[   77s] E                       ^\r\n[   77s] E   SyntaxError: invalid escape sequence \\S\r\n[   77s] __________________ ERROR collecting tests/test_urldispatch.py __________________\r\n[   77s] /usr/lib/python3.6/site-packages/_pytest/python.py:482: in _importtestmodule\r\n[   77s]     mod = self.fspath.pyimport(ensuresyspath=importmode)\r\n[   77s] /usr/lib/python3.6/site-packages/py/_path/local.py:668: in pyimport\r\n[   77s]     __import__(modname)\r\n[   77s] E     File \"/home/abuild/rpmbuild/BUILD/aiohttp-3.4.4/tests/test_urldispatch.py\", line 589\r\n[   77s] E       route = router.add_route('GET', '/get/{num:^\\d+}', handler,\r\n[   77s] E                                      ^\r\n[   77s] E   SyntaxError: invalid escape sequence \\d\r\n[   77s] __________________ ERROR collecting tests/test_web_request.py __________________\r\n[   77s] /usr/lib/python3.6/site-packages/_pytest/python.py:482: in _importtestmodule\r\n[   77s]     mod = self.fspath.pyimport(ensuresyspath=importmode)\r\n[   77s] /usr/lib/python3.6/site-packages/py/_path/local.py:668: in pyimport\r\n[   77s]     __import__(modname)\r\n[   77s] E     File \"/home/abuild/rpmbuild/BUILD/aiohttp-3.4.4/tests/test_web_request.py\", line 343\r\n[   77s] E       header = 'BY=identifier;pROTO=\"\\lala lan\\d\\~ 123\\!&\"'\r\n[   77s] E               ^\r\n[   77s] E   SyntaxError: invalid escape sequence \\l\r\n[   77s] !!!!!!!!!!!!!!!!!!! Interrupted: 4 errors during collection !!!!!!!!!!!!!!!!!!!!\r\n[   77s] =========================== 4 error in 7.42 seconds ============================\r\n[   78s] error: Bad exit status from /var/tmp/rpm-tmp.2YgiWK (%check)\r\n[   78s] \r\n[   78s] \r\n[   78s] RPM build errors:\r\n[   78s]     Bad exit status from /var/tmp/rpm-tmp.2YgiWK (%check)\r\n[   78s] \r\n[   78s] stitny failed \"build python-aiohttp.spec\" at Sat Oct  6 08:56:18 UTC 2018.\r\n[   78s] \r\n```\r\n\r\n## Expected behaviour\r\n\r\nTest suite should pass without problems.\r\n\r\n## Actual behaviour\r\n\r\nIt fails as shown above\r\n\r\n## Steps to reproduce\r\n\r\nJust run testsuite with ``python3 setup.py test``\r\n\r\n## Your environment\r\n```\r\n[  124s] platform linux -- Python 3.6.5, pytest-3.8.1, py-1.5.4, pluggy-0.7.1\r\n```\r\n\r\nchroot build environment for openSUSE, details at [SPEC file](https://github.com/aio-libs/aiohttp/files/2452878/python-aiohttp.spec.txt) and full [build log](https://github.com/aio-libs/aiohttp/files/2452879/python-aiohttp.build-log.txt).\r\n\r\nThis [patch](https://github.com/aio-libs/aiohttp/files/2452880/invalid-escapes-in-tests.patch.txt) fixes the issue.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3325/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3325/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3315", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3315/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3315/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3315/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3315", "id": 366283115, "node_id": "MDU6SXNzdWUzNjYyODMxMTU=", "number": 3315, "title": "ValueError when redirecting to URL with incorrect schema", "user": {"login": "berislavlopac", "id": 754090, "node_id": "MDQ6VXNlcjc1NDA5MA==", "avatar_url": "https://avatars.githubusercontent.com/u/754090?v=4", "gravatar_id": "", "url": "https://api.github.com/users/berislavlopac", "html_url": "https://github.com/berislavlopac", "followers_url": "https://api.github.com/users/berislavlopac/followers", "following_url": "https://api.github.com/users/berislavlopac/following{/other_user}", "gists_url": "https://api.github.com/users/berislavlopac/gists{/gist_id}", "starred_url": "https://api.github.com/users/berislavlopac/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/berislavlopac/subscriptions", "organizations_url": "https://api.github.com/users/berislavlopac/orgs", "repos_url": "https://api.github.com/users/berislavlopac/repos", "events_url": "https://api.github.com/users/berislavlopac/events{/privacy}", "received_events_url": "https://api.github.com/users/berislavlopac/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344995986, "node_id": "MDU6TGFiZWwzNDQ5OTU5ODY=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/client", "name": "client", "color": "bfd4f2", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-10-03T11:00:42Z", "updated_at": "2019-10-28T00:02:18Z", "closed_at": "2018-10-03T16:08:36Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nWhen the Client handles redirection, if the redirected URL contains an incorrect schema, it throws a `ValueError`:\r\n\r\nhttps://github.com/aio-libs/aiohttp/blob/ced10580c1f8f0673ba8b59986f44f8d4605e35d/aiohttp/client.py#L453\r\n\r\nWhile this is technically correct, it is more sensible to expect some kind of more specific error.\r\n\r\n## Expected behaviour\r\n\r\nI would expect the Client to throw an `aiohttp`-specific error, preferably `InvalidURL`.\r\n\r\n## Actual behaviour\r\n\r\nThe Client throws a generic `ValueError`, which is difficult to specifically handle.\r\n\r\n## Steps to reproduce\r\n\r\nCreate a redirection URL, e.g. using an URL shortener like https://tinyurl.com/, and have it redirect to any URL with an incorrect schema, for example `file://foo/bar`. Then, call it with `aiohttp`\r\n\r\n    import aiohttp, asyncio\r\n\r\n    async def get_url(url):\r\n        async with aiohttp.ClientSession() as s, s.get(url) as resp:\r\n            print(await resp.text())\r\n\r\n    asyncio.get_event_loop().run_until_complete(get_url('https://tinyurl.com/y9rf58n8'))\r\n    \r\nOutput:\r\n\r\n    Traceback (most recent call last):\r\n      File \"<stdin>\", line 1, in <module>\r\n      File \"/usr/lib/python3.6/asyncio/base_events.py\", line 468, in run_until_complete\r\n        return future.result()\r\n      File \"<stdin>\", line 2, in get_url\r\n      File \"/home/berislav/.virtualenvs/foobar/lib/python3.6/site-packages/aiohttp/client.py\", line 855, in __aenter__\r\n        self._resp = await self._coro\r\n      File \"/home/berislav/.virtualenvs/foobar/lib/python3.6/site-packages/aiohttp/client.py\", line 456, in _request\r\n        'Can redirect only to http or https')\r\n    ValueError: Can redirect only to http or https\r\n\r\n## Your environment\r\n\r\nPython 3.6.6, and the installed packages:\r\n\r\n    Package       Version\r\n    ------------- -------\r\n    aiohttp       3.4.4  \r\n    async-timeout 3.0.0  \r\n    attrs         18.2.0 \r\n    chardet       3.0.4  \r\n    idna          2.7    \r\n    idna-ssl      1.1.0  \r\n    multidict     4.4.2  \r\n    pip           18.0   \r\n    setuptools    40.4.3 \r\n    wheel         0.32.0 \r\n    yarl          1.2.6 \r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3315/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3315/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3307", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3307/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3307/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3307/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3307", "id": 365378106, "node_id": "MDU6SXNzdWUzNjUzNzgxMDY=", "number": 3307, "title": "Server access log format `%b` is the size of the whole response, not excluding headers", "user": {"login": "cdunklau", "id": 882547, "node_id": "MDQ6VXNlcjg4MjU0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/882547?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cdunklau", "html_url": "https://github.com/cdunklau", "followers_url": "https://api.github.com/users/cdunklau/followers", "following_url": "https://api.github.com/users/cdunklau/following{/other_user}", "gists_url": "https://api.github.com/users/cdunklau/gists{/gist_id}", "starred_url": "https://api.github.com/users/cdunklau/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cdunklau/subscriptions", "organizations_url": "https://api.github.com/users/cdunklau/orgs", "repos_url": "https://api.github.com/users/cdunklau/repos", "events_url": "https://api.github.com/users/cdunklau/events{/privacy}", "received_events_url": "https://api.github.com/users/cdunklau/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 277836062, "node_id": "MDU6TGFiZWwyNzc4MzYwNjI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/good%20first%20issue", "name": "good first issue", "color": "7057ff", "default": true, "description": "Good for newcomers"}, {"id": 1077350962, "node_id": "MDU6TGFiZWwxMDc3MzUwOTYy", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/Hacktoberfest", "name": "Hacktoberfest", "color": "d93f0b", "default": false, "description": "We think it's good for https://hacktoberfest.digitalocean.com/"}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2018-10-01T09:30:44Z", "updated_at": "2019-10-28T00:01:42Z", "closed_at": "2018-10-19T09:33:00Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nAccess log format `%b` is the size of the whole response, not excluding headers. The documentation says it should exclude the headers... \"%b - Size of response in bytes, excluding HTTP headers\".\r\n\r\nhttps://github.com/aio-libs/aiohttp/blob/708d1f07bb7878c09b47df620cd6b38a9bec470b/docs/logging.rst#format-specification\r\n\r\nWhile this looks like an implementation bug, I don't really understand the rationale behind the idea of excluding the headers from the length calculation... ISTM that the full response size would be a more useful metric. I'd recommend leaving the behavior as-is, and just updating the docs to correctly reflect the behavior.\r\n\r\n## Expected behaviour\r\n\r\nReturning `web.Response(body=None, status=200)` to result in 0 for the `%b` replacement value, and returning `web.Response(body=b'foo', status=200)` to result in 3.\r\n\r\n## Actual behaviour\r\n\r\nResults are 149 and 152, respectively. These are the lengths of the entire response, including status line and headers.\r\n\r\n## Steps to reproduce\r\n\r\nRun this:\r\n\r\n```python\r\nimport sys\r\nimport logging\r\nimport asyncio\r\n\r\nfrom aiohttp import web\r\n\r\n\r\ndef nobody(request):\r\n    return web.Response(body=None, status=200)\r\n\r\n\r\ndef somebody(request):\r\n    return web.Response(body=b'foo', status=200)\r\n\r\n\r\ndef init_app(*, loop):\r\n    app = web.Application()\r\n    app.router.add_route('GET', '/nobody', nobody)\r\n    app.router.add_route('GET', '/somebody', somebody)\r\n    return app\r\n\r\n\r\ndef main():\r\n    logging.basicConfig(stream=sys.stderr, level=logging.DEBUG)\r\n\r\n    loop = asyncio.get_event_loop()\r\n    app = init_app(loop=loop)\r\n    web.run_app(\r\n        app,\r\n        host=\"127.0.0.1\",\r\n        port=8080,\r\n        access_log_format='%r response_length=%b',\r\n    )\r\n\r\nif __name__ == '__main__':\r\n    main()\r\n```\r\n\r\nHit the two endpoints:\r\n\r\n```\r\ncurl -vv http://localhost:8080/nobody\r\ncurl -vv http://localhost:8080/somebody\r\n```\r\n\r\nNotice the log lines have the incorrect values for response length, if the documentation is to be believed:\r\n\r\n```\r\nINFO:aiohttp.access:GET /nobody HTTP/1.1 response_length=149\r\nINFO:aiohttp.access:GET /somebody HTTP/1.1 response_length=152\r\n```\r\n\r\n## Your environment\r\n\r\nMac, Python 3.6.3. Installed versions:\r\n\r\n```\r\n$ venv/bin/pip freeze\r\naiohttp==3.4.4\r\nasync-timeout==3.0.0\r\nattrs==18.2.0\r\nchardet==3.0.4\r\nidna==2.7\r\nidna-ssl==1.1.0\r\nmultidict==4.4.2\r\nyarl==1.2.6\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3307/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3307/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3304", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3304/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3304/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3304/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3304", "id": 365221455, "node_id": "MDU6SXNzdWUzNjUyMjE0NTU=", "number": 3304, "title": "Bracket IPv6 addresses in the HOST header", "user": {"login": "pollydrag", "id": 1307664, "node_id": "MDQ6VXNlcjEzMDc2NjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1307664?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pollydrag", "html_url": "https://github.com/pollydrag", "followers_url": "https://api.github.com/users/pollydrag/followers", "following_url": "https://api.github.com/users/pollydrag/following{/other_user}", "gists_url": "https://api.github.com/users/pollydrag/gists{/gist_id}", "starred_url": "https://api.github.com/users/pollydrag/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pollydrag/subscriptions", "organizations_url": "https://api.github.com/users/pollydrag/orgs", "repos_url": "https://api.github.com/users/pollydrag/repos", "events_url": "https://api.github.com/users/pollydrag/events{/privacy}", "received_events_url": "https://api.github.com/users/pollydrag/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 277836062, "node_id": "MDU6TGFiZWwyNzc4MzYwNjI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/good%20first%20issue", "name": "good first issue", "color": "7057ff", "default": true, "description": "Good for newcomers"}, {"id": 1077350962, "node_id": "MDU6TGFiZWwxMDc3MzUwOTYy", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/Hacktoberfest", "name": "Hacktoberfest", "color": "d93f0b", "default": false, "description": "We think it's good for https://hacktoberfest.digitalocean.com/"}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-09-30T12:36:56Z", "updated_at": "2019-10-28T00:02:15Z", "closed_at": "2018-10-04T07:09:02Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nClientSession does not bracket the IPv6 addresses in the HOST header.\r\n\r\n## Expected behaviour\r\n\r\n```\r\nGET / HTTP/1.1\r\nAccept: */*\r\nAccept-Encoding: gzip, deflate\r\nHost: [::1]:99\r\nUser-Agent: Python/3.6 aiohttp/3.5.0a0\r\n```\r\n\r\n## Actual behaviour\r\n\r\n```\r\nGET / HTTP/1.1\r\nAccept: */*\r\nAccept-Encoding: gzip, deflate\r\nHost: ::1:99\r\nUser-Agent: Python/3.6 aiohttp/3.5.0a0\r\n```\r\n\r\n## Steps to reproduce\r\n\r\n```python\r\nasync with aiohttp.ClientSession() as client:\r\n    await client.get('http://[::1]:99')      \r\n```\r\n\r\n## Your environment\r\n\r\n1. aiohttp 3.5.0a0\r\n2. python 3.6\r\n3. ubuntu 16.04\r\n4. aiohttp client\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3304/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3304/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3301", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3301/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3301/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3301/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3301", "id": 365110660, "node_id": "MDU6SXNzdWUzNjUxMTA2NjA=", "number": 3301, "title": "upload file (e.g. image) with multipart reader get empty payload", "user": {"login": "lomoonmoonbird", "id": 10216631, "node_id": "MDQ6VXNlcjEwMjE2NjMx", "avatar_url": "https://avatars.githubusercontent.com/u/10216631?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lomoonmoonbird", "html_url": "https://github.com/lomoonmoonbird", "followers_url": "https://api.github.com/users/lomoonmoonbird/followers", "following_url": "https://api.github.com/users/lomoonmoonbird/following{/other_user}", "gists_url": "https://api.github.com/users/lomoonmoonbird/gists{/gist_id}", "starred_url": "https://api.github.com/users/lomoonmoonbird/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lomoonmoonbird/subscriptions", "organizations_url": "https://api.github.com/users/lomoonmoonbird/orgs", "repos_url": "https://api.github.com/users/lomoonmoonbird/repos", "events_url": "https://api.github.com/users/lomoonmoonbird/events{/privacy}", "received_events_url": "https://api.github.com/users/lomoonmoonbird/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-09-29T08:20:54Z", "updated_at": "2019-10-28T00:02:39Z", "closed_at": "2018-09-29T08:43:44Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\nI am implementing an upload file system, user selects file in html and click upload ,aiohttp server receive and store it in filesystem. thats it.\r\n\r\naccroding to [https://docs.aiohttp.org/en/stable/web_quickstart.html#file-uploads](aiohttp official method)\r\n\r\nthe first method with request handler that reads whole payload worked, but second with multipart reader didnt work.\r\n\r\n<!-- Please describe your problem and why the fix is important. -->\r\n\r\n## Expected behaviour\r\nmultipart reader reads payload and save file in filesystem\r\n\r\n## Actual behaviour\r\nmultipart reader received nothing \r\n\r\n\r\n## Steps to reproduce\r\n\r\nhtml:\r\n\r\n```\r\n<strong>Upload</strong>\r\n<form method=\"post\" action=\"http://localhost:52789/api/admin/image/poster/upload\" enctype=\"multipart/form-data\">\r\n    <strong>Choise files: </strong> <input type=\"file\" name=\"filename\" >\r\n    <input type=\"submit\" name=\"sender\" value=\"Send\" />\r\n</form>\r\n\r\n```\r\n\r\n\r\nserver:\r\n\r\n ```\r\n async def post_image(self, request):\r\n\r\n        reader = await request.multipart()\r\n        \r\n        image = await reader.next()\r\n        print (await image.read(decode=True)) #this printed bytearray of file content\r\n        filename = image.filename\r\n        print (filename) # this printed file name\r\n        size = 0\r\n        with open(os.path.join('', filename), 'wb') as f:\r\n            while True:\r\n                chunk = await image.read_chunk()\r\n        \r\n                print (\"chunk\", chunk) $ chunk is empty\r\n                if not chunk:\r\n                    break\r\n                size += len(chunk)\r\n                f.write(chunk)\r\n        return await self.reply_ok({\"a\":\"b\"})\r\n```\r\n\r\n\r\n\r\nhttp request:\r\nPOST /api/admin/image/poster/upload HTTP/1.1\r\nHost: localhost:52789\r\nConnection: keep-alive\r\nContent-Length: 27023\r\nCache-Control: max-age=0\r\nUpgrade-Insecure-Requests: 1\r\nOrigin: null\r\nContent-Type: multipart/form-data; boundary=----WebKitFormBoundaryB6BTxs8E0K6dZVpG\r\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36\r\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\r\nAccept-Encoding: gzip, deflate, br\r\nAccept-Language: zh-CN,zh;q=0.9\r\nCookie: Admin-Token=admin; sidebarStatus=1\r\n\r\n## Your environment\r\npython: 3.6\r\naiohttp:2.3.7\r\nchrome:69.0.3497.100\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3301/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3301/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3298", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3298/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3298/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3298/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3298", "id": 364556296, "node_id": "MDU6SXNzdWUzNjQ1NTYyOTY=", "number": 3298, "title": "trust_env=True of aiohttp.ClientSession should not print a warning log nor try to access each time a file", "user": {"login": "siom79", "id": 3755956, "node_id": "MDQ6VXNlcjM3NTU5NTY=", "avatar_url": "https://avatars.githubusercontent.com/u/3755956?v=4", "gravatar_id": "", "url": "https://api.github.com/users/siom79", "html_url": "https://github.com/siom79", "followers_url": "https://api.github.com/users/siom79/followers", "following_url": "https://api.github.com/users/siom79/following{/other_user}", "gists_url": "https://api.github.com/users/siom79/gists{/gist_id}", "starred_url": "https://api.github.com/users/siom79/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/siom79/subscriptions", "organizations_url": "https://api.github.com/users/siom79/orgs", "repos_url": "https://api.github.com/users/siom79/repos", "events_url": "https://api.github.com/users/siom79/events{/privacy}", "received_events_url": "https://api.github.com/users/siom79/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2018-09-27T16:26:40Z", "updated_at": "2019-12-02T16:06:52Z", "closed_at": "2018-12-02T15:26:25Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nWhen setting ``trust_env=True`` for ``aiohttp.ClientSession``, a warning like the following one is printed to the log if the file ``.netrc`` is missing.\r\n\r\n```\r\n2018-09-26 08:10:07 WARNING (MainThread) [aiohttp.client] could't find .netrc file\r\n```\r\nThis should not happen as the intention is to only access environment variables. Beyond that, the file access should only happen once and not again and again for each instance of ``aiohttp.ClientSession``. This is for example the reason why pull request [16874](https://github.com/home-assistant/home-assistant/pull/16874) for [home-assistant](https://github.com/home-assistant/home-assistant) was rejected.\r\n\r\n## Expected behaviour\r\n\r\nSetting ``trust_env=True`` for ``aiohttp.ClientSession`` should not print a warning and should not try to access a file each time.\r\n\r\n## Actual behaviour\r\n\r\nIf the file ``.netrc`` is missing, a warning is printed and for each instance of ``aiohttp.ClientSession`` the file check is repeated.\r\n\r\n## Steps to reproduce\r\n\r\nCreate an instance of ``aiohttp.ClientSession`` with ``trust_env=True`` when there is no ``.netrc`` file.\r\n\r\n## Your environment\r\n\r\naiohttp version 3.4.4, used as client, running on Ubuntu 18.04 with python 3.6.6\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3298/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3298/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3296", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3296/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3296/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3296/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3296", "id": 364387106, "node_id": "MDU6SXNzdWUzNjQzODcxMDY=", "number": 3296, "title": "aiohttp client session. it doesn't close a connection after keepalive_timeout", "user": {"login": "jaemyunlee", "id": 37058993, "node_id": "MDQ6VXNlcjM3MDU4OTkz", "avatar_url": "https://avatars.githubusercontent.com/u/37058993?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jaemyunlee", "html_url": "https://github.com/jaemyunlee", "followers_url": "https://api.github.com/users/jaemyunlee/followers", "following_url": "https://api.github.com/users/jaemyunlee/following{/other_user}", "gists_url": "https://api.github.com/users/jaemyunlee/gists{/gist_id}", "starred_url": "https://api.github.com/users/jaemyunlee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jaemyunlee/subscriptions", "organizations_url": "https://api.github.com/users/jaemyunlee/orgs", "repos_url": "https://api.github.com/users/jaemyunlee/repos", "events_url": "https://api.github.com/users/jaemyunlee/events{/privacy}", "received_events_url": "https://api.github.com/users/jaemyunlee/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1363888951, "node_id": "MDU6TGFiZWwxMzYzODg4OTUx", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/pr-available", "name": "pr-available", "color": "363396", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-09-27T09:37:11Z", "updated_at": "2020-11-08T08:56:19Z", "closed_at": "2020-10-17T21:58:11Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Long story short\r\n\r\nI created test server with Asyncio Protocol and Transport and created client side with aiohttp client. If I make multiple requests, It doesn't close connection. (If I make just a few requests, It closes connection, but If i make requests more, It doesn't close and leave it connected)\r\n\r\n## Expected behaviour\r\n\r\nI expected that it closes a connection after keepalive_timeout(default 15 or custom value)\r\n\r\n## Actual behaviour\r\n\r\nIt doesn't close and leave it connected\r\n\r\n## Steps to reproduce\r\n\r\n1. run `server.py`\r\n2. change forloop in `client.py` : `range(1,3)`\r\n3. check connection_lost callback invoke : it works fine\r\n4. change forloop in `client.py` : `range(1,10)`\r\n5. check connection_lost callback invoke : it doesn't invoke connection_lost.\r\n\r\n```\r\n# server.py\r\n\r\nimport asyncio\r\nimport logging\r\nimport sys\r\nimport time\r\n\r\nSERVER_ADDRESS = ('localhost', 8888)\r\n\r\nlogging.basicConfig(\r\n    level=logging.DEBUG,\r\n    format='%(name)s: %(message)s',\r\n    stream=sys.stderr\r\n)\r\nlog = logging.getLogger('main')\r\n\r\nevent_loop = asyncio.get_event_loop()\r\n\r\nclass CustomServer(asyncio.Protocol):\r\n\r\n    def connection_made(self, transport):\r\n\r\n        self.transport = transport\r\n        self.address = transport.get_extra_info('peername')\r\n        self.log = logging.getLogger('custom')\r\n        self.log.debug('connection accepted')\r\n        self.log.debug(self.address)\r\n\r\n    def data_received(self, data):\r\n        self.log.debug(f'receive {data}')\r\n        body = 'hello world!'.encode()\r\n        time.sleep(1)\r\n        self.transport.write((\r\n            b'HTTP/1.1 200 OK\\r\\n'\r\n            b'Content-Length: %b\\r\\n'\r\n            b'Content-Type: text/plain\\r\\n\\r\\n'\r\n            b'%b') % (str(len(body)).encode(), body)\r\n        )\r\n\r\n    def connection_lost(self, exc):\r\n        if exc:\r\n            self.log.error(f'Error: {exc}')\r\n        else:\r\n            self.log.debug('closing')\r\n        super().connection_lost(exc)\r\n\r\n\r\nfactory = event_loop.create_server(CustomServer, *SERVER_ADDRESS)\r\nserver = event_loop.run_until_complete(factory)\r\nlog.debug('server started')\r\n\r\ntry:\r\n    event_loop.run_forever()\r\nfinally:\r\n    log.debug('closing server')\r\n    server.close()\r\n    event_loop.run_until_complete(server.wait_closed())\r\n    log.debug('closing event loop')\r\n    event_loop.close()\r\n```\r\n\r\n```\r\n# client.py\r\n\r\nimport socket\r\n\r\nimport asyncio\r\nimport aiohttp\r\n\r\nevent_loop = asyncio.get_event_loop()\r\ntimeout = aiohttp.ClientTimeout(total=60)\r\nsession = aiohttp.ClientSession(connector=aiohttp.TCPConnector(keepalive_timeout=5, family=socket.AF_INET), timeout=timeout)\r\n\r\nasync def request_example():\r\n    resp = await session.get('http://localhost:8888/')\r\n    res = await resp.text()\r\n    return res\r\n\r\nasync def main():\r\n    try:\r\n        for idx in range(1, 7):\r\n            res = await request_example()\r\n            print(f'{idx} : {res}')\r\n    except asyncio.TimeoutError:\r\n        print('timeout')\r\n\r\n\r\nevent_loop.run_until_complete(main())\r\nprint([task for task in asyncio.Task.all_tasks() if not task.done()])\r\nprint(session.closed)\r\nevent_loop.run_forever()\r\n```\r\n\r\n## Your environment\r\n\r\ncase 1\r\naiohttp version : 3.4.4 Client\r\nOS : Mac Pro(High Sierra)\r\npython : 3.6\r\n\r\ncase2\r\naiohttp version : 3.4.4 Client\r\nOS : Ubuntu14.04\r\npython : 3.5\r\n* changed f string in the code to format to run with python 3.5\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3296/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3296/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3292", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3292/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3292/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3292/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3292", "id": 363980152, "node_id": "MDU6SXNzdWUzNjM5ODAxNTI=", "number": 3292, "title": "Can't suppress all SSL verification errors", "user": {"login": "dandrei", "id": 350897, "node_id": "MDQ6VXNlcjM1MDg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/350897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dandrei", "html_url": "https://github.com/dandrei", "followers_url": "https://api.github.com/users/dandrei/followers", "following_url": "https://api.github.com/users/dandrei/following{/other_user}", "gists_url": "https://api.github.com/users/dandrei/gists{/gist_id}", "starred_url": "https://api.github.com/users/dandrei/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dandrei/subscriptions", "organizations_url": "https://api.github.com/users/dandrei/orgs", "repos_url": "https://api.github.com/users/dandrei/repos", "events_url": "https://api.github.com/users/dandrei/events{/privacy}", "received_events_url": "https://api.github.com/users/dandrei/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 58986078, "node_id": "MDU6TGFiZWw1ODk4NjA3OA==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/invalid", "name": "invalid", "color": "e4e669", "default": true, "description": "This doesn't seem right"}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 12, "created_at": "2018-09-26T11:24:32Z", "updated_at": "2020-01-01T08:24:18Z", "closed_at": "2018-09-26T11:48:23Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nCan't suppress all SSL verification errors.\r\n\r\n## Expected behaviour\r\n\r\nNo errors should be thrown when injecting into the ClientSession a TCPConnector initialized with `ssl=False` .\r\n\r\n## Actual behaviour\r\n\r\nPython dumps the exception stacktrace:\r\n```\r\nssl.SSLError: [SSL: WRONG_VERSION_NUMBER] wrong version number (_ssl.c:1045)\r\n```\r\n\r\n## Steps to reproduce\r\n\r\nRun this code:\r\n```import asyncio\r\nimport aiohttp\r\n\r\nloop = asyncio.get_event_loop()\r\n\r\nuri = 'https://www.000directory.com.ar'\r\n\r\nasync def test():\r\n    async with aiohttp.ClientSession(connector=aiohttp.TCPConnector(ssl=False)) as session:\r\n        async with session.get(uri) as r:\r\n            print(r)\r\n\r\nloop.run_until_complete(test())\r\n```\r\n\r\n## Your environment\r\n\r\naiohttp 3.4.4\r\nUbuntu 16.04 (Python 3.5.5)\r\nWindows 10 (Python 3.7)\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3292/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3292/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3285", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3285/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3285/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3285/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3285", "id": 363001297, "node_id": "MDU6SXNzdWUzNjMwMDEyOTc=", "number": 3285, "title": "ImportError: cannot import name 'hdrs'", "user": {"login": "Sanjay-B", "id": 22083307, "node_id": "MDQ6VXNlcjIyMDgzMzA3", "avatar_url": "https://avatars.githubusercontent.com/u/22083307?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Sanjay-B", "html_url": "https://github.com/Sanjay-B", "followers_url": "https://api.github.com/users/Sanjay-B/followers", "following_url": "https://api.github.com/users/Sanjay-B/following{/other_user}", "gists_url": "https://api.github.com/users/Sanjay-B/gists{/gist_id}", "starred_url": "https://api.github.com/users/Sanjay-B/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Sanjay-B/subscriptions", "organizations_url": "https://api.github.com/users/Sanjay-B/orgs", "repos_url": "https://api.github.com/users/Sanjay-B/repos", "events_url": "https://api.github.com/users/Sanjay-B/events{/privacy}", "received_events_url": "https://api.github.com/users/Sanjay-B/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2018-09-24T02:34:00Z", "updated_at": "2019-10-28T01:01:38Z", "closed_at": "2018-09-26T21:01:40Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nAiohttp is unusable when imported on Python 3.5.\r\n\r\n## Expected behaviour\r\n\r\nNormal usage.\r\n\r\n## Actual behaviour\r\n\r\n``ImportError: cannot import name 'hdrs'`` when importing aiohttp.\r\n\r\n## Steps to reproduce\r\n\r\n``import aiohttp``\r\n\r\n## Your environment\r\n\r\nWindows 10, Python 3.5\r\n\r\n## Error Log\r\n```\r\nTraceback (most recent call last):\r\n  File \"cc.py\", line 1, in <module>\r\n    from pyblox import *\r\n  File \"C:\\Users\\sanja\\AppData\\Local\\Programs\\Python\\Python35\\lib\\site-packages\\pyblox\\__init__.py\", line 16, in <module>\r\n    from .api.assets import Assets\r\n  File \"C:\\Users\\sanja\\AppData\\Local\\Programs\\Python\\Python35\\lib\\site-packages\\pyblox\\api\\assets.py\", line 9, in <module>\r\n    from .http import Http\r\n  File \"C:\\Users\\sanja\\AppData\\Local\\Programs\\Python\\Python35\\lib\\site-packages\\pyblox\\api\\http.py\", line 11, in <module>\r\n    import aiohttp\r\n  File \"C:\\Users\\sanja\\AppData\\Roaming\\Python\\Python35\\site-packages\\aiohttp\\__init__.py\", line 9, in <module>\r\n    from . import hdrs  # noqa\r\nImportError: cannot import name 'hdrs'\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3285/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3285/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3283", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3283/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3283/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3283/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3283", "id": 362956273, "node_id": "MDU6SXNzdWUzNjI5NTYyNzM=", "number": 3283, "title": "Css doesn't load - Nginx Deployment", "user": {"login": "merlinfuchs", "id": 33966852, "node_id": "MDQ6VXNlcjMzOTY2ODUy", "avatar_url": "https://avatars.githubusercontent.com/u/33966852?v=4", "gravatar_id": "", "url": "https://api.github.com/users/merlinfuchs", "html_url": "https://github.com/merlinfuchs", "followers_url": "https://api.github.com/users/merlinfuchs/followers", "following_url": "https://api.github.com/users/merlinfuchs/following{/other_user}", "gists_url": "https://api.github.com/users/merlinfuchs/gists{/gist_id}", "starred_url": "https://api.github.com/users/merlinfuchs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/merlinfuchs/subscriptions", "organizations_url": "https://api.github.com/users/merlinfuchs/orgs", "repos_url": "https://api.github.com/users/merlinfuchs/repos", "events_url": "https://api.github.com/users/merlinfuchs/events{/privacy}", "received_events_url": "https://api.github.com/users/merlinfuchs/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2018-09-23T16:28:29Z", "updated_at": "2019-10-28T01:01:47Z", "closed_at": "2018-09-24T08:56:23Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nIm trying to deplo my aiohttp server with nginx. This is my configuration of nginx:\r\n```\r\nuser www-data;\r\nworker_processes auto;\r\npid /run/nginx.pid;\r\n\r\nevents {\r\n  worker_connections 1024;\r\n}\r\n\r\nhttp {\r\n  include /etc/nginx/mime.types;\r\n\r\n  server {\r\n    listen 80;\r\n    client_max_body_size 4G;\r\n\r\n    server_name bots.discord.club;\r\n\r\n    location / {\r\n      proxy_set_header Host $http_host;\r\n      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\r\n      proxy_redirect off;\r\n      proxy_buffering off;\r\n      proxy_pass http://aiohttp;\r\n    }\r\n\r\n    location /static {\r\n      root /var/www/html;\r\n    }\r\n\r\n  }\r\n\r\n  upstream aiohttp {\r\n    # fail_timeout=0 means we always retry an upstream even if it failed\r\n    # to return a good HTTP response\r\n\r\n    # Unix domain servers\r\n    # server unix:/tmp/example_1.sock fail_timeout=0;\r\n    # server unix:/tmp/example_2.sock fail_timeout=0;\r\n    # server unix:/tmp/example_3.sock fail_timeout=0;\r\n    # server unix:/tmp/example_4.sock fail_timeout=0;\r\n\r\n    # Unix domain sockets are used in this example due to their high performance,\r\n    # but TCP/IP sockets could be used instead:\r\n    server 127.0.0.1:8081 fail_timeout=0;\r\n    # server 127.0.0.1:8082 fail_timeout=0;\r\n    # server 127.0.0.1:8083 fail_timeout=0;\r\n    # server 127.0.0.1:8084 fail_timeout=0;\r\n  }\r\n}\r\n```\r\nEverything works fine, beside that css from the static route isnt working.\r\n\r\n![image](https://user-images.githubusercontent.com/33966852/45930223-bf785c00-bf5d-11e8-8597-6ce0b96457ef.png)\r\n\r\nIt seems like nginx returns it as text/plain. I know this is probably a problem with nginx, but they wasnt able to help me, so I ask here.\r\n\r\n\r\n## Expected behaviour\r\n\r\nCss should load.\r\n\r\n## Actual behaviour\r\n\r\nCss doesn't load.\r\n\r\n## Steps to reproduce\r\n\r\n```\r\nuser www-data;\r\nworker_processes auto;\r\npid /run/nginx.pid;\r\n\r\nevents {\r\n  worker_connections 1024;\r\n}\r\n\r\nhttp {\r\n  include /etc/nginx/mime.types;\r\n\r\n  server {\r\n    listen 80;\r\n    client_max_body_size 4G;\r\n\r\n    server_name bots.discord.club;\r\n\r\n    location / {\r\n      proxy_set_header Host $http_host;\r\n      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\r\n      proxy_redirect off;\r\n      proxy_buffering off;\r\n      proxy_pass http://aiohttp;\r\n    }\r\n\r\n    location /static {\r\n      root /var/www/html;\r\n    }\r\n\r\n  }\r\n\r\n  upstream aiohttp {\r\n    # fail_timeout=0 means we always retry an upstream even if it failed\r\n    # to return a good HTTP response\r\n\r\n    # Unix domain servers\r\n    # server unix:/tmp/example_1.sock fail_timeout=0;\r\n    # server unix:/tmp/example_2.sock fail_timeout=0;\r\n    # server unix:/tmp/example_3.sock fail_timeout=0;\r\n    # server unix:/tmp/example_4.sock fail_timeout=0;\r\n\r\n    # Unix domain sockets are used in this example due to their high performance,\r\n    # but TCP/IP sockets could be used instead:\r\n    server 127.0.0.1:8081 fail_timeout=0;\r\n    # server 127.0.0.1:8082 fail_timeout=0;\r\n    # server 127.0.0.1:8083 fail_timeout=0;\r\n    # server 127.0.0.1:8084 fail_timeout=0;\r\n  }\r\n}\r\n```\r\n\r\n## Your environment\r\n\r\nUbuntu 16.04 LTS 64bit,\r\nNginx 1.10.3,\r\naiohttp 3.4.4\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3283/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3283/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3277", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3277/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3277/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3277/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3277", "id": 361276965, "node_id": "MDU6SXNzdWUzNjEyNzY5NjU=", "number": 3277, "title": "aiohttp 2.3 + python 3.5 broken because of multidict 4.4", "user": {"login": "labbati", "id": 2952352, "node_id": "MDQ6VXNlcjI5NTIzNTI=", "avatar_url": "https://avatars.githubusercontent.com/u/2952352?v=4", "gravatar_id": "", "url": "https://api.github.com/users/labbati", "html_url": "https://github.com/labbati", "followers_url": "https://api.github.com/users/labbati/followers", "following_url": "https://api.github.com/users/labbati/following{/other_user}", "gists_url": "https://api.github.com/users/labbati/gists{/gist_id}", "starred_url": "https://api.github.com/users/labbati/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/labbati/subscriptions", "organizations_url": "https://api.github.com/users/labbati/orgs", "repos_url": "https://api.github.com/users/labbati/repos", "events_url": "https://api.github.com/users/labbati/events{/privacy}", "received_events_url": "https://api.github.com/users/labbati/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2018-09-18T12:21:04Z", "updated_at": "2019-10-28T01:01:53Z", "closed_at": "2018-09-20T10:06:26Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nUsing python 3.5 with aiohttp 2.3 (or less) results in a `TypeError: Cannot subscript an existing Union. Use Union[u, t] instead.` error.\r\n\r\n## Expected behaviour\r\n\r\nGiven that `aiohttp` declares python `3.4.2` as the minimum requirement, it should be possible to use aiohttp 2.x with python 3.5.\r\n\r\n## Steps to reproduce\r\n\r\nGiven the `sample.py` file containing the example from the main README:\r\n\r\n```\r\nimport aiohttp\r\nimport asyncio\r\n\r\nasync def fetch(session, url):\r\n    async with session.get(url) as response:\r\n        return await response.text()\r\n\r\nasync def main():\r\n    async with aiohttp.ClientSession() as session:\r\n        html = await fetch(session, 'http://python.org')\r\n        print(html)\r\n\r\nif __name__ == '__main__':\r\n    loop = asyncio.get_event_loop()\r\n    loop.run_until_complete(main())\r\n``` \r\n\r\nHere is the actual behavior:\r\n\r\n```\r\n$> python --version\r\nPython 3.5.2\r\n\r\n$> pip install \"aiohttp>=2.3,<2.4\"\r\n\r\n$> pip freeze\r\npip freeze\r\naiohttp==2.3.10\r\nasync-timeout==3.0.0\r\nchardet==3.0.4\r\nidna==2.7\r\nidna-ssl==1.1.0\r\nmultidict==4.4.1\r\nyarl==1.2.6\r\n\r\n$> python sample.py\r\nTraceback (most recent call last):\r\n  File \"sample.py\", line 1, in <module>\r\n    import aiohttp\r\n  File \"/Users/user_name/projects/dd-trace-py/aaa/lib/python3.5/site-packages/aiohttp/__init__.py\", line 5, in <module>\r\n    from . import hdrs  # noqa\r\n  File \"/Users/user_name/projects/dd-trace-py/aaa/lib/python3.5/site-packages/aiohttp/hdrs.py\", line 2, in <module>\r\n    from multidict import istr\r\n  File \"/Users/user_name/projects/dd-trace-py/aaa/lib/python3.5/site-packages/multidict/__init__.py\", line 18, in <module>\r\n    from ._abc import MultiMapping, MutableMultiMapping\r\n  File \"/Users/user_name/projects/dd-trace-py/aaa/lib/python3.5/site-packages/multidict/_abc.py\", line 37, in <module>\r\n    class MutableMultiMapping(MultiMapping[_T], MutableMapping[str, _T]):\r\n  File \"/Users/user_name/projects/dd-trace-py/aaa/lib/python3.5/site-packages/multidict/_abc.py\", line 44, in MutableMultiMapping\r\n    def extend(self, *args: _Arg[_T], **kwargs: _T) -> None:\r\n  File \"/Users/user_name/.pyenv/versions/3.5.2/lib/python3.5/typing.py\", line 546, in __getitem__\r\n    \"Cannot subscript an existing Union. Use Union[u, t] instead.\")\r\nTypeError: Cannot subscript an existing Union. Use Union[u, t] instead.\r\n```\r\n\r\nThat is fixed downgrading the multidict version to `4.3.x`.\r\n```\r\n$> pip install \"multidict>=4.3,<4.4\"\r\n\r\n$> pip freeze\r\naiohttp==2.3.10\r\nasync-timeout==3.0.0\r\nchardet==3.0.4\r\nidna==2.7\r\nidna-ssl==1.1.0\r\nmultidict==4.3.1\r\nyarl==1.2.6\r\n\r\n$> python sample.py\r\n<some-beautiful-html />\r\n```\r\n\r\n## Your environment\r\nI can tell that the issue applies to the **client**, but it may be also apply to the server.\r\n\r\nEnvironment, both:\r\n - Docker: `Linux linuxkit-025000000001 4.9.93-linuxkit-aufs #1 SMP Wed Jun 6 16:55:56 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux`\r\n - MAC OS: `Darwin COMP10588.local 17.7.0 Darwin Kernel Version 17.7.0: Thu Jun 21 22:59:54 PDT 2018; root:xnu-4570.71.2~2/RELEASE_X86_64 x86_64`\r\n\r\nInstalled packages (when error occurs)\r\n```\r\naiohttp==2.3.10\r\nasync-timeout==3.0.0\r\nchardet==3.0.4\r\nidna==2.7\r\nidna-ssl==1.1.0\r\nmultidict==4.4.1    <<<<<<<<<<<<<<<<<<<<<<\r\nyarl==1.2.6\r\n```\r\nInstalled packages (when error does not occur):\r\n```\r\naiohttp==2.3.10\r\nasync-timeout==3.0.0\r\nchardet==3.0.4\r\nidna==2.7\r\nidna-ssl==1.1.0\r\nmultidict==4.3.1    <<<<<<<<<<<<<<<<<<<<<<\r\nyarl==1.2.6\r\n```\r\nThe same issue seems to exist for aiohttp 1.x\r\n\r\n## Possible fix\r\n\r\nIt seems to me that pinning the dependency from current `'multidict>=4.0.0'` to `'multidict>=4.0.0,<4.4'` should be enough. But there may be more appropriate solutions.\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3277/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3277/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3273", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3273/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3273/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3273/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3273", "id": 361060294, "node_id": "MDU6SXNzdWUzNjEwNjAyOTQ=", "number": 3273, "title": "Deprecation warnings in 3.8", "user": {"login": "wumpus", "id": 2142266, "node_id": "MDQ6VXNlcjIxNDIyNjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2142266?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wumpus", "html_url": "https://github.com/wumpus", "followers_url": "https://api.github.com/users/wumpus/followers", "following_url": "https://api.github.com/users/wumpus/following{/other_user}", "gists_url": "https://api.github.com/users/wumpus/gists{/gist_id}", "starred_url": "https://api.github.com/users/wumpus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wumpus/subscriptions", "organizations_url": "https://api.github.com/users/wumpus/orgs", "repos_url": "https://api.github.com/users/wumpus/repos", "events_url": "https://api.github.com/users/wumpus/events{/privacy}", "received_events_url": "https://api.github.com/users/wumpus/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2018-09-17T21:56:39Z", "updated_at": "2019-10-28T01:01:32Z", "closed_at": "2018-09-26T21:13:53Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "/home/travis/virtualenv/python3.8-dev/lib/python3.8/site-packages/aiohttp/multipart.py:8: DeprecationWarning: Using or importing the ABCs from 'collections' instead of from 'collections.abc' is deprecated, and in 3.8 it will stop working\r\n  from collections import Mapping, Sequence, deque\r\n\r\nThis is a safe change to make, collections.abc was introduced in 3.3.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3273/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3273/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3270", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3270/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3270/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3270/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3270", "id": 360648539, "node_id": "MDU6SXNzdWUzNjA2NDg1Mzk=", "number": 3270, "title": "UnicodeDecodeError: 'utf-8' codec can't decode byte ...", "user": {"login": "Thempra", "id": 749975, "node_id": "MDQ6VXNlcjc0OTk3NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/749975?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Thempra", "html_url": "https://github.com/Thempra", "followers_url": "https://api.github.com/users/Thempra/followers", "following_url": "https://api.github.com/users/Thempra/following{/other_user}", "gists_url": "https://api.github.com/users/Thempra/gists{/gist_id}", "starred_url": "https://api.github.com/users/Thempra/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Thempra/subscriptions", "organizations_url": "https://api.github.com/users/Thempra/orgs", "repos_url": "https://api.github.com/users/Thempra/repos", "events_url": "https://api.github.com/users/Thempra/events{/privacy}", "received_events_url": "https://api.github.com/users/Thempra/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344995986, "node_id": "MDU6TGFiZWwzNDQ5OTU5ODY=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/client", "name": "client", "color": "bfd4f2", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-09-16T15:13:15Z", "updated_at": "2019-10-28T01:01:56Z", "closed_at": "2018-09-16T21:28:54Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\n\r\nWhen request a call to some servers, a coding error occurs instead download the image / content\r\n\r\n\r\n## Actual behaviour\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"aiohttpPoC.py\", line 16, in <module>\r\n    loop.run_until_complete(main())\r\n  File \"/usr/local/Cellar/python/3.7.0/Frameworks/Python.framework/Versions/3.7/lib/python3.7/asyncio/base_events.py\", line 568, in run_until_complete\r\n    return future.result()\r\n  File \"aiohttpPoC.py\", line 13, in main\r\n    html = await fetch(session, imageurl)\r\n  File \"aiohttpPoC.py\", line 8, in fetch\r\n    return await response.text()\r\n  File \"/usr/local/lib/python3.7/site-packages/aiohttp/client_reqrep.py\", line 921, in text\r\n    return self._body.decode(encoding, errors=errors)\r\nUnicodeDecodeError: 'utf-8' codec can't decode byte 0xe0 in position 6: invalid continuation byte\r\n```\r\n\r\n## Steps to reproduce\r\n\r\n```\r\nimport aiohttp\r\nimport asyncio\r\nimport datetime\r\nimport pytz\r\n\r\nasync def fetch(session, url):\r\n    async with session.get(url) as response:\r\n        return await response.text()\r\n\r\nasync def main():\r\n    imageurl='https://www.aemet.es/imagenes_d/eltiempo/observacion/radar/'+datetime.datetime.now(pytz.timezone('Atlantic/Cape_Verde')).strftime(\"%Y%m%d%H%M\")[:-1]+'0_r8va.gif'\r\n    async with aiohttp.ClientSession() as session:\r\n        html = await fetch(session, imageurl)\r\n\r\nloop = asyncio.get_event_loop()\r\nloop.run_until_complete(main())\r\n```\r\n\r\n\r\n## Your environment\r\n\r\nPython 3.7.0\r\naiohttp 3.4.4", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3270/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3270/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3268", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3268/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3268/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3268/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3268", "id": 360296813, "node_id": "MDU6SXNzdWUzNjAyOTY4MTM=", "number": 3268, "title": "Reopen #3208", "user": {"login": "Swamp-Ig", "id": 6317645, "node_id": "MDQ6VXNlcjYzMTc2NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/6317645?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Swamp-Ig", "html_url": "https://github.com/Swamp-Ig", "followers_url": "https://api.github.com/users/Swamp-Ig/followers", "following_url": "https://api.github.com/users/Swamp-Ig/following{/other_user}", "gists_url": "https://api.github.com/users/Swamp-Ig/gists{/gist_id}", "starred_url": "https://api.github.com/users/Swamp-Ig/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Swamp-Ig/subscriptions", "organizations_url": "https://api.github.com/users/Swamp-Ig/orgs", "repos_url": "https://api.github.com/users/Swamp-Ig/repos", "events_url": "https://api.github.com/users/Swamp-Ig/events{/privacy}", "received_events_url": "https://api.github.com/users/Swamp-Ig/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2018-09-14T13:05:46Z", "updated_at": "2020-03-21T19:45:50Z", "closed_at": "2019-03-22T13:41:31Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "\r\nI'm not sure what's happened exactly, but #3208 still seems to be happening for me.\r\n\r\nIt did work at one point. Not sure what changed exactly.\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3268/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3268/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3250", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3250/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3250/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3250/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3250", "id": 358117746, "node_id": "MDU6SXNzdWUzNTgxMTc3NDY=", "number": 3250, "title": "json decode error with the colr.org website", "user": {"login": "PumPum7", "id": 28806828, "node_id": "MDQ6VXNlcjI4ODA2ODI4", "avatar_url": "https://avatars.githubusercontent.com/u/28806828?v=4", "gravatar_id": "", "url": "https://api.github.com/users/PumPum7", "html_url": "https://github.com/PumPum7", "followers_url": "https://api.github.com/users/PumPum7/followers", "following_url": "https://api.github.com/users/PumPum7/following{/other_user}", "gists_url": "https://api.github.com/users/PumPum7/gists{/gist_id}", "starred_url": "https://api.github.com/users/PumPum7/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/PumPum7/subscriptions", "organizations_url": "https://api.github.com/users/PumPum7/orgs", "repos_url": "https://api.github.com/users/PumPum7/repos", "events_url": "https://api.github.com/users/PumPum7/events{/privacy}", "received_events_url": "https://api.github.com/users/PumPum7/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344995986, "node_id": "MDU6TGFiZWwzNDQ5OTU5ODY=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/client", "name": "client", "color": "bfd4f2", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2018-09-07T15:41:33Z", "updated_at": "2019-10-28T01:01:59Z", "closed_at": "2018-09-11T11:16:23Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nWhen I make an API call to this website: http://www.colr.org/json/color/random and transform the response to json I get this error: `Command raised an exception: ContentTypeError: 0, message='Attempt to decode JSON with unexpected mimetype: text/plain; charset=iso-8859-1'`\r\n\r\n## Expected behaviour\r\nI expected to get the data as json like I did when I used the requests library\r\n\r\n## Actual behaviour\r\n\r\nI get an error and nothing gets returned\r\n\r\n## Steps to reproduce\r\n\r\n```python\r\nasync def request(url, data=None, params=None, headers=None):\r\n    valid_responses = [200, 201, 202]\r\n    async with aiohttp.ClientSession() as session:\r\n        async with session.get(\r\n            url, data=data, params=params, headers=headers\r\n        ) as response:\r\n            if response.status in valid_responses:\r\n                return await response.json()\r\n            return None\r\n```\r\nthe url is `http://www.colr.org/json/color/random` in this case\r\n\r\n## Your environment\r\nI don't use a proxy server\r\nI use Windows 10\r\nMy aiohttp version is 3.3.2\r\n\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case. \r\n     \r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     --> client\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3250/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3250/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3241", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3241/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3241/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3241/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3241", "id": 356879630, "node_id": "MDU6SXNzdWUzNTY4Nzk2MzA=", "number": 3241, "title": "Failed building wheel for aiohttp==3.4.3", "user": {"login": "oleksandr-kuzmenko", "id": 5622979, "node_id": "MDQ6VXNlcjU2MjI5Nzk=", "avatar_url": "https://avatars.githubusercontent.com/u/5622979?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oleksandr-kuzmenko", "html_url": "https://github.com/oleksandr-kuzmenko", "followers_url": "https://api.github.com/users/oleksandr-kuzmenko/followers", "following_url": "https://api.github.com/users/oleksandr-kuzmenko/following{/other_user}", "gists_url": "https://api.github.com/users/oleksandr-kuzmenko/gists{/gist_id}", "starred_url": "https://api.github.com/users/oleksandr-kuzmenko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oleksandr-kuzmenko/subscriptions", "organizations_url": "https://api.github.com/users/oleksandr-kuzmenko/orgs", "repos_url": "https://api.github.com/users/oleksandr-kuzmenko/repos", "events_url": "https://api.github.com/users/oleksandr-kuzmenko/events{/privacy}", "received_events_url": "https://api.github.com/users/oleksandr-kuzmenko/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 5, "created_at": "2018-09-04T16:07:57Z", "updated_at": "2019-10-28T01:02:29Z", "closed_at": "2018-09-05T07:16:47Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "OS - ubuntu bionic\r\npython - 3.7\r\naiohttp - 3.4.3\r\n\r\nno problems with aiohttp 3.4.2\r\n\r\n```\r\n----------------------------------------\r\n  Failed building wheel for aiohttp\r\n  Running setup.py clean for aiohttp\r\nFailed to build aiohttp\r\nInstalling collected packages: aiohttp, aiokafka, asyncpg, asyncpgsa, cantal, cbor, graphene, graphql-core, graphql-server-core, kafka-python, rororo, schedule, sqlalchemy, trafaret, trafaret-config, uvloop, async-shim, concierge-aiohttp, conciergelib, logevo, async-timeout, attrs, chardet, idna, multidict, yarl, PyYAML, rx, aniso8601, graphql-relay, promise, six\r\n  Running setup.py install for aiohttp ... error\r\n    Complete output from command /usr/bin/python3.7 -u -c \"import setuptools, tokenize;__file__='/tmp/pip-install-pmcpipif/aiohttp/setup.py';f=getattr(tokenize, 'open', open)(__file__);code=f.read().replace('\\r\\n', '\\n');f.close();exec(compile(code, __file__, 'exec'))\" install --record /tmp/pip-record-1268nolh/install-record.txt --single-version-externally-managed --compile:\r\n    running install\r\n    running build\r\n    running build_py\r\n    creating build\r\n    creating build/lib.linux-x86_64-3.7\r\n    creating build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/web_routedef.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/tracing.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/test_utils.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/client_proto.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/web_runner.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/tcp_helpers.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/cookiejar.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/locks.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/payload.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/connector.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/web_exceptions.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/web_middlewares.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/web_protocol.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/hdrs.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/http_exceptions.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/web_urldispatcher.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/__init__.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/http.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/http_writer.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/typedefs.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/client_ws.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/worker.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/signals.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/client_reqrep.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/web_app.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/pytest_plugin.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/abc.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/streams.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/web.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/http_websocket.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/client.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/log.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/base_protocol.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/web_server.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/helpers.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/payload_streamer.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/web_fileresponse.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/client_exceptions.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/web_response.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/multipart.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/http_parser.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/formdata.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/web_ws.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/web_request.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/frozenlist.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/resolver.py -> build/lib.linux-x86_64-3.7/aiohttp\r\n    running egg_info\r\n    writing aiohttp.egg-info/PKG-INFO\r\n    writing dependency_links to aiohttp.egg-info/dependency_links.txt\r\n    writing requirements to aiohttp.egg-info/requires.txt\r\n    writing top-level names to aiohttp.egg-info/top_level.txt\r\n    reading manifest file 'aiohttp.egg-info/SOURCES.txt'\r\n    reading manifest template 'MANIFEST.in'\r\n    warning: no files found matching 'aiohttp' anywhere in distribution\r\n    warning: no previously-included files matching '*.pyc' found anywhere in distribution\r\n    warning: no previously-included files matching '*.pyd' found anywhere in distribution\r\n    warning: no previously-included files matching '*.so' found anywhere in distribution\r\n    warning: no previously-included files matching '*.lib' found anywhere in distribution\r\n    warning: no previously-included files matching '*.dll' found anywhere in distribution\r\n    warning: no previously-included files matching '*.a' found anywhere in distribution\r\n    warning: no previously-included files matching '*.obj' found anywhere in distribution\r\n    warning: no previously-included files found matching 'aiohttp/*.html'\r\n    no previously-included directories found matching 'docs/_build'\r\n    writing manifest file 'aiohttp.egg-info/SOURCES.txt'\r\n    copying aiohttp/_cparser.pxd -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/_find_header.c -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/_find_header.h -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/_find_header.pxd -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/_frozenlist.c -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/_frozenlist.pyx -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/_headers.pxi -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/_helpers.c -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/_helpers.pyi -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/_helpers.pyx -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/_http_parser.c -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/_http_parser.pyx -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/_http_writer.c -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/_http_writer.pyx -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/_websocket.c -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/_websocket.pyx -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/frozenlist.pyi -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/py.typed -> build/lib.linux-x86_64-3.7/aiohttp\r\n    copying aiohttp/signals.pyi -> build/lib.linux-x86_64-3.7/aiohttp\r\n    running build_ext\r\n    building 'aiohttp._websocket' extension\r\n    creating build/temp.linux-x86_64-3.7\r\n    creating build/temp.linux-x86_64-3.7/aiohttp\r\n    x86_64-linux-gnu-gcc -pthread -DNDEBUG -g -fwrapv -O2 -Wall -g -fdebug-prefix-map=/build/python3.7-gdrLxR/python3.7-3.7.0=. -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -fPIC -I/usr/include/python3.7m -c aiohttp/_websocket.c -o build/temp.linux-x86_64-3.7/aiohttp/_websocket.o\r\n    aiohttp/_websocket.c:17:10: fatal error: Python.h: No such file or directory\r\n     #include \"Python.h\"\r\n              ^~~~~~~~~~\r\n    compilation terminated.\r\n    error: command 'x86_64-linux-gnu-gcc' failed with exit status 1\r\n    \r\n    ----------------------------------------\r\n```", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3241/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3241/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3226", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3226/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3226/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3226/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/3226", "id": 354693007, "node_id": "MDExOlB1bGxSZXF1ZXN0MjExMzkzMDgz", "number": 3226, "title": "Disable installing deps in RTD", "user": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 731921232, "node_id": "MDU6TGFiZWw3MzE5MjEyMzI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/infra", "name": "infra", "color": "e55e5b", "default": false, "description": null}, {"id": 743514498, "node_id": "MDU6TGFiZWw3NDM1MTQ0OTg=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/meta", "name": "meta", "color": "ccf794", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2018-08-28T11:43:33Z", "updated_at": "2019-10-28T01:04:44Z", "closed_at": "2018-08-28T11:43:47Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/3226", "html_url": "https://github.com/aio-libs/aiohttp/pull/3226", "diff_url": "https://github.com/aio-libs/aiohttp/pull/3226.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/3226.patch", "merged_at": "2018-08-28T11:43:47Z"}, "body": "Fixes #3221\r\n\r\nRef: https://docs.rtfd.io/en/latest/yaml-config.html", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3226/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3226/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3221", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3221/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3221/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3221/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3221", "id": 354314404, "node_id": "MDU6SXNzdWUzNTQzMTQ0MDQ=", "number": 3221, "title": "RTD is still showing docs for 3.3", "user": {"login": "hynek", "id": 41240, "node_id": "MDQ6VXNlcjQxMjQw", "avatar_url": "https://avatars.githubusercontent.com/u/41240?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hynek", "html_url": "https://github.com/hynek", "followers_url": "https://api.github.com/users/hynek/followers", "following_url": "https://api.github.com/users/hynek/following{/other_user}", "gists_url": "https://api.github.com/users/hynek/gists{/gist_id}", "starred_url": "https://api.github.com/users/hynek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hynek/subscriptions", "organizations_url": "https://api.github.com/users/hynek/orgs", "repos_url": "https://api.github.com/users/hynek/repos", "events_url": "https://api.github.com/users/hynek/events{/privacy}", "received_events_url": "https://api.github.com/users/hynek/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 303800438, "node_id": "MDU6TGFiZWwzMDM4MDA0Mzg=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/need%20pull%20request", "name": "need pull request", "color": "bfdadc", "default": false, "description": null}, {"id": 445958404, "node_id": "MDU6TGFiZWw0NDU5NTg0MDQ=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/documentation", "name": "documentation", "color": "0075ca", "default": true, "description": "Improvements or additions to documentation"}, {"id": 731921232, "node_id": "MDU6TGFiZWw3MzE5MjEyMzI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/infra", "name": "infra", "color": "e55e5b", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 12, "created_at": "2018-08-27T13:16:13Z", "updated_at": "2019-10-28T01:02:56Z", "closed_at": "2018-08-28T11:30:16Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "https://aiohttp.readthedocs.io/ is currently showing the docs for \u201cCurrent version is 3.3.2.\u201d", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3221/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3221/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3219", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3219/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3219/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3219/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3219", "id": 354289674, "node_id": "MDU6SXNzdWUzNTQyODk2NzQ=", "number": 3219, "title": "Header parsing regression in 3.4 w/ empty headers", "user": {"login": "hynek", "id": 41240, "node_id": "MDQ6VXNlcjQxMjQw", "avatar_url": "https://avatars.githubusercontent.com/u/41240?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hynek", "html_url": "https://github.com/hynek", "followers_url": "https://api.github.com/users/hynek/followers", "following_url": "https://api.github.com/users/hynek/following{/other_user}", "gists_url": "https://api.github.com/users/hynek/gists{/gist_id}", "starred_url": "https://api.github.com/users/hynek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hynek/subscriptions", "organizations_url": "https://api.github.com/users/hynek/orgs", "repos_url": "https://api.github.com/users/hynek/repos", "events_url": "https://api.github.com/users/hynek/events{/privacy}", "received_events_url": "https://api.github.com/users/hynek/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344996043, "node_id": "MDU6TGFiZWwzNDQ5OTYwNDM=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/server", "name": "server", "color": "006b75", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-08-27T11:58:18Z", "updated_at": "2019-10-28T01:02:53Z", "closed_at": "2018-08-28T22:39:23Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nA request containing\r\n\r\n```\r\nfinagle-http-retryable-request:\r\nX-TX-ID: abc\r\n```\r\n\r\nwill parse to:\r\n\r\n```\r\n'finagle-http-retryable-requestX-TX-ID': 'abc'\r\n```\r\n\r\n## Expected behaviour\r\n\r\nNot squishing them together like 3.3. :)\r\n\r\n## Actual behaviour\r\n\r\nSquishes together.\r\n\r\n## Steps to reproduce\r\n\r\nStart a simple aiohttp server, then:\r\n\r\n```\r\nnc localhost 5100\r\nPOST / HTTP/1.1\r\nFoo:\r\nBar: x\r\n```\r\n\r\ngives you: `<CIMultiDictProxy('FooBar': 'x')>`\r\n\r\nIt doesn\u2019t matter, whether there\u2019s a space behind `Foo:` or not.\r\n\r\n## Your environment\r\n\r\naiohttp 3.4.0. 3.3 works fine.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3219/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3219/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3218", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3218/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3218/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3218/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/3218", "id": 354268119, "node_id": "MDExOlB1bGxSZXF1ZXN0MjExMDcxMDA5", "number": 3218, "title": "Regression in parsing empty headers", "user": {"login": "popravich", "id": 323442, "node_id": "MDQ6VXNlcjMyMzQ0Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/323442?v=4", "gravatar_id": "", "url": "https://api.github.com/users/popravich", "html_url": "https://github.com/popravich", "followers_url": "https://api.github.com/users/popravich/followers", "following_url": "https://api.github.com/users/popravich/following{/other_user}", "gists_url": "https://api.github.com/users/popravich/gists{/gist_id}", "starred_url": "https://api.github.com/users/popravich/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/popravich/subscriptions", "organizations_url": "https://api.github.com/users/popravich/orgs", "repos_url": "https://api.github.com/users/popravich/repos", "events_url": "https://api.github.com/users/popravich/events{/privacy}", "received_events_url": "https://api.github.com/users/popravich/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344995986, "node_id": "MDU6TGFiZWwzNDQ5OTU5ODY=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/client", "name": "client", "color": "bfd4f2", "default": false, "description": null}, {"id": 344996043, "node_id": "MDU6TGFiZWwzNDQ5OTYwNDM=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/server", "name": "server", "color": "006b75", "default": false, "description": null}, {"id": 1472801557, "node_id": "MDU6TGFiZWwxNDcyODAxNTU3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bot:chronographer:provided", "name": "bot:chronographer:provided", "color": "ededed", "default": false, "description": "There is a change note present in this PR"}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2018-08-27T10:39:30Z", "updated_at": "2019-10-28T02:04:26Z", "closed_at": "2018-08-28T14:16:22Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/3218", "html_url": "https://github.com/aio-libs/aiohttp/pull/3218", "diff_url": "https://github.com/aio-libs/aiohttp/pull/3218.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/3218.patch", "merged_at": "2018-08-28T14:16:22Z"}, "body": "## What do these changes do?\r\n\r\nThe v3.4 release bring regression in headers parsing:\r\nempty header values are ignored and such empty headers get concatenated to first non-empty.\r\n\r\nThis PR just adds a test to recreate the issue #3219.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3218/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3218/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3208", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3208/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3208/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3208/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3208", "id": 352516709, "node_id": "MDU6SXNzdWUzNTI1MTY3MDk=", "number": 3208, "title": "TCP not closing properly after POST", "user": {"login": "Swamp-Ig", "id": 6317645, "node_id": "MDQ6VXNlcjYzMTc2NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/6317645?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Swamp-Ig", "html_url": "https://github.com/Swamp-Ig", "followers_url": "https://api.github.com/users/Swamp-Ig/followers", "following_url": "https://api.github.com/users/Swamp-Ig/following{/other_user}", "gists_url": "https://api.github.com/users/Swamp-Ig/gists{/gist_id}", "starred_url": "https://api.github.com/users/Swamp-Ig/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Swamp-Ig/subscriptions", "organizations_url": "https://api.github.com/users/Swamp-Ig/orgs", "repos_url": "https://api.github.com/users/Swamp-Ig/repos", "events_url": "https://api.github.com/users/Swamp-Ig/events{/privacy}", "received_events_url": "https://api.github.com/users/Swamp-Ig/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 303800438, "node_id": "MDU6TGFiZWwzMDM4MDA0Mzg=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/need%20pull%20request", "name": "need pull request", "color": "bfdadc", "default": false, "description": null}, {"id": 344995986, "node_id": "MDU6TGFiZWwzNDQ5OTU5ODY=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/client", "name": "client", "color": "bfd4f2", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, {"login": "Swamp-Ig", "id": 6317645, "node_id": "MDQ6VXNlcjYzMTc2NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/6317645?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Swamp-Ig", "html_url": "https://github.com/Swamp-Ig", "followers_url": "https://api.github.com/users/Swamp-Ig/followers", "following_url": "https://api.github.com/users/Swamp-Ig/following{/other_user}", "gists_url": "https://api.github.com/users/Swamp-Ig/gists{/gist_id}", "starred_url": "https://api.github.com/users/Swamp-Ig/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Swamp-Ig/subscriptions", "organizations_url": "https://api.github.com/users/Swamp-Ig/orgs", "repos_url": "https://api.github.com/users/Swamp-Ig/repos", "events_url": "https://api.github.com/users/Swamp-Ig/events{/privacy}", "received_events_url": "https://api.github.com/users/Swamp-Ig/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 20, "created_at": "2018-08-21T12:29:50Z", "updated_at": "2019-10-28T02:01:38Z", "closed_at": "2018-08-25T14:33:34Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nI'm connecting to an IOT device (airconditioner) with a REST interface.\r\n\r\nPosting commands using >=3.0 doesn't work. The post goes through and the status OK is returned, but there's some issue with the TCP connection. \r\n\r\n## Steps to reproduce\r\n\r\nWithin the [wireshark packet capture](https://github.com/aio-libs/aiohttp/files/2306190/AIO-Issue.zip) there's two different TCP transactions with exactly the same aiohttp code running (also within the zip file). The short version of the code without imports etc looks like this:\r\n\r\n```python\r\ndevice_ip = '10.0.0.107'\r\n\r\nasync def send_command_async(command: str, data: Any):\r\n    body = {command : data}\r\n    url = f\"http://{device_ip}/{command}\"\r\n    async with ClientSession() as session:\r\n        async with session.post(url, json=body) as response:\r\n            response.raise_for_status()\r\n\r\nloop: AbstractEventLoop = asyncio.get_event_loop()\r\nloop.run_until_complete(loop.create_task(send_command_async('SystemMODE', 'heat')))\r\n```\r\n\r\nIf you get aiohttp<3.0 you get the first packet capture, up until packet 10. Everything is happy.\r\n\r\nWith the latest version and any version above 3.0, all goes well until the ACK gets sent for the OK packet, then a whole spume of out of order and dup ack packets goes back and forth.\r\n\r\nI can't actually see any difference in what gets sent or anything. It's possible it's the device that's the issue, I've emailed the guys that produce the device so they are on this issue too, but the low level TCP stuff is a bit beyond me.\r\n\r\nThe odd thing is that http GET works just fine.\r\n\r\n## Environment\r\n\r\n* Python 3.6\r\n* Windows 10\r\n* Latest aiohttp (but did a regression test back until <3.0 version)\r\n* The device is an [iZone air conditioner](http://izone.com.au/)", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3208/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3208/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3144", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3144/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3144/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3144/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3144", "id": 342638254, "node_id": "MDU6SXNzdWUzNDI2MzgyNTQ=", "number": 3144, "title": "Test test_addresses[pyloop] fails with OSError: AF_UNIX path too long", "user": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 731921232, "node_id": "MDU6TGFiZWw3MzE5MjEyMzI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/infra", "name": "infra", "color": "e55e5b", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2018-07-19T08:56:25Z", "updated_at": "2019-10-28T02:02:53Z", "closed_at": "2018-07-31T09:26:53Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nIt looks like because of path nesting under OS X this test fails.\r\n\r\n## Expected behaviour\r\n\r\nSocket address fits os limit\r\n\r\n## Actual behaviour\r\n\r\n<!-- What's actually happening? -->\r\n```python\r\n\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022 test_addresses[pyloop] \u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\u00e2\u20ac\u2022\r\n\r\n\r\n\r\nmake_runner = <function make_runner.<locals>.go at 0x10e764bf8>\r\n\r\ntmpdir = local('/private/var/folders/bb/n7t3rs157850byt_jfdcq9k80000gn/T/pytest-of-travis/pytest-2/test_addresses_pyloop_0')\r\n\r\n\r\n\r\n\u001b[1m    @pytest.mark.skipif(platform.system() == \"Windows\",\u001b[0m\r\n\r\n\u001b[1m                        reason=\"Unix socket support is required\")\u001b[0m\r\n\r\n\u001b[1m    async def test_addresses(make_runner, tmpdir):\u001b[0m\r\n\r\n\u001b[1m        runner = make_runner()\u001b[0m\r\n\r\n\u001b[1m        await runner.setup()\u001b[0m\r\n\r\n\u001b[1m        tcp = web.TCPSite(runner)\u001b[0m\r\n\r\n\u001b[1m        await tcp.start()\u001b[0m\r\n\r\n\u001b[1m        path = str(tmpdir / 'tmp.sock')\u001b[0m\r\n\r\n\u001b[1m        unix = web.UnixSite(runner, path)\u001b[0m\r\n\r\n\u001b[1m>       await unix.start()\u001b[0m\r\n\r\n\r\n\r\n\u001b[1m\u001b[31mtests/test_web_runner.py\u001b[0m:111: \r\n\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\n\u001b[1m\u001b[31maiohttp/web_runner.py\u001b[0m:112: in start\r\n\r\n\u001b[1m    ssl=self._ssl_context, backlog=self._backlog)\u001b[0m\r\n\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\n\r\n\r\nself = <_UnixSelectorEventLoop running=False closed=False debug=False>\r\n\r\nprotocol_factory = <aiohttp.web_server.Server object at 0x10e72ca20>\r\n\r\npath = '/private/var/folders/bb/n7t3rs157850byt_jfdcq9k80000gn/T/pytest-of-travis/pytest-2/test_addresses_pyloop_0/tmp.sock'\r\n\r\n\r\n\r\n\u001b[1m    async def create_unix_server(\u001b[0m\r\n\r\n\u001b[1m            self, protocol_factory, path=None, *,\u001b[0m\r\n\r\n\u001b[1m            sock=None, backlog=100, ssl=None,\u001b[0m\r\n\r\n\u001b[1m            ssl_handshake_timeout=None,\u001b[0m\r\n\r\n\u001b[1m            start_serving=True):\u001b[0m\r\n\r\n\u001b[1m        if isinstance(ssl, bool):\u001b[0m\r\n\r\n\u001b[1m            raise TypeError('ssl argument must be an SSLContext or None')\u001b[0m\r\n\r\n\u001b[1m    \u001b[0m\r\n\r\n\u001b[1m        if ssl_handshake_timeout is not None and not ssl:\u001b[0m\r\n\r\n\u001b[1m            raise ValueError(\u001b[0m\r\n\r\n\u001b[1m                'ssl_handshake_timeout is only meaningful with ssl')\u001b[0m\r\n\r\n\u001b[1m    \u001b[0m\r\n\r\n\u001b[1m        if path is not None:\u001b[0m\r\n\r\n\u001b[1m            if sock is not None:\u001b[0m\r\n\r\n\u001b[1m                raise ValueError(\u001b[0m\r\n\r\n\u001b[1m                    'path and sock can not be specified at the same time')\u001b[0m\r\n\r\n\u001b[1m    \u001b[0m\r\n\r\n\u001b[1m            path = os.fspath(path)\u001b[0m\r\n\r\n\u001b[1m            sock = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)\u001b[0m\r\n\r\n\u001b[1m    \u001b[0m\r\n\r\n\u001b[1m            # Check for abstract socket. `str` and `bytes` paths are supported.\u001b[0m\r\n\r\n\u001b[1m            if path[0] not in (0, '\\x00'):\u001b[0m\r\n\r\n\u001b[1m                try:\u001b[0m\r\n\r\n\u001b[1m                    if stat.S_ISSOCK(os.stat(path).st_mode):\u001b[0m\r\n\r\n\u001b[1m                        os.remove(path)\u001b[0m\r\n\r\n\u001b[1m                except FileNotFoundError:\u001b[0m\r\n\r\n\u001b[1m                    pass\u001b[0m\r\n\r\n\u001b[1m                except OSError as err:\u001b[0m\r\n\r\n\u001b[1m                    # Directory may have permissions only to create socket.\u001b[0m\r\n\r\n\u001b[1m                    logger.error('Unable to check or remove stale UNIX socket '\u001b[0m\r\n\r\n\u001b[1m                                 '%r: %r', path, err)\u001b[0m\r\n\r\n\u001b[1m    \u001b[0m\r\n\r\n\u001b[1m            try:\u001b[0m\r\n\r\n\u001b[1m>               sock.bind(path)\u001b[0m\r\n\r\n\u001b[1m\u001b[31mE               OSError: AF_UNIX path too long\u001b[0m\r\n\r\n\r\n\r\n\u001b[1m\u001b[31m../../../.pyenv/versions/3.7.0/lib/python3.7/asyncio/unix_events.py\u001b[0m:284: OSError\r\n```\r\n\r\n## Steps to reproduce\r\n\r\n<!-- Please describe steps to reproduce the issue.\r\n     If you have a script that does that please include it here within\r\n     markdown code markup -->\r\nhttps://api.travis-ci.com/v3/job/135145022/log.txt\r\n\r\n## Your environment\r\n\r\nOS X under Travis", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3144/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3144/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3142", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3142/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3142/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3142/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3142", "id": 342463134, "node_id": "MDU6SXNzdWUzNDI0NjMxMzQ=", "number": 3142, "title": "docs.aiohttp.org down \"Error 1014: CNAME Cross-User Banned\"", "user": {"login": "wolph", "id": 270571, "node_id": "MDQ6VXNlcjI3MDU3MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/270571?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wolph", "html_url": "https://github.com/wolph", "followers_url": "https://api.github.com/users/wolph/followers", "following_url": "https://api.github.com/users/wolph/following{/other_user}", "gists_url": "https://api.github.com/users/wolph/gists{/gist_id}", "starred_url": "https://api.github.com/users/wolph/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wolph/subscriptions", "organizations_url": "https://api.github.com/users/wolph/orgs", "repos_url": "https://api.github.com/users/wolph/repos", "events_url": "https://api.github.com/users/wolph/events{/privacy}", "received_events_url": "https://api.github.com/users/wolph/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 731921232, "node_id": "MDU6TGFiZWw3MzE5MjEyMzI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/infra", "name": "infra", "color": "e55e5b", "default": false, "description": null}, {"id": 743514498, "node_id": "MDU6TGFiZWw3NDM1MTQ0OTg=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/meta", "name": "meta", "color": "ccf794", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 25, "created_at": "2018-07-18T19:36:12Z", "updated_at": "2019-10-28T03:01:33Z", "closed_at": "2018-07-19T12:23:07Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "As the description says, the documentation site is down: http://docs.aiohttp.org/\r\n\r\nA temporary workaround might be to change the link to: https://aiohttp.readthedocs.io/en/stable/", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3142/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3142/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3102", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3102/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3102/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3102/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3102", "id": 335087200, "node_id": "MDU6SXNzdWUzMzUwODcyMDA=", "number": 3102, "title": "Fix (make robust) test_timer_context_cancelled under Python 3.7", "user": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 58986077, "node_id": "MDU6TGFiZWw1ODk4NjA3Nw==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/enhancement", "name": "enhancement", "color": "84b6eb", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2018-06-23T10:04:54Z", "updated_at": "2019-10-28T03:02:10Z", "closed_at": "2018-07-10T15:51:24Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\n<!-- Please describe your problem and why the fix is important. -->\r\nWith emerging of 3.7, we need to adjust test suite to pass under this env\r\n\r\n## Expected behaviour\r\n\r\n<!-- What is the behaviour you expect? -->\r\ntest passes\r\n\r\n## Actual behaviour\r\n\r\nOne of coroutine cancellation tests fails:\r\n<!-- What's actually happening? -->\r\n```python-traceback\r\n$ make cov-ci-no-ext\r\n...\r\n\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015 test_timer_context_cancelled \u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\r\n    def test_timer_context_cancelled():\r\n        with mock.patch('aiohttp.helpers.asyncio') as m_asyncio:\r\n            m_asyncio.TimeoutError = asyncio.TimeoutError\r\n            loop = mock.Mock()\r\n            ctx = helpers.TimerContext(loop)\r\n            ctx.timeout()\r\n    \r\n            with pytest.raises(asyncio.TimeoutError):\r\n                with ctx:\r\n                    pass\r\n    \r\n>           assert m_asyncio.Task.current_task.return_value.cancel.called\r\nE           AssertionError: assert False\r\nE            +  where False = <MagicMock name='asyncio.Task.current_task().cancel' id='23073207868104'>.called\r\nE            +    where <MagicMock name='asyncio.Task.current_task().cancel' id='23073207868104'> = <MagicMock name='asyncio.Task.current_task()' id='23073207876128'>.cancel\r\nE            +      where <MagicMock name='asyncio.Task.current_task()' id='23073207876128'> = <MagicMock name='asyncio.Task.current_task' id='23073207863616'>.return_value\r\nE            +        where <MagicMock name='asyncio.Task.current_task' id='23073207863616'> = <MagicMock name='asyncio.Task' id='23073207799992'>.current_task\r\nE            +          where <MagicMock name='asyncio.Task' id='23073207799992'> = <MagicMock name='asyncio' id='23073210485560'>.Task\r\ntests/test_helpers.py:430: AssertionError\r\n```\r\n\r\n## Steps to reproduce\r\n\r\n<!-- Please describe steps to reproduce the issue.\r\n     If you have a script that does that please include it here within\r\n     markdown code markup -->\r\nSee https://travis-ci.com/aio-libs/aiohttp/jobs/130964628#L793-L814\r\n\r\n## Your environment\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes aiohttp version, OS, proxy server and other bits that\r\n     are related to your case. \r\n     \r\n     IMPORTANT: aiohttp is both server framework and client library.\r\n     For getting rid of confusing please put 'server', 'client' or 'both'\r\n     word here.\r\n     -->\r\nTravis CI", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3102/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3102/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3048", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3048/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3048/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3048/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/3048", "id": 328489924, "node_id": "MDExOlB1bGxSZXF1ZXN0MTkyMDEyMzcy", "number": 3048, "title": "Fix Travis CI config env vars and deduplicate deploy step", "user": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 731921232, "node_id": "MDU6TGFiZWw3MzE5MjEyMzI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/infra", "name": "infra", "color": "e55e5b", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2018-06-01T11:51:04Z", "updated_at": "2019-10-28T04:04:37Z", "closed_at": "2018-06-04T10:24:33Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/3048", "html_url": "https://github.com/aio-libs/aiohttp/pull/3048", "diff_url": "https://github.com/aio-libs/aiohttp/pull/3048.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/3048.patch", "merged_at": "2018-06-04T10:24:33Z"}, "body": "<!-- Thank you for your contribution! -->\r\n\r\n## What do these changes do?\r\nFix Travis CI deployment to PYPI\r\n<!-- Please give a short brief about these changes. -->\r\n\r\n## Are there changes in behavior for the user?\r\nN/A\r\n<!-- Outline any notable behaviour for the end users. -->\r\n\r\n## Related issue number\r\nN/A\r\n<!-- Are there any issues opened that will be resolved by merging this change? -->\r\n\r\n## Checklist\r\n\r\n- [X] I think the code is well written\r\n- [ ] Unit tests for the changes exist\r\n- [ ] Documentation reflects the changes\r\n- [ ] If you provide code modification, please add yourself to `CONTRIBUTORS.txt`\r\n  * The format is &lt;Name&gt; &lt;Surname&gt;.\r\n  * Please keep alphabetical order, the file is sorted by names. \r\n- [ ] Add a new news fragment into the `CHANGES` folder\r\n  * name it `<issue_id>.<type>` for example (588.bugfix)\r\n  * if you don't have an `issue_id` change it to the pr id after creating the pr\r\n  * ensure type is one of the following:\r\n    * `.feature`: Signifying a new feature.\r\n    * `.bugfix`: Signifying a bug fix.\r\n    * `.doc`: Signifying a documentation improvement.\r\n    * `.removal`: Signifying a deprecation or removal of public API.\r\n    * `.misc`: A ticket has been closed, but it is not of interest to users.\r\n  * Make sure to use full sentences with correct case and punctuation, for example: \"Fix issue with non-ascii contents in doctest text files.\"\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3048/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3048/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3009", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3009/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3009/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3009/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/3009", "id": 324107969, "node_id": "MDU6SXNzdWUzMjQxMDc5Njk=", "number": 3009, "title": "Parser of the Forwarded header ignores the port number", "user": {"login": "gjcarneiro", "id": 2197096, "node_id": "MDQ6VXNlcjIxOTcwOTY=", "avatar_url": "https://avatars.githubusercontent.com/u/2197096?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gjcarneiro", "html_url": "https://github.com/gjcarneiro", "followers_url": "https://api.github.com/users/gjcarneiro/followers", "following_url": "https://api.github.com/users/gjcarneiro/following{/other_user}", "gists_url": "https://api.github.com/users/gjcarneiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/gjcarneiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gjcarneiro/subscriptions", "organizations_url": "https://api.github.com/users/gjcarneiro/orgs", "repos_url": "https://api.github.com/users/gjcarneiro/repos", "events_url": "https://api.github.com/users/gjcarneiro/events{/privacy}", "received_events_url": "https://api.github.com/users/gjcarneiro/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344996043, "node_id": "MDU6TGFiZWwzNDQ5OTYwNDM=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/server", "name": "server", "color": "006b75", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-05-17T17:00:57Z", "updated_at": "2019-10-28T05:02:05Z", "closed_at": "2018-05-19T10:01:27Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nParser of the `Forwarded` header ignores the port number.\r\n\r\n## Expected behaviour\r\n\r\nParsing the header `Forwarded: for=1.2.3.4:5678` should yield a `request.forwarded` value of `({\"for\": \"1.2.3.4:5678\"},)`.\r\n\r\n## Actual behaviour\r\n\r\nParsing the header `Forwarded: for=1.2.3.4:5678` gives me `request.forwarded` value of `({\"for\": \"1.2.3.4\"},)`.  That is, it removes the client port number.\r\n\r\n## Your environment\r\n\r\naiohttp 3.2.1 / Python 3.6.5.\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3009/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/3009/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2997", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2997/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2997/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2997/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/2997", "id": 322705668, "node_id": "MDU6SXNzdWUzMjI3MDU2Njg=", "number": 2997, "title": "codecov integration is broken", "user": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 731921232, "node_id": "MDU6TGFiZWw3MzE5MjEyMzI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/infra", "name": "infra", "color": "e55e5b", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 23, "created_at": "2018-05-14T07:45:22Z", "updated_at": "2019-10-28T05:01:53Z", "closed_at": "2018-05-22T20:50:37Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "body": "I've tried both `bash` script and `codecov` package from PyPI.\r\nBoth ways are failing on uploading data to codecov server.\r\n\r\nLooks like it is a result of migration to travis-ci.com but I don't sure.\r\n\r\nAny ideas?", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2997/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2997/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2942", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2942/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2942/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2942/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/2942", "id": 315011208, "node_id": "MDU6SXNzdWUzMTUwMTEyMDg=", "number": 2942, "title": "enable_compression doesn't work with FileResponse in sendfile mode", "user": {"login": "savv", "id": 747519, "node_id": "MDQ6VXNlcjc0NzUxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/747519?v=4", "gravatar_id": "", "url": "https://api.github.com/users/savv", "html_url": "https://github.com/savv", "followers_url": "https://api.github.com/users/savv/followers", "following_url": "https://api.github.com/users/savv/following{/other_user}", "gists_url": "https://api.github.com/users/savv/gists{/gist_id}", "starred_url": "https://api.github.com/users/savv/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/savv/subscriptions", "organizations_url": "https://api.github.com/users/savv/orgs", "repos_url": "https://api.github.com/users/savv/repos", "events_url": "https://api.github.com/users/savv/events{/privacy}", "received_events_url": "https://api.github.com/users/savv/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 277836062, "node_id": "MDU6TGFiZWwyNzc4MzYwNjI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/good%20first%20issue", "name": "good first issue", "color": "7057ff", "default": true, "description": "Good for newcomers"}, {"id": 344996043, "node_id": "MDU6TGFiZWwzNDQ5OTYwNDM=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/server", "name": "server", "color": "006b75", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2018-04-17T11:05:57Z", "updated_at": "2019-10-28T06:02:14Z", "closed_at": "2018-04-17T20:00:48Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nresponse.enable_compression doesn't work on Heroku.\r\n\r\n## Expected behaviour\r\nenable_compression on a response should work on Heroku.\r\n\r\n\r\n## Actual behaviour\r\nWhile this worked locally just fine, Heroku didn't like it when I enabled compression on a FileResponse:\r\nApr 17 11:58:19 my-app-staging heroku/router:  http_error=\"Bad chunk\" at=error code=H17 desc=\"Poorly formatted HTTP response\" method=GET path=\"/\" host=my-app-staging.herokuapp.com request_id=0bc47133-af19-4999-bc0f-179054b7388a fwd=\"xx.xx.xx.xx\" dyno=web.1 connect=0ms service=19ms status=503 bytes= protocol=https \r\nApr 17 11:58:19 my-app-staging heroku/router:  http_error=\"Bad chunk\" at=error code=H17 desc=\"Poorly formatted HTTP response\" method=GET path=\"/\" host=my-app-staging.herokuapp.com request_id=9c1b4583-61d5-4867-bf1a-75de194cf71f fwd=\"xx.xx.xx.xx\" dyno=web.1 connect=0ms service=5ms status=503 bytes= protocol=https \r\nApr 17 11:58:23 my-app-staging heroku/router:  http_error=\"Bad chunk\" at=error code=H17 desc=\"Poorly formatted HTTP response\" method=GET path=\"/\" host=my-app-staging.herokuapp.com request_id=a2f80aee-0ba0-4117-9139-123a79fd2f1c fwd=\"xx.xx.xx.xx\" dyno=web.1 connect=0ms service=3ms status=503 bytes= protocol=https \r\n\r\n## Steps to reproduce\r\n```\r\n        resp = web.FileResponse('./dist/index.html', headers={'Cache-Control': 'no-cache'})\r\n        resp.enable_compression()\r\n        return resp\r\n```\r\n\r\n## Your environment\r\naiohttp==2.3.6\r\nUsing aiohttp directly on Heroku (no gunicorn/etc).", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2942/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2942/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2892", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2892/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2892/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2892/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/2892", "id": 309748195, "node_id": "MDU6SXNzdWUzMDk3NDgxOTU=", "number": 2892, "title": "Encoding detection error", "user": {"login": "decaz", "id": 31096, "node_id": "MDQ6VXNlcjMxMDk2", "avatar_url": "https://avatars.githubusercontent.com/u/31096?v=4", "gravatar_id": "", "url": "https://api.github.com/users/decaz", "html_url": "https://github.com/decaz", "followers_url": "https://api.github.com/users/decaz/followers", "following_url": "https://api.github.com/users/decaz/following{/other_user}", "gists_url": "https://api.github.com/users/decaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/decaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/decaz/subscriptions", "organizations_url": "https://api.github.com/users/decaz/orgs", "repos_url": "https://api.github.com/users/decaz/repos", "events_url": "https://api.github.com/users/decaz/events{/privacy}", "received_events_url": "https://api.github.com/users/decaz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344995986, "node_id": "MDU6TGFiZWwzNDQ5OTU5ODY=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/client", "name": "client", "color": "bfd4f2", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/19", "html_url": "https://github.com/aio-libs/aiohttp/milestone/19", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/19/labels", "id": 3103867, "node_id": "MDk6TWlsZXN0b25lMzEwMzg2Nw==", "number": 19, "title": "3.1", "description": "", "creator": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 23, "state": "closed", "created_at": "2018-02-09T20:44:20Z", "updated_at": "2018-05-07T07:09:00Z", "due_on": null, "closed_at": "2018-05-07T07:09:00Z"}, "comments": 3, "created_at": "2018-03-29T13:10:00Z", "updated_at": "2019-10-28T07:01:49Z", "closed_at": "2018-03-29T13:35:52Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nEncoding detection at the client is broken.\r\n\r\n## Expected behaviour\r\n\r\nNo errors.\r\n\r\n## Actual behaviour\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"test_aiohttp.py\", line 10, in <module>\r\n    loop.run_until_complete(main())\r\n  File \"/usr/lib/python3.6/asyncio/base_events.py\", line 467, in run_until_complete\r\n    return future.result()\r\n  File \"test_aiohttp.py\", line 7, in main\r\n    resp.get_encoding()\r\n  File \"/home/decaz/.virtualenvs/test/lib/python3.6/site-packages/aiohttp/client_reqrep.py\", line 839, in get_encoding\r\n    encoding = chardet.detect(self._body)['encoding']\r\n  File \"/home/decaz/.virtualenvs/test/lib/python3.6/site-packages/chardet/__init__.py\", line 34, in detect\r\n    '{0}'.format(type(byte_str)))\r\nTypeError: Expected object of type bytes or bytearray, got: <class 'NoneType'>\r\n```\r\n\r\n## Steps to reproduce\r\n\r\n```python\r\nimport asyncio\r\nimport aiohttp\r\n\r\nasync def main():\r\n    async with aiohttp.ClientSession() as session:\r\n        async with session.get('http://olympic.ru/rubric/lenta/') as resp:\r\n            await resp.text()\r\n            print(resp.get_encoding())\r\n\r\nloop = asyncio.get_event_loop()\r\nloop.run_until_complete(main())\r\n```\r\n\r\n## Your environment\r\n\r\naiohttp==3.1.1", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2892/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2892/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2858", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2858/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2858/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2858/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/2858", "id": 306840590, "node_id": "MDExOlB1bGxSZXF1ZXN0MTc2MTcxNDcx", "number": 2858, "title": "Do fire DNS tracing events", "user": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344995986, "node_id": "MDU6TGFiZWwzNDQ5OTU5ODY=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/client", "name": "client", "color": "bfd4f2", "default": false, "description": null}, {"id": 1472801557, "node_id": "MDU6TGFiZWwxNDcyODAxNTU3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bot:chronographer:provided", "name": "bot:chronographer:provided", "color": "ededed", "default": false, "description": "There is a change note present in this PR"}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/19", "html_url": "https://github.com/aio-libs/aiohttp/milestone/19", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/19/labels", "id": 3103867, "node_id": "MDk6TWlsZXN0b25lMzEwMzg2Nw==", "number": 19, "title": "3.1", "description": "", "creator": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 23, "state": "closed", "created_at": "2018-02-09T20:44:20Z", "updated_at": "2018-05-07T07:09:00Z", "due_on": null, "closed_at": "2018-05-07T07:09:00Z"}, "comments": 2, "created_at": "2018-03-20T12:15:43Z", "updated_at": "2019-10-28T07:04:44Z", "closed_at": "2018-03-20T23:07:34Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/2858", "html_url": "https://github.com/aio-libs/aiohttp/pull/2858", "diff_url": "https://github.com/aio-libs/aiohttp/pull/2858.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/2858.patch", "merged_at": "2018-03-20T23:07:34Z"}, "body": "Fix for #2841", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2858/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2858/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2841", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2841/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2841/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2841/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/2841", "id": 305904926, "node_id": "MDU6SXNzdWUzMDU5MDQ5MjY=", "number": 2841, "title": "Client DNS start/end events not fired", "user": {"login": "MykolaPolovyi", "id": 14869198, "node_id": "MDQ6VXNlcjE0ODY5MTk4", "avatar_url": "https://avatars.githubusercontent.com/u/14869198?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MykolaPolovyi", "html_url": "https://github.com/MykolaPolovyi", "followers_url": "https://api.github.com/users/MykolaPolovyi/followers", "following_url": "https://api.github.com/users/MykolaPolovyi/following{/other_user}", "gists_url": "https://api.github.com/users/MykolaPolovyi/gists{/gist_id}", "starred_url": "https://api.github.com/users/MykolaPolovyi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MykolaPolovyi/subscriptions", "organizations_url": "https://api.github.com/users/MykolaPolovyi/orgs", "repos_url": "https://api.github.com/users/MykolaPolovyi/repos", "events_url": "https://api.github.com/users/MykolaPolovyi/events{/privacy}", "received_events_url": "https://api.github.com/users/MykolaPolovyi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344995986, "node_id": "MDU6TGFiZWwzNDQ5OTU5ODY=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/client", "name": "client", "color": "bfd4f2", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/19", "html_url": "https://github.com/aio-libs/aiohttp/milestone/19", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/19/labels", "id": 3103867, "node_id": "MDk6TWlsZXN0b25lMzEwMzg2Nw==", "number": 19, "title": "3.1", "description": "", "creator": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 23, "state": "closed", "created_at": "2018-02-09T20:44:20Z", "updated_at": "2018-05-07T07:09:00Z", "due_on": null, "closed_at": "2018-05-07T07:09:00Z"}, "comments": 6, "created_at": "2018-03-16T12:11:19Z", "updated_at": "2019-10-28T07:02:38Z", "closed_at": "2018-03-20T23:07:39Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nUnable to track dns timing via TraceConfig using client with TcpConnector, since `None` intead of `traces` arg passed to direct and proxy connections methods\r\n\r\n```\r\n    async def _create_connection(self, req, traces=None):\r\n        \"\"\"Create connection.\r\n\r\n        Has same keyword arguments as BaseEventLoop.create_connection.\r\n        \"\"\"\r\n        if req.proxy:\r\n            _, proto = await self._create_proxy_connection(\r\n                req,\r\n                traces=None\r\n            )\r\n        else:\r\n            _, proto = await self._create_direct_connection(\r\n                req,\r\n                traces=None\r\n            )\r\n\r\n        return proto\r\n```\r\n## Expected behaviour\r\n\r\nworking DNS tracing with TCP\r\n\r\n## Actual behaviour\r\n\r\ndns events missed\r\n\r\n## Your environment\r\naiohttp: 3.0.9\r\nOS X\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2841/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2841/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2797", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2797/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2797/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2797/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/2797", "id": 302254388, "node_id": "MDU6SXNzdWUzMDIyNTQzODg=", "number": 2797, "title": "Docs of from make_mocked_request still refer to FlowControlStreamReader", "user": {"login": "hynek", "id": 41240, "node_id": "MDQ6VXNlcjQxMjQw", "avatar_url": "https://avatars.githubusercontent.com/u/41240?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hynek", "html_url": "https://github.com/hynek", "followers_url": "https://api.github.com/users/hynek/followers", "following_url": "https://api.github.com/users/hynek/following{/other_user}", "gists_url": "https://api.github.com/users/hynek/gists{/gist_id}", "starred_url": "https://api.github.com/users/hynek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hynek/subscriptions", "organizations_url": "https://api.github.com/users/hynek/orgs", "repos_url": "https://api.github.com/users/hynek/repos", "events_url": "https://api.github.com/users/hynek/events{/privacy}", "received_events_url": "https://api.github.com/users/hynek/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344996043, "node_id": "MDU6TGFiZWwzNDQ5OTYwNDM=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/server", "name": "server", "color": "006b75", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2018-03-05T10:54:47Z", "updated_at": "2019-10-28T08:01:32Z", "closed_at": "2018-03-15T17:47:53Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "The current docs at https://github.com/aio-libs/aiohttp/blob/master/docs/testing.rst are outdated, however I have no idea how to use StreamReader in testing since it's without any docs\u2026\r\n\r\nCould you provide an example on how to simple push a string into a mocked request? I know you want me to use the higher-level facilities but as mention in the other ticket, I cannot use them since they conflict with pytest-asyncio which is a essential to me.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2797/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2797/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2784", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2784/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2784/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2784/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/2784", "id": 301663883, "node_id": "MDU6SXNzdWUzMDE2NjM4ODM=", "number": 2784, "title": "EofStream and autoclose", "user": {"login": "thomaszdxsn", "id": 23616426, "node_id": "MDQ6VXNlcjIzNjE2NDI2", "avatar_url": "https://avatars.githubusercontent.com/u/23616426?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thomaszdxsn", "html_url": "https://github.com/thomaszdxsn", "followers_url": "https://api.github.com/users/thomaszdxsn/followers", "following_url": "https://api.github.com/users/thomaszdxsn/following{/other_user}", "gists_url": "https://api.github.com/users/thomaszdxsn/gists{/gist_id}", "starred_url": "https://api.github.com/users/thomaszdxsn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thomaszdxsn/subscriptions", "organizations_url": "https://api.github.com/users/thomaszdxsn/orgs", "repos_url": "https://api.github.com/users/thomaszdxsn/repos", "events_url": "https://api.github.com/users/thomaszdxsn/events{/privacy}", "received_events_url": "https://api.github.com/users/thomaszdxsn/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344995986, "node_id": "MDU6TGFiZWwzNDQ5OTU5ODY=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/client", "name": "client", "color": "bfd4f2", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2018-03-02T06:11:18Z", "updated_at": "2022-06-22T09:42:36Z", "closed_at": "2022-06-22T09:42:01Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nHi, I meet a problem with websocket's client message, sometimes I will receive EofStream object instead of bytes or str(so broken my program).I don't now what's this object.But I guess it means EOF right?\r\n\r\n```python\r\nasync for msg in self._ws_conn:\r\n    msg_data = json.loads(msg_data)  # msg_data maybe EofStream\r\n```\r\n\r\n## Expected behaviour\r\n\r\nIf EofStream meaning EOF, Why not just close this websocket connection, beacuase I see `ws_connect()` have a argument named 'autoclose', it default to `True`?\r\n\r\nOr EofStream has other meaning?\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2784/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2784/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2752", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2752/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2752/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2752/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/2752", "id": 299126768, "node_id": "MDU6SXNzdWUyOTkxMjY3Njg=", "number": 2752, "title": "IndexError in RequestHandler", "user": {"login": "Harmon758", "id": 9403740, "node_id": "MDQ6VXNlcjk0MDM3NDA=", "avatar_url": "https://avatars.githubusercontent.com/u/9403740?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Harmon758", "html_url": "https://github.com/Harmon758", "followers_url": "https://api.github.com/users/Harmon758/followers", "following_url": "https://api.github.com/users/Harmon758/following{/other_user}", "gists_url": "https://api.github.com/users/Harmon758/gists{/gist_id}", "starred_url": "https://api.github.com/users/Harmon758/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Harmon758/subscriptions", "organizations_url": "https://api.github.com/users/Harmon758/orgs", "repos_url": "https://api.github.com/users/Harmon758/repos", "events_url": "https://api.github.com/users/Harmon758/events{/privacy}", "received_events_url": "https://api.github.com/users/Harmon758/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344996043, "node_id": "MDU6TGFiZWwzNDQ5OTYwNDM=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/server", "name": "server", "color": "006b75", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2018-02-21T21:00:22Z", "updated_at": "2019-10-28T08:02:58Z", "closed_at": "2018-02-26T12:24:07Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "body": "While running a server with aiohttp 3.0.1 using Python 3.6 on Windows 7, I'm occasionally encountering this error:\r\n```\r\nTask exception was never retrieved\r\nfuture: <Task finished coro=<RequestHandler.start() done, defined at C:\\Program Files\\Python36\\lib\\site-packages\\aiohttp\\web_protocol.py:340> exception=IndexError('pop from an empty deque',)>\r\nTraceback (most recent call last):\r\n  File \"C:\\Program Files\\Python36\\lib\\site-packages\\aiohttp\\web_protocol.py\", line 365, in start\r\n    message, payload = self._messages.popleft()\r\nIndexError: pop from an empty deque\r\n```\r\nI'm not sure what requests are causing this, but it seems to be because it's possible for the Cython version of the HTTPRequestParser to return an empty tuple for `messages` through HTTPParser's `feed_data`.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2752/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2752/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2656", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2656/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2656/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2656/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/2656", "id": 287960277, "node_id": "MDU6SXNzdWUyODc5NjAyNzc=", "number": 2656, "title": "Adding routes to subapps is broken after attaching subapp to the parent app", "user": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344996043, "node_id": "MDU6TGFiZWwzNDQ5OTYwNDM=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/server", "name": "server", "color": "006b75", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-01-11T23:29:27Z", "updated_at": "2020-04-03T23:33:08Z", "closed_at": "2018-01-14T08:04:45Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nIf one adds routes to subapp before `app.add_subapp` accessing them works well, otherwise it results in 404.\r\n\r\n## Expected behaviour\r\n\r\nIt's naturally expected that routing will work well regardless of the order of function calls.\r\n\r\n## Actual behaviour\r\n\r\nGiven `sub_app_cbv.py`:\r\n```python\r\nimport sys\r\nimport aiohttp.web\r\n\r\nAPI_URL_PREFIX = r'/api/v1'\r\n\r\nclass PingView(aiohttp.web.View):\r\n    async def get(self):\r\n        return aiohttp.web.Response(text='pong')\r\n\r\ndef just_app_with_routes_def(app, api_app):\r\n    app.router.add_route('GET', API_URL_PREFIX + r'/ping/', PingView)\r\n\r\ndef sub_app_after_routes_def(app, api_app):\r\n    api_app.router.add_route('GET', r'/ping/', PingView)\r\n    app.add_subapp(API_URL_PREFIX, api_app)\r\n\r\ndef sub_app_before_routes_def(app, api_app):\r\n    app.add_subapp(API_URL_PREFIX, api_app)\r\n    api_app.router.add_route('GET', r'/ping/', PingView)\r\n\r\ndef run_app(coro_name):\r\n    print(f'Going to run {coro_name}')\r\n    setup_app = globals()[coro_name]\r\n    app = aiohttp.web.Application()\r\n    api_app = aiohttp.web.Application()\r\n    setup_app(app, api_app)\r\n    aiohttp.web.run_app(app)\r\n\r\ndef main():\r\n    if len(sys.argv) < 2:\r\n        raise RuntimeError('Supply one cli argument plz [just_app_with_routes_def|sub_app_after_routes_def|sub_app_before_routes_def]')\r\n    coro_name = sys.argv[1]\r\n    run_app(coro_name)\r\n\r\n__name__ == '__main__' and main()\r\n```\r\n\r\n##### Demo 1\r\n\r\n```shell\r\n$ python sub_app_cbv.py just_app_with_routes_def\r\nGoing to run just_app_with_routes_def\r\n======== Running on http://0.0.0.0:8080 ========\r\n(Press CTRL+C to quit)\r\n```\r\n\r\n```shell\r\n$ http :8080/api/v1/ping/\r\nHTTP/1.1 200 OK\r\nContent-Length: 4\r\nContent-Type: text/plain; charset=utf-8\r\nDate: Thu, 11 Jan 2018 23:17:52 GMT\r\nServer: Python/3.6 aiohttp/2.3.7\r\npong\r\n```\r\n\r\n##### Demo 2\r\n\r\n```shell\r\n$ python sub_app_cbv.py sub_app_after_routes_def\r\nGoing to run sub_app_after_routes_def\r\n======== Running on http://0.0.0.0:8080 ========\r\n(Press CTRL+C to quit)\r\n```\r\n\r\n```shell\r\n$ http :8080/api/v1/ping/\r\nHTTP/1.1 200 OK\r\nContent-Length: 4\r\nContent-Type: text/plain; charset=utf-8\r\nDate: Thu, 11 Jan 2018 23:20:58 GMT\r\nServer: Python/3.6 aiohttp/2.3.7\r\npong\r\n```\r\n\r\n##### Demo 3\r\n\r\n```shell\r\n$ python sub_app_cbv.py sub_app_before_routes_def\r\nGoing to run sub_app_before_routes_def\r\n======== Running on http://0.0.0.0:8080 ========\r\n(Press CTRL+C to quit)\r\n```\r\n\r\n```shell\r\n$ http :8080/api/v1/ping/\r\nHTTP/1.1 404 Not Found\r\nContent-Length: 14\r\nContent-Type: text/plain; charset=utf-8\r\nDate: Thu, 11 Jan 2018 23:21:41 GMT\r\nServer: Python/3.6 aiohttp/2.3.7\r\n404: Not Found\r\n```\r\n\r\n## Steps to reproduce\r\n\r\nSee above.\r\n\r\n## Your environment\r\n\r\nGentoo laptop, pyenv, 3.6. Not really env-related.\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2656/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2656/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2633", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2633/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2633/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2633/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/2633", "id": 285164615, "node_id": "MDU6SXNzdWUyODUxNjQ2MTU=", "number": 2633, "title": "Default access log format tries to include Referer header but spells it correctly and thus it doesn't work ", "user": {"login": "EdRowe", "id": 10861549, "node_id": "MDQ6VXNlcjEwODYxNTQ5", "avatar_url": "https://avatars.githubusercontent.com/u/10861549?v=4", "gravatar_id": "", "url": "https://api.github.com/users/EdRowe", "html_url": "https://github.com/EdRowe", "followers_url": "https://api.github.com/users/EdRowe/followers", "following_url": "https://api.github.com/users/EdRowe/following{/other_user}", "gists_url": "https://api.github.com/users/EdRowe/gists{/gist_id}", "starred_url": "https://api.github.com/users/EdRowe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/EdRowe/subscriptions", "organizations_url": "https://api.github.com/users/EdRowe/orgs", "repos_url": "https://api.github.com/users/EdRowe/repos", "events_url": "https://api.github.com/users/EdRowe/events{/privacy}", "received_events_url": "https://api.github.com/users/EdRowe/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344996043, "node_id": "MDU6TGFiZWwzNDQ5OTYwNDM=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/server", "name": "server", "color": "006b75", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/17", "html_url": "https://github.com/aio-libs/aiohttp/milestone/17", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/17/labels", "id": 2605213, "node_id": "MDk6TWlsZXN0b25lMjYwNTIxMw==", "number": 17, "title": "3.0", "description": "Drop Python 3.4 support, `async/await` should be used everywhere", "creator": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 46, "state": "closed", "created_at": "2017-06-26T17:45:09Z", "updated_at": "2018-02-12T13:18:02Z", "due_on": null, "closed_at": "2018-02-12T13:18:02Z"}, "comments": 2, "created_at": "2017-12-29T22:36:30Z", "updated_at": "2019-10-28T11:02:16Z", "closed_at": "2017-12-30T19:21:42Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "The default access log format attempts to output the Referer HTTP request header, referring to it as \"Referrer\". The latter is the correct spelling of the _word_, but the inventors of the _header_ misspelled it as \"Referer\". To make this work as intended, the LOG_FORMAT and the logging docs (which show the default log format) should be updated to use the misspelled version of the word. \r\n\r\n```LOG_FORMAT = '%a %t \"%r\" %s %b \"%{Referrer}i\" \"%{User-Agent}i\"'```\r\nvs\r\n```LOG_FORMAT = '%a %t \"%r\" %s %b \"%{Referer}i\" \"%{User-Agent}i\"'```\r\n\r\nThe docs for the default log format also do not match the actual default log format in that it shows %l and %u which don't actually exist and %t which doesn't appear to be in the default log format. \r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2633/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2633/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2577", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2577/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2577/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2577/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/2577", "id": 278070359, "node_id": "MDExOlB1bGxSZXF1ZXN0MTU1NTcwNzEz", "number": 2577, "title": "Correct request.app context (for handlers not just middlewares)", "user": {"login": "popravich", "id": 323442, "node_id": "MDQ6VXNlcjMyMzQ0Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/323442?v=4", "gravatar_id": "", "url": "https://api.github.com/users/popravich", "html_url": "https://github.com/popravich", "followers_url": "https://api.github.com/users/popravich/followers", "following_url": "https://api.github.com/users/popravich/following{/other_user}", "gists_url": "https://api.github.com/users/popravich/gists{/gist_id}", "starred_url": "https://api.github.com/users/popravich/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/popravich/subscriptions", "organizations_url": "https://api.github.com/users/popravich/orgs", "repos_url": "https://api.github.com/users/popravich/repos", "events_url": "https://api.github.com/users/popravich/events{/privacy}", "received_events_url": "https://api.github.com/users/popravich/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344996043, "node_id": "MDU6TGFiZWwzNDQ5OTYwNDM=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/server", "name": "server", "color": "006b75", "default": false, "description": null}, {"id": 1472801557, "node_id": "MDU6TGFiZWwxNDcyODAxNTU3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bot:chronographer:provided", "name": "bot:chronographer:provided", "color": "ededed", "default": false, "description": "There is a change note present in this PR"}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2017-11-30T10:31:28Z", "updated_at": "2019-10-28T11:04:23Z", "closed_at": "2017-12-04T16:32:14Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/2577", "html_url": "https://github.com/aio-libs/aiohttp/pull/2577", "diff_url": "https://github.com/aio-libs/aiohttp/pull/2577.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/2577.patch", "merged_at": "2017-12-04T16:32:14Z"}, "body": "This is an update to #2550 \r\n`_fix_request_current_app` middleware was added if application had any middlewares.\r\nNow it is yielded unconditionally to set proper context for handlers as well.\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2577/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2577/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2550", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2550/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2550/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2550/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/2550", "id": 276417947, "node_id": "MDExOlB1bGxSZXF1ZXN0MTU0NDA3MjEz", "number": 2550, "title": "Root app middleware receives wrong app context", "user": {"login": "popravich", "id": 323442, "node_id": "MDQ6VXNlcjMyMzQ0Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/323442?v=4", "gravatar_id": "", "url": "https://api.github.com/users/popravich", "html_url": "https://github.com/popravich", "followers_url": "https://api.github.com/users/popravich/followers", "following_url": "https://api.github.com/users/popravich/following{/other_user}", "gists_url": "https://api.github.com/users/popravich/gists{/gist_id}", "starred_url": "https://api.github.com/users/popravich/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/popravich/subscriptions", "organizations_url": "https://api.github.com/users/popravich/orgs", "repos_url": "https://api.github.com/users/popravich/repos", "events_url": "https://api.github.com/users/popravich/events{/privacy}", "received_events_url": "https://api.github.com/users/popravich/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344996043, "node_id": "MDU6TGFiZWwzNDQ5OTYwNDM=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/server", "name": "server", "color": "006b75", "default": false, "description": null}, {"id": 1472801557, "node_id": "MDU6TGFiZWwxNDcyODAxNTU3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bot:chronographer:provided", "name": "bot:chronographer:provided", "color": "ededed", "default": false, "description": "There is a change note present in this PR"}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 13, "created_at": "2017-11-23T15:47:59Z", "updated_at": "2019-10-28T12:04:15Z", "closed_at": "2017-11-27T22:11:09Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/2550", "html_url": "https://github.com/aio-libs/aiohttp/pull/2550", "diff_url": "https://github.com/aio-libs/aiohttp/pull/2550.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/2550.patch", "merged_at": "2017-11-27T22:11:09Z"}, "body": "## Long story short\r\n\r\nWhen handling request to sub-application root application's middlewares see wrong\r\n`request.app` instance \u2014 sub-app instead of the one they attached to.\r\n\r\nThis PR demonstrates it (adds failing test) but has no fix yet.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2550/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2550/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2522", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2522/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2522/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2522/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/2522", "id": 274455939, "node_id": "MDU6SXNzdWUyNzQ0NTU5Mzk=", "number": 2522, "title": "aiohttp and network is unreachable", "user": {"login": "Smosker", "id": 16837024, "node_id": "MDQ6VXNlcjE2ODM3MDI0", "avatar_url": "https://avatars.githubusercontent.com/u/16837024?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Smosker", "html_url": "https://github.com/Smosker", "followers_url": "https://api.github.com/users/Smosker/followers", "following_url": "https://api.github.com/users/Smosker/following{/other_user}", "gists_url": "https://api.github.com/users/Smosker/gists{/gist_id}", "starred_url": "https://api.github.com/users/Smosker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Smosker/subscriptions", "organizations_url": "https://api.github.com/users/Smosker/orgs", "repos_url": "https://api.github.com/users/Smosker/repos", "events_url": "https://api.github.com/users/Smosker/events{/privacy}", "received_events_url": "https://api.github.com/users/Smosker/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344995986, "node_id": "MDU6TGFiZWwzNDQ5OTU5ODY=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/client", "name": "client", "color": "bfd4f2", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 18, "created_at": "2017-11-16T09:56:35Z", "updated_at": "2019-10-28T11:02:23Z", "closed_at": "2017-11-20T07:49:20Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nI'm using aiohttp im my django docker application, when i run it outside docker - everything works fine, but if i run it inside docker - i get error (see traceback)\r\n\r\nvery simplified code:\r\nif you run it - no error will acquire, and if i run it in docker passing one url - no error acquired. If i pass two url with diferent hosts (like `https://onehost.com/someth, https://otherhost.com/someth`) - no error acquired. But if i pass two url with same host `https://onehost.com/someth, https://onehost.com/anything` - i get an error below but only when i run it in docker.\r\nFirst request with `https://onehost.com/someth` finished ok - i see the result, second with`https://onehost.com/anything` i got error.\r\n Any suggestions?\r\n\r\n```\r\nimport asyncio\r\nimport aiohttp\r\nfrom django.http import JsonResponse\r\nfrom django.views import View\r\n\r\n\r\nclass LinksView(View):\r\n    def post(self, request):\r\n\r\n        loop = asyncio.get_event_loop()\r\n        result = loop.run_until_complete(\r\n            run(request))\r\n        print(result)\r\n        return JsonResponse({})\r\n\r\n\r\nclass Helper:\r\n    def __init__(self, session, urls):\r\n        self.url_objects = urls\r\n        self.session = session\r\n\r\n    async def fetch(self, request, url_object):\r\n        async with self.session.request(**request) as response:\r\n            result = await response.json()\r\n            response.raise_for_status()\r\n\r\n        return result, url_object\r\n\r\n    async def get_result(self):\r\n        result_obj = {}\r\n        tasks = [\r\n            self.fetch(request=request, url_object=url_object)\r\n            for request, url_object in self.create_requests()\r\n        ]\r\n        for future in asyncio.as_completed(tasks):\r\n            response, url_object = await future\r\n            result_obj[url_object] = response\r\n\r\n        return result_obj\r\n\r\n    def create_requests(self):\r\n        requests = []\r\n        for url_object in self.url_objects:\r\n            request = self.create_request(url_object)\r\n            requests.append((request, url_object))\r\n\r\n        return requests\r\n\r\n    def create_request(self, url_object, ):\r\n        return dict(\r\n            url=url_object,\r\n            method='GET',\r\n        )\r\n\r\n\r\nasync def run(urls):\r\n    async with aiohttp.ClientSession(\r\n            connector=aiohttp.TCPConnector(\r\n                verify_ssl=False,\r\n            ),\r\n    ) as session:\r\n        helpers = [Helper(session=session, urls=urls)]\r\n\r\n        result_obj = []\r\n        tasks = [asyncio.ensure_future(helper.get_result())\r\n                 for helper in helpers]\r\n\r\n        for future in asyncio.as_completed(tasks):\r\n            result = await future\r\n            result_obj.append(result)\r\n\r\n    return result_obj\r\n\r\nLinksView().post(['https://jsonplaceholder.typicode.com/users',\r\n                  'https://jsonplaceholder.typicode.com/posts/1'])\r\n\r\n```\r\n\r\nTraceback:\r\n```\r\nTraceback (most recent call last):\r\n File \"/usr/local/lib/python3.5/dist-packages/aiohttp/connector.py\", line 796, in _create_direct_connection\r\n local_addr=self._local_addr)\r\n File \"/usr/lib/python3.5/asyncio/base_events.py\", line 695, in create_connection\r\n raise exceptions[0]\r\n File \"/usr/lib/python3.5/asyncio/base_events.py\", line 682, in create_connection\r\n yield from self.sock_connect(sock, address)\r\n File \"/usr/lib/python3.5/asyncio/selector_events.py\", line 402, in sock_connect\r\n return (yield from fut)\r\n File \"/usr/lib/python3.5/asyncio/futures.py\", line 363, in __iter__\r\n return self.result() # May raise too.\r\n File \"/usr/lib/python3.5/asyncio/futures.py\", line 274, in result\r\n raise self._exception\r\n File \"/usr/lib/python3.5/asyncio/selector_events.py\", line 407, in _sock_connect\r\n sock.connect(address)\r\nOSError: [Errno 101] Network is unreachable\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n File \"/usr/local/lib/python3.5/dist-packages/django/core/handlers/base.py\", line 185, in _get_response\r\n response = wrapped_callback(request, *callback_args, **callback_kwargs)\r\n File \"/usr/local/lib/python3.5/dist-packages/django/views/generic/base.py\", line 68, in view\r\n return self.dispatch(request, *args, **kwargs)\r\n File \"/usr/local/lib/python3.5/dist-packages/django/utils/decorators.py\", line 67, in _wrapper\r\n return bound_func(*args, **kwargs)\r\n File \"/usr/local/lib/python3.5/dist-packages/django/views/decorators/csrf.py\", line 58, in wrapped_view\r\n return view_func(*args, **kwargs)\r\n File \"/usr/local/lib/python3.5/dist-packages/django/utils/decorators.py\", line 63, in bound_func\r\n return func.__get__(self, type(self))(*args2, **kwargs2)\r\n File \"/usr/local/lib/python3.5/dist-packages/my_app/my_module/views.py\", line 25, in dispatch\r\n return super().dispatch(request, *args, **kwargs)\r\n File \"/usr/local/lib/python3.5/dist-packages/django/views/generic/base.py\", line 88, in dispatch\r\n return handler(request, *args, **kwargs)\r\n File \"/usr/local/lib/python3.5/dist-packages/my_app/my_module/views.py\", line 46, in post\r\n run(urls))\r\n File \"/usr/lib/python3.5/asyncio/base_events.py\", line 387, in run_until_complete\r\n return future.result()\r\n File \"/usr/lib/python3.5/asyncio/futures.py\", line 274, in result\r\n raise self._exception\r\n File \"/usr/lib/python3.5/asyncio/tasks.py\", line 239, in _step\r\n result = coro.send(None)\r\n File \"/usr/local/lib/python3.5/dist-packages/my_app/my_module/views.py\", line 122, in run\r\n result = await future\r\n File \"/usr/lib/python3.5/asyncio/tasks.py\", line 492, in _wait_for_one\r\n return f.result() # May raise f.exception().\r\n File \"/usr/lib/python3.5/asyncio/futures.py\", line 274, in result\r\n raise self._exception\r\n File \"/usr/lib/python3.5/asyncio/tasks.py\", line 239, in _step\r\n result = coro.send(None)\r\n File \"/usr/local/lib/python3.5/dist-packages/my_app/my_module/views.py\", line 83, in get_result\r\n response, url_object = await future\r\n File \"/usr/lib/python3.5/asyncio/tasks.py\", line 492, in _wait_for_one\r\n return f.result() # May raise f.exception().\r\n File \"/usr/lib/python3.5/asyncio/futures.py\", line 274, in result\r\n raise self._exception\r\n File \"/usr/lib/python3.5/asyncio/tasks.py\", line 239, in _step\r\n result = coro.send(None)\r\n File \"/usr/local/lib/python3.5/dist-packages/my_app/my_module/views.py\", line 65, in fetch\r\n async with self.session.request(**request) as response:\r\n File \"/usr/local/lib/python3.5/dist-packages/aiohttp/client.py\", line 692, in __aenter__\r\n self._resp = yield from self._coro\r\n File \"/usr/local/lib/python3.5/dist-packages/aiohttp/client.py\", line 269, in _request\r\n conn = yield from self._connector.connect(req)\r\n File \"/usr/local/lib/python3.5/dist-packages/aiohttp/connector.py\", line 392, in connect\r\n proto = yield from self._create_connection(req)\r\n File \"/usr/local/lib/python3.5/dist-packages/aiohttp/connector.py\", line 737, in _create_connection\r\n _, proto = yield from self._create_direct_connection(req)\r\n File \"/usr/local/lib/python3.5/dist-packages/aiohttp/connector.py\", line 823, in _create_direct_connection\r\n raise ClientConnectorError(req.connection_key, exc) from exc\r\naiohttp.client_exceptions.ClientConnectorError: Cannot connect to host onehost.com:443 ssl:True [Network is unreachable]\r\n```\r\n\r\n\r\n## Your environment\r\n\r\npython3.5\r\naiohttp==2.3.1\r\n\r\ni found same issue on stackoverflow, but there is no sutable answer where https://stackoverflow.com/questions/40347726/python-3-5-asyincio-and-aiohttp-errno-101-network-is-unreachable because i cant set `family=socket.AF_INET`", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2522/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2522/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2514", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2514/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2514/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2514/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/2514", "id": 273517770, "node_id": "MDU6SXNzdWUyNzM1MTc3NzA=", "number": 2514, "title": "Maintain compatibility between yarl and aiohttp", "user": {"login": "astaff", "id": 1032174, "node_id": "MDQ6VXNlcjEwMzIxNzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1032174?v=4", "gravatar_id": "", "url": "https://api.github.com/users/astaff", "html_url": "https://github.com/astaff", "followers_url": "https://api.github.com/users/astaff/followers", "following_url": "https://api.github.com/users/astaff/following{/other_user}", "gists_url": "https://api.github.com/users/astaff/gists{/gist_id}", "starred_url": "https://api.github.com/users/astaff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/astaff/subscriptions", "organizations_url": "https://api.github.com/users/astaff/orgs", "repos_url": "https://api.github.com/users/astaff/repos", "events_url": "https://api.github.com/users/astaff/events{/privacy}", "received_events_url": "https://api.github.com/users/astaff/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344995986, "node_id": "MDU6TGFiZWwzNDQ5OTU5ODY=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/client", "name": "client", "color": "bfd4f2", "default": false, "description": null}, {"id": 344996043, "node_id": "MDU6TGFiZWwzNDQ5OTYwNDM=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/server", "name": "server", "color": "006b75", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2017-11-13T17:43:48Z", "updated_at": "2019-10-28T13:01:53Z", "closed_at": "2017-11-17T09:33:10Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nAfter recent upgrade of `yarl` our build that uses `aiohttp==2.2.3` broke with `unexpected keyword argument 'strict' being passed from http parser`. Upon investigation turned out that `yarl>=0.11` is required, but a breaking change was introduced in `0.14`.\r\n\r\n## Expected behaviour\r\n\r\nOne of the following:\r\n1) During setup install the version of `yarl` that maintains a contract with the version of aiohttp being installed.\r\n2) Raise depreciation warning when arguments are being removed in minor version update.\r\n\r\n## Actual behaviour\r\n\r\n`>=` requirement combined with a breaking change introduced in minor version update resulted in aiohttp being unable to handle any request.\r\n\r\n## Steps to reproduce\r\n\r\nRunning unit tests on 2.2.3 should reproduce the issue:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/Users/astaff/Development/opentrons/opentrons/.env/lib/python3.5/site-packages/aiohttp/web_protocol.py\", line 278, in data_received\r\n    messages, upgraded, tail = self._request_parser.feed_data(data)\r\n  File \"aiohttp/_http_parser.pyx\", line 274, in aiohttp._http_parser.HttpParser.feed_data (aiohttp/_http_parser.c:4364)\r\n  File \"aiohttp/_http_parser.pyx\", line 334, in aiohttp._http_parser.cb_on_url (aiohttp/_http_parser.c:5381)\r\n  File \"aiohttp/_http_parser.pyx\", line 544, in aiohttp._http_parser._parse_url (aiohttp/_http_parser.c:8777)\r\n  File \"/Users/astaff/Development/opentrons/opentrons/.env/lib/python3.5/site-packages/aiohttp/http_writer.py\", line 317, in __init__\r\n    path = yarl.quote(path, safe='@:', protected='/', strict=False)\r\n  File \"yarl/_quoting.pyx\", line 38, in yarl._quoting._quote\r\nTypeError: _quote() got an unexpected keyword argument 'strict'\r\n```\r\n\r\n## Your environment\r\n\r\nOSX, aiohttp 2.2.3", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2514/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2514/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2499", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2499/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2499/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2499/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/2499", "id": 272818160, "node_id": "MDU6SXNzdWUyNzI4MTgxNjA=", "number": 2499, "title": "Raise an exception if trying to write into closed response", "user": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/17", "html_url": "https://github.com/aio-libs/aiohttp/milestone/17", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/17/labels", "id": 2605213, "node_id": "MDk6TWlsZXN0b25lMjYwNTIxMw==", "number": 17, "title": "3.0", "description": "Drop Python 3.4 support, `async/await` should be used everywhere", "creator": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 46, "state": "closed", "created_at": "2017-06-26T17:45:09Z", "updated_at": "2018-02-12T13:18:02Z", "due_on": null, "closed_at": "2018-02-12T13:18:02Z"}, "comments": 8, "created_at": "2017-11-10T04:43:26Z", "updated_at": "2020-04-17T12:20:47Z", "closed_at": "2018-01-04T06:39:05Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "body": "See https://stackoverflow.com/questions/47175297/handling-premature-client-disconnection-in-aiohttp\r\n\r\nThe problem is: `await drain()` does nothing because the buffer is not overflown, the buffer is not overflown because sent data are ignored and not accumulated in internal buffer.\r\n`transport.is_closing()` should be used for check.\r\n\r\nIt should be fixed in payload writer, affects both client and server.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2499/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2499/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2427", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2427/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2427/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2427/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/2427", "id": 269319157, "node_id": "MDExOlB1bGxSZXF1ZXN0MTQ5MzM2NjQw", "number": 2427, "title": "Globally exclude *.so and *.pyd files from dist", "user": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2017-10-28T13:55:40Z", "updated_at": "2019-10-28T11:03:33Z", "closed_at": "2017-10-28T15:54:44Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/2427", "html_url": "https://github.com/aio-libs/aiohttp/pull/2427", "diff_url": "https://github.com/aio-libs/aiohttp/pull/2427.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/2427.patch", "merged_at": "2017-10-28T15:54:44Z"}, "body": "Fixes #2414.\r\n\r\nP.S. I still feel the need to properly configure `setuptools-git` to avoid need to track files manually.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2427/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2427/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2414", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2414/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2414/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2414/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/2414", "id": 268810403, "node_id": "MDU6SXNzdWUyNjg4MTA0MDM=", "number": 2414, "title": "Build fails on Alpine when building in not a x86 architecture", "user": {"login": "rgdoliveira", "id": 25102037, "node_id": "MDQ6VXNlcjI1MTAyMDM3", "avatar_url": "https://avatars.githubusercontent.com/u/25102037?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rgdoliveira", "html_url": "https://github.com/rgdoliveira", "followers_url": "https://api.github.com/users/rgdoliveira/followers", "following_url": "https://api.github.com/users/rgdoliveira/following{/other_user}", "gists_url": "https://api.github.com/users/rgdoliveira/gists{/gist_id}", "starred_url": "https://api.github.com/users/rgdoliveira/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rgdoliveira/subscriptions", "organizations_url": "https://api.github.com/users/rgdoliveira/orgs", "repos_url": "https://api.github.com/users/rgdoliveira/repos", "events_url": "https://api.github.com/users/rgdoliveira/events{/privacy}", "received_events_url": "https://api.github.com/users/rgdoliveira/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 731921232, "node_id": "MDU6TGFiZWw3MzE5MjEyMzI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/infra", "name": "infra", "color": "e55e5b", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": {"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "webknjaz", "id": 578543, "node_id": "MDQ6VXNlcjU3ODU0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/578543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/webknjaz", "html_url": "https://github.com/webknjaz", "followers_url": "https://api.github.com/users/webknjaz/followers", "following_url": "https://api.github.com/users/webknjaz/following{/other_user}", "gists_url": "https://api.github.com/users/webknjaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/webknjaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/webknjaz/subscriptions", "organizations_url": "https://api.github.com/users/webknjaz/orgs", "repos_url": "https://api.github.com/users/webknjaz/repos", "events_url": "https://api.github.com/users/webknjaz/events{/privacy}", "received_events_url": "https://api.github.com/users/webknjaz/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2017-10-26T15:38:41Z", "updated_at": "2019-10-28T14:02:06Z", "closed_at": "2017-10-27T12:48:22Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\nWhen trying to build aiohttp version 2.3.1 in Alpine (ppc64le and s390x architectures) the build fails at Alpine stripping part because it tries to strip \"_http_parser.cpython-36m-x86_64-linux-gnu.so\" shared object that is shipped in source code and fail in any architecture different from x86.\r\n\r\nI guess the \"_http_parser.cpython-36m-x86_64-linux-gnu.so\" should not be shipped in the source code\r\n\r\n\r\n## Steps to reproduce\r\n- Clone Alpine aports project\r\n- build py3-aiohttp project (community/py3-aiohttp) with command `abuild -r`\r\n\r\n## Your environment\r\nAlpine Linux 3.6.2 (ppc64le or s390x)", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2414/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2414/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2332", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2332/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2332/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2332/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/2332", "id": 266061103, "node_id": "MDExOlB1bGxSZXF1ZXN0MTQ2OTkxNzIy", "number": 2332, "title": "http parser non strict mode", "user": {"login": "popravich", "id": 323442, "node_id": "MDQ6VXNlcjMyMzQ0Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/323442?v=4", "gravatar_id": "", "url": "https://api.github.com/users/popravich", "html_url": "https://github.com/popravich", "followers_url": "https://api.github.com/users/popravich/followers", "following_url": "https://api.github.com/users/popravich/following{/other_user}", "gists_url": "https://api.github.com/users/popravich/gists{/gist_id}", "starred_url": "https://api.github.com/users/popravich/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/popravich/subscriptions", "organizations_url": "https://api.github.com/users/popravich/orgs", "repos_url": "https://api.github.com/users/popravich/repos", "events_url": "https://api.github.com/users/popravich/events{/privacy}", "received_events_url": "https://api.github.com/users/popravich/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 58986077, "node_id": "MDU6TGFiZWw1ODk4NjA3Nw==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/enhancement", "name": "enhancement", "color": "84b6eb", "default": true, "description": null}, {"id": 344996043, "node_id": "MDU6TGFiZWwzNDQ5OTYwNDM=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/server", "name": "server", "color": "006b75", "default": false, "description": null}, {"id": 1472801557, "node_id": "MDU6TGFiZWwxNDcyODAxNTU3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bot:chronographer:provided", "name": "bot:chronographer:provided", "color": "ededed", "default": false, "description": "There is a change note present in this PR"}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 14, "created_at": "2017-10-17T09:50:59Z", "updated_at": "2019-10-28T17:03:46Z", "closed_at": "2017-10-17T15:00:49Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/2332", "html_url": "https://github.com/aio-libs/aiohttp/pull/2332", "diff_url": "https://github.com/aio-libs/aiohttp/pull/2332.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/2332.patch", "merged_at": "2017-10-17T15:00:48Z"}, "body": "## What do these changes do?\r\n\r\nBuild http-parser in non-strict mode.\r\n\r\nBy default http-parser was built in strict mode.\r\nThis was causing requests having non-ascii URLs in request line to be\r\nrejected with `InvalidURLErrors`.\r\nAlthough it is considered to be invalid HTTP request most servers handle such requests.\r\nSo it is decided to **build http-parser in non-strict mode by default**.\r\n\r\n(more discussion [here on gitter](https://gitter.im/aio-libs/Lobby?at=59d34704614889d4756b42c0))\r\n\r\nThis PR allows to control http-parse mode by forwarding `HTTP_PARSER_STRICT` environment\r\nvariable to extension compiler.\r\n\r\n## Checklist\r\n\r\n- [x] I think the code is well written\r\n- [x] Unit tests for the changes exist\r\n- [ ] Documentation reflects the changes\r\n- [x] Add a new news fragment into the `changes` folder", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2332/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2332/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2287", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2287/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2287/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2287/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/2287", "id": 260013558, "node_id": "MDExOlB1bGxSZXF1ZXN0MTQyNzE2OTA1", "number": 2287, "title": "Clone web request's state", "user": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1472801557, "node_id": "MDU6TGFiZWwxNDcyODAxNTU3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bot:chronographer:provided", "name": "bot:chronographer:provided", "color": "ededed", "default": false, "description": "There is a change note present in this PR"}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/16", "html_url": "https://github.com/aio-libs/aiohttp/milestone/16", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/16/labels", "id": 2593480, "node_id": "MDk6TWlsZXN0b25lMjU5MzQ4MA==", "number": 16, "title": "2.3", "description": "aiohttp 2.3.0 release", "creator": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 39, "state": "closed", "created_at": "2017-06-20T11:57:54Z", "updated_at": "2017-10-17T09:31:46Z", "due_on": null, "closed_at": "2017-10-17T09:31:46Z"}, "comments": 6, "created_at": "2017-09-23T14:59:22Z", "updated_at": "2019-10-28T17:05:07Z", "closed_at": "2017-09-23T17:58:15Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/2287", "html_url": "https://github.com/aio-libs/aiohttp/pull/2287", "diff_url": "https://github.com/aio-libs/aiohttp/pull/2287.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/2287.patch", "merged_at": "2017-09-23T17:58:15Z"}, "body": "Fix for #2284", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2287/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2287/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2284", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2284/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2284/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2284/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/2284", "id": 259487692, "node_id": "MDU6SXNzdWUyNTk0ODc2OTI=", "number": 2284, "title": "Server request's state is not cloned.", "user": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 277836062, "node_id": "MDU6TGFiZWwyNzc4MzYwNjI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/good%20first%20issue", "name": "good first issue", "color": "7057ff", "default": true, "description": "Good for newcomers"}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/16", "html_url": "https://github.com/aio-libs/aiohttp/milestone/16", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/16/labels", "id": 2593480, "node_id": "MDk6TWlsZXN0b25lMjU5MzQ4MA==", "number": 16, "title": "2.3", "description": "aiohttp 2.3.0 release", "creator": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 39, "state": "closed", "created_at": "2017-06-20T11:57:54Z", "updated_at": "2017-10-17T09:31:46Z", "due_on": null, "closed_at": "2017-10-17T09:31:46Z"}, "comments": 1, "created_at": "2017-09-21T13:01:08Z", "updated_at": "2019-10-28T16:01:29Z", "closed_at": "2017-09-23T17:58:18Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "body": "`req.clone()` call doesn't clone request state, changes made by `req['key'] = val` are not propagated to clone.\r\n\r\nThe solution is calling `req._state.copy()` in `clone`", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2284/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2284/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2201", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2201/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2201/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2201/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/2201", "id": 250207364, "node_id": "MDU6SXNzdWUyNTAyMDczNjQ=", "number": 2201, "title": "Client: FormData._gen_form_data ignores filename, explodes", "user": {"login": "patrick-jones", "id": 10633578, "node_id": "MDQ6VXNlcjEwNjMzNTc4", "avatar_url": "https://avatars.githubusercontent.com/u/10633578?v=4", "gravatar_id": "", "url": "https://api.github.com/users/patrick-jones", "html_url": "https://github.com/patrick-jones", "followers_url": "https://api.github.com/users/patrick-jones/followers", "following_url": "https://api.github.com/users/patrick-jones/following{/other_user}", "gists_url": "https://api.github.com/users/patrick-jones/gists{/gist_id}", "starred_url": "https://api.github.com/users/patrick-jones/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/patrick-jones/subscriptions", "organizations_url": "https://api.github.com/users/patrick-jones/orgs", "repos_url": "https://api.github.com/users/patrick-jones/repos", "events_url": "https://api.github.com/users/patrick-jones/events{/privacy}", "received_events_url": "https://api.github.com/users/patrick-jones/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-08-15T02:43:09Z", "updated_at": "2019-10-28T17:01:27Z", "closed_at": "2017-08-31T12:14:05Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "I am using the client to upload a file using `FormData`, almost exactly the same code as shown in [this example](http://aiohttp.readthedocs.io/en/stable/client.html#post-a-multipart-encoded-file). The main difference is that I am passing a file created by [tempfile.TemporaryFile](https://docs.python.org/3/library/tempfile.html) as the second argument to `add_field`.\r\n\r\nThe result is: `TypeError: Can not serialize value type: <class '_io.BufferedRandom'>\r\n headers: {'Content-Type': 'application/vnd.ms-excel'}\r\n value: <_io.BufferedRandom name=23>`\r\n\r\nThe root exception is actually thrown from [`helpers.guess_filename`](https://github.com/aio-libs/aiohttp/blob/master/aiohttp/helpers.py#L280): `TypeError: 'int' object is not subscriptable`\r\n\r\n## Expected behaviour\r\n\r\nThere should be no need to call `guess_filename` because I specified a filename:\r\n`form.add_field('file', data, filename=filename, content_type=content_type)`\r\n\r\nAnd even if I didn't provide a filename, `guess_filename` should not throw an exception if `name` is not a string (which is apparently the case for tempfiles; notice that my tempfile has the number 23 for a name).\r\n\r\n## Actual behaviour\r\n\r\n[`FormData._gen_form_data`](https://github.com/aio-libs/aiohttp/blob/master/aiohttp/formdata.py#L115-L117) is not passing the filename to `payload.get_payload`, even though the filename is available. It seems like the code could be changed to include `filename=dispparams.get('filename')` in the kwargs for `get_payload`.\r\n\r\n`guess_filename` assumes that `name` will be a string. Oddly enough, sometimes it's a number.\r\n\r\n## Steps to reproduce\r\n\r\nHere is my code that produces the error. `data` is a `tempfile.TemporaryFile()`. The exception is thrown from the `post` call. `url`, `filename`, and `content_type` are all valid strings.\r\n\r\n```python\r\n    async def post_temp_file(self, url, filename, content_type, data):\r\n        form = FormData()\r\n        form.add_field('file', data, filename=filename, content_type=content_type)\r\n\r\n        async with self.rest.post(url, data=form) as response:\r\n            await self._raise_for_status(response)\r\n            body = await response.text()\r\n\r\n        return json.loads(body)\r\n```\r\n\r\n### Workaround\r\n\r\n```python\r\n        f = BytesIO(data.read())\r\n        setattr(f, 'filename', filename)\r\n        form.add_field('file', f, filename=filename, content_type=content_type)\r\n```\r\n\r\n## Your environment\r\n\r\nPython 3.6.1 on Ubuntu\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2201/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2201/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2183", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2183/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2183/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2183/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/2183", "id": 248916974, "node_id": "MDU6SXNzdWUyNDg5MTY5NzQ=", "number": 2183, "title": "'None' in HTTP headers", "user": {"login": "nesdis", "id": 17020932, "node_id": "MDQ6VXNlcjE3MDIwOTMy", "avatar_url": "https://avatars.githubusercontent.com/u/17020932?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nesdis", "html_url": "https://github.com/nesdis", "followers_url": "https://api.github.com/users/nesdis/followers", "following_url": "https://api.github.com/users/nesdis/following{/other_user}", "gists_url": "https://api.github.com/users/nesdis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nesdis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nesdis/subscriptions", "organizations_url": "https://api.github.com/users/nesdis/orgs", "repos_url": "https://api.github.com/users/nesdis/repos", "events_url": "https://api.github.com/users/nesdis/events{/privacy}", "received_events_url": "https://api.github.com/users/nesdis/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": {"login": "fafhrd91", "id": 598990, "node_id": "MDQ6VXNlcjU5ODk5MA==", "avatar_url": "https://avatars.githubusercontent.com/u/598990?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fafhrd91", "html_url": "https://github.com/fafhrd91", "followers_url": "https://api.github.com/users/fafhrd91/followers", "following_url": "https://api.github.com/users/fafhrd91/following{/other_user}", "gists_url": "https://api.github.com/users/fafhrd91/gists{/gist_id}", "starred_url": "https://api.github.com/users/fafhrd91/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fafhrd91/subscriptions", "organizations_url": "https://api.github.com/users/fafhrd91/orgs", "repos_url": "https://api.github.com/users/fafhrd91/repos", "events_url": "https://api.github.com/users/fafhrd91/events{/privacy}", "received_events_url": "https://api.github.com/users/fafhrd91/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "fafhrd91", "id": 598990, "node_id": "MDQ6VXNlcjU5ODk5MA==", "avatar_url": "https://avatars.githubusercontent.com/u/598990?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fafhrd91", "html_url": "https://github.com/fafhrd91", "followers_url": "https://api.github.com/users/fafhrd91/followers", "following_url": "https://api.github.com/users/fafhrd91/following{/other_user}", "gists_url": "https://api.github.com/users/fafhrd91/gists{/gist_id}", "starred_url": "https://api.github.com/users/fafhrd91/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fafhrd91/subscriptions", "organizations_url": "https://api.github.com/users/fafhrd91/orgs", "repos_url": "https://api.github.com/users/fafhrd91/repos", "events_url": "https://api.github.com/users/fafhrd91/events{/privacy}", "received_events_url": "https://api.github.com/users/fafhrd91/received_events", "type": "User", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/16", "html_url": "https://github.com/aio-libs/aiohttp/milestone/16", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/16/labels", "id": 2593480, "node_id": "MDk6TWlsZXN0b25lMjU5MzQ4MA==", "number": 16, "title": "2.3", "description": "aiohttp 2.3.0 release", "creator": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 39, "state": "closed", "created_at": "2017-06-20T11:57:54Z", "updated_at": "2017-10-17T09:31:46Z", "due_on": null, "closed_at": "2017-10-17T09:31:46Z"}, "comments": 14, "created_at": "2017-08-09T05:00:06Z", "updated_at": "2019-10-28T16:01:38Z", "closed_at": "2017-09-20T20:20:17Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nSometimes in file cookies.py the rawdata is of type None and above exception is hit.\r\n\r\n    def load(self, rawdata):\r\n        \"\"\"Load cookies from a string (presumably HTTP_COOKIE) or\r\n        from a dictionary.  Loading cookies from a dictionary 'd'\r\n        is equivalent to calling:\r\n            map(Cookie.__setitem__, d.keys(), d.values())\r\n        \"\"\"\r\n        if isinstance(rawdata, str):\r\n            self.__parse_string(rawdata)\r\n        else:\r\n            # self.update() wouldn't call our custom __setitem__\r\n            for key, value in rawdata.items():\r\n                self[key] = value\r\n        return\r\n\r\n## Expected behaviour\r\n\r\nWhy is raw_data given to load of type None?\r\n\r\nThis is called in function start of C:\\Python36\\Lib\\site-packages\\aiohttp\\client_reqrep.py\r\n        \r\n    for hdr in self.headers.getall(hdrs.SET_COOKIE, ()):\r\n            try:\r\n                self.cookies.load(hdr)\r\n            except CookieError as exc:\r\n                client_logger.warning(\r\n                    'Can not load response cookies: %s', exc)\r\n        return self\r\n\r\n\r\n## Actual behaviour\r\n\r\nLooks like self.headers.getall(hdrs.SET_COOKIE, ()) is returning hdr of type None, This looks buggy. It should return actual header or raise stopiteration. At times it returns None.\r\n\r\n## Steps to reproduce\r\n\r\nI have not been able to reproduce this issue. Unfortunately I lost the stack trace console output too. But have debugged till the above point. \r\n\r\n## Your environment\r\n\r\n<!-- Describe the environment you have that lead to your issue.\r\n     This includes project version, OS, proxy server and other bits that\r\n     are related to your case. -->\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2183/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2183/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2024", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2024/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2024/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2024/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/2024", "id": 238795208, "node_id": "MDU6SXNzdWUyMzg3OTUyMDg=", "number": 2024, "title": "Preparing a websocket from a low-level-server request fails", "user": {"login": "jhrmnn", "id": 940353, "node_id": "MDQ6VXNlcjk0MDM1Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/940353?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhrmnn", "html_url": "https://github.com/jhrmnn", "followers_url": "https://api.github.com/users/jhrmnn/followers", "following_url": "https://api.github.com/users/jhrmnn/following{/other_user}", "gists_url": "https://api.github.com/users/jhrmnn/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhrmnn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhrmnn/subscriptions", "organizations_url": "https://api.github.com/users/jhrmnn/orgs", "repos_url": "https://api.github.com/users/jhrmnn/repos", "events_url": "https://api.github.com/users/jhrmnn/events{/privacy}", "received_events_url": "https://api.github.com/users/jhrmnn/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/16", "html_url": "https://github.com/aio-libs/aiohttp/milestone/16", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/16/labels", "id": 2593480, "node_id": "MDk6TWlsZXN0b25lMjU5MzQ4MA==", "number": 16, "title": "2.3", "description": "aiohttp 2.3.0 release", "creator": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 39, "state": "closed", "created_at": "2017-06-20T11:57:54Z", "updated_at": "2017-10-17T09:31:46Z", "due_on": null, "closed_at": "2017-10-17T09:31:46Z"}, "comments": 2, "created_at": "2017-06-27T09:48:42Z", "updated_at": "2019-10-28T17:02:58Z", "closed_at": "2017-07-27T09:55:04Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "A request from a low-level server does not have the `app` attribute, but `web.WebSocketResponse.prepare()` takes the event loop from `BaseRequest.app.loop`.\r\n\r\n```\r\n  File \".../aiohttp/web_ws.py\", line 103, in _pre_start\r\n    self._loop = request.app.loop\r\nAttributeError: 'BaseRequest' object has no attribute 'app'\r\n```\r\n\r\nI was able to fix this by assigning a mock app to the request, which has a single `loop` attribute.", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2024/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/2024/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1955", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1955/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1955/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1955/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/1955", "id": 233715791, "node_id": "MDU6SXNzdWUyMzM3MTU3OTE=", "number": 1955, "title": "100% CPU usage with idle websocket", "user": {"login": "naggie", "id": 208440, "node_id": "MDQ6VXNlcjIwODQ0MA==", "avatar_url": "https://avatars.githubusercontent.com/u/208440?v=4", "gravatar_id": "", "url": "https://api.github.com/users/naggie", "html_url": "https://github.com/naggie", "followers_url": "https://api.github.com/users/naggie/followers", "following_url": "https://api.github.com/users/naggie/following{/other_user}", "gists_url": "https://api.github.com/users/naggie/gists{/gist_id}", "starred_url": "https://api.github.com/users/naggie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/naggie/subscriptions", "organizations_url": "https://api.github.com/users/naggie/orgs", "repos_url": "https://api.github.com/users/naggie/repos", "events_url": "https://api.github.com/users/naggie/events{/privacy}", "received_events_url": "https://api.github.com/users/naggie/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": {"login": "fafhrd91", "id": 598990, "node_id": "MDQ6VXNlcjU5ODk5MA==", "avatar_url": "https://avatars.githubusercontent.com/u/598990?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fafhrd91", "html_url": "https://github.com/fafhrd91", "followers_url": "https://api.github.com/users/fafhrd91/followers", "following_url": "https://api.github.com/users/fafhrd91/following{/other_user}", "gists_url": "https://api.github.com/users/fafhrd91/gists{/gist_id}", "starred_url": "https://api.github.com/users/fafhrd91/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fafhrd91/subscriptions", "organizations_url": "https://api.github.com/users/fafhrd91/orgs", "repos_url": "https://api.github.com/users/fafhrd91/repos", "events_url": "https://api.github.com/users/fafhrd91/events{/privacy}", "received_events_url": "https://api.github.com/users/fafhrd91/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "fafhrd91", "id": 598990, "node_id": "MDQ6VXNlcjU5ODk5MA==", "avatar_url": "https://avatars.githubusercontent.com/u/598990?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fafhrd91", "html_url": "https://github.com/fafhrd91", "followers_url": "https://api.github.com/users/fafhrd91/followers", "following_url": "https://api.github.com/users/fafhrd91/following{/other_user}", "gists_url": "https://api.github.com/users/fafhrd91/gists{/gist_id}", "starred_url": "https://api.github.com/users/fafhrd91/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fafhrd91/subscriptions", "organizations_url": "https://api.github.com/users/fafhrd91/orgs", "repos_url": "https://api.github.com/users/fafhrd91/repos", "events_url": "https://api.github.com/users/fafhrd91/events{/privacy}", "received_events_url": "https://api.github.com/users/fafhrd91/received_events", "type": "User", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/17", "html_url": "https://github.com/aio-libs/aiohttp/milestone/17", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/17/labels", "id": 2605213, "node_id": "MDk6TWlsZXN0b25lMjYwNTIxMw==", "number": 17, "title": "3.0", "description": "Drop Python 3.4 support, `async/await` should be used everywhere", "creator": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 46, "state": "closed", "created_at": "2017-06-26T17:45:09Z", "updated_at": "2018-02-12T13:18:02Z", "due_on": null, "closed_at": "2018-02-12T13:18:02Z"}, "comments": 14, "created_at": "2017-06-05T21:26:40Z", "updated_at": "2019-10-28T10:02:23Z", "closed_at": "2018-02-02T10:25:42Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nFairly standard websocket server/client setup, but with session, results in 100% CPU usage. \r\n\r\n\r\n1. Generic websocket server\r\n2. Generic websocket client, but with a session that does a `get` request (to the same endpoint) before a new request to start a websocket\r\n3. In a few minutes, CPU usage increases to 100%\r\n\r\nNote that removing the `get` request seems to avoid the problem.\r\n\r\n\r\n## Expected behaviour\r\nLow CPU usage when idle\r\n\r\n## Actual behaviour\r\nWorker process suddenly goes to 100% CPU usage, confirmed with htop.\r\n\r\n## Steps to reproduce\r\nServer\r\n```\r\nimport asyncio\r\nimport aiohttp\r\nfrom aiohttp import web\r\n\r\nasync def worker_websocket(request):\r\n    ws = aiohttp.web.WebSocketResponse()\r\n    await ws.prepare(request)\r\n\r\n    async for msg in ws:\r\n        pass\r\n\r\n    return ws\r\n\r\napp = aiohttp.web.Application()\r\napp.router.add_get('/worker-websocket',worker_websocket)\r\nweb.run_app( app, port=int(8080))\r\n```\r\nworker\r\n```\r\nimport aiohttp\r\nfrom aiohttp import web\r\nimport asyncio\r\n\r\nasync def websocket_client(loop):\r\n    url = 'http://localhost:8080/worker-websocket'\r\n\r\n    session = aiohttp.ClientSession(loop=loop)\r\n\r\n    # removing this prevents the problem!\r\n    async with session.get(url) as resp:\r\n        pass\r\n\r\n    async with session.ws_connect(url=url) as ws:\r\n        async for msg in ws:\r\n            pass\r\n\r\nloop = asyncio.get_event_loop()\r\nclient = websocket_client(loop)\r\nloop.run_until_complete(client)\r\n```\r\n\r\nRun server + worker and wait a few minutes. Eventually the server process will eat one core. Remove the session.get and it does not happen.\r\n\r\n## Your environment\r\nI've reproduced this, so far, on:\r\n* MacOS 10.12 (Sierra) + Python 3.6.1 with aiohttp 2.1.0\r\n* Ubuntu server 16.04 LTS + Python 3.5.2 with aiohttp 2.1.0\r\n\r\n\r\n----\r\n\r\nUsing `strace`, all I can see is highly frequent `epoll_wait` calls returning 0. My attempts with `pyrasite` and `gdb-python3` yielded nothing useful.\r\n\r\nI'm still yet to try `ipdb` and try to look through the source.\r\n\r\nThe only thing I can find that is even remotely similar is https://groups.google.com/forum/#!topic/libuv/opFk74lww7k .\r\n\r\n\r\nOtherwise my experience with `aiohttp` has been fantastic. Thanks for a great library.\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1955/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1955/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1845", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1845/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1845/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1845/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/1845", "id": 224507831, "node_id": "MDU6SXNzdWUyMjQ1MDc4MzE=", "number": 1845, "title": "Websocket flow control is broken (deadlock+memory leak on websocket.receive)", "user": {"login": "alexmnazarenko", "id": 13042821, "node_id": "MDQ6VXNlcjEzMDQyODIx", "avatar_url": "https://avatars.githubusercontent.com/u/13042821?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexmnazarenko", "html_url": "https://github.com/alexmnazarenko", "followers_url": "https://api.github.com/users/alexmnazarenko/followers", "following_url": "https://api.github.com/users/alexmnazarenko/following{/other_user}", "gists_url": "https://api.github.com/users/alexmnazarenko/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexmnazarenko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexmnazarenko/subscriptions", "organizations_url": "https://api.github.com/users/alexmnazarenko/orgs", "repos_url": "https://api.github.com/users/alexmnazarenko/repos", "events_url": "https://api.github.com/users/alexmnazarenko/events{/privacy}", "received_events_url": "https://api.github.com/users/alexmnazarenko/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 58986077, "node_id": "MDU6TGFiZWw1ODk4NjA3Nw==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/enhancement", "name": "enhancement", "color": "84b6eb", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/22", "html_url": "https://github.com/aio-libs/aiohttp/milestone/22", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/22/labels", "id": 3324450, "node_id": "MDk6TWlsZXN0b25lMzMyNDQ1MA==", "number": 22, "title": "3.3", "description": "", "creator": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 5, "state": "closed", "created_at": "2018-05-07T07:08:53Z", "updated_at": "2018-10-18T20:39:50Z", "due_on": null, "closed_at": "2018-10-18T20:39:50Z"}, "comments": 16, "created_at": "2017-04-26T15:26:28Z", "updated_at": "2019-10-28T05:02:19Z", "closed_at": "2018-05-15T07:49:03Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nHello! I've ran into serious problem while implementing custom RPC over websockets (aiohttp on both sides). On a dense stream of larger messages consumer just freezes (while eating gigabytes of memory). Sender is \"fine\" (await ws.send_bytes() proceeds).\r\n\r\nIt seems to be correlated with message size, but I'm not sure. Surfaces randomly, but quite often on larger (64k+) messages. Who is client and who is server isn't important, so I'll stick to sender/consumer terms.\r\n\r\nThe problem manifested itself only in actual distributed test, if sender-consumer are both on localhost everything works fine.\r\n\r\nWhy do I think that issue is somewhere in flow control - the usecase was fine on older versions of aiohttp before it was implemented.\r\n\r\nAny feedback is much appreciated )\r\n\r\n## Expected behaviour\r\n\r\n* Consumer doesn't hang\r\n* Sender blocks if needed\r\n\r\n## Actual behaviour\r\n\r\n* On consumer's side: `await ws.receive` (or `async for msg in ws`) hangs at some point, memory grows to infinity and beyond\r\n* On sender's side: everything looks fine (but you'll never get any response as consumer is dead)\r\n* Even more interesting: *very rarely* consumer shows an error and disconnects\r\n\r\n## Steps to reproduce\r\n\r\nOriginal program was quite convoluted, so I've made a simple example reproducing the issue.\r\n\r\nConsumer script (implemented as server):\r\n\r\n```\r\nimport aiohttp.web\r\n\r\nasync def consumer(request):\r\n    ws = aiohttp.web.WebSocketResponse()\r\n    await ws.prepare(request)\r\n\r\n    msg_index = 0\r\n    async for msg in ws:\r\n        msg_index += 1\r\n        print(\"Block\", msg.type, msg_index)\r\n    return ws\r\n\r\n\r\ndef main():\r\n    app = aiohttp.web.Application()\r\n    app.router.add_get(\"/ws\", consumer)\r\n    aiohttp.web.run_app(app, port=9090)\r\n\r\nif __name__ == '__main__':\r\n    main()\r\n```\r\n\r\nSender script (implemented as client):\r\n\r\n```\r\nimport asyncio\r\nimport aiohttp\r\nimport uuid\r\n\r\nasync def main():\r\n    # can use larger number for increase the chance to hang, but beware of consumer's memory use.\r\n    # with provided constant values it'll peak at ~1.3Gb\r\n    BLOCK_COUNT = 5000\r\n    BLOCK_SIZE_MULTIPLIER = 2**14\r\n    # uuid4 is 16 bytes, 256k block total size\r\n    BLOCK_SIZE = 16 * BLOCK_SIZE_MULTIPLIER\r\n    async with aiohttp.ClientSession() as session:\r\n        # TODO: use your own IP :)\r\n        async with session.ws_connect(\"http://xxx.xxx.xxx.xxx:9090/ws\") as ws:\r\n            for block_idx in range(BLOCK_COUNT):\r\n                await ws.send_bytes(uuid.uuid4().bytes * BLOCK_SIZE_MULTIPLIER)\r\n                print(\"Block\", block_idx + 1, \"sent\")\r\n    \r\nif __name__ == '__main__':\r\n  asyncio.get_event_loop().run_until_complete(main())\r\n```\r\n\r\nSender prints everything up to \"Block 5000 sent\". Consumer **often, but not always** stops somewhere much eariler (seen 293, 3097 - completely random).\r\n\r\n\r\n## Your environment\r\n\r\n* 2 machines, Ubuntu 16.04\r\n* Python 3.6\r\n* aiohttp 2.0.7\r\n* Gbit LAN\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1845/reactions", "total_count": 11, "+1": 11, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1845/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1769", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1769/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1769/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1769/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/1769", "id": 217969939, "node_id": "MDU6SXNzdWUyMTc5Njk5Mzk=", "number": 1769, "title": "Connections are not correctly kept after HEAD requests", "user": {"login": "arthurdarcet", "id": 973454, "node_id": "MDQ6VXNlcjk3MzQ1NA==", "avatar_url": "https://avatars.githubusercontent.com/u/973454?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arthurdarcet", "html_url": "https://github.com/arthurdarcet", "followers_url": "https://api.github.com/users/arthurdarcet/followers", "following_url": "https://api.github.com/users/arthurdarcet/following{/other_user}", "gists_url": "https://api.github.com/users/arthurdarcet/gists{/gist_id}", "starred_url": "https://api.github.com/users/arthurdarcet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arthurdarcet/subscriptions", "organizations_url": "https://api.github.com/users/arthurdarcet/orgs", "repos_url": "https://api.github.com/users/arthurdarcet/repos", "events_url": "https://api.github.com/users/arthurdarcet/events{/privacy}", "received_events_url": "https://api.github.com/users/arthurdarcet/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 303800438, "node_id": "MDU6TGFiZWwzMDM4MDA0Mzg=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/need%20pull%20request", "name": "need pull request", "color": "bfdadc", "default": false, "description": null}, {"id": 344995986, "node_id": "MDU6TGFiZWwzNDQ5OTU5ODY=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/client", "name": "client", "color": "bfd4f2", "default": false, "description": null}, {"id": 1831256427, "node_id": "MDU6TGFiZWwxODMxMjU2NDI3", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/reproducer:%20present", "name": "reproducer: present", "color": "c2e0c6", "default": false, "description": "This PR or issue contains code, which reproduce the problem described or clearly understandable STR"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2017-03-29T18:37:33Z", "updated_at": "2020-10-16T14:04:32Z", "closed_at": "2020-10-16T14:04:32Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "When the client makes a HEAD request, it parses the response as if it was a regular message.\r\n\r\nBut the HTTP specs has a nice trick: HEAD requests `SHOULD` respond with the exact same headers than the corresponding GET request. This includes `Content-Length` or `Transfer-Encoding: chunked` headers.\r\n\r\nThis means that when the client receives a HEAD response with a `Content-Length: 5` response, it should not expect any body and `payload.is_eof()` should be True immediately, not after receiving 5\u00a0more bytes.\r\n\r\nCurrently `ResponseHandler.should_close` is True for HEAD requests with a `Content-Length: \u2026` because `payload.is_eof()` is False when it should be True, hence the underlying connection is closed and not re-used when it could be.\r\n\r\n\r\nThis is only inefficient on the client side, not at all a bug, and does not produce any wrong results.\r\n\r\n\r\n(also, I was mistaken a few minutes ago: returning a Content-Length header with an empty body is perfectly valid, and the `allow_head=True` parameter of the `add_get` method works perfectly well, no problem at all on the server side)\r\n\r\n\r\nreproducer:\r\n==========\r\n\r\nhttps://github.com/aio-libs/aiohttp/issues/1769#issuecomment-614775045", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1769/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1769/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1699", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1699/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1699/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1699/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/1699", "id": 212499581, "node_id": "MDU6SXNzdWUyMTI0OTk1ODE=", "number": 1699, "title": "Client basic HTTP auth domain mismatch", "user": {"login": "krya", "id": 1183877, "node_id": "MDQ6VXNlcjExODM4Nzc=", "avatar_url": "https://avatars.githubusercontent.com/u/1183877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/krya", "html_url": "https://github.com/krya", "followers_url": "https://api.github.com/users/krya/followers", "following_url": "https://api.github.com/users/krya/following{/other_user}", "gists_url": "https://api.github.com/users/krya/gists{/gist_id}", "starred_url": "https://api.github.com/users/krya/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/krya/subscriptions", "organizations_url": "https://api.github.com/users/krya/orgs", "repos_url": "https://api.github.com/users/krya/repos", "events_url": "https://api.github.com/users/krya/events{/privacy}", "received_events_url": "https://api.github.com/users/krya/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/16", "html_url": "https://github.com/aio-libs/aiohttp/milestone/16", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/16/labels", "id": 2593480, "node_id": "MDk6TWlsZXN0b25lMjU5MzQ4MA==", "number": 16, "title": "2.3", "description": "aiohttp 2.3.0 release", "creator": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 39, "state": "closed", "created_at": "2017-06-20T11:57:54Z", "updated_at": "2017-10-17T09:31:46Z", "due_on": null, "closed_at": "2017-10-17T09:31:46Z"}, "comments": 3, "created_at": "2017-03-07T17:15:56Z", "updated_at": "2019-10-28T15:01:50Z", "closed_at": "2017-10-16T17:10:10Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\nI was making calls with aiohttp client to one twilio API server (which requires basic HTTP authentication) and it was working fine untill I reached an endpoint that does a redirect to amazon S3.\r\nBut it appears that aiohttp passes basic authentication headers after redirection to a location defined in last response header even if domain doesnt match with the one that did redirection which causes an issue in my case because amazon requires that there should be only one auth method (in my cause token was in the url for redirection) \r\nI've checked the requests lib and it works fine in this exact case.\r\n\r\n## Expected behaviour\r\n\r\nonce lib follows redirection and domain doesnt match with previous it should NOT send basic auth headers to this domain\r\n\r\n## Actual behaviour\r\n\r\nend response from S3 ends with an authentication error since there is an auth token in the URL AND a basic auth headers\r\n\r\n## Steps to reproduce\r\n\r\nI'm not sure on available to everyone server that does a redirection to S3\r\n\r\n## Your environment\r\n\r\nubuntu 14/16\r\naiohttp==1.3.3 (same with git master)\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1699/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1699/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1673", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1673/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1673/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1673/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/1673", "id": 209527757, "node_id": "MDU6SXNzdWUyMDk1Mjc3NTc=", "number": 1673, "title": "Drop \"%O\" in access logger", "user": {"login": "fafhrd91", "id": 598990, "node_id": "MDQ6VXNlcjU5ODk5MA==", "avatar_url": "https://avatars.githubusercontent.com/u/598990?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fafhrd91", "html_url": "https://github.com/fafhrd91", "followers_url": "https://api.github.com/users/fafhrd91/followers", "following_url": "https://api.github.com/users/fafhrd91/following{/other_user}", "gists_url": "https://api.github.com/users/fafhrd91/gists{/gist_id}", "starred_url": "https://api.github.com/users/fafhrd91/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fafhrd91/subscriptions", "organizations_url": "https://api.github.com/users/fafhrd91/orgs", "repos_url": "https://api.github.com/users/fafhrd91/repos", "events_url": "https://api.github.com/users/fafhrd91/events{/privacy}", "received_events_url": "https://api.github.com/users/fafhrd91/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/13", "html_url": "https://github.com/aio-libs/aiohttp/milestone/13", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/13/labels", "id": 2308320, "node_id": "MDk6TWlsZXN0b25lMjMwODMyMA==", "number": 13, "title": "2.1", "description": "", "creator": {"login": "fafhrd91", "id": 598990, "node_id": "MDQ6VXNlcjU5ODk5MA==", "avatar_url": "https://avatars.githubusercontent.com/u/598990?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fafhrd91", "html_url": "https://github.com/fafhrd91", "followers_url": "https://api.github.com/users/fafhrd91/followers", "following_url": "https://api.github.com/users/fafhrd91/following{/other_user}", "gists_url": "https://api.github.com/users/fafhrd91/gists{/gist_id}", "starred_url": "https://api.github.com/users/fafhrd91/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fafhrd91/subscriptions", "organizations_url": "https://api.github.com/users/fafhrd91/orgs", "repos_url": "https://api.github.com/users/fafhrd91/repos", "events_url": "https://api.github.com/users/fafhrd91/events{/privacy}", "received_events_url": "https://api.github.com/users/fafhrd91/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 13, "state": "closed", "created_at": "2017-02-08T01:02:47Z", "updated_at": "2018-02-27T19:19:01Z", "due_on": "2017-04-10T07:00:00Z", "closed_at": "2017-06-18T21:54:35Z"}, "comments": 3, "created_at": "2017-02-22T17:39:21Z", "updated_at": "2019-10-28T22:02:54Z", "closed_at": "2017-03-22T02:41:25Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "body": "implementation for \"%O\" is wrong. `output_size` was never designed to use as response size.\r\n\r\n@asvetlov @kxepal ", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1673/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1673/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1469", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1469/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1469/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1469/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/1469", "id": 194641766, "node_id": "MDU6SXNzdWUxOTQ2NDE3NjY=", "number": 1469, "title": "Request.post() stores data in temp files", "user": {"login": "popravich", "id": 323442, "node_id": "MDQ6VXNlcjMyMzQ0Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/323442?v=4", "gravatar_id": "", "url": "https://api.github.com/users/popravich", "html_url": "https://github.com/popravich", "followers_url": "https://api.github.com/users/popravich/followers", "following_url": "https://api.github.com/users/popravich/following{/other_user}", "gists_url": "https://api.github.com/users/popravich/gists{/gist_id}", "starred_url": "https://api.github.com/users/popravich/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/popravich/subscriptions", "organizations_url": "https://api.github.com/users/popravich/orgs", "repos_url": "https://api.github.com/users/popravich/repos", "events_url": "https://api.github.com/users/popravich/events{/privacy}", "received_events_url": "https://api.github.com/users/popravich/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344996043, "node_id": "MDU6TGFiZWwzNDQ5OTYwNDM=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/server", "name": "server", "color": "006b75", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": {"login": "popravich", "id": 323442, "node_id": "MDQ6VXNlcjMyMzQ0Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/323442?v=4", "gravatar_id": "", "url": "https://api.github.com/users/popravich", "html_url": "https://github.com/popravich", "followers_url": "https://api.github.com/users/popravich/followers", "following_url": "https://api.github.com/users/popravich/following{/other_user}", "gists_url": "https://api.github.com/users/popravich/gists{/gist_id}", "starred_url": "https://api.github.com/users/popravich/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/popravich/subscriptions", "organizations_url": "https://api.github.com/users/popravich/orgs", "repos_url": "https://api.github.com/users/popravich/repos", "events_url": "https://api.github.com/users/popravich/events{/privacy}", "received_events_url": "https://api.github.com/users/popravich/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "popravich", "id": 323442, "node_id": "MDQ6VXNlcjMyMzQ0Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/323442?v=4", "gravatar_id": "", "url": "https://api.github.com/users/popravich", "html_url": "https://github.com/popravich", "followers_url": "https://api.github.com/users/popravich/followers", "following_url": "https://api.github.com/users/popravich/following{/other_user}", "gists_url": "https://api.github.com/users/popravich/gists{/gist_id}", "starred_url": "https://api.github.com/users/popravich/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/popravich/subscriptions", "organizations_url": "https://api.github.com/users/popravich/orgs", "repos_url": "https://api.github.com/users/popravich/repos", "events_url": "https://api.github.com/users/popravich/events{/privacy}", "received_events_url": "https://api.github.com/users/popravich/received_events", "type": "User", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/12", "html_url": "https://github.com/aio-libs/aiohttp/milestone/12", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/12/labels", "id": 2299868, "node_id": "MDk6TWlsZXN0b25lMjI5OTg2OA==", "number": 12, "title": "2.0", "description": "", "creator": {"login": "fafhrd91", "id": 598990, "node_id": "MDQ6VXNlcjU5ODk5MA==", "avatar_url": "https://avatars.githubusercontent.com/u/598990?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fafhrd91", "html_url": "https://github.com/fafhrd91", "followers_url": "https://api.github.com/users/fafhrd91/followers", "following_url": "https://api.github.com/users/fafhrd91/following{/other_user}", "gists_url": "https://api.github.com/users/fafhrd91/gists{/gist_id}", "starred_url": "https://api.github.com/users/fafhrd91/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fafhrd91/subscriptions", "organizations_url": "https://api.github.com/users/fafhrd91/orgs", "repos_url": "https://api.github.com/users/fafhrd91/repos", "events_url": "https://api.github.com/users/fafhrd91/events{/privacy}", "received_events_url": "https://api.github.com/users/fafhrd91/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 28, "state": "closed", "created_at": "2017-02-04T18:03:19Z", "updated_at": "2017-10-01T11:41:29Z", "due_on": "2017-03-07T08:00:00Z", "closed_at": "2017-03-20T17:38:47Z"}, "comments": 10, "created_at": "2016-12-09T16:43:11Z", "updated_at": "2019-10-29T00:01:57Z", "closed_at": "2017-02-22T06:54:10Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\n`web_reqrep.Request.post()` reads whole payload into memory and than stores uploads into temp files \u2014 implicitly by using `cgi.FieldStorage`.\r\n\r\n## Expected behaviour\r\n\r\nEither no temporary files or explicit behavior.\r\n\r\n## Actual behaviour\r\n\r\n`cgi.FieldStorage` creates temporary file for each upload (file).\r\nThe `FieldStorage` docstring states the following:\r\n```\r\n    The class is subclassable, mostly for the purpose of overriding\r\n    the make_file() method, which is called internally to come up with\r\n    a file open for reading and writing.  This makes it possible to\r\n    override the default choice of storing all files in a temporary\r\n    directory and unlinking them as soon as they have been opened.\r\n```\r\nSo it is possible to control how uploads are handled \u2014 either stored into temp files or any other way...\r\n\r\nPS: python documentation is missing `FieldStorage` description.\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1469/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1469/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1353", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1353/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1353/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1353/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/1353", "id": 186361362, "node_id": "MDU6SXNzdWUxODYzNjEzNjI=", "number": 1353, "title": "Handle unknown 1XX status codes better in client mode", "user": {"login": "Lukasa", "id": 1382556, "node_id": "MDQ6VXNlcjEzODI1NTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1382556?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Lukasa", "html_url": "https://github.com/Lukasa", "followers_url": "https://api.github.com/users/Lukasa/followers", "following_url": "https://api.github.com/users/Lukasa/following{/other_user}", "gists_url": "https://api.github.com/users/Lukasa/gists{/gist_id}", "starred_url": "https://api.github.com/users/Lukasa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Lukasa/subscriptions", "organizations_url": "https://api.github.com/users/Lukasa/orgs", "repos_url": "https://api.github.com/users/Lukasa/repos", "events_url": "https://api.github.com/users/Lukasa/events{/privacy}", "received_events_url": "https://api.github.com/users/Lukasa/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344995986, "node_id": "MDU6TGFiZWwzNDQ5OTU5ODY=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/client", "name": "client", "color": "bfd4f2", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2016-10-31T18:31:37Z", "updated_at": "2019-10-29T03:02:19Z", "closed_at": "2016-12-27T18:37:13Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\r\n\r\naiohttp's HTTP client does not tolerate non-100 or 101 status codes from the 1XX block in a sensible manner: it treats them as final responses, rather than as provisional ones.\r\n\r\n## Expected behaviour\r\n\r\nWhen aiohttp receives a 1XX status code that it does not recognise, it should either surface these to a user that expects them by means of a callback, or it should ignore them and only show the user the eventual final status code. This is required by [RFC 7231 Section 6.2 (Informational 1xx)](https://tools.ietf.org/html/rfc7231#section-6.2), which reads:\r\n\r\n> A client MUST be able to parse one or more 1xx responses received prior to a final response, even if the client does not expect one.  A user agent MAY ignore unexpected 1xx responses.\r\n\r\n## Actual behaviour\r\n\r\naiohttp treats the 1XX status code as final. It parses the header block as though it were a response in the 2XX or higher range. In most cases these 1XX response codes will not contain a content length or transfer-encoding directive, which means that aiohttp will fall back to reading until connection close. This will cause any following final response to be interpreted as part of the body of the 1XX response, rather than as its own unique response.\r\n\r\n## Steps to reproduce\r\n\r\nThe following \"server\" can demonstrate the issue:\r\n\r\n```python\r\nimport socket\r\nimport time\r\n\r\ndocument = b'''<!DOCTYPE html>\r\n<html lang=\"en\">\r\n  <head>\r\n    <meta charset=\"utf-8\">\r\n    <title>title</title>\r\n    <link rel=\"stylesheet\" href=\"/other/styles.css\">\r\n    <script src=\"/other/action.js\"></script>\r\n  </head>\r\n  <body>\r\n    <h1>Hello, world!</h1>\r\n  </body>\r\n</html>\r\n'''\r\n\r\ns = socket.socket()\r\ns.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)\r\ns.bind(('localhost', 8080))\r\ns.listen(5)\r\n\r\nwhile True:\r\n    new_socket, _ = s.accept()\r\n    data = b''\r\n\r\n    while not data.endswith(b'\\r\\n\\r\\n'):\r\n        data += new_socket.recv(8192)\r\n\r\n    new_socket.sendall(\r\n        b'HTTP/1.1 103 Early Hints\\r\\n'\r\n        b'Server: socketserver/1.0.0\\r\\n'\r\n        b'Link: </other/styles.css>; rel=preload; as=style\\r\\n'\r\n        b'Link: </other/action.js>; rel=preload; as=script\\r\\n'\r\n        b'\\r\\n'\r\n    )\r\n    time.sleep(1)\r\n    new_socket.sendall(\r\n        b'HTTP/1.1 200 OK\\r\\n'\r\n        b'Server: socketserver/1.0.0\\r\\n'\r\n        b'Content-Type: text/html\\r\\n'\r\n        b'Content-Length: %s\\r\\n'\r\n        b'Link: </other/styles.css>; rel=preload; as=style\\r\\n'\r\n        b'Link: </other/action.js>; rel=preload; as=script\\r\\n'\r\n        b'Connection: close\\r\\n'\r\n        b'\\r\\n' % len(document)\r\n    )\r\n    new_socket.sendall(document)\r\n    new_socket.close()\r\n```\r\n\r\nIf this server is run directly, the following client can be used to test it:\r\n\r\n```python\r\nimport aiohttp\r\nimport asyncio\r\nimport async_timeout\r\n\r\n\r\nasync def fetch(session, url):\r\n    with async_timeout.timeout(10):\r\n        async with session.get(url) as response:\r\n            print(\"Status: {}\".format(response.status))\r\n            print(\"---\")\r\n            return await response.text()\r\n\r\nasync def main(loop):\r\n    async with aiohttp.ClientSession(loop=loop) as session:\r\n        html = await fetch(session, 'http://localhost:8080/')\r\n        print(html)\r\n\r\nloop = asyncio.get_event_loop()\r\nloop.run_until_complete(main(loop))\r\n```\r\n\r\nThis client will print \r\n\r\n```\r\nStatus: 103\r\n\n---\r\nHTTP/1.1 200 OK\r\nServer: socketserver/1.0.0\r\nContent-Type: text/html\r\nContent-Length: 256\r\nLink: </other/styles.css>; rel=preload; as=style\r\nLink: </other/action.js>; rel=preload; as=script\r\nConnection: close\r\n\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n  <head>\r\n    <meta charset=\"utf-8\">\r\n    <title>title</title>\r\n    <link rel=\"stylesheet\" href=\"/other/styles.css\">\r\n    <script src=\"/other/action.js\"></script>\r\n  </head>\r\n  <body>\r\n    <h1>Hello, world!</h1>\r\n  </body>\r\n</html>\r\n```\r\n\r\nThis response is clearly wrong: the 200 header block is being treated as part of the 1XX response, rather than as a unique entity. Note that if `Content-Length: 0` is added to the 1XX response, this will still parse incorrectly, but now it will be treated as having zero length, and so will ruin the framing of the HTTP request/responses.\r\n\r\n## Your environment\r\n\r\naiohttp version 1.0.5\r\nPython 3.5.2\r\nmacOS 10.12.1\r\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1353/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1353/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1225", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1225/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1225/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1225/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/1225", "id": 180017693, "node_id": "MDU6SXNzdWUxODAwMTc2OTM=", "number": 1225, "title": "Unable to log certain environment variables in access log", "user": {"login": "VladV", "id": 184503, "node_id": "MDQ6VXNlcjE4NDUwMw==", "avatar_url": "https://avatars.githubusercontent.com/u/184503?v=4", "gravatar_id": "", "url": "https://api.github.com/users/VladV", "html_url": "https://github.com/VladV", "followers_url": "https://api.github.com/users/VladV/followers", "following_url": "https://api.github.com/users/VladV/following{/other_user}", "gists_url": "https://api.github.com/users/VladV/gists{/gist_id}", "starred_url": "https://api.github.com/users/VladV/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/VladV/subscriptions", "organizations_url": "https://api.github.com/users/VladV/orgs", "repos_url": "https://api.github.com/users/VladV/repos", "events_url": "https://api.github.com/users/VladV/events{/privacy}", "received_events_url": "https://api.github.com/users/VladV/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 277836062, "node_id": "MDU6TGFiZWwyNzc4MzYwNjI=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/good%20first%20issue", "name": "good first issue", "color": "7057ff", "default": true, "description": "Good for newcomers"}, {"id": 344996043, "node_id": "MDU6TGFiZWwzNDQ5OTYwNDM=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/server", "name": "server", "color": "006b75", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2016-09-29T11:01:14Z", "updated_at": "2019-10-29T06:02:34Z", "closed_at": "2016-09-30T05:09:25Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "`%{FOO}e` format doesn't accept underscores, so variables like `SERVER_SOFTWARE` cannot be included in the log.\nTested on 0.21.6, probably applies to the latest version as well.\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1225/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1225/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1211", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1211/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1211/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1211/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/1211", "id": 179080134, "node_id": "MDU6SXNzdWUxNzkwODAxMzQ=", "number": 1211, "title": "RuntimeError: Cannot pause_reading() when closing, triggered via FlowControlStreamReader.feed_data", "user": {"login": "zmedico", "id": 3420795, "node_id": "MDQ6VXNlcjM0MjA3OTU=", "avatar_url": "https://avatars.githubusercontent.com/u/3420795?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zmedico", "html_url": "https://github.com/zmedico", "followers_url": "https://api.github.com/users/zmedico/followers", "following_url": "https://api.github.com/users/zmedico/following{/other_user}", "gists_url": "https://api.github.com/users/zmedico/gists{/gist_id}", "starred_url": "https://api.github.com/users/zmedico/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zmedico/subscriptions", "organizations_url": "https://api.github.com/users/zmedico/orgs", "repos_url": "https://api.github.com/users/zmedico/repos", "events_url": "https://api.github.com/users/zmedico/events{/privacy}", "received_events_url": "https://api.github.com/users/zmedico/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344995986, "node_id": "MDU6TGFiZWwzNDQ5OTU5ODY=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/client", "name": "client", "color": "bfd4f2", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2016-09-25T10:52:15Z", "updated_at": "2019-10-29T03:02:01Z", "closed_at": "2017-01-23T18:26:24Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\n\nWhen trying to read the response to a get request from an https endpoint, I get a `RuntimeError: Cannot pause_reading() when closing` exception.\n## Expected behaviour\n\nI expect it to read the response successfully.\n## Actual behaviour\n\n```\n  File \"/usr/lib64/python3.5/site-packages/aiohttp/client_reqrep.py\", line 739, in read\n    self._content = yield from self.content.read()\n  File \"/usr/lib64/python3.5/site-packages/aiohttp/streams.py\", line 507, in wrapper\n    result = yield from func(self, *args, **kw)\n  File \"/usr/lib64/python3.5/site-packages/aiohttp/streams.py\", line 562, in read\n    return (yield from super().read(n))\n  File \"/usr/lib64/python3.5/site-packages/aiohttp/streams.py\", line 265, in read\n    raise self._exception\n  File \"/usr/lib64/python3.5/site-packages/aiohttp/parsers.py\", line 190, in set_parser\n    next(p)\n  File \"/usr/lib64/python3.5/site-packages/aiohttp/protocol.py\", line 313, in __call__\n    yield from self.parse_length_payload(out, buf, length)\n  File \"/usr/lib64/python3.5/site-packages/aiohttp/protocol.py\", line 359, in parse_length_payload\n    out.feed_data(chunk, len(chunk))\n  File \"/usr/lib64/python3.5/site-packages/aiohttp/streams.py\", line 554, in feed_data\n    self._stream.transport.pause_reading()\n  File \"/usr/lib64/python3.5/asyncio/sslproto.py\", line 336, in pause_reading\n    self._ssl_protocol._transport.pause_reading()\n  File \"/usr/lib64/python3.5/asyncio/selector_events.py\", line 647, in pause_reading\n    raise RuntimeError('Cannot pause_reading() when closing')\nRuntimeError: Cannot pause_reading() when closing\n```\n## Steps to reproduce\n\nThe relevant code is something like this, though I've only been able to reproduce it in an application which creates many sessions simultaneously:\n\n```\nasync def ssl_fetch(url):\n    with aiohttp.ClientSession(\n        connector=aiohttp.TCPConnector(\n        ssl_context=ssl._create_unverified_context())) as session:\n\n        resp = await session.get(url)\n        content = await resp.read()\n        await resp.release()\n        return content\n```\n## Your environment\n\nI have observed this bug with aiohttp versions 1.0.1 and 1.0.2 (have not tried any older versions), on Gentoo Linux with Python 3.5.2. I've only been able to reproduce it in an application which creates many sessions simultaneously. Each session has a single request directed at an https endpoint on port 5080 of Linux host running ganeti (http://docs.ganeti.org/ganeti/2.5/man/ganeti-rapi.html).\n\nI was able to workaround the problem by overriding the ClientSession response_class parameter as follows:\n\n```\nclass _FlowControlStreamReader(aiohttp.streams.StreamReader):\n    def feed_data(self, data, size=0):\n        super().feed_data(data)\n\nclass _ClientResponse(aiohttp.client_reqrep.ClientResponse):\n    # workaround bug in FlowControlStreamReader\n    flow_control_class = _FlowControlStreamReader\n```\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1211/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1211/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1200", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1200/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1200/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1200/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/1200", "id": 178291792, "node_id": "MDExOlB1bGxSZXF1ZXN0ODYxMjU5MDY=", "number": 1200, "title": "Add missing WSMsgType to web_ws.__all__", "user": {"login": "popravich", "id": 323442, "node_id": "MDQ6VXNlcjMyMzQ0Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/323442?v=4", "gravatar_id": "", "url": "https://api.github.com/users/popravich", "html_url": "https://github.com/popravich", "followers_url": "https://api.github.com/users/popravich/followers", "following_url": "https://api.github.com/users/popravich/following{/other_user}", "gists_url": "https://api.github.com/users/popravich/gists{/gist_id}", "starred_url": "https://api.github.com/users/popravich/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/popravich/subscriptions", "organizations_url": "https://api.github.com/users/popravich/orgs", "repos_url": "https://api.github.com/users/popravich/repos", "events_url": "https://api.github.com/users/popravich/events{/privacy}", "received_events_url": "https://api.github.com/users/popravich/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2016-09-21T09:22:00Z", "updated_at": "2019-10-29T13:05:22Z", "closed_at": "2016-09-21T09:35:13Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/1200", "html_url": "https://github.com/aio-libs/aiohttp/pull/1200", "diff_url": "https://github.com/aio-libs/aiohttp/pull/1200.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/1200.patch", "merged_at": "2016-09-21T09:35:13Z"}, "body": "## What do these changes do?\n\nAdd `WSMsgType` to `web_ws.__all__` as it was missing there.\n## Are there changes in behavior for the user?\n\n`from aiohttp.web import WSMsgType` will work\n## Related issue number\n#1193\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1200/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1200/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1148", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1148/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1148/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1148/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/1148", "id": 176070992, "node_id": "MDU6SXNzdWUxNzYwNzA5OTI=", "number": 1148, "title": "Recent change to GunicornWebWorker breaks code", "user": {"login": "bcmyers", "id": 10109972, "node_id": "MDQ6VXNlcjEwMTA5OTcy", "avatar_url": "https://avatars.githubusercontent.com/u/10109972?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bcmyers", "html_url": "https://github.com/bcmyers", "followers_url": "https://api.github.com/users/bcmyers/followers", "following_url": "https://api.github.com/users/bcmyers/following{/other_user}", "gists_url": "https://api.github.com/users/bcmyers/gists{/gist_id}", "starred_url": "https://api.github.com/users/bcmyers/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bcmyers/subscriptions", "organizations_url": "https://api.github.com/users/bcmyers/orgs", "repos_url": "https://api.github.com/users/bcmyers/repos", "events_url": "https://api.github.com/users/bcmyers/events{/privacy}", "received_events_url": "https://api.github.com/users/bcmyers/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/7", "html_url": "https://github.com/aio-libs/aiohttp/milestone/7", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/7/labels", "id": 1962252, "node_id": "MDk6TWlsZXN0b25lMTk2MjI1Mg==", "number": 7, "title": "1.0", "description": "", "creator": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 5, "state": "closed", "created_at": "2016-08-25T05:50:22Z", "updated_at": "2016-09-16T13:23:10Z", "due_on": null, "closed_at": "2016-09-16T13:23:10Z"}, "comments": 2, "created_at": "2016-09-09T18:02:27Z", "updated_at": "2019-10-29T07:02:37Z", "closed_at": "2016-09-12T16:41:24Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\n\nFor development, I like using the autoreload feature you can get with gunicorn; so I've been using the following python script to start up a development server:\n\n``` python\nimport os\n\nif __name__ == '__main__':\n    command = (\n        'gunicorn server:app ' +\n        '--bind 0.0.0.0:5000 ' +\n        '--workers 1 ' +\n        '--worker-class aiohttp.worker.GunicornUVLoopWebWorker ' +\n        '--reload')\n    os.system(command)\n```\n\nThis works on the 0.22 branch, but fails when I move to the master branch (1.0.0a0).  I get the following traceback using the master branch when I try to launch the server:\n\n```\nTraceback (most recent call last):\n  File \"/Users/bcmyers/Dropbox/Programming/python/website/venv/lib/python3.5/site-packages/gunicorn/arbiter.py\", line 557, in spawn_worker\n    worker.init_process()\n  File \"/Users/bcmyers/Dropbox/Programming/python/website/venv/lib/python3.5/site-packages/aiohttp/worker.py\", line 196, in init_process\n    super().init_process()\n  File \"/Users/bcmyers/Dropbox/Programming/python/website/venv/lib/python3.5/site-packages/aiohttp/worker.py\", line 36, in init_process\n    super().init_process()\n  File \"/Users/bcmyers/Dropbox/Programming/python/website/venv/lib/python3.5/site-packages/gunicorn/workers/base.py\", line 132, in init_process\n    self.run()\n  File \"/Users/bcmyers/Dropbox/Programming/python/website/venv/lib/python3.5/site-packages/aiohttp/worker.py\", line 43, in run\n    self.loop.run_until_complete(self._runner)\n  File \"uvloop/loop.pyx\", line 1133, in uvloop.loop.Loop.run_until_complete (uvloop/loop.c:19943)\n  File \"uvloop/future.pyx\", line 123, in uvloop.loop.BaseFuture.result (uvloop/loop.c:94147)\n  File \"uvloop/future.pyx\", line 78, in uvloop.loop.BaseFuture._result_impl (uvloop/loop.c:93686)\n  File \"uvloop/task.pyx\", line 126, in uvloop.loop.BaseTask._fast_step (uvloop/loop.c:99430)\n  File \"/Users/bcmyers/Dropbox/Programming/python/website/venv/lib/python3.5/site-packages/aiohttp/worker.py\", line 91, in _run\n    handler = self.make_handler(self.wsgi)\n  File \"/Users/bcmyers/Dropbox/Programming/python/website/venv/lib/python3.5/site-packages/aiohttp/worker.py\", line 52, in make_handler\n    debug=self.cfg.debug,\n  File \"/Users/bcmyers/Dropbox/Programming/python/website/venv/lib/python3.5/site-packages/gunicorn/config.py\", line 58, in __getattr__\n    raise AttributeError(\"No configuration setting for: %s\" % name)\nAttributeError: No configuration setting for: debug\n```\n\nI think the reason is that the `make_handler` method on the `GunicornWebWorker` class has changed from this:\n\n``` python\ndef make_handler(self, app):\n    if hasattr(self.cfg, 'debug'):\n        is_debug = self.cfg.debug\n    else:\n        is_debug = self.log.loglevel == logging.DEBUG\n\n    return app.make_handler(\n        logger=self.log,\n        debug=is_debug,\n        timeout=self.cfg.timeout,\n        keep_alive=self.cfg.keepalive,\n        access_log=self.log.access_log,\n        access_log_format=self.cfg.access_log_format)\n```\n\nto this:\n\n``` python\ndef make_handler(self, app):\n    return app.make_handler(\n        logger=self.log,\n        debug=self.cfg.debug,\n        timeout=self.cfg.timeout,\n        keep_alive=self.cfg.keepalive,\n        access_log=self.log.access_log,\n        access_log_format=self._get_valid_log_format(\n            self.cfg.access_log_format))\n```\n\nIt appears my `cfg` object has no `debug` attribute, which was fine on branch 0.22 but leads to my script failing on the master branch.  Is this a bug?  If not, it would be great if someone could let me know how to fix my code.\n\nThanks!\n## My environment\n\n```\naiohttp==1.0.0a0\ngunicorn==19.6.0\nuvloop==0.5.3\n```\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1148/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1148/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1146", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1146/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1146/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1146/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/1146", "id": 176027984, "node_id": "MDU6SXNzdWUxNzYwMjc5ODQ=", "number": 1146, "title": "Redirects for HEAD requests should use HEAD", "user": {"login": "catlee", "id": 54458, "node_id": "MDQ6VXNlcjU0NDU4", "avatar_url": "https://avatars.githubusercontent.com/u/54458?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catlee", "html_url": "https://github.com/catlee", "followers_url": "https://api.github.com/users/catlee/followers", "following_url": "https://api.github.com/users/catlee/following{/other_user}", "gists_url": "https://api.github.com/users/catlee/gists{/gist_id}", "starred_url": "https://api.github.com/users/catlee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catlee/subscriptions", "organizations_url": "https://api.github.com/users/catlee/orgs", "repos_url": "https://api.github.com/users/catlee/repos", "events_url": "https://api.github.com/users/catlee/events{/privacy}", "received_events_url": "https://api.github.com/users/catlee/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344995986, "node_id": "MDU6TGFiZWwzNDQ5OTU5ODY=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/client", "name": "client", "color": "bfd4f2", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2016-09-09T14:48:22Z", "updated_at": "2019-10-29T07:02:46Z", "closed_at": "2016-09-10T09:02:11Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "## Long story short\n\nI'm trying to do a HEAD request to a service that returns a 303 redirect. aiohttp then does a full GET on the new location.\n## Expected behaviour\n\naiohttp should instead do a HEAD on the new URL.\n## Actual behaviour\n\naiohttp does a GET on the new URL\n\nThe code responsible is here: https://github.com/KeepSafe/aiohttp/blob/master/aiohttp/client.py#L228\nThis references this PR from the requests library: https://github.com/kennethreitz/requests/pull/269/files. However, the requests library is preserving the HEAD method for subsequent requests.\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1146/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1146/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1125", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1125/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1125/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1125/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/1125", "id": 173285452, "node_id": "MDU6SXNzdWUxNzMyODU0NTI=", "number": 1125, "title": "Cookies for different domains with same name disappear", "user": {"login": "JeckLabs", "id": 2048990, "node_id": "MDQ6VXNlcjIwNDg5OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/2048990?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JeckLabs", "html_url": "https://github.com/JeckLabs", "followers_url": "https://api.github.com/users/JeckLabs/followers", "following_url": "https://api.github.com/users/JeckLabs/following{/other_user}", "gists_url": "https://api.github.com/users/JeckLabs/gists{/gist_id}", "starred_url": "https://api.github.com/users/JeckLabs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JeckLabs/subscriptions", "organizations_url": "https://api.github.com/users/JeckLabs/orgs", "repos_url": "https://api.github.com/users/JeckLabs/repos", "events_url": "https://api.github.com/users/JeckLabs/events{/privacy}", "received_events_url": "https://api.github.com/users/JeckLabs/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344995986, "node_id": "MDU6TGFiZWwzNDQ5OTU5ODY=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/client", "name": "client", "color": "bfd4f2", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/7", "html_url": "https://github.com/aio-libs/aiohttp/milestone/7", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/7/labels", "id": 1962252, "node_id": "MDk6TWlsZXN0b25lMTk2MjI1Mg==", "number": 7, "title": "1.0", "description": "", "creator": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 5, "state": "closed", "created_at": "2016-08-25T05:50:22Z", "updated_at": "2016-09-16T13:23:10Z", "due_on": null, "closed_at": "2016-09-16T13:23:10Z"}, "comments": 14, "created_at": "2016-08-25T19:11:45Z", "updated_at": "2019-10-29T07:01:55Z", "closed_at": "2016-09-16T13:22:43Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "It seems that cookies are stored in key / value dictionary that causing the problem in the storing cookies from different domains / subdomains in one session.\n\n``` python\nwith aiohttp.ClientSession() as client:\n\n    async with client.get('https://httpbin.org/cookies/set?test=ok') as resp:\n        logging.info(await resp.json())\n\n    async with client.get('https://httpbin.org/cookies') as resp:\n        logging.info(await resp.json())\n\n    async with client.get('https://http2bin.org/cookies/set?test=fail') as resp:\n        logging.info(await resp.json())\n\n    async with client.get('https://httpbin.org/cookies') as resp:\n        logging.info(await resp.json())\n\n    logger.info(client.cookies)\n```\n\n```\n2016-08-25 21:57:38 INFO {'cookies': {'test_cookie': 'ok'}}\n2016-08-25 21:57:39 INFO {'cookies': {'test_cookie': 'ok'}}\n2016-08-25 21:57:39 INFO {'cookies': {'test_cookie': 'fail'}}\n2016-08-25 21:57:39 INFO {'cookies': {}}\n```\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1125/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/1125/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/848", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/848/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/848/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/848/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/848", "id": 147625286, "node_id": "MDU6SXNzdWUxNDc2MjUyODY=", "number": 848, "title": "Outdated cookie example in docs", "user": {"login": "xinghanchuanqizibenguanliyou", "id": 18004332, "node_id": "MDQ6VXNlcjE4MDA0MzMy", "avatar_url": "https://avatars.githubusercontent.com/u/18004332?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xinghanchuanqizibenguanliyou", "html_url": "https://github.com/xinghanchuanqizibenguanliyou", "followers_url": "https://api.github.com/users/xinghanchuanqizibenguanliyou/followers", "following_url": "https://api.github.com/users/xinghanchuanqizibenguanliyou/following{/other_user}", "gists_url": "https://api.github.com/users/xinghanchuanqizibenguanliyou/gists{/gist_id}", "starred_url": "https://api.github.com/users/xinghanchuanqizibenguanliyou/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xinghanchuanqizibenguanliyou/subscriptions", "organizations_url": "https://api.github.com/users/xinghanchuanqizibenguanliyou/orgs", "repos_url": "https://api.github.com/users/xinghanchuanqizibenguanliyou/repos", "events_url": "https://api.github.com/users/xinghanchuanqizibenguanliyou/events{/privacy}", "received_events_url": "https://api.github.com/users/xinghanchuanqizibenguanliyou/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2016-04-12T03:56:10Z", "updated_at": "2019-10-29T12:01:43Z", "closed_at": "2016-04-21T08:46:06Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Long story short\n\n<!-- Please describe your problem and why the fix is important. -->\n## Expected behaviour\n\n<!-- What the behaviour did you expect? -->\n## Actual behaviour\n\n<!-- What's actually happened? -->\n## Steps to reproduce\n\n<!-- Please describe steps to reproduce the issue.\n     If you have a script that does that please include it here within\n     markdown code markup -->\n## Your environment\n\n<!-- Describe the environment you have that leed to your issue.\n     This includes project version, OS, proxy server and else bits that\n     are related to your case. -->\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/848/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/848/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/732", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/732/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/732/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/732/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/732", "id": 126053121, "node_id": "MDU6SXNzdWUxMjYwNTMxMjE=", "number": 732, "title": "Using a file object as the data parameter forces chunked transfer encoding", "user": {"login": "catlee", "id": 54458, "node_id": "MDQ6VXNlcjU0NDU4", "avatar_url": "https://avatars.githubusercontent.com/u/54458?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catlee", "html_url": "https://github.com/catlee", "followers_url": "https://api.github.com/users/catlee/followers", "following_url": "https://api.github.com/users/catlee/following{/other_user}", "gists_url": "https://api.github.com/users/catlee/gists{/gist_id}", "starred_url": "https://api.github.com/users/catlee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catlee/subscriptions", "organizations_url": "https://api.github.com/users/catlee/orgs", "repos_url": "https://api.github.com/users/catlee/repos", "events_url": "https://api.github.com/users/catlee/events{/privacy}", "received_events_url": "https://api.github.com/users/catlee/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 58986077, "node_id": "MDU6TGFiZWw1ODk4NjA3Nw==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/enhancement", "name": "enhancement", "color": "84b6eb", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2016-01-11T22:35:59Z", "updated_at": "2019-10-29T00:02:07Z", "closed_at": "2017-02-20T05:02:13Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "I'm trying to PUT to S3 using code like this:\n\n```\nresponse = yield from session.request('put', put_url, headers=headers, data=fileobj)\n```\n\nI already know how big fileobj is, and I've included that in the content-length header. However, it appears as if aiohttp can't figure out how big it is, and so forces the request to use chunked transfer encoding, which S3 rejects.\n\nIn my case, fileobj is a tempfile.TemporaryFile object.\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/732/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/732/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/725", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/725/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/725/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/725/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/725", "id": 125726032, "node_id": "MDU6SXNzdWUxMjU3MjYwMzI=", "number": 725, "title": "Memory leak in set_parser", "user": {"login": "mpaolini", "id": 523292, "node_id": "MDQ6VXNlcjUyMzI5Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/523292?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpaolini", "html_url": "https://github.com/mpaolini", "followers_url": "https://api.github.com/users/mpaolini/followers", "following_url": "https://api.github.com/users/mpaolini/following{/other_user}", "gists_url": "https://api.github.com/users/mpaolini/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpaolini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpaolini/subscriptions", "organizations_url": "https://api.github.com/users/mpaolini/orgs", "repos_url": "https://api.github.com/users/mpaolini/repos", "events_url": "https://api.github.com/users/mpaolini/events{/privacy}", "received_events_url": "https://api.github.com/users/mpaolini/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2016-01-09T00:58:32Z", "updated_at": "2019-10-29T05:01:31Z", "closed_at": "2016-11-22T17:26:48Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "I've got two more leaks tracked down with `tracemalloc` and disabled gc\n\n```\n<StatisticDiff traceback=<Traceback (<Frame filename='/usr/local/lib/python3.4/site-packages/aiohttp/client_reqrep.py' lineno=481>,)> size=984648 (+209328) count=5547 (+267)>,\n <StatisticDiff traceback=<Traceback (<Frame filename='/usr/local/lib/python3.4/site-packages/aiohttp/protocol.py' lineno=319>,)> size=298096 (+116064) count=601 (+234)>,\n```\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/725/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/725/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/718", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/718/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/718/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/718/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/718", "id": 124832443, "node_id": "MDExOlB1bGxSZXF1ZXN0NTUwMTg0OTU=", "number": 718, "title": "Check address family to fill wsgi env properly", "user": {"login": "redixin", "id": 103634, "node_id": "MDQ6VXNlcjEwMzYzNA==", "avatar_url": "https://avatars.githubusercontent.com/u/103634?v=4", "gravatar_id": "", "url": "https://api.github.com/users/redixin", "html_url": "https://github.com/redixin", "followers_url": "https://api.github.com/users/redixin/followers", "following_url": "https://api.github.com/users/redixin/following{/other_user}", "gists_url": "https://api.github.com/users/redixin/gists{/gist_id}", "starred_url": "https://api.github.com/users/redixin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/redixin/subscriptions", "organizations_url": "https://api.github.com/users/redixin/orgs", "repos_url": "https://api.github.com/users/redixin/repos", "events_url": "https://api.github.com/users/redixin/events{/privacy}", "received_events_url": "https://api.github.com/users/redixin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/5", "html_url": "https://github.com/aio-libs/aiohttp/milestone/5", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/5/labels", "id": 1477107, "node_id": "MDk6TWlsZXN0b25lMTQ3NzEwNw==", "number": 5, "title": "0.21", "description": "aiohttp 0.21 release", "creator": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 21, "state": "closed", "created_at": "2015-12-29T15:15:02Z", "updated_at": "2016-02-16T20:42:09Z", "due_on": null, "closed_at": "2016-02-16T20:42:09Z"}, "comments": 7, "created_at": "2016-01-04T20:31:39Z", "updated_at": "2019-10-29T21:03:47Z", "closed_at": "2016-01-05T13:53:11Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/718", "html_url": "https://github.com/aio-libs/aiohttp/pull/718", "diff_url": "https://github.com/aio-libs/aiohttp/pull/718.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/718.patch", "merged_at": "2016-01-05T13:53:11Z"}, "body": "", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/718/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/718/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/716", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/716/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/716/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/716/events", "html_url": "https://github.com/aio-libs/aiohttp/pull/716", "id": 124667202, "node_id": "MDExOlB1bGxSZXF1ZXN0NTQ5MzA4Mzk=", "number": 716, "title": "Fix broken wsgi.py due to sockname info size", "user": {"login": "merrellb", "id": 309627, "node_id": "MDQ6VXNlcjMwOTYyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/309627?v=4", "gravatar_id": "", "url": "https://api.github.com/users/merrellb", "html_url": "https://github.com/merrellb", "followers_url": "https://api.github.com/users/merrellb/followers", "following_url": "https://api.github.com/users/merrellb/following{/other_user}", "gists_url": "https://api.github.com/users/merrellb/gists{/gist_id}", "starred_url": "https://api.github.com/users/merrellb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/merrellb/subscriptions", "organizations_url": "https://api.github.com/users/merrellb/orgs", "repos_url": "https://api.github.com/users/merrellb/repos", "events_url": "https://api.github.com/users/merrellb/events{/privacy}", "received_events_url": "https://api.github.com/users/merrellb/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/5", "html_url": "https://github.com/aio-libs/aiohttp/milestone/5", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/5/labels", "id": 1477107, "node_id": "MDk6TWlsZXN0b25lMTQ3NzEwNw==", "number": 5, "title": "0.21", "description": "aiohttp 0.21 release", "creator": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 21, "state": "closed", "created_at": "2015-12-29T15:15:02Z", "updated_at": "2016-02-16T20:42:09Z", "due_on": null, "closed_at": "2016-02-16T20:42:09Z"}, "comments": 9, "created_at": "2016-01-03T19:41:59Z", "updated_at": "2019-10-29T21:03:50Z", "closed_at": "2016-01-05T13:57:44Z", "author_association": "NONE", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/aio-libs/aiohttp/pulls/716", "html_url": "https://github.com/aio-libs/aiohttp/pull/716", "diff_url": "https://github.com/aio-libs/aiohttp/pull/716.diff", "patch_url": "https://github.com/aio-libs/aiohttp/pull/716.patch", "merged_at": null}, "body": "Addresses issue introduced by cccb9cbf267cd753c958297f6f3784d4f20799db\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/716/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/716/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/489", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/489/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/489/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/489/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/489", "id": 104727396, "node_id": "MDU6SXNzdWUxMDQ3MjczOTY=", "number": 489, "title": "[bug] URL parssing error in the web server", "user": {"login": "ghost", "id": 10137, "node_id": "MDQ6VXNlcjEwMTM3", "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghost", "html_url": "https://github.com/ghost", "followers_url": "https://api.github.com/users/ghost/followers", "following_url": "https://api.github.com/users/ghost/following{/other_user}", "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghost/subscriptions", "organizations_url": "https://api.github.com/users/ghost/orgs", "repos_url": "https://api.github.com/users/ghost/repos", "events_url": "https://api.github.com/users/ghost/events{/privacy}", "received_events_url": "https://api.github.com/users/ghost/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/1", "html_url": "https://github.com/aio-libs/aiohttp/milestone/1", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/milestones/1/labels", "id": 1250551, "node_id": "MDk6TWlsZXN0b25lMTI1MDU1MQ==", "number": 1, "title": "0.18", "description": "aiohttp 0.18 major release", "creator": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 18, "state": "closed", "created_at": "2015-08-11T19:36:14Z", "updated_at": "2016-11-01T10:08:39Z", "due_on": null, "closed_at": "2015-10-19T08:26:58Z"}, "comments": 2, "created_at": "2015-09-03T15:55:01Z", "updated_at": "2019-10-29T17:01:48Z", "closed_at": "2015-09-04T15:10:28Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "If you run this simple server example :\n\n``` python\nimport asyncio\nfrom aiohttp import web\n\n@asyncio.coroutine\ndef handle(request):\n    return webResponse(body=request.path.encode('utf8'))\n\n@asyncio.coroutine\ndef init(loop):\n    app = web.Application(loop=loop)\n    app.router.add_route('GET', '/', handle)\n    srv = yield from loop.create_server(app.make_handler(), '127.0.0.1', 5555)\n    return srv\n\nloop = asyncio.get_event_loop()\nloop.run_until_complete(init(loop))\n\ntry:\n    loop.run_forever()\nexcept KeyboardInterrupt:\n    pass\n```\n\nThe following requests will get a `200 OK` with the considered path as content :\n\n```\n$ curl -X GET http://127.0.0.1:5555///\n/\n$ curl -X GET http://127.0.0.1:555//foo/\n/\n```\n\nAs you can see, the path of the URL is not well parsed.\n\nThis bug resides in the `_splitted_path` non-data descriptor which uses `urlsplit` on a path rather than a full URL. The consequence is a second segment interpreted as a network location if the first one is empty.\n\nI've not quite investigated a fix at the moment, but  `_splitted_path` only being used by `raw_path` and `query_string` seems to be a plea to use a fake scheme and netloc for `urlsplit` to behave the expected way.\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/489/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/489/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/356", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/356/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/356/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/356/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/356", "id": 75009502, "node_id": "MDU6SXNzdWU3NTAwOTUwMg==", "number": 356, "title": "Inconsistent behavior when merging params", "user": {"login": "brunsgaard", "id": 815816, "node_id": "MDQ6VXNlcjgxNTgxNg==", "avatar_url": "https://avatars.githubusercontent.com/u/815816?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brunsgaard", "html_url": "https://github.com/brunsgaard", "followers_url": "https://api.github.com/users/brunsgaard/followers", "following_url": "https://api.github.com/users/brunsgaard/following{/other_user}", "gists_url": "https://api.github.com/users/brunsgaard/gists{/gist_id}", "starred_url": "https://api.github.com/users/brunsgaard/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brunsgaard/subscriptions", "organizations_url": "https://api.github.com/users/brunsgaard/orgs", "repos_url": "https://api.github.com/users/brunsgaard/repos", "events_url": "https://api.github.com/users/brunsgaard/events{/privacy}", "received_events_url": "https://api.github.com/users/brunsgaard/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 344995986, "node_id": "MDU6TGFiZWwzNDQ5OTU5ODY=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/client", "name": "client", "color": "bfd4f2", "default": false, "description": null}, {"id": 386634685, "node_id": "MDU6TGFiZWwzODY2MzQ2ODU=", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/sprint", "name": "sprint", "color": "0e8a16", "default": false, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2015-05-10T21:48:19Z", "updated_at": "2019-10-28T20:02:06Z", "closed_at": "2017-06-01T16:21:21Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "This is best illustrated by the code snippet below, which will print `http://localhost:5000/test?key1=value1`, but the server log tells me that the params was actually merged in the request.\n\nI am not sure what the decided behavior should be, when the url contains params and the param keyword argument also is given. But at least the `url` variable in the response object should be consistent with the actual request.\n\n```\n127.0.0.1 - - [10/May/2015 23:39:13] \"GET /test?key1=value1&key2=value2 HTTP/1.1\" 404\n```\n\n``` python\nimport asyncio\nimport aiohttp\n\n@asyncio.coroutine\ndef test_para():\n    url_with_params = 'http://localhost:5000/test?key1=value1'\n    more_params = {'key2': 'value2'}\n    req = aiohttp.request('get', url_with_params, params=more_params)\n    resp = yield from req\n    print(resp.url)\n\nloop = asyncio.get_event_loop()\nloop.run_until_complete(test_para())\nloop.close()\n```\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/356/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/356/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/264", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/264/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/264/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/264/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/264", "id": 55913895, "node_id": "MDU6SXNzdWU1NTkxMzg5NQ==", "number": 264, "title": "UrlDispatcher error during constructing of url with regex parts", "user": {"login": "imbolc", "id": 747996, "node_id": "MDQ6VXNlcjc0Nzk5Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/747996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/imbolc", "html_url": "https://github.com/imbolc", "followers_url": "https://api.github.com/users/imbolc/followers", "following_url": "https://api.github.com/users/imbolc/following{/other_user}", "gists_url": "https://api.github.com/users/imbolc/gists{/gist_id}", "starred_url": "https://api.github.com/users/imbolc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/imbolc/subscriptions", "organizations_url": "https://api.github.com/users/imbolc/orgs", "repos_url": "https://api.github.com/users/imbolc/repos", "events_url": "https://api.github.com/users/imbolc/events{/privacy}", "received_events_url": "https://api.github.com/users/imbolc/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 6, "created_at": "2015-01-29T15:35:05Z", "updated_at": "2019-10-29T20:01:43Z", "closed_at": "2015-01-29T19:26:45Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "```\n>>> from aiohttp.web import UrlDispatcher\n>>> disp = UrlDispatcher()\n>>> disp.add_route('GET', '/{num:^\\d+}', lambda x: x, name='name')\n<DynamicRoute 'name' [GET] /{num:^\\d+} -> <function <lambda> at 0x7f0223131840>\n>>> disp['name'].url(parts={'num': '1'})\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\n  File \"/home/imbolc/.pyenv/versions/3.4.1/lib/python3.4/site-packages/aiohttp/web.py\", line 1226, in url\n    url = self._formatter.format_map(parts)\nValueError: Invalid format specifier\n\n\n\n```\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/264/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/264/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/255", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/255/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/255/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/255/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/255", "id": 55130379, "node_id": "MDU6SXNzdWU1NTEzMDM3OQ==", "number": 255, "title": "Handling WebSocket disconnects", "user": {"login": "saghul", "id": 317464, "node_id": "MDQ6VXNlcjMxNzQ2NA==", "avatar_url": "https://avatars.githubusercontent.com/u/317464?v=4", "gravatar_id": "", "url": "https://api.github.com/users/saghul", "html_url": "https://github.com/saghul", "followers_url": "https://api.github.com/users/saghul/followers", "following_url": "https://api.github.com/users/saghul/following{/other_user}", "gists_url": "https://api.github.com/users/saghul/gists{/gist_id}", "starred_url": "https://api.github.com/users/saghul/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/saghul/subscriptions", "organizations_url": "https://api.github.com/users/saghul/orgs", "repos_url": "https://api.github.com/users/saghul/repos", "events_url": "https://api.github.com/users/saghul/events{/privacy}", "received_events_url": "https://api.github.com/users/saghul/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": {"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "asvetlov", "id": 356399, "node_id": "MDQ6VXNlcjM1NjM5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/356399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asvetlov", "html_url": "https://github.com/asvetlov", "followers_url": "https://api.github.com/users/asvetlov/followers", "following_url": "https://api.github.com/users/asvetlov/following{/other_user}", "gists_url": "https://api.github.com/users/asvetlov/gists{/gist_id}", "starred_url": "https://api.github.com/users/asvetlov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asvetlov/subscriptions", "organizations_url": "https://api.github.com/users/asvetlov/orgs", "repos_url": "https://api.github.com/users/asvetlov/repos", "events_url": "https://api.github.com/users/asvetlov/events{/privacy}", "received_events_url": "https://api.github.com/users/asvetlov/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2015-01-22T09:16:00Z", "updated_at": "2019-10-29T20:01:59Z", "closed_at": "2015-01-22T23:51:38Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "When reading from a ws connection, the `receive_msg` function may raise `WSClientDisconnectedError`. The example in the documentation just returns the ws object once done:\n\n```\n@asyncio.coroutine\ndef websocket_handler(request):\n    ws = web.WebSocketResponse()\n    ws.start(request)\n\n    while True:\n        try:\n            data = yield from ws.receive_str()\n            ws.send_str(data)\n        except web.WSClientDisconnectedError:\n            return ws\n```\n\nHowever, when an error is produced the exception is also stored in the closing_fut: https://github.com/KeepSafe/aiohttp/blob/master/aiohttp/web.py#L833-L859 As a result, a warning is logged because nobody retrieves that exception. I guess one way to \"solve\" it is to do something like this:\n\n```\n@asyncio.coroutine\ndef websocket_handler(request):\n    ws = web.WebSocketResponse()\n    ws.start(request)\n\n    while True:\n        try:\n            data = yield from ws.receive_str()\n            ws.send_str(data)\n        except web.WSClientDisconnectedError:\n            try:\n                yield from ws.wait_closed()\n            except web.WSClientDisconnectedError:\n                pass\n            return ws\n```\n\nBut it kinda feels wrong.\n\nAm I missing something or should this be handled differently? Thanks a lot for aiohttp, I'm really liking it so far!\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/255/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/255/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/161", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/161/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/161/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/161/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/161", "id": 46519882, "node_id": "MDU6SXNzdWU0NjUxOTg4Mg==", "number": 161, "title": "aiohttp can't send files by POST request correct", "user": {"login": "spkps", "id": 2507393, "node_id": "MDQ6VXNlcjI1MDczOTM=", "avatar_url": "https://avatars.githubusercontent.com/u/2507393?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spkps", "html_url": "https://github.com/spkps", "followers_url": "https://api.github.com/users/spkps/followers", "following_url": "https://api.github.com/users/spkps/following{/other_user}", "gists_url": "https://api.github.com/users/spkps/gists{/gist_id}", "starred_url": "https://api.github.com/users/spkps/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spkps/subscriptions", "organizations_url": "https://api.github.com/users/spkps/orgs", "repos_url": "https://api.github.com/users/spkps/repos", "events_url": "https://api.github.com/users/spkps/events{/privacy}", "received_events_url": "https://api.github.com/users/spkps/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2014-10-22T15:00:26Z", "updated_at": "2019-10-29T19:01:50Z", "closed_at": "2015-04-15T18:37:34Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "I've bumped into multiple different issues when tried to send a file to my REST service. I think it'll be better when I just left some code samples instead of detailed description.\n\nIn client part I send two different in size files. I send them using different transports to have the possibility to see errorrs. One of transport is requests and the other is asyncio.\n\n```\nimport asyncio\nimport aiohttp\nimport requests\nimport urllib.request\n\nurl = 'http://127.0.0.1:8080/load/image'\n\nempty_pixel_url = 'http://upload.wikimedia.org/wikipedia/commons/c/ce/Transparent.gif'\nlarge_image_url = 'http://upload.wikimedia.org/wikipedia/commons/d/df/Comet-SidingSpring-Passing-PlanetMars-On-20141019-ArtistConcept-20140905.jpg'\n\npixel = {'image': ('pixel.jpg', urllib.request.urlopen(empty_pixel_url))}\nlarge_image = {'image': urllib.request.urlopen(large_image_url)}\n\n\n@asyncio.coroutine\ndef post_coroutine(files):\n    r = yield from aiohttp.request('post', url, files=files)\n    return (yield from r.text())\n\n\ndef post_asyncio(files):\n    \"\"\"\n        POST by asyncio\n    \"\"\"\n    loop = asyncio.get_event_loop()\n    res = loop.run_until_complete(post_coroutine(files))\n    print(res)\n\n\ndef post_requests(files):\n    \"\"\"\n        POST by requests\n    \"\"\"\n    response = requests.post(url, files=files)\n    print(response.content)\n\n\nif __name__ == '__main__':\n\n    print('post by requests\\n')\n    post_requests(pixel)\n    post_requests(large_image)\n\n    print('\\n'+'-'*20+'\\n')\n    print('post by asyncio')\n    post_asyncio(pixel)\n    post_asyncio(large_image)\n```\n\nThe server part has been written with bottlepy.\n\n```\nimport time\nfrom pathlib import Path\nfrom bottle import post, run, request\n\n@post('/load/image')\ndef load_image():\n    upload = request.files.get('image')\n    fn = upload.filename + str(time.time())\n    upload.save(str(Path('/tmp') / fn))\n    return dict(filename=fn)\n\nrun(host='localhost', port=8080, debug=True)\n```\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/161/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/161/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/117", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/117/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/117/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/117/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/117", "id": 37876959, "node_id": "MDU6SXNzdWUzNzg3Njk1OQ==", "number": 117, "title": "HTTP GET + compress=True = 501", "user": {"login": "a-urth", "id": 3456803, "node_id": "MDQ6VXNlcjM0NTY4MDM=", "avatar_url": "https://avatars.githubusercontent.com/u/3456803?v=4", "gravatar_id": "", "url": "https://api.github.com/users/a-urth", "html_url": "https://github.com/a-urth", "followers_url": "https://api.github.com/users/a-urth/followers", "following_url": "https://api.github.com/users/a-urth/following{/other_user}", "gists_url": "https://api.github.com/users/a-urth/gists{/gist_id}", "starred_url": "https://api.github.com/users/a-urth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/a-urth/subscriptions", "organizations_url": "https://api.github.com/users/a-urth/orgs", "repos_url": "https://api.github.com/users/a-urth/repos", "events_url": "https://api.github.com/users/a-urth/events{/privacy}", "received_events_url": "https://api.github.com/users/a-urth/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2014-07-15T12:22:27Z", "updated_at": "2019-10-29T00:01:42Z", "closed_at": "2016-06-03T18:59:31Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "There are some strange behavior with proxies. Trying to do HTTP GET request, requests package gives correct result, asyncio - 501.\n\nResponse headers:\nSERVER - squid/3.1.4\nMIME-VERSION - 1.0\nDATE - Mon, 14 Jul 2014 20:20:15 GMT\nCONTENT-TYPE - text/html\nCONTENT-LENGTH - 3136\nX-SQUID-ERROR - ERR_UNSUP_REQ 0\nVIA - 1.0 host (squid/3.1.4)\n\nProxy - 173.234.226.20:8800\n\nSeems that GET method for such proxy is incorrect, even if request done through http.\nAny suggestions?\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/117/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/117/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/114", "repository_url": "https://api.github.com/repos/aio-libs/aiohttp", "labels_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/114/labels{/name}", "comments_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/114/comments", "events_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/114/events", "html_url": "https://github.com/aio-libs/aiohttp/issues/114", "id": 37474200, "node_id": "MDU6SXNzdWUzNzQ3NDIwMA==", "number": 114, "title": "Exception with MultiDict in POST request", "user": {"login": "pepijndevos", "id": 168609, "node_id": "MDQ6VXNlcjE2ODYwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/168609?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pepijndevos", "html_url": "https://github.com/pepijndevos", "followers_url": "https://api.github.com/users/pepijndevos/followers", "following_url": "https://api.github.com/users/pepijndevos/following{/other_user}", "gists_url": "https://api.github.com/users/pepijndevos/gists{/gist_id}", "starred_url": "https://api.github.com/users/pepijndevos/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pepijndevos/subscriptions", "organizations_url": "https://api.github.com/users/pepijndevos/orgs", "repos_url": "https://api.github.com/users/pepijndevos/repos", "events_url": "https://api.github.com/users/pepijndevos/events{/privacy}", "received_events_url": "https://api.github.com/users/pepijndevos/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 58986075, "node_id": "MDU6TGFiZWw1ODk4NjA3NQ==", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1641804445, "node_id": "MDU6TGFiZWwxNjQxODA0NDQ1", "url": "https://api.github.com/repos/aio-libs/aiohttp/labels/outdated", "name": "outdated", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": {"login": "fafhrd91", "id": 598990, "node_id": "MDQ6VXNlcjU5ODk5MA==", "avatar_url": "https://avatars.githubusercontent.com/u/598990?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fafhrd91", "html_url": "https://github.com/fafhrd91", "followers_url": "https://api.github.com/users/fafhrd91/followers", "following_url": "https://api.github.com/users/fafhrd91/following{/other_user}", "gists_url": "https://api.github.com/users/fafhrd91/gists{/gist_id}", "starred_url": "https://api.github.com/users/fafhrd91/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fafhrd91/subscriptions", "organizations_url": "https://api.github.com/users/fafhrd91/orgs", "repos_url": "https://api.github.com/users/fafhrd91/repos", "events_url": "https://api.github.com/users/fafhrd91/events{/privacy}", "received_events_url": "https://api.github.com/users/fafhrd91/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "fafhrd91", "id": 598990, "node_id": "MDQ6VXNlcjU5ODk5MA==", "avatar_url": "https://avatars.githubusercontent.com/u/598990?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fafhrd91", "html_url": "https://github.com/fafhrd91", "followers_url": "https://api.github.com/users/fafhrd91/followers", "following_url": "https://api.github.com/users/fafhrd91/following{/other_user}", "gists_url": "https://api.github.com/users/fafhrd91/gists{/gist_id}", "starred_url": "https://api.github.com/users/fafhrd91/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fafhrd91/subscriptions", "organizations_url": "https://api.github.com/users/fafhrd91/orgs", "repos_url": "https://api.github.com/users/fafhrd91/repos", "events_url": "https://api.github.com/users/fafhrd91/events{/privacy}", "received_events_url": "https://api.github.com/users/fafhrd91/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 5, "created_at": "2014-07-09T15:02:06Z", "updated_at": "2019-10-29T22:01:47Z", "closed_at": "2014-07-10T18:02:22Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "I'm trying to POST mutliple values with the same name with aiohttp, but get the following exception:\n\n```\nTraceback (most recent call last):\n  File \"bug.py\", line 7, in <module>\n    loop.run_until_complete(aiohttp.request('POST', \"http://httpbin.org/post\", data=d))\n  File \"/usr/lib64/python3.4/asyncio/base_events.py\", line 208, in run_until_complete\n    return future.result()\n  File \"/usr/lib64/python3.4/asyncio/futures.py\", line 243, in result\n    raise self._exception\n  File \"/usr/lib64/python3.4/asyncio/tasks.py\", line 317, in _step\n    result = coro.throw(exc)\n  File \"/home/pepijn/code/eppserver/env/lib/python3.4/site-packages/aiohttp/client.py\", line 111, in request\n    yield from resp.start(conn, read_until_eof)\n  File \"/home/pepijn/code/eppserver/env/lib/python3.4/site-packages/aiohttp/client.py\", line 604, in start\n    self.message = yield from httpstream.read()\n  File \"/home/pepijn/code/eppserver/env/lib/python3.4/site-packages/aiohttp/streams.py\", line 366, in read\n    return (yield from super().read())\n  File \"/home/pepijn/code/eppserver/env/lib/python3.4/site-packages/aiohttp/streams.py\", line 341, in read\n    yield from self._waiter\n  File \"/usr/lib64/python3.4/asyncio/futures.py\", line 348, in __iter__\n    yield self  # This tells Task to wait for completion.\n  File \"/usr/lib64/python3.4/asyncio/tasks.py\", line 370, in _wakeup\n    value = future.result()\n  File \"/usr/lib64/python3.4/asyncio/futures.py\", line 243, in result\n    raise self._exception\n  File \"/home/pepijn/code/eppserver/env/lib/python3.4/site-packages/aiohttp/client.py\", line 496, in write_bytes\n    request.write(chunk)\n  File \"/home/pepijn/code/eppserver/env/lib/python3.4/site-packages/aiohttp/protocol.py\", line 666, in write\n    chunk is EOF_MARKER), chunk\nAssertionError: a\n```\n\nExample code:\n\n``` python\nimport asyncio\nimport aiohttp\nfrom aiohttp.multidict import MultiDict\n\nloop = asyncio.get_event_loop()\nd = MultiDict([('a', 'b'), ('a', 'c')])\nloop.run_until_complete(aiohttp.request('POST', \"http://httpbin.org/post\", data=d))\n```\n", "reactions": {"url": "https://api.github.com/repos/aio-libs/aiohttp/issues/114/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aio-libs/aiohttp/issues/114/timeline", "performed_via_github_app": null, "state_reason": "completed"}]