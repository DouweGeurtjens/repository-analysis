[{"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/3086", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/3086/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/3086/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/3086/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/3086", "id": 1655234536, "node_id": "I_kwDOBTx5m85iqN_o", "number": 3086, "title": "All admin users' roles have been removed", "user": {"login": "dasantonym", "id": 566883, "node_id": "MDQ6VXNlcjU2Njg4Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/566883?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dasantonym", "html_url": "https://github.com/dasantonym", "followers_url": "https://api.github.com/users/dasantonym/followers", "following_url": "https://api.github.com/users/dasantonym/following{/other_user}", "gists_url": "https://api.github.com/users/dasantonym/gists{/gist_id}", "starred_url": "https://api.github.com/users/dasantonym/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dasantonym/subscriptions", "organizations_url": "https://api.github.com/users/dasantonym/orgs", "repos_url": "https://api.github.com/users/dasantonym/repos", "events_url": "https://api.github.com/users/dasantonym/events{/privacy}", "received_events_url": "https://api.github.com/users/dasantonym/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 14, "created_at": "2023-04-05T08:58:58Z", "updated_at": "2023-04-05T14:21:11Z", "closed_at": "2023-04-05T14:00:27Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n\r\nThe system removed all admin roles for each user that was previously an admin. Now nobody can administer the server anymore. This was already flaky before and sometimes the admin roles came back after a hub restart, but this is no longer the case.\r\n\r\n#### Expected behaviour\r\n\r\nUser `akoch` (also set in the config file under admin users) logs in, log file says:\r\n\r\n```\r\n[I 2023-04-05 08:27:15.702 JupyterHub generic:185] Validating if user claim groups match any of ['staff', 'student']\r\n[I 2023-04-05 08:27:15.710 JupyterHub roles:257] Removing role admin for User: akoch\r\n[I 2023-04-05 08:27:15.720 JupyterHub base:819] User logged in: akoch\r\n```\r\n\r\nUser `admin` logs in:\r\n\r\n```\r\n[I 2023-04-05 08:34:39.882 JupyterHub generic:185] Validating if user claim groups match any of ['staff', 'student']\r\n[I 2023-04-05 08:34:39.889 JupyterHub roles:238] Adding role user for User: admin\r\n[I 2023-04-05 08:34:39.899 JupyterHub base:819] User logged in: admin\r\n```\r\n\r\nSeems that the admin had their role removed earlier.\r\n\r\n#### Actual behaviour\r\n\r\nAdmins listed as admin users in the config under `hub.config.Authenticator.admin_users` (we're using Zero2Jupyterhub) stay admins.\r\n\r\n### How to reproduce\r\n\r\nI am not sure how to reproduce this as we experienced this quite randomly. One thing is that we just recently upgraded the Helm Chart installation from app version 2.x to 3.1.1. There is a new RBAC system in place and maybe the migration went wrong? Before the upgrade we regularly lost admin roles but after a restart of the Hub deployment they usually came back, which is no longer the case.\r\n\r\nSince we are using the OAuth authenticator, does there need to be something configured in the users' claims coming from Keycloak?\r\n\r\n### Your personal set up\r\n\r\nWe're using zero-to-jupyterhub chart version `jupyterhub-2.0.1-0.dev.git.6026.h0e7347d7`.\r\n\r\n - OS: n.a.\r\n - Version(s): Jupyterhub 3.1.1\r\n\r\nWe are using the SQLite DB, if that is of any relevance here. I can also attach the configuration, but we don't have any special things set up except for the external authentication and the admin_users listing.\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/3086/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/3086/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/3032", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/3032/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/3032/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/3032/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/3032", "id": 1589372698, "node_id": "PR_kwDOBTx5m85KOCZR", "number": 3032, "title": "Fix bugs related to installing chart multiple times in the same namespace", "user": {"login": "HoseonRyu", "id": 31889783, "node_id": "MDQ6VXNlcjMxODg5Nzgz", "avatar_url": "https://avatars.githubusercontent.com/u/31889783?v=4", "gravatar_id": "", "url": "https://api.github.com/users/HoseonRyu", "html_url": "https://github.com/HoseonRyu", "followers_url": "https://api.github.com/users/HoseonRyu/followers", "following_url": "https://api.github.com/users/HoseonRyu/following{/other_user}", "gists_url": "https://api.github.com/users/HoseonRyu/gists{/gist_id}", "starred_url": "https://api.github.com/users/HoseonRyu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/HoseonRyu/subscriptions", "organizations_url": "https://api.github.com/users/HoseonRyu/orgs", "repos_url": "https://api.github.com/users/HoseonRyu/repos", "events_url": "https://api.github.com/users/HoseonRyu/events{/privacy}", "received_events_url": "https://api.github.com/users/HoseonRyu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-02-17T13:39:47Z", "updated_at": "2023-03-15T11:41:52Z", "closed_at": "2023-03-15T11:41:49Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/3032", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/3032", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/3032.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/3032.patch", "merged_at": "2023-03-15T11:41:49Z"}, "body": "## Goals\r\nI wanna create multi-hub for many users.\r\nI'm trying to use an alias for this, and found out that it is supported with following PR.\r\n[fix: bug if z2jh is used as a dependency with an alias](https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2310)\r\n\r\nHowever, I found some problems with it, and made this PR to fix it.\r\n\r\n## Environments\r\n- jupyterhub version: 2.0.0\r\n- app version: 3.0.0\r\n\r\n## Problem 1 - existing-secret\r\nLike this [PR](https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2310), `existing-secret` should also be in the conditional statement.\r\n\r\n## Problem 2 - proxy service selector\r\nAfter solving Problem 1, I succeeded in creating two hubs (each have different urls in `ingress.hosts`)\r\nThere is a bug that when spawning through one url, it randomly spawns in another hub\r\nWhen I spawn singleuser via one url, other hub spawns randomly.\r\nTo prevent this, a selector was added to the proxy.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/3032/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/3032/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/3016", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/3016/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/3016/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/3016/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/3016", "id": 1574847435, "node_id": "I_kwDOBTx5m85d3kPL", "number": 3016, "title": "Chart Version 2.0.0 deployment includes vulnerable Version of Git", "user": {"login": "tobydp", "id": 61120049, "node_id": "MDQ6VXNlcjYxMTIwMDQ5", "avatar_url": "https://avatars.githubusercontent.com/u/61120049?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tobydp", "html_url": "https://github.com/tobydp", "followers_url": "https://api.github.com/users/tobydp/followers", "following_url": "https://api.github.com/users/tobydp/following{/other_user}", "gists_url": "https://api.github.com/users/tobydp/gists{/gist_id}", "starred_url": "https://api.github.com/users/tobydp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tobydp/subscriptions", "organizations_url": "https://api.github.com/users/tobydp/orgs", "repos_url": "https://api.github.com/users/tobydp/repos", "events_url": "https://api.github.com/users/tobydp/events{/privacy}", "received_events_url": "https://api.github.com/users/tobydp/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2023-02-07T17:11:35Z", "updated_at": "2023-02-27T13:49:12Z", "closed_at": "2023-02-27T13:49:12Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\n\r\nGit project released new versions to address a pair of security vulnerabilities, [CVE-2022-41903](https://github.com/git/git/security/advisories/GHSA-475x-2q3q-hvwq), and [CVE-2022-23521](https://github.com/git/git/security/advisories/GHSA-c738-c5qq-xg89), that affect versions 2.39 and older.\r\n\r\nSecurity scans show that with the deployment currently used here, a vulnerable version ends up in the Cluster. \r\n\r\nPlease Update the Chart to a newer Version. \r\n\r\n#### Expected behaviour\r\n\r\nNo vulnerable version is delivered.\r\n\r\n#### Actual behaviour\r\n\r\nAffect version is delivered. \r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/3016/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/3016/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/3001", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/3001/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/3001/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/3001/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/3001", "id": 1555185159, "node_id": "I_kwDOBTx5m85csj4H", "number": 3001, "title": "singleuser.image.name does nothing?", "user": {"login": "DylanAlloy", "id": 12659763, "node_id": "MDQ6VXNlcjEyNjU5NzYz", "avatar_url": "https://avatars.githubusercontent.com/u/12659763?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DylanAlloy", "html_url": "https://github.com/DylanAlloy", "followers_url": "https://api.github.com/users/DylanAlloy/followers", "following_url": "https://api.github.com/users/DylanAlloy/following{/other_user}", "gists_url": "https://api.github.com/users/DylanAlloy/gists{/gist_id}", "starred_url": "https://api.github.com/users/DylanAlloy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DylanAlloy/subscriptions", "organizations_url": "https://api.github.com/users/DylanAlloy/orgs", "repos_url": "https://api.github.com/users/DylanAlloy/repos", "events_url": "https://api.github.com/users/DylanAlloy/events{/privacy}", "received_events_url": "https://api.github.com/users/DylanAlloy/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2023-01-24T15:22:00Z", "updated_at": "2023-01-25T13:29:23Z", "closed_at": "2023-01-25T13:29:23Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n\r\nIf I fill out a secret's worth of metadata in \r\n\r\n```\r\nimagePullSecret:\r\n  create: true\r\n  registry: \r\n  email:\r\n  username: \"\"\r\n  password: \"\"\r\n```\r\n\r\nand adding an image from a private repository to the singleuser block:\r\n\r\n```\r\nimage:\r\n    name: private/private/jupyter-single-user\r\n    tag: \"latest\"\r\n    pullPolicy: \"Always\"\r\n    pullSecrets: \"image-pull-secret\"\r\n```\r\n\r\nI can redeploy my changes yet the `hub` secret still contains a values.yaml key where in the value is this:\r\n\r\n![Screen Shot 2023-01-24 at 8 28 12 AM](https://user-images.githubusercontent.com/12659763/214328696-a4ec047f-94df-4de7-86cf-6ce96555c3b7.png)\r\n\r\n#### Expected behaviour\r\n\r\nThought by changing my `imagePullSecret` chunk and by referencing a different image in my values.yaml that when logging in as a user in the hub UI, it would spin up the image I newly configured and referenced, so long as I had upgraded the deployment before hand with `helm upgrade`\r\n\r\n#### Actual behaviour\r\n\r\nNothing seems to change at all. No secret is added per https://z2jh.jupyter.org/en/latest/resources/reference.html#imagepullsecret\r\n\r\nAnd the repo I reference in my singleuser.image block has no effect on the configuration files provisioned \r\n\r\n### How to reproduce\r\n\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\n1. Add metadata to `imagePullSecret` correlated to a private docker registry, set `imagePullSecret.create` to `true`\r\n2. Change `singleuser.image.name`, `singleuser.image.tag`, `singleuser.image.pullPolicy` to values correlated to your desired image (which should already be present in the above registry)\r\n3. Upgrade the helm deployment\r\n4. Attempt to log in & assess the image used by `continuous-image-puller`\r\n5. (optional) check the `hub` Secret, or the DaemonSet manifest for `continuous-image-puller` to see that your changes have not taken any effect\r\n6. (optional) see that no Secret was generated even though you have filled out `imagePullSecret`\r\n\r\n### Your personal set up\r\n\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n\r\n - OS:\r\n Kubernetes\r\n - Version(s):\r\nv1.20.15\r\n\r\nzero-to-jupyterhub\r\n\r\n<details><summary>Full environment</summary>\r\nJust using your helm chart with a custom yaml on Kubernetes 1.20.15 with Argo attached to a git repo, the only changes I have made to the values/config are described herein.\r\n\r\n</details>\r\n\r\n<details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\ndefault `jupyterhub_config.py` in the helm chart\r\n\r\n</details>\r\n\r\n<details><summary>Logs</summary>\r\n\r\nLoading /usr/local/etc/jupyterhub/secret/values.yaml \r\nNo config at /usr/local/etc/jupyterhub/existing-secret/values.yaml \r\n[I 2023-01-24 13:17:34.236 JupyterHub app:2775] Running JupyterHub version 3.0.0 \r\n[I 2023-01-24 13:17:34.236 JupyterHub app:2805] Using Authenticator: jupyterhub.auth.DummyAuthenticator-3.0.0 \r\n[I 2023-01-24 13:17:34.236 JupyterHub app:2805] Using Spawner: kubespawner.spawner.KubeSpawner-4.2.0 \r\n[I 2023-01-24 13:17:34.237 JupyterHub app:2805] Using Proxy: jupyterhub.proxy.ConfigurableHTTPProxy-3.0.0 \r\n[I 2023-01-24 13:17:34.254 alembic.runtime.migration migration:204] Context impl SQLiteImpl. \r\n[I 2023-01-24 13:17:34.254 alembic.runtime.migration migration:207] Will assume non-transactional DDL. \r\n[I 2023-01-24 13:17:34.261 alembic.runtime.migration migration:618] Running stamp_revision  -> 651f5419b74d \r\n[I 2023-01-24 13:17:34.273 alembic.runtime.migration migration:204] Context impl SQLiteImpl. \r\n[I 2023-01-24 13:17:34.273 alembic.runtime.migration migration:207] Will assume non-transactional DDL. \r\n[I 2023-01-24 13:17:34.400 JupyterHub roles:173] Role jupyterhub-idle-culler added to database \r\n[I 2023-01-24 13:17:34.405 JupyterHub app:1934] Not using allowed_users. Any authenticated user will be allowed. \r\n[I 2023-01-24 13:17:34.454 JupyterHub app:2844] Initialized 0 spawners in 0.002 seconds \r\n[I 2023-01-24 13:17:34.456 JupyterHub app:3057] Not starting proxy \r\n[W 2023-01-24 13:17:35.498 JupyterHub proxy:903] api_request to the proxy failed with status code 599, retrying... \r\n[W 2023-01-24 13:17:36.714 JupyterHub proxy:903] api_request to the proxy failed with status code 599, retrying... \r\n[I 2023-01-24 13:17:37.933 JupyterHub app:3093] Hub API listening on http://:8081/hub/ \r\n[I 2023-01-24 13:17:37.933 JupyterHub app:3095] Private Hub API connect url http://hub:8081/hub/ \r\n[I 2023-01-24 13:17:37.933 JupyterHub app:3104] Starting managed service jupyterhub-idle-culler \r\n[I 2023-01-24 13:17:37.933 JupyterHub service:385] Starting service 'jupyterhub-idle-culler': ['python3', '-m', 'jupyterhub_idle_culler', '--url=http://localhost:8081/hub/api', '--timeout=3600', '--cull-every=600', '--concurrency=10'] \r\n[I 2023-01-24 13:17:37.935 JupyterHub service:133] Spawning python3 -m jupyterhub_idle_culler --url=http://localhost:8081/hub/api --timeout=3600 --cull-every=600 --concurrency=10 \r\n[I 2023-01-24 13:17:37.941 JupyterHub proxy:480] Adding route for Hub: / => http://hub:8081 \r\n[I 2023-01-24 13:17:37.943 JupyterHub app:3162] JupyterHub is now running, internal Hub API at http://hub:8081/hub/ \r\n[I 2023-01-24 13:17:38.054 JupyterHub log:186] 200 GET /hub/api/ (jupyterhub-idle-culler@127.0.0.1) 11.22ms \r\n[I 2023-01-24 13:17:38.062 JupyterHub log:186] 200 GET /hub/api/users?state=[secret] (jupyterhub-idle-culler@127.0.0.1) 7.21ms \r\n[I 2023-01-24 13:17:53.674 JupyterHub log:186] 302 GET / -> /hub/ (@165.237.152.143) 0.71ms \r\n[W 2023-01-24 13:17:53.730 JupyterHub base:387] Invalid or expired cookie token \r\n[I 2023-01-24 13:17:53.731 JupyterHub log:186] 302 GET /hub/ -> /hub/login?next=%2Fhub%2F (@165.237.152.143) 1.04ms \r\n[I 2023-01-24 13:17:53.811 JupyterHub log:186] 200 GET /hub/login?next=%2Fhub%2F (@165.237.152.143) 24.25ms \r\n[I 2023-01-24 13:18:00.196 JupyterHub roles:238] Adding role user for User: dylan \r\n[I 2023-01-24 13:18:00.214 JupyterHub base:810] User logged in: dylan \r\n[I 2023-01-24 13:18:00.214 JupyterHub log:186] 302 POST /hub/login?next=%2Fhub%2F -> /hub/ (dylan@165.237.152.143) 27.35ms \r\n[I 2023-01-24 13:18:00.295 JupyterHub log:186] 302 GET /hub/ -> /hub/spawn (dylan@165.237.152.143) 15.97ms \r\n[I 2023-01-24 13:18:00.310 JupyterHub reflector:274] watching for pods with label selector='component=singleuser-server' in namespace argo-spark \r\n[I 2023-01-24 13:18:00.343 JupyterHub reflector:274] watching for events with field selector='involvedObject.kind=Pod' in namespace argo-spark \r\n[I 2023-01-24 13:18:00.375 JupyterHub provider:651] Creating oauth client jupyterhub-user-dylan \r\n[I 2023-01-24 13:18:00.396 JupyterHub spawner:2509] Attempting to create pvc claim-dylan, with timeout 3 \r\n[I 2023-01-24 13:18:00.399 JupyterHub log:186] 302 GET /hub/spawn -> /hub/spawn-pending/dylan (dylan@165.237.152.143) 41.61ms \r\n[I 2023-01-24 13:18:00.470 JupyterHub pages:394] dylan is pending spawn \r\n[I 2023-01-24 13:18:00.473 JupyterHub log:186] 200 GET /hub/spawn-pending/dylan (dylan@165.237.152.143) 5.59ms \r\n[I 2023-01-24 13:18:00.473 JupyterHub spawner:2525] PVC claim-dylan already exists, so did not create new pvc. \r\n[I 2023-01-24 13:18:00.478 JupyterHub spawner:2469] Attempting to create pod jupyter-dylan, with timeout 3 \r\n[W 2023-01-24 13:18:00.559 JupyterHub base:89] Blocking Cross Origin API request.  Referer: https://jupyterhub.wst.k8s.qa.infra.spctrm.net/hub/spawn-pending/dylan, Host: jupyterhub.wst.k8s.qa.infra.spctrm.net, Host URL: http://jupyterhub.wst.k8s.qa.infra.spctrm.net/hub/ \r\n[W 2023-01-24 13:18:00.559 JupyterHub scopes:804] Not authorizing access to /hub/api/users/dylan/server/progress. Requires any of [read:servers], not derived from scopes [] \r\n[W 2023-01-24 13:18:00.559 JupyterHub web:1796] 403 GET /hub/api/users/dylan/server/progress (165.237.152.143): Action is not authorized with current scopes; requires any of [read:servers] \r\n[W 2023-01-24 13:18:00.560 JupyterHub log:186] 403 GET /hub/api/users/dylan/server/progress (@165.237.152.143) 2.38ms \r\n[I 2023-01-24 13:18:04.248 JupyterHub log:186] 200 GET /hub/api (@100.50.10.174) 0.79ms \r\n[I 2023-01-24 13:18:04.273 JupyterHub log:186] 200 POST /hub/api/users/dylan/activity (dylan@100.50.10.174) 15.94ms \r\n[I 2023-01-24 13:18:05.346 JupyterHub base:963] User dylan took 4.987 seconds to start \r\n[I 2023-01-24 13:18:05.347 JupyterHub proxy:333] Adding user dylan to proxy /user/dylan/ => http://100.50.10.174:8888 \r\n[I 2023-01-24 13:18:11.246 JupyterHub login:44] User logged out: dylan \r\n[I 2023-01-24 13:18:11.249 JupyterHub log:186] 302 GET /hub/logout -> /hub/login (@165.237.152.143) 5.20ms \r\n[I 2023-01-24 13:18:11.308 JupyterHub log:186] 200 GET /hub/login (@165.237.152.143) 1.41ms \r\n[W 2023-01-24 13:18:35.337 JupyterHub base:1127] User dylan server stopped, with exit code: 1 \r\n[I 2023-01-24 13:18:35.337 JupyterHub proxy:359] Removing user dylan from proxy (/user/dylan/) \r\n[I 2023-01-24 13:27:38.150 JupyterHub log:186] 200 GET /hub/api/ (jupyterhub-idle-culler@127.0.0.1) 14.56ms \r\n[I 2023-01-24 13:27:38.157 JupyterHub log:186] 200 GET /hub/api/users?state=[secret] (jupyterhub-idle-culler@127.0.0.1) 5.15ms \r\n[I 2023-01-24 13:37:38.152 JupyterHub log:186] 200 GET /hub/api/ (jupyterhub-idle-culler@127.0.0.1) 15.76ms \r\n[I 2023-01-24 13:37:38.158 JupyterHub log:186] 200 GET /hub/api/users?state=[secret] (jupyterhub-idle-culler@127.0.0.1) 5.18ms \r\n[I 2023-01-24 13:47:38.137 JupyterHub log:186] 200 GET /hub/api/ (jupyterhub-idle-culler@127.0.0.1) 15.53ms \r\n[I 2023-01-24 13:47:38.144 JupyterHub log:186] 200 GET /hub/api/users?state=[secret] (jupyterhub-idle-culler@127.0.0.1) 5.49ms \r\n[I 2023-01-24 13:57:38.104 JupyterHub log:186] 200 GET /hub/api/ (jupyterhub-idle-culler@127.0.0.1) 15.07ms \r\n[I 2023-01-24 13:57:38.111 JupyterHub log:186] 200 GET /hub/api/users?state=[secret] (jupyterhub-idle-culler@127.0.0.1) 5.44ms \r\n[I 2023-01-24 14:07:38.135 JupyterHub log:186] 200 GET /hub/api/ (jupyterhub-idle-culler@127.0.0.1) 14.96ms \r\n[I 2023-01-24 14:07:38.142 JupyterHub log:186] 200 GET /hub/api/users?state=[secret] (jupyterhub-idle-culler@127.0.0.1) 5.07ms \r\n[I 2023-01-24 14:10:48.918 JupyterHub log:186] 302 GET / -> /hub/ (@165.237.152.143) 0.72ms \r\n[I 2023-01-24 14:10:48.981 JupyterHub log:186] 302 GET /hub/ -> /hub/login?next=%2Fhub%2F (@165.237.152.143) 0.61ms \r\n[I 2023-01-24 14:10:49.052 JupyterHub log:186] 200 GET /hub/login?next=%2Fhub%2F (@165.237.152.143) 1.62ms \r\n[I 2023-01-24 14:10:52.859 JupyterHub base:810] User logged in: dylan \r\n[I 2023-01-24 14:10:52.859 JupyterHub log:186] 302 POST /hub/login?next=%2Fhub%2F -> /hub/ (dylan@165.237.152.143) 15.13ms \r\n[I 2023-01-24 14:10:52.929 JupyterHub log:186] 302 GET /hub/ -> /hub/spawn (dylan@165.237.152.143) 10.43ms \r\n[I 2023-01-24 14:10:53.004 JupyterHub provider:651] Creating oauth client jupyterhub-user-dylan \r\n[I 2023-01-24 14:10:53.024 JupyterHub spawner:2509] Attempting to create pvc claim-dylan, with timeout 3 \r\n[I 2023-01-24 14:10:53.026 JupyterHub log:186] 302 GET /hub/spawn -> /hub/spawn-pending/dylan (dylan@165.237.152.143) 37.26ms \r\n[I 2023-01-24 14:10:53.069 JupyterHub spawner:2525] PVC claim-dylan already exists, so did not create new pvc. \r\n[I 2023-01-24 14:10:53.074 JupyterHub spawner:2469] Attempting to create pod jupyter-dylan, with timeout 3 \r\n[I 2023-01-24 14:10:53.114 JupyterHub pages:394] dylan is pending spawn \r\n[I 2023-01-24 14:10:53.115 JupyterHub log:186] 200 GET /hub/spawn-pending/dylan (dylan@165.237.152.143) 3.70ms \r\n[W 2023-01-24 14:10:53.187 JupyterHub base:89] Blocking Cross Origin API request.  Referer: https://jupyterhub.wst.k8s.qa.infra.spctrm.net/hub/spawn-pending/dylan, Host: jupyterhub.wst.k8s.qa.infra.spctrm.net, Host URL: http://jupyterhub.wst.k8s.qa.infra.spctrm.net/hub/ \r\n[W 2023-01-24 14:10:53.187 JupyterHub scopes:804] Not authorizing access to /hub/api/users/dylan/server/progress. Requires any of [read:servers], not derived from scopes [] \r\n[W 2023-01-24 14:10:53.187 JupyterHub web:1796] 403 GET /hub/api/users/dylan/server/progress (165.237.152.143): Action is not authorized with current scopes; requires any of [read:servers] \r\n[W 2023-01-24 14:10:53.188 JupyterHub log:186] 403 GET /hub/api/users/dylan/server/progress (@165.237.152.143) 1.68ms \r\n[I 2023-01-24 14:10:53.922 JupyterHub pages:394] dylan is pending spawn \r\n[I 2023-01-24 14:10:53.923 JupyterHub log:186] 200 GET /hub/spawn-pending/dylan (dylan@165.237.152.143) 2.66ms \r\n[W 2023-01-24 14:10:53.992 JupyterHub base:89] Blocking Cross Origin API request.  Referer: https://jupyterhub.wst.k8s.qa.infra.spctrm.net/hub/spawn-pending/dylan, Host: jupyterhub.wst.k8s.qa.infra.spctrm.net, Host URL: http://jupyterhub.wst.k8s.qa.infra.spctrm.net/hub/ \r\n[W 2023-01-24 14:10:53.992 JupyterHub scopes:804] Not authorizing access to /hub/api/users/dylan/server/progress. Requires any of [read:servers], not derived from scopes [] \r\n[W 2023-01-24 14:10:53.992 JupyterHub web:1796] 403 GET /hub/api/users/dylan/server/progress (165.237.152.143): Action is not authorized with current scopes; requires any of [read:servers] \r\n[W 2023-01-24 14:10:53.993 JupyterHub log:186] 403 GET /hub/api/users/dylan/server/progress (@165.237.152.143) 1.79ms \r\n[I 2023-01-24 14:10:55.521 JupyterHub pages:394] dylan is pending spawn \r\n[I 2023-01-24 14:10:55.522 JupyterHub log:186] 200 GET /hub/spawn-pending/dylan (dylan@165.237.152.143) 2.60ms \r\n[W 2023-01-24 14:10:55.593 JupyterHub base:89] Blocking Cross Origin API request.  Referer: https://jupyterhub.wst.k8s.qa.infra.spctrm.net/hub/spawn-pending/dylan, Host: jupyterhub.wst.k8s.qa.infra.spctrm.net, Host URL: http://jupyterhub.wst.k8s.qa.infra.spctrm.net/hub/ \r\n[W 2023-01-24 14:10:55.593 JupyterHub scopes:804] Not authorizing access to /hub/api/users/dylan/server/progress. Requires any of [read:servers], not derived from scopes [] \r\n[W 2023-01-24 14:10:55.593 JupyterHub web:1796] 403 GET /hub/api/users/dylan/server/progress (165.237.152.143): Action is not authorized with current scopes; requires any of [read:servers] \r\n[W 2023-01-24 14:10:55.593 JupyterHub log:186] 403 GET /hub/api/users/dylan/server/progress (@165.237.152.143) 1.99ms \r\n[I 2023-01-24 14:10:55.983 JupyterHub log:186] 200 GET /hub/api (@100.50.10.175) 0.72ms \r\n[I 2023-01-24 14:10:56.008 JupyterHub log:186] 200 POST /hub/api/users/dylan/activity (dylan@100.50.10.175) 15.41ms \r\n[I 2023-01-24 14:10:56.295 JupyterHub pages:394] dylan is pending spawn \r\n[I 2023-01-24 14:10:56.295 JupyterHub log:186] 200 GET /hub/spawn-pending/dylan (dylan@165.237.152.143) 3.16ms \r\n[W 2023-01-24 14:10:56.367 JupyterHub base:89] Blocking Cross Origin API request.  Referer: https://jupyterhub.wst.k8s.qa.infra.spctrm.net/hub/spawn-pending/dylan, Host: jupyterhub.wst.k8s.qa.infra.spctrm.net, Host URL: http://jupyterhub.wst.k8s.qa.infra.spctrm.net/hub/ \r\n[W 2023-01-24 14:10:56.368 JupyterHub scopes:804] Not authorizing access to /hub/api/users/dylan/server/progress. Requires any of [read:servers], not derived from scopes [] \r\n[W 2023-01-24 14:10:56.368 JupyterHub web:1796] 403 GET /hub/api/users/dylan/server/progress (165.237.152.143): Action is not authorized with current scopes; requires any of [read:servers] \r\n[W 2023-01-24 14:10:56.368 JupyterHub log:186] 403 GET /hub/api/users/dylan/server/progress (@165.237.152.143) 1.62ms \r\n[I 2023-01-24 14:10:57.079 JupyterHub pages:394] dylan is pending spawn \r\n[I 2023-01-24 14:10:57.080 JupyterHub log:186] 200 GET /hub/spawn-pending/dylan (dylan@165.237.152.143) 2.80ms \r\n[W 2023-01-24 14:10:57.152 JupyterHub base:89] Blocking Cross Origin API request.  Referer: https://jupyterhub.wst.k8s.qa.infra.spctrm.net/hub/spawn-pending/dylan, Host: jupyterhub.wst.k8s.qa.infra.spctrm.net, Host URL: http://jupyterhub.wst.k8s.qa.infra.spctrm.net/hub/ \r\n[W 2023-01-24 14:10:57.153 JupyterHub scopes:804] Not authorizing access to /hub/api/users/dylan/server/progress. Requires any of [read:servers], not derived from scopes [] \r\n[W 2023-01-24 14:10:57.153 JupyterHub web:1796] 403 GET /hub/api/users/dylan/server/progress (165.237.152.143): Action is not authorized with current scopes; requires any of [read:servers] \r\n[W 2023-01-24 14:10:57.153 JupyterHub log:186] 403 GET /hub/api/users/dylan/server/progress (@165.237.152.143) 2.06ms \r\n[I 2023-01-24 14:10:58.713 JupyterHub pages:394] dylan is pending spawn \r\n[I 2023-01-24 14:10:58.715 JupyterHub log:186] 200 GET /hub/spawn-pending/dylan (dylan@165.237.152.143) 2.94ms \r\n[W 2023-01-24 14:10:58.782 JupyterHub base:89] Blocking Cross Origin API request.  Referer: https://jupyterhub.wst.k8s.qa.infra.spctrm.net/hub/spawn-pending/dylan, Host: jupyterhub.wst.k8s.qa.infra.spctrm.net, Host URL: http://jupyterhub.wst.k8s.qa.infra.spctrm.net/hub/ \r\n[W 2023-01-24 14:10:58.782 JupyterHub scopes:804] Not authorizing access to /hub/api/users/dylan/server/progress. Requires any of [read:servers], not derived from scopes [] \r\n[W 2023-01-24 14:10:58.782 JupyterHub web:1796] 403 GET /hub/api/users/dylan/server/progress (165.237.152.143): Action is not authorized with current scopes; requires any of [read:servers] \r\n[W 2023-01-24 14:10:58.783 JupyterHub log:186] 403 GET /hub/api/users/dylan/server/progress (@165.237.152.143) 1.87ms \r\n[I 2023-01-24 14:10:59.997 JupyterHub base:963] User dylan took 7.005 seconds to start \r\n[I 2023-01-24 14:10:59.997 JupyterHub proxy:333] Adding user dylan to proxy /user/dylan/ => http://100.50.10.175:8888 \r\n[I 2023-01-24 14:11:02.261 JupyterHub log:186] 302 GET /hub/spawn-pending/dylan -> /user/dylan/ (dylan@165.237.152.143) 3.22ms \r\n[W 2023-01-24 14:11:02.464 JupyterHub auth:298] Service Server at /user/dylan/ requested scopes access:servers!user=dylan,read:users:name!user,read:users:groups!user,access:servers!server=dylan/ for user dylan, granting only read:users:name!user,read:users:groups!user,access:servers!server=dylan/. \r\n[I 2023-01-24 14:11:02.474 JupyterHub log:186] 302 GET /hub/api/oauth2/authorize?client_id=jupyterhub-user-dylan&redirect_uri=%2Fuser%2Fdylan%2Foauth_callback&response_type=code&state=[secret] -> /user/dylan/oauth_callback?code=[secret]&state=[secret] (dylan@165.237.152.143) 15.15ms \r\n[I 2023-01-24 14:11:02.564 JupyterHub log:186] 200 POST /hub/api/oauth2/token (dylan@100.50.10.175) 23.08ms \r\n[I 2023-01-24 14:11:02.574 JupyterHub log:186] 200 GET /hub/api/user (dylan@100.50.10.175) 7.97ms \r\n[I 2023-01-24 14:15:34.469 JupyterHub log:186] 200 POST /hub/api/users/dylan/activity (dylan@100.50.10.175) 18.61ms \r\n[I 2023-01-24 14:16:06.970 JupyterHub log:186] 200 GET /hub/api/user (dylan@100.50.10.175) 10.25ms \r\n[I 2023-01-24 14:17:38.139 JupyterHub log:186] 200 GET /hub/api/ (jupyterhub-idle-culler@127.0.0.1) 7.03ms \r\n[I 2023-01-24 14:17:38.144 JupyterHub log:186] 200 GET /hub/api/users?state=[secret] (jupyterhub-idle-culler@127.0.0.1) 3.79ms \r\n[I 2023-01-24 14:20:29.666 JupyterHub log:186] 200 POST /hub/api/users/dylan/activity (dylan@100.50.10.175) 17.86ms \r\n[I 2023-01-24 14:22:32.645 JupyterHub log:186] 200 GET /hub/api/user (dylan@100.50.10.175) 9.94ms \r\n[I 2023-01-24 14:25:07.233 JupyterHub log:186] 200 POST /hub/api/users/dylan/activity (dylan@100.50.10.175) 10.37ms \r\n[I 2023-01-24 14:27:38.132 JupyterHub log:186] 200 GET /hub/api/ (jupyterhub-idle-culler@127.0.0.1) 8.14ms \r\n[I 2023-01-24 14:27:38.137 JupyterHub log:186] 200 GET /hub/api/users?state=[secret] (jupyterhub-idle-culler@127.0.0.1) 3.60ms \r\n[I 2023-01-24 14:30:01.078 JupyterHub log:186] 200 POST /hub/api/users/dylan/activity (dylan@100.50.10.175) 10.22ms \r\n[I 2023-01-24 14:35:15.210 JupyterHub log:186] 200 POST /hub/api/users/dylan/activity (dylan@100.50.10.175) 11.17ms \r\n[I 2023-01-24 14:37:38.144 JupyterHub log:186] 200 GET /hub/api/ (jupyterhub-idle-culler@127.0.0.1) 7.47ms \r\n[I 2023-01-24 14:37:38.148 JupyterHub log:186] 200 GET /hub/api/users?state=[secret] (jupyterhub-idle-culler@127.0.0.1) 3.48ms \r\n[I 2023-01-24 14:40:37.487 JupyterHub log:186] 200 POST /hub/api/users/dylan/activity (dylan@100.50.10.175) 13.01ms \r\n[I 2023-01-24 14:46:03.780 JupyterHub log:186] 200 POST /hub/api/users/dylan/activity (dylan@100.50.10.175) 11.54ms \r\n[I 2023-01-24 14:47:38.119 JupyterHub log:186] 200 GET /hub/api/ (jupyterhub-idle-culler@127.0.0.1) 8.63ms \r\n[I 2023-01-24 14:47:38.125 JupyterHub log:186] 200 GET /hub/api/users?state=[secret] (jupyterhub-idle-culler@127.0.0.1) 4.03ms \r\n[I 2023-01-24 14:51:22.296 JupyterHub log:186] 200 POST /hub/api/users/dylan/activity (dylan@100.50.10.175) 10.63ms \r\n[I 2023-01-24 14:56:17.262 JupyterHub log:186] 200 POST /hub/api/users/dylan/activity (dylan@100.50.10.175) 10.63ms \r\n[I 2023-01-24 14:57:38.143 JupyterHub log:186] 200 GET /hub/api/ (jupyterhub-idle-culler@127.0.0.1) 7.69ms \r\n[I 2023-01-24 14:57:38.148 JupyterHub log:186] 200 GET /hub/api/users?state=[secret] (jupyterhub-idle-culler@127.0.0.1) 3.77ms \r\n[I 2023-01-24 14:57:49.688 JupyterHub log:186] 200 GET /hub/api/user (dylan@100.50.10.175) 8.61ms \r\n[I 2023-01-24 15:01:04.845 JupyterHub log:186] 200 POST /hub/api/users/dylan/activity (dylan@100.50.10.175) 12.01ms \r\n[I 2023-01-24 15:06:10.496 JupyterHub log:186] 200 POST /hub/api/users/dylan/activity (dylan@100.50.10.175) 10.56ms \r\n[I 2023-01-24 15:07:38.123 JupyterHub log:186] 200 GET /hub/api/ (jupyterhub-idle-culler@127.0.0.1) 7.73ms \r\n[I 2023-01-24 15:07:38.128 JupyterHub log:186] 200 GET /hub/api/users?state=[secret] (jupyterhub-idle-culler@127.0.0.1) 3.78ms \r\n[I 2023-01-24 15:11:29.806 JupyterHub log:186] 200 POST /hub/api/users/dylan/activity (dylan@100.50.10.175) 10.65ms \r\n[I 2023-01-24 15:16:34.911 JupyterHub log:186] 200 POST /hub/api/users/dylan/activity (dylan@100.50.10.175) 11.93ms \r\n[I 2023-01-24 15:17:38.145 JupyterHub log:186] 200 GET /hub/api/ (jupyterhub-idle-culler@127.0.0.1) 8.60ms \r\n[I 2023-01-24 15:17:38.150 JupyterHub log:186] 200 GET /hub/api/users?state=[secret] (jupyterhub-idle-culler@127.0.0.1) 3.82ms \r\n[W 2023-01-24 15:21:29.994 JupyterHub base:1127] User dylan server stopped, with exit code: 1 \r\n[I 2023-01-24 15:21:29.994 JupyterHub proxy:359] Removing user dylan from proxy (/user/dylan/) \r\n\r\n\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/3001/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/3001/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2977", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2977/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2977/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2977/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2977", "id": 1495328761, "node_id": "I_kwDOBTx5m85ZIOf5", "number": 2977, "title": "Cannot use generic ephemeral volume in extraVolumes", "user": {"login": "jpolchlo", "id": 18410961, "node_id": "MDQ6VXNlcjE4NDEwOTYx", "avatar_url": "https://avatars.githubusercontent.com/u/18410961?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jpolchlo", "html_url": "https://github.com/jpolchlo", "followers_url": "https://api.github.com/users/jpolchlo/followers", "following_url": "https://api.github.com/users/jpolchlo/following{/other_user}", "gists_url": "https://api.github.com/users/jpolchlo/gists{/gist_id}", "starred_url": "https://api.github.com/users/jpolchlo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jpolchlo/subscriptions", "organizations_url": "https://api.github.com/users/jpolchlo/orgs", "repos_url": "https://api.github.com/users/jpolchlo/repos", "events_url": "https://api.github.com/users/jpolchlo/events{/privacy}", "received_events_url": "https://api.github.com/users/jpolchlo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2022-12-13T23:34:49Z", "updated_at": "2022-12-14T16:42:44Z", "closed_at": "2022-12-14T16:42:43Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\nI am attempting to use `singleuser.storage.extraVolumes` and `extraVolumeMounts` to create a scratch volume on the singleuser pod.  Documentation [suggests](https://z2jh.jupyter.org/en/latest/resources/reference.html#singleuser-storage-extravolumes) that I should be able to use normal k8s syntax for creating this volume, so I am using the [syntax for a generic ephemeral volume](https://kubernetes.io/docs/concepts/storage/ephemeral-volumes/#generic-ephemeral-volumes) as follows:\r\n```yaml\r\n  storage:\r\n    extraVolumeMounts:\r\n      - mountPath: \"/scratch\"\r\n        name: scratch-volume\r\n    extraVolumes:\r\n      - name: scratch-volume\r\n        ephemeral:\r\n          volumeClaimTemplate:\r\n            metadata:\r\n              labels:\r\n                type: jupyter-singleuser-scratch\r\n            spec:\r\n              accessModes: [\"ReadWriteOnce\"]\r\n              storageClassName: gp2\r\n              volumeMode: Filesystem\r\n              resources:\r\n                requests:\r\n                  storage: 256Gi\r\n```\r\n\r\n#### Expected behaviour\r\n\r\n<!-- Tell us what you thought would happen. -->\r\nI would expect this setup to create a generic ephemeral volume.\r\n\r\n#### Actual behaviour\r\n\r\n<!-- Tell us what actually happens. -->\r\nIn the logs, I then observe the following error:\r\n```\r\n      File \"/usr/local/lib/python3.8/dist-packages/kubespawner/spawner.py\", line 1867, in get_pod_manifest\r\n        return make_pod(\r\n      File \"/usr/local/lib/python3.8/dist-packages/kubespawner/objects.py\", line 571, in make_pod\r\n        pod.spec.volumes = [get_k8s_model(V1Volume, obj) for obj in volumes]\r\n      File \"/usr/local/lib/python3.8/dist-packages/kubespawner/objects.py\", line 571, in <listcomp>\r\n        pod.spec.volumes = [get_k8s_model(V1Volume, obj) for obj in volumes]\r\n      File \"/usr/local/lib/python3.8/dist-packages/kubespawner/utils.py\", line 94, in get_k8s_model\r\n        model_dict = _map_dict_keys_to_model_attributes(model_type, model_dict)\r\n      File \"/usr/local/lib/python3.8/dist-packages/kubespawner/utils.py\", line 132, in _map_dict_keys_to_model_attributes\r\n        new_dict[_get_k8s_model_attribute(model_type, key)] = value\r\n      File \"/usr/local/lib/python3.8/dist-packages/kubespawner/utils.py\", line 184, in _get_k8s_model_attribute\r\n        raise ValueError(\r\n    ValueError: 'V1Volume' did not have an attribute matching 'ephemeral'\r\n```\r\n### How to reproduce\r\n\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\nAdd the above YAML to the JupyterHub chart values.\r\n\r\n### Your personal set up\r\n\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\nThis is deployed on EKS using the Helm chart with the extra volume configurations given above.\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2977/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2977/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2957", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2957/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2957/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2957/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2957", "id": 1463090324, "node_id": "I_kwDOBTx5m85XNPyU", "number": 2957, "title": "503 Sevice unavailable when a second user log in the system.", "user": {"login": "Francesko90", "id": 6740590, "node_id": "MDQ6VXNlcjY3NDA1OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/6740590?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Francesko90", "html_url": "https://github.com/Francesko90", "followers_url": "https://api.github.com/users/Francesko90/followers", "following_url": "https://api.github.com/users/Francesko90/following{/other_user}", "gists_url": "https://api.github.com/users/Francesko90/gists{/gist_id}", "starred_url": "https://api.github.com/users/Francesko90/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Francesko90/subscriptions", "organizations_url": "https://api.github.com/users/Francesko90/orgs", "repos_url": "https://api.github.com/users/Francesko90/repos", "events_url": "https://api.github.com/users/Francesko90/events{/privacy}", "received_events_url": "https://api.github.com/users/Francesko90/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-11-24T10:07:08Z", "updated_at": "2022-12-19T16:37:46Z", "closed_at": "2022-12-19T16:37:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\n\r\nSevice unavailable when a second user log in the system.\r\n\r\n#### Expected behaviour\r\n\r\nAll users can be use jupyterhub at the same time.\r\n\r\n#### Actual behaviour\r\n\r\nHello guys! Thanks for your works! I used jupyterhub in the past without this problem, now I deployed jupyterhub 2.0.0 on k3s v1.24.6+k3s1 and I have the following problem. The login of first user works without problem but when a second user spawn his pod the first user receive this error\r\n\r\n![image](https://user-images.githubusercontent.com/6740590/203753900-99cd9f27-8b68-4b41-8ba8-e8c674398a9b.png)\r\n \r\nAnd if try to refresh page \r\n\r\n![image](https://user-images.githubusercontent.com/6740590/203754075-6583cf5c-debd-4da1-a244-9e481370f9a9.png)\r\n\r\nThe pods are up and running for the all users.\r\n\r\n### Your personal set up\r\n```\r\nhub:\r\n  db:\r\n    type: sqlite-memory\r\n  config:\r\n    JupyterHub:\r\n      authenticator_class: ldapauthenticator.LDAPAuthenticator\r\n    LDAPAuthenticator:\r\n      bind_dn_template:\r\n        - cn={username},ou=users,dc=organization,dc=com\r\n      server_address: ldap.organization.com\r\nsingleuser:\r\n  image:\r\n    pullPolicy: \"Always\"\r\n    pullSecrets:\r\n      - \"image-pull-secret\"\r\n  profileList:\r\n    - display_name: \"name\"\r\n      description: \"description\r\n      kubespawner_override:\r\n        image: <my_image_that_Extend_ jupyterhub/k8s-singleuser-sample:2.0.0>\r\n#ingress:\r\n#  enabled: false\r\n#  ingressClassName: traefik\r\n\r\nproxy:\r\n  service:\r\n    nodePorts:\r\n      http: 30000\r\n```\r\n\r\nKubernets: k3s v1.24.6 with containerd\r\nOS:Almalinux\r\nStorageClass: NFS\r\n\r\n\r\nI tried with ingress and nodeport but I have the same error\r\n\r\n\r\n### Log description\r\n\r\nFirst user is fcaronte\r\nSecond user is mrossi\r\n\r\nAt the first spawn of mrossi the pod is corecctly spawned but the hub don't see the pod\r\n\r\nLogs\r\n\r\n- [hub-5b7694c496-rctsq.log](https://github.com/jupyterhub/zero-to-jupyterhub-k8s/files/10083319/hub-5b7694c496-rctsq.log)\r\n- [jupyter-fcaronte.log](https://github.com/jupyterhub/zero-to-jupyterhub-k8s/files/10083320/jupyter-fcaronte.log)\r\n- [jupyter-mrossi.log](https://github.com/jupyterhub/zero-to-jupyterhub-k8s/files/10083321/jupyter-mrossi.log)", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2957/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2957/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2950", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2950/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2950/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2950/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2950", "id": 1453321870, "node_id": "I_kwDOBTx5m85Wn-6O", "number": 2950, "title": "Parameter \"singleuser.defaultUrl\" not working", "user": {"login": "AdrianSanchezLopez", "id": 24246627, "node_id": "MDQ6VXNlcjI0MjQ2NjI3", "avatar_url": "https://avatars.githubusercontent.com/u/24246627?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AdrianSanchezLopez", "html_url": "https://github.com/AdrianSanchezLopez", "followers_url": "https://api.github.com/users/AdrianSanchezLopez/followers", "following_url": "https://api.github.com/users/AdrianSanchezLopez/following{/other_user}", "gists_url": "https://api.github.com/users/AdrianSanchezLopez/gists{/gist_id}", "starred_url": "https://api.github.com/users/AdrianSanchezLopez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AdrianSanchezLopez/subscriptions", "organizations_url": "https://api.github.com/users/AdrianSanchezLopez/orgs", "repos_url": "https://api.github.com/users/AdrianSanchezLopez/repos", "events_url": "https://api.github.com/users/AdrianSanchezLopez/events{/privacy}", "received_events_url": "https://api.github.com/users/AdrianSanchezLopez/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-11-17T13:10:47Z", "updated_at": "2022-11-17T14:32:28Z", "closed_at": "2022-11-17T14:32:28Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\n\r\nWith the lastest version of the Helm chart 2.0.0, the parameter \"singleuser.defaultUrl\" does not work. Setting it to \"/lab\" previously redirected the single-user servers to JupyterLab, now it opens the regular jupyter notebook\r\n\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\n\r\n#### Expected behaviour\r\n\r\nRedirect the user's address to /lab when setting `singleuser.defaultUrl: \"/lab\"`\r\n\r\n#### Actual behaviour\r\n\r\nIt does not redirect to /lab, but instead to \"/tree\", the regular jupyter notebook\r\n\r\n### How to reproduce\r\n\r\n\r\n1. Deploy helm chart 1.2 with `singleuser.defaultUrl: \"/lab\"`\r\n2. Start a User server: it gets redirected to \"/lab\"\r\n3. Deploy helm chart 2.0.0 with `singleuser.defaultUrl: \"/lab\"`\r\n4. Start a User server: it gets redirected to \"tree\"\r\n\r\n### Your personal set up\r\n\r\nTested with minikube version: v1.24.0\r\nkubectl version\r\n```\r\nClient Version: version.Info{Major:\"1\", Minor:\"22\", GitVersion:\"v1.22.4\", GitCommit:\"b695d79d4f967c403a96986f1750a35eb75e75f1\", GitTreeState:\"clean\", BuildDate:\"2021-11-17T15:48:33Z\", GoVersion:\"go1.16.10\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"22\", GitVersion:\"v1.22.3\", GitCommit:\"c92036820499fedefec0f847e2054d824aea6cd1\", GitTreeState:\"clean\", BuildDate:\"2021-10-27T18:35:25Z\", GoVersion:\"go1.16.9\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2950/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2950/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2928", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2928/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2928/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2928/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2928", "id": 1436979191, "node_id": "I_kwDOBTx5m85Vpo_3", "number": 2928, "title": "publish workflow can't push to `jupyterhub/k8s-hub-slim`", "user": {"login": "manics", "id": 1644105, "node_id": "MDQ6VXNlcjE2NDQxMDU=", "avatar_url": "https://avatars.githubusercontent.com/u/1644105?v=4", "gravatar_id": "", "url": "https://api.github.com/users/manics", "html_url": "https://github.com/manics", "followers_url": "https://api.github.com/users/manics/followers", "following_url": "https://api.github.com/users/manics/following{/other_user}", "gists_url": "https://api.github.com/users/manics/gists{/gist_id}", "starred_url": "https://api.github.com/users/manics/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/manics/subscriptions", "organizations_url": "https://api.github.com/users/manics/orgs", "repos_url": "https://api.github.com/users/manics/repos", "events_url": "https://api.github.com/users/manics/events{/privacy}", "received_events_url": "https://api.github.com/users/manics/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-11-05T11:31:51Z", "updated_at": "2022-11-05T12:08:14Z", "closed_at": "2022-11-05T12:08:14Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n\r\nI've just merged #2920 from @consideratio but the publish workflow failed. Presumably the repo needs to be created and a token added/updated?\r\nhttps://github.com/jupyterhub/zero-to-jupyterhub-k8s/actions/runs/3399825278", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2928/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2928/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2926", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2926/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2926/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2926/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2926", "id": 1434845871, "node_id": "I_kwDOBTx5m85VhgKv", "number": 2926, "title": "Using the REST API without an API Token", "user": {"login": "wudstrand", "id": 10553702, "node_id": "MDQ6VXNlcjEwNTUzNzAy", "avatar_url": "https://avatars.githubusercontent.com/u/10553702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wudstrand", "html_url": "https://github.com/wudstrand", "followers_url": "https://api.github.com/users/wudstrand/followers", "following_url": "https://api.github.com/users/wudstrand/following{/other_user}", "gists_url": "https://api.github.com/users/wudstrand/gists{/gist_id}", "starred_url": "https://api.github.com/users/wudstrand/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wudstrand/subscriptions", "organizations_url": "https://api.github.com/users/wudstrand/orgs", "repos_url": "https://api.github.com/users/wudstrand/repos", "events_url": "https://api.github.com/users/wudstrand/events{/privacy}", "received_events_url": "https://api.github.com/users/wudstrand/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-11-03T15:21:20Z", "updated_at": "2022-11-03T19:40:24Z", "closed_at": "2022-11-03T18:07:28Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\n\r\nI am trying to use the hubs REST API from a custom UI and wanted to avoid using an API token and instead use the custom keycloak OAuth authenticator I have setup. Currently the authenticator works when using the provided hub UI, but I cannot figure out how to authenticate with it via the REST API. After combing through the documentation, I've only been able to find information on using API keys to authenticate the REST API.   \r\n\r\n#### Expected behavior\r\n\r\nIf the API supports this functionality add documentation describing the flow of API calls needed to authenticate through the REST API. If the API doesn't support this, add in support on the REST API to utilize the configured authenticators to authenticate.\r\n\r\n#### Actual behavior\r\n\r\nCustom authenticator authenticates users correctly when using the provide hub UI, but all requests to the API via postman receive a 4xx error. The API errors are caused because I am not sure how to authenticate via the REST API.\r\n\r\n### How to reproduce\r\n\r\n#### `values-local.yaml`\r\n```yaml\r\nhub:\r\n  config:\r\n    Authenticator:\r\n      enable_auth_state: true\r\n      auto_login: true \r\n    GenericOAuthenticator:\r\n      client_id: <keycloak client_id>\r\n      client_secret: <keycloak client_secret>\r\n      oauth_callback_url: http://localhost:80/hub/oauth_callback\r\n      authorize_url: https://<keycloak_uri>/auth/realms/<realm>/protocol/openid-connect/auth\r\n      token_url: https://<keycloak_uri>/auth/realms/<realm>/protocol/openid-connect/token\r\n      userdata_url: https://<keycloak_uri>/auth/realms/<realm>/protocol/openid-connect/userinfo\r\n      login_service: Keycloak\r\n      username_key: sub\r\n      userdata_params:\r\n        state: state\r\n    JupyterHub:\r\n      authenticator_class: generic-oauth \r\n\r\ndebug:\r\n  enabled: true\r\n```\r\n\r\n1. Create Namespace\r\n```bash\r\nkubectl create namespace jupyterhub\r\n```\r\n\r\n2. Run Helm Chart\r\n```bash\r\nhelm repo add jupyterhub https://jupyterhub.github.io/helm-chart/\r\nhelm repo update\r\nhelm upgrade --install jupyterhub jupyterhub/jupyterhub --cleanup-on-fail --namespace jupyterhub --create-namespace --version=2.0.0 --values values-local.yaml\r\n```\r\n\r\n3. Visit [http://localhost:80](http://localhost:80) and sign-in to see the hub UI authentication work.\r\n\r\n4. Attempt some of the [hub API calls](https://jupyterhub.readthedocs.io/en/stable/reference/rest-api.html) to see 400 error.\r\n\r\n### Your personal set up\r\n\r\n - OS: mac OS\r\n\r\n\r\n<details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```yaml\r\nhub:\r\n  config:\r\n    Authenticator:\r\n      enable_auth_state: true\r\n      auto_login: true \r\n    GenericOAuthenticator:\r\n      client_id: <keycloak client_id>\r\n      client_secret: <keycloak client_secret>\r\n      oauth_callback_url: http://localhost:80/hub/oauth_callback\r\n      authorize_url: https://<keycloak_uri>/auth/realms/<realm>/protocol/openid-connect/auth\r\n      token_url: https://<keycloak_uri>/auth/realms/<realm>/protocol/openid-connect/token\r\n      userdata_url: https://<keycloak_uri>/auth/realms/<realm>/protocol/openid-connect/userinfo\r\n      login_service: Keycloak\r\n      username_key: sub\r\n      userdata_params:\r\n        state: state\r\n    JupyterHub:\r\n      authenticator_class: generic-oauth \r\n\r\ndebug:\r\n  enabled: true\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2926/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2926/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2854", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2854/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2854/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2854/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2854", "id": 1352629012, "node_id": "I_kwDOBTx5m85Qn3sU", "number": 2854, "title": "Server culling along with the PVC in GKE", "user": {"login": "franklin-degirum", "id": 109635789, "node_id": "U_kgDOBojozQ", "avatar_url": "https://avatars.githubusercontent.com/u/109635789?v=4", "gravatar_id": "", "url": "https://api.github.com/users/franklin-degirum", "html_url": "https://github.com/franklin-degirum", "followers_url": "https://api.github.com/users/franklin-degirum/followers", "following_url": "https://api.github.com/users/franklin-degirum/following{/other_user}", "gists_url": "https://api.github.com/users/franklin-degirum/gists{/gist_id}", "starred_url": "https://api.github.com/users/franklin-degirum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/franklin-degirum/subscriptions", "organizations_url": "https://api.github.com/users/franklin-degirum/orgs", "repos_url": "https://api.github.com/users/franklin-degirum/repos", "events_url": "https://api.github.com/users/franklin-degirum/events{/privacy}", "received_events_url": "https://api.github.com/users/franklin-degirum/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-08-26T18:57:01Z", "updated_at": "2022-08-27T15:34:09Z", "closed_at": "2022-08-27T15:34:09Z", "author_association": "NONE", "active_lock_reason": null, "body": "```\r\ncull:\r\n  enabled: true\r\n  users: false # --cull-users\r\n  removeNamedServers: false # --remove-named-servers\r\n  timeout: 3600# --timeout\r\n  every: 1800# --cull-every\r\n  concurrency: 10 # --concurrency\r\n  maxAge: 12 # --max-age\r\n```\r\nI am using this configuration for IDLE-CULLER\r\n\r\nI want my server to shutdown when not active for an hour and when logged back in, it should still have the data inside.\r\n\r\nwhen I recreate the same env without letsencrypt and Auth0, the PVC still is there, but not when they are being used. Any fix or workaround would be great.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2854/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2854/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2848", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2848/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2848/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2848/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2848", "id": 1343674144, "node_id": "I_kwDOBTx5m85QFtcg", "number": 2848, "title": "User pvc storage gets deleted on culling", "user": {"login": "franklin-degirum", "id": 109635789, "node_id": "U_kgDOBojozQ", "avatar_url": "https://avatars.githubusercontent.com/u/109635789?v=4", "gravatar_id": "", "url": "https://api.github.com/users/franklin-degirum", "html_url": "https://github.com/franklin-degirum", "followers_url": "https://api.github.com/users/franklin-degirum/followers", "following_url": "https://api.github.com/users/franklin-degirum/following{/other_user}", "gists_url": "https://api.github.com/users/franklin-degirum/gists{/gist_id}", "starred_url": "https://api.github.com/users/franklin-degirum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/franklin-degirum/subscriptions", "organizations_url": "https://api.github.com/users/franklin-degirum/orgs", "repos_url": "https://api.github.com/users/franklin-degirum/repos", "events_url": "https://api.github.com/users/franklin-degirum/events{/privacy}", "received_events_url": "https://api.github.com/users/franklin-degirum/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2022-08-18T21:37:26Z", "updated_at": "2022-08-31T06:48:56Z", "closed_at": "2022-08-31T06:48:56Z", "author_association": "NONE", "active_lock_reason": null, "body": "How can I retain the user storage every time the server is culled and when they login again they get to access their previous runtime files. I tried looking at the jupyterhub_idle_culler.py but not really much options just to delete the server and not the storage. Would like to know if there is an existing feature or any workaround for it.\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2848/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2848/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2835", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2835/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2835/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2835/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2835", "id": 1336765511, "node_id": "I_kwDOBTx5m85PrWxH", "number": 2835, "title": "Request for support of helm versions lower than 3.5", "user": {"login": "hessmjr", "id": 7245108, "node_id": "MDQ6VXNlcjcyNDUxMDg=", "avatar_url": "https://avatars.githubusercontent.com/u/7245108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hessmjr", "html_url": "https://github.com/hessmjr", "followers_url": "https://api.github.com/users/hessmjr/followers", "following_url": "https://api.github.com/users/hessmjr/following{/other_user}", "gists_url": "https://api.github.com/users/hessmjr/gists{/gist_id}", "starred_url": "https://api.github.com/users/hessmjr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hessmjr/subscriptions", "organizations_url": "https://api.github.com/users/hessmjr/orgs", "repos_url": "https://api.github.com/users/hessmjr/repos", "events_url": "https://api.github.com/users/hessmjr/events{/privacy}", "received_events_url": "https://api.github.com/users/hessmjr/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2022-08-12T05:22:26Z", "updated_at": "2022-08-12T17:46:52Z", "closed_at": "2022-08-12T17:46:52Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n\r\nHelm chart is not backwards compatible due to use of `dig` function in [here](https://github.com/jupyterhub/zero-to-jupyterhub-k8s/blob/main/jupyterhub/templates/hub/_helpers-passwords.tpl#L35).\r\n\r\n#### Expected behaviour\r\n\r\nNot require Helm upgrade beyond 3.5 (currently out of my control but seems strange to require such a late version of Helm in order to utilize latest stable chart.\r\n\r\n#### Actual behaviour\r\n\r\nHelm throws an error when parsing values\r\n\r\n```\r\nError: parse error at (jupyterhub/templates/hub/_helpers-passwords.tpl:35): function \"dig\" not defined\r\n```\r\n\r\n### How to reproduce\r\n\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\n1. Have version of Helm before 3.5\r\n2. Run Helm upgrade with Jupyterhub helm chart \r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2835/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2835/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2807", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2807/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2807/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2807/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2807", "id": 1314788751, "node_id": "PR_kwDOBTx5m8478EG4", "number": 2807, "title": "Fix user-scheduler backward compatibility for AWS EKS", "user": {"login": "a3626a", "id": 4434752, "node_id": "MDQ6VXNlcjQ0MzQ3NTI=", "avatar_url": "https://avatars.githubusercontent.com/u/4434752?v=4", "gravatar_id": "", "url": "https://api.github.com/users/a3626a", "html_url": "https://github.com/a3626a", "followers_url": "https://api.github.com/users/a3626a/followers", "following_url": "https://api.github.com/users/a3626a/following{/other_user}", "gists_url": "https://api.github.com/users/a3626a/gists{/gist_id}", "starred_url": "https://api.github.com/users/a3626a/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/a3626a/subscriptions", "organizations_url": "https://api.github.com/users/a3626a/orgs", "repos_url": "https://api.github.com/users/a3626a/repos", "events_url": "https://api.github.com/users/a3626a/events{/privacy}", "received_events_url": "https://api.github.com/users/a3626a/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2022-07-22T09:50:08Z", "updated_at": "2022-07-22T14:29:32Z", "closed_at": "2022-07-22T14:17:14Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2807", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2807", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2807.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2807.patch", "merged_at": "2022-07-22T14:17:14Z"}, "body": "# Introduction\r\n\r\nuser-scheduler support both kubernetes before 1.20 and after 1.21. It is done by helm conditionals `if ge (atoi .Capabilities.KubeVersion.Minor) 21`\r\n\r\n# Problem\r\n\r\n`.Capabilities.KubeVersion.Minor` is not a simple number in AWS EKS environment. It is something like `22+`. So backward compatibility fallback is applied to every kubernetes clusters even if its version is greater than 1.20.\r\n\r\n# Solution\r\n\r\nI suggest simple solution just to replace every `+` signs into empty string `''`. Helm `replace` function can do this.\r\n\r\n# Alternative\r\n\r\n[`semverCompare`](https://helm.sh/docs/chart_template_guide/function_list/#semvercompare) can achieve better result, but I am worried about its unexpected behaviors. It changes things a lot.\r\n\r\n# Appendix\r\nRefer this image for various Helm expression results.\r\n![image](https://user-images.githubusercontent.com/4434752/180410032-4f60e77e-fcc8-437e-81e9-a8bf7eb3b24d.png)\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2807/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2807/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2788", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2788/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2788/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2788/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2788", "id": 1296321635, "node_id": "I_kwDOBTx5m85NRExj", "number": 2788, "title": "linkcheck: changelog.md has several broken links", "user": {"login": "manics", "id": 1644105, "node_id": "MDQ6VXNlcjE2NDQxMDU=", "avatar_url": "https://avatars.githubusercontent.com/u/1644105?v=4", "gravatar_id": "", "url": "https://api.github.com/users/manics", "html_url": "https://github.com/manics", "followers_url": "https://api.github.com/users/manics/followers", "following_url": "https://api.github.com/users/manics/following{/other_user}", "gists_url": "https://api.github.com/users/manics/gists{/gist_id}", "starred_url": "https://api.github.com/users/manics/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/manics/subscriptions", "organizations_url": "https://api.github.com/users/manics/orgs", "repos_url": "https://api.github.com/users/manics/repos", "events_url": "https://api.github.com/users/manics/events{/privacy}", "received_events_url": "https://api.github.com/users/manics/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-07-06T19:55:59Z", "updated_at": "2022-07-12T06:10:18Z", "closed_at": "2022-07-12T06:10:18Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "### Bug description\r\n```\r\ncd docs\r\nmake linkcheck\r\ngrep changelog.md _build/linkcheck/output.txt | grep broken\r\n```\r\n```\r\nchangelog.md:2832: [broken] http://zero-to-jupyterhub.readthedocs.io/en/latest/advanced.html#picking-a-scheduler-strategy: Anchor 'picking-a-scheduler-strategy' not found\r\nchangelog.md:2795: [broken] http://zero-to-jupyterhub.readthedocs.io/en/latest/advanced.html#pre-pulling-images-for-faster-startup: Anchor 'pre-pulling-images-for-faster-startup' not found\r\nchangelog.md:2834: [broken] http://zero-to-jupyterhub.readthedocs.io/en/latest/advanced.html?highlight=prepull#pre-pulling-images-for-faster-startup: Anchor 'pre-pulling-images-for-faster-startup' not found\r\nchangelog.md:2857: [broken] http://zero-to-jupyterhub.readthedocs.io/en/latest/create-k8s-cluster.html#setting-up-kubernetes-on-microsoft-azure-container-service-aks: Anchor 'setting-up-kubernetes-on-microsoft-azure-container-service-aks' not found\r\nchangelog.md:2976: [broken] http://zero-to-jupyterhub.readthedocs.io/en/latest/extending-jupyterhub.html#setting-up-https: Anchor 'setting-up-https' not found\r\nchangelog.md:2871: [broken] http://zero-to-jupyterhub.readthedocs.io/en/latest/user-environment.html#pre-populating-user-s-home-directory-with-files: Anchor 'pre-populating-user-s-home-directory-with-files' not found\r\nchangelog.md:2868: [broken] http://zero-to-jupyterhub.readthedocs.io/en/latest/user-environment.html#use-jupyterlab-by-default: Anchor 'use-jupyterlab-by-default' not found\r\nchangelog.md:1423: [broken] https://docs.helm.sh/helm/#helm-rollback: Anchor 'helm-rollback' not found\r\nchangelog.md:25: [broken] https://jupyterhub.readthedocs.io/en/1.5.0/changelog.html#id1: 404 Client Error: Not Found for url: https://jupyterhub.readthedocs.io/en/1.5.0/changelog.html\r\nchangelog.md:3233: [broken] https://kubernetes.io/docs/concepts/storage/persistent-volumes/#storageclasses: Anchor 'storageclasses' not found\r\nchangelog.md:1436: [broken] https://zero-to-jupyterhub.readthedocs.io/en/latest/user-environment.html?highlight=profile#allow-users-to-create-their-own-conda-environments: Anchor 'allow-users-to-create-their-own-conda-environments' not found\r\n```\r\n\r\n#### Expected behaviour\r\n\r\nNot sure. Do we update the changelog and fix the links, bearing in mind some of the links may not be fixable? Or is it a historic document where we keep the content as it was at the time of release?\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2788/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2788/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2727", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2727/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2727/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2727/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2727", "id": 1251640014, "node_id": "PR_kwDOBTx5m844oOzZ", "number": 2727, "title": "Fix for PDBs in k8s 1.20", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-05-28T14:02:01Z", "updated_at": "2022-06-04T09:54:36Z", "closed_at": "2022-05-29T08:15:59Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2727", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2727", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2727.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2727.patch", "merged_at": "2022-05-29T08:15:59Z"}, "body": "Closes #2649 as reported by @geoffo-dev, where policy/v1 seems to be available in the k8s cluster event though policy/v1 PodDisruptionBudgets only come around in k8s 1.21.\r\n\r\nI was on track to get this done across other repos, and went along and did it also for this repo. The actual work was not making the PR, it was to realize there is a bug like this. Thank you @geoffo-dev!", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2727/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2727/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2681", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2681/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2681/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2681/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2681", "id": 1226507494, "node_id": "PR_kwDOBTx5m843WI2u", "number": 2681, "title": "Enable image-puller pods to evict user-placeholder pods", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-05-05T10:47:49Z", "updated_at": "2022-05-06T20:29:14Z", "closed_at": "2022-05-06T20:29:05Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2681", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2681", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2681.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2681.patch", "merged_at": "2022-05-06T20:29:05Z"}, "body": "I wanted to push a commit to #2574 but wasn't allowed to, due to that I decided to open a new PR built on top of #2574. @a3626a is this okay with you?\r\n\r\nI've rebased @a3626a's commit from #2574 and added another commit with changes I wanted to see.\r\n\r\n## Summary\r\n\r\nThis PR adds another PriorityClass resource that [hook|continuous]-image-puller pods can reference in order to acquire a priority making them considered more important than user placeholder pods but still not more important than normal user pods. In practice, this resolves a bug where we could have too many user placeholder pods to fit a image-puller pod and end up with a node that didn't get their image pre-pulled for users.\r\n\r\nI labelled it as a bugfix, its kind of a new feature as well - intended to fix a bug in behavior.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2681/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2681/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2677", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2677/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2677/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2677/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2677", "id": 1221066838, "node_id": "I_kwDOBTx5m85IyABW", "number": 2677, "title": "Spawn failed: Expected object of type 'dict' (or 'V1Container') but got 'V1Container'.", "user": {"login": "orboan", "id": 7423107, "node_id": "MDQ6VXNlcjc0MjMxMDc=", "avatar_url": "https://avatars.githubusercontent.com/u/7423107?v=4", "gravatar_id": "", "url": "https://api.github.com/users/orboan", "html_url": "https://github.com/orboan", "followers_url": "https://api.github.com/users/orboan/followers", "following_url": "https://api.github.com/users/orboan/following{/other_user}", "gists_url": "https://api.github.com/users/orboan/gists{/gist_id}", "starred_url": "https://api.github.com/users/orboan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/orboan/subscriptions", "organizations_url": "https://api.github.com/users/orboan/orgs", "repos_url": "https://api.github.com/users/orboan/repos", "events_url": "https://api.github.com/users/orboan/events{/privacy}", "received_events_url": "https://api.github.com/users/orboan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-04-29T15:18:17Z", "updated_at": "2022-04-29T15:48:21Z", "closed_at": "2022-04-29T15:46:32Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n\r\nAfter docker image is built using:\r\n\r\n`./zero-to-jupyterhub-k8s/images/hub/Dockerfile`\r\n\r\nfrom the **latest commit** in the main branch.\r\n\r\nAnd after deploying it using next config.yaml:\r\n\r\n```\r\nsingleuser:\r\n.....\r\nhub:\r\n  image:\r\n    name: <image built with the Dockerfile found in the repo>\r\n    tag: x.x.x\r\n  config:\r\n    extraEnv:\r\n      LTI_AUTH_CONSUMER_URL: 'https://mydomain.com'\r\n    security: |\r\n      from kubernetes import client\r\n      def modify_pod_hook(spawner, pod):\r\n        pod.spec.containers[0].security_context = client.V1SecurityContext(\r\n            privileged=True,\r\n            capabilities=client.V1Capabilities(\r\n                add=['SYS_ADMIN']\r\n            )\r\n        )\r\n        return pod\r\n      c.KubeSpawner.modify_pod_hook = modify_pod_hook\r\n      c.JupyterHub.admin_access = True\r\n```\r\n\r\nJupyterhub is loading with no problem (I needed to add `pip install kubernetes` to the Dockerfile, as it is a missing required library), but when spawning the jupyterlab image, I get:\r\n\r\n`Spawn failed: Expected object of type 'dict' (or 'V1Container') but got 'V1Container'.`\r\n\r\nThe command used for deployment is:\r\n\r\n```\r\n#!/bin/bash\r\nRELEASE=jupyterhub\r\nNAMESPACE=hub\r\nVERSION=1.2.0\r\n\r\nhelm upgrade --cleanup-on-fail \\\r\n  --install $RELEASE jupyterhub/jupyterhub \\\r\n  --namespace $NAMESPACE \\\r\n  --create-namespace \\\r\n  --version=$VERSION \\\r\n  --values config.yaml\r\n```\r\n\r\n\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\n\r\n#### Expected behaviour\r\n\r\nThe jupyterlab image spawns properly.\r\n\r\n<!-- Tell us what you thought would happen. -->\r\n\r\nDo not know what could be the cause. This has started to happen after I built a new docker image of jupyterhub from the latest Dockerfile found in the main branch of the repo. And after upgrading from version 1.1.3 to 1.2.0 of the helm chart.\r\n\r\n#### Actual behaviour\r\n\r\nDoes not spawn the jupyterlab image. It shows the error:\r\n\r\n`Spawn failed: Expected object of type 'dict' (or 'V1Container') but got 'V1Container'.`\r\n\r\nThe hub pod logs are next:\r\n\r\n```\r\n[I 2022-04-29 14:46:07.876 JupyterHub provider:607] Creating oauth client jupyterhub-user-jovyan\r\n[I 2022-04-29 14:46:07.899 JupyterHub spawner:2351] Attempting to create pvc claim-jovyan, with timeout 3\r\n[I 2022-04-29 14:46:07.900 JupyterHub log:189] 302 POST /hub/spawn -> /hub/spawn-pending/jovyan (jovyan@::ffff:172.17.0.1) 64.51ms\r\n[I 2022-04-29 14:46:07.908 JupyterHub pages:401] jovyan is pending spawn\r\n[I 2022-04-29 14:46:07.912 JupyterHub log:189] 200 GET /hub/spawn-pending/jovyan (jovyan@::ffff:172.17.0.1) 6.76ms\r\n[I 2022-04-29 14:46:07.913 JupyterHub spawner:2367] PVC claim-jovyan already exists, so did not create new pvc.\r\n[E 2022-04-29 14:46:07.921 JupyterHub user:815] Unhandled error starting jovyan's server: Expected object of type 'dict' (or 'V1Container') but got 'V1Container'.\r\n[E 2022-04-29 14:46:07.951 JupyterHub gen:623] Exception in Future <Task finished name='Task-346' coro=<BaseHandler.spawn_single_user.<locals>.finish_user_spawn() done, defined at /usr/local/lib/python3.8/dist-packages/jupyterhub/handlers/base.py:945> exception=AttributeError(\"Expected object of type 'dict' (or 'V1Container') but got 'V1Container'.\")> after timeout\r\n    Traceback (most recent call last):\r\n      File \"/usr/local/lib/python3.8/dist-packages/tornado/gen.py\", line 618, in error_callback\r\n        future.result()\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/handlers/base.py\", line 952, in finish_user_spawn\r\n        await spawn_future\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/user.py\", line 833, in spawn\r\n        raise e\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/user.py\", line 732, in spawn\r\n        url = await gen.with_timeout(timedelta(seconds=spawner.start_timeout), f)\r\n      File \"/usr/local/lib/python3.8/dist-packages/kubespawner/spawner.py\", line 2499, in _start\r\n        pod = await self.get_pod_manifest()\r\n      File \"/usr/local/lib/python3.8/dist-packages/kubespawner/spawner.py\", line 1875, in get_pod_manifest\r\n        return make_pod(\r\n      File \"/usr/local/lib/python3.8/dist-packages/kubespawner/objects.py\", line 578, in make_pod\r\n        pod.spec.init_containers = [\r\n      File \"/usr/local/lib/python3.8/dist-packages/kubespawner/objects.py\", line 579, in <listcomp>\r\n        get_k8s_model(V1Container, obj) for obj in init_containers\r\n      File \"/usr/local/lib/python3.8/dist-packages/kubespawner/utils.py\", line 98, in get_k8s_model\r\n        raise AttributeError(\r\n    AttributeError: Expected object of type 'dict' (or 'V1Container') but got 'V1Container'.\r\n    \r\n[I 2022-04-29 14:46:07.999 JupyterHub log:189] 200 GET /hub/api/users/jovyan/server/progress (jovyan@::ffff:172.17.0.1) 4.24ms\r\n[I 2022-04-29 14:51:24.367 JupyterHub log:189] 200 GET /hub/api/ (cull-idle@127.0.0.1) 15.38ms\r\n```\r\n\r\n\r\n### How to reproduce\r\n\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\nFollow my explanation above.\r\n\r\n### Your personal set up\r\n\r\nThis is a deployment of jupyterhub in a on-premises kubernetes cluster, built using kubeadm.\r\n\r\n - OS: Ubuntu 20.04\r\n <!-- [e.g. ubuntu 20.04, macOS 11.0] -->\r\n - Version(s):\r\n <!-- e.g. jupyterhub --version, python --version --->\r\n\r\n<details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\n# paste output of `pip freeze` or `conda list` here\r\n```\r\n</details>\r\n\r\n<details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```python\r\n# jupyterhub_config.py\r\n```\r\n</details>\r\n\r\n<details><summary>Logs</summary>\r\n<!--\r\nErrors are often logged by jupytehub. How you get logs depends on your deployment.\r\nWith kubernetes it might be:\r\n\r\n    kubectl get pod # hub pod name starts with hub...\r\n    kubectl logs hub-...\r\n    # or for a single-user server\r\n    kubectl logs jupyter-username\r\n\r\nOr the-littlest-jupyterhub:\r\n\r\n    journalctl -u jupyterhub\r\n    # or for a single-user server\r\n    journalctl -u jupyter-username\r\n-->\r\n\r\n```\r\n# paste relevant logs here, if any\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2677/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2677/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2666", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2666/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2666/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2666/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2666", "id": 1204016743, "node_id": "I_kwDOBTx5m85Hw9Zn", "number": 2666, "title": "Latest image (jupyterhub/k8s-hub:1.1.3-n416.h2541a732) fails with \"ModuleNotFoundError: No module named 'kubernetes\"", "user": {"login": "mohanrajdtv", "id": 92185605, "node_id": "U_kgDOBX6kBQ", "avatar_url": "https://avatars.githubusercontent.com/u/92185605?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mohanrajdtv", "html_url": "https://github.com/mohanrajdtv", "followers_url": "https://api.github.com/users/mohanrajdtv/followers", "following_url": "https://api.github.com/users/mohanrajdtv/following{/other_user}", "gists_url": "https://api.github.com/users/mohanrajdtv/gists{/gist_id}", "starred_url": "https://api.github.com/users/mohanrajdtv/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mohanrajdtv/subscriptions", "organizations_url": "https://api.github.com/users/mohanrajdtv/orgs", "repos_url": "https://api.github.com/users/mohanrajdtv/repos", "events_url": "https://api.github.com/users/mohanrajdtv/events{/privacy}", "received_events_url": "https://api.github.com/users/mohanrajdtv/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 13, "created_at": "2022-04-14T04:12:07Z", "updated_at": "2022-04-15T05:50:25Z", "closed_at": "2022-04-14T05:35:33Z", "author_association": "NONE", "active_lock_reason": null, "body": "\r\n<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\n\r\nUpgrading to latest image jupyterhub/k8s-hub:1.1.3-n416.h2541a732 image fails during startup with error \"ModuleNotFoundError: No module named 'kubernetes'\"\r\n\r\n(https://hub.docker.com/layers/k8s-hub/jupyterhub/k8s-hub/1.1.3-n416.h2541a732/images/sha256-d91df3934a6b87260810c655638c2c33fa08fbb99063e9143ae72bb26bf13c37?context=explore)\r\n\r\n#### Expected behaviour\r\n\r\n<!-- Tell us what you thought would happen. -->\r\n\r\nHub pod should start up\r\n\r\n#### Actual behaviour\r\n\r\n![image](https://user-images.githubusercontent.com/92185605/163311678-70a109e4-4c33-44cd-836b-cf1a5f15e7ac.png)\r\n\r\n<!-- Tell us what actually happens. -->\r\n\r\n### How to reproduce\r\n\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\nWe are deploying in Azure Kubernetes \r\nDeploy hub using the latest image (https://hub.docker.com/layers/k8s-hub/jupyterhub/k8s-hub/1.1.3-n416.h2541a732/images/sha256-d91df3934a6b87260810c655638c2c33fa08fbb99063e9143ae72bb26bf13c37?context=explore)\r\n\r\n1. Go to '...'\r\n2. Click on '....'\r\n3. Scroll down to '....'\r\n4. See error\r\n\r\n### Your personal set up\r\n\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\nzero-to-jupyterhub in azure kubernetes\r\n - OS:\r\n <!-- [e.g. ubuntu 20.04, macOS 11.0] -->\r\n - Version(s):\r\n <!-- e.g. jupyterhub --version, python --version --->\r\nlatest jupyterhub version\r\n\r\n<details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\nn/a\r\n```\r\n# paste output of `pip freeze` or `conda list` here\r\n```\r\n</details>\r\n\r\n<details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\nn/a\r\n```python\r\n# jupyterhub_config.py\r\n```\r\n</details>\r\n\r\n<details><summary>Logs</summary>\r\n<!--\r\nErrors are often logged by jupytehub. How you get logs depends on your deployment.\r\nWith kubernetes it might be:\r\n\r\n    kubectl get pod # hub pod name starts with hub...\r\n    kubectl logs hub-...\r\n    # or for a single-user server\r\n    kubectl logs jupyter-username\r\n\r\nOr the-littlest-jupyterhub:\r\n\r\n    journalctl -u jupyterhub\r\n    # or for a single-user server\r\n    journalctl -u jupyter-username\r\n-->\r\n\r\n![image](https://user-images.githubusercontent.com/92185605/163312005-dc903ac7-14ed-44b6-82f0-37f323fbcca1.png)\r\n\r\n\r\n```\r\n# paste relevant logs here, if any\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2666/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2666/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2658", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2658/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2658/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2658/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2658", "id": 1196505420, "node_id": "I_kwDOBTx5m85HUTlM", "number": 2658, "title": "Helm Additional property ingressClassName is not allowed", "user": {"login": "kempspo", "id": 32265362, "node_id": "MDQ6VXNlcjMyMjY1MzYy", "avatar_url": "https://avatars.githubusercontent.com/u/32265362?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kempspo", "html_url": "https://github.com/kempspo", "followers_url": "https://api.github.com/users/kempspo/followers", "following_url": "https://api.github.com/users/kempspo/following{/other_user}", "gists_url": "https://api.github.com/users/kempspo/gists{/gist_id}", "starred_url": "https://api.github.com/users/kempspo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kempspo/subscriptions", "organizations_url": "https://api.github.com/users/kempspo/orgs", "repos_url": "https://api.github.com/users/kempspo/repos", "events_url": "https://api.github.com/users/kempspo/events{/privacy}", "received_events_url": "https://api.github.com/users/kempspo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-04-07T19:54:45Z", "updated_at": "2022-04-07T21:11:32Z", "closed_at": "2022-04-07T21:11:32Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\n```\r\ningress:\r\n  enabled: true\r\n  ingressClassName: someIngressClass\r\n```\r\nHelm throws the following error when \r\n`Error: UPGRADE FAILED: values don't meet the specifications of the schema(s) in the following chart(s): jupyterhub: - ingress: Additional property ingressClassName is not allowed`\r\n\r\n#### Expected behaviour\r\n\r\nAdding an ingressClass does not throw an error\r\n\r\n#### Actual behaviour\r\n\r\n<!-- Tell us what actually happens. -->\r\n\r\n### How to reproduce\r\n\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\n1. Go to '...'\r\n2. Click on '....'\r\n3. Scroll down to '....'\r\n4. See error\r\n\r\n### Your personal set up\r\n\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n\r\n - OS:\r\n <!-- [e.g. ubuntu 20.04, macOS 11.0] -->\r\n - Version(s):\r\n <!-- e.g. jupyterhub --version, python --version --->\r\n\r\n<details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\n# paste output of `pip freeze` or `conda list` here\r\n```\r\n</details>\r\n\r\n<details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```python\r\n# jupyterhub_config.py\r\n```\r\n</details>\r\n\r\n<details><summary>Logs</summary>\r\n<!--\r\nErrors are often logged by jupytehub. How you get logs depends on your deployment.\r\nWith kubernetes it might be:\r\n\r\n    kubectl get pod # hub pod name starts with hub...\r\n    kubectl logs hub-...\r\n    # or for a single-user server\r\n    kubectl logs jupyter-username\r\n\r\nOr the-littlest-jupyterhub:\r\n\r\n    journalctl -u jupyterhub\r\n    # or for a single-user server\r\n    journalctl -u jupyter-username\r\n-->\r\n\r\n```\r\n# paste relevant logs here, if any\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2658/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2658/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2649", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2649/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2649/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2649/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2649", "id": 1188061115, "node_id": "I_kwDOBTx5m85G0F-7", "number": 2649, "title": "PodDisruptionBudget not using the correct API Version in Kubernetes v1.20", "user": {"login": "geoffo-dev", "id": 53539843, "node_id": "MDQ6VXNlcjUzNTM5ODQz", "avatar_url": "https://avatars.githubusercontent.com/u/53539843?v=4", "gravatar_id": "", "url": "https://api.github.com/users/geoffo-dev", "html_url": "https://github.com/geoffo-dev", "followers_url": "https://api.github.com/users/geoffo-dev/followers", "following_url": "https://api.github.com/users/geoffo-dev/following{/other_user}", "gists_url": "https://api.github.com/users/geoffo-dev/gists{/gist_id}", "starred_url": "https://api.github.com/users/geoffo-dev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/geoffo-dev/subscriptions", "organizations_url": "https://api.github.com/users/geoffo-dev/orgs", "repos_url": "https://api.github.com/users/geoffo-dev/repos", "events_url": "https://api.github.com/users/geoffo-dev/events{/privacy}", "received_events_url": "https://api.github.com/users/geoffo-dev/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 580906362, "node_id": "MDU6TGFiZWw1ODA5MDYzNjI=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/help%20wanted", "name": "help wanted", "color": "0e8a16", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2022-03-31T13:14:08Z", "updated_at": "2023-03-28T14:57:08Z", "closed_at": "2022-05-29T08:15:59Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\nWhen attempting to deploy a helm chart to the cluster, both of the default PDB resources cannot deploy giving the error:\r\n\r\n`server could not find the requested resource`\r\n\r\nHaving a look at the helm chart itself:\r\n\r\nhttps://github.com/jupyterhub/zero-to-jupyterhub-k8s/blob/5c0d0c5c74bc97bf403844ced6b8e79cc089498d/jupyterhub/templates/scheduling/user-scheduler/pdb.yaml#L2 \r\n\r\nIt looks like this is checking if only `policy/v1` exists on the cluster - which I believe it does - however PDB v1 does not. Should this not be `policy/v1/PodDisruptionBudget`? As this does not exist on K8s version 1.20 and therefore would default to `policy/v1beta1`.\r\n\r\nI have tried deploying both versions manually and only `policy/v1beta1` works\r\n\r\n```\r\napiVersion: policy/v1beta1\r\nkind: PodDisruptionBudget\r\nmetadata:\r\n  labels:\r\n    app: jupyterhub\r\n```\r\n\r\n### Your personal set up\r\n - Kubernetes Version:\r\nv1.20\r\n - Version(s):\r\nJupyterhub Helm Chart: 1.2.0\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2649/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2649/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2631", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2631/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2631/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2631/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2631", "id": 1176053319, "node_id": "I_kwDOBTx5m85GGSZH", "number": 2631, "title": "AKS Documentation outdated?", "user": {"login": "AlexChung1995", "id": 14365879, "node_id": "MDQ6VXNlcjE0MzY1ODc5", "avatar_url": "https://avatars.githubusercontent.com/u/14365879?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AlexChung1995", "html_url": "https://github.com/AlexChung1995", "followers_url": "https://api.github.com/users/AlexChung1995/followers", "following_url": "https://api.github.com/users/AlexChung1995/following{/other_user}", "gists_url": "https://api.github.com/users/AlexChung1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/AlexChung1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AlexChung1995/subscriptions", "organizations_url": "https://api.github.com/users/AlexChung1995/orgs", "repos_url": "https://api.github.com/users/AlexChung1995/repos", "events_url": "https://api.github.com/users/AlexChung1995/events{/privacy}", "received_events_url": "https://api.github.com/users/AlexChung1995/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 20, "created_at": "2022-03-21T23:16:06Z", "updated_at": "2022-03-29T06:25:51Z", "closed_at": "2022-03-28T22:04:12Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\n\r\nRecently had to upgrade our running JupyterHub deployment on AKS. Found that the public IP for the existing deployment was no longer accessible from the internet. Have tried to redeploy a completely fresh install, fresh resource group etc. following the documentation. Still unable to access the new public ip.\r\n\r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\n\r\nAccess base jupyterhub image at AKS public IP.\r\n\r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\n\r\nIP address is unavailable, browser times out when trying to access IP.\r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\nFollow documentation for deploying jupyterhub on AKS, navigate to public IP.\r\n\r\n### Your personal set up\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n\r\n - OS:\r\n <!-- [e.g. ubuntu 20.04, macOS 11.0] -->\r\n - Version(s):\r\n <!-- e.g. jupyterhub --version, python --version --->\r\n\r\n- <details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\n# paste output of `pip freeze` or `conda list` here\r\n```\r\n</details>\r\n\r\n- <details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```python\r\n# jupyterhub_config.py\r\n```\r\n</details>\r\n\r\n- <details><summary>Logs</summary>\r\n<!--\r\nErrors are often logged by jupytehub. How you get logs depends on your deployment.\r\nWith kubernetes it might be:\r\n\r\n    kubectl get pod # hub pod name starts with hub...\r\n    kubectl logs hub-...\r\n    # or for a single-user server\r\n    kubectl logs jupyter-username\r\n\r\nOr the-littlest-jupyterhub:\r\n\r\n    journalctl -u jupyterhub\r\n    # or for a single-user server\r\n    journalctl -u jupyter-username\r\n-->\r\n\r\n```\r\n# paste relevant logs here, if any\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2631/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2631/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2628", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2628/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2628/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2628/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2628", "id": 1173765915, "node_id": "PR_kwDOBTx5m840qoYj", "number": 2628, "title": "Fix failure to respect proxy.secretSync.resources configuration", "user": {"login": "jhowton-restor3d", "id": 100805929, "node_id": "U_kgDOBgItKQ", "avatar_url": "https://avatars.githubusercontent.com/u/100805929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhowton-restor3d", "html_url": "https://github.com/jhowton-restor3d", "followers_url": "https://api.github.com/users/jhowton-restor3d/followers", "following_url": "https://api.github.com/users/jhowton-restor3d/following{/other_user}", "gists_url": "https://api.github.com/users/jhowton-restor3d/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhowton-restor3d/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhowton-restor3d/subscriptions", "organizations_url": "https://api.github.com/users/jhowton-restor3d/orgs", "repos_url": "https://api.github.com/users/jhowton-restor3d/repos", "events_url": "https://api.github.com/users/jhowton-restor3d/events{/privacy}", "received_events_url": "https://api.github.com/users/jhowton-restor3d/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-03-18T16:11:29Z", "updated_at": "2022-03-23T09:04:13Z", "closed_at": "2022-03-23T09:04:11Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2628", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2628", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2628.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2628.patch", "merged_at": "2022-03-23T09:04:11Z"}, "body": "The `resources` property was not being set in the secret-sync container configuration. This is a configurable property that is described in the zero-to-jupyterhub configuration docs.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2628/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2628/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2611", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2611/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2611/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2611/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2611", "id": 1164321238, "node_id": "I_kwDOBTx5m85FZiHW", "number": 2611, "title": "AKS says: \"The request did not have a subscription or a valid tenant level resource provider\" ", "user": {"login": "arokem", "id": 118582, "node_id": "MDQ6VXNlcjExODU4Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/118582?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arokem", "html_url": "https://github.com/arokem", "followers_url": "https://api.github.com/users/arokem/followers", "following_url": "https://api.github.com/users/arokem/following{/other_user}", "gists_url": "https://api.github.com/users/arokem/gists{/gist_id}", "starred_url": "https://api.github.com/users/arokem/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arokem/subscriptions", "organizations_url": "https://api.github.com/users/arokem/orgs", "repos_url": "https://api.github.com/users/arokem/repos", "events_url": "https://api.github.com/users/arokem/events{/privacy}", "received_events_url": "https://api.github.com/users/arokem/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 630540373, "node_id": "MDU6TGFiZWw2MzA1NDAzNzM=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/documentation", "name": "documentation", "color": "fef2c0", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-03-09T18:57:44Z", "updated_at": "2023-03-12T13:19:55Z", "closed_at": "2023-03-12T13:19:55Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\nInstructions for setting up on Azure with autoscale do not proceed as expected, possibly due to changes in the Azure CLI/API.\r\n\r\n#### Expected behaviour\r\n\r\nIn https://zero-to-jupyterhub.readthedocs.io/en/latest/kubernetes/microsoft/step-zero-azure-autoscale.html, the step: \r\n\r\n```\r\nSP_PASSWD=$(az ad sp create-for-rbac \\\r\n    --name <SERVICE-PRINCIPAL-NAME> \\\r\n    --role Contributor \\\r\n    --scope $VNET_ID \\\r\n    --query password \\\r\n    --output tsv)\r\n```\r\nShould proceed without error.\r\n\r\n#### Actual behaviour\r\n\r\nThe following response is emitted:\r\n\r\n```\r\nWARNING: The underlying Active Directory Graph API will be replaced by Microsoft Graph API in a future version of Azure CLI. Please carefully review all breaking changes introduced during this migration: https://docs.microsoft.com/cli/azure/microsoft-graph-migration\r\nWARNING: Creating 'Contributor' role assignment under scope 'qsiprep-vnet'\r\nWARNING:   Role assignment creation failed.\r\n\r\nWARNING:   role assignment response headers: {'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'Content-Type': 'application/json; charset=utf-8', 'Expires': '-1', 'x-ms-failure-cause': 'gateway', 'x-ms-request-id': '99c9dc9d-ac27-44e6-8e4f-590d488c4685', 'x-ms-correlation-request-id': '99c9dc9d-ac27-44e6-8e4f-590d488c4685', 'x-ms-routing-request-id': 'WESTUS2:20220309T185210Z:99c9dc9d-ac27-44e6-8e4f-590d488c4685', 'Strict-Transport-Security': 'max-age=31536000; includeSubDomains', 'X-Content-Type-Options': 'nosniff', 'Date': 'Wed, 09 Mar 2022 18:52:10 GMT', 'Content-Length': '135'}\r\n\r\nERROR: The request did not have a subscription or a valid tenant level resource provider.\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2611/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2611/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2603", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2603/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2603/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2603/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2603", "id": 1150909525, "node_id": "PR_kwDOBTx5m84zfQGS", "number": 2603, "title": "Remove typo \" in schema.yaml", "user": {"login": "manics", "id": 1644105, "node_id": "MDQ6VXNlcjE2NDQxMDU=", "avatar_url": "https://avatars.githubusercontent.com/u/1644105?v=4", "gravatar_id": "", "url": "https://api.github.com/users/manics", "html_url": "https://github.com/manics", "followers_url": "https://api.github.com/users/manics/followers", "following_url": "https://api.github.com/users/manics/following{/other_user}", "gists_url": "https://api.github.com/users/manics/gists{/gist_id}", "starred_url": "https://api.github.com/users/manics/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/manics/subscriptions", "organizations_url": "https://api.github.com/users/manics/orgs", "repos_url": "https://api.github.com/users/manics/repos", "events_url": "https://api.github.com/users/manics/events{/privacy}", "received_events_url": "https://api.github.com/users/manics/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-02-25T21:48:33Z", "updated_at": "2022-02-25T22:51:34Z", "closed_at": "2022-02-25T22:46:31Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2603", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2603", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2603.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2603.patch", "merged_at": "2022-02-25T22:46:31Z"}, "body": "The `$schema\"` key has a random `\"`", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2603/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2603/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2601", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2601/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2601/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2601/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2601", "id": 1149248157, "node_id": "I_kwDOBTx5m85EgCKd", "number": 2601, "title": "LetsEncrypt certificate generation failing on basic default z2jh / GKE setup", "user": {"login": "matthew-brett", "id": 67612, "node_id": "MDQ6VXNlcjY3NjEy", "avatar_url": "https://avatars.githubusercontent.com/u/67612?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthew-brett", "html_url": "https://github.com/matthew-brett", "followers_url": "https://api.github.com/users/matthew-brett/followers", "following_url": "https://api.github.com/users/matthew-brett/following{/other_user}", "gists_url": "https://api.github.com/users/matthew-brett/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthew-brett/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthew-brett/subscriptions", "organizations_url": "https://api.github.com/users/matthew-brett/orgs", "repos_url": "https://api.github.com/users/matthew-brett/repos", "events_url": "https://api.github.com/users/matthew-brett/events{/privacy}", "received_events_url": "https://api.github.com/users/matthew-brett/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 34, "created_at": "2022-02-24T12:49:01Z", "updated_at": "2022-07-30T09:17:49Z", "closed_at": "2022-05-16T12:18:32Z", "author_association": "NONE", "active_lock_reason": null, "body": "My JupyterHub / Kubernetes cluster is failing to acquire LetsEncrypt certificates for HTTPS.\r\n\r\nI am working with an absolutely default z2jh / GKE setup generated from copy-paste of the current install instructions at:\r\n\r\n<https://zero-to-jupyterhub.readthedocs.io/en/latest/kubernetes/google/step-zero-gcp.html>\r\n\r\nthen\r\n\r\n<https://zero-to-jupyterhub.readthedocs.io/en/latest/jupyterhub/installation.html>\r\n\r\nfollowed by absolute default LetsEncrypt setup at:\r\n\r\n<https://tljh.jupyter.org/en/latest/howto/admin/https.html>\r\n\r\nThe exact scripts are in <https://github.com/matthew-brett/littlest-jhub-k8s>.   The README shows the steps to set up the cluster, basically just running scripts with the default instructions copy-pasted.\r\n\r\n`config.yaml` is:\r\n\r\n```yaml\r\nproxy:\r\n  service:\r\n    loadBalancerIP: 34.127.108.159\r\n  https:\r\n    enabled: true\r\n    hosts:\r\n      - hub.odsti.org\r\n    letsencrypt:\r\n      contactEmail: matthew.brett@gmail.com\r\n```\r\n\r\nI set the DNS A record about 24 hours ago, and `nslookup hub.odsti.org` goes correctly give me `34.127.108.159`, and has done for more than 12 hours.\r\n\r\nI have not modified the default GKE setup in any way - `gcloud container clusters describe jhub-cluster --zone=us-west1-b` shows me:\r\n\r\n```\r\nnetworkPolicyConfig:\r\n    disabled: true\r\n```\r\n\r\nI have no ingress controller - because I have the default setup, and I have no [readinessProbe](https://zero-to-jupyterhub.readthedocs.io/en/latest/resources/reference.html#hub-readinessprobe) configured.\r\n\r\nI'm using the latest Helm chart at time of writing : `1.1.3-n324.hb93a9b5f`, but have also tried `1.2.0` with the same result.\r\n\r\nWhat I am seeing, is errors in the `autohttps` pod log.\r\n\r\n```\r\nhttps_pod=$(kubectl --namespace=jhub get pods -o custom-columns=POD:metadata.name | grep autohttps-)\r\nkubectl --namespace=jhub logs pod/$https_pod traefik -f\r\n```\r\n\r\ngives:\r\n\r\n```\r\nContext \"gke_nipraxis-jupyterhub_us-west1-b_jhub-cluster\" modified.\r\ntime=\"2022-02-24T12:37:19Z\" level=info msg=\"Configuration loaded from file: /etc/traefik/traefik.yaml\"\r\ntime=\"2022-02-24T12:37:20Z\" level=warning msg=\"No domain found in rule PathPrefix(`/`), the TLS options applied for this router will depend on the hostSNI of each request\" entryPointName=https routerName=default@file\r\ntime=\"2022-02-24T12:37:20Z\" level=warning msg=\"No domain found in rule PathPrefix(`/`), the TLS options applied for this router will depend on the hostSNI of each request\" entryPointName=https routerName=default@file\r\ntime=\"2022-02-24T12:37:37Z\" level=error msg=\"Unable to obtain ACME certificate for domains \\\"hub.odsti.org\\\" : unable to generate a certificate for the domains [hub.odsti.org]: error: one or more domains had a problem:\\n[hub.odsti.org] acme: error: 400 :: urn:ietf:params:acme:error:connection :: Fetching http://hub.odsti.org/.well-known/acme-challenge/zDZVtZBCtd7wqqdzxyHmmxK9wxSElv8AFX0BdqSuP2g: Timeout during connect (likely firewall problem)\\n\" providerName=default.acme\r\n```\r\n\r\nIf I restart the autohttps pod:\r\n\r\n```\r\nkubectl --namespace=jhub delete pods $https_pod\r\n```\r\n\r\nThen get the log for the new pod:\r\n\r\n```\r\nhttps_pod=$(kubectl --namespace=jhub get pods -o custom-columns=POD:metadata.name | grep autohttps-)\r\nkubectl --namespace=jhub logs pod/$https_pod traefik -f\r\n```\r\n\r\nI get:\r\n\r\n```\r\nkubectl --namespace=jhub logs pod/$https_pod traefik -f\r\ntime=\"2022-02-24T12:40:34Z\" level=info msg=\"Configuration loaded from file: /etc/traefik/traefik.yaml\"\r\ntime=\"2022-02-24T12:40:34Z\" level=warning msg=\"No domain found in rule PathPrefix(`/`), the TLS options applied for this router will depend on the hostSNI of each request\" entryPointName=https routerName=default@file\r\ntime=\"2022-02-24T12:40:35Z\" level=warning msg=\"No domain found in rule PathPrefix(`/`), the TLS options applied for this router will depend on the hostSNI of each request\" routerName=default@file entryPointName=https\r\ntime=\"2022-02-24T12:40:44Z\" level=error msg=\"Unable to obtain ACME certificate for domains \\\"hub.odsti.org\\\" : unable to generate a certificate for the domains [hub.odsti.org]: error: one or more domains had a problem:\\n[hub.odsti.org] acme: error: 400 :: urn:ietf:params:acme:error:connection :: Fetching http://hub.odsti.org/.well-known/acme-challenge/lihtvdnVUjObuswoOnhSMKZ7VucdaZ-g_ffcQklznsw: Connection refused\\n\" providerName=default.acme\r\n```\r\n\r\n`kubectl --namespace=jhub get secrets` shows no `proxy-public-tls-acme` secret - see [this thread](https://discourse.jupyter.org/t/trouble-getting-https-letsencrypt-working-with-0-9-0-beta-4/3583/5).\r\n\r\nOnce, or twice, these exact same commands did give a certificate, and HTTPS access, and did not give errors in the log - so this appears to be a race condition of some sort, but I am lost as to how to debug further.\r\n\r\nThere is some discussion of this problem on Gitter, starting at <https://gitter.im/jupyterhub/jupyterhub?at=621654ca0909252318f3d7dc>.\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2601/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2601/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2576", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2576/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2576/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2576/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2576", "id": 1130847497, "node_id": "I_kwDOBTx5m85DZ10J", "number": 2576, "title": "Z2JK v1.2.0: user-placeholder pods and single user pods go into a pending state and are never scheduled on a node in their designated GKE K8s node-pool", "user": {"login": "mcberma", "id": 99424314, "node_id": "U_kgDOBe0YOg", "avatar_url": "https://avatars.githubusercontent.com/u/99424314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mcberma", "html_url": "https://github.com/mcberma", "followers_url": "https://api.github.com/users/mcberma/followers", "following_url": "https://api.github.com/users/mcberma/following{/other_user}", "gists_url": "https://api.github.com/users/mcberma/gists{/gist_id}", "starred_url": "https://api.github.com/users/mcberma/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mcberma/subscriptions", "organizations_url": "https://api.github.com/users/mcberma/orgs", "repos_url": "https://api.github.com/users/mcberma/repos", "events_url": "https://api.github.com/users/mcberma/events{/privacy}", "received_events_url": "https://api.github.com/users/mcberma/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2022-02-10T20:08:41Z", "updated_at": "2022-02-11T03:33:53Z", "closed_at": "2022-02-10T20:20:55Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\nZ2JK v1.2.0: user-placeholder pods and single user pods go into a pending state and are never scheduled on a node in their designated GKE K8s node-pool\r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\nuser-placeholder pods and single user pods are scheduled and in a running state on a node in their designated GKE K8s node-pool\r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\n- Core pods (hub, proxy, image-awaiter) are scheduled and running on a node in their designated GKE K8s node-pool. \r\n- Continuous Image Puller and Hook image Puller are scheduled on all nodes that are labeled and tainted and tainted as user nodes (same node pool where user-placeholder pods and single user pods should be running.)\r\n- User-Placeholder pod is in a perpetual state of Pending and are not scheduled to a node in their designated node-pool -- the same  nodes and node-pool where the Continuous Image Puller and Hook Image Puller are running .  User-Placeholder stateful set is in a perpetual state of \"in-progress\".\r\n- Single User pods go into pending state and are not scheduled to a node in their designated node-pool -- the same  nodes and node-pool where the Continuous Image Puller and Hook Image Puller are running.\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\n- Create GKE cluster with two node-pools -- one node pool for the core pods and another node pool for the user pods. Make sure the two node-pools are tainted with distinct taints that differentiates \"core pods\" nodes and \"user pods\" nodes.  Make sure to create an auto-scaling group for the \"user pods\" node-pool.\r\n- Modify the Z2JK v1.2.0 values.yaml file to create 2 User-Placeholder replicas per \"user pods\" node.\r\n- Modify the Z2JK v1.2.0 values.yaml file (core-pods and user-pods section with the tolerations for the core pods node-pool and the tolerations for the user pods node pool.\r\n- Run the Z2JK v1.2.0 helm chart to deploy Z2JK v1.2.0.\r\n- You should notice that the User-Placeholder pods go into a perpetual pending state without being scheduled on a node.\r\n- Login into Jupyter Hub and launch a user's Jupyter Notebook server (e.g., Single User pod).\r\n- Single User pod goes into a pending state and is not assigned to a node.  It eventually is terminated by Jupyterhub.\r\n### Your personal set up\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n\r\n - OS:\r\n <!-- [e.g. ubuntu 20.04, macOS 11.0] -->\r\n - Version(s):\r\n <!-- e.g. jupyterhub --version, python --version --->\r\n\r\n- <details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\n# paste output of `pip freeze` or `conda list` here\r\n```\r\n</details>\r\n\r\n- <details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```python\r\n# jupyterhub_config.py\r\n```\r\n</details>\r\n\r\n- <details><summary>Logs</summary>\r\n<!--\r\nErrors are often logged by jupytehub. How you get logs depends on your deployment.\r\nWith kubernetes it might be:\r\n\r\n    kubectl get pod # hub pod name starts with hub...\r\n    kubectl logs hub-...\r\n    # or for a single-user server\r\n    kubectl logs jupyter-username\r\n\r\nOr the-littlest-jupyterhub:\r\n\r\n    journalctl -u jupyterhub\r\n    # or for a single-user server\r\n    journalctl -u jupyter-username\r\n-->\r\n\r\n```\r\n# paste relevant logs here, if any\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2576/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2576/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2570", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2570/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2570/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2570/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2570", "id": 1125080956, "node_id": "I_kwDOBTx5m85DD198", "number": 2570, "title": "UPGRADE FAILED: failed to replace object: PersistentVolumeClaim \"hub-db-dir\"", "user": {"login": "snickell", "id": 223277, "node_id": "MDQ6VXNlcjIyMzI3Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/223277?v=4", "gravatar_id": "", "url": "https://api.github.com/users/snickell", "html_url": "https://github.com/snickell", "followers_url": "https://api.github.com/users/snickell/followers", "following_url": "https://api.github.com/users/snickell/following{/other_user}", "gists_url": "https://api.github.com/users/snickell/gists{/gist_id}", "starred_url": "https://api.github.com/users/snickell/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/snickell/subscriptions", "organizations_url": "https://api.github.com/users/snickell/orgs", "repos_url": "https://api.github.com/users/snickell/repos", "events_url": "https://api.github.com/users/snickell/events{/privacy}", "received_events_url": "https://api.github.com/users/snickell/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 14, "created_at": "2022-02-06T01:56:57Z", "updated_at": "2022-06-02T08:07:15Z", "closed_at": "2022-06-02T08:07:14Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Hi! Lately when I try to `helm upgrade myz2jh` my z2jh installation on prod or staging, I'm getting the following error:\r\n```\r\nStep #7: Error: UPGRADE FAILED: failed to replace object: PersistentVolumeClaim \"hub-db-dir\" is invalid: spec: Forbidden: spec is immutable after creation except resources.requests for bound claims\r\nStep #7:   core.PersistentVolumeClaimSpec{\r\nStep #7:   \tAccessModes:      {\"ReadWriteOnce\"},\r\nStep #7:   \tSelector:         nil,\r\nStep #7:   \tResources:        {Requests: {s\"storage\": {i: {...}, s: \"1Gi\", Format: \"BinarySI\"}}},\r\nStep #7: - \tVolumeName:       \"\",\r\nStep #7: + \tVolumeName:       \"pvc-7bffbe5b-3b84-4900-88f9-199cd1ee1148\",\r\nStep #7: - \tStorageClassName: nil,\r\nStep #7: + \tStorageClassName: &\"standard\",\r\nStep #7:   \tVolumeMode:       &\"Filesystem\",\r\nStep #7:   \tDataSource:       nil,\r\nStep #7:   }\r\n```\r\n\r\nI work around it by completely deleting PVC `hub-db-dir`, and then setting its finalizers to null with kubectl patch,  before each upgrade in my deploy now, but of course, that's going to cause *serious* problems! And it comes back before the next deploy.\r\n\r\nMaybe this is an issue with newer helm versions (I have helm == 3.7.1)?", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2570/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2570/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2580", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2580/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2580/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2580/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2580", "id": 1134201878, "node_id": "I_kwDOBTx5m85DmowW", "number": 2580, "title": "Jupyterhub kubernetes deployment does not work with recent versions of nginx reverse proxy", "user": {"login": "brunzefb", "id": 462831, "node_id": "MDQ6VXNlcjQ2MjgzMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/462831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brunzefb", "html_url": "https://github.com/brunzefb", "followers_url": "https://api.github.com/users/brunzefb/followers", "following_url": "https://api.github.com/users/brunzefb/following{/other_user}", "gists_url": "https://api.github.com/users/brunzefb/gists{/gist_id}", "starred_url": "https://api.github.com/users/brunzefb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brunzefb/subscriptions", "organizations_url": "https://api.github.com/users/brunzefb/orgs", "repos_url": "https://api.github.com/users/brunzefb/repos", "events_url": "https://api.github.com/users/brunzefb/events{/privacy}", "received_events_url": "https://api.github.com/users/brunzefb/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 13, "created_at": "2022-02-05T04:10:41Z", "updated_at": "2022-05-16T15:13:17Z", "closed_at": "2022-05-16T15:13:17Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\nWe have a successful installation of Jupyter hub running on Amazon EKS (Kubernetes). We enabled ingress and are running helm chart version 1.6.16 and nginx app version 0.24.1.  Ingress with this setup works fine.  The ELB forward traffic to the nginx reverse proxy, which in turn forwards the traffic to the proxy-http component of Jupyter, life is good.  I then tried to upgrade the version of nginx to a more modern one -- chart version 3.29.0, app version 0.45 (from about March 2021).  After installing, ingress still worked, but you could not run python scripts in notebooks -- failure to connect to kernal.  Reinstalled the hub helm chart -- which resulted in the ingress being broken -- 504 error when you hit the endpoint with the browser.  After wasting a long time trying to configure nginx, I reverted back to the old nginx version, which made everything work again.\r\n\r\n\r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\nI expect jupyterhub to work with modern (LTS) versions of the nginx reverse proxy on k8s.\r\n\r\n#### Actual behaviour\r\nIngress is broken with a recent version of nginx reverse proxy.\r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\nDeploy nginx reverse proxy on your cluster, setting appropriate ingress class.\r\nDeploy jupyterhub, after enabling ingress, specifying the same ingress class as above\r\nAfter a few minutes, hit the endpoint.  You get a 504 error.\r\n\r\n### Your personal set up\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n\r\n - OS:\r\n <!-- [e.g. ubuntu 20.04, macOS 11.0] -->\r\n - Version(s):\r\n <!-- e.g. jupyterhub --version, python --version --->\r\n\r\n- <details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\n# paste output of `pip freeze` or `conda list` here\r\n```\r\n</details>\r\n\r\n- <details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```python\r\n# jupyterhub_config.py\r\n```\r\n</details>\r\n\r\n- <details><summary>Logs</summary>\r\n<!--\r\nErrors are often logged by jupytehub. How you get logs depends on your deployment.\r\nWith kubernetes it might be:\r\n\r\n    kubectl get pod # hub pod name starts with hub...\r\n    kubectl logs hub-...\r\n    # or for a single-user server\r\n    kubectl logs jupyter-username\r\n\r\nOr the-littlest-jupyterhub:\r\n\r\n    journalctl -u jupyterhub\r\n    # or for a single-user server\r\n    journalctl -u jupyter-username\r\n-->\r\n\r\n```\r\n# paste relevant logs here, if any\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2580/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2580/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2565", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2565/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2565/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2565/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2565", "id": 1123423219, "node_id": "I_kwDOBTx5m85C9hPz", "number": 2565, "title": "Kube Proxy unhealthy", "user": {"login": "mateskoo", "id": 87084719, "node_id": "MDQ6VXNlcjg3MDg0NzE5", "avatar_url": "https://avatars.githubusercontent.com/u/87084719?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mateskoo", "html_url": "https://github.com/mateskoo", "followers_url": "https://api.github.com/users/mateskoo/followers", "following_url": "https://api.github.com/users/mateskoo/following{/other_user}", "gists_url": "https://api.github.com/users/mateskoo/gists{/gist_id}", "starred_url": "https://api.github.com/users/mateskoo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mateskoo/subscriptions", "organizations_url": "https://api.github.com/users/mateskoo/orgs", "repos_url": "https://api.github.com/users/mateskoo/repos", "events_url": "https://api.github.com/users/mateskoo/events{/privacy}", "received_events_url": "https://api.github.com/users/mateskoo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2022-02-03T18:31:45Z", "updated_at": "2022-05-15T10:08:11Z", "closed_at": "2022-05-15T10:08:11Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\nReadiness probe failing every few minutes, which causes the GUI to not work properly.\r\n\r\n#### Expected behaviour\r\nGUI (notebooks) works without interuptions.\r\n\r\n### How to reproduce\r\nInstall jupyterhub from the official helm chart, set up persistant storage and try to run the GUI with default proxy values.\r\n\r\n### Your personal set up\r\nI am running kubernetes 1.22, with two nodes (master, worker).\r\nChart version: jupyterhub-1.1.3\r\nApp version: 1.4.2\r\n\r\n - OS:\r\n Oracle Linux 7.9 on both master and workers\r\n - Version(s):\r\nChart version: jupyterhub-1.1.3\r\nApp version: 1.4.2\r\n\r\n- <details><summary>Configuration</summary>\r\nDummyAuthenticator - 2 local users created\r\nhttps enabled with selfsigned certificates\r\n</details>\r\n\r\n- <details><summary>Logs</summary>\r\n```\r\nEvents:\r\n  Type     Reason     Age                   From               Message\r\n  ----     ------     ----                  ----               -------\r\n  Normal   Scheduled  9m24s                 default-scheduler  Successfully assigned jupyter-hub/proxy-58f94b7d59-hmx4s to dcpoth24213058\r\n  Normal   Pulled     9m23s                 kubelet            Container image \"jupyterhub/configurable-http-proxy:4.5.0\" already present on machine\r\n  Normal   Created    9m23s                 kubelet            Created container chp\r\n  Normal   Started    9m23s                 kubelet            Started container chp\r\n  Warning  Unhealthy  5m4s (x3 over 8m39s)  kubelet            Readiness probe failed: Get \"https://10.44.0.2:8443/_chp_healthz\": net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers)\r\n```\r\n</details>\r\n\r\n\r\nI have tried to change the tresholds for the readinessProbe and livenessProbe:\r\n\r\n```\r\nlivenessProbe:\r\n          failureThreshold: 85\r\n          httpGet:\r\n            path: /_chp_healthz\r\n            port: https\r\n            scheme: HTTPS\r\n          initialDelaySeconds: 1000\r\n          periodSeconds: 10\r\n          successThreshold: 1\r\n          timeoutSeconds: 30\r\n\r\nreadinessProbe:\r\n          failureThreshold: 3000\r\n          httpGet:\r\n            path: /_chp_healthz\r\n            port: https\r\n            scheme: HTTPS\r\n          periodSeconds: 5\r\n          successThreshold: 1\r\n          timeoutSeconds: 30\r\n```\r\n\r\nI found that this may help in other threads, there were also some values listed.\r\nThis configuration makes it better, but it is still not the user experience I've expected. \r\n\r\nI am fairly new to Kubernetes, and this is my first big deployment, so I would be really gratefull for any hints.\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2565/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2565/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2529", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2529/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2529/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2529/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2529", "id": 1089642958, "node_id": "I_kwDOBTx5m85A8qHO", "number": 2529, "title": "Spawn failed: Could not create pod jupyter-user1", "user": {"login": "nmarandi", "id": 34411083, "node_id": "MDQ6VXNlcjM0NDExMDgz", "avatar_url": "https://avatars.githubusercontent.com/u/34411083?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nmarandi", "html_url": "https://github.com/nmarandi", "followers_url": "https://api.github.com/users/nmarandi/followers", "following_url": "https://api.github.com/users/nmarandi/following{/other_user}", "gists_url": "https://api.github.com/users/nmarandi/gists{/gist_id}", "starred_url": "https://api.github.com/users/nmarandi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nmarandi/subscriptions", "organizations_url": "https://api.github.com/users/nmarandi/orgs", "repos_url": "https://api.github.com/users/nmarandi/repos", "events_url": "https://api.github.com/users/nmarandi/events{/privacy}", "received_events_url": "https://api.github.com/users/nmarandi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-12-28T06:22:47Z", "updated_at": "2021-12-28T07:14:55Z", "closed_at": "2021-12-28T07:09:43Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\ncannot start the server after clicking on the start button.\r\n\r\n#### Expected behavior\r\n<!-- Tell us what you thought would happen. -->\r\nserver starts normally after clicking on the start button.\r\n\r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\n![image](https://user-images.githubusercontent.com/34411083/147533743-5eb13421-ec7d-45ef-8943-72359f9b0ffd.png)\r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\nit's a fresh install with helm chart version 1.2.0 installed on Kubernetes\r\n\r\n### Your personal set up\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n\r\n - OS: ubuntu 20.04\r\n <!-- [e.g. ubuntu 20.04, macOS 11.0] -->\r\n\r\n- <details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```yaml\r\nproxy:\r\n  secretToken: \"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\"\r\n  https:\r\n    enabled: true\r\n    hosts:\r\n      - www.w3schools.com\r\n    type: secret\r\n    secret:\r\n      name: jupyterhub-tls\r\nsingleuser:\r\n  image:\r\n    name: jupyter/datascience-notebook\r\n    tag: lab-3.1.12\r\n  extraEnv: \r\n    GRANT_SUDO: \"yes\"\r\n    NOTEBOOK_ARGS: \"--allow-root\"\r\n  uid: 0\r\n  defaultUrl: \"/lab\"\r\n  storage:\r\n    dynamic:\r\n      storageClass: csi-cephfs-sc\r\n      storageAccessModes: [ReadWriteMany]\r\n  profileList:\r\n    - display_name: \"Minimal environment\"\r\n      description: \"without gpu\"\r\n      memory:\r\n        limit: 1G\r\n        guarantee: 1G\r\n      default: true\r\n    - display_name: \"Datascience environment\"\r\n      description: \"with gpu\"\r\n      memory:\r\n        limit: 1G\r\n        guarantee: 1G\r\n      kubespawner_override:\r\n        extra_resource_limits:\r\n          nvidia.com/gpu: \"1\"\r\nhub:\r\n  extraConfig:\r\n    hub: |\r\n      c.JupyterHub.tornado_settings = { \"headers\": { \"Content-Security-Policy\": \"frame-ancestors 'self' https://www.w3schools.com:443\"}}\r\n    spawner: |\r\n      c.Spawner.args = ['--allow-root','--NotebookApp.tornado_settings={\"headers\":{\"Content-Security-Policy\": \"frame-ancestors * self https://www.w3schools.com:443\"}}'] \r\n  config:\r\n    Authenticator:\r\n      auto_login: true\r\n    GenericOAuthenticator:\r\n      admin_users:\r\n      - user1\r\n      - user2\r\n      client_id: jupyterhub\r\n      client_secret: \r\n      oauth_callback_url:\r\n      authorize_url: \r\n      token_url: \r\n      userdata_url:\r\n      login_service: keycloak\r\n      username_key: preferred_username\r\n      userdata_params:\r\n        state: state\r\n    JupyterHub:\r\n      authenticator_class: generic-oauth\r\n      admin_access: true\r\n  services:\r\n    testService:\r\n      admin: true\r\n      apiToken: \"xxxxxxx\"\r\n\r\n```\r\n</details>\r\n\r\n- <details><summary>Logs</summary>\r\n<!--\r\nErrors are often logged by jupytehub. How you get logs depends on your deployment.\r\nWith kubernetes it might be:\r\n\r\n    kubectl get pod # hub pod name starts with hub...\r\n    kubectl logs hub-...\r\n    # or for a single-user server\r\n    kubectl logs jupyter-username\r\n\r\nOr the-littlest-jupyterhub:\r\n\r\n    journalctl -u jupyterhub\r\n    # or for a single-user server\r\n    journalctl -u jupyter-username\r\n-->\r\n\r\nhub pod logs:\r\n```\r\n[I 2021-12-28 06:03:47.356 JupyterHub log:189] 200 GET /hub/api/users/user1/server/progress (user1@192.168.18.20) 7.31ms\r\n[I 2021-12-28 06:03:50.560 JupyterHub provider:574] Creating oauth client jupyterhub-user-user1\r\n[I 2021-12-28 06:03:50.579 JupyterHub spawner:2344] Attempting to create pvc claim-user1, with timeout 3\r\n[I 2021-12-28 06:03:50.598 JupyterHub spawner:2361] PVC claim-user1 already exists, so did not create new pvc.\r\n[I 2021-12-28 06:03:50.600 JupyterHub spawner:2302] Attempting to create pod jupyter-user1, with timeout 3\r\n[I 2021-12-28 06:03:51.535 JupyterHub log:189] 302 POST /hub/spawn -> /hub/spawn-pending/user1 (user1@192.168.18.20) 1008.39ms\r\n[I 2021-12-28 06:03:51.585 JupyterHub pages:402] user1 is pending spawn\r\n[I 2021-12-28 06:03:53.715 JupyterHub spawner:2302] Attempting to create pod jupyter-user1, with timeout 3\r\n[I 2021-12-28 06:03:57.112 JupyterHub spawner:2302] Attempting to create pod jupyter-user1, with timeout 3\r\n[I 2021-12-28 06:04:00.132 JupyterHub spawner:2302] Attempting to create pod jupyter-user1, with timeout 3\r\n[W 2021-12-28 06:04:00.532 JupyterHub base:1008] User user1 is slow to start (timeout=10)\r\n[E 2021-12-28 06:04:00.609 JupyterHub gen:623] Exception in Future <Future finished exception=ApiException()> after timeout\r\n    Traceback (most recent call last):\r\n      File \"/usr/local/lib/python3.8/dist-packages/tornado/gen.py\", line 618, in error_callback\r\n        future.result()\r\n      File \"/usr/lib/python3.8/concurrent/futures/thread.py\", line 57, in run\r\n        result = self.fn(*self.args, **self.kwargs)\r\n      File \"/usr/local/lib/python3.8/dist-packages/kubespawner/spawner.py\", line 2117, in asynchronize\r\n        return method(*args, **kwargs)\r\n      File \"/usr/local/lib/python3.8/dist-packages/kubernetes/client/api/core_v1_api.py\", line 7320, in create_namespaced_pod\r\n        return self.create_namespaced_pod_with_http_info(namespace, body, **kwargs)  # noqa: E501\r\n      File \"/usr/local/lib/python3.8/dist-packages/kubernetes/client/api/core_v1_api.py\", line 7415, in create_namespaced_pod_with_http_info\r\n        return self.api_client.call_api(\r\n      File \"/usr/local/lib/python3.8/dist-packages/kubernetes/client/api_client.py\", line 348, in call_api\r\n        return self.__call_api(resource_path, method,\r\n      File \"/usr/local/lib/python3.8/dist-packages/kubernetes/client/api_client.py\", line 180, in __call_api\r\n        response_data = self.request(\r\n      File \"/usr/local/lib/python3.8/dist-packages/kubernetes/client/api_client.py\", line 391, in request\r\n        return self.rest_client.POST(url,\r\n      File \"/usr/local/lib/python3.8/dist-packages/kubernetes/client/rest.py\", line 274, in POST\r\n        return self.request(\"POST\", url,\r\n      File \"/usr/local/lib/python3.8/dist-packages/kubernetes/client/rest.py\", line 233, in request\r\n        raise ApiException(http_resp=r)\r\n    kubernetes.client.exceptions.ApiException: (409)\r\n    Reason: Conflict\r\n    HTTP response headers: HTTPHeaderDict({'Cache-Control': 'no-cache, private', 'Content-Type': 'application/json', 'X-Kubernetes-Pf-Flowschema-Uid': '66adedc6-4372-417b-886d-b6862ee17816', 'X-Kubernetes-Pf-Prioritylevel-Uid': '648d43ae-537f-458c-92b5-6dbf4ed46b86', 'Date': 'Tue, 28 Dec 2021 06:04:00 GMT', 'Content-Length': '204'})\r\n    HTTP response body: {\"kind\":\"Status\",\"apiVersion\":\"v1\",\"metadata\":{},\"status\":\"Failure\",\"message\":\"pods \\\"jupyter-user1\\\" already exists\",\"reason\":\"AlreadyExists\",\"details\":{\"name\":\"jupyter-user1\",\"kind\":\"pods\"},\"code\":409}\r\n\r\n[E 2021-12-28 06:04:23.862 JupyterHub user:718] Unhandled error starting user1's server: Could not create pod jupyter-user1\r\n[W 2021-12-28 06:04:23.862 JupyterHub spawner:2103] Pod jupyter-user1 url changed! hub-55b456cc68-jcmvb:49147 -> 10.244.0.50:8888\r\n[I 2021-12-28 06:04:23.888 JupyterHub spawner:2620] Deleting pod jupyter-user1\r\n[W 2021-12-28 06:04:30.769 JupyterHub base:976] 2 consecutive spawns failed.  Hub will exit if failure count reaches 5 before succeeding\r\n[E 2021-12-28 06:04:30.769 JupyterHub gen:623] Exception in Future <Task finished name='Task-550' coro=<BaseHandler.spawn_single_user.<locals>.finish_user_spawn() done, defined at /usr/local/lib/python3.8/dist-packages/jupyterhub/handlers/base.py:900> exception=TimeoutError('Could not create pod jupyter-user1')> after timeout\r\n    Traceback (most recent call last):\r\n      File \"/usr/local/lib/python3.8/dist-packages/tornado/gen.py\", line 618, in error_callback\r\n        future.result()\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/handlers/base.py\", line 907, in finish_user_spawn\r\n        await spawn_future\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/user.py\", line 736, in spawn\r\n        raise e\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/user.py\", line 635, in spawn\r\n        url = await gen.with_timeout(timedelta(seconds=spawner.start_timeout), f)\r\n      File \"/usr/local/lib/python3.8/dist-packages/kubespawner/spawner.py\", line 2508, in _start\r\n        await exponential_backoff(\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/utils.py\", line 184, in exponential_backoff\r\n        raise TimeoutError(fail_message)\r\n    TimeoutError: Could not create pod jupyter-user1\r\n    \r\n[I 2021-12-28 06:04:30.769 JupyterHub log:189] 200 GET /hub/api/users/user1/server/progress (user1@192.168.18.20) 38897.15ms\r\n[W 2021-12-28 06:04:35.792 JupyterHub log:189] 403 GET /hub/metrics (@10.244.1.1) 0.78ms\r\n[I 2021-12-28 06:04:40.096 JupyterHub log:189] 200 GET /hub/api (@10.244.1.1) 1.71ms\r\n[W 2021-12-28 06:04:40.177 JupyterHub log:189] 403 POST /hub/api/users/user1/activity (@10.244.1.1) 4.24ms\r\n[W 2021-12-28 06:04:40.798 JupyterHub log:189] 403 POST /hub/api/users/user1/activity (@10.244.1.1) 1.28ms\r\n[W 2021-12-28 06:04:41.782 JupyterHub log:189] 403 POST /hub/api/users/user1/activity (@10.244.1.1) 1.02ms\r\n[W 2021-12-28 06:04:42.047 JupyterHub log:189] 403 POST /hub/api/users/user1/activity (@10.244.1.1) 0.97ms\r\n[I 2021-12-28 06:04:44.101 JupyterHub log:189] 302 GET / -> /hub/ (@192.168.18.20) 0.43ms\r\n[I 2021-12-28 06:04:44.196 JupyterHub log:189] 302 GET /hub/ -> /hub/spawn (user1@192.168.18.20) 4.63ms\r\n[I 2021-12-28 06:04:44.288 JupyterHub log:189] 200 GET /hub/spawn (user1@192.168.18.20) 6.56ms\r\n[W 2021-12-28 06:04:46.269 JupyterHub log:189] 403 POST /hub/api/users/user1/activity (@10.244.1.1) 0.96ms\r\n```\r\njupyter-user1 pod logs 1:\r\n\r\n```\r\n[W 2021-12-28 06:06:18.864 SingleUserNotebookApp configurable:193] Config option `open_browser` not recognized by `SingleUserNotebookApp`.  Did you mean `browser`?\r\n[I 2021-12-28 06:06:18.920 SingleUserNotebookApp notebookapp:1593] Authentication of /metrics is OFF, since other authentication is disabled.\r\n[W 2021-12-28 06:06:19.817 LabApp] 'tornado_settings' has moved from NotebookApp to ServerApp. This config will be passed to ServerApp. Be sure to update your config before our next release.\r\n[W 2021-12-28 06:06:19.817 LabApp] 'ip' has moved from NotebookApp to ServerApp. This config will be passed to ServerApp. Be sure to update your config before our next release.\r\n[W 2021-12-28 06:06:19.817 LabApp] 'port' has moved from NotebookApp to ServerApp. This config will be passed to ServerApp. Be sure to update your config before our next release.\r\n[W 2021-12-28 06:06:19.817 LabApp] 'port' has moved from NotebookApp to ServerApp. This config will be passed to ServerApp. Be sure to update your config before our next release.\r\n[W 2021-12-28 06:06:19.817 LabApp] 'port' has moved from NotebookApp to ServerApp. This config will be passed to ServerApp. Be sure to update your config before our next release.\r\n[I 2021-12-28 06:06:19.830 LabApp] JupyterLab extension loaded from /opt/conda/lib/python3.9/site-packages/jupyterlab\r\n[I 2021-12-28 06:06:19.830 LabApp] JupyterLab application directory is /opt/conda/share/jupyter/lab\r\nPatching auth into jupyter_server.base.handlers.JupyterHandler(jupyter_server.base.handlers.AuthenticatedHandler) -> JupyterHandler(jupyterhub.singleuser.mixins.HubAuthenticatedHandler, jupyter_server.base.handlers.AuthenticatedHandler)\r\n[I 2021-12-28 06:06:19.841 SingleUserNotebookApp mixins:576] Starting jupyterhub-singleuser server version 1.4.2\r\n[W 2021-12-28 06:06:19.851 SingleUserNotebookApp _version:70] jupyterhub version 1.5.0 != jupyterhub-singleuser version 1.4.2. This could cause failure to authenticate and result in redirect loops!\r\n[I 2021-12-28 06:06:19.852 SingleUserNotebookApp notebookapp:2302] Serving notebooks from local directory: /home/jovyan\r\n[I 2021-12-28 06:06:19.852 SingleUserNotebookApp notebookapp:2302] Jupyter Notebook 6.4.4 is running at:\r\n[I 2021-12-28 06:06:19.852 SingleUserNotebookApp notebookapp:2302] http://jupyter-user1:8888/user/user1/\r\n[I 2021-12-28 06:06:19.852 SingleUserNotebookApp notebookapp:2303] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).\r\n[I 2021-12-28 06:06:19.937 SingleUserNotebookApp mixins:556] Updating Hub with activity every 300 seconds\r\n[E 2021-12-28 06:06:19.942 SingleUserNotebookApp mixins:538] Error notifying Hub of activity\r\n    Traceback (most recent call last):\r\n      File \"/opt/conda/lib/python3.9/site-packages/jupyterhub/singleuser/mixins.py\", line 536, in notify\r\n        await client.fetch(req)\r\n    tornado.httpclient.HTTPClientError: HTTP 403: Forbidden\r\n[E 2021-12-28 06:06:20.724 SingleUserNotebookApp mixins:538] Error notifying Hub of activity\r\n    Traceback (most recent call last):\r\n      File \"/opt/conda/lib/python3.9/site-packages/jupyterhub/singleuser/mixins.py\", line 536, in notify\r\n        await client.fetch(req)\r\n    tornado.httpclient.HTTPClientError: HTTP 403: Forbidden\r\n[E 2021-12-28 06:06:20.870 SingleUserNotebookApp mixins:538] Error notifying Hub of activity\r\n    Traceback (most recent call last):\r\n      File \"/opt/conda/lib/python3.9/site-packages/jupyterhub/singleuser/mixins.py\", line 536, in notify\r\n        await client.fetch(req)\r\n    tornado.httpclient.HTTPClientError: HTTP 403: Forbidden\r\n[E 2021-12-28 06:06:22.712 SingleUserNotebookApp mixins:538] Error notifying Hub of activity\r\n    Traceback (most recent call last):\r\n      File \"/opt/conda/lib/python3.9/site-packages/jupyterhub/singleuser/mixins.py\", line 536, in notify\r\n        await client.fetch(req)\r\n    tornado.httpclient.HTTPClientError: HTTP 403: Forbidden\r\n[E 2021-12-28 06:06:24.933 SingleUserNotebookApp mixins:538] Error notifying Hub of activity\r\n    Traceback (most recent call last):\r\n      File \"/opt/conda/lib/python3.9/site-packages/jupyterhub/singleuser/mixins.py\", line 536, in notify\r\n        await client.fetch(req)\r\n    tornado.httpclient.HTTPClientError: HTTP 403: Forbidden\r\n[E 2021-12-28 06:06:30.146 SingleUserNotebookApp mixins:538] Error notifying Hub of activity\r\n    Traceback (most recent call last):\r\n      File \"/opt/conda/lib/python3.9/site-packages/jupyterhub/singleuser/mixins.py\", line 536, in notify\r\n        await client.fetch(req)\r\n    tornado.httpclient.HTTPClientError: HTTP 403: Forbidden\r\n[E 2021-12-28 06:06:45.166 SingleUserNotebookApp mixins:538] Error notifying Hub of activity\r\n    Traceback (most recent call last):\r\n      File \"/opt/conda/lib/python3.9/site-packages/jupyterhub/singleuser/mixins.py\", line 536, in notify\r\n        await client.fetch(req)\r\n    tornado.httpclient.HTTPClientError: HTTP 403: Forbidden\r\n[E 2021-12-28 06:07:00.187 SingleUserNotebookApp mixins:538] Error notifying Hub of activity\r\n    Traceback (most recent call last):\r\n      File \"/opt/conda/lib/python3.9/site-packages/jupyterhub/singleuser/mixins.py\", line 536, in notify\r\n        await client.fetch(req)\r\n    tornado.httpclient.HTTPClientError: HTTP 403: Forbidden\r\n[E 2021-12-28 06:07:15.209 SingleUserNotebookApp mixins:538] Error notifying Hub of activity\r\n    Traceback (most recent call last):\r\n      File \"/opt/conda/lib/python3.9/site-packages/jupyterhub/singleuser/mixins.py\", line 536, in notify\r\n        await client.fetch(req)\r\n    tornado.httpclient.HTTPClientError: HTTP 403: Forbidden\r\n[E 2021-12-28 06:07:22.538 SingleUserNotebookApp mixins:538] Error notifying Hub of activity\r\n    Traceback (most recent call last):\r\n      File \"/opt/conda/lib/python3.9/site-packages/jupyterhub/singleuser/mixins.py\", line 536, in notify\r\n        await client.fetch(req)\r\n    tornado.httpclient.HTTPClientError: HTTP 403: Forbidden\r\n[E 2021-12-28 06:07:22.538 SingleUserNotebookApp mixins:563] Error notifying Hub of activity\r\n    Traceback (most recent call last):\r\n      File \"/opt/conda/lib/python3.9/site-packages/jupyterhub/singleuser/mixins.py\", line 561, in keep_activity_updated\r\n        await self.notify_activity()\r\n      File \"/opt/conda/lib/python3.9/site-packages/jupyterhub/singleuser/mixins.py\", line 543, in notify_activity\r\n        await exponential_backoff(\r\n      File \"/opt/conda/lib/python3.9/site-packages/jupyterhub/utils.py\", line 184, in exponential_backoff\r\n        raise TimeoutError(fail_message)\r\n    TimeoutError: Failed to notify Hub of activity\r\n\r\n```\r\n\r\njupyter-user1 pod logs 2:\r\n```\r\n[W 2021-12-28 06:44:06.827 SingleUserNotebookApp configurable:193] Config option `open_browser` not recognized by `SingleUserNotebookApp`.  Did you mean `browser`?\r\n[I 2021-12-28 06:44:06.856 SingleUserNotebookApp notebookapp:1593] Authentication of /metrics is OFF, since other authentication is disabled.\r\n[W 2021-12-28 06:44:07.701 LabApp] 'tornado_settings' has moved from NotebookApp to ServerApp. This config will be passed to ServerApp. Be sure to update your config before our next release.\r\n[W 2021-12-28 06:44:07.702 LabApp] 'ip' has moved from NotebookApp to ServerApp. This config will be passed to ServerApp. Be sure to update your config before our next release.\r\n[W 2021-12-28 06:44:07.702 LabApp] 'port' has moved from NotebookApp to ServerApp. This config will be passed to ServerApp. Be sure to update your config before our next release.\r\n[W 2021-12-28 06:44:07.702 LabApp] 'port' has moved from NotebookApp to ServerApp. This config will be passed to ServerApp. Be sure to update your config before our next release.\r\n[W 2021-12-28 06:44:07.702 LabApp] 'port' has moved from NotebookApp to ServerApp. This config will be passed to ServerApp. Be sure to update your config before our next release.\r\n[I 2021-12-28 06:44:07.712 LabApp] JupyterLab extension loaded from /opt/conda/lib/python3.9/site-packages/jupyterlab\r\n[I 2021-12-28 06:44:07.712 LabApp] JupyterLab application directory is /opt/conda/share/jupyter/lab\r\nPatching auth into jupyter_server.base.handlers.JupyterHandler(jupyter_server.base.handlers.AuthenticatedHandler) -> JupyterHandler(jupyterhub.singleuser.mixins.HubAuthenticatedHandler, jupyter_server.base.handlers.AuthenticatedHandler)\r\n[I 2021-12-28 06:44:07.720 SingleUserNotebookApp mixins:576] Starting jupyterhub-singleuser server version 1.4.2\r\n[W 2021-12-28 06:44:07.727 SingleUserNotebookApp _version:70] jupyterhub version 1.5.0 != jupyterhub-singleuser version 1.4.2. This could cause failure to authenticate and result in redirect loops!\r\n[I 2021-12-28 06:44:07.728 SingleUserNotebookApp notebookapp:2302] Serving notebooks from local directory: /home/jovyan\r\n[I 2021-12-28 06:44:07.728 SingleUserNotebookApp notebookapp:2302] Jupyter Notebook 6.4.4 is running at:\r\n[I 2021-12-28 06:44:07.728 SingleUserNotebookApp notebookapp:2302] http://jupyter-user1:8888/user/user1/\r\n[I 2021-12-28 06:44:07.728 SingleUserNotebookApp notebookapp:2303] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).\r\n[I 2021-12-28 06:44:07.799 SingleUserNotebookApp mixins:556] Updating Hub with activity every 300 seconds\r\n[C 2021-12-28 06:44:17.150 SingleUserNotebookApp notebookapp:1972] received signal 15, stopping\r\n[I 2021-12-28 06:44:17.173 SingleUserNotebookApp notebookapp:2139] Shutting down 0 kernels\r\n[I 2021-12-28 06:44:17.178 SingleUserNotebookApp notebookapp:2154] Shutting down 0 terminals\r\n\r\n```\r\n\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2529/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2529/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2510", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2510/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2510/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2510/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2510", "id": 1078610943, "node_id": "I_kwDOBTx5m85ASkv_", "number": 2510, "title": "How to make created custom (conda) environments persist across user sessions in Jupyter Hub on AWS EKS cluster", "user": {"login": "vinayak-shanawad", "id": 37987800, "node_id": "MDQ6VXNlcjM3OTg3ODAw", "avatar_url": "https://avatars.githubusercontent.com/u/37987800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vinayak-shanawad", "html_url": "https://github.com/vinayak-shanawad", "followers_url": "https://api.github.com/users/vinayak-shanawad/followers", "following_url": "https://api.github.com/users/vinayak-shanawad/following{/other_user}", "gists_url": "https://api.github.com/users/vinayak-shanawad/gists{/gist_id}", "starred_url": "https://api.github.com/users/vinayak-shanawad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vinayak-shanawad/subscriptions", "organizations_url": "https://api.github.com/users/vinayak-shanawad/orgs", "repos_url": "https://api.github.com/users/vinayak-shanawad/repos", "events_url": "https://api.github.com/users/vinayak-shanawad/events{/privacy}", "received_events_url": "https://api.github.com/users/vinayak-shanawad/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-12-13T14:39:56Z", "updated_at": "2021-12-14T16:15:58Z", "closed_at": "2021-12-14T16:14:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi All,\r\n\r\nGreetings!!\r\n\r\nHope everyone is doing well.\r\n\r\nThanks in advance.\r\n\r\nI have installed the Jupyter hub on the AWS EKS cluster.\r\n\r\n**Objective 1**: We want to allow users to create conda environments using Jupyter lab UI which needs to be persisted across all user sessions meaning user 1 has created conda environment = xyz and the same environment can be accessed by user 2 when that user logs in to JH.\r\n\r\nAs mentioned in the article below, I have followed the below steps.\r\n\r\nhttps://zero-to-jupyterhub.readthedocs.io/en/latest/jupyterhub/customizing/user-environment.html 1\r\n\r\nEnsure the \u201cnb_conda_kernels\u201d package is installed in the root environment - have mentioned \u201cnb_conda_kernels\u201d in the docker file.\r\nHere is my Dockerfile:\r\n##########################################################################\r\n[#] Get the jupyter hub image of minimal-notebook from Docker hub\r\nFROM jupyter/minimal-notebook:latest\r\n\r\n[#] Allow users to create their own conda environments for notebooks\r\nUSER root\r\n\r\nRUN conda install -c conda-forge nb_conda_kernels\r\nRUN conda install -c conda-forge ipykernel\r\n\r\nCOPY .condarc /tmp/work/\r\n\r\n[#] Copy environment.yml file to /tmp/work/ directory\r\nCOPY custom_environment.yml /tmp/work/\r\n\r\n[#] Switch back to jovyan to avoid accidental container runs as root\r\nUSER ${NB_UID}\r\n##########################################################################\r\n\r\nConfigure Anaconda to install user environments to a folder within \u201c$HOME\u201d = /home/jovyan/.\r\nCreated a file called .condarc and copied it to the home folder for all users.\r\nJupyterHub config.yaml - lifecycle hooks:\r\n\r\nlifecycleHooks:\r\npostStart:\r\nexec:\r\ncommand:\r\n- \u201csh\u201d\r\n- \u201c-c\u201d\r\n- >\r\ncp /tmp/work/custom_environment.yml /home/jovyan/;\r\ncp /tmp/work/.condarc /home/jovyan/;\r\n\r\nDid the helm upgrade, restarted all user\u2019s servers. Login with user 1 and created the below environments which can be seen in home directory.\r\nCommands used to create the environments in Jupyter lab terminal:\r\n\r\nconda create -n myenv --yes python=3.8 ipykernel\r\nconda activate myenv\r\npython -m ipykernel install --user --name myenv\r\nconda env list\r\nSame commands used to create the conda environment = d2l\r\n\r\nconda environments list:\r\nd2l /home/jovyan/my-conda-envs/d2l\r\nmyenv /home/jovyan/my-conda-envs/myenv\r\nbase * /opt/conda\r\n\r\nWhen I login in with user 2 then we can\u2019t see \u201cd2l\u201d and \u201cmyenv\u201d in the \u201c/home/jovyan/my-conda-envs/\u201d directory.\r\nBut as per the documentation, created conda environments need to persist across user sessions but it\u2019s not happening. Could you please check and help?\r\n**Note**: I am publishing a docker image to docker hub and pulling the same while installing JH.\r\n\r\n**Objective 2**: As an admin we will create conda environments in advance in docker image and replicate those conda virtual environments across all the users.\r\n\r\nI have followed below steps to create conda environments in advance in docker image.\r\n\r\nCreated the environments in docker image. Here is my docker file.\r\n##########################################################################\r\n[#] Get the jupyter hub image of minimal-notebook from Docker hub\r\nFROM jupyter/minimal-notebook:latest\r\n[#] Allow users to create their own conda environments for notebooks\r\nUSER root\r\n\r\nRUN conda install -c conda-forge nb_conda_kernels\r\nRUN conda install -c conda-forge ipykernel\r\n\r\nCOPY .condarc $HOME\r\nCOPY .condarc /tmp/work/\r\n\r\n[#] Copy environment.yml file to /tmp/work/ directory\r\nCOPY custom_environment.yml /tmp/work/\r\n\r\n[#] Create a custom environment 1 = d2l\r\nRUN conda env create -f /tmp/work/custom_environment.yml\r\n\r\nRUN python -m ipykernel install --name d2l\r\n\r\n[#] Create a custom environment 2 = myenv with specific version of python\r\nRUN conda create -n myenv --yes python=3.8 ipykernel\r\n\r\n[#] Switch back to jovyan to avoid accidental container runs as root\r\nUSER ${NB_UID}\r\n##########################################################################\r\n\r\nBuild the docker image, run it local system to verify the created conda environments in docker image and can see those environments.\r\n\r\n![image](https://user-images.githubusercontent.com/37987800/145831510-e1013b2b-1001-4184-bd5d-599d44783e70.png)\r\n\r\nJupyterHub config.yaml - lifecycle hooks:\r\nlifecycleHooks:\r\npostStart:\r\nexec:\r\ncommand:\r\n- \u201csh\u201d\r\n- \u201c-c\u201d\r\n- >\r\ncp /tmp/work/.condarc /home/jovyan/;\r\n\r\nDid the helm upgrade, restarted all users servers. When users login with their credentials then they can\u2019t see the conda environments which we created in docker image.\r\n**Note**: I am publishing a docker image to docker hub and pulling the same while installing JH.\r\n\r\nPlease find the below .condarc file.\r\n![image](https://user-images.githubusercontent.com/37987800/145831789-23737965-5926-413e-b65b-046e33a89e59.png)\r\n\r\nCould you please check and help on these issues?\r\n\r\nFYI: I did post Jupyter community but have not received right solution yet.\r\nhttps://discourse.jupyter.org/t/how-to-make-created-custom-conda-environments-persist-across-user-sessions-in-jupyter-hub-on-aws-eks-cluster/12111\r\n\r\n\r\nThanks & Regards,\r\nVinayak", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2510/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2510/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2490", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2490/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2490/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2490/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2490", "id": 1058084752, "node_id": "I_kwDOBTx5m84_EReQ", "number": 2490, "title": "using baseUrl and oauth results in hub/hub redirect", "user": {"login": "sneely333", "id": 66045304, "node_id": "MDQ6VXNlcjY2MDQ1MzA0", "avatar_url": "https://avatars.githubusercontent.com/u/66045304?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sneely333", "html_url": "https://github.com/sneely333", "followers_url": "https://api.github.com/users/sneely333/followers", "following_url": "https://api.github.com/users/sneely333/following{/other_user}", "gists_url": "https://api.github.com/users/sneely333/gists{/gist_id}", "starred_url": "https://api.github.com/users/sneely333/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sneely333/subscriptions", "organizations_url": "https://api.github.com/users/sneely333/orgs", "repos_url": "https://api.github.com/users/sneely333/repos", "events_url": "https://api.github.com/users/sneely333/events{/privacy}", "received_events_url": "https://api.github.com/users/sneely333/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2021-11-19T03:15:16Z", "updated_at": "2021-11-29T17:11:54Z", "closed_at": "2021-11-29T17:11:54Z", "author_association": "NONE", "active_lock_reason": null, "body": "description\r\nUsing the helm config option baseUrl and GenericOAuthenticator (with Cognito) directs user to https://$domainname/$baseurl/hub/hub after successful authentication.  If the user removes the second hub in the url, everything works as expected.  All other links also work as expected.\r\n\r\nExpected behaviour\r\noauth would direct to / rather than /hub.\r\n\r\nActual behaviour\r\noauth redirects to /hub which, because of the baseUrl being set, directs to baseUrl/hub/hub. \r\n\r\n### How to reproduce\r\nUse the standard helm install, set\r\n\r\n```yaml\r\nhub:\r\n baseUrl: /ondemand\r\n\r\nconfig: \r\n   GenericOauthenticator: \r\n      etc etc\r\n```\r\n\r\nMy set up\r\nUsing zero-to-jupyterhub with eks and helm\r\n\r\nChart: jupyterhub-0.11.1\r\nApp version: 1.3.0\r\n\r\nRelevant Logs: \r\n```\r\n[I 2021-11-19 02:53:18.982 JupyterHub oauth2:104] OAuth redirect: 'https://example.com/ondemand/hub/oauth_callback'\r\n[I 2021-11-19 02:53:18.983 JupyterHub log:181] 302 GET /ondemand/hub/oauth_login?next=%2Fhub%2F -> https://example.auth.us-west-2.amazoncognito.com/oauth2/authorize?response_type=code&redirect_uri=https%3A%2F%2Fexample.com%2Fondemand%2Fhub%2Foauth_callback&client_id=xxxxxxxxxx&state=[secret] (@::ffff:ip) 1.43ms\r\n[I 2021-11-19 02:53:19.588 JupyterHub base:757] User logged in: example_username\r\n[I 2021-11-19 02:53:19.588 JupyterHub log:181] 302 GET /ondemand/hub/oauth_callback?code=[secret]&state=[secret] -> /hub/ (@::ffff:ip) 386.39ms\r\n[I 2021-11-19 02:53:19.977 JupyterHub log:181] 302 GET /hub/ -> /ondemand/hub/hub/ (@::ffff:ip) 0.62ms\r\n[W 2021-11-19 02:53:20.103 JupyterHub log:181] 404 GET /ondemand/hub/hub/ (example_username@::ffff:ip) 6.52ms\r\n```", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2490/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2490/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2481", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2481/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2481/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2481/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2481", "id": 1051033578, "node_id": "I_kwDOBTx5m84-pX_q", "number": 2481, "title": "Existing PVCs keep old chart labels after upgrade", "user": {"login": "aloifolia", "id": 1295054, "node_id": "MDQ6VXNlcjEyOTUwNTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1295054?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aloifolia", "html_url": "https://github.com/aloifolia", "followers_url": "https://api.github.com/users/aloifolia/followers", "following_url": "https://api.github.com/users/aloifolia/following{/other_user}", "gists_url": "https://api.github.com/users/aloifolia/gists{/gist_id}", "starred_url": "https://api.github.com/users/aloifolia/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aloifolia/subscriptions", "organizations_url": "https://api.github.com/users/aloifolia/orgs", "repos_url": "https://api.github.com/users/aloifolia/repos", "events_url": "https://api.github.com/users/aloifolia/events{/privacy}", "received_events_url": "https://api.github.com/users/aloifolia/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 3539958030, "node_id": "LA_kwDOBTx5m87S_3kO", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/wontfix", "name": "wontfix", "color": "EB6541", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-11-11T14:24:48Z", "updated_at": "2023-03-12T13:20:14Z", "closed_at": "2023-03-12T13:20:14Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\nWhen you upgrade your jupyterhub installation to a new helm chart via\r\n[\"helm upgrade\" command](https://zero-to-jupyterhub.readthedocs.io/en/latest/jupyterhub/installation.html), the labels of existing PVCs are not accordingly changed. \r\n\r\nE.g., suppose you first install version 1.1.4. On the first login of a new user, a new PVC with label \"chart: jupyterhub-1.1.3\" will be created. If you then upgrade to version 1.2.0, the existing PVC will keep its label. However, any subsequently initialized PVCs will have the label \"chart: jupyterhub-1.2.0\".\r\n\r\n#### Expected behaviour\r\nExisting PVCs should be relabeled if necessary. Alternatively, if the current behavior is actually a feature, the documentation should say so explicitly.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2481/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2481/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2467", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2467/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2467/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2467/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2467", "id": 1041714165, "node_id": "I_kwDOBTx5m84-F0v1", "number": 2467, "title": "Helm Chart fails to get the specified configuration `containerSecurityContext`", "user": {"login": "Jiafi", "id": 14348339, "node_id": "MDQ6VXNlcjE0MzQ4MzM5", "avatar_url": "https://avatars.githubusercontent.com/u/14348339?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jiafi", "html_url": "https://github.com/Jiafi", "followers_url": "https://api.github.com/users/Jiafi/followers", "following_url": "https://api.github.com/users/Jiafi/following{/other_user}", "gists_url": "https://api.github.com/users/Jiafi/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jiafi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jiafi/subscriptions", "organizations_url": "https://api.github.com/users/Jiafi/orgs", "repos_url": "https://api.github.com/users/Jiafi/repos", "events_url": "https://api.github.com/users/Jiafi/events{/privacy}", "received_events_url": "https://api.github.com/users/Jiafi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-11-01T22:57:28Z", "updated_at": "2022-05-15T10:01:30Z", "closed_at": "2022-05-15T10:01:30Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\nWhen I use this values.yaml file, I expect to see capabilities.drop set. But I don't actually see it set (see the result of helm template below)\r\n```yaml\r\nprePuller:\r\n  hook:\r\n    enabled: false\r\n  continuous:\r\n    enabled: false\r\n  pause:\r\n    containerSecurityContext:\r\n      capabilities:\r\n        drop: [ALL]\r\n```\r\n\r\nThe resulting helm chart fails to populated \r\n```yaml\r\npause:\r\n    containerSecurityContext:\r\n      capabilities:\r\n        drop: [ALL]\r\n```\r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\nThe helm chart should have the specified configuration.\r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\nThe helm chart fails to have the specified configuration.\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\n1. Set \r\n```yaml\r\nprePuller:\r\n  hook:\r\n    enabled: false\r\n  continuous:\r\n    enabled: false\r\n  pause:\r\n    containerSecurityContext:\r\n      capabilities:\r\n        drop: [ALL]\r\n```\r\n2. `helm template jupyterhub/jupyterhub -f foo.yaml > /tmp/jupyter-templated.yaml`\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2467/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2467/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2460", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2460/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2460/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2460/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2460", "id": 1038767292, "node_id": "I_kwDOBTx5m8496lS8", "number": 2460, "title": "Docs - Markdown is all sorts of messed up in customizing/user-environment.html", "user": {"login": "brsolomon-deloitte", "id": 81818815, "node_id": "MDQ6VXNlcjgxODE4ODE1", "avatar_url": "https://avatars.githubusercontent.com/u/81818815?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brsolomon-deloitte", "html_url": "https://github.com/brsolomon-deloitte", "followers_url": "https://api.github.com/users/brsolomon-deloitte/followers", "following_url": "https://api.github.com/users/brsolomon-deloitte/following{/other_user}", "gists_url": "https://api.github.com/users/brsolomon-deloitte/gists{/gist_id}", "starred_url": "https://api.github.com/users/brsolomon-deloitte/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brsolomon-deloitte/subscriptions", "organizations_url": "https://api.github.com/users/brsolomon-deloitte/orgs", "repos_url": "https://api.github.com/users/brsolomon-deloitte/repos", "events_url": "https://api.github.com/users/brsolomon-deloitte/events{/privacy}", "received_events_url": "https://api.github.com/users/brsolomon-deloitte/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 580906362, "node_id": "MDU6TGFiZWw1ODA5MDYzNjI=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/help%20wanted", "name": "help wanted", "color": "0e8a16", "default": true, "description": null}, {"id": 630540373, "node_id": "MDU6TGFiZWw2MzA1NDAzNzM=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/documentation", "name": "documentation", "color": "fef2c0", "default": true, "description": null}, {"id": 2398427860, "node_id": "MDU6TGFiZWwyMzk4NDI3ODYw", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/maintenance", "name": "maintenance", "color": "de9af4", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-10-28T17:37:19Z", "updated_at": "2022-05-06T17:17:00Z", "closed_at": "2022-05-06T17:17:00Z", "author_association": "NONE", "active_lock_reason": null, "body": "From https://zero-to-jupyterhub.readthedocs.io/en/latest/jupyterhub/customizing/user-environment.html\r\n\r\n<img width=\"751\" alt=\"Screen Shot 2021-10-28 at 11 36 08 AM\" src=\"https://user-images.githubusercontent.com/81818815/139306698-3fb1fc9e-7422-46f3-b5b7-46b5d7d24a5a.png\">\r\n<img width=\"788\" alt=\"Screen Shot 2021-10-28 at 11 35 57 AM\" src=\"https://user-images.githubusercontent.com/81818815/139306699-08b5649d-07d0-4638-8e05-bbf5d7256e89.png\">\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2460/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2460/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2457", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2457/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2457/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2457/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2457", "id": 1038197379, "node_id": "PR_kwDOBTx5m84tx91g", "number": 2457, "title": "match config load priority for jupyterhub_config.d files and hub.extraConfig", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 2398426378, "node_id": "MDU6TGFiZWwyMzk4NDI2Mzc4", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/breaking", "name": "breaking", "color": "ad3727", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2021-10-28T07:56:02Z", "updated_at": "2021-10-28T11:11:38Z", "closed_at": "2021-10-28T08:59:51Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2457", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2457", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2457.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2457.patch", "merged_at": "2021-10-28T08:59:51Z"}, "body": "Before (priority order):\r\n\r\n1. hub.extraConfig\r\n2. hub.config\r\n3. jupyterhub_config.d config files (via hub.extraFiles for example)\r\n\r\nAfter:\r\n\r\n1. hub.extraConfig\r\n2. jupyterhub_config.d config files (via hub.extraFiles for example)\r\n3. hub.config\r\n\r\nReasoning: it's confusing to move inlined Python config from the old `hub.extraConfig` to new `hub.extraFiles` and have that config not have the same effect, due to the changed priority relative to values.yaml\r\n\r\nReported on Gitter by @MLobo1997 who defined a custom Authenticator in extraFiles, which was overridden because `JupyterHub.authenticator_class` is set in hub.config, meaning `extraFiles` cannot set authenticator_class.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2457/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2457/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2455", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2455/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2455/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2455/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2455", "id": 1036862385, "node_id": "I_kwDOBTx5m849zUOx", "number": 2455, "title": "CentOS7 Single User Image cannot be used correctly", "user": {"login": "tejinc", "id": 10509779, "node_id": "MDQ6VXNlcjEwNTA5Nzc5", "avatar_url": "https://avatars.githubusercontent.com/u/10509779?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tejinc", "html_url": "https://github.com/tejinc", "followers_url": "https://api.github.com/users/tejinc/followers", "following_url": "https://api.github.com/users/tejinc/following{/other_user}", "gists_url": "https://api.github.com/users/tejinc/gists{/gist_id}", "starred_url": "https://api.github.com/users/tejinc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tejinc/subscriptions", "organizations_url": "https://api.github.com/users/tejinc/orgs", "repos_url": "https://api.github.com/users/tejinc/repos", "events_url": "https://api.github.com/users/tejinc/events{/privacy}", "received_events_url": "https://api.github.com/users/tejinc/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 2089494150, "node_id": "MDU6TGFiZWwyMDg5NDk0MTUw", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/support", "name": "support", "color": "8fad22", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-10-27T00:47:51Z", "updated_at": "2021-10-27T00:58:25Z", "closed_at": "2021-10-27T00:58:24Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\n\r\nI made a modified version of the **[jupyter/base-notebook](https://github.com/jupyter/docker-stacks/tree/master/base-notebook)** based on centos7 instead of ubuntu:focal. The image could be successfully run in docker on my terminal. \r\n\r\nWhen I installed jupyterhub with helm3 with my image, the **hook-image-puller** failed to pull the image\r\n```\r\nsingleuser:\r\n  image:\r\n    name: axionhub/base-notebook\r\n    tag: latest\r\n```\r\n\r\nHere's the output of the `kubectl describe pods hook-image-puller-*`\r\n```\r\nEvents:\r\n  Type     Reason          Age                 From               Message\r\n  ----     ------          ----                ----               -------\r\n  Normal   Scheduled       58m                 default-scheduler  Successfully assigned jupyterhub/hook-image-puller-smjnr to axion-k8s-node-1\r\n  Normal   AddedInterface  58m                 multus             Add eth0 [10.233.118.100/32]\r\n  Normal   Created         58m                 kubelet            Created container image-pull-metadata-block\r\n  Normal   Started         58m                 kubelet            Started container image-pull-metadata-block\r\n  Normal   Pulled          58m                 kubelet            Container image \"jupyterhub/k8s-network-tools:1.1.3\" already present on machine\r\n  Normal   Pulled          55m                 kubelet            Successfully pulled image \"axionhub/base-notebook:latest\" in 16.110683165s\r\n  Normal   Pulled          53m                 kubelet            Successfully pulled image \"axionhub/base-notebook:latest\" in 15.953847603s\r\n  Normal   Pulled          47m                 kubelet            Successfully pulled image \"axionhub/base-notebook:latest\" in 15.979975574s\r\n  Normal   Pulled          43m                 kubelet            Successfully pulled image \"axionhub/base-notebook:latest\" in 15.950239417s\r\n  Normal   Pulled          41m                 kubelet            Successfully pulled image \"axionhub/base-notebook:latest\" in 15.942765545s\r\n  Normal   Pulled          36m                 kubelet            Successfully pulled image \"axionhub/base-notebook:latest\" in 20.943385991s\r\n  Warning  Failed          36m (x6 over 55m)   kubelet            Error: failed to start container \"image-pull-singleuser\": Error response from daemon: OCI runtime create failed: container_linux.go:367: starting container process caused: chdir to cwd (\"/home/jovyan\") set in config.json failed: permission denied: unknown\r\n  Normal   Created         31m (x7 over 55m)   kubelet            Created container image-pull-singleuser\r\n  Normal   Pulled          31m                 kubelet            Successfully pulled image \"axionhub/base-notebook:latest\" in 16.117170092s\r\n  Normal   Pulled          20m                 kubelet            Successfully pulled image \"axionhub/base-notebook:latest\" in 1m2.87055963s\r\n  Warning  BackOff         17m (x2 over 29m)   kubelet            Back-off restarting failed container\r\n  Normal   Pulling         70s (x11 over 55m)  kubelet            Pulling image \"axionhub/base-notebook:latest\"\r\n```\r\nThe process failed with ```Error: failed to start container \"image-pull-singleuser\": Error response from daemon: OCI runtime create failed: container_linux.go:367: starting container process caused: chdir to cwd (\"/home/jovyan\") set in config.json failed: permission denied: unknown```\r\n\r\nAll tests run by `pytest` were successful and I could launch jupyterhub with the image. \r\n\r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\nImage pull should be successful and I could launch a jupyterhub based on `centos7`. This is necessary for the applications I'm using. \r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\nimage-pull-singleuser failed. \r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\nChange the helm chart config to:\r\n```\r\nsingleuser:\r\n  image:\r\n    name: axionhub/base-notebook\r\n    tag: latest\r\n```\r\nand run `helm install`\r\n\r\n### Your personal set up\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\nI'm using a private OpenStack cloud with centos 7 as the operating system. I'm using z2jh 1.1.3\r\n\r\n - OS:\r\ncentos 7\r\n - Version(s):\r\n ```\r\nClient: Docker Engine - Community\r\n Version:           20.10.5\r\n API version:       1.41\r\n Go version:        go1.13.15\r\n Git commit:        55c4c88\r\n Built:             Tue Mar  2 20:33:55 2021\r\n OS/Arch:           linux/amd64\r\n Context:           default\r\n Experimental:      true\r\n```\r\n```\r\nkubectl version:\r\nClient Version: version.Info{Major:\"1\", Minor:\"22\", GitVersion:\"v1.22.1\", GitCommit:\"632ed300f2c34f6d6d15ca4cef3d3c7073412212\", GitTreeState:\"clean\", BuildDate:\"2021-08-19T15:45:37Z\", GoVersion:\"go1.16.7\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n```\r\n\r\n- <details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n\r\n```\r\n# paste output of `pip freeze` or `conda list` here\r\n```\r\n</details>\r\n\r\n- <details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\nI'm using the default spawner (KubeSpawner) and oauth2. But these shouldn't affect the ability to use the image.\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2455/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2455/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2454", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2454/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2454/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2454/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2454", "id": 1035966833, "node_id": "I_kwDOBTx5m849v5lx", "number": 2454, "title": "Git commands via jupyterhub show certificate verify error via internal gitlab instance ", "user": {"login": "sim-pml", "id": 73642073, "node_id": "MDQ6VXNlcjczNjQyMDcz", "avatar_url": "https://avatars.githubusercontent.com/u/73642073?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sim-pml", "html_url": "https://github.com/sim-pml", "followers_url": "https://api.github.com/users/sim-pml/followers", "following_url": "https://api.github.com/users/sim-pml/following{/other_user}", "gists_url": "https://api.github.com/users/sim-pml/gists{/gist_id}", "starred_url": "https://api.github.com/users/sim-pml/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sim-pml/subscriptions", "organizations_url": "https://api.github.com/users/sim-pml/orgs", "repos_url": "https://api.github.com/users/sim-pml/repos", "events_url": "https://api.github.com/users/sim-pml/events{/privacy}", "received_events_url": "https://api.github.com/users/sim-pml/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-10-26T08:02:52Z", "updated_at": "2021-10-26T08:42:51Z", "closed_at": "2021-10-26T08:42:51Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\nWe our getting an ssl cert verification failure when we try and run any commands like `git clone` from our internal gitlab instance \r\ne.g. :\r\n```git clone https://mygitserver/somerepourl  server certificate verification failed. CAfile: none CRLfile: none```\r\n\r\nThrough some testing we have realised that this is caused by LetsEncrypt updating their root cert back in September (ref https://letsencrypt.org/docs/dst-root-ca-x3-expiration-september-2021/) \r\n\r\nCurrent work around is to ignore the verify using `GIT_SSL_NO_VERIFY=1`   but not ideal doing this as this would mean the same for other git repositories.\r\n\r\nI've tested updating of the ca-certificates package when logging into one of the juptyerhub single user pods and the issue is then resolved. \r\n\r\n#### Expected behaviour\r\ngit commands should run succesfully\r\n\r\n#### Actual behaviour\r\ncertificate fails to verify \r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\n1. Login to juyterhub \r\n2. Launch a single user notebook instance\r\n3.  Open a terminal\r\n4. try and run a git clone comand e.g. ```git clone https://mygitserver/somerepourl``` \r\n\r\n### Your personal set up\r\n zero-to-jupyterhub which was deployed using a helm chart , we are currently running version 0.11 of Juptyerhub\r\nKubernetes v1.16.7\r\nHelm : v2.16.1\r\n \r\n\r\n - OS:\r\ncentos 7 for master kubernetes nodes\r\nNvidia DGX OS 4 (based on Ubuntu 18.04) for the worker nodes\r\n - Version\r\n -  0.11 of Juptyerhub\r\n\r\n</details>\r\n\r\n- <details><summary>Logs</summary>\r\n<!--\r\nNo errors logs by Jupyterhub itself, this is just relevant to the singleuser pod\r\n\r\n```\r\n# paste relevant logs here, if any\r\n```\r\n</details>\r\n\r\nIs there a way that we can force an `apt-upgrade` of the `ca-certificates` package when a single user pod is created / pulled? I thought apt upgrade / update would happen at this point anyway but this doesn't seem to happen. \r\n\r\nThe error is definitely local to single user instances as git commands work fine elsewhere, including master nodes and worker nodes on kubernetes. \r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2454/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2454/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2448", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2448/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2448/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2448/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2448", "id": 1032058686, "node_id": "I_kwDOBTx5m849g_c-", "number": 2448, "title": "Injecting config files into /usr/local/etc/jupyterhub/jupyterhub_config.d does not work for all configs", "user": {"login": "ihleonard-c3", "id": 13628019, "node_id": "MDQ6VXNlcjEzNjI4MDE5", "avatar_url": "https://avatars.githubusercontent.com/u/13628019?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ihleonard-c3", "html_url": "https://github.com/ihleonard-c3", "followers_url": "https://api.github.com/users/ihleonard-c3/followers", "following_url": "https://api.github.com/users/ihleonard-c3/following{/other_user}", "gists_url": "https://api.github.com/users/ihleonard-c3/gists{/gist_id}", "starred_url": "https://api.github.com/users/ihleonard-c3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ihleonard-c3/subscriptions", "organizations_url": "https://api.github.com/users/ihleonard-c3/orgs", "repos_url": "https://api.github.com/users/ihleonard-c3/repos", "events_url": "https://api.github.com/users/ihleonard-c3/events{/privacy}", "received_events_url": "https://api.github.com/users/ihleonard-c3/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2021-10-21T04:53:34Z", "updated_at": "2022-05-24T05:31:09Z", "closed_at": "2022-05-15T10:13:19Z", "author_association": "NONE", "active_lock_reason": null, "body": "I recently updated my chart dependency from 0.11 to 1.1.3. As part of this, I tried moving my jupyterhub_config python code, which had previously been in `extraConfig` to `extraFiles` and mounting it in /usr/local/etc/jupyterhub/jupyterhub_config.d. However, this resulted in my custom authenticator not being used as the authenticator for my hub. I believe that this is because you\r\n\r\n1. exec code in /usr/local/etc/jupyterhub/jupyterhub_config.d (https://github.com/jupyterhub/zero-to-jupyterhub-k8s/blob/main/jupyterhub/files/hub/jupyterhub_config.py#L439)\r\n2. update the main `c` config with values from `hub.config` (https://github.com/jupyterhub/zero-to-jupyterhub-k8s/blob/main/jupyterhub/files/hub/jupyterhub_config.py#L459)\r\n3. exec `extraConfig`.\r\n\r\nThe problem is that your values yaml specifies the authenticator_class (https://github.com/jupyterhub/zero-to-jupyterhub-k8s/blob/main/jupyterhub/values.yaml#L32). Is there a reason that the config in /usr/local/etc/jupyterhub/jupyterhub_config.d isn't executed after reading `hub.config`?\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2448/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2448/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2446", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2446/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2446/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2446/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2446", "id": 1029979780, "node_id": "PR_kwDOBTx5m84tXmPv", "number": 2446, "title": "idle-culler: fix the new restricted scopes to include read:servers", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2021-10-19T07:56:12Z", "updated_at": "2021-10-25T21:20:40Z", "closed_at": "2021-10-19T08:07:49Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2446", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2446", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2446.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2446.patch", "merged_at": "2021-10-19T08:07:49Z"}, "body": "Thank you @snickell for catching this and reporting it very clearly from https://github.com/jupyterhub/jupyterhub-idle-culler/issues/40!!! :heart: :tada:", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2446/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2446/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2439", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2439/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2439/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2439/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2439", "id": 1025920689, "node_id": "PR_kwDOBTx5m84tLXnE", "number": 2439, "title": "Add config singleuser.networkTools.resources - all containers must have configurable resources", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-10-14T04:02:52Z", "updated_at": "2021-10-14T04:32:52Z", "closed_at": "2021-10-14T04:32:52Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2439", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2439", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2439.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2439.patch", "merged_at": "2021-10-14T04:32:52Z"}, "body": "Closes #2428 by providing a way to configure the resource requests for the init container started by for user servers pods.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2439/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2439/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2434", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2434/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2434/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2434/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2434", "id": 1023892658, "node_id": "PR_kwDOBTx5m84tE3ju", "number": 2434, "title": "Fix implementation of restricted scopes for jupyterhub-idle-culler", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-10-12T14:28:12Z", "updated_at": "2021-10-12T15:08:31Z", "closed_at": "2021-10-12T15:08:31Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2434", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2434", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2434.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2434.patch", "merged_at": "2021-10-12T15:08:30Z"}, "body": "Closes #2407.\r\n\r\n- Add read:hub scope for idle-culler\r\n- Reduce servers scope to delete:servers scope for idle-culler\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2434/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2434/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2428", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2428/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2428/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2428/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2428", "id": 1017073484, "node_id": "I_kwDOBTx5m848n09M", "number": 2428, "title": "resourceQuotas plus blockWithIptables prevents user pods from spawning", "user": {"login": "athornton", "id": 2453165, "node_id": "MDQ6VXNlcjI0NTMxNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/2453165?v=4", "gravatar_id": "", "url": "https://api.github.com/users/athornton", "html_url": "https://github.com/athornton", "followers_url": "https://api.github.com/users/athornton/followers", "following_url": "https://api.github.com/users/athornton/following{/other_user}", "gists_url": "https://api.github.com/users/athornton/gists{/gist_id}", "starred_url": "https://api.github.com/users/athornton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/athornton/subscriptions", "organizations_url": "https://api.github.com/users/athornton/orgs", "repos_url": "https://api.github.com/users/athornton/repos", "events_url": "https://api.github.com/users/athornton/events{/privacy}", "received_events_url": "https://api.github.com/users/athornton/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-10-05T23:49:02Z", "updated_at": "2021-10-14T04:32:52Z", "closed_at": "2021-10-14T04:32:52Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\nIf you are using user namespaces with resourceQuotas set, then if you are also running with singleuser.cloudMetadata.blockWithIptables on, then the initContainer spawned to do the iptables magic won't spawn, because it lacks resource limits, and therefore the user pod will never spawn.\r\n\r\n#### Expected behaviour\r\nI expected to get a user pod...\r\n\r\n#### Actual behaviour\r\n...but I didn't.\r\n\r\n### Suggested solution\r\nSet resource limits on the initContainer.  It doesn't have much to do, so \"way smaller than any reasonable quota\" should work fine.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2428/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2428/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2421", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2421/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2421/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2421/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2421", "id": 1012271713, "node_id": "PR_kwDOBTx5m84sgt2V", "number": 2421, "title": "Fix proxy pod's liveness/readiness probes to be fully configurable", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-09-30T14:45:42Z", "updated_at": "2021-10-04T12:34:47Z", "closed_at": "2021-10-03T21:08:02Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2421", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2421", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2421.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2421.patch", "merged_at": "2021-10-03T21:08:02Z"}, "body": "We had values and schema documenting these, but we didn't have an actual implementation for the proxy pod active.\r\n\r\nCloses #2415.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2421/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2421/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2415", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2415/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2415/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2415/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2415", "id": 1009953605, "node_id": "I_kwDOBTx5m848MqtF", "number": 2415, "title": "proxy.chp.readinessProbe.failureThreshold is not used", "user": {"login": "mriedem", "id": 3237936, "node_id": "MDQ6VXNlcjMyMzc5MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/3237936?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mriedem", "html_url": "https://github.com/mriedem", "followers_url": "https://api.github.com/users/mriedem/followers", "following_url": "https://api.github.com/users/mriedem/following{/other_user}", "gists_url": "https://api.github.com/users/mriedem/gists{/gist_id}", "starred_url": "https://api.github.com/users/mriedem/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mriedem/subscriptions", "organizations_url": "https://api.github.com/users/mriedem/orgs", "repos_url": "https://api.github.com/users/mriedem/repos", "events_url": "https://api.github.com/users/mriedem/events{/privacy}", "received_events_url": "https://api.github.com/users/mriedem/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-09-28T16:18:24Z", "updated_at": "2021-10-03T21:08:02Z", "closed_at": "2021-10-03T21:08:02Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "\r\n### Bug description\r\n\r\nWe're using z2jh 0.11.1 and I was noticing chp probe failures in our deployment. One thing I noticed was the readiness probe config on the proxy pod does not match the failure threshold from the values file:\r\n\r\nhttps://github.com/jupyterhub/zero-to-jupyterhub-k8s/blob/0.11.1/jupyterhub/values.yaml#L202\r\n\r\nThis is from the pod:\r\n\r\n>Readiness:  http-get http://:http/_chp_healthz delay=0s timeout=1s period=2s #success=1 #failure=3\r\n\r\nIt looks like this is because `failureThreshold` isn't used in the `proxy` deployment template:\r\n\r\nhttps://github.com/jupyterhub/zero-to-jupyterhub-k8s/blob/0.11.1/jupyterhub/templates/proxy/deployment.yaml#L127-L140\r\n\r\n#### Expected behaviour\r\n\r\nI expected the failure threshold from the values file to be set on the readiness probe in the proxy (if the readiness probe is enabled, which it is by default).\r\n\r\n#### Actual behaviour\r\n\r\nThe failure threshold is the default 3 from k8s.\r\n\r\n### How to reproduce\r\n\r\nDeploy z2jh 0.11.1 with the chp proxy (default); looks like this is also an issue on the latest `main` branch commit.\r\n\r\n### Your personal set up\r\n\r\nShouldn't really matter for this issue, but we're running on IBM Cloud Container Service.\r\n\r\n----\r\n\r\nHaving said this, like the hub `readinessProbe`, since the proxy is a singleton having the readiness probe enabled is probably unnecessary and I'm guessing that's why the default `failureThreshold` is so high - because taking the proxy out of service doesn't help since it's the only one. So our workaround will likely just be to disable the chp proxy readiness probe (we also disable the hub readiness probe for the same reason).", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2415/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2415/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2402", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2402/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2402/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2402/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2402", "id": 1007209076, "node_id": "I_kwDOBTx5m848CMp0", "number": 2402, "title": "iPython Kernel Cannot Connect", "user": {"login": "chriscardillo", "id": 38569601, "node_id": "MDQ6VXNlcjM4NTY5NjAx", "avatar_url": "https://avatars.githubusercontent.com/u/38569601?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chriscardillo", "html_url": "https://github.com/chriscardillo", "followers_url": "https://api.github.com/users/chriscardillo/followers", "following_url": "https://api.github.com/users/chriscardillo/following{/other_user}", "gists_url": "https://api.github.com/users/chriscardillo/gists{/gist_id}", "starred_url": "https://api.github.com/users/chriscardillo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chriscardillo/subscriptions", "organizations_url": "https://api.github.com/users/chriscardillo/orgs", "repos_url": "https://api.github.com/users/chriscardillo/repos", "events_url": "https://api.github.com/users/chriscardillo/events{/privacy}", "received_events_url": "https://api.github.com/users/chriscardillo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 2089494150, "node_id": "MDU6TGFiZWwyMDg5NDk0MTUw", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/support", "name": "support", "color": "8fad22", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-09-25T22:16:16Z", "updated_at": "2021-09-25T22:20:23Z", "closed_at": "2021-09-25T22:20:23Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\n\r\nTrying to deploy [v1.1.3 of the JupyterHub Chart](https://jupyterhub.github.io/helm-chart/) on AKS. I am successfully able to use the GithubAuthenticator and spin up a Jupyter Notebook for myself, but the iPython Kernel won't connect.\r\n\r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\n\r\nI expect to be able to run Python code.\r\n\r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\n\r\nI am unable to run Python code. I try to run `2 + 2` and the kernel just hangs.\r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\nI am deploying on AKS, v1.1.3 of the JupyterHub Helm Chart. \r\n\r\nI am using Contour as my ingress controller.\r\n\r\nI am using JetStack's cert-manager to manage certificates. I have a ClusterIssuer named `letsencrypt-prod`.\r\n\r\nMy config.yaml looks like this:\r\n\r\n```\r\njupyterhub:\r\n  singleuser:\r\n    defaultUrl: \"/lab\"\r\n  hub:\r\n    db:\r\n      pvc:\r\n        storage: 8Gi\r\n    config:\r\n      GitHubOAuthenticator:\r\n        client_id: my-id\r\n        client_secret: my-secret\r\n        oauth_callback_url: https://hub.example.com/hub/oauth_callback\r\n      JupyterHub:\r\n        authenticator_class: github\r\n        Authenticator:\r\n          admin_users:\r\n            - chriscardillo\r\n  ingress:\r\n    enabled: true\r\n    annotations:\r\n      cert-manager.io/cluster-issuer: letsencrypt-prod\r\n      ingress.kubernetes.io/force-ssl-redirect: \"true\"\r\n      kubernetes.io/tls-acme: \"true\"\r\n    hosts:\r\n      - hub.example.com\r\n    tls:\r\n      - secretName: jupyterhub-tls\r\n        hosts:\r\n          - hub.example.com\r\n  proxy:\r\n    service:\r\n      type: ClusterIP\r\n```\r\n\r\n(I have testing a proxy service type of LoadBalancer, as well but it does not change anything)\r\n\r\n### Your personal set up\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n\r\n - OS: ubuntu 20.04\r\n <!-- [e.g. ubuntu 20.04, macOS 11.0] -->\r\n - Version(s): JupyterHub Helm Chart v1.1.3\r\n <!-- e.g. jupyterhub --version, python --version --->\r\n\r\n- <details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n\r\nN/A\r\n```\r\n# paste output of `pip freeze` or `conda list` here\r\n```\r\n</details>\r\n\r\n- <details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```\r\njupyterhub:\r\n  singleuser:\r\n    defaultUrl: \"/lab\"\r\n  hub:\r\n    db:\r\n      pvc:\r\n        storage: 8Gi\r\n    config:\r\n      GitHubOAuthenticator:\r\n        client_id: my-id\r\n        client_secret: my-secret\r\n        oauth_callback_url: https://hub.example.com/hub/oauth_callback\r\n      JupyterHub:\r\n        authenticator_class: github\r\n        Authenticator:\r\n          admin_users:\r\n            - chriscardillo\r\n  ingress:\r\n    enabled: true\r\n    annotations:\r\n      cert-manager.io/cluster-issuer: letsencrypt-prod\r\n      ingress.kubernetes.io/force-ssl-redirect: \"true\"\r\n      kubernetes.io/tls-acme: \"true\"\r\n    hosts:\r\n      - hub.example.com\r\n    tls:\r\n      - secretName: jupyterhub-tls\r\n        hosts:\r\n          - hub.example.com\r\n  proxy:\r\n    service:\r\n      type: ClusterIP\r\n```\r\n\r\n```python\r\n# jupyterhub_config.py\r\n```\r\n</details>\r\n\r\n- <details><summary>Logs</summary>\r\n<!--\r\nErrors are often logged by jupytehub. How you get logs depends on your deployment.\r\nWith kubernetes it might be:\r\n\r\n    kubectl get pod # hub pod name starts with hub...\r\n    kubectl logs hub-...\r\n    # or for a single-user server\r\n    kubectl logs jupyter-username\r\n\r\nOr the-littlest-jupyterhub:\r\n\r\n    journalctl -u jupyterhub\r\n    # or for a single-user server\r\n    journalctl -u jupyter-username\r\n-->\r\n\r\n```\r\n# paste relevant logs here, if any\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2402/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2402/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2400", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2400/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2400/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2400/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2400", "id": 1006735147, "node_id": "I_kwDOBTx5m848AY8r", "number": 2400, "title": "IngressClass", "user": {"login": "kfox1111", "id": 1513154, "node_id": "MDQ6VXNlcjE1MTMxNTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1513154?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kfox1111", "html_url": "https://github.com/kfox1111", "followers_url": "https://api.github.com/users/kfox1111/followers", "following_url": "https://api.github.com/users/kfox1111/following{/other_user}", "gists_url": "https://api.github.com/users/kfox1111/gists{/gist_id}", "starred_url": "https://api.github.com/users/kfox1111/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kfox1111/subscriptions", "organizations_url": "https://api.github.com/users/kfox1111/orgs", "repos_url": "https://api.github.com/users/kfox1111/repos", "events_url": "https://api.github.com/users/kfox1111/events{/privacy}", "received_events_url": "https://api.github.com/users/kfox1111/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-09-24T18:46:16Z", "updated_at": "2021-09-25T12:47:42Z", "closed_at": "2021-09-25T12:47:41Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\nNewer versions of Kubernetes require an ingressClassName property instead of the annotation. The current chart doesn't support specifying it.\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2400/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2400/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2399", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2399/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2399/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2399/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2399", "id": 1006216426, "node_id": "I_kwDOBTx5m847-aTq", "number": 2399, "title": "Upgrading k8s-hub image from 0.9->1.1.3 on AKS changes PVC syntax for named servers, thus creating new PV's and makes old storage unreachable by default", "user": {"login": "bjornarfjelldal", "id": 52956570, "node_id": "MDQ6VXNlcjUyOTU2NTcw", "avatar_url": "https://avatars.githubusercontent.com/u/52956570?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjornarfjelldal", "html_url": "https://github.com/bjornarfjelldal", "followers_url": "https://api.github.com/users/bjornarfjelldal/followers", "following_url": "https://api.github.com/users/bjornarfjelldal/following{/other_user}", "gists_url": "https://api.github.com/users/bjornarfjelldal/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjornarfjelldal/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjornarfjelldal/subscriptions", "organizations_url": "https://api.github.com/users/bjornarfjelldal/orgs", "repos_url": "https://api.github.com/users/bjornarfjelldal/repos", "events_url": "https://api.github.com/users/bjornarfjelldal/events{/privacy}", "received_events_url": "https://api.github.com/users/bjornarfjelldal/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2021-09-24T08:29:42Z", "updated_at": "2022-05-16T12:30:06Z", "closed_at": "2022-05-16T12:30:06Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n\r\nHi, guys! Thanks for a great tool and for your great work maintaining and developing it. I have encountered a bug:\r\n\r\nWhen upgrading the k8s-hub image from version 0.9 to 1.1.3, the persistant volume claim syntax on named servers on Azure changes from \"**claim-username-servername**\" to \"**claim-usernameservername**\".\r\n\r\nThis causes new PVC's and corresponding PV's to be created, and the old ones are no longer mounted - giving uses the impression that all files are gone.\r\n\r\nWhen downgrading the k8s-hub image, I verify that the old syntax is again used, and the old PV's are mounted again.\r\n\r\n\r\n#### Expected behaviour\r\n\r\nThe same PVC should be used mounting the same PV as before\r\n\r\n#### Actual behaviour\r\n\r\nA new PVC is created, creating a new PV\r\n\r\n### How to reproduce\r\n\r\n1. Use the jupyterhub/k8s-hub image with the tag 0.9.0 on an Azure Kubernetes Service following the excellent zero-to-kubernetes guide.\r\n2. Enable \"named servers\", and create a server with a given user logged in. The perisant volume claim name should then be \"claim-username-servername\"\r\n3. Upgrade the k8s-hub image to 1.1.3 (I have no idea where this change was introduced, but this is the version I upgraded to) and re-deploy\r\n4. Start the same server previously created in step 2. A new PVC is then created with the name \"claim-usernameservername\", and the old PVC/PV is unreachable without manual configuration.\r\n5. \r\n### Your personal set up\r\n\r\nAzure Kubernetes Service (AKS) and Azure Container Registry (ACR), following the zero-to-kubernetes guide.\r\n\r\nk8s-hub image is locally built with a nativeauthenticator as per Dockerfile below, before pushed to ACR:\r\n```\r\n\r\nFROM jupyterhub/k8s-hub:1.1.3\r\nUSER root\r\n\r\nRUN mkdir -p /srv/auth\r\n\r\nRUN git clone https://github.com/jupyterhub/nativeauthenticator.git /srv/auth\r\n\r\nRUN pip install --no-cache -e /srv/auth\r\n\r\nUSER jovyan\r\n```\r\n\r\nThen it is referred to in the config.yaml:\r\n\r\n```\r\nhub:\r\n  image: \r\n    name: myacr.azurecr.io/jupyterhub/jupyterhub_native_auth\r\n    tag: 1.1.3\r\n```\r\n\r\nAnd updated using the latest helm chart repo:\r\n\r\n```\r\nhelm upgrade --cleanup-on-fail \\\r\n  --install jupyterhub jupyterhub/jupyterhub \\\r\n  --namespace jupyterhub \\\r\n  --create-namespace \\\r\n  --version=1.1.3 \\\r\n  --values config.yaml\r\n```\r\n\r\nLet me know if more info is needed. I think it should be reproducable with what I have provided.\r\n\r\nAgain, thanks for your effort in this project!", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2399/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2399/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2391", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2391/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2391/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2391/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2391", "id": 1000311042, "node_id": "I_kwDOBTx5m847n4kC", "number": 2391, "title": "Using CSI driver from openebs fails to mount PVCs", "user": {"login": "Atharex", "id": 2872241, "node_id": "MDQ6VXNlcjI4NzIyNDE=", "avatar_url": "https://avatars.githubusercontent.com/u/2872241?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Atharex", "html_url": "https://github.com/Atharex", "followers_url": "https://api.github.com/users/Atharex/followers", "following_url": "https://api.github.com/users/Atharex/following{/other_user}", "gists_url": "https://api.github.com/users/Atharex/gists{/gist_id}", "starred_url": "https://api.github.com/users/Atharex/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Atharex/subscriptions", "organizations_url": "https://api.github.com/users/Atharex/orgs", "repos_url": "https://api.github.com/users/Atharex/repos", "events_url": "https://api.github.com/users/Atharex/events{/privacy}", "received_events_url": "https://api.github.com/users/Atharex/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-09-19T13:16:53Z", "updated_at": "2021-09-19T13:26:53Z", "closed_at": "2021-09-19T13:26:53Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\n\r\nRecently I've updated both OpenEBS as my storage provider to 2.12.1 using the cStor CSI plugin\r\nand ZTJH to 1.1.3\r\n\r\nIn these versions, the hub seems to give trouble connecting the openEBS PVC to the JH provisioned pod.\r\nWhen I spin up a user pod, I get the following warning output in kubectl describe pod:\r\n\r\n`2021-09-19T07:46:00Z [Warning] MountVolume.MountDevice failed for volume \"pvc-ed35b156-ec20-4708-b6d5-a2d946167e1b\" : kubernetes.io/csi: attacher.MountDevice failed to create newCsiDriverClient: driver name cstor.csi.openebs.io not found in the list of registered CSI drivers`\r\n\r\nThis warning seems to be a bit misleading, as I am successfully using the same provisioned PVCs for all other projects, except Jupyterhub. The CSI driver is loaded and available, but Jupyterhub for some reason does not load it:\r\n\r\n```\r\nkubectl get csidriver\r\nNAME                   ATTACHREQUIRED   PODINFOONMOUNT   MODES                  AGE\r\ncstor.csi.openebs.io   false            true             Persistent,Ephemeral   3d1h\r\n```\r\n\r\n#### Expected behaviour\r\nJupyterhub should use the provisioned PVC and successfully attach it to the user pod\r\n\r\n#### Actual behaviour\r\nJupyterhub throws a warning that this particular CSI driver is not found and then timeouts while failing to provision the prepared PVC to a user pod\r\n\r\n## # How to reproduce\r\nAttempt to install the helm charts \r\nZTJH - 1.1.3\r\nOpenEBS - 2.12.6 (with cStor persistent storage)\r\n\r\n### Your personal set up\r\nK8s version 1.19.10 and above mentioned helm charts\r\nCentos 7\r\nPython 3.8.9\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2391/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2391/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2389", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2389/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2389/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2389/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2389", "id": 998674777, "node_id": "I_kwDOBTx5m847hpFZ", "number": 2389, "title": "JupyterHub template customization; hub vs simpleuser logo and favicon images", "user": {"login": "sunkararp", "id": 10903166, "node_id": "MDQ6VXNlcjEwOTAzMTY2", "avatar_url": "https://avatars.githubusercontent.com/u/10903166?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sunkararp", "html_url": "https://github.com/sunkararp", "followers_url": "https://api.github.com/users/sunkararp/followers", "following_url": "https://api.github.com/users/sunkararp/following{/other_user}", "gists_url": "https://api.github.com/users/sunkararp/gists{/gist_id}", "starred_url": "https://api.github.com/users/sunkararp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sunkararp/subscriptions", "organizations_url": "https://api.github.com/users/sunkararp/orgs", "repos_url": "https://api.github.com/users/sunkararp/repos", "events_url": "https://api.github.com/users/sunkararp/events{/privacy}", "received_events_url": "https://api.github.com/users/sunkararp/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 2089494150, "node_id": "MDU6TGFiZWwyMDg5NDk0MTUw", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/support", "name": "support", "color": "8fad22", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-09-16T21:51:24Z", "updated_at": "2021-09-17T05:59:25Z", "closed_at": "2021-09-17T05:59:25Z", "author_association": "NONE", "active_lock_reason": null, "body": "We followed instructions #1266 to customize templates, it works great with few unpleasant surprises!!!\r\n\r\n- Admin page doesn't work, we are getting 404 for https://wjh.mydomain.com/hub/static/js/admin-react.js\r\n- We see our custom logo and favicon as long as the signed-in user stays in https://jh.mydomain.com/hub/... area\r\n- We see default logo and favicon when the signed-in user navigates to https://js.mydomain.truveta.com/user/... area\r\n\r\nA. How do we fix the Admin page?\r\n\r\nB.  How do we fix this behaviour? We want to have our logo and favicon to be displayed all the time.\r\n\r\nC.  Below is one alternate solution we tried for custom logo, this works great for both /hub/... vs /user/... areas. Is there such thing for favicon as well?\r\n```\r\nhub:\r\n  extraConfig:\r\n    logoConfig: |\r\n      import urllib.request\r\n      urllib.request.urlretrieve(\"https://externalsource/logo.png\", \"logo.png\")\r\n      c.JupyterHub.logo_file = '/srv/jupyterhub/logo.png'\r\n``` ", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2389/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2389/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2374", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2374/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2374/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2374/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2374", "id": 986504143, "node_id": "MDU6SXNzdWU5ODY1MDQxNDM=", "number": 2374, "title": "deprecated apiVersion for ingress", "user": {"login": "MattiasVahlberg", "id": 48249234, "node_id": "MDQ6VXNlcjQ4MjQ5MjM0", "avatar_url": "https://avatars.githubusercontent.com/u/48249234?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MattiasVahlberg", "html_url": "https://github.com/MattiasVahlberg", "followers_url": "https://api.github.com/users/MattiasVahlberg/followers", "following_url": "https://api.github.com/users/MattiasVahlberg/following{/other_user}", "gists_url": "https://api.github.com/users/MattiasVahlberg/gists{/gist_id}", "starred_url": "https://api.github.com/users/MattiasVahlberg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MattiasVahlberg/subscriptions", "organizations_url": "https://api.github.com/users/MattiasVahlberg/orgs", "repos_url": "https://api.github.com/users/MattiasVahlberg/repos", "events_url": "https://api.github.com/users/MattiasVahlberg/events{/privacy}", "received_events_url": "https://api.github.com/users/MattiasVahlberg/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2021-09-02T10:17:54Z", "updated_at": "2021-09-04T01:07:10Z", "closed_at": "2021-09-04T01:07:10Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\nWhen deploying jupyterhub helm chart with config.yaml containing ingress configuration it deploys an old apiVersion for ingress. \r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\nExpecting apiVersion for ingress object in Kubernetes to be\r\n```\r\napiVersion: networking.k8s.io/v1 \r\nkind: Ingress\r\n```\r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\nIngress apiVersion deployed is:\r\n```\r\napiVersion: extensions/v1beta1\r\nkind: Ingress\r\n```\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n1. `helm repo add jupyterhub https://jupyterhub.github.io/helm-chart/`\r\n2. `helm repo update`\r\n3. Create config.yaml:\r\n```\r\nproxy:\r\n  secretToken: \"xxxx\"\r\n  service:\r\n    type: ClusterIP\r\ningress:\r\n  enabled: true\r\n  annotations:\r\n    kubernetes.io/ingress.class: \"nginx\"\r\n    cert-manager.io/cluster-issuer: \"letsencrypt-prod\"\r\n    nginx.ingress.kubernetes.io/client-max-body-size: \"250m\"\r\n    nginx.ingress.kubernetes.io/proxy-body-size: \"250m\"\r\n  hosts: \r\n    - someurl.com\r\n  pathSuffix:\r\n  pathType: Prefix\r\n  tls: \r\n    - hosts:\r\n      - someurl.com\r\n      secretName: tls\r\n```\r\n5. Deploy to kubernetes:\r\n```\r\nhelm upgrade --cleanup-on-fail \\                              \r\n  --install jupyterhub jupyterhub/jupyterhub \\\r\n  --namespace <yournamespace> \\\r\n  --version=1.1.3 \\\r\n  --values config.yaml\r\n```\r\n6. Verify ingress: `kubectl -n <yournamespace> get ingress jupyterhub -o yaml`\r\n\r\n### Your personal set up\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\nAKS cluster version 1.19.11\r\nNGINX deployed with helm:\r\n - app version: `0.45.0`\r\n - chart version: `ingress-nginx-3.27.0`\r\n - OS:\r\n <!-- [e.g. ubuntu 20.04, macOS 11.0] -->\r\n - Version(s):\r\n Jupyterhub chart version: 1.1.3\r\nDefault installation except for ingress, followed https://zero-to-jupyterhub.readthedocs.io/en/latest/jupyterhub/installation.html#install-jupyterhub guide\r\n <!-- e.g. jupyterhub --version, python --version --->\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2374/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2374/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2366", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2366/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2366/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2366/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2366", "id": 980498729, "node_id": "MDU6SXNzdWU5ODA0OTg3Mjk=", "number": 2366, "title": "Nginx Ingress - Kernel stuck on Connecting", "user": {"login": "arghya18", "id": 17959519, "node_id": "MDQ6VXNlcjE3OTU5NTE5", "avatar_url": "https://avatars.githubusercontent.com/u/17959519?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arghya18", "html_url": "https://github.com/arghya18", "followers_url": "https://api.github.com/users/arghya18/followers", "following_url": "https://api.github.com/users/arghya18/following{/other_user}", "gists_url": "https://api.github.com/users/arghya18/gists{/gist_id}", "starred_url": "https://api.github.com/users/arghya18/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arghya18/subscriptions", "organizations_url": "https://api.github.com/users/arghya18/orgs", "repos_url": "https://api.github.com/users/arghya18/repos", "events_url": "https://api.github.com/users/arghya18/events{/privacy}", "received_events_url": "https://api.github.com/users/arghya18/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 2089494150, "node_id": "MDU6TGFiZWwyMDg5NDk0MTUw", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/support", "name": "support", "color": "8fad22", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-08-26T17:49:36Z", "updated_at": "2021-08-26T18:03:33Z", "closed_at": "2021-08-26T18:03:33Z", "author_association": "NONE", "active_lock_reason": null, "body": "I am running z2jh on EKS and trying to configure Ingress but facing error connecting to kernel, this works with LoadBalancer or NodePort service. For Ingress everything else is working except connecting with kernel\r\n\r\nMy ingress config looks like below\r\n\r\n```\r\ningress:\r\n  enabled: true\r\n  hosts: [\"<host_url>\"]\r\n```\r\n\r\nAnd my nginx ingress controller config is below\r\n```\r\ncontroller:\r\n  service:\r\n    targetPorts:\r\n      http: http\r\n      https: http\r\n    internal:\r\n      enabled: 'true'\r\n    annotations:\r\n      service.beta.kubernetes.io/aws-load-balancer-backend-protocol: \"http\"\r\n      service.beta.kubernetes.io/aws-load-balancer-ssl-ports: \"https\"\r\n      service.beta.kubernetes.io/aws-load-balancer-connection-idle-timeout: '3600'\r\n      service.beta.kubernetes.io/aws-load-balancer-internal: 'true'\r\n      service.beta.kubernetes.io/aws-load-balancer-ssl-cert: 'cert-arn'\r\n```\r\n\r\nError:\r\n```\r\n[W 2021-08-26 17:32:33.408 SingleUserNotebookApp log:189] 400 GET /user/11111/api/kernels/cd0584c0-c1db-4e3b-b84d-95a6a6a34c7c/channels?session_id=829bb706-cdc2-4d05-b4c4-523c1b15feec (11111@10.219.35.57) 5.52ms\r\n[W 2021-08-26 17:32:34.163 SingleUserNotebookApp log:189] 400 GET /user/11111/api/kernels/cd0584c0-c1db-4e3b-b84d-95a6a6a34c7c/channels?session_id=533997d2-0c61-4b92-85b7-5a561309c517 (11111@10.219.35.57) 2.08ms\r\n[W 2021-08-26 17:32:34.921 SingleUserNotebookApp log:189] 400 GET /user/11111/api/kernels/cd0584c0-c1db-4e3b-b84d-95a6a6a34c7c/channels?session_id=8982ed28-1250-48e4-9892-81325d9a7241 (11111@10.219.35.57) 1.99ms\r\n[W 2021-08-26 17:32:35.677 SingleUserNotebookApp log:189] 400 GET /user/11111/terminals/websocket/1 (11111@10.219.35.57) 1.34ms\r\n[W 2021-08-26 17:32:36.436 SingleUserNotebookApp handlers:366] Replacing stale connection: cd0584c0-c1db-4e3b-b84d-95a6a6a34c7c:829bb706-cdc2-4d05-b4c4-523c1b15feec\r\n[W 2021-08-26 17:32:43.872 SingleUserNotebookApp handlers:366] Replacing stale connection: a15bc2b9-f405-48bc-8114-6d3d37e5d854:65fcd46f-2e49-4dbc-9c04-52451a830cc5\r\n[W 2021-08-26 17:32:43.916 SingleUserNotebookApp handlers:366] Replacing stale connection: a15bc2b9-f405-48bc-8114-6d3d37e5d854:3721350b-f6f3-44ab-971f-cf0f0cd82ce9\r\n\r\n```\r\n\r\nI have also tried couple of config to enable websocket using annotation nginx.ingress.kubernetes.io/server-snippet but without any luck.\r\nI am not sure if its a bug or configuration issue but default config does not work and I looked into couple of post and discussion around it but nothing worked. ", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2366/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2366/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2357", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2357/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2357/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2357/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2357", "id": 975790008, "node_id": "MDU6SXNzdWU5NzU3OTAwMDg=", "number": 2357, "title": "Disable Istio injection by default on prePuller images", "user": {"login": "chriswreckla", "id": 79598840, "node_id": "MDQ6VXNlcjc5NTk4ODQw", "avatar_url": "https://avatars.githubusercontent.com/u/79598840?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chriswreckla", "html_url": "https://github.com/chriswreckla", "followers_url": "https://api.github.com/users/chriswreckla/followers", "following_url": "https://api.github.com/users/chriswreckla/following{/other_user}", "gists_url": "https://api.github.com/users/chriswreckla/gists{/gist_id}", "starred_url": "https://api.github.com/users/chriswreckla/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chriswreckla/subscriptions", "organizations_url": "https://api.github.com/users/chriswreckla/orgs", "repos_url": "https://api.github.com/users/chriswreckla/repos", "events_url": "https://api.github.com/users/chriswreckla/events{/privacy}", "received_events_url": "https://api.github.com/users/chriswreckla/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-08-20T17:21:06Z", "updated_at": "2021-08-31T20:51:29Z", "closed_at": "2021-08-31T20:51:29Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\nUsing the Istio service mesh, injecting sidecars on the image puller resources prevents the image prePuller hook from completing. A related issue [1830](https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1830) with a similar problem description does not resolve the problem.\r\n\r\n#### Expected behaviour\r\n\r\n<!-- Tell us what you thought would happen. -->\r\n(See output below) \r\n- hook-image-awaiter job shall complete\r\n- hook-image-awaiter and hook-image-puller pods shall terminate\r\n- Installation shall proceed\r\n\r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\n(See output below) \r\n- hook-image-awaiter job fails to complete.\r\n- hub, proxy, user-scheduler, and continuous-image-puller pods never start.\r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\n1. Set up a cluster\r\n2. Install Istio\r\n3. Install the Jupyterhub helm chart in a namespace labeled with Istio injection enabled\r\n4. Note that the hook-image-awaiter pod is stuck due to the image-awaiter process exiting after failure.\r\n`[ERR] GET https://kubernetes.default.svc:443/apis/apps/v1/namespaces/<NAMESPACE>/daemonsets/hook-image-puller request failed: Get \"https://kubernetes.default.svc:443/apis/apps/v1/namespaces/<NAMESPACE>/daemonsets/hook-image-puller\": dial tcp 10.43.0.1:443: connect: connection refused`\r\n5. Work-around: Kill the `hook-image-awaiter` job and the installation completes successfully.\r\n\r\n### Proposed Solution\r\n\r\nUpdate helm `values.yaml` with prePuller annotations since Istio injection will never work with the  `hook-image-awaiter`:\r\n```\r\nprePuller:\r\n  annotations:\r\n    sidecar.istio.io/inject: \"false\"\r\n```\r\n\r\n### Your personal set up\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n- Kubernetes RKE2 nodes runnning `RHEL 8.3` with Kubelet version = `v.1.20.6+rke2r1`\r\n\r\n - JupyterHub Container OS: `RHEL 8.4`\r\n <!-- [e.g. ubuntu 20.04, macOS 11.0] -->\r\n - Version(s): `jupyterhub --version = 1.4.0`\r\n <!-- e.g. jupyterhub --version, python --version --->\r\n\r\n- <details><summary>Full environment</summary> \r\n`jupyterhub/zero-to-jupyterhub-k8s v0.11.1`\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\n# paste output of `pip freeze` or `conda list` here\r\npip freeze\r\nalembic==1.5.8\r\nasync-generator==1.10\r\nattrs==20.3.0\r\nbcrypt==3.2.0\r\ncachetools==4.2.1\r\ncertifi==2020.12.5\r\ncertipy==0.1.3\r\ncffi==1.14.5\r\nchardet==4.0.0\r\ncryptography==3.4.6\r\nentrypoints==0.3\r\nescapism==1.0.1\r\ngoogle-auth==1.28.0\r\ngreenlet==1.0.0\r\nidna==2.10\r\nipython-genutils==0.2.0\r\nJinja2==2.11.3\r\njsonschema==3.2.0\r\njupyter-telemetry==0.1.0\r\njupyterhub==1.4.0\r\njupyterhub-firstuseauthenticator==0.14.1\r\njupyterhub-hmacauthenticator==1.0\r\njupyterhub-idle-culler==1.1\r\njupyterhub-kubespawner==0.16.1\r\njupyterhub-ldapauthenticator==1.3.2\r\njupyterhub-ltiauthenticator==1.0.0\r\njupyterhub-nativeauthenticator==0.0.7\r\njupyterhub-tmpauthenticator==0.6\r\nkubernetes==12.0.1\r\nldap3==2.9\r\nMako==1.1.4\r\nMarkupSafe==1.1.1\r\nmwoauth==0.3.7\r\nnullauthenticator==1.0.0\r\noauthenticator==0.13.0\r\noauthlib==3.1.0\r\nonetimepass==1.0.1\r\npamela==1.0.0\r\nprometheus-client==0.9.0\r\npsycopg2-binary==2.8.6\r\npy-spy==0.3.5\r\npyasn1==0.4.8\r\npyasn1-modules==0.2.8\r\npycparser==2.20\r\npycurl==7.43.0.6\r\nPyJWT==1.7.1\r\nPyMySQL==1.0.2\r\npyOpenSSL==20.0.1\r\npyrsistent==0.17.3\r\npython-dateutil==2.8.1\r\npython-editor==1.0.4\r\npython-json-logger==2.0.1\r\npython-slugify==4.0.1\r\nPyYAML==5.4.1\r\nrequests==2.25.1\r\nrequests-oauthlib==1.3.0\r\nrsa==4.7.2\r\nruamel.yaml==0.16.13\r\nruamel.yaml.clib==0.2.2\r\nsix==1.15.0\r\nSQLAlchemy==1.4.22\r\nsqlalchemy-cockroachdb==1.3.4\r\nstatsd==3.3.0\r\ntext-unidecode==1.3\r\ntornado==6.1\r\ntraitlets==5.0.5\r\nurllib3==1.26.6\r\nwebsocket-client==0.58.0\r\n```\r\n</details>\r\n\r\n## Installation without annotation\r\n```\r\nkubectl -n <NAMESPACE>  get all\r\nNAME                           READY   STATUS     RESTARTS   AGE\r\npod/hook-image-awaiter-rhb8h   1/2     NotReady   0          23s\r\npod/hook-image-puller-4cp9p    2/2     Running    0          23s\r\npod/hook-image-puller-4dn46    2/2     Running    0          22s\r\npod/hook-image-puller-f5xn4    2/2     Running    0          21s\r\npod/hook-image-puller-fbz5g    2/2     Running    0          22s\r\npod/hook-image-puller-v2nz6    2/2     Running    0          21s\r\npod/hook-image-puller-xmrtw    2/2     Running    0          21s\r\n\r\nNAME                               DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE\r\ndaemonset.apps/hook-image-puller   6         6         6       6            6           <none>          24s\r\n\r\nNAME                           COMPLETIONS   DURATION   AGE\r\njob.batch/hook-image-awaiter   0/1           23s        24s\r\n```\r\n```\r\nkubectl -n <NAMESPACE> logs pod/hook-image-awaiter-rhb8h -c hook-image-awaiter\r\n2021/08/20 17:08:25 [DEBUG] GET https://kubernetes.default.svc:443/apis/apps/v1/namespaces/<NAMESPACE>/daemonsets/hook-image-puller\r\n2021/08/20 17:08:25 [ERR] GET https://kubernetes.default.svc:443/apis/apps/v1/namespaces/<NAMESPACE>/daemonsets/hook-image-puller request failed: Get \"https://kubernetes.default.svc:443/apis/apps/v1/namespaces/<NAMESPACE>/daemonsets/hook-image-puller\": dial tcp 10.43.0.1:443: connect: connection refused\r\n2021/08/20 17:08:25 [DEBUG] GET https://kubernetes.default.svc:443/apis/apps/v1/namespaces/<NAMESPACE>/daemonsets/hook-image-puller: retrying in 5s (5 left)\r\n2021/08/20 17:08:30 [ERR] GET https://kubernetes.default.svc:443/apis/apps/v1/namespaces/<NAMESPACE>/daemonsets/hook-image-puller request failed: Get \"https://kubernetes.default.svc:443/apis/apps/v1/namespaces/<NAMESPACE>/daemonsets/hook-image-puller\": dial tcp 10.43.0.1:443: connect: connection refused\r\n2021/08/20 17:08:30 [DEBUG] GET https://kubernetes.default.svc:443/apis/apps/v1/namespaces/<NAMESPACE>/daemonsets/hook-image-puller: retrying in 10s (4 left)\r\n2021/08/20 17:08:40 6 image puller pods are ready out of the 6 currently scheduled and 6 desired number scheduled.\r\n2021/08/20 17:08:40 Image download on nodes awaited successfully: shutting down!\r\n```\r\n\r\n### Successful Installation\r\n```\r\nkubectl -n <NAMESPACE> get all\r\nNAME                                 READY   STATUS    RESTARTS   AGE\r\npod/continuous-image-puller-7tgcn    1/1     Running   0          63s\r\npod/continuous-image-puller-fgdtm    1/1     Running   0          61s\r\npod/continuous-image-puller-jc5d5    1/1     Running   0          60s\r\npod/continuous-image-puller-rg4vg    1/1     Running   0          61s\r\npod/continuous-image-puller-spsrg    1/1     Running   0          60s\r\npod/continuous-image-puller-sx96v    1/1     Running   0          60s\r\npod/hub-cbbb79687-nvqxv              1/1     Running   0          62s\r\npod/proxy-5d9664c749-qf8js           1/1     Running   0          62s\r\npod/user-scheduler-6f99b975c-8fckn   1/1     Running   0          62s\r\npod/user-scheduler-6f99b975c-kj8wx   1/1     Running   0          63s\r\n\r\nNAME                   TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE\r\nservice/hub            ClusterIP   10.43.34.15     <none>        8081/TCP   63s\r\nservice/proxy-api      ClusterIP   10.43.49.144    <none>        8001/TCP   63s\r\nservice/proxy-public   ClusterIP   10.43.176.237   <none>        80/TCP     63s\r\n\r\nNAME                                     DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE\r\ndaemonset.apps/continuous-image-puller   6         6         6       6            6           <none>          63s\r\n\r\nNAME                             READY   UP-TO-DATE   AVAILABLE   AGE\r\ndeployment.apps/hub              1/1     1            1           63s\r\ndeployment.apps/proxy            1/1     1            1           63s\r\ndeployment.apps/user-scheduler   2/2     2            2           63s\r\n\r\nNAME                                       DESIRED   CURRENT   READY   AGE\r\nreplicaset.apps/hub-cbbb79687              1         1         1       63s\r\nreplicaset.apps/proxy-5d9664c749           1         1         1       63s\r\nreplicaset.apps/user-scheduler-6f99b975c   2         2         2       63s\r\n\r\nNAME                                READY   AGE\r\nstatefulset.apps/user-placeholder   0/0     64s\r\n```\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2357/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2357/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2353", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2353/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2353/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2353/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2353", "id": 972684677, "node_id": "MDU6SXNzdWU5NzI2ODQ2Nzc=", "number": 2353, "title": "Need Support for Container Security Context Single user POD ", "user": {"login": "anurag4516", "id": 27914146, "node_id": "MDQ6VXNlcjI3OTE0MTQ2", "avatar_url": "https://avatars.githubusercontent.com/u/27914146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/anurag4516", "html_url": "https://github.com/anurag4516", "followers_url": "https://api.github.com/users/anurag4516/followers", "following_url": "https://api.github.com/users/anurag4516/following{/other_user}", "gists_url": "https://api.github.com/users/anurag4516/gists{/gist_id}", "starred_url": "https://api.github.com/users/anurag4516/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/anurag4516/subscriptions", "organizations_url": "https://api.github.com/users/anurag4516/orgs", "repos_url": "https://api.github.com/users/anurag4516/repos", "events_url": "https://api.github.com/users/anurag4516/events{/privacy}", "received_events_url": "https://api.github.com/users/anurag4516/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2021-08-17T13:21:14Z", "updated_at": "2022-01-10T08:24:17Z", "closed_at": "2022-01-10T08:24:17Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\n\r\nZ2JH only supports CSC at Hub Pod level. When we set something like \r\n\r\n```yaml\r\nhub:\r\n  containerSecurityContext:\r\n    runAsUser:  1234\r\n    runAsGroup: 4567\r\n    readOnlyRootFilesystem: true \r\n    allowPrivilegeEscalation: false\r\n```\r\n\r\nin values.yaml , hub is running with this Container Security Context , as well as Single user Pod notebook container also runs with same security context . As per Kubespawnner documentation setting below should help\r\n c.KubeSpawner.container_security_context ,\r\nBut somehow , this value is not picked up and its overriden via hub containerSecurityContext\r\n\r\n#### Expected behaviour\r\n\r\nShould be able to set  different CSC at both hub and single notebook container level . \r\n\r\n#### Actual behaviour\r\n\r\nOnly able to set value at hub level\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2353/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2353/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2343", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2343/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2343/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2343/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2343", "id": 962106976, "node_id": "MDExOlB1bGxSZXF1ZXN0NzA0OTQ1ODI3", "number": 2343, "title": "fix schema: hub.templateVars didn't accept configuration", "user": {"login": "MridulS", "id": 5363860, "node_id": "MDQ6VXNlcjUzNjM4NjA=", "avatar_url": "https://avatars.githubusercontent.com/u/5363860?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MridulS", "html_url": "https://github.com/MridulS", "followers_url": "https://api.github.com/users/MridulS/followers", "following_url": "https://api.github.com/users/MridulS/following{/other_user}", "gists_url": "https://api.github.com/users/MridulS/gists{/gist_id}", "starred_url": "https://api.github.com/users/MridulS/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MridulS/subscriptions", "organizations_url": "https://api.github.com/users/MridulS/orgs", "repos_url": "https://api.github.com/users/MridulS/repos", "events_url": "https://api.github.com/users/MridulS/events{/privacy}", "received_events_url": "https://api.github.com/users/MridulS/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2021-08-05T18:54:55Z", "updated_at": "2021-08-05T21:26:26Z", "closed_at": "2021-08-05T19:51:58Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2343", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2343", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2343.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2343.patch", "merged_at": "2021-08-05T19:51:58Z"}, "body": "While trying to set `templateVars` we can't set additionalProperties, this PR fixes that\r\n\r\nA minimal example\r\n```\r\nhub:\r\n  templateVars:\r\n    announcement: 'Some Text'\r\n```\r\n\r\nand deploying with\r\n```\r\nhelm upgrade --install jhub jupyterhub/jupyterhub --version=1.1.1 --values config.yaml\r\n```\r\n\r\nfails the lint with the current schema.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2343/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2343/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2333", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2333/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2333/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2333/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2333", "id": 954195737, "node_id": "MDU6SXNzdWU5NTQxOTU3Mzc=", "number": 2333, "title": "Jupyterhub pod (Z2JK Helm chart version 0.10.6)  does not start because it can not create the jupyterhub schema , its tables and other database objects when the database is deployed to Google Cloud SQL for Postgress", "user": {"login": "markcberman", "id": 2898355, "node_id": "MDQ6VXNlcjI4OTgzNTU=", "avatar_url": "https://avatars.githubusercontent.com/u/2898355?v=4", "gravatar_id": "", "url": "https://api.github.com/users/markcberman", "html_url": "https://github.com/markcberman", "followers_url": "https://api.github.com/users/markcberman/followers", "following_url": "https://api.github.com/users/markcberman/following{/other_user}", "gists_url": "https://api.github.com/users/markcberman/gists{/gist_id}", "starred_url": "https://api.github.com/users/markcberman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/markcberman/subscriptions", "organizations_url": "https://api.github.com/users/markcberman/orgs", "repos_url": "https://api.github.com/users/markcberman/repos", "events_url": "https://api.github.com/users/markcberman/events{/privacy}", "received_events_url": "https://api.github.com/users/markcberman/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-07-27T19:22:12Z", "updated_at": "2021-07-27T21:32:02Z", "closed_at": "2021-07-27T21:32:02Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\nJupyterhub pod (Z2JK Helm chart version 0.10.6)  does not start because it can not create the jupyterhub schema , its tables and other database objects when the database is deployed to Google Cloud SQL for Postgress. Here is the error message.\r\n\r\nsqlalchemy.exc.ProgrammingError: (psycopg2.errors.InvalidSchemaName) no schema has been selected to create in\r\n    LINE 2: CREATE TABLE alembic_version (\r\n                         ^\r\n    \r\n    [SQL: \r\n    CREATE TABLE alembic_version (\r\n    \tversion_num VARCHAR(32) NOT NULL, \r\n    \tCONSTRAINT alembic_version_pkc PRIMARY KEY (version_num)\r\n    )\r\n\r\nHere is some more context about the issue:\r\n\r\nWe are trying to redeploy Z2JK from scratch into a GKE development environment due to an accidental deletion of the jupyterhub schema and tables that is running in a shared Google Cloud SQL for Postgres cluster. Unfortunately, there is no reliable backup of the the \u201cjupyterhub\u201d schema, tables and data in our development environment. (We will fix that shortly.)\r\n\r\nWe deleted all of the Z2JK deployments, stateful sets, jobs, pods, etc from the K8s namespace where Z2JK runs \u2013 and as I said the \u201cjupyterhub\u201d schema no longer exists because it was accidentally deleted from our Google Cloud SQL for Postgres cluster.\r\n\r\nWe re-ran the Helm deployment.\r\n\r\nThe jupyterhub pod is failing with the following error message which states there is no schema for SQLAlchemy to create the alembic_version table in. Not sure what is going on as the initial Jupyterhub deployment created the \u201cjupyterhub\u201d schema and all of the tables and other database objects. \r\n\r\n\r\n#### Expected behaviour\r\nThe Jupyterhub pod should automatically recreate it's schema, tables and database objects if the schema is missing from the database.\r\n\r\n#### Actual behaviour\r\nJupyterhub pod does not start because it can not create the jupyterhub schema, it tables and other database objects.  Here is the error message.\r\n\r\nsqlalchemy.exc.ProgrammingError: (psycopg2.errors.InvalidSchemaName) no schema has been selected to create in\r\n    LINE 2: CREATE TABLE alembic_version (\r\n                         ^\r\n    \r\n    [SQL: \r\n    CREATE TABLE alembic_version (\r\n    \tversion_num VARCHAR(32) NOT NULL, \r\n    \tCONSTRAINT alembic_version_pkc PRIMARY KEY (version_num)\r\n    )\r\n\r\n### How to reproduce\r\nInstall  Z2JK with a database running in a non-memory datastore (Postgres or any other database compatible with Jupyterhub).\r\nDelete the database.\r\nDelete the hub' deployment -- which in turn will delete the hub's replicaset and pod.\r\nRedeploy Z2JK using the Helm chart. This will result in a new hub deployment, replica set and pod\r\n\r\n### Your personal set up\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n\r\nZ2JK helm chart version 0.10.6\r\nGKE 1.17\r\n\r\n```\r\n# paste output of `pip freeze` or `conda list` here\r\n```\r\n</details>\r\n\r\n- <details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```python\r\nCustom version of Kubespawner and custom version of OAUTH authenticator that works with ping federate.\r\n```\r\n</details>\r\n\r\n- <details><summary>Logs</summary>\r\n<!--\r\nErrors are often logged by jupytehub. How you get logs depends on your deployment.\r\nWith kubernetes it might be:\r\n\r\n    kubectl get pod # hub pod name starts with hub...\r\n    kubectl logs hub-...\r\n    # or for a single-user server\r\n    kubectl logs jupyter-username\r\n\r\nOr the-littlest-jupyterhub:\r\n\r\n    journalctl -u jupyterhub\r\n    # or for a single-user server\r\n    journalctl -u jupyter-username\r\n-->\r\n\r\n```\r\n [I 2021-07-27 10:47:25.221 alembic.runtime.migration migration:155] Context impl PostgresqlImpl.\r\n[I 2021-07-27 10:47:25.221 alembic.runtime.migration migration:158] Will assume transactional DDL.\r\n[E 2021-07-27 10:47:25.236 JupyterHub app:2844]\r\n    Traceback (most recent call last):\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/app.py\", line 2841, in launch_instance_async\r\n        await self.initialize(argv)\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/app.py\", line 2374, in initialize\r\n        self.init_db()\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/app.py\", line 1584, in init_db\r\n        self.session_factory = orm.new_session_factory(\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/orm.py\", line 880, in new_session_factory\r\n        check_db_revision(engine)\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/orm.py\", line 785, in check_db_revision\r\n        alembic.command.stamp(cfg, head)\r\n      File \"/usr/local/lib/python3.8/dist-packages/alembic/command.py\", line 581, in stamp\r\n        script.run_env()\r\n      File \"/usr/local/lib/python3.8/dist-packages/alembic/script/base.py\", line 489, in run_env\r\n        util.load_python_file(self.dir, \"env.py\")\r\n      File \"/usr/local/lib/python3.8/dist-packages/alembic/util/pyfiles.py\", line 98, in load_python_file\r\n        module = load_module_py(module_id, path)\r\n      File \"/usr/local/lib/python3.8/dist-packages/alembic/util/compat.py\", line 184, in load_module_py\r\n        spec.loader.exec_module(module)\r\n      File \"<frozen importlib._bootstrap_external>\", line 783, in exec_module\r\n      File \"<frozen importlib._bootstrap>\", line 219, in _call_with_frames_removed\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/alembic/env.py\", line 88, in <module>\r\n        run_migrations_online()\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/alembic/env.py\", line 82, in run_migrations_online\r\n        context.run_migrations()\r\n      File \"<string>\", line 8, in run_migrations\r\n      File \"/usr/local/lib/python3.8/dist-packages/alembic/runtime/environment.py\", line 846, in run_migrations\r\n        self.get_context().run_migrations(**kw)\r\n      File \"/usr/local/lib/python3.8/dist-packages/alembic/runtime/migration.py\", line 503, in run_migrations\r\n        self._ensure_version_table()\r\n      File \"/usr/local/lib/python3.8/dist-packages/alembic/runtime/migration.py\", line 442, in _ensure_version_table\r\n        self._version.create(self.connection, checkfirst=True)\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/sql/schema.py\", line 925, in create\r\n        bind._run_visitor(ddl.SchemaGenerator, self, checkfirst=checkfirst)\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/engine/base.py\", line 1656, in _run_visitor\r\n        visitorcallable(self.dialect, self, **kwargs).traverse_single(element)\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/sql/visitors.py\", line 145, in traverse_single\r\n        return meth(obj, **kw)\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/sql/ddl.py\", line 827, in visit_table\r\n        self.connection.execute(\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/engine/base.py\", line 1011, in execute\r\n        return meth(self, multiparams, params)\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/sql/ddl.py\", line 72, in _execute_on_connection\r\n        return connection._execute_ddl(self, multiparams, params)\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/engine/base.py\", line 1068, in _execute_ddl\r\n        ret = self._execute_context(\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/engine/base.py\", line 1316, in _execute_context\r\n        self._handle_dbapi_exception(\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/engine/base.py\", line 1510, in _handle_dbapi_exception\r\n        util.raise_(\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/util/compat.py\", line 182, in raise_\r\n        raise exception\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/engine/base.py\", line 1276, in _execute_context\r\n        self.dialect.do_execute(\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/engine/default.py\", line 593, in do_execute\r\n        cursor.execute(statement, parameters)\r\n    sqlalchemy.exc.ProgrammingError: (psycopg2.errors.InvalidSchemaName) no schema has been selected to create in\r\n    LINE 2: CREATE TABLE alembic_version (\r\n                         ^\r\n    \r\n    [SQL: \r\n    CREATE TABLE alembic_version (\r\n    \tversion_num VARCHAR(32) NOT NULL, \r\n    \tCONSTRAINT alembic_version_pkc PRIMARY KEY (version_num)\r\n    )\r\n    \r\n    ]\r\n    (Background on this error at: http://sqlalche.me/e/13/f405)\r\n    \r\n[D 2021-07-27 10:47:25.243 JupyterHub application:653] Exiting application: jupyterhub\r\n\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2333/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2333/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2327", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2327/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2327/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2327/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2327", "id": 950695364, "node_id": "MDExOlB1bGxSZXF1ZXN0Njk1MjA0NDY0", "number": 2327, "title": "fix hub.services schema regression from 1.1.0", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-07-22T13:53:30Z", "updated_at": "2021-07-22T14:11:43Z", "closed_at": "2021-07-22T14:11:43Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2327", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2327", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2327.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2327.patch", "merged_at": "2021-07-22T14:11:43Z"}, "body": "", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2327/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2327/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2318", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2318/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2318/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2318/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2318", "id": 946893428, "node_id": "MDExOlB1bGxSZXF1ZXN0NjkxOTg0MjYw", "number": 2318, "title": "Allow CHP to function in a IPv4 only and/or IPv6 only context", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-07-17T20:29:46Z", "updated_at": "2021-07-20T05:54:54Z", "closed_at": "2021-07-20T05:54:54Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2318", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2318", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2318.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2318.patch", "merged_at": "2021-07-20T05:54:54Z"}, "body": "# PR summary\r\n\r\nThis changes relies on CHP 4.5.0 that was patched with https://github.com/jupyterhub/configurable-http-proxy/pull/333 to be able to listen to all available network interfaces, IPv4, IPv6, or both.\r\n\r\n---\r\n\r\n# Outdated notes from debugging\r\n\r\nI note that code in CHP, that is influenced by how Z2JH configures CHP via flags, could potentially be set differently to avoid issues in different contextswhere IPv4/IPv6 either both or only one is available. I consider this due to the discussion in https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2254#issuecomment-878951182.\r\n\r\nI created this PR to trial if setting `--ip=` to a blank string would make a difference. I consider this because of @minrk's comment saying `Preferred usage is 0.0.0.0 for all IPv4 or '' for all-interfaces.` and was thinking that all-interfaces may potentially be either all IPv4 and IPv6 if both is available, or only IPv4 or IPv6 if only one of them are available. Then, I think we have a solution to #2254 that experience issues as `--ip=::` causes trouble if IPv6 is disabled.\r\n\r\n### Z2JH [code of relevance](https://github.com/jupyterhub/zero-to-jupyterhub-k8s/blob/04fcd411deee0a62a60876f62d824da81eb89420/jupyterhub/templates/proxy/deployment.yaml#L73-L75)\r\n\r\n```yaml\r\n          command:\r\n            - configurable-http-proxy\r\n            - \"--ip=::\"\r\n            - \"--api-ip=::\"\r\n```\r\n\r\n### CHP [code of relevance](https://github.com/jupyterhub/configurable-http-proxy/blob/94cd6f525d92e70a8412a191b9587e716edc18c9/bin/configurable-http-proxy#L310-L329)\r\n\r\nNote `args.ip` and `args.apiIp` etc map to `--ip` and `--api-ip` via a command line parser.\r\n\r\n```node\r\nvar listen = {};\r\nlisten.port = parseInt(args.port) || 8000;\r\nif (args.ip === \"*\") {\r\n  // handle ip=* alias for all interfaces\r\n  log.warn(\r\n    \"Interpreting ip='*' as all-interfaces. Preferred usage is 0.0.0.0 for all IPv4 or '' for all-interfaces.\"\r\n  );\r\n  args.ip = \"\";\r\n}\r\nlisten.ip = args.ip;\r\nlisten.apiIp = args.apiIp || \"localhost\";\r\nlisten.apiPort = args.apiPort || listen.port + 1;\r\nlisten.metricsIp = args.metricsIp || \"0.0.0.0\";\r\nlisten.metricsPort = args.metricsPort;\r\n\r\nproxy.proxyServer.listen(listen.port, listen.ip);\r\nproxy.apiServer.listen(listen.apiPort, listen.apiIp);\r\nif (listen.metricsPort) {\r\n  proxy.metricsServer.listen(listen.metricsPort, listen.metricsIp);\r\n}\r\n```\r\n\r\n### Outcome of setting `--ip=` and`--api-ip=`\r\n\r\n```\r\n### $ kubectl logs --all-containers deploy/proxy\r\n20:32:26.351 [ConfigProxy] info: Adding route / -> http://hub:8081\r\n20:32:26.359 [ConfigProxy] info: Proxying http://*:8000 to http://hub:8081\r\n20:32:26.359 [ConfigProxy] info: Proxy API at http://localhost:8001/api/routes\r\n20:32:26.361 [ConfigProxy] info: Route added / -> http://hub:8081\r\n```\r\n\r\nAh... But if we make the following modifications...\r\n\r\n```diff\r\n-listen.apiIp = args.apiIp || \"localhost\";\r\n+listen.apiIp = args.apiIp;\r\n```\r\n\r\n```\r\n### $ kubectl logs --all-containers deploy/proxy\r\n21:30:18.584 [ConfigProxy] info: Adding route / -> http://hub:8081\r\n21:30:18.592 [ConfigProxy] info: Proxying http://*:8000 to http://hub:8081\r\n21:30:18.593 [ConfigProxy] info: Proxy API at http://*:8001/api/routes\r\n21:30:18.594 [ConfigProxy] info: Route added / -> http://hub:8081\r\n```", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2318/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2318/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2317", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2317/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2317/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2317/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2317", "id": 946691003, "node_id": "MDExOlB1bGxSZXF1ZXN0NjkxODIyODQ1", "number": 2317, "title": "fix schema: accept proxy.traefik.extra[Static|Dynamic]Config", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-07-17T02:43:43Z", "updated_at": "2021-07-17T02:45:12Z", "closed_at": "2021-07-17T02:45:12Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2317", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2317", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2317.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2317.patch", "merged_at": "2021-07-17T02:45:12Z"}, "body": "The schema was too strict by mistake and didn't allow for any values to be passed to `proxy.traefik.extra[Static|Dynamic]Config`.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2317/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2317/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2310", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2310/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2310/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2310/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2310", "id": 942580052, "node_id": "MDExOlB1bGxSZXF1ZXN0Njg4MjkxOTEz", "number": 2310, "title": "fix: bug if z2jh is used as a dependency with an alias", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-07-13T01:01:54Z", "updated_at": "2021-07-13T01:07:29Z", "closed_at": "2021-07-13T01:07:29Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2310", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2310", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2310.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2310.patch", "merged_at": "2021-07-13T01:07:29Z"}, "body": "If z2jh was used as a dependency helm chart, and it had an alias, this bug would happen which make template rendering fail.\r\n\r\nAs an example, the following Chart.yaml would cause an error.\r\n\r\n```yaml\r\napiVersion: v2\r\ndescription: irrelevant\r\nname: irrelevant\r\nversion: 0.1.0\r\ndependencies:\r\n  - name: jupyterhub\r\n    version: \"1.0.1\"\r\n    repository: \"https://jupyterhub.github.io/helm-chart\"\r\n    alias: dep-chart-alias\r\n```\r\n\r\n```\r\nexecuting \"jupyterhub.fullname\" at <.Values.jupyterhub.fullnameOverride>: nil pointer evaluating interface {}.fullnameOverride\r\n```", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2310/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2310/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2301", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2301/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2301/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2301/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2301", "id": 935729104, "node_id": "MDU6SXNzdWU5MzU3MjkxMDQ=", "number": 2301, "title": "hub ssl verify error", "user": {"login": "Proger666", "id": 16278906, "node_id": "MDQ6VXNlcjE2Mjc4OTA2", "avatar_url": "https://avatars.githubusercontent.com/u/16278906?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Proger666", "html_url": "https://github.com/Proger666", "followers_url": "https://api.github.com/users/Proger666/followers", "following_url": "https://api.github.com/users/Proger666/following{/other_user}", "gists_url": "https://api.github.com/users/Proger666/gists{/gist_id}", "starred_url": "https://api.github.com/users/Proger666/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Proger666/subscriptions", "organizations_url": "https://api.github.com/users/Proger666/orgs", "repos_url": "https://api.github.com/users/Proger666/repos", "events_url": "https://api.github.com/users/Proger666/events{/privacy}", "received_events_url": "https://api.github.com/users/Proger666/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-07-02T12:34:46Z", "updated_at": "2021-07-03T08:32:31Z", "closed_at": "2021-07-03T08:32:31Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\nAfter fresh helm install of jupyterhub v1.0.1, i got an SSL error because hub could not verify self-signed certificate from k8s API:\r\n\r\n`WARNING:urllib3.connectionpool:Retrying (Retry(total=2, connect=None, read=None, redirect=None, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get issuer certificate (_ssl.c:1123)'))': /api/v1/namespaces/jupiter/pods?fieldSelector=&labelSelector=component%3Dsingleuser-server`\r\n\r\n \r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\nThis should be ignored.\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2301/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2301/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2297", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2297/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2297/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2297/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2297", "id": 933493766, "node_id": "MDExOlB1bGxSZXF1ZXN0NjgwNjkwODQy", "number": 2297, "title": "fix: downgrade traefik in autohttps pod to avoid a regression about ACME TLS acquisition", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-06-30T09:31:52Z", "updated_at": "2021-06-30T23:13:14Z", "closed_at": "2021-06-30T23:13:14Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": true, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2297", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2297", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2297.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2297.patch", "merged_at": null}, "body": "Closes https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2296.\r\n\r\nNot sure what goes on... Debugging a lot... I really really really dislike intermittent ACME cert acquisition issues...", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2297/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2297/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2296", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2296/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2296/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2296/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2296", "id": 933491667, "node_id": "MDU6SXNzdWU5MzM0OTE2Njc=", "number": 2296, "title": "1.0.1 updated traefik from v2.4.8 to v2.4.9 and introduced an upstream regression", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-06-30T09:29:20Z", "updated_at": "2021-07-06T17:14:12Z", "closed_at": "2021-07-06T17:14:11Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "### Bug description\r\n\r\nI've reported an issue in Traefik about a regression to acquire new TLS certificates when using version 2.4.9 instead of 2.4.8 as we do in z2jh 1.0.1: https://github.com/traefik/traefik/issues/8240\r\n\r\n#### Expected behaviour\r\n\r\nThe proxy.https.type=letsencrypt option to work properly... Bumping traefik minor versions haven't proven to be reliable... I should stop bumping traefik and only do it one every quarter or similar...\r\n\r\n#### Actual behaviour\r\nTLS cert acquisition fail like this in `autohttps` pods logs when having `debug.enabled=true` set.\r\n\r\n```\r\ntime=\"2021-06-30T08:51:43Z\" level=debug msg=\"legolog: [INFO] Deactivating auth: https://acme-staging-v02.api.letsencrypt.org/acme/authz-v3/78629711\"\r\ntime=\"2021-06-30T08:51:43Z\" level=debug msg=\"legolog: [INFO] Unable to deactivate the authorization: https://acme-staging-v02.api.letsencrypt.org/acme/authz-v3/78629711\"\r\ntime=\"2021-06-30T08:51:43Z\" level=error msg=\"Unable to obtain ACME certificate for domains \\\"hub.neurohackademy.org\\\" : unable to generate a certificate for the domains [hub.neurohackademy.org]: error: one or more domains had a problem:\\n[hub.neurohackademy.org] acme: error: 400 :: urn:ietf:params:acme:error:connection :: Fetching http://hub.neurohackademy.org/.well-known/acme-challenge/xiBRKmK3WjN0E8P3KBq3jeh1BZzOv8YK2xqZDRmY-BE: Connection refused\\n\" providerName=default.acme\r\n```", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2296/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2296/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2294", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2294/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2294/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2294/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2294", "id": 932967433, "node_id": "MDExOlB1bGxSZXF1ZXN0NjgwMjQ3NTMx", "number": 2294, "title": "Fix regression where hub.services require an apiToken to be specified", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-06-29T17:58:37Z", "updated_at": "2021-07-05T19:56:46Z", "closed_at": "2021-07-05T19:56:46Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": true, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2294", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2294", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2294.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2294.patch", "merged_at": null}, "body": "This is not a regression in Z2JH itself, but with JupyterHub 1.4.0 and 1.4.1, but it is fixed in current main branch. See https://github.com/jupyterhub/jupyterhub/pull/3531", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2294/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2294/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2293", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2293/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2293/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2293/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2293", "id": 932145380, "node_id": "MDExOlB1bGxSZXF1ZXN0Njc5NTM0NDM2", "number": 2293, "title": "Fix failure to set imagePullSecrets for user-placeholder pods (scheduling.userPlaceholder.image config added)", "user": {"login": "michaellzc", "id": 8373004, "node_id": "MDQ6VXNlcjgzNzMwMDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/8373004?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaellzc", "html_url": "https://github.com/michaellzc", "followers_url": "https://api.github.com/users/michaellzc/followers", "following_url": "https://api.github.com/users/michaellzc/following{/other_user}", "gists_url": "https://api.github.com/users/michaellzc/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaellzc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaellzc/subscriptions", "organizations_url": "https://api.github.com/users/michaellzc/orgs", "repos_url": "https://api.github.com/users/michaellzc/repos", "events_url": "https://api.github.com/users/michaellzc/events{/privacy}", "received_events_url": "https://api.github.com/users/michaellzc/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2021-06-29T02:27:17Z", "updated_at": "2021-06-29T15:49:33Z", "closed_at": "2021-06-29T15:49:32Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2293", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2293", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2293.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2293.patch", "merged_at": "2021-06-29T15:49:32Z"}, "body": "### Updated summary by Erik\r\n\r\n`prePuller.pause.image.name|tag` was used to set the user-placeholder pods image, but the user-placeholder pods didn't make use of the `prePuller.pause.image.pullPolicy|pullSecrets` or any other config to set imagePullPolicy or imagePullSecrets. With this PR the dedicated option `scheduling.userPlaceholer.image` and respective fields are added and respected for the user-placeholder pods.\r\n\r\n### Original PR summary\r\n\r\n`prePuller.pause.image.pullSecrets` was already defined in `values.yaml` but it was never actually used in the placeholder statefulset template.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2293/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2293/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2289", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2289/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2289/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2289/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2289", "id": 929977287, "node_id": "MDExOlB1bGxSZXF1ZXN0Njc3NzQ3NTE2", "number": 2289, "title": "Relax extraEnv schema to allow for array values", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-06-25T08:54:29Z", "updated_at": "2021-06-25T09:01:41Z", "closed_at": "2021-06-25T09:01:41Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2289", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2289", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2289.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2289.patch", "merged_at": "2021-06-25T09:01:40Z"}, "body": "This is a fix of a regression that stopped allowing extraEnv accepting lists. The recommended approach is to use a map, but lists were still supposed to be supported.\r\n\r\nCloses #2290", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2289/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2289/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2285", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2285/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2285/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2285/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2285", "id": 929686119, "node_id": "MDExOlB1bGxSZXF1ZXN0Njc3NTAwMDUy", "number": 2285, "title": "Relax hub.db.type schema to accept unknown database types", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-06-24T23:21:13Z", "updated_at": "2021-06-24T23:34:30Z", "closed_at": "2021-06-24T23:34:30Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2285", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2285", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2285.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2285.patch", "merged_at": "2021-06-24T23:34:30Z"}, "body": "Closes #2246 by allowing for `hub.db.type` schema to accept `other` as configuration.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2285/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2285/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2284", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2284/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2284/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2284/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2284", "id": 929680753, "node_id": "MDExOlB1bGxSZXF1ZXN0Njc3NDk1Mzc5", "number": 2284, "title": "templates: quote namespace in case they are only contain numbers", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-06-24T23:08:31Z", "updated_at": "2021-06-24T23:27:21Z", "closed_at": "2021-06-24T23:27:21Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2284", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2284", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2284.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2284.patch", "merged_at": "2021-06-24T23:27:21Z"}, "body": "I'm not sure we would be able to install the Helm chart in a namespace with only numbers in its name, but now there is a change it could work at least.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2284/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2284/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2276", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2276/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2276/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2276/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2276", "id": 928296120, "node_id": "MDExOlB1bGxSZXF1ZXN0Njc2MzIwNzcw", "number": 2276, "title": "Corrected scheduler rbac custom naming", "user": {"login": "v1r7u", "id": 1583399, "node_id": "MDQ6VXNlcjE1ODMzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1583399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/v1r7u", "html_url": "https://github.com/v1r7u", "followers_url": "https://api.github.com/users/v1r7u/followers", "following_url": "https://api.github.com/users/v1r7u/following{/other_user}", "gists_url": "https://api.github.com/users/v1r7u/gists{/gist_id}", "starred_url": "https://api.github.com/users/v1r7u/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/v1r7u/subscriptions", "organizations_url": "https://api.github.com/users/v1r7u/orgs", "repos_url": "https://api.github.com/users/v1r7u/repos", "events_url": "https://api.github.com/users/v1r7u/events{/privacy}", "received_events_url": "https://api.github.com/users/v1r7u/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-06-23T14:04:09Z", "updated_at": "2021-06-23T14:10:41Z", "closed_at": "2021-06-23T14:10:03Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2276", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2276", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2276.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2276.patch", "merged_at": "2021-06-23T14:10:03Z"}, "body": "Closes #2275", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2276/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2276/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2275", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2275/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2275/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2275/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2275", "id": 928291429, "node_id": "MDU6SXNzdWU5MjgyOTE0Mjk=", "number": 2275, "title": "User-scheduler role-binding uses hardcoded service-account name", "user": {"login": "v1r7u", "id": 1583399, "node_id": "MDQ6VXNlcjE1ODMzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1583399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/v1r7u", "html_url": "https://github.com/v1r7u", "followers_url": "https://api.github.com/users/v1r7u/followers", "following_url": "https://api.github.com/users/v1r7u/following{/other_user}", "gists_url": "https://api.github.com/users/v1r7u/gists{/gist_id}", "starred_url": "https://api.github.com/users/v1r7u/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/v1r7u/subscriptions", "organizations_url": "https://api.github.com/users/v1r7u/orgs", "repos_url": "https://api.github.com/users/v1r7u/repos", "events_url": "https://api.github.com/users/v1r7u/events{/privacy}", "received_events_url": "https://api.github.com/users/v1r7u/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-06-23T14:00:08Z", "updated_at": "2021-06-23T14:10:03Z", "closed_at": "2021-06-23T14:10:03Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Bug description\r\nUser-scheduler role-binding has hardcoded `user-scheduler` in the Service-Account name. If the name is overridden - the scheduler cannot connect to kube-api.\r\n\r\n#### Expected behaviour\r\nJupyterhub should be able to work from the box with customized names.\r\n\r\n#### Actual behaviour\r\nNo user pods could be scheduled, because scheduler is not authorized to connect to kube-api\r\n\r\n### How to reproduce\r\nTry to release helm chart with parameter `fullnameOverride: jupyterhub-1`\r\n\r\n### Your personal set up\r\n```\r\nKubernetes: v1.19.7\r\nHelm: v3.6.0\r\nJupyterhub chart: 0.11.1-1.0.0\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2275/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2275/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2254", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2254/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2254/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2254/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2254", "id": 922751337, "node_id": "MDU6SXNzdWU5MjI3NTEzMzc=", "number": 2254, "title": "Proxy pod fail to start when IPv6 is disabled (listen EAFNOSUPPORT: address family not supported)", "user": {"login": "JamesCarscadden", "id": 236038, "node_id": "MDQ6VXNlcjIzNjAzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/236038?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JamesCarscadden", "html_url": "https://github.com/JamesCarscadden", "followers_url": "https://api.github.com/users/JamesCarscadden/followers", "following_url": "https://api.github.com/users/JamesCarscadden/following{/other_user}", "gists_url": "https://api.github.com/users/JamesCarscadden/gists{/gist_id}", "starred_url": "https://api.github.com/users/JamesCarscadden/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JamesCarscadden/subscriptions", "organizations_url": "https://api.github.com/users/JamesCarscadden/orgs", "repos_url": "https://api.github.com/users/JamesCarscadden/repos", "events_url": "https://api.github.com/users/JamesCarscadden/events{/privacy}", "received_events_url": "https://api.github.com/users/JamesCarscadden/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 12, "created_at": "2021-06-16T15:17:14Z", "updated_at": "2021-07-21T11:51:30Z", "closed_at": "2021-07-21T11:51:30Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\nI am attempting to set up the Z2JH chart on a Raspberry PI (arm64) based cluster and am encountering some problems with the proxy (chp) pod. Specifically I am getting the following error:\r\n\r\nUncaught Exception: listen EAFNOSUPPORT: address family not supported :::8000\r\n\r\n#### Expected behaviour\r\nProxy pod should start up correctly\r\n\r\n#### Actual behaviour\r\nUncaught Exception: listen EAFNOSUPPORT: address family not supported :::8000\r\n\r\n### How to reproduce\r\nUse base Z2JH chart (v1.0.0) on an arm64 based cluster node using proxy service type of ClusterIP\r\n\r\n### Your personal set up\r\nKubernetes v1.21.1 running on Raspberry PI 4 (8Gb) 4 node cluster.\r\nBase OS is current version of Raspbian arm64 distribution\r\nCluster is using current versions of MetalLb and Flannel CNI\r\nUsing Helm to deploy the jupyterhub chart from https://jupyterhub.github.io/helm-chart/\r\n\r\nFull output from the proxy pod chp container:\r\n\r\n```\r\n15:00:24.322 [ConfigProxy] \u001b[32minfo\u001b[39m: Adding route / -> http://hub:8081\r\n15:00:24.343 [ConfigProxy] \u001b[32minfo\u001b[39m: Proxying http://:::8000 to http://hub:8081\r\n15:00:24.343 [ConfigProxy] \u001b[32minfo\u001b[39m: Proxy API at http://:::8001/api/routes\r\n15:00:24.361 [ConfigProxy] \u001b[31merror\u001b[39m: Uncaught Exception: listen EAFNOSUPPORT: address family not supported :::8000\r\n15:00:24.363 [ConfigProxy] \u001b[31merror\u001b[39m: Error: listen EAFNOSUPPORT: address family not supported :::8000\r\nat Server.setupListenHandle [as _listen2] (net.js:1301:21)\r\nat listenInCluster (net.js:1366:12)\r\nat doListen (net.js:1503:7)\r\nat processTicksAndRejections (internal/process/task_queues.js:83:21)\r\n15:00:24.363 [ConfigProxy] \u001b[31merror\u001b[39m: Uncaught Exception: listen EAFNOSUPPORT: address family not supported :::8001\r\n15:00:24.364 [ConfigProxy] \u001b[31merror\u001b[39m: Error: listen EAFNOSUPPORT: address family not supported :::8001\r\nat Server.setupListenHandle [as _listen2] (net.js:1301:21)\r\nat listenInCluster (net.js:1366:12)\r\nat doListen (net.js:1503:7)\r\nat processTicksAndRejections (internal/process/task_queues.js:83:21)\r\n15:00:24.365 [ConfigProxy] \u001b[32minfo\u001b[39m: Route added / -> http://hub:8081\r\n```\r\n\r\nThe pod ends up stuck in a CrashLoopBackoff\r\n\r\nI am using the following values for my helm deployment (using nginx-ingress, external-dns, and cert-manager for the ingress):\r\n\r\n```yaml\r\ningress:\r\n  enabled: true\r\n  hosts:\r\n    - jupyter.pi.<myhostname>\r\n  annotations:\r\n    kunernetes.io/ingress.class: nginx\r\n    external-dns.alpha.kubernetes.io/target: \"<my public IP address>\"\r\n  tls:\r\n    - hosts:\r\n      - jupyter.pi.<myhostname>\r\n      secretName: web-cert-wildcard\r\nproxy:\r\n  secretToken: <big ugly random value>\r\n  service:\r\n    type: ClusterIP\r\n```", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2254/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2254/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2253", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2253/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2253/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2253/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2253", "id": 922730350, "node_id": "MDU6SXNzdWU5MjI3MzAzNTA=", "number": 2253, "title": "Z2JH on Raspberry PI Cluster exec format error on pre puller", "user": {"login": "JamesCarscadden", "id": 236038, "node_id": "MDQ6VXNlcjIzNjAzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/236038?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JamesCarscadden", "html_url": "https://github.com/JamesCarscadden", "followers_url": "https://api.github.com/users/JamesCarscadden/followers", "following_url": "https://api.github.com/users/JamesCarscadden/following{/other_user}", "gists_url": "https://api.github.com/users/JamesCarscadden/gists{/gist_id}", "starred_url": "https://api.github.com/users/JamesCarscadden/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JamesCarscadden/subscriptions", "organizations_url": "https://api.github.com/users/JamesCarscadden/orgs", "repos_url": "https://api.github.com/users/JamesCarscadden/repos", "events_url": "https://api.github.com/users/JamesCarscadden/events{/privacy}", "received_events_url": "https://api.github.com/users/JamesCarscadden/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2021-06-16T15:00:05Z", "updated_at": "2021-07-06T17:18:36Z", "closed_at": "2021-07-06T17:18:36Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\nI am attempting to set up the Z2JH chart on a Raspberry PI (arm64) based cluster and am encountering some problems with the pre Puller job/pods. Specifically we get an exec format error (unsurprising since that container does not appear to have an arm64 version. \r\n\r\n#### Expected behaviour\r\nThese containers should have arm64 versions\r\n\r\n#### Actual behaviour\r\nexec format error due to no arm64 version\r\n\r\n### How to reproduce\r\nUse base Z2JH chart (v1.0.0) on an arm64 based cluster node\r\n\r\n### Your personal set up\r\nKubernetes v1.21.1 running on Raspberry PI 4 (8Gb) 4 node cluster.\r\nBase OS is current version of Raspbian arm64 distribution\r\nUsing Helm to deploy the jupyterhub chart from https://jupyterhub.github.io/helm-chart/\r\n\r\nThis issue can be worked around by setting\r\n\r\n```yaml\r\nprePuller:\r\n    hook:\r\n      enabled: false\r\n    continuous:\r\n      enabled: false\r\n```\r\n\r\nin the helm values", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2253/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2253/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2251", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2251/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2251/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2251/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2251", "id": 921427827, "node_id": "MDExOlB1bGxSZXF1ZXN0NjcwNDMxOTI2", "number": 2251, "title": "Fix fullnameOverride for Ingress & PriorityClass resources", "user": {"login": "v1r7u", "id": 1583399, "node_id": "MDQ6VXNlcjE1ODMzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1583399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/v1r7u", "html_url": "https://github.com/v1r7u", "followers_url": "https://api.github.com/users/v1r7u/followers", "following_url": "https://api.github.com/users/v1r7u/following{/other_user}", "gists_url": "https://api.github.com/users/v1r7u/gists{/gist_id}", "starred_url": "https://api.github.com/users/v1r7u/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/v1r7u/subscriptions", "organizations_url": "https://api.github.com/users/v1r7u/orgs", "repos_url": "https://api.github.com/users/v1r7u/repos", "events_url": "https://api.github.com/users/v1r7u/events{/privacy}", "received_events_url": "https://api.github.com/users/v1r7u/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-06-15T13:56:50Z", "updated_at": "2021-06-15T17:13:04Z", "closed_at": "2021-06-15T17:13:02Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2251", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2251", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2251.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2251.patch", "merged_at": "2021-06-15T17:13:02Z"}, "body": "Closes #2250, which blocks fullname-overrides with Ingress objects", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2251/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2251/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2250", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2250/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2250/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2250/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2250", "id": 921426401, "node_id": "MDU6SXNzdWU5MjE0MjY0MDE=", "number": 2250, "title": "Ingress object cannot be created when full-name is overridden", "user": {"login": "v1r7u", "id": 1583399, "node_id": "MDQ6VXNlcjE1ODMzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1583399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/v1r7u", "html_url": "https://github.com/v1r7u", "followers_url": "https://api.github.com/users/v1r7u/followers", "following_url": "https://api.github.com/users/v1r7u/following{/other_user}", "gists_url": "https://api.github.com/users/v1r7u/gists{/gist_id}", "starred_url": "https://api.github.com/users/v1r7u/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/v1r7u/subscriptions", "organizations_url": "https://api.github.com/users/v1r7u/orgs", "repos_url": "https://api.github.com/users/v1r7u/repos", "events_url": "https://api.github.com/users/v1r7u/events{/privacy}", "received_events_url": "https://api.github.com/users/v1r7u/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-06-15T13:55:26Z", "updated_at": "2021-06-15T17:13:02Z", "closed_at": "2021-06-15T17:13:02Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\nWhen the default naming is overridden, helm release fails because `Ingress` object has an invalid name.\r\n\r\n#### Expected behaviour\r\nI can override the default naming for jupyterhub releases with `Ingress` object.\r\n\r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\nThe ingress object has a naming pattern with a _minus sign_ at the end, like `{name-override}-`, which is not a valid dns name and kubernetes rejects it.\r\n\r\nThe rest of jupyterhub kubernetes objects append a string after `jupyterhub.fullname.dash`, while ingress object does not have it: https://github.com/jupyterhub/zero-to-jupyterhub-k8s/blob/main/jupyterhub/templates/_helpers-names.tpl#L177\r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\nTry to release helm chart with parameter `fullnameOverride: jupyterhub-1`\r\n\r\n### Your personal set up\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n```\r\nKubernetes: v1.19.7\r\nHelm: v3.6.0\r\nJupyterhub chart: 0.11.1-1.0.0\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2250/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2250/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2244", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2244/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2244/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2244/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2244", "id": 915650169, "node_id": "MDU6SXNzdWU5MTU2NTAxNjk=", "number": 2244, "title": "Clarify documentation about the culling configuration", "user": {"login": "cdibble", "id": 8380659, "node_id": "MDQ6VXNlcjgzODA2NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/8380659?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cdibble", "html_url": "https://github.com/cdibble", "followers_url": "https://api.github.com/users/cdibble/followers", "following_url": "https://api.github.com/users/cdibble/following{/other_user}", "gists_url": "https://api.github.com/users/cdibble/gists{/gist_id}", "starred_url": "https://api.github.com/users/cdibble/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cdibble/subscriptions", "organizations_url": "https://api.github.com/users/cdibble/orgs", "repos_url": "https://api.github.com/users/cdibble/repos", "events_url": "https://api.github.com/users/cdibble/events{/privacy}", "received_events_url": "https://api.github.com/users/cdibble/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2021-06-08T23:58:38Z", "updated_at": "2022-06-26T13:04:13Z", "closed_at": "2022-06-26T13:04:00Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\nThere might be more than one thing going on here, so happy to separate into multiple issues if appropriate.\r\n\r\nEDIT- there are two things going on indeed: see [this issue ](https://github.com/jupyterlab/jupyterlab/issues/6893) related to JupyterLab and failing to avoid culling active Lab servers.\r\nThis issue should focus on `idle-culler` and the problem of configuring to avoid culling named servers.\r\n\r\nI am seeing named servers culled after the timeout interval when that is set to false. This occurs with terminal processes running and the browser/client disconnected (i.e., on overnight jobs).\r\n\r\nMy `config.yaml` file used to install the official helm chart (v0.11.1) has the following cull configs:\r\n\r\n```\r\ncull:\r\n  enabled: true\r\n  users: false\r\n  removeNamedServers: false\r\n  timeout: 3600\r\n  every: 600\r\n  concurrency: 10\r\n  maxAge: 0\r\n```\r\nThe hub logs confirm this:\r\n```\r\n[I 210608 02:28:03 __init__:191] Culling server <user-name>/<server-instance-name> (inactive for 01:05:49)\r\n```\r\n\r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\nNamed servers would not be culled ever.\r\n\r\nServers with running terminal processes would not be culled.\r\n\r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\nAfter the configured interval, the culler kills the pods.\r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\nSee above snippet for the relevant portions of the `config.yaml` file. \r\n\r\n### Your personal set up\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\nRunning on AWS EKS with helm chart v0.11.1.\r\n\r\nThe `singleUser` image uses the base image `jupyter/datascience-notebook:python-3.8.8`\r\n\r\nOther images in helm:\r\n```\r\nhub:\r\n  image:\r\n    name: jupyterhub/k8s-hub\r\n    tag: 0.10.6-n211.h2e3a73af \r\n\r\nproxy:\r\n  chp:\r\n    image:\r\n      name: jupyterhub/configurable-http-proxy\r\n      tag: 4.3.2\r\n  traefik:\r\n    image:\r\n      name: traefik\r\n      tag: v2.4.8 \r\n\r\nsingleuser:\r\n  networkTools:\r\n    image:\r\n      name: jupyterhub/k8s-network-tools\r\n      tag: 0.11.1-n221.h84f79652 # \"set-by-chartpress\"\r\n\r\nscheduling:\r\n  userScheduler:\r\n    image:\r\n      name: k8s.gcr.io/kube-scheduler\r\n      tag: v1.19.10\r\n\r\nprePuller:\r\n  hook:\r\n    image:\r\n      name: jupyterhub/k8s-image-awaiter\r\n      tag: 0.11.1-n362.h81fdd6e0 # \"set-by-chartpress\"\r\n  pause:\r\n    image:\r\n      name: k8s.gcr.io/pause\r\n      tag: \"3.2\"\r\n```\r\n\r\n\r\n\r\n - OS:\r\n <!-- [e.g. ubuntu 20.04, macOS 11.0] -->\r\n - Version(s):\r\n <!-- e.g. jupyterhub --version, python --version --->\r\n\r\n- <details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\n# paste output of `pip freeze` or `conda list` here\r\n# this is truncated for brevity. can provide more details if needed.\r\njupyter-client                    6.1.12\r\njupyter-contrib-core              0.3.3\r\njupyter-contrib-nbextensions      0.5.1\r\njupyter-core                      4.7.1\r\njupyter-highlight-selected-word   0.2.0\r\njupyter-latex-envs                1.4.6\r\njupyter-nbextensions-configurator 0.4.1\r\njupyter-packaging                 0.10.1\r\njupyter-resource-usage            0.6.0\r\njupyter-server                    1.6.4\r\njupyter-server-mathjax            0.2.2\r\njupyter-telemetry                 0.1.0\r\njupyterhub                        1.4.0\r\njupyterlab                        3.0.14\r\njupyterlab-git                    0.30.1\r\njupyterlab-pygments               0.1.2\r\njupyterlab-server                 2.5.0\r\njupyterlab-widgets                1.0.0\r\nnbclient                          0.5.3\r\nnbconvert                         6.0.7\r\nnbdime                            3.1.0\r\nnbformat                          5.1.3\r\nnbgitpuller                       0.9.0\r\nnotebook                          6.3.0\r\nnteract-on-jupyter                2.1.3\r\noauthlib                          3.0.1\r\nprometheus-client                 0.10.1\r\nwidgetsnbextension                3.5.1\r\n```\r\n</details>\r\n\r\n- <details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```python\r\n# jupyterhub_config.py\r\n```\r\n</details>\r\n\r\n- <details><summary>Logs</summary>\r\n<!--\r\nErrors are often logged by jupytehub. How you get logs depends on your deployment.\r\nWith kubernetes it might be:\r\n\r\n    kubectl get pod # hub pod name starts with hub...\r\n    kubectl logs hub-...\r\n    # or for a single-user server\r\n    kubectl logs jupyter-username\r\n\r\nOr the-littlest-jupyterhub:\r\n\r\n    journalctl -u jupyterhub\r\n    # or for a single-user server\r\n    journalctl -u jupyter-username\r\n-->\r\n\r\n```\r\n# paste relevant logs here, if any\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2244/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2244/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2242", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2242/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2242/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2242/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2242", "id": 913483883, "node_id": "MDU6SXNzdWU5MTM0ODM4ODM=", "number": 2242, "title": "Change policy/v1beta1 to policy/v1 to resolve newer K8 issues", "user": {"login": "Bltzz", "id": 47246028, "node_id": "MDQ6VXNlcjQ3MjQ2MDI4", "avatar_url": "https://avatars.githubusercontent.com/u/47246028?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Bltzz", "html_url": "https://github.com/Bltzz", "followers_url": "https://api.github.com/users/Bltzz/followers", "following_url": "https://api.github.com/users/Bltzz/following{/other_user}", "gists_url": "https://api.github.com/users/Bltzz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Bltzz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Bltzz/subscriptions", "organizations_url": "https://api.github.com/users/Bltzz/orgs", "repos_url": "https://api.github.com/users/Bltzz/repos", "events_url": "https://api.github.com/users/Bltzz/events{/privacy}", "received_events_url": "https://api.github.com/users/Bltzz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2021-06-07T12:15:15Z", "updated_at": "2021-06-07T15:18:09Z", "closed_at": "2021-06-07T13:12:37Z", "author_association": "NONE", "active_lock_reason": null, "body": "\r\n### Bug description\r\nWhen I run: helm upgrade --cleanup-on-fail --install jupyter jupyterhub/jupyterhub --namespace jhub --create-namespace --version=0.11.1 --values config.yaml\r\n\r\nI get the following error:\r\n\r\nW0607 11:59:34.173526 3606783 warnings.go:70] policy/v1beta1 PodDisruptionBudget                                                 is deprecated in v1.21+, unavailable in v1.25+; use policy/v1 PodDisruptionBudg                                                et\r\n\r\nI assume, the\r\n\r\nzero-to-jupyterhub-k8s/jupyterhub/templates/proxy/pdb.yaml \r\n\r\nand \r\n\r\nzero-to-jupyterhub-k8s/jupyterhub/templates/scheduling/user-placeholder/pdb.yaml \r\n\r\nneeds to be changed\r\n\r\n#### Expected behaviour\r\nRun through installation process (as in the tutorial)\r\nhttps://zero-to-jupyterhub.readthedocs.io/en/latest/jupyterhub/installation.html\r\n\r\n#### Actual behaviour\r\nError mentioned above\r\n\r\n### How to reproduce\r\nuse K8 Verison mentioned below and follow tutorial\r\n\r\n### Your personal set up\r\nK8: Client Version: version.Info{Major:\"1\", Minor:\"21\", GitVersion:\"v1.21.1\", GitCom                                                mit:\"5e58841cce77d4bc13713ad2b91fa0d961e69192\", GitTreeState:\"clean\", BuildDate:                                                \"2021-05-12T14:18:45Z\", GoVersion:\"go1.16.4\", Compiler:\"gc\", Platform:\"linux/amd                                                64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"21\", GitVersion:\"v1.21.1\", GitCom                                                mit:\"5e58841cce77d4bc13713ad2b91fa0d961e69192\", GitTreeState:\"clean\", BuildDate:                                                \"2021-05-12T14:12:29Z\", GoVersion:\"go1.16.4\", Compiler:\"gc\", Platform:\"linux/amd                                                64\"}\r\n\r\n\r\n - OS:\r\nRed Hat Enterprise Linux release 8.2 (Ootpa)\r\n\r\n - Version(s):\r\n python 3.8 \r\njhub: latest, stable\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2242/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2242/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2238", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2238/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2238/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2238/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2238", "id": 910063286, "node_id": "MDU6SXNzdWU5MTAwNjMyODY=", "number": 2238, "title": " Proxy token must be a 32 byte random string generated with `openssl rand -hex 32`!", "user": {"login": "zouchengli", "id": 27568522, "node_id": "MDQ6VXNlcjI3NTY4NTIy", "avatar_url": "https://avatars.githubusercontent.com/u/27568522?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zouchengli", "html_url": "https://github.com/zouchengli", "followers_url": "https://api.github.com/users/zouchengli/followers", "following_url": "https://api.github.com/users/zouchengli/following{/other_user}", "gists_url": "https://api.github.com/users/zouchengli/gists{/gist_id}", "starred_url": "https://api.github.com/users/zouchengli/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zouchengli/subscriptions", "organizations_url": "https://api.github.com/users/zouchengli/orgs", "repos_url": "https://api.github.com/users/zouchengli/repos", "events_url": "https://api.github.com/users/zouchengli/events{/privacy}", "received_events_url": "https://api.github.com/users/zouchengli/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-06-03T03:40:06Z", "updated_at": "2021-06-03T09:00:57Z", "closed_at": "2021-06-03T09:00:11Z", "author_association": "NONE", "active_lock_reason": null, "body": "```\r\n helm install my-jupyterhub jupyterhub/jupyterhub --version 0.11.1\r\nWARNING: Kubernetes configuration file is group-readable. This is insecure. Location: /home/zouchengli/.kube/config\r\nWARNING: Kubernetes configuration file is world-readable. This is insecure. Location: /home/zouchengli/.kube/config\r\nError: execution error at (jupyterhub/templates/proxy/deployment.yaml:28:32): Proxy token must be a 32 byte random string generated with `openssl rand -hex 32`!\r\n```", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2238/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2238/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2234", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2234/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2234/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2234/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2234", "id": 903614545, "node_id": "MDU6SXNzdWU5MDM2MTQ1NDU=", "number": 2234, "title": "function \"dig\" not defined`", "user": {"login": "echarles", "id": 226720, "node_id": "MDQ6VXNlcjIyNjcyMA==", "avatar_url": "https://avatars.githubusercontent.com/u/226720?v=4", "gravatar_id": "", "url": "https://api.github.com/users/echarles", "html_url": "https://github.com/echarles", "followers_url": "https://api.github.com/users/echarles/followers", "following_url": "https://api.github.com/users/echarles/following{/other_user}", "gists_url": "https://api.github.com/users/echarles/gists{/gist_id}", "starred_url": "https://api.github.com/users/echarles/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/echarles/subscriptions", "organizations_url": "https://api.github.com/users/echarles/orgs", "repos_url": "https://api.github.com/users/echarles/repos", "events_url": "https://api.github.com/users/echarles/events{/privacy}", "received_events_url": "https://api.github.com/users/echarles/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2021-05-27T11:55:18Z", "updated_at": "2022-03-18T14:11:33Z", "closed_at": "2021-05-27T13:52:19Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\n\r\nDeploying the helm chart (latest main branch) with a go client, I hit\r\n\r\n`failed to install release: parse error at (jupyterhub/templates/hub/_helpers-passwords.tpl:35): function \"dig\" not defined`\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2234/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2234/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2208", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2208/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2208/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2208/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2208", "id": 894613544, "node_id": "MDExOlB1bGxSZXF1ZXN0NjQ2OTUwOTUz", "number": 2208, "title": "fix: remove no longer needed safeguard for enable_auth_state", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-05-18T17:28:35Z", "updated_at": "2021-05-18T17:37:54Z", "closed_at": "2021-05-18T17:37:54Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2208", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2208", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2208.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2208.patch", "merged_at": "2021-05-18T17:37:54Z"}, "body": "This fixes a bug where we could not properly use a seeded cookie secret because we had a failsafe checking that we explicitly had set a cookie secret. Since we now seed those secrets if they aren't explicitly set, this is no longer relevant.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2208/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2208/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2207", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2207/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2207/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2207/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2207", "id": 894604285, "node_id": "MDExOlB1bGxSZXF1ZXN0NjQ2OTQzMTkw", "number": 2207, "title": "fix: respect hub.config entries to override seeded secrets", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-05-18T17:16:22Z", "updated_at": "2021-05-18T17:22:40Z", "closed_at": "2021-05-18T17:22:40Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2207", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2207", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2207.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2207.patch", "merged_at": "2021-05-18T17:22:40Z"}, "body": "Self merging this to quicken up release process and avoid some merge conflicts after splitting apart a PR for readability.\r\n\r\nNote that `dig` is introduced in helm 3.5.0 (via a new version of `sprig`, a helper library). `dig` allow us to simplify logic to get nested values without making the logic ugly.\r\n\r\nCloses minor issue #2108. Publish test failure is unrelated.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2207/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2207/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2205", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2205/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2205/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2205/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2205", "id": 894340813, "node_id": "MDU6SXNzdWU4OTQzNDA4MTM=", "number": 2205, "title": "Doc bug: postgres connection string is not supported as of n495", "user": {"login": "jabbera", "id": 301208, "node_id": "MDQ6VXNlcjMwMTIwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/301208?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jabbera", "html_url": "https://github.com/jabbera", "followers_url": "https://api.github.com/users/jabbera/followers", "following_url": "https://api.github.com/users/jabbera/following{/other_user}", "gists_url": "https://api.github.com/users/jabbera/gists{/gist_id}", "starred_url": "https://api.github.com/users/jabbera/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jabbera/subscriptions", "organizations_url": "https://api.github.com/users/jabbera/orgs", "repos_url": "https://api.github.com/users/jabbera/repos", "events_url": "https://api.github.com/users/jabbera/events{/privacy}", "received_events_url": "https://api.github.com/users/jabbera/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-05-18T12:45:44Z", "updated_at": "2021-05-18T12:51:48Z", "closed_at": "2021-05-18T12:51:47Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\nAfter a clean install of n495 on x64 AKS I can't connect to my postgres JH database. \r\n\r\nThe example connection string in the documentation [here ](https://zero-to-jupyterhub.readthedocs.io/en/stable/resources/reference.html) is: \r\n\r\npostgres+psycopg2://<db-username>:<db-password>@<db-hostname>:<db-port>/<db-name>\r\n\r\nUsing this connection string yields the following error\r\n\r\n```\r\nsqlalchemy.exc.NoSuchModuleError: Can't load plugin: sqlalchemy.dialects:postgres.psycopg2\r\n```\r\n\r\nPer this SO https://stackoverflow.com/questions/62688256/sqlalchemy-exc-nosuchmoduleerror-cant-load-plugin-sqlalchemy-dialectspostgre that postgres needs to be postgresql and this indeed fixed my issue.\r\n\r\n### How to reproduce\r\n\r\nClean install of n495 with connection string from documentation.\r\n\r\n### Your personal set up\r\n\r\nAKS 1.20.5", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2205/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2205/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2204", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2204/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2204/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2204/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2204", "id": 894309648, "node_id": "MDU6SXNzdWU4OTQzMDk2NDg=", "number": 2204, "title": "Fresh install of n495 not working", "user": {"login": "jabbera", "id": 301208, "node_id": "MDQ6VXNlcjMwMTIwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/301208?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jabbera", "html_url": "https://github.com/jabbera", "followers_url": "https://api.github.com/users/jabbera/followers", "following_url": "https://api.github.com/users/jabbera/following{/other_user}", "gists_url": "https://api.github.com/users/jabbera/gists{/gist_id}", "starred_url": "https://api.github.com/users/jabbera/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jabbera/subscriptions", "organizations_url": "https://api.github.com/users/jabbera/orgs", "repos_url": "https://api.github.com/users/jabbera/repos", "events_url": "https://api.github.com/users/jabbera/events{/privacy}", "received_events_url": "https://api.github.com/users/jabbera/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-05-18T12:09:55Z", "updated_at": "2021-05-18T12:15:01Z", "closed_at": "2021-05-18T12:15:01Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n\r\nTrying to do a fresh install of: n495\r\n\r\n\r\n#### Expected behaviour\r\nChart should install\r\n\r\n#### Actual behaviour\r\nError: \r\n```\r\nError: template: jupyterhub/templates/hub/deployment.yaml:27:32: executing \"jupyterhub/templates/hub/deployment.yaml\" at <include (print .Template.BasePath \"/hub/configmap.yaml\") .>: error calling include: template: jupyterhub/templates/hub/configmap.yaml:30:33: executing \"jupyterhub/templates/hub/configmap.yaml\" at <include \"jupyterhub.imagePuller.daemonset.hook.checksum\" .>: error calling include: template: jupyterhub/templates/image-puller/_helpers-daemonset.tpl:212:14: executing \"jupyterhub.imagePuller.daemonset.hook.checksum\" at <merge (dict \"componentLabel\" \"pinned\" \"Chart\" (dict \"Name\" \"jupyterhub\" \"Version\" \"pinned\")) .>: error calling merge: reflect: call of reflect.Value.MapKeys on ptr Value\r\n\r\n```\r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\n              helm upgrade --install jhub jupyterhub/jupyterhub --version=0.11.1-n495.h232e257c \\\r\n                --values 00-config.yml --values 01-config-${{ parameters.environment }}.yml \\\r\n                --namespace jhub --timeout 15m \\\r\n               <SNIP>\r\n\r\n### Your personal set up\r\nAKS 1.20.5\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2204/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2204/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2201", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2201/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2201/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2201/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2201", "id": 892565642, "node_id": "MDExOlB1bGxSZXF1ZXN0NjQ1MjM5NTcw", "number": 2201, "title": "Pivot strategy (from breaking to non-breaking) to make our PriorityClass resources no longer be helm hook resources", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 2398426378, "node_id": "MDU6TGFiZWwyMzk4NDI2Mzc4", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/breaking", "name": "breaking", "color": "ad3727", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/milestones/7", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/milestone/7", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/milestones/7/labels", "id": 6105581, "node_id": "MDk6TWlsZXN0b25lNjEwNTU4MQ==", "number": 7, "title": "1.0.0", "description": "", "creator": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 19, "state": "open", "created_at": "2020-11-14T03:21:10Z", "updated_at": "2021-05-28T20:30:30Z", "due_on": null, "closed_at": null}, "comments": 1, "created_at": "2021-05-16T00:28:14Z", "updated_at": "2021-05-16T03:19:18Z", "closed_at": "2021-05-16T03:16:32Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2201", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2201", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2201.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2201.patch", "merged_at": "2021-05-16T03:16:32Z"}, "body": "In #2180 I was on the lookout for a test failure. When I didn't see it I assumed everything was fine, but it wasn't. The failure didn't happen because `scheduling.podPriority.enabled` wasn't explicitly set to true in `dev-config.yaml`.\r\n\r\nDue to this, #2180 introduced a breaking change after all. Instead of just reverting it fully, I've come up with a new strategy and to meet the goal that #2180 aimed for.\r\n\r\n### Goal\r\n\r\nI want to transition a Helm hook resource (kind: PriorityClass) to become a Helm chart managed resource. I want this transition a) without manual interventions, and b) without renaming the resource.\r\n\r\n### Strategy\r\n\r\nI've found that I can do that if the users make an upgrade in two steps:\r\n1. During a first upgrade add three ownership annotations/labels.\r\n2. During the second upgrade step remove all hook annotations and ownership annotations/labels.\r\n\r\nSee https://jacky-jiang.medium.com/import-existing-resources-in-helm-3-e27db11fd467 for more details.\r\n\r\n```yaml\r\n  annotations:\r\n    helm.sh/hook: pre-install,pre-upgrade\r\n    helm.sh/hook-delete-policy: before-hook-creation\r\n    helm.sh/hook-weight: \"-100\"\r\n\r\n    # step 1: I add these three ownership annotations/labels below\r\n    meta.helm.sh/release-name: {{ .Release.Name }}\r\n    meta.helm.sh/release-namespace: {{ .Release.Namespace }}\r\n  labels:\r\n    app.kubernetes.io/managed-by: Helm\r\n```\r\n\r\n### Background\r\n\r\nThe priorityclass resource was a helm hook as a workaround when an early version of helm didn't install the priorityclass before resources that referenced it.\r\n\r\n### Breaking change\r\n\r\nThis PR is supposed to remove a breaking change in #2180, but there remains a breaking change for anyone that...\r\n1. Is upgrading _from_ a version in the range of `0.11.1-n455.h487e27eb` (#2180) up to but excluding `0.11.1-n493.h7e3de5fb` (#2201 - this PR), to a later version, such as `1.0.0`.\r\n2. Have had `scheduling.podPriority.enabled=true`\r\n\r\nThey will experience that the hub pod isn't getting created, because the referenced priorityclass isn't available as can be observed by watching the events (`kubectl get events`).\r\n\r\n```\r\n4s          Warning   FailedCreate              replicaset/hub-74d7f49fd8              Error creating: pods \"hub-74d7f49fd8-\" is forbidden: no PriorityClass with name jupyterhub-default-priority was found\r\n```", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2201/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2201/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2189", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2189/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2189/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2189/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2189", "id": 886305738, "node_id": "MDU6SXNzdWU4ODYzMDU3Mzg=", "number": 2189, "title": "something is wrong with the documentation", "user": {"login": "parmentelat", "id": 4519227, "node_id": "MDQ6VXNlcjQ1MTkyMjc=", "avatar_url": "https://avatars.githubusercontent.com/u/4519227?v=4", "gravatar_id": "", "url": "https://api.github.com/users/parmentelat", "html_url": "https://github.com/parmentelat", "followers_url": "https://api.github.com/users/parmentelat/followers", "following_url": "https://api.github.com/users/parmentelat/following{/other_user}", "gists_url": "https://api.github.com/users/parmentelat/gists{/gist_id}", "starred_url": "https://api.github.com/users/parmentelat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/parmentelat/subscriptions", "organizations_url": "https://api.github.com/users/parmentelat/orgs", "repos_url": "https://api.github.com/users/parmentelat/repos", "events_url": "https://api.github.com/users/parmentelat/events{/privacy}", "received_events_url": "https://api.github.com/users/parmentelat/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-05-11T07:17:48Z", "updated_at": "2021-05-14T03:09:40Z", "closed_at": "2021-05-14T03:09:39Z", "author_association": "NONE", "active_lock_reason": null, "body": "at least one html page on rtd exhibits a couple occurrences of a formatting problem \r\n\r\nin\r\nhttps://zero-to-jupyterhub.readthedocs.io/en/stable/jupyterhub/installation.html\r\n\r\nI could spot stuff like the following; \r\n\r\n![image](https://user-images.githubusercontent.com/4519227/117774059-60b09f80-b239-11eb-8165-4b0846a1c182.png)\r\n\r\n![image](https://user-images.githubusercontent.com/4519227/117773885-2810c600-b239-11eb-992f-e7c399a94250.png)\r\n\r\n![image](https://user-images.githubusercontent.com/4519227/117773896-2cd57a00-b239-11eb-8fe2-ff64af1f65e7.png)\r\n\r\n\r\nlooking a bit further down the docs, I could find at least one similar issue in\r\nhttps://zero-to-jupyterhub.readthedocs.io/en/stable/jupyterhub/customizing/user-environment.html\r\n\r\nso it could well be a widespread problem\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2189/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2189/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2178", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2178/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2178/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2178/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2178", "id": 876904606, "node_id": "MDU6SXNzdWU4NzY5MDQ2MDY=", "number": 2178, "title": "Update documentation to ensure reproducible steps with helm", "user": {"login": "wilmeragsgh", "id": 10764342, "node_id": "MDQ6VXNlcjEwNzY0MzQy", "avatar_url": "https://avatars.githubusercontent.com/u/10764342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wilmeragsgh", "html_url": "https://github.com/wilmeragsgh", "followers_url": "https://api.github.com/users/wilmeragsgh/followers", "following_url": "https://api.github.com/users/wilmeragsgh/following{/other_user}", "gists_url": "https://api.github.com/users/wilmeragsgh/gists{/gist_id}", "starred_url": "https://api.github.com/users/wilmeragsgh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wilmeragsgh/subscriptions", "organizations_url": "https://api.github.com/users/wilmeragsgh/orgs", "repos_url": "https://api.github.com/users/wilmeragsgh/repos", "events_url": "https://api.github.com/users/wilmeragsgh/events{/privacy}", "received_events_url": "https://api.github.com/users/wilmeragsgh/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-05-05T22:20:21Z", "updated_at": "2021-05-14T03:11:14Z", "closed_at": "2021-05-14T03:11:14Z", "author_association": "NONE", "active_lock_reason": null, "body": "Thanks for this amazing project btw!\r\n\r\n### Bug description\r\nIn the documentation at: https://zero-to-jupyterhub.readthedocs.io/en/stable/jupyterhub/installation.html\r\nThe code snippet for helm upgrade points to version `0.10.6` whereas the stable version is `0.11.1`\r\nThis affects, for example, when testing authentication customizations where dummyAuth will overwrite the desired configuration.\r\n\r\n#### Expected behavior\r\nWith the up-to-date version in the doc, the steps will behave as described in the documentation without any issue.\r\n\r\n#### Actual behaviour\r\nRight now the configurations for auth (tested auth0 and github) get overwritten by dummyAuth.\r\n\r\n### How to reproduce\r\nTry to follow the current steps on the documentation and test adding auth0 or github.\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2178/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2178/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2174", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2174/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2174/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2174/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2174", "id": 875862749, "node_id": "MDExOlB1bGxSZXF1ZXN0NjMwMTE5NTgx", "number": 2174, "title": "fix: prePuller.hook.pullOnlyOnChanges didn't work, now it does", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-05-04T21:43:03Z", "updated_at": "2021-05-04T22:27:16Z", "closed_at": "2021-05-04T22:27:16Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2174", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2174", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2174.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2174.patch", "merged_at": "2021-05-04T22:27:16Z"}, "body": "Closes #2172 by the strategy described in https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2172#issuecomment-832234254.\r\n\r\nIn brief:\r\n1. the checksum of the hook-image-puller daemonset that was calculated became different based on from what template origin calculated the checksum as `.Templates.Name` changed which in turn influenced rendered labels.\r\n2. the checksum of the hook-image-puller daemonset that was calculated became different based on .Chart.Version as found in labels as well, which was irrelevant to re-pull on.\r\n3. the rbac resources used by hook-image-awaiter were created no matter what, but now they are created based on if the hook-image-awaiter job is created.\r\n\r\nNote though that we do want to pull again if something has changed about node affinity etc, so instead of just creating a list of the images it makes sense to still use a checksum of the k8s resource with some parts omitted, like the labels in the metadata section.\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2174/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2174/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2172", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2172/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2172/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2172/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2172", "id": 874420883, "node_id": "MDU6SXNzdWU4NzQ0MjA4ODM=", "number": 2172, "title": "prePuller.hook.pullOnlyOnChanges not pulling only on changes", "user": {"login": "yuvipanda", "id": 30430, "node_id": "MDQ6VXNlcjMwNDMw", "avatar_url": "https://avatars.githubusercontent.com/u/30430?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuvipanda", "html_url": "https://github.com/yuvipanda", "followers_url": "https://api.github.com/users/yuvipanda/followers", "following_url": "https://api.github.com/users/yuvipanda/following{/other_user}", "gists_url": "https://api.github.com/users/yuvipanda/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuvipanda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuvipanda/subscriptions", "organizations_url": "https://api.github.com/users/yuvipanda/orgs", "repos_url": "https://api.github.com/users/yuvipanda/repos", "events_url": "https://api.github.com/users/yuvipanda/events{/privacy}", "received_events_url": "https://api.github.com/users/yuvipanda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-05-03T09:54:04Z", "updated_at": "2021-05-04T23:34:31Z", "closed_at": "2021-05-04T22:27:16Z", "author_association": "COLLABORATOR", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n\r\nI've `prePuller.hook.pullOnlyOnChanges` (added in https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2066) set to true, but the hook prePuller is still being triggered for each deploy.\r\n\r\n\r\n### How to reproduce\r\nRelevant config is:\r\n\r\n```yaml\r\njupyterhub:\r\n  prePuller:\r\n    hook:\r\n      pullOnlyOnChanges: true\r\n```\r\n\r\nRunning helm upgrade with `--debug`, I get:\r\n\r\n```\r\nhistory.go:56: [debug] getting history for release r-staging\r\nupgrade.go:123: [debug] preparing upgrade for r-staging\r\nupgrade.go:131: [debug] performing update for r-staging\r\nupgrade.go:303: [debug] creating upgraded release for r-staging\r\nclient.go:282: [debug] Starting delete for \"r-staging-default-priority\" PriorityClass\r\nclient.go:122: [debug] creating 1 resource(s)\r\nclient.go:282: [debug] Starting delete for \"r-staging-user-placeholder-priority\" PriorityClass\r\nclient.go:122: [debug] creating 1 resource(s)\r\nclient.go:282: [debug] Starting delete for \"hook-image-puller\" DaemonSet\r\nclient.go:311: [debug] daemonsets.apps \"hook-image-puller\" not found\r\nclient.go:122: [debug] creating 1 resource(s)\r\nclient.go:282: [debug] Starting delete for \"hook-image-awaiter\" ServiceAccount\r\nclient.go:311: [debug] serviceaccounts \"hook-image-awaiter\" not found\r\nclient.go:122: [debug] creating 1 resource(s)\r\nclient.go:282: [debug] Starting delete for \"hook-image-awaiter\" Role\r\nclient.go:311: [debug] roles.rbac.authorization.k8s.io \"hook-image-awaiter\" not found\r\nclient.go:122: [debug] creating 1 resource(s)\r\nclient.go:282: [debug] Starting delete for \"hook-image-awaiter\" RoleBinding\r\nclient.go:311: [debug] rolebindings.rbac.authorization.k8s.io \"hook-image-awaiter\" not found\r\nclient.go:122: [debug] creating 1 resource(s)\r\nclient.go:282: [debug] Starting delete for \"hook-image-awaiter\" Job\r\nclient.go:311: [debug] jobs.batch \"hook-image-awaiter\" not found\r\nclient.go:122: [debug] creating 1 resource(s)\r\nclient.go:491: [debug] Watching for changes to Job hook-image-awaiter with timeout of 5m0s\r\nclient.go:519: [debug] Add/Modify event for hook-image-awaiter: ADDED\r\nclient.go:558: [debug] hook-image-awaiter: Jobs active: 1, jobs failed: 0, jobs succeeded: 0\r\nclient.go:519: [debug] Add/Modify event for hook-image-awaiter: MODIFIED\r\nclient.go:282: [debug] Starting delete for \"hook-image-puller\" DaemonSet\r\nclient.go:282: [debug] Starting delete for \"hook-image-awaiter\" ServiceAccount\r\nclient.go:282: [debug] Starting delete for \"hook-image-awaiter\" Role\r\nclient.go:282: [debug] Starting delete for \"hook-image-awaiter\" RoleBinding\r\nclient.go:282: [debug] Starting delete for \"hook-image-awaiter\" Job\r\nclient.go:201: [debug] checking 27 resources for changes\r\nclient.go:464: [debug] Looks like there are no changes for PodDisruptionBudget \"user-placeholder\"\r\nclient.go:464: [debug] Looks like there are no changes for PodDisruptionBudget \"user-scheduler\"\r\nclient.go:464: [debug] Looks like there are no changes for ServiceAccount \"hub\"\r\n...\r\n```\r\n\r\nThis just repeats, even with no changes at all.\r\n\r\n### Versions\r\n\r\nhelm version: v3.5.4\r\nkubernetes version: v1.18.16-gke.502\r\nz2jh version:  0.11.1-n438.h7e6a66e9 (master at time of bug report)", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2172/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2172/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2166", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2166/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2166/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2166/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2166", "id": 872652250, "node_id": "MDU6SXNzdWU4NzI2NTIyNTA=", "number": 2166, "title": "Large notebooks save fails with failed to fetch", "user": {"login": "barperez111", "id": 29413024, "node_id": "MDQ6VXNlcjI5NDEzMDI0", "avatar_url": "https://avatars.githubusercontent.com/u/29413024?v=4", "gravatar_id": "", "url": "https://api.github.com/users/barperez111", "html_url": "https://github.com/barperez111", "followers_url": "https://api.github.com/users/barperez111/followers", "following_url": "https://api.github.com/users/barperez111/following{/other_user}", "gists_url": "https://api.github.com/users/barperez111/gists{/gist_id}", "starred_url": "https://api.github.com/users/barperez111/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/barperez111/subscriptions", "organizations_url": "https://api.github.com/users/barperez111/orgs", "repos_url": "https://api.github.com/users/barperez111/repos", "events_url": "https://api.github.com/users/barperez111/events{/privacy}", "received_events_url": "https://api.github.com/users/barperez111/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-04-30T14:51:53Z", "updated_at": "2021-05-06T10:03:28Z", "closed_at": "2021-05-03T16:46:50Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\nHi!\r\nIm running zero to jhub on eks.\r\nwhen saving large notebooks (~50 mb) the corresponding /api/contents/Huge.ipynb?content=0&1619793 HTTP put request fails with connection reset (after something like 1 minute).\r\nrunning on a better network the request takes 40sec and file is saved properly \r\nWhen saving on The Littlest JupyterHub (on the *bad* network) request succeed after 2 minutes while on zero to jhub i get connection reset after 1 min. \r\n\r\nThis led me to think this is some sort of timeout issue, so i have increased timeouts for every component i could think about (the aws load balancer, the configurable http proxy,)\r\n\r\nI saw there was an issue regarding getting connection reset on kubernetes as a result of INVALID packets that are not dropped \r\n(see: https://kubernetes.io/blog/2019/03/29/kube-proxy-subtleties-debugging-an-intermittent-connection-reset/). i tried to configure conntrack to be liberal but that didn't work either. \r\n\r\nany suggestions?\r\n\r\nThnx a lot!\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2166/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2166/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2130", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2130/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2130/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2130/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2130", "id": 850903956, "node_id": "MDU6SXNzdWU4NTA5MDM5NTY=", "number": 2130, "title": "embedding a jupyterhub into an iframe \uff0c", "user": {"login": "day-code", "id": 69946103, "node_id": "MDQ6VXNlcjY5OTQ2MTAz", "avatar_url": "https://avatars.githubusercontent.com/u/69946103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/day-code", "html_url": "https://github.com/day-code", "followers_url": "https://api.github.com/users/day-code/followers", "following_url": "https://api.github.com/users/day-code/following{/other_user}", "gists_url": "https://api.github.com/users/day-code/gists{/gist_id}", "starred_url": "https://api.github.com/users/day-code/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/day-code/subscriptions", "organizations_url": "https://api.github.com/users/day-code/orgs", "repos_url": "https://api.github.com/users/day-code/repos", "events_url": "https://api.github.com/users/day-code/events{/privacy}", "received_events_url": "https://api.github.com/users/day-code/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-04-06T02:47:58Z", "updated_at": "2021-05-27T03:04:02Z", "closed_at": "2021-04-07T05:41:26Z", "author_association": "NONE", "active_lock_reason": null, "body": "\r\n![QQ\u622a\u56fe20210406110357](https://user-images.githubusercontent.com/69946103/113653202-f485cd80-96c7-11eb-861d-90174ebed520.png)\r\nbut still it show error while I run\r\nbecause an ancestor violates the following Content Security Policy directive: \"frame-ancestors *\".\r\n![QQ\u622a\u56fe20210406104655](https://user-images.githubusercontent.com/69946103/113651924-758f9580-96c5-11eb-8f70-9b3357a42c2b.png)\r\nPlease help me with this. thanks in advance.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2130/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2130/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2120", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2120/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2120/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2120/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2120", "id": 844089011, "node_id": "MDU6SXNzdWU4NDQwODkwMTE=", "number": 2120, "title": "hub.db.password doesn't work on 0.11.1", "user": {"login": "duongnt", "id": 759564, "node_id": "MDQ6VXNlcjc1OTU2NA==", "avatar_url": "https://avatars.githubusercontent.com/u/759564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/duongnt", "html_url": "https://github.com/duongnt", "followers_url": "https://api.github.com/users/duongnt/followers", "following_url": "https://api.github.com/users/duongnt/following{/other_user}", "gists_url": "https://api.github.com/users/duongnt/gists{/gist_id}", "starred_url": "https://api.github.com/users/duongnt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/duongnt/subscriptions", "organizations_url": "https://api.github.com/users/duongnt/orgs", "repos_url": "https://api.github.com/users/duongnt/repos", "events_url": "https://api.github.com/users/duongnt/events{/privacy}", "received_events_url": "https://api.github.com/users/duongnt/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2021-03-30T05:26:57Z", "updated_at": "2021-07-30T20:25:43Z", "closed_at": "2021-04-09T15:58:57Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\nhub.db.password doesn't work on 0.11.1, which is the latest stable release I could find. \r\n\r\nhub.db.password is set in the secret, however it's not picked up in jupyterhub_config.py (this looks like fixed in master, but it hasn't been released yet).\r\n\r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\nhub.db.password to work on a stable release. \r\n\r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\n1. Go to '...'\r\n2. Click on '....'\r\n3. Scroll down to '....'\r\n4. See error\r\n\r\n### Your personal set up\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n\r\n - OS:\r\n <!-- [e.g. ubuntu 20.04, macOS 11.0] -->\r\n - Version(s):\r\n <!-- e.g. jupyterhub --version, python --version --->\r\n\r\n- <details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\n# paste output of `pip freeze` or `conda list` here\r\n```\r\n</details>\r\n\r\n- <details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```python\r\n# jupyterhub_config.py\r\n```\r\n</details>\r\n\r\n- <details><summary>Logs</summary>\r\n<!--\r\nErrors are often logged by jupytehub. How you get logs depends on your deployment.\r\nWith kubernetes it might be:\r\n\r\n    kubectl get pod # hub pod name starts with hub...\r\n    kubectl logs hub-...\r\n    # or for a single-user server\r\n    kubectl logs jupyter-username\r\n\r\nOr the-littlest-jupyterhub:\r\n\r\n    journalctl -u jupyterhub\r\n    # or for a single-user server\r\n    journalctl -u jupyter-username\r\n-->\r\n\r\n```\r\n# paste relevant logs here, if any\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2120/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2120/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2102", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2102/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2102/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2102/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2102", "id": 832768316, "node_id": "MDU6SXNzdWU4MzI3NjgzMTY=", "number": 2102, "title": "Can't connect to jupyterhub managed services w/ url", "user": {"login": "kafonek", "id": 3867768, "node_id": "MDQ6VXNlcjM4Njc3Njg=", "avatar_url": "https://avatars.githubusercontent.com/u/3867768?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kafonek", "html_url": "https://github.com/kafonek", "followers_url": "https://api.github.com/users/kafonek/followers", "following_url": "https://api.github.com/users/kafonek/following{/other_user}", "gists_url": "https://api.github.com/users/kafonek/gists{/gist_id}", "starred_url": "https://api.github.com/users/kafonek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kafonek/subscriptions", "organizations_url": "https://api.github.com/users/kafonek/orgs", "repos_url": "https://api.github.com/users/kafonek/repos", "events_url": "https://api.github.com/users/kafonek/events{/privacy}", "received_events_url": "https://api.github.com/users/kafonek/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2021-03-16T12:53:33Z", "updated_at": "2021-04-16T13:50:59Z", "closed_at": "2021-04-16T13:50:59Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Bug description\r\nI am having trouble deploying a [Jupyterhub-managed service](https://jupyterhub.readthedocs.io/en/stable/reference/services.html#hub-managed-services) that exposes a `url`.  The configurable-http-proxy is unable to proxy to hosts `localhost`, `127.0.0.1`, or `0.0.0.0`.\r\n\r\n### How to reproduce\r\nRun a simple web server that copies syntax from [Tornado docs](https://www.tornadoweb.org/en/stable/#hello-world) and [`jupyterhub/examples/service-whoami`](https://github.com/jupyterhub/jupyterhub/tree/master/examples/service-whoami):\r\n\r\n```\r\n# config.yaml\r\nhub:\r\n  services:\r\n    hello:\r\n      admin: false\r\n      command: [\"python3\", \"hello.py\"]\r\n      url: 'http://127.0.0.1:8888'\r\n\r\n  extraFiles:\r\n    hello:\r\n      mountPath: /srv/jupyterhub/hello.py\r\n      stringData: |\r\n        import tornado.ioloop\r\n        import tornado.web\r\n\r\n        class MainHandler(tornado.web.RequestHandler):\r\n            def get(self):\r\n                self.write(\"Hello, world\")\r\n\r\n        def make_app():\r\n            return tornado.web.Application([\r\n                (r\"/?\", MainHandler),\r\n            ])\r\n\r\n        if __name__ == \"__main__\":\r\n            app = make_app()\r\n            app.listen(8888)\r\n            tornado.ioloop.IOLoop.current().start()\r\n```\r\n\r\nThe \"hello\" service shows up in the Jupyterhub web UI.  Kubectl logs for `deploy/hub` and `deploy/proxy` show the service being spawned, connected, and proxy routes set.\r\n\r\n```\r\n# kubectl logs deploy/proxy\r\n12:28:51.378 [ConfigProxy] info: Adding route /services/hello -> http://127.0.0.1:8888\r\n12:28:51.378 [ConfigProxy] info: Route added /services/hello -> http://127.0.0.1:8888\r\n12:28:51.379 [ConfigProxy] info: 201 POST /api/routes/services/hello \r\n```\r\n\r\nCurling `http://127.0.0.1:8888` while exec'd into the Hub pod works.  Trying to curl `http://proxy-public/services/hello` or opening the service in the web UI shows errors such as:\r\n\r\n```\r\n#kubectl logs deploy/proxy\r\n12:36:32.721 [ConfigProxy] debug: PROXY WEB /services/hello to http://127.0.0.1:8888\r\n12:36:32.722 [ConfigProxy] error: 503 GET /services/hello connect ECONNREFUSED 127.0.0.1:8888\r\n```\r\n### Alternative attempt - 0.0.0.0\r\nI tried changing the `hub.services.hello.url` to `0.0.0.0` and got a different error in `deploy/proxy` logs:\r\n\r\n```\r\n12:42:05.037 [ConfigProxy] info: Adding route /services/hello -> http://hub-74c5cf68bd-cdg5t:8888\r\n12:42:05.037 [ConfigProxy] info: Route added /services/hello -> http://hub-74c5cf68bd-cdg5t:8888\r\n12:42:05.037 [ConfigProxy] info: 201 POST /api/routes/services/hello \r\n12:42:23.838 [ConfigProxy] debug: PROXY WEB /services/hello/ to http://hub-74c5cf68bd-cdg5t:8888\r\n12:42:28.850 [ConfigProxy] error: 503 GET /services/hello/ Error: getaddrinfo EAI_AGAIN hub-74c5cf68bd-cdg5t\r\n    at GetAddrInfoReqWrap.onlookup [as oncomplete] (dns.js:67:26) {\r\n  errno: -3001,\r\n  code: 'EAI_AGAIN',\r\n  syscall: 'getaddrinfo',\r\n  hostname: 'hub-74c5cf68bd-cdg5t'\r\n}\r\n12:42:28.850 [ConfigProxy] debug: Requesting custom error page: http://hub:8081/hub/error/503?url=%2Fservices%2Fhello%2F\r\n12:42:28.875 [ConfigProxy] debug: Not recording activity for status 503 on /services/hello\r\n```\r\n\r\n### Your personal set up\r\nRunning from local (git clone) master branch of this repo.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2102/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2102/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2100", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2100/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2100/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2100/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2100", "id": 831772486, "node_id": "MDExOlB1bGxSZXF1ZXN0NTkzMDQxOTAx", "number": 2100, "title": "Fix mixup of hook/continuous-image-puller following recent PR", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-03-15T12:42:24Z", "updated_at": "2021-03-15T14:07:06Z", "closed_at": "2021-03-15T13:28:00Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2100", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2100", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2100.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2100.patch", "merged_at": "2021-03-15T13:28:00Z"}, "body": "Closes #2099 ", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2100/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2100/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2099", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2099/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2099/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2099/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2099", "id": 831757815, "node_id": "MDU6SXNzdWU4MzE3NTc4MTU=", "number": 2099, "title": "Hook pre-puller fails on master", "user": {"login": "yuvipanda", "id": 30430, "node_id": "MDQ6VXNlcjMwNDMw", "avatar_url": "https://avatars.githubusercontent.com/u/30430?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuvipanda", "html_url": "https://github.com/yuvipanda", "followers_url": "https://api.github.com/users/yuvipanda/followers", "following_url": "https://api.github.com/users/yuvipanda/following{/other_user}", "gists_url": "https://api.github.com/users/yuvipanda/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuvipanda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuvipanda/subscriptions", "organizations_url": "https://api.github.com/users/yuvipanda/orgs", "repos_url": "https://api.github.com/users/yuvipanda/repos", "events_url": "https://api.github.com/users/yuvipanda/events{/privacy}", "received_events_url": "https://api.github.com/users/yuvipanda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-03-15T12:23:29Z", "updated_at": "2021-03-15T13:28:00Z", "closed_at": "2021-03-15T13:28:00Z", "author_association": "COLLABORATOR", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n\r\nOn doing a helm upgrade, the `hook-image-awaiter` gets into error state, and does not allow the upgrade to complete. Logs indicate that the hook-image-puller daemonset was not created:\r\n\r\n```\r\n\u2570\u2500$ k -n biology-staging logs hook-image-awaiter-sm56p          \r\n2021/03/15 12:14:38 [DEBUG] GET https://kubernetes.default.svc:443/apis/apps/v1/namespaces/biology-staging/daemonsets/hook-image-puller\r\n2021/03/15 12:14:38 Can not parse API response as DaemonSet: {\"kind\":\"Status\",\"apiVersion\":\"v1\",\"metadata\":{},\"status\":\"Failure\",\"message\":\"daemonsets.apps \\\"hook-image-puller\\\" not found\",\"reason\":\"NotFound\",\"details\":{\"name\":\"hook-image-puller\",\"group\":\"apps\",\"kind\":\"daemonsets\"},\"code\":404}\r\n```\r\n\r\n### How to reproduce\r\n\r\nRun a z2jh master version, with base config in https://github.com/berkeley-dsep-infra/datahub/blob/staging/hub/values.yaml\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2099/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2099/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2096", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2096/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2096/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2096/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2096", "id": 830118833, "node_id": "MDU6SXNzdWU4MzAxMTg4MzM=", "number": 2096, "title": "AKS documentation pointing to google", "user": {"login": "jabbera", "id": 301208, "node_id": "MDQ6VXNlcjMwMTIwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/301208?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jabbera", "html_url": "https://github.com/jabbera", "followers_url": "https://api.github.com/users/jabbera/followers", "following_url": "https://api.github.com/users/jabbera/following{/other_user}", "gists_url": "https://api.github.com/users/jabbera/gists{/gist_id}", "starred_url": "https://api.github.com/users/jabbera/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jabbera/subscriptions", "organizations_url": "https://api.github.com/users/jabbera/orgs", "repos_url": "https://api.github.com/users/jabbera/repos", "events_url": "https://api.github.com/users/jabbera/events{/privacy}", "received_events_url": "https://api.github.com/users/jabbera/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-03-12T13:27:25Z", "updated_at": "2021-03-22T00:33:45Z", "closed_at": "2021-03-22T00:33:45Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Bug description\r\nAKS link actually points to google: \r\n\r\nhttps://github.com/jupyterhub/zero-to-jupyterhub-k8s/blame/master/doc/source/jupyterhub/customizing/user-resources.md#L98\r\n\r\n#### Expected behaviour\r\nDocumentation points to the right place\r\n\r\n#### Actual behaviour\r\nDocumentation points to the wrong place\r\n\r\n### How to reproduce\r\nlook at the link\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2096/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2096/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2078", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2078/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2078/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2078/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2078", "id": 822082154, "node_id": "MDU6SXNzdWU4MjIwODIxNTQ=", "number": 2078, "title": "Upgrade to master causes failure due to user-scheduler pdb", "user": {"login": "yuvipanda", "id": 30430, "node_id": "MDQ6VXNlcjMwNDMw", "avatar_url": "https://avatars.githubusercontent.com/u/30430?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuvipanda", "html_url": "https://github.com/yuvipanda", "followers_url": "https://api.github.com/users/yuvipanda/followers", "following_url": "https://api.github.com/users/yuvipanda/following{/other_user}", "gists_url": "https://api.github.com/users/yuvipanda/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuvipanda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuvipanda/subscriptions", "organizations_url": "https://api.github.com/users/yuvipanda/orgs", "repos_url": "https://api.github.com/users/yuvipanda/repos", "events_url": "https://api.github.com/users/yuvipanda/events{/privacy}", "received_events_url": "https://api.github.com/users/yuvipanda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-03-04T12:21:44Z", "updated_at": "2021-03-04T17:01:13Z", "closed_at": "2021-03-04T17:01:13Z", "author_association": "COLLABORATOR", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n\r\nSince https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2039, upgrading from a lower version of z2jh to master causes failure with this:\r\n\r\nError: UPGRADE FAILED: cannot patch \"user-scheduler\" with kind PodDisruptionBudget: PodDisruptionBudget.policy \"user-scheduler\" is invalid: spec: Invalid value: policy.PodDisruptionBudgetSpec{MinAvailable:(*intstr.IntOrString)(0xc04d3c4be0), Selector:(*v1.LabelSelector)(0xc04d3c4c00), MaxUnavailable:(*intstr.IntOrString)(0xc04d3c4c40)}: minAvailable and maxUnavailable cannot be both set\r\n\r\nInstead, the upgrade should happen silently, with the pdbs automatically adjusted.\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2078/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2078/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2076", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2076/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2076/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2076/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2076", "id": 819244413, "node_id": "MDU6SXNzdWU4MTkyNDQ0MTM=", "number": 2076, "title": "hub.extraFiles not working as expected", "user": {"login": "AdrianSanchezLopez", "id": 24246627, "node_id": "MDQ6VXNlcjI0MjQ2NjI3", "avatar_url": "https://avatars.githubusercontent.com/u/24246627?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AdrianSanchezLopez", "html_url": "https://github.com/AdrianSanchezLopez", "followers_url": "https://api.github.com/users/AdrianSanchezLopez/followers", "following_url": "https://api.github.com/users/AdrianSanchezLopez/following{/other_user}", "gists_url": "https://api.github.com/users/AdrianSanchezLopez/gists{/gist_id}", "starred_url": "https://api.github.com/users/AdrianSanchezLopez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AdrianSanchezLopez/subscriptions", "organizations_url": "https://api.github.com/users/AdrianSanchezLopez/orgs", "repos_url": "https://api.github.com/users/AdrianSanchezLopez/repos", "events_url": "https://api.github.com/users/AdrianSanchezLopez/events{/privacy}", "received_events_url": "https://api.github.com/users/AdrianSanchezLopez/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-03-01T20:40:38Z", "updated_at": "2021-03-01T22:13:18Z", "closed_at": "2021-03-01T22:13:18Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\nThe new functionality on the lastest version 0.11.1 does not seem to make any effect, as the [docs](https://zero-to-jupyterhub.readthedocs.io/en/latest/resources/reference.html#hub-extrafiles) say\r\n\r\nAdding a simple config setup such as:\r\n```\r\nhub:\r\n  extraFiles:\r\n    my_image:\r\n      mountPath: /tmp/test.txt\r\n      stringData: |\r\n        hello world!\r\n```\r\ndoes not inject it into the Hub's pod (double checked with a simple exec into the pod, and files are not there)\r\n\r\n\r\n### My personal set up\r\nUsing: \r\n- minikube version: `v1.15.1`\r\n- kubectl:  `Client Version: version.Info{Major:\"1\", Minor:\"18\", GitVersion:\"v1.18.2\", GitCommit:\"52c56ce7a8272c798dbc29846288d7cd9fbae032\", GitTreeState:\"clean\", BuildDate:\"2020-04-16T11:56:40Z\", GoVersion:\"go1.13.9\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"19\", GitVersion:\"v1.19.4\", GitCommit:\"d360454c9bcd1634cf4cc52d1867af5491dc9c5f\", GitTreeState:\"clean\", BuildDate:\"2020-11-11T13:09:17Z\", GoVersion:\"go1.15.2\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n`\r\n- helm: `version.BuildInfo{Version:\"v3.3.4\", GitCommit:\"a61ce5633af99708171414353ed49547cf05013d\", GitTreeState:\"clean\", GoVersion:\"go1.14.9\"}`\r\n- helm chart: `jupyterhub/jupyterhub 0.11.1`\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2076/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2076/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2070", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2070/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2070/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2070/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2070", "id": 816689037, "node_id": "MDExOlB1bGxSZXF1ZXN0NTgwMzA4MDc5", "number": 2070, "title": "Fix schema validation for Spawner.cpu/memory limits/guarantees", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-02-25T18:33:14Z", "updated_at": "2021-02-25T18:42:14Z", "closed_at": "2021-02-25T18:42:14Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2070", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2070", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2070.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2070.patch", "merged_at": "2021-02-25T18:42:14Z"}, "body": "- [mem_limit / mem_guarantee](https://github.com/jupyterhub/jupyterhub/blob/c3ca924ba896bf2da40cab29e2a08784850a945b/jupyterhub/spawner.py#L567) is a ByteSpecification, which can accept numbers, strings, and None.\r\n- [cpu_limit / cpu_guarantee](https://github.com/jupyterhub/jupyterhub/blob/c3ca924ba896bf2da40cab29e2a08784850a945b/jupyterhub/spawner.py#L590) is a Float or None.\r\n\r\nCloses #2068, closes #2069 which is like this PR.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2070/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2070/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2068", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2068/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2068/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2068/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2068", "id": 816650784, "node_id": "MDU6SXNzdWU4MTY2NTA3ODQ=", "number": 2068, "title": "Type mismatch between Kubespawner and Helm Schema", "user": {"login": "thomasv314", "id": 584675, "node_id": "MDQ6VXNlcjU4NDY3NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/584675?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thomasv314", "html_url": "https://github.com/thomasv314", "followers_url": "https://api.github.com/users/thomasv314/followers", "following_url": "https://api.github.com/users/thomasv314/following{/other_user}", "gists_url": "https://api.github.com/users/thomasv314/gists{/gist_id}", "starred_url": "https://api.github.com/users/thomasv314/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thomasv314/subscriptions", "organizations_url": "https://api.github.com/users/thomasv314/orgs", "repos_url": "https://api.github.com/users/thomasv314/repos", "events_url": "https://api.github.com/users/thomasv314/events{/privacy}", "received_events_url": "https://api.github.com/users/thomasv314/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-02-25T17:38:12Z", "updated_at": "2021-02-25T18:46:33Z", "closed_at": "2021-02-25T18:42:14Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\nIt is not immediately clear to me if this is an issue with the latest version of the jupyterhub chart, or Kubespawner.\r\n\r\nThere is a mismatch between the helm values for `.singleuser.cpu.guarantee` and the Kubespawner traitlets.\r\n\r\nAfter upgrading to a version running off master, we see errors related to cpu limits/requests.\r\n\r\n\r\n#### Expected behaviour\r\nJupyterHub deploys / runs without issue.\r\n\r\n#### Actual behaviour\r\n\r\nHelm fails to deploy due to Schema validation issues:\r\n\r\nGiven the following values\r\n\r\n```\r\n  singleuser:\r\n    cpu:\r\n      limit: 2\r\n      guarantee: 1\r\n```\r\n\r\nDeploying with helm errors out:\r\n```\r\n  Error: UPGRADE FAILED: values don't meet the specifications of the schema(s) in the following chart(s):\r\n  jupyterhub:\r\n  - singleuser.cpu.guarantee: Invalid type. Expected: [string,null], given: integer\r\n  - singleuser.cpu.limit: Invalid type. Expected: [string,null], given: integer\r\n```\r\n\r\nWhen fixing the type in helm values, the deploy succeeds but the hub container errors out with:\r\n\r\n```\r\n   traitlets.traitlets.TraitError: The 'cpu_limit' trait of a KubeSpawner instance expected a float, not the str '2'.\r\n```\r\n\r\n#### How to reproduce\r\n\r\nTry to sync with versions specified and the values provided above.\r\n\r\n### Your personal set up\r\n\r\nJupyterhub Chart: jupyterhub/zero-to-jupyterhub-k8s@10196f6641823d13e6b55d53928faa33e21b3405 (0.11.1-n239.h10196f66)\r\nKubespawner: jupyterhub/kubespawner@a16e400d69b2481863f3c6452273abbedb74f76a\r\n\r\n```\r\nalembic==1.4.3\r\nasync-generator==1.10\r\nattrs==20.3.0\r\nbcrypt==3.2.0\r\nboto3==1.17.14\r\nbotocore==1.20.14\r\ncachetools==4.1.1\r\ncertifi==2020.12.5\r\ncertipy==0.1.3\r\ncffi==1.14.4\r\nchardet==3.0.4\r\nconda==4.3.16\r\ncryptography==3.4.4\r\nentrypoints==0.3\r\nescapism==1.0.1\r\ngoogle-auth==1.23.0\r\nidna==2.10\r\nipython-genutils==0.2.0\r\nJinja2==2.11.2\r\njmespath==0.10.0\r\njsonschema==3.2.0\r\njupyter-telemetry==0.1.0\r\njupyterhub==1.3.0\r\njupyterhub-firstuseauthenticator==0.14.1\r\njupyterhub-hmacauthenticator==1.0\r\njupyterhub-idle-culler==1.0\r\njupyterhub-kubespawner @ git+https://github.com/jupyterhub/kubespawner.git@a16e400d69b2481863f3c6452273abbedb74f76a\r\njupyterhub-ldapauthenticator==1.3.2\r\njupyterhub-ltiauthenticator==1.0.0\r\njupyterhub-nativeauthenticator==0.0.7\r\njupyterhub-tmpauthenticator==0.6\r\nkubernetes==12.0.1\r\nldap3==2.8.1\r\nMako==1.1.3\r\nMarkupSafe==1.1.1\r\nmwoauth==0.3.7\r\nnullauthenticator==1.0.0\r\noauthenticator==0.13.0\r\noauthlib==3.1.0\r\nonetimepass==1.0.1\r\npamela==1.0.0\r\nprometheus-client==0.9.0\r\npsycopg2-binary==2.8.6\r\npy-spy==0.3.4\r\npyasn1==0.4.8\r\npyasn1-modules==0.2.8\r\npycosat==0.6.3\r\npycparser==2.20\r\npycurl==7.43.0.6\r\nPyJWT==1.7.1\r\nPyMySQL==1.0.2\r\npyOpenSSL==20.0.0\r\npyrsistent==0.17.3\r\npython-dateutil==2.8.1\r\npython-editor==1.0.4\r\npython-json-logger==2.0.1\r\npython-slugify==4.0.1\r\nPyYAML==5.3.1\r\nrequests==2.25.0\r\nrequests-oauthlib==1.3.0\r\nrsa==4.6\r\nruamel.yaml==0.16.12\r\nruamel.yaml.clib==0.2.2\r\ns3transfer==0.3.4\r\nsix==1.15.0\r\nSQLAlchemy==1.3.23\r\nstatsd==3.3.0\r\ntext-unidecode==1.3\r\ntornado==6.1\r\ntraitlets==5.0.5\r\nurllib3==1.26.2\r\nwebsocket-client==0.57.0\r\n```\r\n</details>\r\n\r\n- <details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```python\r\n# jupyterhub_config.py\r\n```\r\n</details>\r\n\r\n- <details><summary>Logs</summary>\r\n\r\n```\r\nhub-7b65ffd55c-rjhmh:hub     Traceback (most recent call last):\r\nhub-7b65ffd55c-rjhmh:hub       File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/app.py\", line 2856, in launch_instance_async\r\nhub-7b65ffd55c-rjhmh:hub         await self.initialize(argv)\r\nhub-7b65ffd55c-rjhmh:hub       File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/app.py\", line 2428, in initialize\r\nhub-7b65ffd55c-rjhmh:hub         await gen.with_timeout(\r\nhub-7b65ffd55c-rjhmh:hub       File \"/usr/lib/python3.8/asyncio/events.py\", line 81, in _run\r\nhub-7b65ffd55c-rjhmh:hub         self._context.run(self._callback, *self._args)\r\nhub-7b65ffd55c-rjhmh:hub       File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/app.py\", line 2413, in log_init_time\r\nhub-7b65ffd55c-rjhmh:hub         n_spawners = f.result()\r\nhub-7b65ffd55c-rjhmh:hub       File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/app.py\", line 2116, in init_spawners\r\nhub-7b65ffd55c-rjhmh:hub         spawner = user.spawners[orm_spawner.name]\r\nhub-7b65ffd55c-rjhmh:hub       File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/user.py\", line 186, in __getitem__\r\nhub-7b65ffd55c-rjhmh:hub         self[key] = self.spawner_factory(key)\r\nhub-7b65ffd55c-rjhmh:hub       File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/user.py\", line 332, in _new_spawner\r\nhub-7b65ffd55c-rjhmh:hub         spawner = spawner_class(**spawn_kwargs)\r\nhub-7b65ffd55c-rjhmh:hub       File \"/usr/local/lib/python3.8/dist-packages/kubespawner/spawner.py\", line 162, in __init__\r\nhub-7b65ffd55c-rjhmh:hub         super().__init__(*args, **kwargs)\r\nhub-7b65ffd55c-rjhmh:hub       File \"/usr/local/lib/python3.8/dist-packages/traitlets/config/configurable.py\", line 104, in __init__\r\nhub-7b65ffd55c-rjhmh:hub         self.config = config\r\nhub-7b65ffd55c-rjhmh:hub       File \"/usr/local/lib/python3.8/dist-packages/traitlets/traitlets.py\", line 604, in __set__\r\nhub-7b65ffd55c-rjhmh:hub         self.set(obj, value)\r\nhub-7b65ffd55c-rjhmh:hub       File \"/usr/local/lib/python3.8/dist-packages/traitlets/traitlets.py\", line 593, in set\r\nhub-7b65ffd55c-rjhmh:hub         obj._notify_trait(self.name, old_value, new_value)\r\nhub-7b65ffd55c-rjhmh:hub       File \"/usr/local/lib/python3.8/dist-packages/traitlets/traitlets.py\", line 1217, in _notify_trait\r\nhub-7b65ffd55c-rjhmh:hub         self.notify_change(Bunch(\r\nhub-7b65ffd55c-rjhmh:hub       File \"/usr/local/lib/python3.8/dist-packages/traitlets/traitlets.py\", line 1227, in notify_change\r\nhub-7b65ffd55c-rjhmh:hub         return self._notify_observers(change)\r\nhub-7b65ffd55c-rjhmh:hub       File \"/usr/local/lib/python3.8/dist-packages/traitlets/traitlets.py\", line 1264, in _notify_observers\r\nhub-7b65ffd55c-rjhmh:hub         c(event)\r\nhub-7b65ffd55c-rjhmh:hub       File \"/usr/local/lib/python3.8/dist-packages/traitlets/traitlets.py\", line 888, in compatible_observer\r\nhub-7b65ffd55c-rjhmh:hub         return func(self, change)\r\nhub-7b65ffd55c-rjhmh:hub       File \"/usr/local/lib/python3.8/dist-packages/traitlets/config/configurable.py\", line 208, in _config_changed\r\nhub-7b65ffd55c-rjhmh:hub         self._load_config(change.new, traits=traits, section_names=section_names)\r\nhub-7b65ffd55c-rjhmh:hub       File \"/usr/local/lib/python3.8/dist-packages/traitlets/config/configurable.py\", line 175, in _load_config\r\nhub-7b65ffd55c-rjhmh:hub         setattr(self, name, deepcopy(config_value))\r\nhub-7b65ffd55c-rjhmh:hub       File \"/usr/local/lib/python3.8/dist-packages/traitlets/traitlets.py\", line 604, in __set__\r\nhub-7b65ffd55c-rjhmh:hub         self.set(obj, value)\r\nhub-7b65ffd55c-rjhmh:hub       File \"/usr/local/lib/python3.8/dist-packages/traitlets/traitlets.py\", line 578, in set\r\nhub-7b65ffd55c-rjhmh:hub         new_value = self._validate(obj, value)\r\nhub-7b65ffd55c-rjhmh:hub       File \"/usr/local/lib/python3.8/dist-packages/traitlets/traitlets.py\", line 610, in _validate\r\nhub-7b65ffd55c-rjhmh:hub         value = self.validate(obj, value)\r\nhub-7b65ffd55c-rjhmh:hub       File \"/usr/local/lib/python3.8/dist-packages/traitlets/traitlets.py\", line 2080, in validate\r\nhub-7b65ffd55c-rjhmh:hub         self.error(obj, value)\r\nhub-7b65ffd55c-rjhmh:hub       File \"/usr/local/lib/python3.8/dist-packages/traitlets/traitlets.py\", line 690, in error\r\nhub-7b65ffd55c-rjhmh:hub         raise TraitError(e)\r\nhub-7b65ffd55c-rjhmh:hub     traitlets.traitlets.TraitError: The 'cpu_limit' trait of a KubeSpawner instance expected a float, not the str '2'.\r\n```\r\n\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2068/reactions", "total_count": 2, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2068/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2064", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2064/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2064/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2064/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2064", "id": 815735829, "node_id": "MDU6SXNzdWU4MTU3MzU4Mjk=", "number": 2064, "title": "Support kubespawner internal_ssl", "user": {"login": "thomasv314", "id": 584675, "node_id": "MDQ6VXNlcjU4NDY3NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/584675?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thomasv314", "html_url": "https://github.com/thomasv314", "followers_url": "https://api.github.com/users/thomasv314/followers", "following_url": "https://api.github.com/users/thomasv314/following{/other_user}", "gists_url": "https://api.github.com/users/thomasv314/gists{/gist_id}", "starred_url": "https://api.github.com/users/thomasv314/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thomasv314/subscriptions", "organizations_url": "https://api.github.com/users/thomasv314/orgs", "repos_url": "https://api.github.com/users/thomasv314/repos", "events_url": "https://api.github.com/users/thomasv314/events{/privacy}", "received_events_url": "https://api.github.com/users/thomasv314/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-02-24T18:29:23Z", "updated_at": "2021-02-24T18:52:31Z", "closed_at": "2021-02-24T18:52:31Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n\r\njupyterhub/kubespawner#409 added support for internal_ssl, where a hub container using KubeSpawner requires the ability to delete services and secrets\r\n\r\n#### Expected behaviour\r\n\r\nLatest kubespawner works with zero-to-jupyterhub chart\r\n\r\n\r\n#### Actual behaviour\r\n\r\n### How to reproduce\r\n\r\n```\r\nc.JupyterHub.internal_ssl = True\r\nc.JupyterHub.spawner_class = 'kubespawner.KubeSpawner'\r\n```\r\n\r\n### Your personal set up\r\n\r\nzero-to-jupyterhub, k8s 1.18\r\n\r\n```\r\nkubespawner @ master/a16e400\r\n```\r\n</details>\r\n\r\n- <details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```python\r\n# jupyterhub_config.py\r\nc.JupyterHub.internal_ssl = True\r\nc.JupyterHub.spawner_class = 'kubespawner.KubeSpawner'\r\nc.JupyterHub.bind_url = \"https://0.0.0.0:8081\"\r\nc.JupyterHub.hub_bind_url = \"https://0.0.0.0:8081\"\r\nc.ConfigurableHTTPProxy.api_url = 'https://proxy-api.myns.svc.cluster.local:8001'\r\nc.JupyterHub.trusted_alt_names = [\"IP:127.0.0.1\", \"DNS:jupyter.{{ .Environment.Values.domain }}\", \"DNS:*.myns.svc.cluster.local\"]\r\nc.JupyterHub.hub_connect_url = \"https://hub.myns.svc.cluster.local:8081\"\r\n\r\nc.KubeSpawner.working_dir = '/home/jovyan/'\r\nc.KubeSpawner.internal_ssl = True\r\nc.KubeSpawner.ssl_alt_names = [\r\n  \"IP:127.0.0.1\",\r\n  \"DNS:jupyter.{{ .Environment.Values.domain }}\",\r\n  \"DNS:*.myns.svc.cluster.local\"\r\n]\r\n```\r\n</details>\r\n\r\n- <details><summary>Logs</summary>\r\n<!--\r\nErrors are often logged by jupytehub. How you get logs depends on your deployment.\r\nWith kubernetes it might be:\r\n\r\n    kubectl get pod # hub pod name starts with hub...\r\n    kubectl logs hub-...\r\n    # or for a single-user server\r\n    kubectl logs jupyter-username\r\n\r\nOr the-littlest-jupyterhub:\r\n\r\n    journalctl -u jupyterhub\r\n    # or for a single-user server\r\n    journalctl -u jupyter-username\r\n-->\r\n\r\n\r\n```\r\n[I 2021-02-24 17:39:55.681 JupyterHub spawner:2247] Deleting secret/jupyter-tom-2evendetta-40foo-2ecom\r\n[E 2021-02-24 17:39:55.684 JupyterHub spawner:2260] Error deleting {kind}/{name}: {e}\r\n  Traceback (most recent call last):\r\n       File \"/usr/local/lib/python3.8/dist-packages/kubespawner/spawner.py\", line 2248, in _ensure_not_exists\r\n         await gen.with_timeout(\r\n       File \"/usr/lib/python3.8/concurrent/futures/thread.py\", line 57, in run\r\n         result = self.fn(*self.args, **self.kwargs)\r\n       File \"/usr/local/lib/python3.8/dist-packages/kubespawner/spawner.py\", line 1964, in asynchronize\r\n         return method(*args, **kwargs)\r\n       File \"/usr/local/lib/python3.8/dist-packages/kubernetes/client/api/core_v1_api.py\", line 12753, in delete_namespaced_secret\r\n         return self.delete_namespaced_secret_with_http_info(name, namespace, **kwargs)  # noqa: E501\r\n       File \"/usr/local/lib/python3.8/dist-packages/kubernetes/client/api/core_v1_api.py\", line 12860, in delete_namespaced_secret_with_http_info\r\n         return self.api_client.call_api(\r\n       File \"/usr/local/lib/python3.8/dist-packages/kubernetes/client/api_client.py\", line 348, in call_api\r\n         return self.__call_api(resource_path, method,\r\n       File \"/usr/local/lib/python3.8/dist-packages/kubernetes/client/api_client.py\", line 180, in __call_api\r\n         response_data = self.request(\r\n       File \"/usr/local/lib/python3.8/dist-packages/kubernetes/client/api_client.py\", line 415, in request\r\n         return self.rest_client.DELETE(url,\r\n       File \"/usr/local/lib/python3.8/dist-packages/kubernetes/client/rest.py\", line 265, in DELETE\r\n         return self.request(\"DELETE\", url,\r\n       File \"/usr/local/lib/python3.8/dist-packages/kubernetes/client/rest.py\", line 233, in request\r\n         raise ApiException(http_resp=r)\r\n     kubernetes.client.exceptions.ApiException: (403)\r\n     Reason: Forbidden\r\n     HTTP response headers: HTTPHeaderDict({'Audit-Id': 'f89ae4b4-cffc-4d2a-9fae-e637fe821ea8', 'Cache-Control': 'no-cache, private', 'Content-Type': 'application/json', 'X-Content-Type-Options': 'nosniff', 'Date': 'Wed, 24 Feb 2021 17:39:55 GMT', 'Content-Length': '382'})\r\n     HTTP response body: {\"kind\":\"Status\",\"apiVersion\":\"v1\",\"metadata\":{},\"status\":\"Failure\",\"message\":\"secrets \\\"jupyter-tom-2evendetta-40foo-2ecom\\\" is forbidden: User \\\"system:serviceaccount:myns:hub\\\" cannot delete resource \\\"secrets\\\" in API group \\\"\\\" in the namespace \\\"myns\\\"\",\"reason\":\"Forbidden\",\"details\":{\"name\":\"jupyter-tom-2evendetta-40foo-2ecom\",\"kind\":\"secrets\"},\"code\":403}\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2064/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2064/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2055", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2055/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2055/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2055/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2055", "id": 812527328, "node_id": "MDExOlB1bGxSZXF1ZXN0NTc2ODc2MTM2", "number": 2055, "title": "Support setting resources to null to omit them", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-02-20T06:10:43Z", "updated_at": "2021-03-09T20:02:33Z", "closed_at": "2021-02-20T08:00:43Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2055", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2055", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2055.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2055.patch", "merged_at": "2021-02-20T08:00:43Z"}, "body": "It wasn't possible to reset the resource requests such as `hub.resources` to `null` because of our helm template logic assumed an object. This PR makes it so that if a .resources chart config value is `null` or `{}`, then the resources section will be omitted.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2055/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2055/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2050", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2050/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2050/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2050/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2050", "id": 812004989, "node_id": "MDU6SXNzdWU4MTIwMDQ5ODk=", "number": 2050, "title": "GithubOA does't works.", "user": {"login": "lidongze0629", "id": 23491543, "node_id": "MDQ6VXNlcjIzNDkxNTQz", "avatar_url": "https://avatars.githubusercontent.com/u/23491543?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lidongze0629", "html_url": "https://github.com/lidongze0629", "followers_url": "https://api.github.com/users/lidongze0629/followers", "following_url": "https://api.github.com/users/lidongze0629/following{/other_user}", "gists_url": "https://api.github.com/users/lidongze0629/gists{/gist_id}", "starred_url": "https://api.github.com/users/lidongze0629/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lidongze0629/subscriptions", "organizations_url": "https://api.github.com/users/lidongze0629/orgs", "repos_url": "https://api.github.com/users/lidongze0629/repos", "events_url": "https://api.github.com/users/lidongze0629/events{/privacy}", "received_events_url": "https://api.github.com/users/lidongze0629/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-02-19T13:01:46Z", "updated_at": "2021-02-20T03:23:03Z", "closed_at": "2021-02-20T03:23:03Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\nI try to deploy jupyterhub on k8s with Github OA following this [tutorials](https://zero-to-jupyterhub.readthedocs.io/en/stable/). But the Dummy Authenticator is always.\r\n\r\n#### Expected behaviour\r\nGithub Authentication appears.\r\n\r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\nDummyAuthenticator.\r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\nHere is my config.yaml\r\n```yaml\r\nproxy:\r\n  secretToken: \"a92efe26f5a8a8870090005e71a85701c519f62917ad5281729a785c080fa2ad\"\r\n\r\nsingleuser:\r\n  memory:\r\n    limit: 3G\r\n    guarantee: 2G\r\n  cpu:\r\n    limit: 10\r\n    guarantee: 1\r\n    storage:\r\n      capacity: \"20Gi\"\r\n      dynamic:\r\n        storageClass: alicloud-disk-ssd\r\n\r\nhub:\r\n  db:\r\n    pvc:\r\n      storageClassName: alicloud-disk-ssd\r\n      storage: 20Gi\r\n  config:\r\n    GitHubOAuthenticator:\r\n      admin_users:\r\n        - lidongze0629\r\n      client_id: myid\r\n      client_secret: mysecret\r\n      oauth_callback_url: https://extenal_ip:podt/hub/oauth_callback\r\n      scope:\r\n        - public_repo\r\n        - user:email\r\n    JupyterHub:\r\n      authenticator_class: github\r\n```\r\n\r\n\r\n### Your personal set up\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n\r\n - OS: ubuntu20.04\r\n <!-- [e.g. ubuntu 20.04, macOS 11.0] -->\r\n - Version(s): 0.10.6\r\n <!-- e.g. jupyterhub --version, python --version --->\r\n- K8s cluster: Aliyun ACK\r\n- <details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\n# paste output of `pip freeze` or `conda list` here\r\n```\r\n</details>\r\n\r\n- <details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```python\r\n# jupyterhub_config.py\r\n```\r\n</details>\r\n\r\n- <details><summary>Logs</summary>\r\n<!--\r\nErrors are often logged by jupytehub. How you get logs depends on your deployment.\r\nWith kubernetes it might be:\r\n\r\n    kubectl get pod # hub pod name starts with hub...\r\n    kubectl logs hub-...\r\n    # or for a single-user server\r\n    kubectl logs jupyter-username\r\n\r\nOr the-littlest-jupyterhub:\r\n\r\n    journalctl -u jupyterhub\r\n    # or for a single-user server\r\n    journalctl -u jupyter-username\r\n-->\r\n\r\n```\r\n# paste relevant logs here, if any\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2050/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2050/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2041", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2041/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2041/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2041/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2041", "id": 810615064, "node_id": "MDU6SXNzdWU4MTA2MTUwNjQ=", "number": 2041, "title": "Ensure dynamic versions in docs", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 580906362, "node_id": "MDU6TGFiZWw1ODA5MDYzNjI=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/help%20wanted", "name": "help wanted", "color": "0e8a16", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-02-17T23:25:52Z", "updated_at": "2021-02-20T06:16:33Z", "closed_at": "2021-02-20T06:16:33Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "We should ensure dynamic versioning in docs throughout, so that if we have version 0.11.1, it sais 0.11.1 all around, or in latest it said 0.11.1-n123.h1234567 or similarly.\r\n\r\nSee #2040 for example on the issues caused by this. Also note that we have the dynamic version available, and the challenge is how to get it within code blocks or no longer emedding it within code blocks where we have the issue. For details on the challenges, see https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1968\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2041/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2041/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2039", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2039/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2039/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2039/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2039", "id": 810513986, "node_id": "MDExOlB1bGxSZXF1ZXN0NTc1MTkyODIw", "number": 2039, "title": "pdb: default to maxUnavailable=1 instead of minAvailable=1", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2021-02-17T20:28:23Z", "updated_at": "2021-02-18T08:58:00Z", "closed_at": "2021-02-18T08:42:09Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2039", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2039", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2039.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2039.patch", "merged_at": "2021-02-18T08:42:09Z"}, "body": "If you want to lower the replicas of user-scheduler to 1, then you will get the same PDB issues we have had with hub/proxy (#1938) where they block upgrades etc because we have `minAvailable: 1` instead of `maxUnavailable: 1` in order to handle workloads.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2039/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2039/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2038", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2038/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2038/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2038/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2038", "id": 810441248, "node_id": "MDExOlB1bGxSZXF1ZXN0NTc1MTMyMjg0", "number": 2038, "title": "fix: imagePullSecret.enabled to work alongside imagePullSecret.create", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-02-17T18:45:00Z", "updated_at": "2021-02-19T04:17:06Z", "closed_at": "2021-02-19T04:17:06Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2038", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2038", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2038.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2038.patch", "merged_at": "2021-02-19T04:17:06Z"}, "body": "`imagePullSecret.create` were to be the new `.enabled` which should still work, but it turns out that I've missed one entry making `.create` function while `.enabled` wouldn't function.\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2038/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2038/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2036", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2036/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2036/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2036/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2036", "id": 809289231, "node_id": "MDExOlB1bGxSZXF1ZXN0NTc0MTc2NTI4", "number": 2036, "title": "hub image build: fix use of PIP_OVERRIDES arg", "user": {"login": "remche", "id": 90197, "node_id": "MDQ6VXNlcjkwMTk3", "avatar_url": "https://avatars.githubusercontent.com/u/90197?v=4", "gravatar_id": "", "url": "https://api.github.com/users/remche", "html_url": "https://github.com/remche", "followers_url": "https://api.github.com/users/remche/followers", "following_url": "https://api.github.com/users/remche/following{/other_user}", "gists_url": "https://api.github.com/users/remche/gists{/gist_id}", "starred_url": "https://api.github.com/users/remche/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/remche/subscriptions", "organizations_url": "https://api.github.com/users/remche/orgs", "repos_url": "https://api.github.com/users/remche/repos", "events_url": "https://api.github.com/users/remche/events{/privacy}", "received_events_url": "https://api.github.com/users/remche/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-02-16T12:58:28Z", "updated_at": "2021-02-16T14:29:29Z", "closed_at": "2021-02-16T14:29:08Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2036", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2036", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2036.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2036.patch", "merged_at": "2021-02-16T14:29:08Z"}, "body": "Default shell for Docker build is `sh`, the double bracket is not supported and pip overrides wont work.\r\nhttps://github.com/jupyterhub/zero-to-jupyterhub-k8s/runs/1804962086?check_suite_focus=true#step:8:1181\r\n\r\nI used the `test` notation as few lines below.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2036/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2036/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2023", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2023/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2023/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2023/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2023", "id": 799642047, "node_id": "MDExOlB1bGxSZXF1ZXN0NTY2MjU0NjMy", "number": 2023, "title": "fix: load only .py files in jupyterhub_config.d folder", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-02-02T20:11:54Z", "updated_at": "2021-02-03T13:05:43Z", "closed_at": "2021-02-03T12:58:50Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2023", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2023", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2023.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2023.patch", "merged_at": "2021-02-03T12:58:49Z"}, "body": "Closes #2022 by the implementation suggested by @minrk.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2023/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2023/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2022", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2022/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2022/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2022/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2022", "id": 799144884, "node_id": "MDU6SXNzdWU3OTkxNDQ4ODQ=", "number": 2022, "title": "/usr/local/etc/jupyterhub/jupyterhub_config.d subdirectory made jupyterhub fail to start", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2021-02-02T10:23:14Z", "updated_at": "2021-02-03T12:58:49Z", "closed_at": "2021-02-03T12:58:49Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "I mounted extra configuration to the /usr/local/etc/jupyterhub/jupyterhub_config.d folder. Using a k8s configmap without `subPath` in the volumeMount, it meant that I not only added a my_config.py file, but k8s also created a hidden folder as it does.\r\n\r\nThis led to z2jh's jupyterhub_config.py crashed while loading files from the jupyterhub_config.d folder, as it detected a folder and got upset.\r\n\r\n```\r\n      File \"/usr/local/etc/jupyterhub/jupyterhub_config.py\", line 415, in <module>\r\n        with open(f\"{config_dir}/{file_name}\") as f:\r\n    IsADirectoryError: [Errno 21] Is a directory: '/usr/local/etc/jupyterhub/jupyterhub_config.d/..2021_02_02_10_04_22.654959900'\r\n```\r\n\r\n@minrk @yuvipanda do you think we should ignore or include content within subdirectories of the jupyterhub_config.d folder?\r\n\r\n## Action point\r\n- [x] Decide on how to act regarding directories under the jupyterhub_config.d folder - ignore and warn or load files recursively?\r\n- [x] Implement decision", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2022/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2022/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2019", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2019/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2019/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2019/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2019", "id": 796635783, "node_id": "MDU6SXNzdWU3OTY2MzU3ODM=", "number": 2019, "title": "netpol: hub pod (kubespawner) requires egress to k8s api-server (reliable fix / documentation needed)", "user": {"login": "cyrilcros", "id": 10993194, "node_id": "MDQ6VXNlcjEwOTkzMTk0", "avatar_url": "https://avatars.githubusercontent.com/u/10993194?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cyrilcros", "html_url": "https://github.com/cyrilcros", "followers_url": "https://api.github.com/users/cyrilcros/followers", "following_url": "https://api.github.com/users/cyrilcros/following{/other_user}", "gists_url": "https://api.github.com/users/cyrilcros/gists{/gist_id}", "starred_url": "https://api.github.com/users/cyrilcros/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cyrilcros/subscriptions", "organizations_url": "https://api.github.com/users/cyrilcros/orgs", "repos_url": "https://api.github.com/users/cyrilcros/repos", "events_url": "https://api.github.com/users/cyrilcros/events{/privacy}", "received_events_url": "https://api.github.com/users/cyrilcros/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 630540373, "node_id": "MDU6TGFiZWw2MzA1NDAzNzM=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/documentation", "name": "documentation", "color": "fef2c0", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 14, "created_at": "2021-01-29T06:59:37Z", "updated_at": "2021-01-30T05:04:38Z", "closed_at": "2021-01-30T03:27:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Proposed change\r\n<!-- Use this section to describe the feature you'd like to be added. -->\r\nI had issues getting redirected from the dummy auth login to the hub control panel. The connection would just hang. I realized I needed to disable the hub network policy, maybe because I am using kubernetes ingress-nginx + certmanager with disabled https for the proxy. The other netpols were fine when enabled (single user and chp).\r\nThe current documentation doesn\u2019t say anything about network policy configuration for that type of ingress... see https://zero-to-jupyterhub.readthedocs.io/en/latest/administrator/advanced.html#ingress\r\n\r\n### Alternative options\r\n<!-- Use this section to describe alternative options and why you've decided on the proposed feature above. -->\r\n- Add documentation for that use case?\r\n- Change the templates to accomodate people who set an ingress?\r\n- Explain what labels should be added to the ingress controller?\r\n\r\n### Who would use this feature?\r\n<!-- Describe who would benefit from using this feature. -->\r\nAnyone who uses an ingress external to the chart, for example kubernetes/nginx-ingress. That\u2019s very often the case for bare metal clusters with a loadbalancer like Metallb, I guess, or if you want to have all your ingresses managed by the same controller, or if you want to benefit from your own install of cert-manager.\r\n\r\n<!-- Describe what you think needs to be done. Doing that is an excellent first step to get the feature implemented. -->\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2019/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2019/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2016", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2016/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2016/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2016/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2016", "id": 795105648, "node_id": "MDExOlB1bGxSZXF1ZXN0NTYyNTA5NjIz", "number": 2016, "title": "Followup fixes to seed secrets PR (#1993)", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-01-27T13:34:09Z", "updated_at": "2021-01-29T09:45:13Z", "closed_at": "2021-01-29T09:45:07Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2016", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2016", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2016.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2016.patch", "merged_at": "2021-01-29T09:45:06Z"}, "body": "I'm debugging an issue with the seed secrets PR which seemingly misbehaves a bit.\r\n\r\n## Action points\r\n- [x] The randHex function gives never gives me a leading hex character with a-f, only 0-9. Whyyyyyyyyyyyyyy?\r\n  Unless my algorithm is implemented wrong, it should mean that randAlphaNum first a-f letter is always showing up after its first 0-9 digit for some reason.\r\n  Answer: it turns out `randAlphaNum 1` in helm/sprig always starts with a number. See 9f0889c.\r\n- [x] `helm diff` in the CI system under the upgrade dev job make it seem like passwords were generated both during the installation of the latest dev release and the local chart upgrade instead of re-using the existing value from the k8s Secret. Why?\r\n  Answer: The logic failed as I forgot to inspect the `data` value. See f243d3c\r\n- [x] We also need to normalize the fetched value to a non-base64 encoded string. a6d8e32", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2016/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2016/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2015", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2015/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2015/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2015/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2015", "id": 794558620, "node_id": "MDU6SXNzdWU3OTQ1NTg2MjA=", "number": 2015, "title": "Z2JH 0.11.1 gives 404 when connecting to JupyterLab 3.0.5 singleuser ServerApp", "user": {"login": "jpugliesi", "id": 2141170, "node_id": "MDQ6VXNlcjIxNDExNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/2141170?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jpugliesi", "html_url": "https://github.com/jpugliesi", "followers_url": "https://api.github.com/users/jpugliesi/followers", "following_url": "https://api.github.com/users/jpugliesi/following{/other_user}", "gists_url": "https://api.github.com/users/jpugliesi/gists{/gist_id}", "starred_url": "https://api.github.com/users/jpugliesi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jpugliesi/subscriptions", "organizations_url": "https://api.github.com/users/jpugliesi/orgs", "repos_url": "https://api.github.com/users/jpugliesi/repos", "events_url": "https://api.github.com/users/jpugliesi/events{/privacy}", "received_events_url": "https://api.github.com/users/jpugliesi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2021-01-26T21:02:33Z", "updated_at": "2023-03-23T06:10:55Z", "closed_at": "2021-02-19T04:01:26Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\nHello - we are using z2jh 0.11.1, attempting to use jupyterlab 3.0.5 with the new `ServerApp` for the single-user servers\r\n\r\nWe currently get 404s from the singleuser server when set up:\r\n```\r\n[I 2021-01-26 20:53:55.183 SingleUserNotebookApp mixins:557] Starting jupyterhub-singleuser server version 1.3.0\r\n[I 2021-01-26 20:53:55.192 SingleUserNotebookApp serverapp:1938] Serving notebooks from local directory: /efs/jupyterhub\r\n[I 2021-01-26 20:53:55.192 SingleUserNotebookApp serverapp:1938] Jupyter Server 1.2.2 is running at:\r\n[I 2021-01-26 20:53:55.192 SingleUserNotebookApp serverapp:1938] http://jupyter-john:8888/user/john/lab\r\n[I 2021-01-26 20:53:55.192 SingleUserNotebookApp serverapp:1938]  or http://127.0.0.1:8888/user/john/lab\r\n[I 2021-01-26 20:53:55.192 SingleUserNotebookApp serverapp:1939] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).\r\n[I 2021-01-26 20:53:55.195 SingleUserNotebookApp mixins:538] Updating Hub with activity every 300 seconds\r\n[I 2021-01-26 20:53:57.142 SingleUserNotebookApp log:181] 302 GET /user/john/ -> /user/john/lab? (@100.114.155.52) 0.69ms\r\n[W 2021-01-26 20:53:57.326 SingleUserNotebookApp log:181] 404 GET /user/john/lab? (@::ffff:100.126.103.68) 10.65ms\r\n```\r\n\r\nWe've set the following env variable in the singleuser server:\r\n```\r\n   #environment variable in singleuser server\r\n   env:\r\n    - name: JUPYTERHUB_SINGLEUSER_APP\r\n      value: \"jupyter_server.serverapp.ServerApp\"\r\n```\r\n\r\nand configure the z2jh config to use jupyterlab:\r\n```\r\nsingleuser:\r\n  defaultUrl: \"/lab\"\r\n```\r\n\r\nour `jupyter_server_config.py` is:\r\n```\r\nc = get_config()\r\nc.Spawner.default_url = '/lab'\r\n```\r\n\r\n#### Expected behaviour\r\nI expect the following configuration to work\r\n\r\n#### Actual behaviour\r\nSpawning a singleuser server produces a 404\r\n```\r\n404 : Not Found\r\nYou are requesting a page that does not exist!\r\n```\r\n\r\n### How to reproduce\r\n1. Install z2jh 0.11.1\r\n2. Configure as mentioned above\r\n\r\n### Your personal set up\r\nKubernetes 1.16.5\r\n\r\npip freeze in singleuser server env:\r\n```\r\nabsl-py==0.10.0\r\naiohttp==3.7.3\r\nalembic==1.5.2\r\nansiwrap==0.8.4\r\nanyio==2.0.2\r\nappdirs==1.4.4\r\nargon2-cffi==20.1.0\r\nastunparse==1.6.3\r\nasync-generator==1.10\r\nasync-timeout==3.0.1\r\nattrs==20.1.0\r\nautovizwidget @ file:///tmp/pip-install-z_z18dmw/sparkmagic_5585a992207b4cfca1556c625ca386c4/autovizwidget\r\nawscli==1.18.219\r\nBabel==2.9.0\r\nbackcall==0.2.0\r\nblack==20.8b1\r\nbleach==3.1.5\r\nboto3==1.16.59\r\nbotocore==1.19.59\r\nbranca==0.4.2\r\ncachetools==4.1.1\r\ncertifi==2020.6.20\r\ncertipy==0.1.3\r\ncffi==1.14.2\r\ncfgv==3.2.0\r\nchardet==3.0.4\r\nclick==7.1.2\r\ncolorama==0.4.3\r\ncolour==0.1.5\r\ncoverage==5.4\r\ncryptography==3.3.1\r\ncvxpy==1.1.7\r\ncycler==0.10.0\r\ndecorator==4.4.2\r\ndefusedxml==0.6.0\r\ndistlib==0.3.1\r\ndocformatter==1.4\r\ndocutils==0.15.2\r\necos==2.0.7.post1\r\nentrypoints==0.3\r\nfilelock==3.0.12\r\nflake8==3.8.4\r\nfolium==0.12.1\r\nfsspec==0.8.5\r\ngast==0.3.3\r\ngcsfs==0.7.1\r\ngitdb==4.0.5\r\nGitPython==3.1.12\r\ngoogle-auth==1.21.0\r\ngoogle-auth-oauthlib==0.4.1\r\ngoogle-pasta==0.2.0\r\ngrpcio==1.31.0\r\ngviz-api==1.9.0\r\nh5py==2.10.0\r\nhdijupyterutils @ file:///tmp/pip-install-z_z18dmw/sparkmagic_5585a992207b4cfca1556c625ca386c4/hdijupyterutils\r\nhybridcontents==0.2.0\r\nidentify==1.5.13\r\nidna==2.10\r\nimportlib-metadata==1.7.0\r\niniconfig==1.1.1\r\nipykernel==5.4.3\r\nipython==7.18.1\r\nipython-genutils==0.2.0\r\nipywidgets==7.5.1\r\njedi==0.17.2\r\nJinja2==2.11.2\r\njmespath==0.10.0\r\njoblib==1.0.0\r\njson5==0.9.5\r\njsonschema==3.2.0\r\njupyter==1.0.0\r\njupyter-client==6.1.7\r\njupyter-console==6.2.0\r\njupyter-core==4.6.3\r\njupyter-http-over-ws==0.0.8\r\njupyter-server==1.2.2\r\njupyter-telemetry==0.1.0\r\njupyterhub==1.3.0\r\njupyterlab==3.0.5\r\njupyterlab-code-formatter==1.4.2\r\njupyterlab-git==0.23.3\r\njupyterlab-server==2.1.3\r\njupyterlab-widgets==1.0.0\r\nKeras-Preprocessing==1.1.2\r\nkiwisolver==1.2.0\r\nMako==1.1.4\r\nMarkdown==3.2.2\r\nMarkupSafe==1.1.1\r\nmatplotlib==3.3.1\r\nmccabe==0.6.1\r\nmistune==0.8.4\r\nmock==4.0.3\r\nmultidict==5.1.0\r\nmypy-extensions==0.4.3\r\nnbclassic==0.2.6\r\nnbclient==0.5.1\r\nnbconvert==5.6.1\r\nnbdime==2.1.0\r\nnbformat==5.1.2\r\nnbstripout==0.3.9\r\nnbval==0.9.6\r\nnest-asyncio==1.4.3\r\nnodeenv==1.5.0\r\nnose==1.3.7\r\nnose-exclude==0.5.0\r\nnose-warnings-filters==0.1.5\r\nnotebook==6.1.3\r\nnumpy==1.18.5\r\noauthlib==3.1.0\r\nopt-einsum==3.3.0\r\nosqp==0.6.2.post0\r\npackaging==20.4\r\npamela==1.0.0\r\npandas==1.2.1\r\npandocfilters==1.4.2\r\npapermill @ git+https://github.com/viaduct-ai/papermill.git@bfd9c39c3b031385317772091e64b3e275d8928c\r\nparso==0.7.1\r\npathspec==0.8.1\r\npexpect==4.8.0\r\npickleshare==0.7.5\r\nPillow==7.2.0\r\npipenv==2020.11.15\r\nplotly==4.14.3\r\npluggy==0.13.1\r\npre-commit==2.9.3\r\nprometheus-client==0.8.0\r\nprompt-toolkit==3.0.7\r\nprotobuf==3.13.0\r\npsycopg2-binary==2.8.6\r\nptyprocess==0.6.0\r\npy==1.10.0\r\npy4j==0.10.7\r\npyarrow==3.0.0\r\npyasn1==0.4.8\r\npyasn1-modules==0.2.8\r\npycodestyle==2.6.0\r\npycparser==2.20\r\npyflakes==2.2.0\r\nPygments==2.6.1\r\npygobject==3.26.1\r\npykerberos==1.2.1\r\npyOpenSSL==20.0.1\r\npyparsing==2.4.7\r\npyrsistent==0.16.0\r\npyspark==2.4.5\r\npytest==6.2.2\r\npytest-cov==2.11.1\r\npython-apt==1.6.5+ubuntu0.3\r\npython-dateutil==2.8.1\r\npython-editor==1.0.4\r\npython-json-logger==2.0.1\r\npytz==2020.5\r\nPyYAML==5.3.1\r\npyzmq==19.0.2\r\nqdldl==0.1.5.post0\r\nqtconsole==4.7.6\r\nQtPy==1.9.0\r\nregex==2020.11.13\r\nrequests==2.25.1\r\nrequests-kerberos==0.12.0\r\nrequests-oauthlib==1.3.0\r\nrequests-unixsocket==0.2.0\r\nretrying==1.3.3\r\nrsa==4.5\r\nruamel.yaml==0.16.12\r\nruamel.yaml.clib==0.2.2\r\ns3contents==0.6.1\r\ns3fs==0.4.2\r\ns3transfer==0.3.4\r\nscikit-learn==0.24.1\r\nscipy==1.4.1\r\nscs==2.1.2\r\nselenium==3.141.0\r\nSend2Trash==1.5.0\r\nsix==1.15.0\r\nsmmap==3.0.5\r\nsniffio==1.2.0\r\nsparkmagic @ git+https://github.com/viaduct-ai/sparkmagic.git@cd575a07e20867b7e7755a74e5b168978602ffc4#subdirectory=sparkmagic\r\nSQLAlchemy==1.3.22\r\nssh-import-id==5.7\r\ntenacity==6.3.1\r\ntensorboard==2.3.0\r\ntensorboard-plugin-profile==2.4.0\r\ntensorboard-plugin-wit==1.7.0\r\ntensorflow==2.3.0\r\ntensorflow-estimator==2.3.0\r\ntermcolor==1.1.0\r\nterminado==0.8.3\r\ntestbook==0.2.5\r\ntestpath==0.4.4\r\ntextwrap3==0.9.2\r\nthreadpoolctl==2.1.0\r\ntoml==0.10.2\r\ntornado==6.1\r\ntqdm==4.56.0\r\ntraitlets==5.0.0\r\ntyped-ast==1.4.2\r\ntyping-extensions==3.7.4.3\r\nunattended-upgrades==0.1\r\nuntokenize==0.1.1\r\nurllib3==1.25.10\r\nvirtualenv==20.4.0\r\nvirtualenv-clone==0.5.4\r\nwcwidth==0.2.5\r\nwebencodings==0.5.1\r\nWerkzeug==1.0.1\r\nwidgetsnbextension==3.5.1\r\nwrapt==1.12.1\r\nxgboost==1.3.3\r\nyapf==0.30.0\r\nyarl==1.6.3\r\nzipp==3.1.0\r\n```", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2015/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2015/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2013", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2013/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2013/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2013/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2013", "id": 794040609, "node_id": "MDU6SXNzdWU3OTQwNDA2MDk=", "number": 2013, "title": "Cannot connect to kernel", "user": {"login": "bartgras", "id": 8042963, "node_id": "MDQ6VXNlcjgwNDI5NjM=", "avatar_url": "https://avatars.githubusercontent.com/u/8042963?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bartgras", "html_url": "https://github.com/bartgras", "followers_url": "https://api.github.com/users/bartgras/followers", "following_url": "https://api.github.com/users/bartgras/following{/other_user}", "gists_url": "https://api.github.com/users/bartgras/gists{/gist_id}", "starred_url": "https://api.github.com/users/bartgras/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bartgras/subscriptions", "organizations_url": "https://api.github.com/users/bartgras/orgs", "repos_url": "https://api.github.com/users/bartgras/repos", "events_url": "https://api.github.com/users/bartgras/events{/privacy}", "received_events_url": "https://api.github.com/users/bartgras/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 2089494150, "node_id": "MDU6TGFiZWwyMDg5NDk0MTUw", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/support", "name": "support", "color": "8fad22", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2021-01-26T08:36:45Z", "updated_at": "2021-01-26T09:49:23Z", "closed_at": "2021-01-26T08:57:06Z", "author_association": "NONE", "active_lock_reason": null, "body": "I've had existing (AWS) EKS cluster on which I (almost) successfully installed z2jh.\r\nWhat works:\r\n* I have working SSL setup\r\n* I can login and manage servers\r\n* I can create notebook\r\n\r\nThe only issue I have is that I cannot connect to kernel. \r\n\r\n\r\nHere is log from my `jupyter-<name>` pod:\r\n```\r\n[W 2021-01-26 08:18:57.030 SingleUserNotebookApp configurable:168] Config option `open_browser` not recognized by `SingleUserNotebookApp`.  Did you mean `browser`?\r\n[I 2021-01-26 08:18:57.260 SingleUserNotebookApp extension:168] JupyterLab extension loaded from /opt/conda/lib/python3.6/site-packages/jupyterlab\r\n[I 2021-01-26 08:18:57.260 SingleUserNotebookApp extension:169] JupyterLab application directory is /opt/conda/share/jupyter/lab\r\n[I 2021-01-26 08:18:57.262 SingleUserNotebookApp singleuser:406] Starting jupyterhub-singleuser server version 0.9.4\r\n[W 2021-01-26 08:18:57.269 SingleUserNotebookApp _version:50] jupyterhub version 1.3.0 != jupyterhub-singleuser version 0.9.4. This could cause failure to authenticate and result in redirect loops!\r\n[I 2021-01-26 08:18:57.269 SingleUserNotebookApp notebookapp:1712] Serving notebooks from local directory: /home/jovyan\r\n[I 2021-01-26 08:18:57.270 SingleUserNotebookApp notebookapp:1712] The Jupyter Notebook is running at:\r\n[I 2021-01-26 08:18:57.270 SingleUserNotebookApp notebookapp:1712] http://(jupyter-bart or 127.0.0.1):8888/user/bart/\r\n[I 2021-01-26 08:18:57.270 SingleUserNotebookApp notebookapp:1713] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).\r\n[I 2021-01-26 08:19:01.524 SingleUserNotebookApp log:158] 302 GET /user/bart/ -> /user/bart/tree? (@192.168.41.86) 0.59ms\r\n[I 2021-01-26 08:19:01.642 SingleUserNotebookApp log:158] 302 GET /user/bart/ -> /user/bart/tree? (@103.73.243.180) 0.55ms\r\n[I 2021-01-26 08:19:01.695 SingleUserNotebookApp log:158] 302 GET /user/bart/tree? -> /hub/api/oauth2/authorize?client_id=jupyterhub-user-bart&redirect_uri=%2Fuser%2Fbart%2Foauth_callback&response_type=code&state=[secret] (@103.73.243.180) 3.31ms\r\n[I 2021-01-26 08:19:01.879 SingleUserNotebookApp auth:875] Logged-in user {'kind': 'user', 'name': 'bart', 'admin': False, 'groups': [], 'server': '/user/bart/', 'pending': None, 'created': '2021-01-26T08:12:39.756512Z', 'last_activity': '2021-01-26T08:19:01.873391Z', 'servers': None}\r\n[I 2021-01-26 08:19:01.880 SingleUserNotebookApp log:158] 302 GET /user/bart/oauth_callback?code=[secret]&state=[secret] -> /user/bart/tree? (@103.73.243.180) 62.36ms\r\n[I 2021-01-26 08:19:02.023 SingleUserNotebookApp log:158] 200 GET /user/bart/tree? (bart@103.73.243.180) 93.36ms\r\n[I 2021-01-26 08:19:02.248 SingleUserNotebookApp log:158] 200 GET /user/bart/api/config/common?_=1611649142160 (bart@103.73.243.180) 2.82ms\r\n[I 2021-01-26 08:19:02.251 SingleUserNotebookApp log:158] 200 GET /user/bart/api/config/tree?_=1611649142159 (bart@103.73.243.180) 2.51ms\r\n[I 2021-01-26 08:19:02.293 SingleUserNotebookApp log:158] 200 GET /user/bart/api/terminals?_=1611649142161 (bart@103.73.243.180) 1.03ms\r\n[I 2021-01-26 08:19:02.331 SingleUserNotebookApp log:158] 200 GET /user/bart/api/sessions?_=1611649142162 (bart@103.73.243.180) 2.34ms\r\n[I 2021-01-26 08:19:02.333 SingleUserNotebookApp log:158] 200 GET /user/bart/api/terminals?_=1611649142163 (bart@103.73.243.180) 1.04ms\r\n[I 2021-01-26 08:19:02.384 SingleUserNotebookApp log:158] 200 GET /user/bart/api/contents?type=directory&_=1611649142164 (bart@103.73.243.180) 2.91ms\r\n[I 2021-01-26 08:19:07.477 SingleUserNotebookApp log:158] 200 GET /user/bart/notebooks/Untitled.ipynb (bart@103.73.243.180) 312.98ms\r\n[I 2021-01-26 08:19:07.748 SingleUserNotebookApp log:158] 200 GET /user/bart/api/config/common?_=1611649147645 (bart@103.73.243.180) 2.54ms\r\n[I 2021-01-26 08:19:07.751 SingleUserNotebookApp log:158] 200 GET /user/bart/api/config/notebook?_=1611649147644 (bart@103.73.243.180) 2.63ms\r\n[I 2021-01-26 08:19:07.783 SingleUserNotebookApp log:158] 200 GET /user/bart/api/contents/Untitled.ipynb?type=notebook&_=1611649147646 (bart@103.73.243.180) 11.60ms\r\n[I 2021-01-26 08:19:07.901 SingleUserNotebookApp kernelmanager:164] Kernel started: 8ccbb47f-5580-4cb0-9cb1-85675a04ab83\r\n[I 2021-01-26 08:19:07.902 SingleUserNotebookApp log:158] 201 POST /user/bart/api/sessions (bart@103.73.243.180) 30.43ms\r\n[I 2021-01-26 08:19:07.907 SingleUserNotebookApp log:158] 200 GET /user/bart/api/contents/Untitled.ipynb/checkpoints?_=1611649147647 (bart@103.73.243.180) 1.71ms\r\n[I 2021-01-26 08:19:08.541 SingleUserNotebookApp handlers:190] Adapting to protocol v5.1 for kernel 8ccbb47f-5580-4cb0-9cb1-85675a04ab83\r\n[W 2021-01-26 08:19:08.543 SingleUserNotebookApp log:158] 400 GET /user/bart/api/kernels/8ccbb47f-5580-4cb0-9cb1-85675a04ab83/channels?session_id=fc3d7721c75c4be09bcd8a65da9b7a85 (bart@103.73.243.180) 504.01ms\r\n[W 2021-01-26 08:19:09.692 SingleUserNotebookApp handlers:254] Replacing stale connection: 8ccbb47f-5580-4cb0-9cb1-85675a04ab83:fc3d7721c75c4be09bcd8a65da9b7a85\r\n```\r\n\r\nAfter I hit \"Reload kernel\" button, following lines are added to log:\r\n```\r\n[W 2021-01-26 08:28:50.269 SingleUserNotebookApp handlers:252] Replacing stale connection: c8f56f02-078f-4818-81fb-d0b42c095c15:c5e1b6f33274463aac0e52506c611f58\r\n[I 2021-01-26 08:28:59.045 SingleUserNotebookApp multikernelmanager:300] Kernel restarted: c8f56f02-078f-4818-81fb-d0b42c095c15\r\n[I 2021-01-26 08:28:59.048 SingleUserNotebookApp log:181] 200 POST /user/bart/api/kernels/c8f56f02-078f-4818-81fb-d0b42c095c15/restart (bart@103.73.243.180) 210.52ms\r\n[W 2021-01-26 08:29:49.437 SingleUserNotebookApp handlers:252] Replacing stale connection: c8f56f02-078f-4818-81fb-d0b42c095c15:c5e1b6f33274463aac0e52506c611f58\r\n[W 2021-01-26 08:29:51.617 SingleUserNotebookApp handlers:252] Replacing stale connection: c8f56f02-078f-4818-81fb-d0b42c095c15:c5e1b6f33274463aac0e52506c611f58\r\n[W 2021-01-26 08:30:53.986 SingleUserNotebookApp handlers:252] Replacing stale connection: c8f56f02-078f-4818-81fb-d0b42c095c15:c5e1b6f33274463aac0e52506c611f58\r\n[W 2021-01-26 08:31:53.570 SingleUserNotebookApp handlers:252] Replacing stale connection: c8f56f02-078f-4818-81fb-d0b42c095c15:c5e1b6f33274463aac0e52506c611f58\r\n[W 2021-01-26 08:32:09.770 SingleUserNotebookApp handlers:252] Replacing stale connection: c8f56f02-078f-4818-81fb-d0b42c095c15:c5e1b6f33274463aac0e52506c611f58\r\n```\r\n\r\nAnd it continues with `Replacing stale connection` but never connects to the kernel.\r\n\r\n\r\nMy `config.yaml`:\r\n```\r\nproxy:\r\n  secretToken: <token>\r\n  https:\r\n    enabled: true\r\n    type: offload\r\n  service:\r\n    annotations:\r\n      # Certificate ARN\r\n      service.beta.kubernetes.io/aws-load-balancer-ssl-cert: \"<ARN>\"\r\n      # The protocol to use on the backend, we use TCP since we're using websockets\r\n      service.beta.kubernetes.io/aws-load-balancer-backend-protocol: \"tcp\"\r\n      # Which ports should use SSL\r\n      service.beta.kubernetes.io/aws-load-balancer-ssl-ports: \"https\"\r\n      service.beta.kubernetes.io/aws-load-balancer-connection-idle-timeout: \"3600\"\r\n\r\ningress: \r\n  enabled: true\r\n  hosts:\r\n    - <host>\r\n\r\nhub:\r\n  cookieSecret: <token>\r\n  config:\r\n    Authenticator:\r\n      admin_users:\r\n        - admin\r\n      allowed_users:\r\n        - <user>\r\n    DummyAuthenticator:\r\n      password: <password>\r\n    JupyterHub:\r\n      authenticator_class: dummy\r\n\r\nsingleuser:\r\n  image:\r\n    name: jupyter/datascience-notebook\r\n    tag: 177037d09156\r\n  memory:\r\n    limit: 16G\r\n    guarantee: 2G\r\n  nodeSelector:\r\n    memory: 32gb\r\n  cpu:\r\n    limit: 8\r\n    guarantee: 4\r\n  storage:\r\n    capacity: 5Gi\r\n```\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2013/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2013/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2009", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2009/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2009/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2009/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/2009", "id": 792918275, "node_id": "MDU6SXNzdWU3OTI5MTgyNzU=", "number": 2009, "title": "Hub existingSecret functionality not working as expected ", "user": {"login": "zarrarrana", "id": 15875702, "node_id": "MDQ6VXNlcjE1ODc1NzAy", "avatar_url": "https://avatars.githubusercontent.com/u/15875702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zarrarrana", "html_url": "https://github.com/zarrarrana", "followers_url": "https://api.github.com/users/zarrarrana/followers", "following_url": "https://api.github.com/users/zarrarrana/following{/other_user}", "gists_url": "https://api.github.com/users/zarrarrana/gists{/gist_id}", "starred_url": "https://api.github.com/users/zarrarrana/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zarrarrana/subscriptions", "organizations_url": "https://api.github.com/users/zarrarrana/orgs", "repos_url": "https://api.github.com/users/zarrarrana/repos", "events_url": "https://api.github.com/users/zarrarrana/events{/privacy}", "received_events_url": "https://api.github.com/users/zarrarrana/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/milestones/7", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/milestone/7", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/milestones/7/labels", "id": 6105581, "node_id": "MDk6TWlsZXN0b25lNjEwNTU4MQ==", "number": 7, "title": "1.0.0", "description": "", "creator": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 19, "state": "open", "created_at": "2020-11-14T03:21:10Z", "updated_at": "2021-05-28T20:30:30Z", "due_on": null, "closed_at": null}, "comments": 8, "created_at": "2021-01-24T22:35:01Z", "updated_at": "2021-03-15T21:19:59Z", "closed_at": "2021-02-25T08:34:38Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\nHi,  I am trying to update jupyterhub to helm chart 0.10.6 from 0.9.0, and with the recent change of moving values.yaml only to hub-secret and removing it from hub-config is breaking the Hub existingSecret functionality. In our existing deployment on EKS we use gitops/flux/helm operator for our deployments and we didn't want to add secrets to git, so we created hub-secret which only includes secrets(proxy token, db creds, crypto-key, cookie-secret, etc) using [external secrets operator](https://github.com/external-secrets/kubernetes-external-secrets)  and set the name as existingSecret. Now when the existingSecret is set, the secret is not created and values.yaml doesn't make it to the hub pod and it doesn't start properly.\r\n\r\n\r\n#### Expected behaviour\r\nThe previous behaviour of existingSecret should continue to work without having to add values.yaml to existingSecret. \r\n\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2009/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2009/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2007", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2007/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2007/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2007/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2007", "id": 792891429, "node_id": "MDExOlB1bGxSZXF1ZXN0NTYwNjczMDk2", "number": 2007, "title": "fix: set tolerations to predefined labels on core pods", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-01-24T20:56:45Z", "updated_at": "2021-01-27T09:16:28Z", "closed_at": "2021-01-27T09:16:22Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/2007", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2007", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2007.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/2007.patch", "merged_at": "2021-01-27T09:16:21Z"}, "body": "Closes #1486 by adding a default toleration to our core pods to a specific taint [according to our current documentation](https://zero-to-jupyterhub.readthedocs.io/en/stable/resources/reference.html#hub-tolerations). This is done according to strategy described in https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1486#issuecomment-648993410.\r\n\r\n@minrk I recall trimming away this feature (but apparently missed that part in the docs) while adding the user equivalent tolerations because the complexity of the implementation I went for. Since then we have added configurable tolerations for all our core pods on request by users, this is to me something that indicates the value of having a default toleration.\r\n\r\nWhat do you think about this implementation? I lean towards thinking its a good addition as users have requested configurable tolerations.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2007/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/2007/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1989", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1989/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1989/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1989/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1989", "id": 786848597, "node_id": "MDExOlB1bGxSZXF1ZXN0NTU1NjU5OTQx", "number": 1989, "title": "fix: fix of ingress regression and improved testing", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-01-15T12:10:29Z", "updated_at": "2021-01-15T12:15:06Z", "closed_at": "2021-01-15T12:15:06Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/1989", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1989", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1989.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1989.patch", "merged_at": "2021-01-15T12:15:06Z"}, "body": "Our linting example didn't cover the ingress Helm template properly and a basic syntax error sneaked past in #1983.\r\n\r\nI'll release 0.11.1 with this bugfix.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1989/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1989/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1952", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1952/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1952/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1952/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1952", "id": 771746936, "node_id": "MDU6SXNzdWU3NzE3NDY5MzY=", "number": 1952, "title": "Docs: fix our dynamically retrieved chart version", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 630540373, "node_id": "MDU6TGFiZWw2MzA1NDAzNzM=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/documentation", "name": "documentation", "color": "fef2c0", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-12-20T23:57:04Z", "updated_at": "2021-01-01T22:49:19Z", "closed_at": "2021-01-01T22:49:19Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Our landing page has an invalid note about the Helm chart version which we should fix. As you can see from the rST, it [references a custom variable](https://github.com/jupyterhub/zero-to-jupyterhub-k8s/blame/master/doc/source/index.rst#L23-L25), which is set through inspection of Chart.yaml.\r\n\r\nhttps://github.com/jupyterhub/zero-to-jupyterhub-k8s/blob/ba38491ef41d59af55f1b2510c60bd913116e1b6/doc/source/conf.py#L40-L55\r\n\r\n### Screenshot from z2jh.jupyter.org's landing page\r\n![image](https://user-images.githubusercontent.com/3837114/102727553-87bc1280-4326-11eb-93e9-5a445dc8fd8a.png)\r\n\r\n---\r\n\r\nRelated to fixing this, it could be nice to pin references in docs currently going to master to instead go to the associated release. See @manics comment here: https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1943/files#r546444303", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1952/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1952/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1950", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1950/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1950/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1950/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1950", "id": 771289337, "node_id": "MDExOlB1bGxSZXF1ZXN0NTQyODY2MzAw", "number": 1950, "title": "Fix failure to block insecure metadata server IP", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-12-19T03:03:31Z", "updated_at": "2021-01-14T17:11:42Z", "closed_at": "2020-12-19T17:19:50Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/1950", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1950", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1950.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1950.patch", "merged_at": "2020-12-19T17:19:50Z"}, "body": "#1805 softly deprecated a configuration, but the new configuration didn't work which made the user pods not startup with an initContainer blocking access to the metadata server which is known to be a security concern.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1950/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1950/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1941", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1941/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1941/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1941/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1941", "id": 763054751, "node_id": "MDExOlB1bGxSZXF1ZXN0NTM3NTQ0MTgy", "number": 1941, "title": "Enable hub livenessProbe by default and relax hub/proxy probes", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/milestones/8", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/milestone/8", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/milestones/8/labels", "id": 6205752, "node_id": "MDk6TWlsZXN0b25lNjIwNTc1Mg==", "number": 8, "title": "0.11.0", "description": "", "creator": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 8, "state": "closed", "created_at": "2020-12-11T22:54:28Z", "updated_at": "2021-01-15T16:17:50Z", "due_on": "2020-12-23T08:00:00Z", "closed_at": "2021-01-15T16:17:50Z"}, "comments": 2, "created_at": "2020-12-11T23:36:45Z", "updated_at": "2021-01-14T17:11:43Z", "closed_at": "2020-12-12T17:42:45Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/1941", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1941", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1941.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1941.patch", "merged_at": "2020-12-12T17:42:44Z"}, "body": "This PR closes #1936 and stems from a deliberations in #1732 that I suggest we close when we have added a startupProbe as suggested in an action point in https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1732#issuecomment-705277165.\n\nThe actual changes are:\n1. Enable hub's livenessProbe by default.\n2. Make hub's livenessProbe start after 5 minutes (from 3), and trigger a pod restart after >5 minutes without any response (from >30s).\n3. Make hub's readinessProbe very relaxed so it won't fail before the hub's livenessProbe or generally at all, because it would not serve a purpose to have a non-ready hub pod as it doesn't support being run in parallel with another pod.\n4. Make proxy's readinessProbe be very relaxed for the same reasons at the hub pod.\n\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1941/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1941/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1938", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1938/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1938/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1938/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1938", "id": 761732742, "node_id": "MDExOlB1bGxSZXF1ZXN0NTM2MzU1NTQz", "number": 1938, "title": "Disable PDBs for hub/proxy, add PDB for autohttps, and relocate config proxy.pdb to proxy.chp.pdb", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 2398426378, "node_id": "MDU6TGFiZWwyMzk4NDI2Mzc4", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/breaking", "name": "breaking", "color": "ad3727", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/milestones/8", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/milestone/8", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/milestones/8/labels", "id": 6205752, "node_id": "MDk6TWlsZXN0b25lNjIwNTc1Mg==", "number": 8, "title": "0.11.0", "description": "", "creator": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 8, "state": "closed", "created_at": "2020-12-11T22:54:28Z", "updated_at": "2021-01-15T16:17:50Z", "due_on": "2020-12-23T08:00:00Z", "closed_at": "2021-01-15T16:17:50Z"}, "comments": 7, "created_at": "2020-12-11T00:12:29Z", "updated_at": "2021-01-14T17:11:39Z", "closed_at": "2020-12-21T21:11:52Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/1938", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1938", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1938.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1938.patch", "merged_at": "2020-12-21T21:11:51Z"}, "body": "This PR follows #1937 and discussion in #1934. I suggest we continue the discussion about _what to do_ in #1934 unless it is about the lines of codes changed.\r\n\r\nI've opened https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1951 to represent the wish for better documentation about HA so that the we are more explicit with assumptions.\r\n\r\n## PR summary\r\n\r\n- [x] Disabling hub/proxy PDB by default.\r\n  This is done to close #1934, and motivated by them being non-HA applications. For more in-depth discussion, see #1934.\r\n- [x] Added autohttps PDB, also disabled by default.\r\n  This is done for completeness as it would generally make sense to enable PDBs for proxy/hub/autohttps all at once if either was enabled.\r\n- [x] Renamed pdb configuration proxy.pdb to to proxy.chp.pdb.\r\n  This was done to make the configuration more cohesive and easy to understand now that we have one for the proxy pod and the autohttps pod. This is in alignment of how we have mapped the other configuration. It will make it easier in the future if we replace the configurable-http-proxy with another implementation also that may merit from other defaults. The old name is deprecated with a `fail` to help users quickly spot the change and transition.\r\n\r\n## Motivation for the new default\r\n\r\n1. Most other Helm chart defaults to having PDBs disabled by default\r\n   making our chart's behavior unexpected.\r\n\r\n2. The idea of using a PDB is tightly coupled with applications that\r\n   support high availability, in other words, to run in parallel to\r\n   another. But, the hub/proxy/autohttps pod doesn't support it. As an\r\n   indication of this, see the k8s docs on \"configure-pdb\" which has a\r\n   \"Before you begin\" section that sais \"You are the owner of an\r\n   application running on a Kubernetes cluster that requires high\r\n   availability.\r\n\r\n   ref: https://kubernetes.io/docs/tasks/run-application/configure-pdb/\r\n\r\n3. When evictions take place, such as when a node is drained, the PDBs\r\n   will be respected, and since we have `minAvailable: 1` and cannot\r\n   create another one, a manual pod deletion is required.\r\n\r\n   It is my perception that the act of draining a node should come with\r\n   intent and consideration typically. If it comes as part of an\r\n   automated k8s upgrade of nodes, it should at least be scheduled at a\r\n   acceptable time window etc. So, it wouldn't be helpful to add the\r\n   need to run `kubect delete pod` alongside this.\r\n\r\n4. If the wish is to avoid making the cluster autoscaler relocate a pod\r\n   part of a deployment, then it is more direct and sensible to use the\r\n   `\"cluster-autoscaler.kubernetes.io/safe-to-evict\": \"false\"`\r\n   annotation.\r\n\r\n   ref: https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/FAQ.md#what-types-of-pods-can-prevent-ca-from-removing-a-node", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1938/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1938/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1936", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1936/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1936/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1936/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1936", "id": 761153873, "node_id": "MDU6SXNzdWU3NjExNTM4NzM=", "number": 1936, "title": "hub pod's readinessProbe too strict", "user": {"login": "chrisbulgaria", "id": 54033534, "node_id": "MDQ6VXNlcjU0MDMzNTM0", "avatar_url": "https://avatars.githubusercontent.com/u/54033534?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chrisbulgaria", "html_url": "https://github.com/chrisbulgaria", "followers_url": "https://api.github.com/users/chrisbulgaria/followers", "following_url": "https://api.github.com/users/chrisbulgaria/following{/other_user}", "gists_url": "https://api.github.com/users/chrisbulgaria/gists{/gist_id}", "starred_url": "https://api.github.com/users/chrisbulgaria/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chrisbulgaria/subscriptions", "organizations_url": "https://api.github.com/users/chrisbulgaria/orgs", "repos_url": "https://api.github.com/users/chrisbulgaria/repos", "events_url": "https://api.github.com/users/chrisbulgaria/events{/privacy}", "received_events_url": "https://api.github.com/users/chrisbulgaria/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/milestones/8", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/milestone/8", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/milestones/8/labels", "id": 6205752, "node_id": "MDk6TWlsZXN0b25lNjIwNTc1Mg==", "number": 8, "title": "0.11.0", "description": "", "creator": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 8, "state": "closed", "created_at": "2020-12-11T22:54:28Z", "updated_at": "2021-01-15T16:17:50Z", "due_on": "2020-12-23T08:00:00Z", "closed_at": "2021-01-15T16:17:50Z"}, "comments": 7, "created_at": "2020-12-08T17:13:16Z", "updated_at": "2020-12-12T17:42:45Z", "closed_at": "2020-12-12T17:42:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "\r\n### Bug description\r\n\r\nUsing a custom authenticator for jupyterhub (on kubernetes) which takes some time todo the authentication  -  > 10sec. Upgrading from helm chart version 0.9.1 (where everything was working) to 0.10.6.\r\nNow after the login the redirect to /hub/ times out after 1 minute, resulting in HTTP 503. Logs below.\r\nA refresh of the browser (repeating the call to /hub) works then without problems.\r\nIt seems to be  related to the time the authenticator takes - with 5 sec all is fine, > 10 sec not\r\n#### Expected behaviour\r\nThe call to /hub succedes (does the spawn) \r\n#### Actual behaviour\r\nHTTP 503\r\n\r\n### How to reproduce\r\nUse below as custom authenticator reproduces,\r\n\r\n\r\n    def authenticate(self, handler, data):\r\n\r\n      \r\n        print(\"enter authenticate\") \r\n\r\n        time.sleep(10)\r\n        return {\r\n            'name': 'testuser'} \r\n\r\n\r\n### Your personal set up\r\n\r\nJupyterhub (helm chart 0.10.6 on Kubernetes (EKS)). On 0.9.1 works fine.\r\n```\r\n# paste relevant logs here, if any\r\n`\r\nproxy\r\n\r\n6:42:45.269 [ConfigProxy] info: 200 GET /api/routes\r\n16:43:43.427 [ConfigProxy] info: 200 GET /api/routes\r\n16:43:43.437 [ConfigProxy] info: 200 GET /api/routes\r\n16:43:51.066 [ConfigProxy] debug: PROXY WEB /hub/ to http://hub:8081\r\n16:43:51.092 [ConfigProxy] debug: PROXY WEB /hub/login?next=%2Fhub%2F to http://hub:8081\r\n16:44:01.129 [ConfigProxy] debug: PROXY WEB /hub/ to http://hub:8081\r\n16:44:43.443 [ConfigProxy] info: 200 GET /api/routes\r\n16:45:01.130 [ConfigProxy] error: 503 GET /hub/ socket hang up\r\n16:45:01.437 [ConfigProxy] debug: PROXY WEB /favicon.ico to http://hub:8081\r\n16:45:43.443 [ConfigProxy] info: 200 GET /api/routes\r\n16:46:43.453 [ConfigProxy] info: 200 GET /api/routes\r\n\r\nHub\r\n\r\nD 2020-12-08 16:43:50.526 JupyterHub log:181] 200 GET /hub/health (@xxxx) 0.73ms\r\n[I 2020-12-08 16:43:51.070 JupyterHub log:181] 302 GET /hub/ -> /hub/login?next=%2Fhub%2F (@x) 0.90ms\r\nenter authenticate\r\n[D 2020-12-08 16:44:01.108 JupyterHub base:519] Setting cookie jupyterhub-session-id: {'httponly': True}\r\n[D 2020-12-08 16:44:01.109 JupyterHub base:523] Setting cookie for schaper: jupyterhub-hub-login\r\n[D 2020-12-08 16:44:01.109 JupyterHub base:519] Setting cookie jupyterhub-hub-login: {'httponly': True, 'path': '/hub/'}\r\n[I 2020-12-08 16:44:01.110 JupyterHub base:755] User logged in: testuser\r\n[I 2020-12-08 16:44:01.110 JupyterHub log:181] 302 GET /hub/login?next=%2Fhub%2F -> /hub/ (@x) 10015.43ms\r\n[D 2020-12-08 16:44:01.114 JupyterHub log:181] 200 GET /hub/health (@x) 2.52ms\r\n[D 2020-12-08 16:44:01.116 JupyterHub log:181] 200 GET /hub/health (@x) 3.94ms\r\n[D 2020-12-08 16:44:01.116 JupyterHub log:181] 200 GET /hub/health (@x) 4.06ms\r\n...\r\n[D 2020-12-08 16:44:34.527 JupyterHub log:181] 200 GET /hub/health (@x) 0.66ms\r\n[D 2020-12-08 16:44:36.526 JupyterHub log:181] 200 GET /hub/health (@x) 0.69ms\r\n[D 2020-12-08 16:44:38.526 JupyterHub log:181] 200 GET /hub/health (@x) 0.65ms\r\n[D 2020-12-08 16:44:40.526 JupyterHub log:181] 200 GET /hub/health (@x) 0.64ms\r\n[D 2020-12-08 16:44:42.526 JupyterHub log:181] 200 GET /hub/health (@x) 0.61ms\r\n[D 2020-12-08 16:44:43.439 JupyterHub proxy:788] Proxy: Fetching GET http://proxy-api:8001/api/routes\r\n[I 2020-12-08 16:44:43.444 JupyterHub proxy:320] Checking routes\r\n[D 2020-12-08 16:44:44.526 JupyterHub log:181] 200 GET /hub/health (@x) 0.75ms\r\n[D 2020-12-08 16:44:46.526 JupyterHub log:181] 200 GET /hub/health (@x) 0.81ms\r\n...\r\n[D 2020-12-08 16:45:00.526 JupyterHub log:181] 200 GET /hub/health (@x) 0.82ms\r\n[D 2020-12-08 16:45:01.133 JupyterHub pages:654] No template for 503\r\n[I 2020-12-08 16:45:01.169 JupyterHub log:181] 200 GET /hub/error/503?url=%2Fhub%2F (@x) 35.98ms\r\n[D 2020-12-08 16:45:01.441 JupyterHub log:181] 200 GET /favicon.ico (@x) 0.98ms\r\n\r\n\r\n\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1936/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1936/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1935", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1935/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1935/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1935/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1935", "id": 758884649, "node_id": "MDU6SXNzdWU3NTg4ODQ2NDk=", "number": 1935, "title": "LDAP authentication fails due to unsupported protocol", "user": {"login": "nicholasmireles", "id": 29737780, "node_id": "MDQ6VXNlcjI5NzM3Nzgw", "avatar_url": "https://avatars.githubusercontent.com/u/29737780?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nicholasmireles", "html_url": "https://github.com/nicholasmireles", "followers_url": "https://api.github.com/users/nicholasmireles/followers", "following_url": "https://api.github.com/users/nicholasmireles/following{/other_user}", "gists_url": "https://api.github.com/users/nicholasmireles/gists{/gist_id}", "starred_url": "https://api.github.com/users/nicholasmireles/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nicholasmireles/subscriptions", "organizations_url": "https://api.github.com/users/nicholasmireles/orgs", "repos_url": "https://api.github.com/users/nicholasmireles/repos", "events_url": "https://api.github.com/users/nicholasmireles/events{/privacy}", "received_events_url": "https://api.github.com/users/nicholasmireles/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-12-07T22:02:23Z", "updated_at": "2021-11-26T04:22:11Z", "closed_at": "2020-12-08T02:35:35Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\nWhen using the LDAP authentication method, users fail to authenticate due to an exception raised in the LDAP library.\r\n\r\n#### Expected behaviour\r\nAt the login screen, a user would successfully or unsuccessfully be authenticated via LDAP\r\n\r\n#### Actual behaviour\r\nThe user is presented with `500 : Internal Server Error` and the server shows an exception in the log.\r\n\r\n### How to reproduce\r\nhelm install the jupyterhub/jupyterhub chart with the following configuration\r\n\r\n```\r\n  type: ldap\r\n  ldap:\r\n    server:\r\n      address: LDAP_SERVER\r\n      ssl: true | false\r\n    dn: \r\n      templates:\r\n        - 'DN_STRING`\r\n```\r\n\r\n### Your personal set up\r\n - OS: ubuntu 20.04\r\n - Version(s):\r\n    - Helm verson: 3.4.1\r\n    - Chart:  jupyterhub-0.10.6\r\n    - Kubernetes version: 1.18.9\r\n\r\n<details><summary>Configuration</summary>\r\n```\r\n  type: ldap\r\n  ldap:\r\n    server:\r\n      address: LDAP_SERVER\r\n      ssl: true | false\r\n    dn: \r\n      templates:\r\n        - 'DN_STRING`\r\n```\r\n</details>\r\n\r\n<details><summary>Logs</summary>\r\n```\r\nTraceback (most recent call last):      File \"/usr/local/lib/python3.8/dist-packages/tornado/web.py\", line 1704, in _execute        result = await result      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/handlers/login.py\", line 144, in post        user = await self.login_user(data)      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/handlers/base.py\", line 747, in login_user        authenticated = await self.authenticate(data)      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/auth.py\", line 459, in get_authenticated_user        authenticated = await maybe_future(self.authenticate(handler, data))      File \"/usr/local/lib/python3.8/dist-packages/ldapauthenticator/ldapauthenticator.py\", line 382, in authenticate        conn = self.get_connection(userdn, password)      File \"/usr/local/lib/python3.8/dist-packages/ldapauthenticator/ldapauthenticator.py\", line 314, in get_connection        conn = ldap3.Connection(      File \"/usr/local/lib/python3.8/dist-packages/ldap3/core/connection.py\", line 356, in __init__        self._do_auto_bind()      File \"/usr/local/lib/python3.8/dist-packages/ldap3/core/connection.py\", line 380, in _do_auto_bind        self.open(read_server_info=False)      File \"/usr/local/lib/python3.8/dist-packages/ldap3/strategy/sync.py\", line 56, in open        BaseStrategy.open(self, reset_usage, read_server_info)\r\nFile \"/usr/local/lib/python3.8/dist-packages/ldap3/strategy/base.py\", line 145, in open        raise exception_history[0][0]    ldap3.core.exceptions.LDAPSocketOpenError: (\"('socket ssl wrapping error: [SSL: UNSUPPORTED_PROTOCOL] unsupported protocol (_ssl.c:1123)',)\",)\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1935/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1935/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1934", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1934/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1934/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1934/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1934", "id": 758641966, "node_id": "MDU6SXNzdWU3NTg2NDE5NjY=", "number": 1934, "title": "Deployments with 1 replica and a PodDisruptionBudget enabled by default prevent node drain operations from succeeding", "user": {"login": "DaniJG", "id": 3903889, "node_id": "MDQ6VXNlcjM5MDM4ODk=", "avatar_url": "https://avatars.githubusercontent.com/u/3903889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DaniJG", "html_url": "https://github.com/DaniJG", "followers_url": "https://api.github.com/users/DaniJG/followers", "following_url": "https://api.github.com/users/DaniJG/following{/other_user}", "gists_url": "https://api.github.com/users/DaniJG/gists{/gist_id}", "starred_url": "https://api.github.com/users/DaniJG/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DaniJG/subscriptions", "organizations_url": "https://api.github.com/users/DaniJG/orgs", "repos_url": "https://api.github.com/users/DaniJG/repos", "events_url": "https://api.github.com/users/DaniJG/events{/privacy}", "received_events_url": "https://api.github.com/users/DaniJG/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/milestones/8", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/milestone/8", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/milestones/8/labels", "id": 6205752, "node_id": "MDk6TWlsZXN0b25lNjIwNTc1Mg==", "number": 8, "title": "0.11.0", "description": "", "creator": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 8, "state": "closed", "created_at": "2020-12-11T22:54:28Z", "updated_at": "2021-01-15T16:17:50Z", "due_on": "2020-12-23T08:00:00Z", "closed_at": "2021-01-15T16:17:50Z"}, "comments": 26, "created_at": "2020-12-07T16:07:45Z", "updated_at": "2021-03-11T12:06:26Z", "closed_at": "2020-12-21T21:11:51Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\nInstalling the chart with the default values results in workloads such as the hub created with a hardcoded `replica: 1` and a PodDisruptionBudget with `minAvailable: 1`.\r\n```\r\nkubectl get poddisruptionbudget --all-namespaces\r\nNAMESPACE    NAME               MIN AVAILABLE   MAX UNAVAILABLE   ALLOWED DISRUPTIONS   AGE\r\njupyterhub   hub                1               N/A               0                     191d\r\njupyterhub   proxy              1               N/A               0                     191d\r\njupyterhub   user-placeholder   0               N/A               0                     191d\r\njupyterhub   user-scheduler     1               N/A               0    \r\n```\r\n\r\nThis prevents operations such as draining the node with kured (see https://github.com/weaveworks/kured/issues/82) which require the workload to be redeployed to a different node, killing that single replica in the process. Any operation that needs to kill that single replica will conflict with the PodDisruptionBudget that is defined by default.\r\n\r\nYou can see in the kured's output the following error repeated again and again:\r\n```\r\ntime=\"2020-12-07T11:59:35Z\" level=info msg=\"evicting pod jupyterhub/hub-6dddf4fdc7-mv8jg\" cmd=/usr/bin/kubectl std=out\r\ntime=\"2020-12-07T11:59:35Z\" level=warning msg=\"error when evicting pod \\\"hub-6dddf4fdc7-mv8jg\\\" (will retry after 5s): Cannot evict pod as it would violate the pod's disruption budget.\" cmd=/usr/bin/kubectl std=err\r\ntime=\"2020-12-07T11:59:40Z\" level=info msg=\"evicting pod jupyterhub/hub-6dddf4fdc7-mv8jg\" cmd=/usr/bin/kubectl std=out\r\ntime=\"2020-12-07T11:59:40Z\" level=warning msg=\"error when evicting pod \\\"hub-6dddf4fdc7-mv8jg\\\" (will retry after 5s): Cannot evict pod as it would violate the pod's disruption budget.\" cmd=/usr/bin/kubectl std=err\r\n```\r\n\r\nThe only way to redeploy such workload and automated processes such as node drains or kured reboots is by manually removing the PDB. (See https://kubernetes.io/docs/tasks/run-application/configure-pdb/#think-about-how-your-application-reacts-to-disruptions)\r\n\r\n#### Expected behaviour\r\nI would expect the PodDisruptionBudgets to be disabled by default (or to include a `minAvailable: 0` by default). This way installing Jupyter using its default values will not prevent nodes from being drained (or similar operations that might require redeploying the workload)\r\n\r\n#### Actual behaviour\r\nby default jupyter will deploy both the `hub` and `proxy` workloads with one replica and a PodDisrutionBudget that includes `minAvailable: 1`. This prevents maintenance operations like a controller kured reboot (which needs to drain the node) since any operation killing the container will fail.\r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\nFollow these steps:\r\n1. Install and start minikube\r\n2. Install kured using its official chart\r\n    ```\r\n    $ helm repo add kured https://weaveworks.github.io/kured\r\n    $ helm install kured kured/kured --set configuration.period=1m\r\n    ```\r\n3. Install jupyter using this chart\r\n    ```\r\n    $ helm repo add jupyterhub https://jupyterhub.github.io/helm-chart/\r\n    $ helm repo update\r\n    $ helm install jupyter jupyterhub/jupyterhub --set proxy.secretToken=$(openssl rand -hex 32)\r\n    ```\r\n4. Run  `minikube ssh`\r\n5. Run `sudo touch /var/run/reboot-required`\r\n5. Check the logs of the kured container. Note how the drain operation is consistently being attempted and failing due to the default PodDisruptionBudget\r\n    ```\r\n    $ kubectl logs kured-8ndbm --tail 10 -f\r\n    ...\r\n    error when evicting pod \"proxy-569d78d49c-wc6db\" (will retry after 5s): Cannot evict pod as it would violate the pod's disruption budget.\r\n    evicting pod default/user-scheduler-8664cb5984-hctvs\r\n    error when evicting pod \"user-scheduler-8664cb5984-hctvs\" (will retry after 5s): Cannot evict pod as it would violate the \r\n    pod's disruption budget.\r\n    ...\r\n    ```\r\n\r\nIf you want, cleanup your minikube environment with:\r\n```\r\n$ helm delete kured\r\n$ helm delete jupyter\r\n```\r\n### Your personal set up\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n\r\nMinikube:\r\n ```\r\n$ minikube version\r\nminikube version: v1.15.1\r\n```\r\n\r\nJupyter chart\r\n```\r\n$ helm show chart jupyterhub/jupyterhub\r\napiVersion: v1\r\nappVersion: 1.2.2\r\ndescription: Multi-user Jupyter installation\r\nhome: https://z2jh.jupyter.org\r\nicon: https://jupyter.org/assets/hublogo.svg\r\nkubeVersion: '>=1.14.0-0'\r\nmaintainers:\r\n- email: erik@sundellopensource.se\r\n  name: Erik Sundell\r\n- name: Simon Li\r\n  url: https://github.com/manics/\r\nname: jupyterhub\r\nsources:\r\n- https://github.com/jupyterhub/zero-to-jupyterhub-k8s\r\nversion: 0.10.6\r\n- kured chart\r\n```\r\n\r\nkured chart\r\n```\r\n$ helm show chart kured/kured\r\napiVersion: v1\r\nappVersion: 1.5.1\r\ndescription: A Helm chart for kured\r\nhome: https://github.com/weaveworks/kured\r\nicon: https://raw.githubusercontent.com/weaveworks/kured/master/img/logo.png\r\nmaintainers:\r\n- email: christian.kotzbauer@gmail.com\r\n  name: ckotzbauer\r\n- email: david@davidkarlsen.com\r\n  name: davidkarlsen\r\nname: kured\r\nsources:\r\n- https://github.com/weaveworks/kured\r\nversion: 2.2.1\r\n```\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1934/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1934/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1929", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1929/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1929/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1929/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1929", "id": 757368707, "node_id": "MDU6SXNzdWU3NTczNjg3MDc=", "number": 1929, "title": "Cannot modify auth_state", "user": {"login": "kyprifog", "id": 991756, "node_id": "MDQ6VXNlcjk5MTc1Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/991756?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyprifog", "html_url": "https://github.com/kyprifog", "followers_url": "https://api.github.com/users/kyprifog/followers", "following_url": "https://api.github.com/users/kyprifog/following{/other_user}", "gists_url": "https://api.github.com/users/kyprifog/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyprifog/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyprifog/subscriptions", "organizations_url": "https://api.github.com/users/kyprifog/orgs", "repos_url": "https://api.github.com/users/kyprifog/repos", "events_url": "https://api.github.com/users/kyprifog/events{/privacy}", "received_events_url": "https://api.github.com/users/kyprifog/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-12-04T20:02:53Z", "updated_at": "2020-12-05T11:14:54Z", "closed_at": "2020-12-05T11:14:54Z", "author_association": "NONE", "active_lock_reason": null, "body": "Using version 0.10.2\r\n\r\nI have a post_auth_hook in which I am attempted to modify the auth_state (or pass it on in any way shape or form):\r\n\r\n```\r\ndef post_auth_hook(authenticator, handler, authentication):\r\n    log(\"Running post auth hook\")\r\n    log(f\"AUTHENTICATION: {authentication}\")\r\n    auth_state = authentication[\"auth_state\"] \r\n    auth_state[\"monkey\"] = \"bananans\"\r\n    authentication[\"auth_state\"] = auth_state\r\n    log(f\"AUTH NOW: {authentication}\")\r\n    return authentication\r\n```\r\nWhich shows the values you would expect in the authentication hash that is being passed back.\r\nBut when I go into the SQL lite database and look it does not appear that the auth state is changing:\r\n\r\n```\r\nselect * from users where name is  'USERNAME' limit 1;\r\n2|USERNAME|0|2020-11-30 20:11:20.647034|2020-12-04 19:50:01.243342|29b227711e9c4f50ab6294f1f40c406f|{}|\r\n```\r\nThen after logging in I get:\r\n```\r\n2|USERNAME|0|2020-11-30 20:11:20.647034|2020-12-04 19:54:02.656352|29b227711e9c4f50ab6294f1f40c406f|{}|\r\n```\r\n\r\nThe last active date is changing but the hash for the auth_state does not appear to have changed. As a result when I try to access it in other hooks I am always getting None:\r\n\r\n```\r\nasync def pre_spawn_hook(spawner):\r\n    auth_state = await spawner.user.get_auth_state()\r\n    log(f\"AUTH PRE SPAWN {auth_state}\")\r\n    return spawner\r\n```\r\n\r\nResults in `None`\r\n\r\nI also tried to add an update_auth_state hook (as the documentation was not clear as to whether or not this was required for it to even work, if so should be the default IMO):\r\n\r\n```\r\ndef userdata_hook(spawner, auth_state):\r\n    log(f\"AUTH_STATE FROM HOOK: {auth_state}\")\r\n    spawner.userdata = auth_state \r\n```\r\n\r\n```\r\nc.KubeSpawner.auth_state_hook = userdata_hook\r\n```\r\nBut it appears that the auth_state in this hook is already `None`\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1929/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1929/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1924", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1924/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1924/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1924/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1924", "id": 752302433, "node_id": "MDExOlB1bGxSZXF1ZXN0NTI4NjUyMzk5", "number": 1924, "title": "image: bump JupyterHub to 1.2.2 from 1.2.1 for bugfixes", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 2435133741, "node_id": "MDU6TGFiZWwyNDM1MTMzNzQx", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/dependencies", "name": "dependencies", "color": "ea5dc7", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-11-27T14:45:54Z", "updated_at": "2020-11-27T15:11:06Z", "closed_at": "2020-11-27T15:11:06Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/1924", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1924", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1924.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1924.patch", "merged_at": "2020-11-27T15:11:06Z"}, "body": "See [the JupyterHub changelog here](https://jupyterhub.readthedocs.io/en/stable/changelog.html?highlight=changelog).", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1924/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1924/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1918", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1918/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1918/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1918/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1918", "id": 747283022, "node_id": "MDExOlB1bGxSZXF1ZXN0NTI0NTMyNzIz", "number": 1918, "title": "hub image: bump oauthenticator and prometheus-client", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-11-20T08:20:03Z", "updated_at": "2020-11-21T13:13:19Z", "closed_at": "2020-11-20T21:27:52Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/1918", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1918", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1918.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1918.patch", "merged_at": "2020-11-20T21:27:52Z"}, "body": "This patch bump of oauthenticator is likely to fix the bug described here: https://github.com/jupyterhub/jupyterhub/issues/3277, so I'm cutting a patch release of z2jh for it.\r\n\r\n---\r\n\r\nCloses #1917 which behaves a bit differently, hmmm... This bump was made with the `./dependency freeze --freeze` and it results in a bit different changes than dependencybot gives us. It does notify us about something though.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1918/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1918/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1916", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1916/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1916/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1916/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1916", "id": 745163024, "node_id": "MDU6SXNzdWU3NDUxNjMwMjQ=", "number": 1916, "title": "Failed to connect to Hub API at http://hub:8081/hub/hub/api", "user": {"login": "tirumerla", "id": 57160285, "node_id": "MDQ6VXNlcjU3MTYwMjg1", "avatar_url": "https://avatars.githubusercontent.com/u/57160285?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tirumerla", "html_url": "https://github.com/tirumerla", "followers_url": "https://api.github.com/users/tirumerla/followers", "following_url": "https://api.github.com/users/tirumerla/following{/other_user}", "gists_url": "https://api.github.com/users/tirumerla/gists{/gist_id}", "starred_url": "https://api.github.com/users/tirumerla/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tirumerla/subscriptions", "organizations_url": "https://api.github.com/users/tirumerla/orgs", "repos_url": "https://api.github.com/users/tirumerla/repos", "events_url": "https://api.github.com/users/tirumerla/events{/privacy}", "received_events_url": "https://api.github.com/users/tirumerla/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-11-17T23:27:42Z", "updated_at": "2020-11-18T00:05:29Z", "closed_at": "2020-11-18T00:05:29Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML commments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\nHi Guys,\r\n\r\nI\u2019m running into this issue after single user pods spawns and trying to connect to hub which is running in a **different namespace than single user pods**.\r\n\r\n[Doesn't this code](https://github.com/jupyterhub/zero-to-jupyterhub-k8s/blob/master/jupyterhub/files/hub/jupyterhub_config.py#L91) needs to be `http://hub.<singleuser_pods_namespace>:8081/hub/hub/api`\r\n\r\n#### Expected behaviour\r\nSingle user pods should connect to hub without issues.\r\n\r\n#### Actual behaviour\r\n```\r\n[E 2020-11-17 00:45:06.093 SingleUserNotebookApp log:174] 500 GET /hub/user/tirumerla/oauth_callback?code=[secret]&state=[secret] (@172.30.12.179) 29.46ms\r\n[E 2020-11-17 00:45:10.023 SingleUserNotebookApp singleuser:438] Failed to connect to my Hub at http://hub:8081/hub/hub/api (attempt 3/5). Is it running?\r\n    Traceback (most recent call last):\r\n      File \"/opt/conda/lib/python3.6/site-packages/jupyterhub/singleuser.py\", line 432, in check_hub_version\r\n        resp = await client.fetch(self.hub_api_url)\r\n      File \"/opt/conda/lib/python3.6/site-packages/tornado/simple_httpclient.py\", line 336, in run\r\n        source_ip=source_ip,\r\n      File \"/opt/conda/lib/python3.6/site-packages/tornado/tcpclient.py\", line 270, in connect\r\n        addrinfo = await self.resolver.resolve(host, port, af)\r\n      File \"/opt/conda/lib/python3.6/site-packages/tornado/netutil.py\", line 396, in resolve\r\n        None, _resolve_addr, host, port, family\r\n      File \"/opt/conda/lib/python3.6/concurrent/futures/thread.py\", line 56, in run\r\n        result = self.fn(*self.args, **self.kwargs)\r\n      File \"/opt/conda/lib/python3.6/site-packages/tornado/netutil.py\", line 379, in _resolve_addr\r\n        addrinfo = socket.getaddrinfo(host, port, family, socket.SOCK_STREAM)\r\n      File \"/opt/conda/lib/python3.6/socket.py\", line 745, in getaddrinfo\r\n        for res in _socket.getaddrinfo(host, port, family, type, proto, flags):\r\n    socket.gaierror: [Errno -2] Name or service not known\r\n[E 2020-11-17 00:45:18.035 SingleUserNotebookApp singleuser:438] Failed to connect to my Hub at http://hub:8081/hub/hub/api (attempt 4/5). Is it running?\r\n    Traceback (most recent call last):\r\n      File \"/opt/conda/lib/python3.6/site-packages/jupyterhub/singleuser.py\", line 432, in check_hub_version\r\n        resp = await client.fetch(self.hub_api_url)\r\n      File \"/opt/conda/lib/python3.6/site-packages/tornado/simple_httpclient.py\", line 336, in run\r\n        source_ip=source_ip,\r\n      File \"/opt/conda/lib/python3.6/site-packages/tornado/tcpclient.py\", line 270, in connect\r\n        addrinfo = await self.resolver.resolve(host, port, af)\r\n      File \"/opt/conda/lib/python3.6/site-packages/tornado/netutil.py\", line 396, in resolve\r\n        None, _resolve_addr, host, port, family\r\n      File \"/opt/conda/lib/python3.6/concurrent/futures/thread.py\", line 56, in run\r\n        result = self.fn(*self.args, **self.kwargs)\r\n      File \"/opt/conda/lib/python3.6/site-packages/tornado/netutil.py\", line 379, in _resolve_addr\r\n        addrinfo = socket.getaddrinfo(host, port, family, socket.SOCK_STREAM)\r\n      File \"/opt/conda/lib/python3.6/socket.py\", line 745, in getaddrinfo\r\n        for res in _socket.getaddrinfo(host, port, family, type, proto, flags):\r\n    socket.gaierror: [Errno -2] Name or service not known\r\n[E 2020-11-17 00:45:34.048 SingleUserNotebookApp singleuser:438] Failed to connect to my Hub at http://hub:8081/hub/hub/api (attempt 5/5). Is it running?\r\n    Traceback (most recent call last):\r\n      File \"/opt/conda/lib/python3.6/site-packages/jupyterhub/singleuser.py\", line 432, in check_hub_version\r\n        resp = await client.fetch(self.hub_api_url)\r\n      File \"/opt/conda/lib/python3.6/site-packages/tornado/simple_httpclient.py\", line 336, in run\r\n        source_ip=source_ip,\r\n      File \"/opt/conda/lib/python3.6/site-packages/tornado/tcpclient.py\", line 270, in connect\r\n        addrinfo = await self.resolver.resolve(host, port, af)\r\n      File \"/opt/conda/lib/python3.6/site-packages/tornado/netutil.py\", line 396, in resolve\r\n        None, _resolve_addr, host, port, family\r\n      File \"/opt/conda/lib/python3.6/concurrent/futures/thread.py\", line 56, in run\r\n        result = self.fn(*self.args, **self.kwargs)\r\n      File \"/opt/conda/lib/python3.6/site-packages/tornado/netutil.py\", line 379, in _resolve_addr\r\n        addrinfo = socket.getaddrinfo(host, port, family, socket.SOCK_STREAM)\r\n      File \"/opt/conda/lib/python3.6/socket.py\", line 745, in getaddrinfo\r\n        for res in _socket.getaddrinfo(host, port, family, type, proto, flags):\r\n    socket.gaierror: [Errno -2] Name or service not known\r\n```\r\n\r\n### How to reproduce\r\n\r\nDeploy Jupyterhub pods in \"A\" namespace and singleuser pods in \"B\" namespace using `c.KubeSpawner.namespace = 'B'`\r\nYou will see - `Failed to connect to Hub API at 'http://hub:8081/hub/hub/api'.  Is the Hub accessible at this URL`\r\n\r\n### Your personal set up\r\n\r\nHelm chart version: `0.10.2`\r\nK8s version: `eks v1.17`\r\nJupyterhub version: `1.1.0`\r\n\r\n[Posted on discourse](https://discourse.jupyter.org/t/500-failed-to-connect-to-my-hub-at-http-hub-8081-hub-hub-api/6785) as well.\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1916/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1916/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1914", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1914/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1914/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1914/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1914", "id": 744722083, "node_id": "MDU6SXNzdWU3NDQ3MjIwODM=", "number": 1914, "title": "Authenticator not honoring the auth.whitelist.users key", "user": {"login": "TiemenSch", "id": 7141863, "node_id": "MDQ6VXNlcjcxNDE4NjM=", "avatar_url": "https://avatars.githubusercontent.com/u/7141863?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TiemenSch", "html_url": "https://github.com/TiemenSch", "followers_url": "https://api.github.com/users/TiemenSch/followers", "following_url": "https://api.github.com/users/TiemenSch/following{/other_user}", "gists_url": "https://api.github.com/users/TiemenSch/gists{/gist_id}", "starred_url": "https://api.github.com/users/TiemenSch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TiemenSch/subscriptions", "organizations_url": "https://api.github.com/users/TiemenSch/orgs", "repos_url": "https://api.github.com/users/TiemenSch/repos", "events_url": "https://api.github.com/users/TiemenSch/events{/privacy}", "received_events_url": "https://api.github.com/users/TiemenSch/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 12, "created_at": "2020-11-17T13:08:42Z", "updated_at": "2020-11-30T11:54:59Z", "closed_at": "2020-11-30T11:54:59Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML commments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n\r\nThe user whitelist is not being honored when using the Gitlab OAuthenticator.\r\n\r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\n\r\nOnly users in the whitelist should be able to login to the JupyterHub.\r\n\r\n#### Actual behaviour\r\n\r\nAny (Gitlab) user is able to login and use the JupyterHub instance.\r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\nTry logging in with a account not in the whitelist.\r\n\r\n### Your personal set up\r\n<!-- Tell us a little about the system you're using. -->\r\n\r\n```yaml\r\nauth:\r\n  whitelist:\r\n    users:\r\n      - user1\r\n      - user2\r\n  admin:\r\n    access: true\r\n    users:\r\n      - <REDACTED>\r\n  type: gitlab\r\n  gitlab:\r\n    clientId: <REDACTED>\r\n    clientSecret: <REDACTED>\r\n    callbackUrl: <REDACTED>\r\n  scopes:\r\n    - \"read_user\"\r\n```\r\n - OS: Linux\r\n - Version: Chart 0.10.2\r\n - Configuration: See above. \r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1914/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1914/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1912", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1912/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1912/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1912/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1912", "id": 743324327, "node_id": "MDExOlB1bGxSZXF1ZXN0NTIxMjQ0Njg5", "number": 1912, "title": "hub image: kubernetes 12.0.1, nativeauth 0.0.6, tornado 6.1", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 2398427860, "node_id": "MDU6TGFiZWwyMzk4NDI3ODYw", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/maintenance", "name": "maintenance", "color": "de9af4", "default": false, "description": ""}, {"id": 2435133741, "node_id": "MDU6TGFiZWwyNDM1MTMzNzQx", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/dependencies", "name": "dependencies", "color": "ea5dc7", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-11-15T19:15:35Z", "updated_at": "2021-01-15T16:20:28Z", "closed_at": "2020-11-15T19:28:02Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/1912", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1912", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1912.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1912.patch", "merged_at": "2020-11-15T19:28:02Z"}, "body": "This PR bumps some dependencies in the hub image. There was a bugfix that could cause the kubernetes/python-client library to crash in kubespawner which would make the hub pod crash if the k8s server had some unrelated issues I think.\r\n\r\nFor more info on the kubernetes 12.0.0 -> 12.0.1 bump, see https://github.com/kubernetes-client/python/blob/master/CHANGELOG.md#v1201", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1912/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1912/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1908", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1908/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1908/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1908/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1908", "id": 741829391, "node_id": "MDU6SXNzdWU3NDE4MjkzOTE=", "number": 1908, "title": "Old images remain on AWS EKS nodes indefinitely?", "user": {"login": "petebachant", "id": 4604869, "node_id": "MDQ6VXNlcjQ2MDQ4Njk=", "avatar_url": "https://avatars.githubusercontent.com/u/4604869?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petebachant", "html_url": "https://github.com/petebachant", "followers_url": "https://api.github.com/users/petebachant/followers", "following_url": "https://api.github.com/users/petebachant/following{/other_user}", "gists_url": "https://api.github.com/users/petebachant/gists{/gist_id}", "starred_url": "https://api.github.com/users/petebachant/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petebachant/subscriptions", "organizations_url": "https://api.github.com/users/petebachant/orgs", "repos_url": "https://api.github.com/users/petebachant/repos", "events_url": "https://api.github.com/users/petebachant/events{/privacy}", "received_events_url": "https://api.github.com/users/petebachant/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 2089494150, "node_id": "MDU6TGFiZWwyMDg5NDk0MTUw", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/support", "name": "support", "color": "8fad22", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-11-12T18:30:32Z", "updated_at": "2020-11-12T18:41:30Z", "closed_at": "2020-11-12T18:36:56Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML commments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\n\r\nWe may have an unusual JupyterHub use case, but we rebuild and deploy images on the order of once per day. Everything works well except the nodes eventually fill up their storage and then fail to start servers.\r\n\r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\n\r\nOld images should be pruned so long as there are no containers running them.\r\n\r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\n\r\nOld images seem to persist for the entire node life.\r\n\r\n### Your personal set up\r\n<!-- Tell us a little about the system you're using. -->\r\n\r\nWe are running JupyterHub Helm chart v0.10.2 on AWS EKS with one user per node. Each node has 30 GB of storage.\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1908/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1908/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1892", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1892/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1892/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1892/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1892", "id": 733222450, "node_id": "MDExOlB1bGxSZXF1ZXN0NTEzMDM5NzAx", "number": 1892, "title": "Add securityContext to all image-puller pods' containers", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-10-30T14:17:53Z", "updated_at": "2020-10-30T14:20:14Z", "closed_at": "2020-10-30T14:20:14Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/1892", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1892", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1892.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1892.patch", "merged_at": "2020-10-30T14:20:14Z"}, "body": "This PR closes #1891 which was very beutifully written by @jatinder91, thank you :heart: :tada:!\n\nI intend to cut a 0.10.2 release with this merged.\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1892/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1892/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1891", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1891/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1891/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1891/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1891", "id": 733207908, "node_id": "MDU6SXNzdWU3MzMyMDc5MDg=", "number": 1891, "title": "Image-puller daemonset fails with restricted PSP", "user": {"login": "jatinder91", "id": 10898523, "node_id": "MDQ6VXNlcjEwODk4NTIz", "avatar_url": "https://avatars.githubusercontent.com/u/10898523?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jatinder91", "html_url": "https://github.com/jatinder91", "followers_url": "https://api.github.com/users/jatinder91/followers", "following_url": "https://api.github.com/users/jatinder91/following{/other_user}", "gists_url": "https://api.github.com/users/jatinder91/gists{/gist_id}", "starred_url": "https://api.github.com/users/jatinder91/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jatinder91/subscriptions", "organizations_url": "https://api.github.com/users/jatinder91/orgs", "repos_url": "https://api.github.com/users/jatinder91/repos", "events_url": "https://api.github.com/users/jatinder91/events{/privacy}", "received_events_url": "https://api.github.com/users/jatinder91/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-10-30T14:01:10Z", "updated_at": "2020-10-30T15:01:17Z", "closed_at": "2020-10-30T14:20:14Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML commments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\nWhen restricted PSP is in place, the image-puller daemonset fails as below:-\r\n```\r\nNAME                       READY   STATUS                            RESTARTS   AGE\r\nhook-image-awaiter-wdgld   1/1     Running                           0          21s\r\nhook-image-puller-dcsbg    0/1     Init:CreateContainerConfigError   0          21s\r\nhook-image-puller-gbw9c    0/1     Init:CreateContainerConfigError   0          21s\r\nhook-image-puller-gztbr    0/1     Init:CreateContainerConfigError   0          21s\r\nhook-image-puller-mvhpr    0/1     Init:CreateContainerConfigError   0          21s\r\nhook-image-puller-qb4rp    0/1     Init:CreateContainerConfigError   0          21s\r\nhook-image-puller-r2txj    0/1     Init:CreateContainerConfigError   0          21s\r\n```\r\nError:\r\n```\r\nEvents:\r\n  Type     Reason     Age                From               Message\r\n  ----     ------     ----               ----               -------\r\n  Normal   Scheduled  32s                default-scheduler  Successfully assigned default/hook-image-puller-dcsbg to example-slv-02\r\n  Normal   Pulling    31s                kubelet            Pulling image \"jupyterhub/k8s-network-tools:0.10.1\"\r\n  Normal   Pulled     25s                kubelet            Successfully pulled image \"jupyterhub/k8s-network-tools:0.10.1\"\r\n  Warning  Failed     12s (x3 over 25s)  kubelet            Error: container has runAsNonRoot and image will run as root\r\n  Normal   Pulled     12s (x2 over 24s)  kubelet            Container image \"jupyterhub/k8s-network-tools:0.10.1\" already present on machine\r\n```\r\n\r\n\r\n#### Expected behaviour\r\nHelm chart should be able to deployed in restricted PSP enabled cluster.\r\n\r\n#### Actual behaviour\r\nHelm chart is not deploying in restricted PSP enabled cluster.\r\n\r\n### How to reproduce\r\nRestricted.yaml\r\n```\r\napiVersion: policy/v1beta1\r\nkind: PodSecurityPolicy\r\nmetadata:\r\n  annotations:\r\n    seccomp.security.alpha.kubernetes.io/allowedProfileNames: 'runtime/default'\r\n    seccomp.security.alpha.kubernetes.io/defaultProfileName:  'runtime/default'\r\n  name: default\r\nspec:\r\n  allowedCapabilities: []  # default set of capabilities are implicitly allowed\r\n  allowPrivilegeEscalation: false\r\n  fsGroup:\r\n    rule: 'MustRunAs'\r\n    ranges:\r\n      # Forbid adding the root group.\r\n      - min: 1\r\n        max: 65535\r\n  hostIPC: false\r\n  hostNetwork: false\r\n  hostPID: false\r\n  privileged: false\r\n  readOnlyRootFilesystem: false\r\n  runAsUser:\r\n    rule: 'MustRunAsNonRoot'\r\n  seLinux:\r\n    rule: 'RunAsAny'\r\n  supplementalGroups:\r\n    rule: 'MustRunAs'\r\n    ranges:\r\n      # Forbid adding the root group.\r\n      - min: 1\r\n        max: 65535\r\n  requiredDropCapabilities:\r\n  - ALL\r\n  volumes:\r\n  - 'configMap'\r\n  - 'downwardAPI'\r\n  - 'emptyDir'\r\n  - 'persistentVolumeClaim'\r\n  - 'projected'\r\n  - 'secret'\r\n\r\n---\r\n# Cluster role which grants access to the default pod security policy\r\napiVersion: rbac.authorization.k8s.io/v1\r\nkind: ClusterRole\r\nmetadata:\r\n  name: default-psp\r\nrules:\r\n- apiGroups:\r\n  - policy\r\n  resourceNames:\r\n  - default\r\n  resources:\r\n  - podsecuritypolicies\r\n  verbs:\r\n  - use\r\n\r\n---\r\n# Cluster role binding for default pod security policy granting all authenticated users access\r\napiVersion: rbac.authorization.k8s.io/v1\r\nkind: ClusterRoleBinding\r\nmetadata:\r\n  name: default-psp\r\nroleRef:\r\n  apiGroup: rbac.authorization.k8s.io\r\n  kind: ClusterRole\r\n  name: default-psp\r\nsubjects:\r\n- apiGroup: rbac.authorization.k8s.io\r\n  kind: Group\r\n  name: system:authenticated\r\n```\r\n1. kubectl create -f Restricted.yaml\r\n2. helm repo add jupyterhub https://jupyterhub.github.io/helm-chart/\r\n3. helm repo update\r\n4. helm install jupyterhub jupyterhub/jupyterhub --version=0.10.1\r\n\r\nFIX:\r\n\r\n\r\n1. Add variable in values.yml\r\n```\r\nprePuller:\r\n  securityContext:\r\n    runAsUser: 65534  # nobody user\r\n    runAsGroup: 65534 # nobody group\r\n```\r\n\r\n2. change in _daemonset-helper.yaml on line number 41.\r\n\r\n```\r\n   spec:\r\n      securityContext:\r\n        {{- .Values.prePuller.securityContext  | toYaml | trimSuffix \"\\n\" | nindent 8 }}\r\n```\r\n\r\noutput:\r\n```\r\nNAME                            READY   STATUS    RESTARTS   AGE\r\ncontinuous-image-puller-gcw8x   1/1     Running   0          2m22s\r\ncontinuous-image-puller-gp2q5   1/1     Running   0          2m22s\r\ncontinuous-image-puller-ktnbx   1/1     Running   0          2m22s\r\ncontinuous-image-puller-lfprz   1/1     Running   0          2m22s\r\ncontinuous-image-puller-nl7c8   1/1     Running   0          2m22s\r\ncontinuous-image-puller-wwrf2   1/1     Running   0          2m22s\r\nhub-6669f8989-snnfn             1/1     Running   0          2m22s\r\nproxy-5b98f59b4c-tf7gh          1/1     Running   0          2m22s\r\nuser-scheduler-68dd9d78-p2mq7   1/1     Running   0          2m22s\r\nuser-scheduler-68dd9d78-pvbxg   1/1     Running   0          2m22s\r\n```\r\n\r\n### personal set up\r\n\r\n - OS:\r\nCentOS Linux release 7.7.1908 (Core)\r\n - Version:\r\n 0.10.1\r\n - Configuration:\r\n ```\r\nkubectl version\r\nClient Version: version.Info{Major:\"1\", Minor:\"18\", GitVersion:\"v1.18.9\", GitCommit:\"94f372e501c973a7fa9eb40ec9ebd2fe7ca69848\", GitTreeState:\"clean\", BuildDate:\"2020-09-16T13:56:40Z\", GoVersion:\"go1.13.15\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"18\", GitVersion:\"v1.18.9\", GitCommit:\"94f372e501c973a7fa9eb40ec9ebd2fe7ca69848\", GitTreeState:\"clean\", BuildDate:\"2020-09-16T13:47:43Z\", GoVersion:\"go1.13.15\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1891/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1891/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1889", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1889/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1889/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1889/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1889", "id": 733130588, "node_id": "MDExOlB1bGxSZXF1ZXN0NTEyOTU5ODk4", "number": 1889, "title": "Use JupyterHub 1.2.1 - fixes regression for external JH services' oauth_no_confirm config", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 2435133741, "node_id": "MDU6TGFiZWwyNDM1MTMzNzQx", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/dependencies", "name": "dependencies", "color": "ea5dc7", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-10-30T12:24:41Z", "updated_at": "2020-10-30T13:34:14Z", "closed_at": "2020-10-30T12:27:13Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/1889", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1889", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1889.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1889.patch", "merged_at": "2020-10-30T12:27:13Z"}, "body": "fixes regression in 1.2.0", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1889/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1889/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1868", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1868/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1868/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1868/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1868", "id": 727885043, "node_id": "MDExOlB1bGxSZXF1ZXN0NTA4NjkyNjk4", "number": 1868, "title": "Bump KubeSpawner to 0.14.1 to fix a bug in 0.14.0 about image_pull_secrets", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-10-23T04:12:36Z", "updated_at": "2020-10-23T04:14:33Z", "closed_at": "2020-10-23T04:14:33Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/1868", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1868", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1868.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1868.patch", "merged_at": "2020-10-23T04:14:33Z"}, "body": "This PR fixes a recently introduced bug influencing the configuration of singleuser.imagePullSecrets.\r\n\r\nThank you @johnhoman :heart:", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1868/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1868/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1853", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1853/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1853/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1853/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1853", "id": 725636864, "node_id": "MDU6SXNzdWU3MjU2MzY4NjQ=", "number": 1853, "title": "Cert acquisition instability in used Traefik versions", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/milestones/6", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/milestone/6", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/milestones/6/labels", "id": 6003295, "node_id": "MDk6TWlsZXN0b25lNjAwMzI5NQ==", "number": 6, "title": "0.10.0", "description": null, "creator": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 6, "state": "closed", "created_at": "2020-10-18T11:05:18Z", "updated_at": "2021-01-15T16:17:49Z", "due_on": null, "closed_at": "2021-01-15T16:17:49Z"}, "comments": 2, "created_at": "2020-10-20T14:14:40Z", "updated_at": "2020-10-21T19:40:17Z", "closed_at": "2020-10-21T19:40:17Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "## Cert aquisition\r\nApparently the instability with cert acquisition has surfaced again, which I think relates to Traefik v2.3.1 being released and us having pinned v2.3 rather than v2.3.0 for example. I reported an issue which i think has surfaced again, and was then mostly fixed by https://github.com/traefik/traefik/pull/6939.\r\n\r\nAn example of such recent error, can be seen in https://travis-ci.org/github/jupyterhub/zero-to-jupyterhub-k8s/jobs/737397758.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1853/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1853/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1843", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1843/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1843/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1843/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1843", "id": 723402774, "node_id": "MDU6SXNzdWU3MjM0MDI3NzQ=", "number": 1843, "title": "user-scheduler: localpath-provisioner issues caused by missing permission for persistentvolumes", "user": {"login": "tuxtof", "id": 180613, "node_id": "MDQ6VXNlcjE4MDYxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/180613?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tuxtof", "html_url": "https://github.com/tuxtof", "followers_url": "https://api.github.com/users/tuxtof/followers", "following_url": "https://api.github.com/users/tuxtof/following{/other_user}", "gists_url": "https://api.github.com/users/tuxtof/gists{/gist_id}", "starred_url": "https://api.github.com/users/tuxtof/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tuxtof/subscriptions", "organizations_url": "https://api.github.com/users/tuxtof/orgs", "repos_url": "https://api.github.com/users/tuxtof/repos", "events_url": "https://api.github.com/users/tuxtof/events{/privacy}", "received_events_url": "https://api.github.com/users/tuxtof/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-10-16T17:28:07Z", "updated_at": "2020-10-17T06:04:18Z", "closed_at": "2020-10-16T19:25:20Z", "author_association": "NONE", "active_lock_reason": null, "body": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/blob/38e50c71130fcf56655685f0992f4f125bef3879/jupyterhub/templates/scheduling/user-scheduler/rbac.yaml#L45\r\n\r\npersistentvolume is missing a 's' at the end, so break on the k8s cluster using localpath-provisionner", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1843/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1843/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1842", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1842/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1842/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1842/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1842", "id": 723150072, "node_id": "MDExOlB1bGxSZXF1ZXN0NTA0Nzg2MjI1", "number": 1842, "title": "netpol: allowedIngressPorts and interNamespaceAccessLabels config added with defaults retaining 0.9.1 current behavior", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 580906361, "node_id": "MDU6TGFiZWw1ODA5MDYzNjE=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/enhancement", "name": "enhancement", "color": "84b6eb", "default": true, "description": null}, {"id": 2398426378, "node_id": "MDU6TGFiZWwyMzk4NDI2Mzc4", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/breaking", "name": "breaking", "color": "ad3727", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/milestones/6", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/milestone/6", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/milestones/6/labels", "id": 6003295, "node_id": "MDk6TWlsZXN0b25lNjAwMzI5NQ==", "number": 6, "title": "0.10.0", "description": null, "creator": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 6, "state": "closed", "created_at": "2020-10-18T11:05:18Z", "updated_at": "2021-01-15T16:17:49Z", "due_on": null, "closed_at": "2021-01-15T16:17:49Z"}, "comments": 28, "created_at": "2020-10-16T11:49:04Z", "updated_at": "2020-10-23T14:26:59Z", "closed_at": "2020-10-23T14:20:42Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/1842", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1842", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1842.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1842.patch", "merged_at": "2020-10-23T14:20:42Z"}, "body": "# PR changes summarized\r\n\r\n### Breaking change\r\n- `proxy.networkPolicy` is deprecated, and `proxy.chp.networkPolicy` and `proxy.traefik.networkPolicy` is introduced.\r\n\r\n### Restores access to `proxy` pod's http/https ports by default (bugfix)\r\nSince #1670 the proxy pod would not accept incoming traffic from pods in other namespaces, due to a bugfix that caused a breaking change. This can be observed in #1863 for example I think.\r\n\r\n```diff\r\n     - ports:\r\n         - port: http\r\n         {{- if or $manualHTTPS $manualHTTPSwithsecret }}\r\n         - port: https\r\n         {{- end }}\r\n-    - from:\r\n+      from:\r\n         - podSelector:\r\n             matchLabels:\r\n               hub.jupyter.org/network-access-proxy-http: \"true\"\r\n```\r\n\r\nThe bug fixed was that `hub.jupyter.org/network-access-proxy-http: \"true\"` was entirely ignored and had no meaning, but now that it got meaning, we ended up restricting access too much. As an example, the proxy would reject incoming traffic from a nginx-ingress-controller pod that terminated TLS in another namespace.\r\n\r\nIn this PR I introduce the networkPolicy configuration `allowedIngressPorts` as suggested by @manics, and configures it for `proxy.chp.networkPolicy` and `proxy.traefik.networkPolicy` to be set to `[http, https]` by default, while the networkPolicy configuration for hub/singleuser will not allow any of this by default.\r\n\r\nThis provides us with a configuration concept applicable to all networkPolicy resources we deploy, while retaining ability to work with even finer grained control with network access labels.\r\n\r\n### Conditional use of access labels across namespaces (enhancement)\r\nThis PR let's the respective `networkPolicy` configuration configure `interNamespaceAccessLabels`. If this configuration option is set to `accept`, the access labels valid for the respective networkPolicy configuration, such as `hub.jupyter.org/network-access-proxy-api: \"true\"`, will be accepted even on pods in other namespaces, and on entire namespaces, to allow these pods as sources for incoming network traffic.\r\n\r\n```diff\r\n+        # source 1 - labelled pods\r\n         - podSelector:\r\n             matchLabels:\r\n               hub.jupyter.org/network-access-proxy-api: \"true\"\r\n+        {{- if eq .Values.proxy.chp.networkPolicy.interNamespaceAccessLabels \"accept\" }}\r\n+          namespaceSelector:\r\n+            matchLabels: {}   # without this, the podSelector would only consider pods in the local namespace\r\n+        # source 2 - pods in labeled namespaces\r\n+        - namespaceSelector:\r\n+            matchLabels:\r\n+              hub.jupyter.org/network-access-proxy-api: \"true\"\r\n+        {{- end }}\r\n```\r\n\r\n# Motivation\r\nNetwork policies are enabled by default as of #1271, and we need ability to configure access in a way that won't force users and maintainers to debug k8s native network policy configuration which is notoriously hard to understand correctly. Closes #1863.\r\n\r\n### allowedIngressPorts config\r\nWe needed to come up with a solution after #1670, which as described below ended up restricting ingress, for example from a nginx-ingress-controller pod in another namespace, towards the proxy pod. At the same time, we should have a flexible and cohesive configuration of networkPolicies.\r\n\r\n### interNamespaceAccessLabels config\r\n`interNamespaceAccessLabels` is ensuring that users are not forced to add fragile workarounds if they need to access something from another namespace in the future, and by avoiding fragile workarounds, we avoid complicated issue reports following the fragile configurations future failures.\r\n\r\n# Related\r\n### NetworkPolicy documentation\r\n[This section of the k8s documentation](https://kubernetes.io/docs/concepts/services-networking/network-policies/#behavior-of-to-and-from-selectors) is very relevant details on the rules that we can set in a NetworkPolicy from the k8s docs, distinguishing between: a) podSelector, b) namespaceSelector, c) podSelector AND namespaceSelector, and d) ipblock.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1842/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1842/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1837", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1837/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1837/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1837/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1837", "id": 720094861, "node_id": "MDExOlB1bGxSZXF1ZXN0NTAyMTc1Mjkw", "number": 1837, "title": "user-scheduler: let image locality etc matter again", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/milestones/6", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/milestone/6", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/milestones/6/labels", "id": 6003295, "node_id": "MDk6TWlsZXN0b25lNjAwMzI5NQ==", "number": 6, "title": "0.10.0", "description": null, "creator": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 6, "state": "closed", "created_at": "2020-10-18T11:05:18Z", "updated_at": "2021-01-15T16:17:49Z", "due_on": null, "closed_at": "2021-01-15T16:17:49Z"}, "comments": 9, "created_at": "2020-10-13T10:25:30Z", "updated_at": "2020-10-19T09:43:42Z", "closed_at": "2020-10-19T09:43:42Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/1837", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1837", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1837.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1837.patch", "merged_at": "2020-10-19T09:43:41Z"}, "body": "I consider this to be fix #1836 by considering image locality when scheduling users.\ufeff\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1837/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1837/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1831", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1831/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1831/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1831/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1831", "id": 718411927, "node_id": "MDU6SXNzdWU3MTg0MTE5Mjc=", "number": 1831, "title": "CI: the netpol tests fails to reliably start the user pod", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-10-09T20:43:41Z", "updated_at": "2020-10-13T19:33:21Z", "closed_at": "2020-10-13T19:33:11Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "I don't know when this started happening, perhaps a week back, but the network policy pytest is now starting to behave unreliably for something unrelated to network policies I believe, it starts to behave unreliably because it fails to start the pod sometimes - which is before the networkpolicy testing actually begins.\r\n\r\nSo, in reality, it seems like the user pod startups have become unreliable for some reason. I suspect this relates to the bumping of kubespawner, but I'm not sure. Step 1 to address this is to print debugging information when pytest fails.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1831/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1831/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1830", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1830/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1830/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1830/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1830", "id": 718390796, "node_id": "MDExOlB1bGxSZXF1ZXN0NTAwNzkzNzYw", "number": 1830, "title": "Add retryable HTTP client to image-awaiter", "user": {"login": "bleggett", "id": 854255, "node_id": "MDQ6VXNlcjg1NDI1NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/854255?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bleggett", "html_url": "https://github.com/bleggett", "followers_url": "https://api.github.com/users/bleggett/followers", "following_url": "https://api.github.com/users/bleggett/following{/other_user}", "gists_url": "https://api.github.com/users/bleggett/gists{/gist_id}", "starred_url": "https://api.github.com/users/bleggett/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bleggett/subscriptions", "organizations_url": "https://api.github.com/users/bleggett/orgs", "repos_url": "https://api.github.com/users/bleggett/repos", "events_url": "https://api.github.com/users/bleggett/events{/privacy}", "received_events_url": "https://api.github.com/users/bleggett/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-10-09T20:01:07Z", "updated_at": "2020-10-09T21:39:56Z", "closed_at": "2020-10-09T20:44:47Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/1830", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1830", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1830.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1830.patch", "merged_at": "2020-10-09T20:44:47Z"}, "body": "Uses https://pkg.go.dev/mod/github.com/hashicorp/go-retryablehttp which is a drop-in compatible wrapper around the default Go http client.\r\n\r\nWill fix issue where `image-awaiter` never becomes healthy when deployed in a cluster with a service mesh - since the service mesh uses an init container to configure pod networking, the network might not be ready to route connections when `image-awaiter` tries to make a connection on startup, so `image-awaiter` should be a good resilient HTTP client and at least retry a few times.\r\n\r\nExample using the retry settings of 5 retries:\r\n\r\n```\r\n~/Source/zero-to-jupyterhub-k8s/images/image-awaiter(master*) \u00bb docker run -it --rm --net=host yolo:test4 /image-awaiter -debug -namespace default -daemonset hook-image-puller                                                                                          bleggett@bleggett\r\n2020/10/09 19:49:31 [DEBUG] GET http://localhost:8080/apis/apps/v1/namespaces/default/daemonsets/hook-image-puller\r\n2020/10/09 19:49:31 [ERR] GET http://localhost:8080/apis/apps/v1/namespaces/default/daemonsets/hook-image-puller request failed: Get \"http://localhost:8080/apis/apps/v1/namespaces/default/daemonsets/hook-image-puller\": dial tcp [::1]:8080: connect: connection refused\r\n2020/10/09 19:49:31 [DEBUG] GET http://localhost:8080/apis/apps/v1/namespaces/default/daemonsets/hook-image-puller: retrying in 5s (5 left)\r\n2020/10/09 19:49:36 [ERR] GET http://localhost:8080/apis/apps/v1/namespaces/default/daemonsets/hook-image-puller request failed: Get \"http://localhost:8080/apis/apps/v1/namespaces/default/daemonsets/hook-image-puller\": dial tcp [::1]:8080: connect: connection refused\r\n2020/10/09 19:49:36 [DEBUG] GET http://localhost:8080/apis/apps/v1/namespaces/default/daemonsets/hook-image-puller: retrying in 10s (4 left)\r\n2020/10/09 19:49:46 [ERR] GET http://localhost:8080/apis/apps/v1/namespaces/default/daemonsets/hook-image-puller request failed: Get \"http://localhost:8080/apis/apps/v1/namespaces/default/daemonsets/hook-image-puller\": dial tcp [::1]:8080: connect: connection refused\r\n2020/10/09 19:49:46 [DEBUG] GET http://localhost:8080/apis/apps/v1/namespaces/default/daemonsets/hook-image-puller: retrying in 20s (3 left)\r\n2020/10/09 19:50:06 [ERR] GET http://localhost:8080/apis/apps/v1/namespaces/default/daemonsets/hook-image-puller request failed: Get \"http://localhost:8080/apis/apps/v1/namespaces/default/daemonsets/hook-image-puller\": dial tcp [::1]:8080: connect: connection refused\r\n2020/10/09 19:50:06 [DEBUG] GET http://localhost:8080/apis/apps/v1/namespaces/default/daemonsets/hook-image-puller: retrying in 30s (2 left)\r\n2020/10/09 19:50:36 [ERR] GET http://localhost:8080/apis/apps/v1/namespaces/default/daemonsets/hook-image-puller request failed: Get \"http://localhost:8080/apis/apps/v1/namespaces/default/daemonsets/hook-image-puller\": dial tcp [::1]:8080: connect: connection refused\r\n2020/10/09 19:50:36 [DEBUG] GET http://localhost:8080/apis/apps/v1/namespaces/default/daemonsets/hook-image-puller: retrying in 30s (1 left)\r\n2020/10/09 19:51:06 [ERR] GET http://localhost:8080/apis/apps/v1/namespaces/default/daemonsets/hook-image-puller request failed: Get \"http://localhost:8080/apis/apps/v1/namespaces/default/daemonsets/hook-image-puller\": dial tcp [::1]:8080: connect: connection refused\r\n2020/10/09 19:51:06 GET http://localhost:8080/apis/apps/v1/namespaces/default/daemonsets/hook-image-puller giving up after 6 attempt(s): Get \"http://localhost:8080/apis/apps/v1/namespaces/default/daemonsets/hook-image-puller\": dial tcp [::1]:8080: connect: connection refused\r\n```\r\n\r\nEDIT: Fixes #1793", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1830/reactions", "total_count": 2, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1830/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1817", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1817/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1817/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1817/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1817", "id": 716192778, "node_id": "MDExOlB1bGxSZXF1ZXN0NDk4OTc1NzQz", "number": 1817, "title": "prePuller: fix recently introduced regression", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-10-07T04:49:04Z", "updated_at": "2020-10-07T05:04:29Z", "closed_at": "2020-10-07T05:04:29Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/1817", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1817", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1817.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1817.patch", "merged_at": "2020-10-07T05:04:29Z"}, "body": "In https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1764 I introduced a which is now tested for and fixed.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1817/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1817/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1812", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1812/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1812/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1812/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1812", "id": 716102174, "node_id": "MDExOlB1bGxSZXF1ZXN0NDk4OTAxOTM3", "number": 1812, "title": "userScheduler: only render associated PDB resource if userScheduler itself is enabled", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-10-07T00:11:42Z", "updated_at": "2020-10-07T02:45:07Z", "closed_at": "2020-10-07T00:21:55Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/1812", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1812", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1812.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1812.patch", "merged_at": "2020-10-07T00:21:55Z"}, "body": "Closes #1282 - thank you @rokroskar for reporting this!", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1812/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 1, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1812/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1808", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1808/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1808/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1808/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1808", "id": 714925984, "node_id": "MDExOlB1bGxSZXF1ZXN0NDk3OTIzNjEy", "number": 1808, "title": "Fix same functionality for proxy.traefik.extraEnv as other extraEnv", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-10-05T15:08:36Z", "updated_at": "2020-10-05T16:07:30Z", "closed_at": "2020-10-05T16:07:30Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/1808", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1808", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1808.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1808.patch", "merged_at": "2020-10-05T16:07:30Z"}, "body": "This is a remnant change following #1757 to ensure all of our extraEnv configuration support the same syntax.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1808/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1808/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1798", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1798/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1798/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1798/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1798", "id": 714427714, "node_id": "MDExOlB1bGxSZXF1ZXN0NDk3NTE3NzAx", "number": 1798, "title": "Set container securityContext by default", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 580906361, "node_id": "MDU6TGFiZWw1ODA5MDYzNjE=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/enhancement", "name": "enhancement", "color": "84b6eb", "default": true, "description": null}, {"id": 2398426378, "node_id": "MDU6TGFiZWwyMzk4NDI2Mzc4", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/breaking", "name": "breaking", "color": "ad3727", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-10-04T23:41:32Z", "updated_at": "2020-10-08T17:27:46Z", "closed_at": "2020-10-08T17:18:50Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/1798", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1798", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1798.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1798.patch", "merged_at": "2020-10-08T17:18:49Z"}, "body": "This can help us avoid usage of root by default which can cause clusters with [PodSecurityPolicy resources](https://kubernetes.io/docs/concepts/policy/pod-security-policy/) to stop the Helm chart from functioning.\r\n\r\nIn practice, what I do in this PR is to create Helm chart configuration to set all Pod's containers' `securityContext`, and let this configuration default to have a securityContext like this be injected to all of our managed containers within the pods.\r\n\r\n```yaml\r\n# some of our k8s Deployment resources\r\nspec:\r\n  template:\r\n    spec:\r\n      containers:\r\n        - image: ...\r\n          # ...\r\n          securityContext:\r\n            runAsUser: 65534\r\n            runAsGroup: 65534\r\n            allowPrivilegeEscalation: false\r\n```\r\n\r\nA securityContext of a pod with a `runAsUser` directive will force the container to startup as that user instead of the default: `root`. This can add another layer of security to by letting the containers we run not end up escalating privileges and ending up abusing some k8s vulnerability to do harmful stuff.\r\n\r\nFixes #1386, but not #1408.\r\n\r\n## singleuser.containerSecurityContext ?\r\n\r\nThis PR does not add `singleuser.containerSecurityContext`, yet, because it is quite a bit more complicated at the moment. KubeSpawner expose some configuration that in the end goes into either the pod's securityContext or the container's securityContext. Here is an overview.\r\n\r\nKubeSpawner.* | [PodSecurityContex](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#podsecuritycontext-v1-core) | [SecurityContext](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#securitycontext-v1-core)\r\n-|-|-\r\n`fs_gid` | `fsGroup` | -\r\n`supplemental_gids` | `supplementalGroups` | -\r\n`run_as_uid` | - | `runAsUser`\r\n`run_as_gid` | - | `runAsGroup`\r\n`privileged` | - | `privileged`\r\n\r\n## Breaking change\r\n- `proxy.containerSecurityContex` has been renamed to `proxy.chp.containerSecurityContex`\r\n\r\n---\r\n\r\nI deem that this can be said to close #937 good enough, but only properly by setting `singleuser.cloudMetadata.blockWithIptables: false`.\r\n\r\nCloses #1491, Closes #1677", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1798/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 1, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1798/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1793", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1793/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1793/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1793/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1793", "id": 713758466, "node_id": "MDU6SXNzdWU3MTM3NTg0NjY=", "number": 1793, "title": "`image-awaiter/daemonset.go` should actually retry HTTP calls if they fail, rather than immediately exiting if the first call fails.", "user": {"login": "bleggett", "id": 854255, "node_id": "MDQ6VXNlcjg1NDI1NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/854255?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bleggett", "html_url": "https://github.com/bleggett", "followers_url": "https://api.github.com/users/bleggett/followers", "following_url": "https://api.github.com/users/bleggett/following{/other_user}", "gists_url": "https://api.github.com/users/bleggett/gists{/gist_id}", "starred_url": "https://api.github.com/users/bleggett/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bleggett/subscriptions", "organizations_url": "https://api.github.com/users/bleggett/orgs", "repos_url": "https://api.github.com/users/bleggett/repos", "events_url": "https://api.github.com/users/bleggett/events{/privacy}", "received_events_url": "https://api.github.com/users/bleggett/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 580906362, "node_id": "MDU6TGFiZWw1ODA5MDYzNjI=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/help%20wanted", "name": "help wanted", "color": "0e8a16", "default": true, "description": null}, {"id": 748212683, "node_id": "MDU6TGFiZWw3NDgyMTI2ODM=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/good%20first%20issue", "name": "good first issue", "color": "5319e7", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-10-02T16:42:38Z", "updated_at": "2020-10-09T20:44:47Z", "closed_at": "2020-10-09T20:44:47Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML commments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\nCurrently, the `image-awaiter/daemonset.go` logic attempts to contact the Kube API server on startup.\r\n\r\nIf this initial HTTP call fails, the image awaiter quits.\r\n\r\nThis creates problems in scenarios where e.g. you have Istio sidecars - the Istio sidecar needs to be up for the pod to be able to talk to the rest of the cluster, but the `image-awaiter` might try to contact the API server before the Istio sidecar is ready, and will simply quit, assuming that a temporary failure is catastrophic.\r\n\r\n#### Expected behaviour\r\nTo be resilient and well-behaved, the `image-awaiter/daemonset.go` code should add basic retry logic to its startup HTTP call to the Kube API server, rather than exiting after one failure.\r\n\r\n#### Actual behaviour\r\n`image-awaiter/daemonset.go`exits after one failure to contact the Kube API server\r\n\r\n### How to reproduce\r\n1. Set up a cluster\r\n2. Install Istio\r\n3. Install the Jupyter helm chart\r\n4. Note that the `hook-image-awaiter` pod, if the initial HTTP call to the Kube API server fails, gets `stuck` due to the image-awaiter process exiting on the first failure.\r\n\r\n### Your personal set up\r\nMinikube on macOS, Jupyter Helm chart 0.9.1\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1793/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1793/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1789", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1789/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1789/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1789/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1789", "id": 711290756, "node_id": "MDU6SXNzdWU3MTEyOTA3NTY=", "number": 1789, "title": "orgWhiteList not restricting users", "user": {"login": "psschwei", "id": 44698588, "node_id": "MDQ6VXNlcjQ0Njk4NTg4", "avatar_url": "https://avatars.githubusercontent.com/u/44698588?v=4", "gravatar_id": "", "url": "https://api.github.com/users/psschwei", "html_url": "https://github.com/psschwei", "followers_url": "https://api.github.com/users/psschwei/followers", "following_url": "https://api.github.com/users/psschwei/following{/other_user}", "gists_url": "https://api.github.com/users/psschwei/gists{/gist_id}", "starred_url": "https://api.github.com/users/psschwei/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/psschwei/subscriptions", "organizations_url": "https://api.github.com/users/psschwei/orgs", "repos_url": "https://api.github.com/users/psschwei/repos", "events_url": "https://api.github.com/users/psschwei/events{/privacy}", "received_events_url": "https://api.github.com/users/psschwei/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2020-09-29T16:52:18Z", "updated_at": "2020-10-07T14:39:35Z", "closed_at": "2020-10-07T14:08:39Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\n\r\nI'm trying to set up Jupyterhub and restrict access to only the members of a specific organization, as [detailed in the docs](https://zero-to-jupyterhub.readthedocs.io/en/latest/administrator/authentication.html#giving-access-to-organizations-on-github).\r\n\r\nHowever, I'm finding that the whitelist is not working, as users not part of that organization are still able to authenticate (note: I am using GitHub Enterprise, not github.com). \r\n\r\nI also had similar problems when using a whitelist of individual users, where anyone could authenticate, not just the users on the list. \r\n\r\nOutside of the whitelist not working, the OAuth app seems to function as it should -- it shows up as an \"Authorize OAuth App\" for each user once that have given it permission (even those not in the org).\r\n\r\n#### Expected behaviour\r\n\r\nOnly members of a specific organization would be able to authenticate to JupyterHub.\r\n\r\n#### Actual behaviour\r\n\r\nUsers not in the specified organization are also able to authenticate to JupyterHub.\r\n\r\n### How to reproduce\r\n\r\n1. Create JH instance on k8s \r\n1. Set up ingress to access JH instance\r\n1. Set up OAuth application in GHE\r\n    * note: using `<jh-hostname>/hub/oauth_callback` as the callback URL\r\n1. Update `config.yaml` (see configuration section below)\r\n1. update JH via `helm upgrade <release> jupyterhub/jupyterhub --version=0.8.2 --values config.yaml`\r\n1. Go to `<hostname>` and click \"Sign in with GitHub\" button\r\n\r\n\r\n### Your personal set up\r\n \r\n - Version:\r\n0.8.2\r\n - Configuration:\r\n```yaml\r\nproxy:\r\n  secretToken: <token>\r\nsingleuser:\r\n  memory:\r\n    guarantee: 16G\r\n  cpu:\r\n    guarantee: 4\r\n  image:\r\n    name: jupyter/minimal-notebook\r\n    tag: latest\r\n  storage:\r\n    extraVolumes:\r\n      - name: jupyterhub-shared\r\n        persistentVolumeClaim:\r\n          claimName: shared-volume\r\n    extraVolumeMounts:\r\n      - name: jupyterhub-shared\r\n        mountPath: /home/jovyan/shared\r\n  profileList:\r\n    - display_name: \"Minimal Environment\"\r\n      description: \"Base Python Environment\"\r\n      default: true\r\n    - display_name: \"Data Science Environment\"\r\n      description: \"Enhanced Data Science environment supporting Python, R, and Julia\"\r\n      kubespawner_override:\r\n        image: jupyter/datascience-notebook:latest\r\ncull:\r\n  timeout: 86400    \r\nauth:\r\n  type: github\r\n  github:\r\n    clientId: \"<client-id>\"\r\n    clientSecret: \"<client-secret>\"\r\n    callbackUrl: \"<jh-hostname>/hub/oauth_callback\"\r\n    orgWhiteList:\r\n      - \"<org-name>\"\r\n  scopes:\r\n    - \"read:user\"\r\n  admin:\r\n    users:\r\n      - <id>\r\nhub:\r\n  extraEnv:\r\n    GITHUB_HOST: \"<ghe-hostname>\"\r\n```", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1789/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1789/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1787", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1787/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1787/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1787/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1787", "id": 707204553, "node_id": "MDExOlB1bGxSZXF1ZXN0NDkxNjQ0NTM5", "number": 1787, "title": "Relax hook-image-puller to make upgrades more reliable", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-09-23T09:33:59Z", "updated_at": "2020-10-04T06:14:11Z", "closed_at": "2020-10-02T15:50:29Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/1787", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1787", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1787.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1787.patch", "merged_at": "2020-10-02T15:50:29Z"}, "body": "This configuration makes the hook-image-awaiter start comparing the\r\nnumber of scheduled image-puller pods with the number of ready\r\nimage-puller pods, instead of comparing the number of desired\r\nimage-puller pods with the ready number of image-puller pods, after a\r\nduration of 10 seconds.\r\n\r\nThis helps anyone using the hook-image-puller to avoid failures\r\nof running `helm upgrade` that can happen if a node is full packed with\r\npods and no more pods can be scheduled on it, because then the\r\nimage-awaiter would get stuck waiting forever on an image pulling pod\r\nthat never successfully schedules to do the actual pulling.\r\n\r\n---\r\n\r\n@yuvipanda I merged #1763 and created this as a followup to the review comment https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1763#discussion_r493209514 about sticking with the existing behavior until its been tested a while.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1787/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1787/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1778", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1778/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1778/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1778/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1778", "id": 700337010, "node_id": "MDExOlB1bGxSZXF1ZXN0NDg1OTg5Nzc5", "number": 1778, "title": "Updates to user-scheduler's coupling to the kube-scheduler binary", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 2398427860, "node_id": "MDU6TGFiZWwyMzk4NDI3ODYw", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/maintenance", "name": "maintenance", "color": "de9af4", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-09-12T18:53:23Z", "updated_at": "2020-10-04T06:13:04Z", "closed_at": "2020-09-21T07:47:26Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/1778", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1778", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1778.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1778.patch", "merged_at": "2020-09-21T07:47:26Z"}, "body": "Closes #1773 which also contains the findings that made me do what I summarize having done below.\r\n\r\n## Important review\r\n- [x] We should review this on a modern k8s cluster (1.17+) and verify that the user-scheduler does indeed schedule pods on the most busy node even with the new configuration style. I suggest this is done after merge though.\r\n\r\n## Summary of changes\r\n- Fixes a bug introduced by bumping to kube-scheduler binary of version 1.16 relating to not having the permission to look for CSINodes resources.\r\n- Bumping kube-spawner binary to the latest k8s version (1.19.1), but is able to fallback to 1.16.15) if the CSINode resource is not registered as a resource type in the k8s cluster.\r\n- Configures the modern kube-scheduler binary in its new configuration format.\r\n- Provides some notes as to when we can remove the fallback (when 1.17+ is assumed)\r\n\r\n## More detailed summary of changes\r\n- I made us mount the configuration as a file, which is what we need to do in the modern configuration format and it also made us no longer need to provide RBAC rules for inspecting configmaps.\r\n- I made the new `plugins` configurable _for the advanced user_ wanting to try another scheduling policy.\r\n- I opted to fully specify the RBAC permissions instead of complement what could end up missing by augmenting the `system:kube-scheduler` and `system:volume-scheduler` ClusterRole's as doing this felt easier to maintain.\r\n- I removed a helm template function to get the current k8s version as a fallback for the kube-scheduler image tag which would be unsuitable to use and has not been used.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1778/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1778/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1773", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1773/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1773/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1773/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1773", "id": 695753321, "node_id": "MDU6SXNzdWU2OTU3NTMzMjE=", "number": 1773, "title": "kube-scheduler binary bump to 1.16 make user-scheduler in 1.15 k8s fail", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2020-09-08T10:28:19Z", "updated_at": "2020-09-21T07:47:26Z", "closed_at": "2020-09-21T07:47:26Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "#1699 introduced an breaking bug using this Helm chart on Kubernetes clusters versioned 1.15 and lower. The `user-scheduler` pods responsible for scheduling the k8s pods representing the users in a smart manner is now failing to schedule them to the k8s nodes with the following error message.\r\n\r\n```\r\nI0908 10:05:43.912366       1 reflector.go:158] Listing and watching *v1beta1.CSINode from k8s.io/client-go/informers/factory.go:134\r\nE0908 10:05:43.914298       1 reflector.go:123] k8s.io/client-go/informers/factory.go:134: Failed to list *v1beta1.CSINode: csinodes.storage.k8s.io is forbidden: User \"system:serviceaccount:jupyterhub:user-scheduler\" cannot list resource \"csinodes\" in API group \"storage.k8s.io\" at the cluster scope\r\n```\r\n\r\nThe error describes that the user-scheduler pod isn't allowed to ask the k8s api-server about `storage.k8s.io/v1beta/csinodes` resources.\r\n\r\nTo understand why this is, we need to understand what grants the user-scheduler pod permission to potentially do something like this in the first place.\r\n\r\n1. The user-scheduler pod is configured to use a k8s ServiceAccount named `user-scheduler`.\r\n2. The k8s ServiceAccount `user-scheduler` is coupled to have the Cluster permissions of...\r\n   - the ClusterRole `system:kube-scheduler` through the ClusterRoleBinding `jupyterhub-user-scheduler-base`\r\n   - the ClusterRole `jupyterhub-user-scheduler-complementary` through the ClusterRoleBinding `jupyterhub-user-scheduler-complementary`.\r\n3. The permissions defined in ClusterRole `system:kube-scheduler` depends on the k8s version, its not part of this Helm chart. And, k8s 1.15 doesn't include the permission to inspect CSINode resources, while k8s 1.16's version of the `system:kube-scheduler` ClusterRole does.\r\n\r\nDue to this, the solution as I see it, is to add the permission to inspect CSINode resources in the ClusterRole `jupyterhub-user-scheduler-complementary`. This is a one-liner fix right in this section, by adding `csinodes` next to `storageclasses`.\r\n\r\nhttps://github.com/jupyterhub/zero-to-jupyterhub-k8s/blob/cd1eff7a5f093453de4d5868d1c4148044c0db23/jupyterhub/templates/scheduling/user-scheduler/rbac.yaml#L39-L42\r\n\r\n---\r\n\r\n/cc: @deepitpro and @ArijitBhattacharyya11 who have also seen the consequences of this issue - perhaps you could create a PR to fix this also? =) Following its merge, a new developer release version will be published herehttps://jupyterhub.github.io/helm-chart/ which we can upgrade to.\r\n\r\n### Related\r\n\r\nCloses #1773.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1773/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1773/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1760", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1760/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1760/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1760/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1760", "id": 689294156, "node_id": "MDU6SXNzdWU2ODkyOTQxNTY=", "number": 1760, "title": "insufficient pods and the interaction with the hook-image-puller daemonset", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 580906361, "node_id": "MDU6TGFiZWw1ODA5MDYzNjE=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/enhancement", "name": "enhancement", "color": "84b6eb", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2020-08-31T15:27:13Z", "updated_at": "2020-10-04T06:11:03Z", "closed_at": "2020-10-04T06:11:03Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "### Background\r\n\r\nOn GKE for example, one is limited to 110 pods per node no matter what configuration option is used. Other k8s deployments will have different limits but still have limits.\r\n\r\nWe have some challenges with regards to this limitation and the system to automatically download new images ahead of time on certain nodes. We do it by creating a deamonset that creates one pod per node. The hook puller daemonset is created temporary with a Helm hook as part of chart upgrades to ensure the new images is available before the actual chart upgrade. The continuous puller daemonset is created as part of the chart to ensure newly added nodes get the images.\r\n\r\n### Goal outcomes\r\n1. To avoid the [upgrade failures](https://github.com/neurohackademy/nh2020-jupyterhub/issues/86) following having a hook daemonset trying to create a pod on a node capped by a pod limit.\r\n2. To avoid using unnecessary pods.\r\n\r\n### Solution brainstorming\r\nI'm not sure, but we could consider:\r\n1. changing the pod priority which influences scheduling order of pending pods and could potentially get pods evicted if they have a negative priority if i recall correctly.\r\n2. making the hook puller not want to schedule on nodes that have full capacity somehow, i think this may be hard though.\r\n3. modifying the hook-image-awaiter that inspects the hook pre-puller daemonset to see if its pods are ready and avoid waiting for pods in a pending state that hasn't been scheduled to avoid this kind of reliability issue.\r\n\r\nI think I like option 3 the most, its quite simple logic update in the image awaiter pod. It will need to introduce some delay if pods are pending though as they will always be pending the initial second they are scheduled or so I figure. This tackles the both goal 1 and 2 for the hook-image-puller daemonset, but would fail to address the second goal for the continuous image puller daemonset. Perhaps that daemonset should get a placeholder kind of priority as well?\r\n\r\n### Suggested changes\r\n1. We update the logic of the hook-image-awaiter go binary we have developed to not just wait for the number of pods created to all be ready, but to instead wait mindful that some pods may get stuck in pending and accept that.\r\n2. We update the continuous image puller daemonsets pod priority to be like the user placeholders if scheduling.podPriority is enabled, which allows pre-pulling to run only on nodes which isn't full of users or other pods.\r\n\r\nPing @yuvipanda as I know you are already mindful of these issues, what do you think about these suggested changes to address them?", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1760/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1760/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1758", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1758/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1758/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1758/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1758", "id": 686966685, "node_id": "MDExOlB1bGxSZXF1ZXN0NDc0NDY5OTUz", "number": 1758, "title": "https: Only expose port 443 if we really have HTTPS on", "user": {"login": "yuvipanda", "id": 30430, "node_id": "MDQ6VXNlcjMwNDMw", "avatar_url": "https://avatars.githubusercontent.com/u/30430?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuvipanda", "html_url": "https://github.com/yuvipanda", "followers_url": "https://api.github.com/users/yuvipanda/followers", "following_url": "https://api.github.com/users/yuvipanda/following{/other_user}", "gists_url": "https://api.github.com/users/yuvipanda/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuvipanda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuvipanda/subscriptions", "organizations_url": "https://api.github.com/users/yuvipanda/orgs", "repos_url": "https://api.github.com/users/yuvipanda/repos", "events_url": "https://api.github.com/users/yuvipanda/events{/privacy}", "received_events_url": "https://api.github.com/users/yuvipanda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 2398426378, "node_id": "MDU6TGFiZWwyMzk4NDI2Mzc4", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/breaking", "name": "breaking", "color": "ad3727", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-08-27T06:03:30Z", "updated_at": "2020-10-05T11:04:53Z", "closed_at": "2020-09-08T06:31:02Z", "author_association": "COLLABORATOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/1758", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1758", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1758.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1758.patch", "merged_at": "2020-09-08T06:31:02Z"}, "body": "For HTTPS, we want to expose port 443 on our service, but\r\nonly if it is 'turned on'. Unfortunately, in v 0.9, the\r\ndefault was set to 'enabled' but it didn't act as enabled\r\nunless hostnames were actually set. This exposed port 443\r\nin proxy-public regardless of wether we were actually\r\nset up for HTTPS or not. This caused weird issues with\r\nAWS, since it was health checking all exposed ports. Since\r\nwe didn't have automatic HTTPS setup (since that needs\r\nhostnames), this broke all installs on AWS!\r\n\r\nThis tries to be backwards compatible change, exposing\r\nport 443 only if we *really* have https running. This\r\nshould fix issues with AWS, and be more 'correct'.\r\n\r\nManual HTTPS doesn't actually need hosts lists to be set,\r\nso we remove that from our documentation.\r\n\r\nWe also re-introduce 'https.enabled' in our documentation -\r\nmanual action (DNS) is needed to enable HTTPS, so this\r\nbeing explicit is IMO a good thing.\r\n\r\nFixes #1637", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1758/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1758/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1750", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1750/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1750/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1750/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1750", "id": 683851251, "node_id": "MDU6SXNzdWU2ODM4NTEyNTE=", "number": 1750, "title": "Specify certificate through Secret resource Documentation Bug", "user": {"login": "salvis2", "id": 27738742, "node_id": "MDQ6VXNlcjI3NzM4NzQy", "avatar_url": "https://avatars.githubusercontent.com/u/27738742?v=4", "gravatar_id": "", "url": "https://api.github.com/users/salvis2", "html_url": "https://github.com/salvis2", "followers_url": "https://api.github.com/users/salvis2/followers", "following_url": "https://api.github.com/users/salvis2/following{/other_user}", "gists_url": "https://api.github.com/users/salvis2/gists{/gist_id}", "starred_url": "https://api.github.com/users/salvis2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/salvis2/subscriptions", "organizations_url": "https://api.github.com/users/salvis2/orgs", "repos_url": "https://api.github.com/users/salvis2/repos", "events_url": "https://api.github.com/users/salvis2/events{/privacy}", "received_events_url": "https://api.github.com/users/salvis2/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-08-21T22:06:27Z", "updated_at": "2020-08-25T03:40:36Z", "closed_at": "2020-08-25T03:40:36Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML commments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\nThe Z2JH K8s section [Specify certificate through Secret resource](https://zero-to-jupyterhub.readthedocs.io/en/latest/administrator/security.html#specify-certificate-through-secret-resource) shows an example configuration as follows:\r\n\r\n```\r\nproxy:\r\n  https:\r\n    hosts:\r\n      - <your-domain-name>\r\n    type: secret\r\n      secret:\r\n        name: example-tls\r\n```\r\n\r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\nI thought a `helm upgrade` command with this configuration inside it would succeed.\r\n\r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\nThe `helm upgrade` command results in the following error:\r\n\r\n```\r\nError: failed to parse ./config.yaml: error converting YAML to JSON: yaml: line 100: mapping values are not allowed in this context\r\n```\r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n1. Putting that configuration in a [YAML validator](https://onlineyamltools.com/validate-yaml) tells me that that configuration is incorrect YAML.\r\n\r\nor \r\n\r\n2. Putting that configuration in a `.yaml` file and then running \r\n```\r\nhelm upgrade jupyterhub jupyterhub/jupyterhub --values ./config.yaml --namespace jhub\r\n```\r\nshould yield the error above.\r\n\r\n### Your personal set up\r\n<!-- Tell us a little about the system you're using. -->\r\n\r\n - OS: Linux, Ubuntu 18.04\r\n - Version: JupyterHub version v0.9.0-beta.3, kubectl client v1.17.4, kubectl server version v1.15.11-eks-065dce\r\n - Configuration: Listed above\r\n\r\n### Solution\r\n\r\nI think the configuration in the listed documentation section needs to be changed to:\r\n\r\n```\r\nproxy:\r\n  https:\r\n    hosts:\r\n      - <your-domain-name>\r\n    type: secret\r\n    secret:\r\n      name: example-tls\r\n```\r\n\r\nThis configuration allows my `helm upgrade` command to succeed.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1750/reactions", "total_count": 4, "+1": 3, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1750/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1739", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1739/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1739/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1739/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1739", "id": 674962434, "node_id": "MDU6SXNzdWU2NzQ5NjI0MzQ=", "number": 1739, "title": "Jupyterhub for Kubernes: How to avoid Image Prepull on specific nodes ", "user": {"login": "adr-arroyo", "id": 11291505, "node_id": "MDQ6VXNlcjExMjkxNTA1", "avatar_url": "https://avatars.githubusercontent.com/u/11291505?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adr-arroyo", "html_url": "https://github.com/adr-arroyo", "followers_url": "https://api.github.com/users/adr-arroyo/followers", "following_url": "https://api.github.com/users/adr-arroyo/following{/other_user}", "gists_url": "https://api.github.com/users/adr-arroyo/gists{/gist_id}", "starred_url": "https://api.github.com/users/adr-arroyo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adr-arroyo/subscriptions", "organizations_url": "https://api.github.com/users/adr-arroyo/orgs", "repos_url": "https://api.github.com/users/adr-arroyo/repos", "events_url": "https://api.github.com/users/adr-arroyo/events{/privacy}", "received_events_url": "https://api.github.com/users/adr-arroyo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2020-08-07T11:48:37Z", "updated_at": "2020-10-08T02:01:09Z", "closed_at": "2020-10-08T02:01:09Z", "author_association": "NONE", "active_lock_reason": null, "body": "\r\n### Bug description\r\nI have a custom Kubernetes cluster with several nodes, each node has assigned some tags to differenciate between them with a Kubernetes label selector (nodeSelector), being one of them PU = \"gpu\" || \"cpu\". I have also deployed a Jupyterhub environment on my cluster. However I am having trouble with the deployments of different profiles (singleUser.profileList) on different nodes.\r\n\r\nMore specifically, I would like to have a profile assigned to nodes with PU: \"cpu\" and other profile assigned to nodes with PU: \"gpu\", in order to take advantage of the GPU when deploying notebooks. In the \"cpu\" profile I have to select the intel version of the  docker image, whereas in the \"gpu\" profile I need a specific ARM (+ NVIDIA) docker image since the node is deployed on an arm-based machine. I believe I have configured properly each profile so that the user server is deployed in the proper nodes, with the nodeSelector tag (see below). \r\n\r\nThe problem comes with the Jupyterhub image prepuller. I have seen that it tries to pull __all the images of every profile in every node__, even though the nodeSelector tag is configured. Then, in the arm/gpu node it tries to prepull the image of the intel/cpu node   , and on this node it tries to pull the arm/gpu image, ending up in an unsuccessfull installation and jupyterhub not being deployed on the cluster.\r\n\r\nIs this a bug on the prepuller or a misconfiguration and the prepuller can be configured to avoid this?\r\n\r\n#### Expected behaviour\r\nJupyterhub pulls the proper and configured image when the server is deployed on the node\r\n\r\n#### Actual behaviour\r\nJupyterhub prepulls images on every node, even though their architecture is not the right one.\r\n\r\n### How to reproduce\r\n\r\nKubernetes cluster with hybrid ARM and Intel nodes and deploy different user profiles on each node.\r\n\r\n### Your personal set up\r\n\r\n - OS:\r\nLinux-Ubuntu 18.04\r\n - Version:\r\n jupyterhub 0.9.0\r\n - Configuration:\r\nKubernetes deployment.\r\n\r\n\r\n### My configuration:\r\n\r\n```\r\n...\r\n\r\nsingleuser:\r\n  nodeSelector:\r\n    ARCH: \"intel\"\r\n    LAYER: \"cloud\"\r\n  defaultUrl: \"/lab\"\r\n  image:\r\n    name: easierai/jupyterhub-core\r\n    tag: latest\r\n  profileList:\r\n    - display_name: \"environment\"\r\n      description: \"Environment preconfigured .\"\r\n      default: true\r\n      nodeSelector:\r\n        PU: \"cpu\"\r\n    - display_name: \"Minimal Environment\"\r\n      description: \"Only default libraries installed.\"\r\n      kubespawner_override:\r\n        image: jupyter/minimal-notebook\r\n        nodeSelector:\r\n          PU: \"cpu\"\r\n    - display_name: \"one NVIDIA\"\r\n      description: \"ARM, GPU\"\r\n      kubespawner_override:\r\n        image: step21/jupyter-minimal-notebook:arm64\r\n        nodeSelector:\r\n          PU: \"gpu\"\r\n        extraResource:\r\n          limits:\r\n            nvidia.com/gpu: 1\r\n\r\n...\r\n```", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1739/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1739/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1733", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1733/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1733/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1733/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1733", "id": 668429032, "node_id": "MDU6SXNzdWU2Njg0MjkwMzI=", "number": 1733, "title": "A blank singleuser.fsGid configuration is the same as setting it to 0 - which it shouldn't be", "user": {"login": "24hours", "id": 650407, "node_id": "MDQ6VXNlcjY1MDQwNw==", "avatar_url": "https://avatars.githubusercontent.com/u/650407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/24hours", "html_url": "https://github.com/24hours", "followers_url": "https://api.github.com/users/24hours/followers", "following_url": "https://api.github.com/users/24hours/following{/other_user}", "gists_url": "https://api.github.com/users/24hours/gists{/gist_id}", "starred_url": "https://api.github.com/users/24hours/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/24hours/subscriptions", "organizations_url": "https://api.github.com/users/24hours/orgs", "repos_url": "https://api.github.com/users/24hours/repos", "events_url": "https://api.github.com/users/24hours/events{/privacy}", "received_events_url": "https://api.github.com/users/24hours/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 580906362, "node_id": "MDU6TGFiZWw1ODA5MDYzNjI=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/help%20wanted", "name": "help wanted", "color": "0e8a16", "default": true, "description": null}, {"id": 748212683, "node_id": "MDU6TGFiZWw3NDgyMTI2ODM=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/good%20first%20issue", "name": "good first issue", "color": "5319e7", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-07-30T06:58:16Z", "updated_at": "2020-10-26T06:48:00Z", "closed_at": "2020-10-26T06:48:00Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML commments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\n\r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\n\r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\nin config.yaml \r\ndefine the setting as \r\n```\r\nsingleuser:\r\n  fsGid: null\r\n```\r\n\r\nspawn a jupyter notebook, inspect pod yaml configuration \r\nyou will see \r\n```\r\nspec\r\n  securityContext:\r\n    fsGroup: 0\r\n```\r\n\r\nobviously securityContext should not be defined as `fsGid=None`. \r\n\r\n### Your personal set up\r\n\r\nI'm setting up jupyterhub-k8s in my local environment using PVC for each user. However, if user stored too many file into their volume, their subsequent session become very slow to the point where timeout frequently occur. \r\n\r\nthe issue can be traced back to several issue across Kubernetes ecosystem. \r\nLonghorn: https://github.com/longhorn/longhorn/issues/1221\r\nAzure ACS: https://github.com/Azure/acs-engine/issues/2989#issuecomment-414933515\r\n\r\nI have even reported the bug here:\r\nhttps://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1252\r\n\r\nthe culprit is \r\n```\r\n securityContext:\r\n    fsGroup: 0\r\n```\r\n\r\nwork around is proposed in this issue, dont set fsGroup on pod configuration.\r\nhttps://github.com/kubernetes/kubernetes/issues/69699#issuecomment-558861917\r\n\r\nwhich is equivalent to \r\nconfig.yaml \r\n```\r\nsingleuser:\r\n  fsGid: null\r\n```\r\nas default is set to fsGid=100\r\n\r\nThe bug related to both jupyterhub-k8s and [Kubespawner](https://github.com/jupyterhub/kubespawner)\r\n\r\nIn kubespawner, \r\n```python\r\nspawner = KubeSpawner(fs_gid=1000)\r\nprint(spawner.fs_gid) # 1000\r\n# this is the expected result \r\n\r\nspawner = KubeSpawner(fs_gid=None)\r\nprint(spawner.fs_gid) # None\r\n# this will spawn a container with no securityContext defined. \r\n\r\nspawner = KubeSpawner()\r\nprint(spawner.fs_gid) # 0\r\n# Due to how fs_gid is defined in traitlets, undefined will default to 0.\r\n# One solution is to force define trailets with the default value = None. \r\n```\r\n\r\nThis is the location where fs_gid is defined in jupyter_config.py\r\nhttps://github.com/jupyterhub/zero-to-jupyterhub-k8s/blob/master/jupyterhub/files/hub/jupyterhub_config.py#L118\r\n\r\nDue to how `set_config_if_not_none` is defined:\r\nhttps://github.com/jupyterhub/zero-to-jupyterhub-k8s/blob/master/jupyterhub/files/hub/z2jh.py#L78\r\nthe value is not defined if `value = None`\r\n\r\nfinally causing arguments passed to KubeSpawner to be missing fs_gid thus defaulting to 0\r\n\r\nThe resulting bug is the combination of Kubespawner and juputerhub-k8s error. ", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1733/reactions", "total_count": 4, "+1": 2, "-1": 0, "laugh": 0, "hooray": 1, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1733/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1732", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1732/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1732/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1732/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1732", "id": 665166082, "node_id": "MDU6SXNzdWU2NjUxNjYwODI=", "number": 1732, "title": "Default settings of the Hub pod's readinessProbe are problematic", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2020-07-24T13:23:11Z", "updated_at": "2021-01-16T08:19:01Z", "closed_at": "2021-01-16T08:19:00Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "We have a k8s readinessProbe defined, which means that we declare the hub only to be \"Ready\" to receive traffic when it has passed the test of responding to a HTTP request. This is only used as an indicator of successfully starting up currently. For example, the CI tests should not try send traffic to the hub pod before the hub pod has started.\r\n\r\n> **NOTE:** that there is also a livenessProbe which if that fails, it would trigger the container in the pod to restart.\r\n\r\nTo make a pod not-ready at a later time doesn't make much sense - we don't have a pod to fall back to, and we cannot have multiple instances running. Due to this, the setting of the readinessProbe should be such that the hub pod becomes ready when it should be, but that it doesn't ever fail because it was slow for a while.\r\n\r\nInstead of disabling the readinessProbe entirely, I think we should try to make it not fail, this can be done using failureThreshold for example: https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#probe-v1-core\r\n\r\n## 503 (Service unavailable) errors\r\n\r\nThese happen when traffic is routed to a k8s Service that direct traffic to pods without any pod in a Ready status, which is influenced by the readinessProbe.\r\n\r\n[![image](https://user-images.githubusercontent.com/3837114/88401651-4c92d300-cdca-11ea-9ce9-9457b8dc1713.png)](https://snapshot.raintank.io/dashboard/snapshot/oA6Kyl3zZZZ2Oh5ZifMc7KEn6WIZcbEg?orgId=2)\r\n\r\n\r\n## Current default configuration and its use\r\nhttps://github.com/jupyterhub/zero-to-jupyterhub-k8s/blob/0c88d30d32f00a27c491a50986169bdf77e86f4d/jupyterhub/values.yaml#L90-L97\r\n\r\nhttps://github.com/jupyterhub/zero-to-jupyterhub-k8s/blob/d080b1d24bc1eb4d8faac0726f5d5ea87605459b/jupyterhub/templates/hub/deployment.yaml#L224-L246", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1732/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1732/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1731", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1731/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1731/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1731/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1731", "id": 664407883, "node_id": "MDU6SXNzdWU2NjQ0MDc4ODM=", "number": 1731, "title": "DNSConfigForming: Search Line limits were exceeded", "user": {"login": "ReyRen", "id": 26827250, "node_id": "MDQ6VXNlcjI2ODI3MjUw", "avatar_url": "https://avatars.githubusercontent.com/u/26827250?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ReyRen", "html_url": "https://github.com/ReyRen", "followers_url": "https://api.github.com/users/ReyRen/followers", "following_url": "https://api.github.com/users/ReyRen/following{/other_user}", "gists_url": "https://api.github.com/users/ReyRen/gists{/gist_id}", "starred_url": "https://api.github.com/users/ReyRen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ReyRen/subscriptions", "organizations_url": "https://api.github.com/users/ReyRen/orgs", "repos_url": "https://api.github.com/users/ReyRen/repos", "events_url": "https://api.github.com/users/ReyRen/events{/privacy}", "received_events_url": "https://api.github.com/users/ReyRen/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-07-23T11:44:35Z", "updated_at": "2020-07-24T06:04:35Z", "closed_at": "2020-07-24T06:04:35Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML commments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\nwhen I use helm3 to install jhub, the pods with jupyterhub/k8s-hub:0.9.0 image get \"CrashLoopBackoff\" error. \r\nAnd when I look into what's going on, it shows: \"Search Line limits were exceeded, some search paths have been omitted, the applied search line is: jhub.svc.cluster.local svc.cluster.local cluster.local eth.cluster cm.cluster brightcomputing.com\"\r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\nhealth running\r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\n```\r\nNAME                              READY   STATUS             RESTARTS   AGE\r\ncontinuous-image-puller-54ssd     1/1     Running            0          10m  \r\ncontinuous-image-puller-5jmwh     1/1     Running            0          10m  \r\ncontinuous-image-puller-6cns4     1/1     Running            0          10m  \r\ncontinuous-image-puller-blkxc     1/1     Running            0          10m  \r\ncontinuous-image-puller-f9xm8     1/1     Running            0          10m  \r\ncontinuous-image-puller-gfckx     1/1     Running            0          10m  \r\ncontinuous-image-puller-kwhqf     1/1     Running            0          10m  \r\ncontinuous-image-puller-kzh2n     1/1     Running            0          10m  \r\ncontinuous-image-puller-z2gxp     1/1     Running            0          10m  \r\nhub-989845588-lsqcz               0/1     CrashLoopBackOff   6          10m  \r\nproxy-675744c968-zmths            1/1     Running            0          10m  \r\nuser-scheduler-56557c648d-4mm8r   1/1     Running            0          10m  \r\nuser-scheduler-56557c648d-6c99l   1/1     Running            0          10m  \r\n\r\n```\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\nstep by step from https://zero-to-jupyterhub.readthedocs.io/en/latest/setup-jupyterhub/setup-jupyterhub.html#setup-jupyterhub\r\n\r\n### Your personal set up\r\n<!-- Tell us a little about the system you're using. -->\r\n\r\n - OS: ubuntu 18.04\r\n <!-- [e.g. linux, OSX] -->\r\n - Version: 0.9.0\r\n <!-- e.g. jupyterhub --version. --->\r\n - Configuration:\r\n <!-- Be careful not to share any sensitive information. --->\r\n\r\nThanks,\r\nYuan", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1731/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1731/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1727", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1727/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1727/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1727/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1727", "id": 663351647, "node_id": "MDExOlB1bGxSZXF1ZXN0NDU0NzgyMDQ1", "number": 1727, "title": "jupyterhub existing image pull secret configuration load bug fixed", "user": {"login": "mpolatcan", "id": 5066703, "node_id": "MDQ6VXNlcjUwNjY3MDM=", "avatar_url": "https://avatars.githubusercontent.com/u/5066703?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolatcan", "html_url": "https://github.com/mpolatcan", "followers_url": "https://api.github.com/users/mpolatcan/followers", "following_url": "https://api.github.com/users/mpolatcan/following{/other_user}", "gists_url": "https://api.github.com/users/mpolatcan/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolatcan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolatcan/subscriptions", "organizations_url": "https://api.github.com/users/mpolatcan/orgs", "repos_url": "https://api.github.com/users/mpolatcan/repos", "events_url": "https://api.github.com/users/mpolatcan/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolatcan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-07-21T22:37:06Z", "updated_at": "2020-10-04T06:07:32Z", "closed_at": "2020-08-25T09:50:28Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/1727", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1727", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1727.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1727.patch", "merged_at": "2020-08-25T09:50:28Z"}, "body": "When we want to deploy Jupyterhub on Kubernetes, we have had an issue about that singleuser pod spawner which it is also named Kubespawner doesn't use our existing image pull secrets although we had defined on values.yaml. I have found that jupyterhub_config.py configuration doesn't include that config load so anyone can't use existing image pull secrets on their system. Also Kubespawner takes image pull secret name as string not array so that I have changed format of the image pull secret configuration on values.yaml :)", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1727/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1727/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1726", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1726/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1726/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1726/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1726", "id": 663175461, "node_id": "MDU6SXNzdWU2NjMxNzU0NjE=", "number": 1726, "title": "Cannot install on AWS EKS using Fargate only cluster", "user": {"login": "DarkmatterVale", "id": 6094957, "node_id": "MDQ6VXNlcjYwOTQ5NTc=", "avatar_url": "https://avatars.githubusercontent.com/u/6094957?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DarkmatterVale", "html_url": "https://github.com/DarkmatterVale", "followers_url": "https://api.github.com/users/DarkmatterVale/followers", "following_url": "https://api.github.com/users/DarkmatterVale/following{/other_user}", "gists_url": "https://api.github.com/users/DarkmatterVale/gists{/gist_id}", "starred_url": "https://api.github.com/users/DarkmatterVale/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DarkmatterVale/subscriptions", "organizations_url": "https://api.github.com/users/DarkmatterVale/orgs", "repos_url": "https://api.github.com/users/DarkmatterVale/repos", "events_url": "https://api.github.com/users/DarkmatterVale/events{/privacy}", "received_events_url": "https://api.github.com/users/DarkmatterVale/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-07-21T17:11:09Z", "updated_at": "2020-10-08T01:21:46Z", "closed_at": "2020-10-08T01:21:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML commments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\nI am unable to launch a JupyterHub installation on AWS EKS using the Fargate compute profile.\r\n\r\n#### Expected behaviour\r\nJupyterHub is successfully installed on an EKS cluster regardless of underlying compute profile (Fargate or EC2).\r\n\r\n#### Actual behaviour\r\nWhen I attempt to install the Jupyterhub helm chart on an EKS cluster that uses a fargate-only compute, the hook-image-awaiter pods fail to stabilize, leading to a failed install.\r\n\r\nOutput of ```kubectl get pod -A```:\r\n```\r\nNAMESPACE     NAME                       READY   STATUS    RESTARTS   AGE\r\njhub          hook-image-awaiter-*****   0/1     Error     0          3h12m\r\njhub          hook-image-awaiter-*****   0/1     Error     0          3h9m\r\njhub          hook-image-awaiter-*****   0/1     Error     0          172m\r\njhub          hook-image-awaiter-*****   0/1     Error     0          178m\r\njhub          hook-image-awaiter-*****   0/1     Error     0          3h15m\r\njhub          hook-image-awaiter-*****   0/1     Error     0          3h2m\r\njhub          hook-image-awaiter-*****   0/1     Error     0          3h6m\r\nkube-system   coredns-**********-*****   1/1     Running   0          12d\r\nkube-system   coredns-**********-*****   1/1     Running   0          12d\r\n```\r\n(note I ran this a few hours ago which is why the age is high)\r\n\r\nOutput of ```kubectl logs hook-image-awaiter-***** -n jhub``` (all of them fail on the same error):\r\n```\r\n2020/07/21 13:57:38 Get https://10.100.0.1:443/apis/apps/v1/namespaces/jhub/daemonsets/hook-image-puller: dial tcp 10.100.0.1:443: getsockopt: connection timed out\r\n``` \r\n\r\nI confirmed that the endpoint that causes the connection time out error is reachable from a Fargate pod running in the jhub namespace. To verify this (instructions on how to get an api token can be found [here](https://kubernetes.io/docs/tasks/administer-cluster/access-cluster-api/)):\r\n1. Start up a ubuntu pod: ```kubectl run -i --tty ubuntu --image=ubuntu -n jhub -- sh```\r\n2. ```apt update && apt install curl```\r\n3. ```curl -X GET https://10.100.0.1:443/apis/apps/v1/namespaces/jhub/daemonsets/hook-image-puller --header \"Authorization: Bearer $TOKEN\" --insecure```\r\n\r\n### How to reproduce\r\n1. Create a new Fargate EKS cluster using eksctl (```eksctl create cluster --name my-jupyterhub-cluster --version 1.16 --fargate --region us-east-2```)\r\n2. Add a fargate profile for JupyterHub's namespace (\"jhub\")\r\n3. Add Jupyterhub repository to helm (```helm repo add jupyterhub https://jupyterhub.github.io/helm-chart/ && helm repo update```)\r\n4. Create ```config.yaml```:\r\n```\r\nproxy:\r\n  secretToken: .........................................................\r\n```\r\n5. Install JupyterHub helm chart:\r\n```\r\nRELEASE=jhub\r\nNAMESPACE=jhub\r\n\r\nhelm upgrade --install $RELEASE jupyterhub/jupyterhub \\\r\n  --namespace $NAMESPACE \\\r\n  --version=0.9.0 \\\r\n  --values config.yaml \\\r\n  --create-namespace\r\n```\r\n\r\n### Your personal set up\r\n - OS: OSX, 10.15.6\r\n - Helm version: v3.2.3\r\n - Kubectl version:\r\n    - Client version: 1.18.2\r\n    - Server version: 1.16.8\r\n\r\nOther information to know: I am happily running a JupyterHub cluster on EKS using EC2 instances as the compute. This issue seems to only appear when using Fargate.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1726/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1726/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1721", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1721/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1721/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1721/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1721", "id": 658497743, "node_id": "MDExOlB1bGxSZXF1ZXN0NDUwNDUyNjMx", "number": 1721, "title": "fix: jupyterhub services without apiToken was ignored", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-07-16T19:31:55Z", "updated_at": "2020-07-16T19:39:24Z", "closed_at": "2020-07-16T19:39:24Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/1721", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1721", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1721.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1721.patch", "merged_at": "2020-07-16T19:39:24Z"}, "body": "JupyterHub services that didn't have a apiToken set in the Helm chart configuration hub.services.my-service-name.apiToken didn't render into the configmap.\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1721/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1721/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1719", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1719/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1719/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1719/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1719", "id": 658446068, "node_id": "MDExOlB1bGxSZXF1ZXN0NDUwNDA3MzAx", "number": 1719, "title": "fix: autohttps cert acquisition stability fixed", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-07-16T18:27:04Z", "updated_at": "2021-11-25T10:04:28Z", "closed_at": "2020-07-16T18:57:38Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/1719", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1719", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1719.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1719.patch", "merged_at": "2020-07-16T18:57:38Z"}, "body": "Sometimes autohttps cert acquisition failed, and it was because the\r\nchallenge was initiated from a not-k8s-ready pod due to a\r\nreadinessProbe that would require to get a successfull response before\r\nit marked the pod as ready.\r\n\r\nSee: https://github.com/containous/traefik/issues/7033#issuecomment-659589390\r\n\r\nCloses #1716 - @AndrewSav provided very useful guidance making me realize this, and I'm truly thankful this help - it made my day! Thank you!!! :tada: :heart:", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1719/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1719/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1716", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1716/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1716/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1716/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1716", "id": 655228015, "node_id": "MDU6SXNzdWU2NTUyMjgwMTU=", "number": 1716, "title": "CI/CD: Autohttps reliability issues when acquiring certs with Pebble (unknown behavior with Let's Encrypt)", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-07-11T15:26:50Z", "updated_at": "2021-11-25T06:56:53Z", "closed_at": "2020-07-16T18:57:38Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "# Final words about the issue resolution\r\n\r\nThe `autohttps` pod containing Traefik, exposed behind the k8s service called `proxy-public`, when starting up was directly asking the ACME server `pebble` to be challenged so it could get a TLS certificate. This could sometimes happen before the k8s readinessProbe had made the autohttps pod's traefik container be considered Ready, which then makes Pebble fail to reach it through the `proxy-public` k8s service.\r\n\r\nSolution: we stop using the readinessProbe, which makes the pod ready without delay.\r\n\r\n---\r\n\r\nAutohttps startup isn't reliable. There seem to be multiple reasons for this though. It has proven to be not reliable in the past against Let's Encrypt (Helm chart users ACME server) and Pebble (Our CI systems ACME server). I think some issues was fixed in Traefik v2.2.4 that we use following https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1714.\r\n\r\nBut, still with Traefik v2.2.4, there are issues at least when working against Pebble. Below are two CI jobs that have succeeded / failed seemingly at random.\r\n\r\n# Reproduction\r\n\r\nFirst follow the setup instructions in [CONTRIBUTING.md](https://github.com/jupyterhub/zero-to-jupyterhub-k8s/blob/master/CONTRIBUTING.md), then the following command can be representative of an attempt. The attempts typically succeeds, but perhaps 20% of them fail.\r\n\r\n```\r\nkubectl delete secrets/proxy-public-tls-acme; kubectl delete pod -l component=autohttps; kubectl wait --for=condition=Available deploy/autohttps; sleep 15; kubectl logs deploy/autohttps -c traefik\r\n```\r\n\r\n# Workaround\r\n\r\nIf I modify the configuration of Pebble to sleep a bit at random, between 0-15 seconds, then it behaves a lot more reliable. This makes me confident that the issue relates to Traefik's ability to setup its web-endpoint fast enough following attempting to prove itself. I'm not 100% if its a Traefik issue or LEGO issue, but I think its a Traefik issue.\r\n\r\n```yaml\r\n# dev-config-pebble.yaml\r\npebble:\r\n  env:\r\n    ## ref: https://github.com/letsencrypt/pebble#testing-at-full-speed\r\n    - name: PEBBLE_VA_NOSLEEP\r\n      value: \"0\"\r\n    - name: PEBBLE_VA_SLEEPTIME\r\n      value: \"10\"\r\n    ## ref: https://github.com/letsencrypt/pebble#invalid-anti-replay-nonce-errors\r\n    - name: PEBBLE_WFE_NONCEREJECT\r\n      value: \"0\"\r\n    ## ref: https://github.com/letsencrypt/pebble#authorization-reuse\r\n    - name: PEBBLE_AUTHZREUSE\r\n      value: \"0\"\r\n```\r\n\r\n```\r\nhelm upgrade --install pebble jupyterhub/pebble --cleanup-on-fail --values dev-config-pebble.yaml\r\n```\r\n\r\n__Script to run 100 tests__\r\n\r\n```\r\n!/bin/bash\r\n# restarts 100 the pod with traefik (autohttps) 100\r\n# times and breaks on first failure.\r\n# PEBBLE_VA_SLEEPTIME=X\r\n# PEBBLE_VA_SLEEPTIME=1 --- 7/50 attempts failed\r\n# PEBBLE_VA_SLEEPTIME=3 --- 1/50 attempts failed\r\n# PEBBLE_VA_SLEEPTIME=5 --- X/100 attempts failed\r\n# PEBBLE_VA_SLEEPTIME=10 --- 0/100 attempts failed\r\nfor (( c=1; c<=100; c++ ))\r\ndo\r\n   echo \"Attempt $c\"\r\n   kubectl delete secrets/proxy-public-tls-acme; kubectl delete pod -l component=autohttps; kubectl wait --for=condition=Available deploy/autohttps; sleep 10; kubectl logs deploy/autohttps -c traefik | grep \"Retrieving the ACME\" || break\r\ndone\r\n```\r\n\r\n# Conclusion\r\n\r\nThis may not be an issue when using Let's Encrypt. Let's Encrypt may have a brief delay answering Traefik, or there may be some network delay to answer. And in either case, it may help Traefik not run into issues. Since I've got it to be stable on my own computer with `PEBBLE_VA_SLEEPTIME=10` and `PEBBLE_VA_NOSLEEP=0` I'll go ahead and close this for now as the issue is with Traefik as far as I understand.\r\n\r\n# [Example of failing job](https://travis-ci.org/github/jupyterhub/zero-to-jupyterhub-k8s/jobs/707163491)\r\n\r\n## Traefik (autohttps) logs (fail)\r\n\r\n```\r\ntime=\"2020-07-11T14:25:20Z\" level=info msg=\"Configuration loaded from file: /etc/traefik/traefik.yaml\"\r\ntime=\"2020-07-11T14:25:20Z\" level=info msg=\"Traefik version 2.2.4 built on 2020-07-10T17:26:20Z\"\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Static configuration loaded {\\\"global\\\":{\\\"checkNewVersion\\\":true},\\\"serversTransport\\\":{\\\"maxIdleConnsPerHost\\\":200},\\\"entryPoints\\\":{\\\"http\\\":{\\\"address\\\":\\\":80\\\",\\\"transport\\\":{\\\"lifeCycle\\\":{\\\"graceTimeOut\\\":10000000000},\\\"respondingTimeouts\\\":{\\\"idleTimeout\\\":180000000000}},\\\"forwardedHeaders\\\":{},\\\"http\\\":{}},\\\"https\\\":{\\\"address\\\":\\\":443\\\",\\\"transport\\\":{\\\"lifeCycle\\\":{\\\"graceTimeOut\\\":10000000000},\\\"respondingTimeouts\\\":{\\\"idleTimeout\\\":600000000000}},\\\"forwardedHeaders\\\":{},\\\"http\\\":{}}},\\\"providers\\\":{\\\"providersThrottleDuration\\\":2000000000,\\\"file\\\":{\\\"watch\\\":true,\\\"filename\\\":\\\"/etc/traefik/dynamic.yaml\\\"}},\\\"log\\\":{\\\"level\\\":\\\"DEBUG\\\",\\\"format\\\":\\\"common\\\"},\\\"accessLog\\\":{\\\"format\\\":\\\"common\\\",\\\"filters\\\":{\\\"statusCodes\\\":[\\\"500-599\\\"]},\\\"fields\\\":{\\\"defaultMode\\\":\\\"keep\\\",\\\"headers\\\":{\\\"defaultMode\\\":\\\"drop\\\",\\\"names\\\":{\\\"Authorization\\\":\\\"redacted\\\",\\\"Cookie\\\":\\\"redacted\\\",\\\"Set-Cookie\\\":\\\"redacted\\\",\\\"X-Xsrftoken\\\":\\\"redacted\\\"}}}},\\\"certificatesResolvers\\\":{\\\"default\\\":{\\\"acme\\\":{\\\"email\\\":\\\"jovyan@jupyter.test\\\",\\\"caServer\\\":\\\"https://pebble/dir\\\",\\\"storage\\\":\\\"/etc/acme/acme.json\\\",\\\"keyType\\\":\\\"RSA4096\\\",\\\"httpChallenge\\\":{\\\"entryPoint\\\":\\\"http\\\"}}}}}\"\r\ntime=\"2020-07-11T14:25:20Z\" level=info msg=\"\\nStats collection is disabled.\\nHelp us improve Traefik by turning this feature on :)\\nMore details on: https://docs.traefik.io/contributing/data-collection/\\n\"\r\ntime=\"2020-07-11T14:25:20Z\" level=info msg=\"Starting provider aggregator.ProviderAggregator {}\"\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Start TCP Server\" entryPointName=http\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Start TCP Server\" entryPointName=https\r\ntime=\"2020-07-11T14:25:20Z\" level=info msg=\"Starting provider *file.Provider {\\\"watch\\\":true,\\\"filename\\\":\\\"/etc/traefik/dynamic.yaml\\\"}\"\r\ntime=\"2020-07-11T14:25:20Z\" level=info msg=\"Starting provider *acme.Provider {\\\"email\\\":\\\"jovyan@jupyter.test\\\",\\\"caServer\\\":\\\"https://pebble/dir\\\",\\\"storage\\\":\\\"/etc/acme/acme.json\\\",\\\"keyType\\\":\\\"RSA4096\\\",\\\"httpChallenge\\\":{\\\"entryPoint\\\":\\\"http\\\"},\\\"ResolverName\\\":\\\"default\\\",\\\"store\\\":{},\\\"ChallengeStore\\\":{}}\"\r\ntime=\"2020-07-11T14:25:20Z\" level=info msg=\"Testing certificate renew...\" providerName=default.acme\r\ntime=\"2020-07-11T14:25:20Z\" level=info msg=\"Starting provider *traefik.Provider {}\"\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Configuration received from provider file: {\\\"http\\\":{\\\"routers\\\":{\\\"default\\\":{\\\"middlewares\\\":[\\\"hsts\\\",\\\"scheme\\\"],\\\"service\\\":\\\"default\\\",\\\"rule\\\":\\\"PathPrefix(`/`)\\\",\\\"tls\\\":{\\\"options\\\":\\\"default\\\",\\\"certResolver\\\":\\\"default\\\",\\\"domains\\\":[{\\\"main\\\":\\\"local.jovyan.org\\\"}]}},\\\"insecure\\\":{\\\"middlewares\\\":[\\\"redirect\\\"],\\\"service\\\":\\\"default\\\",\\\"rule\\\":\\\"PathPrefix(`/`)\\\"}},\\\"services\\\":{\\\"default\\\":{\\\"loadBalancer\\\":{\\\"servers\\\":[{\\\"url\\\":\\\"http://proxy-http:8000/\\\"}],\\\"passHostHeader\\\":null}}},\\\"middlewares\\\":{\\\"hsts\\\":{\\\"headers\\\":{\\\"stsSeconds\\\":15724800}},\\\"redirect\\\":{\\\"redirectScheme\\\":{\\\"scheme\\\":\\\"https\\\",\\\"permanent\\\":true}},\\\"scheme\\\":{\\\"headers\\\":{\\\"customRequestHeaders\\\":{\\\"X-Scheme\\\":\\\"https\\\"}}}}},\\\"tcp\\\":{},\\\"udp\\\":{},\\\"tls\\\":{\\\"options\\\":{\\\"default\\\":{\\\"minVersion\\\":\\\"VersionTLS12\\\",\\\"cipherSuites\\\":[\\\"TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384\\\",\\\"TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384\\\",\\\"TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256\\\",\\\"TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256\\\",\\\"TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305\\\",\\\"TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305\\\"],\\\"clientAuth\\\":{},\\\"sniStrict\\\":true}}}}\" providerName=file\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Configuration received from provider default.acme: {\\\"http\\\":{},\\\"tls\\\":{}}\" providerName=default.acme\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Configuration received from provider internal: {\\\"http\\\":{\\\"services\\\":{\\\"noop\\\":{}}},\\\"tcp\\\":{},\\\"tls\\\":{}}\" providerName=internal\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"No entryPoint defined for this router, using the default one(s) instead: [http https]\" routerName=default\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"No entryPoint defined for this router, using the default one(s) instead: [http https]\" routerName=insecure\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Creating middleware\" entryPointName=http routerName=insecure@file serviceName=default middlewareName=pipelining middlewareType=Pipelining\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Creating load-balancer\" routerName=insecure@file serviceName=default entryPointName=http\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Creating server 0 http://proxy-http:8000/\" routerName=insecure@file serviceName=default entryPointName=http serverName=0\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Added outgoing tracing middleware default\" middlewareName=tracing entryPointName=http routerName=insecure@file middlewareType=TracingForwarder\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Creating middleware\" entryPointName=http routerName=insecure@file middlewareName=redirect@file middlewareType=RedirectScheme\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Setting up redirection to https \" middlewareType=RedirectScheme entryPointName=http routerName=insecure@file middlewareName=redirect@file\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Adding tracing to middleware\" entryPointName=http routerName=insecure@file middlewareName=redirect@file\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Creating middleware\" entryPointName=http middlewareName=traefik-internal-recovery middlewareType=Recovery\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Creating middleware\" entryPointName=https middlewareType=Recovery middlewareName=traefik-internal-recovery\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Creating Middleware (ResponseModifier)\" middlewareName=hsts@file middlewareType=Headers entryPointName=https routerName=default@file\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Creating Middleware (ResponseModifier)\" entryPointName=https routerName=default@file middlewareName=scheme@file middlewareType=Headers\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Creating middleware\" middlewareType=Pipelining entryPointName=https routerName=default@file serviceName=default middlewareName=pipelining\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Creating load-balancer\" routerName=default@file serviceName=default entryPointName=https\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Creating server 0 http://proxy-http:8000/\" serviceName=default entryPointName=https serverName=0 routerName=default@file\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Added outgoing tracing middleware default\" middlewareType=TracingForwarder entryPointName=https routerName=default@file middlewareName=tracing\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Creating middleware\" middlewareType=Headers entryPointName=https routerName=default@file middlewareName=scheme@file\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Setting up customHeaders/Cors from {map[X-Scheme:https] map[] false [] []  [] [] 0 false [] [] false false  map[] false 0 false false false false  false false      false}\" middlewareName=scheme@file middlewareType=Headers entryPointName=https routerName=default@file\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Adding tracing to middleware\" middlewareName=scheme@file entryPointName=https routerName=default@file\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Creating middleware\" entryPointName=https routerName=default@file middlewareName=hsts@file middlewareType=Headers\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Setting up secureHeaders from {map[] map[] false [] []  [] [] 0 false [] [] false false  map[] false 15724800 false false false false  false false      false}\" middlewareName=hsts@file middlewareType=Headers entryPointName=https routerName=default@file\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Adding tracing to middleware\" middlewareName=hsts@file entryPointName=https routerName=default@file\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Creating middleware\" middlewareType=Recovery entryPointName=https middlewareName=traefik-internal-recovery\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Creating middleware\" entryPointName=http middlewareName=traefik-internal-recovery middlewareType=Recovery\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"No default certificate, generating one\"\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Looking for provided certificate(s) to validate [\\\"local.jovyan.org\\\"]...\" providerName=default.acme\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"No default certificate, generating one\"\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Creating middleware\" routerName=insecure@file serviceName=default middlewareName=pipelining middlewareType=Pipelining entryPointName=https\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Creating load-balancer\" entryPointName=https routerName=insecure@file serviceName=default\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Creating server 0 http://proxy-http:8000/\" serviceName=default serverName=0 entryPointName=https routerName=insecure@file\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Added outgoing tracing middleware default\" entryPointName=https routerName=insecure@file middlewareName=tracing middlewareType=TracingForwarder\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Creating middleware\" entryPointName=https routerName=insecure@file middlewareName=redirect@file middlewareType=RedirectScheme\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Setting up redirection to https \" entryPointName=https routerName=insecure@file middlewareName=redirect@file middlewareType=RedirectScheme\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Adding tracing to middleware\" routerName=insecure@file entryPointName=https middlewareName=redirect@file\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Creating middleware\" entryPointName=https middlewareName=traefik-internal-recovery middlewareType=Recovery\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Creating middleware\" entryPointName=http middlewareName=traefik-internal-recovery middlewareType=Recovery\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Creating Middleware (ResponseModifier)\" middlewareType=Headers entryPointName=http routerName=default@file middlewareName=hsts@file\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Creating Middleware (ResponseModifier)\" middlewareType=Headers routerName=default@file entryPointName=http middlewareName=scheme@file\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Creating middleware\" serviceName=default middlewareName=pipelining middlewareType=Pipelining entryPointName=http routerName=default@file\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Creating load-balancer\" entryPointName=http routerName=default@file serviceName=default\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Creating server 0 http://proxy-http:8000/\" entryPointName=http routerName=default@file serviceName=default serverName=0\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Added outgoing tracing middleware default\" middlewareType=TracingForwarder entryPointName=http routerName=default@file middlewareName=tracing\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Creating middleware\" routerName=default@file middlewareName=scheme@file middlewareType=Headers entryPointName=http\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Setting up customHeaders/Cors from {map[X-Scheme:https] map[] false [] []  [] [] 0 false [] [] false false  map[] false 0 false false false false  false false      false}\" entryPointName=http routerName=default@file middlewareName=scheme@file middlewareType=Headers\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Adding tracing to middleware\" entryPointName=http routerName=default@file middlewareName=scheme@file\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Creating middleware\" middlewareType=Headers middlewareName=hsts@file entryPointName=http routerName=default@file\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Setting up secureHeaders from {map[] map[] false [] []  [] [] 0 false [] [] false false  map[] false 15724800 false false false false  false false      false}\" entryPointName=http routerName=default@file middlewareType=Headers middlewareName=hsts@file\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Adding tracing to middleware\" entryPointName=http routerName=default@file middlewareName=hsts@file\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Creating middleware\" entryPointName=http middlewareName=traefik-internal-recovery middlewareType=Recovery\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"Creating middleware\" entryPointName=https middlewareName=traefik-internal-recovery middlewareType=Recovery\r\ntime=\"2020-07-11T14:25:20Z\" level=debug msg=\"No default certificate, generating one\"\r\ntime=\"2020-07-11T14:25:21Z\" level=debug msg=\"Domains [\\\"local.jovyan.org\\\"] need ACME certificates generation for domains \\\"local.jovyan.org\\\".\" providerName=default.acme\r\ntime=\"2020-07-11T14:25:21Z\" level=debug msg=\"Loading ACME certificates [local.jovyan.org]...\" providerName=default.acme\r\ntime=\"2020-07-11T14:25:21Z\" level=debug msg=\"Creating middleware\" entryPointName=http routerName=insecure@file serviceName=default middlewareName=pipelining middlewareType=Pipelining\r\ntime=\"2020-07-11T14:25:21Z\" level=debug msg=\"Creating load-balancer\" serviceName=default entryPointName=http routerName=insecure@file\r\ntime=\"2020-07-11T14:25:21Z\" level=debug msg=\"Creating server 0 http://proxy-http:8000/\" serverName=0 entryPointName=http routerName=insecure@file serviceName=default\r\ntime=\"2020-07-11T14:25:21Z\" level=debug msg=\"Added outgoing tracing middleware default\" routerName=insecure@file entryPointName=http middlewareName=tracing middlewareType=TracingForwarder\r\ntime=\"2020-07-11T14:25:21Z\" level=debug msg=\"Creating middleware\" entryPointName=http routerName=insecure@file middlewareType=RedirectScheme middlewareName=redirect@file\r\ntime=\"2020-07-11T14:25:21Z\" level=debug msg=\"Setting up redirection to https \" entryPointName=http routerName=insecure@file middlewareType=RedirectScheme middlewareName=redirect@file\r\ntime=\"2020-07-11T14:25:21Z\" level=debug msg=\"Adding tracing to middleware\" entryPointName=http routerName=insecure@file middlewareName=redirect@file\r\ntime=\"2020-07-11T14:25:21Z\" level=debug msg=\"Creating middleware\" middlewareName=traefik-internal-recovery middlewareType=Recovery entryPointName=http\r\ntime=\"2020-07-11T14:25:21Z\" level=debug msg=\"Creating middleware\" entryPointName=https middlewareName=traefik-internal-recovery middlewareType=Recovery\r\ntime=\"2020-07-11T14:25:21Z\" level=debug msg=\"Creating Middleware (ResponseModifier)\" entryPointName=http routerName=default@file middlewareName=hsts@file middlewareType=Headers\r\ntime=\"2020-07-11T14:25:21Z\" level=debug msg=\"Creating Middleware (ResponseModifier)\" routerName=default@file entryPointName=http middlewareName=scheme@file middlewareType=Headers\r\ntime=\"2020-07-11T14:25:21Z\" level=debug msg=\"Creating middleware\" serviceName=default middlewareName=pipelining middlewareType=Pipelining entryPointName=http routerName=default@file\r\ntime=\"2020-07-11T14:25:21Z\" level=debug msg=\"Creating load-balancer\" routerName=default@file serviceName=default entryPointName=http\r\ntime=\"2020-07-11T14:25:21Z\" level=debug msg=\"Creating server 0 http://proxy-http:8000/\" entryPointName=http routerName=default@file serverName=0 serviceName=default\r\ntime=\"2020-07-11T14:25:21Z\" level=debug msg=\"Added outgoing tracing middleware default\" routerName=default@file middlewareName=tracing middlewareType=TracingForwarder entryPointName=http\r\ntime=\"2020-07-11T14:25:21Z\" level=debug msg=\"Creating middleware\" entryPointName=http routerName=default@file middlewareName=scheme@file middlewareType=Headers\r\ntime=\"2020-07-11T14:25:21Z\" level=debug msg=\"Setting up customHeaders/Cors from {map[X-Scheme:https] map[] false [] []  [] [] 0 false [] [] false false  map[] false 0 false false false false  false false      false}\" entryPointName=http routerName=default@file middlewareName=scheme@file middlewareType=Headers\r\ntime=\"2020-07-11T14:25:21Z\" level=debug msg=\"Adding tracing to middleware\" middlewareName=scheme@file entryPointName=http routerName=default@file\r\ntime=\"2020-07-11T14:25:21Z\" level=debug msg=\"Creating middleware\" middlewareName=hsts@file middlewareType=Headers routerName=default@file entryPointName=http\r\ntime=\"2020-07-11T14:25:21Z\" level=debug msg=\"Setting up secureHeaders from {map[] map[] false [] []  [] [] 0 false [] [] false false  map[] false 15724800 false false false false  false false      false}\" middlewareName=hsts@file middlewareType=Headers routerName=default@file entryPointName=http\r\ntime=\"2020-07-11T14:25:21Z\" level=debug msg=\"Adding tracing to middleware\" entryPointName=http routerName=default@file middlewareName=hsts@file\r\ntime=\"2020-07-11T14:25:21Z\" level=debug msg=\"Creating middleware\" middlewareName=traefik-internal-recovery middlewareType=Recovery entryPointName=http\r\ntime=\"2020-07-11T14:25:21Z\" level=debug msg=\"Creating middleware\" middlewareName=traefik-internal-recovery middlewareType=Recovery entryPointName=https\r\ntime=\"2020-07-11T14:25:21Z\" level=debug msg=\"No default certificate, generating one\"\r\ntime=\"2020-07-11T14:25:21Z\" level=debug msg=\"Looking for provided certificate(s) to validate [\\\"local.jovyan.org\\\"]...\" providerName=default.acme\r\ntime=\"2020-07-11T14:25:21Z\" level=debug msg=\"No default certificate, generating one\"\r\ntime=\"2020-07-11T14:25:21Z\" level=debug msg=\"No ACME certificate generation required for domains [\\\"local.jovyan.org\\\"].\" providerName=default.acme\r\ntime=\"2020-07-11T14:25:21Z\" level=debug msg=\"Looking for provided certificate(s) to validate [\\\"local.jovyan.org\\\"]...\" providerName=default.acme\r\ntime=\"2020-07-11T14:25:21Z\" level=debug msg=\"No ACME certificate generation required for domains [\\\"local.jovyan.org\\\"].\" providerName=default.acme\r\ntime=\"2020-07-11T14:25:22Z\" level=debug msg=\"Building ACME client...\" providerName=default.acme\r\ntime=\"2020-07-11T14:25:22Z\" level=debug msg=\"https://pebble/dir\" providerName=default.acme\r\ntime=\"2020-07-11T14:25:22Z\" level=info msg=Register... providerName=default.acme\r\ntime=\"2020-07-11T14:25:22Z\" level=debug msg=\"legolog: [INFO] acme: Registering account for jovyan@jupyter.test\"\r\ntime=\"2020-07-11T14:25:22Z\" level=debug msg=\"Using HTTP Challenge provider.\" providerName=default.acme\r\ntime=\"2020-07-11T14:25:22Z\" level=debug msg=\"legolog: [INFO] [local.jovyan.org] acme: Obtaining bundled SAN certificate\"\r\ntime=\"2020-07-11T14:25:22Z\" level=debug msg=\"legolog: [INFO] [local.jovyan.org] AuthURL: https://pebble/authZ/HT2wstPk3zOyYhwpDhuspp5qBuvPg45Ge1KfPTbyusA\"\r\ntime=\"2020-07-11T14:25:22Z\" level=debug msg=\"legolog: [INFO] [local.jovyan.org] acme: Could not find solver for: tls-alpn-01\"\r\ntime=\"2020-07-11T14:25:22Z\" level=debug msg=\"legolog: [INFO] [local.jovyan.org] acme: use http-01 solver\"\r\ntime=\"2020-07-11T14:25:22Z\" level=debug msg=\"legolog: [INFO] [local.jovyan.org] acme: Trying to solve HTTP-01\"\r\ntime=\"2020-07-11T14:25:42Z\" level=debug msg=\"legolog: [INFO] Deactivating auth: https://pebble/authZ/HT2wstPk3zOyYhwpDhuspp5qBuvPg45Ge1KfPTbyusA\"\r\ntime=\"2020-07-11T14:25:42Z\" level=error msg=\"Unable to obtain ACME certificate for domains \\\"local.jovyan.org\\\" : unable to generate a certificate for the domains [local.jovyan.org]: error: one or more domains had a problem:\\n[local.jovyan.org] acme: error: 400 :: urn:ietf:params:acme:error:connection :: Get http://local.jovyan.org:80/.well-known/acme-challenge/rImzLzHuDV1EwpqgwqRGK93vKWUtC_baC6TVVA3WIc0: net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers), url: \\n\" providerName=default.acme\r\n```\r\n\r\n## Pebble logs (fail)\r\n\r\n```\r\nPebble 2020/07/11 14:24:06 Starting Pebble ACME server\r\nPebble 2020/07/11 14:24:06 Generated new root issuer with serial 4c141fb32a7d4100 and SKI 8b8d0e65f03b863239b07c073e68b43802d32578\r\nPebble 2020/07/11 14:24:06 Generated new intermediate issuer with serial 14bf232b82fce6d0 and SKI e850f60613bfbbb6d00fc7eae43905f643b95fdd\r\nPebble 2020/07/11 14:24:06 Using custom DNS resolver for ACME challenges: 10.43.116.4:53\r\nPebble 2020/07/11 14:24:06 Disabling random VA sleeps\r\nPebble 2020/07/11 14:24:06 Configured to reject 0% of good nonces\r\nPebble 2020/07/11 14:24:06 Configured to attempt authz reuse for each identifier 100% of the time\r\nPebble 2020/07/11 14:24:06 Configured to show 3 orders per page\r\nPebble 2020/07/11 14:24:06 Management interface listening on: :8444\r\nPebble 2020/07/11 14:24:06 Root CA certificate available at: https://:8444/roots/0\r\nPebble 2020/07/11 14:24:06 Listening on: :8443\r\nPebble 2020/07/11 14:24:06 ACME directory available at: https://:8443/dir\r\nPebble 2020/07/11 14:25:22 GET /dir -> calling handler()\r\nPebble 2020/07/11 14:25:22 HEAD /nonce-plz -> calling handler()\r\nPebble 2020/07/11 14:25:22 POST /sign-me-up -> calling handler()\r\nPebble 2020/07/11 14:25:22 There are now 1 accounts in memory\r\nPebble 2020/07/11 14:25:22 POST /order-plz -> calling handler()\r\nPebble 2020/07/11 14:25:22 There are now 1 authorizations in the db\r\nPebble 2020/07/11 14:25:22 Added order \"SsbMvyTJCPwmAeEepgl9EPADvBXLQuib_Qk4FUgJpKE\" to the db\r\nPebble 2020/07/11 14:25:22 There are now 1 orders in the db\r\nPebble 2020/07/11 14:25:22 POST /authZ/ -> calling handler()\r\nPebble 2020/07/11 14:25:22 POST /chalZ/ -> calling handler()\r\nPebble 2020/07/11 14:25:22 Pulled a task from the Tasks queue: &va.vaTask{Identifier:acme.Identifier{Type:\"dns\", Value:\"local.jovyan.org\"}, Challenge:(*core.Challenge)(0xc000093680), Account:(*core.Account)(0xc00008ccc0)}\r\nPebble 2020/07/11 14:25:22 Starting 3 validations.\r\nPebble 2020/07/11 14:25:22 Attempting to validate w/ HTTP: http://local.jovyan.org:80/.well-known/acme-challenge/rImzLzHuDV1EwpqgwqRGK93vKWUtC_baC6TVVA3WIc0\r\nPebble 2020/07/11 14:25:22 Attempting to validate w/ HTTP: http://local.jovyan.org:80/.well-known/acme-challenge/rImzLzHuDV1EwpqgwqRGK93vKWUtC_baC6TVVA3WIc0\r\nPebble 2020/07/11 14:25:22 Attempting to validate w/ HTTP: http://local.jovyan.org:80/.well-known/acme-challenge/rImzLzHuDV1EwpqgwqRGK93vKWUtC_baC6TVVA3WIc0\r\nPebble 2020/07/11 14:25:22 POST /authZ/ -> calling handler()\r\nPebble 2020/07/11 14:25:25 POST /authZ/ -> calling handler()\r\nPebble 2020/07/11 14:25:33 POST /authZ/ -> calling handler()\r\nPebble 2020/07/11 14:25:37 authz HT2wstPk3zOyYhwpDhuspp5qBuvPg45Ge1KfPTbyusA set INVALID by completed challenge Bybss0OgV91YU7Vm_8sFcQN_-D6FxLcw_sdfciq2Jfc\r\nPebble 2020/07/11 14:25:37 order SsbMvyTJCPwmAeEepgl9EPADvBXLQuib_Qk4FUgJpKE set INVALID by invalid authz HT2wstPk3zOyYhwpDhuspp5qBuvPg45Ge1KfPTbyusA\r\nPebble 2020/07/11 14:25:42 POST /authZ/ -> calling handler()\r\nPebble 2020/07/11 14:25:42 POST /authZ/ -> calling handler()\r\nPebble 2020/07/11 14:25:42 POST /authZ/ -> calling handler()\r\n```\r\n\r\n# [Example of successful job](https://travis-ci.org/github/jupyterhub/zero-to-jupyterhub-k8s/jobs/707186078)\r\n\r\n## Traefik (autohttps) logs (success)\r\n\r\n```\r\n2020-07-11 15:38:06,458 INFO /usr/local/bin/acme-secret-sync.py load proxy-public-tls-acme acme.json /etc/acme/acme.json\r\ntime=\"2020-07-11T15:38:12Z\" level=info msg=\"Configuration loaded from file: /etc/traefik/traefik.yaml\"\r\ntime=\"2020-07-11T15:38:12Z\" level=info msg=\"Traefik version 2.2.4 built on 2020-07-10T17:26:20Z\"\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Static configuration loaded {\\\"global\\\":{\\\"checkNewVersion\\\":true},\\\"serversTransport\\\":{\\\"maxIdleConnsPerHost\\\":200},\\\"entryPoints\\\":{\\\"http\\\":{\\\"address\\\":\\\":80\\\",\\\"transport\\\":{\\\"lifeCycle\\\":{\\\"graceTimeOut\\\":10000000000},\\\"respondingTimeouts\\\":{\\\"idleTimeout\\\":180000000000}},\\\"forwardedHeaders\\\":{},\\\"http\\\":{}},\\\"https\\\":{\\\"address\\\":\\\":443\\\",\\\"transport\\\":{\\\"lifeCycle\\\":{\\\"graceTimeOut\\\":10000000000},\\\"respondingTimeouts\\\":{\\\"idleTimeout\\\":600000000000}},\\\"forwardedHeaders\\\":{},\\\"http\\\":{}}},\\\"providers\\\":{\\\"providersThrottleDuration\\\":2000000000,\\\"file\\\":{\\\"watch\\\":true,\\\"filename\\\":\\\"/etc/traefik/dynamic.yaml\\\"}},\\\"log\\\":{\\\"level\\\":\\\"DEBUG\\\",\\\"format\\\":\\\"common\\\"},\\\"accessLog\\\":{\\\"format\\\":\\\"common\\\",\\\"filters\\\":{\\\"statusCodes\\\":[\\\"500-599\\\"]},\\\"fields\\\":{\\\"defaultMode\\\":\\\"keep\\\",\\\"headers\\\":{\\\"defaultMode\\\":\\\"drop\\\",\\\"names\\\":{\\\"Authorization\\\":\\\"redacted\\\",\\\"Cookie\\\":\\\"redacted\\\",\\\"Set-Cookie\\\":\\\"redacted\\\",\\\"X-Xsrftoken\\\":\\\"redacted\\\"}}}},\\\"certificatesResolvers\\\":{\\\"default\\\":{\\\"acme\\\":{\\\"email\\\":\\\"jovyan@jupyter.test\\\",\\\"caServer\\\":\\\"https://pebble/dir\\\",\\\"storage\\\":\\\"/etc/acme/acme.json\\\",\\\"keyType\\\":\\\"RSA4096\\\",\\\"httpChallenge\\\":{\\\"entryPoint\\\":\\\"http\\\"}}}}}\"\r\ntime=\"2020-07-11T15:38:12Z\" level=info msg=\"\\nStats collection is disabled.\\nHelp us improve Traefik by turning this feature on :)\\nMore details on: https://docs.traefik.io/contributing/data-collection/\\n\"\r\ntime=\"2020-07-11T15:38:12Z\" level=info msg=\"Starting provider aggregator.ProviderAggregator {}\"\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Start TCP Server\" entryPointName=http\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Start TCP Server\" entryPointName=https\r\ntime=\"2020-07-11T15:38:12Z\" level=info msg=\"Starting provider *file.Provider {\\\"watch\\\":true,\\\"filename\\\":\\\"/etc/traefik/dynamic.yaml\\\"}\"\r\ntime=\"2020-07-11T15:38:12Z\" level=info msg=\"Starting provider *acme.Provider {\\\"email\\\":\\\"jovyan@jupyter.test\\\",\\\"caServer\\\":\\\"https://pebble/dir\\\",\\\"storage\\\":\\\"/etc/acme/acme.json\\\",\\\"keyType\\\":\\\"RSA4096\\\",\\\"httpChallenge\\\":{\\\"entryPoint\\\":\\\"http\\\"},\\\"ResolverName\\\":\\\"default\\\",\\\"store\\\":{},\\\"ChallengeStore\\\":{}}\"\r\ntime=\"2020-07-11T15:38:12Z\" level=info msg=\"Testing certificate renew...\" providerName=default.acme\r\ntime=\"2020-07-11T15:38:12Z\" level=info msg=\"Starting provider *traefik.Provider {}\"\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Configuration received from provider file: {\\\"http\\\":{\\\"routers\\\":{\\\"default\\\":{\\\"middlewares\\\":[\\\"hsts\\\",\\\"scheme\\\"],\\\"service\\\":\\\"default\\\",\\\"rule\\\":\\\"PathPrefix(`/`)\\\",\\\"tls\\\":{\\\"options\\\":\\\"default\\\",\\\"certResolver\\\":\\\"default\\\",\\\"domains\\\":[{\\\"main\\\":\\\"local.jovyan.org\\\"}]}},\\\"insecure\\\":{\\\"middlewares\\\":[\\\"redirect\\\"],\\\"service\\\":\\\"default\\\",\\\"rule\\\":\\\"PathPrefix(`/`)\\\"}},\\\"services\\\":{\\\"default\\\":{\\\"loadBalancer\\\":{\\\"servers\\\":[{\\\"url\\\":\\\"http://proxy-http:8000/\\\"}],\\\"passHostHeader\\\":null}}},\\\"middlewares\\\":{\\\"hsts\\\":{\\\"headers\\\":{\\\"stsSeconds\\\":15724800}},\\\"redirect\\\":{\\\"redirectScheme\\\":{\\\"scheme\\\":\\\"https\\\",\\\"permanent\\\":true}},\\\"scheme\\\":{\\\"headers\\\":{\\\"customRequestHeaders\\\":{\\\"X-Scheme\\\":\\\"https\\\"}}}}},\\\"tcp\\\":{},\\\"udp\\\":{},\\\"tls\\\":{\\\"options\\\":{\\\"default\\\":{\\\"minVersion\\\":\\\"VersionTLS12\\\",\\\"cipherSuites\\\":[\\\"TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384\\\",\\\"TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384\\\",\\\"TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256\\\",\\\"TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256\\\",\\\"TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305\\\",\\\"TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305\\\"],\\\"clientAuth\\\":{},\\\"sniStrict\\\":true}}}}\" providerName=file\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Configuration received from provider default.acme: {\\\"http\\\":{},\\\"tls\\\":{}}\" providerName=default.acme\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Configuration received from provider internal: {\\\"http\\\":{\\\"services\\\":{\\\"noop\\\":{}}},\\\"tcp\\\":{},\\\"tls\\\":{}}\" providerName=internal\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"No entryPoint defined for this router, using the default one(s) instead: [http https]\" routerName=insecure\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"No entryPoint defined for this router, using the default one(s) instead: [http https]\" routerName=default\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Creating middleware\" serviceName=default entryPointName=http middlewareName=pipelining middlewareType=Pipelining routerName=insecure@file\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Creating load-balancer\" routerName=insecure@file serviceName=default entryPointName=http\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Creating server 0 http://proxy-http:8000/\" entryPointName=http routerName=insecure@file serviceName=default serverName=0\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Added outgoing tracing middleware default\" entryPointName=http routerName=insecure@file middlewareName=tracing middlewareType=TracingForwarder\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Creating middleware\" middlewareName=redirect@file middlewareType=RedirectScheme entryPointName=http routerName=insecure@file\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Setting up redirection to https \" middlewareName=redirect@file middlewareType=RedirectScheme entryPointName=http routerName=insecure@file\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Adding tracing to middleware\" routerName=insecure@file middlewareName=redirect@file entryPointName=http\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Creating middleware\" middlewareType=Recovery entryPointName=http middlewareName=traefik-internal-recovery\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Creating middleware\" middlewareType=Recovery middlewareName=traefik-internal-recovery entryPointName=https\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Creating Middleware (ResponseModifier)\" entryPointName=http routerName=default@file middlewareName=hsts@file middlewareType=Headers\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Creating Middleware (ResponseModifier)\" entryPointName=http routerName=default@file middlewareName=scheme@file middlewareType=Headers\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Creating middleware\" routerName=default@file serviceName=default middlewareName=pipelining middlewareType=Pipelining entryPointName=http\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Creating load-balancer\" routerName=default@file serviceName=default entryPointName=http\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Creating server 0 http://proxy-http:8000/\" serverName=0 entryPointName=http routerName=default@file serviceName=default\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Added outgoing tracing middleware default\" entryPointName=http routerName=default@file middlewareName=tracing middlewareType=TracingForwarder\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Creating middleware\" entryPointName=http routerName=default@file middlewareName=scheme@file middlewareType=Headers\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Setting up customHeaders/Cors from {map[X-Scheme:https] map[] false [] []  [] [] 0 false [] [] false false  map[] false 0 false false false false  false false      false}\" entryPointName=http routerName=default@file middlewareName=scheme@file middlewareType=Headers\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Adding tracing to middleware\" routerName=default@file middlewareName=scheme@file entryPointName=http\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Creating middleware\" entryPointName=http routerName=default@file middlewareName=hsts@file middlewareType=Headers\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Setting up secureHeaders from {map[] map[] false [] []  [] [] 0 false [] [] false false  map[] false 15724800 false false false false  false false      false}\" middlewareName=hsts@file middlewareType=Headers entryPointName=http routerName=default@file\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Adding tracing to middleware\" entryPointName=http routerName=default@file middlewareName=hsts@file\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Creating middleware\" entryPointName=http middlewareType=Recovery middlewareName=traefik-internal-recovery\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Creating middleware\" entryPointName=https middlewareName=traefik-internal-recovery middlewareType=Recovery\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"No default certificate, generating one\"\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Looking for provided certificate(s) to validate [\\\"local.jovyan.org\\\"]...\" providerName=default.acme\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"No default certificate, generating one\"\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Creating middleware\" entryPointName=http middlewareName=pipelining middlewareType=Pipelining routerName=insecure@file serviceName=default\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Creating load-balancer\" entryPointName=http routerName=insecure@file serviceName=default\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Creating server 0 http://proxy-http:8000/\" entryPointName=http routerName=insecure@file serviceName=default serverName=0\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Added outgoing tracing middleware default\" middlewareType=TracingForwarder middlewareName=tracing entryPointName=http routerName=insecure@file\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Creating middleware\" entryPointName=http routerName=insecure@file middlewareName=redirect@file middlewareType=RedirectScheme\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Setting up redirection to https \" entryPointName=http routerName=insecure@file middlewareName=redirect@file middlewareType=RedirectScheme\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Adding tracing to middleware\" entryPointName=http routerName=insecure@file middlewareName=redirect@file\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Creating middleware\" entryPointName=http middlewareName=traefik-internal-recovery middlewareType=Recovery\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Creating middleware\" entryPointName=https middlewareName=traefik-internal-recovery middlewareType=Recovery\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Creating Middleware (ResponseModifier)\" entryPointName=http routerName=default@file middlewareName=hsts@file middlewareType=Headers\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Creating Middleware (ResponseModifier)\" entryPointName=http middlewareName=scheme@file routerName=default@file middlewareType=Headers\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Creating middleware\" entryPointName=http routerName=default@file serviceName=default middlewareName=pipelining middlewareType=Pipelining\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Creating load-balancer\" entryPointName=http routerName=default@file serviceName=default\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Creating server 0 http://proxy-http:8000/\" entryPointName=http routerName=default@file serviceName=default serverName=0\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Added outgoing tracing middleware default\" entryPointName=http routerName=default@file middlewareName=tracing middlewareType=TracingForwarder\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Creating middleware\" entryPointName=http routerName=default@file middlewareType=Headers middlewareName=scheme@file\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Setting up customHeaders/Cors from {map[X-Scheme:https] map[] false [] []  [] [] 0 false [] [] false false  map[] false 0 false false false false  false false      false}\" entryPointName=http routerName=default@file middlewareType=Headers middlewareName=scheme@file\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Adding tracing to middleware\" entryPointName=http routerName=default@file middlewareName=scheme@file\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Creating middleware\" entryPointName=http routerName=default@file middlewareName=hsts@file middlewareType=Headers\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Setting up secureHeaders from {map[] map[] false [] []  [] [] 0 false [] [] false false  map[] false 15724800 false false false false  false false      false}\" routerName=default@file middlewareName=hsts@file middlewareType=Headers entryPointName=http\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Adding tracing to middleware\" routerName=default@file entryPointName=http middlewareName=hsts@file\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Creating middleware\" entryPointName=http middlewareName=traefik-internal-recovery middlewareType=Recovery\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"Creating middleware\" middlewareType=Recovery entryPointName=https middlewareName=traefik-internal-recovery\r\ntime=\"2020-07-11T15:38:12Z\" level=debug msg=\"No default certificate, generating one\"\r\ntime=\"2020-07-11T15:38:13Z\" level=debug msg=\"Domains [\\\"local.jovyan.org\\\"] need ACME certificates generation for domains \\\"local.jovyan.org\\\".\" providerName=default.acme\r\ntime=\"2020-07-11T15:38:13Z\" level=debug msg=\"Loading ACME certificates [local.jovyan.org]...\" providerName=default.acme\r\ntime=\"2020-07-11T15:38:13Z\" level=debug msg=\"Creating middleware\" entryPointName=http routerName=insecure@file serviceName=default middlewareName=pipelining middlewareType=Pipelining\r\ntime=\"2020-07-11T15:38:13Z\" level=debug msg=\"Creating load-balancer\" entryPointName=http routerName=insecure@file serviceName=default\r\ntime=\"2020-07-11T15:38:13Z\" level=debug msg=\"Creating server 0 http://proxy-http:8000/\" serviceName=default entryPointName=http serverName=0 routerName=insecure@file\r\ntime=\"2020-07-11T15:38:13Z\" level=debug msg=\"Added outgoing tracing middleware default\" entryPointName=http routerName=insecure@file middlewareName=tracing middlewareType=TracingForwarder\r\ntime=\"2020-07-11T15:38:13Z\" level=debug msg=\"Creating middleware\" entryPointName=http routerName=insecure@file middlewareType=RedirectScheme middlewareName=redirect@file\r\ntime=\"2020-07-11T15:38:13Z\" level=debug msg=\"Setting up redirection to https \" middlewareName=redirect@file entryPointName=http routerName=insecure@file middlewareType=RedirectScheme\r\ntime=\"2020-07-11T15:38:13Z\" level=debug msg=\"Adding tracing to middleware\" entryPointName=http routerName=insecure@file middlewareName=redirect@file\r\ntime=\"2020-07-11T15:38:13Z\" level=debug msg=\"Creating middleware\" entryPointName=http middlewareType=Recovery middlewareName=traefik-internal-recovery\r\ntime=\"2020-07-11T15:38:13Z\" level=debug msg=\"Creating middleware\" entryPointName=https middlewareName=traefik-internal-recovery middlewareType=Recovery\r\ntime=\"2020-07-11T15:38:13Z\" level=debug msg=\"Creating Middleware (ResponseModifier)\" routerName=default@file middlewareName=hsts@file entryPointName=http middlewareType=Headers\r\ntime=\"2020-07-11T15:38:13Z\" level=debug msg=\"Creating Middleware (ResponseModifier)\" entryPointName=http routerName=default@file middlewareName=scheme@file middlewareType=Headers\r\ntime=\"2020-07-11T15:38:13Z\" level=debug msg=\"Creating middleware\" serviceName=default middlewareName=pipelining middlewareType=Pipelining entryPointName=http routerName=default@file\r\ntime=\"2020-07-11T15:38:13Z\" level=debug msg=\"Creating load-balancer\" routerName=default@file serviceName=default entryPointName=http\r\ntime=\"2020-07-11T15:38:13Z\" level=debug msg=\"Creating server 0 http://proxy-http:8000/\" serviceName=default entryPointName=http routerName=default@file serverName=0\r\ntime=\"2020-07-11T15:38:13Z\" level=debug msg=\"Added outgoing tracing middleware default\" middlewareType=TracingForwarder entryPointName=http routerName=default@file middlewareName=tracing\r\ntime=\"2020-07-11T15:38:13Z\" level=debug msg=\"Creating middleware\" entryPointName=http routerName=default@file middlewareName=scheme@file middlewareType=Headers\r\ntime=\"2020-07-11T15:38:13Z\" level=debug msg=\"Setting up customHeaders/Cors from {map[X-Scheme:https] map[] false [] []  [] [] 0 false [] [] false false  map[] false 0 false false false false  false false      false}\" entryPointName=http routerName=default@file middlewareName=scheme@file middlewareType=Headers\r\ntime=\"2020-07-11T15:38:13Z\" level=debug msg=\"Adding tracing to middleware\" routerName=default@file middlewareName=scheme@file entryPointName=http\r\ntime=\"2020-07-11T15:38:13Z\" level=debug msg=\"Creating middleware\" entryPointName=http routerName=default@file middlewareName=hsts@file middlewareType=Headers\r\ntime=\"2020-07-11T15:38:13Z\" level=debug msg=\"Setting up secureHeaders from {map[] map[] false [] []  [] [] 0 false [] [] false false  map[] false 15724800 false false false false  false false      false}\" entryPointName=http routerName=default@file middlewareName=hsts@file middlewareType=Headers\r\ntime=\"2020-07-11T15:38:13Z\" level=debug msg=\"Adding tracing to middleware\" entryPointName=http routerName=default@file middlewareName=hsts@file\r\ntime=\"2020-07-11T15:38:13Z\" level=debug msg=\"Creating middleware\" middlewareType=Recovery entryPointName=http middlewareName=traefik-internal-recovery\r\ntime=\"2020-07-11T15:38:13Z\" level=debug msg=\"Creating middleware\" middlewareName=traefik-internal-recovery middlewareType=Recovery entryPointName=https\r\ntime=\"2020-07-11T15:38:13Z\" level=debug msg=\"No default certificate, generating one\"\r\ntime=\"2020-07-11T15:38:13Z\" level=debug msg=\"Looking for provided certificate(s) to validate [\\\"local.jovyan.org\\\"]...\" providerName=default.acme\r\ntime=\"2020-07-11T15:38:13Z\" level=debug msg=\"No default certificate, generating one\"\r\ntime=\"2020-07-11T15:38:14Z\" level=debug msg=\"No ACME certificate generation required for domains [\\\"local.jovyan.org\\\"].\" providerName=default.acme\r\ntime=\"2020-07-11T15:38:14Z\" level=debug msg=\"Looking for provided certificate(s) to validate [\\\"local.jovyan.org\\\"]...\" providerName=default.acme\r\ntime=\"2020-07-11T15:38:14Z\" level=debug msg=\"No ACME certificate generation required for domains [\\\"local.jovyan.org\\\"].\" providerName=default.acme\r\ntime=\"2020-07-11T15:38:14Z\" level=debug msg=\"Building ACME client...\" providerName=default.acme\r\ntime=\"2020-07-11T15:38:14Z\" level=debug msg=\"https://pebble/dir\" providerName=default.acme\r\ntime=\"2020-07-11T15:38:14Z\" level=info msg=Register... providerName=default.acme\r\ntime=\"2020-07-11T15:38:14Z\" level=debug msg=\"legolog: [INFO] acme: Registering account for jovyan@jupyter.test\"\r\ntime=\"2020-07-11T15:38:14Z\" level=debug msg=\"Using HTTP Challenge provider.\" providerName=default.acme\r\ntime=\"2020-07-11T15:38:14Z\" level=debug msg=\"legolog: [INFO] [local.jovyan.org] acme: Obtaining bundled SAN certificate\"\r\ntime=\"2020-07-11T15:38:14Z\" level=debug msg=\"legolog: [INFO] [local.jovyan.org] AuthURL: https://pebble/authZ/zsuK3S6ILfNn81Rp0_rLoa_6bH_v2lJFbJk1BhI9nsQ\"\r\ntime=\"2020-07-11T15:38:14Z\" level=debug msg=\"legolog: [INFO] [local.jovyan.org] acme: Could not find solver for: tls-alpn-01\"\r\ntime=\"2020-07-11T15:38:14Z\" level=debug msg=\"legolog: [INFO] [local.jovyan.org] acme: use http-01 solver\"\r\ntime=\"2020-07-11T15:38:14Z\" level=debug msg=\"legolog: [INFO] [local.jovyan.org] acme: Trying to solve HTTP-01\"\r\ntime=\"2020-07-11T15:38:14Z\" level=debug msg=\"Retrieving the ACME challenge for token TXX7NTF6SY6CA1-O_ex3Wm7lIpa4hNPcDB_ngQbibGk...\" providerName=default.acme\r\ntime=\"2020-07-11T15:38:14Z\" level=debug msg=\"Retrieving the ACME challenge for token TXX7NTF6SY6CA1-O_ex3Wm7lIpa4hNPcDB_ngQbibGk...\" providerName=default.acme\r\ntime=\"2020-07-11T15:38:14Z\" level=debug msg=\"Retrieving the ACME challenge for token TXX7NTF6SY6CA1-O_ex3Wm7lIpa4hNPcDB_ngQbibGk...\" providerName=default.acme\r\ntime=\"2020-07-11T15:38:14Z\" level=debug msg=\"legolog: [INFO] [local.jovyan.org] The server validated our request\"\r\ntime=\"2020-07-11T15:38:14Z\" level=debug msg=\"legolog: [INFO] [local.jovyan.org] acme: Validations succeeded; requesting certificates\"\r\ntime=\"2020-07-11T15:38:17Z\" level=debug msg=\"legolog: [INFO] Wait for certificate [timeout: 30s, interval: 500ms]\"\r\ntime=\"2020-07-11T15:38:17Z\" level=debug msg=\"legolog: [INFO] [local.jovyan.org] Server responded with a certificate.\"\r\ntime=\"2020-07-11T15:38:17Z\" level=debug msg=\"Certificates obtained for domains [local.jovyan.org]\" providerName=default.acme\r\ntime=\"2020-07-11T15:38:17Z\" level=debug msg=\"Configuration received from provider default.acme: {\\\"http\\\":{},\\\"tls\\\":{}}\" providerName=default.acme\r\ntime=\"2020-07-11T15:38:17Z\" level=debug msg=\"Adding certificate for domain(s) local.jovyan.org\"\r\ntime=\"2020-07-11T15:38:17Z\" level=debug msg=\"No default certificate, generating one\"\r\ntime=\"2020-07-11T15:38:17Z\" level=debug msg=\"Creating middleware\" entryPointName=http routerName=insecure@file serviceName=default middlewareName=pipelining middlewareType=Pipelining\r\ntime=\"2020-07-11T15:38:17Z\" level=debug msg=\"Creating load-balancer\" routerName=insecure@file serviceName=default entryPointName=http\r\ntime=\"2020-07-11T15:38:17Z\" level=debug msg=\"Creating server 0 http://proxy-http:8000/\" routerName=insecure@file serviceName=default serverName=0 entryPointName=http\r\ntime=\"2020-07-11T15:38:17Z\" level=debug msg=\"Added outgoing tracing middleware default\" entryPointName=http routerName=insecure@file middlewareName=tracing middlewareType=TracingForwarder\r\ntime=\"2020-07-11T15:38:17Z\" level=debug msg=\"Creating middleware\" routerName=insecure@file middlewareName=redirect@file middlewareType=RedirectScheme entryPointName=http\r\ntime=\"2020-07-11T15:38:17Z\" level=debug msg=\"Setting up redirection to https \" entryPointName=http routerName=insecure@file middlewareName=redirect@file middlewareType=RedirectScheme\r\ntime=\"2020-07-11T15:38:17Z\" level=debug msg=\"Adding tracing to middleware\" entryPointName=http routerName=insecure@file middlewareName=redirect@file\r\ntime=\"2020-07-11T15:38:17Z\" level=debug msg=\"Creating middleware\" middlewareType=Recovery entryPointName=http middlewareName=traefik-internal-recovery\r\ntime=\"2020-07-11T15:38:17Z\" level=debug msg=\"Creating middleware\" entryPointName=https middlewareName=traefik-internal-recovery middlewareType=Recovery\r\ntime=\"2020-07-11T15:38:17Z\" level=debug msg=\"Creating Middleware (ResponseModifier)\" middlewareName=hsts@file middlewareType=Headers entryPointName=http routerName=default@file\r\ntime=\"2020-07-11T15:38:17Z\" level=debug msg=\"Creating Middleware (ResponseModifier)\" middlewareName=scheme@file middlewareType=Headers routerName=default@file entryPointName=http\r\ntime=\"2020-07-11T15:38:17Z\" level=debug msg=\"Creating middleware\" routerName=default@file serviceName=default middlewareName=pipelining middlewareType=Pipelining entryPointName=http\r\ntime=\"2020-07-11T15:38:17Z\" level=debug msg=\"Creating load-balancer\" entryPointName=http routerName=default@file serviceName=default\r\ntime=\"2020-07-11T15:38:17Z\" level=debug msg=\"Creating server 0 http://proxy-http:8000/\" routerName=default@file serviceName=default serverName=0 entryPointName=http\r\ntime=\"2020-07-11T15:38:17Z\" level=debug msg=\"Added outgoing tracing middleware default\" middlewareType=TracingForwarder entryPointName=http routerName=default@file middlewareName=tracing\r\ntime=\"2020-07-11T15:38:17Z\" level=debug msg=\"Creating middleware\" routerName=default@file entryPointName=http middlewareName=scheme@file middlewareType=Headers\r\ntime=\"2020-07-11T15:38:17Z\" level=debug msg=\"Setting up customHeaders/Cors from {map[X-Scheme:https] map[] false [] []  [] [] 0 false [] [] false false  map[] false 0 false false false false  false false      false}\" middlewareType=Headers routerName=default@file entryPointName=http middlewareName=scheme@file\r\ntime=\"2020-07-11T15:38:17Z\" level=debug msg=\"Adding tracing to middleware\" entryPointName=http routerName=default@file middlewareName=scheme@file\r\ntime=\"2020-07-11T15:38:17Z\" level=debug msg=\"Creating middleware\" routerName=default@file middlewareName=hsts@file middlewareType=Headers entryPointName=http\r\ntime=\"2020-07-11T15:38:17Z\" level=debug msg=\"Setting up secureHeaders from {map[] map[] false [] []  [] [] 0 false [] [] false false  map[] false 15724800 false false false false  false false      false}\" middlewareName=hsts@file middlewareType=Headers entryPointName=http routerName=default@file\r\ntime=\"2020-07-11T15:38:17Z\" level=debug msg=\"Adding tracing to middleware\" routerName=default@file middlewareName=hsts@file entryPointName=http\r\ntime=\"2020-07-11T15:38:17Z\" level=debug msg=\"Creating middleware\" middlewareType=Recovery entryPointName=http middlewareName=traefik-internal-recovery\r\ntime=\"2020-07-11T15:38:17Z\" level=debug msg=\"Creating middleware\" middlewareName=traefik-internal-recovery middlewareType=Recovery entryPointName=https\r\ntime=\"2020-07-11T15:38:17Z\" level=debug msg=\"Looking for provided certificate(s) to validate [\\\"local.jovyan.org\\\"]...\" providerName=default.acme\r\ntime=\"2020-07-11T15:38:17Z\" level=debug msg=\"No ACME certificate generation required for domains [\\\"local.jovyan.org\\\"].\" providerName=default.acme\r\n```\r\n\r\n## Pebble logs (success)\r\n\r\n```\r\nPebble 2020/07/11 15:37:03 Starting Pebble ACME server\r\nPebble 2020/07/11 15:37:04 Generated new root issuer with serial 532dec3ca6feca04 and SKI 06668556fb5a81ab7434ae1f5f28ec76151b7cc7\r\nPebble 2020/07/11 15:37:04 Generated new intermediate issuer with serial 1f58baa2d44b2f05 and SKI b091d40bdd5d3891a66d7bc7ae40174c3f0ec0fb\r\nPebble 2020/07/11 15:37:04 Using custom DNS resolver for ACME challenges: 10.43.251.95:53\r\nPebble 2020/07/11 15:37:04 Disabling random VA sleeps\r\nPebble 2020/07/11 15:37:04 Configured to reject 0% of good nonces\r\nPebble 2020/07/11 15:37:04 Configured to attempt authz reuse for each identifier 0% of the time\r\nPebble 2020/07/11 15:37:04 Configured to show 3 orders per page\r\nPebble 2020/07/11 15:37:04 Management interface listening on: :8444\r\nPebble 2020/07/11 15:37:04 Root CA certificate available at: https://:8444/roots/0\r\nPebble 2020/07/11 15:37:04 Listening on: :8443\r\nPebble 2020/07/11 15:37:04 ACME directory available at: https://:8443/dir\r\nPebble 2020/07/11 15:38:14 GET /dir -> calling handler()\r\nPebble 2020/07/11 15:38:14 HEAD /nonce-plz -> calling handler()\r\nPebble 2020/07/11 15:38:14 POST /sign-me-up -> calling handler()\r\nPebble 2020/07/11 15:38:14 There are now 1 accounts in memory\r\nPebble 2020/07/11 15:38:14 POST /order-plz -> calling handler()\r\nPebble 2020/07/11 15:38:14 There are now 1 authorizations in the db\r\nPebble 2020/07/11 15:38:14 Added order \"xRTU2IMZBO0UadnjJ2Kb-1dSTilr_sB38ZZhvs4XAyU\" to the db\r\nPebble 2020/07/11 15:38:14 There are now 1 orders in the db\r\nPebble 2020/07/11 15:38:14 POST /authZ/ -> calling handler()\r\nPebble 2020/07/11 15:38:14 POST /chalZ/ -> calling handler()\r\nPebble 2020/07/11 15:38:14 Pulled a task from the Tasks queue: &va.vaTask{Identifier:acme.Identifier{Type:\"dns\", Value:\"local.jovyan.org\"}, Challenge:(*core.Challenge)(0xc000093680), Account:(*core.Account)(0xc000060420)}\r\nPebble 2020/07/11 15:38:14 Starting 3 validations.\r\nPebble 2020/07/11 15:38:14 Attempting to validate w/ HTTP: http://local.jovyan.org:80/.well-known/acme-challenge/TXX7NTF6SY6CA1-O_ex3Wm7lIpa4hNPcDB_ngQbibGk\r\nPebble 2020/07/11 15:38:14 Attempting to validate w/ HTTP: http://local.jovyan.org:80/.well-known/acme-challenge/TXX7NTF6SY6CA1-O_ex3Wm7lIpa4hNPcDB_ngQbibGk\r\nPebble 2020/07/11 15:38:14 Attempting to validate w/ HTTP: http://local.jovyan.org:80/.well-known/acme-challenge/TXX7NTF6SY6CA1-O_ex3Wm7lIpa4hNPcDB_ngQbibGk\r\nPebble 2020/07/11 15:38:14 authz zsuK3S6ILfNn81Rp0_rLoa_6bH_v2lJFbJk1BhI9nsQ set VALID by completed challenge _V3HTgAzRJaSjXMnWbJS2la7137wArSpKAauLA5JRxg\r\nPebble 2020/07/11 15:38:14 POST /authZ/ -> calling handler()\r\nPebble 2020/07/11 15:38:17 POST /finalize-order/ -> calling handler()\r\nPebble 2020/07/11 15:38:17 Order xRTU2IMZBO0UadnjJ2Kb-1dSTilr_sB38ZZhvs4XAyU is fully authorized. Processing finalization\r\nPebble 2020/07/11 15:38:17 Issued certificate serial 1728c92763b2689d for order xRTU2IMZBO0UadnjJ2Kb-1dSTilr_sB38ZZhvs4XAyU\r\nPebble 2020/07/11 15:38:17 POST /my-order/ -> calling handler()\r\nPebble 2020/07/11 15:38:17 POST /certZ/ -> calling handler()\r\n```", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1716/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1716/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1707", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1707/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1707/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1707/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1707", "id": 649904318, "node_id": "MDU6SXNzdWU2NDk5MDQzMTg=", "number": 1707, "title": "HTTP probe failed with 0.9.0 version", "user": {"login": "mbalduini", "id": 4280101, "node_id": "MDQ6VXNlcjQyODAxMDE=", "avatar_url": "https://avatars.githubusercontent.com/u/4280101?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mbalduini", "html_url": "https://github.com/mbalduini", "followers_url": "https://api.github.com/users/mbalduini/followers", "following_url": "https://api.github.com/users/mbalduini/following{/other_user}", "gists_url": "https://api.github.com/users/mbalduini/gists{/gist_id}", "starred_url": "https://api.github.com/users/mbalduini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mbalduini/subscriptions", "organizations_url": "https://api.github.com/users/mbalduini/orgs", "repos_url": "https://api.github.com/users/mbalduini/repos", "events_url": "https://api.github.com/users/mbalduini/events{/privacy}", "received_events_url": "https://api.github.com/users/mbalduini/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-07-02T12:48:01Z", "updated_at": "2020-08-26T07:53:16Z", "closed_at": "2020-08-26T07:53:16Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML commments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\nThe installation of the jupyterhub version 0.9.0 successfully ended, but the hub pod results `running` but not `ready`.\r\nAs you can see from the pod description below, the problem is `Readiness probe failed: HTTP probe failed with statuscode: 404`.\r\n\r\n```\r\nName:           hub-75c958fc98-wvvnj\r\nNamespace:      jhubt\r\nPriority:       0\r\nNode:           ip-172-20-119-190.eu-west-1.compute.internal/172.20.119.190\r\nStart Time:     Thu, 02 Jul 2020 12:32:00 +0000\r\nLabels:         app=jupyterhub\r\n                component=hub\r\n                hub.jupyter.org/network-access-proxy-api=true\r\n                hub.jupyter.org/network-access-proxy-http=true\r\n                hub.jupyter.org/network-access-singleuser=true\r\n                pod-template-hash=75c958fc98\r\n                release=jhubt\r\nAnnotations:    checksum/config-map: e56bc18260532e54c31f0783aaafc3c1a18c5f26f4d9ef0d03aa358062b12902\r\n                checksum/secret: 24278f774ebcdd491d91205c013884f04ce5af859fa4dc54132e148123b5acfe\r\nStatus:         Running\r\nIP:             100.120.0.9\r\nIPs:            <none>\r\nControlled By:  ReplicaSet/hub-75c958fc98\r\nContainers:\r\n  hub:\r\n    Container ID:  docker://61ebab69eae15e44f236d414e6d7e2d9f650b00db5fd4bc005c5c60c851f4c10\r\n    Image:         jupyterhub/k8s-hub:0.9.0\r\n    Image ID:      docker-pullable://jupyterhub/k8s-hub@sha256:ec78bdae0fed0c49474950a1fe4fec3b00448599d4a35e51a93b10a7f342846b\r\n    Port:          8081/TCP\r\n    Host Port:     0/TCP\r\n    Command:\r\n      jupyterhub\r\n      --config\r\n      /etc/jupyterhub/jupyterhub_config.py\r\n      --upgrade-db\r\n    State:          Running\r\n      Started:      Thu, 02 Jul 2020 12:32:23 +0000\r\n    Ready:          False\r\n    Restart Count:  0\r\n    Requests:\r\n      cpu:      200m\r\n      memory:   512Mi\r\n    Readiness:  http-get http://:hub/hub/health delay=0s timeout=1s period=10s #success=1 #failure=3\r\n    Environment:\r\n      PYTHONUNBUFFERED:        1\r\n      HELM_RELEASE_NAME:       jhubt\r\n      POD_NAMESPACE:           jhubt (v1:metadata.namespace)\r\n      CONFIGPROXY_AUTH_TOKEN:  <set to the key 'proxy.token' in secret 'hub-secret'>  Optional: false\r\n    Mounts:\r\n      /etc/jupyterhub/config/ from config (rw)\r\n      /etc/jupyterhub/cull_idle_servers.py from config (rw,path=\"cull_idle_servers.py\")\r\n      /etc/jupyterhub/jupyterhub_config.py from config (rw,path=\"jupyterhub_config.py\")\r\n      /etc/jupyterhub/secret/ from secret (rw)\r\n      /etc/jupyterhub/z2jh.py from config (rw,path=\"z2jh.py\")\r\n      /srv/jupyterhub from hub-db-dir (rw)\r\n      /var/run/secrets/kubernetes.io/serviceaccount from hub-token-kt88q (ro)\r\nConditions:\r\n  Type              Status\r\n  Initialized       True \r\n  Ready             False \r\n  ContainersReady   False \r\n  PodScheduled      True \r\nVolumes:\r\n  config:\r\n    Type:      ConfigMap (a volume populated by a ConfigMap)\r\n    Name:      hub-config\r\n    Optional:  false\r\n  secret:\r\n    Type:        Secret (a volume populated by a Secret)\r\n    SecretName:  hub-secret\r\n    Optional:    false\r\n  hub-db-dir:\r\n    Type:       PersistentVolumeClaim (a reference to a PersistentVolumeClaim in the same namespace)\r\n    ClaimName:  hub-db-dir\r\n    ReadOnly:   false\r\n  hub-token-kt88q:\r\n    Type:        Secret (a volume populated by a Secret)\r\n    SecretName:  hub-token-kt88q\r\n    Optional:    false\r\nQoS Class:       Burstable\r\nNode-Selectors:  <none>\r\nTolerations:     node.kubernetes.io/not-ready:NoExecute for 300s\r\n                 node.kubernetes.io/unreachable:NoExecute for 300s\r\nEvents:\r\n  Type     Reason                  Age                     From                                                   Message\r\n  ----     ------                  ----                    ----                                                   -------\r\n  Warning  FailedScheduling        9m6s (x4 over 9m10s)    default-scheduler                                      pod has unbound immediate PersistentVolumeClaims\r\n  Normal   Scheduled               9m1s                    default-scheduler                                      Successfully assigned jhubt/hub-75c958fc98-wvvnj to ip-172-20-119-190.eu-west-1.compute.internal\r\n  Normal   SuccessfulAttachVolume  8m59s                   attachdetach-controller                                AttachVolume.Attach succeeded for volume \"pvc-e9576486-b52b-4dac-9a21-754233f56f25\"\r\n  Normal   Pulling                 8m55s                   kubelet, ip-172-20-119-190.eu-west-1.compute.internal  Pulling image \"jupyterhub/k8s-hub:0.9.0\"\r\n  Normal   Pulled                  8m39s                   kubelet, ip-172-20-119-190.eu-west-1.compute.internal  Successfully pulled image \"jupyterhub/k8s-hub:0.9.0\"\r\n  Normal   Created                 8m38s                   kubelet, ip-172-20-119-190.eu-west-1.compute.internal  Created container hub\r\n  Normal   Started                 8m38s                   kubelet, ip-172-20-119-190.eu-west-1.compute.internal  Started container hub\r\n  Warning  Unhealthy               3m45s (x30 over 8m35s)  kubelet, ip-172-20-119-190.eu-west-1.compute.internal  Readiness probe failed: HTTP probe failed with statuscode: 404\r\n```\r\n\r\n#### Expected behaviour\r\nI expect to be able to access the hub using the the public IP (or aws ELB) listed as a service\r\n\r\n#### Actual behaviour\r\nThe hub pod is running but keep remaining not accessible (not ready)\r\n\r\n### Your personal set up\r\n\r\nI'm working on AWS and using kops to control the cluster\r\n\r\n - OS:\r\nUbuntu 18.04\r\n - Version:\r\n\r\nk8s:\r\n```\r\nClient Version: version.Info{Major:\"1\", Minor:\"18\", GitVersion:\"v1.18.5\", GitCommit:\"e6503f8d8f769ace2f338794c914a96fc335df0f\", GitTreeState:\"clean\", BuildDate:\"2020-06-26T03:47:41Z\", GoVersion:\"go1.13.9\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n\r\nServer Version: version.Info{Major:\"1\", Minor:\"15\", GitVersion:\"v1.15.12\", GitCommit:\"e2a822d9f3c2fdb5c9bfbe64313cf9f657f0a725\", GitTreeState:\"clean\", BuildDate:\"2020-05-06T05:09:48Z\", GoVersion:\"go1.12.17\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n```\r\nHelm\r\n```\r\nClient: &version.Version{SemVer:\"v2.16.9\", GitCommit:\"8ad7037828e5a0fca1009dabe290130da6368e39\", GitTreeState:\"clean\"}\r\n\r\nServer: &version.Version{SemVer:\"v2.16.9\", GitCommit:\"8ad7037828e5a0fca1009dabe290130da6368e39\", GitTreeState:\"clean\"}\r\n```\r\nhelm chart  0.9.0\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1707/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1707/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1700", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1700/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1700/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1700/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1700", "id": 645934568, "node_id": "MDU6SXNzdWU2NDU5MzQ1Njg=", "number": 1700, "title": "Admin access to users server lead to 403 (workaround exist)", "user": {"login": "0nebody", "id": 26727168, "node_id": "MDQ6VXNlcjI2NzI3MTY4", "avatar_url": "https://avatars.githubusercontent.com/u/26727168?v=4", "gravatar_id": "", "url": "https://api.github.com/users/0nebody", "html_url": "https://github.com/0nebody", "followers_url": "https://api.github.com/users/0nebody/followers", "following_url": "https://api.github.com/users/0nebody/following{/other_user}", "gists_url": "https://api.github.com/users/0nebody/gists{/gist_id}", "starred_url": "https://api.github.com/users/0nebody/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/0nebody/subscriptions", "organizations_url": "https://api.github.com/users/0nebody/orgs", "repos_url": "https://api.github.com/users/0nebody/repos", "events_url": "https://api.github.com/users/0nebody/events{/privacy}", "received_events_url": "https://api.github.com/users/0nebody/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2020-06-26T00:52:07Z", "updated_at": "2021-01-16T08:21:55Z", "closed_at": "2021-01-16T08:21:47Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\nAs an admin when I attempt to access another users notebook I receive a 403 error.\r\n\r\n#### Expected behaviour\r\nI expect to be able to access the users notebook.\r\n\r\n#### Actual behaviour\r\nI am redirected to a 403 page.\r\n\r\n### How to reproduce\r\n1. Go to admin.\r\n2. Click on access server for another user.\r\n3. See error\r\n\r\n### Your personal set up\r\nThis occurs when when proxy.https.type is set to offload and a load balancer is responsible for SSL termination.\r\n\r\n```\r\n[E 2020-06-26 00:19:01.177 JupyterHub auth:280] OAuth POST from https://domain.com/hub/api/oauth2/authorize?client_id=jupyterhub-user-test&redirect_uri=%2Fuser%2Ftest%2Foauth_callback&response_type=code&state=asdf != http://domain.com/hub/api/oauth2/authorize?client_id=jupyterhub-user-test&redirect_uri=%2Fuser%2Ftest%2Foauth_callback&response_type=code&state=asdf\r\n[W 2020-06-26 00:19:01.178 JupyterHub web:1786] 403 POST /hub/api/oauth2/authorize?client_id=jupyterhub-user-test&redirect_uri=%2Fuser%2Ftest%2Foauth_callback&response_type=code&state=asdf (10.23.101.226): Authorization form must be sent from authorization page\r\n```\r\nThe headers sent from the proxy to the container are:\r\n```\r\nx-forwarded-port=443,80\r\nx-forwarded-proto=https,http\r\n```\r\nWhen HTTPS is offloaded the proxy should not attempt to add x-forward headers. Adding `--no-x-forward` flag to the proxy fixes the issue.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1700/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1700/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1699", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1699/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1699/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1699/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1699", "id": 645146530, "node_id": "MDExOlB1bGxSZXF1ZXN0NDM5NjU4MTY4", "number": 1699, "title": "Enable the user scheduler to pay attention to CSI volume count", "user": {"login": "rschroll", "id": 367903, "node_id": "MDQ6VXNlcjM2NzkwMw==", "avatar_url": "https://avatars.githubusercontent.com/u/367903?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rschroll", "html_url": "https://github.com/rschroll", "followers_url": "https://api.github.com/users/rschroll/followers", "following_url": "https://api.github.com/users/rschroll/following{/other_user}", "gists_url": "https://api.github.com/users/rschroll/gists{/gist_id}", "starred_url": "https://api.github.com/users/rschroll/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rschroll/subscriptions", "organizations_url": "https://api.github.com/users/rschroll/orgs", "repos_url": "https://api.github.com/users/rschroll/repos", "events_url": "https://api.github.com/users/rschroll/events{/privacy}", "received_events_url": "https://api.github.com/users/rschroll/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-06-25T04:44:34Z", "updated_at": "2020-10-04T06:04:51Z", "closed_at": "2020-08-25T09:14:21Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/1699", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1699", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1699.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1699.patch", "merged_at": "2020-08-25T09:14:20Z"}, "body": "I've been getting the 0.9.0 chart running on an autoscaling cluster on Digital Ocean.  Most things are working, but it would try to schedule more than seven pods with volumes on a given node.  (Digital Ocean has a relatively low limit of 7 on this.)  This only happened when using the userScheduler; if that was disabled, the limits were respected.\r\n\r\nDigital Ocean support pointed out that the scheduler did not have the \"MaxCSIVolumeCountPred\" predicate, which they use to count the attached volumes.  This appears to be a more general predicate, which will replace the provider specific ones we currently have. (See [here](https://github.com/mjaow/kubernetes/blob/master/pkg/scheduler/algorithm/predicates/predicates.go#L61).)\r\n\r\nI could only get this to work with an updated version of the kube-scheduler image.  I don't know what was going wrong with the current version, and I also don't know if it needs to be updated this far.  If we're worried about upgrading this far, I can check some of the previous versions and report back.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1699/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 1, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1699/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1698", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1698/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1698/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1698/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1698", "id": 641928999, "node_id": "MDU6SXNzdWU2NDE5Mjg5OTk=", "number": 1698, "title": "Readiness Probe Failed", "user": {"login": "ghost", "id": 10137, "node_id": "MDQ6VXNlcjEwMTM3", "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghost", "html_url": "https://github.com/ghost", "followers_url": "https://api.github.com/users/ghost/followers", "following_url": "https://api.github.com/users/ghost/following{/other_user}", "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghost/subscriptions", "organizations_url": "https://api.github.com/users/ghost/orgs", "repos_url": "https://api.github.com/users/ghost/repos", "events_url": "https://api.github.com/users/ghost/events{/privacy}", "received_events_url": "https://api.github.com/users/ghost/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-06-19T12:18:46Z", "updated_at": "2022-04-05T22:13:49Z", "closed_at": "2020-06-24T14:22:07Z", "author_association": "NONE", "active_lock_reason": null, "body": "I installed the `jupyter hub helm chart` using helm 3 and ran into the following problem with one of the hub pod not being able to run because of a connection refused on port 8081.\r\nPlease help me resolve this issue. \r\n```\r\nName:         hub-584dbdbbc7-vmw5n\r\nNamespace:    jhub\r\nPriority:     0\r\nNode:         192.168.1.108/192.168.1.108\r\nStart Time:   Fri, 19 Jun 2020 05:02:47 -0700\r\nLabels:       app=jupyterhub\r\n              component=hub\r\n              hub.jupyter.org/network-access-proxy-api=true\r\n              hub.jupyter.org/network-access-proxy-http=true\r\n              hub.jupyter.org/network-access-singleuser=true\r\n              pod-template-hash=584dbdbbc7\r\n              release=jhub\r\nAnnotations:  checksum/config-map: 555b4a2661cca23664372c280f1833d38933dafe649cde5a8b3cc73afb573c64\r\n              checksum/secret: 830bc1d7eb23e0cab10152d72832cb02c52e8cdf9023804a78ac1382eb171ad8\r\nStatus:       Running\r\nIP:           10.1.88.20\r\nIPs:\r\n  IP:           10.1.88.20\r\nControlled By:  ReplicaSet/hub-584dbdbbc7\r\nContainers:\r\n  hub:\r\n    Container ID:  containerd://e5bcc3dce1da0b107d9fd6bddead99346ee15abf7cd81c946e94d66c1e6e6a09\r\n    Image:         jupyterhub/k8s-hub:0.9.0\r\n    Image ID:      docker.io/jupyterhub/k8s-hub@sha256:ec78bdae0fed0c49474950a1fe4fec3b00448599d4a35e51a93b10a7f342846b\r\n    Port:          8081/TCP\r\n    Host Port:     0/TCP\r\n    Command:\r\n      jupyterhub\r\n      --config\r\n      /etc/jupyterhub/jupyterhub_config.py\r\n      --upgrade-db\r\n    State:          Terminated\r\n      Reason:       Error\r\n      Exit Code:    1\r\n      Started:      Fri, 19 Jun 2020 05:06:08 -0700\r\n      Finished:     Fri, 19 Jun 2020 05:06:09 -0700\r\n    Last State:     Terminated\r\n      Reason:       Error\r\n      Exit Code:    1\r\n      Started:      Fri, 19 Jun 2020 05:05:24 -0700\r\n      Finished:     Fri, 19 Jun 2020 05:05:25 -0700\r\n    Ready:          False\r\n    Restart Count:  4\r\n    Requests:\r\n      cpu:      200m\r\n      memory:   512Mi\r\n    Readiness:  http-get http://:hub/hub/health delay=0s timeout=1s period=10s #success=1 #failure=3\r\n    Environment:\r\n      PYTHONUNBUFFERED:        1\r\n      HELM_RELEASE_NAME:       jhub\r\n      POD_NAMESPACE:           jhub (v1:metadata.namespace)\r\n      CONFIGPROXY_AUTH_TOKEN:  <set to the key 'proxy.token' in secret 'hub-secret'>  Optional: false\r\n    Mounts:\r\n      /etc/jupyterhub/config/ from config (rw)\r\n      /etc/jupyterhub/cull_idle_servers.py from config (rw,path=\"cull_idle_servers.py\")\r\n      /etc/jupyterhub/jupyterhub_config.py from config (rw,path=\"jupyterhub_config.py\")\r\n      /etc/jupyterhub/secret/ from secret (rw)\r\n      /etc/jupyterhub/z2jh.py from config (rw,path=\"z2jh.py\")\r\n      /srv/jupyterhub from hub-db-dir (rw)\r\n      /var/run/secrets/kubernetes.io/serviceaccount from hub-token-76nj9 (ro)\r\nConditions:\r\n  Type              Status\r\n  Initialized       True \r\n  Ready             False \r\n  ContainersReady   False \r\n  PodScheduled      True \r\nVolumes:\r\n  config:\r\n    Type:      ConfigMap (a volume populated by a ConfigMap)\r\n    Name:      hub-config\r\n    Optional:  false\r\n  secret:\r\n    Type:        Secret (a volume populated by a Secret)\r\n    SecretName:  hub-secret\r\n    Optional:    false\r\n  hub-db-dir:\r\n    Type:       PersistentVolumeClaim (a reference to a PersistentVolumeClaim in the same namespace)\r\n    ClaimName:  hub-db-dir\r\n    ReadOnly:   false\r\n  hub-token-76nj9:\r\n    Type:        Secret (a volume populated by a Secret)\r\n    SecretName:  hub-token-76nj9\r\n    Optional:    false\r\nQoS Class:       Burstable\r\nNode-Selectors:  <none>\r\nTolerations:     node.kubernetes.io/not-ready:NoExecute for 300s\r\n                 node.kubernetes.io/unreachable:NoExecute for 300s\r\nEvents:\r\n  Type     Reason     Age                From                    Message\r\n  ----     ------     ----               ----                    -------\r\n  Normal   Scheduled  <unknown>          default-scheduler       Successfully assigned jhub/hub-584dbdbbc7-vmw5n to 192.168.1.108\r\n  Normal   Pulling    3m29s              kubelet, 192.168.1.108  Pulling image \"jupyterhub/k8s-hub:0.9.0\"\r\n  Normal   Pulled     99s                kubelet, 192.168.1.108  Successfully pulled image \"jupyterhub/k8s-hub:0.9.0\"\r\n  Warning  Unhealthy  52s                kubelet, 192.168.1.108  Readiness probe failed: Get \"http://10.1.88.20:8081/hub/health\": dial tcp 10.1.88.20:8081: connect: connection refused\r\n  Warning  BackOff    24s (x8 over 95s)  kubelet, 192.168.1.108  Back-off restarting failed container\r\n  Normal   Created    9s (x5 over 99s)   kubelet, 192.168.1.108  Created container hub\r\n  Normal   Started    9s (x5 over 98s)   kubelet, 192.168.1.108  Started container hub\r\n  Normal   Pulled     9s (x4 over 97s)   kubelet, 192.168.1.108  Container image \"jupyterhub/k8s-hub:0.9.0\" already present on machine\r\n(base) vinhdiesal@vinhdiesal-kvnet:~/.helm/jupyter hub$ microk8s kubectl -n jhub describe pod hub-584dbdbbc7-vmw5n \r\nName:         hub-584dbdbbc7-vmw5n\r\nNamespace:    jhub\r\nPriority:     0\r\nNode:         192.168.1.108/192.168.1.108\r\nStart Time:   Fri, 19 Jun 2020 05:02:47 -0700\r\nLabels:       app=jupyterhub\r\n              component=hub\r\n              hub.jupyter.org/network-access-proxy-api=true\r\n              hub.jupyter.org/network-access-proxy-http=true\r\n              hub.jupyter.org/network-access-singleuser=true\r\n              pod-template-hash=584dbdbbc7\r\n              release=jhub\r\nAnnotations:  checksum/config-map: 555b4a2661cca23664372c280f1833d38933dafe649cde5a8b3cc73afb573c64\r\n              checksum/secret: 830bc1d7eb23e0cab10152d72832cb02c52e8cdf9023804a78ac1382eb171ad8\r\nStatus:       Running\r\nIP:           10.1.88.20\r\nIPs:\r\n  IP:           10.1.88.20\r\nControlled By:  ReplicaSet/hub-584dbdbbc7\r\nContainers:\r\n  hub:\r\n    Container ID:  containerd://e7c8b095bac0c791c27990769e5554d99e41d52c6088ff2fb4c37802e88d1a57\r\n    Image:         jupyterhub/k8s-hub:0.9.0\r\n    Image ID:      docker.io/jupyterhub/k8s-hub@sha256:ec78bdae0fed0c49474950a1fe4fec3b00448599d4a35e51a93b10a7f342846b\r\n    Port:          8081/TCP\r\n    Host Port:     0/TCP\r\n    Command:\r\n      jupyterhub\r\n      --config\r\n      /etc/jupyterhub/jupyterhub_config.py\r\n      --upgrade-db\r\n    State:          Waiting\r\n      Reason:       CrashLoopBackOff\r\n    Last State:     Terminated\r\n      Reason:       Error\r\n      Exit Code:    1\r\n      Started:      Fri, 19 Jun 2020 05:07:39 -0700\r\n      Finished:     Fri, 19 Jun 2020 05:07:40 -0700\r\n    Ready:          False\r\n    Restart Count:  5\r\n    Requests:\r\n      cpu:      200m\r\n      memory:   512Mi\r\n    Readiness:  http-get http://:hub/hub/health delay=0s timeout=1s period=10s #success=1 #failure=3\r\n    Environment:\r\n      PYTHONUNBUFFERED:        1\r\n      HELM_RELEASE_NAME:       jhub\r\n      POD_NAMESPACE:           jhub (v1:metadata.namespace)\r\n      CONFIGPROXY_AUTH_TOKEN:  <set to the key 'proxy.token' in secret 'hub-secret'>  Optional: false\r\n    Mounts:\r\n      /etc/jupyterhub/config/ from config (rw)\r\n      /etc/jupyterhub/cull_idle_servers.py from config (rw,path=\"cull_idle_servers.py\")\r\n      /etc/jupyterhub/jupyterhub_config.py from config (rw,path=\"jupyterhub_config.py\")\r\n      /etc/jupyterhub/secret/ from secret (rw)\r\n      /etc/jupyterhub/z2jh.py from config (rw,path=\"z2jh.py\")\r\n      /srv/jupyterhub from hub-db-dir (rw)\r\n      /var/run/secrets/kubernetes.io/serviceaccount from hub-token-76nj9 (ro)\r\nConditions:\r\n  Type              Status\r\n  Initialized       True \r\n  Ready             False \r\n  ContainersReady   False \r\n  PodScheduled      True \r\nVolumes:\r\n  config:\r\n    Type:      ConfigMap (a volume populated by a ConfigMap)\r\n    Name:      hub-config\r\n    Optional:  false\r\n  secret:\r\n    Type:        Secret (a volume populated by a Secret)\r\n    SecretName:  hub-secret\r\n    Optional:    false\r\n  hub-db-dir:\r\n    Type:       PersistentVolumeClaim (a reference to a PersistentVolumeClaim in the same namespace)\r\n    ClaimName:  hub-db-dir\r\n    ReadOnly:   false\r\n  hub-token-76nj9:\r\n    Type:        Secret (a volume populated by a Secret)\r\n    SecretName:  hub-token-76nj9\r\n    Optional:    false\r\nQoS Class:       Burstable\r\nNode-Selectors:  <none>\r\nTolerations:     node.kubernetes.io/not-ready:NoExecute for 300s\r\n                 node.kubernetes.io/unreachable:NoExecute for 300s\r\nEvents:\r\n  Type     Reason     Age                   From                    Message\r\n  ----     ------     ----                  ----                    -------\r\n  Normal   Scheduled  <unknown>             default-scheduler       Successfully assigned jhub/hub-584dbdbbc7-vmw5n to 192.168.1.108\r\n  Normal   Pulling    5m14s                 kubelet, 192.168.1.108  Pulling image \"jupyterhub/k8s-hub:0.9.0\"\r\n  Normal   Pulled     3m24s                 kubelet, 192.168.1.108  Successfully pulled image \"jupyterhub/k8s-hub:0.9.0\"\r\n  Warning  Unhealthy  2m37s                 kubelet, 192.168.1.108  Readiness probe failed: Get \"http://10.1.88.20:8081/hub/health\": dial tcp 10.1.88.20:8081: connect: connection refused\r\n  Normal   Created    114s (x5 over 3m24s)  kubelet, 192.168.1.108  Created container hub\r\n  Normal   Started    114s (x5 over 3m23s)  kubelet, 192.168.1.108  Started container hub\r\n  Normal   Pulled     114s (x4 over 3m22s)  kubelet, 192.168.1.108  Container image \"jupyterhub/k8s-hub:0.9.0\" already present on machine\r\n  Warning  BackOff    10s (x17 over 3m20s)  kubelet, 192.168.1.108  Back-off restarting failed container\r\n```", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1698/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1698/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1697", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1697/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1697/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1697/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1697", "id": 640408423, "node_id": "MDU6SXNzdWU2NDA0MDg0MjM=", "number": 1697, "title": "CI: linkcheck of our docs fails", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-06-17T12:37:55Z", "updated_at": "2020-07-05T16:31:41Z", "closed_at": "2020-07-05T16:31:41Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "### Bug description\r\nOur test fails [like this](https://travis-ci.org/github/jupyterhub/zero-to-jupyterhub-k8s/jobs/699287339), which is initialized as described in `.travis.yml` under `docs:linkcheck`.\r\n\r\n```\r\n/home/travis/build/jupyterhub/zero-to-jupyterhub-k8s/doc/source/customizing/user-environment.rst:4: WARNING: Duplicate explicit target name: \"jupyterlab\".\r\n```\r\n\r\n### How to reproduce\r\n\r\nI think something like this, but check `.travis.yml` for details on how it is done there.\r\n\r\n- Clone repo, enter the `doc/` folder.\r\n- Install doc-requirements.txt with pip.\r\n- `make linkcheck`", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1697/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1697/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1678", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1678/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1678/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1678/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1678", "id": 623503223, "node_id": "MDExOlB1bGxSZXF1ZXN0NDIyMTU5MzIy", "number": 1678, "title": "secret-sync: selective write to secret / functional logs", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 2398427860, "node_id": "MDU6TGFiZWwyMzk4NDI3ODYw", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/maintenance", "name": "maintenance", "color": "de9af4", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-05-22T22:21:51Z", "updated_at": "2020-10-04T06:02:34Z", "closed_at": "2020-06-03T12:01:43Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/1678", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1678", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1678.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1678.patch", "merged_at": "2020-06-03T12:01:43Z"}, "body": "While working to setup the test suite for HTTPS, this script became quite relevant and I learned some things.\r\n\r\n1. The logs didn't work, so I've tried learning about python logging and fixed it by adding `PYTHONBUFFERED=1` and I also print something on startup to provide a life sign, and added some logging statements here and there to help me grasp what was going on.\r\n2. Traefik, running in the autohttps pod, that runs secret-sync.py as a sidecar - often ended up writing content to the k8s secret that contained a partial state that was soon to be outdated. If the k8s secret was used to bootstrap a new autohttps pod, and the k8s secret contained such partial state that had been outdated, I was forced to manually delete the secret etc. To avoid this, we now only write to the k8s secret when we have acquired a certificate.\r\n3. SIGTERM signals that were passed by `kubectl delete` or `docker stop` wasn't making the script exit, but with `tini` it did. I also realized that `tini-static` was a `tini` binary that had some dependencies embedded into it, allowing it to run on the alpine distribution. This change actually made things quite a bit more robust, because without it, it was common to get two autohttps pods with an active secret-sync.py running, both writing content to the k8s secret. This was because one autohttps pod was in the terminating state, but it took 30 seconds for it to actually quick because that is when SIGKILL is sent, so the new pod that maybe acquired a certificate, would get the k8s secret overwritten by the old pod etc.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1678/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1678/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1670", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1670/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1670/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1670/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1670", "id": 619070236, "node_id": "MDExOlB1bGxSZXF1ZXN0NDE4NjY1NDc3", "number": 1670, "title": "Tighten and flesh out networkpolicies", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 580906361, "node_id": "MDU6TGFiZWw1ODA5MDYzNjE=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/enhancement", "name": "enhancement", "color": "84b6eb", "default": true, "description": null}, {"id": 2398426378, "node_id": "MDU6TGFiZWwyMzk4NDI2Mzc4", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/breaking", "name": "breaking", "color": "ad3727", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-05-15T15:45:11Z", "updated_at": "2020-10-17T17:39:44Z", "closed_at": "2020-05-16T10:47:20Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/1670", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1670", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1670.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1670.patch", "merged_at": "2020-05-16T10:47:20Z"}, "body": "If someone wanted to restrict the egress, they would previously need quite a bit of exceptions. With this setup, I hope to make them function even though the Helm chart user removes denies all not explicitly allowed egress by removing the explicit allowance of 0.0.0.0/0 (all IPv4 egress).\r\n\r\n---\r\n\r\n## UPDATE\r\nThis PR introduced a breaking change. All traffic towards the proxy pod, for example through the proxy-public service, must now be from pods labelled with `hub.jupyter.org/network-access-proxy-http: \"true\"` or from pods in a namespace labelled with `hub.jupyter.org/network-access-proxy-http: \"true\"`.\r\n\r\nThat this wasn't already the case, is considered a bug fix.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1670/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1670/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1551", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1551/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1551/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1551/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1551", "id": 553991308, "node_id": "MDU6SXNzdWU1NTM5OTEzMDg=", "number": 1551, "title": "GitLab OAuth require api scope in 0.9.0-beta.3, but didn't before", "user": {"login": "conet", "id": 11311763, "node_id": "MDQ6VXNlcjExMzExNzYz", "avatar_url": "https://avatars.githubusercontent.com/u/11311763?v=4", "gravatar_id": "", "url": "https://api.github.com/users/conet", "html_url": "https://github.com/conet", "followers_url": "https://api.github.com/users/conet/followers", "following_url": "https://api.github.com/users/conet/following{/other_user}", "gists_url": "https://api.github.com/users/conet/gists{/gist_id}", "starred_url": "https://api.github.com/users/conet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/conet/subscriptions", "organizations_url": "https://api.github.com/users/conet/orgs", "repos_url": "https://api.github.com/users/conet/repos", "events_url": "https://api.github.com/users/conet/events{/privacy}", "received_events_url": "https://api.github.com/users/conet/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 23, "created_at": "2020-01-23T07:44:22Z", "updated_at": "2020-10-07T18:10:38Z", "closed_at": "2020-10-07T18:10:38Z", "author_association": "NONE", "active_lock_reason": null, "body": "I was running the version `0.9-484ce8e` for a while now without problems and I thought it's time for an update, when I ran `0.9.0-beta.3` everything works properly for logged in users even the login works if it's not oauh, I have one instance where I have gitlab ouath defined but that fails on `0.9.0-beta.3` even though it works without issues on `0.9-484ce8e`.\r\nHere is the error log:\r\n\r\n```\r\n[I 2020-01-23 06:53:35.572 JupyterHub log:174] 200 GET /hub/login (@79.114.17.155) 28.34ms\r\n[I 2020-01-23 06:53:37.399 JupyterHub oauth2:100] OAuth redirect: 'https://jhub-host/hub/oauth_callback'\r\n[I 2020-01-23 06:53:37.400 JupyterHub log:174] 302 GET /hub/oauth_login?next= -> https://auth-host/oauth/authorize?response_type=code&redirect_uri=https%3A%2F%2Fjhub-host%2Fhub%2Foauth_callback&client_id=[secret]&state=[secret]&scope=read_user (@79.114.17.155) 1.98ms\r\n[E 2020-01-23 06:53:38.007 JupyterHub web:1788] Uncaught exception GET /hub/oauth_callback?code=[secret]&state=[secret] (79.114.17.155)\r\n    HTTPServerRequest(protocol='https', host='jhub-host', method='GET', uri='/hub/oauth_callback?code=[secret]&state=[secret]', version='HTTP/1.1', remote_ip='79.114.17.155')\r\n    Traceback (most recent call last):\r\n      File \"/usr/local/lib/python3.6/dist-packages/tornado/web.py\", line 1699, in _execute\r\n        result = await result\r\n      File \"/usr/local/lib/python3.6/dist-packages/oauthenticator/oauth2.py\", line 207, in get\r\n        user = await self.login_user()\r\n      File \"/usr/local/lib/python3.6/dist-packages/jupyterhub/handlers/base.py\", line 699, in login_user\r\n        authenticated = await self.authenticate(data)\r\n      File \"/usr/local/lib/python3.6/dist-packages/jupyterhub/auth.py\", line 383, in get_authenticated_user\r\n        authenticated = await maybe_future(self.authenticate(handler, data))\r\n      File \"/usr/local/lib/python3.6/dist-packages/oauthenticator/gitlab.py\", line 130, in authenticate\r\n        self.gitlab_version = await self._get_gitlab_version(access_token)\r\n      File \"/usr/local/lib/python3.6/dist-packages/oauthenticator/gitlab.py\", line 182, in _get_gitlab_version\r\n        resp = await AsyncHTTPClient().fetch(req, raise_error=True)\r\n    tornado.httpclient.HTTPClientError: HTTP 403: Forbidden\r\n    \r\n[E 2020-01-23 06:53:38.015 JupyterHub log:166] {\r\n      \"Cookie\": \"_ga=[secret]; _xsrf=[secret]; oauthenticator-state=[secret]\",\r\n      \"Accept-Language\": \"en-US,en;q=0.9,ro;q=0.8,hu;q=0.7\",\r\n      \"Accept-Encoding\": \"gzip, deflate, br\",\r\n      \"Referer\": \"https://jhub-host/hub/login\",\r\n      \"Sec-Fetch-Mode\": \"navigate\",\r\n      \"Sec-Fetch-Site\": \"same-site\",\r\n      \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\",\r\n      \"Sec-Fetch-User\": \"?1\",\r\n      \"User-Agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36\",\r\n      \"Upgrade-Insecure-Requests\": \"1\",\r\n      \"X-Scheme\": \"https\",\r\n      \"X-Forwarded-Proto\": \"https,http\",\r\n      \"X-Forwarded-Port\": \"443,80\",\r\n      \"X-Forwarded-Host\": \"jhub-host\",\r\n      \"X-Forwarded-For\": \"79.114.17.155,10.36.135.2\",\r\n      \"X-Real-Ip\": \"79.114.17.155\",\r\n      \"X-Request-Id\": \"6b24da3985ea79be4487d10d9ad5889a\",\r\n      \"Host\": \"jhub-host\",\r\n      \"Connection\": \"close\"\r\n    }\r\n[E 2020-01-23 06:53:38.016 JupyterHub log:174] 500 GET /hub/oauth_callback?code=[secret]&state=[secret] (@79.114.17.155) 371.69ms\r\n```\r\n\r\nSeems like the internal callback fails with a `HTTP 403: Forbidden` any ideas why?", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1551/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1551/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1547", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1547/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1547/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1547/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1547", "id": 551421235, "node_id": "MDU6SXNzdWU1NTE0MjEyMzU=", "number": 1547, "title": "Broken links in installation guides", "user": {"login": "metonymic-smokey", "id": 48997495, "node_id": "MDQ6VXNlcjQ4OTk3NDk1", "avatar_url": "https://avatars.githubusercontent.com/u/48997495?v=4", "gravatar_id": "", "url": "https://api.github.com/users/metonymic-smokey", "html_url": "https://github.com/metonymic-smokey", "followers_url": "https://api.github.com/users/metonymic-smokey/followers", "following_url": "https://api.github.com/users/metonymic-smokey/following{/other_user}", "gists_url": "https://api.github.com/users/metonymic-smokey/gists{/gist_id}", "starred_url": "https://api.github.com/users/metonymic-smokey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/metonymic-smokey/subscriptions", "organizations_url": "https://api.github.com/users/metonymic-smokey/orgs", "repos_url": "https://api.github.com/users/metonymic-smokey/repos", "events_url": "https://api.github.com/users/metonymic-smokey/events{/privacy}", "received_events_url": "https://api.github.com/users/metonymic-smokey/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 630540373, "node_id": "MDU6TGFiZWw2MzA1NDAzNzM=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/documentation", "name": "documentation", "color": "fef2c0", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2020-01-17T13:40:02Z", "updated_at": "2020-10-07T16:45:14Z", "closed_at": "2020-10-07T16:44:58Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "There are a few broken Edit this Page links, which on clicking lead to a 404 error.\r\n\r\nThe ones I've found till now are:\r\nhttps://github.com/jupyterhub/zero-to-jupyterhub-k8s/edit/master//index.rst\r\nhttps://github.com/jupyterhub/zero-to-jupyterhub-k8s/edit/master//google/step-zero-gcp.rst\r\nhttps://github.com/jupyterhub/zero-to-jupyterhub-k8s/edit/master//microsoft/step-zero-azure-autoscale.rst\r\nhttps://github.com/jupyterhub/zero-to-jupyterhub-k8s/edit/master//amazon/step-zero-aws.rst\r\nhttps://github.com/jupyterhub/zero-to-jupyterhub-k8s/edit/master//amazon/step-zero-aws-eks.rst\r\nand a few more on the same setup page.\r\n\r\nAs far as I know, these should redirect to a page similar to [this](https://github.com/jupyterhub/zero-to-jupyterhub-k8s/edit/master/doc/source/google/step-zero-gcp.rst).", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1547/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1547/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1486", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1486/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1486/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1486/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1486", "id": 526299607, "node_id": "MDU6SXNzdWU1MjYyOTk2MDc=", "number": 1486, "title": "Core pods (hub/proxy/autohttps/user-scheduler) doesn't get the hub.jupyter.org/dedicated=core:NoSchedule toleration", "user": {"login": "jaskiratr", "id": 8619877, "node_id": "MDQ6VXNlcjg2MTk4Nzc=", "avatar_url": "https://avatars.githubusercontent.com/u/8619877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jaskiratr", "html_url": "https://github.com/jaskiratr", "followers_url": "https://api.github.com/users/jaskiratr/followers", "following_url": "https://api.github.com/users/jaskiratr/following{/other_user}", "gists_url": "https://api.github.com/users/jaskiratr/gists{/gist_id}", "starred_url": "https://api.github.com/users/jaskiratr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jaskiratr/subscriptions", "organizations_url": "https://api.github.com/users/jaskiratr/orgs", "repos_url": "https://api.github.com/users/jaskiratr/repos", "events_url": "https://api.github.com/users/jaskiratr/events{/privacy}", "received_events_url": "https://api.github.com/users/jaskiratr/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 580906362, "node_id": "MDU6TGFiZWw1ODA5MDYzNjI=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/help%20wanted", "name": "help wanted", "color": "0e8a16", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/milestones/7", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/milestone/7", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/milestones/7/labels", "id": 6105581, "node_id": "MDk6TWlsZXN0b25lNjEwNTU4MQ==", "number": 7, "title": "1.0.0", "description": "", "creator": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 19, "state": "open", "created_at": "2020-11-14T03:21:10Z", "updated_at": "2021-05-28T20:30:30Z", "due_on": null, "closed_at": null}, "comments": 4, "created_at": "2019-11-21T00:52:08Z", "updated_at": "2021-01-27T09:16:21Z", "closed_at": "2021-01-27T09:16:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'm unable to leverage taints on an instance group dedicated for core pods. \r\nFollowing is the configuration for `jhub-core` instance group created for core pods.\r\n```yaml\r\napiVersion: kops/v1alpha2\r\nkind: InstanceGroup\r\nmetadata:\r\n  creationTimestamp: null\r\n  name: jhub-core\r\nspec:\r\n  image: kope.io/k8s-1.12-debian-stretch-amd64-hvm-ebs-2019-09-26\r\n  machineType: t2.medium\r\n  maxSize: 1\r\n  minSize: 1\r\n  nodeLabels:\r\n    hub.jupyter.org/node-purpose: core\r\n    kops.k8s.io/instancegroup: jhub-core\r\n  role: Node\r\n  subnets:\r\n  - us-west-2a\r\n  taints:\r\n  - hub.jupyter.org/dedicated=core:NoSchedule\r\n```\r\nThe core pods don't seem to have the relevant tolerances applied when deployed via helm. Following is the `config.yaml` used by helm\r\n```yaml\r\nproxy:\r\n  secretToken: \"-------------\"\r\n  pdb:\r\n    enabled: false\r\nsingleuser:\r\n  defaultUrl: \"/lab\"\r\n  hub:\r\n    pdb:\r\n      enabled: false\r\n    extraConfig:\r\n      jupyterlab: |\r\n        c.Spawner.cmd = ['jupyter-labhub']\r\n  image:\r\n    name: jupyter/all-spark-notebook\r\n    tag: latest\r\n\r\nscheduling:\r\n  corePods:\r\n    nodeAffinity:\r\n      matchNodePurpose: require\r\n  userPods:\r\n    nodeAffinity:\r\n      matchNodePurpose: require\r\n  userScheduler:\r\n    pdb:\r\n      enabled: false\r\n```\r\n**Jhub Version** = `0.9-445a953`\r\n`helm upgrade -i jhub jupyterhub/jupyterhub --namespace jhub --version=0.9-445a953 -f .\\aws-manifests\\jhub\\helm\\config.yaml\r\n`\r\nFor example the `hub` pod appears to have tolerations\r\n```json\r\n\"tolerations\": [\r\n      {\r\n        \"key\": \"node.kubernetes.io/not-ready\",\r\n        \"operator\": \"Exists\",\r\n        \"effect\": \"NoExecute\",\r\n        \"tolerationSeconds\": 300\r\n      },\r\n      {\r\n        \"key\": \"node.kubernetes.io/unreachable\",\r\n        \"operator\": \"Exists\",\r\n        \"effect\": \"NoExecute\",\r\n        \"tolerationSeconds\": 300\r\n      }\r\n    ],\r\n```\r\nHow can I add `hub.jupyter.org/dedicated=core:NoSchedule` to all the core pods in order to prevent any other pods getting scheduled on this jhub-core instance group?\r\n\r\nThank you!\r\n<!--\r\nWelcome to Zero to JupyterHub!\r\n\r\nBefore filing an issue, please search through the issues and\r\n[Discourse forum](https://discourse.jupyter.org/) to see\r\nif your question has been discussed before.\r\n\r\nIf you have a general question about using this repository, or are\r\nlooking for advice on using and configuring JupyterHub,\r\nplease use the [Discourse forum](https://discourse.jupyter.org/).\r\nMany JupyterHub community members are members of the forum\r\nso you will have the benefit of other users' experience\r\nas well as the JupyterHub team.\r\n\r\nPlease submit as much detail about your issue as possible.\r\nIf you think it would be helpful, include a\r\nscrubbed version of your `config.yaml` file.\r\n\r\n*** WARNING ***\r\nMake sure you remove all sensitive information that's\r\nin your `config.yaml` file, as GitHub is a public space.\r\n\r\nPlease remove at *least* the following fields:\r\n\r\n* any special keys under auth\r\n* proxy.secretToken\r\n* hub.cookieSecret\r\n\r\nIf you post any sensitive information we reserve the\r\nright to edit your comment in order to remove it.\r\n\r\nIf you have a bug report or a technical suggestion directly relevant\r\nto this repostiory please open an issue.\r\n-->\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1486/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1486/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1222", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1222/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1222/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1222/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1222", "id": 430036421, "node_id": "MDU6SXNzdWU0MzAwMzY0MjE=", "number": 1222, "title": "After cookies expire, user can still operate in jupyterlab page", "user": {"login": "SolarisYan", "id": 8148762, "node_id": "MDQ6VXNlcjgxNDg3NjI=", "avatar_url": "https://avatars.githubusercontent.com/u/8148762?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SolarisYan", "html_url": "https://github.com/SolarisYan", "followers_url": "https://api.github.com/users/SolarisYan/followers", "following_url": "https://api.github.com/users/SolarisYan/following{/other_user}", "gists_url": "https://api.github.com/users/SolarisYan/gists{/gist_id}", "starred_url": "https://api.github.com/users/SolarisYan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SolarisYan/subscriptions", "organizations_url": "https://api.github.com/users/SolarisYan/orgs", "repos_url": "https://api.github.com/users/SolarisYan/repos", "events_url": "https://api.github.com/users/SolarisYan/events{/privacy}", "received_events_url": "https://api.github.com/users/SolarisYan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2019-04-06T13:59:17Z", "updated_at": "2022-05-16T16:35:33Z", "closed_at": "2022-05-16T16:35:33Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi there, I found that after the cookies jupyterhub-user-xxx and jupyterhub-session-id expired, i can still operate in jupyterlab. To verify this, I set \r\n```python\r\n c.JupyterHub.tornado_settings = {\r\n        \"slow_spawn_timeout\": 0,\r\n        \"cookie_options\": {\r\n          \"expires_days\": 0.0125\r\n        }\r\n}\r\nc.JupyterHub.cookie_max_age_days = 0.0125\r\n```\r\nSo the cookies jupyterhub-user-xxx and jupyterhub-session-id will expire after 18min,and those will delete in browser when expired. But the web page have no tips,and when i open a notebook, it can be used normally, and the cookie  jupyterhub-user-xxx  in the browser's cookie again.\r\n\r\nI use GenericOAuthenticator with keycloak, and i also set the keycloak SSO Session Idle and SSO Session Max is 18min. I'm sure there's no active session in my keycloak. \r\n\r\nI think  jupyterlab or jupyterhub should disable user operation and prompt user to login again?\r\n\r\nIf i use the classic notebook, any operate will be disable or redirect to login page.\r\n\r\n![image](https://user-images.githubusercontent.com/8148762/55670449-ede4d580-58b6-11e9-842a-342c9e05c560.png)\r\n\r\nI use jupyterhub 0.9.4 and jupyterlab 0.35.4", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1222/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1222/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1205", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1205/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1205/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1205/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1205", "id": 426579475, "node_id": "MDU6SXNzdWU0MjY1Nzk0NzU=", "number": 1205, "title": "Estimating costs calculator binder errors", "user": {"login": "mathieuboudreau", "id": 1421029, "node_id": "MDQ6VXNlcjE0MjEwMjk=", "avatar_url": "https://avatars.githubusercontent.com/u/1421029?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mathieuboudreau", "html_url": "https://github.com/mathieuboudreau", "followers_url": "https://api.github.com/users/mathieuboudreau/followers", "following_url": "https://api.github.com/users/mathieuboudreau/following{/other_user}", "gists_url": "https://api.github.com/users/mathieuboudreau/gists{/gist_id}", "starred_url": "https://api.github.com/users/mathieuboudreau/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mathieuboudreau/subscriptions", "organizations_url": "https://api.github.com/users/mathieuboudreau/orgs", "repos_url": "https://api.github.com/users/mathieuboudreau/repos", "events_url": "https://api.github.com/users/mathieuboudreau/events{/privacy}", "received_events_url": "https://api.github.com/users/mathieuboudreau/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 630540373, "node_id": "MDU6TGFiZWw2MzA1NDAzNzM=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/documentation", "name": "documentation", "color": "fef2c0", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-03-28T16:06:27Z", "updated_at": "2020-10-06T20:49:24Z", "closed_at": "2020-10-06T20:49:24Z", "author_association": "NONE", "active_lock_reason": null, "body": "Clicking the \"Launch cost calculator\" in this link (https://zero-to-jupyterhub.readthedocs.io/en/stable/cost.html), MyBinder fails to build and errors:\r\n\r\n<img width=\"1175\" alt=\"Capture d\u2019\u00e9cran 2019-03-28 \u00e0 13 29 32\" src=\"https://user-images.githubusercontent.com/1421029/55173193-376a4d80-515e-11e9-9a07-2faf1c48a5b1.png\">\r\n ", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1205/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1205/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1185", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1185/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1185/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1185/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1185", "id": 419252577, "node_id": "MDExOlB1bGxSZXF1ZXN0MjU5ODAyNzU3", "number": 1185, "title": "Switch to openssl backend for pycurl", "user": {"login": "joshbode", "id": 878107, "node_id": "MDQ6VXNlcjg3ODEwNw==", "avatar_url": "https://avatars.githubusercontent.com/u/878107?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joshbode", "html_url": "https://github.com/joshbode", "followers_url": "https://api.github.com/users/joshbode/followers", "following_url": "https://api.github.com/users/joshbode/following{/other_user}", "gists_url": "https://api.github.com/users/joshbode/gists{/gist_id}", "starred_url": "https://api.github.com/users/joshbode/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joshbode/subscriptions", "organizations_url": "https://api.github.com/users/joshbode/orgs", "repos_url": "https://api.github.com/users/joshbode/repos", "events_url": "https://api.github.com/users/joshbode/events{/privacy}", "received_events_url": "https://api.github.com/users/joshbode/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 697551410, "node_id": "MDU6TGFiZWw2OTc1NTE0MTA=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/needs:%20testing", "name": "needs: testing", "color": "c2e0c6", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/milestones/5", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/milestone/5", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/milestones/5/labels", "id": 3631697, "node_id": "MDk6TWlsZXN0b25lMzYzMTY5Nw==", "number": 5, "title": "0.9", "description": "", "creator": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 4, "state": "closed", "created_at": "2018-09-07T08:34:41Z", "updated_at": "2021-01-15T16:17:43Z", "due_on": null, "closed_at": "2021-01-15T16:17:43Z"}, "comments": 11, "created_at": "2019-03-11T00:22:32Z", "updated_at": "2019-05-22T05:34:03Z", "closed_at": "2019-03-17T22:26:05Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/1185", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1185", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1185.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/1185.patch", "merged_at": "2019-03-17T22:26:05Z"}, "body": "Builds `pycurl` as a requirement with `openssl` backend\r\n\r\nResolves #1102", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1185/reactions", "total_count": 7, "+1": 4, "-1": 0, "laugh": 0, "hooray": 1, "confused": 0, "heart": 2, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/1185/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/854", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/854/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/854/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/854/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/854", "id": 351774084, "node_id": "MDExOlB1bGxSZXF1ZXN0MjA5Mjg0MTUx", "number": 854, "title": "No more duplicates of puller pods", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-08-18T00:30:58Z", "updated_at": "2018-08-18T20:34:41Z", "closed_at": "2018-08-18T20:34:41Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/854", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/854", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/854.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/854.patch", "merged_at": "2018-08-18T20:34:41Z"}, "body": "Thanks to the new `before-hook-creation` deletion policy, we can avoid the `object already exist` error as Helm would simply delete and recreate the resource instead if it found a resource with the same name. This means that we can use a single name for the puller daemonset and won't ever orphan a puller daemonsets after a failed upgrade followed by a successful upgrade.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/854/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/854/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/851", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/851/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/851/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/851/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/851", "id": 351254685, "node_id": "MDExOlB1bGxSZXF1ZXN0MjA4ODk3NDg4", "number": 851, "title": "Pulling images from external private image repositories", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 580906361, "node_id": "MDU6TGFiZWw1ODA5MDYzNjE=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/enhancement", "name": "enhancement", "color": "84b6eb", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/milestones/3", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/milestone/3", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/milestones/3/labels", "id": 3054680, "node_id": "MDk6TWlsZXN0b25lMzA1NDY4MA==", "number": 3, "title": "0.7", "description": "", "creator": {"login": "choldgraf", "id": 1839645, "node_id": "MDQ6VXNlcjE4Mzk2NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/1839645?v=4", "gravatar_id": "", "url": "https://api.github.com/users/choldgraf", "html_url": "https://github.com/choldgraf", "followers_url": "https://api.github.com/users/choldgraf/followers", "following_url": "https://api.github.com/users/choldgraf/following{/other_user}", "gists_url": "https://api.github.com/users/choldgraf/gists{/gist_id}", "starred_url": "https://api.github.com/users/choldgraf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/choldgraf/subscriptions", "organizations_url": "https://api.github.com/users/choldgraf/orgs", "repos_url": "https://api.github.com/users/choldgraf/repos", "events_url": "https://api.github.com/users/choldgraf/events{/privacy}", "received_events_url": "https://api.github.com/users/choldgraf/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 20, "state": "closed", "created_at": "2018-01-22T17:25:35Z", "updated_at": "2018-09-07T08:34:35Z", "due_on": null, "closed_at": "2018-09-07T08:34:35Z"}, "comments": 3, "created_at": "2018-08-16T15:25:29Z", "updated_at": "2018-09-04T20:37:57Z", "closed_at": "2018-08-29T19:10:53Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/pulls/851", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/851", "diff_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/851.diff", "patch_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/851.patch", "merged_at": "2018-08-29T19:10:53Z"}, "body": "## TODO\r\n\r\n- [x] Verify hook-pulling from private registries works as well.\r\n- [x] Verify output is EXACTLY the same (as kubeclt create secret ...)  with a registry using symbols like `:/` in it as well\r\n\r\n---\r\n\r\n@AlexMorreale helped us use config.yaml to install a Kubernetes Secret which could be referenced by pods that want to pull from image registries that required some credentials - this is #801.\r\n\r\nThis PR complements Alex work by...\r\n- Allowing for the email field to optionally be configured, which seem to be utilized by some registries but not all.\r\n- Adds support for setting large JSON blobs in the password field, something that is required in order to pull from a private gcr.io registry from an external cluster.\r\n- Ensures that the image puller DaemonSets, both `hook-` and `continuous-` have the same credentials to pull the images.\r\n\r\nFixes #871.\r\n\r\n---\r\n\r\nNote that with #844, this pr will ensure that the Helm template within `jupyterhub/templates/singleuser/image-credentials-secret.yaml` is valid and generated valid output which is a very important check for this PR.\r\n\r\nAlso note that the secret created with values in config.yaml, will have the *exact* same content as a secret created by kubectl's command if you provide a simple password or if you pass it a big JSON blob.\r\n```\r\nkubectl create secret docker-registry regcred --docker-server=<your-registry-server> --docker-username=<your-name> --docker-password=<your-pword> --docker-email=<your-email> \r\n```\r\n\r\nSee [the Kubernetes documentation](https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/#create-a-secret-in-the-cluster-that-holds-your-authorization-token) for more details.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/851/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/851/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/806", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/806/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/806/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/806/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/806", "id": 346392333, "node_id": "MDU6SXNzdWUzNDYzOTIzMzM=", "number": 806, "title": "Proxy redirects to unexpected port", "user": {"login": "ryanlovett", "id": 10248125, "node_id": "MDQ6VXNlcjEwMjQ4MTI1", "avatar_url": "https://avatars.githubusercontent.com/u/10248125?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ryanlovett", "html_url": "https://github.com/ryanlovett", "followers_url": "https://api.github.com/users/ryanlovett/followers", "following_url": "https://api.github.com/users/ryanlovett/following{/other_user}", "gists_url": "https://api.github.com/users/ryanlovett/gists{/gist_id}", "starred_url": "https://api.github.com/users/ryanlovett/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ryanlovett/subscriptions", "organizations_url": "https://api.github.com/users/ryanlovett/orgs", "repos_url": "https://api.github.com/users/ryanlovett/repos", "events_url": "https://api.github.com/users/ryanlovett/events{/privacy}", "received_events_url": "https://api.github.com/users/ryanlovett/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 18, "created_at": "2018-07-31T23:18:11Z", "updated_at": "2019-10-30T23:16:25Z", "closed_at": "2019-08-20T10:14:28Z", "author_association": "COLLABORATOR", "active_lock_reason": null, "body": "With v0.7-578b3a2 and\r\n```\r\nhttps:\r\n  hosts:\r\n    - \"my.hostname.edu\"\r\n  type: manual\r\n  manual:\r\n    key: |\r\n      ...\r\n    cert: |\r\n      ...\r\n```\r\n\r\nConnecting to the proxy on port 80 was redirecting me to 8443:\r\n```\r\n--2018-07-31 16:02:50--  http://aa.bb.cc.dd/\r\nConnecting to aa.bb.cc.dd:80... connected.\r\nHTTP request sent, awaiting response... 301 Moved Permanently\r\nLocation: https://aa.bb.cc.dd:8443/ [following]\r\n--2018-07-31 16:02:50--  https://aa.bb.cc.dd:8443/\r\nConnecting to aa.bb.cc.dd:8443... ^C\r\n```\r\n\r\nThis would then hang since I only had 80/443 open in my firewall.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/806/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/806/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/525", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/525/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/525/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/525/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/525", "id": 299402961, "node_id": "MDU6SXNzdWUyOTk0MDI5NjE=", "number": 525, "title": "Pressing \"Access Server\" as admin leads to ones personal account", "user": {"login": "mrocklin", "id": 306380, "node_id": "MDQ6VXNlcjMwNjM4MA==", "avatar_url": "https://avatars.githubusercontent.com/u/306380?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrocklin", "html_url": "https://github.com/mrocklin", "followers_url": "https://api.github.com/users/mrocklin/followers", "following_url": "https://api.github.com/users/mrocklin/following{/other_user}", "gists_url": "https://api.github.com/users/mrocklin/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrocklin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrocklin/subscriptions", "organizations_url": "https://api.github.com/users/mrocklin/orgs", "repos_url": "https://api.github.com/users/mrocklin/repos", "events_url": "https://api.github.com/users/mrocklin/events{/privacy}", "received_events_url": "https://api.github.com/users/mrocklin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2018-02-22T15:45:18Z", "updated_at": "2018-09-04T07:29:01Z", "closed_at": "2018-09-04T07:29:01Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "When diagnosing a user's issue I log into the hub/admin page and press the \"Access Server\" button next to their account name.  Instead of being taken to their account I am taken to my own.\r\n\r\n## Contents of `config.yaml`\r\n\r\n    --version=v0.6.0-9701a90\r\n\r\n```\r\nproxy:\r\n  secretToken: SECRET\r\n\r\nsingleuser:\r\n  image:\r\n    name: daskdev/pangeo-notebook\r\n    tag: 2018-02-14\r\n  cmd: ['start-singleuser.sh']\r\n  extraEnv:\r\n    EXTRA_PIP_PACKAGES: >-\r\n    GCSFUSE_BUCKET: pangeo-data\r\n  storage:\r\n    extraVolumes:\r\n      - name: fuse\r\n        hostPath:\r\n          path: /dev/fuse\r\n    extraVolumeMounts:\r\n      - name: fuse\r\n        mountPath: /dev/fuse\r\n  cpu:\r\n    limit: 2\r\n    guarantee: 1\r\n  memory:\r\n    limit: 4G\r\n    guarantee: 2G\r\n\r\n\r\n# proxy:\r\n#   https:\r\n#     hosts:\r\n#       - pangeo.pydata.org\r\n#     letsencrypt:\r\n#       contactEmail: mrocklin@gmail.com\r\n\r\nauth:\r\n  type: github\r\n  github:\r\n    clientId: \"2cb5e09d5733ff2e6ae3\"\r\n    clientSecret: \"SECRET\"\r\n    callbackUrl: \"http://pangeo.pydata.org/hub/oauth_callback\"\r\n  admin:\r\n    access: true\r\n    users:\r\n      - mrocklin\r\n      - jhamman\r\n      - rabernat\r\n      - yuvipanda\r\n      - choldgraf\r\n\r\nrbac:\r\n  enabled: false\r\n\r\nhub:\r\n  extraConfig: |\r\n    c.KubeSpawner.singleuser_service_account = 'default'\r\n    c.Spawner.default_url = '/lab'\r\n    from kubernetes import client\r\n    def modify_pod_hook(spawner, pod):\r\n        pod.spec.containers[0].security_context = client.V1SecurityContext(\r\n            privileged=True,\r\n            capabilities=client.V1Capabilities(\r\n                add=['SYS_ADMIN']\r\n            )\r\n        )\r\n        return pod\r\n    c.KubeSpawner.modify_pod_hook = modify_pod_hook\r\n\r\ncull:\r\n  enabled: true\r\n  users: false\r\n  timeout: 3600\r\n  every: 600\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/525/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/525/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/521", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/521/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/521/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/521/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/521", "id": 299319510, "node_id": "MDU6SXNzdWUyOTkzMTk1MTA=", "number": 521, "title": "If auth.whitelist.users is non-empty GitHub orgs are ignored", "user": {"login": "manics", "id": 1644105, "node_id": "MDQ6VXNlcjE2NDQxMDU=", "avatar_url": "https://avatars.githubusercontent.com/u/1644105?v=4", "gravatar_id": "", "url": "https://api.github.com/users/manics", "html_url": "https://github.com/manics", "followers_url": "https://api.github.com/users/manics/followers", "following_url": "https://api.github.com/users/manics/following{/other_user}", "gists_url": "https://api.github.com/users/manics/gists{/gist_id}", "starred_url": "https://api.github.com/users/manics/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/manics/subscriptions", "organizations_url": "https://api.github.com/users/manics/orgs", "repos_url": "https://api.github.com/users/manics/repos", "events_url": "https://api.github.com/users/manics/events{/privacy}", "received_events_url": "https://api.github.com/users/manics/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 580906362, "node_id": "MDU6TGFiZWw1ODA5MDYzNjI=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/help%20wanted", "name": "help wanted", "color": "0e8a16", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2018-02-22T11:36:11Z", "updated_at": "2021-01-17T16:36:41Z", "closed_at": "2021-01-17T16:36:41Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Expected behaviour: If `auth.whitelist.users` is a non-empty list and `auth.github.org_whitelist` from https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/501 is set users should be able to login if they're in `auth.whitelist.users` or if they're a member of `auth.github.org_whitelist`\r\n\r\nObserved behaviour: If `auth.whitelist.users` is a non-empty `auth.github.org_whitelist` is ignored\r\n\r\n## Relevant config\r\n```\r\nauth:\r\n  whitelist:\r\n    users:\r\n    - nonexistent-dummy-user\r\n  type: github\r\n  github:\r\n    clientId: \"CLIENT_ID\"\r\n    clientSecret: \"CLIENT_SECRET\"\r\n    callbackUrl: \"http://10.0.17.150.xip.io/hub/oauth_callback\"\r\n    org_whitelist:\r\n    - idr-contrib\r\n```\r\nI'm a public member of [`idr-contrib`](https://github.com/idr-contrib)\r\n\r\n`kubectl logs -f deploy/hub`:\r\n```\r\n[D 2018-02-21 12:04:36.986 JupyterHub proxy:552] Proxy: Fetching GET http://10.233.51.203:8001/api/routes\r\n[I 2018-02-21 12:04:54.382 JupyterHub oauth2:82] OAuth redirect: 'http://10.0.17.150.xip.io/hub/oauth_callback'\r\n[I 2018-02-21 12:04:54.383 JupyterHub log:122] 302 GET /hub/oauth_login?next= \u2192 https://github.com/login/oauth/authorize?redirect_uri=http%3A%2F%2F10.0.17.150.xip.io%2Fhub%2Foauth_callback&client_id=[CLIENT_ID]&response_type=code&state=[STATE]%3D%3D&scope=read%3Aorg (@134.36.162.197) 1.19ms\r\n[W 2018-02-21 12:04:56.019 JupyterHub auth:249] User 'manics' not in whitelist.\r\n[W 2018-02-21 12:04:56.019 JupyterHub base:351] Failed login for unknown user\r\n[D 2018-02-21 12:04:56.020 JupyterHub base:633] No template for 403\r\n[W 2018-02-21 12:04:56.024 JupyterHub log:122] 403 GET /hub/oauth_callback?code=5da9f5ee26ede539c294&state=[STATE]%3D%3D (@134.36.162.197) 1250.62ms\r\n[D 2018-02-21 12:04:56.285 JupyterHub log:122] 304 GET /favicon.ico (@134.36.162.197) 0.65ms\r\n```\r\n\r\nOriginally reported in https://github.com/jupyterhub/zero-to-jupyterhub-k8s/pull/501#issuecomment-367311371", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/521/reactions", "total_count": 3, "+1": 3, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/521/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/518", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/518/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/518/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/518/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/518", "id": 299223579, "node_id": "MDU6SXNzdWUyOTkyMjM1Nzk=", "number": 518, "title": "Unable to start singleuser when user pv is full", "user": {"login": "clkao", "id": 69736, "node_id": "MDQ6VXNlcjY5NzM2", "avatar_url": "https://avatars.githubusercontent.com/u/69736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/clkao", "html_url": "https://github.com/clkao", "followers_url": "https://api.github.com/users/clkao/followers", "following_url": "https://api.github.com/users/clkao/following{/other_user}", "gists_url": "https://api.github.com/users/clkao/gists{/gist_id}", "starred_url": "https://api.github.com/users/clkao/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/clkao/subscriptions", "organizations_url": "https://api.github.com/users/clkao/orgs", "repos_url": "https://api.github.com/users/clkao/repos", "events_url": "https://api.github.com/users/clkao/events{/privacy}", "received_events_url": "https://api.github.com/users/clkao/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2018-02-22T05:07:56Z", "updated_at": "2018-09-04T07:26:32Z", "closed_at": "2018-09-04T07:26:32Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "This is probably a jupyterlab issue, but worth tracking here as full user pv will render the singleuser notebook unusable and require manual intervention.  There should be a fail-safe mode that the server can be started and user is advised to cleanup home directory.\r\n\r\n```\r\n\r\nOSError: [Errno 28] No space left on device\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/opt/conda/bin/jupyter-labhub\", line 11, in <module>\r\n    load_entry_point('jupyterlab==0.31.3', 'console_scripts', 'jupyter-labhub')()\r\n  File \"/opt/conda/lib/python3.6/site-packages/jupyterlab/labhubapp.py\", line 32, in main\r\n    return SingleUserLabApp.launch_instance(argv)\r\n  File \"/opt/conda/lib/python3.6/site-packages/jupyter_core/application.py\", line 266, in launch_instance\r\n    return super(JupyterApp, cls).launch_instance(argv=argv, **kwargs)\r\n  File \"/opt/conda/lib/python3.6/site-packages/traitlets/config/application.py\", line 658, in launch_instance\r\n    app.start()\r\n  File \"/opt/conda/lib/python3.6/site-packages/jupyterhub/singleuser.py\", line 368, in start\r\n    super(SingleUserNotebookApp, self).start()\r\n  File \"/opt/conda/lib/python3.6/site-packages/notebook/notebookapp.py\", line 1453, in start\r\n    self.write_server_info_file()\r\n  File \"/opt/conda/lib/python3.6/site-packages/notebook/notebookapp.py\", line 1412, in write_server_info_file\r\n    json.dump(self.server_info(), f, indent=2, sort_keys=True)\r\nOSError: [Errno 28] No space left on device\r\n```", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/518/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/518/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/454", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/454/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/454/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/454/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/454", "id": 292060951, "node_id": "MDU6SXNzdWUyOTIwNjA5NTE=", "number": 454, "title": "prePuller doesn't understand noschedule taint", "user": {"login": "yuvipanda", "id": 30430, "node_id": "MDQ6VXNlcjMwNDMw", "avatar_url": "https://avatars.githubusercontent.com/u/30430?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuvipanda", "html_url": "https://github.com/yuvipanda", "followers_url": "https://api.github.com/users/yuvipanda/followers", "following_url": "https://api.github.com/users/yuvipanda/following{/other_user}", "gists_url": "https://api.github.com/users/yuvipanda/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuvipanda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuvipanda/subscriptions", "organizations_url": "https://api.github.com/users/yuvipanda/orgs", "repos_url": "https://api.github.com/users/yuvipanda/repos", "events_url": "https://api.github.com/users/yuvipanda/events{/privacy}", "received_events_url": "https://api.github.com/users/yuvipanda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/milestones/2", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/milestone/2", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/milestones/2/labels", "id": 3018233, "node_id": "MDk6TWlsZXN0b25lMzAxODIzMw==", "number": 2, "title": "0.6", "description": "", "creator": {"login": "yuvipanda", "id": 30430, "node_id": "MDQ6VXNlcjMwNDMw", "avatar_url": "https://avatars.githubusercontent.com/u/30430?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuvipanda", "html_url": "https://github.com/yuvipanda", "followers_url": "https://api.github.com/users/yuvipanda/followers", "following_url": "https://api.github.com/users/yuvipanda/following{/other_user}", "gists_url": "https://api.github.com/users/yuvipanda/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuvipanda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuvipanda/subscriptions", "organizations_url": "https://api.github.com/users/yuvipanda/orgs", "repos_url": "https://api.github.com/users/yuvipanda/repos", "events_url": "https://api.github.com/users/yuvipanda/events{/privacy}", "received_events_url": "https://api.github.com/users/yuvipanda/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 23, "state": "closed", "created_at": "2018-01-08T04:01:22Z", "updated_at": "2018-03-31T19:55:25Z", "due_on": "2018-01-24T08:00:00Z", "closed_at": "2018-03-31T19:55:25Z"}, "comments": 1, "created_at": "2018-01-26T23:20:08Z", "updated_at": "2018-01-30T09:05:42Z", "closed_at": "2018-01-30T09:05:42Z", "author_association": "COLLABORATOR", "active_lock_reason": null, "body": "In the pre-puller, we only check for the `unschedulable: true` spec to see if a daemonset will get scheduled there. This accounts for cordoned nodes, but not for tainted nodes.\r\n\r\nWe should check for:\r\n\r\n```\r\n  taints:\r\n  - effect: NoSchedule\r\n    key: node-role.kubernetes.io/master\r\n    timeAdded: null\r\n    value: \"true\"\r\n```\r\n\r\nas well in the pre-puller.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/454/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/454/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/211", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/211/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/211/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/211/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/211", "id": 262257504, "node_id": "MDU6SXNzdWUyNjIyNTc1MDQ=", "number": 211, "title": "schema doc page points to the deprecated helm chart", "user": {"login": "choldgraf", "id": 1839645, "node_id": "MDQ6VXNlcjE4Mzk2NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/1839645?v=4", "gravatar_id": "", "url": "https://api.github.com/users/choldgraf", "html_url": "https://github.com/choldgraf", "followers_url": "https://api.github.com/users/choldgraf/followers", "following_url": "https://api.github.com/users/choldgraf/following{/other_user}", "gists_url": "https://api.github.com/users/choldgraf/gists{/gist_id}", "starred_url": "https://api.github.com/users/choldgraf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/choldgraf/subscriptions", "organizations_url": "https://api.github.com/users/choldgraf/orgs", "repos_url": "https://api.github.com/users/choldgraf/repos", "events_url": "https://api.github.com/users/choldgraf/events{/privacy}", "received_events_url": "https://api.github.com/users/choldgraf/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 630540373, "node_id": "MDU6TGFiZWw2MzA1NDAzNzM=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/documentation", "name": "documentation", "color": "fef2c0", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-10-02T23:13:50Z", "updated_at": "2018-05-02T22:06:20Z", "closed_at": "2018-05-02T22:06:20Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "We should fix this! I'd do it now but am sitting in customs right now after flying across the ocean!", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/211/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/211/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/204", "repository_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/204/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/204/comments", "events_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/204/events", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/204", "id": 259649248, "node_id": "MDU6SXNzdWUyNTk2NDkyNDg=", "number": 204, "title": "Refactor handling of schema page", "user": {"login": "willingc", "id": 2680980, "node_id": "MDQ6VXNlcjI2ODA5ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/2680980?v=4", "gravatar_id": "", "url": "https://api.github.com/users/willingc", "html_url": "https://github.com/willingc", "followers_url": "https://api.github.com/users/willingc/followers", "following_url": "https://api.github.com/users/willingc/following{/other_user}", "gists_url": "https://api.github.com/users/willingc/gists{/gist_id}", "starred_url": "https://api.github.com/users/willingc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/willingc/subscriptions", "organizations_url": "https://api.github.com/users/willingc/orgs", "repos_url": "https://api.github.com/users/willingc/repos", "events_url": "https://api.github.com/users/willingc/events{/privacy}", "received_events_url": "https://api.github.com/users/willingc/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 580906359, "node_id": "MDU6TGFiZWw1ODA5MDYzNTk=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 630540373, "node_id": "MDU6TGFiZWw2MzA1NDAzNzM=", "url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/labels/documentation", "name": "documentation", "color": "fef2c0", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/milestones/1", "html_url": "https://github.com/jupyterhub/zero-to-jupyterhub-k8s/milestone/1", "labels_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/milestones/1/labels", "id": 2831342, "node_id": "MDk6TWlsZXN0b25lMjgzMTM0Mg==", "number": 1, "title": "0.5", "description": null, "creator": {"login": "yuvipanda", "id": 30430, "node_id": "MDQ6VXNlcjMwNDMw", "avatar_url": "https://avatars.githubusercontent.com/u/30430?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuvipanda", "html_url": "https://github.com/yuvipanda", "followers_url": "https://api.github.com/users/yuvipanda/followers", "following_url": "https://api.github.com/users/yuvipanda/following{/other_user}", "gists_url": "https://api.github.com/users/yuvipanda/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuvipanda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuvipanda/subscriptions", "organizations_url": "https://api.github.com/users/yuvipanda/orgs", "repos_url": "https://api.github.com/users/yuvipanda/repos", "events_url": "https://api.github.com/users/yuvipanda/events{/privacy}", "received_events_url": "https://api.github.com/users/yuvipanda/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 109, "state": "closed", "created_at": "2017-10-11T19:24:52Z", "updated_at": "2018-04-28T20:50:23Z", "due_on": null, "closed_at": "2018-01-10T18:36:52Z"}, "comments": 2, "created_at": "2017-09-21T22:18:43Z", "updated_at": "2017-12-05T04:31:04Z", "closed_at": "2017-11-08T16:17:48Z", "author_association": "COLLABORATOR", "active_lock_reason": null, "body": "The new schema page build italicizes everything when built on RTD. The theme's rendering of fonts is being overwritten.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/204/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/zero-to-jupyterhub-k8s/issues/204/timeline", "performed_via_github_app": null, "state_reason": "completed"}]