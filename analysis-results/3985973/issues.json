[{"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3815", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3815/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3815/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3815/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3815", "id": 1684213279, "node_id": "I_kwDOBpf0x85kYw4f", "number": 3815, "title": "cannot import name 'get_base_python_image_uri' from 'sagemaker.image_uris' (/home/ec2-user/anaconda3/envs/python3/lib/python3.10/site-packages/sagemaker/image_uris.py)", "user": {"login": "KraftZzz", "id": 109524202, "node_id": "U_kgDOBoc06g", "avatar_url": "https://avatars.githubusercontent.com/u/109524202?v=4", "gravatar_id": "", "url": "https://api.github.com/users/KraftZzz", "html_url": "https://github.com/KraftZzz", "followers_url": "https://api.github.com/users/KraftZzz/followers", "following_url": "https://api.github.com/users/KraftZzz/following{/other_user}", "gists_url": "https://api.github.com/users/KraftZzz/gists{/gist_id}", "starred_url": "https://api.github.com/users/KraftZzz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/KraftZzz/subscriptions", "organizations_url": "https://api.github.com/users/KraftZzz/orgs", "repos_url": "https://api.github.com/users/KraftZzz/repos", "events_url": "https://api.github.com/users/KraftZzz/events{/privacy}", "received_events_url": "https://api.github.com/users/KraftZzz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 5436711711, "node_id": "LA_kwDOBpf0x88AAAABRA2jHw", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/remote-function", "name": "remote-function", "color": "0052cc", "default": false, "description": "Relates to Pathways feature"}], "state": "closed", "locked": false, "assignee": {"login": "dpatro", "id": 2094260, "node_id": "MDQ6VXNlcjIwOTQyNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/2094260?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dpatro", "html_url": "https://github.com/dpatro", "followers_url": "https://api.github.com/users/dpatro/followers", "following_url": "https://api.github.com/users/dpatro/following{/other_user}", "gists_url": "https://api.github.com/users/dpatro/gists{/gist_id}", "starred_url": "https://api.github.com/users/dpatro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dpatro/subscriptions", "organizations_url": "https://api.github.com/users/dpatro/orgs", "repos_url": "https://api.github.com/users/dpatro/repos", "events_url": "https://api.github.com/users/dpatro/events{/privacy}", "received_events_url": "https://api.github.com/users/dpatro/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "dpatro", "id": 2094260, "node_id": "MDQ6VXNlcjIwOTQyNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/2094260?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dpatro", "html_url": "https://github.com/dpatro", "followers_url": "https://api.github.com/users/dpatro/followers", "following_url": "https://api.github.com/users/dpatro/following{/other_user}", "gists_url": "https://api.github.com/users/dpatro/gists{/gist_id}", "starred_url": "https://api.github.com/users/dpatro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dpatro/subscriptions", "organizations_url": "https://api.github.com/users/dpatro/orgs", "repos_url": "https://api.github.com/users/dpatro/repos", "events_url": "https://api.github.com/users/dpatro/events{/privacy}", "received_events_url": "https://api.github.com/users/dpatro/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 5, "created_at": "2023-04-26T03:42:47Z", "updated_at": "2023-04-27T18:05:18Z", "closed_at": "2023-04-27T18:05:18Z", "author_association": "NONE", "active_lock_reason": null, "body": "\r\nI run this code in jupyternotebook:\r\n\r\n!pip3 show sagemaker\r\nfrom sagemaker.remote_function import remote\r\n\r\nName: sagemaker\r\nVersion: 2.150.0\r\nSummary: Open source library for training and deploying models on Amazon SageMaker.\r\nHome-page: https://github.com/aws/sagemaker-python-sdk/\r\nAuthor: Amazon Web Services\r\nAuthor-email: \r\nLicense: Apache License 2.0\r\nLocation: /home/ec2-user/anaconda3/envs/python3/lib/python3.10/site-packages\r\nRequires: attrs, boto3, cloudpickle, google-pasta, importlib-metadata, jsonschema, numpy, packaging, pandas, pathos, platformdirs, protobuf, protobuf3-to-dict, PyYAML, schema, smdebug-rulesconfig, tblib\r\nRequired-by: \r\n---------------------------------------------------------------------------\r\nImportError                               Traceback (most recent call last)\r\nCell In[6], line 2\r\n      1 get_ipython().system('pip3 show sagemaker')\r\n----> 2 from sagemaker.remote_function import remote\r\n\r\nFile ~/anaconda3/envs/python3/lib/python3.10/site-packages/sagemaker/remote_function/__init__.py:16\r\n     13 \"\"\"Defines classes and helper methods used in remote function executions.\"\"\"\r\n     14 from __future__ import absolute_import\r\n---> 16 from sagemaker.remote_function.client import remote, RemoteExecutor  # noqa: F401\r\n\r\nFile ~/anaconda3/envs/python3/lib/python3.10/site-packages/sagemaker/remote_function/client.py:38\r\n     36 from sagemaker.session import Session\r\n     37 from sagemaker.s3 import s3_path_join\r\n---> 38 from sagemaker.remote_function.job import _JobSettings, _Job, _RunInfo\r\n     39 from sagemaker.remote_function import logging_config\r\n     40 from sagemaker.utils import name_from_base, base_from_name\r\n\r\nFile ~/anaconda3/envs/python3/lib/python3.10/site-packages/sagemaker/remote_function/job.py:44\r\n     42 from sagemaker.experiments._run_context import _RunContext\r\n     43 from sagemaker.experiments.run import Run\r\n---> 44 from sagemaker.image_uris import get_base_python_image_uri\r\n     45 from sagemaker.session import get_execution_role, _logs_for_job, Session\r\n     46 from sagemaker.utils import name_from_base, _tmpdir, resolve_value_from_config\r\n\r\nImportError: cannot import name 'get_base_python_image_uri' from 'sagemaker.image_uris' (/home/ec2-user/anaconda3/envs/python3/lib/python3.10/site-packages/sagemaker/image_uris.py)\r\n\r\nI refer this blog: https://aws.amazon.com/cn/blogs/machine-learning/run-your-local-machine-learning-code-as-amazon-sagemaker-training-jobs-with-minimal-code-changes/, but is not work fine.", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3815/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3815/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3769", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3769/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3769/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3769/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3769", "id": 1658943203, "node_id": "I_kwDOBpf0x85i4Xbj", "number": 3769, "title": "DJL not passing through sagemaker session when downloading s3 artifact", "user": {"login": "jbarz1", "id": 64875874, "node_id": "MDQ6VXNlcjY0ODc1ODc0", "avatar_url": "https://avatars.githubusercontent.com/u/64875874?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jbarz1", "html_url": "https://github.com/jbarz1", "followers_url": "https://api.github.com/users/jbarz1/followers", "following_url": "https://api.github.com/users/jbarz1/following{/other_user}", "gists_url": "https://api.github.com/users/jbarz1/gists{/gist_id}", "starred_url": "https://api.github.com/users/jbarz1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jbarz1/subscriptions", "organizations_url": "https://api.github.com/users/jbarz1/orgs", "repos_url": "https://api.github.com/users/jbarz1/repos", "events_url": "https://api.github.com/users/jbarz1/events{/privacy}", "received_events_url": "https://api.github.com/users/jbarz1/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": {"login": "siddvenk", "id": 13823525, "node_id": "MDQ6VXNlcjEzODIzNTI1", "avatar_url": "https://avatars.githubusercontent.com/u/13823525?v=4", "gravatar_id": "", "url": "https://api.github.com/users/siddvenk", "html_url": "https://github.com/siddvenk", "followers_url": "https://api.github.com/users/siddvenk/followers", "following_url": "https://api.github.com/users/siddvenk/following{/other_user}", "gists_url": "https://api.github.com/users/siddvenk/gists{/gist_id}", "starred_url": "https://api.github.com/users/siddvenk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/siddvenk/subscriptions", "organizations_url": "https://api.github.com/users/siddvenk/orgs", "repos_url": "https://api.github.com/users/siddvenk/repos", "events_url": "https://api.github.com/users/siddvenk/events{/privacy}", "received_events_url": "https://api.github.com/users/siddvenk/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "siddvenk", "id": 13823525, "node_id": "MDQ6VXNlcjEzODIzNTI1", "avatar_url": "https://avatars.githubusercontent.com/u/13823525?v=4", "gravatar_id": "", "url": "https://api.github.com/users/siddvenk", "html_url": "https://github.com/siddvenk", "followers_url": "https://api.github.com/users/siddvenk/followers", "following_url": "https://api.github.com/users/siddvenk/following{/other_user}", "gists_url": "https://api.github.com/users/siddvenk/gists{/gist_id}", "starred_url": "https://api.github.com/users/siddvenk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/siddvenk/subscriptions", "organizations_url": "https://api.github.com/users/siddvenk/orgs", "repos_url": "https://api.github.com/users/siddvenk/repos", "events_url": "https://api.github.com/users/siddvenk/events{/privacy}", "received_events_url": "https://api.github.com/users/siddvenk/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2023-04-07T15:45:41Z", "updated_at": "2023-04-26T21:40:17Z", "closed_at": "2023-04-26T21:40:17Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**Describe the bug**\r\nA clear and concise description of what the bug is.\r\n\r\nI pass in a sagemaker session with region set into DJLModel but when downloading the s3 artifact, it complains about region not being set\r\n\r\nI think the self.sagemaker_session needs to be passed in here.\r\n\r\nhttps://github.com/aws/sagemaker-python-sdk/blob/c4c4e83f0082e246b75f69a9c519436b1514a4cc/src/sagemaker/djl_inference/model.py#L146\r\n\r\n**To reproduce**\r\nA clear, step-by-step set of instructions to reproduce the bug.\r\n\r\n```\r\nregion='us-west-2'\r\nboto_session = boto3.Session(profile_name='default', region_name=region)\r\nsession = Session(boto_session=boto_session)\r\n\r\nmodel = DJLModel(\r\n    pretrained_model_location,\r\n    role,\r\n    task=\"text-generation\",\r\n    number_of_partitions=2,\r\n    data_type=\"fp16\",\r\n    sagemaker_session=session,\r\n)\r\n```\r\n\r\n**Expected behavior**\r\nA clear and concise description of what you expected to happen.\r\n\r\npass\r\n\r\n**Screenshots or logs**\r\nIf applicable, add screenshots or logs to help explain your problem.\r\n\r\n```\r\nValueError                                Traceback (most recent call last)\r\n/tmp/ipykernel_12/3966350342.py in <module>\r\n      7     number_of_partitions=2,\r\n      8     data_type=\"fp16\",\r\n----> 9     sagemaker_session=session,\r\n     10 )\r\n     11 \r\n\r\n/usr/local/lib/python3.7/site-packages/sagemaker/djl_inference/model.py in __new__(cls, model_id, *args, **kwargs)\r\n    199             )\r\n    200         if model_id.startswith(\"s3://\"):\r\n--> 201             model_config = _get_model_config_properties_from_s3(model_id)\r\n    202         else:\r\n    203             model_config = _get_model_config_properties_from_hf(model_id)\r\n\r\n/usr/local/lib/python3.7/site-packages/sagemaker/djl_inference/model.py in _get_model_config_properties_from_s3(model_s3_uri)\r\n    139     \"\"\"Placeholder docstring\"\"\"\r\n    140 \r\n--> 141     s3_files = s3.S3Downloader.list(model_s3_uri)\r\n    142     model_config = None\r\n    143     for config in defaults.VALID_MODEL_CONFIG_FILES:\r\n\r\n/usr/local/lib/python3.7/site-packages/sagemaker/s3.py in list(s3_uri, sagemaker_session)\r\n    179             [str]: The list of S3 URIs in the given S3 base uri.\r\n    180         \"\"\"\r\n--> 181         sagemaker_session = sagemaker_session or Session()\r\n    182         bucket, key_prefix = parse_s3_url(url=s3_uri)\r\n    183 \r\n\r\n/usr/local/lib/python3.7/site-packages/sagemaker/session.py in __init__(self, boto_session, sagemaker_client, sagemaker_runtime_client, sagemaker_featurestore_runtime_client, default_bucket, settings, sagemaker_metrics_client, sagemaker_config)\r\n    215             sagemaker_featurestore_runtime_client=sagemaker_featurestore_runtime_client,\r\n    216             sagemaker_metrics_client=sagemaker_metrics_client,\r\n--> 217             sagemaker_config=sagemaker_config,\r\n    218         )\r\n    219 \r\n\r\n/usr/local/lib/python3.7/site-packages/sagemaker/session.py in _initialize(self, boto_session, sagemaker_client, sagemaker_runtime_client, sagemaker_featurestore_runtime_client, sagemaker_metrics_client, sagemaker_config)\r\n    237         if self._region_name is None:\r\n    238             raise ValueError(\r\n--> 239                 \"Must setup local AWS configuration with a region supported by SageMaker.\"\r\n    240             )\r\n    241 \r\n\r\nValueError: Must setup local AWS configuration with a region supported by SageMaker.\r\n\r\n```\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.145.0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: DJL\r\n- **Framework version**:\r\n- **Python version**:\r\n- **CPU or GPU**:\r\n- **Custom Docker image (Y/N)**:N\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3769/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3769/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3755", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3755/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3755/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3755/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3755", "id": 1640978125, "node_id": "I_kwDOBpf0x85hz1bN", "number": 3755, "title": "PyTorch model fails when using code_location variable", "user": {"login": "giedzz", "id": 32011715, "node_id": "MDQ6VXNlcjMyMDExNzE1", "avatar_url": "https://avatars.githubusercontent.com/u/32011715?v=4", "gravatar_id": "", "url": "https://api.github.com/users/giedzz", "html_url": "https://github.com/giedzz", "followers_url": "https://api.github.com/users/giedzz/followers", "following_url": "https://api.github.com/users/giedzz/following{/other_user}", "gists_url": "https://api.github.com/users/giedzz/gists{/gist_id}", "starred_url": "https://api.github.com/users/giedzz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/giedzz/subscriptions", "organizations_url": "https://api.github.com/users/giedzz/orgs", "repos_url": "https://api.github.com/users/giedzz/repos", "events_url": "https://api.github.com/users/giedzz/events{/privacy}", "received_events_url": "https://api.github.com/users/giedzz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-03-26T16:26:18Z", "updated_at": "2023-03-27T06:43:03Z", "closed_at": "2023-03-27T06:43:03Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nWhen I try to load PyTorch model using code_location variable it says, that model files could not be accessed. I have the \"sts:AssumeRole\" permission and \"s3:GetObject\" for the bucket that model is in. Furthermore the model is being loaded without any issues when code_location is not given. \r\n\r\n**To reproduce**\r\nA clear, step-by-step set of instructions to reproduce the bug.\r\nUse the following code to deploy model:\r\n```\r\nimport os\r\n\r\nfrom sagemaker.pytorch import PyTorchModel\r\n\r\n\r\npytorch_model = PyTorchModel(model_data='s3://test-sagemaker/output/model-output/model.tar.gz',\r\n                             role='arn:aws:iam::582013076470:role/SageMakerEstimatorTestRole',\r\n                             entry_point='model/code/inference.py',\r\n                             framework_version='1.13.1',\r\n                             py_version='py39',\r\n                             code_location='s3://test-sagemaker-estimator-policy',\r\n                             name='model-output')\r\npredictor = pytorch_model.deploy(instance_type='ml.t2.medium',\r\n                                 initial_instance_count=1,\r\n                                 endpoint_name='resnet-model-endpoint')\r\n```\r\n\r\n**Expected behavior**\r\nThis code should deploy model code for inference.\r\n\r\n**Screenshots or logs**\r\nError that I receive:\r\n`botocore.exceptions.ClientError: An error occurred (ValidationException) when calling the CreateModel operation: Could not access model data at s3://test-sagemaker/model-output/model.tar.gz. Please ensure that the role \"arn:aws:iam::5555555555:role/SageMakerEstimatorTestRole\" exists and that its trust relationship policy allows the action \"sts:AssumeRole\" for the service principal \"sagemaker.amazonaws.com\". Also ensure that the role has \"s3:GetObject\" permissions and that the object is located in eu-west-1.`\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.141.0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: PyTorch\r\n- **Framework version**: 1.13.1\r\n- **Python version**: 3.9\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3755/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3755/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3739", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3739/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3739/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3739/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3739", "id": 1634528982, "node_id": "I_kwDOBpf0x85hbO7W", "number": 3739, "title": "`sagemaker.model.Model.create` doesn't return a model instance", "user": {"login": "KMouratidis", "id": 26832680, "node_id": "MDQ6VXNlcjI2ODMyNjgw", "avatar_url": "https://avatars.githubusercontent.com/u/26832680?v=4", "gravatar_id": "", "url": "https://api.github.com/users/KMouratidis", "html_url": "https://github.com/KMouratidis", "followers_url": "https://api.github.com/users/KMouratidis/followers", "following_url": "https://api.github.com/users/KMouratidis/following{/other_user}", "gists_url": "https://api.github.com/users/KMouratidis/gists{/gist_id}", "starred_url": "https://api.github.com/users/KMouratidis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/KMouratidis/subscriptions", "organizations_url": "https://api.github.com/users/KMouratidis/orgs", "repos_url": "https://api.github.com/users/KMouratidis/repos", "events_url": "https://api.github.com/users/KMouratidis/events{/privacy}", "received_events_url": "https://api.github.com/users/KMouratidis/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-03-21T18:55:35Z", "updated_at": "2023-03-22T11:10:46Z", "closed_at": "2023-03-22T11:10:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "In `sagemaker.workflow.model_step.ModelStep`'s constructor, [the docstring](https://github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/workflow/model_step.py#L53) says:\r\n\r\n> step_args (_ModelStepArguments): The arguments for the `ModelStep` definition, generated by invoking the :func:`~sagemaker.model.Model.register` or :func:`~sagemaker.model.Model.create`\r\n\r\nIf you look at the first one (register), [it returns a ModelPackage instance](https://github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/model.py#L430), however [the second one doesn't return anything](https://github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/model.py#L436-L477).\r\n\r\nI think this might be fixed by adding / modifying a few return statements in these places:\r\n\r\n- add: https://github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/model.py#L688\r\n- add: https://github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/session.py#L3045\r\n- modify: https://github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/session.py#L3057-L3058 (return the response or a `Model` instance instead of the string `name`, or something along those lines? not sure)\r\n\r\nMaking said changes will also help with extending the `ModelStep` class.", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3739/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3739/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3693", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3693/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3693/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3693/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3693", "id": 1607159008, "node_id": "I_kwDOBpf0x85fy0zg", "number": 3693, "title": "ClientError: Failed to invoke sagemaker:CreateHyperParameterTuningJob. Error Details: Only the following fields in TrainingJobDefinition are allowed to change", "user": {"login": "timxieICN", "id": 112183115, "node_id": "U_kgDOBq_HSw", "avatar_url": "https://avatars.githubusercontent.com/u/112183115?v=4", "gravatar_id": "", "url": "https://api.github.com/users/timxieICN", "html_url": "https://github.com/timxieICN", "followers_url": "https://api.github.com/users/timxieICN/followers", "following_url": "https://api.github.com/users/timxieICN/following{/other_user}", "gists_url": "https://api.github.com/users/timxieICN/gists{/gist_id}", "starred_url": "https://api.github.com/users/timxieICN/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/timxieICN/subscriptions", "organizations_url": "https://api.github.com/users/timxieICN/orgs", "repos_url": "https://api.github.com/users/timxieICN/repos", "events_url": "https://api.github.com/users/timxieICN/events{/privacy}", "received_events_url": "https://api.github.com/users/timxieICN/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-03-02T16:52:57Z", "updated_at": "2023-03-06T14:18:45Z", "closed_at": "2023-03-06T14:18:44Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nIt's related to several other bug reports:\r\n- https://github.com/aws/sagemaker-python-sdk/issues/3627\r\n- https://github.com/aws/sagemaker-python-sdk/issues/3598\r\n- https://github.com/aws/sagemaker-python-sdk/pull/3614\r\n\r\nI already installed the latest version of `sagemaker==2.135.0` and `boto3==1.26.81`. However, I'm still having trouble passing the custom environment variable from `Estimator` to `HyperparameterTuner` on my custom ECR image\r\n\r\nNow it's failing in the parameter validation:\r\n```\r\nClientError: Failed to invoke sagemaker:CreateHyperParameterTuningJob. Error Details: Only the following fields in TrainingJobDefinition are allowed to change: [algorithmSpecification, inputDataConfig, outputDataConfig, staticHyperParameters, roleArn, resourceConfig, stoppingCondition, vpcConfig, enableManagedSpotTraining, checkpointConfig].\r\n```\r\n\r\n**To reproduce**\r\nA clear, step-by-step set of instructions to reproduce the bug.\r\n```\r\nscript_preprocess = ScriptProcessor(\r\n    image_uri=CUSTOM_BUILD_IMAGE,\r\n    command=[\"python3\"],\r\n    instance_type=processing_instance_type,\r\n    instance_count=processing_instance_count,\r\n    base_job_name=f\"{base_job_prefix}/mau-conversion-preprocess\",\r\n    sagemaker_session=sagemaker_session,\r\n    role=role,\r\n    env={\r\n          \"STAGE\": \"ALPHA\",\r\n    },\r\n)\r\nstep_process = ProcessingStep(\r\n    name=\"PreprocessMauConversionData\",\r\n    processor=script_preprocess,\r\n    inputs=[\r\n        ProcessingInput(\r\n            input_name=\"input_training\",\r\n            destination=\"/opt/ml/processing/input/training\",\r\n            source=f\"s3://{datalake_bucket}/{base_job_prefix}/\"\r\n            f\"preprocessed/training/2022-10-27/2022-10-27T03_00_29.206816+00_00.csv.gz\",\r\n            s3_data_type=\"S3Prefix\",\r\n            s3_input_mode=\"File\",\r\n            s3_data_distribution_type=\"FullyReplicated\",\r\n            s3_compression_type=\"None\",\r\n            app_managed=False,\r\n        ),\r\n        ProcessingInput(\r\n            input_name=\"input_prediction\",\r\n            destination=\"/opt/ml/processing/input/prediction\",\r\n            source=f\"s3://{datalake_bucket}/{base_job_prefix}/\"\r\n            f\"preprocessed/prediction/2022-10-27/2022-10-27T03_00_29.206816+00_00.csv.gz\",\r\n            s3_data_type=\"S3Prefix\",\r\n            s3_input_mode=\"File\",\r\n            s3_data_distribution_type=\"FullyReplicated\",\r\n            s3_compression_type=\"None\",\r\n            app_managed=False,\r\n        ),\r\n    ],\r\n    outputs=[\r\n        ProcessingOutput(\r\n            output_name=\"train\",\r\n            source=\"/opt/ml/processing/output/train\",\r\n            s3_upload_mode=\"EndOfJob\",\r\n        ),\r\n        ProcessingOutput(\r\n            output_name=\"validation\",\r\n            source=\"/opt/ml/processing/output/validation\",\r\n            s3_upload_mode=\"EndOfJob\",\r\n        ),\r\n        ProcessingOutput(\r\n            output_name=\"test\",\r\n            source=\"/opt/ml/processing/output/test\",\r\n            s3_upload_mode=\"EndOfJob\",\r\n        ),\r\n    ],\r\n    code=os.path.join(BASE_DIR, \"preprocess.py\"),\r\n)\r\n\r\n# Tuning step for xgboost model\r\nxgb_tune = Estimator(\r\n    image_uri=CUSTOM_BUILD_IMAGE,\r\n    instance_count=training_instance_count,\r\n    instance_type=training_instance_type,\r\n    volume_size=5,\r\n    output_path=f\"s3://{default_bucket}/{base_job_prefix}/MauConversionTuneXGB\",\r\n    base_job_name=f\"{base_job_prefix}/mau-conversion-base-tune-xgb\",\r\n    sagemaker_session=sagemaker_session,\r\n    role=role,\r\n    entry_point=os.path.join(BASE_DIR, \"preprocess.py\"),\r\n    environment={\r\n        \"STAGE\": \"ALPHA\",\r\n    },\r\n    metric_definitions=[\r\n        {\r\n            \"Name\": \"validation:accuracy\",\r\n            \"Regex\": \".*validation-accuracy:([-+]?[0-9]*\\.?[0-9]+(?:[eE][-+]?[0-9]+)?).*\"\r\n        }\r\n    ],\r\n)\r\nxgb_tune.set_hyperparameters(\r\n    verbosity=1,\r\n    objective=\"binary:logistic\",\r\n    scale_pos_weight=0.5,\r\n    rate_drop=0.2,\r\n)\r\ntuner_xgb_train = HyperparameterTuner(\r\n    estimator=xgb_tune,\r\n    objective_metric_name=\"validation:accuracy\",\r\n    hyperparameter_ranges={\r\n        \"max_depth\": IntegerParameter(min_value=3, max_value=10, scaling_type=\"Linear\"),\r\n        \"min_child_weight\": IntegerParameter(min_value=1, max_value=5, scaling_type=\"Linear\"),\r\n        \"eta\": ContinuousParameter(min_value=0.01, max_value=0.2, scaling_type=\"Logarithmic\"),\r\n        \"gamma\": ContinuousParameter(min_value=0.1, max_value=0.3, scaling_type=\"Logarithmic\"),\r\n        \"subsample\": ContinuousParameter(min_value=0.75, max_value=1.0, scaling_type=\"Linear\"),\r\n    },\r\n    strategy=\"Bayesian\",\r\n    objective_type=\"Maximize\",\r\n    max_jobs=6,\r\n    max_parallel_jobs=2,\r\n    base_tuning_job_name=f\"{base_job_prefix}/mau-conversion-hyper-tune-xgb\",\r\n    warm_start_config={},\r\n    metric_definitions=[\r\n        {\r\n            \"Name\": \"validation:accuracy\",\r\n            \"Regex\": \".*validation-accuracy:([-+]?[0-9]*\\.?[0-9]+(?:[eE][-+]?[0-9]+)?).*\"\r\n        }\r\n    ],\r\n)\r\nstep_xgb_tune = TuningStep(\r\n    name=\"TuneMauConversionXbgModel\",\r\n    tuner=tuner_xgb_train,\r\n    description=\"This is tuning XGBoost model\",\r\n    inputs={\r\n        \"train\": TrainingInput(\r\n            s3_data=step_process.properties.ProcessingOutputConfig.Outputs[\r\n                \"train\"\r\n            ].S3Output.S3Uri,\r\n            content_type=\"text/csv\",\r\n        ),\r\n        \"validation\": TrainingInput(\r\n            s3_data=step_process.properties.ProcessingOutputConfig.Outputs[\r\n                \"validation\"\r\n            ].S3Output.S3Uri,\r\n            content_type=\"text/csv\",\r\n        ),\r\n    },\r\n    depends_on=[step_process],\r\n)\r\n```\r\n\r\n**Screenshots or logs**\r\n![Screen Shot 2023-03-02 at 11 49 41 AM](https://user-images.githubusercontent.com/112183115/222496745-131d6d95-62b7-4ebf-b7c8-87df72903860.png)\r\n\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.135.0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: Custom framework on custom ECR image\r\n- **Framework version**: Custom framework on custom ECR image\r\n- **Python version**: 3.9\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: Y\r\n\r\n**Python Package**\r\n```\r\nboto3==1.26.81\r\nbotocore==1.29.81\r\nsagemaker==2.135.0\r\n```", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3693/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3693/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3679", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3679/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3679/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3679/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3679", "id": 1597740085, "node_id": "I_kwDOBpf0x85fO5Q1", "number": 3679, "title": "Incorrect image inference for Graviton instance types trained on Huggingface framework", "user": {"login": "mathcass", "id": 918541, "node_id": "MDQ6VXNlcjkxODU0MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/918541?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mathcass", "html_url": "https://github.com/mathcass", "followers_url": "https://api.github.com/users/mathcass/followers", "following_url": "https://api.github.com/users/mathcass/following{/other_user}", "gists_url": "https://api.github.com/users/mathcass/gists{/gist_id}", "starred_url": "https://api.github.com/users/mathcass/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mathcass/subscriptions", "organizations_url": "https://api.github.com/users/mathcass/orgs", "repos_url": "https://api.github.com/users/mathcass/repos", "events_url": "https://api.github.com/users/mathcass/events{/privacy}", "received_events_url": "https://api.github.com/users/mathcass/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-02-24T01:14:37Z", "updated_at": "2023-02-28T16:34:48Z", "closed_at": "2023-02-28T16:34:48Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nI configured and built an estimator using HuggingFace with PyTorch under the hood. Then, I tried to deploy to a ml.c7g.xlarge without really thinking about the fact that it's a Graviton instance with ARM design. \r\n\r\n**To reproduce**\r\nI have private code that reproduces this, but unfortunately I can't share it. However, I think the base of it would be, \r\n\r\n1. Set up an estimator and train a model - I think this is the relevant base to demonstrate which framework I was using\r\n```\r\nHuggingFace(\r\n    ...\r\n    instance_type='ml.p3.2xlarge',\r\n    instance_count=1,\r\n    transformers_version='4.17',\r\n    pytorch_version='1.10',\r\n    py_version='py38',\r\n    ...\r\n)\r\n```\r\n\r\n2. Fit the model. Then deploy it to a ml.c7g.xlarge instance\r\n3. You'll wait a while for the command to error, but in the meantime, you'll get errors like this attached screenshot in Cloudwatch\r\n\r\n![Screen Shot 2023-02-23 at 5 11 14 PM](https://user-images.githubusercontent.com/918541/221067449-88f36fff-3461-489f-a23a-efc32bfe02fe.png)\r\n\r\n**Expected behavior**\r\nI'd expect either of two things. A. If something about my training configuration isn't supported on Graviton, notify me with an error. B. If there's a compatible deployment for my configuration, it should succeed.\r\n\r\n**Screenshots or logs**\r\nI provided a screenshot above of the error I see.\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.134.1\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: Huggingface\r\n- **Framework version**: 4.17\r\n- **Python version**: py38\r\n- **CPU or GPU**: Both (GPU for training, Graviton for inference)\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\nNone that I can think of! But I'm happy to provide further detail if I can. Feel free to ask. \r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3679/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3679/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3627", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3627/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3627/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3627/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3627", "id": 1568229233, "node_id": "I_kwDOBpf0x85deUdx", "number": 3627, "title": "Unknown parameter in TrainingJobDefinition: \"Environment\"", "user": {"login": "DougTrajano", "id": 8703022, "node_id": "MDQ6VXNlcjg3MDMwMjI=", "avatar_url": "https://avatars.githubusercontent.com/u/8703022?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DougTrajano", "html_url": "https://github.com/DougTrajano", "followers_url": "https://api.github.com/users/DougTrajano/followers", "following_url": "https://api.github.com/users/DougTrajano/following{/other_user}", "gists_url": "https://api.github.com/users/DougTrajano/gists{/gist_id}", "starred_url": "https://api.github.com/users/DougTrajano/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DougTrajano/subscriptions", "organizations_url": "https://api.github.com/users/DougTrajano/orgs", "repos_url": "https://api.github.com/users/DougTrajano/repos", "events_url": "https://api.github.com/users/DougTrajano/events{/privacy}", "received_events_url": "https://api.github.com/users/DougTrajano/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2023-02-02T15:08:38Z", "updated_at": "2023-02-07T01:39:24Z", "closed_at": "2023-02-07T01:39:24Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\n\r\nIt's related to another bug that I previously reported in #3598 and #3614 \r\n\r\nNow it's failing in the parameter validation\r\n\r\n```log\r\nParamValidationError: Parameter validation failed:\r\nUnknown parameter in TrainingJobDefinition: \"Environment\", must be one of: DefinitionName, TuningObjective, HyperParameterRanges, StaticHyperParameters, AlgorithmSpecification, RoleArn, InputDataConfig, VpcConfig, OutputDataConfig, ResourceConfig, StoppingCondition, EnableNetworkIsolation, EnableInterContainerTrafficEncryption, EnableManagedSpotTraining, CheckpointConfig, RetryStrategy, HyperParameterTuningResourceConfig\r\n```\r\n\r\n**To reproduce**\r\n\r\n```python\r\nfrom sagemaker.pytorch import PyTorch\r\nfrom sagemaker.tuner import (\r\n    IntegerParameter,\r\n    CategoricalParameter,\r\n    ContinuousParameter,\r\n    HyperparameterTuner\r\n)\r\n\r\ncheckpoint_s3_uri = f\"s3://{bucket_name}/{prefix}/checkpoints\"\r\n\r\ninstance_type = \"ml.g4dn.xlarge\" \r\n# 4 vCPUs, 16 GB RAM, 1 x NVIDIA T4 16GB GPU - $ 0.736 per hour\r\n\r\nestimator = PyTorch(\r\n    entry_point=\"train.py\",\r\n    source_dir=\"ml\",\r\n    role=params.sagemaker_execution_role_arn,\r\n    sagemaker_session=sagemaker_session,\r\n    py_version=\"py38\",\r\n    framework_version=\"1.12.0\",\r\n    instance_count=1,\r\n    instance_type=instance_type,\r\n    use_spot_instances=True,\r\n    max_wait=10800,\r\n    max_run=10800,\r\n    checkpoint_s3_uri=checkpoint_s3_uri,\r\n    checkpoint_local_path=\"/opt/ml/checkpoints\",\r\n    environment={\r\n        \"MLFLOW_TRACKING_URI\": params.mlflow_tracking_uri,\r\n        \"MLFLOW_EXPERIMENT_NAME\": params.mlflow_experiment_name,\r\n        \"MLFLOW_TRACKING_USERNAME\": params.mlflow_tracking_username,\r\n        \"MLFLOW_TRACKING_PASSWORD\": params.mlflow_tracking_password,\r\n        \"MLFLOW_TAGS\": params.mlflow_tags,\r\n        \"MLFLOW_RUN_ID\": mlflow.active_run().info.run_id,\r\n        \"MLFLOW_FLATTEN_PARAMS\": \"True\"\r\n    },\r\n    hyperparameters={\r\n        ## If you want to test the code, uncomment the following lines to use smaller datasets\r\n        # \"max_train_samples\": 100,\r\n        # \"max_val_samples\": 100,\r\n        # \"max_test_samples\": 100,\r\n        \"num_train_epochs\": params.num_train_epochs,\r\n        \"early_stopping_patience\": params.early_stopping_patience,\r\n        \"eval_dataset\": \"validation\",\r\n        \"batch_size\": params.batch_size,\r\n        \"seed\": params.seed\r\n    }\r\n)\r\n\r\ntuner = HyperparameterTuner(\r\n    estimator,\r\n    max_jobs=18,\r\n    max_parallel_jobs=3,\r\n    objective_type=\"Maximize\",\r\n    objective_metric_name=\"eval_f1\",\r\n    metric_definitions=[\r\n        {\r\n            \"Name\": \"eval_f1\",\r\n            \"Regex\": \"eval_f1: ([0-9\\\\.]+)\"\r\n        }\r\n    ],\r\n    hyperparameter_ranges={\r\n        \"learning_rate\": ContinuousParameter(1e-5, 1e-3),\r\n        \"weight_decay\": ContinuousParameter(0.0, 0.1),\r\n        \"adam_beta1\": ContinuousParameter(0.8, 0.999),\r\n        \"adam_beta2\": ContinuousParameter(0.8, 0.999),\r\n        \"adam_epsilon\": ContinuousParameter(1e-8, 1e-6),\r\n        \"label_smoothing_factor\": ContinuousParameter(0.0, 0.1),\r\n        \"optim\": CategoricalParameter(\r\n            [\r\n                \"adamw_hf\",\r\n                \"adamw_torch\",\r\n                \"adamw_apex_fused\",\r\n                \"adafactor\"\r\n            ]\r\n        )\r\n    }\r\n)\r\n```\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.131.0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: PyTorch\r\n- **Framework version**: 1.12.0\r\n- **Python version**: 3.8\r\n- **CPU or GPU**: GPU\r\n- **Custom Docker image (Y/N)**: N", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3627/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3627/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3607", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3607/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3607/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3607/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3607", "id": 1552825079, "node_id": "I_kwDOBpf0x85cjjr3", "number": 3607, "title": "SageMaker creates source code files in default location despite setting output_path", "user": {"login": "j-adamczyk", "id": 50807718, "node_id": "MDQ6VXNlcjUwODA3NzE4", "avatar_url": "https://avatars.githubusercontent.com/u/50807718?v=4", "gravatar_id": "", "url": "https://api.github.com/users/j-adamczyk", "html_url": "https://github.com/j-adamczyk", "followers_url": "https://api.github.com/users/j-adamczyk/followers", "following_url": "https://api.github.com/users/j-adamczyk/following{/other_user}", "gists_url": "https://api.github.com/users/j-adamczyk/gists{/gist_id}", "starred_url": "https://api.github.com/users/j-adamczyk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/j-adamczyk/subscriptions", "organizations_url": "https://api.github.com/users/j-adamczyk/orgs", "repos_url": "https://api.github.com/users/j-adamczyk/repos", "events_url": "https://api.github.com/users/j-adamczyk/events{/privacy}", "received_events_url": "https://api.github.com/users/j-adamczyk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-01-23T10:10:51Z", "updated_at": "2023-01-23T15:57:29Z", "closed_at": "2023-01-23T15:57:29Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nI set `output_path` to directory on S3, e.g. `s3://mybucket/models/`. File with trained model and outputs is created there, in directory named like `pytorch-training-2023-01-23-09-38-39-952`. However, additionally directory with the same name is created in the root of the bucket, like `s3://mybucket/pytorch-training-2023-01-23-09-38-39-952`, with source files for training. I expect `output_path` to be used for all outputs. As it is now, I need to manually move or delete this additional directory in bucket root.\r\n\r\n**To reproduce**\r\nTrain any model on SageMaker, setting `output_path`.\r\n\r\n**Expected behavior**\r\nPut everything to the provided S3 prefix.\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.117.0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: PyTorch\r\n- **Framework version**: 1.12.1\r\n- **Python version**: 3.8\r\n- **CPU or GPU**: GPU\r\n- **Custom Docker image (Y/N)**: N\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3607/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3607/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3598", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3598/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3598/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3598/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3598", "id": 1537554392, "node_id": "I_kwDOBpf0x85bpTfY", "number": 3598, "title": "`HyperparameterTuner` not keeping estimator environment variables", "user": {"login": "Guillem96", "id": 21279306, "node_id": "MDQ6VXNlcjIxMjc5MzA2", "avatar_url": "https://avatars.githubusercontent.com/u/21279306?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Guillem96", "html_url": "https://github.com/Guillem96", "followers_url": "https://api.github.com/users/Guillem96/followers", "following_url": "https://api.github.com/users/Guillem96/following{/other_user}", "gists_url": "https://api.github.com/users/Guillem96/gists{/gist_id}", "starred_url": "https://api.github.com/users/Guillem96/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Guillem96/subscriptions", "organizations_url": "https://api.github.com/users/Guillem96/orgs", "repos_url": "https://api.github.com/users/Guillem96/repos", "events_url": "https://api.github.com/users/Guillem96/events{/privacy}", "received_events_url": "https://api.github.com/users/Guillem96/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-01-18T07:58:06Z", "updated_at": "2023-01-26T07:09:41Z", "closed_at": "2023-01-26T07:09:40Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**Describe the bug**\r\nWhen instanciating an Hyperparameter Tuning Job with `HyperparameterTuner` object, the environment variables declared in the underlying estimator are not provided to the Training Jobs.\r\n\r\nWhen I declare a custom environment variable (`CUSTOM_ENV_VARIABLE`) in the estimator environemnt I should be able to access it in the created training jobs, but that's not the case.\r\n\r\nWhen running the training jobs (of the HPO) I'm getting this output:\r\n\r\n```\r\n\u00a0 | 2023-01-18T08:40:41.013+01:00 | ********************************************************************************\r\n-- | -- | --\r\n\u00a0 | 2023-01-18T08:40:41.013+01:00 | Environment value:\r\n\u00a0 | 2023-01-18T08:40:41.013+01:00 | <NOT-DEFINED>\r\n\u00a0 | 2023-01-18T08:40:41.013+01:00 | ********************************************************************************\r\n```\r\n\r\nSaying that my variable is not defined (see the *to reproduce* section below).\r\n\r\n**To reproduce**\r\n\r\n```python\r\n# Minimal estimator code\r\nimport os\r\n\r\nenv_value = os.environ.get(\"CUSTOM_ENV_VARIABLE\", \"<NOT-DEFINED>\")\r\n\r\nprint(\"*\" * 80)\r\nprint(\"Environment value:\", env_value)\r\nprint(\"*\" * 80)\r\n\r\n# TBD: Training logic\r\n# ...\r\n\r\nprint(\"Accuracy: 0.45345\")  # so HPO does not complain\r\n```\r\n\r\n```python\r\n# Code to instanciate the HPO job\r\n\r\nimport sagemaker\r\nfrom sagemaker.pytorch import PyTorch\r\nfrom sagemaker.tuner import HyperparameterTuner\r\nfrom sagemaker.parameter import CategoricalParameter\r\n\r\npytorch_estimator = PyTorch(\r\n    \"minimal.py\",\r\n    instance_type=\"ml.m5.large\",\r\n    instance_count=1,\r\n    framework_version=\"1.12.1\",\r\n    py_version=\"py38\",\r\n    environment={\"CUSTOM_ENV_VARIABLE\": \"CUSTOM_VALUE\"},\r\n    metric_definitions=[\r\n        {\"Name\": \"accuracy\", \"Regex\": r\"^Accuracy: (\\d*[.]?\\d+)$\"},\r\n    ],\r\n    role=\"<role_arn>\",\r\n)\r\n\r\ntuner = HyperparameterTuner(\r\n    pytorch_estimator,\r\n    objective_metric_name=\"accuracy\",\r\n    hyperparameter_ranges={\r\n        \"mock\": CategoricalParameter([\"a\", \"b\"]),\r\n    },\r\n    metric_definitions=[\r\n        {\"Name\": \"accuracy\", \"Regex\": r\"^Accuracy: (\\d*[.]?\\d+)$\"},\r\n    ],\r\n    base_tuning_job_name=\"minimal-missing-env-bug\",\r\n)\r\n\r\ntuner.fit({\"train\": \"<s3_path>\"})\r\n```\r\n\r\n**Expected behavior**\r\n\r\nI should get this output:\r\n\r\n```\r\n | 2023-01-18T08:40:41.013+01:00 | ********************************************************************************\r\n-- | -- | --\r\n\u00a0 | 2023-01-18T08:40:41.013+01:00 | Environment value:\r\n\u00a0 | 2023-01-18T08:40:41.013+01:00 | CUSTOM_VALUE\r\n\u00a0 | 2023-01-18T08:40:41.013+01:00 | ********************************************************************************\r\n```\r\n\r\nStating that the `CUSTOM_ENV_VARIABLE` is defined and has the `CUSTOM_VALUE` value.\r\n\r\n**System information**\r\n\r\n- **SageMaker Python SDK version**:  2.128.0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: Pytorch\r\n- **Framework version**: 1.12\r\n- **Python version**: py38\r\n- **CPU or GPU**: CPU and GPU (error happening in both machine types)\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3598/reactions", "total_count": 6, "+1": 5, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 1}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3598/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3568", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3568/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3568/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3568/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3568", "id": 1520259693, "node_id": "I_kwDOBpf0x85anVJt", "number": 3568, "title": "Lambda helper doesn't update the lambda function code when using the function_arn parameter", "user": {"login": "idanmoradarthas", "id": 14873156, "node_id": "MDQ6VXNlcjE0ODczMTU2", "avatar_url": "https://avatars.githubusercontent.com/u/14873156?v=4", "gravatar_id": "", "url": "https://api.github.com/users/idanmoradarthas", "html_url": "https://github.com/idanmoradarthas", "followers_url": "https://api.github.com/users/idanmoradarthas/followers", "following_url": "https://api.github.com/users/idanmoradarthas/following{/other_user}", "gists_url": "https://api.github.com/users/idanmoradarthas/gists{/gist_id}", "starred_url": "https://api.github.com/users/idanmoradarthas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/idanmoradarthas/subscriptions", "organizations_url": "https://api.github.com/users/idanmoradarthas/orgs", "repos_url": "https://api.github.com/users/idanmoradarthas/repos", "events_url": "https://api.github.com/users/idanmoradarthas/events{/privacy}", "received_events_url": "https://api.github.com/users/idanmoradarthas/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-01-05T07:48:21Z", "updated_at": "2023-02-24T21:36:57Z", "closed_at": "2023-02-24T21:36:56Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nWe tested ```sagemaker.lambda_helper.Lambda``` with zipped_code_dir parameter and (and also with script parameter, but not together) using the parameter function_arn to identify the lambda function (as we created it outside of python code). We are using the Pipeline object from sagemaker but the function doesn't update the code when we upsert the pipeline code to sagemaker. \r\n\r\nA workaround is to use the update() function. If this is an expected behavior and you need to use the update() function when using the parameter function_arn, it should be written in the documentation here: https://sagemaker.readthedocs.io/en/stable/api/utility/lambda_helper.html\r\n\r\n**To reproduce**\r\n```python\r\nfunc = Lambda(\r\n    function_arn=\"arn:aws:lambda:[region]:[account_id]function:[function_name]\",\r\n    zipped_code_dir=\"lambda_helper.zip\",\r\n    handler=\"lambda_helper.lambda_handler\",\r\n    s3_bucket=sagemaker.Session().default_bucket()\r\n)\r\n```\r\n\r\nThe work around:\r\n```python\r\nf_update_response = func.update()\r\nprint(f_update_response)\r\n```\r\n\r\n**Expected behavior**\r\nThe function will update the code when using upsert of the Pipeline object.\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.52.1. but the bug also reproduces on the latest sagemaker SDK Python version (2.126.0)\r\n- **Python version**: 3.9\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: N\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3568/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3568/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3564", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3564/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3564/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3564/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3564", "id": 1515398987, "node_id": "I_kwDOBpf0x85aUydL", "number": 3564, "title": "ParameterString should be able to be an empty string", "user": {"login": "idanmoradarthas", "id": 14873156, "node_id": "MDQ6VXNlcjE0ODczMTU2", "avatar_url": "https://avatars.githubusercontent.com/u/14873156?v=4", "gravatar_id": "", "url": "https://api.github.com/users/idanmoradarthas", "html_url": "https://github.com/idanmoradarthas", "followers_url": "https://api.github.com/users/idanmoradarthas/followers", "following_url": "https://api.github.com/users/idanmoradarthas/following{/other_user}", "gists_url": "https://api.github.com/users/idanmoradarthas/gists{/gist_id}", "starred_url": "https://api.github.com/users/idanmoradarthas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/idanmoradarthas/subscriptions", "organizations_url": "https://api.github.com/users/idanmoradarthas/orgs", "repos_url": "https://api.github.com/users/idanmoradarthas/repos", "events_url": "https://api.github.com/users/idanmoradarthas/events{/privacy}", "received_events_url": "https://api.github.com/users/idanmoradarthas/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-01-01T08:49:42Z", "updated_at": "2023-01-08T11:18:33Z", "closed_at": "2023-01-08T11:18:33Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the feature you'd like**\r\n```sagemaker.workflow.parameters.ParameterString``` should be able to be an empty string as a default value, and also be able to receive empty string as an input. In sagemaker local mode we are able to put empty string as parameter to the script processor, so it is unclear why in local mode it is working but in the cloud we will get an error.\r\n\r\n**Describe alternatives you've considered**\r\nWe are putting the string \"(empty)\" to represent empty values, Seems redundant.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3564/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3564/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3561", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3561/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3561/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3561/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3561", "id": 1512627126, "node_id": "I_kwDOBpf0x85aKNu2", "number": 3561, "title": "I have lost all my jobs / runs / trials since last week", "user": {"login": "arminvburren", "id": 104854255, "node_id": "U_kgDOBj_y7w", "avatar_url": "https://avatars.githubusercontent.com/u/104854255?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arminvburren", "html_url": "https://github.com/arminvburren", "followers_url": "https://api.github.com/users/arminvburren/followers", "following_url": "https://api.github.com/users/arminvburren/following{/other_user}", "gists_url": "https://api.github.com/users/arminvburren/gists{/gist_id}", "starred_url": "https://api.github.com/users/arminvburren/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arminvburren/subscriptions", "organizations_url": "https://api.github.com/users/arminvburren/orgs", "repos_url": "https://api.github.com/users/arminvburren/repos", "events_url": "https://api.github.com/users/arminvburren/events{/privacy}", "received_events_url": "https://api.github.com/users/arminvburren/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2876754145, "node_id": "MDU6TGFiZWwyODc2NzU0MTQ1", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20experiments", "name": "component: experiments", "color": "F12EE0", "default": false, "description": "Relates to the SageMaker Experiements Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2022-12-28T10:03:48Z", "updated_at": "2023-01-20T01:45:29Z", "closed_at": "2023-01-20T01:45:28Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hello,\r\n\r\nI am not sure if this related to a recent update but as of last week there was an update in the UI and now I can't find the tab with \"Experiments / trial names / jobs\". There's only an \"Experiment\" tab and it says \"no Jobs\" even though there was a lot of jobs before.\r\n\r\nAlso when i try to read the doc there is nothing that looks like what I was using before. Here are images of the script I was using to launch my jobs.\r\n\r\nCan anyone explain what is happening ?\r\n\r\n![1](https://user-images.githubusercontent.com/104854255/209794082-15c6defe-d8c9-4d3a-83c2-0923c69b7442.png)\r\n\r\n![2](https://user-images.githubusercontent.com/104854255/209794712-933598c9-5a4c-49d2-87b9-51ee0ae71ecd.png)\r\n\r\n![3](https://user-images.githubusercontent.com/104854255/209794087-dac9d23e-5cf4-41d7-853a-1ce57acce93e.png)\r\n\r\n![4](https://user-images.githubusercontent.com/104854255/209794348-26ee7ab0-fb98-4924-8a72-75297deb9272.png)\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3561/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3561/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3555", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3555/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3555/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3555/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3555", "id": 1505256965, "node_id": "I_kwDOBpf0x85ZuGYF", "number": 3555, "title": "Calling `pipeline.describe()` before `pipeline.start()` is breaking the cache config for the TrainingStep.", "user": {"login": "cristopherfreitas", "id": 89938554, "node_id": "MDQ6VXNlcjg5OTM4NTU0", "avatar_url": "https://avatars.githubusercontent.com/u/89938554?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cristopherfreitas", "html_url": "https://github.com/cristopherfreitas", "followers_url": "https://api.github.com/users/cristopherfreitas/followers", "following_url": "https://api.github.com/users/cristopherfreitas/following{/other_user}", "gists_url": "https://api.github.com/users/cristopherfreitas/gists{/gist_id}", "starred_url": "https://api.github.com/users/cristopherfreitas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cristopherfreitas/subscriptions", "organizations_url": "https://api.github.com/users/cristopherfreitas/orgs", "repos_url": "https://api.github.com/users/cristopherfreitas/repos", "events_url": "https://api.github.com/users/cristopherfreitas/events{/privacy}", "received_events_url": "https://api.github.com/users/cristopherfreitas/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2022-12-20T20:52:41Z", "updated_at": "2023-03-01T21:32:24Z", "closed_at": "2023-03-01T21:32:23Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nGiven that I have the pipeline properly set, and I'm using cache for the TrainingStep, if I run `pipeline.describe()`, then `pipeline.upsert()` and `pipeline.start()`, I'm getting an error: \r\n\r\n```\r\nClientError: Failed to invoke sagemaker:CreateTrainingJob. Error Details: ProfilerConfig is not allowed to have fields when disabled.\r\n```\r\n\r\n**To reproduce**\r\nThis is what the training step looks like:\r\n```python\r\npipeline_session = PipelineSession()\r\n\r\n# Enable caching for the Training step with 30 days expiration date\r\n# The expiration date follows ISO-8601 https://en.wikipedia.org/wiki/ISO_8601#Durations\r\ncache_config = CacheConfig(enable_caching=True, expire_after=\"P1M\")\r\n\r\n# Training step for generating model artifacts\r\nmodel_path = f\"s3://{sagemaker_session.default_bucket()}/{base_job_prefix}/train\"\r\n\r\nmodel_train = PyTorch(\r\n    entry_point='build.py',\r\n    region=region,\r\n    framework_version=\"1.12\",\r\n    py_version=\"py38\",\r\n    instance_type=\"ml.m5.xlarge\",\r\n    instance_count=1,\r\n    output_path=model_path,\r\n    base_job_name=f\"{base_job_prefix}/train\",\r\n    sagemaker_session=pipeline_session,\r\n    role=role,\r\n    source_dir=BASE_DIR,\r\n    disable_profiler=True\r\n)\r\n\r\nstep_train = TrainingStep(\r\n    name=f\"{base_job_prefix}Train\",\r\n    estimator=model_train,\r\n    cache_config=cache_config\r\n)\r\n```\r\n\r\nThis is the code to create the pipeline:\r\n```python\r\nprint(\"###### Creating/updating a SageMaker Pipeline with the following definition:\")\r\nparsed = json.loads(pipeline.definition())\r\nprint(json.dumps(parsed, indent=2, sort_keys=True))\r\n\r\nall_tags = get_pipeline_custom_tags(args.module_name, args.kwargs, tags)\r\n\r\nupsert_response = pipeline.upsert(\r\n    role_arn=args.role_arn, description=args.description\r\n)\r\n\r\nprint(\"\\n###### Created/Updated SageMaker Pipeline: Response received:\")\r\nprint(upsert_response)\r\n\r\nexecution = pipeline.start()\r\nprint(f\"\\n###### Execution started with PipelineExecutionArn: {execution.arn}\")\r\n\r\nprint(\"Waiting for the execution to finish...\")\r\n```\r\n\r\n**Expected behavior**\r\nI would expect the pipeline to run in the same behavior as if I haven't run `pipeline.describe()`. \r\n\r\n**Screenshots or logs**\r\n<img width=\"386\" alt=\"image\" src=\"https://user-images.githubusercontent.com/89938554/208764029-db8c23ea-c2cc-4d9b-82e3-f9a3542d7f8b.png\">\r\n\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.125.0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: PyTorch\r\n- **Framework version**: 1.12\r\n- **Python version**: 3.8\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\nLooking into the differences between a successful and a failed execution, I found this extra field when failing: `ProfilerConfig.S3OutputPath`. \r\n\r\nIt seems that calling `pipeline.describe()` adds this field in the pipeline configuration even with `disable_profiler=True` in the `PyTorch` estimator. \r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3555/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3555/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3531", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3531/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3531/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3531/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3531", "id": 1492507252, "node_id": "I_kwDOBpf0x85Y9dp0", "number": 3531, "title": "Pinned packaging in v2.121.2 #3514 renders sagemaker uninstallable with other dependencies", "user": {"login": "jmahlik", "id": 38999128, "node_id": "MDQ6VXNlcjM4OTk5MTI4", "avatar_url": "https://avatars.githubusercontent.com/u/38999128?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jmahlik", "html_url": "https://github.com/jmahlik", "followers_url": "https://api.github.com/users/jmahlik/followers", "following_url": "https://api.github.com/users/jmahlik/following{/other_user}", "gists_url": "https://api.github.com/users/jmahlik/gists{/gist_id}", "starred_url": "https://api.github.com/users/jmahlik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jmahlik/subscriptions", "organizations_url": "https://api.github.com/users/jmahlik/orgs", "repos_url": "https://api.github.com/users/jmahlik/repos", "events_url": "https://api.github.com/users/jmahlik/events{/privacy}", "received_events_url": "https://api.github.com/users/jmahlik/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-12-12T18:33:22Z", "updated_at": "2022-12-14T14:44:30Z", "closed_at": "2022-12-14T14:44:30Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**Describe the bug**\r\nA clear and concise description of what the bug is.\r\n\r\nIt looks like #3514 attempted to address packaging changing some exceptions in recent versions. `packaging` was also pinned in this PR to `packaging==20.9` in the `setup.py`. Packaging is quite a widely used dependency, so pinning it is making upgrading sagmaker not possible.\r\n\r\npackaging 20.9 was released in January 2021, so many other dependencies are requiring a more recent version.\r\n\r\n**To reproduce**\r\nA clear, step-by-step set of instructions to reproduce the bug.\r\n\r\n```\r\npython -m pip install  'sagemaker>=2.121.1' 'statsmodels>=0.13.5'\r\n...\r\n\r\nThe conflict is caused by:\r\n    sagemaker 2.121.1 depends on packaging==20.9\r\n    statsmodels 0.13.5 depends on packaging>=21.3\r\n```\r\n\r\n**Expected behavior**\r\nA clear and concise description of what you expected to happen.\r\n\r\nSagemaker is installable with other dependencies. `packaging` should ideally be un-pinned and the exceptions adjusted to account for newer versions. Potentially require at least a recent version of packaging? Maybe `>=22.0`. \r\n\r\n**Screenshots or logs**\r\nIf applicable, add screenshots or logs to help explain your problem.\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.121.2, 2.121.1\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: n/a\r\n- **Framework version**: n/a\r\n- **Python version**: 3.11, 3.10, 3.9, 3.8\r\n- **CPU or GPU**: n/a\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3531/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3531/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3520", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3520/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3520/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3520/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3520", "id": 1486991451, "node_id": "I_kwDOBpf0x85YobBb", "number": 3520, "title": "Transform Integ Test Failure", "user": {"login": "amzn-choeric", "id": 105388439, "node_id": "U_kgDOBkgZlw", "avatar_url": "https://avatars.githubusercontent.com/u/105388439?v=4", "gravatar_id": "", "url": "https://api.github.com/users/amzn-choeric", "html_url": "https://github.com/amzn-choeric", "followers_url": "https://api.github.com/users/amzn-choeric/followers", "following_url": "https://api.github.com/users/amzn-choeric/following{/other_user}", "gists_url": "https://api.github.com/users/amzn-choeric/gists{/gist_id}", "starred_url": "https://api.github.com/users/amzn-choeric/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/amzn-choeric/subscriptions", "organizations_url": "https://api.github.com/users/amzn-choeric/orgs", "repos_url": "https://api.github.com/users/amzn-choeric/repos", "events_url": "https://api.github.com/users/amzn-choeric/events{/privacy}", "received_events_url": "https://api.github.com/users/amzn-choeric/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-12-09T15:57:27Z", "updated_at": "2022-12-09T18:53:30Z", "closed_at": "2022-12-09T18:53:30Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**Describe the bug**\r\nI am not quite sure how the internal pipeline consuming the repo is set up, but I believe the test linked below has been failing for a while (possibly early 2021 or even before that) as we are getting tickets of such failure. The root cause seems to be a bad model. \r\n\r\nhttps://github.com/aws/sagemaker-python-sdk/blob/5f9d0242b2da712507b0664b41335721369f4417/tests/integ/test_inference_pipeline.py#L53\r\n\r\n**To reproduce**\r\nYou should be able to check the internal accounts. Please feel free to message me internally for further specifics.", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3520/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3520/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3484", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3484/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3484/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3484/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3484", "id": 1461749221, "node_id": "I_kwDOBpf0x85XIIXl", "number": 3484, "title": "Accessing argument property in ProcessingStep adds new code ProcessingInput every time", "user": {"login": "wsykala", "id": 38567820, "node_id": "MDQ6VXNlcjM4NTY3ODIw", "avatar_url": "https://avatars.githubusercontent.com/u/38567820?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wsykala", "html_url": "https://github.com/wsykala", "followers_url": "https://api.github.com/users/wsykala/followers", "following_url": "https://api.github.com/users/wsykala/following{/other_user}", "gists_url": "https://api.github.com/users/wsykala/gists{/gist_id}", "starred_url": "https://api.github.com/users/wsykala/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wsykala/subscriptions", "organizations_url": "https://api.github.com/users/wsykala/orgs", "repos_url": "https://api.github.com/users/wsykala/repos", "events_url": "https://api.github.com/users/wsykala/events{/privacy}", "received_events_url": "https://api.github.com/users/wsykala/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": {"login": "brockwade633", "id": 25024717, "node_id": "MDQ6VXNlcjI1MDI0NzE3", "avatar_url": "https://avatars.githubusercontent.com/u/25024717?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brockwade633", "html_url": "https://github.com/brockwade633", "followers_url": "https://api.github.com/users/brockwade633/followers", "following_url": "https://api.github.com/users/brockwade633/following{/other_user}", "gists_url": "https://api.github.com/users/brockwade633/gists{/gist_id}", "starred_url": "https://api.github.com/users/brockwade633/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brockwade633/subscriptions", "organizations_url": "https://api.github.com/users/brockwade633/orgs", "repos_url": "https://api.github.com/users/brockwade633/repos", "events_url": "https://api.github.com/users/brockwade633/events{/privacy}", "received_events_url": "https://api.github.com/users/brockwade633/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "brockwade633", "id": 25024717, "node_id": "MDQ6VXNlcjI1MDI0NzE3", "avatar_url": "https://avatars.githubusercontent.com/u/25024717?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brockwade633", "html_url": "https://github.com/brockwade633", "followers_url": "https://api.github.com/users/brockwade633/followers", "following_url": "https://api.github.com/users/brockwade633/following{/other_user}", "gists_url": "https://api.github.com/users/brockwade633/gists{/gist_id}", "starred_url": "https://api.github.com/users/brockwade633/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brockwade633/subscriptions", "organizations_url": "https://api.github.com/users/brockwade633/orgs", "repos_url": "https://api.github.com/users/brockwade633/repos", "events_url": "https://api.github.com/users/brockwade633/events{/privacy}", "received_events_url": "https://api.github.com/users/brockwade633/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2022-11-23T13:17:32Z", "updated_at": "2022-12-20T13:06:46Z", "closed_at": "2022-12-19T20:12:33Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\n\r\nEvery time you access the `arguments` property in `ProcessingStep`, a new `code` input is added to the `ProcessingInputs`. Additionally each time the property is accessed, a new `sourcedir.tar.gz` file is uploaded to a S3 bucket. \r\n\r\nIf you were to remove the custom `inputs` argument from the example below, the `code` input would not be added, although the `sourcedir.tar.gz` file will still get uploaded to S3.\r\n\r\nBecause input and output names must be unique for a job, this behaviour can result in the error below:\r\n```\r\nClientError: Failed to invoke sagemaker:CreateProcessingJob. Error Details: Input and Output names must be globally unique: [code]\r\n```\r\n\r\n**To reproduce**\r\n```\r\nfrom sagemaker.sklearn import SKLearn\r\nfrom sagemaker.workflow.pipeline import Pipeline\r\nfrom sagemaker.workflow.steps import ProcessingStep\r\nfrom sagemaker.processing import (\r\n    FrameworkProcessor,\r\n    ProcessingInput,\r\n    ProcessingOutput,\r\n)\r\nfrom sagemaker.workflow.pipeline_context import PipelineSession\r\n\r\n\r\nbucket = ''   # Pass your bucket\r\ncode_path = f's3://{bucket}/code'\r\nsession = PipelineSession(default_bucket=bucket)\r\n\r\nproc = FrameworkProcessor(\r\n    estimator_cls=SKLearn,\r\n    sagemaker_session=session,\r\n    framework_version='1.0-1',\r\n    role=session.get_caller_identity_arn(),\r\n    instance_type='ml.m5.xlarge',\r\n    instance_count=1,\r\n    code_location=code_path,\r\n)\r\nstep_args = proc.run(\r\n    code='split.py',\r\n    inputs=[\r\n        ProcessingInput(\r\n            source=f's3://{bucket}',\r\n            destination='/opt/ml/processing/input',\r\n        ),\r\n    ],\r\n    source_dir='proc/'\r\n)\r\nproc_step = ProcessingStep(\r\n    name='Ingest',\r\n    step_args=step_args\r\n)\r\n\r\ndef _print_inputs(args):\r\n    d = {}\r\n    for arg in args:\r\n        name = arg['InputName']\r\n        d[name] = d.get(name, 0) + 1\r\n    print(d)\r\n\r\n_print_inputs(proc_step.arguments['ProcessingInputs'])\r\n_print_inputs(proc_step.arguments['ProcessingInputs'])\r\n_print_inputs(proc_step.arguments['ProcessingInputs'])\r\n```\r\n\r\n**Expected behavior**\r\nThe number of inputs should be equal to `3`. And the code should be uploaded to S3 only once. This was the case in previous versions of sagemaker (`<=2.115.0`).\r\n```\r\n# Output cut for visibility sake (not showing print statements from sagemaker)\r\nJob Name:  <your-job-name>\r\n{'input-1': 1, 'code': 1, 'entrypoint': 1}\r\n{'input-1': 1, 'code': 1, 'entrypoint': 1}\r\n{'input-1': 1, 'code': 1, 'entrypoint': 1}\r\n```\r\n\r\n**Screenshots or logs**\r\n\r\nMeanwhile, the number of inputs is incremented by one every time `arguments` property is accessed. Moreover, the code gets uploaded to S3 every time.\r\n```\r\n# Output cut for visibility sake (not showing print statements from sagemaker)\r\nJob Name:  <your-job-name-1>\r\n{'input-1': 1, 'code': 1, 'entrypoint': 1}\r\nJob Name:  <your-job-name-2>\r\n{'input-1': 1, 'code': 2, 'entrypoint': 1}\r\nJob Name:  <your-job-name-3>\r\n{'input-1': 1, 'code': 3, 'entrypoint': 1}\r\n```\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.116.0, 2.117.0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: SKLearn (N/A - it looks like an error in `ProcessingStep` class.)\r\n- **Framework version**: 1.0-1\r\n- **Python version**: 3.7.10\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\nPossibly, the exact same bug appeared in #3477.\r\nThis does not happen in versions lower than `2.116.0`, meaning that this behaviour was introduced with the addition of `context` object in `PipelineSession`.", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3484/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3484/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3477", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3477/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3477/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3477/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3477", "id": 1458223487, "node_id": "I_kwDOBpf0x85W6rl_", "number": 3477, "title": "ClientError when executing SM Pipeline with multiple Spark processing steps", "user": {"login": "jpcpereira", "id": 9059866, "node_id": "MDQ6VXNlcjkwNTk4NjY=", "avatar_url": "https://avatars.githubusercontent.com/u/9059866?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jpcpereira", "html_url": "https://github.com/jpcpereira", "followers_url": "https://api.github.com/users/jpcpereira/followers", "following_url": "https://api.github.com/users/jpcpereira/following{/other_user}", "gists_url": "https://api.github.com/users/jpcpereira/gists{/gist_id}", "starred_url": "https://api.github.com/users/jpcpereira/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jpcpereira/subscriptions", "organizations_url": "https://api.github.com/users/jpcpereira/orgs", "repos_url": "https://api.github.com/users/jpcpereira/repos", "events_url": "https://api.github.com/users/jpcpereira/events{/privacy}", "received_events_url": "https://api.github.com/users/jpcpereira/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": {"login": "brockwade633", "id": 25024717, "node_id": "MDQ6VXNlcjI1MDI0NzE3", "avatar_url": "https://avatars.githubusercontent.com/u/25024717?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brockwade633", "html_url": "https://github.com/brockwade633", "followers_url": "https://api.github.com/users/brockwade633/followers", "following_url": "https://api.github.com/users/brockwade633/following{/other_user}", "gists_url": "https://api.github.com/users/brockwade633/gists{/gist_id}", "starred_url": "https://api.github.com/users/brockwade633/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brockwade633/subscriptions", "organizations_url": "https://api.github.com/users/brockwade633/orgs", "repos_url": "https://api.github.com/users/brockwade633/repos", "events_url": "https://api.github.com/users/brockwade633/events{/privacy}", "received_events_url": "https://api.github.com/users/brockwade633/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "brockwade633", "id": 25024717, "node_id": "MDQ6VXNlcjI1MDI0NzE3", "avatar_url": "https://avatars.githubusercontent.com/u/25024717?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brockwade633", "html_url": "https://github.com/brockwade633", "followers_url": "https://api.github.com/users/brockwade633/followers", "following_url": "https://api.github.com/users/brockwade633/following{/other_user}", "gists_url": "https://api.github.com/users/brockwade633/gists{/gist_id}", "starred_url": "https://api.github.com/users/brockwade633/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brockwade633/subscriptions", "organizations_url": "https://api.github.com/users/brockwade633/orgs", "repos_url": "https://api.github.com/users/brockwade633/repos", "events_url": "https://api.github.com/users/brockwade633/events{/privacy}", "received_events_url": "https://api.github.com/users/brockwade633/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2022-11-21T16:22:59Z", "updated_at": "2022-12-09T10:43:43Z", "closed_at": "2022-12-09T10:43:43Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nWhen executing a SageMaker Pipeline that includes several PySpark Processing steps, a `ClientError` occurs at the start of the pipeline execution. This seems to be due to the fact that the Spark settings passed to the PySparkProcessor via the `configuration` argument are handled by the SageMaker Python SDK using a `ProcessingInput`, which uses `conf` as input name for each and every `ProcessingInput` created for each of the Spark Processing jobs. This leads to the `ClientError` below, as the input names have to be globally unique.\r\n\r\n**To reproduce**\r\nRun a PySparkProcessor making use of the `configuration` argument to pass Spark configurations such as the following:\r\n\r\n```\r\npyspark_config = [{\r\n    \"Classification\": \"spark-defaults\",\r\n    \"Properties\": {\r\n      \"spark.executor.memory\": \"15g\",\r\n      \"spark.driver.memory\": \"40g\",\r\n}]\r\n```\r\n\r\n**Expected behavior**\r\nSageMaker Pipeline with multiple Spark Processing steps executes successfully.\r\n\r\n**Screenshots or logs**\r\nThe following `ClientError` is displayed in the SageMaker Studio UI:\r\n\r\n```\r\nClientError: Failed to invoke sagemaker:CreateProcessingJob. Error Details: Input and Output names must be globally unique: [conf]\r\n```\r\n\r\n`ProcessingInput` created by SageMaker in multiple jobs has always the same input name (`conf`):\r\n\r\n```\r\n{\r\n    \"AppManaged\": false,\r\n    \"InputName\": \"conf\",\r\n    \"S3Input\": {\r\n    \"LocalPath\": \"/opt/ml/processing/input/conf\",\r\n    \"S3CompressionType\": \"None\",\r\n    \"S3DataDistributionType\": \"FullyReplicated\",\r\n    \"S3DataType\": \"S3Prefix\",\r\n    \"S3InputMode\": \"File\",\r\n    \"S3Uri\": \"XXXXX/configuration.json\"\r\n}\r\n```\r\n* S3Uri masked with XXXXX to hide private information.\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.117\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: Spark\r\n- **Framework version**: Spark 3.1\r\n- **Python version**:  3.7\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: No, using the AWS pre-built image (657317673100.dkr.ecr.eu-west-1.amazonaws.com/sagemaker-spark-processing:3.1-v1)\r\n\r\n**Additional context**\r\nLet me know if you need further information about the reported behavior.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3477/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3477/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3467", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3467/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3467/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3467/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3467", "id": 1444380319, "node_id": "I_kwDOBpf0x85WF36f", "number": 3467, "title": "_repack_script_launcher.sh is overwriting runproc.sh on subsequent pipeline steps making pipeline to fail", "user": {"login": "RicardoHS", "id": 9122812, "node_id": "MDQ6VXNlcjkxMjI4MTI=", "avatar_url": "https://avatars.githubusercontent.com/u/9122812?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RicardoHS", "html_url": "https://github.com/RicardoHS", "followers_url": "https://api.github.com/users/RicardoHS/followers", "following_url": "https://api.github.com/users/RicardoHS/following{/other_user}", "gists_url": "https://api.github.com/users/RicardoHS/gists{/gist_id}", "starred_url": "https://api.github.com/users/RicardoHS/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RicardoHS/subscriptions", "organizations_url": "https://api.github.com/users/RicardoHS/orgs", "repos_url": "https://api.github.com/users/RicardoHS/repos", "events_url": "https://api.github.com/users/RicardoHS/events{/privacy}", "received_events_url": "https://api.github.com/users/RicardoHS/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": {"login": "brockwade633", "id": 25024717, "node_id": "MDQ6VXNlcjI1MDI0NzE3", "avatar_url": "https://avatars.githubusercontent.com/u/25024717?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brockwade633", "html_url": "https://github.com/brockwade633", "followers_url": "https://api.github.com/users/brockwade633/followers", "following_url": "https://api.github.com/users/brockwade633/following{/other_user}", "gists_url": "https://api.github.com/users/brockwade633/gists{/gist_id}", "starred_url": "https://api.github.com/users/brockwade633/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brockwade633/subscriptions", "organizations_url": "https://api.github.com/users/brockwade633/orgs", "repos_url": "https://api.github.com/users/brockwade633/repos", "events_url": "https://api.github.com/users/brockwade633/events{/privacy}", "received_events_url": "https://api.github.com/users/brockwade633/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "brockwade633", "id": 25024717, "node_id": "MDQ6VXNlcjI1MDI0NzE3", "avatar_url": "https://avatars.githubusercontent.com/u/25024717?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brockwade633", "html_url": "https://github.com/brockwade633", "followers_url": "https://api.github.com/users/brockwade633/followers", "following_url": "https://api.github.com/users/brockwade633/following{/other_user}", "gists_url": "https://api.github.com/users/brockwade633/gists{/gist_id}", "starred_url": "https://api.github.com/users/brockwade633/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brockwade633/subscriptions", "organizations_url": "https://api.github.com/users/brockwade633/orgs", "repos_url": "https://api.github.com/users/brockwade633/repos", "events_url": "https://api.github.com/users/brockwade633/events{/privacy}", "received_events_url": "https://api.github.com/users/brockwade633/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 12, "created_at": "2022-11-10T18:31:12Z", "updated_at": "2022-12-13T16:47:58Z", "closed_at": "2022-12-13T16:47:58Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nNot sure if it was introduced in this commit [d5261f2](https://github.com/aws/sagemaker-python-sdk/commit/d5261f2ffa7408a58c9cdf1bba87caededc7b3c0). I have found my pipelines fails when using v2.116.0 instead of v2.112.0. Comparing pipeline.describe() output from when I upsert the pipeline from my local machine (using v2.112.0) vs the one executed on my CI/CD (uses last version available) shows me that if a step uses a custom entrypoint, the S3 path used is the same for all steps. Because runproc.sh is stored there, only the runproc.sh of last step with custom entrypoint will survive.\r\n\r\n**In v2.112.0 pipeline.describe() output**:\r\nMy first step:\r\n```\r\n[...]\r\n{\r\n  \"InputName\": \"entrypoint\",\r\n  \"AppManaged\": false,\r\n  \"S3Input\": {\r\n      \"S3Uri\": \"s3://[...]/tensorflow-2022-11-10-15-11-30-827/source/runproc.sh\",\r\n      \"LocalPath\": \"/opt/ml/processing/input/entrypoint\",\r\n      \"S3DataType\": \"S3Prefix\",\r\n      \"S3InputMode\": \"File\",\r\n      \"S3DataDistributionType\": \"FullyReplicated\",\r\n      \"S3CompressionType\": \"None\"\r\n  }\r\n}\r\n\r\n````\r\nMy second step\r\n```\r\n[...]\r\n  {\r\n      \"InputName\": \"entrypoint\",\r\n      \"AppManaged\": false,\r\n      \"S3Input\": {\r\n          \"S3Uri\": \"s3://[...]/tensorflow-2022-11-10-15-11-31-496/source/runproc.sh\",\r\n          \"LocalPath\": \"/opt/ml/processing/input/entrypoint\",\r\n          \"S3DataType\": \"S3Prefix\",\r\n          \"S3InputMode\": \"File\",\r\n          \"S3DataDistributionType\": \"FullyReplicated\",\r\n          \"S3CompressionType\": \"None\"\r\n      }\r\n  }\r\n```\r\n\r\n**In v2.116.0 pipeline.describe() output**:\r\nMy first step:\r\n```\r\n[...]\r\n  {\r\n      \"InputName\": \"entrypoint\",\r\n      \"AppManaged\": false,\r\n      \"S3Input\": {\r\n          \"S3Uri\": \"s3://[...]/MLPlat-weight-size-prediction/code/11596271372a0f364465cbc82d312815/runproc.sh\",\r\n          \"LocalPath\": \"/opt/ml/processing/input/entrypoint\",\r\n          \"S3DataType\": \"S3Prefix\",\r\n          \"S3InputMode\": \"File\",\r\n          \"S3DataDistributionType\": \"FullyReplicated\",\r\n          \"S3CompressionType\": \"None\"\r\n      }\r\n  }\r\n\r\n````\r\nMy second step\r\n```\r\n[...]\r\n  {\r\n      \"InputName\": \"entrypoint\",\r\n      \"AppManaged\": false,\r\n      \"S3Input\": {\r\n          \"S3Uri\": \"s3://[...]/MLPlat-weight-size-prediction/code/11596271372a0f364465cbc82d312815/runproc.sh\",\r\n          \"LocalPath\": \"/opt/ml/processing/input/entrypoint\",\r\n          \"S3DataType\": \"S3Prefix\",\r\n          \"S3InputMode\": \"File\",\r\n          \"S3DataDistributionType\": \"FullyReplicated\",\r\n          \"S3CompressionType\": \"None\"\r\n      }\r\n  }\r\n```\r\n\r\n\r\n**To reproduce**\r\nUse two steps with custom entrypoint. In 2.112.0 it should work, in 2.116.0 all steps will use the same entrypoint code (the one from the last step defined)\r\n\r\n**Expected behavior**\r\nCustom entrypoint code is not overwritten\r\n\r\n**Screenshots or logs**\r\n-\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.112.0 vs 2.116.0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: Tensorflow\r\n- **Framework version**:  2.4.1\r\n- **Python version**: py37\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**:\r\n\r\n**Additional context**\r\n-\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3467/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3467/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3464", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3464/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3464/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3464/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3464", "id": 1442295688, "node_id": "I_kwDOBpf0x85V96-I", "number": 3464, "title": "Local mode: role chaining/assumed role on notebook instances does not forward correct credentials", "user": {"login": "jmahlik", "id": 38999128, "node_id": "MDQ6VXNlcjM4OTk5MTI4", "avatar_url": "https://avatars.githubusercontent.com/u/38999128?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jmahlik", "html_url": "https://github.com/jmahlik", "followers_url": "https://api.github.com/users/jmahlik/followers", "following_url": "https://api.github.com/users/jmahlik/following{/other_user}", "gists_url": "https://api.github.com/users/jmahlik/gists{/gist_id}", "starred_url": "https://api.github.com/users/jmahlik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jmahlik/subscriptions", "organizations_url": "https://api.github.com/users/jmahlik/orgs", "repos_url": "https://api.github.com/users/jmahlik/repos", "events_url": "https://api.github.com/users/jmahlik/events{/privacy}", "received_events_url": "https://api.github.com/users/jmahlik/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2022-11-09T15:23:32Z", "updated_at": "2023-04-12T21:40:18Z", "closed_at": "2023-04-12T21:40:18Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**Describe the bug**\r\nWhen using role chaining/assumed role in a notebook, the correct creds are not forwarded to the training container via environment vars. Credentials are always obtained from the ec2 metadata service when in a sagemaker notebook with it enabled.\r\n\r\nThe credentials from the boto session's role should be used by default, even if they are temporary, as an assumed role may have different permissions than the notebook's base role.\r\n\r\nSomewhat related to: https://github.com/aws/sagemaker-python-sdk/issues/403. This was assuming users on a notebook would not be using temporary creds.\r\n\r\nRelevant code. Seems like a fix would be to take the token if it does exist no matter what. The correct role could be obtained from the session or from the role passed to the image? Current workaround is to manually pass these as env vars.\r\n\r\nhttps://github.com/aws/sagemaker-python-sdk/blob/885423c26ce7288283bbca7d9c1c53c4d0ccf103/src/sagemaker/local/image.py#L989-1035\r\n\r\n**To reproduce**\r\n\r\nHave a `~/.aws/config` file that assumes a role via the metadata service. This works fine for code outside the container. Boto will refresh the creds whenever it needs to via the metadata service.\r\n\r\n```\r\n[default]\r\n...\r\n\r\n[profile my-profile]\r\nrole_arn =  arn:...:...\r\nrole_session_name = session-name\r\ncredential_source = Ec2InstanceMetadata\r\n```\r\n`export AWS_DEFAULT_PROFILE=my-profile`\r\n\r\nThe notebooks base role has different permissions than the role assumed via the profile. Run a script that uses boto outside the container. Then use local mode. \r\n\r\nscript -- The notebook's base role doesn't have permissions to list certain buckets *but* the assumed role from the profile does.\r\n\r\n```\r\nimport boto3\r\nboto3.client(\"s3\").list_buckets()\r\n```\r\n'\r\nWould result in the bucket not being found/permission errors since the base role from the ec2 instance metadata gets picked up.\r\n\r\n**Expected behavior**\r\nThe same role/creds from an assumed role to be passed to the container at runtime.\r\n\r\n**Screenshots or logs**\r\nIf applicable, add screenshots or logs to help explain your problem.\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.116.0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: script processor\r\n- **Framework version**: n/a\r\n- **Python version**: 3.9\r\n- **CPU or GPU**: cpu\r\n- **Custom Docker image (Y/N)**: y\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3464/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3464/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3458", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3458/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3458/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3458/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3458", "id": 1436301465, "node_id": "I_kwDOBpf0x85VnDiZ", "number": 3458, "title": "TransformStep not handling ModelStep properties correctly - model.tar.gz file not being downloaded", "user": {"login": "fjpa121197", "id": 43655840, "node_id": "MDQ6VXNlcjQzNjU1ODQw", "avatar_url": "https://avatars.githubusercontent.com/u/43655840?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fjpa121197", "html_url": "https://github.com/fjpa121197", "followers_url": "https://api.github.com/users/fjpa121197/followers", "following_url": "https://api.github.com/users/fjpa121197/following{/other_user}", "gists_url": "https://api.github.com/users/fjpa121197/gists{/gist_id}", "starred_url": "https://api.github.com/users/fjpa121197/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fjpa121197/subscriptions", "organizations_url": "https://api.github.com/users/fjpa121197/orgs", "repos_url": "https://api.github.com/users/fjpa121197/repos", "events_url": "https://api.github.com/users/fjpa121197/events{/privacy}", "received_events_url": "https://api.github.com/users/fjpa121197/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-11-04T15:59:28Z", "updated_at": "2022-12-12T22:15:41Z", "closed_at": "2022-12-12T22:15:41Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nI'm trying to run a SageMaker Pipeline, consisting on multiple steps, from data preprocessing to evaluation.\r\n\r\nI'm only using processing jobs for all steps, mainly because I encounter errors when trying to refer to the artifacts of a TrainingStep (as seen here: [#3635](https://github.com/aws/amazon-sagemaker-examples/issues/3635)).\r\n\r\nMy code to define the pipeline steps, for data preparation up to evaluation, is as follows:\r\n\r\n```python\r\n\r\n# Define correct sessions for sagemaker \r\n    sagemaker_session = get_session(region, default_bucket, profile_name)\r\n    if role is None:\r\n        role = sagemaker.session.get_execution_role(sagemaker_session)\r\n\r\n    # Get correct pipeline session (either local or remote session)\r\n    pipeline_session = get_pipeline_session(region, default_bucket, pipeline_mode, profile_name)\r\n\r\n    # Define paths of scripts to be used in the pipeline steps\r\n    # Define jobs prefix to be used for better identification and separation of steps and their artifacts\r\n    if pipeline_mode == \"local\":\r\n        base_job_prefix = f\"local/{base_job_prefix}\"\r\n        processing_code_path = r\"offers/preprocess.py\"\r\n        training_code_path = r\"offers/train.py\"\r\n        evaluation_code_path = r\"offers/evaluate.py\"\r\n        inference_code_path = r\"offers/inference.py\"\r\n    else:\r\n        base_job_prefix = f\"remote/{base_job_prefix}\"\r\n        processing_code_path = os.path.join(BASE_DIR, \"preprocess.py\")\r\n        training_code_path = os.path.join(BASE_DIR, \"train.py\")\r\n        evaluation_code_path = os.path.join(BASE_DIR, \"evaluate.py\")\r\n        inference_code_path = os.path.join(BASE_DIR, \"inference.py\")\r\n\r\n    # DEFINITION OF PARAMETERS FOR PIPELINE EXECUTION\r\n    # Parameters related to instances type and number\r\n    processing_instance_count = ParameterInteger(name=\"ProcessingInstanceCount\", default_value=1)\r\n    processing_instance_type = ParameterString(name=\"ProcessingInstanceType\", default_value=processing_instance_type)\r\n    training_instance_type = ParameterString(name=\"TrainingInstanceType\", default_value=training_instance_type)\r\n\r\n    # model_approval_status = ParameterString(name=\"ModelApprovalStatus\", default_value=\"PendingManualApproval\")\r\n\r\n    # Paramaters where custom docker images are located (to be used in the different steps)\r\n    # For our case, this image has been previously created using the Dockerfile in docker directory, and pushed to private ECR repository\r\n    custom_image_uri = ParameterString(name=\"CustomOffersImage\", default_value=\"XXXXXXXXXX.dkr.ecr.eu-west-1.amazonaws.com/ktp-custom-images-offers:latest\")\r\n    custom_image_inference_uri = ParameterString(name=\"CustomOffersInferenceImage\", default_value=\"XXXXXXXXXXX.dkr.ecr.eu-west-1.amazonaws.com/custom-image-inference:latest\")\r\n\r\n    # Parameters where base data files are located and corresponding file names\r\n    input_data_bucket = ParameterString(name=\"S3BucketInputDataUrl\",default_value=f\"s3://XXX-test-offers-prediction-ml-training-data\")\r\n    # TODO: Change files names when automating export of files to S3\r\n    input_data_files = \"['properties_data_ws_1.csv','offers_data_ws_1.csv','daily_values_ws_1.csv']\"\r\n\r\n    # DEFINITION OF PIPELINE STEPS\r\n    # Processing step for data preprocessing\r\n    sklearn_processor = ScriptProcessor(\r\n        image_uri=custom_image_uri.default_value,\r\n        command=['python3'],\r\n        instance_type=processing_instance_type.default_value,\r\n        instance_count=processing_instance_count.default_value,\r\n        base_job_name=f\"{base_job_prefix}/OffersPrep/sklearn\",\r\n        sagemaker_session=pipeline_session,\r\n        role=role,\r\n    )\r\n    step_args = sklearn_processor.run(\r\n        outputs=[\r\n            ProcessingOutput(output_name=\"train\", source=\"/opt/ml/processing/train\"),\r\n            ProcessingOutput(output_name=\"validation\", source=\"/opt/ml/processing/validation\"),\r\n            ProcessingOutput(output_name=\"test\", source=\"/opt/ml/processing/test\"),\r\n            ProcessingOutput(output_name=\"preprocessor\", source=\"/opt/ml/processing/preprocessor\")\r\n        ],\r\n        code=processing_code_path,\r\n        arguments=[\"--input-data\", input_data_bucket, \"--files-names\", input_data_files],\r\n    )\r\n    step_process = ProcessingStep(\r\n        name=\"PreprocessOffersData\",\r\n        step_args=step_args,\r\n    )\r\n\r\n    # Training step for creating a trained model\r\n    # Context: Sagemaker has 2 types of jobs, processing and training jobs. Training jobs are originally made from training models,\r\n    # while processing jobs are better suited for preparing data, etc.\r\n\r\n    # TODO: See if it is possible to switch from processing job to training job type\r\n\r\n    model_path = f\"s3://{sagemaker_session.default_bucket()}/{base_job_prefix}/OffersTrain\"\r\n    target_name = 'unique_offers_cut'\r\n\r\n    catboost_processor = ScriptProcessor(\r\n        image_uri=custom_image_uri.default_value,\r\n        command=['python3'],\r\n        instance_type=processing_instance_type.default_value,\r\n        instance_count=processing_instance_count.default_value,\r\n        base_job_name=f\"{base_job_prefix}/OffersTrain/cat\",\r\n        sagemaker_session=pipeline_session,\r\n        role=role,\r\n    )\r\n\r\n    step_args = catboost_processor.run(\r\n        inputs=[\r\n            ProcessingInput(\r\n                source=step_process.properties.ProcessingOutputConfig.Outputs[\"train\"].S3Output.S3Uri,\r\n                destination=\"/opt/ml/processing/data/train\",\r\n                input_name=\"train.csv\"\r\n            ),\r\n            ProcessingInput(\r\n                source=step_process.properties.ProcessingOutputConfig.Outputs[\"validation\"].S3Output.S3Uri,\r\n                destination=\"/opt/ml/processing/data/validation\",\r\n                input_name=\"validation.csv\"\r\n            ),\r\n            ProcessingInput(\r\n                source=step_process.properties.ProcessingOutputConfig.Outputs[\"preprocessor\"].S3Output.S3Uri,\r\n                destination=\"/opt/ml/processing/preprocessor\",\r\n                input_name=\"custom_columntransformer.joblib\"\r\n            )\r\n        ],\r\n        code=training_code_path,\r\n        arguments=[\"--model-path\", model_path, \"--target-name\", target_name],\r\n        outputs=[\r\n            ProcessingOutput(output_name=\"model\", source=\"/opt/ml/processing/model\"),\r\n            ProcessingOutput(output_name=\"artifacts\", source=\"/opt/ml/processing/data/training/artifacts\")\r\n        ]\r\n    )\r\n\r\n    step_train = ProcessingStep(\r\n        name=\"TrainingOffersData\",\r\n        step_args=step_args,\r\n    )\r\n\r\n    # processing step for evaluation (model performance in terms of metrics)\r\n    script_eval = ScriptProcessor(\r\n        image_uri=custom_image_uri.default_value,\r\n        command=[\"python3\"],\r\n        instance_type=processing_instance_type.default_value,\r\n        instance_count=1,\r\n        base_job_name=f\"{base_job_prefix}/OffersEval/eval\",\r\n        sagemaker_session=pipeline_session,\r\n        role=role,\r\n    )\r\n    step_args = script_eval.run(\r\n        inputs=[\r\n            ProcessingInput(\r\n                source=step_train.properties.ProcessingOutputConfig.Outputs[\"model\"].S3Output.S3Uri,\r\n                destination=\"/opt/ml/processing/model/estimator\",\r\n                input_name=\"catboost-model\"\r\n    \r\n            ),\r\n            ProcessingInput(\r\n                source=step_process.properties.ProcessingOutputConfig.Outputs[\"test\"].S3Output.S3Uri,\r\n                destination=\"/opt/ml/processing/data/test\",\r\n                input_name=\"test.csv\"\r\n            ),\r\n        ],\r\n        outputs=[\r\n            ProcessingOutput(output_name=\"evaluation\", source=\"/opt/ml/processing/evaluation\"),\r\n            ProcessingOutput(output_name=\"predictions\", source=\"/opt/ml/processing/predictions\")\r\n        ],\r\n        code=evaluation_code_path,\r\n        arguments=[\"--model-name\", \"catboost-model\", \"--target-name\", target_name, \"--supp-feats\", \"['property_id', 'gl_date']\"],\r\n    )\r\n\r\n    evaluation_report = PropertyFile(\r\n        name=\"OffersPredictionEvaluationReport\",\r\n        output_name=\"evaluation\",\r\n        path=\"evaluation.json\",\r\n    )\r\n    step_eval = ProcessingStep(\r\n        name=\"EvaluateOffersModel\",\r\n        step_args=step_args,\r\n        property_files=[evaluation_report],\r\n    )\r\n\r\n    # processing step for evaluation (in terms of business success criteria)\r\n\r\n    script_eval_biz_criteria = ScriptProcessor(\r\n        image_uri=custom_image_uri.default_value,\r\n        command=[\"python3\"],\r\n        instance_type=processing_instance_type.default_value,\r\n        instance_count=1,\r\n        base_job_name=f\"{base_job_prefix}/OffersBizEval/eval\",\r\n        sagemaker_session=pipeline_session,\r\n        role=role,\r\n    )\r\n    step_args = script_eval_biz_criteria.run(\r\n        inputs=[\r\n            ProcessingInput(\r\n                source=step_eval.properties.ProcessingOutputConfig.Outputs[\"predictions\"].S3Output.S3Uri,\r\n                destination=\"/opt/ml/processing/predictions\",\r\n                input_name=\"test_df_predictions.csv\"\r\n            ),\r\n        ],\r\n        outputs=[\r\n            ProcessingOutput(output_name=\"evaluation\", source=\"/opt/ml/processing/evaluation\")\r\n        ],\r\n        code=evaluation_code_path,\r\n        arguments=[\"--evaluate-success\", \"1\"],\r\n    )\r\n\r\n    evaluation_business_report = PropertyFile(\r\n        name=\"OffersPredictionBusinessEvaluationReport\",\r\n        output_name=\"evaluation\",\r\n        path=\"business_evaluation.json\",\r\n    )\r\n    step_eval_biz_criteria = ProcessingStep(\r\n        name=\"EvaluateOffersModelSuccessCriteria\",\r\n        step_args=step_args,\r\n        property_files=[evaluation_business_report],\r\n    )\r\n\r\n```\r\nIn order to create the model, my code is as follows:\r\n\r\n``` python\r\n\r\nif pipeline_mode == \"local\":\r\n        source_dir = r\"offers\"\r\n    else:\r\n        source_dir = r\"pipelines/offers\"\r\n\r\n    model = Model(\r\n        image_uri=custom_image_inference_uri.default_value,\r\n        model_data=Join(on=\"/\",values=[step_train.properties.ProcessingOutputConfig.Outputs[\"artifacts\"].S3Output.S3Uri,\"model.tar.gz\"]),\r\n        entry_point=inference_code_path,\r\n        source_dir=source_dir,\r\n        role=role,\r\n        sagemaker_session=pipeline_session\r\n    )\r\n\r\n    step_create_model = ModelStep(\r\n        name=\"OffersPredictionModel\", step_args=model.create()\r\n    )\r\n\r\n```\r\nWhen testing it locally, everything runs fine, however, when trying to add a TransformStep, when defining it, it is not able to download the inference code, which is in `model.tar.gz`, defined when creating the model.\r\n\r\nThis is how I defined the TransformStep:\r\n\r\n```python\r\n\r\ntransformer = Transformer(\r\n        model_name=step_create_model.properties.ModelName,\r\n        instance_type=training_instance_type.default_value,\r\n        instance_count=1,\r\n        output_path=f\"s3://{default_bucket}/{base_job_prefix}/OffersPrediction/transform\",\r\n        sagemaker_session=pipeline_session,\r\n    )\r\n\r\n    transform_data = Join(\r\n        on=\"/\",\r\n        values=[\r\n            step_process.properties.ProcessingOutputConfig.Outputs[\"test\"].S3Output.S3Uri,\r\n            \"test.csv\",\r\n        ],\r\n    )\r\n\r\n    transform_args = transformer.transform(transform_data, content_type=\"text/csv\")\r\n\r\n    step_transform = TransformStep(name=\"OffersPredictionTransform\", step_args=transform_args)\r\n\r\n```\r\n\r\nAll the steps are included in the Pipeline as follows (added a ConditionStep to check the evaluation results, and based on passing it, to create model and run transform job):\r\n\r\n```python\r\nstep_fail_model_metric = FailStep(\r\n        name=\"OffersPredictionMSEFail\",\r\n        error_message=Join(on=\" \", values=[\"Execution failed due to MSE >\", 3.0]),\r\n    )\r\n\r\n    step_fail_model_success = FailStep(\r\n        name=\"OffersPredictionSuccessCritFail\",\r\n        error_message=Join(on=\" \", values=[\"Execution failed due to success criteria is higher than >\", 1.49])\r\n    )\r\n\r\n\r\n    cond_lte_model_metric = ConditionLessThanOrEqualTo(\r\n        left=JsonGet(\r\n            step_name=step_eval.name,\r\n            property_file=evaluation_report,\r\n            json_path=\"regression_metrics.mse.value\",\r\n        ),\r\n        right=3.0,\r\n    )\r\n\r\n    cond_lte_model_success = ConditionLessThanOrEqualTo(\r\n        left=JsonGet(\r\n            step_name=step_eval_biz_criteria.name,\r\n            property_file=evaluation_business_report,\r\n            json_path=\"success_criteria_1.2022.percentile_75.value\",\r\n        ),\r\n        right=1.49,\r\n    )\r\n\r\n    step_cond = ConditionStep(\r\n        name=\"OffersPredictionCond\",\r\n        conditions=[cond_lte_model_metric, cond_lte_model_success],\r\n        if_steps=[step_create_model, step_transform],\r\n        else_steps=[step_fail_model_metric, step_fail_model_success],\r\n    )\r\n\r\n    # Define pipeline instance using previous defined steps\r\n    pipeline = Pipeline(\r\n        name=pipeline_name,\r\n        parameters=[\r\n            processing_instance_type,\r\n            processing_instance_count,\r\n            training_instance_type,\r\n            # model_approval_status,\r\n            input_data_bucket,\r\n        ],\r\n        steps=[ step_process, \r\n                step_train, \r\n                step_eval,\r\n                step_eval_biz_criteria,\r\n                step_cond\r\n            ],\r\n        sagemaker_session=pipeline_session,\r\n    )\r\n\r\n```\r\n\r\nWhen the step_transform tries to run, it can't locate the inference code, and that has been defined in model_data, when defining Model().\r\n\r\nNot sure why it doesn't download the tar file?\r\n\r\nThe model.tar.gz file looks like this:\r\n```\r\ncode/\r\n--inference.py\r\nopt/\r\n--ml/\r\n---other_dirs/...\r\n---other_dirs/...\r\n---other_dirs/...\r\n\r\n```\r\nMy Dockerfile for the inference is as follows:\r\n```Docker\r\nFROM python:3.8-slim-buster\r\n\r\nRUN pip3 install scikit-learn boto3 sagemaker numpy pandas catboost\r\nENV PYTHONUNBUFFERED=TRUE\r\n\r\nENTRYPOINT [\"python3\", \"code/inference.py\"]\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3458/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3458/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3451", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3451/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3451/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3451/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3451", "id": 1433990875, "node_id": "I_kwDOBpf0x85VePbb", "number": 3451, "title": "multiple calls to pipeline.definition() causes extra \"code\" ProcessingInput to the appended to ProcessingStep", "user": {"login": "nmadan", "id": 8586390, "node_id": "MDQ6VXNlcjg1ODYzOTA=", "avatar_url": "https://avatars.githubusercontent.com/u/8586390?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nmadan", "html_url": "https://github.com/nmadan", "followers_url": "https://api.github.com/users/nmadan/followers", "following_url": "https://api.github.com/users/nmadan/following{/other_user}", "gists_url": "https://api.github.com/users/nmadan/gists{/gist_id}", "starred_url": "https://api.github.com/users/nmadan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nmadan/subscriptions", "organizations_url": "https://api.github.com/users/nmadan/orgs", "repos_url": "https://api.github.com/users/nmadan/repos", "events_url": "https://api.github.com/users/nmadan/events{/privacy}", "received_events_url": "https://api.github.com/users/nmadan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": {"login": "brockwade633", "id": 25024717, "node_id": "MDQ6VXNlcjI1MDI0NzE3", "avatar_url": "https://avatars.githubusercontent.com/u/25024717?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brockwade633", "html_url": "https://github.com/brockwade633", "followers_url": "https://api.github.com/users/brockwade633/followers", "following_url": "https://api.github.com/users/brockwade633/following{/other_user}", "gists_url": "https://api.github.com/users/brockwade633/gists{/gist_id}", "starred_url": "https://api.github.com/users/brockwade633/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brockwade633/subscriptions", "organizations_url": "https://api.github.com/users/brockwade633/orgs", "repos_url": "https://api.github.com/users/brockwade633/repos", "events_url": "https://api.github.com/users/brockwade633/events{/privacy}", "received_events_url": "https://api.github.com/users/brockwade633/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "brockwade633", "id": 25024717, "node_id": "MDQ6VXNlcjI1MDI0NzE3", "avatar_url": "https://avatars.githubusercontent.com/u/25024717?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brockwade633", "html_url": "https://github.com/brockwade633", "followers_url": "https://api.github.com/users/brockwade633/followers", "following_url": "https://api.github.com/users/brockwade633/following{/other_user}", "gists_url": "https://api.github.com/users/brockwade633/gists{/gist_id}", "starred_url": "https://api.github.com/users/brockwade633/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brockwade633/subscriptions", "organizations_url": "https://api.github.com/users/brockwade633/orgs", "repos_url": "https://api.github.com/users/brockwade633/repos", "events_url": "https://api.github.com/users/brockwade633/events{/privacy}", "received_events_url": "https://api.github.com/users/brockwade633/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 8, "created_at": "2022-11-03T01:43:59Z", "updated_at": "2022-12-14T17:28:33Z", "closed_at": "2022-12-05T22:12:43Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "**Describe the bug**\r\nI have multiple calls to `pipeline.definition()` in my notebook. Everytime I make this call, an extra \"code\" ProcessingInput gets appended to my ProcessingStep argument definition\r\n\r\n**To reproduce**\r\n```\r\nprepare_labeled_data_processor = \\\r\n    PyTorchProcessor(\r\n        code_location=code_location(),\r\n        instance_count=1,\r\n        instance_type=\"ml.m5.large\",\r\n        **common_attributes\r\n)\r\n\r\nstep_args = prepare_labeled_data_processor.run(\r\n    source_dir='.',\r\n    code='prepare_labeled_data.py',\r\n    inputs=[ProcessingInput(\r\n        source=p['env/locations/prepared_reviews_labeled_data'],\r\n        destination='/opt/ml/processing/input/data')],\r\n    outputs=[\r\n        ProcessingOutput(\r\n            output_name='labeled-data-train',\r\n            source='/opt/ml/processing/output/train',\r\n            destination=join_expr('labeled-data-train')\r\n        ),\r\n        ProcessingOutput(\r\n            output_name='labeled-data-valid',\r\n            source='/opt/ml/processing/output/valid',\r\n            destination=join_expr('labeled-valid-train')\r\n        )\r\n    ], \r\n    arguments=[\r\n       '--max-lines-per-output-file', '3000',\r\n       '--max-output-files', '20',\r\n       '--train-valid-ratio', train_valid_split_ratio, \r\n       '--seed', seed,\r\n    ], \r\n)\r\n\r\nprepare_labeled_data_step = ProcessingStep(\r\n    name='prepare-labeled-data',\r\n    step_args=step_args,\r\n)\r\n\r\n```\r\n\r\nAfter one call to pipeline.definition(), my step json looks like:\r\n```\r\n{\r\n   \"Arguments\":{\r\n      \"AppSpecification\":{\r\n         \"ContainerArguments\":[\r\n            \"--max-lines-per-output-file\",\r\n            \"3000\",\r\n            \"--max-output-files\",\r\n            \"20\",\r\n            \"--train-valid-ratio\",\r\n            {\r\n               \"Get\":\"Parameters.train_valid_split_ratio\"\r\n            },\r\n            \"--seed\",\r\n            {\r\n               \"Get\":\"Parameters.seed\"\r\n            }\r\n         ],\r\n         \"ContainerEntrypoint\":[\r\n            \"/bin/bash\",\r\n            \"/opt/ml/processing/input/entrypoint/runproc.sh\"\r\n         ],\r\n         \"ImageUri\":\"763104351884.dkr.ecr.eu-west-1.amazonaws.com/pytorch-training:1.10-cpu-py38\"\r\n      },\r\n      \"ProcessingInputs\":[\r\n         {\r\n            \"AppManaged\":false,\r\n            \"InputName\":\"input-1\",\r\n            \"S3Input\":{\r\n               \"LocalPath\":\"/opt/ml/processing/input/data\",\r\n               \"S3CompressionType\":\"None\",\r\n               \"S3DataDistributionType\":\"FullyReplicated\",\r\n               \"S3DataType\":\"S3Prefix\",\r\n               \"S3InputMode\":\"File\",\r\n               \"S3Uri\":\"s3://stackoverflow-dataset/labeled-data/train\"\r\n            }\r\n         },\r\n         {\r\n            \"AppManaged\":false,\r\n            \"InputName\":\"code\",\r\n            \"S3Input\":{\r\n               \"LocalPath\":\"/opt/ml/processing/input/code/\",\r\n               \"S3CompressionType\":\"None\",\r\n               \"S3DataDistributionType\":\"FullyReplicated\",\r\n               \"S3DataType\":\"S3Prefix\",\r\n               \"S3InputMode\":\"File\",\r\n               \"S3Uri\":\"s3://sagemaker-eu-west-1-426334991426/pipeline-code/stackoverflow-clf-small/code/7bf6d0f7251c2ec38f3c2f7b991a1acb/sourcedir.tar.gz\"\r\n            }\r\n         },\r\n         {\r\n            \"AppManaged\":false,\r\n            \"InputName\":\"code\",\r\n            \"S3Input\":{\r\n               \"LocalPath\":\"/opt/ml/processing/input/code/\",\r\n               \"S3CompressionType\":\"None\",\r\n               \"S3DataDistributionType\":\"FullyReplicated\",\r\n               \"S3DataType\":\"S3Prefix\",\r\n               \"S3InputMode\":\"File\",\r\n               \"S3Uri\":\"s3://sagemaker-eu-west-1-426334991426/pipeline-code/stackoverflow-clf-small/code/7bf6d0f7251c2ec38f3c2f7b991a1acb/sourcedir.tar.gz\"\r\n            }\r\n         },\r\n         {\r\n            \"AppManaged\":false,\r\n            \"InputName\":\"entrypoint\",\r\n            \"S3Input\":{\r\n               \"LocalPath\":\"/opt/ml/processing/input/entrypoint\",\r\n               \"S3CompressionType\":\"None\",\r\n               \"S3DataDistributionType\":\"FullyReplicated\",\r\n               \"S3DataType\":\"S3Prefix\",\r\n               \"S3InputMode\":\"File\",\r\n               \"S3Uri\":\"s3://sagemaker-eu-west-1-426334991426/pipeline-code/stackoverflow-clf-small/code/7bf6d0f7251c2ec38f3c2f7b991a1acb/runproc.sh\"\r\n            }\r\n         }\r\n      ],\r\n      \"ProcessingOutputConfig\":{\r\n         \"Outputs\":[\r\n            {\r\n               \"AppManaged\":false,\r\n               \"OutputName\":\"labeled-data-train\",\r\n               \"S3Output\":{\r\n                  \"LocalPath\":\"/opt/ml/processing/output/train\",\r\n                  \"S3UploadMode\":\"EndOfJob\",\r\n                  \"S3Uri\":{\r\n                     \"Std:Join\":{\r\n                        \"On\":\"/\",\r\n                        \"Values\":[\r\n                           \"s3://nlp-article/pipeline-runs\",\r\n                           \"2022\",\r\n                           \"11\",\r\n                           {\r\n                              \"Get\":\"Execution.PipelineExecutionId\"\r\n                           },\r\n                           \"labeled-data-train\"\r\n                        ]\r\n                     }\r\n                  }\r\n               }\r\n            }\r\n```\r\n\r\nAfter every subsequent call, another \"code\" ProcessingInput gets added\r\n**Expected behavior**\r\nNo extra ProcessingInputs are appended\r\n\r\n\r\n**Additional context**\r\nThis issue was noticed in sdk version 2.116. It does not exist in v2.115.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3451/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3451/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3413", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3413/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3413/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3413/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3413", "id": 1408141978, "node_id": "I_kwDOBpf0x85T7oqa", "number": 3413, "title": "Regression in terms of handling the code_location attribute in SM Pipelines", "user": {"login": "navaj0", "id": 14225906, "node_id": "MDQ6VXNlcjE0MjI1OTA2", "avatar_url": "https://avatars.githubusercontent.com/u/14225906?v=4", "gravatar_id": "", "url": "https://api.github.com/users/navaj0", "html_url": "https://github.com/navaj0", "followers_url": "https://api.github.com/users/navaj0/followers", "following_url": "https://api.github.com/users/navaj0/following{/other_user}", "gists_url": "https://api.github.com/users/navaj0/gists{/gist_id}", "starred_url": "https://api.github.com/users/navaj0/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/navaj0/subscriptions", "organizations_url": "https://api.github.com/users/navaj0/orgs", "repos_url": "https://api.github.com/users/navaj0/repos", "events_url": "https://api.github.com/users/navaj0/events{/privacy}", "received_events_url": "https://api.github.com/users/navaj0/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-10-13T16:59:54Z", "updated_at": "2022-11-03T17:08:41Z", "closed_at": "2022-11-03T17:08:41Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**Describe the bug**\r\n\r\nIt worked before, but now breaks my code. It worked at least until 2.100.0 and I was kinda hoping it would be fixed without intervention, but it does not work in 2.104.0, 2.109.0 and 2.110.0.\r\n\r\nI used to provide a string that ended in a \u2018/\u2019, like `f's3://{pipeline_session.default_bucket()}/pipeline-code/' ` But this now results in the below error message when attempting to run a Batch Transform. Please recognize the \u2018//\u2019 in the key.\r\n\r\n```\r\nClientError: Failed to download model data(bucket: sagemaker-eu-west-1-426334991426, key: pipeline-code//pytorch-inference-2022-10-12-14-48-22-161/pipelines-otzuzj9grt59-lr-bow-RepackModel-0-bVEhzyl7Ih/output/model.tar.gz). NoSuchKey (HTTP StatusCode: 404)\r\n```\r\n\r\naws s3 ls would still see the model tarball, but not the Batch Transform. Removing the slash from the code location \u201cworks\u201d (as in does not create an error message), but then I have no separation between the pipeline prefix and the artifact name, e.g. `pipeline-codepytorchinference ...`\r\n\r\n**To reproduce**\r\n\r\nExample:\r\n\r\n```\r\nteacher_model = PyTorchModel(\r\n    model_data=teacher_training_step.properties.ModelArtifacts.S3ModelArtifacts,\r\n    **common_attributes,\r\n    code_location=f's3://{pipeline_session.default_bucket()}/pipeline-code/',\r\n    source_dir='.',\r\n    entry_point='inference.py',\r\n) \r\n```\r\nIn the first training job config in the pipeline json dump, you will find:\r\n```\r\n'OutputDataConfig': {'S3OutputPath': 's3://sagemaker-eu-west-1-426334991426/pipeline-code//pytorch-inference-2022-10-12-16-00-45-984'},\r\n```\r\n\r\n\r\n**Expected behavior**\r\nA clear and concise description of what you expected to happen.\r\n\r\n**Screenshots or logs**\r\nIf applicable, add screenshots or logs to help explain your problem.\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**:\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**:\r\n- **Framework version**:\r\n- **Python version**:\r\n- **CPU or GPU**:\r\n- **Custom Docker image (Y/N)**:\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3413/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3413/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3405", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3405/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3405/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3405/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/pull/3405", "id": 1403736071, "node_id": "PR_kwDOBpf0x85Ahhv7", "number": 3405, "title": "fix: fix ml_inf to ml_inf1 in Neo multi-version support", "user": {"login": "HappyAmazonian", "id": 91216626, "node_id": "MDQ6VXNlcjkxMjE2NjI2", "avatar_url": "https://avatars.githubusercontent.com/u/91216626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/HappyAmazonian", "html_url": "https://github.com/HappyAmazonian", "followers_url": "https://api.github.com/users/HappyAmazonian/followers", "following_url": "https://api.github.com/users/HappyAmazonian/following{/other_user}", "gists_url": "https://api.github.com/users/HappyAmazonian/gists{/gist_id}", "starred_url": "https://api.github.com/users/HappyAmazonian/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/HappyAmazonian/subscriptions", "organizations_url": "https://api.github.com/users/HappyAmazonian/orgs", "repos_url": "https://api.github.com/users/HappyAmazonian/repos", "events_url": "https://api.github.com/users/HappyAmazonian/events{/privacy}", "received_events_url": "https://api.github.com/users/HappyAmazonian/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": {"login": "knikure", "id": 110067132, "node_id": "U_kgDOBo99vA", "avatar_url": "https://avatars.githubusercontent.com/u/110067132?v=4", "gravatar_id": "", "url": "https://api.github.com/users/knikure", "html_url": "https://github.com/knikure", "followers_url": "https://api.github.com/users/knikure/followers", "following_url": "https://api.github.com/users/knikure/following{/other_user}", "gists_url": "https://api.github.com/users/knikure/gists{/gist_id}", "starred_url": "https://api.github.com/users/knikure/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/knikure/subscriptions", "organizations_url": "https://api.github.com/users/knikure/orgs", "repos_url": "https://api.github.com/users/knikure/repos", "events_url": "https://api.github.com/users/knikure/events{/privacy}", "received_events_url": "https://api.github.com/users/knikure/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "knikure", "id": 110067132, "node_id": "U_kgDOBo99vA", "avatar_url": "https://avatars.githubusercontent.com/u/110067132?v=4", "gravatar_id": "", "url": "https://api.github.com/users/knikure", "html_url": "https://github.com/knikure", "followers_url": "https://api.github.com/users/knikure/followers", "following_url": "https://api.github.com/users/knikure/following{/other_user}", "gists_url": "https://api.github.com/users/knikure/gists{/gist_id}", "starred_url": "https://api.github.com/users/knikure/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/knikure/subscriptions", "organizations_url": "https://api.github.com/users/knikure/orgs", "repos_url": "https://api.github.com/users/knikure/repos", "events_url": "https://api.github.com/users/knikure/events{/privacy}", "received_events_url": "https://api.github.com/users/knikure/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 48, "created_at": "2022-10-10T21:35:40Z", "updated_at": "2022-12-02T19:50:06Z", "closed_at": "2022-12-02T19:50:06Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/pulls/3405", "html_url": "https://github.com/aws/sagemaker-python-sdk/pull/3405", "diff_url": "https://github.com/aws/sagemaker-python-sdk/pull/3405.diff", "patch_url": "https://github.com/aws/sagemaker-python-sdk/pull/3405.patch", "merged_at": "2022-12-02T19:50:06Z"}, "body": "*Issue #, if available:*\r\nThere was a typo \"ml_inf\" which should be \"ml_inf1\"\r\n\r\n*Description of changes:*\r\nFixed the typo\r\n\r\n*Testing done:*\r\nUnit tests\r\n\r\n## Merge Checklist\r\n\r\n_Put an `x` in the boxes that apply. You can also fill these out after creating the PR. If you're unsure about any of them, don't hesitate to ask. We're here to help! This is simply a reminder of what we are going to look for before merging your pull request._\r\n\r\n#### General\r\n\r\n- [x] I have read the [CONTRIBUTING](https://github.com/aws/sagemaker-python-sdk/blob/master/CONTRIBUTING.md) doc\r\n- [x] I certify that the changes I am introducing will be backward compatible, and I have discussed concerns about this, if any, with the Python SDK team\r\n- [x] I used the commit message format described in [CONTRIBUTING](https://github.com/aws/sagemaker-python-sdk/blob/master/CONTRIBUTING.md#committing-your-change)\r\n- [x] I have passed the region in to all S3 and STS clients that I've initialized as part of this change.\r\n- [x] I have updated any necessary documentation, including [READMEs](https://github.com/aws/sagemaker-python-sdk/blob/master/README.rst) and [API docs](https://github.com/aws/sagemaker-python-sdk/tree/master/doc) (if appropriate)\r\n\r\n#### Tests\r\n\r\n- [x] I have added tests that prove my fix is effective or that my feature works (if appropriate)\r\n- [x] I have added unit and/or integration tests as appropriate to ensure backward compatibility of the changes\r\n- [x] I have checked that my tests are not configured for a specific region or account (if appropriate)\r\n- [x] I have used [`unique_name_from_base`](https://github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/utils.py#L77) to create resource names in integ tests (if appropriate)\r\n\r\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3405/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3405/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3402", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3402/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3402/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3402/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3402", "id": 1402918619, "node_id": "I_kwDOBpf0x85Tntbb", "number": 3402, "title": "Attribute error in preprocessing.py", "user": {"login": "n4vya", "id": 19608919, "node_id": "MDQ6VXNlcjE5NjA4OTE5", "avatar_url": "https://avatars.githubusercontent.com/u/19608919?v=4", "gravatar_id": "", "url": "https://api.github.com/users/n4vya", "html_url": "https://github.com/n4vya", "followers_url": "https://api.github.com/users/n4vya/followers", "following_url": "https://api.github.com/users/n4vya/following{/other_user}", "gists_url": "https://api.github.com/users/n4vya/gists{/gist_id}", "starred_url": "https://api.github.com/users/n4vya/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/n4vya/subscriptions", "organizations_url": "https://api.github.com/users/n4vya/orgs", "repos_url": "https://api.github.com/users/n4vya/repos", "events_url": "https://api.github.com/users/n4vya/events{/privacy}", "received_events_url": "https://api.github.com/users/n4vya/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-10-10T10:08:43Z", "updated_at": "2022-10-10T10:36:14Z", "closed_at": "2022-10-10T10:35:06Z", "author_association": "NONE", "active_lock_reason": null, "body": "Attribute error \r\n\r\n**To reproduce**\r\n\r\n\r\nSKLearnProcessor(framework_version='0.20.0',\r\n                                                 role=sagemaker.get_execution_role(), \r\n                                                 base_job_name = 'preprocess'\r\n                                                 sagemaker_session=boto3.session.Session(), \r\n                                                 instance_count=1,\r\n                                                 instance_type='ml.m5.xlarge')\r\n\r\n\r\nI get the following error:\r\nAttributeError: 'Session' object has no attribute 'boto_region_name'\r\n\r\nI suspect the code in line 94 on sagemaker-python-sdk/blob/master/src/sagemaker/sklearn/processing.py should be `session.region_name` instead of` boto_region_name`\r\n**Screenshots or logs**\r\n\r\n\r\n**System information**\r\nTrying to execute this in AWS Sagemaker studio\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3402/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3402/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3392", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3392/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3392/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3392/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3392", "id": 1396733696, "node_id": "I_kwDOBpf0x85TQHcA", "number": 3392, "title": "SageMaker pipeline Caching Pipeline Steps not working for Transform step", "user": {"login": "mouhannadali", "id": 17967903, "node_id": "MDQ6VXNlcjE3OTY3OTAz", "avatar_url": "https://avatars.githubusercontent.com/u/17967903?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mouhannadali", "html_url": "https://github.com/mouhannadali", "followers_url": "https://api.github.com/users/mouhannadali/followers", "following_url": "https://api.github.com/users/mouhannadali/following{/other_user}", "gists_url": "https://api.github.com/users/mouhannadali/gists{/gist_id}", "starred_url": "https://api.github.com/users/mouhannadali/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mouhannadali/subscriptions", "organizations_url": "https://api.github.com/users/mouhannadali/orgs", "repos_url": "https://api.github.com/users/mouhannadali/repos", "events_url": "https://api.github.com/users/mouhannadali/events{/privacy}", "received_events_url": "https://api.github.com/users/mouhannadali/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2022-10-04T19:17:44Z", "updated_at": "2023-01-23T21:49:26Z", "closed_at": "2023-01-23T21:49:26Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nCaching Pipeline Steps will not work for the Transform step if a ModelStep step is before\r\n\r\n**To reproduce**\r\nI have created a Sagemaker pipeline consisting of preprocessing step -> ModelStep -> transfer step and then -> postprocessing step\r\nI have activated the Caching Pipeline and it is working for the preprocessing step but for the transfer step, it is not working. I believe this because inside the model step we need to call `model.create()` every time we execute the pipeline which means the input parameters for the transfer step are changing. however, I couldn't find any way to have the model step fixed (without model.create())\r\n\r\n**Expected behavior**\r\nCaching Pipeline Steps should be working for the Transform step if ModelStep is executed before\r\n\r\n**Screenshots or logs**\r\nIf applicable, add screenshots or logs to help explain your problem.\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**:\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**:\r\n- **Framework version**:\r\n- **Python version**:\r\n- **CPU or GPU**:\r\n- **Custom Docker image (Y/N)**:\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3392/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3392/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3389", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3389/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3389/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3389/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3389", "id": 1395130270, "node_id": "I_kwDOBpf0x85TJ_-e", "number": 3389, "title": "FrameworkProcessor does not use output_kms_key when uploading the code artifact", "user": {"login": "szamarin", "id": 7694916, "node_id": "MDQ6VXNlcjc2OTQ5MTY=", "avatar_url": "https://avatars.githubusercontent.com/u/7694916?v=4", "gravatar_id": "", "url": "https://api.github.com/users/szamarin", "html_url": "https://github.com/szamarin", "followers_url": "https://api.github.com/users/szamarin/followers", "following_url": "https://api.github.com/users/szamarin/following{/other_user}", "gists_url": "https://api.github.com/users/szamarin/gists{/gist_id}", "starred_url": "https://api.github.com/users/szamarin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/szamarin/subscriptions", "organizations_url": "https://api.github.com/users/szamarin/orgs", "repos_url": "https://api.github.com/users/szamarin/repos", "events_url": "https://api.github.com/users/szamarin/events{/privacy}", "received_events_url": "https://api.github.com/users/szamarin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-10-03T18:14:13Z", "updated_at": "2023-04-28T15:03:24Z", "closed_at": "2023-04-27T00:15:29Z", "author_association": "NONE", "active_lock_reason": null, "body": "The Framework processor creates an Estimator when uploading the code artifact (sourcedir.tar.gz) to S3. However when instantiating the estimator, the output_kms_key is not passed to the constructor ([code](https://github.com/aws/sagemaker-python-sdk/blob/342f2187010f191e15f5c66b93f5a7f0335b7120/src/sagemaker/processing.py#L1741))\r\n\r\n```\r\n    def _upload_payload(\r\n        self,\r\n        entry_point: str,\r\n        source_dir: Optional[str],\r\n        dependencies: Optional[List[str]],\r\n        git_config: Optional[Dict[str, str]],\r\n        job_name: str,\r\n    ) -> \"sagemaker.estimator.Framework\":  # type: ignore[name-defined]   # noqa: F821\r\n        \"\"\"Upload payload sourcedir.tar.gz to S3.\"\"\"\r\n        # A new estimator instance is required, because each call to ScriptProcessor.run() can\r\n        # use different codes.\r\n        estimator = self._create_estimator(\r\n            entry_point=entry_point,\r\n            source_dir=source_dir,\r\n            dependencies=dependencies,\r\n            git_config=git_config,\r\n        )\r\n\r\n        estimator._prepare_for_training(job_name=job_name)\r\n        logger.info(\r\n            \"Uploaded %s to %s\",\r\n            estimator.source_dir,\r\n            estimator._hyperparameters[\"sagemaker_submit_directory\"],\r\n        )\r\n\r\n        return estimator\r\n```\r\nIf a customer has a bucket policy that requires a SSE with KMS, they are unable to use the Frameworkprocessor. \r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3389/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 1}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3389/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3384", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3384/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3384/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3384/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3384", "id": 1391118499, "node_id": "I_kwDOBpf0x85S6sij", "number": 3384, "title": "Cache does not work with the PySparkProcessor class", "user": {"login": "HarryPommier", "id": 50177956, "node_id": "MDQ6VXNlcjUwMTc3OTU2", "avatar_url": "https://avatars.githubusercontent.com/u/50177956?v=4", "gravatar_id": "", "url": "https://api.github.com/users/HarryPommier", "html_url": "https://github.com/HarryPommier", "followers_url": "https://api.github.com/users/HarryPommier/followers", "following_url": "https://api.github.com/users/HarryPommier/following{/other_user}", "gists_url": "https://api.github.com/users/HarryPommier/gists{/gist_id}", "starred_url": "https://api.github.com/users/HarryPommier/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/HarryPommier/subscriptions", "organizations_url": "https://api.github.com/users/HarryPommier/orgs", "repos_url": "https://api.github.com/users/HarryPommier/repos", "events_url": "https://api.github.com/users/HarryPommier/events{/privacy}", "received_events_url": "https://api.github.com/users/HarryPommier/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-09-29T16:01:36Z", "updated_at": "2022-12-20T18:13:14Z", "closed_at": "2022-12-20T18:13:14Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nIt seems that the cache mechanism does not work with the PySparkProcessor.\r\n\r\n**To reproduce**\r\n\r\n```\r\npyspark_processor = PySparkProcessor(\r\n    base_job_name=\"sm-spark\",\r\n    framework_version=\"3.1\",\r\n    role=role_arn,\r\n    instance_type=\"ml.m5.xlarge\",\r\n    instance_count=8,\r\n    sagemaker_session=pipeline_session,\r\n    max_runtime_in_seconds=2400,\r\n)\r\n\r\nstep_process_args = pyspark_processor.run(\r\n    submit_app=\"steps/preprocess.py\",\r\n    outputs=[ProcessingOutput(output_name=\"train\", source=\"/opt/ml/processing/output\", destination=f\"s3://{static_bucket}/{static_prefix}\")],\r\n)\r\n\r\nstep_process = ProcessingStep(\r\n    name=\"PySparkPreprocessing\",\r\n    step_args=step_process_args,\r\n    cache_config=cache_config,\r\n)\r\n```\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.109.0\r\n\r\n\r\n**Additional context**\r\nI think #2790 does not solve the caching problem when using the \"PySparkProcessor\" class. \r\nAs far as I understand, this piece of code (src/sagemaker/workflow/steps.py) :\r\n```\r\n    if code:\r\n        code_url = urlparse(code)\r\n        if code_url.scheme == \"\" or code_url.scheme == \"file\":\r\n            # By default, Processor will upload the local code to an S3 path\r\n            # containing a timestamp. This causes cache misses whenever a\r\n            # pipeline is updated, even if the underlying script hasn't changed.\r\n            # To avoid this, hash the contents of the script and include it\r\n            # in the job_name passed to the Processor, which will be used\r\n            # instead of the timestamped path.\r\n            self.job_name = self._generate_code_upload_path()\r\n```\r\nis only executed when the \"code\" argument  is provided. This is not the case when using PySparkProcessor since we only provide a \"submit_app\" argument. \r\n\r\nI found a temporary workaround, consisting of providing a static s3 path for the \"submit_app\" parameter (otherwise a time-stamped path is always generated and makes the cache fail).\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3384/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3384/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3358", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3358/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3358/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3358/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/pull/3358", "id": 1372320087, "node_id": "PR_kwDOBpf0x84-6QPY", "number": 3358, "title": "fix: Add regex for short-form sagemaker-xgboost tags", "user": {"login": "mabunday", "id": 15115482, "node_id": "MDQ6VXNlcjE1MTE1NDgy", "avatar_url": "https://avatars.githubusercontent.com/u/15115482?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mabunday", "html_url": "https://github.com/mabunday", "followers_url": "https://api.github.com/users/mabunday/followers", "following_url": "https://api.github.com/users/mabunday/following{/other_user}", "gists_url": "https://api.github.com/users/mabunday/gists{/gist_id}", "starred_url": "https://api.github.com/users/mabunday/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mabunday/subscriptions", "organizations_url": "https://api.github.com/users/mabunday/orgs", "repos_url": "https://api.github.com/users/mabunday/repos", "events_url": "https://api.github.com/users/mabunday/events{/privacy}", "received_events_url": "https://api.github.com/users/mabunday/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 25, "created_at": "2022-09-14T04:39:00Z", "updated_at": "2022-10-01T20:33:33Z", "closed_at": "2022-10-01T20:33:33Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/pulls/3358", "html_url": "https://github.com/aws/sagemaker-python-sdk/pull/3358", "diff_url": "https://github.com/aws/sagemaker-python-sdk/pull/3358.diff", "patch_url": "https://github.com/aws/sagemaker-python-sdk/pull/3358.patch", "merged_at": "2022-10-01T20:33:33Z"}, "body": "*Issue #, if available:*\r\n\r\n*Description of changes:*\r\n\r\nThe json schemas for `sagemaker-xgboost` versions `1.2-1`, `1.2-2`, `1.3-1`, and `1.5-1` do not have the fields `processors` and `py_versions`. This causes the function `sagemaker.image_uris.retrieve` to return an ECR URI that is incorrectly parsed in the XGB estimator because the format does not match what is expected: https://github.com/aws/sagemaker-python-sdk/blob/v2.105.0/src/sagemaker/xgboost/estimator.py#L268-L277\r\n\r\nThe following lines of code demonstrate the difference between `1.0-1` - which has these fields - and `1.5-1`, which does not:\r\n\r\n```python3\r\nimport sagemaker\r\n\r\nprint(sagemaker.image_uris.retrieve(\"xgboost\", \"us-west-2\", \"1.0-1\"))\r\nprint(sagemaker.image_uris.retrieve(\"xgboost\", \"us-west-2\", \"1.5-1\"))\r\n>>> 246618743249.dkr.ecr.us-west-2.amazonaws.com/sagemaker-xgboost:1.0-1-cpu-py3\r\n>>> 246618743249.dkr.ecr.us-west-2.amazonaws.com/sagemaker-xgboost:1.5-1\r\n``` \r\n\r\n```python3\r\nIn [6]: framework_name_from_image(\"246618743249.dkr.ecr.us-west-2.amazonaws.com/sagemaker-xgboost:1.5-1\")\r\nOut[6]: (None, None, None, None)\r\n\r\nIn [7]: framework_name_from_image(\"246618743249.dkr.ecr.us-west-2.amazonaws.com/sagemaker-xgboost:1.5-1-cpu-py3\")\r\nOut[7]: ('xgboost', 'py3', '1.5-1-cpu-py3', None)\r\n```\r\n\r\nNote: All `sagemaker-xgboost` images are published to production ECRs with the tags `<xgboost_version>-1` and `<xgboost_version>-1-cpu-py3`. These tags are aliases for each other and the images they return are identical.\r\n\r\nThe `processors` and `py_versions` fields cannot just be added to the schemas for `1.2-1`, `1.2-2`, `1.3-1`, and `1.5-1` because the images `-cpu-py3` also have GPU capabilities. Adding a processors field with only CPU as the value causes validation errors if a GPU instance is used with one of these images. Therefore, this change instead modifies `framework_name_from_image` and `framework_version_from_tag` to accommodate the short-form alias if it is passed. \r\n\r\n*Testing done:*\r\n\r\n```\r\nconda create -n sm_sdk python=3.8\r\npip install --upgrade .[test]\r\ntox tests/unit\r\n```\r\n\r\n## Merge Checklist\r\n\r\n_Put an `x` in the boxes that apply. You can also fill these out after creating the PR. If you're unsure about any of them, don't hesitate to ask. We're here to help! This is simply a reminder of what we are going to look for before merging your pull request._\r\n\r\n#### General\r\n\r\n- [x] I have read the [CONTRIBUTING](https://github.com/aws/sagemaker-python-sdk/blob/master/CONTRIBUTING.md) doc\r\n- [x] I certify that the changes I am introducing will be backword compatible, and I have discussed concerns about this, if any, with the Python SDK team\r\n- [x] I used the commit message format described in [CONTRIBUTING](https://github.com/aws/sagemaker-python-sdk/blob/master/CONTRIBUTING.md#committing-your-change)\r\n- [x] I have passed the region in to all S3 and STS clients that I've initialized as part of this change.\r\n- [x] I have updated any necessary documentation, including [READMEs](https://github.com/aws/sagemaker-python-sdk/blob/master/README.rst) and [API docs](https://github.com/aws/sagemaker-python-sdk/tree/master/doc) (if appropriate)\r\n\r\n#### Tests\r\n\r\n- [x] I have added tests that prove my fix is effective or that my feature works (if appropriate)\r\n- [x] I have added unit and/or integration tests as appropriate to ensure backward compatibility of the changes\r\n- [x] I have checked that my tests are not configured for a specific region or account (if appropriate)\r\n- [x] I have used [`unique_name_from_base`](https://github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/utils.py#L77) to create resource names in integ tests (if appropriate)\r\n\r\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3358/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3358/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3326", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3326/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3326/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3326/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3326", "id": 1348523563, "node_id": "I_kwDOBpf0x85QYNYr", "number": 3326, "title": "Relax the docker version for local mode extra", "user": {"login": "jmahlik", "id": 38999128, "node_id": "MDQ6VXNlcjM4OTk5MTI4", "avatar_url": "https://avatars.githubusercontent.com/u/38999128?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jmahlik", "html_url": "https://github.com/jmahlik", "followers_url": "https://api.github.com/users/jmahlik/followers", "following_url": "https://api.github.com/users/jmahlik/following{/other_user}", "gists_url": "https://api.github.com/users/jmahlik/gists{/gist_id}", "starred_url": "https://api.github.com/users/jmahlik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jmahlik/subscriptions", "organizations_url": "https://api.github.com/users/jmahlik/orgs", "repos_url": "https://api.github.com/users/jmahlik/repos", "events_url": "https://api.github.com/users/jmahlik/events{/privacy}", "received_events_url": "https://api.github.com/users/jmahlik/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-08-23T20:44:16Z", "updated_at": "2022-10-10T03:56:56Z", "closed_at": "2022-10-10T03:56:56Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**Describe the bug**\r\nCurrently, the docker major version is restricted to `docker~=5.0.0` in the [local extras](https://github.com/aws/sagemaker-python-sdk/blob/master/requirements/extras/local_requirements.txt).\r\n\r\nThis makes installing sagemaker into a windows python 3.10 environment quite difficult, or not possible if there are other transitive deps relying on docker. Docker 5.0.0 fails to install due to a transitive pinned dep on pywin32 which doesn't work with python 3.10. \r\n\r\nDocker released 6.0.0 which would make installation possible on windows. According to the maintainers, it should be api compatible with 5.x .  Consider bumping the max allowable version of docker to 6. This would allow users to pin docker as needed and make installation possible on windows python 3.10.\r\n\r\nThere's not really a workaround other than relaxing the docker version or downgrading python to 3.9. Python 3.9 is discontinuing binary installers with the next release, so keeping python 3.9 up to date with security fixes will not be easy for the majority of python users on windows (building from source is not fun on windows).\r\n\r\nhttps://github.com/docker/docker-py/releases/tag/6.0.0\r\n\r\nhttps://github.com/docker/docker-py/pull/3004\r\n\r\n**To reproduce**\r\nrequirements.txt\r\n\r\n```\r\nsagemaker[local]==2.105.0\r\ndocker>=5.0.0\r\n```\r\n\r\nconstraints.txt\r\n\r\n```\r\ndocker>=6.0.0; platform_system == \"Windows\"\r\n```\r\n\r\n```\r\npython -m pip install sagemaker[local]==2.105.0 # pinned docker pywin32 isn't installable in windows 3.10\r\npython -m pip install -r requirements.txt # does not resolve\r\n# or \r\npython -m pip install -r requirements.txt -c constraints.txt # does not resolve\r\n```\r\n\r\n**Expected behavior**\r\nInstallation on windows with python 3.10.\r\n\r\n**Screenshots or logs**\r\nIf applicable, add screenshots or logs to help explain your problem.\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.105.0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: n/a\r\n- **Framework version**: n/a\r\n- **Python version**: 3.10.6\r\n- **CPU or GPU**: cpu\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3326/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3326/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3323", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3323/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3323/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3323/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3323", "id": 1345821582, "node_id": "I_kwDOBpf0x85QN5uO", "number": 3323, "title": "Passing ParameterString for Processor arguments fails in Pipeline definition", "user": {"login": "amitpeshwani", "id": 16716969, "node_id": "MDQ6VXNlcjE2NzE2OTY5", "avatar_url": "https://avatars.githubusercontent.com/u/16716969?v=4", "gravatar_id": "", "url": "https://api.github.com/users/amitpeshwani", "html_url": "https://github.com/amitpeshwani", "followers_url": "https://api.github.com/users/amitpeshwani/followers", "following_url": "https://api.github.com/users/amitpeshwani/following{/other_user}", "gists_url": "https://api.github.com/users/amitpeshwani/gists{/gist_id}", "starred_url": "https://api.github.com/users/amitpeshwani/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/amitpeshwani/subscriptions", "organizations_url": "https://api.github.com/users/amitpeshwani/orgs", "repos_url": "https://api.github.com/users/amitpeshwani/repos", "events_url": "https://api.github.com/users/amitpeshwani/events{/privacy}", "received_events_url": "https://api.github.com/users/amitpeshwani/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2022-08-22T05:07:12Z", "updated_at": "2022-10-12T16:24:45Z", "closed_at": "2022-10-12T16:24:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nPassing a ParameterString parameter in the arguments for Processor throws an error when defining it as part of a pipeline.\r\n\r\nGetting `TypeError: Object of type ParameterString is not JSON serializable` error\r\n\r\n\r\n**To reproduce**\r\n```\r\ntrain_or_infer = ParameterString(name=\"TrainOrInfer\", default_value=\"infer\")\r\n\r\nscript_processor = SKLearnProcessor(framework_version='0.20.0',\r\n                                instance_count=1,\r\n                                instance_type=processing_instance_type,\r\n                                role=role, \r\n                                sagemaker_session=sagemaker_session)\r\n\r\nprocessor_step_args = script_processor.run(\r\n    inputs=[\r\n        ProcessingInput(source=\"s3://path\", destination=\"/opt/ml/processing/payload\"),\r\n    ],\r\n    outputs=[\r\n        ProcessingOutput(output_name=\"payload_train\", source=\"/opt/ml/processing/processed_payload_train\"),\r\n        ProcessingOutput(output_name=\"payload_infer\", source=\"/opt/ml/processing/processed_payload_infer\")\r\n    ],\r\n    code=os.path.join(\"localpath\", \"processing.py\"),\r\n    arguments=[\r\n        '--train_or_infer', train_or_infer, \r\n    ]\r\n)   \r\n\r\n```\r\n**Expected behavior**\r\nThe pipeline definition printed out\r\n\r\n**Screenshots or logs**\r\nIf applicable, add screenshots or logs to help explain your problem.\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.105.0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: SKLearnProcessor\r\n- **Framework version**: 0.20.0\r\n- **Python version**: 3.8\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\n- I'm passing LocalPipelineSession as sagemaker_session. `from sagemaker.workflow.pipeline_context import LocalPipelineSession`\r\n- Removing the pipelineparameter from arguments, creates the pipeline definition successfully\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3323/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3323/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3320", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3320/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3320/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3320/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3320", "id": 1344551968, "node_id": "I_kwDOBpf0x85QJDwg", "number": 3320, "title": "\"Exception: Object of type ParameterString is not JSON serializable\" when passing ParameterString as part of input in hyperparametertuner fit method.", "user": {"login": "george-chenvibes", "id": 107582348, "node_id": "U_kgDOBmmTjA", "avatar_url": "https://avatars.githubusercontent.com/u/107582348?v=4", "gravatar_id": "", "url": "https://api.github.com/users/george-chenvibes", "html_url": "https://github.com/george-chenvibes", "followers_url": "https://api.github.com/users/george-chenvibes/followers", "following_url": "https://api.github.com/users/george-chenvibes/following{/other_user}", "gists_url": "https://api.github.com/users/george-chenvibes/gists{/gist_id}", "starred_url": "https://api.github.com/users/george-chenvibes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/george-chenvibes/subscriptions", "organizations_url": "https://api.github.com/users/george-chenvibes/orgs", "repos_url": "https://api.github.com/users/george-chenvibes/repos", "events_url": "https://api.github.com/users/george-chenvibes/events{/privacy}", "received_events_url": "https://api.github.com/users/george-chenvibes/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-08-19T14:54:42Z", "updated_at": "2022-08-24T22:21:39Z", "closed_at": "2022-08-24T22:21:39Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nWhen running the `HyperparameterTuner.fit` method, with ParameterString as part of input, the method errors out with following: \r\n`Exception: Object of type ParameterString is not JSON serializable`. Even replacing the ParameterStrings with, strings\r\nproduces the same error.\r\n\r\n**To reproduce**\r\n`bucket = \"ml-bucket\"`\r\n`prefix = \"sample-prefix/\"`\r\n\r\n`image_uri = sagemaker.image_uris.retrieve(\r\n        framework=\"xgboost\",\r\n        region=region,\r\n        version=\"1.0-1\",\r\n        py_version=\"py3\",\r\n        instance_type=training_instance_type,\r\n    )`\r\n`role = sagemaker.session.get_execution_role(sagemaker_session)`\r\n`train_instance_count=1`\r\n`training_instance_type=\"ml.m4.4xlarge\"`\r\n`estimator_prefix=\"generic-estimator-prefix\"`\r\n`estimator_output_path=f\"s3://{bucket}/{estimator_prefix}\"`\r\n`train_data_path = f's3://{bucket}/{prefix}train'`\r\n`test_data_path = f's3://{bucket}/{prefix}test'`\r\n\r\n`train_data_path = ParameterString(\r\n        name=\"TrainDataPath\",\r\n        default_value=train_data_path,\r\n    )`\r\n    `test_data_path = ParameterString(\r\n        name=\"TestDataPath\",\r\n        default_value=test_data_path,\r\n    )`\r\n\r\n`xgb = sagemaker.estimator.Estimator(\r\n        image_uri=image_uri,\r\n        role=role,\r\n        instance_count=train_instance_count,\r\n        instance_type=training_instance_type,\r\n        output_path=estimator_output_path,\r\n        base_job_name=\"generic-base-job-name\",\r\n        hyperparameters=HPs,\r\n        debugger_hook_config=False,  # disable SageMaker Debugger\r\n        disable_profiler=True  # Specifies whether Debugger monitoring and profiling will be disabled\r\n    )`\r\n\r\n\r\n`\r\nsearch_grid = {\r\n        \"alpha\": ContinuousParameter(0.01, 10, scaling_type=\"Logarithmic\"),\r\n        \"eta\": ContinuousParameter(0.1, 0.5),\r\n        \"gamma\": ContinuousParameter(0, 5),\r\n        \"min_child_weight\": ContinuousParameter(0, 120),\r\n        \"max_depth\": IntegerParameter(1, 7),\r\n        \"subsample\": ContinuousParameter(0.5, 1)\r\n    }\r\n`\r\n\r\n`tuner = HyperparameterTuner(\r\n        xgb,\r\n        objective_metric_name=\"validation:auc\",\r\n        objective_type=\"Maximize\",\r\n        hyperparameter_ranges=search_grid,\r\n        max_jobs=2,\r\n        max_parallel_jobs=2,\r\n        early_stopping_type=\"Auto\",\r\n        strategy=\"Bayesian\"\r\n    )`\r\n\r\n`step_args = tuner.fit(inputs={\r\n            \"train\": TrainingInput(\r\n                s3_data=train_data_path,\r\n            ),\r\n            \"validation\": TrainingInput(\r\n                s3_data=test_data_path\r\n            ),\r\n        }, )`\r\n\r\n**Even trying above without setting train_data_path, and test_data_path as ParameterStrings fails with same error.**\r\n\r\n**Expected behavior**\r\nTuner successfully runs tuning job.\r\n**Screenshots or logs**\r\n![tuner_job_fail](https://user-images.githubusercontent.com/107582348/185646181-ee243d88-98c0-4a4b-882c-6bddd67055e5.png)\r\n\r\n**System information**\r\nAWS Codebuild\r\n- **SageMaker Python SDK version**:\r\n2.104.0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**:\r\nBayesian HyperParameterTuner, XGBoost Sagemaker Model\r\n- **Python version**:\r\n3.8", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3320/reactions", "total_count": 6, "+1": 6, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3320/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3299", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3299/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3299/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3299/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3299", "id": 1339365848, "node_id": "I_kwDOBpf0x85P1RnY", "number": 3299, "title": "Args not getting updated properly with multiple trainingsteps in pipeline", "user": {"login": "clausagerskov", "id": 13769591, "node_id": "MDQ6VXNlcjEzNzY5NTkx", "avatar_url": "https://avatars.githubusercontent.com/u/13769591?v=4", "gravatar_id": "", "url": "https://api.github.com/users/clausagerskov", "html_url": "https://github.com/clausagerskov", "followers_url": "https://api.github.com/users/clausagerskov/followers", "following_url": "https://api.github.com/users/clausagerskov/following{/other_user}", "gists_url": "https://api.github.com/users/clausagerskov/gists{/gist_id}", "starred_url": "https://api.github.com/users/clausagerskov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/clausagerskov/subscriptions", "organizations_url": "https://api.github.com/users/clausagerskov/orgs", "repos_url": "https://api.github.com/users/clausagerskov/repos", "events_url": "https://api.github.com/users/clausagerskov/events{/privacy}", "received_events_url": "https://api.github.com/users/clausagerskov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-08-15T18:56:39Z", "updated_at": "2022-12-19T22:10:03Z", "closed_at": "2022-12-19T22:10:03Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nWhen running a sagemaker pytorch pipeline with two separate pytorch training steps with hyperparameters passed to pytorch estimators, if one sets a hyperparam named \"modeA\" to e.g. True and pass to trainingstep 1, and then set a hyperparam with the same name \"modeA\" to False and pass to trainingstep 2, when doing argparser to get the args.modeA in the second the value of the hyperparam is still True.\r\n\r\n**To reproduce**\r\nCreate a pipeline with two pytorch estimator trainingsteps, give both a bool hyperparam named \"modeA\", first pass as true to trainingstep1 then false to trainingstep2.\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.103\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: PyTorch\r\n- **Framework version**: 0.23-1\r\n- **Python version**: 3.8\r\n- **CPU or GPU**: both\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3299/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3299/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3291", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3291/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3291/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3291/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3291", "id": 1336027017, "node_id": "I_kwDOBpf0x85PoieJ", "number": 3291, "title": "workflow._RepackModelStep can fail if source_dir contains requirements.txt", "user": {"login": "akreuzer", "id": 13447298, "node_id": "MDQ6VXNlcjEzNDQ3Mjk4", "avatar_url": "https://avatars.githubusercontent.com/u/13447298?v=4", "gravatar_id": "", "url": "https://api.github.com/users/akreuzer", "html_url": "https://github.com/akreuzer", "followers_url": "https://api.github.com/users/akreuzer/followers", "following_url": "https://api.github.com/users/akreuzer/following{/other_user}", "gists_url": "https://api.github.com/users/akreuzer/gists{/gist_id}", "starred_url": "https://api.github.com/users/akreuzer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/akreuzer/subscriptions", "organizations_url": "https://api.github.com/users/akreuzer/orgs", "repos_url": "https://api.github.com/users/akreuzer/repos", "events_url": "https://api.github.com/users/akreuzer/events{/privacy}", "received_events_url": "https://api.github.com/users/akreuzer/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-08-11T14:16:24Z", "updated_at": "2022-12-02T03:23:37Z", "closed_at": "2022-12-02T03:23:36Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\n`_RepackModelStep` is a part of the `sagemaker.workflow.model_step.ModelStep`.\r\nIts purpose is to attach a `source_dir` to the plain `model.tar.gz`.\r\nAs I understand, this is done using a training step that does not do any real training but just repacks the model, see \r\n\r\nhttps://github.com/aws/sagemaker-python-sdk/blob/284ddbebcf6240f0a4d3c734244f8e8ad066a9b3/src/sagemaker/workflow/_utils.py#L155-L158\r\n\r\nIf the source_dir contains a `requirements.txt`, this step can fail. This is due to the fact in the step above the requirements will be installed even though they might not be compatible. See attached logs.\r\n\r\n**To reproduce**\r\nAn example of a source_dir where this is the case is Jumpstart LightGBM Inference source_dir available at `s3://jumpstart-cache-prod-us-east-2/source-directory-tarballs/lightgbm/inference/regression/v1.1.0/sourcedir.tar.gz`\r\nIts requirements.txt looks like this.\r\n```\r\n/opt/ml/model/code/lib/lightgbm/tenacity-8.0.1-py3-none-any.whl\r\n/opt/ml/model/code/lib/lightgbm/plotly-5.1.0-py2.py3-none-any.whl\r\n/opt/ml/model/code/lib/lightgbm/graphviz-0.17-py3-none-any.whl\r\n...\r\n```\r\n\r\nAdding this source_dir to a model using the following code results in pipeline failure.\r\n```python\r\nmodel = Model(\r\n    image_uri=deploy_image_uri,\r\n    source_dir=deploy_source_uri_cache,\r\n    entry_point=\"inference.py\",\r\n    model_data=step_train.properties.ModelArtifacts.S3ModelArtifacts,\r\n    sagemaker_session=pipeline_session,\r\n    role=role,\r\n)\r\n\r\nstep_model = ModelStep(\"RegisterModel\", \r\n    step_args=model.register(\r\n        content_types=[\"text/csv\"],\r\n        response_types=[\"application/json\"],\r\n        inference_instances=[\"ml.t2.medium\"],\r\n        transform_instances=[\"ml.m5.xlarge\"],\r\n        model_package_group_name=\"lgbm-test\",\r\n        \r\n    ))\r\n```\r\n(Note that in the above code, `deploy_source_uri_cache` points to a copy of `s3://jumpstart-cache-prod-us-east-2/source-directory-tarballs/lightgbm/inference/regression/v1.1.0/sourcedir.tar.gz` as it is modified by `_RepackModelStep`)\r\n\r\n**Expected behavior**\r\n`_RepackModelStep` should work regardless of the content of source_dir.\r\n\r\n**Screenshots or logs**\r\n![Screen Shot 2022-08-11 at 7 10 16 AM](https://user-images.githubusercontent.com/13447298/184153368-16214db9-b51d-40d4-92f6-556f9ef9fa2b.png)\r\n\r\n\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.103.0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: JumpStart LightGBM\r\n- **Framework version**: N/A\r\n- **Python version**: 3.8\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3291/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3291/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3287", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3287/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3287/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3287/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3287", "id": 1331069560, "node_id": "I_kwDOBpf0x85PVoJ4", "number": 3287, "title": "Sagemaker Session and FeatureGroup describe_feature_metadata() function missing", "user": {"login": "gregcodercw", "id": 48602129, "node_id": "MDQ6VXNlcjQ4NjAyMTI5", "avatar_url": "https://avatars.githubusercontent.com/u/48602129?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gregcodercw", "html_url": "https://github.com/gregcodercw", "followers_url": "https://api.github.com/users/gregcodercw/followers", "following_url": "https://api.github.com/users/gregcodercw/following{/other_user}", "gists_url": "https://api.github.com/users/gregcodercw/gists{/gist_id}", "starred_url": "https://api.github.com/users/gregcodercw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gregcodercw/subscriptions", "organizations_url": "https://api.github.com/users/gregcodercw/orgs", "repos_url": "https://api.github.com/users/gregcodercw/repos", "events_url": "https://api.github.com/users/gregcodercw/events{/privacy}", "received_events_url": "https://api.github.com/users/gregcodercw/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-08-07T17:04:21Z", "updated_at": "2023-01-25T15:51:25Z", "closed_at": "2023-01-25T15:51:25Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'm running into a possible bug I don't understand. I have an existing feature group that I'm trying to get the metadata from but the method is missing on the FeatureGroup object.\r\n\r\nUsing SageMaker Studio and Jupyter Notebooks.\r\n\r\n```python\r\nfrom sagemaker.session import Session\r\nfrom sagemaker.feature_store.feature_group import FeatureGroup\r\n\r\nsagemaker_session = Session()\r\nfeature_group = FeatureGroup(name='test-feature-group', sagemaker_session=sagemaker_session)\r\nfeature_group.describe()  #works great\r\nfeature_group.describe_feature_metadata()  #AttributeError: 'FeatureGroup' object has no attribute 'describe_feature_metadata'\r\n```\r\n\r\nWhen I dump the class source code using print(inspect.getsource(FeatureGroup)) the function is there but inspecting the object after instantiation the function is missing. The sagemaker_session object is also supposed to have describe_feature_metadata() method which is also missing. The session client does work with sagemaker_session.sagemaker_client.describe_feature_metadata(FeatureGroupName='...', FeatureName='...') which functions as expected and is my work around for now.\r\n\r\nPython 3.7.10\r\nSagemaker-2.103.0", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3287/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3287/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3275", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3275/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3275/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3275/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3275", "id": 1325717345, "node_id": "I_kwDOBpf0x85PBNdh", "number": 3275, "title": "sagemaker.workflow.pipeline.PipelineGraph throws exeption when a SageMaker Step's input is a function", "user": {"login": "DRKolev-code", "id": 83947853, "node_id": "MDQ6VXNlcjgzOTQ3ODUz", "avatar_url": "https://avatars.githubusercontent.com/u/83947853?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DRKolev-code", "html_url": "https://github.com/DRKolev-code", "followers_url": "https://api.github.com/users/DRKolev-code/followers", "following_url": "https://api.github.com/users/DRKolev-code/following{/other_user}", "gists_url": "https://api.github.com/users/DRKolev-code/gists{/gist_id}", "starred_url": "https://api.github.com/users/DRKolev-code/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DRKolev-code/subscriptions", "organizations_url": "https://api.github.com/users/DRKolev-code/orgs", "repos_url": "https://api.github.com/users/DRKolev-code/repos", "events_url": "https://api.github.com/users/DRKolev-code/events{/privacy}", "received_events_url": "https://api.github.com/users/DRKolev-code/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2022-08-02T11:34:05Z", "updated_at": "2022-08-11T19:47:46Z", "closed_at": "2022-08-11T19:47:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nI am trying to use `PipelineGraph `to sort out the dependencies of my steps. The issue occurs because we have a custom Pipeline class that schedules our steps one after the other and some of them have the `inputs ` as a method that gets evaluated when the step is ready to be executed.\r\n\r\nSuch as:\r\n\r\n```\r\nstep.inputs = (\r\n                step.inputs if not inspect.ismethod(step.inputs) else step.inputs()\r\n            )\r\n```\r\n\r\nThe error is:\r\n`TypeError: unsupported operand type(s) for +: 'method' and 'list'`\r\n\r\nThis is due to the method:\r\n\r\n`sagemaker.workflow.steps.Step._find_dependencies_in_step_arguments`\r\n\r\nas it cannot reconcile the inputs being a method to be executed later.\r\n\r\n**To reproduce**\r\n```\r\nfrom sagemaker.workflow.pipeline import PipelineGraph\r\nfrom sagemaker.workflow.steps import ProcessingStep\r\nfrom sagemaker.processing import ScriptProcessor\r\n\r\ndef my_function():\r\n    pass\r\n\r\nCreate any step and assign its inputs to be a function.\r\n\r\nstep_calls = ProcessingStep(\r\n            name='calls',\r\n            description='Processing missing calldata.',\r\n            processor=script_processor,\r\n            inputs=my_function\r\n)\r\n\r\nPipelineGraph(step_call)\r\n```\r\n\r\n\r\n**Expected behavior**\r\nI expect that if the inputs are a method then they should be ignored. Maybe the `PipelineGraph `can have a `boolean `value to toggle this behaviour with default being to check the inputs for dependencies.\r\n\r\n**Screenshots or logs**\r\n```\r\nFile \"../console.py\", line 21, in run_training_pipeline\r\n    training_pipeline.run(run_date, local)\r\n\r\n  File \"../src/pipelines/training_pipeline.py\", line 42, in run\r\n    PipelineGraph(\r\n\r\n  File \"/home/noname/.venv/main/lib/python3.10/site-packages/sagemaker/workflow/pipeline.py\", line 568, in __init__\r\n    self.adjacency_list = self._initialize_adjacency_list()\r\n\r\n  File \"/home/noname/.venv/main/lib/python3.10/site-packages/sagemaker/workflow/pipeline.py\", line 596, in _initialize_adjacency_list\r\n    step._find_step_dependencies(self.step_map)\r\n\r\n  File \"/home/noname/.venv/main/lib/python3.10/site-packages/sagemaker/workflow/steps.py\", line 183, in _find_step_dependencies\r\n    self.step_only_arguments, step_map\r\n\r\n  File \"/home/noname/.venv/main/lib/python3.10/site-packages/sagemaker/workflow/steps.py\", line 115, in step_only_arguments\r\n    return self.arguments\r\n\r\n  File \"/home/noname/.venv/main/lib/python3.10/site-packages/sagemaker/workflow/steps.py\", line 853, in arguments\r\n    normalized_inputs, normalized_outputs = self.processor._normalize_args(\r\n\r\n  File \"/home/noname/.venv/main/lib/python3.10/site-packages/sagemaker/processing.py\", line 242, in _normalize_args\r\n    inputs_with_code = self._include_code_in_inputs(inputs, code, kms_key)\r\n\r\n  File \"/home/noname/.venv/main/lib/python3.10/site-packages/sagemaker/processing.py\", line 583, in _include_code_in_inputs\r\n    inputs_with_code = self._convert_code_and_add_to_inputs(inputs, user_code_s3_uri)\r\n\r\n  File \"/home/noname/.venv/main/lib/python3.10/site-packages/sagemaker/processing.py\", line 697, in _convert_code_and_add_to_inputs\r\n    return (inputs or []) + [code_file_input]\r\n\r\nTypeError: unsupported operand type(s) for +: 'method' and 'list'\r\n```\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: na\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: na\r\n- **Framework version**: na\r\n- **Python version**:\r\n- **CPU or GPU**: na\r\n- **Custom Docker image (Y/N)**: na\r\n\r\n**Additional context**\r\nI understand that this might not be an intended use case for the class `PipelineGraph `but it is a scenario that occurs. It would be nice if a fix is applied.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3275/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3275/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3272", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3272/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3272/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3272/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3272", "id": 1324319111, "node_id": "I_kwDOBpf0x85O74GH", "number": 3272, "title": "Pickling a SageMaker step corrupts part of the object.", "user": {"login": "DRKolev-code", "id": 83947853, "node_id": "MDQ6VXNlcjgzOTQ3ODUz", "avatar_url": "https://avatars.githubusercontent.com/u/83947853?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DRKolev-code", "html_url": "https://github.com/DRKolev-code", "followers_url": "https://api.github.com/users/DRKolev-code/followers", "following_url": "https://api.github.com/users/DRKolev-code/following{/other_user}", "gists_url": "https://api.github.com/users/DRKolev-code/gists{/gist_id}", "starred_url": "https://api.github.com/users/DRKolev-code/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DRKolev-code/subscriptions", "organizations_url": "https://api.github.com/users/DRKolev-code/orgs", "repos_url": "https://api.github.com/users/DRKolev-code/repos", "events_url": "https://api.github.com/users/DRKolev-code/events{/privacy}", "received_events_url": "https://api.github.com/users/DRKolev-code/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-08-01T12:10:42Z", "updated_at": "2023-01-19T18:54:46Z", "closed_at": "2023-01-19T18:54:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nThis issue is related to https://github.com/boto/boto3/issues/3365. I have been trying to pickle and unpickle a SageMaker step and the relevant part for this repo is the fact that after unpickling a step the step.step_type becomes CONDITION from what it was originally:\r\n\r\nOriginal:\r\n`ProcessingStep(name='calls', display_name=None, description='Processing missing calldata.', step_type=<StepTypeEnum.PROCESSING: 'Processing'>, depends_on=None)`\r\n\r\nBecomes:\r\n`ProcessingStep(name='calls', display_name=None, description='Processing missing calldata.', step_type=<StepTypeEnum.CONDITION: 'Condition'>, depends_on=None)`\r\n\r\n**To reproduce**\r\nI cannot give the complete code for the ProcessingStep but I think any initialization would produce the bug.\r\n```\r\nimport dill\r\nfrom dill import loads, dumps\r\nimport copyreg\r\n\r\ndef save_sslcontext(obj):\r\n                return obj.__class__, (obj.protocol,)\r\n\r\ncopyreg.pickle(ssl.SSLSocket, _reduce_socket, _rebuild_socket)\r\ncopyreg.pickle(ssl.SSLContext, save_sslcontext)\r\n\r\n# Creating a ProcessingStep. I cannot share the script but I imagine any processing step will have the same behaviour.\r\nstep= ProcessingStep(\r\n            name='calls',\r\n            description='Processing missing calldata.',\r\n            processor=script_processor,\r\n            cache_config=cache_config,\r\n            code=(Path(__file__).parent / 'scripts' / 'calls.py').as_posix(),\r\n            job_arguments=[\r\n                '--catalog_variables',\r\n                json.dumps(catalog_variables),\r\n            ],\r\n        )\r\n\r\nprint(step)\r\nprint(loads(dumps(step)\r\n```\r\n\r\n**Expected behavior**\r\nI expect once unpickled the object to not have corrupted fields. the step.step_type should not change.\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.98.0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: ProcessingStep, TuningStep, probably all of the other ones.\r\n- **Framework version**: na\r\n- **Python version**: 3.10\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: Either\r\n\r\n**Additional context**\r\nTo pickle a SageMaker step sometimes you have to add the following code as well. This is due to botocore and related to the https://github.com/boto/boto3/issues/3365 issue.\r\n\r\n```\r\n# Stuff I changed to make `dill `work.\r\ndef __getattr__client(self, item):\r\n\tif item not in vars(self):\r\n\t\traise AttributeError\r\n\r\n\tevent_name = \"getattr.%s.%s\" % (self._service_model.service_id.hyphenize(), item)\r\n\thandler, event_response = self.meta.events.emit_until_response(\r\n\t\tevent_name, client=self\r\n\t)\r\n\r\n\tif event_response is not None:\r\n\t\treturn event_response\r\n\r\n\traise AttributeError(\r\n\t\t\"'%s' object has no attribute '%s'\" % (self.__class__.__name__, item)\r\n\t)\r\n\r\nbotocore.client.BaseClient.__getattr__ = __getattr__client\r\n\r\ndef __getattr__errorfactory(self, name):\r\n\tif name not in vars(self):\r\n\t\traise AttributeError\r\n\r\n\texception_cls_names = [\r\n\t\texception_cls.__name__ for exception_cls in self._code_to_exception.values()\r\n\t]\r\n\traise AttributeError(\r\n\t\t\"%r object has no attribute %r. Valid exceptions are: %s\"\r\n\t\t% (self, name, \", \".join(exception_cls_names))\r\n\t)\r\n\r\nbotocore.errorfactory.BaseClientExceptions.__getattr__ = __getattr__errorfactory\r\n\r\ndef save_sslcontext(obj):\r\n                return obj.__class__, (obj.protocol,)\r\n\r\ncopyreg.pickle(ssl.SSLSocket, _reduce_socket, _rebuild_socket)\r\ncopyreg.pickle(ssl.SSLContext, save_sslcontext)\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3272/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3272/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3236", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3236/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3236/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3236/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3236", "id": 1305014108, "node_id": "I_kwDOBpf0x85NyO9c", "number": 3236, "title": "LambdaStep in Sagemaker Pipeline times out even though the Lambda function has finished Processing", "user": {"login": "mohitravi123", "id": 109298588, "node_id": "U_kgDOBoPDnA", "avatar_url": "https://avatars.githubusercontent.com/u/109298588?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mohitravi123", "html_url": "https://github.com/mohitravi123", "followers_url": "https://api.github.com/users/mohitravi123/followers", "following_url": "https://api.github.com/users/mohitravi123/following{/other_user}", "gists_url": "https://api.github.com/users/mohitravi123/gists{/gist_id}", "starred_url": "https://api.github.com/users/mohitravi123/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mohitravi123/subscriptions", "organizations_url": "https://api.github.com/users/mohitravi123/orgs", "repos_url": "https://api.github.com/users/mohitravi123/repos", "events_url": "https://api.github.com/users/mohitravi123/events{/privacy}", "received_events_url": "https://api.github.com/users/mohitravi123/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2022-07-14T16:21:55Z", "updated_at": "2022-07-28T18:12:27Z", "closed_at": "2022-07-28T18:12:27Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nI'm using a `LambdaStep` in the sagemaker pipeline to run an athena query and store results in s3 which will be the input for future steps. The lambda function takes around 7 minutes to run. Even after the lambda function is successful, the `LambdaStep` in the sagemaker pipeline does not succeed and ultimately times out exactly at 10 minutes which is the maximum run time for the `LambdaStep`. I can verify that the lambda function is successful by looking at cloudwatch logs and the resulting output of the athena query in the s3 bucket.\r\n\r\n**To reproduce**\r\nCreate a lambda function with the following code. To mimic the athena query run time, I have added a sleep function for 7 minutes.\r\n\r\n```\r\nimport json\r\nimport os\r\nimport time\r\n\r\ndef lambda_handler(event, context):    \r\n    print(\"starting lambda function\")\r\n\r\n    time.sleep(420)\r\n    \r\n    print(\"lambda function succeeded\")\r\n\r\n    return {\r\n        \"statusCode\": 200,\r\n        \"state\": 'SUCCEEDED'\r\n    }\r\n```\r\n\r\nMy sagemaker pipeline is defined as follows:\r\n```\r\n# Lambda helper class can be used to create the Lambda function\r\nfunc = Lambda(\r\n    function_arn=\"arn:aws:lambda:{region}:{account_id}:function:lambda-test\",\r\n)\r\n\r\n# Define LambdaStep\r\nstep_deploy_lambda = LambdaStep(\r\n    name=\"LambdaStep\",\r\n    lambda_func=func\r\n)\r\n\r\n# Run sagemaker pipeline\r\npipeline_name = \"lambda-step-pipeline-test\" \r\n\r\npipeline = Pipeline(\r\n    name=pipeline_name,\r\n    steps=[step_deploy_lambda],\r\n    sagemaker_session=sagemaker_session\r\n)\r\n\r\npipeline.upsert(role_arn=role)\r\nexecution = pipeline.start()\r\n```\r\n\r\n**Expected behavior**\r\nAfter the lambda function succeeds, I would expect the `lambdaStep` to be successful and move to the next step in the sagemaker pipeline.\r\n\r\n\r\n**Screenshots or logs**\r\nIn the Output tab of the `lambdaStep` in sagemaker studio, I can see the following message about lambda timeout.\r\n\r\n```\r\nThis step failed. For more information, view the logs\r\nClientError: Lambda Function runtime exceeded. Maximum runtime for the Lambda function is 10 minutes.\r\n```\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.86.2\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: N/A\r\n- **Framework version**: N/A\r\n- **Python version**: 3.7\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\nThe lambda function configuration is:\r\n- **Memory**: 3008 MB\r\n- **Ephemeral storage**: 512 MB\r\n- **Timeout**: 10min 0sec\r\n\r\n\r\n\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3236/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3236/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3233", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3233/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3233/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3233/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3233", "id": 1303190361, "node_id": "I_kwDOBpf0x85NrRtZ", "number": 3233, "title": "Model monitor job intermittently fails", "user": {"login": "arvgram", "id": 108921448, "node_id": "U_kgDOBn4CaA", "avatar_url": "https://avatars.githubusercontent.com/u/108921448?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arvgram", "html_url": "https://github.com/arvgram", "followers_url": "https://api.github.com/users/arvgram/followers", "following_url": "https://api.github.com/users/arvgram/following{/other_user}", "gists_url": "https://api.github.com/users/arvgram/gists{/gist_id}", "starred_url": "https://api.github.com/users/arvgram/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arvgram/subscriptions", "organizations_url": "https://api.github.com/users/arvgram/orgs", "repos_url": "https://api.github.com/users/arvgram/repos", "events_url": "https://api.github.com/users/arvgram/events{/privacy}", "received_events_url": "https://api.github.com/users/arvgram/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 4376817897, "node_id": "LA_kwDOBpf0x88AAAABBODw6Q", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:model%20monitor", "name": "component:model monitor", "color": "f9d0c4", "default": false, "description": "Relates to SageMaker Model Monitor"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2022-07-13T09:51:12Z", "updated_at": "2022-08-03T16:27:58Z", "closed_at": "2022-08-03T16:27:30Z", "author_association": "NONE", "active_lock_reason": null, "body": "When monitoring an endpoint that is utilizing a decision tree model on Iris dataset the monitor sometimes executes a monitor job successfully, sometimes it crashes with the exit message:\r\n`Command 'bin/spark-submit --master yarn --deploy-mode client --conf spark.hadoop.fs.s3a.aws.credentials.provider=org.apache.hadoop.fs.s3a.SimpleAWSCredentialsProvider --conf spark.serializer=org.apache.spark.serializer.KryoSerializer /opt/amazon/sagemaker-data-analyzer-1.0-jar-with-dependencies.jar --analytics_input /tmp/spark_job_config.json' died with <Signals.SIGKILL: 9>`. \r\n\r\n\r\n\r\n**To reproduce**\r\n-  Upload a model to an endpoint:\r\n```\r\n# Create a model object from the pretrained model. \r\n\r\nmodel_uri = string with the uri for the s3 bucket where model i stored. \r\nmodel_name = f\"my-decision-tree-model\"\r\n\r\nmodel = SKLearnModel(model_data= model_uri,\r\n                             role=role,\r\n                             entry_point= \"Scripts/serve.py\",\r\n                             framework_version=\"0.23-1\")\r\nprint('Model name: ' + model_name)\r\n```\r\nThe `serve`-function we are using is defined as:\r\n\r\n```\r\n%%writefile Scripts/serve.py\r\n\r\n# The methods below are for model serving, which will be called by the SageMaker serving endpoint automatically:\r\n#  model_fn()\r\n#  input_fn()\r\n#  predict_fn()\r\n#  output_fn()\r\n\r\nimport os\r\nimport joblib\r\nimport json\r\nimport pandas as pd\r\nimport numpy as np\r\nfrom io import StringIO \r\n\r\n\"\"\"\r\nDeserialize fitted model\r\n\"\"\"\r\ndef model_fn(model_dir):\r\n    model = joblib.load(os.path.join(model_dir, \"model.joblib\"))\r\n    return model\r\n\r\n\"\"\"\r\ninput_fn\r\n    request_body: The body of the request sent to the model.\r\n    request_content_type: (string) specifies the format/variable type of the request\r\n\"\"\"\r\ndef input_fn(request_body, request_content_type):\r\n    if request_content_type == 'application/json':\r\n        request_body = json.loads(request_body)\r\n        inpVar = request_body['Input']\r\n        return inpVar\r\n    elif request_content_type == 'text/csv':\r\n        df = pd.read_csv(StringIO(request_body),header=None)\r\n        return df.values.tolist()\r\n    else:\r\n        raise ValueError(\"This model only supports text/csv or application/json input\")\r\n        \r\n\"\"\"\r\npredict_fn\r\n    input_data: returned array from input_fn above\r\n    model (sklearn model) returned model loaded from model_fn above\r\n\"\"\"\r\ndef predict_fn(input_data, model):\r\n    return model.predict(input_data)\r\n\r\n\"\"\"\r\noutput_fn\r\n    prediction: the returned value from predict_fn above\r\n    content_type: the content type the endpoint expects to be returned. Ex: JSON, string\r\n\"\"\"\r\n\r\ndef output_fn(prediction, content_type):\r\n    if content_type == 'application/json':\r\n        res = prediction.tolist()\r\n        respJSON = {'Output': res}\r\n        return respJSON\r\n    elif content_type == 'text/csv':\r\n        s = StringIO()\r\n        np.savetxt(s, prediction, fmt='%d', delimiter=',', newline='\\n')\r\n        return s.getvalue()\r\n    else:\r\n        raise ValueError(\"This model only supports text/csv or application/json input\") \r\n\r\n```\r\n- Upload model to endpoint with endpoint data capture enabled:\r\n\r\n```\r\nendpoint_name = \"model-endpoint\" \r\nprint(\"Endpoint name (endpoint_name) =\", endpoint_name)\r\n\r\ndata_capture_config = DataCaptureConfig(\r\n    enable_capture = True, \r\n    sampling_percentage = 100, \r\n    destination_s3_uri = endpoint_data_uri,\r\n    csv_content_types = ['text/csv', 'text/html']\r\n)\r\n\r\npredictor = model.deploy(\r\n    initial_instance_count=1,\r\n    instance_type=\"ml.t2.medium\",\r\n    endpoint_name=endpoint_name,\r\n    data_capture_config=data_capture_config,\r\n)\r\n```\r\n-  Create a model monitor object and set an hourly schedule. \r\n```\r\nmy_model_monitor = DefaultModelMonitor(\r\n    role=role,\r\n    instance_count=1,\r\n    instance_type=\"ml.t3.medium\",\r\n    volume_size_in_gb=20,\r\n    max_runtime_in_seconds=1800,\r\n    sagemaker_session=session,\r\n)\r\n\r\nmon_schedule_name = my_monitor_schedule\r\n\r\nmy_model_monitor.create_monitoring_schedule(\r\n    monitor_schedule_name=mon_schedule_name,\r\n    endpoint_input=endpoint_name,\r\n    output_s3_uri = s3_report_path,\r\n    statistics = statistics_uri, #we point at uploaded statistics in s3\r\n    constraints = constraints_uri, #we point at uploaded constraints in s3\r\n    schedule_cron_expression=CronExpressionGenerator.hourly(),\r\n    enable_cloudwatch_metrics=True,\r\n)\r\n\r\n```\r\n- Send some data to endpoint. I have made a loop that sends randomized input with features that are similar to the Iris dataset, mixed with input from the actual Iris dataset and see if it catches any drift etc. \r\n\r\n```\r\ndef invoke_csv_iris(output = False):\r\n    import numpy as np\r\n    \r\n    content_type = \"text/csv\"\r\n    \r\n    sepal_length = 3 + np.random.rand()*5\r\n    sepal_width = 2 + np.random.rand()*2\r\n    petal_length = 1 + np.random.rand()*5\r\n    petal_width = np.random.rand()*3\r\n\r\n    random_iris_string = str(sepal_length) + \",\" + str(sepal_width) + \",\" + str(petal_length) + \",\" + str(petal_width)\r\n\r\n    response = client.invoke_endpoint(\r\n        EndpointName=endpoint_name, \r\n        ContentType=content_type,\r\n        Accept=content_type,\r\n        Body=random_iris_string)\r\n    r = response['Body'].read().decode()\r\n    if output:\r\n        print(type(r))\r\n        print(r)\r\n```\r\n\r\n```\r\ncontent_type = \"text/csv\"\r\ncount = 0\r\nstop_count = 7\r\nwith open(\"dataset_for_monitor.csv\", \"r\") as csv_file:\r\n    for row in csv_file:\r\n        body = row[:-3]  # without the target\r\n        if count%4 == 0: #send a random iris every fourth \r\n            invoke_csv_iris(output = False)\r\n            count += 1\r\n            if count > stop_count:\r\n                break\r\n        \r\n        response = client.invoke_endpoint(\r\n            EndpointName=endpoint_name, \r\n            ContentType=content_type,\r\n            Accept=content_type,\r\n            Body=body)\r\n        time.sleep(1)\r\n        count += 1\r\n        if count > stop_count:\r\n            break\r\n    print(f'Processed {count} predictions.')\r\n```\r\n\r\n```\r\ndef inspect_monitor_executions(monitor_object):\r\n    monitoring_executions = monitor_object.list_executions()\r\n    print(\"The executions the monitor has made are: \")\r\n    for execution in monitoring_executions:\r\n        print(20*\"-\")\r\n        print(\"Latest execution status: {}\".format(execution.describe()[\"ProcessingJobStatus\"]))\r\n        print(\"Latest execution exit message: {}\".format(execution.describe()[\"ExitMessage\"]))\r\n        print(\"Process start time: {}. \".format(execution.describe()[\"ProcessingStartTime\"]))\r\n        print(\"Process end time: {}. \".format(execution.describe()[\"ProcessingEndTime\"]))\r\n```\r\n\r\n`inspect_monitor_executions(fresh_start_friday_parallel_monitor)`\r\n\r\n\r\n\r\n- Sometimes this performs successful executions and sometimes it crashes. I have tried to send only \"real\" data from dataset or only \"artificial\" data from randomized loop, without being able to conclude the reason for the crash. I have also sent different  batch size of input data, and there might be a problem with larger requests. However, these are about 10 invocations per minute, which with the four feature data should not too much of a computational load. \r\n\r\n**Expected behavior**\r\nI expect the monitor to complete a successful execution every time. It is weird that it is crashing some of the times and executing successfully some of the time. \r\n\r\n**Screenshots or logs**\r\nThe exit message for the crash is:\r\n`Command 'bin/spark-submit --master yarn --deploy-mode client --conf spark.hadoop.fs.s3a.aws.credentials.provider=org.apache.hadoop.fs.s3a.SimpleAWSCredentialsProvider --conf spark.serializer=org.apache.spark.serializer.KryoSerializer /opt/amazon/sagemaker-data-analyzer-1.0-jar-with-dependencies.jar --analytics_input /tmp/spark_job_config.json' died with <Signals.SIGKILL: 9>.`\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- SageMaker Python SDK version: 2.98.0\r\n- Framework name (eg. PyTorch) or algorithm (eg. KMeans): ScikitLearn decision tree\r\n- Framework version:\r\n- Python version 3.8.12. \r\n- CPU or GPU: CPU\r\n- Custom Docker image (Y/N): No.\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3233/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3233/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3222", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3222/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3222/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3222/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3222", "id": 1299831953, "node_id": "I_kwDOBpf0x85NedyR", "number": 3222, "title": "Can't register a model in model registry without specifying `inference_instances` and `transform_instances`", "user": {"login": "acere", "id": 13648166, "node_id": "MDQ6VXNlcjEzNjQ4MTY2", "avatar_url": "https://avatars.githubusercontent.com/u/13648166?v=4", "gravatar_id": "", "url": "https://api.github.com/users/acere", "html_url": "https://github.com/acere", "followers_url": "https://api.github.com/users/acere/followers", "following_url": "https://api.github.com/users/acere/following{/other_user}", "gists_url": "https://api.github.com/users/acere/gists{/gist_id}", "starred_url": "https://api.github.com/users/acere/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/acere/subscriptions", "organizations_url": "https://api.github.com/users/acere/orgs", "repos_url": "https://api.github.com/users/acere/repos", "events_url": "https://api.github.com/users/acere/events{/privacy}", "received_events_url": "https://api.github.com/users/acere/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-07-10T05:16:54Z", "updated_at": "2022-09-01T01:48:47Z", "closed_at": "2022-09-01T01:48:47Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nRegistering a model using SageMaker SDK `model.register()` without specifying `inference_instances` and `transform_instances` fails with the following error:\r\n```python\r\nParamValidationError: Parameter validation failed:\r\nInvalid type for parameter InferenceSpecification.SupportedRealtimeInferenceInstanceTypes, value: None, type: <class 'NoneType'>, valid types: <class 'list'>, <class 'tuple'>\r\nInvalid type for parameter InferenceSpecification.SupportedTransformInstanceTypes, value: None, type: <class 'NoneType'>, valid types: <class 'list'>, <class 'tuple'>\r\n```\r\n\r\nThe same operation via boto3, `sagemaker_client.create_model_package()` instead completes successfully.  \r\n\r\nI traced the issue to these two lines of code:\r\nhttps://github.com/aws/sagemaker-python-sdk/blob/9369a8781da9be92e1850ff62b42428cd61e23a6/src/sagemaker/session.py#L4502-L4503\r\n\r\nWhen `inference_instances` and `transform_instances` are `None` in `model.register()`, they should not be included at all to the `inference_specification` dictionary.\r\n\r\n**To reproduce**\r\nThe bug can be reproduced running this code block in a SageMaker (studio) notebook:\r\n```python\r\nimport sagemaker\r\n\r\nmodel_data = \"test.tar.gz\"\r\nmodel_package_group_name = \"test-model-group-name\"\r\n\r\n!touch {model_data}\r\n\r\nmodel_data_uri = sagemaker.s3.S3Uploader.upload(\r\n    local_path=model_data,\r\n    desired_s3_uri=f\"s3://{sagemaker.Session().default_bucket()}/{model_package_group_name}\",\r\n)\r\n\r\n\r\ninference_image = sagemaker.image_uris.retrieve(\r\n    framework=\"xgboost\",\r\n    region=sagemaker.Session().boto_region_name,\r\n    image_scope=\"inference\",\r\n    version=\"latest\",\r\n)\r\n\r\nmodel = sagemaker.Model(\r\n    image_uri=inference_image,\r\n    model_data=model_data_uri,\r\n    sagemaker_session=sagemaker.Session(),\r\n)\r\n\r\nmodel.register(\r\n    content_types=[\"application/json\"],\r\n    response_types=[\"application/json\"],\r\n    model_package_group_name=model_package_group_name,\r\n)\r\n```\r\n\r\n\r\n**Expected behavior**\r\nI would expect the model to be registered \r\n\r\n**Screenshots or logs**\r\n\r\nthis is the error returned when running the code block above\r\n```\r\n---------------------------------------------------------------------------\r\nParamValidationError                      Traceback (most recent call last)\r\nInput In [2], in <cell line: 27>()\r\n     14 inference_image = sagemaker.image_uris.retrieve(\r\n     15     framework=\"xgboost\",\r\n     16     region=sagemaker.Session().boto_region_name,\r\n     17     image_scope=\"inference\",\r\n     18     version=\"latest\",\r\n     19 )\r\n     21 model = sagemaker.Model(\r\n     22     image_uri=inference_image,\r\n     23     model_data=model_data_uri,\r\n     24     sagemaker_session=sagemaker.Session(),\r\n     25 )\r\n---> 27 model.register(\r\n     28     content_types=[\"application/json\"],\r\n     29     response_types=[\"application/json\"],\r\n     30     model_package_group_name=model_package_group_name,\r\n     31 )\r\n\r\nFile /opt/conda/lib/python3.8/site-packages/sagemaker/workflow/pipeline_context.py:209, in runnable_by_pipeline.<locals>.wrapper(*args, **kwargs)\r\n    206     run_func(*args, **kwargs)\r\n    207     return self_instance.sagemaker_session.context\r\n--> 209 return run_func(*args, **kwargs)\r\n\r\nFile /opt/conda/lib/python3.8/site-packages/sagemaker/model.py:409, in Model.register(self, content_types, response_types, inference_instances, transform_instances, model_package_name, model_package_group_name, image_uri, model_metrics, metadata_properties, marketplace_cert, approval_status, description, drift_check_baselines, customer_metadata_properties, validation_specification, domain, task, sample_payload_url, framework, framework_version, nearest_model_name, data_input_configuration)\r\n    384     container_def = {\r\n    385         \"Image\": self.image_uri,\r\n    386         \"ModelDataUrl\": self.model_data,\r\n    387     }\r\n    389 model_pkg_args = sagemaker.get_model_package_args(\r\n    390     content_types,\r\n    391     response_types,\r\n   (...)\r\n    407     task=task,\r\n    408 )\r\n--> 409 model_package = self.sagemaker_session.create_model_package_from_containers(\r\n    410     **model_pkg_args\r\n    411 )\r\n    412 if isinstance(self.sagemaker_session, PipelineSession):\r\n    413     return None\r\n\r\nFile /opt/conda/lib/python3.8/site-packages/sagemaker/session.py:2896, in Session.create_model_package_from_containers(self, containers, content_types, response_types, inference_instances, transform_instances, model_package_name, model_package_group_name, model_metrics, metadata_properties, marketplace_cert, approval_status, description, drift_check_baselines, customer_metadata_properties, validation_specification, domain, sample_payload_url, task)\r\n   2891             self.sagemaker_client.create_model_package_group(\r\n   2892                 ModelPackageGroupName=request[\"ModelPackageGroupName\"]\r\n   2893             )\r\n   2894     return self.sagemaker_client.create_model_package(**request)\r\n-> 2896 return self._intercept_create_request(\r\n   2897     model_pkg_request, submit, self.create_model_package_from_containers.__name__\r\n   2898 )\r\n\r\nFile /opt/conda/lib/python3.8/site-packages/sagemaker/session.py:4230, in Session._intercept_create_request(self, request, create, func_name)\r\n   4217 def _intercept_create_request(\r\n   4218     self, request: typing.Dict, create, func_name: str = None  # pylint: disable=unused-argument\r\n   4219 ):\r\n   4220     \"\"\"This function intercepts the create job request.\r\n   4221 \r\n   4222     PipelineSession inherits this Session class and will override\r\n   (...)\r\n   4228         func_name (str): the name of the function needed intercepting\r\n   4229     \"\"\"\r\n-> 4230     return create(request)\r\n\r\nFile /opt/conda/lib/python3.8/site-packages/sagemaker/session.py:2894, in Session.create_model_package_from_containers.<locals>.submit(request)\r\n   2890     except ClientError:\r\n   2891         self.sagemaker_client.create_model_package_group(\r\n   2892             ModelPackageGroupName=request[\"ModelPackageGroupName\"]\r\n   2893         )\r\n-> 2894 return self.sagemaker_client.create_model_package(**request)\r\n\r\nFile /opt/conda/lib/python3.8/site-packages/botocore/client.py:508, in ClientCreator._create_api_method.<locals>._api_call(self, *args, **kwargs)\r\n    504     raise TypeError(\r\n    505         f\"{py_operation_name}() only accepts keyword arguments.\"\r\n    506     )\r\n    507 # The \"self\" in this scope is referring to the BaseClient.\r\n--> 508 return self._make_api_call(operation_name, kwargs)\r\n\r\nFile /opt/conda/lib/python3.8/site-packages/botocore/client.py:874, in BaseClient._make_api_call(self, operation_name, api_params)\r\n    865     logger.debug(\r\n    866         'Warning: %s.%s() is deprecated', service_name, operation_name\r\n    867     )\r\n    868 request_context = {\r\n    869     'client_region': self.meta.region_name,\r\n    870     'client_config': self.meta.config,\r\n    871     'has_streaming_input': operation_model.has_streaming_input,\r\n    872     'auth_type': operation_model.auth_type,\r\n    873 }\r\n--> 874 request_dict = self._convert_to_request_dict(\r\n    875     api_params, operation_model, context=request_context\r\n    876 )\r\n    877 resolve_checksum_context(request_dict, operation_model, api_params)\r\n    879 service_id = self._service_model.service_id.hyphenize()\r\n\r\nFile /opt/conda/lib/python3.8/site-packages/botocore/client.py:935, in BaseClient._convert_to_request_dict(self, api_params, operation_model, context)\r\n    929 def _convert_to_request_dict(\r\n    930     self, api_params, operation_model, context=None\r\n    931 ):\r\n    932     api_params = self._emit_api_params(\r\n    933         api_params, operation_model, context\r\n    934     )\r\n--> 935     request_dict = self._serializer.serialize_to_request(\r\n    936         api_params, operation_model\r\n    937     )\r\n    938     if not self._client_config.inject_host_prefix:\r\n    939         request_dict.pop('host_prefix', None)\r\n\r\nFile /opt/conda/lib/python3.8/site-packages/botocore/validate.py:381, in ParamValidationDecorator.serialize_to_request(self, parameters, operation_model)\r\n    377     report = self._param_validator.validate(\r\n    378         parameters, operation_model.input_shape\r\n    379     )\r\n    380     if report.has_errors():\r\n--> 381         raise ParamValidationError(report=report.generate_report())\r\n    382 return self._serializer.serialize_to_request(\r\n    383     parameters, operation_model\r\n    384 )\r\n\r\nParamValidationError: Parameter validation failed:\r\nInvalid type for parameter InferenceSpecification.SupportedRealtimeInferenceInstanceTypes, value: None, type: <class 'NoneType'>, valid types: <class 'list'>, <class 'tuple'>\r\nInvalid type for parameter InferenceSpecification.SupportedTransformInstanceTypes, value: None, type: <class 'NoneType'>, valid types: <class 'list'>, <class 'tuple'>\r\n```\r\n\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**:\r\n2.99.0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**:\r\nAny\r\n- **Framework version**:\r\nAny\r\n- **Python version**:\r\n3.8\r\n- **CPU or GPU**:\r\nAny\r\n- **Custom Docker image (Y/N)**:\r\nN\r\n**Additional context**\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3222/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3222/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3201", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3201/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3201/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3201/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3201", "id": 1287577293, "node_id": "I_kwDOBpf0x85Mvt7N", "number": 3201, "title": "ValueError: instance_type should not be a pipeline variable in SKLearnProcessor", "user": {"login": "zerualem", "id": 10284514, "node_id": "MDQ6VXNlcjEwMjg0NTE0", "avatar_url": "https://avatars.githubusercontent.com/u/10284514?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zerualem", "html_url": "https://github.com/zerualem", "followers_url": "https://api.github.com/users/zerualem/followers", "following_url": "https://api.github.com/users/zerualem/following{/other_user}", "gists_url": "https://api.github.com/users/zerualem/gists{/gist_id}", "starred_url": "https://api.github.com/users/zerualem/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zerualem/subscriptions", "organizations_url": "https://api.github.com/users/zerualem/orgs", "repos_url": "https://api.github.com/users/zerualem/repos", "events_url": "https://api.github.com/users/zerualem/events{/privacy}", "received_events_url": "https://api.github.com/users/zerualem/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-06-28T16:08:51Z", "updated_at": "2022-09-02T18:53:31Z", "closed_at": "2022-09-02T18:53:31Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nThe sagemaker.sklearn.processing SKLearnProcessor object throws a value error when sagemaker.workflow.parameters.ParameterString is passed as instance_type.\r\nI have been running the exact same script, and I never had an issue previously.\r\n\r\n**To reproduce**\r\n```Python\r\nfrom sagemaker.workflow.parameters import (\r\n    ParameterInteger,\r\n    ParameterString,\r\n    ParameterFloat\r\n)\r\nfrom sagemaker.sklearn.processing import SKLearnProcessor\r\n\r\nprocessing_instance_count = ParameterInteger(name=\"ProcessingInstanceCount\", default_value=1)\r\nprocessing_instance_type = ParameterString(name=\"ProcessingInstanceType\", default_value=\"ml.t3.large\")\r\nframework_version = \"0.23-1\"\r\n\r\nsklearn_processor = SKLearnProcessor(\r\n    framework_version=framework_version,\r\n    instance_type=processing_instance_type,\r\n    instance_count=processing_instance_count,\r\n    base_job_name=\"sk_preprocess\",\r\n    role=role,\r\n)\r\n```\r\n\r\n**Screenshots or logs**\r\n```Python\r\n---------------------------------------------------------------------------\r\nValueError                                Traceback (most recent call last)\r\n<ipython-input-4-9898fc9aebc0> in <module>\r\n      8     instance_count=processing_instance_count,\r\n      9     base_job_name=\"sk_preprocess\",\r\n---> 10     role=role,\r\n     11 )\r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/sklearn/processing.py in __init__(self, framework_version, role, instance_type, instance_count, command, volume_size_in_gb, volume_kms_key, output_kms_key, max_runtime_in_seconds, base_job_name, sagemaker_session, env, tags, network_config)\r\n     89 \r\n     90         image_uri = image_uris.retrieve(\r\n---> 91             defaults.SKLEARN_NAME, region, version=framework_version, instance_type=instance_type\r\n     92         )\r\n     93 \r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/image_uris.py in retrieve(framework, region, version, py_version, instance_type, accelerator_type, image_scope, container_version, distribution, base_framework_version, training_compiler_config, model_id, model_version, tolerate_vulnerable_model, tolerate_deprecated_model, sdk_version, inference_tool, serverless_inference_config)\r\n    115     for name, val in args.items():\r\n    116         if is_pipeline_variable(val):\r\n--> 117             raise ValueError(\"%s should not be a pipeline variable (%s)\" % (name, type(val)))\r\n    118 \r\n    119     if is_jumpstart_model_input(model_id, model_version):\r\n\r\nValueError: instance_type should not be a pipeline variable (<class 'sagemaker.workflow.parameters.ParameterString'>)\r\n```\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.94.0\r\n- I working on a SageMaker studio notebook\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3201/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3201/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3197", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3197/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3197/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3197/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3197", "id": 1285828066, "node_id": "I_kwDOBpf0x85MpC3i", "number": 3197, "title": "Not able to provide `extra_args` to S3Uploader.upload()", "user": {"login": "spaskalaydzhiyski", "id": 106966418, "node_id": "U_kgDOBmAtkg", "avatar_url": "https://avatars.githubusercontent.com/u/106966418?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spaskalaydzhiyski", "html_url": "https://github.com/spaskalaydzhiyski", "followers_url": "https://api.github.com/users/spaskalaydzhiyski/followers", "following_url": "https://api.github.com/users/spaskalaydzhiyski/following{/other_user}", "gists_url": "https://api.github.com/users/spaskalaydzhiyski/gists{/gist_id}", "starred_url": "https://api.github.com/users/spaskalaydzhiyski/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spaskalaydzhiyski/subscriptions", "organizations_url": "https://api.github.com/users/spaskalaydzhiyski/orgs", "repos_url": "https://api.github.com/users/spaskalaydzhiyski/repos", "events_url": "https://api.github.com/users/spaskalaydzhiyski/events{/privacy}", "received_events_url": "https://api.github.com/users/spaskalaydzhiyski/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-06-27T13:41:17Z", "updated_at": "2022-09-27T06:51:28Z", "closed_at": "2022-07-01T19:19:10Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nNot able to provide `extra_args` to S3Uploader.upload()\r\n\r\n**To reproduce**\r\nTry calling `sagemaker.s3.S3Uploader.upload()`\r\n<img width=\"700\" alt=\"image\" src=\"https://user-images.githubusercontent.com/106966418/175954247-82367b11-2c05-4e25-b113-83badf667262.png\">\r\n for an s3 bucket encrypted with **AES256**\r\n\r\nThe `upload()` function internally calls `sagemaker_session.upload_data()` which takes `extra_args` as param, but unfortunately we have no means of passing extra_args from `S3Uploader.upload()`\r\n<img width=\"764\" alt=\"image\" src=\"https://user-images.githubusercontent.com/106966418/175954179-40f89137-2cf5-44d7-9ef1-0ca84dc72b5a.png\">\r\n\r\nBecause of this line:\r\n<img width=\"393\" alt=\"image\" src=\"https://user-images.githubusercontent.com/106966418/175956039-381acc4d-ad48-4dd9-a4d9-539156f2ab2f.png\">\r\n\r\nWhen called the function results in AccessDenied error.\r\n<img width=\"487\" alt=\"image\" src=\"https://user-images.githubusercontent.com/106966418/175954641-c050253c-3af3-42c3-bcab-61300b789c47.png\">\r\n\r\n**Expected behavior**\r\nI would expect to be able to call `S3Uploader.upload(local_file_path, s3_destination_path, extra_args={'ServerSideEncryption': 'AES256'})`.\r\n\r\n**IMPORTANT**\r\nThis problem also breaks the demos in SageMaker Studio (in case you are using AES256 encrypted S3 buckets) since both `Processor` and `ScriptProcessor` use `S3Uploader` internally to communicate with S3.\r\nThe fix is very straight forward (although laborious) and only requires to add `extra_args` to all the places where `S3Uploader.upload` is called from **including all upstream function calls that are supposed to pass `extra_args` down to S3Uploader.upload.**\r\n<img width=\"989\" alt=\"image\" src=\"https://user-images.githubusercontent.com/106966418/176168054-04aab4b7-f25e-4b79-87d0-e3b0a9779cc7.png\">\r\n\r\n\r\n**Screenshots or logs**\r\nIf applicable, add screenshots or logs to help explain your problem.\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**:2.96.0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**:\r\n- **Framework version**:\r\n- **Python version**:3.9\r\n- **CPU or GPU**:CPU\r\n- **Custom Docker image (Y/N)**:N\r\n\r\n**Additional context**\r\nI can write the fix myself, but since `S3Uploader.upload()` is quite a common function and is used all throughout the codebase - I would rather not touch other modules in sagemaker a part from `S3Uploader`. The full solution would include adding the option to pass `extra_args` to **all calls** of `S3Uploader.upload()`", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3197/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3197/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3196", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3196/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3196/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3196/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3196", "id": 1285489053, "node_id": "I_kwDOBpf0x85MnwGd", "number": 3196, "title": "Cannot invoke Sagemaker endpoint, ReadTimeoutError: Read timeout on endpoint URL: ... but no errors in model deploy", "user": {"login": "AlinaAlbasova", "id": 39599016, "node_id": "MDQ6VXNlcjM5NTk5MDE2", "avatar_url": "https://avatars.githubusercontent.com/u/39599016?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AlinaAlbasova", "html_url": "https://github.com/AlinaAlbasova", "followers_url": "https://api.github.com/users/AlinaAlbasova/followers", "following_url": "https://api.github.com/users/AlinaAlbasova/following{/other_user}", "gists_url": "https://api.github.com/users/AlinaAlbasova/gists{/gist_id}", "starred_url": "https://api.github.com/users/AlinaAlbasova/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AlinaAlbasova/subscriptions", "organizations_url": "https://api.github.com/users/AlinaAlbasova/orgs", "repos_url": "https://api.github.com/users/AlinaAlbasova/repos", "events_url": "https://api.github.com/users/AlinaAlbasova/events{/privacy}", "received_events_url": "https://api.github.com/users/AlinaAlbasova/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-06-27T09:08:59Z", "updated_at": "2022-06-27T13:40:29Z", "closed_at": "2022-06-27T13:40:29Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nAfter \"successfull\" model.deploy, we tried to invoke our ENDPOINT, but got ReadTimeoutError: Read timeout on endpoint URL. While there are **NO** errors in model deploy log, only `WARNING: sun.reflect.Reflection.getCallerClass is not supported. This will impact performance.` and `Model server started.` But neither model loading nor error happen after this. In UI, endpoint have status **InService** (**Several days ago the same code worked without any issues**. We first encountered the problem on June 24, 2022)\r\n\r\n\r\n**To reproduce**\r\n1. Archive model.pth file into gz.tar and upload in to s3\r\n2. Prepare inference.py script (input_fn, output_fn, predict_fn, model_fn) and requirements.txt\r\n3. Build model using pre-built Pytorch container:\r\npytorch_model = PyTorchModel(model_data=model_archive_path,\r\n                                 name=ENDPOINT_NAME,\r\n                                 role=role,\r\n                                 source_dir='SOURCE_DIR',\r\n                                 entry_point='SOURCE_DIR/inference.py',\r\n                                 framework_version='1.9',\r\n\r\n5. Deploy model\r\n6. Invoke endpoint\r\n\r\n\r\n**Expected behavior**\r\nAn endpoint should return response in a way defined in output_fn of inference.py script\r\n\r\n**Screenshots or logs**\r\n\r\n```\r\nCollecting opencv-python>=4.2.0.32  Downloading opencv_python-4.6.0.66-cp36-abi3-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (60.9 MB)     \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 60.9/60.9 MB 30.8 MB/s eta 0:00:00\r\n--\r\nCollecting shapely>=1.8.0  Downloading Shapely-1.8.2-cp38-cp38-manylinux_2_12_x86_64.manylinux2010_x86_64.whl (2.1 MB)     \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 2.1/2.1 MB 66.8 MB/s eta 0:00:00\r\nRequirement already satisfied: tqdm>=4.48.2 in /opt/conda/lib/python3.8/site-packages (from -r /opt/ml/model/code/requirements.txt (line 3)) (4.64.0)\r\nRequirement already satisfied: pillow>=8.2.0 in /opt/conda/lib/python3.8/site-packages (from -r /opt/ml/model/code/requirements.txt (line 4)) (9.1.1)\r\nRequirement already satisfied: pyyaml in /opt/conda/lib/python3.8/site-packages (from -r /opt/ml/model/code/requirements.txt (line 5)) (5.4.1)\r\nCollecting fire  Downloading fire-0.4.0.tar.gz (87 kB)     \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 87.7/87.7 kB 17.4 MB/s eta 0:00:00  Preparing metadata (setup.py): started  Preparing metadata (setup.py): finished with status 'done'\r\nCollecting terminaltables  Downloading terminaltables-3.1.10-py2.py3-none-any.whl (15 kB)\r\nRequirement already satisfied: requests in /opt/conda/lib/python3.8/site-packages (from -r /opt/ml/model/code/requirements.txt (line 8)) (2.28.0)\r\nCollecting click==8.0.4  Downloading click-8.0.4-py3-none-any.whl (97 kB)     \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 97.5/97.5 kB 5.5 MB/s eta 0:00:00\r\nCollecting boto3  Downloading boto3-1.24.16-py3-none-any.whl (132 kB)     \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 132.5/132.5 kB 28.9 MB/s eta 0:00:00\r\nCollecting smart_open  Downloading smart_open-6.0.0-py3-none-any.whl (58 kB)     \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 58.4/58.4 kB 9.0 MB/s eta 0:00:00\r\nRequirement already satisfied: numpy in /opt/conda/lib/python3.8/site-packages (from -r /opt/ml/model/code/requirements.txt (line 12)) (1.22.4)\r\nCollecting onnx>=1.9.0  Downloading onnx-1.12.0-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (13.1 MB)     \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 13.1/13.1 MB 87.2 MB/s eta 0:00:00\r\nCollecting onnx-simplifier>=0.3.6  Downloading onnx-simplifier-0.3.10.tar.gz (14 kB)  Preparing metadata (setup.py): started  Preparing metadata (setup.py): finished with status 'done'\r\nRequirement already satisfied: six in /opt/conda/lib/python3.8/site-packages (from fire->-r /opt/ml/model/code/requirements.txt (line 6)) (1.16.0)\r\nCollecting termcolor  Downloading termcolor-1.1.0.tar.gz (3.9 kB)  Preparing metadata (setup.py): started  Preparing metadata (setup.py): finished with status 'done'\r\nRequirement already satisfied: certifi>=2017.4.17 in /opt/conda/lib/python3.8/site-packages (from requests->-r /opt/ml/model/code/requirements.txt (line 8)) (2022.6.15)\r\nRequirement already satisfied: charset-normalizer~=2.0.0 in /opt/conda/lib/python3.8/site-packages (from requests->-r /opt/ml/model/code/requirements.txt (line 8)) (2.0.4)\r\nRequirement already satisfied: urllib3<1.27,>=1.21.1 in /opt/conda/lib/python3.8/site-packages (from requests->-r /opt/ml/model/code/requirements.txt (line 8)) (1.26.9)\r\nRequirement already satisfied: idna<4,>=2.5 in /opt/conda/lib/python3.8/site-packages (from requests->-r /opt/ml/model/code/requirements.txt (line 8)) (3.3)\r\nCollecting botocore<1.28.0,>=1.27.16  Downloading botocore-1.27.16-py3-none-any.whl (8.9 MB)     \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 8.9/8.9 MB 94.8 MB/s eta 0:00:00\r\nRequirement already satisfied: jmespath<2.0.0,>=0.7.1 in /opt/conda/lib/python3.8/site-packages (from boto3->-r /opt/ml/model/code/requirements.txt (line 10)) (1.0.1)\r\nRequirement already satisfied: s3transfer<0.7.0,>=0.6.0 in /opt/conda/lib/python3.8/site-packages (from boto3->-r /opt/ml/model/code/requirements.txt (line 10)) (0.6.0)\r\nCollecting protobuf<=3.20.1,>=3.12.2  Downloading protobuf-3.20.1-cp38-cp38-manylinux_2_5_x86_64.manylinux1_x86_64.whl (1.0 MB)     \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 1.0/1.0 MB 82.0 MB/s eta 0:00:00\r\nRequirement already satisfied: typing-extensions>=3.6.2.1 in /opt/conda/lib/python3.8/site-packages (from onnx>=1.9.0->-r /opt/ml/model/code/requirements.txt (line 13)) (4.2.0)\r\nCollecting onnxoptimizer>=0.2.6  Downloading onnxoptimizer-0.2.7-cp38-cp38-manylinux2014_x86_64.whl (499 kB)     \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 499.4/499.4 kB 62.2 MB/s eta 0:00:00\r\nCollecting rich  Downloading rich-12.4.4-py3-none-any.whl (232 kB)     \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 232.0/232.0 kB 41.3 MB/s eta 0:00:00\r\nCollecting onnxruntime>=1.11.1  Downloading onnxruntime-1.11.1-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (5.2 MB)     \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 5.2/5.2 MB 119.8 MB/s eta 0:00:00\r\nRequirement already satisfied: python-dateutil<3.0.0,>=2.1 in /opt/conda/lib/python3.8/site-packages (from botocore<1.28.0,>=1.27.16->boto3->-r /opt/ml/model/code/requirements.txt (line 10)) (2.8.2)\r\nCollecting flatbuffers  Downloading flatbuffers-2.0-py2.py3-none-any.whl (26 kB)\r\nRequirement already satisfied: pygments<3.0.0,>=2.6.0 in /opt/conda/lib/python3.8/site-packages (from rich->onnx-simplifier>=0.3.6->-r /opt/ml/model/code/requirements.txt (line 14)) (2.11.2)\r\nCollecting commonmark<0.10.0,>=0.9.0  Downloading commonmark-0.9.1-py2.py3-none-any.whl (51 kB)     \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 51.1/51.1 kB 12.1 MB/s eta 0:00:00\r\nBuilding wheels for collected packages: fire, onnx-simplifier, termcolor  Building wheel for fire (setup.py): started  Building wheel for fire (setup.py): finished with status 'done'  Created wheel for fire: filename=fire-0.4.0-py2.py3-none-any.whl size=115942 sha256=b88008efc779a033efd9dbe258532761a6888962f833c1723d9667acfb8d6ce3  Stored in directory: /root/.cache/pip/wheels/1f/10/06/2a990ee4d73a8479fe2922445e8a876d38cfbfed052284c6a1  Building wheel for onnx-simplifier (setup.py): started  Building wheel for onnx-simplifier (setup.py): finished with status 'done'  Created wheel for onnx-simplifier: filename=onnx_simplifier-0.3.10-py3-none-any.whl size=14811 sha256=2949c73afc76c2ac214f311f66e9da5a1e35c3ed8f99d00a32125926b2b8a369  Stored in directory: /root/.cache/pip/wheels/69/65/40/3233ab81517b8ce538a3c6337dac2c7e33534c5ae118a8403b  Building wheel for termcolor (setup.py): started  Building wheel for termcolor (setup.py): finished with status 'done'  Created wheel for termcolor: filename=termcolor-1.1.0-py3-none-any.whl size=4848 sha256=8e295770ae50bdf83291221c57228543b520aabfef8562fe24281e8061d8f910  Stored in directory: /root/.cache/pip/wheels/a0/16/9c/5473df82468f958445479c59e784896fa24f4a5fc024b0f501\r\nSuccessfully built fire onnx-simplifier termcolor\r\nInstalling collected packages: termcolor, flatbuffers, commonmark, terminaltables, smart_open, shapely, rich, protobuf, opencv-python, fire, click, onnxruntime, onnx, botocore, onnxoptimizer, onnx-simplifier, boto3  Attempting uninstall: botocore    Found existing installation: botocore 1.27.14    Uninstalling botocore-1.27.14:      Successfully uninstalled botocore-1.27.14\r\nERROR: pip's dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.\r\nawscli 1.25.14 requires botocore==1.27.14, but you have botocore 1.27.16 which is incompatible.\r\nSuccessfully installed boto3-1.24.16 botocore-1.27.16 click-8.0.4 commonmark-0.9.1 fire-0.4.0 flatbuffers-2.0 onnx-1.12.0 onnx-simplifier-0.3.10 onnxoptimizer-0.2.7 onnxruntime-1.11.1 opencv-python-4.6.0.66 protobuf-3.20.1 rich-12.4.4 shapely-1.8.2 smart_open-6.0.0 termcolor-1.1.0 terminaltables-3.1.10\r\nWARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv\r\nWARNING: sun.reflect.Reflection.getCallerClass is not supported. This will impact performance.\r\nModel server started.\r\n```\r\n\r\n\r\n**System information**\r\n- **SageMaker Python SDK version**: 2.96.0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: PyTorch\r\n- **Framework version**: 1.9\r\n- **Python version**: 3.8\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3196/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3196/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3195", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3195/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3195/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3195/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3195", "id": 1284531455, "node_id": "I_kwDOBpf0x85MkGT_", "number": 3195, "title": "Execution variables cannot be used in spark_event_logs_s3_uri", "user": {"login": "nebur395", "id": 17260233, "node_id": "MDQ6VXNlcjE3MjYwMjMz", "avatar_url": "https://avatars.githubusercontent.com/u/17260233?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nebur395", "html_url": "https://github.com/nebur395", "followers_url": "https://api.github.com/users/nebur395/followers", "following_url": "https://api.github.com/users/nebur395/following{/other_user}", "gists_url": "https://api.github.com/users/nebur395/gists{/gist_id}", "starred_url": "https://api.github.com/users/nebur395/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nebur395/subscriptions", "organizations_url": "https://api.github.com/users/nebur395/orgs", "repos_url": "https://api.github.com/users/nebur395/repos", "events_url": "https://api.github.com/users/nebur395/events{/privacy}", "received_events_url": "https://api.github.com/users/nebur395/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2022-06-25T09:52:07Z", "updated_at": "2022-07-19T13:04:42Z", "closed_at": "2022-07-19T13:04:42Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nIn order to be able to organise our S3 bucket in which the input and the outputs are being uploaded for our Sagemaker pipelines, we want to be able to specify a custom `spark_event_logs_s3_uri` path. To improve our data lineage we are trying to store these files by pipeline name and execution ids. \r\n\r\nTherefore we need to use ExecutionVariables in `spark_event_logs_s3_uri` property. For using them, you have to use the special `Join` function from sagemaker, otherwise you cannot concatenate them with other static strings. So final output for this property would be:\r\n```\r\nspark_event_logs_s3_uri=Join(on=\"/\", values=[\r\n    \"s3:/\", default_bucket, ExecutionVariables.PIPELINE_NAME, ExecutionVariables.PIPELINE_EXECUTION_ID, \"spark-event-logs/\"\r\n])\r\n```\r\n\r\nWith that said, we are getting an error which says: `AttributeError: 'Join' object has no attribute 'decode'`. However, if you just remove the Join and the Execution variables for something like this: `spark_event_logs_s3_uri=f\"s3://{default_bucket}/spark-event-logs/\"` then it works.\r\n\r\n**To reproduce**\r\n```\r\nimport boto3\r\nimport sagemaker\r\nfrom sagemaker.workflow.pipeline import Pipeline\r\nfrom sagemaker.processing import ProcessingInput, ProcessingOutput\r\nfrom sagemaker.workflow.steps import ProcessingStep\r\nfrom sagemaker.spark.processing import PySparkProcessor\r\nfrom sagemaker.workflow.execution_variables import ExecutionVariables\r\nfrom sagemaker.workflow.functions import Join\r\n\r\nboto_session = boto3.Session(region_name=\"eu-west-1\")\r\n\r\nsagemaker_client = boto_session.client(\"sagemaker\")\r\n\r\ndefault_bucket = \"XYZ\"\r\n\r\nsagemaker_session = sagemaker.session.Session(\r\n    boto_session=boto_session,\r\n    sagemaker_client=sagemaker_client,\r\n    default_bucket=default_bucket\r\n)\r\n\r\nbucket_pipeline_execution_prefix = [\r\n    \"s3:/\", default_bucket, ExecutionVariables.PIPELINE_NAME, ExecutionVariables.PIPELINE_EXECUTION_ID\r\n]\r\n\r\nspark_processor = PySparkProcessor(\r\n    base_job_name=\"sm-spark\",\r\n    role=\"XYZ\",\r\n    instance_count=1,\r\n    instance_type=\"ml.m5.xlarge\",\r\n    max_runtime_in_seconds=1200,\r\n    image_uri=\"XYZ\",\r\n    sagemaker_session=sagemaker_session\r\n)\r\n\r\nrun_args = spark_processor.get_run_args(\r\n    submit_app=\"./processing.py\",\r\n    inputs=[],\r\n    outputs=[\r\n        ProcessingOutput(\r\n            source='/opt/ml/processing/output',\r\n            output_name='demo-output',\r\n            destination=Join(on=\"/\", values=[\r\n                *bucket_pipeline_execution_prefix, \"output/preprocessed\"\r\n            ])\r\n        )\r\n    ],\r\n    spark_event_logs_s3_uri=Join(on=\"/\", values=[\r\n                *bucket_pipeline_execution_prefix, \"spark-event-logs\"\r\n            ])\r\n)\r\n\r\nstep_process = ProcessingStep(\r\n    name=\"demo-processing\",\r\n    processor=spark_processor,\r\n    inputs=run_args.inputs,\r\n    outputs=run_args.outputs,\r\n    code=run_args.code,\r\n)\r\n\r\npipeline = Pipeline(\r\n    name='demo-pipeline',\r\n    parameters=[],\r\n    sagemaker_session=sagemaker_session,\r\n    steps=[step_process],\r\n)\r\n\r\npipeline.upsert(role_arn=\"XYZ\")\r\n\r\nexecution = pipeline.start()\r\n```\r\n\r\n**Expected behavior**\r\nScript to work and spark logs to be stored in the same way as `step_preprocess.properties.ProcessingOutputConfig.Outputs[\"demo-output\"].S3Output.S3Uri`\r\n\r\n**Screenshots or logs**\r\n```\r\n---------------------------------------------------------------------------\r\nAttributeError                            Traceback (most recent call last)\r\n<ipython-input-21-cf9b6fbcda40> in <module>\r\n     55     ],\r\n     56     spark_event_logs_s3_uri=Join(on=\"/\", values=[\r\n---> 57                 \"s3:/\", default_bucket, ExecutionVariables.PIPELINE_NAME, ExecutionVariables.PIPELINE_EXECUTION_ID, \"spark-event-logs/\"\r\n     58             ])\r\n     59 )\r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/spark/processing.py in get_run_args(self, submit_app, submit_py_files, submit_jars, submit_files, inputs, outputs, arguments, job_name, configuration, spark_event_logs_s3_uri)\r\n    784             submit_files=submit_files,\r\n    785             configuration=configuration,\r\n--> 786             spark_event_logs_s3_uri=spark_event_logs_s3_uri,\r\n    787         )\r\n    788 \r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/spark/processing.py in _extend_processing_args(self, inputs, outputs, **kwargs)\r\n    900         )\r\n    901 \r\n--> 902         return super()._extend_processing_args(extended_inputs, outputs, **kwargs)\r\n    903 \r\n    904 \r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/spark/processing.py in _extend_processing_args(self, inputs, outputs, **kwargs)\r\n    267         if kwargs.get(\"spark_event_logs_s3_uri\"):\r\n    268             spark_event_logs_s3_uri = kwargs.get(\"spark_event_logs_s3_uri\")\r\n--> 269             self._validate_s3_uri(spark_event_logs_s3_uri)\r\n    270 \r\n    271             self._spark_event_logs_s3_uri = spark_event_logs_s3_uri\r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/spark/processing.py in _validate_s3_uri(self, spark_output_s3_path)\r\n    593             spark_output_s3_path (str): The URI of the Spark output S3 Path.\r\n    594         \"\"\"\r\n--> 595         if urlparse(spark_output_s3_path).scheme != \"s3\":\r\n    596             raise ValueError(\r\n    597                 f\"Invalid s3 path: {spark_output_s3_path}. Please enter something like \"\r\n\r\n/opt/conda/lib/python3.7/urllib/parse.py in urlparse(url, scheme, allow_fragments)\r\n    365     Note that we don't break the components up in smaller bits\r\n    366     (e.g. netloc is a single string) and we don't expand % escapes.\"\"\"\r\n--> 367     url, scheme, _coerce_result = _coerce_args(url, scheme)\r\n    368     splitresult = urlsplit(url, scheme, allow_fragments)\r\n    369     scheme, netloc, url, query, fragment = splitresult\r\n\r\n/opt/conda/lib/python3.7/urllib/parse.py in _coerce_args(*args)\r\n    121     if str_input:\r\n    122         return args + (_noop,)\r\n--> 123     return _decode_args(args) + (_encode_result,)\r\n    124 \r\n    125 # Result objects are more helpful than simple tuples\r\n\r\n/opt/conda/lib/python3.7/urllib/parse.py in _decode_args(args, encoding, errors)\r\n    105 def _decode_args(args, encoding=_implicit_encoding,\r\n    106                        errors=_implicit_errors):\r\n--> 107     return tuple(x.decode(encoding, errors) if x else '' for x in args)\r\n    108 \r\n    109 def _coerce_args(*args):\r\n\r\n/opt/conda/lib/python3.7/urllib/parse.py in <genexpr>(.0)\r\n    105 def _decode_args(args, encoding=_implicit_encoding,\r\n    106                        errors=_implicit_errors):\r\n--> 107     return tuple(x.decode(encoding, errors) if x else '' for x in args)\r\n    108 \r\n    109 def _coerce_args(*args):\r\n\r\nAttributeError: 'Join' object has no attribute 'decode'\r\n```\r\n\r\n**System information**\r\nSagemaker studio notebook:\r\n- Instance type: ml.t3.medium\r\n- Notebook environment: \r\n  - Image: Data science\r\n  - Kernel: Python 3", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3195/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3195/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3152", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3152/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3152/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3152/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3152", "id": 1255696515, "node_id": "I_kwDOBpf0x85K2GiD", "number": 3152, "title": "Passing processor image uri as a ParameterString fails", "user": {"login": "lkev", "id": 3269734, "node_id": "MDQ6VXNlcjMyNjk3MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3269734?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lkev", "html_url": "https://github.com/lkev", "followers_url": "https://api.github.com/users/lkev/followers", "following_url": "https://api.github.com/users/lkev/following{/other_user}", "gists_url": "https://api.github.com/users/lkev/gists{/gist_id}", "starred_url": "https://api.github.com/users/lkev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lkev/subscriptions", "organizations_url": "https://api.github.com/users/lkev/orgs", "repos_url": "https://api.github.com/users/lkev/repos", "events_url": "https://api.github.com/users/lkev/events{/privacy}", "received_events_url": "https://api.github.com/users/lkev/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2022-06-01T11:06:41Z", "updated_at": "2022-08-05T21:09:45Z", "closed_at": "2022-08-05T21:09:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\n\r\nWhen passing a `ParameterString` object as the `image_uri` to `Processor`, it fails on pipeline definition as it's trying to parse and verify the image uri as a string, but it's a `ParameterString`, so fails.\r\n\r\n__important note__ This fails on the latest version, 2.92.2, but not on 2.91.2.dev0 (the version installed from #3111 ).\r\n\r\n\r\n**To reproduce**\r\n\r\n```python\r\nimport sagemaker\r\nfrom sagemaker.workflow.parameters import ParameterString\r\nfrom sagemaker.workflow.pipeline import Pipeline\r\nfrom sagemaker.workflow.steps import ProcessingStep\r\nfrom sagemaker.processing import Processor\r\n\r\nprint(sagemaker.__version__)\r\n\r\nparam_estimator_image_uri = ParameterString(\r\n    name=\"estimator_image_uri\",\r\n)\r\nproc = Processor(\r\n    image_uri=param_estimator_image_uri,\r\n    role=\"arn:aws:iam::942338063951:role/datascience-sagemaker\",\r\n    instance_count=1,\r\n    instance_type=\"ml.g4dn.xlarge\",\r\n)\r\n\r\nproc_step= ProcessingStep(\"proc_step\", processor=proc)\r\n\r\npipe = Pipeline(name=\"TestPipe\", steps=[proc_step])\r\nprint(pipe.definition())\r\n```\r\n\r\n**Expected behavior**\r\n\r\nExpect following output:\r\n\r\n```python\r\n2.92.2\r\n{\"Version\": \"2020-12-01\", \"Metadata\": {}, \"Parameters\": [], \"PipelineExperimentConfig\": {\"ExperimentName\": {\"Get\": \"Execution.PipelineName\"}, \"TrialName\": {\"Get\": \"Execution.PipelineExecutionId\"}}, \"Steps\": [{\"Name\": \"proc_step\", \"Type\": \"Processing\", \"Arguments\": {\"ProcessingResources\": {\"ClusterConfig\": {\"InstanceType\": \"ml.g4dn.xlarge\", \"InstanceCount\": 1, \"VolumeSizeInGB\": 30}}, \"AppSpecification\": {\"ImageUri\": {\"Get\": \"Parameters.estimator_image_uri\"}}, \"RoleArn\": \"arn:aws:iam::942338063951:role/datascience-sagemaker\"}}]}\r\n```\r\n\r\n**Screenshots or logs**\r\n\r\nGet the following error:\r\n\r\n```python\r\n2.92.2\r\nTraceback (most recent call last):\r\n  File \"/Users/nh105218/repos/fraud_detector/smtest.py\", line 22, in <module>\r\n    print(pipe.definition())\r\n  File \"/opt/miniconda3/envs/env2/lib/python3.9/site-packages/sagemaker/workflow/pipeline.py\", line 292, in definition\r\n    request_dict = self.to_request()\r\n  File \"/opt/miniconda3/envs/env2/lib/python3.9/site-packages/sagemaker/workflow/pipeline.py\", line 91, in to_request\r\n    \"Steps\": list_to_request(self.steps),\r\n  File \"/opt/miniconda3/envs/env2/lib/python3.9/site-packages/sagemaker/workflow/utilities.py\", line 43, in list_to_request\r\n    request_dicts.append(entity.to_request())\r\n  File \"/opt/miniconda3/envs/env2/lib/python3.9/site-packages/sagemaker/workflow/steps.py\", line 754, in to_request\r\n    request_dict = super(ProcessingStep, self).to_request()\r\n  File \"/opt/miniconda3/envs/env2/lib/python3.9/site-packages/sagemaker/workflow/steps.py\", line 226, in to_request\r\n    step_dict = super().to_request()\r\n  File \"/opt/miniconda3/envs/env2/lib/python3.9/site-packages/sagemaker/workflow/steps.py\", line 109, in to_request\r\n    \"Arguments\": self.arguments,\r\n  File \"/opt/miniconda3/envs/env2/lib/python3.9/site-packages/sagemaker/workflow/steps.py\", line 730, in arguments\r\n    normalized_inputs, normalized_outputs = self.processor._normalize_args(\r\n  File \"/opt/miniconda3/envs/env2/lib/python3.9/site-packages/sagemaker/processing.py\", line 240, in _normalize_args\r\n    self._current_job_name = self._generate_current_job_name(job_name=job_name)\r\n  File \"/opt/miniconda3/envs/env2/lib/python3.9/site-packages/sagemaker/processing.py\", line 283, in _generate_current_job_name\r\n    base_name = base_name_from_image(self.image_uri)\r\n  File \"/opt/miniconda3/envs/env2/lib/python3.9/site-packages/sagemaker/utils.py\", line 102, in base_name_from_image\r\n    m = re.match(\"^(.+/)?([^:/]+)(:[^:]+)?$\", image)\r\n  File \"/opt/miniconda3/envs/env2/lib/python3.9/re.py\", line 191, in match\r\n    return _compile(pattern, flags).match(string)\r\nTypeError: expected string or bytes-like object\r\n```\r\n\r\nWhen debugging, the value I get for `image` being passed to `base_name_from_image(image)` is `ParameterString(name='estimator_image_uri', parameter_type=<ParameterTypeEnum.STRING: 'String'>, default_value=None)`\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.92.2\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: N/A\r\n- **Framework version**: N/A\r\n- **Python version**: 3.9.6\r\n- **CPU or GPU**: N/A\r\n- **Custom Docker image (Y/N)**: N", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3152/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3152/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3149", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3149/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3149/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3149/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3149", "id": 1253908741, "node_id": "I_kwDOBpf0x85KvSEF", "number": 3149, "title": "Not able to have the value of the output_path in TensorFlow estimator as pipeline parameter", "user": {"login": "mouhannadali", "id": 17967903, "node_id": "MDQ6VXNlcjE3OTY3OTAz", "avatar_url": "https://avatars.githubusercontent.com/u/17967903?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mouhannadali", "html_url": "https://github.com/mouhannadali", "followers_url": "https://api.github.com/users/mouhannadali/followers", "following_url": "https://api.github.com/users/mouhannadali/following{/other_user}", "gists_url": "https://api.github.com/users/mouhannadali/gists{/gist_id}", "starred_url": "https://api.github.com/users/mouhannadali/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mouhannadali/subscriptions", "organizations_url": "https://api.github.com/users/mouhannadali/orgs", "repos_url": "https://api.github.com/users/mouhannadali/repos", "events_url": "https://api.github.com/users/mouhannadali/events{/privacy}", "received_events_url": "https://api.github.com/users/mouhannadali/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2022-05-31T13:55:27Z", "updated_at": "2022-06-05T21:25:35Z", "closed_at": "2022-06-05T21:25:34Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nI am not able to have the value of the output_path in TensorFlow estimater as pipeline parameter\r\n\r\n**To reproduce**\r\nI created the following Sagemaker workflow parameters:\r\n```\r\ntraining_instance_type = ParameterString(name=\"TrainingInstanceType\", default_value=\"ml.c5.2xlarge\")\r\ntraining_instance_count = ParameterInteger(name=\"TrainingInstanceCount\", default_value=1)\r\nuse_spot_instances = ParameterBoolean(name=\"UseSpot_Instances\", default_value=False)\r\ntrain_output_s3 = ParameterString(name=\"TrainOutputS3Path\", default_value=\"s3://bucketname/key/\")\r\n```\r\ncreated the following TF estimator:\r\n```\r\nestimator = TensorFlow(\r\n    sagemaker_session=sess,\r\n    entry_point=\"unet.py\",\r\n    source_dir=\"scripts/\",\r\n    role=role,\r\n    instance_count=training_instance_count,\r\n    instance_type=training_instance_type,\r\n    framework_version=\"2.1\",\r\n    py_version=\"py3\",\r\n    use_spot_instances=use_spot_instances,\r\n    output_path=train_output_s3,\r\n    container_log_level=logging.WARNING,\r\n    hyperparameters=hyperparameters,\r\n)\r\n```\r\n\r\ncreated the training step:\r\n```\r\ninput_path = \"s3://bucketname-2/key-2/\"\r\ninputs = TrainingInput(s3_data=input_path)\r\n\r\nstep_train = TrainingStep(\r\n    name=\"pytorch-train\",\r\n    estimator=estimator,\r\n    inputs=inputs,\r\n)\r\n```\r\nand finally created the pipeline and tried to print the pipeline.definition()\r\n```\r\npipeline = Pipeline(\r\n    name=pipeline_name,\r\n    parameters = [training_instance_type, training_instance_count,use_spot_instances, train_output_s3],\r\n    steps=[step_train],\r\n    sagemaker_session=sess,\r\n)\r\n\r\npipeline.definition()\r\n```\r\n\r\n**Expected behavior**\r\nThe pipeline should be created without any problem \r\n\r\n**Screenshots or logs**\r\n![image](https://user-images.githubusercontent.com/17967903/171187287-c684ed35-d58c-410c-b907-a58167cc7ee2.png)\r\n\r\n**Additional context**\r\nNow if I hardcode the output_path in the estimator then it is working correctly:\r\n\r\n```\r\nestimator = TensorFlow(\r\n    sagemaker_session=sess,\r\n    entry_point=\"unet.py\",\r\n    source_dir=\"scripts/\",\r\n    role=role,\r\n    instance_count=training_instance_count,\r\n    instance_type=training_instance_type,\r\n    framework_version=\"2.1\",\r\n    py_version=\"py3\",\r\n    use_spot_instances=use_spot_instances,\r\n    output_path=\"s3://bucketname/key/\",\r\n    container_log_level=logging.WARNING,\r\n    hyperparameters=hyperparameters,\r\n)\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3149/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3149/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3143", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3143/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3143/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3143/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3143", "id": 1250770095, "node_id": "I_kwDOBpf0x85KjTyv", "number": 3143, "title": "Repack always uses sklearn image", "user": {"login": "jponf", "id": 3852560, "node_id": "MDQ6VXNlcjM4NTI1NjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3852560?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jponf", "html_url": "https://github.com/jponf", "followers_url": "https://api.github.com/users/jponf/followers", "following_url": "https://api.github.com/users/jponf/following{/other_user}", "gists_url": "https://api.github.com/users/jponf/gists{/gist_id}", "starred_url": "https://api.github.com/users/jponf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jponf/subscriptions", "organizations_url": "https://api.github.com/users/jponf/orgs", "repos_url": "https://api.github.com/users/jponf/repos", "events_url": "https://api.github.com/users/jponf/events{/privacy}", "received_events_url": "https://api.github.com/users/jponf/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2022-05-27T13:28:18Z", "updated_at": "2022-10-31T21:40:16Z", "closed_at": "2022-10-31T21:38:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "When registering a pytorch model, using python 3.8, it fails because the requirements.txt includes dependencies (numpy is the one failing in this case, but may be others) that cannot be installed during the repack step.\r\n\r\nWe've found that the repack image cannot be changed and that right now it is an image using Python 3.7, a Python version not supported by our numpy version.\r\nhttps://github.com/aws/sagemaker-python-sdk/blob/56452f100696e3f9db3621fb8de44ec7034263d4/src/sagemaker/workflow/_utils.py#L40\r\n\r\nWith numpy we can probably remove it from the requirement.txt but there might be other libraries that we cannot ignore this way.\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n\r\n - SageMaker Python SDK version: 2.88.3\r\n - Framework name (eg. PyTorch) or algorithm (eg. KMeans): PyTorch\r\n - Framework version: 1.10\r\n - Python version: py38\r\n - CPU or GPU: CPU\r\n - Custom Docker image (Y/N): N", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3143/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3143/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3142", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3142/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3142/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3142/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3142", "id": 1250316830, "node_id": "I_kwDOBpf0x85KhlIe", "number": 3142, "title": "model_dir cannot be created when output_path is a Join object for TensorFlow Estimator", "user": {"login": "andjsmi", "id": 101757907, "node_id": "U_kgDOBhCz0w", "avatar_url": "https://avatars.githubusercontent.com/u/101757907?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andjsmi", "html_url": "https://github.com/andjsmi", "followers_url": "https://api.github.com/users/andjsmi/followers", "following_url": "https://api.github.com/users/andjsmi/following{/other_user}", "gists_url": "https://api.github.com/users/andjsmi/gists{/gist_id}", "starred_url": "https://api.github.com/users/andjsmi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andjsmi/subscriptions", "organizations_url": "https://api.github.com/users/andjsmi/orgs", "repos_url": "https://api.github.com/users/andjsmi/repos", "events_url": "https://api.github.com/users/andjsmi/events{/privacy}", "received_events_url": "https://api.github.com/users/andjsmi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-05-27T04:16:19Z", "updated_at": "2022-06-06T16:41:08Z", "closed_at": "2022-06-06T16:41:07Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**Describe the bug**\r\nWhen creating a pipeline with a TrainingStep with a TensorFlow Estimator where output_path=Join, the pipeline definition cannot be created if model_dir is not passed as a parameter. On running `pipeline.definition()` it throws \r\n\r\nTypeError: expected str, bytes or os.PathLike object, not Join\r\n\r\n\r\n\r\n\r\n**To reproduce**\r\nCreate a Tensorflow Estimator where the output_path given is a Join object. Do not pass any value for the model_dir parameter.\r\n\r\n**Expected behavior**\r\nThe SDK generates the model_dir as required.\r\n\r\n**Screenshots or logs**\r\n```\r\nfrom sagemaker.tensorflow import TensorFlow\r\nfrom sagemaker.inputs import TrainingInput\r\nfrom sagemaker.workflow.steps import TrainingStep\r\nfrom sagemaker.workflow.step_collections import RegisterModel\r\nfrom sagemaker.workflow.functions import Join\r\nimport time\r\n\r\noutput_loc = Join(on='/', values=[\"s3:/\", bucket, prefix, s3_output_loc])\r\n\r\n# Where to store the trained model\r\nmodel_path = f\"s3://{bucket}/{prefix}/model/\"\r\n\r\nhyperparameters = {\"epochs\": training_epochs}\r\ntensorflow_version = \"2.4.1\"\r\npython_version = \"py37\"\r\n\r\ntf2_estimator = TensorFlow(\r\n    source_dir=\"code\",\r\n    entry_point=\"train.py\",\r\n    instance_type=\"ml.m5.xlarge\",\r\n    instance_count=1,\r\n    framework_version=tensorflow_version,\r\n    #model_dir=False,\r\n    role=role,\r\n    base_job_name=\"tf2-california-housing-train\",\r\n    output_path=output_loc,\r\n    hyperparameters=hyperparameters,\r\n    py_version=python_version,\r\n)\r\n\r\n# Use the tf2_estimator in a Sagemaker pipelines ProcessingStep.\r\n# NOTE how the input to the training job directly references the output of the previous step.\r\nstep_train_model = TrainingStep(\r\n    name=\"Train-California-Housing-Model\",\r\n    estimator=tf2_estimator,\r\n    inputs={\r\n        \"train\": TrainingInput(\r\n            s3_data=step_preprocess_data.properties.ProcessingOutputConfig.Outputs[\r\n                \"train\"\r\n            ].S3Output.S3Uri,\r\n            content_type=\"text/csv\",\r\n        ),\r\n        \"test\": TrainingInput(\r\n            s3_data=step_preprocess_data.properties.ProcessingOutputConfig.Outputs[\r\n                \"test\"\r\n            ].S3Output.S3Uri,\r\n            content_type=\"text/csv\",\r\n        ),\r\n    },\r\n)\r\n\r\nfrom sagemaker.workflow.pipeline import Pipeline\r\n\r\n# Create a Sagemaker Pipeline.\r\n# Each parameter for the pipeline must be set as a parameter explicitly when the pipeline is created.\r\n# Also pass in each of the steps created above.\r\n# Note that the order of execution is determined from each step's dependencies on other steps,\r\n# not on the order they are passed in below.\r\npipeline = Pipeline(\r\n    name=pipeline_name,\r\n    parameters=[\r\n        processing_instance_type,\r\n        training_instance_type,\r\n        input_data,\r\n        training_epochs,\r\n        accuracy_mse_threshold,\r\n        endpoint_instance_type,\r\n        s3_output_loc,\r\n    ],\r\n    steps=[step_train_model],\r\n)\r\nimport json\r\n\r\npipeline.definition()\r\n```\r\n\r\n```\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/workflow/pipeline.py in definition(self)\r\n    290     def definition(self) -> str:\r\n    291         \"\"\"Converts a request structure to string representation for workflow service calls.\"\"\"\r\n--> 292         request_dict = self.to_request()\r\n    293         self._interpolate_step_collection_name_in_depends_on(request_dict[\"Steps\"])\r\n    294         request_dict[\"PipelineExperimentConfig\"] = interpolate(\r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/workflow/pipeline.py in to_request(self)\r\n     89             if self.pipeline_experiment_config is not None\r\n     90             else None,\r\n---> 91             \"Steps\": list_to_request(self.steps),\r\n     92         }\r\n     93 \r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/workflow/utilities.py in list_to_request(entities)\r\n     40     for entity in entities:\r\n     41         if isinstance(entity, Entity):\r\n---> 42             request_dicts.append(entity.to_request())\r\n     43         elif isinstance(entity, StepCollection):\r\n     44             request_dicts.extend(entity.request_dicts())\r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/workflow/steps.py in to_request(self)\r\n    359     def to_request(self) -> RequestType:\r\n    360         \"\"\"Updates the request dictionary with cache configuration.\"\"\"\r\n--> 361         request_dict = super().to_request()\r\n    362         if self.cache_config:\r\n    363             request_dict.update(self.cache_config.config)\r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/workflow/steps.py in to_request(self)\r\n    221     def to_request(self) -> RequestType:\r\n    222         \"\"\"Gets the request structure for `ConfigurableRetryStep`.\"\"\"\r\n--> 223         step_dict = super().to_request()\r\n    224         if self.retry_policies:\r\n    225             step_dict[\"RetryPolicies\"] = self._resolve_retry_policy(self.retry_policies)\r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/workflow/steps.py in to_request(self)\r\n    104             \"Name\": self.name,\r\n    105             \"Type\": self.step_type.value,\r\n--> 106             \"Arguments\": self.arguments,\r\n    107         }\r\n    108         if self.depends_on:\r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/workflow/steps.py in arguments(self)\r\n    340             self.estimator._prepare_for_training(self.job_name)\r\n    341             train_args = _TrainingJob._get_train_args(\r\n--> 342                 self.estimator, self.inputs, experiment_config=dict()\r\n    343             )\r\n    344             request_dict = self.estimator.sagemaker_session._get_train_request(**train_args)\r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/estimator.py in _get_train_args(cls, estimator, inputs, experiment_config)\r\n   1841         config = _Job._load_config(inputs, estimator)\r\n   1842 \r\n-> 1843         current_hyperparameters = estimator.hyperparameters()\r\n   1844         if current_hyperparameters is not None:\r\n   1845             hyperparameters = {\r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/tensorflow/estimator.py in hyperparameters(self)\r\n    362         if self.model_dir is not False:\r\n    363             self.model_dir = self.model_dir or self._default_s3_path(\r\n--> 364                 \"model\", mpi=additional_hyperparameters.get(self.LAUNCH_MPI_ENV_NAME, False)\r\n    365             )\r\n    366             additional_hyperparameters[\"model_dir\"] = self.model_dir\r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/tensorflow/estimator.py in _default_s3_path(self, directory, mpi)\r\n    379             return \"/opt/ml/model\"\r\n    380         if self._current_job_name:\r\n--> 381             return s3.s3_path_join(self.output_path, self._current_job_name, directory)\r\n    382         return None\r\n    383 \r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/s3.py in s3_path_join(*args)\r\n     56         return str(pathlib.PurePosixPath(args[0], path)).replace(\"s3:/\", \"s3://\")\r\n     57 \r\n---> 58     return str(pathlib.PurePosixPath(*args)).lstrip(\"/\")\r\n     59 \r\n     60 \r\n\r\n/opt/conda/lib/python3.7/pathlib.py in __new__(cls, *args)\r\n    640         if cls is PurePath:\r\n    641             cls = PureWindowsPath if os.name == 'nt' else PurePosixPath\r\n--> 642         return cls._from_parts(args)\r\n    643 \r\n    644     def __reduce__(self):\r\n\r\n/opt/conda/lib/python3.7/pathlib.py in _from_parts(cls, args, init)\r\n    672         # right flavour.\r\n    673         self = object.__new__(cls)\r\n--> 674         drv, root, parts = self._parse_args(args)\r\n    675         self._drv = drv\r\n    676         self._root = root\r\n\r\n/opt/conda/lib/python3.7/pathlib.py in _parse_args(cls, args)\r\n    656                 parts += a._parts\r\n    657             else:\r\n--> 658                 a = os.fspath(a)\r\n    659                 if isinstance(a, str):\r\n    660                     # Force-cast str subclasses to str (issue #21127)\r\n\r\nTypeError: expected str, bytes or os.PathLike object, not Join\r\n```\r\n\r\n\r\n\r\nIf applicable, add screenshots or logs to help explain your problem.\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.92.1\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: TensorFlow\r\n- **Framework version**: 2.4.1\r\n- **Python version**: 3.7.10 (Studio Data Science image)\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\nIf model_dir is passed either a False or Join from my testing it will not throw the error.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3142/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3142/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3141", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3141/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3141/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3141/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3141", "id": 1250232727, "node_id": "I_kwDOBpf0x85KhQmX", "number": 3141, "title": "Exception: instance_type should not be a pipeline variable (<class 'sagemaker.workflow.parameters.ParameterString'>)", "user": {"login": "qidewenwhen", "id": 32910701, "node_id": "MDQ6VXNlcjMyOTEwNzAx", "avatar_url": "https://avatars.githubusercontent.com/u/32910701?v=4", "gravatar_id": "", "url": "https://api.github.com/users/qidewenwhen", "html_url": "https://github.com/qidewenwhen", "followers_url": "https://api.github.com/users/qidewenwhen/followers", "following_url": "https://api.github.com/users/qidewenwhen/following{/other_user}", "gists_url": "https://api.github.com/users/qidewenwhen/gists{/gist_id}", "starred_url": "https://api.github.com/users/qidewenwhen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/qidewenwhen/subscriptions", "organizations_url": "https://api.github.com/users/qidewenwhen/orgs", "repos_url": "https://api.github.com/users/qidewenwhen/repos", "events_url": "https://api.github.com/users/qidewenwhen/events{/privacy}", "received_events_url": "https://api.github.com/users/qidewenwhen/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-05-27T01:11:33Z", "updated_at": "2022-05-27T01:16:06Z", "closed_at": "2022-05-27T01:16:06Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "**Describe the bug**\r\nAfter the release https://github.com/aws/sagemaker-python-sdk/releases/tag/v2.92.0, pipelines which was working before started failing with this exception, which relates to [this commit](https://github.com/aws/sagemaker-python-sdk/commit/19b5560ab0811d3833d3132acc630fa9869ffacd)\r\n\r\n```\r\nException: instance_type should not be a pipeline variable (<class 'sagemaker.workflow.parameters.ParameterString'>)\r\n```\r\n\r\n**Note**\r\nThis is a breaking change which can break some existing customer codes, so open this issue, post the explanation and fix options here, in case any one searches for it.", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3141/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3141/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3131", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3131/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3131/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3131/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3131", "id": 1247050236, "node_id": "I_kwDOBpf0x85KVHn8", "number": 3131, "title": "documentation: the estimator.fit method does not have docstring", "user": {"login": "mchoi8739", "id": 21208346, "node_id": "MDQ6VXNlcjIxMjA4MzQ2", "avatar_url": "https://avatars.githubusercontent.com/u/21208346?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mchoi8739", "html_url": "https://github.com/mchoi8739", "followers_url": "https://api.github.com/users/mchoi8739/followers", "following_url": "https://api.github.com/users/mchoi8739/following{/other_user}", "gists_url": "https://api.github.com/users/mchoi8739/gists{/gist_id}", "starred_url": "https://api.github.com/users/mchoi8739/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mchoi8739/subscriptions", "organizations_url": "https://api.github.com/users/mchoi8739/orgs", "repos_url": "https://api.github.com/users/mchoi8739/repos", "events_url": "https://api.github.com/users/mchoi8739/events{/privacy}", "received_events_url": "https://api.github.com/users/mchoi8739/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 892238348, "node_id": "MDU6TGFiZWw4OTIyMzgzNDg=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/type:%20documentation", "name": "type: documentation", "color": "002b36", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-05-24T19:46:51Z", "updated_at": "2022-05-25T16:16:02Z", "closed_at": "2022-05-25T16:16:02Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**What did you find confusing? Please describe.**\r\n\r\nThe most used class method of Estimator for training, `Estimator.fit`, is not documented properly.\r\nhttps://sagemaker.readthedocs.io/en/stable/api/training/estimators.html#sagemaker.estimator.Estimator.fit\r\n\r\n**Describe how documentation can be improved**\r\n- Add docstring to the fit classmethod.\r\n- Add a complete list of kwd args for the fit method, such as `inputs` for training data channels, etc.\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3131/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3131/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3104", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3104/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3104/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3104/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3104", "id": 1234154181, "node_id": "I_kwDOBpf0x85Jj7LF", "number": 3104, "title": "Passing ParameterString for Estimator output_path fails in Pipeline definition ", "user": {"login": "lkev", "id": 3269734, "node_id": "MDQ6VXNlcjMyNjk3MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3269734?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lkev", "html_url": "https://github.com/lkev", "followers_url": "https://api.github.com/users/lkev/followers", "following_url": "https://api.github.com/users/lkev/following{/other_user}", "gists_url": "https://api.github.com/users/lkev/gists{/gist_id}", "starred_url": "https://api.github.com/users/lkev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lkev/subscriptions", "organizations_url": "https://api.github.com/users/lkev/orgs", "repos_url": "https://api.github.com/users/lkev/repos", "events_url": "https://api.github.com/users/lkev/events{/privacy}", "received_events_url": "https://api.github.com/users/lkev/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2022-05-12T15:26:53Z", "updated_at": "2022-06-01T15:27:44Z", "closed_at": "2022-05-27T20:56:25Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nPassing a `ParameterString` parameter in the `output` arg for `Estimator` throws an error when defining it as part of a pipeline.\r\n\r\nThis is because the estimator attempts to parse the `ParameterString` as an s3 URL and obviously fails.\r\n\r\n**To reproduce**\r\n```python\r\nfrom sagemaker.workflow.parameters import ParameterString\r\nfrom sagemaker.workflow.pipeline import Pipeline\r\nfrom sagemaker.workflow.steps import TrainingStep\r\nfrom sagemaker.estimator import Estimator\r\n\r\nparam_training_output_s3_uri = ParameterString(\r\n    name=\"training_output_s3_uri\"\r\n)\r\nest = Estimator(\r\n    role=\"test\",\r\n    image_uri=(\r\n        \"763104351884.dkr.ecr.us-east-1.amazonaws.com/tensorflow-\"\r\n        \"training:2.8.0-gpu-py39-cu112-ubuntu20.04-sagemaker\"\r\n    ),\r\n    instance_count=1,\r\n    instance_type=\"ml.g4dn.xlarge\",\r\n    entry_point=\"training.py\",\r\n    source_dir=\"pipeline/training\",\r\n    output_path=param_training_output_s3_uri,\r\n)\r\n\r\nest_step = TrainingStep(f\"fd_training_step\", estimator=est,)\r\n\r\npipe = Pipeline(name=\"TestPipe\", steps=[est_step],)\r\nprint(pipe.definition())\r\n```\r\n\r\n**Expected behavior**\r\nThe pipeline definition printed out\r\n\r\n**Screenshots or logs**\r\n\r\nThe `ParameterString` gets passed to `parse_s3_url(self.output_path)` in the `Estimator` (line 699). However, it can't parse as it as an s3 url as it is a `ParameterString` object.\r\n\r\nSee error log below of above code below:\r\n```python\r\nTraceback (most recent call last):\r\n  File \"full_pipeline.py\", line 348, in <module>\r\n    main()\r\n  File \"full_pipeline.py\", line 344, in main\r\n    print(pipe.definition())\r\n  File \"/opt/miniconda3/envs/newenv/lib/python3.9/site-packages/sagemaker/workflow/pipeline.py\", line 301, in definition\r\n    request_dict = self.to_request()\r\n  File \"/opt/miniconda3/envs/newenv/lib/python3.9/site-packages/sagemaker/workflow/pipeline.py\", line 91, in to_request\r\n    \"Steps\": list_to_request(self.steps),\r\n  File \"/opt/miniconda3/envs/newenv/lib/python3.9/site-packages/sagemaker/workflow/utilities.py\", line 37, in list_to_request\r\n    request_dicts.append(entity.to_request())\r\n  File \"/opt/miniconda3/envs/newenv/lib/python3.9/site-packages/sagemaker/workflow/steps.py\", line 314, in to_request\r\n    request_dict = super().to_request()\r\n  File \"/opt/miniconda3/envs/newenv/lib/python3.9/site-packages/sagemaker/workflow/steps.py\", line 214, in to_request\r\n    step_dict = super().to_request()\r\n  File \"/opt/miniconda3/envs/newenv/lib/python3.9/site-packages/sagemaker/workflow/steps.py\", line 103, in to_request\r\n    \"Arguments\": self.arguments,\r\n  File \"/opt/miniconda3/envs/newenv/lib/python3.9/site-packages/sagemaker/workflow/steps.py\", line 298, in arguments\r\n    self.estimator._prepare_for_training()\r\n  File \"/opt/miniconda3/envs/newenv/lib/python3.9/site-packages/sagemaker/estimator.py\", line 659, in _prepare_for_training\r\n    self.uploaded_code = self._stage_user_code_in_s3()\r\n  File \"/opt/miniconda3/envs/newenv/lib/python3.9/site-packages/sagemaker/estimator.py\", line 699, in _stage_user_code_in_s3\r\n    code_bucket, _ = parse_s3_url(self.output_path)\r\n  File \"/opt/miniconda3/envs/newenv/lib/python3.9/site-packages/sagemaker/s3.py\", line 39, in parse_s3_url\r\n    raise ValueError(\"Expecting 's3' scheme, got: {} in {}.\".format(parsed_url.scheme, url))\r\nValueError: Expecting 's3' scheme, got:  in .\r\n```\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.72.3\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: N/A\r\n- **Framework version**: N/A\r\n- **Python version**: 3.9\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\nPotentially related to https://github.com/aws/sagemaker-python-sdk/issues/3091 or https://github.com/aws/sagemaker-python-sdk/issues/3078.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3104/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3104/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3103", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3103/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3103/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3103/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3103", "id": 1234098530, "node_id": "I_kwDOBpf0x85Jjtli", "number": 3103, "title": "Image URI in CreateModelStep can not be a Sagemaker Properties object.", "user": {"login": "BasHuijben", "id": 53039033, "node_id": "MDQ6VXNlcjUzMDM5MDMz", "avatar_url": "https://avatars.githubusercontent.com/u/53039033?v=4", "gravatar_id": "", "url": "https://api.github.com/users/BasHuijben", "html_url": "https://github.com/BasHuijben", "followers_url": "https://api.github.com/users/BasHuijben/followers", "following_url": "https://api.github.com/users/BasHuijben/following{/other_user}", "gists_url": "https://api.github.com/users/BasHuijben/gists{/gist_id}", "starred_url": "https://api.github.com/users/BasHuijben/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/BasHuijben/subscriptions", "organizations_url": "https://api.github.com/users/BasHuijben/orgs", "repos_url": "https://api.github.com/users/BasHuijben/repos", "events_url": "https://api.github.com/users/BasHuijben/events{/privacy}", "received_events_url": "https://api.github.com/users/BasHuijben/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-05-12T14:46:35Z", "updated_at": "2022-05-19T21:58:21Z", "closed_at": "2022-05-19T21:58:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nWhen deploying a model, we create a pipeline consisting of three steps: \r\n1.\tGet latest model version (LambdaStep). Depending on the environment we are in, we select different models from the model registry. For instance in dev we select the latest registered model, but in prod we select the latest approved model. \r\n2.\tCreate model (CreteModelStep). \r\n3.\tDeploy model (LambdaStep).\r\n\r\nWe create a new model with the following code (step 2):\r\n```\r\nmodel = Model(name=model_package_name,\r\n              image_uri=step_latest_model_version.properties.Outputs[\"model_image\"],\r\n              model_data=step_latest_model_version.properties.Outputs[\"model_artifact\"],\r\n              sagemaker_session=sagemaker_session,\r\n              role=CONFIG['role'])\r\nstep_create_model = CreateModelStep(name='Create-model',\r\n                                    model=model,\r\n                                    inputs=None,\r\n                                    display_name=model_package_name,\r\n                                    depends_on=[step_latest_model_version])\r\n```\r\n\r\nThis was working fine in version 2.72.2 but in versions 2.82.2 and 2.89.0 (did not test more versions) it is giving the following error when we upsert the pipeline:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \".../sagemaker_bug.py\", line 45, in <module>\r\n    response = pipeline.upsert(role_arn=...,\r\n  File \"...\\lib\\site-packages\\sagemaker\\workflow\\pipeline.py\", line 219, in upsert\r\n    response = self.create(role_arn, description, tags, parallelism_config)\r\n  File \"...\\lib\\site-packages\\sagemaker\\workflow\\pipeline.py\", line 116, in create\r\n    kwargs = self._create_args(role_arn, description, parallelism_config)\r\n  File \"...\\lib\\site-packages\\sagemaker\\workflow\\pipeline.py\", line 138, in _create_args\r\n    pipeline_definition = self.definition()\r\n  File \"...\\lib\\site-packages\\sagemaker\\workflow\\pipeline.py\", line 301, in definition\r\n    request_dict = self.to_request()\r\n  File \"...\\lib\\site-packages\\sagemaker\\workflow\\pipeline.py\", line 91, in to_request\r\n    \"Steps\": list_to_request(self.steps),\r\n  File \"...\\lib\\site-packages\\sagemaker\\workflow\\utilities.py\", line 42, in list_to_request\r\n    request_dicts.append(entity.to_request())\r\n  File \"...\\lib\\site-packages\\sagemaker\\workflow\\steps.py\", line 213, in to_request\r\n    step_dict = super().to_request()\r\n  File \"...\\lib\\site-packages\\sagemaker\\workflow\\steps.py\", line 102, in to_request\r\n    \"Arguments\": self.arguments,\r\n  File \"...\\lib\\site-packages\\sagemaker\\workflow\\steps.py\", line 435, in arguments\r\n    container_defs=self.model.prepare_container_def(\r\n  File \"...\\lib\\site-packages\\sagemaker\\model.py\", line 414, in prepare_container_def\r\n    deploy_key_prefix = fw_utils.model_code_key_prefix(\r\n  File \"...\\lib\\site-packages\\sagemaker\\fw_utils.py\", line 398, in model_code_key_prefix\r\n    training_job_name = sagemaker.utils.name_from_image(image)\r\n  File \"...\\lib\\site-packages\\sagemaker\\utils.py\", line 60, in name_from_image\r\n    return name_from_base(base_name_from_image(image), max_length=max_length)\r\n  File \"...\\lib\\site-packages\\sagemaker\\utils.py\", line 102, in base_name_from_image\r\n    m = re.match(\"^(.+/)?([^:/]+)(:[^:]+)?$\", image)\r\n  File \"...\\lib\\re.py\", line 191, in match\r\n    return _compile(pattern, flags).match(string)\r\nTypeError: expected string or bytes-like object\r\n```\r\n\r\nThe reason for this is that image is equal to a Sagemaker Properties object and not a string. This makes sense because we set `image_uri` to `step_latest_model_version.properties.Outputs[\"model_image\"]`.\r\n\r\nPersonally I think you should be able to provide a Properties object as `image_uri` when you would like to deploy a model from the model registry inside a Sagemaker pipeline, like in version 2.72.2.  \r\n\r\n**To reproduce**\r\nI reproduced the error with the following code:\r\n\r\n``` \r\nimport boto3\r\n\r\nimport sagemaker\r\nfrom sagemaker.lambda_helper import Lambda\r\nfrom sagemaker.workflow.steps import CreateModelStep\r\nfrom sagemaker.workflow.lambda_step import LambdaStep, LambdaOutput, LambdaOutputTypeEnum\r\nfrom sagemaker import Model\r\nfrom sagemaker.workflow.pipeline import Pipeline\r\n\r\n\r\nregion = sagemaker.Session().boto_region_name\r\nsm_client = boto3.client(\"sagemaker\")\r\nboto_session = boto3.Session(region_name=region)\r\nsagemaker_session = sagemaker.session.Session(boto_session=boto_session,\r\n                                              sagemaker_client=sm_client)\r\n\r\nlambda_func = Lambda(function_name='latest-model-package',\r\n                     execution_role_arn=your_own_execution_role,\r\n                     script='latest_model_package.py',\r\n                     handler=\"latest_model_package.get_latest_model_package_lambda\")\r\n\r\n\r\nlambda_outputs = [LambdaOutput(output_name=\"image_uri\", output_type=LambdaOutputTypeEnum.String),\r\n                  LambdaOutput(output_name=\"model_artifact\", output_type=LambdaOutputTypeEnum.String)]\r\nstep_latest_model_version = LambdaStep(name=\"Get-latest-model\",\r\n                                       lambda_func=lambda_func,\r\n                                       inputs={},\r\n                                       outputs=lambda_outputs)\r\n\r\nmodel = Model(name='test',\r\n              image_uri=step_latest_model_version.properties.Outputs[\"image_uri\"],\r\n              model_data=step_latest_model_version.properties.Outputs[\"model_artifact\"],\r\n              sagemaker_session=sagemaker_session,\r\n              role=your_own_role')\r\nstep_create_model = CreateModelStep(name='Create-model',\r\n                                    model=model,\r\n                                    inputs=None,\r\n                                    display_name='test',\r\n                                    depends_on=[step_latest_model_version])\r\n\r\npipeline = Pipeline(name='test-pipeline',\r\n                    steps=[step_latest_model_version, step_create_model])\r\n\r\n# submit pipeline\r\nresponse = pipeline.upsert(role_arn=your_own_role,\r\n                           description='test pipeline')\r\n```\r\n\r\n\r\n``` \r\nlatest_model_package.py\r\ndef get_latest_model_package_lambda(event, context):\r\n    return {'image_uri': 'image_uri_of_model_package',\r\n            'model_artifact': 'model_artifact_of_model_package'}\r\n```\r\n\r\n\r\n**Expected behavior**\r\nThe pipeline should work with a Sagemaker Property object as input for the `image_uri` parameter of the `CreateModelStep` class, like in version 2.72.2\r\n\r\n**Screenshots or logs**\r\nsee error message above. \r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.82.2 and 2.89.0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: -\r\n- **Framework version**: -\r\n- **Python version**: 3.8\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\n-", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3103/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3103/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3092", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3092/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3092/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3092/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3092", "id": 1223843853, "node_id": "I_kwDOBpf0x85I8mAN", "number": 3092, "title": "no metrics showing in the sagemaker pipeline UI as well as in the Experiments and trails UI", "user": {"login": "hannahHe20", "id": 74689853, "node_id": "MDQ6VXNlcjc0Njg5ODUz", "avatar_url": "https://avatars.githubusercontent.com/u/74689853?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hannahHe20", "html_url": "https://github.com/hannahHe20", "followers_url": "https://api.github.com/users/hannahHe20/followers", "following_url": "https://api.github.com/users/hannahHe20/following{/other_user}", "gists_url": "https://api.github.com/users/hannahHe20/gists{/gist_id}", "starred_url": "https://api.github.com/users/hannahHe20/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hannahHe20/subscriptions", "organizations_url": "https://api.github.com/users/hannahHe20/orgs", "repos_url": "https://api.github.com/users/hannahHe20/repos", "events_url": "https://api.github.com/users/hannahHe20/events{/privacy}", "received_events_url": "https://api.github.com/users/hannahHe20/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790726627, "node_id": "MDU6TGFiZWwyNzkwNzI2NjI3", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20training", "name": "component: training", "color": "5319e7", "default": false, "description": "Relates to the SageMaker Training Platform"}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": {"login": "aoguo64", "id": 72373287, "node_id": "MDQ6VXNlcjcyMzczMjg3", "avatar_url": "https://avatars.githubusercontent.com/u/72373287?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aoguo64", "html_url": "https://github.com/aoguo64", "followers_url": "https://api.github.com/users/aoguo64/followers", "following_url": "https://api.github.com/users/aoguo64/following{/other_user}", "gists_url": "https://api.github.com/users/aoguo64/gists{/gist_id}", "starred_url": "https://api.github.com/users/aoguo64/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aoguo64/subscriptions", "organizations_url": "https://api.github.com/users/aoguo64/orgs", "repos_url": "https://api.github.com/users/aoguo64/repos", "events_url": "https://api.github.com/users/aoguo64/events{/privacy}", "received_events_url": "https://api.github.com/users/aoguo64/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "aoguo64", "id": 72373287, "node_id": "MDQ6VXNlcjcyMzczMjg3", "avatar_url": "https://avatars.githubusercontent.com/u/72373287?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aoguo64", "html_url": "https://github.com/aoguo64", "followers_url": "https://api.github.com/users/aoguo64/followers", "following_url": "https://api.github.com/users/aoguo64/following{/other_user}", "gists_url": "https://api.github.com/users/aoguo64/gists{/gist_id}", "starred_url": "https://api.github.com/users/aoguo64/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aoguo64/subscriptions", "organizations_url": "https://api.github.com/users/aoguo64/orgs", "repos_url": "https://api.github.com/users/aoguo64/repos", "events_url": "https://api.github.com/users/aoguo64/events{/privacy}", "received_events_url": "https://api.github.com/users/aoguo64/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2022-05-03T08:59:45Z", "updated_at": "2022-11-30T12:53:49Z", "closed_at": "2022-05-05T18:31:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nI'm looking into the sagemaker experiment tracking functionality to run my project based on my own docker image. But I cannot see the metrics in the sagemaker pipeline UI and Experiments & trails UI. \r\n\r\n**To reproduce**\r\nI used the sagemaker studio and the default \"MLOps template for model building, training and deployment\" template to initiate my project. And then modified the code in the pipeline.py under abalone(the code has been attached).\r\nThe pipeline has run successfully but I'm not able to see the metrics on both sagemaker pipeline UI and experiment trails UI. \r\n\r\n**Expected behavior**\r\nit supposed to show the \"Top 10 Combinations Based on Score\" and also it's value which captured by regrex as I defined in the estimator. \r\n\r\n**Screenshots or logs**\r\nlogs in cloudwatch  training group and I'm using regex to get this sentence to get the value: \"top 10 combinations based on score: [0, 1, 2, 5, 6, 9, 19, 30, 57, 58, 3497.034612758378]\" and based on my regex, it can locate to the sentence and get the values as shown:\r\n\r\n<img width=\"1671\" alt=\"logs in cloudwatch training group\" src=\"https://user-images.githubusercontent.com/74689853/166620186-56a6fb92-aaed-4fb1-b0ee-db9ff40da27c.png\">\r\n<img width=\"860\" alt=\"Screenshot 2022-05-03 at 8 52 27 PM\" src=\"https://user-images.githubusercontent.com/74689853/166620947-d76052b7-767e-40ba-9ff0-b065c0a2fe25.png\">\r\n\r\n\r\n\r\n<img width=\"1337\" alt=\"no metrics in pipeline ui\" src=\"https://user-images.githubusercontent.com/74689853/166427415-c16b596c-8937-4841-aa6e-fc763be1dc62.png\">\r\n\r\n<img width=\"812\" alt=\"no metrics in experiment ui\" src=\"https://user-images.githubusercontent.com/74689853/166427431-a6557ba3-d798-4ecb-93d4-0df200cafaf3.png\">\r\n\r\n<img width=\"845\" alt=\"my customized estimator\" src=\"https://user-images.githubusercontent.com/74689853/166427450-727fbc24-9e37-4f6c-80cb-4d73bd29dfc7.png\">\r\n\r\n<img width=\"930\" alt=\"code for customized estimator\" src=\"https://user-images.githubusercontent.com/74689853/166427464-d513b4f6-8e4b-4f87-bb01-db1208688ba0.png\">\r\n\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: Downloading sagemaker-2.88.2.tar.gz (529 kB) \r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: no\r\n- **Framework version**: no \r\n- **Python version**: python 3.6\r\n- **CPU or GPU**: both\r\n- **Custom Docker image (Y/N)**:  Y\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3092/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3092/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3091", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3091/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3091/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3091/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3091", "id": 1223722151, "node_id": "I_kwDOBpf0x85I8ISn", "number": 3091, "title": "Create Model Step fails when when we pass the URL as a Pipeline Parameter for model_data", "user": {"login": "rohangpatil", "id": 1222850, "node_id": "MDQ6VXNlcjEyMjI4NTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1222850?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rohangpatil", "html_url": "https://github.com/rohangpatil", "followers_url": "https://api.github.com/users/rohangpatil/followers", "following_url": "https://api.github.com/users/rohangpatil/following{/other_user}", "gists_url": "https://api.github.com/users/rohangpatil/gists{/gist_id}", "starred_url": "https://api.github.com/users/rohangpatil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rohangpatil/subscriptions", "organizations_url": "https://api.github.com/users/rohangpatil/orgs", "repos_url": "https://api.github.com/users/rohangpatil/repos", "events_url": "https://api.github.com/users/rohangpatil/events{/privacy}", "received_events_url": "https://api.github.com/users/rohangpatil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2022-05-03T06:01:10Z", "updated_at": "2022-06-06T16:39:09Z", "closed_at": "2022-06-06T16:39:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nA clear and concise description of what the bug is.\r\n\r\n**To reproduce**\r\nThe below code works\r\n```python\r\nmodel = XGBoostModel(\r\n      model_data=\"s3://<...>/model.tar.gz\",\r\n      role=role,\r\n      sagemaker_session=sagemaker_session,\r\n      entry_point=\"inference_entrypoint.py\",\r\n      framework_version=\"1.5-1\",\r\n    )\r\n```\r\nThis doesnt work.\r\n```python\r\nmodel_url = ParameterString(name=\"ModelURL\")\r\nmodel = XGBoostModel(\r\n      model_data=model_url,\r\n      role=role,\r\n      sagemaker_session=sagemaker_session,\r\n      entry_point=\"inference_entrypoint.py\",\r\n      framework_version=\"1.5-1\",\r\n    )\r\n```\r\n\r\n**Expected behavior**\r\nA clear and concise description of what you expected to happen.\r\n\r\n**Screenshots or logs**\r\nThis is not what is expected.\r\n<img width=\"1438\" alt=\"Screen Shot 2022-05-03 at 11 28 49 AM\" src=\"https://user-images.githubusercontent.com/1222850/166410377-db53e87b-ccb6-4fe4-892a-d3e90ea27734.png\">\r\nThis is expected \r\n<img width=\"1438\" alt=\"Screen Shot 2022-05-03 at 11 30 04 AM\" src=\"https://user-images.githubusercontent.com/1222850/166410409-2a1fef5d-9490-44b5-95f9-9e31d5143bec.png\">\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n\r\nSageMaker Python SDK version: 2.87.0\r\nFramework name (eg. PyTorch) or algorithm (eg. KMeans): XGBoost\r\nFramework version: 1.5-1\r\nPython version: 3.7.10\r\nCPU or GPU: CPU\r\nCustom Docker image (Y/N): N\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3091/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3091/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3078", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3078/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3078/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3078/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3078", "id": 1213011286, "node_id": "I_kwDOBpf0x85ITRVW", "number": 3078, "title": "Passing Pipeline Variable for entry_point while using XGBoost Estimator in script mode fails", "user": {"login": "rohangpatil", "id": 1222850, "node_id": "MDQ6VXNlcjEyMjI4NTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1222850?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rohangpatil", "html_url": "https://github.com/rohangpatil", "followers_url": "https://api.github.com/users/rohangpatil/followers", "following_url": "https://api.github.com/users/rohangpatil/following{/other_user}", "gists_url": "https://api.github.com/users/rohangpatil/gists{/gist_id}", "starred_url": "https://api.github.com/users/rohangpatil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rohangpatil/subscriptions", "organizations_url": "https://api.github.com/users/rohangpatil/orgs", "repos_url": "https://api.github.com/users/rohangpatil/repos", "events_url": "https://api.github.com/users/rohangpatil/events{/privacy}", "received_events_url": "https://api.github.com/users/rohangpatil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 12, "created_at": "2022-04-23T00:48:09Z", "updated_at": "2022-05-30T22:32:02Z", "closed_at": "2022-05-30T16:30:37Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nPassing Pipeline Variable (e.g. S3 URL) for entry_point while using XGBoost Estimator in script mode fails to generate a pipeline definition. As the  estimator tries to parse the variable and fails at url parsing.\r\n\r\n**To reproduce**\r\n\r\n```python\r\nmodel_output_path = ParameterString(name=\"ModelOutputPath\")\r\n\r\nxgb_script_mode_estimator = XGBoost(\r\n        entry_point=script_path,\r\n        framework_version=\"1.5-1\",  # Note: framework_version is mandatory\r\n        role=role,\r\n        instance_count=training_instance_count,\r\n        instance_type=training_instance_type,\r\n        output_path=model_output_path,\r\n        hyperparameters={\r\n            \"eval_metric\": eval_metric,\r\n            \"min_child_weight\": min_child_weight\r\n        },\r\n        checkpoint_s3_uri=checkpoint_path\r\n    )\r\n\r\n    train_input = TrainingInput(\r\n        s3_processed_training_samples_url, content_type=content_type\r\n    )\r\n    validation_input = TrainingInput(\r\n        s3_processed_testing_samples_url, content_type=content_type\r\n    )\r\n\r\n    step_train = TrainingStep(\r\n        name=\"TrainModel\",\r\n        estimator=xgb_script_mode_estimator,\r\n        inputs={\"train\": train_input, \"validation\": validation_input},\r\n    )\r\npipeline = get_pipeline(\r\n    region=region,\r\n    role=role,\r\n    default_bucket=default_bucket,\r\n    model_package_group_name=model_package_group_name,\r\n    pipeline_name=pipeline_name\r\n)\r\n\r\nimport json\r\njson.loads(pipeline.definition())\r\n```\r\n\r\ngenerates the error\r\n\r\n```\r\n---------------------------------------------------------------------------\r\nTypeError                                 Traceback (most recent call last)\r\n<ipython-input-4-7d78ecac635c> in <module>\r\n      1 import json\r\n----> 2 json.loads(pipeline.definition())\r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/workflow/pipeline.py in definition(self)\r\n    299     def definition(self) -> str:\r\n    300         \"\"\"Converts a request structure to string representation for workflow service calls.\"\"\"\r\n--> 301         request_dict = self.to_request()\r\n    302         request_dict[\"PipelineExperimentConfig\"] = interpolate(\r\n    303             request_dict[\"PipelineExperimentConfig\"], {}, {}\r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/workflow/pipeline.py in to_request(self)\r\n     89             if self.pipeline_experiment_config is not None\r\n     90             else None,\r\n---> 91             \"Steps\": list_to_request(self.steps),\r\n     92         }\r\n     93 \r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/workflow/utilities.py in list_to_request(entities)\r\n     40     for entity in entities:\r\n     41         if isinstance(entity, Entity):\r\n---> 42             request_dicts.append(entity.to_request())\r\n     43         elif isinstance(entity, StepCollection):\r\n     44             request_dicts.extend(entity.request_dicts())\r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/workflow/steps.py in to_request(self)\r\n    324     def to_request(self) -> RequestType:\r\n    325         \"\"\"Updates the request dictionary with cache configuration.\"\"\"\r\n--> 326         request_dict = super().to_request()\r\n    327         if self.cache_config:\r\n    328             request_dict.update(self.cache_config.config)\r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/workflow/steps.py in to_request(self)\r\n    212     def to_request(self) -> RequestType:\r\n    213         \"\"\"Gets the request structure for `ConfigurableRetryStep`.\"\"\"\r\n--> 214         step_dict = super().to_request()\r\n    215         if self.retry_policies:\r\n    216             step_dict[\"RetryPolicies\"] = self._resolve_retry_policy(self.retry_policies)\r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/workflow/steps.py in to_request(self)\r\n    101             \"Name\": self.name,\r\n    102             \"Type\": self.step_type.value,\r\n--> 103             \"Arguments\": self.arguments,\r\n    104         }\r\n    105         if self.depends_on:\r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/workflow/steps.py in arguments(self)\r\n    306         \"\"\"\r\n    307 \r\n--> 308         self.estimator._prepare_for_training(self.job_name)\r\n    309         train_args = _TrainingJob._get_train_args(\r\n    310             self.estimator, self.inputs, experiment_config=dict()\r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/estimator.py in _prepare_for_training(self, job_name)\r\n   2660                 constructor if applicable.\r\n   2661         \"\"\"\r\n-> 2662         super(Framework, self)._prepare_for_training(job_name=job_name)\r\n   2663 \r\n   2664         self._validate_and_set_debugger_configs()\r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/estimator.py in _prepare_for_training(self, job_name)\r\n    659                 self.code_uri = self.uploaded_code.s3_prefix\r\n    660             else:\r\n--> 661                 self.uploaded_code = self._stage_user_code_in_s3()\r\n    662                 code_dir = self.uploaded_code.s3_prefix\r\n    663                 script = self.uploaded_code.script_name\r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/estimator.py in _stage_user_code_in_s3(self)\r\n    699             kms_key = None\r\n    700         elif self.code_location is None:\r\n--> 701             code_bucket, _ = parse_s3_url(self.output_path)\r\n    702             code_s3_prefix = \"{}/{}\".format(self._current_job_name, \"source\")\r\n    703             kms_key = self.output_kms_key\r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/s3.py in parse_s3_url(url)\r\n     37     parsed_url = urlparse(url)\r\n     38     if parsed_url.scheme != \"s3\":\r\n---> 39         raise ValueError(\"Expecting 's3' scheme, got: {} in {}.\".format(parsed_url.scheme, url))\r\n     40     return parsed_url.netloc, parsed_url.path.lstrip(\"/\")\r\n     41 \r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/workflow/entities.py in __str__(self)\r\n     79     def __str__(self):\r\n     80         \"\"\"Override built-in String function for PipelineVariable\"\"\"\r\n---> 81         raise TypeError(\"Pipeline variables do not support __str__ operation.\")\r\n     82 \r\n     83     def __int__(self):\r\n\r\nTypeError: Pipeline variables do not support __str__ operation.\r\n```\r\n\r\n\r\n\r\n**Expected behavior**\r\nThe pipeline definition has to be generated. \r\n\r\n**Screenshots or logs**\r\nN/A\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.87.0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: XGBoost\r\n- **Framework version**: 1.5-1\r\n- **Python version**: 3.7.10\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3078/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3078/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3038", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3038/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3038/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3038/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3038", "id": 1187946811, "node_id": "I_kwDOBpf0x85GzqE7", "number": 3038, "title": "Pipleline creation failed when s3 source_dir path given for Model Object", "user": {"login": "Parth6846", "id": 30802753, "node_id": "MDQ6VXNlcjMwODAyNzUz", "avatar_url": "https://avatars.githubusercontent.com/u/30802753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Parth6846", "html_url": "https://github.com/Parth6846", "followers_url": "https://api.github.com/users/Parth6846/followers", "following_url": "https://api.github.com/users/Parth6846/following{/other_user}", "gists_url": "https://api.github.com/users/Parth6846/gists{/gist_id}", "starred_url": "https://api.github.com/users/Parth6846/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Parth6846/subscriptions", "organizations_url": "https://api.github.com/users/Parth6846/orgs", "repos_url": "https://api.github.com/users/Parth6846/repos", "events_url": "https://api.github.com/users/Parth6846/events{/privacy}", "received_events_url": "https://api.github.com/users/Parth6846/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": {"login": "staubhp", "id": 2755397, "node_id": "MDQ6VXNlcjI3NTUzOTc=", "avatar_url": "https://avatars.githubusercontent.com/u/2755397?v=4", "gravatar_id": "", "url": "https://api.github.com/users/staubhp", "html_url": "https://github.com/staubhp", "followers_url": "https://api.github.com/users/staubhp/followers", "following_url": "https://api.github.com/users/staubhp/following{/other_user}", "gists_url": "https://api.github.com/users/staubhp/gists{/gist_id}", "starred_url": "https://api.github.com/users/staubhp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/staubhp/subscriptions", "organizations_url": "https://api.github.com/users/staubhp/orgs", "repos_url": "https://api.github.com/users/staubhp/repos", "events_url": "https://api.github.com/users/staubhp/events{/privacy}", "received_events_url": "https://api.github.com/users/staubhp/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "staubhp", "id": 2755397, "node_id": "MDQ6VXNlcjI3NTUzOTc=", "avatar_url": "https://avatars.githubusercontent.com/u/2755397?v=4", "gravatar_id": "", "url": "https://api.github.com/users/staubhp", "html_url": "https://github.com/staubhp", "followers_url": "https://api.github.com/users/staubhp/followers", "following_url": "https://api.github.com/users/staubhp/following{/other_user}", "gists_url": "https://api.github.com/users/staubhp/gists{/gist_id}", "starred_url": "https://api.github.com/users/staubhp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/staubhp/subscriptions", "organizations_url": "https://api.github.com/users/staubhp/orgs", "repos_url": "https://api.github.com/users/staubhp/repos", "events_url": "https://api.github.com/users/staubhp/events{/privacy}", "received_events_url": "https://api.github.com/users/staubhp/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2022-03-31T11:37:45Z", "updated_at": "2022-04-01T17:36:20Z", "closed_at": "2022-04-01T17:36:20Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nI am trying to create pipeline with only Register model step. In my model object I am providing s3 path for source_dir. At the time of pipeline creation it failed with IsADirectoryError\r\n\r\n**To reproduce**\r\n```\r\nimport boto3\r\nfrom sagemaker.amazon.amazon_estimator import get_image_uri\r\nsagemaker_role = sagemaker.get_execution_role()\r\n\r\nsagemaker_session = sagemaker.session.Session(default_bucket='bucket_name')\r\ncontainer_sk = get_image_uri(boto3.Session().region_name, \"sklearn\", \"0.23-1\")\r\n\r\nmodel_path = 's3://bucket_name/prefix/model.tar.gz'\r\nsource_dir_path = 's3://bucket_name/prefix/sourcedir.tar.gz'\r\n\r\nfrom sagemaker.model import Model\r\ntest_model = Model(\r\nimage_uri  = container_sk,\r\n    model_data=model_path,\r\n    role=sagemaker_role,\r\n    entry_point='inference.py',\r\n    source_dir=source_dir_path,\r\n    sagemaker_session=sagemaker_session,\r\n    container_log_level=\"20\"\r\n)\r\n\r\n\r\nfrom sagemaker.model_metrics import MetricsSource, ModelMetrics\r\nfrom sagemaker.workflow.step_collections import RegisterModel\r\n\r\n\r\nstep_register = RegisterModel(\r\n    name='RegisterModel',\r\n    model = test_model,\r\n    content_types=['text/csv'],\r\n    response_types=['application/json'],\r\n    inference_instances=['ml.m5.xlarge'],\r\n    transform_instances=['ml.m5.xlarge'],\r\n    model_package_group_name=model_package_group_name,\r\n    approval_status=model_approval_status\r\n)\r\n\r\nfrom sagemaker.workflow.pipeline import Pipeline\r\n\r\npipeline = Pipeline(\r\n    name=\"pipeline_name\",\r\n    parameters=[],\r\n    steps=[       \r\n        step_register\r\n    ]\r\n)\r\n\r\n\r\ntry:\r\n    response = pipeline.create(role_arn=sagemaker_role)\r\nexcept ClientError as e:\r\n    error = e.response[\"Error\"]\r\n```\r\n\r\n**Expected behavior**\r\nSuccessful Pipeline creation with s3 path input for source_dir.\r\n\r\n**Screenshots or logs**\r\n```\r\n---------------------------------------------------------------------------\r\nIsADirectoryError                         Traceback (most recent call last)\r\n<ipython-input-11-63a4c0b7d2af> in <module>\r\n      2 \r\n      3 try:\r\n----> 4     response = pipeline.create(role_arn=sagemaker_role)\r\n      5 except ClientError as e:\r\n      6     error = e.response[\"Error\"]\r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/workflow/pipeline.py in create(self, role_arn, description, tags, parallelism_config)\r\n    114         \"\"\"\r\n    115         tags = _append_project_tags(tags)\r\n--> 116         kwargs = self._create_args(role_arn, description, parallelism_config)\r\n    117         update_args(\r\n    118             kwargs,\r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/workflow/pipeline.py in _create_args(self, role_arn, description, parallelism_config)\r\n    136             A keyword argument dict for calling create_pipeline.\r\n    137         \"\"\"\r\n--> 138         pipeline_definition = self.definition()\r\n    139         kwargs = dict(\r\n    140             PipelineName=self.name,\r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/workflow/pipeline.py in definition(self)\r\n    299     def definition(self) -> str:\r\n    300         \"\"\"Converts a request structure to string representation for workflow service calls.\"\"\"\r\n--> 301         request_dict = self.to_request()\r\n    302         request_dict[\"PipelineExperimentConfig\"] = interpolate(\r\n    303             request_dict[\"PipelineExperimentConfig\"], {}, {}\r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/workflow/pipeline.py in to_request(self)\r\n     89             if self.pipeline_experiment_config is not None\r\n     90             else None,\r\n---> 91             \"Steps\": list_to_request(self.steps),\r\n     92         }\r\n     93 \r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/workflow/utilities.py in list_to_request(entities)\r\n     37             request_dicts.append(entity.to_request())\r\n     38         elif isinstance(entity, StepCollection):\r\n---> 39             request_dicts.extend(entity.request_dicts())\r\n     40     return request_dicts\r\n     41 \r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/workflow/step_collections.py in request_dicts(self)\r\n     48     def request_dicts(self) -> List[RequestType]:\r\n     49         \"\"\"Get the request structure for workflow service calls.\"\"\"\r\n---> 50         return [step.to_request() for step in self.steps]\r\n     51 \r\n     52 \r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/workflow/step_collections.py in <listcomp>(.0)\r\n     48     def request_dicts(self) -> List[RequestType]:\r\n     49         \"\"\"Get the request structure for workflow service calls.\"\"\"\r\n---> 50         return [step.to_request() for step in self.steps]\r\n     51 \r\n     52 \r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/workflow/steps.py in to_request(self)\r\n    314     def to_request(self) -> RequestType:\r\n    315         \"\"\"Updates the request dictionary with cache configuration.\"\"\"\r\n--> 316         request_dict = super().to_request()\r\n    317         if self.cache_config:\r\n    318             request_dict.update(self.cache_config.config)\r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/workflow/steps.py in to_request(self)\r\n    212     def to_request(self) -> RequestType:\r\n    213         \"\"\"Gets the request structure for `ConfigurableRetryStep`.\"\"\"\r\n--> 214         step_dict = super().to_request()\r\n    215         if self.retry_policies:\r\n    216             step_dict[\"RetryPolicies\"] = self._resolve_retry_policy(self.retry_policies)\r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/workflow/steps.py in to_request(self)\r\n    101             \"Name\": self.name,\r\n    102             \"Type\": self.step_type.value,\r\n--> 103             \"Arguments\": self.arguments,\r\n    104         }\r\n    105         if self.depends_on:\r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/workflow/_utils.py in arguments(self)\r\n    255         repacking script and then gets the arguments for the training job.\r\n    256         \"\"\"\r\n--> 257         self._prepare_for_repacking()\r\n    258         return super(_RepackModelStep, self).arguments\r\n    259 \r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/workflow/_utils.py in _prepare_for_repacking(self)\r\n    192             self._establish_source_dir()\r\n    193 \r\n--> 194         self._inject_repack_script()\r\n    195 \r\n    196     def _establish_source_dir(self):\r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/workflow/_utils.py in _inject_repack_script(self)\r\n    232 \r\n    233                 src_dir = os.path.join(tmp, \"src\")\r\n--> 234                 with tarfile.open(name=local_path, mode=\"r:gz\") as tf:\r\n    235                     tf.extractall(path=src_dir)\r\n    236 \r\n\r\n/opt/conda/lib/python3.7/tarfile.py in open(cls, name, mode, fileobj, bufsize, **kwargs)\r\n   1591             else:\r\n   1592                 raise CompressionError(\"unknown compression type %r\" % comptype)\r\n-> 1593             return func(name, filemode, fileobj, **kwargs)\r\n   1594 \r\n   1595         elif \"|\" in mode:\r\n\r\n/opt/conda/lib/python3.7/tarfile.py in gzopen(cls, name, mode, fileobj, compresslevel, **kwargs)\r\n   1637 \r\n   1638         try:\r\n-> 1639             fileobj = GzipFile(name, mode + \"b\", compresslevel, fileobj)\r\n   1640         except OSError:\r\n   1641             if fileobj is not None and mode == 'r':\r\n\r\n/opt/conda/lib/python3.7/gzip.py in __init__(self, filename, mode, compresslevel, fileobj, mtime)\r\n    166             mode += 'b'\r\n    167         if fileobj is None:\r\n--> 168             fileobj = self.myfileobj = builtins.open(filename, mode or 'rb')\r\n    169         if filename is None:\r\n    170             filename = getattr(fileobj, 'name', '')\r\n\r\nIsADirectoryError: [Errno 21] Is a directory: '/tmp/tmpo1ulxvtn/local.tar.gz'\r\n```\r\n**Advices to fix**\r\nIn /sagemaker/workflow/_utils.py Line 221 It's using S3Downloader which downloads source.tar.gz file to local path. Which is creating directory /tmp/tmpo1ulxvtn/local.tar.gz. It should be rather object not directory\r\n\r\n**System information**\r\n- **SageMaker Python SDK version**:2.82.0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**:sklearn\r\n- **Framework version**:0.23-1\r\n- **Python version**:Python 3.7.10\r\n- **CPU or GPU**:CPU\r\n- **Custom Docker image (Y/N)**:N\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3038/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3038/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3031", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3031/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3031/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3031/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3031", "id": 1182616468, "node_id": "I_kwDOBpf0x85GfUuU", "number": 3031, "title": "Model repack always uploads data to S3 bucket regardless of local mode settings", "user": {"login": "alar0330", "id": 8170857, "node_id": "MDQ6VXNlcjgxNzA4NTc=", "avatar_url": "https://avatars.githubusercontent.com/u/8170857?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alar0330", "html_url": "https://github.com/alar0330", "followers_url": "https://api.github.com/users/alar0330/followers", "following_url": "https://api.github.com/users/alar0330/following{/other_user}", "gists_url": "https://api.github.com/users/alar0330/gists{/gist_id}", "starred_url": "https://api.github.com/users/alar0330/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alar0330/subscriptions", "organizations_url": "https://api.github.com/users/alar0330/orgs", "repos_url": "https://api.github.com/users/alar0330/repos", "events_url": "https://api.github.com/users/alar0330/events{/privacy}", "received_events_url": "https://api.github.com/users/alar0330/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790727032, "node_id": "MDU6TGFiZWwyNzkwNzI3MDMy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20hosting", "name": "component: hosting", "color": "01E1F7", "default": false, "description": "Relates to the SageMaker Hosting Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2022-03-27T18:14:56Z", "updated_at": "2022-05-17T14:39:00Z", "closed_at": "2022-05-17T14:39:00Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\n`sagemaker.model.Model` uploads data to S3 when repacking, regardless and despite of local mode settings.\r\n\r\n**Why is this important?**\r\n1/ It seems to contradict the intention of using `local_code` setting to disallow S3 uploads of code-, model-, and other artifacts to S3.\r\n2/ Imagine using Local Mode for dev purposes and having a moderate-sized model (say ResNet-50, with 170mb in serialization). Without proper implementation of `local_code=True` scenario, every launch in LOCAL MODE will trigger an (unnecessary) upload to S3 due to `repack()`-call and then an immediate download to the locally-run container due to `SM_SUBMIT_DIRECTORY = s3://...`. This round trip can causes minutes of delay. Instead of this, the local (repacked) directory with model- and code-artifacts should be mounted directly to the container as `/opt/ml/model`.\r\n\r\n**To reproduce**\r\n```\r\n    sagemaker_session = LocalSession()\r\n    sagemaker_session.config = {'local': {'local_code': True}}\r\n\r\n    role = 'IAM_ROLE'\r\n    # model_dir can also be `file://` to read model locally\r\n    model_dir = 's3://aws-ml-blog/artifacts/pytorch-script-mode-local-model-inference/model.tar.gz'\r\n    image_uri = \"763104351884.dkr.ecr.eu-central-1.amazonaws.com/pytorch-inference:1.8-cpu-py3\"\r\n\r\n    model = PyTorchModel(\r\n        role=role,\r\n        model_data=model_dir,\r\n        framework_version='1.8',\r\n        entry_point='inference.py', # <--- provide any entry_point to trigger repacking of model data \r\n        sagemaker_session=sagemaker_session,\r\n        image_uri=image_uri)\r\n\r\n      predictor = model.deploy(\r\n        initial_instance_count=1,\r\n        instance_type='local')\r\n```\r\n\r\n**Expected behavior**\r\nExpected behaviour is that with these local mode settings, the model and inference scripts are repacked and stored locally (as `file://...`) and not uploaded to S3, as is **currently implemented** for cases when no repacking is needed.\r\n\r\n**Advices to fix**\r\n`sagemaker.model.Model` implements `_upload_code()`, which (in case if repack is needed) defines the following repacked model data path\r\n\r\n```\r\nrepacked_model_data = \"s3://\" + \"/\".join([bucket, key_prefix, \"model.tar.gz\"])\r\n````\r\n\r\nirrespective of the LOCAL MODE settings (contradicting the logic for when no repack is needed). Perhaps, what we need to do is introduce a check for LOCAL MODE that will conditionally define the `repacked_model_data`either having `s3://` (non-LOCAL) or `file://` (LOCAL) paths prefixes. This will (probably) be enough to fix this, as the `utils.repack_model(repacked_model_uri=repacked_model_data, ...)` checks the prefix of the provided `repacked_model_uri` to decide whether to upload data to S3, or store locally.\r\n\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.80.0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: PyTorch\r\n- **Framework version**: >1.2\r\n- **Python version**: 3.8.12\r\n- **CPU or GPU**:\r\n- **Custom Docker image (Y/N)**:\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3031/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3031/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3024", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3024/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3024/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3024/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3024", "id": 1178216018, "node_id": "I_kwDOBpf0x85GOiZS", "number": 3024, "title": "`sagemaker.image_uris.retrieve` returns a wrong image when instance type comes from a ParameterString", "user": {"login": "jonsnowseven", "id": 25992803, "node_id": "MDQ6VXNlcjI1OTkyODAz", "avatar_url": "https://avatars.githubusercontent.com/u/25992803?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonsnowseven", "html_url": "https://github.com/jonsnowseven", "followers_url": "https://api.github.com/users/jonsnowseven/followers", "following_url": "https://api.github.com/users/jonsnowseven/following{/other_user}", "gists_url": "https://api.github.com/users/jonsnowseven/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonsnowseven/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonsnowseven/subscriptions", "organizations_url": "https://api.github.com/users/jonsnowseven/orgs", "repos_url": "https://api.github.com/users/jonsnowseven/repos", "events_url": "https://api.github.com/users/jonsnowseven/events{/privacy}", "received_events_url": "https://api.github.com/users/jonsnowseven/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": {"login": "qidewenwhen", "id": 32910701, "node_id": "MDQ6VXNlcjMyOTEwNzAx", "avatar_url": "https://avatars.githubusercontent.com/u/32910701?v=4", "gravatar_id": "", "url": "https://api.github.com/users/qidewenwhen", "html_url": "https://github.com/qidewenwhen", "followers_url": "https://api.github.com/users/qidewenwhen/followers", "following_url": "https://api.github.com/users/qidewenwhen/following{/other_user}", "gists_url": "https://api.github.com/users/qidewenwhen/gists{/gist_id}", "starred_url": "https://api.github.com/users/qidewenwhen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/qidewenwhen/subscriptions", "organizations_url": "https://api.github.com/users/qidewenwhen/orgs", "repos_url": "https://api.github.com/users/qidewenwhen/repos", "events_url": "https://api.github.com/users/qidewenwhen/events{/privacy}", "received_events_url": "https://api.github.com/users/qidewenwhen/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "qidewenwhen", "id": 32910701, "node_id": "MDQ6VXNlcjMyOTEwNzAx", "avatar_url": "https://avatars.githubusercontent.com/u/32910701?v=4", "gravatar_id": "", "url": "https://api.github.com/users/qidewenwhen", "html_url": "https://github.com/qidewenwhen", "followers_url": "https://api.github.com/users/qidewenwhen/followers", "following_url": "https://api.github.com/users/qidewenwhen/following{/other_user}", "gists_url": "https://api.github.com/users/qidewenwhen/gists{/gist_id}", "starred_url": "https://api.github.com/users/qidewenwhen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/qidewenwhen/subscriptions", "organizations_url": "https://api.github.com/users/qidewenwhen/orgs", "repos_url": "https://api.github.com/users/qidewenwhen/repos", "events_url": "https://api.github.com/users/qidewenwhen/events{/privacy}", "received_events_url": "https://api.github.com/users/qidewenwhen/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 13, "created_at": "2022-03-23T14:38:30Z", "updated_at": "2022-08-29T19:50:18Z", "closed_at": "2022-05-27T20:53:41Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\n`sagemaker.image_uris.retrieve` returns a wrong image when instance type comes from a Parameter\r\n\r\n**To reproduce**\r\n```python\r\nimport sagemaker\r\nfrom sagemaker.workflow.parameters import ParameterString \r\n\r\ntraining_instance_type = ParameterString(\r\n    name=\"TrainingInstanceType\",\r\n    default_value=\"ml.m5.xlarge\",\r\n)\r\n...\r\ntf_model_image_uri = sagemaker.image_uris.retrieve(\r\n    framework=\"tensorflow\",\r\n    region=region,\r\n    version=\"1.15\",\r\n    image_scope=\"training\",\r\n    py_version=\"py3\",\r\n    instance_type=training_instance_type, # ParameterString\r\n)\r\n\r\nestimator = TensorFlow(\u00b4\r\n    image_uri=tf_model_image_uri,\r\n    ...\r\n)\r\n... # rest of the code for the SageMaker Pipeline definition\r\n\r\npipeline.start(dict(TrainingInstanceType=\"ml.p2.xlarge\"))\r\n\r\n# after starting an execution, the image that is inputed into the estimator is \r\n# <account>.dkr.ecr.<region>.amazonaws.com/tensorflow-training:1.15-cpu-py3 \r\n# which is a CPU image **instead of GPU image**\r\n```\r\n\r\n**Expected behavior**\r\nLazy evaluation of the image to allow getting the actual parameter value for the instance type.\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.80.0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: TensorFlow\r\n- **Framework version**: 1.15\r\n- **Python version**: 3.7\r\n- **CPU or GPU**: GPU\r\n- **Custom Docker image (Y/N)**: N\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3024/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3024/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3023", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3023/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3023/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3023/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/3023", "id": 1177785707, "node_id": "I_kwDOBpf0x85GM5Vr", "number": 3023, "title": "Neo compilation fails with ml_inf1 on v2.80.0", "user": {"login": "hariby", "id": 4242858, "node_id": "MDQ6VXNlcjQyNDI4NTg=", "avatar_url": "https://avatars.githubusercontent.com/u/4242858?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hariby", "html_url": "https://github.com/hariby", "followers_url": "https://api.github.com/users/hariby/followers", "following_url": "https://api.github.com/users/hariby/following{/other_user}", "gists_url": "https://api.github.com/users/hariby/gists{/gist_id}", "starred_url": "https://api.github.com/users/hariby/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hariby/subscriptions", "organizations_url": "https://api.github.com/users/hariby/orgs", "repos_url": "https://api.github.com/users/hariby/repos", "events_url": "https://api.github.com/users/hariby/events{/privacy}", "received_events_url": "https://api.github.com/users/hariby/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-03-23T08:34:38Z", "updated_at": "2022-03-23T17:17:59Z", "closed_at": "2022-03-23T17:03:50Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nSageMaker Neo supports Inf1 instances (AWS Inferentia) [[What's New on Apr 2020](https://aws.amazon.com/about-aws/whats-new/2020/04/amazon-sagemaker-now-supports-Inf1-instances-providing-high-performance-and-cost-effective-machine-learning-inference/?nc1=h_ls)]. However, with SageMaker Python SDK v2.80.0, the [`Model.compile`](https://sagemaker.readthedocs.io/en/stable/api/inference/model.html#sagemaker.model.Model.compile) fails with `ClientError` (described below). \r\n\r\n**To reproduce**\r\n1. Open an SageMaker Studio\r\n2. Clone the [Amazon SageMaker Examples](https://github.com/aws/amazon-sagemaker-examples) repo\r\n3. Open Neo compilation example notebooks such as [PyTorch vision](https://github.com/aws/amazon-sagemaker-examples/blob/main/sagemaker_neo_compilation_jobs/deploy_pytorch_model_on_Inf1_instance/pytorch_torchvision_neo_on_Inf1.ipynb) or [Hugging Face BERT](https://github.com/aws/amazon-sagemaker-examples/blob/main/sagemaker_neo_compilation_jobs/deploy_huggingface_model_on_Inf1_instance/inf1_bert_compile_and_deploy.ipynb). Both installs the latest version (currently 2.28.0) of SageMaker Python SDK. \r\n4. Run the notebook\r\n\r\n**Expected behavior**\r\nCompilation job should succeed. I checked the SDK v2.79.0 can successfully call the compilation job. \r\n\r\n**Screenshots or logs**\r\n```\r\nClientError: An error occurred (ValidationException) when calling the CreateCompilationJob operation: Unsupported framework version field for target. Framework version is supported for Target Platform configuration and only part of target devices. \r\nFramework version is only supported for ml_c4, ml_c5, ml_m4, ml_m5, ml_p2, ml_p3, ml_g4dn cloud targetsand lambda, jetson_tx1, jetson_nano, jetson_tx2, jetson_xavier, deeplens, rasp3b, rasp4b, imx8qm, rk3288, rk3399, aisage, sbe_c, qcs605, qcs603, x86_win32, x86_win64 edge devices.\r\n```\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.80.0 (2.79.0 works fine)\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: PyTorch \r\n- **Framework version**: 1.6 \r\n- **Python version**: 3.6\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\nhttps://github.com/aws/amazon-sagemaker-examples/issues/3239", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3023/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/3023/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2978", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2978/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2978/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2978/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2978", "id": 1162340111, "node_id": "I_kwDOBpf0x85FR-cP", "number": 2978, "title": "\"error: argument *: invalid int value\" for arguments that come from ParameterInteger or ParameterFloat", "user": {"login": "jonsnowseven", "id": 25992803, "node_id": "MDQ6VXNlcjI1OTkyODAz", "avatar_url": "https://avatars.githubusercontent.com/u/25992803?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonsnowseven", "html_url": "https://github.com/jonsnowseven", "followers_url": "https://api.github.com/users/jonsnowseven/followers", "following_url": "https://api.github.com/users/jonsnowseven/following{/other_user}", "gists_url": "https://api.github.com/users/jonsnowseven/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonsnowseven/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonsnowseven/subscriptions", "organizations_url": "https://api.github.com/users/jonsnowseven/orgs", "repos_url": "https://api.github.com/users/jonsnowseven/repos", "events_url": "https://api.github.com/users/jonsnowseven/events{/privacy}", "received_events_url": "https://api.github.com/users/jonsnowseven/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": {"login": "qidewenwhen", "id": 32910701, "node_id": "MDQ6VXNlcjMyOTEwNzAx", "avatar_url": "https://avatars.githubusercontent.com/u/32910701?v=4", "gravatar_id": "", "url": "https://api.github.com/users/qidewenwhen", "html_url": "https://github.com/qidewenwhen", "followers_url": "https://api.github.com/users/qidewenwhen/followers", "following_url": "https://api.github.com/users/qidewenwhen/following{/other_user}", "gists_url": "https://api.github.com/users/qidewenwhen/gists{/gist_id}", "starred_url": "https://api.github.com/users/qidewenwhen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/qidewenwhen/subscriptions", "organizations_url": "https://api.github.com/users/qidewenwhen/orgs", "repos_url": "https://api.github.com/users/qidewenwhen/repos", "events_url": "https://api.github.com/users/qidewenwhen/events{/privacy}", "received_events_url": "https://api.github.com/users/qidewenwhen/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "qidewenwhen", "id": 32910701, "node_id": "MDQ6VXNlcjMyOTEwNzAx", "avatar_url": "https://avatars.githubusercontent.com/u/32910701?v=4", "gravatar_id": "", "url": "https://api.github.com/users/qidewenwhen", "html_url": "https://github.com/qidewenwhen", "followers_url": "https://api.github.com/users/qidewenwhen/followers", "following_url": "https://api.github.com/users/qidewenwhen/following{/other_user}", "gists_url": "https://api.github.com/users/qidewenwhen/gists{/gist_id}", "starred_url": "https://api.github.com/users/qidewenwhen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/qidewenwhen/subscriptions", "organizations_url": "https://api.github.com/users/qidewenwhen/orgs", "repos_url": "https://api.github.com/users/qidewenwhen/repos", "events_url": "https://api.github.com/users/qidewenwhen/events{/privacy}", "received_events_url": "https://api.github.com/users/qidewenwhen/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 6, "created_at": "2022-03-08T08:02:07Z", "updated_at": "2022-04-27T23:28:08Z", "closed_at": "2022-04-27T23:28:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nAdditionally opened an error on the [aws-samples](https://github.com/aws-samples/sagemaker-cross-validation-pipeline):\r\nhttps://github.com/aws-samples/sagemaker-cross-validation-pipeline/issues/1\r\n\r\n**To reproduce**\r\nExecute [Example in AWS Samples - SageMaker Cross Validation](https://github.com/aws-samples/sagemaker-cross-validation-pipeline)\r\n\r\n**Expected behaviour**\r\nArgument is correctly parsed to an integer instead of `\"ParameterInteger(name='KFold', parameter_type=<ParameterTypeEnum.INTEGER: 'Integer'>, default_value=3)\"`\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.77.1\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: [Custom](https://github.com/aws-samples/sagemaker-cross-validation-pipeline/blob/main/code/Dockerfile)\r\n- **Framework version**: NA\r\n- **Python version**: 3.8.12\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: Y\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2978/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2978/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2972", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2972/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2972/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2972/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2972", "id": 1160904169, "node_id": "I_kwDOBpf0x85FMf3p", "number": 2972, "title": "Unknown parameter 'CustomerMetadataProperties' error when creating step using RegisterModel in Sagemaker Pipeline", "user": {"login": "ash15996", "id": 93158577, "node_id": "U_kgDOBY18sQ", "avatar_url": "https://avatars.githubusercontent.com/u/93158577?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ash15996", "html_url": "https://github.com/ash15996", "followers_url": "https://api.github.com/users/ash15996/followers", "following_url": "https://api.github.com/users/ash15996/following{/other_user}", "gists_url": "https://api.github.com/users/ash15996/gists{/gist_id}", "starred_url": "https://api.github.com/users/ash15996/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ash15996/subscriptions", "organizations_url": "https://api.github.com/users/ash15996/orgs", "repos_url": "https://api.github.com/users/ash15996/repos", "events_url": "https://api.github.com/users/ash15996/events{/privacy}", "received_events_url": "https://api.github.com/users/ash15996/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-03-07T04:48:22Z", "updated_at": "2022-03-23T17:09:01Z", "closed_at": "2022-03-23T17:09:01Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nRun into error when using 'customer_metadata_properties' parameter from the sagemaker.workflow.step_collections.RegisterModel class and executing it as a step in a Pipeline. Starting the Pipeline with the above parameter produces the following error: \r\n\r\n`ClientError: An error occurred (ValidationException) when calling the CreatePipeline operation: Unable to parse pipeline definition. Unknown Argument member 'CustomerMetadataProperties'.\r\n`\r\n\r\nFor additional context, using 'customer_metadata_properties' directly through estimator.Register works as intended, i.e, the key-value pair gets shown in the model registry. Only when using it as a step in a Pipeline produces the error above. \r\n\r\n`**To reproduce**\r\n\r\n1.  Create an Estimator\r\n```\r\nestimator = sagemaker.estimator.Estimator(\r\n    image_uri=image_uri,\r\n    sagemaker_session=sagemaker_session,\r\n    role=role,\r\n    instance_count=1,\r\n    instance_type=\"ml.c4.large\",\r\n    base_job_name=\"test-registry\",\r\n    output_path=s3_output_path,\r\n)\r\n\r\njob_name='test-2022-01-21-20-01-01-257'\r\nattached_estimator = estimator.attach(job_name)\r\n\r\n```\r\n\r\n2. Create a pipeline step to register the estimator\r\n```\r\nfrom sagemaker.workflow.step_collections import RegisterModel\r\nstep_register = RegisterModel(\r\n    name=\"RegisterDeepARTrafficTest\",\r\n    estimator=attached_estimator,\r\n    model_data=\"s3://sagemaker-us-east-1/deepAR/deepar-traffic-pred-2022-01-21-20-01-01-257/output/model.tar.gz\",\r\n    content_types=[\"applicaiton/json\"],\r\n    response_types=[\"application/json\"],\r\n    inference_instances= [\"ml.m5.large\"],\r\n    transform_instances=[\"ml.m5.large\"],\r\n    model_package_group_name=\"deepar-test\",\r\n    approval_status=\"PendingManualApproval\",\r\n    customer_metadata_properties={\"key_metadata\":\"value_metadata\"},\r\n    description=\"register-test-metadata\",\r\n)\r\n\r\n```\r\n\r\n3. Create and execute a Sagemaker Pipeline\r\n```\r\nfrom sagemaker.workflow.pipeline import Pipeline\r\npipeline = Pipeline(\r\n    name=\"test-register-deepar\",\r\n    steps=[step_register],\r\n    sagemaker_session=sagemaker_session,\r\n)\r\npipeline.upsert(\r\n            role_arn=role\r\n)\r\nexecution = pipeline.start()\r\n\r\n```\r\n\r\n**Expected behavior**\r\n\r\nExpecting the model to be registered along with customer_metadata_properties key value pair being visible in the model registry\r\n\r\n**Screenshots or logs**\r\n\r\n![image](https://user-images.githubusercontent.com/93158577/156969286-61556f24-ad09-470e-b752-40c252125035.png)\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.77.1\r\n- **Python version**:Python 3.7.10\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2972/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2972/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2949", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2949/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2949/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2949/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2949", "id": 1147381496, "node_id": "I_kwDOBpf0x85EY6b4", "number": 2949, "title": "EstimatorBase._json_encode_hyperparameters(hyperparams) breaks sagemaker_training.py", "user": {"login": "osdf", "id": 193341, "node_id": "MDQ6VXNlcjE5MzM0MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/193341?v=4", "gravatar_id": "", "url": "https://api.github.com/users/osdf", "html_url": "https://github.com/osdf", "followers_url": "https://api.github.com/users/osdf/followers", "following_url": "https://api.github.com/users/osdf/following{/other_user}", "gists_url": "https://api.github.com/users/osdf/gists{/gist_id}", "starred_url": "https://api.github.com/users/osdf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/osdf/subscriptions", "organizations_url": "https://api.github.com/users/osdf/orgs", "repos_url": "https://api.github.com/users/osdf/repos", "events_url": "https://api.github.com/users/osdf/events{/privacy}", "received_events_url": "https://api.github.com/users/osdf/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-02-22T21:23:39Z", "updated_at": "2022-12-02T21:07:45Z", "closed_at": "2022-12-02T21:07:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\n\r\nhttps://github.com/aws/sagemaker-training-toolkit/blob/master/src/sagemaker_training/logging_config.py#L29 needs an integer for `level`.\r\nThrough https://github.com/aws/sagemaker-python-sdk/blob/dev/src/sagemaker/estimator.py#L685 the value in `hyperparams[CONTAINER_LOG_LEVEL_PARAM_NAME]` (which is `logging.INFO`, the integer value `20`) gets converted to a string (`'20'`), and hence https://github.com/aws/sagemaker-training-toolkit/blob/master/src/sagemaker_training/logging_config.py#L37 breaks.\r\n\r\nSimilarly (if one fixes the `'20'` issue by hand), \r\nhttps://github.com/aws/sagemaker-training-toolkit/blob/master/src/sagemaker_training/files.py#L136 won't identify that code needs to be downloaded from s3, because the entry for https://github.com/aws/sagemaker-python-sdk/blob/dev/src/sagemaker/model.py#L65 is wrapped into a string, having the form `\"'s3://....'\"`.\r\n\r\n\r\n**To reproduce**\r\nRun with script-mode, using newest sagemaker python sdk (2.76.0)\r\n\r\n**Expected behavior**\r\nIt works.\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.76.0\r\n- **Framework name**: None\r\n- **Framework version**: None\r\n- **Python version**: 3.8\r\n- **CPU or GPU**: CPU and GPU\r\n- **Custom Docker image (Y/N)**: Yes.\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2949/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2949/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2948", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2948/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2948/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2948/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2948", "id": 1147290968, "node_id": "I_kwDOBpf0x85EYkVY", "number": 2948, "title": "Lambda cannot be updated in the SageMaker Pipelines LambdaStep", "user": {"login": "xietao0221", "id": 6492574, "node_id": "MDQ6VXNlcjY0OTI1NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/6492574?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xietao0221", "html_url": "https://github.com/xietao0221", "followers_url": "https://api.github.com/users/xietao0221/followers", "following_url": "https://api.github.com/users/xietao0221/following{/other_user}", "gists_url": "https://api.github.com/users/xietao0221/gists{/gist_id}", "starred_url": "https://api.github.com/users/xietao0221/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xietao0221/subscriptions", "organizations_url": "https://api.github.com/users/xietao0221/orgs", "repos_url": "https://api.github.com/users/xietao0221/repos", "events_url": "https://api.github.com/users/xietao0221/events{/privacy}", "received_events_url": "https://api.github.com/users/xietao0221/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": {"login": "rohangujarathi", "id": 28344270, "node_id": "MDQ6VXNlcjI4MzQ0Mjcw", "avatar_url": "https://avatars.githubusercontent.com/u/28344270?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rohangujarathi", "html_url": "https://github.com/rohangujarathi", "followers_url": "https://api.github.com/users/rohangujarathi/followers", "following_url": "https://api.github.com/users/rohangujarathi/following{/other_user}", "gists_url": "https://api.github.com/users/rohangujarathi/gists{/gist_id}", "starred_url": "https://api.github.com/users/rohangujarathi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rohangujarathi/subscriptions", "organizations_url": "https://api.github.com/users/rohangujarathi/orgs", "repos_url": "https://api.github.com/users/rohangujarathi/repos", "events_url": "https://api.github.com/users/rohangujarathi/events{/privacy}", "received_events_url": "https://api.github.com/users/rohangujarathi/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "rohangujarathi", "id": 28344270, "node_id": "MDQ6VXNlcjI4MzQ0Mjcw", "avatar_url": "https://avatars.githubusercontent.com/u/28344270?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rohangujarathi", "html_url": "https://github.com/rohangujarathi", "followers_url": "https://api.github.com/users/rohangujarathi/followers", "following_url": "https://api.github.com/users/rohangujarathi/following{/other_user}", "gists_url": "https://api.github.com/users/rohangujarathi/gists{/gist_id}", "starred_url": "https://api.github.com/users/rohangujarathi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rohangujarathi/subscriptions", "organizations_url": "https://api.github.com/users/rohangujarathi/orgs", "repos_url": "https://api.github.com/users/rohangujarathi/repos", "events_url": "https://api.github.com/users/rohangujarathi/events{/privacy}", "received_events_url": "https://api.github.com/users/rohangujarathi/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2022-02-22T19:32:01Z", "updated_at": "2022-05-11T22:17:14Z", "closed_at": "2022-05-11T22:17:14Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nI am able to use LambdaStep to create a Lambda function that is used by SageMaker Pipelines when the Lambda does not exist. But after I update the Lambda script, I expect the Lambda function would be updated but it is not.\r\n\r\n**To reproduce**\r\n1. execute the sagemaker pipeline, that includes a lambda step, the first time to create the lambda function\r\n2. update the lambda script\r\n3. run the sagemaker pipeline again, the lambda script won't be updated to reflect the change\r\n\r\n**Expected behavior**\r\nThe lambda script will be updated to reflect the change defined in the sagemaker pipeline\r\n\r\n**Screenshots or logs**\r\nN/A\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: `2.66.2.post0`\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: N/A\r\n- **Framework version**: N/A\r\n- **Python version**: 3.8\r\n- **CPU or GPU**: N/A\r\n- **Custom Docker image (Y/N)**: N/A\r\n\r\n**Additional context**\r\n* Amazon internal code link - https://code.amazon.com/packages/PVReengagementMLPipeline/blobs/b7b84f52802c7de9ef2a552d78db1b653392d763/--/src/pv_reengagement_ml_pipeline/pipelines/steps/commit_step.py#L25\r\n* Amazon internal ticket link - https://t.corp.amazon.com/P55427823\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2948/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2948/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2942", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2942/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2942/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2942/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2942", "id": 1143452605, "node_id": "I_kwDOBpf0x85EJ7O9", "number": 2942, "title": "Unsupported pytorch version 1.10.0 with SM Elastic Inference Accelerators", "user": {"login": "vinayak-shanawad", "id": 37987800, "node_id": "MDQ6VXNlcjM3OTg3ODAw", "avatar_url": "https://avatars.githubusercontent.com/u/37987800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vinayak-shanawad", "html_url": "https://github.com/vinayak-shanawad", "followers_url": "https://api.github.com/users/vinayak-shanawad/followers", "following_url": "https://api.github.com/users/vinayak-shanawad/following{/other_user}", "gists_url": "https://api.github.com/users/vinayak-shanawad/gists{/gist_id}", "starred_url": "https://api.github.com/users/vinayak-shanawad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vinayak-shanawad/subscriptions", "organizations_url": "https://api.github.com/users/vinayak-shanawad/orgs", "repos_url": "https://api.github.com/users/vinayak-shanawad/repos", "events_url": "https://api.github.com/users/vinayak-shanawad/events{/privacy}", "received_events_url": "https://api.github.com/users/vinayak-shanawad/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-02-18T17:27:18Z", "updated_at": "2022-06-30T04:25:36Z", "closed_at": "2022-06-29T19:11:44Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi Team,\r\n\r\nGreetings!!\r\n\r\nWe are not able to deploy on real-time endpoint with elastic inference accelerators. Could you please have a look?\r\n\r\nSageMaker version: 2.76.0\r\n\r\n**Code**:\r\nfrom sagemaker.pytorch import PyTorchModel\r\nfrom sagemaker import get_execution_role\r\n\r\nendpoint_name = 'ner-bert'\r\n\r\nmodel = PyTorchModel(entry_point='deploy_ei.py', \r\n                     source_dir='code',\r\n                     model_data=model_data, \r\n                     role=get_execution_role(), \r\n                     framework_version='1.10.0', \r\n                     py_version='py38')\r\n\r\npredictor = model.deploy(initial_instance_count=1,\r\n                        instance_type='ml.m5.xlarge',\r\n                        accelerator_type='ml.eia2.medium',\r\n                        endpoint_name=endpoint_name)\r\n\r\n**Error details**: Unsupported pytorch version: 1.10.0. You may need to upgrade your SDK version (pip install -U sagemaker) for newer pytorch versions. Supported pytorch version(s): 1.3.1, 1.5.1, 1.3, 1.5.\r\n\r\n**Note**: We are able to deploy without elastic accelerator in above code and want to use Python 3.8 version because we have some dependency libraries which supports only Python 3.8 version.\r\n\r\nI looked at \"Available DL containers\" at https://github.com/aws/deep-learning-containers/blob/master/available_images.md\r\nand by looking at this section \"SageMaker Framework Containers (SM support only)\", SM support PyTorch 1.10.0 with Python 3.8 version.\r\n\r\nBut we would like to deploy on Elastic Inference accelerators and by looking at this section \"Elastic Inference Containers\" in above URL, EI containers supports only PyTorch 1.5.1 with Python 3.6. Why these containers are so outdated?\r\n\r\nWhat could be the solution?\r\n\r\nCan we specify the latest version of Python in requirements.txt file and get it installed?\r\n\r\nThanks,\r\nVinayak", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2942/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2942/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2941", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2941/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2941/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2941/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2941", "id": 1140982849, "node_id": "I_kwDOBpf0x85EAgRB", "number": 2941, "title": "SageMaker ProcessingStep doesn't support git_config while FrameworkProcessor.run do.", "user": {"login": "mohamed-ali", "id": 2883926, "node_id": "MDQ6VXNlcjI4ODM5MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2883926?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mohamed-ali", "html_url": "https://github.com/mohamed-ali", "followers_url": "https://api.github.com/users/mohamed-ali/followers", "following_url": "https://api.github.com/users/mohamed-ali/following{/other_user}", "gists_url": "https://api.github.com/users/mohamed-ali/gists{/gist_id}", "starred_url": "https://api.github.com/users/mohamed-ali/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mohamed-ali/subscriptions", "organizations_url": "https://api.github.com/users/mohamed-ali/orgs", "repos_url": "https://api.github.com/users/mohamed-ali/repos", "events_url": "https://api.github.com/users/mohamed-ali/events{/privacy}", "received_events_url": "https://api.github.com/users/mohamed-ali/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-02-17T07:46:48Z", "updated_at": "2022-02-17T14:44:47Z", "closed_at": "2022-02-17T14:44:47Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**Describe the bug**\r\nSageMaker ProcessingStep doesn't support git_config while FrameworkProcessor do.\r\n\r\n**To reproduce**\r\nCheck the signature of ProcessingStep vs FrameworkProcessor.run.\r\n\r\n```\r\nProcessingStep(\r\n    name: str,\r\n    processor: sagemaker.processing.Processor,\r\n    display_name: str = None,\r\n    description: str = None,\r\n    inputs: List[sagemaker.processing.ProcessingInput] = None,\r\n    outputs: List[sagemaker.processing.ProcessingOutput] = None,\r\n    job_arguments: List[str] = None,\r\n    code: str = None,\r\n    property_files: List[sagemaker.workflow.properties.PropertyFile] = None,\r\n    cache_config: sagemaker.workflow.steps.CacheConfig = None,\r\n    depends_on: Union[List[str], List[sagemaker.workflow.steps.Step]] = None,\r\n    retry_policies: List[sagemaker.workflow.retry.RetryPolicy] = None,\r\n)\r\n```\r\n\r\n```\r\nFrameworkProcessor.run(\r\n    self,\r\n    code,\r\n    source_dir=None,\r\n    dependencies=None,\r\n    git_config=None,\r\n    inputs=None,\r\n    outputs=None,\r\n    arguments=None,\r\n    wait=True,\r\n    logs=True,\r\n    job_name=None,\r\n    experiment_config=None,\r\n    kms_key=None,\r\n)\r\n```\r\n\r\n**Expected behavior**\r\nProcessingStep should supports the parameters of the individual processor. In particular, git_config should be supported since it is  a supported feature in FrameworkProcessor.run.\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.75.1\r\n- **Python version**: 3.7.10\r\n- **CPU or GPU**: \r\n- **Custom Docker image (Y/N)**:\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2941/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2941/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2940", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2940/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2940/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2940/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2940", "id": 1140048934, "node_id": "I_kwDOBpf0x85D88Qm", "number": 2940, "title": "TrainingStep changing `sagemaker_job_name` input parameter with each pipeline update [kills caching]", "user": {"login": "mpaf", "id": 3285301, "node_id": "MDQ6VXNlcjMyODUzMDE=", "avatar_url": "https://avatars.githubusercontent.com/u/3285301?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpaf", "html_url": "https://github.com/mpaf", "followers_url": "https://api.github.com/users/mpaf/followers", "following_url": "https://api.github.com/users/mpaf/following{/other_user}", "gists_url": "https://api.github.com/users/mpaf/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpaf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpaf/subscriptions", "organizations_url": "https://api.github.com/users/mpaf/orgs", "repos_url": "https://api.github.com/users/mpaf/repos", "events_url": "https://api.github.com/users/mpaf/events{/privacy}", "received_events_url": "https://api.github.com/users/mpaf/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-02-16T13:50:12Z", "updated_at": "2022-03-08T17:05:19Z", "closed_at": "2022-03-08T17:05:19Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nDuring pipeline upsert, a training job name is created and added to the input parameters of a sagemaker training step which kills caching (even when otherwise nothing has changed). The input parameter in question is in hyperparameters: sagemaker_job_name. This job_name is modified each time we run upsert, even with no change.\r\n\r\n**To reproduce**\r\n\r\n1. Create a Pipeline with a single train step\r\n2. Run > pipeline.steps[0].estimator._hyperparameters['sagemaker_job_name']\r\n3. It will throw an error as that hyperparam doesn't exist\r\n4. run pipeline.definition() or pipeline.upsert()\r\n5. run step 2 again, you now have a job_name input param (not the actual job name that pipeline will run)\r\n6. re-running steps 4 and 5 always gives a different output, even with no changes to pipeline.\r\n7. This kills the pipeline cache with no-op updates to the Training Step.\r\n\r\n**Expected behavior**\r\n\r\nThe training job name is a dynamic parameter to be created during pipeline execution, and not during pipeline creation/update time.\r\n\r\n**Screenshots or logs**\r\nNA\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.75.1\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: PyTorch Framework Estimator\r\n- **Framework version**: 1.9.0\r\n- **Python version**: 3.7.1\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\nN/A", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2940/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2940/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2936", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2936/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2936/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2936/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/pull/2936", "id": 1138432719, "node_id": "PR_kwDOBpf0x84y2FRy", "number": 2936, "title": "Fix broken reference.", "user": {"login": "mohamed-ali", "id": 2883926, "node_id": "MDQ6VXNlcjI4ODM5MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2883926?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mohamed-ali", "html_url": "https://github.com/mohamed-ali", "followers_url": "https://api.github.com/users/mohamed-ali/followers", "following_url": "https://api.github.com/users/mohamed-ali/following{/other_user}", "gists_url": "https://api.github.com/users/mohamed-ali/gists{/gist_id}", "starred_url": "https://api.github.com/users/mohamed-ali/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mohamed-ali/subscriptions", "organizations_url": "https://api.github.com/users/mohamed-ali/orgs", "repos_url": "https://api.github.com/users/mohamed-ali/repos", "events_url": "https://api.github.com/users/mohamed-ali/events{/privacy}", "received_events_url": "https://api.github.com/users/mohamed-ali/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 892238348, "node_id": "MDU6TGFiZWw4OTIyMzgzNDg=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/type:%20documentation", "name": "type: documentation", "color": "002b36", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": {"login": "claytonparnell", "id": 42805768, "node_id": "MDQ6VXNlcjQyODA1NzY4", "avatar_url": "https://avatars.githubusercontent.com/u/42805768?v=4", "gravatar_id": "", "url": "https://api.github.com/users/claytonparnell", "html_url": "https://github.com/claytonparnell", "followers_url": "https://api.github.com/users/claytonparnell/followers", "following_url": "https://api.github.com/users/claytonparnell/following{/other_user}", "gists_url": "https://api.github.com/users/claytonparnell/gists{/gist_id}", "starred_url": "https://api.github.com/users/claytonparnell/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/claytonparnell/subscriptions", "organizations_url": "https://api.github.com/users/claytonparnell/orgs", "repos_url": "https://api.github.com/users/claytonparnell/repos", "events_url": "https://api.github.com/users/claytonparnell/events{/privacy}", "received_events_url": "https://api.github.com/users/claytonparnell/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "claytonparnell", "id": 42805768, "node_id": "MDQ6VXNlcjQyODA1NzY4", "avatar_url": "https://avatars.githubusercontent.com/u/42805768?v=4", "gravatar_id": "", "url": "https://api.github.com/users/claytonparnell", "html_url": "https://github.com/claytonparnell", "followers_url": "https://api.github.com/users/claytonparnell/followers", "following_url": "https://api.github.com/users/claytonparnell/following{/other_user}", "gists_url": "https://api.github.com/users/claytonparnell/gists{/gist_id}", "starred_url": "https://api.github.com/users/claytonparnell/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/claytonparnell/subscriptions", "organizations_url": "https://api.github.com/users/claytonparnell/orgs", "repos_url": "https://api.github.com/users/claytonparnell/repos", "events_url": "https://api.github.com/users/claytonparnell/events{/privacy}", "received_events_url": "https://api.github.com/users/claytonparnell/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 29, "created_at": "2022-02-15T09:44:27Z", "updated_at": "2022-12-21T22:32:57Z", "closed_at": "2022-12-21T22:32:57Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/pulls/2936", "html_url": "https://github.com/aws/sagemaker-python-sdk/pull/2936", "diff_url": "https://github.com/aws/sagemaker-python-sdk/pull/2936.diff", "patch_url": "https://github.com/aws/sagemaker-python-sdk/pull/2936.patch", "merged_at": "2022-12-21T22:32:56Z"}, "body": "Fixes a broken reference.", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2936/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2936/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2933", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2933/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2933/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2933/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2933", "id": 1136938699, "node_id": "I_kwDOBpf0x85DxE7L", "number": 2933, "title": "82 symbols length constraint error for a pipeline name while creating a new pipeline", "user": {"login": "morelen17", "id": 11724878, "node_id": "MDQ6VXNlcjExNzI0ODc4", "avatar_url": "https://avatars.githubusercontent.com/u/11724878?v=4", "gravatar_id": "", "url": "https://api.github.com/users/morelen17", "html_url": "https://github.com/morelen17", "followers_url": "https://api.github.com/users/morelen17/followers", "following_url": "https://api.github.com/users/morelen17/following{/other_user}", "gists_url": "https://api.github.com/users/morelen17/gists{/gist_id}", "starred_url": "https://api.github.com/users/morelen17/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/morelen17/subscriptions", "organizations_url": "https://api.github.com/users/morelen17/orgs", "repos_url": "https://api.github.com/users/morelen17/repos", "events_url": "https://api.github.com/users/morelen17/events{/privacy}", "received_events_url": "https://api.github.com/users/morelen17/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-02-14T08:19:29Z", "updated_at": "2022-05-02T14:17:49Z", "closed_at": "2022-05-02T14:17:48Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nI get this error when building and creating an arbitrary pipeline.\r\n```\r\nbotocore.exceptions.ClientError: An error occurred (ValidationException) when calling the CreatePipeline operation: [string \"<pipeline-name>\" is too long (length: <xxx>, maximum allowed: 82)]\r\n```\r\n\r\nApparently, it is somehow related with `PipelineExecutionDisplayName` length constraint (from the [docs](https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_PipelineExecution.html): `Minimum length of 1. Maximum length of 82.`). `PipelineName` in fact has the [following](https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreatePipeline.html#sagemaker-CreatePipeline-request-PipelineName) constraint: `Minimum length of 1. Maximum length of 256.`.\r\n\r\n**To reproduce**\r\nCreate any pipeline:\r\n```python\r\nfrom sagemaker.workflow.pipeline import Pipeline\r\n\r\n\r\na_long_pipeline_name = '...'  # len(a_long_pipeline_name) > 82 - magic number?\r\nbuggy_sm_pipeline = Pipeline(\r\n    name=a_long_pipeline_name,\r\n    steps=[...],\r\n)\r\nbuggy_sm_pipeline.upsert(role_arn='...')\r\n```\r\n\r\n**Expected behavior**\r\nThe pipeline is created / updated w/o any errors even if its name length is greater than **82**. It must not be in any way tied to `PipelineExecutionDisplayName` (if this is indeed the case, which I suspect it is).\r\n\r\n**Screenshots or logs**\r\n```\r\nTraceback (most recent call last):\r\n  ...\r\n  File \"<>/python3.8/site-packages/sagemaker/workflow/pipeline.py\", line 219, in upsert\r\n    response = self.create(role_arn, description, tags, parallelism_config)\r\n  File \"<>/python3.8/site-packages/sagemaker/workflow/pipeline.py\", line 121, in create\r\n    return self.sagemaker_session.sagemaker_client.create_pipeline(**kwargs)\r\n  File \"<>/python3.8/site-packages/botocore/client.py\", line 391, in _api_call\r\n    return self._make_api_call(operation_name, kwargs)\r\n  File \"<>/python3.8/site-packages/botocore/client.py\", line 719, in _make_api_call\r\n    raise error_class(parsed_response, operation_name)\r\nbotocore.exceptions.ClientError: An error occurred (ValidationException) when calling the CreatePipeline operation: [string \"<pipeline-name>\" is too long (length: <xxx>, maximum allowed: 82)]\r\n```\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.73.0 (also 2.59.8)\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: -\r\n- **Framework version**: -\r\n- **Python version**: 3.8 (3.8.12)\r\n- **CPU or GPU**: -\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\n\\-\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2933/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2933/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2930", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2930/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2930/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2930/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2930", "id": 1132777856, "node_id": "I_kwDOBpf0x85DhNGA", "number": 2930, "title": "[Bug] Environment Variables through Estimators in Local Mode Does Not Work", "user": {"login": "ssmall41", "id": 12437233, "node_id": "MDQ6VXNlcjEyNDM3MjMz", "avatar_url": "https://avatars.githubusercontent.com/u/12437233?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ssmall41", "html_url": "https://github.com/ssmall41", "followers_url": "https://api.github.com/users/ssmall41/followers", "following_url": "https://api.github.com/users/ssmall41/following{/other_user}", "gists_url": "https://api.github.com/users/ssmall41/gists{/gist_id}", "starred_url": "https://api.github.com/users/ssmall41/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ssmall41/subscriptions", "organizations_url": "https://api.github.com/users/ssmall41/orgs", "repos_url": "https://api.github.com/users/ssmall41/repos", "events_url": "https://api.github.com/users/ssmall41/events{/privacy}", "received_events_url": "https://api.github.com/users/ssmall41/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-02-11T15:47:50Z", "updated_at": "2022-04-05T17:35:51Z", "closed_at": "2022-04-05T17:35:51Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**Describe the bug**\r\n[Estimators accept an argument](https://sagemaker.readthedocs.io/en/stable/api/training/estimators.html) for setting environment variables in training jobs. However providing values here does not actually set them in the container when using local mode. A workaround is to pass the values as hyperparameters and then use them appropriately in the container code or training script.\r\n\r\n**To reproduce**\r\nFor example, with the PyTorch estimator:\r\n```\r\nfrom sagemaker.pytorch import PyTorch\r\nestimator = PyTorch(instance_type=\"local\", environment={\"MYVAR\": \"got_it\"}, ...)\r\n```\r\nCalls to `os.environ[\"MYVAR\"]` do not see `\"MYVAR\"` defined. If instead I use `instance_type=\"ml.g4dn.xlarge\"`, then `\"MYVAR\"` is defined in the container, as expected.\r\n\r\n**Expected behavior**\r\n`\"MYVAR\"` should be defined in the container.\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.72.3 \r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: PyTorch\r\n- **Framework version**: 1.9.0\r\n- **Python version**: py38\r\n- **CPU or GPU**: GPU\r\n- **Custom Docker image (Y/N)**: No\r\n\r\nI can also produce this with Tensorflow images as well, so I suspect it's not dependent on the framework.\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2930/reactions", "total_count": 12, "+1": 12, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2930/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2911", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2911/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2911/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2911/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2911", "id": 1127486437, "node_id": "I_kwDOBpf0x85DNBPl", "number": 2911, "title": "pytorch container version 1.5.1 deployment with Elastic inferance error leads to torchscript model trace being unable to be loaded", "user": {"login": "cm2435", "id": 69640669, "node_id": "MDQ6VXNlcjY5NjQwNjY5", "avatar_url": "https://avatars.githubusercontent.com/u/69640669?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cm2435", "html_url": "https://github.com/cm2435", "followers_url": "https://api.github.com/users/cm2435/followers", "following_url": "https://api.github.com/users/cm2435/following{/other_user}", "gists_url": "https://api.github.com/users/cm2435/gists{/gist_id}", "starred_url": "https://api.github.com/users/cm2435/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cm2435/subscriptions", "organizations_url": "https://api.github.com/users/cm2435/orgs", "repos_url": "https://api.github.com/users/cm2435/repos", "events_url": "https://api.github.com/users/cm2435/events{/privacy}", "received_events_url": "https://api.github.com/users/cm2435/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-02-08T16:32:02Z", "updated_at": "2022-08-30T06:23:29Z", "closed_at": "2022-08-30T06:23:29Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nHello All! First time raising an issue with Sagemaker so forgive me if this is wrong place or format. Trying to deploy Bert model to return sentence embeddings in pytorch container with the model served as torchscript trace .pt file. Deployment in framework version 1.5 works as intended, until an elastic accelerator is attached to the estimator deployed, at which point the torchserve logs show that the model cannot be loaded. Using framework 1.5.1 further yields an import error of torch EIA. \r\n\r\n**To reproduce**\r\nFollowing the documentation on how to load a torchscript model in model_fn at the link below. \r\n`https://docs.aws.amazon.com/elastic-inference/latest/developerguide/ei-pytorch-using.html` \r\n\r\nI load my model using the following \r\n```\r\ndef model_fn(model_dir):\r\n    logger.info('model_fn')\r\n    torch._C._jit_set_profiling_executor(False)\r\n    \r\n    jit_path = os.path.join(model_dir, \"traced_bert.pt\")\r\n    traced_model = torch.jit.load(jit_path, map_location=torch.device('cpu'))\r\n    tokenizer = BertTokenizer.from_pretrained(\"bert-base-uncased\")\r\n\r\n    if torch.__version__ == '1.5.1':\r\n        import torcheia\r\n        traced_model = traced_model.eval()\r\n        # attach_eia() is introduced in PyTorch Elastic Inference 1.5.1,\r\n        traced_model = torcheia.jit.attach_eia(traced_model, 0)\r\n            \r\n        device = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\")\r\n        logger.info(model_dir)\r\n        traced_model.to(device)\r\n        \r\n    model_dict = {'model':traced_model, 'tokenizer':tokenizer}\r\n    return model_dict\r\n```\r\n\r\nInside of a inference.py file in a .code subdirectory, as specified by the documentation.The Pytorch model class is intialized as follows: \r\n\r\n```\r\nfrom sagemaker.pytorch import PyTorch, PyTorchModel\r\nfrom sagemaker.predictor import Predictor\r\nfrom sagemaker import get_execution_role\r\n\r\nclass StringPredictor(Predictor):\r\n    def __init__(self, endpoint_name, sagemaker_session):\r\n        super(StringPredictor, self).__init__(endpoint_name, sagemaker_session,)# content_type='text/plain')\r\n\r\npytorch_model = PyTorchModel(model_data = pt_model_data, \r\n                             role=role, \r\n                             entry_point ='inference.py',\r\n                             source_dir = './code',\r\n                             py_version = 'py3', \r\n                             framework_version = '1.5.1',\r\n                             predictor_cls=StringPredictor)\r\n```\r\n\r\n**Expected behavior**\r\nThis as, without elastic inferance, load a bert model trace from the traced_bert.pt file, and use it to return embeddings of an input string or list of strings. However, it instead returns the following cloudwatch logs below: \r\n\r\n\r\n\r\n**Screenshots or logs**y\r\n```\r\n\r\n\r\n2022-02-08 16:01:24,875 [WARN ] W-9000-model com.amazonaws.ml.mms.wlm.BatchAggregator - Load model failed: model, error: Worker died. | 2022-02-08  16:01:24,875 [WARN ] W-9000-model  com.amazonaws.ml.mms.wlm.BatchAggregator - Load model failed: model,  error: Worker died. | AllTraffic/i-018a65bd4adef637d\r\n-- | -- | --\r\n\u00a0\r\n\r\n<span><span class=\"\"><div class=\"logs__log-events-table__formatted-message\" data-testid=\"logs__log-events-table__formatted-message\"><div class=\"logs__log-events-table__content\">2022-02-08 16:01:24,877 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle - ImportError: /opt/conda/lib/python3.6/site-packages/_torch_eia.cpython-36m-x86_64-linux-gnu.so: undefined symbol: _ZTVN5torch8autograd8profiler14RecordFunctionE</div></div></span></span>2022-02-08 16:01:24,875 [WARN ] W-9000-model com.amazonaws.ml.mms.wlm.BatchAggregator - Load model failed: model, error: Worker died.\r\n\t2022-02-08 16:01:24,875 [WARN ] W-9000-model com.amazonaws.ml.mms.wlm.BatchAggregator - Load model failed: model, error: Worker died.\t[AllTraffic/i-018a65bd4adef637d](https://us-east-1.console.aws.amazon.com/cloudwatch/home?region=us-east-1#logsV2:log-groups/log-group/$252Faws$252Fsagemaker$252FEndpoints$252Fsimilar-language-search-1644335320/log-events/AllTraffic$252Fi-018a65bd4adef637d$3Fstart$3D1644336085772$26refEventId$3D36669920071780642424269827607790865012690228969552216077)\r\n\t2022-02-08T16:01:25.872+00:00\r\n2022-02-08 16:01:24,875 [INFO ] W-9000-model com.amazonaws.ml.mms.wlm.WorkerThread - Retry worker: 9000-66ac40cc-6e0e4860-8bac23a9-f092939f-4a6b7bf9-d703e7b2-d14f0c4a-a02d37b7-2786bf9f in 34 seconds.\r\n\t2022-02-08 16:01:24,875 [INFO ] W-9000-model com.amazonaws.ml.mms.wlm.WorkerThread - Retry worker: 9000-66ac40cc-6e0e4860-8bac23a9-f092939f-4a6b7bf9-d703e7b2-d14f0c4a-a02d37b7-2786bf9f in 34 seconds.\t[AllTraffic/i-018a65bd4adef637d](https://us-east-1.console.aws.amazon.com/cloudwatch/home?region=us-east-1#logsV2:log-groups/log-group/$252Faws$252Fsagemaker$252FEndpoints$252Fsimilar-language-search-1644335320/log-events/AllTraffic$252Fi-018a65bd4adef637d$3Fstart$3D1644336085772$26refEventId$3D36669920071780642424269827607790865012690228969552216078)\r\n\t2022-02-08T16:01:25.872+00:00\r\n2022-02-08 16:01:24,875 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle -     self.module = importlib.import_module(module_name)\r\n\t2022-02-08 16:01:24,875 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle - self.module = importlib.import_module(module_name)\t[AllTraffic/i-018a65bd4adef637d](https://us-east-1.console.aws.amazon.com/cloudwatch/home?region=us-east-1#logsV2:log-groups/log-group/$252Faws$252Fsagemaker$252FEndpoints$252Fsimilar-language-search-1644335320/log-events/AllTraffic$252Fi-018a65bd4adef637d$3Fstart$3D1644336085772$26refEventId$3D36669920071780642424269827607790865012690228969552216079)\r\n\t2022-02-08T16:01:25.872+00:00\r\n2022-02-08 16:01:24,875 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle -   File \"/opt/conda/lib/python3.6/importlib/__init__.py\", line 126, in import_module\r\n\t2022-02-08 16:01:24,875 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle - File \"/opt/conda/lib/python3.6/importlib/__init__.py\", line 126, in import_module\t[AllTraffic/i-018a65bd4adef637d](https://us-east-1.console.aws.amazon.com/cloudwatch/home?region=us-east-1#logsV2:log-groups/log-group/$252Faws$252Fsagemaker$252FEndpoints$252Fsimilar-language-search-1644335320/log-events/AllTraffic$252Fi-018a65bd4adef637d$3Fstart$3D1644336085772$26refEventId$3D36669920071780642424269827607790865012690228969552216080)\r\n\t2022-02-08T16:01:25.872+00:00\r\n2022-02-08 16:01:24,876 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle -     return _bootstrap._gcd_import(name[level:], package, level)\r\n\t2022-02-08 16:01:24,876 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle - return _bootstrap._gcd_import(name[level:], package, level)\t[AllTraffic/i-018a65bd4adef637d](https://us-east-1.console.aws.amazon.com/cloudwatch/home?region=us-east-1#logsV2:log-groups/log-group/$252Faws$252Fsagemaker$252FEndpoints$252Fsimilar-language-search-1644335320/log-events/AllTraffic$252Fi-018a65bd4adef637d$3Fstart$3D1644336085772$26refEventId$3D36669920071780642424269827607790865012690228969552216081)\r\n\t2022-02-08T16:01:25.872+00:00\r\n2022-02-08 16:01:24,876 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle -   File \"<frozen importlib._bootstrap>\", line 994, in _gcd_import\r\n\t2022-02-08 16:01:24,876 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle - File \"<frozen importlib._bootstrap>\", line 994, in _gcd_import\t[AllTraffic/i-018a65bd4adef637d](https://us-east-1.console.aws.amazon.com/cloudwatch/home?region=us-east-1#logsV2:log-groups/log-group/$252Faws$252Fsagemaker$252FEndpoints$252Fsimilar-language-search-1644335320/log-events/AllTraffic$252Fi-018a65bd4adef637d$3Fstart$3D1644336085772$26refEventId$3D36669920071780642424269827607790865012690228969552216082)\r\n\t2022-02-08T16:01:25.872+00:00\r\n2022-02-08 16:01:24,876 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle -   File \"<frozen importlib._bootstrap>\", line 971, in _find_and_load\r\n\t2022-02-08 16:01:24,876 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle - File \"<frozen importlib._bootstrap>\", line 971, in _find_and_load\t[AllTraffic/i-018a65bd4adef637d](https://us-east-1.console.aws.amazon.com/cloudwatch/home?region=us-east-1#logsV2:log-groups/log-group/$252Faws$252Fsagemaker$252FEndpoints$252Fsimilar-language-search-1644335320/log-events/AllTraffic$252Fi-018a65bd4adef637d$3Fstart$3D1644336085772$26refEventId$3D36669920071780642424269827607790865012690228969552216083)\r\n\t2022-02-08T16:01:25.872+00:00\r\n2022-02-08 16:01:24,876 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle -   File \"<frozen importlib._bootstrap>\", line 955, in _find_and_load_unlocked\r\n\t2022-02-08 16:01:24,876 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle - File \"<frozen importlib._bootstrap>\", line 955, in _find_and_load_unlocked\t[AllTraffic/i-018a65bd4adef637d](https://us-east-1.console.aws.amazon.com/cloudwatch/home?region=us-east-1#logsV2:log-groups/log-group/$252Faws$252Fsagemaker$252FEndpoints$252Fsimilar-language-search-1644335320/log-events/AllTraffic$252Fi-018a65bd4adef637d$3Fstart$3D1644336085772$26refEventId$3D36669920071780642424269827607790865012690228969552216084)\r\n\t2022-02-08T16:01:25.872+00:00\r\n2022-02-08 16:01:24,876 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle -   File \"<frozen importlib._bootstrap>\", line 665, in _load_unlocked\r\n\t2022-02-08 16:01:24,876 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle - File \"<frozen importlib._bootstrap>\", line 665, in _load_unlocked\t[AllTraffic/i-018a65bd4adef637d](https://us-east-1.console.aws.amazon.com/cloudwatch/home?region=us-east-1#logsV2:log-groups/log-group/$252Faws$252Fsagemaker$252FEndpoints$252Fsimilar-language-search-1644335320/log-events/AllTraffic$252Fi-018a65bd4adef637d$3Fstart$3D1644336085772$26refEventId$3D36669920071780642424269827607790865012690228969552216085)\r\n\t2022-02-08T16:01:25.872+00:00\r\n2022-02-08 16:01:24,876 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle -   File \"<frozen importlib._bootstrap_external>\", line 678, in exec_module\r\n\t2022-02-08 16:01:24,876 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle - File \"<frozen importlib._bootstrap_external>\", line 678, in exec_module\t[AllTraffic/i-018a65bd4adef637d](https://us-east-1.console.aws.amazon.com/cloudwatch/home?region=us-east-1#logsV2:log-groups/log-group/$252Faws$252Fsagemaker$252FEndpoints$252Fsimilar-language-search-1644335320/log-events/AllTraffic$252Fi-018a65bd4adef637d$3Fstart$3D1644336085772$26refEventId$3D36669920071780642424269827607790865012690228969552216086)\r\n\t2022-02-08T16:01:25.872+00:00\r\n2022-02-08 16:01:24,876 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle -   File \"<frozen importlib._bootstrap>\", line 219, in _call_with_frames_removed\r\n\t2022-02-08 16:01:24,876 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle - File \"<frozen importlib._bootstrap>\", line 219, in _call_with_frames_removed\t[AllTraffic/i-018a65bd4adef637d](https://us-east-1.console.aws.amazon.com/cloudwatch/home?region=us-east-1#logsV2:log-groups/log-group/$252Faws$252Fsagemaker$252FEndpoints$252Fsimilar-language-search-1644335320/log-events/AllTraffic$252Fi-018a65bd4adef637d$3Fstart$3D1644336085772$26refEventId$3D36669920071780642424269827607790865012690228969552216087)\r\n\t2022-02-08T16:01:25.873+00:00\r\n2022-02-08 16:01:24,876 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle -   File \"/opt/conda/lib/python3.6/site-packages/sagemaker_pytorch_serving_container/handler_service.py\", line 17, in <module>\r\n\t2022-02-08 16:01:24,876 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle - File \"/opt/conda/lib/python3.6/site-packages/sagemaker_pytorch_serving_container/handler_service.py\", line 17, in <module>\t[AllTraffic/i-018a65bd4adef637d](https://us-east-1.console.aws.amazon.com/cloudwatch/home?region=us-east-1#logsV2:log-groups/log-group/$252Faws$252Fsagemaker$252FEndpoints$252Fsimilar-language-search-1644335320/log-events/AllTraffic$252Fi-018a65bd4adef637d$3Fstart$3D1644336085773$26refEventId$3D36669920071802943169468358230932400730962877331058196504)\r\n\t2022-02-08T16:01:25.873+00:00\r\n2022-02-08 16:01:24,876 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle -     from sagemaker_pytorch_serving_container.default_inference_handler import \\\r\n\t2022-02-08 16:01:24,876 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle - from sagemaker_pytorch_serving_container.default_inference_handler import \\\t[AllTraffic/i-018a65bd4adef637d](https://us-east-1.console.aws.amazon.com/cloudwatch/home?region=us-east-1#logsV2:log-groups/log-group/$252Faws$252Fsagemaker$252FEndpoints$252Fsimilar-language-search-1644335320/log-events/AllTraffic$252Fi-018a65bd4adef637d$3Fstart$3D1644336085773$26refEventId$3D36669920071802943169468358230932400730962877331058196505)\r\n\t2022-02-08T16:01:25.873+00:00\r\n2022-02-08 16:01:24,876 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle -   File \"/opt/conda/lib/python3.6/site-packages/sagemaker_pytorch_serving_container/default_inference_handler.py\", line 18, in <module>\r\n\t2022-02-08 16:01:24,876 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle - File \"/opt/conda/lib/python3.6/site-packages/sagemaker_pytorch_serving_container/default_inference_handler.py\", line 18, in <module>\t[AllTraffic/i-018a65bd4adef637d](https://us-east-1.console.aws.amazon.com/cloudwatch/home?region=us-east-1#logsV2:log-groups/log-group/$252Faws$252Fsagemaker$252FEndpoints$252Fsimilar-language-search-1644335320/log-events/AllTraffic$252Fi-018a65bd4adef637d$3Fstart$3D1644336085773$26refEventId$3D36669920071802943169468358230932400730962877331058196506)\r\n\t2022-02-08T16:01:25.873+00:00\r\n2022-02-08 16:01:24,876 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle -     import torch, torcheia\r\n\t2022-02-08 16:01:24,876 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle - import torch, torcheia\t[AllTraffic/i-018a65bd4adef637d](https://us-east-1.console.aws.amazon.com/cloudwatch/home?region=us-east-1#logsV2:log-groups/log-group/$252Faws$252Fsagemaker$252FEndpoints$252Fsimilar-language-search-1644335320/log-events/AllTraffic$252Fi-018a65bd4adef637d$3Fstart$3D1644336085773$26refEventId$3D36669920071802943169468358230932400730962877331058196507)\r\n\t2022-02-08T16:01:25.873+00:00\r\n2022-02-08 16:01:24,876 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle -   File \"/opt/conda/lib/python3.6/site-packages/torcheia/__init__.py\", line 1, in <module>\r\n\t2022-02-08 16:01:24,876 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle - File \"/opt/conda/lib/python3.6/site-packages/torcheia/__init__.py\", line 1, in <module>\t[AllTraffic/i-018a65bd4adef637d](https://us-east-1.console.aws.amazon.com/cloudwatch/home?region=us-east-1#logsV2:log-groups/log-group/$252Faws$252Fsagemaker$252FEndpoints$252Fsimilar-language-search-1644335320/log-events/AllTraffic$252Fi-018a65bd4adef637d$3Fstart$3D1644336085773$26refEventId$3D36669920071802943169468358230932400730962877331058196508)\r\n\t2022-02-08T16:01:25.873+00:00\r\n2022-02-08 16:01:24,876 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle -     from _torch_eia import *\r\n\t2022-02-08 16:01:24,876 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle - from _torch_eia import *\t[AllTraffic/i-018a65bd4adef637d](https://us-east-1.console.aws.amazon.com/cloudwatch/home?region=us-east-1#logsV2:log-groups/log-group/$252Faws$252Fsagemaker$252FEndpoints$252Fsimilar-language-search-1644335320/log-events/AllTraffic$252Fi-018a65bd4adef637d$3Fstart$3D1644336085773$26refEventId$3D36669920071802943169468358230932400730962877331058196509)\r\n\t2022-02-08T16:01:25.873+00:00\r\n2022-02-08 16:01:24,877 [INFO ] W-9000-model-stdout com.amazonaws.ml.mms.wlm.WorkerLifeCycle - ImportError: /opt/conda/lib/python3.6/site-packages/_torch_eia.cpython-36m-x86_64-linux-gnu.so: undefined symbol: _ZTVN5torch8autograd8profiler14RecordFunctionE\r\n```\r\n\r\n\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**:\r\n- **Framework name Pytorch \r\n- **Framework version**: 1.5\r\n- **Python version**: 3.6.13\r\n- **CPU or GPU**: CPU with elastic inferance \r\n- **Custom Docker image (Y/N)**: no\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n\r\nDeployment Specs\r\n```\r\nlocal_mode = False\r\n\r\nif local_mode:\r\n    instance_type = \"local\"\r\nelse:\r\n    instance_type = \"ml.c4.xlarge\"\r\n   # instance_type = \"ml.c4.xlarge\"\r\n\r\n\r\npredictor = pytorch_model.deploy(\r\n    initial_instance_count=1,\r\n    instance_type=instance_type,\r\n    endpoint_name = f'similar-language-search-{int(time.time())}',\r\n    serializer=JSONSerializer(),\r\n    deserializer=JSONDeserializer(),\r\n    accelerator_type='ml.eia2.medium'\r\n)\r\n```", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2911/reactions", "total_count": 3, "+1": 3, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2911/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2910", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2910/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2910/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2910/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2910", "id": 1127024365, "node_id": "I_kwDOBpf0x85DLQbt", "number": 2910, "title": "`s3:ListAllMyBuckets` or `s3:CreateBucket` permission required for Session with default bucket", "user": {"login": "janbe-ts", "id": 63344087, "node_id": "MDQ6VXNlcjYzMzQ0MDg3", "avatar_url": "https://avatars.githubusercontent.com/u/63344087?v=4", "gravatar_id": "", "url": "https://api.github.com/users/janbe-ts", "html_url": "https://github.com/janbe-ts", "followers_url": "https://api.github.com/users/janbe-ts/followers", "following_url": "https://api.github.com/users/janbe-ts/following{/other_user}", "gists_url": "https://api.github.com/users/janbe-ts/gists{/gist_id}", "starred_url": "https://api.github.com/users/janbe-ts/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/janbe-ts/subscriptions", "organizations_url": "https://api.github.com/users/janbe-ts/orgs", "repos_url": "https://api.github.com/users/janbe-ts/repos", "events_url": "https://api.github.com/users/janbe-ts/events{/privacy}", "received_events_url": "https://api.github.com/users/janbe-ts/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2022-02-08T09:52:39Z", "updated_at": "2022-06-27T18:31:00Z", "closed_at": "2022-06-27T18:31:00Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nWhen I create a Session like this: `Session(default_bucket=my_bucket)`, the library conveniently creates the bucket if it doesn't already exists. To check whether the bucket exists is based on getting the creation date of the bucket which is an operation that requires the IAM permission `s3:ListAllMyBuckets`. This permission shouldn't be necessary and is often not allowed in environments following the least privileges principle.\r\n\r\n**To reproduce**\r\nCreate a Session with a `default_bucket` that already exists. Creating any Sagemaker processing job will fail if the used IAM role does not have `s3:ListAllMyBuckets` and `s3:CreateBucket` permission. \r\n\r\n**Expected behavior**\r\nI should be able to create a Sagemaker processing job without having to assign `s3:ListAllMyBuckets` or `s3:CreateBucket` to my IAM role.\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.75.1\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: PySparkProcessor\r\n- **Framework version**: 2.4\r\n- **Python version**: 3.9.4\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: Y\r\n\r\n**Additional context**\r\nThis code in the function `_create_s3_bucket_if_it_does_not_exist` in `session.py` creates the bucket if it doesn't already exists:\r\n```\r\nif bucket.creation_date is None:\r\n  try:\r\n      if region == \"us-east-1\":\r\n          # 'us-east-1' cannot be specified because it is the default region:\r\n          # https://github.com/boto/boto3/issues/125\r\n          s3.create_bucket(Bucket=bucket_name)\r\n      else:\r\n          s3.create_bucket(\r\n              Bucket=bucket_name, CreateBucketConfiguration={\"LocationConstraint\": region}\r\n          )\r\n  \r\n      LOGGER.info(\"Created S3 bucket: %s\", bucket_name)\r\n  except ClientError as e:\r\n      error_code = e.response[\"Error\"][\"Code\"]\r\n      message = e.response[\"Error\"][\"Message\"]\r\n  \r\n      if error_code == \"BucketAlreadyOwnedByYou\":\r\n          pass\r\n      elif (\r\n          error_code == \"OperationAborted\"\r\n          and \"conflicting conditional operation\" in message\r\n      ):\r\n          # If this bucket is already being concurrently created, we don't need to create\r\n          # it again.\r\n          pass\r\n      else:\r\n          raise\r\n```\r\n\r\n`bucket.creation_date` (surprisingly) uses an API call like `aws s3 list-buckets` to get the creation date of the default bucket. The API call requires `s3:ListAllMyBuckets` permission. Weirdly, if the caller doesn't have this permission, the API doesn't fail but just returns `None`. In this case, we enter the if clause although the bucket may already exist.\r\n\r\n`s3.create_bucket` obviously requires the `s3:CreateBucket` permission. If the caller has this permission and the bucket already exists, the API raises a ClientError with error_code `BucketAlreadyOwnedByYou`, which will allow this code to pass.\r\nHowever, if the `s3:CreateBucket` permission isn't granted, this code fails with a permission denied ClientError.\r\n\r\nTherefore, the caller needs either `s3:ListAllMyBuckets` or `s3:CreateBucket` in order for this code to work. Both shouldn't be needed for this operation.\r\n\r\nThe [head_bucket operation](https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/s3.html#S3.Client.head_bucket) would be more suitable to be used instead of `bucket.creation_date` here because it's both faster and doesn't need the mentioned permissions. This would also allow the if clause `if error_code == \"BucketAlreadyOwnedByYou\":` to be removed.\r\n\r\nIf you agree with me, I can help implementing a change. Please let me know! :)\r\nCheers", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2910/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2910/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2909", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2909/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2909/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2909/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2909", "id": 1126629224, "node_id": "I_kwDOBpf0x85DJv9o", "number": 2909, "title": "SageMaker processing step not finding /opt/ml/processing/input/code/", "user": {"login": "calvin0112", "id": 99224546, "node_id": "U_kgDOBeoL4g", "avatar_url": "https://avatars.githubusercontent.com/u/99224546?v=4", "gravatar_id": "", "url": "https://api.github.com/users/calvin0112", "html_url": "https://github.com/calvin0112", "followers_url": "https://api.github.com/users/calvin0112/followers", "following_url": "https://api.github.com/users/calvin0112/following{/other_user}", "gists_url": "https://api.github.com/users/calvin0112/gists{/gist_id}", "starred_url": "https://api.github.com/users/calvin0112/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/calvin0112/subscriptions", "organizations_url": "https://api.github.com/users/calvin0112/orgs", "repos_url": "https://api.github.com/users/calvin0112/repos", "events_url": "https://api.github.com/users/calvin0112/events{/privacy}", "received_events_url": "https://api.github.com/users/calvin0112/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-02-07T23:52:21Z", "updated_at": "2022-05-19T22:00:04Z", "closed_at": "2022-05-19T22:00:04Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi,\r\n\r\nI'm using XGBoostProcessor from the SageMaker Python SDK for a ProcessingStep in my SageMaker pipeline. When running the pipeline from a Jupyter notebook in SageMaker Studio, I'm getting the following error:\r\n\r\n```\r\n    /opt/ml/processing/input/entrypoint/runproc.sh: line 3: cd: /opt/ml/processing/input/code/: No such file or directory\r\n    tar (child): sourcedir.tar.gz: Cannot open: No such file or directory\r\n```\r\n\r\nThis is from the script runproc.sh, which is generated by XGBoostProcessor. It looks like the script is trying to go to the directory \"/opt/ml/processing/input/code/\" to unpack the code to run for the processing but can't find the directory. Here is my Python code for my pipeline:\r\n\r\n```\r\n    BASE_DIR = os.path.dirname(os.path.realpath(__file__))\r\n    \r\n    ...\r\n    \r\n        train_processor = XGBoostProcessor(\r\n            framework_version=\"1.3-1\",\r\n            command=[\"python3\"],\r\n            instance_type=processing_instance_type,\r\n            instance_count=1,\r\n            base_job_name=f\"{base_job_prefix}/script-sc-train\",\r\n            sagemaker_session=sagemaker_session,\r\n            role=role\r\n        )\r\n    \r\n        train_something_run_args = train_processor.get_run_args(\r\n            code=os.path.join(BASE_DIR, \"train_something.py\"),\r\n            source_dir=BASE_DIR,\r\n            arguments=[\r\n                '--input_table', SOMETHING_INPUT_TABLE,\r\n                '--s3_storage_bucket', S3_STORAGE_BUCKET,\r\n                '--model_file_path', S3_MODEL_PREFIX + f\"/{SOMETHING_MODEL_NAME}_model.pkl\"\r\n            ]\r\n        )\r\n    \r\n        step_train_something = ProcessingStep(\r\n            name=\"TrainSomethingModel\",\r\n            processor=train_processor,\r\n            code=train_something_run_args.code,\r\n            job_arguments=train_something_run_args.arguments\r\n        )\r\n\r\n```\r\n\r\nThe script \"train_something.py\" is the code that I need to run for the processing step, and BASE_DIR is the directory with the dependencies.\r\n\r\nI tried adding a ProcessingInput with \"/opt/ml/processing/input/code\" as the destination for the RunArgs, but it didn't help:\r\n\r\n```\r\n    train_something_run_args = train_processor.get_run_args(\r\n        code=os.path.join(BASE_DIR, \"train_something.py\"),\r\n        source_dir=BASE_DIR,\r\n        inputs=[ProcessingInput(source=BASE_DIR, destination=\"/opt/ml/processing/input/code\")],\r\n        arguments=[\r\n            '--input_table', SOMETHING_INPUT_TABLE,\r\n            '--s3_storage_bucket', S3_STORAGE_BUCKET,\r\n            '--model_file_path', S3_MODEL_PREFIX + f\"/{SOMETHING_MODEL_NAME}_model.pkl\"\r\n        ]\r\n    )\r\n    \r\n    step_train_something = ProcessingStep(\r\n        name=\"TrainSomethingModel\",\r\n        processor=train_processor,\r\n        code=train_something_run_args.code,\r\n        inputs=train_something_run_args.inputs,\r\n        job_arguments=train_something_run_args.arguments\r\n    )\r\n```\r\n\r\nWith the ProcessingInput, I'm still getting the same error. I've confirmed that the script runproc.sh and the code archive sourcedir.tar.gz are in the S3 bucket.\r\n\r\nI would appreciate any help with this. I found an issue regarding the broken integration between FrameworkProcessor and ProcessingStep (https://github.com/aws/sagemaker-python-sdk/issues/2656). Is it related?\r\n\r\nThanks,\r\nC", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2909/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2909/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2863", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2863/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2863/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2863/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2863", "id": 1110856040, "node_id": "I_kwDOBpf0x85CNlFo", "number": 2863, "title": "image_uris.retrieve() for PyTorch Estimator returns ValueError: \"Empty Sagemaker instance type\"", "user": {"login": "fierval", "id": 987574, "node_id": "MDQ6VXNlcjk4NzU3NA==", "avatar_url": "https://avatars.githubusercontent.com/u/987574?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fierval", "html_url": "https://github.com/fierval", "followers_url": "https://api.github.com/users/fierval/followers", "following_url": "https://api.github.com/users/fierval/following{/other_user}", "gists_url": "https://api.github.com/users/fierval/gists{/gist_id}", "starred_url": "https://api.github.com/users/fierval/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fierval/subscriptions", "organizations_url": "https://api.github.com/users/fierval/orgs", "repos_url": "https://api.github.com/users/fierval/repos", "events_url": "https://api.github.com/users/fierval/events{/privacy}", "received_events_url": "https://api.github.com/users/fierval/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-01-21T19:58:53Z", "updated_at": "2022-01-21T20:02:05Z", "closed_at": "2022-01-21T20:02:05Z", "author_association": "NONE", "active_lock_reason": null, "body": "```python\r\nimport sagemaker\r\nimg_uri = sagemaker.image_uris.retrieve(framework='pytorch', region='us-east-1', image_scope='training', version=\"1.9\", py_version='py38')\r\n```\r\nTried different versions of pytorch and python, tried \"latest\" for the version parameter - no effect.\r\n\r\n**Results**\r\n```\r\n~\\anaconda3\\envs\\sroie\\lib\\site-packages\\sagemaker\\image_uris.py in _processor(instance_type, available_processors)\r\n    261 \r\n    262     if not instance_type:\r\n--> 263         raise ValueError(\r\n    264             \"Empty SageMaker instance type. For options, see: \"\r\n    265             \"https://aws.amazon.com/sagemaker/pricing/instance-types\"\r\n\r\nValueError: Empty SageMaker instance type. For options, see: https://aws.amazon.com/sagemaker/pricing/instance-types\r\n```\r\n**System information**\r\nA description of your system. Please provide:\r\nSagemaker Python SDK 2.73.0 also repro on 2.72.3\r\nWindows 11. \r\nConda Python 3.8", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2863/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2863/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2843", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2843/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2843/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2843/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2843", "id": 1099154303, "node_id": "I_kwDOBpf0x85Bg8N_", "number": 2843, "title": "ConditionEquals does not accept PrimitiveType \"bool\" in the left parameter", "user": {"login": "snnclsr", "id": 20097381, "node_id": "MDQ6VXNlcjIwMDk3Mzgx", "avatar_url": "https://avatars.githubusercontent.com/u/20097381?v=4", "gravatar_id": "", "url": "https://api.github.com/users/snnclsr", "html_url": "https://github.com/snnclsr", "followers_url": "https://api.github.com/users/snnclsr/followers", "following_url": "https://api.github.com/users/snnclsr/following{/other_user}", "gists_url": "https://api.github.com/users/snnclsr/gists{/gist_id}", "starred_url": "https://api.github.com/users/snnclsr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/snnclsr/subscriptions", "organizations_url": "https://api.github.com/users/snnclsr/orgs", "repos_url": "https://api.github.com/users/snnclsr/repos", "events_url": "https://api.github.com/users/snnclsr/events{/privacy}", "received_events_url": "https://api.github.com/users/snnclsr/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-01-11T13:30:33Z", "updated_at": "2022-03-28T17:12:49Z", "closed_at": "2022-03-28T17:12:48Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\n\r\nConditionEquals class accepts two parameters left and right. And according to documentation, it can be either ConditionValueType or PrimitiveType. When I pass two boolean parameters as True and True it throws the following exception. **AttributeError: 'bool' object has no attribute 'expr'**\r\n\r\n**To reproduce**\r\n\r\n```python\r\nfrom sagemaker.workflow.conditions import ConditionEquals\r\nfrom sagemaker.workflow.parameters import ParameterBoolean\r\nbool_param = ParameterBoolean(name=\"bool_param\", default_value=True)\r\n# Produces the aforementioned error\r\ncond_error = ConditionEquals(\r\n    left=True,\r\n    right=True\r\n)\r\ncond_fine = ConditionEquals(\r\n    left=bool_param,\r\n    right=True\r\n)\r\nprint(cond_error.to_request())\r\n>>> AttributeError: 'bool' object has no attribute 'expr'\r\nprint(cond_fine.to_request())\r\n>>> {'Type': 'Equals', 'LeftValue': {'Get': 'Parameters.bool_param'}, 'RightValue': True}\r\n```\r\n\r\n**Expected behavior**\r\nSince the documentation states that the parameter could be a primitive type, I would expect to pass a `True` as it is.\r\n\r\n**Screenshots or logs**\r\nIf applicable, add screenshots or logs to help explain your problem.\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: '2.72.3'\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: None\r\n- **Framework version**: None\r\n- **Python version**: 3.8.8\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\n\r\nI was using this operation while creating a new pipeline step but the code above can reproduce the same behaviour.\r\n\r\nHere in the master branch: \r\nhttps://github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/workflow/conditions.py#L82\r\nfor the right value `primitive_or_expr` function used. I believe the same thing applies to left value as well.", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2843/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2843/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2808", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2808/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2808/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2808/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2808", "id": 1088762846, "node_id": "I_kwDOBpf0x85A5TPe", "number": 2808, "title": "preprocess output is uploaded to the wrong place", "user": {"login": "yitzchak-ben-ezra-ecoplant", "id": 72689700, "node_id": "MDQ6VXNlcjcyNjg5NzAw", "avatar_url": "https://avatars.githubusercontent.com/u/72689700?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yitzchak-ben-ezra-ecoplant", "html_url": "https://github.com/yitzchak-ben-ezra-ecoplant", "followers_url": "https://api.github.com/users/yitzchak-ben-ezra-ecoplant/followers", "following_url": "https://api.github.com/users/yitzchak-ben-ezra-ecoplant/following{/other_user}", "gists_url": "https://api.github.com/users/yitzchak-ben-ezra-ecoplant/gists{/gist_id}", "starred_url": "https://api.github.com/users/yitzchak-ben-ezra-ecoplant/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yitzchak-ben-ezra-ecoplant/subscriptions", "organizations_url": "https://api.github.com/users/yitzchak-ben-ezra-ecoplant/orgs", "repos_url": "https://api.github.com/users/yitzchak-ben-ezra-ecoplant/repos", "events_url": "https://api.github.com/users/yitzchak-ben-ezra-ecoplant/events{/privacy}", "received_events_url": "https://api.github.com/users/yitzchak-ben-ezra-ecoplant/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-12-26T12:36:09Z", "updated_at": "2021-12-26T19:49:27Z", "closed_at": "2021-12-26T19:49:27Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nI want to execute same pipeline multiple times concurrently (with different inputs). I expect each preprocess output to be uploaded to a dedicated bucket. but all outputs among separate executions runs over each other because they share same directory name in S3.\r\nthis is caused because somehow the job name is being defined during pipeline creation - instead of during execution.\r\n\r\n**To reproduce**\r\nI'm using `ScriptProcessor` with the `ProcessingStep`\r\n`code` is being upload to the correct place in each execution\r\nbut `output` not\r\n```\r\nprocessor = ScriptProcessor(\r\n    command=['python'],\r\n    image_uri=f\"{ecr_uri_prefix}/{preprocessing_name}:latest\",\r\n    instance_type=processing_instance_type,\r\n    instance_count=processing_instance_count,\r\n    role=role,\r\n    max_runtime_in_seconds=1000,\r\n    base_job_name=\"pressure-drop-model-preprocess\",\r\n)\r\n\r\n\r\nstep_process = ProcessingStep(\r\n    name=\"PressureDropModelPreprocess\",\r\n    processor=processor,\r\n    job_arguments=['--compressor-id', compressor_id,\r\n                   '--station-flow-sensor-id', station_flow_sensor_id,\r\n                   '--station-pressure-sensor-id', station_pressure_sensor_id,\r\n                   '--station-flow-indicator', station_flow_indicator,\r\n                   '--station-pressure-indicator', station_pressure_indicator,],\r\n    inputs=[\r\n        ProcessingInput(source=input_data, destination=\"/opt/ml/processing/input-indicators\"),\r\n    ],\r\n    outputs=[\r\n        ProcessingOutput(output_name=\"train\", source=\"/opt/ml/processing/train\"),  # the output will be stored in a directory with timestamp of definition - not in timestamp of execution\r\n    ],\r\n    code=f\"{scripts_dir}/preprocessing.py\",  # local path - works great\r\n)\r\n```\r\n\r\n**Expected behavior**\r\non each execution a dedicated folder in S3 should appear with \"code\" and \"output\" of this execution.\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: '2.59.5'\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: Custom docker image\r\n- **Framework version**: N/A\r\n- **Python version**: 3.7.10\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: Y\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2808/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2808/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2791", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2791/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2791/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2791/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2791", "id": 1074037235, "node_id": "I_kwDOBpf0x85ABIHz", "number": 2791, "title": "TensorFlowModel is not available in SageMaker Pipelines", "user": {"login": "matsuyusu", "id": 95735278, "node_id": "U_kgDOBbTN7g", "avatar_url": "https://avatars.githubusercontent.com/u/95735278?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matsuyusu", "html_url": "https://github.com/matsuyusu", "followers_url": "https://api.github.com/users/matsuyusu/followers", "following_url": "https://api.github.com/users/matsuyusu/following{/other_user}", "gists_url": "https://api.github.com/users/matsuyusu/gists{/gist_id}", "starred_url": "https://api.github.com/users/matsuyusu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matsuyusu/subscriptions", "organizations_url": "https://api.github.com/users/matsuyusu/orgs", "repos_url": "https://api.github.com/users/matsuyusu/repos", "events_url": "https://api.github.com/users/matsuyusu/events{/privacy}", "received_events_url": "https://api.github.com/users/matsuyusu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": {"login": "qidewenwhen", "id": 32910701, "node_id": "MDQ6VXNlcjMyOTEwNzAx", "avatar_url": "https://avatars.githubusercontent.com/u/32910701?v=4", "gravatar_id": "", "url": "https://api.github.com/users/qidewenwhen", "html_url": "https://github.com/qidewenwhen", "followers_url": "https://api.github.com/users/qidewenwhen/followers", "following_url": "https://api.github.com/users/qidewenwhen/following{/other_user}", "gists_url": "https://api.github.com/users/qidewenwhen/gists{/gist_id}", "starred_url": "https://api.github.com/users/qidewenwhen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/qidewenwhen/subscriptions", "organizations_url": "https://api.github.com/users/qidewenwhen/orgs", "repos_url": "https://api.github.com/users/qidewenwhen/repos", "events_url": "https://api.github.com/users/qidewenwhen/events{/privacy}", "received_events_url": "https://api.github.com/users/qidewenwhen/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "qidewenwhen", "id": 32910701, "node_id": "MDQ6VXNlcjMyOTEwNzAx", "avatar_url": "https://avatars.githubusercontent.com/u/32910701?v=4", "gravatar_id": "", "url": "https://api.github.com/users/qidewenwhen", "html_url": "https://github.com/qidewenwhen", "followers_url": "https://api.github.com/users/qidewenwhen/followers", "following_url": "https://api.github.com/users/qidewenwhen/following{/other_user}", "gists_url": "https://api.github.com/users/qidewenwhen/gists{/gist_id}", "starred_url": "https://api.github.com/users/qidewenwhen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/qidewenwhen/subscriptions", "organizations_url": "https://api.github.com/users/qidewenwhen/orgs", "repos_url": "https://api.github.com/users/qidewenwhen/repos", "events_url": "https://api.github.com/users/qidewenwhen/events{/privacy}", "received_events_url": "https://api.github.com/users/qidewenwhen/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 5, "created_at": "2021-12-08T05:50:18Z", "updated_at": "2022-04-15T02:49:25Z", "closed_at": "2022-04-15T02:49:25Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nA clear and concise description of what the bug is.\r\n\r\nFor TensorFlowModel in sagemaker.tensorflow.model, if model_data=step_train.properties.ModelArtifacts.S3ModelArtifacts, then we get an error. if model_data=s3/path/model.tar.gz, then the execution will be successful.\r\n\r\n**To reproduce**\r\nA clear, step-by-step set of instructions to reproduce the bug.\r\n\r\nTo use SageMaker Pipelines, we write pipeline.py. \r\nIn pipeline.py, we must create a model to define a batch inference as follow.\r\n```\r\nfrom sagemaker.tensorflow.model import TensorFlowModel\r\nmodel = TensorFlowModel(\r\n    entry_point=os.path.join(BASE_DIR, 'inference.py'),\r\n    model_data=step_train.properties.ModelArtifacts.S3ModelArtifacts,\r\n    source_dir=BASE_DIR,\r\n    role=role,\r\n    name='XXX',\r\n    framework_version=TF_VERSION,\r\n    sagemaker_session=sagemaker_session)\r\n```\r\n\r\n**Expected behavior**\r\nA clear and concise description of what you expected to happen.\r\n\r\nTransform using a model created in TrainingStep.\r\n\r\n**Screenshots or logs**\r\nIf applicable, add screenshots or logs to help explain your problem.\r\n\r\nWe get the following exception:\r\nException: 'Properties' object has no attribute 'lower'\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**:2.70.0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: TensorFlow\r\n- **Framework version**:1.15.2\r\n- **Python version**:3.7\r\n- **CPU or GPU**:CPU\r\n- **Custom Docker image (Y/N)**:N\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2791/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2791/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2759", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2759/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2759/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2759/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2759", "id": 1051410087, "node_id": "I_kwDOBpf0x84-qz6n", "number": 2759, "title": "RegisterModel step fails when I provide 'entry_point' and 'source_dir' arguments to register a sklearn model as a part of SM Pipelines", "user": {"login": "krishnashanker-amt", "id": 70163242, "node_id": "MDQ6VXNlcjcwMTYzMjQy", "avatar_url": "https://avatars.githubusercontent.com/u/70163242?v=4", "gravatar_id": "", "url": "https://api.github.com/users/krishnashanker-amt", "html_url": "https://github.com/krishnashanker-amt", "followers_url": "https://api.github.com/users/krishnashanker-amt/followers", "following_url": "https://api.github.com/users/krishnashanker-amt/following{/other_user}", "gists_url": "https://api.github.com/users/krishnashanker-amt/gists{/gist_id}", "starred_url": "https://api.github.com/users/krishnashanker-amt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/krishnashanker-amt/subscriptions", "organizations_url": "https://api.github.com/users/krishnashanker-amt/orgs", "repos_url": "https://api.github.com/users/krishnashanker-amt/repos", "events_url": "https://api.github.com/users/krishnashanker-amt/events{/privacy}", "received_events_url": "https://api.github.com/users/krishnashanker-amt/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-11-11T22:23:54Z", "updated_at": "2022-02-14T22:12:57Z", "closed_at": "2022-02-14T22:12:57Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nI have created a multi-step SM Pipeline that trains a sklearn model (xgb classifier from sklearn) using a custom training script as `entry_point` (that makes use of multiple custom supporting scripts provided via `source_dir`), and registers it post satisfactory evaluation results. \r\n\r\nWhen I provide the RegisterModel script with  `entry_point` and `source_dir` as additional parameters to indicate a custom script, the SM Pipeline fails at the RegisterRepackModel step as the repack step launches a container where the `SM_HP_SOURCE_DIR` environment variable is set to the location of the `source_dir` _on my local environment_ instead of packaging the `source_dir` from my local to a location on the container (usually `/opt/ml/code/`)\r\n\r\n![image](https://user-images.githubusercontent.com/70163242/141372848-dc3e8299-4124-4f99-b65e-37688493cb1b.png)\r\n\r\nThe container obviously fails to find such a folder and the step fails\r\n\r\n<img width=\"1491\" alt=\"Screen Shot 2021-11-11 at 4 48 55 PM\" src=\"https://user-images.githubusercontent.com/70163242/141373883-86be62ab-7c32-422d-8ea1-b173b23958ef.png\">\r\n\r\n\r\n\r\n\r\n**To reproduce**\r\n\r\n- Create a sklearn estimator using a custom training script \r\n\r\n``` python\r\nsklearn = SKLearn(\r\n        entry_point = 'train.py',\r\n        source_dir = code_location,\r\n        framework_version = FRAMEWORK_VERSION,\r\n        base_job_name=f\"{base_job_prefix}/xgboost_train\",\r\n        instance_type=training_instance_type,\r\n        role=role,\r\n    output_path = model_path,\r\n    hyperparameters = hyperparameters,\r\n    metric_definitions=[\r\n        {'Name': 'AUC-ROC', 'Regex': \"AUC-ROC = ([0-9.]+).*$\"}\r\n    ], \r\n    )\r\n```\r\n- Create a TrainingStep in SM Pipeline using the estimator as input\r\n- Create a RegisterModel step in SM Pipeline (from [this issue](https://github.com/aws/sagemaker-python-sdk/issues/2014), I found I can pass the additional parameters entry_point and source_dir to specify a custom inference script) \r\n\r\n``` python\r\nstep_register = RegisterModel(\r\n        name=\"Register-Model\",\r\n        estimator=sklearn,\r\n        model_data=step_train_model.properties.ModelArtifacts.S3ModelArtifacts,\r\n        content_types=[\"application/json\", \"text/csv\"],\r\n        response_types=[\"application/json\", \"text/csv\"],\r\n        inference_instances=[\"ml.t2.medium\", \"ml.m5.xlarge\"],\r\n        transform_instances=[\"ml.m5.xlarge\"],\r\n        model_package_group_name=model_package_group_name,\r\n        approval_status=model_approval_status,\r\n        model_metrics=model_metrics,\r\n        entry_point = 'train.py',\r\n        source_dir = model_files_location\r\n    )\r\n```\r\n- At this point, I've tried three different ways to provide a value for `source_dir`, all of them fail. \r\n1) `model_files_location` is a location on my local environment. That fails with the error shown in the issue description. \r\n2) `model_files_location` is a S3 bucket address where the code is packaged as a `tar.gz` file (same directory structure as a `sourcedir.tar.gz` file used by sklearn containers). Fails with the below error. \r\n\r\n\r\n<img width=\"815\" alt=\"Screen Shot 2021-11-11 at 5 22 30 PM\" src=\"https://user-images.githubusercontent.com/70163242/141377489-9803b428-0a3b-46c9-92ea-385c7dc5bc06.png\">\r\n\r\n\r\n- Combine the steps in a pipeline and execute it\r\n\r\n\r\n\r\n**Expected behavior**\r\n\r\nThe RegisterModel takes care of re-packing the model with the custom training script and supporting scripts, but passes the wrong environment variable to the container. If the right environment variable can be passed, or if we can control the environment variables passed to a container, then endpoint should launch successfully. \r\n\r\nIdeally, the model package arn from RegisterModel step contains the inference and supporting scripts so that `serving.py` from a [sagemaker-scikit-learn-container](https://github.com/aws/sagemaker-scikit-learn-container/blob/master/src/sagemaker_sklearn_container/serving.py) can successfully find the `module_name` and launch a container that passes ping health checks. \r\n\r\n**Screenshots or logs**\r\nIf applicable, add screenshots or logs to help explain your problem.\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.66.0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: SKLearn\r\n- **Framework version**:  0.23-1\r\n- **Python version**: 3.7.10\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\n\r\nBased on the comments in[ link 1](https://github.com/aws/sagemaker-python-sdk/issues/2014) and [link 2](https://github.com/aws/sagemaker-python-sdk/issues/2123), I also tried building `/opt/ml/model/` with the following things during model training, so that they are stored as a part of the `model.tar.gz` file. \r\n```\r\n./code/{both train and inference scripts}\r\n./code/{other scripts}\r\n./{model_assets}\r\n./{other reference files}\r\n```\r\n I tried skipping the `source_dir` and `entry_point` arguments in RegisterModel when I do this (so that the pipeline can at least run and create a registered model, otherwise it will not execute), but the container still fails to find my `train.py`. \r\n\r\n<img width=\"1356\" alt=\"Screen Shot 2021-11-11 at 5 23 42 PM\" src=\"https://user-images.githubusercontent.com/70163242/141377616-3a53bfbe-cfd8-404d-860f-f80a540ecc59.png\">\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2759/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2759/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2747", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2747/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2747/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2747/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2747", "id": 1042804578, "node_id": "I_kwDOBpf0x84-J-9i", "number": 2747, "title": "Must provide absolute path in local mode, not in remote mode", "user": {"login": "neilmcguigan", "id": 1829364, "node_id": "MDQ6VXNlcjE4MjkzNjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1829364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/neilmcguigan", "html_url": "https://github.com/neilmcguigan", "followers_url": "https://api.github.com/users/neilmcguigan/followers", "following_url": "https://api.github.com/users/neilmcguigan/following{/other_user}", "gists_url": "https://api.github.com/users/neilmcguigan/gists{/gist_id}", "starred_url": "https://api.github.com/users/neilmcguigan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/neilmcguigan/subscriptions", "organizations_url": "https://api.github.com/users/neilmcguigan/orgs", "repos_url": "https://api.github.com/users/neilmcguigan/repos", "events_url": "https://api.github.com/users/neilmcguigan/events{/privacy}", "received_events_url": "https://api.github.com/users/neilmcguigan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-11-02T20:48:38Z", "updated_at": "2022-02-16T18:22:12Z", "closed_at": "2022-02-16T18:22:12Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nCreate an SKLearn estimator. Call fit(). Works great. Repeat with local mode on. Fails\r\n\r\n**To reproduce**\r\n```\r\nfrom sagemaker.local import LocalSession\r\nfrom sagemaker.sklearn.estimator import SKLearn\r\n\r\nsagemaker_session = LocalSession()\r\nsagemaker_session.config = {'local': {'local_code': True}}\r\n\r\nrole = \"arn:aws:iam::123456789012:role/Foo\"\r\n\r\nestimator = SKLearn(\r\n    entry_point=\"foo.py\",\r\n    framework_version=\"0.23-1\",\r\n    role=role,\r\n    instance_count=1,\r\n    instance_type=\"local\"\r\n)\r\n\r\nestimator.fit()\r\n```\r\nThe above works without local mode.\r\nThe above fails in local mode with an obscure Docker compose error. \r\nIf you provide the absolute path to \"foo.py\" it works\r\n\r\n\r\n**Expected behavior**\r\nShould work with same code in local and remote mode\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: latest\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: sklearn\r\n- **Framework version**: 0.23-1\r\n- **Python version**: 3.x\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2747/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2747/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2700", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2700/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2700/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2700/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2700", "id": 1024957462, "node_id": "I_kwDOBpf0x849F5wW", "number": 2700, "title": "Image Uri generation for Hugging Face is broken ", "user": {"login": "philschmid", "id": 32632186, "node_id": "MDQ6VXNlcjMyNjMyMTg2", "avatar_url": "https://avatars.githubusercontent.com/u/32632186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/philschmid", "html_url": "https://github.com/philschmid", "followers_url": "https://api.github.com/users/philschmid/followers", "following_url": "https://api.github.com/users/philschmid/following{/other_user}", "gists_url": "https://api.github.com/users/philschmid/gists{/gist_id}", "starred_url": "https://api.github.com/users/philschmid/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/philschmid/subscriptions", "organizations_url": "https://api.github.com/users/philschmid/orgs", "repos_url": "https://api.github.com/users/philschmid/repos", "events_url": "https://api.github.com/users/philschmid/events{/privacy}", "received_events_url": "https://api.github.com/users/philschmid/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 3070286644, "node_id": "MDU6TGFiZWwzMDcwMjg2NjQ0", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/HuggingFace", "name": "HuggingFace", "color": "FBCA04", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2021-10-13T08:37:54Z", "updated_at": "2022-11-18T23:35:52Z", "closed_at": "2021-10-27T22:17:16Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**Describe the bug**\r\n i am getting an error saying\r\n`UnexpectedStatusException: Error hosting endpoint huggingface-pytorch-inference-2021-10-13-08-17-14-036: Failed. Reason:  The image '763104351884.dkr.ecr.us-east-1.amazonaws.com/huggingface-pytorch-inference:1.8.1-transformers4.10.2-gpu-py36-cu110-ubuntu18.04' does not exist..`\r\n\r\nwhen using the following code\r\n```python\r\nhuggingface_model = HuggingFaceModel(\r\n\ttransformers_version='4.10.2',\r\n\tpytorch_version='1.8.1',\r\n\tpy_version='py36',\r\n\tenv=hub,\r\n\trole=role, \r\n)\r\n```\r\nLooking at the release here: https://github.com/aws/deep-learning-containers/releases/tag/v1.0-hf-4.10.2-pt-1.8.1-py36\r\nI can see that the difference is cu110 to cu111\r\n\r\nI looked at the image_uri_config and it correctly contains cu111 https://github.com/aws/sagemaker-python-sdk/blob/82f1ba771ff158a946b68be008aad627fdfb53e3/src/sagemaker/image_uri_config/huggingface.json#L569\r\n\r\nIt is the same for pytorch 1.9 and transformers 4.11. But there is also the ubuntu version wrong.\r\n\r\nWhen using pytorch 1.9 and transformers 4.11 the sdk generates the following tag `1.9-transformers4.11-gpu-py38-cu110-ubuntu18.04`\r\nbut the correct one must include `cu111-ubuntu20.04`\r\n https://github.com/aws/sagemaker-python-sdk/blob/82f1ba771ff158a946b68be008aad627fdfb53e3/src/sagemaker/image_uri_config/huggingface.json#L775\r\n\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.62.0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: Hugging Face\r\n\r\ncc @ahsan-z-khan \r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2700/reactions", "total_count": 3, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 1}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2700/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2686", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2686/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2686/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2686/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2686", "id": 1015657938, "node_id": "I_kwDOBpf0x848ibXS", "number": 2686, "title": "Endpoint Deserializer doesn't work no matter what I do", "user": {"login": "JayThibs", "id": 19174440, "node_id": "MDQ6VXNlcjE5MTc0NDQw", "avatar_url": "https://avatars.githubusercontent.com/u/19174440?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JayThibs", "html_url": "https://github.com/JayThibs", "followers_url": "https://api.github.com/users/JayThibs/followers", "following_url": "https://api.github.com/users/JayThibs/following{/other_user}", "gists_url": "https://api.github.com/users/JayThibs/gists{/gist_id}", "starred_url": "https://api.github.com/users/JayThibs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JayThibs/subscriptions", "organizations_url": "https://api.github.com/users/JayThibs/orgs", "repos_url": "https://api.github.com/users/JayThibs/repos", "events_url": "https://api.github.com/users/JayThibs/events{/privacy}", "received_events_url": "https://api.github.com/users/JayThibs/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-10-04T21:35:42Z", "updated_at": "2021-10-06T03:07:18Z", "closed_at": "2021-10-06T03:07:17Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nAfter struggling to make the serializer work (because my images are too big when sent via JSON), I finally figured out how to send the data in numpy.ndarray for prediction. However, now I'm trying to send the data back after prediction and nothing I do seems to work. All errors I'm getting are similar to this:\r\n\r\n> TypeError: Object of type 'BytesIO' is not JSON serializable\r\n\r\nI get the 'numpy.ndarray' is not JSON serializable if I don't create buffer beforehand. Issues like this come up whether I use `NumpyDeserializer`, `JSONDeserializer` or `BytesDeserializer`. I just can't seem to get things in the right format. What's worse is that it's frustrating how I need to deploy and wait 10 minutes every new test I do...\r\n\r\nAnyways, the data comes from a semantic segmentation prediction of a model and it is basically an ndarray of shape (1, 2, 512, 512) with 0s and 1s. I tried converting it into a list and using `json.dumps`, I've tried storing the ndarray in `BytesIO()` with `np.save`, I've tried sending the array just as is or using `np.asarray(array_var)`; nothing seems to work.\r\n\r\nI don't know why JSON is even in the picture when I use `NumpyDeserializer`. But it runs the following line according to CloudWatch: `json_value = json.dumps(val, indent=2).encode(\"utf-8\")`\r\n\r\nIt may have to do with the encoding? But then again, it makes sense it's not JSON serializable since I'm outputting BytesIO or a numpy array. It should work if it was a list though...\r\n\r\n**Expected behavior**\r\nI get my prediction back as a numpy array. At this point I don't really care in what format I receive it in, I just want to get the output of my prediction as long as I can convert it back into its original shape.\r\n\r\n**System information**\r\n- **SageMaker Python SDK version**: 2.59.7\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: PyTorch 1.8.1.\r\n- **Framework version**: 1.8.1.\r\n- **Python version**: 3.6\r\n- **CPU or GPU**: ml.m4.xlarge\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional Information:**\r\n\r\nError message:\r\n\r\n```\r\n\r\n\r\n---------------------------------------------------------------------------\r\nModelError                                Traceback (most recent call last)\r\n<ipython-input-144-65f6749dd24c> in <module>\r\n----> 1 results = predictor.predict(x_arr)\r\n\r\n~/anaconda3/envs/pytorch_latest_p36/lib/python3.6/site-packages/sagemaker/predictor.py in predict(self, data, initial_args, target_model, target_variant, inference_id)\r\n    159             data, initial_args, target_model, target_variant, inference_id\r\n    160         )\r\n--> 161         response = self.sagemaker_session.sagemaker_runtime_client.invoke_endpoint(**request_args)\r\n    162         return self._handle_response(response)\r\n    163 \r\n\r\n~/anaconda3/envs/pytorch_latest_p36/lib/python3.6/site-packages/botocore/client.py in _api_call(self, *args, **kwargs)\r\n    384                     \"%s() only accepts keyword arguments.\" % py_operation_name)\r\n    385             # The \"self\" in this scope is referring to the BaseClient.\r\n--> 386             return self._make_api_call(operation_name, kwargs)\r\n    387 \r\n    388         _api_call.__name__ = str(py_operation_name)\r\n\r\n~/anaconda3/envs/pytorch_latest_p36/lib/python3.6/site-packages/botocore/client.py in _make_api_call(self, operation_name, api_params)\r\n    703             error_code = parsed_response.get(\"Error\", {}).get(\"Code\")\r\n    704             error_class = self.exceptions.from_code(error_code)\r\n--> 705             raise error_class(parsed_response, operation_name)\r\n    706         else:\r\n    707             return parsed_response\r\n\r\nModelError: An error occurred (ModelError) when calling the InvokeEndpoint operation: Received server error (503) from model with message \"{\r\n  \"code\": 503,\r\n  \"type\": \"InternalServerException\",\r\n  \"message\": \"Unsupported model output data type.\"\r\n}\r\n\". See https://us-east-1.console.aws.amazon.com/cloudwatch/home?region=us-east-1#logEventViewer:group=/aws/sagemaker/Endpoints/floodwater-tuning-211001-2300-002-99c3af83-2021-10-04-04-06-15 in account 034262493329 for more information.\r\n```\r\n\r\nCloudWatch Errors:\r\n\r\n```\r\n\r\n\r\n2021-10-04 04:21:03,693 [INFO ] W-9000-model_1-stdout MODEL_LOG -     json_value = json.dumps(val, indent=2).encode(\"utf-8\")\r\n--\r\n2021-10-04 04:21:03,696 [INFO ] W-9000-model_1-stdout MODEL_LOG -   File \"/opt/conda/lib/python3.6/json/__init__.py\", line 238, in dumps\r\n2021-10-04 04:21:03,696 [INFO ] W-9000-model_1-stdout MODEL_LOG -   File \"/opt/conda/lib/python3.6/json/encoder.py\", line 201, in encode\r\n2021-10-04 04:21:03,697 [INFO ] W-9000-model_1-stdout MODEL_LOG -   File \"/opt/conda/lib/python3.6/json/encoder.py\", line 437, in _iterencode\r\n2021-10-04 04:21:03,697 [INFO ] W-9000-model_1-stdout MODEL_LOG -   File \"/opt/conda/lib/python3.6/json/encoder.py\", line 180, in default\r\n2021-10-04 04:21:03,697 [INFO ] W-9000-model_1-stdout MODEL_LOG - TypeError: Object of type 'BytesIO' is not JSON serializable\r\n```", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2686/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2686/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2680", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2680/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2680/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2680/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2680", "id": 1012643152, "node_id": "I_kwDOBpf0x848W7VQ", "number": 2680, "title": "bug  label test", "user": {"login": "ahsan-z-khan", "id": 42346890, "node_id": "MDQ6VXNlcjQyMzQ2ODkw", "avatar_url": "https://avatars.githubusercontent.com/u/42346890?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ahsan-z-khan", "html_url": "https://github.com/ahsan-z-khan", "followers_url": "https://api.github.com/users/ahsan-z-khan/followers", "following_url": "https://api.github.com/users/ahsan-z-khan/following{/other_user}", "gists_url": "https://api.github.com/users/ahsan-z-khan/gists{/gist_id}", "starred_url": "https://api.github.com/users/ahsan-z-khan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ahsan-z-khan/subscriptions", "organizations_url": "https://api.github.com/users/ahsan-z-khan/orgs", "repos_url": "https://api.github.com/users/ahsan-z-khan/repos", "events_url": "https://api.github.com/users/ahsan-z-khan/events{/privacy}", "received_events_url": "https://api.github.com/users/ahsan-z-khan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-09-30T21:29:46Z", "updated_at": "2021-09-30T21:29:50Z", "closed_at": "2021-09-30T21:29:50Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "**Describe the bug**\r\nA clear and concise description of what the bug is.\r\n\r\n**To reproduce**\r\nA clear, step-by-step set of instructions to reproduce the bug.\r\n\r\n**Expected behavior**\r\nA clear and concise description of what you expected to happen.\r\n\r\n**Screenshots or logs**\r\nIf applicable, add screenshots or logs to help explain your problem.\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**:\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**:\r\n- **Framework version**:\r\n- **Python version**:\r\n- **CPU or GPU**:\r\n- **Custom Docker image (Y/N)**:\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2680/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2680/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2676", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2676/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2676/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2676/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2676", "id": 1011489075, "node_id": "I_kwDOBpf0x848Shkz", "number": 2676, "title": "Unnecessary session call while generating pipeline definition", "user": {"login": "vinitsheth", "id": 17501495, "node_id": "MDQ6VXNlcjE3NTAxNDk1", "avatar_url": "https://avatars.githubusercontent.com/u/17501495?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vinitsheth", "html_url": "https://github.com/vinitsheth", "followers_url": "https://api.github.com/users/vinitsheth/followers", "following_url": "https://api.github.com/users/vinitsheth/following{/other_user}", "gists_url": "https://api.github.com/users/vinitsheth/gists{/gist_id}", "starred_url": "https://api.github.com/users/vinitsheth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vinitsheth/subscriptions", "organizations_url": "https://api.github.com/users/vinitsheth/orgs", "repos_url": "https://api.github.com/users/vinitsheth/repos", "events_url": "https://api.github.com/users/vinitsheth/events{/privacy}", "received_events_url": "https://api.github.com/users/vinitsheth/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-09-29T22:08:43Z", "updated_at": "2022-03-18T22:29:12Z", "closed_at": "2022-03-18T22:29:12Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nUnnecessary session call to get `account_id` is made [here](https://github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/workflow/lambda_step.py#L157) which is not required. if `self.lambda_func.function_arn` is passed while creating [Lambda](https://github.com/aws/sagemaker-python-sdk/blob/558583e45c4d3f69c07aa2cb3c0a7f97617d8e77/src/sagemaker/lambda_helper.py#L25), the `account_id` obtained from the call is ignored. \r\n\r\nThis limits the usage of [Lambda Step](https://github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/workflow/lambda_step.py#L78) and aws credentials are required to be able to use this. \r\n\r\n**To reproduce**\r\n```\r\nimport boto3\r\nfrom sagemaker.lambda_helper import Lambda\r\nfrom sagemaker.session import Session\r\nfrom sagemaker.workflow.lambda_step import LambdaStep\r\nfrom sagemaker.workflow.pipeline import Pipeline\r\n\r\n\r\nregion_name = \"us-east-1\"\r\nboto_session = boto3.Session(region_name=region_name)\r\nsagemaker_session = Session(boto_session=boto_session)\r\nlambda_fun_arn = \"arn:aws:lambda:us-east-1:123456789123:function:some-lambda-fun\"\r\n\r\nstep_lambda = LambdaStep(\r\n    name=f\"Some-Lambda-Step\",\r\n    lambda_func=Lambda(function_arn=lambda_fun_arn, session=sagemaker_session)\r\n)\r\n\r\nmodel_pipeline = Pipeline(\r\n    name=f\"Some-ModelPipeline\",\r\n    steps=[step_lambda],\r\n    sagemaker_session=sagemaker_session\r\n)\r\nprint(model_pipeline.definition())\r\n\r\n```\r\n\r\n**Expected behavior**\r\nIt would be useful if this [session call](https://github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/workflow/lambda_step.py#L157) is moved inside of [this](https://github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/workflow/lambda_step.py#L164) if block. \r\n\r\n**Screenshots or logs**\r\n```\r\nbotocore.exceptions.NoCredentialsError: Unable to locate credentials\r\n```\r\n\r\n**Additional context**\r\nIn our use case we are only interested in generating [pipeline definition](https://github.com/aws/sagemaker-python-sdk/blob/558583e45c4d3f69c07aa2cb3c0a7f97617d8e77/src/sagemaker/workflow/pipeline.py#L255). All other [steps](https://github.com/aws/sagemaker-python-sdk/blob/558583e45c4d3f69c07aa2cb3c0a7f97617d8e77/src/sagemaker/workflow/steps.py#L61) allow generating pipeline definition without making any calls which would require aws credentials. \r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2676/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2676/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2666", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2666/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2666/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2666/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2666", "id": 1007549733, "node_id": "I_kwDOBpf0x848Df0l", "number": 2666, "title": "TuningStep does not copy inputs to multi-estimator Tuner", "user": {"login": "neilmcguigan", "id": 1829364, "node_id": "MDQ6VXNlcjE4MjkzNjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1829364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/neilmcguigan", "html_url": "https://github.com/neilmcguigan", "followers_url": "https://api.github.com/users/neilmcguigan/followers", "following_url": "https://api.github.com/users/neilmcguigan/following{/other_user}", "gists_url": "https://api.github.com/users/neilmcguigan/gists{/gist_id}", "starred_url": "https://api.github.com/users/neilmcguigan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/neilmcguigan/subscriptions", "organizations_url": "https://api.github.com/users/neilmcguigan/orgs", "repos_url": "https://api.github.com/users/neilmcguigan/repos", "events_url": "https://api.github.com/users/neilmcguigan/events{/privacy}", "received_events_url": "https://api.github.com/users/neilmcguigan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-09-27T00:20:49Z", "updated_at": "2022-02-08T17:42:32Z", "closed_at": "2022-02-08T17:42:05Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nCreate a Tuner. Create a TunerStep, and reference the tuner. The TunerStep inputs are used by the Tuner\r\n\r\nCreate a multi-estimator Tuner using HyperParameterTuner.create(). Create a TunerStep, and reference the tuner. The TunerStep inputs are NOT used by the tuners\r\n\r\n**To reproduce**\r\nCreate a multi-estimator Tuner using HyperParameterTuner.create(). Create a TunerStep, and reference the tuner. The TunerStep inputs are NOT used by the tuners\r\n\r\n**Expected behavior**\r\nThe tuner inputs are empty. I expect them to be filled with the TunerStep inputs\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: latest\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: linearlearner, knn, xgboost\r\n- **Python version**: 3\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2666/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2666/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2656", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2656/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2656/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2656/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2656", "id": 1005566439, "node_id": "I_kwDOBpf0x84777nn", "number": 2656, "title": "FrameworkProcessor is broken with SageMaker Pipelines", "user": {"login": "dgallitelli", "id": 9881522, "node_id": "MDQ6VXNlcjk4ODE1MjI=", "avatar_url": "https://avatars.githubusercontent.com/u/9881522?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dgallitelli", "html_url": "https://github.com/dgallitelli", "followers_url": "https://api.github.com/users/dgallitelli/followers", "following_url": "https://api.github.com/users/dgallitelli/following{/other_user}", "gists_url": "https://api.github.com/users/dgallitelli/gists{/gist_id}", "starred_url": "https://api.github.com/users/dgallitelli/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dgallitelli/subscriptions", "organizations_url": "https://api.github.com/users/dgallitelli/orgs", "repos_url": "https://api.github.com/users/dgallitelli/repos", "events_url": "https://api.github.com/users/dgallitelli/events{/privacy}", "received_events_url": "https://api.github.com/users/dgallitelli/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790729403, "node_id": "MDU6TGFiZWwyNzkwNzI5NDAz", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20processing", "name": "component: processing", "color": "62F992", "default": false, "description": "Relates to the SageMaker Processing Platform"}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 23, "created_at": "2021-09-23T15:24:48Z", "updated_at": "2022-12-19T20:15:25Z", "closed_at": "2022-12-19T20:15:25Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nTrying to use any Processor derived from FrameworkProcessor is bugged with SageMaker Pipelines. There is a problem with the `command` and `entrypoint` parameter, where `command` does not pass `python3`, causing the following error:\r\n\r\n> `line 2: import: command not found`\r\n\r\n**To reproduce**\r\n1. Create a FrameworkProcessor (i.e. PyTorchProcessor, TensorFlowProcessor)\r\n2. Create a ProcessingStep and a Pipeline\r\n3. Execute it\r\n4. See it fail\r\n\r\n**Expected behavior**\r\nThe pipeline should go through. \r\n\r\n**Screenshots or logs**\r\n\r\nScreenshot from Pipelines:\r\n![image](https://user-images.githubusercontent.com/9881522/134536113-dac8acd1-f195-4bd2-8fa0-e176cd03b45c.png)\r\n\r\nLogs from CloudWatch:\r\n```\r\n/opt/ml/processing/input/entrypoint/inference_with_processing.py: line 2: import: command not found\r\n/opt/ml/processing/input/entrypoint/inference_with_processing.py: line 3: import: command not found\r\n/opt/ml/processing/input/entrypoint/inference_with_processing.py: line 4: import: command not found\r\n/opt/ml/processing/input/entrypoint/inference_with_processing.py: line 5: import: command not found\r\n/opt/ml/processing/input/entrypoint/inference_with_processing.py: line 6: from: command not found\r\n```\r\n\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.57.0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: Every Framework\r\n- **Framework version**: Every version supported by SM\r\n- **Python version**: 3.8\r\n- **CPU or GPU**: CPU and GPU\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\nN/A\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2656/reactions", "total_count": 10, "+1": 9, "-1": 0, "laugh": 0, "hooray": 0, "confused": 1, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2656/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2647", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2647/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2647/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2647/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2647", "id": 1001580820, "node_id": "I_kwDOBpf0x847sukU", "number": 2647, "title": "local mode permission denied when file is written from running job to mounted volume", "user": {"login": "jmahlik", "id": 38999128, "node_id": "MDQ6VXNlcjM4OTk5MTI4", "avatar_url": "https://avatars.githubusercontent.com/u/38999128?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jmahlik", "html_url": "https://github.com/jmahlik", "followers_url": "https://api.github.com/users/jmahlik/followers", "following_url": "https://api.github.com/users/jmahlik/following{/other_user}", "gists_url": "https://api.github.com/users/jmahlik/gists{/gist_id}", "starred_url": "https://api.github.com/users/jmahlik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jmahlik/subscriptions", "organizations_url": "https://api.github.com/users/jmahlik/orgs", "repos_url": "https://api.github.com/users/jmahlik/repos", "events_url": "https://api.github.com/users/jmahlik/events{/privacy}", "received_events_url": "https://api.github.com/users/jmahlik/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-09-21T00:05:02Z", "updated_at": "2023-02-22T02:49:52Z", "closed_at": "2023-02-22T02:49:52Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**Describe the bug**\r\nPermission denied in local mode when files are created by the running job. This occurs on the `ProcessingOutput` volumes when attempting to clean up. The job doesn't exit cleanly.\r\n\r\nFix is here:\r\n\r\nhttps://github.com/aws/sagemaker-python-sdk/pull/3017\r\n\r\n**To reproduce**\r\nWrite a file to a mounted docker volume as a non-root user using local mode.\r\n\r\n**Expected behavior**\r\nTry except the error.\r\n\r\n**Screenshots or logs**\r\n```python \r\n---> 76     shutil.rmtree(source)\r\n     77     return final_uri\r\n...\r\nPermissionError: [Errno 13] Permission denied: 'myfile2.txt'\r\n\r\n```\r\n\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: latest\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: local mode\r\n- **Framework version**: n/a\r\n- **Python version**: python 3.9\r\n- **CPU or GPU**: cpu\r\n- **Custom Docker image (Y/N)**: Y\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n\r\n\r\n~local mode", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2647/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2647/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2627", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2627/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2627/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2627/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2627", "id": 993839705, "node_id": "MDU6SXNzdWU5OTM4Mzk3MDU=", "number": 2627, "title": "Sagemaker Pipelines CreateModelStep doesn't support tags", "user": {"login": "Will282", "id": 1675276, "node_id": "MDQ6VXNlcjE2NzUyNzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1675276?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Will282", "html_url": "https://github.com/Will282", "followers_url": "https://api.github.com/users/Will282/followers", "following_url": "https://api.github.com/users/Will282/following{/other_user}", "gists_url": "https://api.github.com/users/Will282/gists{/gist_id}", "starred_url": "https://api.github.com/users/Will282/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Will282/subscriptions", "organizations_url": "https://api.github.com/users/Will282/orgs", "repos_url": "https://api.github.com/users/Will282/repos", "events_url": "https://api.github.com/users/Will282/events{/privacy}", "received_events_url": "https://api.github.com/users/Will282/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790727032, "node_id": "MDU6TGFiZWwyNzkwNzI3MDMy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20hosting", "name": "component: hosting", "color": "01E1F7", "default": false, "description": "Relates to the SageMaker Hosting Platform"}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-09-11T13:17:03Z", "updated_at": "2022-05-13T16:24:41Z", "closed_at": "2022-05-13T16:24:41Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nThe `CreateModelStep` SM Pipelines step does not support a tags keyword argument and therefore cannot pass tags to the CreateModel API request that this step makes.\r\n\r\nWe use \"RequestTags\" and \"ResourceTags\" in our environment to enable attribute-based access control and with this issue, we are unable to properly secure models created via Sagemaker Pipelines\r\n\r\n**To reproduce**\r\nUse the CreateModelStep within a Sagemaker Pipeline with an execution role that has a \"RequestTag\" condition on the \"sagemaker:CreateModel\" action. \r\n\r\n**Expected behavior**\r\nIt should be possible to pass a keyword argument of \"tags\" to the `CreateModelStep` class so that when the step makes the \"CreateModel\" API request, it can pass the correct tags.\r\n\r\n**Screenshots or logs**\r\nN/A\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: v2.59.1\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: Any\r\n- **Framework version**: Any\r\n- **Python version**: 3.8\r\n- **CPU or GPU**: N/A\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\nN/A", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2627/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2627/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2623", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2623/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2623/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2623/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2623", "id": 991050486, "node_id": "MDU6SXNzdWU5OTEwNTA0ODY=", "number": 2623, "title": "bug in local mode docker-compose.yaml ", "user": {"login": "quetil", "id": 40307197, "node_id": "MDQ6VXNlcjQwMzA3MTk3", "avatar_url": "https://avatars.githubusercontent.com/u/40307197?v=4", "gravatar_id": "", "url": "https://api.github.com/users/quetil", "html_url": "https://github.com/quetil", "followers_url": "https://api.github.com/users/quetil/followers", "following_url": "https://api.github.com/users/quetil/following{/other_user}", "gists_url": "https://api.github.com/users/quetil/gists{/gist_id}", "starred_url": "https://api.github.com/users/quetil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/quetil/subscriptions", "organizations_url": "https://api.github.com/users/quetil/orgs", "repos_url": "https://api.github.com/users/quetil/repos", "events_url": "https://api.github.com/users/quetil/events{/privacy}", "received_events_url": "https://api.github.com/users/quetil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-09-08T11:51:26Z", "updated_at": "2022-02-16T18:22:20Z", "closed_at": "2022-02-16T18:22:20Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nWhen using the locale mode, under windows, the Estimator.fi() is not working.\r\n**To reproduce**\r\n```\r\nimport sagemaker\r\nfrom sagemaker.local import LocalSession\r\nsagemaker_session = LocalSession()\r\nsagemaker_session.config = {'local': {'local_code': True}}\r\ntf_estimator = TensorFlow(\r\n        # env\r\n        py_version='py37',\r\n        framework_version='2.4',\r\n\r\n        # instance\r\n        instance_count=1,\r\n        instance_type='local',\r\n\r\n        # job\r\n        base_job_name='test',\r\n        source_dir=r\"C:/Users/me/project/\",\r\n        entry_point=r\"C:/Users/me/project/train.py\",\r\n        role=role,\r\n        sagemaker_session = sagemaker_session,\r\n        script_mode=True,\r\n)\r\ntf_estimator.fit(r\"file://C:/Users/me/project/data\", wait=False)\r\n```\r\n\r\nbut the generated `docker-compose.yaml` file is not well written, in _volumes_ entry, one can see:\r\n    - C:\\Users\\me\\project\\data:/opt/ml/input/data/training\r\n    - /Users/me/project/:/opt/ml/code\r\n\r\nThe last line is not well written. I tried several ways:\r\n-  source_dir=\"C:/Users/me/project/\"\r\n-  source_dir=\"file://C:/Users/me/project/\"\r\n-  source_dir=\"file:///C:/Users/me/project/\"\r\n-  source_dir=r\"file://C:/Users/me/project/\"\r\n-  source_dir=r\"C:/Users/me/project/\"\r\n\r\nBut it doesn't work better.\r\n\r\n**EDIT**\r\nIt seems the origin of the error come from [`sagemaker.local.image._prepare_training_volumes()`](https://github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/local/image.py#L497) and the use of the `urllib.parse.urlparse()` function.\r\n\r\n```\r\ntraining_dir\r\nOut[2]: 'file://C:/Users/me/project/'\r\nurlparse(training_dir)\r\nOut[3]: ParseResult(scheme='file', netloc='C:', path='/Users/me/project/', params='', query='', fragment='')\r\n```\r\n\r\nAnd then, only the \"path\" key is written in the `docker-compose.yaml` file, which lead to an error because docker can't find `/Users/me/project/` the `C:` is missing.\r\n\r\nAny workaround in mind? I fixed it for my use case with:\r\n`volumes.append(_Volume(parsed_uri.netloc+parsed_uri.path, \"/opt/ml/code\"))` instead of `volumes.append(_Volume(parsed_uri.path, \"/opt/ml/code\"))` but without knowing the side effect.\r\n\r\n\r\n**Expected behavior**\r\nTo write correctly the docker-compose.yaml and to launch the training.\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.59.1\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: Tensorflow\r\n- **Framework version**: 2.4\r\n- **Python version**: 3.7\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\nDocker image: 763104351884.dkr.ecr.eu-west-1.amazonaws.com/tensorflow-training   (2.4-cpu-py37)\r\n\r\nThank you for your help !", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2623/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2623/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2611", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2611/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2611/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2611/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2611", "id": 984268774, "node_id": "MDU6SXNzdWU5ODQyNjg3NzQ=", "number": 2611, "title": "Version 2.58.0 Does Not Specify `psutil` as a Dependency", "user": {"login": "parsons-kyle-89", "id": 31140928, "node_id": "MDQ6VXNlcjMxMTQwOTI4", "avatar_url": "https://avatars.githubusercontent.com/u/31140928?v=4", "gravatar_id": "", "url": "https://api.github.com/users/parsons-kyle-89", "html_url": "https://github.com/parsons-kyle-89", "followers_url": "https://api.github.com/users/parsons-kyle-89/followers", "following_url": "https://api.github.com/users/parsons-kyle-89/following{/other_user}", "gists_url": "https://api.github.com/users/parsons-kyle-89/gists{/gist_id}", "starred_url": "https://api.github.com/users/parsons-kyle-89/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/parsons-kyle-89/subscriptions", "organizations_url": "https://api.github.com/users/parsons-kyle-89/orgs", "repos_url": "https://api.github.com/users/parsons-kyle-89/repos", "events_url": "https://api.github.com/users/parsons-kyle-89/events{/privacy}", "received_events_url": "https://api.github.com/users/parsons-kyle-89/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-08-31T20:09:33Z", "updated_at": "2021-09-01T21:10:32Z", "closed_at": "2021-09-01T21:10:32Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nIn version 2.58.0 `import sagemaker` will fail if you don't also install `psutil` which will not be installed by `python -m pip install 'sagemaker==2.58.0'`\r\n\r\n**To reproduce**\r\nCreate venv, install `sagemaker`, and try to import it.\r\n```\r\n$ python -m venv .venv\r\n$ source .venv/bin/activate\r\n$ python -m pip install sagemaker==2.58.0\r\n$ python -c \"import sagemaker\"\r\n...\r\nModuleNotFoundError: No module named 'psutil'\r\n```\r\n\r\n**Expected behavior**\r\nSagemaker should import without error.\r\n\r\n**Screenshots or logs**\r\n```\r\n$ python -c \"import sagemaker\"\r\nTraceback (most recent call last):\r\n  File \"<string>\", line 1, in <module>\r\n  File \"~/code/sagemaker/.venv/lib/python3.7/site-packages/sagemaker/__init__.py\", line 18, in <module>\r\n    from sagemaker import estimator, parameter, tuner  # noqa: F401\r\n  File \"~/code/sagemaker/.venv/lib/python3.7/site-packages/sagemaker/estimator.py\", line 28, in <module>\r\n    from sagemaker import git_utils, image_uris\r\n  File \"~/code/sagemaker/.venv/lib/python3.7/site-packages/sagemaker/image_uris.py\", line 22, in <module>\r\n    from sagemaker.spark import defaults\r\n  File \"~/code/sagemaker/.venv/lib/python3.7/site-packages/sagemaker/spark/__init__.py\", line 16, in <module>\r\n    from sagemaker.spark.processing import PySparkProcessor, SparkJarProcessor  # noqa: F401\r\n  File \"~/code/sagemaker/.venv/lib/python3.7/site-packages/sagemaker/spark/processing.py\", line 35, in <module>\r\n    from sagemaker.local.image import _ecr_login_if_needed, _pull_image\r\n  File \"~/code/sagemaker/.venv/lib/python3.7/site-packages/sagemaker/local/__init__.py\", line 16, in <module>\r\n    from .local_session import (  # noqa: F401\r\n  File \"~/code/sagemaker/.venv/lib/python3.7/site-packages/sagemaker/local/local_session.py\", line 23, in <module>\r\n    from sagemaker.local.image import _SageMakerContainer\r\n  File \"~/code/sagemaker/.venv/lib/python3.7/site-packages/sagemaker/local/image.py\", line 37, in <module>\r\n    import psutil\r\nModuleNotFoundError: No module named 'psutil'\r\n```\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.58.0\r\n- **Python version**: 3.7.3\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\nAppears caused by #2572 .  `psutil` is added as a local requirement and then by extension a test requirement but not as a base requirement.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2611/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2611/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2586", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2586/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2586/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2586/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/pull/2586", "id": 974806954, "node_id": "MDExOlB1bGxSZXF1ZXN0NzE2MDU5NjAy", "number": 2586, "title": "fix: pass network isolation config to pipelineModel", "user": {"login": "shreyapandit", "id": 836757, "node_id": "MDQ6VXNlcjgzNjc1Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/836757?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shreyapandit", "html_url": "https://github.com/shreyapandit", "followers_url": "https://api.github.com/users/shreyapandit/followers", "following_url": "https://api.github.com/users/shreyapandit/following{/other_user}", "gists_url": "https://api.github.com/users/shreyapandit/gists{/gist_id}", "starred_url": "https://api.github.com/users/shreyapandit/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shreyapandit/subscriptions", "organizations_url": "https://api.github.com/users/shreyapandit/orgs", "repos_url": "https://api.github.com/users/shreyapandit/repos", "events_url": "https://api.github.com/users/shreyapandit/events{/privacy}", "received_events_url": "https://api.github.com/users/shreyapandit/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-08-19T15:47:31Z", "updated_at": "2021-08-19T19:18:11Z", "closed_at": "2021-08-19T19:14:22Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/pulls/2586", "html_url": "https://github.com/aws/sagemaker-python-sdk/pull/2586", "diff_url": "https://github.com/aws/sagemaker-python-sdk/pull/2586.diff", "patch_url": "https://github.com/aws/sagemaker-python-sdk/pull/2586.patch", "merged_at": "2021-08-19T19:14:22Z"}, "body": "*Issue #, if available:*\r\nhttps://tiny.amazon.com/1ia05f0b2\r\n\r\n*Description of changes:*\r\nWe recently fixed passing network isolation while creating a model (#2553), this propagates it further to PipelineModel which also requires it.\r\n\r\n\r\n## Merge Checklist\r\n\r\n_Put an `x` in the boxes that apply. You can also fill these out after creating the PR. If you're unsure about any of them, don't hesitate to ask. We're here to help! This is simply a reminder of what we are going to look for before merging your pull request._\r\n\r\n#### General\r\n\r\n- [x] I have read the [CONTRIBUTING](https://github.com/aws/sagemaker-python-sdk/blob/master/CONTRIBUTING.md) doc\r\n- [x] I used the commit message format described in [CONTRIBUTING](https://github.com/aws/sagemaker-python-sdk/blob/master/CONTRIBUTING.md#committing-your-change)\r\n- [ ] I have passed the region in to all S3 and STS clients that I've initialized as part of this change.\r\n- [ ] I have updated any necessary documentation, including [READMEs](https://github.com/aws/sagemaker-python-sdk/blob/master/README.rst) and [API docs](https://github.com/aws/sagemaker-python-sdk/tree/master/doc) (if appropriate)\r\n\r\n#### Tests\r\n\r\n- [x] I have added tests that prove my fix is effective or that my feature works (if appropriate)\r\n- [ ] I have checked that my tests are not configured for a specific region or account (if appropriate)\r\n- [ ] I have used [`unique_name_from_base`](https://github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/utils.py#L77) to create resource names in integ tests (if appropriate)\r\n\r\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2586/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2586/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2549", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2549/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2549/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2549/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2549", "id": 958941799, "node_id": "MDU6SXNzdWU5NTg5NDE3OTk=", "number": 2549, "title": "TransformStep in Pipelines mishandling source_dir attribute (PyTorch/Script Mode)", "user": {"login": "marianokamp", "id": 3245189, "node_id": "MDQ6VXNlcjMyNDUxODk=", "avatar_url": "https://avatars.githubusercontent.com/u/3245189?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marianokamp", "html_url": "https://github.com/marianokamp", "followers_url": "https://api.github.com/users/marianokamp/followers", "following_url": "https://api.github.com/users/marianokamp/following{/other_user}", "gists_url": "https://api.github.com/users/marianokamp/gists{/gist_id}", "starred_url": "https://api.github.com/users/marianokamp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marianokamp/subscriptions", "organizations_url": "https://api.github.com/users/marianokamp/orgs", "repos_url": "https://api.github.com/users/marianokamp/repos", "events_url": "https://api.github.com/users/marianokamp/events{/privacy}", "received_events_url": "https://api.github.com/users/marianokamp/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": {"login": "jerrypeng7773", "id": 50377760, "node_id": "MDQ6VXNlcjUwMzc3NzYw", "avatar_url": "https://avatars.githubusercontent.com/u/50377760?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jerrypeng7773", "html_url": "https://github.com/jerrypeng7773", "followers_url": "https://api.github.com/users/jerrypeng7773/followers", "following_url": "https://api.github.com/users/jerrypeng7773/following{/other_user}", "gists_url": "https://api.github.com/users/jerrypeng7773/gists{/gist_id}", "starred_url": "https://api.github.com/users/jerrypeng7773/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jerrypeng7773/subscriptions", "organizations_url": "https://api.github.com/users/jerrypeng7773/orgs", "repos_url": "https://api.github.com/users/jerrypeng7773/repos", "events_url": "https://api.github.com/users/jerrypeng7773/events{/privacy}", "received_events_url": "https://api.github.com/users/jerrypeng7773/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "jerrypeng7773", "id": 50377760, "node_id": "MDQ6VXNlcjUwMzc3NzYw", "avatar_url": "https://avatars.githubusercontent.com/u/50377760?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jerrypeng7773", "html_url": "https://github.com/jerrypeng7773", "followers_url": "https://api.github.com/users/jerrypeng7773/followers", "following_url": "https://api.github.com/users/jerrypeng7773/following{/other_user}", "gists_url": "https://api.github.com/users/jerrypeng7773/gists{/gist_id}", "starred_url": "https://api.github.com/users/jerrypeng7773/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jerrypeng7773/subscriptions", "organizations_url": "https://api.github.com/users/jerrypeng7773/orgs", "repos_url": "https://api.github.com/users/jerrypeng7773/repos", "events_url": "https://api.github.com/users/jerrypeng7773/events{/privacy}", "received_events_url": "https://api.github.com/users/jerrypeng7773/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2021-08-03T09:56:01Z", "updated_at": "2022-05-25T17:36:40Z", "closed_at": "2022-05-13T01:07:13Z", "author_association": "NONE", "active_lock_reason": null, "body": "When creating a Transform the `source_dir` attribute that points to the local directory containing the source is used to pack up the sources, put them onto S3 and when the Transform is executed, it uses that code that has been transferred from the S3 location to the running Transform container.\r\n\r\nThis works with the SDK directly, but not with SM Pipelines. Here `source_dir` and the consequent upload of the source is not handled properly.\r\n\r\n### What is working? \r\n_(Plain use of SDK to instantiate model and transfomer)_\r\n\r\n```\r\npytorch_model = PyTorchModel(model_data=model_url,\r\n                             role=role,\r\n                             py_version='py3',\r\n                             framework_version='1.8',\r\n                             source_dir='.',\r\n                             entry_point='inference.py')\r\n\r\npytorch_transformer = pytorch_model.transformer(instance_type='ml.g4dn.xlarge', \\\r\n                                                instance_count=1,\\\r\n                                                accept='text/csv',\\\r\n                                                output_path=[..],\\\r\n                                                env={[..]})\r\n```\r\n\r\nThis is working in the SDK. The source dir is packaged up, transfered to S3 and also the resulting model contains the property: `SAGEMAKER_SUBMIT_DIRECTORY = s3://.../model.tar.gz`\r\n\r\nOutput of a describe-model and inspection of the tar ball:\r\n\r\n```\r\naws sagemaker describe-model --model-name pytorch-inference-2021-07-28-19-50-16-101\r\n{\r\n    \"ModelName\": \"pytorch-inference-2021-07-28-19-50-16-101\",\r\n    \"PrimaryContainer\": {\r\n        \"Image\": \"763104351884.dkr.ecr.eu-west-1.amazonaws.com/pytorch-inference:1.8-gpu-py3\",\r\n        \"Mode\": \"SingleModel\",\r\n        \"ModelDataUrl\": \"s3://sagemaker-eu-west-1-XXX/pytorch-inference-2021-07-28-19-43-05-552/model.tar.gz\",\r\n        \"Environment\": {\r\n            \"SAGEMAKER_CONTAINER_LOG_LEVEL\": \"20\",\r\n            \"SAGEMAKER_PROGRAM\": \"inference.py\",\r\n            \"SAGEMAKER_REGION\": \"eu-west-1\",\r\n            \"SAGEMAKER_SUBMIT_DIRECTORY\": \"s3://sagemaker-eu-west-1-XXX/pytorch-inference-2021-07-28-19-43-05-552/model.tar.gz\"\r\n        }\r\n    },\r\n    \"ExecutionRoleArn\": \"arn:aws:iam::XXX:role/service-role/AmazonSageMaker-ExecutionRole-20191105T200284\",\r\n    \"CreationTime\": \"2021-07-28T21:50:16.627000+02:00\",\r\n    \"ModelArn\": \"arn:aws:sagemaker:eu-west-1:XXX:model/pytorch-inference-2021-07-28-19-50-16-101\",\r\n    \"EnableNetworkIsolation\": false\r\n}\r\n\r\naws s3 cp s3://sagemaker-eu-west-1-XXX/pytorch-inference-2021-07-28-19-43-05-552/model.tar.gz /tmp/m.tgz\r\ntar -tf /tmp/m.tgz\r\n/\r\nargs_init.pth\r\nclasses.pth\r\ncode\r\n[..]\r\ncode/inference.py\r\n[..]\r\nmodel.pth\r\ntraining_state.pth\r\n```\r\n^^^ Please recognize the existence of `code/inference.py` and see the `SAGEMAKER_SUBMIT_DIRECTORY`.\r\n\r\n### What is not working?\r\n_(Equivalent steps with SM Pipelines)_\r\n\r\n```\r\npytorch_model = PyTorchModel(model_data=model_url,\r\n                             role=role,\r\n                             py_version='py3',\r\n                             framework_version='1.8',\r\n                             source_dir='.',\r\n                             entry_point='inference.py') # same as above\r\n\r\nmodel_input = CreateModelInput(instance_type=estimator.instance_type)\r\n\r\ncreate_model_step = \\\r\n            CreateModelStep(name=f'create-model-{model_name}',\r\n                            model=model,\r\n                            inputs=model_input)\r\n\r\ntransformer = Transformer(\r\n    model_name=create_finetuned_model_step.properties.ModelName,\r\n    instance_type='ml.g4dn.xlarge',\r\n    instance_count=1,\r\n    output_path=[..],\r\n    env={'SAGEMAKER_MODEL_SERVER_TIMEOUT' : '3600' },\r\n    accept='text/csv'\r\n)\r\n\r\ntransform_step = TransformStep(\r\n    name='create-pseudo-labeles',\r\n    transformer=transformer,\r\n    inputs=TransformInput(data=[..],\r\n                          split_type='Line',\r\n                          content_type='text/csv'))\r\n\r\n```\r\n\r\nWhen running the Transform  I get the dreaded `Please provide a model_fn implementation` error. \r\n\r\nThe main difference seems to be that the `SAGEMAKER_SUBMIT_DIRECTORY` property has not been updated to `s3://.../model.tar.gz` as in the working case above, but shows the local path `file://.`. And the tarball does not contain the inference code.\r\n\r\nFull output:\r\n```\r\n\r\naws sagemaker describe-model --model-name pipelines-dk7q607at2b1-create-model-lstm-YuGjeljWaM\r\n{\r\n    \"ModelName\": \"pipelines-dk7q607at2b1-create-model-lstm-YuGjeljWaM\",\r\n    \"PrimaryContainer\": {\r\n        \"Image\": \"763104351884.dkr.ecr.eu-west-1.amazonaws.com/pytorch-inference:1.8-gpu-py3\",\r\n        \"Mode\": \"SingleModel\",\r\n        \"ModelDataUrl\": \"s3://sagemaker-eu-west-1-XXX/pipelines-dk7q607at2b1-train-lstm-yKvVNN1ZA2/output/model.tar.gz\",\r\n        \"Environment\": {\r\n            \"SAGEMAKER_CONTAINER_LOG_LEVEL\": \"20\",\r\n            \"SAGEMAKER_PROGRAM\": \"inference.py\",\r\n            \"SAGEMAKER_REGION\": \"eu-west-1\",\r\n            \"SAGEMAKER_SUBMIT_DIRECTORY\": \"file://.\"\r\n        }\r\n    },\r\n    \"ExecutionRoleArn\": \"arn:aws:iam::XXX:role/service-role/AmazonSageMaker-ExecutionRole-20191105T200284\",\r\n    \"CreationTime\": \"2021-08-03T12:12:50.553000+02:00\",\r\n    \"ModelArn\": \"arn:aws:sagemaker:eu-west-1:XXX:model/pipelines-dk7q607at2b1-create-model-lstm-yugjeljwam\",\r\n    \"EnableNetworkIsolation\": false\r\n}\r\naws s3 cp s3://sagemaker-eu-west-1-XXX/pipelines-dk7q607at2b1-train-lstm-yKvVNN1ZA2/output/model.tar.gz /tmp/m.tgz\r\ntar -tf /tmp/m.tgz\r\nmodel.pth\r\nargs_init.pth\r\ntraining_state.pth\r\nclasses.pth\r\ntokenizer.pth\r\n\r\n```\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.49.2\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: PyTorch\r\n- **Framework version**: 1.8\r\n- **Python version**: 3.8.3\r\n- **CPU or GPU**: GPU\r\n- **Custom Docker image (Y/N)**: N\r\n\r\nYou can slack me for details, I am mkamp@.", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2549/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2549/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2533", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2533/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2533/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2533/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/pull/2533", "id": 950285498, "node_id": "MDExOlB1bGxSZXF1ZXN0Njk0ODU2OTE4", "number": 2533, "title": "fix: update `sagemaker.serverless` integration test", "user": {"login": "bveeramani", "id": 26107013, "node_id": "MDQ6VXNlcjI2MTA3MDEz", "avatar_url": "https://avatars.githubusercontent.com/u/26107013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bveeramani", "html_url": "https://github.com/bveeramani", "followers_url": "https://api.github.com/users/bveeramani/followers", "following_url": "https://api.github.com/users/bveeramani/following{/other_user}", "gists_url": "https://api.github.com/users/bveeramani/gists{/gist_id}", "starred_url": "https://api.github.com/users/bveeramani/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bveeramani/subscriptions", "organizations_url": "https://api.github.com/users/bveeramani/orgs", "repos_url": "https://api.github.com/users/bveeramani/repos", "events_url": "https://api.github.com/users/bveeramani/events{/privacy}", "received_events_url": "https://api.github.com/users/bveeramani/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 3175477686, "node_id": "MDU6TGFiZWwzMTc1NDc3Njg2", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/serverless", "name": "serverless", "color": "0E5591", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": {"login": "bveeramani", "id": 26107013, "node_id": "MDQ6VXNlcjI2MTA3MDEz", "avatar_url": "https://avatars.githubusercontent.com/u/26107013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bveeramani", "html_url": "https://github.com/bveeramani", "followers_url": "https://api.github.com/users/bveeramani/followers", "following_url": "https://api.github.com/users/bveeramani/following{/other_user}", "gists_url": "https://api.github.com/users/bveeramani/gists{/gist_id}", "starred_url": "https://api.github.com/users/bveeramani/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bveeramani/subscriptions", "organizations_url": "https://api.github.com/users/bveeramani/orgs", "repos_url": "https://api.github.com/users/bveeramani/repos", "events_url": "https://api.github.com/users/bveeramani/events{/privacy}", "received_events_url": "https://api.github.com/users/bveeramani/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "bveeramani", "id": 26107013, "node_id": "MDQ6VXNlcjI2MTA3MDEz", "avatar_url": "https://avatars.githubusercontent.com/u/26107013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bveeramani", "html_url": "https://github.com/bveeramani", "followers_url": "https://api.github.com/users/bveeramani/followers", "following_url": "https://api.github.com/users/bveeramani/following{/other_user}", "gists_url": "https://api.github.com/users/bveeramani/gists{/gist_id}", "starred_url": "https://api.github.com/users/bveeramani/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bveeramani/subscriptions", "organizations_url": "https://api.github.com/users/bveeramani/orgs", "repos_url": "https://api.github.com/users/bveeramani/repos", "events_url": "https://api.github.com/users/bveeramani/events{/privacy}", "received_events_url": "https://api.github.com/users/bveeramani/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 92, "created_at": "2021-07-22T04:15:20Z", "updated_at": "2021-08-04T23:03:00Z", "closed_at": "2021-08-04T23:02:59Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/pulls/2533", "html_url": "https://github.com/aws/sagemaker-python-sdk/pull/2533", "diff_url": "https://github.com/aws/sagemaker-python-sdk/pull/2533.diff", "patch_url": "https://github.com/aws/sagemaker-python-sdk/pull/2533.patch", "merged_at": "2021-08-04T23:02:59Z"}, "body": "*Issue #, if available:*\r\n\r\n*Description of changes:*\r\n`\"CODEBUILD_BUILD_ID\" not in os.environ` was evaluating `True` during builds, so the test was getting skipped.\r\n\r\nMade two fixes:\r\n- Stored cat image in S3 (it was previously hosted at some third-party website)\r\n- Changed the condition for skipping the test\r\n\r\nNote that this branch is based on the branch `bveeramani:rename-delete-endpoint`. See #2529.\r\n\r\n*Testing done:*\r\nIntegration test.\r\n\r\n## Merge Checklist\r\n\r\n_Put an `x` in the boxes that apply. You can also fill these out after creating the PR. If you're unsure about any of them, don't hesitate to ask. We're here to help! This is simply a reminder of what we are going to look for before merging your pull request._\r\n\r\n#### General\r\n\r\n- [x] I have read the [CONTRIBUTING](https://github.com/aws/sagemaker-python-sdk/blob/master/CONTRIBUTING.md) doc\r\n- [x] I used the commit message format described in [CONTRIBUTING](https://github.com/aws/sagemaker-python-sdk/blob/master/CONTRIBUTING.md#committing-your-change)\r\n- [ ] I have passed the region in to all S3 and STS clients that I've initialized as part of this change.\r\n- [ ] I have updated any necessary documentation, including [READMEs](https://github.com/aws/sagemaker-python-sdk/blob/master/README.rst) and [API docs](https://github.com/aws/sagemaker-python-sdk/tree/master/doc) (if appropriate)\r\n\r\n#### Tests\r\n\r\n- [x] I have added tests that prove my fix is effective or that my feature works (if appropriate)\r\n- [ ] I have checked that my tests are not configured for a specific region or account (if appropriate)\r\n- [x] I have used [`unique_name_from_base`](https://github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/utils.py#L77) to create resource names in integ tests (if appropriate)\r\n\r\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2533/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2533/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2472", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2472/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2472/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2472/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2472", "id": 924719217, "node_id": "MDU6SXNzdWU5MjQ3MTkyMTc=", "number": 2472, "title": "Sagemaker pipelines with script-mode Tensorflow + `source_dir`", "user": {"login": "stephenhunter-mdfwork", "id": 54841723, "node_id": "MDQ6VXNlcjU0ODQxNzIz", "avatar_url": "https://avatars.githubusercontent.com/u/54841723?v=4", "gravatar_id": "", "url": "https://api.github.com/users/stephenhunter-mdfwork", "html_url": "https://github.com/stephenhunter-mdfwork", "followers_url": "https://api.github.com/users/stephenhunter-mdfwork/followers", "following_url": "https://api.github.com/users/stephenhunter-mdfwork/following{/other_user}", "gists_url": "https://api.github.com/users/stephenhunter-mdfwork/gists{/gist_id}", "starred_url": "https://api.github.com/users/stephenhunter-mdfwork/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/stephenhunter-mdfwork/subscriptions", "organizations_url": "https://api.github.com/users/stephenhunter-mdfwork/orgs", "repos_url": "https://api.github.com/users/stephenhunter-mdfwork/repos", "events_url": "https://api.github.com/users/stephenhunter-mdfwork/events{/privacy}", "received_events_url": "https://api.github.com/users/stephenhunter-mdfwork/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": {"login": "jerrypeng7773", "id": 50377760, "node_id": "MDQ6VXNlcjUwMzc3NzYw", "avatar_url": "https://avatars.githubusercontent.com/u/50377760?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jerrypeng7773", "html_url": "https://github.com/jerrypeng7773", "followers_url": "https://api.github.com/users/jerrypeng7773/followers", "following_url": "https://api.github.com/users/jerrypeng7773/following{/other_user}", "gists_url": "https://api.github.com/users/jerrypeng7773/gists{/gist_id}", "starred_url": "https://api.github.com/users/jerrypeng7773/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jerrypeng7773/subscriptions", "organizations_url": "https://api.github.com/users/jerrypeng7773/orgs", "repos_url": "https://api.github.com/users/jerrypeng7773/repos", "events_url": "https://api.github.com/users/jerrypeng7773/events{/privacy}", "received_events_url": "https://api.github.com/users/jerrypeng7773/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "jerrypeng7773", "id": 50377760, "node_id": "MDQ6VXNlcjUwMzc3NzYw", "avatar_url": "https://avatars.githubusercontent.com/u/50377760?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jerrypeng7773", "html_url": "https://github.com/jerrypeng7773", "followers_url": "https://api.github.com/users/jerrypeng7773/followers", "following_url": "https://api.github.com/users/jerrypeng7773/following{/other_user}", "gists_url": "https://api.github.com/users/jerrypeng7773/gists{/gist_id}", "starred_url": "https://api.github.com/users/jerrypeng7773/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jerrypeng7773/subscriptions", "organizations_url": "https://api.github.com/users/jerrypeng7773/orgs", "repos_url": "https://api.github.com/users/jerrypeng7773/repos", "events_url": "https://api.github.com/users/jerrypeng7773/events{/privacy}", "received_events_url": "https://api.github.com/users/jerrypeng7773/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 5, "created_at": "2021-06-18T09:25:50Z", "updated_at": "2022-05-18T17:09:28Z", "closed_at": "2022-05-18T17:09:28Z", "author_association": "NONE", "active_lock_reason": null, "body": "**What did you find confusing? Please describe.**\r\nWhen running SageMaker Pipelines containing a script-mode Tensorflow training job, where the model script and a `requirements.txt` file are provided in a subfolder as specified by `source_dir`, I was able to run everything fine when starting a Pipeline run via the SageMaker Studio environment. However, when committing the code to the `main` branch of the project, the automated CI/CD in Codebuild fails to find the `source_dir` because it is not packaged. Not being a devops engineer, not having any CI/CD experience, and being a bit ignorant about how Python packages are built with setuptools, I did not know how to fix this and I could not find any documentation to point me in the right direction. Eventually I figured out how to fix it:\r\n\r\n- Include an `__init__.py` in the `source_dir` folder so that the `source_dir` folder is packaged. This alone is not enough if a `requirements.txt` file is also provided, so the following step is also needed to include that.\r\n- Change `setup.py` by adding a `package_data` argument to `setuptools.setup()` as below, where `src` is the `source_dir` provided in a subfolder of `my_pipeline`:\r\n\r\n```\r\n...\r\n    packages=setuptools.find_packages(),\r\n    include_package_data=True,\r\n    package_data={\"pipelines.my_pipeline.src\": [\"*.txt\"]},\r\n    python_requires=\">=3.6\",\r\n    install_requires=required_packages,\r\n    extras_require=extras,\r\n...\r\n```\r\n\r\nThe above makes sure that the `requirements.txt` file is packaged and thus found by the training job.\r\n\r\n**Describe how documentation can be improved**\r\nFor people without DevOps experience, perhaps some more context in the template notebook of the generated SageMaker projects would be useful. Currently, when looking at the `pipelines` description in the `sagemaker-pipelines-project.ipynb` notebook, it says:\r\n\r\n\"\r\n\r\nYour pipeline artifacts, which includes a pipeline module defining the required `get_pipeline` method that returns an instance of a SageMaker pipeline, a preprocessing script that is used in feature engineering, and a model evaluation script to measure the Mean Squared Error of the model that's trained by the pipeline:\r\n\r\n```\r\n|-- pipelines\r\n|   |-- abalone\r\n|   |   |-- evaluate.py\r\n|   |   |-- __init__.py\r\n|   |   |-- pipeline.py\r\n|   |   `-- preprocess.py\r\n\r\n```\r\n\r\n\"\r\n\r\nPerhaps it would be valuable to just add a note here along the lines of:\r\n\r\n\"For additional subfolders with code and/or artifacts needed by your pipeline to be visible by pipeline jobs started in Codebuild, they need to be packaged correctly by the `setup.py` file. For example ... \",  etc.\r\n\r\n**Additional context**\r\nn/a\r\n\r\nThanks for looking at this issue. I appreciate any feedback :)", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2472/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2472/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2443", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2443/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2443/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2443/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2443", "id": 919576928, "node_id": "MDU6SXNzdWU5MTk1NzY5Mjg=", "number": 2443, "title": "get_execution_role fails on Studio", "user": {"login": "harusametime", "id": 10037251, "node_id": "MDQ6VXNlcjEwMDM3MjUx", "avatar_url": "https://avatars.githubusercontent.com/u/10037251?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harusametime", "html_url": "https://github.com/harusametime", "followers_url": "https://api.github.com/users/harusametime/followers", "following_url": "https://api.github.com/users/harusametime/following{/other_user}", "gists_url": "https://api.github.com/users/harusametime/gists{/gist_id}", "starred_url": "https://api.github.com/users/harusametime/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harusametime/subscriptions", "organizations_url": "https://api.github.com/users/harusametime/orgs", "repos_url": "https://api.github.com/users/harusametime/repos", "events_url": "https://api.github.com/users/harusametime/events{/privacy}", "received_events_url": "https://api.github.com/users/harusametime/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2021-06-12T14:40:43Z", "updated_at": "2021-06-25T12:55:48Z", "closed_at": "2021-06-25T12:55:48Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**Describe the bug**\r\nPerforming `get_execution_role` on SageMaker Studio raises `KeyError: 'UserSettings'` with SageMaker Python SDK >= 2.45.0. This does not happen on classic notebook instance and some Studio image with  SageMaker Python SDK <2.45.0; for example,`MXNet 1.6 Python 3.6 CPU` image uses version 2.28.0 as of June 12, and can perform `get_execution_role` successfully.\r\n\r\n**To reproduce**\r\n1. Create notebook using image with SageMaker Python SDK >= 2.45.0, such as `Data Science`.\r\n2. Call get `get_execution_role`\r\n\r\n**Expected behavior**\r\nWe can get role ARN without error.\r\n\r\n\r\n**Screenshots or logs**\r\nIf applicable, add screenshots or logs to help explain your problem.\r\n\r\n<img width=\"763\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2021-06-12 23 32 15\" src=\"https://user-images.githubusercontent.com/10037251/121779621-94376e80-cbd7-11eb-92ff-2557f8343b9c.png\">\r\n\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: >= 2.45.0.\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: \r\n- **Framework version**:\r\n- **Python version**:\r\n- **CPU or GPU**:\r\n- **Custom Docker image (Y/N)**:\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2443/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2443/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2442", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2442/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2442/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2442/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2442", "id": 919300172, "node_id": "MDU6SXNzdWU5MTkzMDAxNzI=", "number": 2442, "title": "Cannot use SSH URL to point to a private GitHub repo containing a custom inference script when deploying a model", "user": {"login": "e13h", "id": 12199891, "node_id": "MDQ6VXNlcjEyMTk5ODkx", "avatar_url": "https://avatars.githubusercontent.com/u/12199891?v=4", "gravatar_id": "", "url": "https://api.github.com/users/e13h", "html_url": "https://github.com/e13h", "followers_url": "https://api.github.com/users/e13h/followers", "following_url": "https://api.github.com/users/e13h/following{/other_user}", "gists_url": "https://api.github.com/users/e13h/gists{/gist_id}", "starred_url": "https://api.github.com/users/e13h/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/e13h/subscriptions", "organizations_url": "https://api.github.com/users/e13h/orgs", "repos_url": "https://api.github.com/users/e13h/repos", "events_url": "https://api.github.com/users/e13h/events{/privacy}", "received_events_url": "https://api.github.com/users/e13h/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790728283, "node_id": "MDU6TGFiZWwyNzkwNzI4Mjgz", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20notebooks", "name": "component: notebooks", "color": "08275B", "default": false, "description": "Relates to the SageMaker Notebook Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-06-11T23:24:53Z", "updated_at": "2023-02-27T18:17:03Z", "closed_at": "2023-02-27T18:17:03Z", "author_association": "NONE", "active_lock_reason": null, "body": "[The SageMaker Python SDK docs](https://sagemaker.readthedocs.io/en/stable/api/inference/model.html#sagemaker.model.Model) imply that you can use your own `ssh/config` on a notebook instance\r\n> For GitHub and other Git repos, when SSH URLs are provided, it doesn\u2019t matter whether 2FA is enabled or disabled; you should either have no passphrase for the SSH key pairs, or have the ssh-agent configured so that you will not be prompted for SSH passphrase when you do \u2018git clone\u2019 command with SSH URLs.\r\n\r\nBut, the code for cloning repos with an SSH URL uses the `GIT_SSH` environment variable (to make sure that the user isn't prompted for credentials)\r\nhttps://github.com/aws/sagemaker-python-sdk/blob/9f399cee16ccbad0134ecddf14b9f2846826334a/src/sagemaker/git_utils.py#L280-L287\r\n\r\n[The documentation for git](https://git-scm.com/book/en/v2/Git-Internals-Environment-Variables) says, however, that whatever `GIT_SSH` points to will override any `ssh/config` you have set up.\r\n> `GIT_SSH`, if specified, is a program that is invoked **instead of** `ssh` when Git tries to connect to an SSH host. It is invoked like `$GIT_SSH [username@]host [-p <port>] <command>`. Note that this isn\u2019t the easiest way to customize how `ssh` is invoked; it won\u2019t support extra command-line parameters, so you\u2019d have to write a wrapper script and set `GIT_SSH` to point to it. It\u2019s probably easier just to use the `~/.ssh/config` file for that.\r\n\r\nSo this means that you can't clone a private repo using an SSH URL. The only way to clone it would be to use a GitHub Personal Access Token (PAT) and an HTTPS URL.\r\n\r\n---\r\n\r\nTo reproduce, use this template code (having an `ssh/config` and a private key set up or not makes no difference in the output behavior):\r\n```python\r\nfrom sagemaker import get_execution_role\r\nfrom sagemaker.pytorch.model import PyTorchModel\r\n\r\nPyTorchModel(\r\n    model_data=s3_uri_path_to_model_tar_gz,\r\n    git_config={\r\n        \"repo\": f\"git@github.com:{repo_account_name}/{private_repo_name}.git\",\r\n        \"branch\": branch_name,\r\n    },\r\n    code_location=s3_uri_path_to_code_location,\r\n    source_dir=path_to_src_in_github_repo,\r\n    entry_point=\"inference.py\",\r\n    role=get_execution_role(),\r\n    py_version=\"py3\",\r\n    framework_version=\"1.4\"\r\n)\r\n```\r\nOutput (not a very helpful message, but that's a different issue :wink: )\r\n```\r\nCalledProcessError: Command '['git', 'clone', 'git@github.com:<org>/<repo>.git', '/tmp/tmp01e7i6rz']' returned non-zero exit status 128.\r\n```", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2442/reactions", "total_count": 3, "+1": 3, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2442/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2426", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2426/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2426/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2426/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2426", "id": 911518514, "node_id": "MDU6SXNzdWU5MTE1MTg1MTQ=", "number": 2426, "title": "JsonGet function is not interpolated into workflow expression", "user": {"login": "madayev", "id": 8828906, "node_id": "MDQ6VXNlcjg4Mjg5MDY=", "avatar_url": "https://avatars.githubusercontent.com/u/8828906?v=4", "gravatar_id": "", "url": "https://api.github.com/users/madayev", "html_url": "https://github.com/madayev", "followers_url": "https://api.github.com/users/madayev/followers", "following_url": "https://api.github.com/users/madayev/following{/other_user}", "gists_url": "https://api.github.com/users/madayev/gists{/gist_id}", "starred_url": "https://api.github.com/users/madayev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/madayev/subscriptions", "organizations_url": "https://api.github.com/users/madayev/orgs", "repos_url": "https://api.github.com/users/madayev/repos", "events_url": "https://api.github.com/users/madayev/events{/privacy}", "received_events_url": "https://api.github.com/users/madayev/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-06-04T13:49:31Z", "updated_at": "2021-08-02T22:57:10Z", "closed_at": "2021-08-02T22:57:10Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Description**\r\nWhen the JsonGet function is used to get the values of PropertyFile in order to assign Estimators hyperparameter values, Sagemaker Pipeline is not able to convert this request into the expression for workflow service calls. As a result, JsonGet cannot be used to get/pass values from PropertyFile to next step components.\r\n\r\n**To reproduce**\r\n```\r\nparams = PropertyFile(\r\n    name=\"params\",\r\n    output_name=\"params\",\r\n    path=\"params.json\"\r\n)\r\n\r\nstep_process = ProcessingStep(\r\n    'processing_step',\r\n    processor=processor,\r\n    job_arguments=[...],\r\n    outputs=[\r\n        ...\r\n    ],\r\n    property_files=[params]\r\n)\r\n\r\nestimator = Estimator(\r\n    image_uri=image_uri,\r\n    instance_type=training_instance_type,\r\n    instance_count=1,\r\n    output_path=output_path,\r\n    role=role,\r\n)\r\n\r\nestimator.set_hyperparameters(\r\n    alpha=JsonGet(\r\n        step=step_tune,\r\n        property_file=params,\r\n        json_path=\"alpha\"\r\n    ),\r\n    gamma=JsonGet(\r\n        step=step_tune,\r\n        property_file=params,\r\n        json_path=\"gamma\"\r\n    ),\r\n    eta=JsonGet(\r\n        step=step_tune,\r\n        property_file=params,\r\n        json_path=\"eta\"\r\n    ),\r\n    ...\r\n)\r\n\r\nstep_train = TrainingStep(\r\n    name=\"TrainStep\",\r\n    estimator=estimator,\r\n    inputs={\r\n        ...\r\n    },\r\n)\r\n\r\npipeline_name = \"Pipeline\"\r\npipeline = Pipeline(\r\n    name=pipeline_name,\r\n    parameters=[\r\n        ...\r\n    ],\r\n    steps=[step_process, step_train],\r\n)\r\n\r\njson.loads(pipeline.definition())\r\n```\r\n\r\n**Screenshots or logs**\r\n```\r\n---------------------------------------------------------------------------\r\nTypeError                                 Traceback (most recent call last)\r\n<ipython-input-9-3d1e039d5b24> in <module>\r\n----> json.loads(pipeline.definition())\r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/workflow/pipeline.py in definition(self)\r\n    225         \"\"\"Converts a request structure to string representation for workflow service calls.\"\"\"\r\n    226         request_dict = self.to_request()\r\n--> 227         request_dict[\"Steps\"] = interpolate(request_dict[\"Steps\"])\r\n    228 \r\n    229         return json.dumps(request_dict)\r\n\r\n/opt/conda/lib/python3.7/site-packages/sagemaker/workflow/pipeline.py in interpolate(request_obj)\r\n    255         RequestType: The request dict with Parameter values replaced by their expression.\r\n    256     \"\"\"\r\n--> 257     request_obj_copy = deepcopy(request_obj)\r\n    258     return _interpolate(request_obj_copy)\r\n    259 \r\n\r\n/opt/conda/lib/python3.7/copy.py in deepcopy(x, memo, _nil)\r\n    148     copier = _deepcopy_dispatch.get(cls)\r\n    149     if copier:\r\n--> 150         y = copier(x, memo)\r\n    151     else:\r\n    152         try:\r\n\r\n/opt/conda/lib/python3.7/copy.py in _deepcopy_list(x, memo, deepcopy)\r\n    214     append = y.append\r\n    215     for a in x:\r\n--> 216         append(deepcopy(a, memo))\r\n    217     return y\r\n    218 d[list] = _deepcopy_list\r\n\r\n/opt/conda/lib/python3.7/copy.py in deepcopy(x, memo, _nil)\r\n    148     copier = _deepcopy_dispatch.get(cls)\r\n    149     if copier:\r\n--> 150         y = copier(x, memo)\r\n    151     else:\r\n    152         try:\r\n\r\n/opt/conda/lib/python3.7/copy.py in _deepcopy_dict(x, memo, deepcopy)\r\n    239     memo[id(x)] = y\r\n    240     for key, value in x.items():\r\n--> 241         y[deepcopy(key, memo)] = deepcopy(value, memo)\r\n    242     return y\r\n    243 d[dict] = _deepcopy_dict\r\n\r\n/opt/conda/lib/python3.7/copy.py in deepcopy(x, memo, _nil)\r\n    148     copier = _deepcopy_dispatch.get(cls)\r\n    149     if copier:\r\n--> 150         y = copier(x, memo)\r\n    151     else:\r\n    152         try:\r\n\r\n/opt/conda/lib/python3.7/copy.py in _deepcopy_dict(x, memo, deepcopy)\r\n    239     memo[id(x)] = y\r\n    240     for key, value in x.items():\r\n--> 241         y[deepcopy(key, memo)] = deepcopy(value, memo)\r\n    242     return y\r\n    243 d[dict] = _deepcopy_dict\r\n\r\n/opt/conda/lib/python3.7/copy.py in deepcopy(x, memo, _nil)\r\n    148     copier = _deepcopy_dispatch.get(cls)\r\n    149     if copier:\r\n--> 150         y = copier(x, memo)\r\n    151     else:\r\n    152         try:\r\n\r\n/opt/conda/lib/python3.7/copy.py in _deepcopy_dict(x, memo, deepcopy)\r\n    239     memo[id(x)] = y\r\n    240     for key, value in x.items():\r\n--> 241         y[deepcopy(key, memo)] = deepcopy(value, memo)\r\n    242     return y\r\n    243 d[dict] = _deepcopy_dict\r\n\r\n/opt/conda/lib/python3.7/copy.py in deepcopy(x, memo, _nil)\r\n    178                     y = x\r\n    179                 else:\r\n--> 180                     y = _reconstruct(x, memo, *rv)\r\n    181 \r\n    182     # If is its own copy, don't memoize.\r\n\r\n/opt/conda/lib/python3.7/copy.py in _reconstruct(x, memo, func, args, state, listiter, dictiter, deepcopy)\r\n    279     if state is not None:\r\n    280         if deep:\r\n--> 281             state = deepcopy(state, memo)\r\n    282         if hasattr(y, '__setstate__'):\r\n    283             y.__setstate__(state)\r\n\r\n/opt/conda/lib/python3.7/copy.py in deepcopy(x, memo, _nil)\r\n    148     copier = _deepcopy_dispatch.get(cls)\r\n    149     if copier:\r\n--> 150         y = copier(x, memo)\r\n    151     else:\r\n    152         try:\r\n\r\n/opt/conda/lib/python3.7/copy.py in _deepcopy_dict(x, memo, deepcopy)\r\n    239     memo[id(x)] = y\r\n    240     for key, value in x.items():\r\n--> 241         y[deepcopy(key, memo)] = deepcopy(value, memo)\r\n    242     return y\r\n    243 d[dict] = _deepcopy_dict\r\n\r\n/opt/conda/lib/python3.7/copy.py in deepcopy(x, memo, _nil)\r\n    178                     y = x\r\n    179                 else:\r\n--> 180                     y = _reconstruct(x, memo, *rv)\r\n    181 \r\n    182     # If is its own copy, don't memoize.\r\n\r\n/opt/conda/lib/python3.7/copy.py in _reconstruct(x, memo, func, args, state, listiter, dictiter, deepcopy)\r\n    279     if state is not None:\r\n    280         if deep:\r\n--> 281             state = deepcopy(state, memo)\r\n    282         if hasattr(y, '__setstate__'):\r\n    283             y.__setstate__(state)\r\n\r\n/opt/conda/lib/python3.7/copy.py in deepcopy(x, memo, _nil)\r\n    148     copier = _deepcopy_dispatch.get(cls)\r\n    149     if copier:\r\n--> 150         y = copier(x, memo)\r\n    151     else:\r\n    152         try:\r\n\r\n/opt/conda/lib/python3.7/copy.py in _deepcopy_dict(x, memo, deepcopy)\r\n    239     memo[id(x)] = y\r\n    240     for key, value in x.items():\r\n--> 241         y[deepcopy(key, memo)] = deepcopy(value, memo)\r\n    242     return y\r\n    243 d[dict] = _deepcopy_dict\r\n\r\n/opt/conda/lib/python3.7/copy.py in deepcopy(x, memo, _nil)\r\n    178                     y = x\r\n    179                 else:\r\n--> 180                     y = _reconstruct(x, memo, *rv)\r\n    181 \r\n    182     # If is its own copy, don't memoize.\r\n\r\n/opt/conda/lib/python3.7/copy.py in _reconstruct(x, memo, func, args, state, listiter, dictiter, deepcopy)\r\n    279     if state is not None:\r\n    280         if deep:\r\n--> 281             state = deepcopy(state, memo)\r\n    282         if hasattr(y, '__setstate__'):\r\n    283             y.__setstate__(state)\r\n\r\n/opt/conda/lib/python3.7/copy.py in deepcopy(x, memo, _nil)\r\n    148     copier = _deepcopy_dispatch.get(cls)\r\n    149     if copier:\r\n--> 150         y = copier(x, memo)\r\n    151     else:\r\n    152         try:\r\n\r\n/opt/conda/lib/python3.7/copy.py in _deepcopy_dict(x, memo, deepcopy)\r\n    239     memo[id(x)] = y\r\n    240     for key, value in x.items():\r\n--> 241         y[deepcopy(key, memo)] = deepcopy(value, memo)\r\n    242     return y\r\n    243 d[dict] = _deepcopy_dict\r\n\r\n/opt/conda/lib/python3.7/copy.py in deepcopy(x, memo, _nil)\r\n    178                     y = x\r\n    179                 else:\r\n--> 180                     y = _reconstruct(x, memo, *rv)\r\n    181 \r\n    182     # If is its own copy, don't memoize.\r\n\r\n/opt/conda/lib/python3.7/copy.py in _reconstruct(x, memo, func, args, state, listiter, dictiter, deepcopy)\r\n    279     if state is not None:\r\n    280         if deep:\r\n--> 281             state = deepcopy(state, memo)\r\n    282         if hasattr(y, '__setstate__'):\r\n    283             y.__setstate__(state)\r\n\r\n/opt/conda/lib/python3.7/copy.py in deepcopy(x, memo, _nil)\r\n    148     copier = _deepcopy_dispatch.get(cls)\r\n    149     if copier:\r\n--> 150         y = copier(x, memo)\r\n    151     else:\r\n    152         try:\r\n\r\n/opt/conda/lib/python3.7/copy.py in _deepcopy_dict(x, memo, deepcopy)\r\n    239     memo[id(x)] = y\r\n    240     for key, value in x.items():\r\n--> 241         y[deepcopy(key, memo)] = deepcopy(value, memo)\r\n    242     return y\r\n    243 d[dict] = _deepcopy_dict\r\n\r\n/opt/conda/lib/python3.7/copy.py in deepcopy(x, memo, _nil)\r\n    178                     y = x\r\n    179                 else:\r\n--> 180                     y = _reconstruct(x, memo, *rv)\r\n    181 \r\n    182     # If is its own copy, don't memoize.\r\n\r\n/opt/conda/lib/python3.7/copy.py in _reconstruct(x, memo, func, args, state, listiter, dictiter, deepcopy)\r\n    279     if state is not None:\r\n    280         if deep:\r\n--> 281             state = deepcopy(state, memo)\r\n    282         if hasattr(y, '__setstate__'):\r\n    283             y.__setstate__(state)\r\n\r\n/opt/conda/lib/python3.7/copy.py in deepcopy(x, memo, _nil)\r\n    148     copier = _deepcopy_dispatch.get(cls)\r\n    149     if copier:\r\n--> 150         y = copier(x, memo)\r\n    151     else:\r\n    152         try:\r\n\r\n/opt/conda/lib/python3.7/copy.py in _deepcopy_dict(x, memo, deepcopy)\r\n    239     memo[id(x)] = y\r\n    240     for key, value in x.items():\r\n--> 241         y[deepcopy(key, memo)] = deepcopy(value, memo)\r\n    242     return y\r\n    243 d[dict] = _deepcopy_dict\r\n\r\n/opt/conda/lib/python3.7/copy.py in deepcopy(x, memo, _nil)\r\n    178                     y = x\r\n    179                 else:\r\n--> 180                     y = _reconstruct(x, memo, *rv)\r\n    181 \r\n    182     # If is its own copy, don't memoize.\r\n\r\n/opt/conda/lib/python3.7/copy.py in _reconstruct(x, memo, func, args, state, listiter, dictiter, deepcopy)\r\n    279     if state is not None:\r\n    280         if deep:\r\n--> 281             state = deepcopy(state, memo)\r\n    282         if hasattr(y, '__setstate__'):\r\n    283             y.__setstate__(state)\r\n\r\n/opt/conda/lib/python3.7/copy.py in deepcopy(x, memo, _nil)\r\n    148     copier = _deepcopy_dispatch.get(cls)\r\n    149     if copier:\r\n--> 150         y = copier(x, memo)\r\n    151     else:\r\n    152         try:\r\n\r\n/opt/conda/lib/python3.7/copy.py in _deepcopy_dict(x, memo, deepcopy)\r\n    239     memo[id(x)] = y\r\n    240     for key, value in x.items():\r\n--> 241         y[deepcopy(key, memo)] = deepcopy(value, memo)\r\n    242     return y\r\n    243 d[dict] = _deepcopy_dict\r\n\r\n/opt/conda/lib/python3.7/copy.py in deepcopy(x, memo, _nil)\r\n    178                     y = x\r\n    179                 else:\r\n--> 180                     y = _reconstruct(x, memo, *rv)\r\n    181 \r\n    182     # If is its own copy, don't memoize.\r\n\r\n/opt/conda/lib/python3.7/copy.py in _reconstruct(x, memo, func, args, state, listiter, dictiter, deepcopy)\r\n    279     if state is not None:\r\n    280         if deep:\r\n--> 281             state = deepcopy(state, memo)\r\n    282         if hasattr(y, '__setstate__'):\r\n    283             y.__setstate__(state)\r\n\r\n/opt/conda/lib/python3.7/copy.py in deepcopy(x, memo, _nil)\r\n    148     copier = _deepcopy_dispatch.get(cls)\r\n    149     if copier:\r\n--> 150         y = copier(x, memo)\r\n    151     else:\r\n    152         try:\r\n\r\n/opt/conda/lib/python3.7/copy.py in _deepcopy_dict(x, memo, deepcopy)\r\n    239     memo[id(x)] = y\r\n    240     for key, value in x.items():\r\n--> 241         y[deepcopy(key, memo)] = deepcopy(value, memo)\r\n    242     return y\r\n    243 d[dict] = _deepcopy_dict\r\n\r\n/opt/conda/lib/python3.7/copy.py in deepcopy(x, memo, _nil)\r\n    167                     reductor = getattr(x, \"__reduce_ex__\", None)\r\n    168                     if reductor:\r\n--> 169                         rv = reductor(4)\r\n    170                     else:\r\n    171                         reductor = getattr(x, \"__reduce__\", None)\r\n\r\nTypeError: can't pickle _thread.lock objects\r\n```\r\n\r\n**Expected behavior**\r\nSuccessfully convert the request to workflow service calls and get values from PropertyFile at runtime.\r\n\r\n**System information**\r\n- **SageMaker Python SDK version**:\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**:\r\n- **Framework version**:\r\n- **Python version**:\r\n- **CPU or GPU**:\r\n- **Custom Docker image (Y/N)**:\r\n\r\n**Additional context**\r\nIt's possible to bypass the error by overriding the __deepcopy__ function, so it returns a new instance of JsonGet.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2426/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2426/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2321", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2321/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2321/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2321/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/pull/2321", "id": 875794348, "node_id": "MDExOlB1bGxSZXF1ZXN0NjMwMDYzMzU3", "number": 2321, "title": "fix: use subprocess.run and f-strings in sagemaker.local.image", "user": {"login": "ajaykarpur", "id": 5490371, "node_id": "MDQ6VXNlcjU0OTAzNzE=", "avatar_url": "https://avatars.githubusercontent.com/u/5490371?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ajaykarpur", "html_url": "https://github.com/ajaykarpur", "followers_url": "https://api.github.com/users/ajaykarpur/followers", "following_url": "https://api.github.com/users/ajaykarpur/following{/other_user}", "gists_url": "https://api.github.com/users/ajaykarpur/gists{/gist_id}", "starred_url": "https://api.github.com/users/ajaykarpur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ajaykarpur/subscriptions", "organizations_url": "https://api.github.com/users/ajaykarpur/orgs", "repos_url": "https://api.github.com/users/ajaykarpur/repos", "events_url": "https://api.github.com/users/ajaykarpur/events{/privacy}", "received_events_url": "https://api.github.com/users/ajaykarpur/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2108671731, "node_id": "MDU6TGFiZWwyMTA4NjcxNzMx", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/Local%20Mode", "name": "Local Mode", "color": "9C61F7", "default": false, "description": ""}, {"id": 2108671736, "node_id": "MDU6TGFiZWwyMTA4NjcxNzM2", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/Docker", "name": "Docker", "color": "39A0EE", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 26, "created_at": "2021-05-04T20:09:22Z", "updated_at": "2021-08-25T18:08:46Z", "closed_at": "2021-05-07T18:30:52Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/pulls/2321", "html_url": "https://github.com/aws/sagemaker-python-sdk/pull/2321", "diff_url": "https://github.com/aws/sagemaker-python-sdk/pull/2321.diff", "patch_url": "https://github.com/aws/sagemaker-python-sdk/pull/2321.patch", "merged_at": null}, "body": "*Description of changes:*\r\nThis PR updates usage of `subprocess` to the recommended `run` function. It also updates strings to f-strings.\r\n\r\nFrom the `subprocess` [documentation](https://docs.python.org/3/library/subprocess.html#using-the-subprocess-module):\r\n> The recommended approach to invoking subprocesses is to use the run() function for all use cases it can handle.\r\n\r\n*Testing done:*\r\n\r\n## Merge Checklist\r\n\r\n_Put an `x` in the boxes that apply. You can also fill these out after creating the PR. If you're unsure about any of them, don't hesitate to ask. We're here to help! This is simply a reminder of what we are going to look for before merging your pull request._\r\n\r\n#### General\r\n\r\n- [x] I have read the [CONTRIBUTING](https://github.com/aws/sagemaker-python-sdk/blob/master/CONTRIBUTING.md) doc\r\n- [x] I used the commit message format described in [CONTRIBUTING](https://github.com/aws/sagemaker-python-sdk/blob/master/CONTRIBUTING.md#committing-your-change)\r\n- [ ] I have passed the region in to all S3 and STS clients that I've initialized as part of this change.\r\n- [x] I have updated any necessary documentation, including [READMEs](https://github.com/aws/sagemaker-python-sdk/blob/master/README.rst) and [API docs](https://github.com/aws/sagemaker-python-sdk/tree/master/doc) (if appropriate)\r\n\r\n#### Tests\r\n\r\n- [x] I have added tests that prove my fix is effective or that my feature works (if appropriate)\r\n- [ ] I have checked that my tests are not configured for a specific region or account (if appropriate)\r\n- [ ] I have used [`unique_name_from_base`](https://github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/utils.py#L77) to create resource names in integ tests (if appropriate)\r\n\r\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2321/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2321/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2302", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2302/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2302/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2302/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2302", "id": 865946162, "node_id": "MDU6SXNzdWU4NjU5NDYxNjI=", "number": 2302, "title": "sagemaker.workflow.step_collections.RegisterModel does not propagate the VPC config to repacker", "user": {"login": "yevgeniyilyin", "id": 64436231, "node_id": "MDQ6VXNlcjY0NDM2MjMx", "avatar_url": "https://avatars.githubusercontent.com/u/64436231?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yevgeniyilyin", "html_url": "https://github.com/yevgeniyilyin", "followers_url": "https://api.github.com/users/yevgeniyilyin/followers", "following_url": "https://api.github.com/users/yevgeniyilyin/following{/other_user}", "gists_url": "https://api.github.com/users/yevgeniyilyin/gists{/gist_id}", "starred_url": "https://api.github.com/users/yevgeniyilyin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yevgeniyilyin/subscriptions", "organizations_url": "https://api.github.com/users/yevgeniyilyin/orgs", "repos_url": "https://api.github.com/users/yevgeniyilyin/repos", "events_url": "https://api.github.com/users/yevgeniyilyin/events{/privacy}", "received_events_url": "https://api.github.com/users/yevgeniyilyin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": {"login": "staubhp", "id": 2755397, "node_id": "MDQ6VXNlcjI3NTUzOTc=", "avatar_url": "https://avatars.githubusercontent.com/u/2755397?v=4", "gravatar_id": "", "url": "https://api.github.com/users/staubhp", "html_url": "https://github.com/staubhp", "followers_url": "https://api.github.com/users/staubhp/followers", "following_url": "https://api.github.com/users/staubhp/following{/other_user}", "gists_url": "https://api.github.com/users/staubhp/gists{/gist_id}", "starred_url": "https://api.github.com/users/staubhp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/staubhp/subscriptions", "organizations_url": "https://api.github.com/users/staubhp/orgs", "repos_url": "https://api.github.com/users/staubhp/repos", "events_url": "https://api.github.com/users/staubhp/events{/privacy}", "received_events_url": "https://api.github.com/users/staubhp/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "staubhp", "id": 2755397, "node_id": "MDQ6VXNlcjI3NTUzOTc=", "avatar_url": "https://avatars.githubusercontent.com/u/2755397?v=4", "gravatar_id": "", "url": "https://api.github.com/users/staubhp", "html_url": "https://github.com/staubhp", "followers_url": "https://api.github.com/users/staubhp/followers", "following_url": "https://api.github.com/users/staubhp/following{/other_user}", "gists_url": "https://api.github.com/users/staubhp/gists{/gist_id}", "starred_url": "https://api.github.com/users/staubhp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/staubhp/subscriptions", "organizations_url": "https://api.github.com/users/staubhp/orgs", "repos_url": "https://api.github.com/users/staubhp/repos", "events_url": "https://api.github.com/users/staubhp/events{/privacy}", "received_events_url": "https://api.github.com/users/staubhp/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2021-04-23T09:47:38Z", "updated_at": "2021-08-28T00:07:34Z", "closed_at": "2021-08-28T00:07:34Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nRegisterModel step is unable to use VPC config to access S3 buckets via VPC endpoints. The problem is in the internal implementation of _RepackModelStep. The SKLearn repacker does not use the VPC config from the original estimator: https://github.com/aws/sagemaker-python-sdk/blob/cdb633b3ab02398c3b77f5ecd2c03cdf41049c78/src/sagemaker/workflow/_utils.py#L88\r\n\r\n**To reproduce**\r\nUse VPC config setup for all pipeline steps to access S3 bucket via the VPC endpoint. The ProcessingStep and TrainingStep can use the VPC config (via Estimator and constructor parameters). RegisterModel step fails with AccessDenied exception because it does not use the specified VPC config.\r\n\r\n**Expected behavior**\r\nRegisterStep must use the provided VPC config and pass it to repacker\r\n\r\n**Screenshots or logs**\r\nIf applicable, add screenshots or logs to help explain your problem.\r\n\r\n**Additional context**\r\nThis is a showstopper for a customer because all communication to S3 bucket must be done via an VPC endpoint. \r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2302/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2302/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2271", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2271/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2271/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2271/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2271", "id": 851828124, "node_id": "MDU6SXNzdWU4NTE4MjgxMjQ=", "number": 2271, "title": "RegisterModelStep with model repacking throws error", "user": {"login": "jerrypeng7773", "id": 50377760, "node_id": "MDQ6VXNlcjUwMzc3NzYw", "avatar_url": "https://avatars.githubusercontent.com/u/50377760?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jerrypeng7773", "html_url": "https://github.com/jerrypeng7773", "followers_url": "https://api.github.com/users/jerrypeng7773/followers", "following_url": "https://api.github.com/users/jerrypeng7773/following{/other_user}", "gists_url": "https://api.github.com/users/jerrypeng7773/gists{/gist_id}", "starred_url": "https://api.github.com/users/jerrypeng7773/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jerrypeng7773/subscriptions", "organizations_url": "https://api.github.com/users/jerrypeng7773/orgs", "repos_url": "https://api.github.com/users/jerrypeng7773/repos", "events_url": "https://api.github.com/users/jerrypeng7773/events{/privacy}", "received_events_url": "https://api.github.com/users/jerrypeng7773/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-04-06T21:36:08Z", "updated_at": "2021-05-04T18:10:29Z", "closed_at": "2021-05-04T18:10:29Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**Describe the bug**\r\n\r\nWhen `entry_point` is given to RegisterModelStep to do model repacking, during register model step instance to definition DSL conversion, an error will be thrown.\r\n\r\n**To reproduce**\r\nadd the following test to `tests/unit/sagemaker/workflow/test_step_collections.py`\r\n\r\n```\r\nfrom tests.integ import DATA_DIR\r\ndef test_register_model_with_model_repack(estimator, model_metrics):\r\n    model_data = f\"s3://{BUCKET}/model.tar.gz\"\r\n    register_model = RegisterModel(\r\n        name=\"RegisterModelStep\",\r\n        estimator=estimator,\r\n        model_data=model_data,\r\n        content_types=[\"content_type\"],\r\n        response_types=[\"response_type\"],\r\n        inference_instances=[\"inference_instance\"],\r\n        transform_instances=[\"transform_instance\"],\r\n        model_package_group_name=\"mpg\",\r\n        model_metrics=model_metrics,\r\n        approval_status=\"Approved\",\r\n        description=\"description\",\r\n        entry_point=f\"{DATA_DIR}/dummy_script.py\",\r\n    )\r\n\r\n    request_dicts = register_model.request_dicts()\r\n    assert len(request_dicts) == 2\r\n    print(request_dicts)\r\n    for request_dict in request_dicts:\r\n        if request_dict[\"Type\"] == \"Training\":\r\n            assert request_dict[\"Name\"] == \"RegisterModelStepRepackModel\"\r\n            arguments = request_dict[\"Arguments\"]\r\n            repacker_job_name = arguments[\"HyperParameters\"][\"sagemaker_job_name\"]\r\n            assert ordered(arguments) == ordered(\r\n                {\r\n                    \"AlgorithmSpecification\": {\r\n                        \"TrainingImage\": \"246618743249.dkr.ecr.us-west-2.amazonaws.com/sagemaker-scikit-learn:0.23-1-cpu-py3\",\r\n                        \"TrainingInputMode\": \"File\",\r\n                    },\r\n                    \"DebugHookConfig\": {\r\n                        \"CollectionConfigurations\": [],\r\n                        \"S3OutputPath\": f\"s3://{BUCKET}/\",\r\n                    },\r\n                    \"HyperParameters\": {\r\n                        \"inference_script\": '\"dummy_script.py\"',\r\n                        \"model_archive\": '\"model.tar.gz\"',\r\n                        \"sagemaker_submit_directory\": '\"s3://{}/{}/source/sourcedir.tar.gz\"'.format(\r\n                            BUCKET, repacker_job_name.replace('\"', \"\")\r\n                        ),\r\n                        \"sagemaker_program\": '\"_repack_model.py\"',\r\n                        \"sagemaker_container_log_level\": \"20\",\r\n                        \"sagemaker_job_name\": repacker_job_name,\r\n                        \"sagemaker_region\": f'\"{REGION}\"',\r\n                    },\r\n                    \"InputDataConfig\": [\r\n                        {\r\n                            \"ChannelName\": \"training\",\r\n                            \"DataSource\": {\r\n                                \"S3DataSource\": {\r\n                                    \"S3DataDistributionType\": \"FullyReplicated\",\r\n                                    \"S3DataType\": \"S3Prefix\",\r\n                                    \"S3Uri\": f\"s3://{BUCKET}\",\r\n                                }\r\n                            },\r\n                        }\r\n                    ],\r\n                    \"OutputDataConfig\": {\"S3OutputPath\": f\"s3://{BUCKET}/\"},\r\n                    \"ResourceConfig\": {\r\n                        \"InstanceCount\": 1,\r\n                        \"InstanceType\": \"ml.m5.large\",\r\n                        \"VolumeSizeInGB\": 30,\r\n                    },\r\n                    \"RoleArn\": ROLE,\r\n                    \"StoppingCondition\": {\"MaxRuntimeInSeconds\": 86400},\r\n                }\r\n            )\r\n        elif request_dict[\"Type\"] == \"RegisterModel\":\r\n            assert request_dict[\"Name\"] == \"RegisterModelStep\"\r\n            arguments = request_dict[\"Arguments\"]\r\n            assert len(arguments[\"InferenceSpecification\"][\"Containers\"]) == 1\r\n            assert (\r\n                arguments[\"InferenceSpecification\"][\"Containers\"][0][\"Image\"]\r\n                == estimator.training_image_uri()\r\n            )\r\n            assert isinstance(\r\n                arguments[\"InferenceSpecification\"][\"Containers\"][0][\"ModelDataUrl\"], Properties\r\n            )\r\n            del arguments[\"InferenceSpecification\"][\"Containers\"]\r\n            assert ordered(arguments) == ordered(\r\n                {\r\n                    \"InferenceSpecification\": {\r\n                        \"SupportedContentTypes\": [\"content_type\"],\r\n                        \"SupportedRealtimeInferenceInstanceTypes\": [\"inference_instance\"],\r\n                        \"SupportedResponseMIMETypes\": [\"response_type\"],\r\n                        \"SupportedTransformInstanceTypes\": [\"transform_instance\"],\r\n                    },\r\n                    \"ModelApprovalStatus\": \"Approved\",\r\n                    \"ModelMetrics\": {\r\n                        \"ModelQuality\": {\r\n                            \"Statistics\": {\r\n                                \"ContentType\": \"text/csv\",\r\n                                \"S3Uri\": f\"s3://{BUCKET}/metrics.csv\",\r\n                            },\r\n                        },\r\n                    },\r\n                    \"ModelPackageDescription\": \"description\",\r\n                    \"ModelPackageGroupName\": \"mpg\",\r\n                }\r\n            )\r\n        else:\r\n            raise Exception(\"A step exists in the collection of an invalid type.\")\r\n```\r\nthen run `tox tests/unit/sagemaker/workflow/test_step_collections.py`, error will be thrown:\r\n\r\n```\r\n\r\nestimator = <sagemaker.estimator.Estimator object at 0x11a8ac4e0>, model_metrics = <sagemaker.model_metrics.ModelMetrics object at 0x11a887390>\r\n\r\n    def test_register_model_with_model_repack(estimator, model_metrics):\r\n        model_data = f\"s3://{BUCKET}/model.tar.gz\"\r\n        register_model = RegisterModel(\r\n            name=\"RegisterModelStep\",\r\n            estimator=estimator,\r\n            model_data=model_data,\r\n            content_types=[\"content_type\"],\r\n            response_types=[\"response_type\"],\r\n            inference_instances=[\"inference_instance\"],\r\n            transform_instances=[\"transform_instance\"],\r\n            model_package_group_name=\"mpg\",\r\n            model_metrics=model_metrics,\r\n            approval_status=\"Approved\",\r\n            description=\"description\",\r\n            entry_point=f\"{DATA_DIR}/dummy_script.py\",\r\n        )\r\n    \r\n>       request_dicts = register_model.request_dicts()\r\n\r\ntests/unit/sagemaker/workflow/test_step_collections.py:251: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n.tox/py36/lib/python3.6/site-packages/sagemaker/workflow/step_collections.py:48: in request_dicts\r\n    return [step.to_request() for step in self.steps]\r\n.tox/py36/lib/python3.6/site-packages/sagemaker/workflow/step_collections.py:48: in <listcomp>\r\n    return [step.to_request() for step in self.steps]\r\n.tox/py36/lib/python3.6/site-packages/sagemaker/workflow/steps.py:86: in to_request\r\n    \"Arguments\": self.arguments,\r\n.tox/py36/lib/python3.6/site-packages/sagemaker/workflow/_utils.py:291: in arguments\r\n    model = self.estimator.create_model(**self.kwargs)\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nself = <sagemaker.estimator.Estimator object at 0x11a8ac4e0>, role = 'DummyRole', image_uri = None, predictor_cls = <function Estimator.create_model.<locals>.predict_wrapper at 0x11a878ea0>\r\nvpc_config_override = 'VPC_CONFIG_DEFAULT', kwargs = {'enable_network_isolation': False, 'entry_point': '/Users/xuefpeng/workplace/PythonProjects/sagemaker-python-sdk/tests/integ/../data/dummy_script.py'}\r\npredict_wrapper = <function Estimator.create_model.<locals>.predict_wrapper at 0x11a878ea0>\r\n\r\n    def create_model(\r\n        self,\r\n        role=None,\r\n        image_uri=None,\r\n        predictor_cls=None,\r\n        vpc_config_override=vpc_utils.VPC_CONFIG_DEFAULT,\r\n        **kwargs,\r\n    ):\r\n        \"\"\"Create a model to deploy.\r\n    \r\n        The serializer and deserializer arguments are only used to define a\r\n        default Predictor. They are ignored if an explicit predictor class is passed in.\r\n        Other arguments are passed through to the Model class.\r\n    \r\n        Args:\r\n            role (str): The ``ExecutionRoleArn`` IAM Role ARN for the ``Model``,\r\n                which is also used during transform jobs. If not specified, the\r\n                role from the Estimator will be used.\r\n            image_uri (str): A Docker image URI to use for deploying the model.\r\n                Defaults to the image used for training.\r\n            predictor_cls (Predictor): The predictor class to use when\r\n                deploying the model.\r\n            vpc_config_override (dict[str, list[str]]): Optional override for VpcConfig set on\r\n                the model.\r\n                Default: use subnets and security groups from this Estimator.\r\n                * 'Subnets' (list[str]): List of subnet ids.\r\n                * 'SecurityGroupIds' (list[str]): List of security group ids.\r\n            **kwargs: Additional parameters passed to :class:`~sagemaker.model.Model`\r\n    \r\n        .. tip::\r\n    \r\n            You can find additional parameters for using this method at\r\n            :class:`~sagemaker.model.Model`.\r\n    \r\n        Returns:\r\n            (sagemaker.model.Model) a Model ready for deployment.\r\n        \"\"\"\r\n        removed_kwargs(\"serializer\", kwargs)\r\n        removed_kwargs(\"deserializer\", kwargs)\r\n        removed_kwargs(\"content_type\", kwargs)\r\n        removed_kwargs(\"accept\", kwargs)\r\n    \r\n        if predictor_cls is None:\r\n    \r\n            def predict_wrapper(endpoint, session):\r\n                return Predictor(endpoint, session)\r\n    \r\n            predictor_cls = predict_wrapper\r\n    \r\n        role = role or self.role\r\n    \r\n        if \"enable_network_isolation\" not in kwargs:\r\n            kwargs[\"enable_network_isolation\"] = self.enable_network_isolation()\r\n    \r\n        return Model(\r\n            image_uri or self.training_image_uri(),\r\n            self.model_data,\r\n            role,\r\n            vpc_config=self.get_vpc_config(vpc_config_override),\r\n            sagemaker_session=self.sagemaker_session,\r\n            predictor_cls=predictor_cls,\r\n>           **kwargs,\r\n        )\r\nE       TypeError: __init__() got an unexpected keyword argument 'entry_point'\r\n\r\n.tox/py36/lib/python3.6/site-packages/sagemaker/estimator.py:1928: TypeError\r\n```\r\n\r\n**Expected behavior**\r\nThe conversion should succeed instead of throwing error\r\n\r\n**Screenshots or logs**\r\nIf applicable, add screenshots or logs to help explain your problem.\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**:  v2.33.0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: N/A\r\n- **Framework version**: N/A\r\n- **Python version**: 3.6.9\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2271/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2271/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2253", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2253/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2253/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2253/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2253", "id": 843515331, "node_id": "MDU6SXNzdWU4NDM1MTUzMzE=", "number": 2253, "title": "Scikit processing example - Client LogStream error #8", "user": {"login": "gerold-csendes-epam", "id": 74710495, "node_id": "MDQ6VXNlcjc0NzEwNDk1", "avatar_url": "https://avatars.githubusercontent.com/u/74710495?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gerold-csendes-epam", "html_url": "https://github.com/gerold-csendes-epam", "followers_url": "https://api.github.com/users/gerold-csendes-epam/followers", "following_url": "https://api.github.com/users/gerold-csendes-epam/following{/other_user}", "gists_url": "https://api.github.com/users/gerold-csendes-epam/gists{/gist_id}", "starred_url": "https://api.github.com/users/gerold-csendes-epam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gerold-csendes-epam/subscriptions", "organizations_url": "https://api.github.com/users/gerold-csendes-epam/orgs", "repos_url": "https://api.github.com/users/gerold-csendes-epam/repos", "events_url": "https://api.github.com/users/gerold-csendes-epam/events{/privacy}", "received_events_url": "https://api.github.com/users/gerold-csendes-epam/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-03-29T15:59:43Z", "updated_at": "2021-08-12T18:39:33Z", "closed_at": "2021-08-12T18:39:27Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nWhen running the the local scikit-learn processing [srcipt](https://github.com/aws-samples/amazon-sagemaker-local-mode/tree/main/scikit_learn_local_processing) on a notebook instance the training job finishes successfully but I get the following error (I substituted the user and and resource id-s with ....):\r\n`ClientError: An error occurred (AccessDeniedException) when calling the DescribeLogStreams operation: User: ... is not authorized to perform: logs:DescribeLogStreams on resource: ... -group:/aws/sagemaker/ProcessingJobs:log-stream`\r\n\r\nIt seems like it is trying to write logs which is not really necessary in the local mode, is it? Maybe the issue is that I run the script on sagemaker? \r\n\r\nI originally posted the issue at the local example [repo](https://github.com/aws-samples/amazon-sagemaker-local-mode)\r\n\r\n**To reproduce**\r\nRun the aforementioned notebook.\r\n\r\n**Screenshots or logs**\r\nThis is the last thing that gets outputted before the error:\r\n```\r\n405xfy7qlb-algo-1-xyh7a | Processing Complete\r\n405xfy7qlb-algo-1-xyh7a exited with code 0\r\nAborting on container exit...\r\n===== Job Complete =====\r\n```\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.31.1\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: Sklearn \r\n- **Framework version**:  0.20.0\r\n- **Python version**:  python3\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\nI can get rid of the error by specifying `logs=False` argument.", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2253/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2253/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2200", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2200/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2200/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2200/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2200", "id": 827091210, "node_id": "MDU6SXNzdWU4MjcwOTEyMTA=", "number": 2200, "title": "Hyperparameter won't be changed for different executions", "user": {"login": "ruyyi0323", "id": 31749673, "node_id": "MDQ6VXNlcjMxNzQ5Njcz", "avatar_url": "https://avatars.githubusercontent.com/u/31749673?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ruyyi0323", "html_url": "https://github.com/ruyyi0323", "followers_url": "https://api.github.com/users/ruyyi0323/followers", "following_url": "https://api.github.com/users/ruyyi0323/following{/other_user}", "gists_url": "https://api.github.com/users/ruyyi0323/gists{/gist_id}", "starred_url": "https://api.github.com/users/ruyyi0323/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ruyyi0323/subscriptions", "organizations_url": "https://api.github.com/users/ruyyi0323/orgs", "repos_url": "https://api.github.com/users/ruyyi0323/repos", "events_url": "https://api.github.com/users/ruyyi0323/events{/privacy}", "received_events_url": "https://api.github.com/users/ruyyi0323/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-03-10T04:38:39Z", "updated_at": "2022-06-21T21:59:53Z", "closed_at": "2022-06-21T21:59:53Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nChanging hyperparameter for the estimator doesn't work\r\n\r\n**To reproduce**\r\nI am creating an estimator and hyperparameters in this way\r\n```\r\n# ... define other parameters\r\n\r\n    train_epochs=ParameterInteger(\r\n        name=\"TrainEpochs\", \r\n        default_value=5,\r\n    )\r\n    train_batch_size=ParameterInteger(\r\n        name=\"TrainBatchSize\", \r\n        default_value=256,\r\n    )\r\n    early_stop_tolerance=ParameterInteger(\r\n        name=\"EarlyStopPatience\", \r\n        default_value=10,\r\n    )\r\n\r\n# ... define other steps\r\n\r\nsalary_estimator = Estimator(\r\n        entry_point='train.py',\r\n        source_dir=os.path.join(code_dir, \"src.tar.gz\"), # this should be just \"source\" for your code\r\n        role=role,\r\n        image_uri=\"763104351884.dkr.ecr.us-east-1.amazonaws.com/tensorflow-training:2.3.1-gpu-py37-cu110-ubuntu18.04\",\r\n        instance_count=1,\r\n        instance_type=training_instance_type,\r\n        output_path = get_projection_s3_dir(experiment_dir, \"model\"),\r\n        sagemaker_session=sagemaker_session,\r\n        container_log_level=10, # 10 debug 20 info 30 warning 40 error\r\n        volume_size=160,\r\n        base_job_name=f\"{base_job_prefix}-model-train\"\r\n    )\r\n    salary_estimator.set_hyperparameters(\r\n        epcohs=train_epochs,\r\n        batch_size=train_batch_size,\r\n        early_stop_patience=early_stop_tolerance\r\n    )\r\n``` \r\nif I run the experiment in this way\r\n```\r\nexec_params = dict(\r\n    ...\r\n    TrainEpochs=3,\r\n)\r\n```\r\nIn training, it would still use 5 as its training epochs, by further checking the definition of pipeline, I found\r\n![image](https://user-images.githubusercontent.com/31749673/110577198-2ab74800-8130-11eb-9f3c-93c97dd1c6d3.png)\r\nRather than fetching the parameter, seems like estimator is purely using the default value of it\r\n\r\nAlso, I tried to use the `TensorFlow` estimator object, it won't work either\r\n\r\n**Expected behavior**\r\nThe estimator seems should get the parameter value rather than set it using the default value.\r\n\r\n**Screenshots or logs**\r\nSee above\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.23.5\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: Tensorflow\r\n- **Framework version**: ..\r\n- **Python version**: 3.7\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: N\r\n- (Same as SageMaker Studio Data-Science Environment)\r\n\r\n**Additional context**\r\n@ChoiByungWook \r\nI am using this as reference to create my own stuff https://github.com/data-science-on-aws/workshop/blob/7f3449de54c908c97d58d784f0a1050531d9b7ad/10_pipeline/01_Create_SageMaker_Pipeline_BERT_Reviews.ipynb", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2200/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2200/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2197", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2197/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2197/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2197/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2197", "id": 826068015, "node_id": "MDU6SXNzdWU4MjYwNjgwMTU=", "number": 2197, "title": "Workflow ProcessingStep run arguments", "user": {"login": "jaggaer-mtrninic", "id": 77275587, "node_id": "MDQ6VXNlcjc3Mjc1NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/77275587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jaggaer-mtrninic", "html_url": "https://github.com/jaggaer-mtrninic", "followers_url": "https://api.github.com/users/jaggaer-mtrninic/followers", "following_url": "https://api.github.com/users/jaggaer-mtrninic/following{/other_user}", "gists_url": "https://api.github.com/users/jaggaer-mtrninic/gists{/gist_id}", "starred_url": "https://api.github.com/users/jaggaer-mtrninic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jaggaer-mtrninic/subscriptions", "organizations_url": "https://api.github.com/users/jaggaer-mtrninic/orgs", "repos_url": "https://api.github.com/users/jaggaer-mtrninic/repos", "events_url": "https://api.github.com/users/jaggaer-mtrninic/events{/privacy}", "received_events_url": "https://api.github.com/users/jaggaer-mtrninic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-03-09T15:03:10Z", "updated_at": "2022-05-13T01:32:45Z", "closed_at": "2022-05-13T01:32:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the feature you'd like**\r\nProcessingStep at the moment as per my knowledge doesn't cover all the arguments that run function of concrete Processor has. \r\nFeature would be ability to pass in an run arguments for concrete processor from the ProcessingStep object.\r\n\r\n**How would this feature be used? Please describe.**\r\nFor example PySparkProcessor has a submit_jars argument but this can not be passed to ProcessingStep as part of the pipeline. \r\nIt would be nice if there could be a run arguments for ProcessingStep where we could client pass the arguments of concrete Procesor.\r\n\r\n**Describe alternatives you've considered**\r\nFor PySpark processor and submit jars only solution in my mind is to rewrite the code in Scala and make an uber jar with all jars required for the job.\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2197/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2197/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2170", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2170/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2170/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2170/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2170", "id": 814016786, "node_id": "MDU6SXNzdWU4MTQwMTY3ODY=", "number": 2170, "title": "AttributeError: module 'smdistributed.dataparallel.tensorflow' has no attribute 'get_world_size'", "user": {"login": "gonsoomoon-ml", "id": 61612358, "node_id": "MDQ6VXNlcjYxNjEyMzU4", "avatar_url": "https://avatars.githubusercontent.com/u/61612358?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gonsoomoon-ml", "html_url": "https://github.com/gonsoomoon-ml", "followers_url": "https://api.github.com/users/gonsoomoon-ml/followers", "following_url": "https://api.github.com/users/gonsoomoon-ml/following{/other_user}", "gists_url": "https://api.github.com/users/gonsoomoon-ml/gists{/gist_id}", "starred_url": "https://api.github.com/users/gonsoomoon-ml/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gonsoomoon-ml/subscriptions", "organizations_url": "https://api.github.com/users/gonsoomoon-ml/orgs", "repos_url": "https://api.github.com/users/gonsoomoon-ml/repos", "events_url": "https://api.github.com/users/gonsoomoon-ml/events{/privacy}", "received_events_url": "https://api.github.com/users/gonsoomoon-ml/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2108671742, "node_id": "MDU6TGFiZWwyMTA4NjcxNzQy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/Tensorflow", "name": "Tensorflow", "color": "FF8F00", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-02-23T01:41:50Z", "updated_at": "2021-03-13T10:19:21Z", "closed_at": "2021-03-13T10:19:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nA clear and concise description of what the bug is.\r\nWhen I ran \"https://github.com/aws/amazon-sagemaker-examples/blob/master/training/distributed_training/tensorflow/data_parallel/mnist/tensorflow2_smdataparallel_mnist_demo.ipynb\", I had an error as follows:\r\n\r\n[1,14]<stdout>:    train_tensorflow_smdataparallel_mnist.py:71 training_step  *\r\n[1,14]<stdout>:        with tf.GradientTape() as tape:\r\n[1,14]<stdout>:    /usr/local/lib/python3.7/site-packages/tensorflow/python/eager/backprop.py:855 __enter__\r\n[1,14]<stdout>:        smdebug_hook = get_smdebug_hook(hook_type=\"keras\", create_if_not_exists=True)\r\n[1,14]<stdout>:    /usr/local/lib/python3.7/site-packages/tensorflow/python/util/smdebug.py:122 get_smdebug_hook\r\n[1,14]<stdout>:        return smd.get_hook(hook_type=hook_type, create_if_not_exists=create_if_not_exists)\r\n[1,14]<stdout>:    /usr/local/lib/python3.7/site-packages/smdebug/tensorflow/singleton_utils.py:41 get_hook\r\n[1,14]<stdout>:        create_if_not_exists=create_if_not_exists,\r\n[1,14]<stdout>:    /usr/local/lib/python3.7/site-packages/smdebug/core/singleton_utils.py:60 get_hook\r\n[1,14]<stdout>:        _create_hook(json_config_path, hook_class)\r\n[1,14]<stdout>:    /usr/local/lib/python3.7/site-packages/smdebug/core/singleton_utils.py:28 _create_hook\r\n[1,14]<stdout>:        hook = hook_class.create_from_json_file(json_file_path=json_config_path)\r\n[1,14]<stdout>:    /usr/local/lib/python3.7/site-packages/smdebug/core/hook.py:309 create_from_json_file\r\n[1,14]<stdout>:        return create_hook_from_json_config(cls, json_config_path=json_file_path)\r\n[1,14]<stdout>:    /usr/local/lib/python3.7/site-packages/smdebug/core/json_config.py:244 create_hook_from_json_config\r\n[1,14]<stdout>:        save_all=save_all,\r\n[1,14]<stdout>:    /usr/local/lib/python3.7/site-packages/smdebug/tensorflow/keras.py:93 __init__\r\n[1,14]<stdout>:        profiler_config_parser=profiler_config_parser,\r\n[1,14]<stdout>:    /usr/local/lib/python3.7/site-packages/smdebug/tensorflow/base_hook.py:83 __init__\r\n[1,14]<stdout>:        profiler_config_parser=profiler_config_parser,\r\n[1,14]<stdout>:    /usr/local/lib/python3.7/site-packages/smdebug/core/hook.py:238 __init__\r\n[1,14]<stdout>:        self.timeline_writer = TimelineFileWriter(profiler_config_parser=profiler_config_parser)\r\n[1,14]<stdout>:    /usr/local/lib/python3.7/site-packages/smdebug/core/tfevent/timeline_file_writer.py:138 __init__\r\n[1,14]<stdout>:        suffix=suffix,\r\n[1,14]<stdout>:    /usr/local/lib/python3.7/site-packages/smdebug/core/tfevent/timeline_file_writer.py:232 __init__\r\n[1,14]<stdout>:        self.node_id = get_node_id()\r\n[1,14]<stdout>:    /usr/local/lib/python3.7/site-packages/smdebug/core/utils.py:393 get_node_id\r\n[1,14]<stdout>:        rank = get_distributed_worker()\r\n[1,14]<stdout>:    /usr/local/lib/python3.7/site-packages/smdebug/core/utils.py:373 get_distributed_worker\r\n[1,14]<stdout>:        if _smdataparallel_imported.get_world_size():\r\n[1,14]<stdout>:\r\n[1,14]<stdout>:    AttributeError: module 'smdistributed.dataparallel.tensorflow' has no attribute 'get_world_size'\r\n\r\n**To reproduce**\r\nAs I mentioned above, I cloned \"https://github.com/aws/amazon-sagemaker-examples\" and then moved to \"https://github.com/aws/amazon-sagemaker-examples/blob/master/training/distributed_training/tensorflow/data_parallel/mnist/tensorflow2_smdataparallel_mnist_demo.ipynb\" and then just run all cells.\r\nOn this cell, estimator.fit(),  I got the error. \r\n\r\n**Expected behavior**\r\nAbsolutely, I expected no error on the command, estimator.fit()\r\n\r\n**Screenshots or logs**\r\nI put it as above\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.25.1\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: I used a given sample as follows:\r\nfrom sagemaker.tensorflow import TensorFlow\r\nestimator = TensorFlow(\r\n                        base_job_name='tensorflow2-smdataparallel-mnist',\r\n                        source_dir='code',\r\n                        entry_point='train_tensorflow_smdataparallel_mnist.py',\r\n                        role=role,\r\n                        py_version='py37',\r\n                        framework_version='2.3.1',\r\n                        # For training with multinode distributed training, set this count. Example: 2\r\n                        instance_count=2,\r\n                        # For training with p3dn instance use - ml.p3dn.24xlarge, with p4dn instance use - ml.p4d.24xlarge\r\n                        instance_type= 'ml.p3.16xlarge',\r\n                        sagemaker_session=sagemaker_session,\r\n                        # Training using SMDataParallel Distributed Training Framework\r\n                        distribution={'smdistributed':{\r\n                                            'dataparallel':{\r\n                                                    'enabled': True\r\n                                             }\r\n                                      }}\r\n                        ) \r\n- **Framework version**: NA\r\n- **Python version**: NA\r\n- **CPU or GPU**: NA\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\nAdd any other context about the problem here. \r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2170/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2170/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2165", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2165/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2165/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2165/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2165", "id": 811624812, "node_id": "MDU6SXNzdWU4MTE2MjQ4MTI=", "number": 2165, "title": "Batch transform fails with character encoding error in local mode", "user": {"login": "oleg131", "id": 10161825, "node_id": "MDQ6VXNlcjEwMTYxODI1", "avatar_url": "https://avatars.githubusercontent.com/u/10161825?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oleg131", "html_url": "https://github.com/oleg131", "followers_url": "https://api.github.com/users/oleg131/followers", "following_url": "https://api.github.com/users/oleg131/following{/other_user}", "gists_url": "https://api.github.com/users/oleg131/gists{/gist_id}", "starred_url": "https://api.github.com/users/oleg131/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oleg131/subscriptions", "organizations_url": "https://api.github.com/users/oleg131/orgs", "repos_url": "https://api.github.com/users/oleg131/repos", "events_url": "https://api.github.com/users/oleg131/events{/privacy}", "received_events_url": "https://api.github.com/users/oleg131/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 993024953, "node_id": "MDU6TGFiZWw5OTMwMjQ5NTM=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/contributions%20welcome", "name": "contributions welcome", "color": "81f985", "default": false, "description": ""}, {"id": 2108671731, "node_id": "MDU6TGFiZWwyMTA4NjcxNzMx", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/Local%20Mode", "name": "Local Mode", "color": "9C61F7", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-02-19T02:19:32Z", "updated_at": "2022-04-20T00:45:49Z", "closed_at": "2022-04-20T00:45:49Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nRunning transformer in local mode fails with error\r\n\r\n```\r\nUnicodeEncodeError: 'latin-1' codec can't encode character '\\u2026' in position 1268: Body ('\u2026') is not valid Latin-1. Use body.encode('utf-8') if you want to send it encoded in UTF-8.\r\n```\r\n\r\n**To reproduce**\r\n- train a model in BYOC mode (since error occurs before any code is called from the container, any model will do)\r\n- create a transformer from trained estimator\r\n- call transform on transformer\r\n\r\n```\r\ntransformer = estimator.transformer(instance_count=1, instance_type='local')\r\npath = 'file:///home/path-to-data/'\r\ntransformer.transform(\r\n    path,\r\n    content_type='application/json'\r\n)\r\n```\r\n\r\n**Expected behavior**\r\nNo error\r\n\r\n**Screenshots or logs**\r\n```\r\n---------------------------------------------------------------------------\r\nUnicodeEncodeError                        Traceback (most recent call last)\r\n<ipython-input-42-b434e4fff40b> in <module>\r\n      1 transformer.transform(\r\n      2     path,\r\n----> 3     content_type='application/json'\r\n      4 )\r\n\r\n~/anaconda3/lib/python3.7/site-packages/sagemaker/transformer.py in transform(self, data, data_type, content_type, compression_type, split_type, job_name, input_filter, output_filter, join_source, experiment_config, model_client_config, wait, logs)\r\n    212             join_source,\r\n    213             experiment_config,\r\n--> 214             model_client_config,\r\n    215         )\r\n    216 \r\n\r\n~/anaconda3/lib/python3.7/site-packages/sagemaker/transformer.py in start_new(cls, transformer, data, data_type, content_type, compression_type, split_type, input_filter, output_filter, join_source, experiment_config, model_client_config)\r\n    364             model_client_config,\r\n    365         )\r\n--> 366         transformer.sagemaker_session.transform(**transform_args)\r\n    367 \r\n    368         return cls(transformer.sagemaker_session, transformer._current_job_name)\r\n\r\n~/anaconda3/lib/python3.7/site-packages/sagemaker/session.py in transform(self, job_name, model_name, strategy, max_concurrent_transforms, max_payload, env, input_config, output_config, resource_config, experiment_config, tags, data_processing, model_client_config)\r\n   2420         LOGGER.info(\"Creating transform job with name: %s\", job_name)\r\n   2421         LOGGER.debug(\"Transform request: %s\", json.dumps(transform_request, indent=4))\r\n-> 2422         self.sagemaker_client.create_transform_job(**transform_request)\r\n   2423 \r\n   2424     def _create_model_request(\r\n\r\n~/anaconda3/lib/python3.7/site-packages/sagemaker/local/local_session.py in create_transform_job(self, TransformJobName, ModelName, TransformInput, TransformOutput, TransformResources, **kwargs)\r\n    232         transform_job = _LocalTransformJob(TransformJobName, ModelName, self.sagemaker_session)\r\n    233         LocalSagemakerClient._transform_jobs[TransformJobName] = transform_job\r\n--> 234         transform_job.start(TransformInput, TransformOutput, TransformResources, **kwargs)\r\n    235 \r\n    236     def describe_transform_job(self, TransformJobName):\r\n\r\n~/anaconda3/lib/python3.7/site-packages/sagemaker/local/entities.py in start(self, input_data, output_data, transform_resources, **kwargs)\r\n    314 \r\n    315         # run the batch inference requests\r\n--> 316         self._perform_batch_inference(input_data, output_data, **kwargs)\r\n    317         self.end_time = datetime.datetime.now()\r\n    318         self.state = self._COMPLETED\r\n\r\n~/anaconda3/lib/python3.7/site-packages/sagemaker/local/entities.py in _perform_batch_inference(self, input_data, output_data, **kwargs)\r\n    478                     # call the container and add the result to inference.\r\n    479                     response = self.local_session.sagemaker_runtime_client.invoke_endpoint(\r\n--> 480                         item, \"\", input_data[\"ContentType\"], accept\r\n    481                     )\r\n    482 \r\n\r\n~/anaconda3/lib/python3.7/site-packages/sagemaker/local/local_session.py in invoke_endpoint(self, Body, EndpointName, ContentType, Accept, CustomAttributes, TargetModel, TargetVariant)\r\n    457             headers[\"X-Amzn-SageMaker-Target-Variant\"] = TargetVariant\r\n    458 \r\n--> 459         r = self.http.request(\"POST\", url, body=Body, preload_content=False, headers=headers)\r\n    460 \r\n    461         return {\"Body\": r, \"ContentType\": Accept}\r\n\r\n~/anaconda3/lib/python3.7/site-packages/urllib3/request.py in request(self, method, url, fields, headers, **urlopen_kw)\r\n     78         else:\r\n     79             return self.request_encode_body(\r\n---> 80                 method, url, fields=fields, headers=headers, **urlopen_kw\r\n     81             )\r\n     82 \r\n\r\n~/anaconda3/lib/python3.7/site-packages/urllib3/request.py in request_encode_body(self, method, url, fields, headers, encode_multipart, multipart_boundary, **urlopen_kw)\r\n    169         extra_kw.update(urlopen_kw)\r\n    170 \r\n--> 171         return self.urlopen(method, url, **extra_kw)\r\n\r\n~/anaconda3/lib/python3.7/site-packages/urllib3/poolmanager.py in urlopen(self, method, url, redirect, **kw)\r\n    334             response = conn.urlopen(method, url, **kw)\r\n    335         else:\r\n--> 336             response = conn.urlopen(method, u.request_uri, **kw)\r\n    337 \r\n    338         redirect_location = redirect and response.get_redirect_location()\r\n\r\n~/anaconda3/lib/python3.7/site-packages/urllib3/connectionpool.py in urlopen(self, method, url, body, headers, retries, redirect, assert_same_host, timeout, pool_timeout, release_conn, chunked, body_pos, **response_kw)\r\n    675                 body=body,\r\n    676                 headers=headers,\r\n--> 677                 chunked=chunked,\r\n    678             )\r\n    679 \r\n\r\n~/anaconda3/lib/python3.7/site-packages/urllib3/connectionpool.py in _make_request(self, conn, method, url, timeout, chunked, **httplib_request_kw)\r\n    390             conn.request_chunked(method, url, **httplib_request_kw)\r\n    391         else:\r\n--> 392             conn.request(method, url, **httplib_request_kw)\r\n    393 \r\n    394         # Reset the timeout for the recv() on the socket\r\n\r\n~/anaconda3/lib/python3.7/http/client.py in request(self, method, url, body, headers, encode_chunked)\r\n   1242                 encode_chunked=False):\r\n   1243         \"\"\"Send a complete request to the server.\"\"\"\r\n-> 1244         self._send_request(method, url, body, headers, encode_chunked)\r\n   1245 \r\n   1246     def _send_request(self, method, url, body, headers, encode_chunked):\r\n\r\n~/anaconda3/lib/python3.7/http/client.py in _send_request(self, method, url, body, headers, encode_chunked)\r\n   1287             # RFC 2616 Section 3.7.1 says that text default has a\r\n   1288             # default charset of iso-8859-1.\r\n-> 1289             body = _encode(body, 'body')\r\n   1290         self.endheaders(body, encode_chunked=encode_chunked)\r\n   1291 \r\n\r\n~/anaconda3/lib/python3.7/http/client.py in _encode(data, name)\r\n    168             \"%s (%.20r) is not valid Latin-1. Use %s.encode('utf-8') \"\r\n    169             \"if you want to send it encoded in UTF-8.\" %\r\n--> 170             (name.title(), data[err.start:err.end], name)) from None\r\n    171 \r\n    172 \r\n\r\nUnicodeEncodeError: 'latin-1' codec can't encode character '\\u2026' in position 1268: Body ('\u2026') is not valid Latin-1. Use body.encode('utf-8') if you want to send it encoded in UTF-8.\r\n\r\n```\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.24.5\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: BYOC\r\n- **Framework version**:\r\n- **Python version**: 3.7.4\r\n- **CPU or GPU**: CPU but not applicable\r\n- **Custom Docker image (Y/N)**: Y\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2165/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2165/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2144", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2144/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2144/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2144/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2144", "id": 808357697, "node_id": "MDU6SXNzdWU4MDgzNTc2OTc=", "number": 2144, "title": "SM Pipelines ParameterInteger default value set to 0 is not generated in the JSON definition", "user": {"login": "giuseppeporcelli", "id": 7733029, "node_id": "MDQ6VXNlcjc3MzMwMjk=", "avatar_url": "https://avatars.githubusercontent.com/u/7733029?v=4", "gravatar_id": "", "url": "https://api.github.com/users/giuseppeporcelli", "html_url": "https://github.com/giuseppeporcelli", "followers_url": "https://api.github.com/users/giuseppeporcelli/followers", "following_url": "https://api.github.com/users/giuseppeporcelli/following{/other_user}", "gists_url": "https://api.github.com/users/giuseppeporcelli/gists{/gist_id}", "starred_url": "https://api.github.com/users/giuseppeporcelli/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/giuseppeporcelli/subscriptions", "organizations_url": "https://api.github.com/users/giuseppeporcelli/orgs", "repos_url": "https://api.github.com/users/giuseppeporcelli/repos", "events_url": "https://api.github.com/users/giuseppeporcelli/events{/privacy}", "received_events_url": "https://api.github.com/users/giuseppeporcelli/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2790730452, "node_id": "MDU6TGFiZWwyNzkwNzMwNDUy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/component:%20pipelines", "name": "component: pipelines", "color": "45AD34", "default": false, "description": "Relates to the SageMaker Pipeline Platform"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-02-15T09:25:59Z", "updated_at": "2021-05-25T16:07:31Z", "closed_at": "2021-05-25T16:07:31Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**Describe the bug**\r\nWhen creating a ParameterInteger whose default value is set to 0, the default value is not generated in the pipeline JSON definition.\r\n\r\n**To reproduce**\r\nSimply create a ParameterInteger with default value set to 0 similarly to the following one:\r\n\r\n`ParameterInteger(name=\"silent\", default_value=0)`\r\n\r\nThen, generate the JSON definition and you will find:\r\n\r\n`{'Name': 'silent', 'Type': 'Integer'},`\r\n\r\n**Expected behavior**\r\nThe generated JSON definition should include the default value. Example:\r\n\r\n`{'Name': 'silent', 'Type': 'Integer', 'DefaultValue': 0},`\r\n\r\n**Screenshots or logs**\r\nN/A\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.24.5\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: N/A\r\n- **Framework version**: N/A\r\n- **Python version**: 3.7.6\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\nN/A\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2144/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2144/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2123", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2123/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2123/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2123/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2123", "id": 800645852, "node_id": "MDU6SXNzdWU4MDA2NDU4NTI=", "number": 2123, "title": "RegisterModel or TensorFlowModel.register lost the inference behavior", "user": {"login": "ruyyi0323", "id": 31749673, "node_id": "MDQ6VXNlcjMxNzQ5Njcz", "avatar_url": "https://avatars.githubusercontent.com/u/31749673?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ruyyi0323", "html_url": "https://github.com/ruyyi0323", "followers_url": "https://api.github.com/users/ruyyi0323/followers", "following_url": "https://api.github.com/users/ruyyi0323/following{/other_user}", "gists_url": "https://api.github.com/users/ruyyi0323/gists{/gist_id}", "starred_url": "https://api.github.com/users/ruyyi0323/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ruyyi0323/subscriptions", "organizations_url": "https://api.github.com/users/ruyyi0323/orgs", "repos_url": "https://api.github.com/users/ruyyi0323/repos", "events_url": "https://api.github.com/users/ruyyi0323/events{/privacy}", "received_events_url": "https://api.github.com/users/ruyyi0323/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 892238348, "node_id": "MDU6TGFiZWw4OTIyMzgzNDg=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/type:%20documentation", "name": "type: documentation", "color": "002b36", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 16, "created_at": "2021-02-03T19:45:50Z", "updated_at": "2021-04-22T15:31:00Z", "closed_at": "2021-03-09T20:59:10Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nI am using the template project and intend to create and deploy a keras model which has customized preprocessing script. In order to do that I squeeze the preprocessing script inside the inference.py as described in https://sagemaker.readthedocs.io/en/stable/frameworks/tensorflow/deploying_tensorflow_serving.html, created model works as expected when I tried to use `TensorFlowModel` model independently, but when I deploy from the model package arn which registered from pipeline, it seems not behaving as expected.\r\n\r\n**To reproduce**\r\nMy pipeline looks like this\r\n```\r\n- step_data_ingest\r\n- step_feature_engineering\r\n- step_data_validation\r\n- step_train (shows below)\r\n- output_path = f\"{experiment_package_s3_dir}/model\"\r\n\r\n    xx_estimator = TensorFlow(\r\n        entry_point='train.py',\r\n        source_dir='pipelines/abalone/src', # this should be just \"source\" for your code\r\n        role=role,\r\n        image_uri=\"763104351884.dkr.ecr.us-east-1.amazonaws.com/tensorflow-training:2.3.1-cpu-py37-ubuntu18.04\",\r\n        instance_count=1,\r\n        model_dir=False,\r\n        instance_type=training_instance_type,\r\n        output_path = output_path, # all training step output (include debug etc.)\r\n        sagemaker_session=sagemaker_session,\r\n        container_log_level=10, # 10 debug 20 info 30 warning 40 error\r\n        base_job_name=f\"{base_job_prefix}-model-train\",\r\n        hyperparameters={\r\n            \"epochs\": 5,\r\n            \"batch_size\": 256,\r\n            \"early_stop_patience\": 10,\r\n            \"country\": country\r\n        }\r\n    )\r\n    step_train = TrainingStep(\r\n        name=\"TrainxxModel\",\r\n        estimator=xx_estimator,\r\n        inputs={\r\n            \"train\": TrainingInput(\r\n                s3_data=step_data_ingest.properties.ProcessingOutputConfig.Outputs[\r\n                    \"train\"\r\n                ].S3Output.S3Uri,\r\n                content_type=None,\r\n            ),\r\n            \"validation\": TrainingInput(\r\n                s3_data=step_data_ingest.properties.ProcessingOutputConfig.Outputs[\r\n                    \"validation\"\r\n                ].S3Output.S3Uri,\r\n                content_type=None,\r\n            ),\r\n            \"encoders\": TrainingInput(\r\n                s3_data=step_feature_engineering.properties.ProcessingOutputConfig.Outputs[\r\n                    \"encoders\"\r\n                ].S3Output.S3Uri,\r\n                content_type=None,\r\n            ),\r\n        },\r\n    )\r\n\r\n- step_model_eval\r\n- step_register\r\n\r\n    step_register = RegisterModel(\r\n        name=\"RegisterxxModel\",\r\n        estimator=xx_estimator,\r\n        model_data=step_train.properties.ModelArtifacts.S3ModelArtifacts,\r\n        image_uri=\"763104351884.dkr.ecr.us-east-1.amazonaws.com/tensorflow-inference:2.3.1-cpu-py37-ubuntu18.04\",\r\n        content_types=[\"application/json\", \"text/csv\"],\r\n        response_types=[\"application/json\", \"text/csv\"],\r\n        inference_instances=[\"ml.m5.large\"],\r\n        transform_instances=[\"ml.m5.large\"],\r\n        model_package_group_name=model_package_group_name,\r\n        approval_status=model_approval_status,\r\n        source_dir='pipelines/abalone/src',\r\n        entry_point=\"inference.py\",\r\n        model_metrics=salary_model_metrics,\r\n        role=role,\r\n    )\r\n\r\n```\r\n\r\ninside the inference.py, I have defined several setup outside of the handler method, looks like this\r\n\r\n```\r\nimport xxx\r\n\r\nsetup encoders\r\nload model\r\n\r\ndef handler\r\n   process input\r\n   model predict\r\n   processing output\r\n\r\ndef _processing_input\r\n    encoders do feature transform\r\n\r\ndef _processing_output\r\n\r\n```\r\n\r\n**Expected behavior**\r\nThe registerred model will take input, log and execute the feature transform and give back proper prediction after being deployed\r\n\r\n**Screenshots or logs**\r\nIf applicable, add screenshots or logs to help explain your problem.\r\n- if I deploy model this way, it works\r\n```\r\n## A. The working one\r\nxx_model = TensorFlowModel(\r\n    name=\"xxDebugModel\",\r\n    entry_point=\"inference.py\",\r\n    source_dir=\"../pipelines/abalone/src\",\r\n    image_uri=image_uri,\r\n    model_data=model_data,\r\n    sagemaker_session=sagemaker.Session(),\r\n    container_log_level=0,\r\n    role=role,\r\n)\r\ndisplay(xx_model.__dict__)\r\n```\r\n- These following ways won't work\r\n```\r\n## B. deploy from package created from xx_model.register\r\nmodel_package = xx_model.register(\r\n    content_types=[\"application/json\", \"text/csv\"],\r\n    response_types=[\"application/json\", \"text/csv\"],\r\n    inference_instances=[\"ml.m5.large\"],\r\n    transform_instances=[\"ml.m5.large\"],\r\n    model_package_group_name=\"xxPipeModelGroup\",\r\n    approval_status=\"Approved\",\r\n    model_metrics = xx_model_metrics,\r\n    description=f\"Registered from XX Model Experiement Pack: {experiment_package_s3_dir}\"\r\n)\r\nmodel_package.deploy(\r\n    initial_instance_count=1,\r\n    instance_type=\"ml.m5.large\",\r\n    endpoint_name=\"xxDebugModelPackDeploy\"\r\n)\r\n\r\n## C. deploy from package registerred after pipeline, these two methods shows same behavior\r\nmodel_package_from_arn = sagemaker.ModelPackage(\r\n    role=role,\r\n    model_package_arn = \"arn:aws:sagemaker:us-east-1:104436464649:model-package/xxx-us/5\"\r\n)\r\nmodel_package_from_arn.deploy(\r\n    initial_instance_count=1,\r\n    instance_type=\"ml.m5.large\",\r\n    endpoint_name=\"xxDebugModelPackARNDeploy\"\r\n)\r\n```\r\n\r\nA shows logs like this\r\n```\r\n// [from tensorflow serving] loading model\r\n// [from inference.py] load encoders\r\n// [from inference.py] setting up\r\n// [from tensorflow serving] entering event loop (ping...ping...)\r\n```\r\n\r\nB and C shows similar logs\r\n```\r\n// [from tensorflow serving] loading model\r\n// [from tensorflow serving] entering event loop (ping...ping...)\r\n```\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**:\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: Tensorflow\r\n- **Framework version**: 2.3\r\n- **Python version**: 3.7\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\n- For privacy, I masked the variable names, it may be having typos, but you can assume all of them are correct.\r\n- I don't know how to find the log at the instance beginning time, if someone can help I can grab those logs\r\n\r\nOther issues found:\r\n1. I can't initiate CreateModelStep through TensorFlowModel, shoots an error about S3ModelArtifacts\r\n2. When I try to deploy the model using A way, I have to do that twice, the first time it shoots back an error saying I used duplicated tags for sagamaker-project or whatever, and I can't mask that out.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2123/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2123/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2112", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2112/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2112/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2112/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2112", "id": 796162750, "node_id": "MDU6SXNzdWU3OTYxNjI3NTA=", "number": 2112, "title": "XGBoostModel attempts to deploy the wrong model object", "user": {"login": "akozd", "id": 24705981, "node_id": "MDQ6VXNlcjI0NzA1OTgx", "avatar_url": "https://avatars.githubusercontent.com/u/24705981?v=4", "gravatar_id": "", "url": "https://api.github.com/users/akozd", "html_url": "https://github.com/akozd", "followers_url": "https://api.github.com/users/akozd/followers", "following_url": "https://api.github.com/users/akozd/following{/other_user}", "gists_url": "https://api.github.com/users/akozd/gists{/gist_id}", "starred_url": "https://api.github.com/users/akozd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/akozd/subscriptions", "organizations_url": "https://api.github.com/users/akozd/orgs", "repos_url": "https://api.github.com/users/akozd/repos", "events_url": "https://api.github.com/users/akozd/events{/privacy}", "received_events_url": "https://api.github.com/users/akozd/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-01-28T16:31:22Z", "updated_at": "2022-04-20T01:17:22Z", "closed_at": "2022-04-20T01:17:22Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nA clear and concise description of what the bug is.\r\n\r\n**To reproduce**\r\nA clear, step-by-step set of instructions to reproduce the bug.\r\n\r\nThis bug can be reproduced by trying to create a XGBoostModel object from an artifact and trying to deploy it:\r\n\r\n```python\r\nfrom sagemaker.xgboost.model import XGBoostModel\r\n\r\n# grab the model artifact that was written out by the local training job\r\ns3_model_artifact = estimator.latest_training_job.describe()['ModelArtifacts']['S3ModelArtifacts']\r\nprint(s3_model_artifact) # output: s3://sagemaker-us-east-1-111111111111/neo-demo/sagemaker-xgboost-2021-01-28-14-48-59-995/model.tar.gz\r\nxgboost_model = XGBoostModel(\r\n    model_data=s3_model_artifact,\r\n    role=role,\r\n    entry_point='entrypoint.py',\r\n    framework_version='0.90-2',\r\n)\r\nxgboost_model.deploy(\r\n    initial_instance_count = 1, \r\n    instance_type='ml.c5.large',\r\n    endpoint_name='unoptimized-c5'\r\n)\r\n```\r\n\r\nResult:\r\n\r\n```python\r\nClientError: An error occurred (ValidationException) when calling the CreateEndpoint operation: Could not find model \"arn:aws:sagemaker:us-east-1:111111111111:model/xgboost-neo-ml-c5-ml-c5-2021-01-26-21-18-17-222\".\r\n```\r\n\r\n**Expected behavior**\r\nA clear and concise description of what you expected to happen.\r\n\r\nI was expecting my model to be deployed.\r\n\r\n**Screenshots or logs**\r\nIf applicable, add screenshots or logs to help explain your problem.\r\n\r\nStack trace:\r\n\r\n```python\r\n---------------------------------------------------------------------------\r\nClientError                               Traceback (most recent call last)\r\n<ipython-input-41-5bde12cc30e3> in <module>\r\n     13     initial_instance_count = 1,\r\n     14     instance_type='ml.c5.large',\r\n---> 15     endpoint_name='unoptimized-c5'\r\n     16 )\r\n\r\n~/anaconda3/envs/python3/lib/python3.6/site-packages/sagemaker/model.py in deploy(self, initial_instance_count, instance_type, serializer, deserializer, accelerator_type, endpoint_name, tags, kms_key, wait, data_capture_config, **kwargs)\r\n    772                 predictor.deserializer = deserializer\r\n    773             return predictor\r\n--> 774         return None\r\n    775 \r\n    776     def transformer(\r\n\r\n~/anaconda3/envs/python3/lib/python3.6/site-packages/sagemaker/session.py in endpoint_from_production_variants(self, name, production_variants, tags, kms_key, wait, data_capture_config_dict)\r\n   3502             role = re.sub(\r\n   3503                 r\"^(.+)sts::(\\d+):assumed-role/(.+?)/.*$\",\r\n-> 3504                 r\"\\1iam::\\2:role/service-role/\\3\",\r\n   3505                 assumed_role,\r\n   3506             )\r\n\r\n~/anaconda3/envs/python3/lib/python3.6/site-packages/sagemaker/session.py in create_endpoint(self, endpoint_name, config_name, tags, wait)\r\n   2993 \r\n   2994     def delete_endpoint(self, endpoint_name):\r\n-> 2995         \"\"\"Delete an Amazon SageMaker ``Endpoint``.\r\n   2996 \r\n   2997         Args:\r\n\r\n~/anaconda3/envs/python3/lib/python3.6/site-packages/botocore/client.py in _api_call(self, *args, **kwargs)\r\n    355                     \"%s() only accepts keyword arguments.\" % py_operation_name)\r\n    356             # The \"self\" in this scope is referring to the BaseClient.\r\n--> 357             return self._make_api_call(operation_name, kwargs)\r\n    358 \r\n    359         _api_call.__name__ = str(py_operation_name)\r\n\r\n~/anaconda3/envs/python3/lib/python3.6/site-packages/botocore/client.py in _make_api_call(self, operation_name, api_params)\r\n    674             error_code = parsed_response.get(\"Error\", {}).get(\"Code\")\r\n    675             error_class = self.exceptions.from_code(error_code)\r\n--> 676             raise error_class(parsed_response, operation_name)\r\n    677         else:\r\n    678             return parsed_response\r\n\r\nClientError: An error occurred (ValidationException) when calling the CreateEndpoint operation: Could not find model \"arn:aws:sagemaker:us-east-1:111111111111:model/xgboost-neo-ml-c5-ml-c5-2021-01-26-21-18-17-222\".\r\n```\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.19.0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: xgboost\r\n- **Framework version**: 0.90-2\r\n- **Python version**: 3.6.10\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2112/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2112/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2110", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2110/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2110/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2110/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2110", "id": 795447113, "node_id": "MDU6SXNzdWU3OTU0NDcxMTM=", "number": 2110, "title": "FeatureGroup ingest() function does not support NA.", "user": {"login": "alex-tang", "id": 11010958, "node_id": "MDQ6VXNlcjExMDEwOTU4", "avatar_url": "https://avatars.githubusercontent.com/u/11010958?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alex-tang", "html_url": "https://github.com/alex-tang", "followers_url": "https://api.github.com/users/alex-tang/followers", "following_url": "https://api.github.com/users/alex-tang/following{/other_user}", "gists_url": "https://api.github.com/users/alex-tang/gists{/gist_id}", "starred_url": "https://api.github.com/users/alex-tang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alex-tang/subscriptions", "organizations_url": "https://api.github.com/users/alex-tang/orgs", "repos_url": "https://api.github.com/users/alex-tang/repos", "events_url": "https://api.github.com/users/alex-tang/events{/privacy}", "received_events_url": "https://api.github.com/users/alex-tang/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-01-27T21:12:04Z", "updated_at": "2021-02-25T04:43:52Z", "closed_at": "2021-02-25T04:43:42Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**Describe the bug**\r\nThe FeatureGroup class's `ingest()` function does not support Pandas 'NA' values for Integral and Fractional types.\r\n\r\n**To reproduce**\r\nCreate a pandas dataframe with integral, fractional, and string types (int, float, string). Add pandas NA values to some cells. Create a FeatureGroup instance and invoke the ingest() method.\r\n\r\nSee that the NA is being parsed as the string \"NA\" and provided to the SageMaker Feature Store PutRecord API, which is invalid.\r\n\r\n**Expected behavior**\r\nThe pandas constant NA should be ignored for any feature type when generating a feature value for the record in the PutRecord API.\r\n\r\n**Screenshots or logs**\r\nN/A\r\n\r\n**System information**\r\nN/A\r\n\r\n**Additional context**\r\nN/A\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2110/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2110/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2089", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2089/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2089/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2089/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2089", "id": 786408647, "node_id": "MDU6SXNzdWU3ODY0MDg2NDc=", "number": 2089, "title": "sagemaker.get_execution_role() returns incorrect ARN", "user": {"login": "hughack", "id": 55732582, "node_id": "MDQ6VXNlcjU1NzMyNTgy", "avatar_url": "https://avatars.githubusercontent.com/u/55732582?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hughack", "html_url": "https://github.com/hughack", "followers_url": "https://api.github.com/users/hughack/followers", "following_url": "https://api.github.com/users/hughack/following{/other_user}", "gists_url": "https://api.github.com/users/hughack/gists{/gist_id}", "starred_url": "https://api.github.com/users/hughack/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hughack/subscriptions", "organizations_url": "https://api.github.com/users/hughack/orgs", "repos_url": "https://api.github.com/users/hughack/repos", "events_url": "https://api.github.com/users/hughack/events{/privacy}", "received_events_url": "https://api.github.com/users/hughack/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 993024953, "node_id": "MDU6TGFiZWw5OTMwMjQ5NTM=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/contributions%20welcome", "name": "contributions welcome", "color": "81f985", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-01-14T23:12:00Z", "updated_at": "2021-03-08T21:55:19Z", "closed_at": "2021-03-08T21:55:19Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nI manually created an execution role for SageMaker Studio called `AmazonSageMaker-ExecutionRole-ap-southeast-2`\r\n\r\nCalling `sagemaker.get_execution_role()` within a SageMaker Studio Notebook returns the incorrect role ARN:\r\n\r\n```\r\narn:aws:iam::************:role/service-role/AmazonSageMaker-ExecutionRole-ap-southeast-2\r\n```\r\n\r\nActual ARN:\r\n\r\n```\r\narn:aws:iam::************:role/AmazonSageMaker-ExecutionRole-ap-southeast-2\r\n```\r\n\r\n**To reproduce**\r\nCreate role in CloudFormation:\r\n```yaml\r\n  SageMakerExecutionRole:\r\n      Type: \"AWS::IAM::Role\"\r\n      Properties:\r\n        RoleName: !Sub AmazonSageMaker-ExecutionRole-${AWS::Region}\r\n        AssumeRolePolicyDocument:\r\n          Version: 2012-10-17\r\n          Statement:\r\n            - Effect: Allow\r\n              Principal:\r\n                Service:\r\n                  - sagemaker.amazonaws.com\r\n                  - ecs-tasks.amazonaws.com\r\n              Action:\r\n                - \"sts:AssumeRole\"\r\n        Path: /\r\n        ManagedPolicyArns:\r\n          - arn:aws:iam::aws:policy/AmazonSageMakerFullAccess\r\n          - !Ref SageMakerExecutionPolicy\r\n```\r\n\r\nSetup SageMaker Studio with this role as execution role.\r\n\r\nOpen a notebook and run:\r\n\r\n```python\r\nfrom sagemaker import get_execution_role\r\nprint(get_execution_role())\r\n```\r\n\r\n**Expected behavior**\r\nOutput role ARN:\r\n```\r\narn:aws:iam::************:role/AmazonSageMaker-ExecutionRole-ap-southeast-2\r\n```\r\nActual output:\r\n```\r\narn:aws:iam::************:role/service-role/AmazonSageMaker-ExecutionRole-ap-southeast-2\r\n```\r\n\r\nNote addition of `service-role/`.\r\n\r\n**Additional context**\r\nLooks like this line is the culprit:\r\n\r\nhttps://github.com/aws/sagemaker-python-sdk/blob/1fdefe06068e5eaf9f63287737d55db96ecc12cf/src/sagemaker/session.py#L3501\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2089/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2089/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2072", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2072/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2072/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2072/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2072", "id": 780881672, "node_id": "MDU6SXNzdWU3ODA4ODE2NzI=", "number": 2072, "title": "[Bug] sagemaker should not toggle global logging facilities", "user": {"login": "yifeim", "id": 8949994, "node_id": "MDQ6VXNlcjg5NDk5OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/8949994?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yifeim", "html_url": "https://github.com/yifeim", "followers_url": "https://api.github.com/users/yifeim/followers", "following_url": "https://api.github.com/users/yifeim/following{/other_user}", "gists_url": "https://api.github.com/users/yifeim/gists{/gist_id}", "starred_url": "https://api.github.com/users/yifeim/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yifeim/subscriptions", "organizations_url": "https://api.github.com/users/yifeim/orgs", "repos_url": "https://api.github.com/users/yifeim/repos", "events_url": "https://api.github.com/users/yifeim/events{/privacy}", "received_events_url": "https://api.github.com/users/yifeim/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-01-06T22:15:45Z", "updated_at": "2021-01-12T20:31:03Z", "closed_at": "2021-01-12T20:31:03Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "After importing sagemaker, all my warning messages disappear. Here is a reproducible example:\r\n```\r\nimport sagemaker, warnings # order does not matter\r\nwarnings.warn('this important warning message cannot be seen')\r\n```\r\n\r\nAfter some digging, I found this line of code to be particularly suspicious:\r\n\r\nhttps://github.com/aws/sagemaker-python-sdk/blame/master/src/sagemaker/deprecations.py#L19\r\n\r\nI was wondering if there is another way to achieve the desired effects without unexpected and potentially significant consequences. Thanks.", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2072/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2072/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2021", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2021/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2021/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2021/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/2021", "id": 760476738, "node_id": "MDU6SXNzdWU3NjA0NzY3Mzg=", "number": 2021, "title": "[bug] incorrect sparkml-serving.json format", "user": {"login": "DyfanJones", "id": 23235152, "node_id": "MDQ6VXNlcjIzMjM1MTUy", "avatar_url": "https://avatars.githubusercontent.com/u/23235152?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DyfanJones", "html_url": "https://github.com/DyfanJones", "followers_url": "https://api.github.com/users/DyfanJones/followers", "following_url": "https://api.github.com/users/DyfanJones/following{/other_user}", "gists_url": "https://api.github.com/users/DyfanJones/gists{/gist_id}", "starred_url": "https://api.github.com/users/DyfanJones/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DyfanJones/subscriptions", "organizations_url": "https://api.github.com/users/DyfanJones/orgs", "repos_url": "https://api.github.com/users/DyfanJones/repos", "events_url": "https://api.github.com/users/DyfanJones/events{/privacy}", "received_events_url": "https://api.github.com/users/DyfanJones/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-12-09T16:26:16Z", "updated_at": "2020-12-23T19:21:47Z", "closed_at": "2020-12-23T19:21:47Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\n\r\nWhen trying to get spark-serving version 2.4,  `image_uris.retrieve` return the following message:\r\n```\r\n# Defaulting to the only supported framework/algorithm version: 2.2. Ignoring framework/algorithm version: 2.4.\r\n```\r\nI believe this is because the json: https://github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/image_uri_config/sparkml-serving.json is formatted incorrectly.  I believe this give the following json levels.\r\n\r\nJson levels:\r\n- scope\r\n- versions:\r\n    - 2.2\r\n- 2.4\r\n\r\n**To reproduce**\r\n\r\n```\r\nimport sagemaker\r\nsagemaker.__version__\r\n#  '2.4.1'\r\n\r\nfrom sagemaker import image_uris\r\nimage_uris.retrieve(\"sparkml-serving\", \"eu-west-1\", version=\"2.4\")\r\n\r\n# Defaulting to the only supported framework/algorithm version: 2.2. Ignoring framework/algorithm version: 2.4.\r\n# '141502667606.dkr.ecr.eu-west-1.amazonaws.com/sagemaker-sparkml-serving:2.2'\r\n```\r\n\r\nThe correct json format should be as follows:\r\n\r\n```\r\n{\r\n    \"scope\": [\"inference\"],\r\n    \"versions\": {\r\n        \"2.2\": {\r\n            \"registries\": {\r\n                \"af-south-1\": \"510948584623\",\r\n                \"ap-east-1\": \"651117190479\",\r\n                \"ap-northeast-1\": \"354813040037\",\r\n                \"ap-northeast-2\": \"366743142698\",\r\n                \"ap-south-1\": \"720646828776\",\r\n                \"ap-southeast-1\": \"121021644041\",\r\n                \"ap-southeast-2\": \"783357654285\",\r\n                \"ca-central-1\": \"341280168497\",\r\n                \"cn-north-1\": \"450853457545\",\r\n                \"cn-northwest-1\": \"451049120500\",\r\n                \"eu-central-1\": \"492215442770\",\r\n                \"eu-north-1\": \"662702820516\",\r\n                \"eu-west-1\": \"141502667606\",\r\n                \"eu-west-2\": \"764974769150\",\r\n                \"eu-west-3\": \"659782779980\",\r\n                \"eu-south-1\": \"978288397137\",\r\n                \"me-south-1\": \"801668240914\",\r\n                \"sa-east-1\": \"737474898029\",\r\n                \"us-east-1\": \"683313688378\",\r\n                \"us-east-2\": \"257758044811\",\r\n                \"us-gov-west-1\": \"414596584902\",\r\n                \"us-iso-east-1\": \"833128469047\",\r\n                \"us-west-1\": \"746614075791\",\r\n                \"us-west-2\": \"246618743249\"\r\n            },\r\n            \"repository\": \"sagemaker-sparkml-serving\"\r\n        },\r\n        \"2.4\": {\r\n            \"registries\": {\r\n                \"af-south-1\": \"510948584623\",\r\n                \"ap-east-1\": \"651117190479\",\r\n                \"ap-northeast-1\": \"354813040037\",\r\n                \"ap-northeast-2\": \"366743142698\",\r\n                \"ap-south-1\": \"720646828776\",\r\n                \"ap-southeast-1\": \"121021644041\",\r\n                \"ap-southeast-2\": \"783357654285\",\r\n                \"ca-central-1\": \"341280168497\",\r\n                \"cn-north-1\": \"450853457545\",\r\n                \"cn-northwest-1\": \"451049120500\",\r\n                \"eu-central-1\": \"492215442770\",\r\n                \"eu-north-1\": \"662702820516\",\r\n                \"eu-west-1\": \"141502667606\",\r\n                \"eu-west-2\": \"764974769150\",\r\n                \"eu-west-3\": \"659782779980\",\r\n                \"eu-south-1\": \"978288397137\",\r\n                \"me-south-1\": \"801668240914\",\r\n                \"sa-east-1\": \"737474898029\",\r\n                \"us-east-1\": \"683313688378\",\r\n                \"us-east-2\": \"257758044811\",\r\n                \"us-gov-west-1\": \"414596584902\",\r\n                \"us-iso-east-1\": \"833128469047\",\r\n                \"us-west-1\": \"746614075791\",\r\n                \"us-west-2\": \"246618743249\"\r\n            },\r\n            \"repository\": \"sagemaker-sparkml-serving\"\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nThis should return json levels:\r\n- scope\r\n- versions:\r\n    - 2.2\r\n    - 2.4\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2021/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2021/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2012", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2012/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2012/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2012/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/pull/2012", "id": 755554900, "node_id": "MDExOlB1bGxSZXF1ZXN0NTMxMjQ0MzE2", "number": 2012, "title": "fix: check for distributions in TF estimator", "user": {"login": "ajaykarpur", "id": 5490371, "node_id": "MDQ6VXNlcjU0OTAzNzE=", "avatar_url": "https://avatars.githubusercontent.com/u/5490371?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ajaykarpur", "html_url": "https://github.com/ajaykarpur", "followers_url": "https://api.github.com/users/ajaykarpur/followers", "following_url": "https://api.github.com/users/ajaykarpur/following{/other_user}", "gists_url": "https://api.github.com/users/ajaykarpur/gists{/gist_id}", "starred_url": "https://api.github.com/users/ajaykarpur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ajaykarpur/subscriptions", "organizations_url": "https://api.github.com/users/ajaykarpur/orgs", "repos_url": "https://api.github.com/users/ajaykarpur/repos", "events_url": "https://api.github.com/users/ajaykarpur/events{/privacy}", "received_events_url": "https://api.github.com/users/ajaykarpur/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2108671742, "node_id": "MDU6TGFiZWwyMTA4NjcxNzQy", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/Tensorflow", "name": "Tensorflow", "color": "FF8F00", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2020-12-02T19:35:17Z", "updated_at": "2020-12-02T23:56:10Z", "closed_at": "2020-12-02T23:56:10Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/pulls/2012", "html_url": "https://github.com/aws/sagemaker-python-sdk/pull/2012", "diff_url": "https://github.com/aws/sagemaker-python-sdk/pull/2012.diff", "patch_url": "https://github.com/aws/sagemaker-python-sdk/pull/2012.patch", "merged_at": "2020-12-02T23:56:09Z"}, "body": "*Description of changes:*\r\nCall `deprecations.renamed_kwargs` to check for the `distributions` keyword argument in the TensorFlow Estimator.\r\n\r\n## Merge Checklist\r\n\r\n_Put an `x` in the boxes that apply. You can also fill these out after creating the PR. If you're unsure about any of them, don't hesitate to ask. We're here to help! This is simply a reminder of what we are going to look for before merging your pull request._\r\n\r\n#### General\r\n\r\n- [x] I have read the [CONTRIBUTING](https://github.com/aws/sagemaker-python-sdk/blob/master/CONTRIBUTING.md) doc\r\n- [x] I used the commit message format described in [CONTRIBUTING](https://github.com/aws/sagemaker-python-sdk/blob/master/CONTRIBUTING.md#committing-your-change)\r\n- [ ] I have passed the region in to all S3 and STS clients that I've initialized as part of this change.\r\n- [ ] I have updated any necessary documentation, including [READMEs](https://github.com/aws/sagemaker-python-sdk/blob/master/README.rst) and [API docs](https://github.com/aws/sagemaker-python-sdk/tree/master/doc) (if appropriate)\r\n\r\n#### Tests\r\n\r\n- [ ] I have added tests that prove my fix is effective or that my feature works (if appropriate)\r\n- [ ] I have checked that my tests are not configured for a specific region or account (if appropriate)\r\n- [ ] I have used [`unique_name_from_base`](https://github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/utils.py#L77) to create resource names in integ tests (if appropriate)\r\n\r\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2012/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/2012/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1980", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1980/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1980/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1980/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/pull/1980", "id": 737346318, "node_id": "MDExOlB1bGxSZXF1ZXN0NTE2NDA1NDQ0", "number": 1980, "title": "fix: create default bucket only if needed", "user": {"login": "ajaykarpur", "id": 5490371, "node_id": "MDQ6VXNlcjU0OTAzNzE=", "avatar_url": "https://avatars.githubusercontent.com/u/5490371?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ajaykarpur", "html_url": "https://github.com/ajaykarpur", "followers_url": "https://api.github.com/users/ajaykarpur/followers", "following_url": "https://api.github.com/users/ajaykarpur/following{/other_user}", "gists_url": "https://api.github.com/users/ajaykarpur/gists{/gist_id}", "starred_url": "https://api.github.com/users/ajaykarpur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ajaykarpur/subscriptions", "organizations_url": "https://api.github.com/users/ajaykarpur/orgs", "repos_url": "https://api.github.com/users/ajaykarpur/repos", "events_url": "https://api.github.com/users/ajaykarpur/events{/privacy}", "received_events_url": "https://api.github.com/users/ajaykarpur/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-11-05T23:44:37Z", "updated_at": "2020-11-06T17:29:09Z", "closed_at": "2020-11-06T17:29:08Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/pulls/1980", "html_url": "https://github.com/aws/sagemaker-python-sdk/pull/1980", "diff_url": "https://github.com/aws/sagemaker-python-sdk/pull/1980.diff", "patch_url": "https://github.com/aws/sagemaker-python-sdk/pull/1980.patch", "merged_at": "2020-11-06T17:29:08Z"}, "body": "*Description of changes:*\r\nCreate the default bucket only if the `output_path` is `None`.\r\n\r\n*Testing done:*\r\n`tox -e black-format,py38 tests/unit/test_airflow.py`\r\n\r\n## Merge Checklist\r\n\r\n_Put an `x` in the boxes that apply. You can also fill these out after creating the PR. If you're unsure about any of them, don't hesitate to ask. We're here to help! This is simply a reminder of what we are going to look for before merging your pull request._\r\n\r\n#### General\r\n\r\n- [x] I have read the [CONTRIBUTING](https://github.com/aws/sagemaker-python-sdk/blob/master/CONTRIBUTING.md) doc\r\n- [x] I used the commit message format described in [CONTRIBUTING](https://github.com/aws/sagemaker-python-sdk/blob/master/CONTRIBUTING.md#committing-your-change)\r\n- [ ] I have passed the region in to all S3 and STS clients that I've initialized as part of this change.\r\n- [ ] I have updated any necessary documentation, including [READMEs](https://github.com/aws/sagemaker-python-sdk/blob/master/README.rst) and [API docs](https://github.com/aws/sagemaker-python-sdk/tree/master/doc) (if appropriate)\r\n\r\n#### Tests\r\n\r\n- [ ] I have added tests that prove my fix is effective or that my feature works (if appropriate)\r\n- [ ] I have checked that my tests are not configured for a specific region or account (if appropriate)\r\n- [ ] I have used [`unique_name_from_base`](https://github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/utils.py#L77) to create resource names in integ tests (if appropriate)\r\n\r\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1980/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1980/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1978", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1978/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1978/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1978/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1978", "id": 733652757, "node_id": "MDU6SXNzdWU3MzM2NTI3NTc=", "number": 1978, "title": "Intermittent broken pipe error while waiting for endpoint", "user": {"login": "pinaraws", "id": 47152339, "node_id": "MDQ6VXNlcjQ3MTUyMzM5", "avatar_url": "https://avatars.githubusercontent.com/u/47152339?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pinaraws", "html_url": "https://github.com/pinaraws", "followers_url": "https://api.github.com/users/pinaraws/followers", "following_url": "https://api.github.com/users/pinaraws/following{/other_user}", "gists_url": "https://api.github.com/users/pinaraws/gists{/gist_id}", "starred_url": "https://api.github.com/users/pinaraws/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pinaraws/subscriptions", "organizations_url": "https://api.github.com/users/pinaraws/orgs", "repos_url": "https://api.github.com/users/pinaraws/repos", "events_url": "https://api.github.com/users/pinaraws/events{/privacy}", "received_events_url": "https://api.github.com/users/pinaraws/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 749522466, "node_id": "MDU6TGFiZWw3NDk1MjI0NjY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/type:%20question", "name": "type: question", "color": "d876e3", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-10-31T06:54:06Z", "updated_at": "2021-02-27T01:02:11Z", "closed_at": "2021-02-27T01:02:11Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "**Describe the bug**\r\nIntermittent broken pipe error seen while waiting for endpoint.\r\n\r\n**To reproduce**\r\nCreate an endpoint and wait.\r\n\r\n**Expected behavior**\r\nWait should return with no error.\r\n\r\n**Screenshots or logs**\r\n```\r\n    self.__sagemaker_session.wait_for_endpoint(self.__endpoint_name)\r\n  File \"/root/.pyenv/versions/3.7.7/lib/python3.7/site-packages/sagemaker/session.py\", line 2876, in wait_for_endpoint\r\n    desc = _wait_until(lambda: _deploy_done(self.sagemaker_client, endpoint), poll)\r\n  File \"/root/.pyenv/versions/3.7.7/lib/python3.7/site-packages/sagemaker/session.py\", line 3789, in _wait_until\r\n    result = callable_fn()\r\n  File \"/root/.pyenv/versions/3.7.7/lib/python3.7/site-packages/sagemaker/session.py\", line 2876, in <lambda>\r\n    desc = _wait_until(lambda: _deploy_done(self.sagemaker_client, endpoint), poll)\r\n  File \"/root/.pyenv/versions/3.7.7/lib/python3.7/site-packages/sagemaker/session.py\", line 3772, in _deploy_done\r\n    print(hosting_status_codes.get(status, \"?\"), end=\"\")\r\nBrokenPipeError: [Errno 32] Broken pipe\r\n```\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.5.5\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: N/A\r\n- **Framework version**: N/A\r\n- **Python version**: 3.7.7\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: N\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1978/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1978/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1968", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1968/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1968/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1968/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1968", "id": 728175902, "node_id": "MDU6SXNzdWU3MjgxNzU5MDI=", "number": 1968, "title": "Cannot pull algorithm container. Either the image does not exist or its permissions are incorrect.", "user": {"login": "sumankamilya", "id": 73344991, "node_id": "MDQ6VXNlcjczMzQ0OTkx", "avatar_url": "https://avatars.githubusercontent.com/u/73344991?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sumankamilya", "html_url": "https://github.com/sumankamilya", "followers_url": "https://api.github.com/users/sumankamilya/followers", "following_url": "https://api.github.com/users/sumankamilya/following{/other_user}", "gists_url": "https://api.github.com/users/sumankamilya/gists{/gist_id}", "starred_url": "https://api.github.com/users/sumankamilya/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sumankamilya/subscriptions", "organizations_url": "https://api.github.com/users/sumankamilya/orgs", "repos_url": "https://api.github.com/users/sumankamilya/repos", "events_url": "https://api.github.com/users/sumankamilya/events{/privacy}", "received_events_url": "https://api.github.com/users/sumankamilya/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-10-23T12:24:29Z", "updated_at": "2021-04-06T16:55:58Z", "closed_at": "2021-04-06T16:55:58Z", "author_association": "NONE", "active_lock_reason": null, "body": "2020-10-23 12:04:45 Starting - Starting the training job...\r\n2020-10-23 12:04:48 Starting - Launching requested ML instances......\r\n2020-10-23 12:06:01 Starting - Preparing the instances for training......\r\n2020-10-23 12:06:59 Downloading - Downloading input data.........\r\n2020-10-23 12:08:36 Training - Downloading the training image.........\r\n2020-10-23 12:09:56 Failed - Training job failed\r\n..\r\n---------------------------------------------------------------------------\r\nUnexpectedStatusException                 Traceback (most recent call last)\r\n<ipython-input-25-e218a06ec66b> in <module>\r\n----> 1 model.fit(inputs=data_channels, logs=True)\r\n\r\n~/anaconda3/envs/amazonei_mxnet_p36/lib/python3.6/site-packages/sagemaker/estimator.py in fit(self, inputs, wait, logs, job_name, experiment_config)\r\n    497         self.jobs.append(self.latest_training_job)\r\n    498         if wait:\r\n--> 499             self.latest_training_job.wait(logs=logs)\r\n    500 \r\n    501     def _compilation_job_name(self):\r\n\r\n~/anaconda3/envs/amazonei_mxnet_p36/lib/python3.6/site-packages/sagemaker/estimator.py in wait(self, logs)\r\n   1137         # If logs are requested, call logs_for_jobs.\r\n   1138         if logs != \"None\":\r\n-> 1139             self.sagemaker_session.logs_for_job(self.job_name, wait=True, log_type=logs)\r\n   1140         else:\r\n   1141             self.sagemaker_session.wait_for_job(self.job_name)\r\n\r\n~/anaconda3/envs/amazonei_mxnet_p36/lib/python3.6/site-packages/sagemaker/session.py in logs_for_job(self, job_name, wait, poll, log_type)\r\n   3075 \r\n   3076         if wait:\r\n-> 3077             self._check_job_status(job_name, description, \"TrainingJobStatus\")\r\n   3078             if dot:\r\n   3079                 print()\r\n\r\n~/anaconda3/envs/amazonei_mxnet_p36/lib/python3.6/site-packages/sagemaker/session.py in _check_job_status(self, job, desc, status_key_name)\r\n   2669                 ),\r\n   2670                 allowed_statuses=[\"Completed\", \"Stopped\"],\r\n-> 2671                 actual_status=status,\r\n   2672             )\r\n   2673 \r\n\r\nUnexpectedStatusException: Error for Training job object-detection-2020-10-23-12-04-45-594: Failed. Reason: ClientError: Cannot pull algorithm container. Either the image does not exist or its permissions are incorrect.", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1968/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1968/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1949", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1949/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1949/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1949/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/pull/1949", "id": 719567889, "node_id": "MDExOlB1bGxSZXF1ZXN0NTAxNzMzMTMz", "number": 1949, "title": "fix: add missing scikit-learn account IDs for af-south-1 and eu-south-1", "user": {"login": "ajaykarpur", "id": 5490371, "node_id": "MDQ6VXNlcjU0OTAzNzE=", "avatar_url": "https://avatars.githubusercontent.com/u/5490371?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ajaykarpur", "html_url": "https://github.com/ajaykarpur", "followers_url": "https://api.github.com/users/ajaykarpur/followers", "following_url": "https://api.github.com/users/ajaykarpur/following{/other_user}", "gists_url": "https://api.github.com/users/ajaykarpur/gists{/gist_id}", "starred_url": "https://api.github.com/users/ajaykarpur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ajaykarpur/subscriptions", "organizations_url": "https://api.github.com/users/ajaykarpur/orgs", "repos_url": "https://api.github.com/users/ajaykarpur/repos", "events_url": "https://api.github.com/users/ajaykarpur/events{/privacy}", "received_events_url": "https://api.github.com/users/ajaykarpur/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 2108671716, "node_id": "MDU6TGFiZWwyMTA4NjcxNzE2", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/scikit-learn", "name": "scikit-learn", "color": "3294C7", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-10-12T18:13:50Z", "updated_at": "2020-10-12T18:42:52Z", "closed_at": "2020-10-12T18:42:51Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/pulls/1949", "html_url": "https://github.com/aws/sagemaker-python-sdk/pull/1949", "diff_url": "https://github.com/aws/sagemaker-python-sdk/pull/1949.diff", "patch_url": "https://github.com/aws/sagemaker-python-sdk/pull/1949.patch", "merged_at": "2020-10-12T18:42:51Z"}, "body": "*Description of changes:*\r\nAccount IDs were missing for two regions for scikit-learn `0.23-1`.\r\n\r\n*Testing done:*\r\n```\r\ntox tests/unit/sagemaker/image_uris/test_sklearn.py\r\n```\r\n\r\n## Merge Checklist\r\n\r\n_Put an `x` in the boxes that apply. You can also fill these out after creating the PR. If you're unsure about any of them, don't hesitate to ask. We're here to help! This is simply a reminder of what we are going to look for before merging your pull request._\r\n\r\n#### General\r\n\r\n- [x] I have read the [CONTRIBUTING](https://github.com/aws/sagemaker-python-sdk/blob/master/CONTRIBUTING.md) doc\r\n- [x] I used the commit message format described in [CONTRIBUTING](https://github.com/aws/sagemaker-python-sdk/blob/master/CONTRIBUTING.md#committing-your-change)\r\n- [ ] I have passed the region in to all S3 and STS clients that I've initialized as part of this change.\r\n- [ ] I have updated any necessary documentation, including [READMEs](https://github.com/aws/sagemaker-python-sdk/blob/master/README.rst) and [API docs](https://github.com/aws/sagemaker-python-sdk/tree/master/doc) (if appropriate)\r\n\r\n#### Tests\r\n\r\n- [ ] I have added tests that prove my fix is effective or that my feature works (if appropriate)\r\n- [ ] I have checked that my tests are not configured for a specific region or account (if appropriate)\r\n- [ ] I have used [`unique_name_from_base`](https://github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/utils.py#L77) to create resource names in integ tests (if appropriate)\r\n\r\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1949/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1949/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1940", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1940/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1940/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1940/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/pull/1940", "id": 715261047, "node_id": "MDExOlB1bGxSZXF1ZXN0NDk4MjAwMjAy", "number": 1940, "title": "doc: fix broken link to moved notebook", "user": {"login": "metrizable", "id": 65414824, "node_id": "MDQ6VXNlcjY1NDE0ODI0", "avatar_url": "https://avatars.githubusercontent.com/u/65414824?v=4", "gravatar_id": "", "url": "https://api.github.com/users/metrizable", "html_url": "https://github.com/metrizable", "followers_url": "https://api.github.com/users/metrizable/followers", "following_url": "https://api.github.com/users/metrizable/following{/other_user}", "gists_url": "https://api.github.com/users/metrizable/gists{/gist_id}", "starred_url": "https://api.github.com/users/metrizable/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/metrizable/subscriptions", "organizations_url": "https://api.github.com/users/metrizable/orgs", "repos_url": "https://api.github.com/users/metrizable/repos", "events_url": "https://api.github.com/users/metrizable/events{/privacy}", "received_events_url": "https://api.github.com/users/metrizable/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 892238348, "node_id": "MDU6TGFiZWw4OTIyMzgzNDg=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/type:%20documentation", "name": "type: documentation", "color": "002b36", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 12, "created_at": "2020-10-06T01:01:53Z", "updated_at": "2020-12-23T19:20:49Z", "closed_at": "2020-10-06T19:18:01Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/pulls/1940", "html_url": "https://github.com/aws/sagemaker-python-sdk/pull/1940", "diff_url": "https://github.com/aws/sagemaker-python-sdk/pull/1940.diff", "patch_url": "https://github.com/aws/sagemaker-python-sdk/pull/1940.patch", "merged_at": "2020-10-06T19:18:01Z"}, "body": "*Issue #, if available:*\r\n\r\n*Description of changes:*\r\n\r\n*Testing done:*\r\n\r\n## Merge Checklist\r\n\r\n_Put an `x` in the boxes that apply. You can also fill these out after creating the PR. If you're unsure about any of them, don't hesitate to ask. We're here to help! This is simply a reminder of what we are going to look for before merging your pull request._\r\n\r\n#### General\r\n\r\n- [x] I have read the [CONTRIBUTING](https://github.com/aws/sagemaker-python-sdk/blob/master/CONTRIBUTING.md) doc\r\n- [x] I used the commit message format described in [CONTRIBUTING](https://github.com/aws/sagemaker-python-sdk/blob/master/CONTRIBUTING.md#committing-your-change)\r\n- [ ] I have passed the region in to all S3 and STS clients that I've initialized as part of this change.\r\n- [x] I have updated any necessary documentation, including [READMEs](https://github.com/aws/sagemaker-python-sdk/blob/master/README.rst) and [API docs](https://github.com/aws/sagemaker-python-sdk/tree/master/doc) (if appropriate)\r\n\r\n#### Tests\r\n\r\n- [ ] I have added tests that prove my fix is effective or that my feature works (if appropriate)\r\n- [ ] I have checked that my tests are not configured for a specific region or account (if appropriate)\r\n- [ ] I have used [`unique_name_from_base`](https://github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/utils.py#L77) to create resource names in integ tests (if appropriate)\r\n\r\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1940/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1940/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1912", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1912/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1912/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1912/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1912", "id": 706321535, "node_id": "MDU6SXNzdWU3MDYzMjE1MzU=", "number": 1912, "title": "docs build fail on Sphinx v3.2.1", "user": {"login": "aaronmarkham", "id": 5974205, "node_id": "MDQ6VXNlcjU5NzQyMDU=", "avatar_url": "https://avatars.githubusercontent.com/u/5974205?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aaronmarkham", "html_url": "https://github.com/aaronmarkham", "followers_url": "https://api.github.com/users/aaronmarkham/followers", "following_url": "https://api.github.com/users/aaronmarkham/following{/other_user}", "gists_url": "https://api.github.com/users/aaronmarkham/gists{/gist_id}", "starred_url": "https://api.github.com/users/aaronmarkham/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aaronmarkham/subscriptions", "organizations_url": "https://api.github.com/users/aaronmarkham/orgs", "repos_url": "https://api.github.com/users/aaronmarkham/repos", "events_url": "https://api.github.com/users/aaronmarkham/events{/privacy}", "received_events_url": "https://api.github.com/users/aaronmarkham/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 892238348, "node_id": "MDU6TGFiZWw4OTIyMzgzNDg=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/type:%20documentation", "name": "type: documentation", "color": "002b36", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-09-22T12:01:47Z", "updated_at": "2020-10-27T00:18:02Z", "closed_at": "2020-10-27T00:18:02Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "**Describe the bug**\r\n\r\n```\r\nWarning, treated as error:\r\n/home/ubuntu/anaconda3/envs/sagemaker/lib/python3.7/site-packages/sagemaker/amazon/linear_learner.py:docstring of sagemaker.LinearLearner:184:Field list ends without a blank line; unexpected unindent.\r\n```\r\n\r\n**To reproduce**\r\nSetup an env w/ the latest Sphinx (3.2.1) and build the docs.\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1912/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1912/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1910", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1910/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1910/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1910/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1910", "id": 705238013, "node_id": "MDU6SXNzdWU3MDUyMzgwMTM=", "number": 1910, "title": "KeyError: 'NetworkConfig' in predictor.list_monitors()", "user": {"login": "athewsey", "id": 19252478, "node_id": "MDQ6VXNlcjE5MjUyNDc4", "avatar_url": "https://avatars.githubusercontent.com/u/19252478?v=4", "gravatar_id": "", "url": "https://api.github.com/users/athewsey", "html_url": "https://github.com/athewsey", "followers_url": "https://api.github.com/users/athewsey/followers", "following_url": "https://api.github.com/users/athewsey/following{/other_user}", "gists_url": "https://api.github.com/users/athewsey/gists{/gist_id}", "starred_url": "https://api.github.com/users/athewsey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/athewsey/subscriptions", "organizations_url": "https://api.github.com/users/athewsey/orgs", "repos_url": "https://api.github.com/users/athewsey/repos", "events_url": "https://api.github.com/users/athewsey/events{/privacy}", "received_events_url": "https://api.github.com/users/athewsey/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-09-21T02:07:46Z", "updated_at": "2020-10-07T19:58:34Z", "closed_at": "2020-10-07T19:58:33Z", "author_association": "COLLABORATOR", "active_lock_reason": null, "body": "**Describe the bug**\r\n\r\n`predictor.list_monitors()` raises `KeyError: 'NetworkConfig'` when called on a (non-VPC) endpoint (PyTorch framework model, custom Docker monitoring job).\r\n\r\nPer the [MonitoringJobDefinition API doc](https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_MonitoringJobDefinition.html#sagemaker-Type-MonitoringJobDefinition-NetworkConfig), this field is optional in the response so should not be assumed.\r\n\r\n**To reproduce**\r\n\r\nSpecifically I'm using the [\"Detecting and analyzing incorrect model predictions with Amazon SageMaker Model Monitor and Debugger\"](https://github.com/aws-samples/amazon-sagemaker-analyze-model-predictions) sample, and trying to re-attach to my endpoint's existing monitoring schedule after a kernel restart.\r\n\r\nIn general I expect you could:\r\n\r\n- Deploy an endpoint *not* in a VPC, with no VPC/network configurations specified\r\n- Attach a monitoring schedule, also with no VPC/network config\r\n- call `predictor.list_monitors()`\r\n\r\n**Expected behavior**\r\n\r\nList monitors regardless of whether NetworkConfig/VPC information is available\r\n\r\n**Screenshots or logs**\r\n\r\nTraceback:\r\n\r\n```\r\n~/anaconda3/envs/pytorch_p36/lib/python3.6/site-packages/sagemaker/predictor.py in list_monitors(self)\r\n    358                     ModelMonitor.attach(\r\n    359                         monitor_schedule_name=schedule_name,\r\n--> 360                         sagemaker_session=self.sagemaker_session,\r\n    361                     )\r\n    362                 )\r\n\r\n~/anaconda3/envs/pytorch_p36/lib/python3.6/site-packages/sagemaker/model_monitor/model_monitoring.py in attach(cls, monitor_schedule_name, sagemaker_session)\r\n    680 \r\n    681         vpc_config = schedule_desc[\"MonitoringScheduleConfig\"][\"MonitoringJobDefinition\"][\r\n--> 682             \"NetworkConfig\"\r\n    683         ].get(\"VpcConfig\")\r\n    684 \r\n\r\nKeyError: 'NetworkConfig'\r\n```\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.9.1\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: PyTorch\r\n- **Framework version**: 1.3.1\r\n- **Python version**: 3.6\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: Y for processing job, N for endpoint\r\n\r\n**Additional context**\r\n\r\nNone\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1910/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1910/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1909", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1909/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1909/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1909/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1909", "id": 704722339, "node_id": "MDU6SXNzdWU3MDQ3MjIzMzk=", "number": 1909, "title": "PyTorch 1.6.0 Inference packaging skips dependencies, other model artefacts", "user": {"login": "setu4993", "id": 1833708, "node_id": "MDQ6VXNlcjE4MzM3MDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1833708?v=4", "gravatar_id": "", "url": "https://api.github.com/users/setu4993", "html_url": "https://github.com/setu4993", "followers_url": "https://api.github.com/users/setu4993/followers", "following_url": "https://api.github.com/users/setu4993/following{/other_user}", "gists_url": "https://api.github.com/users/setu4993/gists{/gist_id}", "starred_url": "https://api.github.com/users/setu4993/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/setu4993/subscriptions", "organizations_url": "https://api.github.com/users/setu4993/orgs", "repos_url": "https://api.github.com/users/setu4993/repos", "events_url": "https://api.github.com/users/setu4993/events{/privacy}", "received_events_url": "https://api.github.com/users/setu4993/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 13, "created_at": "2020-09-19T00:30:37Z", "updated_at": "2021-06-24T22:43:00Z", "closed_at": "2021-06-24T22:43:00Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nModel artefacts packagedin `model.tar.gz` are skipped when the model object is converted into a TorchServe model. Similarly, dependencies included are also dropped.\r\n\r\n**To reproduce**\r\nAdd any extra file to `model.tar.gz` that is not `model.pth`, and it won't show up in the container. Similarly, any of the extra `depenencies` specified during the initialization of a `PyTorchModel` object are dropped.\r\n\r\n**Expected behavior**\r\nModel package would include all of the extra files and dependencies, as described in the [API documentation](https://sagemaker.readthedocs.io/en/stable/api/inference/model.html#sagemaker.model.FrameworkModel).\r\n\r\n**Screenshots or logs**\r\nTried `os.walk` in the model_dir and realized artefacts I was expecting were missing. The below log shows the files in `model_dir`. I had an extra `.pkl` object in there which was not included.\r\n\r\n> 2020-09-18 23:50:40,059 [WARN ] W-9000-model_1-stderr org.pytorch.serve.wlm.WorkerLifeCycle - 2020-09-18 23:50:40.058 | INFO     | inference:model_fn:59 - ['inference.py', 'handler_service.py', 'model.pth']\r\n\r\nSimilarly, the directories log is missing the extra dependencies specified while creating the `PyTorchModel` object under `model_dir/lib` (#1832 another bug) or `model_dir` (as specified in API documentation) both.\r\n> 2020-09-18 23:50:40,058 [WARN ] W-9000-model_1-stderr org.pytorch.serve.wlm.WorkerLifeCycle - 2020-09-18 23:50:40.058 | INFO     | inference:model_fn:58 - ['__pycache__', 'MAR-INF']\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.9.1\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: PyTorch\r\n- **Framework version**: 1.6.0\r\n- **Python version**: 3.6\r\n- **CPU or GPU**: GPU\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\n\r\nThe problem arises from this line in the process of [TorchServe packaging](https://github.com/aws/sagemaker-pytorch-inference-toolkit/blob/6936c08581e26ff3bac26824b1e4946ec68ffc85/src/sagemaker_pytorch_serving_container/torchserve.py#L125), that is a result of https://github.com/aws/sagemaker-pytorch-inference-toolkit/pull/79/. It drops **every** other object as a part of the repackaging except the inference script.\r\n\r\nClearly, that is a regression and unexpected.", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1909/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1909/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1908", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1908/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1908/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1908/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/pull/1908", "id": 704630651, "node_id": "MDExOlB1bGxSZXF1ZXN0NDg5NTIwMjM3", "number": 1908, "title": "fix: add missing account IDs for af-south-1 and eu-south-1", "user": {"login": "ajaykarpur", "id": 5490371, "node_id": "MDQ6VXNlcjU0OTAzNzE=", "avatar_url": "https://avatars.githubusercontent.com/u/5490371?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ajaykarpur", "html_url": "https://github.com/ajaykarpur", "followers_url": "https://api.github.com/users/ajaykarpur/followers", "following_url": "https://api.github.com/users/ajaykarpur/following{/other_user}", "gists_url": "https://api.github.com/users/ajaykarpur/gists{/gist_id}", "starred_url": "https://api.github.com/users/ajaykarpur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ajaykarpur/subscriptions", "organizations_url": "https://api.github.com/users/ajaykarpur/orgs", "repos_url": "https://api.github.com/users/ajaykarpur/repos", "events_url": "https://api.github.com/users/ajaykarpur/events{/privacy}", "received_events_url": "https://api.github.com/users/ajaykarpur/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 26, "created_at": "2020-09-18T20:14:46Z", "updated_at": "2020-09-22T18:45:14Z", "closed_at": "2020-09-22T18:45:13Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/pulls/1908", "html_url": "https://github.com/aws/sagemaker-python-sdk/pull/1908", "diff_url": "https://github.com/aws/sagemaker-python-sdk/pull/1908.diff", "patch_url": "https://github.com/aws/sagemaker-python-sdk/pull/1908.patch", "merged_at": "2020-09-22T18:45:13Z"}, "body": "*Description of changes:*\r\nAccount IDs for `af-south-1` and `eu-south-1` were missing. This PR is a region-related bugfix.\r\n\r\n*Testing done:*\r\n- Ran unit tests locally with `tox`.\r\n- Ran `tests/integ/test_airflow_config.py::test_byo_airflow_config_uploads_data_source_to_s3_when_inputs_provided` from my local machine, which passed. This same test [failed in the PR build](https://devbuildsagemakerpythonsdkonestackpdx-g-buildlogs-5ww5g6ahayeg.s3.amazonaws.com/ec87a5dc-54c3-425a-a424-aad68e0cec5a/build.log?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIASCMSNBKCTUALAEXS%2F20200921%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20200921T211633Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEGUaCXVzLXdlc3QtMiJHMEUCIQDrrAVRQp5nV5jqx38f1ekPBYExUh355NkQmIdKxueSlgIgaF1naLjVLsUBSASDw2vCanr13RuqVEWn7SN6qAi3z5Uq%2FwEIfhACGgwxNDI1Nzc4MzA1MzMiDC1C6uErKwoYvWbPBircAf4qJ%2FJ9h6oX9ls5SYgnwmFs%2FayoSZ3Sui3%2BLq1YjG9MVX8keT3ZQ7U%2BMWW3Plqb32i2M1nB1G2x9%2FwnPOf%2B%2BykT5kX89tiTR2tPdsqhPf4cjRSQqIz20Wv8sfPfoLmRXZM%2FJYAJPD9%2Fnl2iGkhziAtmxRO3E8iWZZvH8XqDyHud2qu7H%2FHAmePq281aPcsnTUkBm%2FAf1U0WtRUXE2HswkI0A1pNiPx%2Be5mM08h%2F3vOVijlqDNXNJostzZGHjbYZdehNF5duoiVc0AgdtRWMRLt4CtVkOHQ2YF7bb1Awr7Ck%2BwU64AFo88rCyRMsvKxQ4Waz7OYp1fO7INpZYidci6SLNZKoVOUmezSN7lNVeSxxgbSK4NQ6uEQBpqWvY3qFApwM319pZICRMC5H8sTZ1LjF9PRrs9WCziio4pdWvR3mcHvQf%2ByQIp2DW9EqmLZaIXdxSgGdmd5y9zaRmDUmd3ngqCIeGCtifFTZW2UkXwCnZ7ifGE6d8ZSSTS9DuMnXbNL0ybDTj2VtvDLQURPKFPC7jtXNKGoSf9j6YfsImzX2pgwK3VI9vLjbO6%2BwawuBjeb%2FlUMUVgtPskuqZkUR864Ifkrjag%3D%3D&X-Amz-Signature=c4bd2c968999213aaa69592a448b9d6404daf99c65f2102e2a2177e43436de8e); modified the buildspec to skip it.\r\n\r\n## Merge Checklist\r\n\r\n_Put an `x` in the boxes that apply. You can also fill these out after creating the PR. If you're unsure about any of them, don't hesitate to ask. We're here to help! This is simply a reminder of what we are going to look for before merging your pull request._\r\n\r\n#### General\r\n\r\n- [x] I have read the [CONTRIBUTING](https://github.com/aws/sagemaker-python-sdk/blob/master/CONTRIBUTING.md) doc\r\n- [x] I used the commit message format described in [CONTRIBUTING](https://github.com/aws/sagemaker-python-sdk/blob/master/CONTRIBUTING.md#committing-your-change)\r\n- [ ] I have passed the region in to all S3 and STS clients that I've initialized as part of this change.\r\n- [ ] I have updated any necessary documentation, including [READMEs](https://github.com/aws/sagemaker-python-sdk/blob/master/README.rst) and [API docs](https://github.com/aws/sagemaker-python-sdk/tree/master/doc) (if appropriate)\r\n\r\n#### Tests\r\n\r\n- [x] I have added tests that prove my fix is effective or that my feature works (if appropriate)\r\n- [ ] I have checked that my tests are not configured for a specific region or account (if appropriate)\r\n- [ ] I have used [`unique_name_from_base`](https://github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/utils.py#L77) to create resource names in integ tests (if appropriate)\r\n\r\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1908/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1908/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1875", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1875/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1875/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1875/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1875", "id": 696140367, "node_id": "MDU6SXNzdWU2OTYxNDAzNjc=", "number": 1875, "title": "container_log_level does not work in TensorFlow estimator", "user": {"login": "tailaiw", "id": 29800495, "node_id": "MDQ6VXNlcjI5ODAwNDk1", "avatar_url": "https://avatars.githubusercontent.com/u/29800495?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tailaiw", "html_url": "https://github.com/tailaiw", "followers_url": "https://api.github.com/users/tailaiw/followers", "following_url": "https://api.github.com/users/tailaiw/following{/other_user}", "gists_url": "https://api.github.com/users/tailaiw/gists{/gist_id}", "starred_url": "https://api.github.com/users/tailaiw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tailaiw/subscriptions", "organizations_url": "https://api.github.com/users/tailaiw/orgs", "repos_url": "https://api.github.com/users/tailaiw/repos", "events_url": "https://api.github.com/users/tailaiw/events{/privacy}", "received_events_url": "https://api.github.com/users/tailaiw/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-09-08T20:02:38Z", "updated_at": "2020-11-23T20:10:15Z", "closed_at": "2020-11-23T20:10:15Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nParameter `container_log_level` does not work in TensorFlow estimator\r\n\r\n**To reproduce**\r\nI have a TensorFlow estimator built roughly as follows\r\n```python\r\nimport logging\r\nfrom sagemaker.tensorflow import TensorFlow\r\nestimator = TensorFlow(\r\n        sagemaker_session=sagemaker_session,\r\n        entry_point=\"my_entry_point.py\",\r\n        source_dir=my_source_dir,\r\n        role=my_role,\r\n        instance_count=1,\r\n        instance_type=\"ml.p3.2xlarge\",    \r\n        framework_version=\"2.1\",\r\n        py_version=\"py3\",\r\n        checkpoint_s3_uri=my_checkpoint_s3_uri,\r\n        container_log_level=logging.WARNING)\r\n```\r\nI expect now logs lower than WARNING will be included in the training job logs. However, a lot of INFO level logs are observed. Particularly, a lot of INFO logs related to frequent checkpoint uploading (from instance to S3) are observed, which makes the entire log super long. I tried logging.ERROR and no luck either.\r\n\r\n**Expected behavior**\r\nNo log except WARNING and ERROR level ones should be observed.\r\n\r\n**Screenshots or logs**\r\nIf applicable, add screenshots or logs to help explain your problem.\r\n![image](https://user-images.githubusercontent.com/29800495/92522270-1bd4f480-f1e4-11ea-827c-1c33934a8d9e.png)\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.5.1\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: TensorFlow\r\n- **Framework version**: 2.1\r\n- **Python version**: 3.7\r\n- **CPU or GPU**: GPU\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1875/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1875/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1847", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1847/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1847/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1847/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1847", "id": 682935691, "node_id": "MDU6SXNzdWU2ODI5MzU2OTE=", "number": 1847, "title": "bug: AttributeError: 'NoneType' object has no attribute 'module' when applying the v2 upgrade tool", "user": {"login": "metrizable", "id": 65414824, "node_id": "MDQ6VXNlcjY1NDE0ODI0", "avatar_url": "https://avatars.githubusercontent.com/u/65414824?v=4", "gravatar_id": "", "url": "https://api.github.com/users/metrizable", "html_url": "https://github.com/metrizable", "followers_url": "https://api.github.com/users/metrizable/followers", "following_url": "https://api.github.com/users/metrizable/following{/other_user}", "gists_url": "https://api.github.com/users/metrizable/gists{/gist_id}", "starred_url": "https://api.github.com/users/metrizable/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/metrizable/subscriptions", "organizations_url": "https://api.github.com/users/metrizable/orgs", "repos_url": "https://api.github.com/users/metrizable/repos", "events_url": "https://api.github.com/users/metrizable/events{/privacy}", "received_events_url": "https://api.github.com/users/metrizable/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-08-20T17:20:58Z", "updated_at": "2020-08-20T21:27:56Z", "closed_at": "2020-08-20T21:27:56Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**Describe the bug**\r\n\r\nWhen applying the `sagemaker-upgrade-v2` automated CLI tool, earlier ast modification leads to an `AttributeError` exception.\r\n\r\n**To reproduce**\r\n\r\n1. Craft a script that will be modified by a SerDe import renamer\r\n1. Apply the V2 upgrade CLI tool: \r\n\r\nAn `AttributeError` exception is raised.\r\n\r\n**Expected behavior**\r\n\r\nThe V2 upgrade CLI would properly upgrade the script.\r\n\r\n**Screenshots or logs**\r\n\r\n```\r\n\u276f cat v1.py\r\nimport sagemaker\r\n\r\nfrom sagemaker.predictor import csv_serializer\r\n\r\ncsv_serializer.__doc___\r\n\r\n\u276f sagemaker-upgrade-v2 --in-file v1.py --out-file v2.py\r\nTraceback (most recent call last):\r\n  File \"~/testvenv/bin/sagemaker-upgrade-v2\", line 8, in <module>\r\n    sys.exit(main())\r\n  File \"~/testvenv/lib/python3.8/site-packages/sagemaker/cli/compatibility/v2/sagemaker_upgrade_v2.py\", line 78, in main\r\n    _update_file(args.in_file, args.out_file)\r\n  File \"~/testvenv/lib/python3.8/site-packages/sagemaker/cli/compatibility/v2/sagemaker_upgrade_v2.py\", line 50, in _update_file\r\n    updater_cls(input_path=input_file, output_path=output_file).update()\r\n  File \"~/testvenv/lib/python3.8/site-packages/sagemaker/cli/compatibility/v2/files.py\", line 72, in update\r\n    output = self._update_ast(self._read_input_file())\r\n  File \"~/testvenv/lib/python3.8/site-packages/sagemaker/cli/compatibility/v2/files.py\", line 86, in _update_ast\r\n    return ASTTransformer().visit(input_ast)\r\n  File \"/usr/lib/python3.8/ast.py\", line 363, in visit\r\n    return visitor(node)\r\n  File \"~/testvenv/lib/python3.8/site-packages/sagemaker/cli/compatibility/v2/ast_transformer.py\", line 136, in visit_Module\r\n    self.generic_visit(node)\r\n  File \"/usr/lib/python3.8/ast.py\", line 439, in generic_visit\r\n    value = self.visit(value)\r\n  File \"/usr/lib/python3.8/ast.py\", line 363, in visit\r\n    return visitor(node)\r\n  File \"~/testvenv/lib/python3.8/site-packages/sagemaker/cli/compatibility/v2/ast_transformer.py\", line 155, in visit_ImportFrom\r\n    node = import_checker.check_and_modify_node(node)\r\n  File \"~/testvenv/lib/python3.8/site-packages/sagemaker/cli/compatibility/v2/modifiers/modifier.py\", line 26, in check_and_modify_node\r\n    if self.node_should_be_modified(node):\r\n  File \"~/testvenv/lib/python3.8/site-packages/sagemaker/cli/compatibility/v2/modifiers/image_uris.py\", line 115, in node_should_be_modified\r\n    return node.module in GET_IMAGE_URI_NAMESPACES and any(\r\nAttributeError: 'NoneType' object has no attribute 'module'\r\n```\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 2.4.1\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**:\r\n- **Framework version**:\r\n- **Python version**:\r\n- **CPU or GPU**:\r\n- **Custom Docker image (Y/N)**:\r\n\r\n**Additional context**\r\n\r\nThe problem comes from [the ordering](https://github.com/aws/sagemaker-python-sdk/blob/v2.4.1/src/sagemaker/cli/compatibility/v2/ast_transformer.py#L59-L60), which the existing, isolated unit tests do not cover. The earlier renamer modifies the ast, and the later renamer cannot handle this situation:\r\n\r\n```\r\n 59     modifiers.serde.SerdeImportFromPredictorRenamer(),\r\n 60     modifiers.image_uris.ImageURIRetrieveImportFromRenamer(),\r\n```", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1847/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1847/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1759", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1759/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1759/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1759/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1759", "id": 667143710, "node_id": "MDU6SXNzdWU2NjcxNDM3MTA=", "number": 1759, "title": "Default model_dir uses backslashes on Windows", "user": {"login": "RobinKa", "id": 2614101, "node_id": "MDQ6VXNlcjI2MTQxMDE=", "avatar_url": "https://avatars.githubusercontent.com/u/2614101?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RobinKa", "html_url": "https://github.com/RobinKa", "followers_url": "https://api.github.com/users/RobinKa/followers", "following_url": "https://api.github.com/users/RobinKa/following{/other_user}", "gists_url": "https://api.github.com/users/RobinKa/gists{/gist_id}", "starred_url": "https://api.github.com/users/RobinKa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RobinKa/subscriptions", "organizations_url": "https://api.github.com/users/RobinKa/orgs", "repos_url": "https://api.github.com/users/RobinKa/repos", "events_url": "https://api.github.com/users/RobinKa/events{/privacy}", "received_events_url": "https://api.github.com/users/RobinKa/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 814413598, "node_id": "MDU6TGFiZWw4MTQ0MTM1OTg=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/In%20progress", "name": "In progress", "color": "33E997", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-07-28T14:58:41Z", "updated_at": "2020-08-05T16:13:04Z", "closed_at": "2020-08-05T16:13:03Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nThe default `model_dir` will contain backslashes when running the following code to start tensorflow training on Windows.\r\n\r\n```python\r\nfrom sagemaker.tensorflow import TensorFlow\r\n\r\nrole = \"<role>\"\r\n\r\ntf_estimator = TensorFlow(\r\n    source_dir=\"src\", script_mode=True,\r\n    framework_version=\"1.15.2\", py_version=\"py37\",\r\n    entry_point=\"main.py\", role=role,\r\n    train_instance_count=1, train_instance_type=\"ml.g4dn.xlarge\",\r\n    train_volume_size=50,\r\n    output_path=\"<bucketpath>/exported_model\"\r\n)\r\n\r\ntf_estimator.fit({\r\n    \"train\": \"<bucketpath>/<train dir>\",\r\n    \"test\": \"<bucketpath>/<test dir>\",\r\n})\r\n```\r\n\r\nTrying to then upload something to the `model_dir` path (eg. when tensorflow tries to save checkpoints) will not work as S3 requires forward slashes. Example args that are passed when executing the above code\r\n\r\n```\r\nArgs: Namespace(alpha=0.25, augment=True, batch_size=3, classes=2, crop_size=512, current_host='algo-1', epochs=3, fl_weight=0.1, gamma=2.0, hosts=['algo-1'], init_lr=0.004, layer_depth=21, mode='train', model_dir='<bucketpath>/exported_model\\\\tensorflow-training-2020\r\n-07-28-14-00-00-884\\\\model', momentum=0.9, num_gpus=1, output_dir='output', power=0.9, regularization_scale=0.0001, sm_model_dir='/opt/ml/model', stddev=0.02, test_dir='/opt/ml/input/data/test', train_dir='/opt/ml/input/data/train')\r\n```\r\n\r\nAs a workaround I just did `args.model_dir = args.model_dir.replace(\"\\\\\", \"/\")` in my training code.\r\n\r\n**Expected behavior**\r\nThe `model_dir` path should use forward slashes no matter which OS the code to initiate training is run from for S3 paths.\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 1.71.1\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: TensorFlow\r\n- **Framework version**: 1.15.2\r\n- **Python version**: 3.7.? on server, 3.7.3 locally\r\n- **CPU or GPU**: GPU\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1759/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1759/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1696", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1696/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1696/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1696/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1696", "id": 654405116, "node_id": "MDU6SXNzdWU2NTQ0MDUxMTY=", "number": 1696, "title": "Unable to suppress pandas warnings from analytics module", "user": {"login": "jaipreet-s", "id": 43826141, "node_id": "MDQ6VXNlcjQzODI2MTQx", "avatar_url": "https://avatars.githubusercontent.com/u/43826141?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jaipreet-s", "html_url": "https://github.com/jaipreet-s", "followers_url": "https://api.github.com/users/jaipreet-s/followers", "following_url": "https://api.github.com/users/jaipreet-s/following{/other_user}", "gists_url": "https://api.github.com/users/jaipreet-s/gists{/gist_id}", "starred_url": "https://api.github.com/users/jaipreet-s/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jaipreet-s/subscriptions", "organizations_url": "https://api.github.com/users/jaipreet-s/orgs", "repos_url": "https://api.github.com/users/jaipreet-s/repos", "events_url": "https://api.github.com/users/jaipreet-s/events{/privacy}", "received_events_url": "https://api.github.com/users/jaipreet-s/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 850818746, "node_id": "MDU6TGFiZWw4NTA4MTg3NDY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/status:%20pending%20release", "name": "status: pending release", "color": "eee8d5", "default": false, "description": "issues for which fixes have been merged but not released to PyPI"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-07-09T23:19:42Z", "updated_at": "2021-02-18T03:05:16Z", "closed_at": "2020-07-23T22:24:48Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nThe Python SDK outputs a `warning` for not having pandas on import even if I'm not using the analytics feature, and it's not straightforward to suppress the warnings from just the `sagemaker` module.\r\n\r\n**To reproduce**\r\n\r\nWithout having pandas, do\r\n\r\n```\r\nimport sagemaker\r\n```\r\n\r\nYou'll see a warning `WARNING:root:pandas failed to import. Analytics features will be impaired or broken.`\r\n\r\n**Expected behavior**\r\nA clear and concise description of what you expected to happen.\r\n\r\nIdeally, I only see this warning when I'm trying to use the analytics feature.\r\nAs an added measure, I should be able to suppress it by doing\r\n\r\n```\r\n        logging.getLogger('sagemaker').setLevel(logging.CRITICAL)\r\n        import sagemaker\r\n        logging.getLogger('sagemaker').setLevel(logging.WARNING)\r\n```\r\n\r\nbut because we're using the root logger object I have to change the log level globally by doing\r\n\r\n```\r\n        logging.basicConfig(level=logging.CRITICAL)\r\n        import sagemaker.session as session\r\n        logging.basicConfig(level=logging.INFO)\r\n```\r\n\r\n**Screenshots or logs**\r\nIf applicable, add screenshots or logs to help explain your problem.\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 1.66\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: N/A\r\n- **Framework version**: N/A\r\n- **Python version**: 3.6\r\n- **CPU or GPU**: N/A\r\n- **Custom Docker image (Y/N)**: N/A\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1696/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1696/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1582", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1582/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1582/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1582/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1582", "id": 637553899, "node_id": "MDU6SXNzdWU2Mzc1NTM4OTk=", "number": 1582, "title": "local_gpu with distributed training for single instance multi-gpu distributed training", "user": {"login": "ChaiBapchya", "id": 10992635, "node_id": "MDQ6VXNlcjEwOTkyNjM1", "avatar_url": "https://avatars.githubusercontent.com/u/10992635?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ChaiBapchya", "html_url": "https://github.com/ChaiBapchya", "followers_url": "https://api.github.com/users/ChaiBapchya/followers", "following_url": "https://api.github.com/users/ChaiBapchya/following{/other_user}", "gists_url": "https://api.github.com/users/ChaiBapchya/gists{/gist_id}", "starred_url": "https://api.github.com/users/ChaiBapchya/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ChaiBapchya/subscriptions", "organizations_url": "https://api.github.com/users/ChaiBapchya/orgs", "repos_url": "https://api.github.com/users/ChaiBapchya/repos", "events_url": "https://api.github.com/users/ChaiBapchya/events{/privacy}", "received_events_url": "https://api.github.com/users/ChaiBapchya/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 814413598, "node_id": "MDU6TGFiZWw4MTQ0MTM1OTg=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/In%20progress", "name": "In progress", "color": "33E997", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-06-12T07:42:04Z", "updated_at": "2020-06-17T17:59:38Z", "closed_at": "2020-06-17T17:59:37Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**Describe the bug**\r\nUpon testing for local-session [sagemaker], single instance, multi-gpu distributed training\r\n\r\nIt fails at \r\n```\r\nInput\r\ntraining_instance_type = 'local_gpu', distributions = {'mpi': {'enabled': True, 'processes_per_host': 4}}\r\n```\r\nStack Trace\r\n```\r\n    def warn_if_parameter_server_with_multi_gpu(training_instance_type, distributions):\r\n        \"\"\"Warn the user that training will not fully leverage all the GPU\r\n        cores if parameter server is enabled and a multi-GPU instance is selected.\r\n        Distributed training with the default parameter server setup doesn't\r\n        support multi-GPU instances.\r\n\r\n        Args:\r\n            training_instance_type (str): A string representing the type of training instance selected.\r\n            distributions (dict): A dictionary with information to enable distributed training.\r\n                (Defaults to None if distributed training is not enabled.) For example:\r\n\r\n                .. code:: python\r\n\r\n                    {\r\n                        'parameter_server':\r\n                        {\r\n                            'enabled': True\r\n                        }\r\n                    }\r\n\r\n\r\n        \"\"\"\r\n        if training_instance_type == \"local\" or distributions is None:\r\n            return\r\n\r\n        is_multi_gpu_instance = (\r\n>           training_instance_type.split(\".\")[1].startswith(\"p\")\r\n            and training_instance_type not in SINGLE_GPU_INSTANCE_TYPES\r\n        )\r\nE       IndexError: list index out of range\r\n\r\n.tox/py37/lib/python3.7/site-packages/sagemaker/fw_utils.py:620: IndexError\r\n````\r\n\r\n**To reproduce**\r\n```\r\ntox -e py37 -- tests/integ/test_horovod_mx.py\r\n```\r\n- Build custom docker image :\r\nhttps://github.com/ChaiBapchya/sagemaker-mxnet-training-toolkit/tree/mx_hvd_mpi\r\n- custom Sagemaker python SDK build from source : https://github.com/ChaiBapchya/sagemaker-python-sdk/tree/mx_estimator_horovod_mpi\r\n\r\n**Expected behavior**\r\nFor running Distributed training on single instance multi-gpu for mpi-based horovod, I encounter this error.\r\nSince I'm using horovod [mpi] this warning isn't relevant.\r\nI suggest we should also add local_gpu here\r\n\r\n```\r\nif training_instance_type in [\"local\",\"local_gpu\"] or distributions is None:\r\n            return\r\n```\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: Build from source [1.62.1.dev0]\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**:MXNet\r\n- **Framework version**:1.6.0\r\n- **Python version**:3\r\n- **CPU or GPU**:GPU\r\n- **Custom Docker image (Y/N)**:Y\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1582/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1582/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1501", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1501/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1501/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1501/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1501", "id": 619439043, "node_id": "MDU6SXNzdWU2MTk0MzkwNDM=", "number": 1501, "title": "S3Downloader.list() returns malformed URIs under Windows", "user": {"login": "alex23lemm", "id": 611112, "node_id": "MDQ6VXNlcjYxMTExMg==", "avatar_url": "https://avatars.githubusercontent.com/u/611112?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alex23lemm", "html_url": "https://github.com/alex23lemm", "followers_url": "https://api.github.com/users/alex23lemm/followers", "following_url": "https://api.github.com/users/alex23lemm/following{/other_user}", "gists_url": "https://api.github.com/users/alex23lemm/gists{/gist_id}", "starred_url": "https://api.github.com/users/alex23lemm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alex23lemm/subscriptions", "organizations_url": "https://api.github.com/users/alex23lemm/orgs", "repos_url": "https://api.github.com/users/alex23lemm/repos", "events_url": "https://api.github.com/users/alex23lemm/events{/privacy}", "received_events_url": "https://api.github.com/users/alex23lemm/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 850818746, "node_id": "MDU6TGFiZWw4NTA4MTg3NDY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/status:%20pending%20release", "name": "status: pending release", "color": "eee8d5", "default": false, "description": "issues for which fixes have been merged but not released to PyPI"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-05-16T10:33:07Z", "updated_at": "2020-05-26T15:43:51Z", "closed_at": "2020-05-26T15:43:50Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nInstead of a `/` after the bucket name `S3Downloader.list()` adds `\\\\` when constructing the URI under Windows resulting in an address that looks as follows:\r\n`s3://bucket_name\\\\models/output/model.tar.gz`\r\n\r\n**To reproduce**\r\nI assume that you have set up your credentials underneath `~/.aws` on your Windows machine. \r\n\r\n* On your machine install Miniconda https://docs.conda.io/en/latest/miniconda.html\r\n* Open the Anaconda Prompt and execute the following commands to set up a test environment:\r\n```\r\nconda create --name sagemaker-test\r\nconda activate sagemaker-test\r\nconda install pip\r\npip install sagemaker\r\n```\r\n\r\n* Save the following Python script underneath `C:\\examples\\s3downlader.py` and modify the S3 URI to test it against your S3 bucket:\r\n``` python\r\nimport sagemaker\r\n\r\ns3_downloader = sagemaker.s3.S3Downloader()\r\noutput_path = \"s3://[YOUR BUCKET NAME]/models/\"\r\nprint(s3_downloader.list(output_path))\r\n```\r\n\r\n* Back in Anaconda Prompt, execute the following command:\r\n```\r\npython c:\\examples\\s3downloader.py\r\n```\r\n\r\n* In my case the result looks as follows:\r\n\r\n```\r\n['s3://[REMOVED_MY_BUCKET_NAME]\\\\models/sagemaker-train-xgboost-15-May-2020-10-41-44/output/model.tar.gz',\r\n 's3://[REMOVED_MY_BUCKET_NAME]\\\\models/sagemaker-train-xgboost-15-May-2020-10-41-44/predictions/taxi_test.csv.out']\r\n```\r\n\r\n**Expected behavior**\r\nIn contrast, when I execute the Python script above in a SageMaker notebook, everything works as expected and the response looks as follows:\r\n```\r\n['s3://[REMOVED_MY_BUCKET_NAME]/models/sagemaker-train-xgboost-15-May-2020-10-41-44/output/model.tar.gz',\r\n 's3://[REMOVED_MY_BUCKET_NAME]/models/sagemaker-train-xgboost-15-May-2020-10-41-44/predictions/taxi_test.csv.out']\r\n```\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 1.58.2\r\n- **Python version**: 3.7\r\n- **OS**: Windows 10", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1501/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1501/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1486", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1486/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1486/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1486/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1486", "id": 615764589, "node_id": "MDU6SXNzdWU2MTU3NjQ1ODk=", "number": 1486, "title": "Local output path does not work in script mode with s3 code location", "user": {"login": "marcelgwerder", "id": 4008557, "node_id": "MDQ6VXNlcjQwMDg1NTc=", "avatar_url": "https://avatars.githubusercontent.com/u/4008557?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marcelgwerder", "html_url": "https://github.com/marcelgwerder", "followers_url": "https://api.github.com/users/marcelgwerder/followers", "following_url": "https://api.github.com/users/marcelgwerder/following{/other_user}", "gists_url": "https://api.github.com/users/marcelgwerder/gists{/gist_id}", "starred_url": "https://api.github.com/users/marcelgwerder/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marcelgwerder/subscriptions", "organizations_url": "https://api.github.com/users/marcelgwerder/orgs", "repos_url": "https://api.github.com/users/marcelgwerder/repos", "events_url": "https://api.github.com/users/marcelgwerder/events{/privacy}", "received_events_url": "https://api.github.com/users/marcelgwerder/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 850818746, "node_id": "MDU6TGFiZWw4NTA4MTg3NDY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/status:%20pending%20release", "name": "status: pending release", "color": "eee8d5", "default": false, "description": "issues for which fixes have been merged but not released to PyPI"}, {"id": 892238348, "node_id": "MDU6TGFiZWw4OTIyMzgzNDg=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/type:%20documentation", "name": "type: documentation", "color": "002b36", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-05-11T10:14:09Z", "updated_at": "2020-05-21T18:44:39Z", "closed_at": "2020-05-21T18:44:39Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nIt seems like when setting a code location the output bucket is used to derive the kms key if the code and output buckets match. \r\nhttps://github.com/aws/sagemaker-python-sdk/blob/c58bd0fac012d6e5093f5263a2547423fd427a77/src/sagemaker/estimator.py#L1732\r\n\r\nThe use of the `parse_s3_url` however makes it impossible to use a local output path in local mode because it expects a valid s3 url.\r\nhttps://github.com/aws/sagemaker-python-sdk/blob/c58bd0fac012d6e5093f5263a2547423fd427a77/src/sagemaker/s3.py#L33\r\n\r\n**To reproduce**\r\nWhen using the `sagemaker.estimator.Framework` class or any class extending it, use local mode with local output path and specify a code location on s3.\r\n\r\n**Expected behavior**\r\nEverything works just like when using the estimator class. I should be able to use a local output path even when setting an s3 code location.\r\n\r\n**Screenshots or logs**\r\n```\r\n~/anaconda3/envs/sm/lib/python3.6/site-packages/sagemaker/estimator.py in fit(self, inputs, wait, logs, job_name, experiment_config)\r\n    489 \r\n    490         \"\"\"\r\n--> 491         self._prepare_for_training(job_name=job_name)\r\n    492 \r\n    493         self.latest_training_job = _TrainingJob.start_new(self, inputs, experiment_config)\r\n\r\n~/anaconda3/envs/sm/lib/python3.6/site-packages/sagemaker/estimator.py in _prepare_for_training(self, job_name)\r\n   1685             self.code_uri = self.uploaded_code.s3_prefix\r\n   1686         else:\r\n-> 1687             self.uploaded_code = self._stage_user_code_in_s3()\r\n   1688             code_dir = self.uploaded_code.s3_prefix\r\n   1689             script = self.uploaded_code.script_name\r\n\r\n~/anaconda3/envs/sm/lib/python3.6/site-packages/sagemaker/estimator.py in _stage_user_code_in_s3(self)\r\n   1730             code_s3_prefix = \"/\".join(filter(None, [key_prefix, self._current_job_name, \"source\"]))\r\n   1731 \r\n-> 1732             output_bucket, _ = parse_s3_url(self.output_path)\r\n   1733             kms_key = self.output_kms_key if code_bucket == output_bucket else None\r\n   1734 \r\n\r\n~/anaconda3/envs/sm/lib/python3.6/site-packages/sagemaker/fw_utils.py in parse_s3_url(url)\r\n    549         str: S3 bucket name str: S3 key\r\n    550     \"\"\"\r\n--> 551     return s3.parse_s3_url(url)\r\n    552 \r\n    553 \r\n\r\n~/anaconda3/envs/sm/lib/python3.6/site-packages/sagemaker/s3.py in parse_s3_url(url)\r\n     31     parsed_url = urlparse(url)\r\n     32     if parsed_url.scheme != \"s3\":\r\n---> 33         raise ValueError(\"Expecting 's3' scheme, got: {} in {}.\".format(parsed_url.scheme, url))\r\n     34     return parsed_url.netloc, parsed_url.path.lstrip(\"/\")\r\n     35 \r\n\r\nValueError: Expecting 's3' scheme, got: file in file:///data/07_model_output/wnut17.\r\n```\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**:  1.57.0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: Custom algorithm with `Framework` class\r\n- **Framework version**:\r\n- **Python version**: 3.6.10\r\n- **CPU or GPU**:  CPU\r\n- **Custom Docker image (Y/N)**: Y\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1486/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1486/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1469", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1469/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1469/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1469/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1469", "id": 614199264, "node_id": "MDU6SXNzdWU2MTQxOTkyNjQ=", "number": 1469, "title": "Upgraded pip fails to install packages with enum34", "user": {"login": "ehsanmok", "id": 6980212, "node_id": "MDQ6VXNlcjY5ODAyMTI=", "avatar_url": "https://avatars.githubusercontent.com/u/6980212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ehsanmok", "html_url": "https://github.com/ehsanmok", "followers_url": "https://api.github.com/users/ehsanmok/followers", "following_url": "https://api.github.com/users/ehsanmok/following{/other_user}", "gists_url": "https://api.github.com/users/ehsanmok/gists{/gist_id}", "starred_url": "https://api.github.com/users/ehsanmok/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ehsanmok/subscriptions", "organizations_url": "https://api.github.com/users/ehsanmok/orgs", "repos_url": "https://api.github.com/users/ehsanmok/repos", "events_url": "https://api.github.com/users/ehsanmok/events{/privacy}", "received_events_url": "https://api.github.com/users/ehsanmok/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 850818746, "node_id": "MDU6TGFiZWw4NTA4MTg3NDY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/status:%20pending%20release", "name": "status: pending release", "color": "eee8d5", "default": false, "description": "issues for which fixes have been merged but not released to PyPI"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/milestones/3", "html_url": "https://github.com/aws/sagemaker-python-sdk/milestone/3", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/milestones/3/labels", "id": 5395715, "node_id": "MDk6TWlsZXN0b25lNTM5NTcxNQ==", "number": 3, "title": "v2.0.0.rc1", "description": "", "creator": {"login": "laurenyu", "id": 6631887, "node_id": "MDQ6VXNlcjY2MzE4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/6631887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/laurenyu", "html_url": "https://github.com/laurenyu", "followers_url": "https://api.github.com/users/laurenyu/followers", "following_url": "https://api.github.com/users/laurenyu/following{/other_user}", "gists_url": "https://api.github.com/users/laurenyu/gists{/gist_id}", "starred_url": "https://api.github.com/users/laurenyu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/laurenyu/subscriptions", "organizations_url": "https://api.github.com/users/laurenyu/orgs", "repos_url": "https://api.github.com/users/laurenyu/repos", "events_url": "https://api.github.com/users/laurenyu/events{/privacy}", "received_events_url": "https://api.github.com/users/laurenyu/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 4, "state": "closed", "created_at": "2020-05-07T22:18:06Z", "updated_at": "2020-07-13T19:28:31Z", "due_on": null, "closed_at": "2020-07-10T15:42:05Z"}, "comments": 7, "created_at": "2020-05-07T16:46:40Z", "updated_at": "2020-07-09T16:34:39Z", "closed_at": "2020-07-09T16:34:39Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nUpgraded `pip` to the v20.1 fails to install GluonTS. Need to [remove `enum34`](https://github.com/iterative/dvc/issues/1995) from conda envs.\r\n\r\n**To reproduce**\r\n\r\n```\r\npython -m pip install --upgrade -q pip\r\npython -m pip install -q git+https://github.com/awslabs/gluon-ts@master \r\n```\r\n\r\n**Screenshots or logs**\r\n```\r\nAttributeError: module 'enum' has no attribute 'IntFlag'\r\n```\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 1.56.1\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: MXNet but should affect all conda env\r\n- **Framework version**: 1.6.0\r\n- **Python version**: py36\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\n\r\nRelated to #1428 ", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1469/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1469/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1448", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1448/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1448/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1448/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1448", "id": 610996826, "node_id": "MDU6SXNzdWU2MTA5OTY4MjY=", "number": 1448, "title": "training_config does not return MetricDefinitions", "user": {"login": "shunjd", "id": 54326218, "node_id": "MDQ6VXNlcjU0MzI2MjE4", "avatar_url": "https://avatars.githubusercontent.com/u/54326218?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shunjd", "html_url": "https://github.com/shunjd", "followers_url": "https://api.github.com/users/shunjd/followers", "following_url": "https://api.github.com/users/shunjd/following{/other_user}", "gists_url": "https://api.github.com/users/shunjd/gists{/gist_id}", "starred_url": "https://api.github.com/users/shunjd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shunjd/subscriptions", "organizations_url": "https://api.github.com/users/shunjd/orgs", "repos_url": "https://api.github.com/users/shunjd/repos", "events_url": "https://api.github.com/users/shunjd/events{/privacy}", "received_events_url": "https://api.github.com/users/shunjd/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 850818746, "node_id": "MDU6TGFiZWw4NTA4MTg3NDY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/status:%20pending%20release", "name": "status: pending release", "color": "eee8d5", "default": false, "description": "issues for which fixes have been merged but not released to PyPI"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-05-01T22:21:22Z", "updated_at": "2020-05-07T17:32:58Z", "closed_at": "2020-05-07T17:32:58Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\n`sagemaker.workflow.airflow.training_config` does not return the `MetricDefinitions` when it is provided in the estimator. However, `tuning_config` does have it.\r\n\r\nRelated: https://github.com/aws/aws-step-functions-data-science-sdk-python/issues/40\r\n\r\nMetricDefinitions in `tuning_config`\r\nhttps://github.com/aws/sagemaker-python-sdk/blob/aceb8e013848937f6cbb0d7c2f0dffdff1f5aabf/src/sagemaker/workflow/airflow.py#L372\r\n\r\n**To reproduce**\r\n```\r\nestimator = sagemaker.estimator.Estimator(\r\n        PCA_IMAGE,\r\n        role=EXECUTION_ROLE,\r\n        train_instance_count=1,\r\n        train_instance_type='ml.c4.xlarge',\r\n        output_path=s3_output_location,\r\n        metric_definitions=[{'Name': 'foo', 'Regex': 'bar=(.*?);'}]\r\n    )\r\n\r\nresult = training_config(estimator)\r\nprint(result)\r\n```\r\n\r\n**Expected behavior**\r\n`MetricDefinitions` should be included in the result.\r\n\r\n**Screenshots or logs**\r\nN/A\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: latest\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: Estimator/TensforFlow\r\n- **Framework version**:\r\n- **Python version**:\r\n- **CPU or GPU**:\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\nN/A", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1448/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1448/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1374", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1374/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1374/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1374/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1374", "id": 587332662, "node_id": "MDU6SXNzdWU1ODczMzI2NjI=", "number": 1374, "title": "Local _SageMakerContainer cannot run in --detached mode", "user": {"login": "atotev", "id": 10067176, "node_id": "MDQ6VXNlcjEwMDY3MTc2", "avatar_url": "https://avatars.githubusercontent.com/u/10067176?v=4", "gravatar_id": "", "url": "https://api.github.com/users/atotev", "html_url": "https://github.com/atotev", "followers_url": "https://api.github.com/users/atotev/followers", "following_url": "https://api.github.com/users/atotev/following{/other_user}", "gists_url": "https://api.github.com/users/atotev/gists{/gist_id}", "starred_url": "https://api.github.com/users/atotev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/atotev/subscriptions", "organizations_url": "https://api.github.com/users/atotev/orgs", "repos_url": "https://api.github.com/users/atotev/repos", "events_url": "https://api.github.com/users/atotev/events{/privacy}", "received_events_url": "https://api.github.com/users/atotev/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 850818746, "node_id": "MDU6TGFiZWw4NTA4MTg3NDY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/status:%20pending%20release", "name": "status: pending release", "color": "eee8d5", "default": false, "description": "issues for which fixes have been merged but not released to PyPI"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-03-24T23:06:46Z", "updated_at": "2020-03-26T17:52:21Z", "closed_at": "2020-03-26T17:52:20Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**Describe the bug**\r\nThe `detached` parameter of the `_SageMakerContainer._compose()` method conflicts with the `--abort-on-container-exit` option which is set unconditionally. Per [docker-compose reference](https://docs.docker.com/compose/reference/up/):\r\n\r\n```\r\nOptions:\r\n    -d, --detach               Detached mode: Run containers in the background,\r\n                               print new container names. Incompatible with\r\n                               --abort-on-container-exit.\r\n```\r\n\r\n \r\n\r\n**To reproduce**\r\nCall `self._compose(True)` leads to the following error:\r\n\r\n```\r\nException in thread Thread-4:\r\nTraceback (most recent call last):\r\n  File \"/home/user/test/venv/lib/python3.6/site-packages/sagemaker/local/image.py\", line 614, in run\r\n    _stream_output(self.process)\r\n  File \"/home/user/test/venv/lib/python3.6/site-packages/sagemaker/local/image.py\", line 673, in _stream_output\r\n    raise RuntimeError(\"Process exited with code: %s\" % exit_code)\r\nRuntimeError: Process exited with code: 1\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3.6/threading.py\", line 916, in _bootstrap_inner\r\n    self.run()\r\n  File \"/home/user/test/venv/lib/python3.6/site-packages/sagemaker/local/image.py\", line 619, in run\r\n    raise RuntimeError(msg)\r\nRuntimeError: Failed to run: ['docker-compose', '-f', '/tmp/tmpxxte1jk0/docker-compose.yaml', 'up', '--build', '--abort-on-container-exit', '-d'], Process exited with code: 1\r\n```\r\n\r\n**Expected behavior**\r\nThe container should start with no errors.\r\n\r\n**Screenshots or logs**\r\nStacktrace provided.\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 1.52.0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: VW\r\n- **Framework version**: 8.7.0\r\n- **Python version**: 3.6\r\n- **CPU or GPU**: CPU\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1374/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1374/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1372", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1372/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1372/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1372/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1372", "id": 585539811, "node_id": "MDU6SXNzdWU1ODU1Mzk4MTE=", "number": 1372, "title": "Stalled PyTorch training job on SageMaker with custom image", "user": {"login": "mattmcclean", "id": 788855, "node_id": "MDQ6VXNlcjc4ODg1NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/788855?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mattmcclean", "html_url": "https://github.com/mattmcclean", "followers_url": "https://api.github.com/users/mattmcclean/followers", "following_url": "https://api.github.com/users/mattmcclean/following{/other_user}", "gists_url": "https://api.github.com/users/mattmcclean/gists{/gist_id}", "starred_url": "https://api.github.com/users/mattmcclean/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mattmcclean/subscriptions", "organizations_url": "https://api.github.com/users/mattmcclean/orgs", "repos_url": "https://api.github.com/users/mattmcclean/repos", "events_url": "https://api.github.com/users/mattmcclean/events{/privacy}", "received_events_url": "https://api.github.com/users/mattmcclean/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2020-03-21T17:12:28Z", "updated_at": "2021-10-02T06:20:26Z", "closed_at": "2021-10-02T06:20:26Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**Describe the bug**\r\nI have found an issue training a PyTorch based model with SageMaker. The training job stalls and does not return any log at a certain point. I have tried to run the same training job locally on a SageMaker Notebook Instance in `local` mode and it works fine.\r\n\r\n**To reproduce**\r\nHere is the code I used to train the model:\r\n\r\n```\r\nimport boto3\r\nfrom sagemaker.pytorch import PyTorch\r\nimport sagemaker as sage\r\n\r\n# upload training data to S3\r\nsess = sage.Session()\r\ndata_location = sess.upload_data(path, key_prefix=prefix)\r\n\r\nclient = boto3.client('sts')\r\naccount = client.get_caller_identity()['Account']\r\nmy_session = boto3.session.Session()\r\nregion = my_session.region_name\r\nalgorithm_name = 'fastai2-oxford-pets-sagemaker-example'\r\necr_image = '{}.dkr.ecr.{}.amazonaws.com/{}-{}:latest'.format(account, region, algorithm_name, 'training')\r\n\r\n# run the training job\r\nhyperparameters = {'epochs': 2}\r\ninstance_type = 'ml.p3.2xlarge'\r\nestimator = PyTorch(source_dir='container/oxford-pets',\r\n                    entry_point='oxford-pets.py',\r\n                    role=role,\r\n                    train_instance_count=1,\r\n                    train_instance_type=instance_type,\r\n                    framework_version='1.4.0',\r\n                    py_version='py3',\r\n                    hyperparameters=hyperparameters,\r\n                    image_name=ecr_image)\r\n\r\nestimator.fit(data_location)\r\n```\r\n\r\n**Expected behavior**\r\nI expect the remote training job to run in the same way as the local training job.\r\n\r\n**Screenshots or logs**\r\n\r\nHere are the logs from CloudWatch when running the training job on SageMaker:\r\n```\r\n---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n|   timestamp   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 message                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |\r\n|---------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\r\n| 1584809751611 | bash: cannot set terminal process group (-1): Inappropriate ioctl for device                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |\r\n| 1584809751611 | bash: no job control in this shell                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |\r\n| 1584809752611 | 2020-03-21 16:55:52,398 sagemaker-containers INFO     Imported framework sagemaker_pytorch_container.training                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |\r\n| 1584809752611 | 2020-03-21 16:55:52,421 sagemaker_pytorch_container.training INFO     Block until all host DNS lookups succeed.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |\r\n| 1584809754612 | 2020-03-21 16:55:53,875 sagemaker_pytorch_container.training INFO     Invoking user training script.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |\r\n| 1584809754612 | 2020-03-21 16:55:54,132 sagemaker-containers INFO     Module default_user_module_name does not provide a setup.py.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |\r\n| 1584809754612 | Generating setup.py                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |\r\n| 1584809754612 | 2020-03-21 16:55:54,132 sagemaker-containers INFO     Generating setup.cfg                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |\r\n| 1584809754612 | 2020-03-21 16:55:54,132 sagemaker-containers INFO     Generating MANIFEST.in                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |\r\n| 1584809754612 | 2020-03-21 16:55:54,132 sagemaker-containers INFO     Installing module with the following command:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |\r\n| 1584809754612 | /opt/conda/bin/python -m pip install .                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\r\n| 1584809755613 | Processing /tmp/tmpnauetv9h/module_dir                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\r\n| 1584809755613 | Building wheels for collected packages: default-user-module-name   Building wheel for default-user-module-name (setup.py): started   Building wheel for default-user-module-name (setup.py): finished with status 'done'   Created wheel for default-user-module-name: filename=default_user_module_name-1.0.0-py2.py3-none-any.whl size=4363 sha256=0a635403d69c368f1f1cd92132ecda70c3f413161b66290a1e8f51480ff25087   Stored in directory: /tmp/pip-ephem-wheel-cache-tnzgd27m/wheels/0c/79/09/07c6c63bdf9a903552bed453a9418666c007f39c160a72555f                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |\r\n| 1584809755613 | Successfully built default-user-module-name                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |\r\n| 1584809756613 | Installing collected packages: default-user-module-name                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |\r\n| 1584809756613 | Successfully installed default-user-module-name-1.0.0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |\r\n| 1584809756613 | 2020-03-21 16:55:56,318 sagemaker-containers INFO     Invoking user script                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |\r\n| 1584809756613 | Training Env:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |\r\n| 1584809756614 | {     \"additional_framework_parameters\": {},     \"channel_input_dirs\": {         \"training\": \"/opt/ml/input/data/training\"     },     \"current_host\": \"algo-1\",     \"framework_module\": \"sagemaker_pytorch_container.training:main\",     \"hosts\": [         \"algo-1\"     ],     \"hyperparameters\": {         \"epochs\": 2     },     \"input_config_dir\": \"/opt/ml/input/config\",     \"input_data_config\": {         \"training\": {             \"TrainingInputMode\": \"File\",             \"S3DistributionType\": \"FullyReplicated\",             \"RecordWrapperType\": \"None\"         }     },     \"input_dir\": \"/opt/ml/input\",     \"is_master\": true,     \"job_name\": \"fastai2-oxford-pets-sagemaker-example-t-2020-03-21-16-48-47-522\",     \"log_level\": 20,     \"master_hostname\": \"algo-1\",     \"model_dir\": \"/opt/ml/model\",     \"module_dir\": \"s3://sagemaker-eu-west-1-934676248949/fastai2-oxford-pets-sagemaker-example-t-2020-03-21-16-48-47-522/source/sourcedir.tar.gz\",     \"module_name\": \"oxford-pets\",     \"network_interface_name\": \"eth0\",     \"num_cpus\": 8,     \"num_gpus\": 1,     \"output_data_dir\": \"/opt/ml/output/data\",     \"output_dir\": \"/opt/ml/output\",     \"output_intermediate_dir\": \"/opt/ml/output/intermediate\",     \"resource_config\": {         \"current_host\": \"algo-1\",         \"hosts\": [             \"algo-1\"         ],         \"network_interface_name\": \"eth0\"     },     \"user_entry_point\": \"oxford-pets.py\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |\r\n| 1584809756614 | }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |\r\n| 1584809756614 | Environment variables:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\r\n| 1584809756614 | SM_HOSTS=[\"algo-1\"]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |\r\n| 1584809756614 | SM_NETWORK_INTERFACE_NAME=eth0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |\r\n| 1584809756614 | SM_HPS={\"epochs\":2}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |\r\n| 1584809756615 | SM_USER_ENTRY_POINT=oxford-pets.py                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |\r\n| 1584809756615 | SM_FRAMEWORK_PARAMS={}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\r\n| 1584809756615 | SM_RESOURCE_CONFIG={\"current_host\":\"algo-1\",\"hosts\":[\"algo-1\"],\"network_interface_name\":\"eth0\"}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |\r\n| 1584809756615 | SM_INPUT_DATA_CONFIG={\"training\":{\"RecordWrapperType\":\"None\",\"S3DistributionType\":\"FullyReplicated\",\"TrainingInputMode\":\"File\"}}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |\r\n| 1584809756615 | SM_OUTPUT_DATA_DIR=/opt/ml/output/data                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\r\n| 1584809756615 | SM_CHANNELS=[\"training\"]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\r\n| 1584809756615 | SM_CURRENT_HOST=algo-1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\r\n| 1584809756615 | SM_MODULE_NAME=oxford-pets                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |\r\n| 1584809756615 | SM_LOG_LEVEL=20                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |\r\n| 1584809756615 | SM_FRAMEWORK_MODULE=sagemaker_pytorch_container.training:main                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |\r\n| 1584809756615 | SM_INPUT_DIR=/opt/ml/input                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |\r\n| 1584809756615 | SM_INPUT_CONFIG_DIR=/opt/ml/input/config                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\r\n| 1584809756615 | SM_OUTPUT_DIR=/opt/ml/output                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |\r\n| 1584809756615 | SM_NUM_CPUS=8                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |\r\n| 1584809756615 | SM_NUM_GPUS=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |\r\n| 1584809756615 | SM_MODEL_DIR=/opt/ml/model                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |\r\n| 1584809756615 | SM_MODULE_DIR=s3://sagemaker-eu-west-1-934676248949/fastai2-oxford-pets-sagemaker-example-t-2020-03-21-16-48-47-522/source/sourcedir.tar.gz                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |\r\n| 1584809756615 | SM_TRAINING_ENV={\"additional_framework_parameters\":{},\"channel_input_dirs\":{\"training\":\"/opt/ml/input/data/training\"},\"current_host\":\"algo-1\",\"framework_module\":\"sagemaker_pytorch_container.training:main\",\"hosts\":[\"algo-1\"],\"hyperparameters\":{\"epochs\":2},\"input_config_dir\":\"/opt/ml/input/config\",\"input_data_config\":{\"training\":{\"RecordWrapperType\":\"None\",\"S3DistributionType\":\"FullyReplicated\",\"TrainingInputMode\":\"File\"}},\"input_dir\":\"/opt/ml/input\",\"is_master\":true,\"job_name\":\"fastai2-oxford-pets-sagemaker-example-t-2020-03-21-16-48-47-522\",\"log_level\":20,\"master_hostname\":\"algo-1\",\"model_dir\":\"/opt/ml/model\",\"module_dir\":\"s3://sagemaker-eu-west-1-934676248949/fastai2-oxford-pets-sagemaker-example-t-2020-03-21-16-48-47-522/source/sourcedir.tar.gz\",\"module_name\":\"oxford-pets\",\"network_interface_name\":\"eth0\",\"num_cpus\":8,\"num_gpus\":1,\"output_data_dir\":\"/opt/ml/output/data\",\"output_dir\":\"/opt/ml/output\",\"output_intermediate_dir\":\"/opt/ml/output/intermediate\",\"resource_config\":{\"current_host\":\"algo-1\",\"hosts\":[\"algo-1\"],\"network_interface_name\":\"eth0\"},\"user_entry_point\":\"oxford-pets.py\"}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |\r\n| 1584809756615 | SM_USER_ARGS=[\"--epochs\",\"2\"]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |\r\n| 1584809756615 | SM_OUTPUT_INTERMEDIATE_DIR=/opt/ml/output/intermediate                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\r\n| 1584809756615 | SM_CHANNEL_TRAINING=/opt/ml/input/data/training                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |\r\n| 1584809756615 | SM_HP_EPOCHS=2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |\r\n| 1584809756615 | PYTHONPATH=/opt/ml/code:/opt/conda/bin:/opt/conda/lib/python36.zip:/opt/conda/lib/python3.6:/opt/conda/lib/python3.6/lib-dynload:/opt/conda/lib/python3.6/site-packages                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |\r\n| 1584809756616 | Invoking script with the following command:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |\r\n| 1584809756616 | /opt/conda/bin/python oxford-pets.py --epochs 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |\r\n| 1584809769641 | [2020-03-21 16:56:08.752 algo-1:46 INFO json_config.py:90] Creating hook from json_config at /opt/ml/input/config/debughookconfig.json.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |\r\n| 1584809769641 | Downloading: \"https://download.pytorch.org/models/resnet50-19c8e357.pth\" to /root/.cache/torch/checkpoints/resnet50-19c8e357.pth                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |\r\n| 1584809769641 | [2020-03-21 16:56:08.752 algo-1:46 INFO hook.py:170] tensorboard_dir has not been set for the hook. SMDebug will not be exporting tensorboard summaries.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\r\n| 1584809769641 | #015  0%|          | 0.00/97.8M [00:00<?, ?B/s]#015  3%|\u258e         | 2.52M/97.8M [00:00<00:03, 26.4MB/s]#015  5%|\u258c         | 5.25M/97.8M [00:00<00:03, 26.9MB/s]#015  8%|\u258a         | 7.75M/97.8M [00:00<00:03, 26.2MB/s]#015 11%|\u2588         | 10.6M/97.8M [00:00<00:03, 27.1MB/s]#015 14%|\u2588\u258e        | 13.3M/97.8M [00:00<00:03, 27.5MB/s]#015 16%|\u2588\u258b        | 15.9M/97.8M [00:00<00:03, 27.6MB/s]#015 19%|\u2588\u2589        | 18.7M/97.8M [00:00<00:02, 27.8MB/s]#015 22%|\u2588\u2588\u258f       | 21.2M/97.8M [00:00<00:02, 27.3MB/s]#015 24%|\u2588\u2588\u258d       | 23.9M/97.8M [00:00<00:02, 27.5MB/s]#015 27%|\u2588\u2588\u258b       | 26.6M/97.8M [00:01<00:02, 27.8MB/s]#015 30%|\u2588\u2588\u2589       | 29.3M/97.8M [00:01<00:02, 27.9MB/s]#015 33%|\u2588\u2588\u2588\u258e      | 31.9M/97.8M [00:01<00:02, 27.8MB/s]#015 35%|\u2588\u2588\u2588\u258c      | 34.6M/97.8M [00:01<00:02, 27.8MB/s]#015 38%|\u2588\u2588\u2588\u258a      | 37.4M/97.8M [00:01<00:02, 28.0MB/s]#015 41%|\u2588\u2588\u2588\u2588      | 40.1M/97.8M [00:01<00:02, 28.2MB/s]#015 44%|\u2588\u2588\u2588\u2588\u258d     | 42.8M/97.8M [00:01<00:02, 28.2MB/s]#015 47%|\u2588\u2588\u2588\u2588\u258b     | 45.6M/97.8M [00:01<00:01, 28.4MB/s]#015 49%|\u2588\u2588\u2588\u2588\u2589     | 48.3M/97.8M [00:01<00:01, 27.7MB/s]#015 52%|\u2588\u2588\u2588\u2588\u2588\u258f    | 50.9M/97.8M [00:01<00:01, 27.7MB/s]#015 55%|\u2588\u2588\u2588\u2588\u2588\u258d    | 53.6M/97.8M [00:02<00:01, 27.9MB/s]#015 58%|\u2588\u2588\u2588\u2588\u2588\u258a    | 56.3M/97.8M [00:02<00:01, 27.1MB/s]#015 60%|\u2588\u2588\u2588\u2588\u2588\u2588    | 59.0M/97.8M [00:02<00:01, 27.5MB/s]#015 63%|\u2588\u2588\u2588\u2588\u2588\u2588\u258e   | 61.8M/97.8M [00:02<00:01, 27.8MB/s]#015 66%|\u2588\u2588\u2588\u2588\u2588\u2588\u258c   | 64.5M/97.8M [00:02<00:01, 28.1MB/s]#015 69%|\u2588\u2588\u2588\u2588\u2588\u2588\u2589   | 67.2M/97.8M [00:02<00:01, 28.3MB/s]#015 72%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258f  | 70.0M/97.8M [00:02<00:01, 28.3MB/s]#015 74%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d  | 72.8M/97.8M [00:02<00:00, 28.5MB/s]#015 77%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b  | 75.5M/97.8M [00:02<00:00, 28.0MB/s]#015 80%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588  | 78.2M/97.8M [00:02<00:00, 28.1MB/s]#015 83%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258e | 81.0M/97.8M [00:03<00:00, 28.4MB/s]#015 86%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c | 83.7M/97.8M [00:03<00:00, 28.3MB/s]#015 88%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a | 86.4M/97.8M [00:03<00:00, 28.4MB/s]#015 91%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 | 89.2M/97.8M [00:03<00:00, 28.4MB/s]#015 94%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d| 91.9M/97.8M [00:03<00:00, 27.8MB/s]#015 97%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258b| 94.6M/97.8M [00:03<00:00, 28.0MB/s]#015100%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2589| 97.3M/97.8M [00:03<00:00, 28.0MB/s]#015100%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588| 97.8M/97.8M [00:03<00:00, 27.9MB/s] |\r\n| 1584809769641 | [2020-03-21 16:56:08.752 algo-1:46 INFO hook.py:215] Saving to /opt/ml/output/tensors                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |\r\n---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n```\r\n\r\nHere are the logs when running in `local` mode. It ran successfully with the same Docker image:\r\n```\r\nCreating tmpsp4f4h0t_algo-1-636se_1 ... \r\nAttaching to tmpsp4f4h0t_algo-1-636se_12mdone\r\nalgo-1-636se_1  | 2020-03-21 16:44:10,168 sagemaker-containers INFO     Imported framework sagemaker_pytorch_container.training\r\nalgo-1-636se_1  | 2020-03-21 16:44:10,201 sagemaker_pytorch_container.training INFO     Block until all host DNS lookups succeed.\r\nalgo-1-636se_1  | 2020-03-21 16:44:10,202 sagemaker_pytorch_container.training INFO     Invoking user training script.\r\nalgo-1-636se_1  | 2020-03-21 16:44:10,348 sagemaker-containers INFO     Module default_user_module_name does not provide a setup.py. \r\nalgo-1-636se_1  | Generating setup.py\r\nalgo-1-636se_1  | 2020-03-21 16:44:10,348 sagemaker-containers INFO     Generating setup.cfg\r\nalgo-1-636se_1  | 2020-03-21 16:44:10,348 sagemaker-containers INFO     Generating MANIFEST.in\r\nalgo-1-636se_1  | 2020-03-21 16:44:10,349 sagemaker-containers INFO     Installing module with the following command:\r\nalgo-1-636se_1  | /opt/conda/bin/python -m pip install . \r\nalgo-1-636se_1  | Processing /tmp/tmp5fvc5oxc/module_dir\r\nalgo-1-636se_1  | Building wheels for collected packages: default-user-module-name\r\nalgo-1-636se_1  |   Building wheel for default-user-module-name (setup.py) ... done\r\nalgo-1-636se_1  |   Created wheel for default-user-module-name: filename=default_user_module_name-1.0.0-py2.py3-none-any.whl size=4364 sha256=9b9736c6048e647a361000af0385eaf0507f14fbaf41ed0e8dddd7c383462a08\r\nalgo-1-636se_1  |   Stored in directory: /tmp/pip-ephem-wheel-cache-nahh2sra/wheels/29/99/43/3d5edfdcc8f0955107dd1c3bbb438930ef19cddf2d205fb4b8\r\nalgo-1-636se_1  | Successfully built default-user-module-name\r\nalgo-1-636se_1  | Installing collected packages: default-user-module-name\r\nalgo-1-636se_1  | Successfully installed default-user-module-name-1.0.0\r\nalgo-1-636se_1  | 2020-03-21 16:44:12,595 sagemaker-containers INFO     Invoking user script\r\nalgo-1-636se_1  | \r\nalgo-1-636se_1  | Training Env:\r\nalgo-1-636se_1  | \r\nalgo-1-636se_1  | {\r\nalgo-1-636se_1  |     \"additional_framework_parameters\": {},\r\nalgo-1-636se_1  |     \"channel_input_dirs\": {\r\nalgo-1-636se_1  |         \"training\": \"/opt/ml/input/data/training\"\r\nalgo-1-636se_1  |     },\r\nalgo-1-636se_1  |     \"current_host\": \"algo-1-636se\",\r\nalgo-1-636se_1  |     \"framework_module\": \"sagemaker_pytorch_container.training:main\",\r\nalgo-1-636se_1  |     \"hosts\": [\r\nalgo-1-636se_1  |         \"algo-1-636se\"\r\nalgo-1-636se_1  |     ],\r\nalgo-1-636se_1  |     \"hyperparameters\": {\r\nalgo-1-636se_1  |         \"epochs\": 2\r\nalgo-1-636se_1  |     },\r\nalgo-1-636se_1  |     \"input_config_dir\": \"/opt/ml/input/config\",\r\nalgo-1-636se_1  |     \"input_data_config\": {\r\nalgo-1-636se_1  |         \"training\": {\r\nalgo-1-636se_1  |             \"TrainingInputMode\": \"File\"\r\nalgo-1-636se_1  |         }\r\nalgo-1-636se_1  |     },\r\nalgo-1-636se_1  |     \"input_dir\": \"/opt/ml/input\",\r\nalgo-1-636se_1  |     \"is_master\": true,\r\nalgo-1-636se_1  |     \"job_name\": \"fastai2-oxford-pets-sagemaker-example-t-2020-03-21-16-44-07-259\",\r\nalgo-1-636se_1  |     \"log_level\": 20,\r\nalgo-1-636se_1  |     \"master_hostname\": \"algo-1-636se\",\r\nalgo-1-636se_1  |     \"model_dir\": \"/opt/ml/model\",\r\nalgo-1-636se_1  |     \"module_dir\": \"s3://sagemaker-eu-west-1-934676248949/fastai2-oxford-pets-sagemaker-example-t-2020-03-21-16-44-07-259/source/sourcedir.tar.gz\",\r\nalgo-1-636se_1  |     \"module_name\": \"oxford-pets\",\r\nalgo-1-636se_1  |     \"network_interface_name\": \"eth0\",\r\nalgo-1-636se_1  |     \"num_cpus\": 8,\r\nalgo-1-636se_1  |     \"num_gpus\": 1,\r\nalgo-1-636se_1  |     \"output_data_dir\": \"/opt/ml/output/data\",\r\nalgo-1-636se_1  |     \"output_dir\": \"/opt/ml/output\",\r\nalgo-1-636se_1  |     \"output_intermediate_dir\": \"/opt/ml/output/intermediate\",\r\nalgo-1-636se_1  |     \"resource_config\": {\r\nalgo-1-636se_1  |         \"current_host\": \"algo-1-636se\",\r\nalgo-1-636se_1  |         \"hosts\": [\r\nalgo-1-636se_1  |             \"algo-1-636se\"\r\nalgo-1-636se_1  |         ]\r\nalgo-1-636se_1  |     },\r\nalgo-1-636se_1  |     \"user_entry_point\": \"oxford-pets.py\"\r\nalgo-1-636se_1  | }\r\nalgo-1-636se_1  | \r\nalgo-1-636se_1  | Environment variables:\r\nalgo-1-636se_1  | \r\nalgo-1-636se_1  | SM_HOSTS=[\"algo-1-636se\"]\r\nalgo-1-636se_1  | SM_NETWORK_INTERFACE_NAME=eth0\r\nalgo-1-636se_1  | SM_HPS={\"epochs\":2}\r\nalgo-1-636se_1  | SM_USER_ENTRY_POINT=oxford-pets.py\r\nalgo-1-636se_1  | SM_FRAMEWORK_PARAMS={}\r\nalgo-1-636se_1  | SM_RESOURCE_CONFIG={\"current_host\":\"algo-1-636se\",\"hosts\":[\"algo-1-636se\"]}\r\nalgo-1-636se_1  | SM_INPUT_DATA_CONFIG={\"training\":{\"TrainingInputMode\":\"File\"}}\r\nalgo-1-636se_1  | SM_OUTPUT_DATA_DIR=/opt/ml/output/data\r\nalgo-1-636se_1  | SM_CHANNELS=[\"training\"]\r\nalgo-1-636se_1  | SM_CURRENT_HOST=algo-1-636se\r\nalgo-1-636se_1  | SM_MODULE_NAME=oxford-pets\r\nalgo-1-636se_1  | SM_LOG_LEVEL=20\r\nalgo-1-636se_1  | SM_FRAMEWORK_MODULE=sagemaker_pytorch_container.training:main\r\nalgo-1-636se_1  | SM_INPUT_DIR=/opt/ml/input\r\nalgo-1-636se_1  | SM_INPUT_CONFIG_DIR=/opt/ml/input/config\r\nalgo-1-636se_1  | SM_OUTPUT_DIR=/opt/ml/output\r\nalgo-1-636se_1  | SM_NUM_CPUS=8\r\nalgo-1-636se_1  | SM_NUM_GPUS=1\r\nalgo-1-636se_1  | SM_MODEL_DIR=/opt/ml/model\r\nalgo-1-636se_1  | SM_MODULE_DIR=s3://sagemaker-eu-west-1-934676248949/fastai2-oxford-pets-sagemaker-example-t-2020-03-21-16-44-07-259/source/sourcedir.tar.gz\r\nalgo-1-636se_1  | SM_TRAINING_ENV={\"additional_framework_parameters\":{},\"channel_input_dirs\":{\"training\":\"/opt/ml/input/data/training\"},\"current_host\":\"algo-1-636se\",\"framework_module\":\"sagemaker_pytorch_container.training:main\",\"hosts\":[\"algo-1-636se\"],\"hyperparameters\":{\"epochs\":2},\"input_config_dir\":\"/opt/ml/input/config\",\"input_data_config\":{\"training\":{\"TrainingInputMode\":\"File\"}},\"input_dir\":\"/opt/ml/input\",\"is_master\":true,\"job_name\":\"fastai2-oxford-pets-sagemaker-example-t-2020-03-21-16-44-07-259\",\"log_level\":20,\"master_hostname\":\"algo-1-636se\",\"model_dir\":\"/opt/ml/model\",\"module_dir\":\"s3://sagemaker-eu-west-1-934676248949/fastai2-oxford-pets-sagemaker-example-t-2020-03-21-16-44-07-259/source/sourcedir.tar.gz\",\"module_name\":\"oxford-pets\",\"network_interface_name\":\"eth0\",\"num_cpus\":8,\"num_gpus\":1,\"output_data_dir\":\"/opt/ml/output/data\",\"output_dir\":\"/opt/ml/output\",\"output_intermediate_dir\":\"/opt/ml/output/intermediate\",\"resource_config\":{\"current_host\":\"algo-1-636se\",\"hosts\":[\"algo-1-636se\"]},\"user_entry_point\":\"oxford-pets.py\"}\r\nalgo-1-636se_1  | SM_USER_ARGS=[\"--epochs\",\"2\"]\r\nalgo-1-636se_1  | SM_OUTPUT_INTERMEDIATE_DIR=/opt/ml/output/intermediate\r\nalgo-1-636se_1  | SM_CHANNEL_TRAINING=/opt/ml/input/data/training\r\nalgo-1-636se_1  | SM_HP_EPOCHS=2\r\nalgo-1-636se_1  | PYTHONPATH=/opt/ml/code:/opt/conda/bin:/opt/conda/lib/python36.zip:/opt/conda/lib/python3.6:/opt/conda/lib/python3.6/lib-dynload:/opt/conda/lib/python3.6/site-packages\r\nalgo-1-636se_1  | \r\nalgo-1-636se_1  | Invoking script with the following command:\r\nalgo-1-636se_1  | \r\nalgo-1-636se_1  | /opt/conda/bin/python oxford-pets.py --epochs 2\r\nalgo-1-636se_1  | \r\nalgo-1-636se_1  | \r\nepoch     train_loss  valid_loss  error_rate  time    \r\nalgo-1-636se_1  | Downloading: \"https://download.pytorch.org/models/resnet50-19c8e357.pth\" to /root/.cache/torch/checkpoints/resnet50-19c8e357.pth\r\n0         0.902371    0.234592    0.077131    00:31     \r\n100%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588| 97.8M/97.8M [00:03<00:00, 27.5MB/s]\r\n1         0.323855    0.182979    0.064953    00:39     \r\nalgo-1-636se_1  | INFO:__main__:Finished training\r\nalgo-1-636se_1  | INFO:__main__:Saving the model.\r\nalgo-1-636se_1  | INFO:__main__:Model saved\r\nalgo-1-636se_1  | 2020-03-21 16:45:34,886 sagemaker-containers INFO     Reporting training SUCCESS\r\ntmpsp4f4h0t_algo-1-636se_1 exited with code 0\r\nAborting on container exit...\r\n===== Job Complete =====\r\n```\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 1.51.3\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: PyTorch\r\n- **Framework version**: 1.4.0\r\n- **Python version**: 3.6\r\n- **CPU or GPU**: GPU\r\n- **Custom Docker image (Y/N)**: Y\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1372/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1372/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1371", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1371/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1371/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1371/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1371", "id": 585529948, "node_id": "MDU6SXNzdWU1ODU1Mjk5NDg=", "number": 1371, "title": "PyTorch training container v1.4.0 not recognizing requirements.txt file", "user": {"login": "mattmcclean", "id": 788855, "node_id": "MDQ6VXNlcjc4ODg1NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/788855?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mattmcclean", "html_url": "https://github.com/mattmcclean", "followers_url": "https://api.github.com/users/mattmcclean/followers", "following_url": "https://api.github.com/users/mattmcclean/following{/other_user}", "gists_url": "https://api.github.com/users/mattmcclean/gists{/gist_id}", "starred_url": "https://api.github.com/users/mattmcclean/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mattmcclean/subscriptions", "organizations_url": "https://api.github.com/users/mattmcclean/orgs", "repos_url": "https://api.github.com/users/mattmcclean/repos", "events_url": "https://api.github.com/users/mattmcclean/events{/privacy}", "received_events_url": "https://api.github.com/users/mattmcclean/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 850818746, "node_id": "MDU6TGFiZWw4NTA4MTg3NDY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/status:%20pending%20release", "name": "status: pending release", "color": "eee8d5", "default": false, "description": "issues for which fixes have been merged but not released to PyPI"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-03-21T16:17:34Z", "updated_at": "2020-04-06T17:55:06Z", "closed_at": "2020-04-06T17:55:06Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**Describe the bug**\r\nI tried to launch a local and remote training job using the PyTorch container v1.4.0 and provided the `source_dir` with a `requirements.txt` file to install extra packages. When running the training job it does not recognise the file and thus does not install the required packages. I tried it with the framework version `1.3.1` and it installs it fine.\r\n\r\n**To reproduce**\r\n\r\nCode to create the problem:\r\n\r\n```\r\nfrom sagemaker import get_execution_role\r\nrole = get_execution_role()\r\nfrom sagemaker.pytorch import PyTorch \r\nhyperparameters = {'epochs': 2}\r\nestimator = PyTorch(source_dir='container/oxford-pets',\r\n                    entry_point='oxford-pets.py',\r\n                    role=role,\r\n                    train_instance_count=1,\r\n                    train_instance_type='local_gpu',\r\n                    framework_version='1.4.0',\r\n                    py_version='py3',\r\n                    hyperparameters=hyperparameters)\r\n```\r\n\r\nI tried both local and remote training on SageMaker with a `ml.p3.2xlarge` instance and had the same issue.\r\n\r\n**Expected behavior**\r\nI expected the training job to install the packages described in the `requirements.txt` file.\r\n\r\n**Screenshots or logs**\r\nIf applicable, add screenshots or logs to help explain your problem.\r\n\r\nLog output from training job:\r\n\r\n```\r\n-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n|   timestamp   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                message                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\r\n|---------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\r\n| 1584806924672 | bash: cannot set terminal process group (-1): Inappropriate ioctl for device                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |\r\n| 1584806924672 | bash: no job control in this shell                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |\r\n| 1584806924672 | 2020-03-21 16:08:42,231 sagemaker-containers INFO     Imported framework sagemaker_pytorch_container.training                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |\r\n| 1584806924672 | 2020-03-21 16:08:42,254 sagemaker_pytorch_container.training INFO     Block until all host DNS lookups succeed.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |\r\n| 1584806924672 | 2020-03-21 16:08:42,256 sagemaker_pytorch_container.training INFO     Invoking user training script.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\r\n| 1584806924672 | 2020-03-21 16:08:42,756 sagemaker-containers INFO     Module default_user_module_name does not provide a setup.py.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |\r\n| 1584806924672 | Generating setup.py                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |\r\n| 1584806924672 | 2020-03-21 16:08:42,756 sagemaker-containers INFO     Generating setup.cfg                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |\r\n| 1584806924673 | 2020-03-21 16:08:42,757 sagemaker-containers INFO     Generating MANIFEST.in                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |\r\n| 1584806924673 | 2020-03-21 16:08:42,757 sagemaker-containers INFO     Installing module with the following command:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |\r\n| 1584806924673 | /opt/conda/bin/python -m pip install .                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\r\n| 1584806924673 | Processing /tmp/tmpt2wmv0lh/module_dir                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\r\n| 1584806924673 | Building wheels for collected packages: default-user-module-name   Building wheel for default-user-module-name (setup.py): started   Building wheel for default-user-module-name (setup.py): finished with status 'done'   Created wheel for default-user-module-name: filename=default_user_module_name-1.0.0-py2.py3-none-any.whl size=4367 sha256=abce39aca5032c7ccc38c600aaef52bf6fd51d8e4ffd52638fcc278d6b0fba11   Stored in directory: /tmp/pip-ephem-wheel-cache-0snmgkoe/wheels/0c/23/bf/49d9b9675d4918970abec256eaa8ffc91ab60b231c72288ea8                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |\r\n| 1584806924673 | Successfully built default-user-module-name                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |\r\n| 1584806925673 | Installing collected packages: default-user-module-name                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |\r\n| 1584806925673 | Successfully installed default-user-module-name-1.0.0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |\r\n| 1584806925673 | 2020-03-21 16:08:45,292 sagemaker-containers INFO     Invoking user script                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |\r\n| 1584806925674 | Training Env:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |\r\n| 1584806925674 | {     \"additional_framework_parameters\": {},     \"channel_input_dirs\": {         \"training\": \"/opt/ml/input/data/training\"     },     \"current_host\": \"algo-1\",     \"framework_module\": \"sagemaker_pytorch_container.training:main\",     \"hosts\": [         \"algo-1\"     ],     \"hyperparameters\": {         \"epochs\": 2     },     \"input_config_dir\": \"/opt/ml/input/config\",     \"input_data_config\": {         \"training\": {             \"TrainingInputMode\": \"File\",             \"S3DistributionType\": \"FullyReplicated\",             \"RecordWrapperType\": \"None\"         }     },     \"input_dir\": \"/opt/ml/input\",     \"is_master\": true,     \"job_name\": \"pytorch-training-2020-03-21-16-03-13-971\",     \"log_level\": 20,     \"master_hostname\": \"algo-1\",     \"model_dir\": \"/opt/ml/model\",     \"module_dir\": \"s3://sagemaker-eu-west-1-934676248949/pytorch-training-2020-03-21-16-03-13-971/source/sourcedir.tar.gz\",     \"module_name\": \"oxford-pets\",     \"network_interface_name\": \"eth0\",     \"num_cpus\": 8,     \"num_gpus\": 1,     \"output_data_dir\": \"/opt/ml/output/data\",     \"output_dir\": \"/opt/ml/output\",     \"output_intermediate_dir\": \"/opt/ml/output/intermediate\",     \"resource_config\": {         \"current_host\": \"algo-1\",         \"hosts\": [             \"algo-1\"         ],         \"network_interface_name\": \"eth0\"     },     \"user_entry_point\": \"oxford-pets.py\" |\r\n| 1584806925674 | }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |\r\n| 1584806925674 | Environment variables:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\r\n| 1584806925674 | SM_HOSTS=[\"algo-1\"]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |\r\n| 1584806925674 | SM_NETWORK_INTERFACE_NAME=eth0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |\r\n| 1584806925674 | SM_HPS={\"epochs\":2}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |\r\n| 1584806925674 | SM_USER_ENTRY_POINT=oxford-pets.py                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |\r\n| 1584806925674 | SM_FRAMEWORK_PARAMS={}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\r\n| 1584806925675 | SM_RESOURCE_CONFIG={\"current_host\":\"algo-1\",\"hosts\":[\"algo-1\"],\"network_interface_name\":\"eth0\"}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |\r\n| 1584806925675 | SM_INPUT_DATA_CONFIG={\"training\":{\"RecordWrapperType\":\"None\",\"S3DistributionType\":\"FullyReplicated\",\"TrainingInputMode\":\"File\"}}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |\r\n| 1584806925675 | SM_OUTPUT_DATA_DIR=/opt/ml/output/data                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\r\n| 1584806925675 | SM_CHANNELS=[\"training\"]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |\r\n| 1584806925675 | SM_CURRENT_HOST=algo-1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\r\n| 1584806925675 | SM_MODULE_NAME=oxford-pets                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |\r\n| 1584806925675 | SM_LOG_LEVEL=20                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |\r\n| 1584806925675 | SM_FRAMEWORK_MODULE=sagemaker_pytorch_container.training:main                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |\r\n| 1584806925675 | SM_INPUT_DIR=/opt/ml/input                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |\r\n| 1584806925675 | SM_INPUT_CONFIG_DIR=/opt/ml/input/config                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |\r\n| 1584806925675 | SM_OUTPUT_DIR=/opt/ml/output                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |\r\n| 1584806925675 | SM_NUM_CPUS=8                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |\r\n| 1584806925675 | SM_NUM_GPUS=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |\r\n| 1584806925675 | SM_MODEL_DIR=/opt/ml/model                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |\r\n| 1584806925675 | SM_MODULE_DIR=s3://sagemaker-eu-west-1-934676248949/pytorch-training-2020-03-21-16-03-13-971/source/sourcedir.tar.gz                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\r\n| 1584806925675 | SM_TRAINING_ENV={\"additional_framework_parameters\":{},\"channel_input_dirs\":{\"training\":\"/opt/ml/input/data/training\"},\"current_host\":\"algo-1\",\"framework_module\":\"sagemaker_pytorch_container.training:main\",\"hosts\":[\"algo-1\"],\"hyperparameters\":{\"epochs\":2},\"input_config_dir\":\"/opt/ml/input/config\",\"input_data_config\":{\"training\":{\"RecordWrapperType\":\"None\",\"S3DistributionType\":\"FullyReplicated\",\"TrainingInputMode\":\"File\"}},\"input_dir\":\"/opt/ml/input\",\"is_master\":true,\"job_name\":\"pytorch-training-2020-03-21-16-03-13-971\",\"log_level\":20,\"master_hostname\":\"algo-1\",\"model_dir\":\"/opt/ml/model\",\"module_dir\":\"s3://sagemaker-eu-west-1-934676248949/pytorch-training-2020-03-21-16-03-13-971/source/sourcedir.tar.gz\",\"module_name\":\"oxford-pets\",\"network_interface_name\":\"eth0\",\"num_cpus\":8,\"num_gpus\":1,\"output_data_dir\":\"/opt/ml/output/data\",\"output_dir\":\"/opt/ml/output\",\"output_intermediate_dir\":\"/opt/ml/output/intermediate\",\"resource_config\":{\"current_host\":\"algo-1\",\"hosts\":[\"algo-1\"],\"network_interface_name\":\"eth0\"},\"user_entry_point\":\"oxford-pets.py\"}                                                                                                                                                                                                                                                                                                       |\r\n| 1584806925675 | SM_USER_ARGS=[\"--epochs\",\"2\"]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |\r\n| 1584806925675 | SM_OUTPUT_INTERMEDIATE_DIR=/opt/ml/output/intermediate                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\r\n| 1584806925675 | SM_CHANNEL_TRAINING=/opt/ml/input/data/training                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |\r\n| 1584806925675 | SM_HP_EPOCHS=2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |\r\n| 1584806925675 | PYTHONPATH=/opt/ml/code:/opt/conda/bin:/opt/conda/lib/python36.zip:/opt/conda/lib/python3.6:/opt/conda/lib/python3.6/lib-dynload:/opt/conda/lib/python3.6/site-packages                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |\r\n| 1584806925675 | Invoking script with the following command:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |\r\n| 1584806925675 | /opt/conda/bin/python oxford-pets.py --epochs 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |\r\n| 1584806925675 | Traceback (most recent call last):   File \"oxford-pets.py\", line 23, in <module>     from fastai2.vision.all import *                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |\r\n| 1584806925675 | ModuleNotFoundError: No module named 'fastai2'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |\r\n| 1584806925675 | 2020-03-21 16:08:45,350 sagemaker-containers ERROR    ExecuteUserScriptError:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |\r\n| 1584806925675 | Command \"/opt/conda/bin/python oxford-pets.py --epochs 2\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |\r\n| 1584806925676 | Traceback (most recent call last):   File \"oxford-pets.py\", line 23, in <module>     from fastai2.vision.all import *                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |\r\n| 1584806925676 | ModuleNotFoundError: No module named 'fastai2'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |\r\n-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n```\r\n\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 1.51.3\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: PyTorch\r\n- **Framework version**: 1.4.0\r\n- **Python version**: 3.6\r\n- **CPU or GPU**: GPU\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1371/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1371/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1341", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1341/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1341/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1341/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1341", "id": 578239541, "node_id": "MDU6SXNzdWU1NzgyMzk1NDE=", "number": 1341, "title": "`KeyError: 'ProcessingOutputConfig'` when calling Calling `ProcessingJob.from_processing_name()` for a ProcessingJob defined without a ProcessingOutput (ie. Spark Processor)", "user": {"login": "cfregly", "id": 1438064, "node_id": "MDQ6VXNlcjE0MzgwNjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1438064?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cfregly", "html_url": "https://github.com/cfregly", "followers_url": "https://api.github.com/users/cfregly/followers", "following_url": "https://api.github.com/users/cfregly/following{/other_user}", "gists_url": "https://api.github.com/users/cfregly/gists{/gist_id}", "starred_url": "https://api.github.com/users/cfregly/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cfregly/subscriptions", "organizations_url": "https://api.github.com/users/cfregly/orgs", "repos_url": "https://api.github.com/users/cfregly/repos", "events_url": "https://api.github.com/users/cfregly/events{/privacy}", "received_events_url": "https://api.github.com/users/cfregly/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-03-09T23:05:11Z", "updated_at": "2020-03-11T17:56:16Z", "closed_at": "2020-03-11T17:56:16Z", "author_association": "NONE", "active_lock_reason": null, "body": "After running this `ScriptProcessor`:\r\n```\r\nprocessor.run(code='preprocess-spark.py',\r\n              arguments=['s3_input_data', balanced_train_data_input,\r\n                         's3_output_data', balanced_train_data_tfidf_output,\r\n              ],    \r\n              logs=True,\r\n              wait=False\r\n)\r\n```\r\n\r\nand running this code:\r\n\r\n```\r\npreprocessing_job_description = processor.jobs[-1].describe()\r\nprocessing_job_name = preprocessing_job_description['ProcessingJobName']\r\n\r\nrunning_processor = sagemaker.processing.ProcessingJob.from_processing_name(processing_job_name=processing_job_name,\r\n```\r\n\r\nI'm seeing this error\r\n\r\n```\r\n---------------------------------------------------------------------------\r\nKeyError                                  Traceback (most recent call last)\r\n<ipython-input-55-5b16753426ad> in <module>()\r\n      1 running_processor = sagemaker.processing.ProcessingJob.from_processing_name(processing_job_name=processing_job_name,\r\n----> 2                                                                             sagemaker_session=sagemaker_session)\r\n      3 running_processor.describe()\r\n\r\n~/anaconda3/envs/python3/lib/python3.6/site-packages/sagemaker/processing.py in from_processing_name(cls, sagemaker_session, processing_job_name)\r\n    668             outputs=[\r\n    669                 ProcessingOutput(\r\n--> 670                     source=job_desc[\"ProcessingOutputConfig\"][\"Outputs\"][0][\"S3Output\"][\r\n    671                         \"LocalPath\"\r\n    672                     ],\r\n\r\nKeyError: 'ProcessingOutputConfig'\r\n```\r\n\r\nNote:  I'm not using `ProcessingOutput` because I am using a Spark Processor and writing directly to S3.  (See https://github.com/awslabs/amazon-sagemaker-examples/issues/994 for more info on why I'm doing this.)", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1341/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1341/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1317", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1317/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1317/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1317/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1317", "id": 573430274, "node_id": "MDU6SXNzdWU1NzM0MzAyNzQ=", "number": 1317, "title": "[bug] mxnet estimator requirements.txt stopped working", "user": {"login": "yifeim", "id": 8949994, "node_id": "MDQ6VXNlcjg5NDk5OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/8949994?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yifeim", "html_url": "https://github.com/yifeim", "followers_url": "https://api.github.com/users/yifeim/followers", "following_url": "https://api.github.com/users/yifeim/following{/other_user}", "gists_url": "https://api.github.com/users/yifeim/gists{/gist_id}", "starred_url": "https://api.github.com/users/yifeim/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yifeim/subscriptions", "organizations_url": "https://api.github.com/users/yifeim/orgs", "repos_url": "https://api.github.com/users/yifeim/repos", "events_url": "https://api.github.com/users/yifeim/events{/privacy}", "received_events_url": "https://api.github.com/users/yifeim/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 850818746, "node_id": "MDU6TGFiZWw4NTA4MTg3NDY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/status:%20pending%20release", "name": "status: pending release", "color": "eee8d5", "default": false, "description": "issues for which fixes have been merged but not released to PyPI"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2020-02-29T23:27:53Z", "updated_at": "2020-04-06T17:29:06Z", "closed_at": "2020-04-06T17:29:06Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**Describe the bug**\r\nAccording to the documents,\r\nhttps://github.com/aws/sagemaker-python-sdk/blob/master/doc/using_mxnet.rst#use-third-party-libraries\r\nrequirements.txt could be loaded in mxnet estimators. This was the behavior when `framework_version='1.4.1'`, but will trigger errors in `framework_version='1.6.0'`.\r\n\r\n**Screenshots or logs**\r\nError because the package is not installed, despite being specified in requirements.txt. No errors are observed with framework_version='1.4.1'.\r\n```\r\nmxnet 1.6.0\r\nTraceback (most recent call last):\r\n  File \"sagemaker_wrapper.py\", line 18, in <module>\r\n    from sm_train import train, save\r\n  File \"/opt/ml/code/sm_train.py\", line 33, in <module>\r\n    from data_io import walk_s3_or_local, read_s3_or_local, ReadAllAndStream\r\n  File \"/opt/ml/code/data_io.py\", line 19, in <module>\r\n    from dependencies import lru_cache, AttrDict, boto3\r\n  File \"/opt/ml/code/dependencies.py\", line 31, in <module>\r\n    from attrdict import AttrDict\r\nModuleNotFoundError: No module named 'attrdict'\r\n```\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: latest as of 2/29/2020\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: mxnet\r\n- **Framework version**: 1.6.0\r\n- **Python version**: py3\r\n- **CPU or GPU**: local_gpu and ml.p3.xlarge\r\n- **Custom Docker image (Y/N)**: N\r\n\r\n**Additional context**\r\nI will be using framework_version='1.4.1' for the time being. A related issue is that framework_version='1.3.1' could not be loaded. Mxnet-1.3 was announced on 11/2018. I think there should be sufficiently many people wanting to use this version to reproduce old experiments. Why did we stop supporting already?\r\n\r\nhttps://aws.amazon.com/about-aws/whats-new/2018/11/amazon-sagemaker-now-supports-apache-mxnet-1-3-and-tensorflow-1-/", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1317/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1317/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1301", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1301/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1301/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1301/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1301", "id": 568099103, "node_id": "MDU6SXNzdWU1NjgwOTkxMDM=", "number": 1301, "title": "Attempt to enable data capture on an endpoint created by cloudformation will fail", "user": {"login": "brightsparc", "id": 360368, "node_id": "MDQ6VXNlcjM2MDM2OA==", "avatar_url": "https://avatars.githubusercontent.com/u/360368?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brightsparc", "html_url": "https://github.com/brightsparc", "followers_url": "https://api.github.com/users/brightsparc/followers", "following_url": "https://api.github.com/users/brightsparc/following{/other_user}", "gists_url": "https://api.github.com/users/brightsparc/gists{/gist_id}", "starred_url": "https://api.github.com/users/brightsparc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brightsparc/subscriptions", "organizations_url": "https://api.github.com/users/brightsparc/orgs", "repos_url": "https://api.github.com/users/brightsparc/repos", "events_url": "https://api.github.com/users/brightsparc/events{/privacy}", "received_events_url": "https://api.github.com/users/brightsparc/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 850818746, "node_id": "MDU6TGFiZWw4NTA4MTg3NDY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/status:%20pending%20release", "name": "status: pending release", "color": "eee8d5", "default": false, "description": "issues for which fixes have been merged but not released to PyPI"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-02-20T07:16:24Z", "updated_at": "2020-03-23T17:50:36Z", "closed_at": "2020-03-23T17:50:36Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nAttempt to enable data capture on an endpoint created by cloudformation will fail due as it contains \"aws:cloudformation:*\" tags.  These tags can not be deleted.\r\n\r\n**To reproduce**\r\nAttempt to enable data capture on an endpoint created with \"aws:\" tags:\r\n\r\nsee: [ageMaker-Enable-Model-Monitor](https://github.com/awslabs/amazon-sagemaker-examples/blob/master/sagemaker_model_monitor/enable_model_monitor/SageMaker-Enable-Model-Monitor.ipynb) notebook\r\n\r\n```\r\npredictor = RealTimePredictor(endpoint=endpoint_name)\r\npredictor.update_data_capture_config(data_capture_config=data_capture_config)\r\n```\r\n\r\nReturns error:\r\n\r\n```\r\n~/anaconda3/envs/python3/lib/python3.6/site-packages/botocore/client.py in _make_api_call(self, operation_name, api_params)\r\n    584             error_code = parsed_response.get(\"Error\", {}).get(\"Code\")\r\n    585             error_class = self.exceptions.from_code(error_code)\r\n--> 586             raise error_class(parsed_response, operation_name)\r\n    587         else:\r\n    588             return parsed_response\r\n\r\nClientError: An error occurred (ValidationException) when calling the DeleteTags operation: System prefix 'aws:' reserved for AWS usage in tag key: aws:cloudformation:stack-name\r\n```\r\n\r\n**Expected behavior**\r\nThe \"aws:*\" tags should either be ignore or removed when collecting existing tags.  \r\n\r\nThe following is a work around that overrides the tags instead of loading existing\r\n\r\n```\r\n# Get the current endpoint config \r\nendpoint_config_name = sm.describe_endpoint(EndpointName=endpoint_name)['EndpointConfigName']\r\nnew_config_name = name_from_base(base=endpoint_config_name)\r\n\r\n# Create a new config from the existing adding data capture\r\nnew_tags = [{'Key': 'datacapture', 'Value': 'true'}] \r\nsm_session.create_endpoint_config_from_existing(\r\n    endpoint_config_name, new_config_name, new_tags=new_tags, \r\n    new_data_capture_config_dict=data_capture_config._to_request_dict())\r\n\r\n# Update the endpoint\r\nsm_session.update_endpoint(endpoint_name=endpoint_name, endpoint_config_name=new_config_name)\r\n```\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 1.50.9.post0\r\n- **Python version**:  3.6.5  \r\n- **CPU**:\r\n- **Custom Docker image**:N\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1301/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1301/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1276", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1276/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1276/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1276/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1276", "id": 559313668, "node_id": "MDU6SXNzdWU1NTkzMTM2Njg=", "number": 1276, "title": "Broken link to sagemaker.automl Doc", "user": {"login": "nealrp", "id": 10123104, "node_id": "MDQ6VXNlcjEwMTIzMTA0", "avatar_url": "https://avatars.githubusercontent.com/u/10123104?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nealrp", "html_url": "https://github.com/nealrp", "followers_url": "https://api.github.com/users/nealrp/followers", "following_url": "https://api.github.com/users/nealrp/following{/other_user}", "gists_url": "https://api.github.com/users/nealrp/gists{/gist_id}", "starred_url": "https://api.github.com/users/nealrp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nealrp/subscriptions", "organizations_url": "https://api.github.com/users/nealrp/orgs", "repos_url": "https://api.github.com/users/nealrp/repos", "events_url": "https://api.github.com/users/nealrp/events{/privacy}", "received_events_url": "https://api.github.com/users/nealrp/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-02-03T20:25:06Z", "updated_at": "2020-02-07T18:43:37Z", "closed_at": "2020-02-03T23:22:31Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nA clear and concise description of what the bug is.\r\nBroken link in page https://github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/automl/README.rst\r\n\r\n\"For more information about AutoML parameters, please refer to: https://sagemaker.readthedocs.io/en/stable/sagemaker.automl.html\"\r\n\r\n**To reproduce**\r\nA clear, step-by-step set of instructions to reproduce the bug.\r\n\r\nGo to \"For more information about AutoML parameters, please refer to: https://sagemaker.readthedocs.io/en/stable/sagemaker.automl.html\"\r\n\r\n**Expected behavior**\r\nA clear and concise description of what you expected to happen.\r\nWorking link\r\n\r\n**Screenshots or logs**\r\nIf applicable, add screenshots or logs to help explain your problem.\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**:\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**:\r\n- **Framework version**:\r\n- **Python version**:\r\n- **CPU or GPU**:\r\n- **Custom Docker image (Y/N)**:\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1276/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1276/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1253", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1253/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1253/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1253/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1253", "id": 552614595, "node_id": "MDU6SXNzdWU1NTI2MTQ1OTU=", "number": 1253, "title": "Sagemaker samples give an error for S3 Buckets requiring SSE encryption mode", "user": {"login": "jerrygb", "id": 1516634, "node_id": "MDQ6VXNlcjE1MTY2MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1516634?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jerrygb", "html_url": "https://github.com/jerrygb", "followers_url": "https://api.github.com/users/jerrygb/followers", "following_url": "https://api.github.com/users/jerrygb/following{/other_user}", "gists_url": "https://api.github.com/users/jerrygb/gists{/gist_id}", "starred_url": "https://api.github.com/users/jerrygb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jerrygb/subscriptions", "organizations_url": "https://api.github.com/users/jerrygb/orgs", "repos_url": "https://api.github.com/users/jerrygb/repos", "events_url": "https://api.github.com/users/jerrygb/events{/privacy}", "received_events_url": "https://api.github.com/users/jerrygb/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-01-21T04:16:16Z", "updated_at": "2020-01-25T05:49:36Z", "closed_at": "2020-01-25T05:49:06Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nTrying to run through Sagemaker samples and hit the road block when using S3 Buckets which require objected to be encrypted using SSE.\r\n\r\n**To reproduce**\r\nRun the Parameter Server based distributed training in the notebook [here](https://github.com/aws-samples/amazon-sagemaker-script-mode/blob/master/tf-distribution-options/tf-distributed-training.ipynb)\r\n\r\n**_Updated class declaration:_**\r\n\r\n```\r\nestimator_ps = TensorFlow(\r\n                       git_config=git_config,\r\n                       source_dir='tf-distribution-options/code',\r\n                       entry_point='train_ps.py', \r\n                       base_job_name='ps-cifar10-tf',\r\n                       role=role,\r\n                       framework_version='1.13',\r\n                       py_version='py3',\r\n                       hyperparameters=hyperparameters,\r\n                       train_instance_count=ps_instance_count, \r\n                       train_instance_type=ps_instance_type,\r\n                       model_dir=model_dir,\r\n                       tags = [{'Key' : 'Project', 'Value' : 'cifar10'},{'Key' : 'TensorBoard', 'Value' : 'dist'}],\r\n                       distributions=distributions,\r\n                       output_kms_key='arn:aws:kms:us-east-1:yyyyyyy:key/key_id')\r\n```\r\n\r\n**Note:** The `output_kms_key` is defined since the policy requires that all objects are encrypted at-rest.\r\n\r\n**Expected behavior**\r\nRuns the tensorflow training given train, test and validation datasets and logs the model checkpoints on the S3 using the KMS key provided.\r\n\r\n**Screenshots or logs**\r\n\r\nLooks like part of the requested training is completed. However, when logging the modal checkpoints it gives an error. I do have access to the S3 bucket from the notebook environment. However, all the objects require to be SSE encrypted in my environment.\r\n\r\n```\r\ns/step - loss: 0.9891 - acc: 0.6518 - val_loss: 0.8898 - val_acc: 0.6931\r\nINFO:root:Test loss:0.9299138677425873\r\nINFO:root:Test accuracy:0.6730769276618958\r\n2020-01-21 00:36:52,250 sagemaker_tensorflow_container.training INFO     master algo-1 is down, stopping parameter server\r\n2020-01-21 00:36:52,250 sagemaker_tensorflow_container.training WARNING  Your model will NOT be servable with SageMaker TensorFlow Serving container.The model artifact was not saved in the TensorFlow SavedModel directory structure:\r\nhttps://www.tensorflow.org/guide/saved_model#structure_of_a_savedmodel_directory\r\n2020-01-21 00:36:52,251 sagemaker-containers INFO     Reporting training SUCCESS\r\nTraceback (most recent call last):\r\n  File \"train_ps.py\", line 141, in <module>\r\n    main(args)\r\n  File \"train_ps.py\", line 88, in main\r\n    validation_steps=(num_examples_per_epoch('validation') // args.batch_size) // size, callbacks=callbacks)\r\n  File \"/usr/local/lib/python3.6/site-packages/tensorflow/python/keras/engine/training.py\", line 880, in fit\r\n    validation_steps=validation_steps)\r\n  File \"/usr/local/lib/python3.6/site-packages/tensorflow/python/keras/engine/training_arrays.py\", line 215, in model_iteration\r\n    mode=mode)\r\n  File \"/usr/local/lib/python3.6/site-packages/tensorflow/python/keras/callbacks.py\", line 106, in configure_callbacks\r\n    callback_list.set_model(callback_model)\r\n  File \"/usr/local/lib/python3.6/site-packages/tensorflow/python/keras/callbacks.py\", line 178, in set_model\r\n    callback.set_model(model)\r\n  File \"/usr/local/lib/python3.6/site-packages/tensorflow/python/keras/callbacks.py\", line 1010, in set_model\r\n    self._init_writer()\r\n  File \"/usr/local/lib/python3.6/site-packages/tensorflow/python/keras/callbacks.py\", line 947, in _init_writer\r\n    self.writer = tf_summary.FileWriter(self.log_dir, K.get_session().graph)\r\n  File \"/usr/local/lib/python3.6/site-packages/tensorflow/python/summary/writer/writer.py\", line 367, in __init__\r\n    filename_suffix)\r\n  File \"/usr/local/lib/python3.6/site-packages/tensorflow/python/summary/writer/event_file_writer.py\", line 67, in __init__\r\n    gfile.MakeDirs(self._logdir)\r\n  File \"/usr/local/lib/python3.6/site-packages/tensorflow/python/lib/io/file_io.py\", line 442, in recursive_create_dir\r\n    recursive_create_dir_v2(dirname)\r\n  File \"/usr/local/lib/python3.6/site-packages/tensorflow/python/lib/io/file_io.py\", line 458, in recursive_create_dir_v2\r\n    pywrap_tensorflow.RecursivelyCreateDir(compat.as_bytes(path), status)\r\n  File \"/usr/local/lib/python3.6/site-packages/tensorflow/python/framework/errors_impl.py\", line 528, in __exit__\r\n    c_api.TF_GetCode(self.status.status))\r\ntensorflow.python.framework.errors_impl.AbortedError: All 10 retry attempts failed. The last failure: Unknown: AccessDenied: 1 failed parts. Access Denied\r\n2020-01-21 00:37:28,821 sagemaker-containers ERROR    ExecuteUserScriptError:\r\nCommand \"/usr/local/bin/python3.6 train_ps.py --batch-size 128 --epochs 10 --model_dir /opt/ml/model\"\r\n\r\n2020-01-21 00:37:36 Uploading - Uploading generated training model\r\n2020-01-21 00:37:36 Failed - Training job failed\r\n---------------------------------------------------------------------------\r\nUnexpectedStatusException                 Traceback (most recent call last)\r\n<ipython-input-10-2e1ef825f72c> in <module>()\r\n      1 remote_inputs = {'train' : inputs+'/train', 'validation' : inputs+'/validation', 'eval' : inputs+'/eval'}\r\n----> 2 estimator_ps.fit(remote_inputs, wait=True)\r\n\r\n~/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/sagemaker/tensorflow/estimator.py in fit(self, inputs, wait, logs, job_name, experiment_config, run_tensorboard_locally)\r\n    454                 tensorboard.join()\r\n    455         else:\r\n--> 456             fit_super()\r\n    457 \r\n    458     @classmethod\r\n\r\n~/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/sagemaker/tensorflow/estimator.py in fit_super()\r\n    433 \r\n    434         def fit_super():\r\n--> 435             super(TensorFlow, self).fit(inputs, wait, logs, job_name, experiment_config)\r\n    436 \r\n    437         if run_tensorboard_locally and wait is False:\r\n\r\n~/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/sagemaker/estimator.py in fit(self, inputs, wait, logs, job_name, experiment_config)\r\n    462         self.jobs.append(self.latest_training_job)\r\n    463         if wait:\r\n--> 464             self.latest_training_job.wait(logs=logs)\r\n    465 \r\n    466     def _compilation_job_name(self):\r\n\r\n~/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/sagemaker/estimator.py in wait(self, logs)\r\n   1059         # If logs are requested, call logs_for_jobs.\r\n   1060         if logs != \"None\":\r\n-> 1061             self.sagemaker_session.logs_for_job(self.job_name, wait=True, log_type=logs)\r\n   1062         else:\r\n   1063             self.sagemaker_session.wait_for_job(self.job_name)\r\n\r\n~/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/sagemaker/session.py in logs_for_job(self, job_name, wait, poll, log_type)\r\n   2972 \r\n   2973         if wait:\r\n-> 2974             self._check_job_status(job_name, description, \"TrainingJobStatus\")\r\n   2975             if dot:\r\n   2976                 print()\r\n\r\n~/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/sagemaker/session.py in _check_job_status(self, job, desc, status_key_name)\r\n   2566                 ),\r\n   2567                 allowed_statuses=[\"Completed\", \"Stopped\"],\r\n-> 2568                 actual_status=status,\r\n   2569             )\r\n   2570 \r\n\r\nUnexpectedStatusException: Error for Training job ps-cifar10-tf-2020-01-21-00-32-13-303: Failed. Reason: AlgorithmError: ExecuteUserScriptError:\r\nCommand \"/usr/local/bin/python3.6 train_ps.py --batch-size 128 --epochs 10 --model_dir /opt/ml/model\"\r\n```\r\n\r\n**System information**\r\nA description of your system. Please provide:\r\n- **SageMaker Python SDK version**: 1.45.0.dev0\r\n- **Framework name (eg. PyTorch) or algorithm (eg. KMeans)**: Tensorflow\r\n- **Framework version**: 1.13\r\n- **Python version**: 3.6.9\r\n- **CPU or GPU**: GPU \r\n- **Custom Docker image (Y/N)**: N\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1253/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1253/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1207", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1207/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1207/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1207/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1207", "id": 545760036, "node_id": "MDU6SXNzdWU1NDU3NjAwMzY=", "number": 1207, "title": "None always returned from `AutoML.deploy()`", "user": {"login": "barnybug", "id": 146373, "node_id": "MDQ6VXNlcjE0NjM3Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/146373?v=4", "gravatar_id": "", "url": "https://api.github.com/users/barnybug", "html_url": "https://github.com/barnybug", "followers_url": "https://api.github.com/users/barnybug/followers", "following_url": "https://api.github.com/users/barnybug/following{/other_user}", "gists_url": "https://api.github.com/users/barnybug/gists{/gist_id}", "starred_url": "https://api.github.com/users/barnybug/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/barnybug/subscriptions", "organizations_url": "https://api.github.com/users/barnybug/orgs", "repos_url": "https://api.github.com/users/barnybug/repos", "events_url": "https://api.github.com/users/barnybug/events{/privacy}", "received_events_url": "https://api.github.com/users/barnybug/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 850818746, "node_id": "MDU6TGFiZWw4NTA4MTg3NDY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/status:%20pending%20release", "name": "status: pending release", "color": "eee8d5", "default": false, "description": "issues for which fixes have been merged but not released to PyPI"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-01-06T14:38:55Z", "updated_at": "2020-01-14T19:36:14Z", "closed_at": "2020-01-14T19:36:14Z", "author_association": "NONE", "active_lock_reason": null, "body": "### System Information\r\n- **Framework**: AutoML\r\n- **Python Version**: 3.7\r\n\r\n### Describe the problem\r\n`sagemaker.automl.automl.AutoML.deploy()` currently can't return a predictor. This is because you can't provide the predictor_cls parameter to the `PipelineModel()` constructed inside `_deploy_inference_pipeline`.\r\n\r\nThe docs for `sagemaker.automl.automl.AutoML.deploy()` say:\r\n```\r\nReturns:\r\n            callable[string, sagemaker.session.Session]: Invocation of\r\n            ``self.predictor_cls`` on the created endpoint name.\r\n```\r\n\r\n### Minimal repro / logs\r\n\r\nRoughly:\r\n```\r\nfrom sagemaker.automl import automl\r\nml = automl.AutoML(...)\r\nml.fit(...)\r\ncandidate = ml.best_candidate(...)\r\npredictor = ml.deploy(\r\n    initial_instance_count=1,\r\n    instance_type='ml.t2.medium',\r\n    candidate=candidate,\r\n)\r\npredictor # always None\r\n```", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1207/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1207/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1201", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1201/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1201/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1201/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1201", "id": 542962302, "node_id": "MDU6SXNzdWU1NDI5NjIzMDI=", "number": 1201, "title": "AttributeError: 'Model' object has no attribute '__framework_name__'", "user": {"login": "cfregly", "id": 1438064, "node_id": "MDQ6VXNlcjE0MzgwNjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1438064?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cfregly", "html_url": "https://github.com/cfregly", "followers_url": "https://api.github.com/users/cfregly/followers", "following_url": "https://api.github.com/users/cfregly/following{/other_user}", "gists_url": "https://api.github.com/users/cfregly/gists{/gist_id}", "starred_url": "https://api.github.com/users/cfregly/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cfregly/subscriptions", "organizations_url": "https://api.github.com/users/cfregly/orgs", "repos_url": "https://api.github.com/users/cfregly/repos", "events_url": "https://api.github.com/users/cfregly/events{/privacy}", "received_events_url": "https://api.github.com/users/cfregly/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 15, "created_at": "2019-12-27T19:03:23Z", "updated_at": "2020-01-20T21:29:21Z", "closed_at": "2020-01-18T01:06:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "Please fill out the form below.\r\n\r\n### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**:  TensorFlow\r\n- **Framework Version**:  2.0.0\r\n- **Python Version**:  Python3\r\n- **CPU or GPU**:  CPU\r\n- **Python SDK Version**:  1.49.0\r\n- **StepFunctions SDK**:  1.0.0.3\r\n- **Are you using a custom image**:  No\r\n\r\n### Describe the problem\r\nDescribe the problem or feature request clearly here.\r\n\r\nHere is the error:\r\n```\r\n---------------------------------------------------------------------------\r\nAttributeError                            Traceback (most recent call last)\r\n<ipython-input-42-23cc1e7f4991> in <module>()\r\n      3     role=workflow_execution_role,\r\n      4     inputs=training_data_uri,\r\n----> 5     s3_bucket=model_output_path\r\n      6 )\r\n\r\n~/anaconda3/envs/python3/lib/python3.6/site-packages/stepfunctions/template/pipeline/train.py in __init__(self, estimator, role, inputs, s3_bucket, client, **kwargs)\r\n     64             self.pipeline_name = 'training-pipeline-{date}'.format(date=self._generate_timestamp())\r\n     65 \r\n---> 66         self.definition = self.build_workflow_definition()\r\n     67         self.input_template = self._extract_input_template(self.definition)\r\n     68 \r\n\r\n~/anaconda3/envs/python3/lib/python3.6/site-packages/stepfunctions/template/pipeline/train.py in build_workflow_definition(self)\r\n     95             instance_type=train_instance_type,\r\n     96             model=model,\r\n---> 97             model_name=default_name\r\n     98         )\r\n     99 \r\n\r\n~/anaconda3/envs/python3/lib/python3.6/site-packages/stepfunctions/steps/sagemaker.py in __init__(self, state_id, model, model_name, instance_type, **kwargs)\r\n    171         \"\"\"\r\n    172         if isinstance(model, FrameworkModel):\r\n--> 173             parameters = model_config(model=model, instance_type=instance_type, role=model.role, image=model.image)\r\n    174             if model_name:\r\n    175                 parameters['ModelName'] = model_name\r\n\r\n~/anaconda3/envs/python3/lib/python3.6/site-packages/sagemaker/workflow/airflow.py in model_config(instance_type, model, role, image)\r\n    577 \r\n    578     if isinstance(model, sagemaker.model.FrameworkModel):\r\n--> 579         container_def = prepare_framework_container_def(model, instance_type, s3_operations)\r\n    580     else:\r\n    581         container_def = model.prepare_container_def(instance_type)\r\n\r\n~/anaconda3/envs/python3/lib/python3.6/site-packages/sagemaker/workflow/airflow.py in prepare_framework_container_def(model, instance_type, s3_operations)\r\n    519         deploy_image = fw_utils.create_image_uri(\r\n    520             region_name,\r\n--> 521             model.__framework_name__,\r\n    522             instance_type,\r\n    523             model.framework_version,\r\n\r\nAttributeError: 'Model' object has no attribute '__framework_name__'\r\n```\r\n\r\nWe are doing this through the stepfunctions SDK with [TrainingPipeline](https://github.com/aws/aws-step-functions-data-science-sdk-python/blob/21d6aa19b6aa73bb6a25490e1cdf0257ac44f815/src/stepfunctions/template/pipeline/train.py)\r\n\r\nPyTorch is OK. \r\n\r\n[pytorch/model.py](https://github.com/aws/sagemaker-python-sdk/blob/042c3a0475e2e40984b23dc5a70834568d3fb1ae/src/sagemaker/pytorch/model.py#L147) \r\n\r\n[tensorflow/model.py](https://github.com/aws/sagemaker-python-sdk/blob/042c3a0475e2e40984b23dc5a70834568d3fb1ae/src/sagemaker/tensorflow/model.py#L137)\r\n\r\n### Minimal repro / logs\r\nPlease provide any logs and a bare minimum reproducible test case, as this will be helpful to diagnose the problem. If including tracebacks, please include the full traceback. Large logs and files should be attached.\r\n\r\n- **Exact command to reproduce**:\r\n\r\n```\r\n...\r\npipeline = TrainingPipeline(\r\n    estimator=tensorflow_mnist_estimator,\r\n    role=workflow_execution_role,\r\n    inputs=training_data_uri,\r\n    s3_bucket=model_output_path\r\n)\r\n...\r\n```\r\n\r\nHere is the link to the successful PyTorch version:  https://github.com/awslabs/amazon-sagemaker-examples/blob/346811d27ba9e1cd6a3db94a90f584b951f7aa33/step-functions-data-science-sdk/training_pipeline_pytorch_mnist/training_pipeline_pytorch_mnist.ipynb\r\n\r\nThere is no equivalent example using TensorFlow.\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1201/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1201/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1184", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1184/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1184/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1184/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1184", "id": 539745383, "node_id": "MDU6SXNzdWU1Mzk3NDUzODM=", "number": 1184, "title": "SageMaker Session not created by default upon Model Class Instantiation", "user": {"login": "matthewfollegot", "id": 35209054, "node_id": "MDQ6VXNlcjM1MjA5MDU0", "avatar_url": "https://avatars.githubusercontent.com/u/35209054?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthewfollegot", "html_url": "https://github.com/matthewfollegot", "followers_url": "https://api.github.com/users/matthewfollegot/followers", "following_url": "https://api.github.com/users/matthewfollegot/following{/other_user}", "gists_url": "https://api.github.com/users/matthewfollegot/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthewfollegot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthewfollegot/subscriptions", "organizations_url": "https://api.github.com/users/matthewfollegot/orgs", "repos_url": "https://api.github.com/users/matthewfollegot/repos", "events_url": "https://api.github.com/users/matthewfollegot/events{/privacy}", "received_events_url": "https://api.github.com/users/matthewfollegot/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 850818746, "node_id": "MDU6TGFiZWw4NTA4MTg3NDY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/status:%20pending%20release", "name": "status: pending release", "color": "eee8d5", "default": false, "description": "issues for which fixes have been merged but not released to PyPI"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-12-18T15:17:18Z", "updated_at": "2020-02-14T00:40:40Z", "closed_at": "2020-02-14T00:40:40Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**: Sagemaker / sagemaker.model.Model\r\n- **Framework Version**: stable\r\n- **Python Version**: 3.6\r\n- **CPU or GPU**: CPU\r\n- **Python SDK Version**: \r\n- **Are you using a custom image**: Yes\r\n\r\n### Describe the problem\r\nWhen creating a model, `sagemaker.model.Model`, if a sagemaker_session is not specified, an `AttributeError: 'NoneType' object has no attribute 'create_model'` is raised when invoking one of the model's functions. In the [docs](https://sagemaker.readthedocs.io/en/stable/model.html#sagemaker.model.Model), also pasted below, it specifies that if the parameter is not specified, one is created. This did not work and I can confirm because when I passed in a valid `sagemaker_session`, the code worked fine.\r\n```\r\nsagemaker_session (sagemaker.session.Session) \u2013 A SageMaker Session object, used for SageMaker interactions (default: None). If not specified, one is created using the default AWS configuration chain.\r\n```\r\n\r\n#### Note: created a PR for this issue [here](https://github.com/aws/sagemaker-python-sdk/pull/1185)\r\n\r\n### Minimal repro / logs\r\n```\r\nAttributeError                            Traceback (most recent call last)\r\n<ipython-input-4-b38a2118e690> in <module>()\r\n      3     target_data_s3_location='s3://pd-ds-workbench-sagemaker-stg/projects/responder_recommendations/data/output',\r\n      4     instance_type='ml.m4.xlarge',\r\n----> 5     instance_count=1\r\n      6 )\r\n~/SageMaker/ds-python-utils/dsutils/ml/model.py in get_predictions_s3(self, input_data_s3_location, target_data_s3_location, instance_type, instance_count, wait)\r\n    136             instance_type=instance_type,\r\n    137             output_path=target_data_s3_location,\r\n--> 138             tags=self.aws_tags()\r\n    139         )\r\n    140 \r\n~/anaconda3/envs/python3/lib/python3.6/site-packages/sagemaker/model.py in transformer(self, instance_count, instance_type, strategy, assemble_with, output_path, output_kms_key, accept, env, max_concurrent_transforms, max_payload, tags, volume_kms_key)\r\n    520                 attached to the ML compute instance (default: None).\r\n    521         \"\"\"\r\n--> 522         self._create_sagemaker_model(instance_type, tags=tags)\r\n    523         if self.enable_network_isolation():\r\n    524             env = None\r\n~/anaconda3/envs/python3/lib/python3.6/site-packages/sagemaker/model.py in _create_sagemaker_model(self, instance_type, accelerator_type, tags)\r\n    186         self.name = self.name or utils.name_from_image(container_def[\"Image\"])\r\n    187         enable_network_isolation = self.enable_network_isolation()\r\n--> 188         self.sagemaker_session.create_model(\r\n    189             self.name,\r\n    190             self.role,\r\nAttributeError: 'NoneType' object has no attribute 'create_model'\r\n```\r\n\r\n- **Exact command to reproduce**: Call one of the `sagemaker.model.Model` class methods without specifying a `sagemaker_session` when instantiating the object (I called `sagemaker.model.Model.transformer()`).\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1184/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1184/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1174", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1174/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1174/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1174/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1174", "id": 538412496, "node_id": "MDU6SXNzdWU1Mzg0MTI0OTY=", "number": 1174, "title": "Bug in v1.47.0 after allowing default bucket to be specified by the user", "user": {"login": "elvinx", "id": 8008982, "node_id": "MDQ6VXNlcjgwMDg5ODI=", "avatar_url": "https://avatars.githubusercontent.com/u/8008982?v=4", "gravatar_id": "", "url": "https://api.github.com/users/elvinx", "html_url": "https://github.com/elvinx", "followers_url": "https://api.github.com/users/elvinx/followers", "following_url": "https://api.github.com/users/elvinx/following{/other_user}", "gists_url": "https://api.github.com/users/elvinx/gists{/gist_id}", "starred_url": "https://api.github.com/users/elvinx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/elvinx/subscriptions", "organizations_url": "https://api.github.com/users/elvinx/orgs", "repos_url": "https://api.github.com/users/elvinx/repos", "events_url": "https://api.github.com/users/elvinx/events{/privacy}", "received_events_url": "https://api.github.com/users/elvinx/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": {"login": "ajaykarpur", "id": 5490371, "node_id": "MDQ6VXNlcjU0OTAzNzE=", "avatar_url": "https://avatars.githubusercontent.com/u/5490371?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ajaykarpur", "html_url": "https://github.com/ajaykarpur", "followers_url": "https://api.github.com/users/ajaykarpur/followers", "following_url": "https://api.github.com/users/ajaykarpur/following{/other_user}", "gists_url": "https://api.github.com/users/ajaykarpur/gists{/gist_id}", "starred_url": "https://api.github.com/users/ajaykarpur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ajaykarpur/subscriptions", "organizations_url": "https://api.github.com/users/ajaykarpur/orgs", "repos_url": "https://api.github.com/users/ajaykarpur/repos", "events_url": "https://api.github.com/users/ajaykarpur/events{/privacy}", "received_events_url": "https://api.github.com/users/ajaykarpur/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "ajaykarpur", "id": 5490371, "node_id": "MDQ6VXNlcjU0OTAzNzE=", "avatar_url": "https://avatars.githubusercontent.com/u/5490371?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ajaykarpur", "html_url": "https://github.com/ajaykarpur", "followers_url": "https://api.github.com/users/ajaykarpur/followers", "following_url": "https://api.github.com/users/ajaykarpur/following{/other_user}", "gists_url": "https://api.github.com/users/ajaykarpur/gists{/gist_id}", "starred_url": "https://api.github.com/users/ajaykarpur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ajaykarpur/subscriptions", "organizations_url": "https://api.github.com/users/ajaykarpur/orgs", "repos_url": "https://api.github.com/users/ajaykarpur/repos", "events_url": "https://api.github.com/users/ajaykarpur/events{/privacy}", "received_events_url": "https://api.github.com/users/ajaykarpur/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2019-12-16T13:28:44Z", "updated_at": "2019-12-17T23:52:21Z", "closed_at": "2019-12-17T23:51:12Z", "author_association": "NONE", "active_lock_reason": null, "body": "@andremoeller thank you for the quick fix!\r\nI am afraid this feature (https://github.com/aws/sagemaker-python-sdk/pull/1168) introduced a bug :/ And now by default the SDK tries to create the bucket all the time\r\n - I upgraded to SageMaker 1.47 \r\n - Run below lines of code\r\n```python\r\nimport sagemaker\r\nrole = sagemaker.get_execution_role()\r\n```\r\n - I get the below error \r\n`ClientError: An error occurred (AccessDenied) when calling the CreateBucket operation: Access Denied`\r\n\r\n<img width=\"865\" alt=\"Screen Shot 2019-12-16 at 2 22 24 PM\" src=\"https://user-images.githubusercontent.com/8008982/70910195-7fdcda80-200f-11ea-83a5-b0045858a377.png\">\r\n\r\n\r\nhttps://github.com/aws/sagemaker-python-sdk/issues/1165", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1174/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1174/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1166", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1166/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1166/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1166/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/pull/1166", "id": 537205737, "node_id": "MDExOlB1bGxSZXF1ZXN0MzUyNjA0NDU1", "number": 1166, "title": "fix: specify S3 uri as code location in ScriptProcessor.run", "user": {"login": "ajaykarpur", "id": 5490371, "node_id": "MDQ6VXNlcjU0OTAzNzE=", "avatar_url": "https://avatars.githubusercontent.com/u/5490371?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ajaykarpur", "html_url": "https://github.com/ajaykarpur", "followers_url": "https://api.github.com/users/ajaykarpur/followers", "following_url": "https://api.github.com/users/ajaykarpur/following{/other_user}", "gists_url": "https://api.github.com/users/ajaykarpur/gists{/gist_id}", "starred_url": "https://api.github.com/users/ajaykarpur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ajaykarpur/subscriptions", "organizations_url": "https://api.github.com/users/ajaykarpur/orgs", "repos_url": "https://api.github.com/users/ajaykarpur/repos", "events_url": "https://api.github.com/users/ajaykarpur/events{/privacy}", "received_events_url": "https://api.github.com/users/ajaykarpur/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2019-12-12T20:49:37Z", "updated_at": "2019-12-12T23:23:16Z", "closed_at": "2019-12-12T21:49:00Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/pulls/1166", "html_url": "https://github.com/aws/sagemaker-python-sdk/pull/1166", "diff_url": "https://github.com/aws/sagemaker-python-sdk/pull/1166.diff", "patch_url": "https://github.com/aws/sagemaker-python-sdk/pull/1166.patch", "merged_at": null}, "body": "*Issue #, if available:*\r\nhttps://github.com/aws/sagemaker-python-sdk/issues/1163\r\n\r\n*Description of changes:*\r\nFixed a bug in ScriptProcessor that attempted to upload the user's code to S3 even when it was already an S3 uri.\r\n\r\n*Testing done:*\r\n\r\n## Merge Checklist\r\n\r\n_Put an `x` in the boxes that apply. You can also fill these out after creating the PR. If you're unsure about any of them, don't hesitate to ask. We're here to help! This is simply a reminder of what we are going to look for before merging your pull request._\r\n\r\n- [x] I have read the [CONTRIBUTING](https://github.com/aws/sagemaker-python-sdk/blob/master/CONTRIBUTING.md) doc\r\n- [x] I used the commit message format described in [CONTRIBUTING](https://github.com/aws/sagemaker-python-sdk/blob/master/CONTRIBUTING.md#committing-your-change)\r\n- [ ] I have used the regional endpoint when creating S3 and/or STS clients (if appropriate)\r\n- [ ] I have added tests that prove my fix is effective or that my feature works (if appropriate)\r\n- [ ] I have checked that my tests are not configured for a specific region or account (if appropriate)\r\n- [ ] I have updated any necessary documentation, including [READMEs](https://github.com/aws/sagemaker-python-sdk/blob/master/README.rst) and [API docs](https://github.com/aws/sagemaker-python-sdk/tree/master/doc) (if appropriate)\r\n\r\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1166/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1166/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1163", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1163/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1163/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1163/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1163", "id": 536896697, "node_id": "MDU6SXNzdWU1MzY4OTY2OTc=", "number": 1163, "title": "Processing job: Cannot specify s3 uri as code location", "user": {"login": "elvinx", "id": 8008982, "node_id": "MDQ6VXNlcjgwMDg5ODI=", "avatar_url": "https://avatars.githubusercontent.com/u/8008982?v=4", "gravatar_id": "", "url": "https://api.github.com/users/elvinx", "html_url": "https://github.com/elvinx", "followers_url": "https://api.github.com/users/elvinx/followers", "following_url": "https://api.github.com/users/elvinx/following{/other_user}", "gists_url": "https://api.github.com/users/elvinx/gists{/gist_id}", "starred_url": "https://api.github.com/users/elvinx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/elvinx/subscriptions", "organizations_url": "https://api.github.com/users/elvinx/orgs", "repos_url": "https://api.github.com/users/elvinx/repos", "events_url": "https://api.github.com/users/elvinx/events{/privacy}", "received_events_url": "https://api.github.com/users/elvinx/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": {"login": "andremoeller", "id": 5501191, "node_id": "MDQ6VXNlcjU1MDExOTE=", "avatar_url": "https://avatars.githubusercontent.com/u/5501191?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andremoeller", "html_url": "https://github.com/andremoeller", "followers_url": "https://api.github.com/users/andremoeller/followers", "following_url": "https://api.github.com/users/andremoeller/following{/other_user}", "gists_url": "https://api.github.com/users/andremoeller/gists{/gist_id}", "starred_url": "https://api.github.com/users/andremoeller/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andremoeller/subscriptions", "organizations_url": "https://api.github.com/users/andremoeller/orgs", "repos_url": "https://api.github.com/users/andremoeller/repos", "events_url": "https://api.github.com/users/andremoeller/events{/privacy}", "received_events_url": "https://api.github.com/users/andremoeller/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "andremoeller", "id": 5501191, "node_id": "MDQ6VXNlcjU1MDExOTE=", "avatar_url": "https://avatars.githubusercontent.com/u/5501191?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andremoeller", "html_url": "https://github.com/andremoeller", "followers_url": "https://api.github.com/users/andremoeller/followers", "following_url": "https://api.github.com/users/andremoeller/following{/other_user}", "gists_url": "https://api.github.com/users/andremoeller/gists{/gist_id}", "starred_url": "https://api.github.com/users/andremoeller/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andremoeller/subscriptions", "organizations_url": "https://api.github.com/users/andremoeller/orgs", "repos_url": "https://api.github.com/users/andremoeller/repos", "events_url": "https://api.github.com/users/andremoeller/events{/privacy}", "received_events_url": "https://api.github.com/users/andremoeller/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2019-12-12T10:42:32Z", "updated_at": "2019-12-13T21:39:34Z", "closed_at": "2019-12-13T21:39:34Z", "author_association": "NONE", "active_lock_reason": null, "body": "According to the docs, one can specify either S3 URI or a local path as code location while running processing jobs with SageMaker:\r\n<img width=\"692\" alt=\"Screen Shot 2019-12-12 at 11 29 32 AM\" src=\"https://user-images.githubusercontent.com/8008982/70704632-b1356d80-1cd2-11ea-844e-21f75db5b454.png\">\r\n\r\nThis seems not to be the case. \r\nWhen you specify the s3 path, SageMaker Python SDK still tries to create a default S3 bucket and upload the code to it.\r\n\r\nI dug into the code base and can see that there is no check if the given path is an S3 path or not and default behavior is always to expect a local path.\r\nhttps://github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/processing.py#L373\r\n\r\n\r\n<img width=\"795\" alt=\"Screen Shot 2019-12-12 at 11 35 28 AM\" src=\"https://user-images.githubusercontent.com/8008982/70705029-85ff4e00-1cd3-11ea-98d7-21e0babb995b.png\">\r\n\r\n\r\n<img width=\"733\" alt=\"Screen Shot 2019-12-12 at 11 38 09 AM\" src=\"https://user-images.githubusercontent.com/8008982/70705213-e8584e80-1cd3-11ea-9584-acf21d30515a.png\">\r\n\r\n\r\nExpected behavior:\r\nAllow S3 paths as a code location as stated in the docs.\r\n\r\n ", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1163/reactions", "total_count": 5, "+1": 5, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1163/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1133", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1133/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1133/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1133/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1133", "id": 527741447, "node_id": "MDU6SXNzdWU1Mjc3NDE0NDc=", "number": 1133, "title": " Export directory already exists in Tensorflow 1.14 Sagemaker", "user": {"login": "javemar", "id": 10106461, "node_id": "MDQ6VXNlcjEwMTA2NDYx", "avatar_url": "https://avatars.githubusercontent.com/u/10106461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/javemar", "html_url": "https://github.com/javemar", "followers_url": "https://api.github.com/users/javemar/followers", "following_url": "https://api.github.com/users/javemar/following{/other_user}", "gists_url": "https://api.github.com/users/javemar/gists{/gist_id}", "starred_url": "https://api.github.com/users/javemar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/javemar/subscriptions", "organizations_url": "https://api.github.com/users/javemar/orgs", "repos_url": "https://api.github.com/users/javemar/repos", "events_url": "https://api.github.com/users/javemar/events{/privacy}", "received_events_url": "https://api.github.com/users/javemar/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-11-24T19:05:36Z", "updated_at": "2020-05-21T00:12:03Z", "closed_at": "2020-05-21T00:12:03Z", "author_association": "NONE", "active_lock_reason": null, "body": "\r\n\r\n### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**: tensorflow sagemaker\r\n- **Framework Version**: 1.14\r\n- **Python Version**:  3.6\r\n- **CPU or GPU**: cpu\r\n- **Python SDK Version**: lastest \r\n- **Are you using a custom image**: No\r\n\r\n### Describe the problem\r\n\r\nWhen I run in the script mode with the framework version 1.14 of tensorflow, i  got the following error\r\n\r\nAssertionError: Export directory already exists, and isn't empty. Please choose a different export directory, or delete all the contents of the specified directory: /opt/ml/model\r\n\r\nIt's weird,  because if I use the  framework version 1.13 it worked.\r\n\r\n(There is something more that i really dont understand well, but when I use the the argument ouput_path then sagemaker will use this information to change the model_dir variable and it  gave another error. I  don't know if this is related)\r\n\r\n### Minimal repro / logs\r\n\r\nTraceback (most recent call last):\r\n  File \"train.py\", line 88, in <module>\r\n    tf.contrib.saved_model.save_keras_model(model, model_dir)\r\n  File \"/usr/local/lib/python3.6/site-packages/tensorflow/python/keras/saving/saved_model.py\", line 119, in export_saved_model\r\n    input_signature)\r\n  File \"/usr/local/lib/python3.6/site-packages/tensorflow/python/keras/saving/saved_model.py\", line 166, in _save_v1_format\r\n    builder = saved_model_builder._SavedModelBuilder(path)\r\n  File \"/usr/local/lib/python3.6/site-packages/tensorflow/python/saved_model/builder_impl.py\", line 102, in __init__\r\n    \"specified directory: %s\" % export_dir)\r\n\r\nAssertionError: Export directory already exists, and isn't empty. Please choose a different export directory, or delete all the contents of the specified directory: /opt/ml/model\r\n\r\n- **Exact command to reproduce**:\r\nI use two files:\r\n\r\n##----------------------------------------##-------------------------------------------------\r\n#train.py:\r\n```\r\n\r\nimport tensorflow as tf\r\nimport os\r\nimport argparse\r\nfrom tensorflow.contrib.eager.python import tfe\r\n\r\ntf.enable_eager_execution()\r\n\r\ndef pack(features, label):\r\n    return tf.stack(list(features.values()), axis=-1), label\r\n\r\ndef get_data(train_dir,name, batch_size):\r\n    data =  tf.data.experimental.make_csv_dataset(\r\n                os.path.join(train_dir, name), label_name=\"0\", \r\n                  num_epochs=1,batch_size=batch_size)\r\n    data = data.map(pack)\r\n    return data\r\n\r\ndef create_model():\r\n    model = tf.keras.models.Sequential(\r\n          [tf.keras.layers.Dense( 5, activation='relu'   ),\r\n          tf.keras.layers.Dense( 4 , activation='relu'  ),\r\n           tf.keras.layers.Dense( 1  ,activation='sigmoid' ) ]   \r\n       )\r\n    return model\r\n    \r\n    \r\n    \r\n    \r\n\r\nparser = argparse.ArgumentParser()\r\n\r\n#  hyperparameters sent by the client are passed as command-line arguments to the script\r\nparser.add_argument('--epochs', type=int, default=1)\r\nparser.add_argument('--batch_size', type=int, default=64)\r\n#parser.add_argument('--learning_rate', type=float, default=0.1)\r\n\r\n# data directories\r\nparser.add_argument('--train', type=str, default=os.environ.get('SM_CHANNEL_TRAIN'))\r\nparser.add_argument('--test', type=str, default=os.environ.get('SM_CHANNEL_TEST'))\r\n\r\n\r\n\r\n# model directory: we will use the default set by SageMaker, /opt/ml/model\r\nparser.add_argument('--model_dir', type=str, default = os.environ.get('SM_MODEL_DIR'))\r\n#parser.add_argument('--output-data-dir', type=str, default=os.environ['SM_OUTPUT_DATA_DIR'])\r\n\r\nargs = parser.parse_args()\r\n\r\nif __name__ == '__main__':\r\n    \r\n    \r\n    \r\n    train_dir = args.train\r\n    test_dir = args.test\r\n    batch_size =  args.batch_size\r\n    epochs = args.epochs\r\n    #model_dir = args.model_dir\r\n    model_dir = \"/opt/ml/model\"\r\n    output_data = os.environ['SM_OUTPUT_DATA_DIR']\r\n    \r\n    \r\n    \r\n    model = create_model() \r\n    model.compile(loss='binary_crossentropy', optimizer='adam', metrics=[\"accuracy\"])\r\n    \r\n    train_data = get_data(train_dir, \"train.csv\",  batch_size)\r\n    test_data = get_data(test_dir,\"test.csv\", batch_size)\r\n    \r\n    model.fit(train_data, epochs=epochs, steps_per_epoch=50)\r\n    \r\n    #saver = tfe.Saver(model.variables)\r\n    #saver.save(os.path.join(model_dir , 'weights.ckpt'))\r\n    print (\"file is:\" + model_dir)\r\n    #print (model_dir)\r\n    \r\n    #model.save(os.path.join(model_dir, \"model.h5\"))\r\n    saver = tfe.Saver(model.variables)\r\n    saver.save(model_dir + '/weights.ckpt')\r\n    \r\n    #print(r\"sdfsdff\\n\")\r\n    #scores = model.evaluate(test_data)\r\n    #print (f\"the accuracy score was: {scores}\")\r\n    tf.contrib.saved_model.save_keras_model(model, model_dir)\r\n\r\n\r\n```\r\n##----------------------------------------##-------------------------------------------------\r\n#I and have a jupyter notebook with following code:\r\n```\r\nimport tensorflow as tf\r\nimport sagemaker\r\nimport os\r\nimport pandas as pd\r\nimport numpy as np\r\nfrom sklearn.model_selection import train_test_split\r\nfrom sklearn.datasets import make_moons\r\nx , y = make_moons(n_samples=300,  noise=0)\r\ndatos = pd.DataFrame( np.hstack([ y.reshape(-1,1), x   ])   )\r\ntrain, test = train_test_split(datos)\r\ntrain.head()\r\ntrain.to_csv(\"train.csv\", index=False)\r\ntest.to_csv(\"test.csv\", index=False)\r\nrole =  sagemaker.get_execution_role()\r\nsagemaker_session = sagemaker.Session()\r\n\r\nkey_prefix = \"data/moons\"\r\ntrain_data = sagemaker_session.upload_data(\"train.csv\", key_prefix=key_prefix)\r\ntest_data = sagemaker_session.upload_data(\"test.csv\", key_prefix=key_prefix)\r\nfrom sagemaker.tensorflow import TensorFlow\r\n\r\nestimator = TensorFlow(sagemaker_session= sagemaker_session, \r\n                       role=role,entry_point='train.py',\r\n                       train_instance_type=\"ml.c4.xlarge\",\r\n                       hyperparameters={\"epochs\":20,\"batch_size\":32},\r\n                       train_instance_count=1,\r\n                       output_path = output_path,\r\n                       #model_dir = '/opt/ml/model',\r\n                      framework_version=\"1.14\", # **if I changed to 1.13, it worked**\r\n\r\n                       py_version='py3',\r\n                       script_mode=True\r\n                      )\r\n\r\nestimator.fit({\"train\":train_data, \"test\":test_data})\r\n\r\n```", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1133/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1133/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1120", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1120/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1120/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1120/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1120", "id": 521621997, "node_id": "MDU6SXNzdWU1MjE2MjE5OTc=", "number": 1120, "title": "Deploy method doesn't work if \"tags\" attribute is supplied", "user": {"login": "svpino", "id": 1126730, "node_id": "MDQ6VXNlcjExMjY3MzA=", "avatar_url": "https://avatars.githubusercontent.com/u/1126730?v=4", "gravatar_id": "", "url": "https://api.github.com/users/svpino", "html_url": "https://github.com/svpino", "followers_url": "https://api.github.com/users/svpino/followers", "following_url": "https://api.github.com/users/svpino/following{/other_user}", "gists_url": "https://api.github.com/users/svpino/gists{/gist_id}", "starred_url": "https://api.github.com/users/svpino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/svpino/subscriptions", "organizations_url": "https://api.github.com/users/svpino/orgs", "repos_url": "https://api.github.com/users/svpino/repos", "events_url": "https://api.github.com/users/svpino/events{/privacy}", "received_events_url": "https://api.github.com/users/svpino/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-11-12T15:30:17Z", "updated_at": "2019-12-10T02:58:16Z", "closed_at": "2019-12-10T02:58:12Z", "author_association": "NONE", "active_lock_reason": null, "body": "Please fill out the form below.\r\n\r\n### System Information\r\n- sagemaker lib version 1.43.4.post1\r\n- Using object detection sample notebook.\r\n\r\n### Describe the problem\r\nWhen supplying the `tags` attribute to the deploy function of a model, an error is displayed.\r\n\r\nHere is the relevant code:\r\n```\r\nobject_detector = od_model.deploy(\r\n    initial_instance_count = 1, \r\n    instance_type = 'ml.m4.xlarge'\r\n    tags = [{\r\n        \"TagName\": \"TagValue\"\r\n    }])\r\n```\r\n\r\nError message:\r\n```\r\n---------------------------------------------------------------------------\r\nTypeError                                 Traceback (most recent call last)\r\n<ipython-input-63-da1a1683e6f2> in <module>()\r\n      3     instance_type = 'ml.m4.xlarge',\r\n      4     tags = [{\r\n----> 5         \"TagName\": \"TagValue\"\r\n      6     }])\r\n      7 \r\n\r\n~/anaconda3/envs/mxnet_p36/lib/python3.6/site-packages/sagemaker/estimator.py in deploy(self, initial_instance_count, instance_type, accelerator_type, endpoint_name, use_compiled_model, update_endpoint, wait, model_name, kms_key, **kwargs)\r\n    549         else:\r\n    550             kwargs[\"model_kms_key\"] = self.output_kms_key\r\n--> 551             model = self.create_model(**kwargs)\r\n    552         model.name = model_name\r\n    553         return model.deploy(\r\n\r\n~/anaconda3/envs/mxnet_p36/lib/python3.6/site-packages/sagemaker/estimator.py in create_model(self, role, image, predictor_cls, serializer, deserializer, content_type, accept, vpc_config_override, **kwargs)\r\n   1176             predictor_cls=predictor_cls,\r\n   1177             enable_network_isolation=self.enable_network_isolation(),\r\n-> 1178             **kwargs\r\n   1179         )\r\n   1180 \r\n\r\nTypeError: __init__() got an unexpected keyword argument 'tags'\r\n```\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1120/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1120/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1082", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1082/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1082/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1082/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1082", "id": 505090338, "node_id": "MDU6SXNzdWU1MDUwOTAzMzg=", "number": 1082, "title": "Error creating XGBoostModel endpoint from s3 ", "user": {"login": "sivakhno", "id": 1651457, "node_id": "MDQ6VXNlcjE2NTE0NTc=", "avatar_url": "https://avatars.githubusercontent.com/u/1651457?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sivakhno", "html_url": "https://github.com/sivakhno", "followers_url": "https://api.github.com/users/sivakhno/followers", "following_url": "https://api.github.com/users/sivakhno/following{/other_user}", "gists_url": "https://api.github.com/users/sivakhno/gists{/gist_id}", "starred_url": "https://api.github.com/users/sivakhno/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sivakhno/subscriptions", "organizations_url": "https://api.github.com/users/sivakhno/orgs", "repos_url": "https://api.github.com/users/sivakhno/repos", "events_url": "https://api.github.com/users/sivakhno/events{/privacy}", "received_events_url": "https://api.github.com/users/sivakhno/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2019-10-10T07:32:04Z", "updated_at": "2019-10-15T22:07:38Z", "closed_at": "2019-10-15T22:02:28Z", "author_association": "NONE", "active_lock_reason": null, "body": "Reference: MLFW-2706\r\n\r\nPlease fill out the form below.\r\n\r\n### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**: XGBoost\r\n- **Framework Version**: 0.90-1\r\n- **Python Version**: 3\r\n- **CPU or GPU**: CPU\r\n- **Python SDK Version**:\r\n- **Are you using a custom image**: Nope, the following is used 141502667606.dkr.ecr.eu-west-1.amazonaws.com/sagemaker-xgboost:0.90-1-cpu-py\r\n\r\n### Describe the problem\r\nwe have a problem creating XGBoost endpoint from s3 - funnily it does work if we do it just after training. \r\n\r\n### Minimal repro / logs\r\n\r\nThe details are \r\n\r\n1. Training part works well!\r\n```\r\nestimator = XGBoost(entry_point = 'myscript_gpu.py', train_instance_type=\"ml.m5.24xlarge\",\r\n                    sagemaker_session=sagemaker_session,\r\n                    source_dir='./source/',\r\n                    train_instance_count=1, hyperparameters={'nthread':32, 'sagemaker_enable_cloudwatch_metrics':True, 'no_multithread':False, 'num_features':10},\r\n                    role=role, base_job_name='skills-nomultithread', \r\n                    framework_version = '0.90-1', \r\n                    py_version='3')\r\n```\r\n`estimator.fit ({'train':train_input,  validation':eval_input})`\r\n\r\n\r\n2. deploying from resulting estimator also works \r\n`predictor = estimator.deploy(initial_instance_count=1, instance_type=\"ml.m4.xlarge\") `\r\n\r\n\r\n3. we however need to create a new model class from previously saved to s3 bucket model and then deploy, which leads to ERROR\r\n```\r\nmodel_data = estimator.model_uri\r\nclass JSONPredictor(RealTimePredictor):\r\n    def __init__(self, endpoint_name, sagemaker_session):\r\n        super(JSONPredictor, self).__init__(endpoint_name,\r\n                                            sagemaker_session, json_serializer, json_deserializer)\r\nnew_estimator = XGBoostModel(model_data = model_data, entry_point = 'myscript_gpu.py', \r\n                    sagemaker_session=sagemaker_session,\r\n                    source_dir='./source',\r\n                    role=role,\r\n                    predictor_cls=JSONPredictor,\r\n                    framework_version = '0.90-1', \r\n                    py_version='py3',\r\n                    env={\r\n                      'SAGEMAKER_BASE_PATH': '/opt/ml',\r\n                      'BASE_PATH_ENV': 'SAGEMAKER_BASE_PATH',\r\n                      'SAGEMAKER_SUBMIT_DIRECTORY': '/opt/ml/code',\r\n                      'SM_MODEL_DIR': '/opt/ml/model'})\r\n```\r\n`predictor_new = new_estimator.deploy(initial_instance_count=1, instance_type=\"ml.m4.xlarge\")`\r\n\r\nERROR: sagemaker_containers._errors.ClientError: [Errno 2] No such file or directory: '/root/sagemaker_local/jobs/1570010091.8216782/opt/ml/model/model.joblib'\r\n\r\nI am surprised that the model_dir has sagemaker_local in it since I am training on the cloud - could this be a bug\r\nI also attach ERROR LOGS\r\nThanks for looking into this!\r\n\r\n[error_log.txt](https://github.com/aws/sagemaker-python-sdk/files/3711059/error_log.txt)\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1082/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1082/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1075", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1075/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1075/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1075/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1075", "id": 502779063, "node_id": "MDU6SXNzdWU1MDI3NzkwNjM=", "number": 1075, "title": "Batch transfer failing for LDA model", "user": {"login": "salmanmashayekh", "id": 48693449, "node_id": "MDQ6VXNlcjQ4NjkzNDQ5", "avatar_url": "https://avatars.githubusercontent.com/u/48693449?v=4", "gravatar_id": "", "url": "https://api.github.com/users/salmanmashayekh", "html_url": "https://github.com/salmanmashayekh", "followers_url": "https://api.github.com/users/salmanmashayekh/followers", "following_url": "https://api.github.com/users/salmanmashayekh/following{/other_user}", "gists_url": "https://api.github.com/users/salmanmashayekh/gists{/gist_id}", "starred_url": "https://api.github.com/users/salmanmashayekh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/salmanmashayekh/subscriptions", "organizations_url": "https://api.github.com/users/salmanmashayekh/orgs", "repos_url": "https://api.github.com/users/salmanmashayekh/repos", "events_url": "https://api.github.com/users/salmanmashayekh/events{/privacy}", "received_events_url": "https://api.github.com/users/salmanmashayekh/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 749522466, "node_id": "MDU6TGFiZWw3NDk1MjI0NjY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/type:%20question", "name": "type: question", "color": "d876e3", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-10-04T18:23:26Z", "updated_at": "2020-02-19T19:10:40Z", "closed_at": "2020-02-19T19:10:40Z", "author_association": "NONE", "active_lock_reason": null, "body": "Reference ID: 0412573472\r\n\r\nI am training a Sagemaker LDA model on a `recordio` formatted input data. Here is the training code:\r\n\r\n```\r\nsession = sagemaker.Session()\r\n\r\n# specify general training job information\r\nlda = sagemaker.estimator.Estimator(\r\n    container,\r\n    role,\r\n    output_path = f\"s3://{BUCKET}/{OUTPUT_DIR}\",\r\n    train_instance_count = INSTANCE_COUNT,\r\n    train_instance_type = INSTANCE_TYPE,\r\n    sagemaker_session = session,\r\n)\r\n\r\n# set algorithm-specific hyperparameters\r\n# https://docs.aws.amazon.com/sagemaker/latest/dg/lda_hyperparameters.html\r\nlda.set_hyperparameters(\r\n    num_topics = N_TOPICS,\r\n    feature_dim = VOCAB_SIZE,\r\n    mini_batch_size = DOC_SIZE,\r\n    max_restarts = 50,\r\n)\r\n\r\ntrain_channel = sagemaker.session.s3_input(\r\n    s3_data = f\"s3://{BUCKET}/{TRAIN_DIR}/{TRAIN_FILE}\",\r\n    content_type = \"application/x-recordio-protobuf\",\r\n)\r\n\r\nlda.fit({'train': train_channel})\r\n```\r\n\r\nIt trains fine and finishes after a few minutes. But the batch transfer fails on the same input data with the error `unable to evaluate payload provided`. Here is the code:\r\n\r\n```\r\ntransformer = lda.transformer(\r\n    instance_count = INSTANCE_COUNT, \r\n    instance_type = INSTANCE_TYPE, \r\n    output_path = f\"s3://{BUCKET}/{PRED_DIR}\",\r\n    strategy = \"SingleRecord\",\r\n    max_payload = 1,\r\n)\r\n\r\ntransformer.transform(\r\n    data = f\"s3://{BUCKET}/{TRAIN_DIR}/{TRAIN_FILE}\", \r\n    data_type = \"S3Prefix\", \r\n    content_type = \"application/x-recordio-protobuf\", \r\n    split_type = \"RecordIO\"\r\n)\r\n```\r\n\r\nI have tried also the `MultiRecord` with no luck. The model file can be downloaded from here: https://drive.google.com/open?id=1y2UGgRGq7UBY4m88rHVPSLJQitRMa66p\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1075/reactions", "total_count": 3, "+1": 3, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1075/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1034", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1034/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1034/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1034/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1034", "id": 491344557, "node_id": "MDU6SXNzdWU0OTEzNDQ1NTc=", "number": 1034, "title": "Bug: change: use regional endpoint when creating AWS STS client #1026", "user": {"login": "adrian-chang", "id": 601268, "node_id": "MDQ6VXNlcjYwMTI2OA==", "avatar_url": "https://avatars.githubusercontent.com/u/601268?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adrian-chang", "html_url": "https://github.com/adrian-chang", "followers_url": "https://api.github.com/users/adrian-chang/followers", "following_url": "https://api.github.com/users/adrian-chang/following{/other_user}", "gists_url": "https://api.github.com/users/adrian-chang/gists{/gist_id}", "starred_url": "https://api.github.com/users/adrian-chang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adrian-chang/subscriptions", "organizations_url": "https://api.github.com/users/adrian-chang/orgs", "repos_url": "https://api.github.com/users/adrian-chang/repos", "events_url": "https://api.github.com/users/adrian-chang/events{/privacy}", "received_events_url": "https://api.github.com/users/adrian-chang/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 850818746, "node_id": "MDU6TGFiZWw4NTA4MTg3NDY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/status:%20pending%20release", "name": "status: pending release", "color": "eee8d5", "default": false, "description": "issues for which fixes have been merged but not released to PyPI"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 22, "created_at": "2019-09-09T21:51:03Z", "updated_at": "2019-09-12T14:53:05Z", "closed_at": "2019-09-10T18:53:59Z", "author_association": "NONE", "active_lock_reason": null, "body": "Please fill out the form below.\r\n\r\n### System Information\r\n- Python 3.6.9\r\n- Sagemaker SDK 1.39.0\r\n\r\n### Describe the problem\r\nPR #1026 introduced a bug by not using a scheme for a particular STS endpoint\r\n\r\n### Minimal repro / logs\r\n\r\n```sagemaker.get_execution_role(sagemaker_session)```\r\n\r\nLeads to this stack trace\r\n\r\n```\r\n  File \"/Library/Caches/virtualenvs/gocentral-ml-sagemaker-0XKWRhha-py3.6/lib/python3.6/site-packages/sagemaker/session.py\", line 1386, in get_caller_identity_arn\r\n    \"sts\", endpoint_url=sts_regional_endpoint(self.boto_region_name)\r\n  File \"/Library/Caches/virtualenvs/gocentral-ml-sagemaker-0XKWRhha-py3.6/lib/python3.6/site-packages/boto3/session.py\", line 263, in client\r\n    aws_session_token=aws_session_token, config=config)\r\n  File \"/Library/Caches/pypoetry/virtualenvs/gocentral-ml-sagemaker-0XKWRhha-py3.6/lib/python3.6/site-packages/botocore/session.py\", line 839, in create_client\r\n    client_config=config, api_version=api_version)\r\n  File \"/Library/Caches/pypoetry/virtualenvs/gocentral-ml-sagemaker-0XKWRhha-py3.6/lib/python3.6/site-packages/botocore/client.py\", line 86, in create_client\r\n    verify, credentials, scoped_config, client_config, endpoint_bridge)\r\n  File \"/Library/Caches/pypoetry/virtualenvs/gocentral-ml-sagemaker-0XKWRhha-py3.6/lib/python3.6/site-packages/botocore/client.py\", line 328, in _get_client_args\r\n    verify, credentials, scoped_config, client_config, endpoint_bridge)\r\n  File \"/Library/Caches/pypoetry/virtualenvs/gocentral-ml-sagemaker-0XKWRhha-py3.6/lib/python3.6/site-packages/botocore/args.py\", line 85, in get_client_args\r\n    client_cert=new_config.client_cert)\r\n  File \"/Library/Caches/pypoetry/virtualenvs/gocentral-ml-sagemaker-0XKWRhha-py3.6/lib/python3.6/site-packages/botocore/endpoint.py\", line 261, in create_endpoint\r\n    raise ValueError(\"Invalid endpoint: %s\" % endpoint_url)\r\nValueError: Invalid endpoint: sts.us-west-2.amazonaws.com\r\n\r\n```\r\n\r\nThe `endpoint.py` requires a scheme and non is provided via the `sts_regional_endpoint` method.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1034/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1034/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1012", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1012/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1012/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1012/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1012", "id": 487473983, "node_id": "MDU6SXNzdWU0ODc0NzM5ODM=", "number": 1012, "title": "Error when deploying custom model via `MXNetModel.deploy`", "user": {"login": "atibaup", "id": 1799897, "node_id": "MDQ6VXNlcjE3OTk4OTc=", "avatar_url": "https://avatars.githubusercontent.com/u/1799897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/atibaup", "html_url": "https://github.com/atibaup", "followers_url": "https://api.github.com/users/atibaup/followers", "following_url": "https://api.github.com/users/atibaup/following{/other_user}", "gists_url": "https://api.github.com/users/atibaup/gists{/gist_id}", "starred_url": "https://api.github.com/users/atibaup/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/atibaup/subscriptions", "organizations_url": "https://api.github.com/users/atibaup/orgs", "repos_url": "https://api.github.com/users/atibaup/repos", "events_url": "https://api.github.com/users/atibaup/events{/privacy}", "received_events_url": "https://api.github.com/users/atibaup/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 850818746, "node_id": "MDU6TGFiZWw4NTA4MTg3NDY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/status:%20pending%20release", "name": "status: pending release", "color": "eee8d5", "default": false, "description": "issues for which fixes have been merged but not released to PyPI"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-08-30T13:06:33Z", "updated_at": "2019-09-10T17:45:08Z", "closed_at": "2019-09-10T17:45:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**: MXNet / MXNetModel\r\n- **Framework Version**: 1.4.1\r\n- **Python Version**:  3.6.7\r\n- **CPU or GPU**: N/A\r\n- **Python SDK Version**: 1.38.4\r\n- **Are you using a custom image**: No\r\n\r\n### Describe the problem\r\n\r\nWe obtain the following error when trying to deploy a custom MXNet model via `MXNetModel.deploy`:\r\n\r\n```python\r\nPython 3.6.7 | packaged by conda-forge | (default, Jul  2 2019, 02:07:37) \r\n[GCC 4.2.1 Compatible Clang 4.0.1 (tags/RELEASE_401/final)] on darwin\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> from sagemaker.mxnet.model import MXNetModel\r\n>>> mxnet_model = MXNetModel(model_data=s3_data_bucket,\r\n...                          role=role_arn,\r\n...                          entry_point='inference.py',\r\n...                          dependencies=['path/to/package'],\r\n...                          framework_version='1.4.1',\r\n...                          py_version='py3')\r\n>>> \r\n>>> mxnet_model.deploy(instance_type='ml.c5.xlarge', initial_instance_count=1)\r\n```\r\n```\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/anaconda3/envs/xx/lib/python3.6/site-packages/sagemaker/model.py\", line 426, in deploy\r\n    self._create_sagemaker_model(instance_type, accelerator_type, tags)\r\n  File \"/anaconda3/envs/xx/lib/python3.6/site-packages/sagemaker/model.py\", line 165, in _create_sagemaker_model\r\n    container_def = self.prepare_container_def(instance_type, accelerator_type=accelerator_type)\r\n  File \"/anaconda3/envs/xx/lib/python3.6/site-packages/sagemaker/mxnet/model.py\", line 148, in prepare_container_def\r\n    self._upload_code(deploy_key_prefix, is_mms_version)\r\n  File \"/anaconda3/envs/xx/lib/python3.6/site-packages/sagemaker/model.py\", line 788, in _upload_code\r\n    sagemaker_session=self.sagemaker_session,\r\n  File \"/anaconda3/envs/xx/lib/python3.6/site-packages/sagemaker/utils.py\", line 413, in repack_model\r\n    model_dir, inference_script, source_directory, dependencies, sagemaker_session, tmp\r\n  File \"/anaconda3/envs/xx/lib/python3.6/site-packages/sagemaker/utils.py\", line 472, in _create_or_update_code_dir\r\n    shutil.copytree(dependency, code_dir, os.path.basename(dependency))\r\n  File \"/anaconda3/envs/xx/lib/python3.6/shutil.py\", line 315, in copytree\r\n    os.makedirs(dst)\r\n  File \"/anaconda3/envs/xx/lib/python3.6/os.py\", line 220, in makedirs\r\n    mkdir(name, mode)\r\nFileExistsError: [Errno 17] File exists: '/var/folders/3z/kqrl01qd2vv6248zcs56q0wh0000gn/T/tmpqbeoxi0t/model/code'\r\n```\r\n\r\nWe strongly suspect the problem to be related to [line 472](https://github.com/aws/sagemaker-python-sdk/blob/9765de68ad8b776740d800148c861ca0e4794716/src/sagemaker/utils.py#L472) in `sagemaker/utils.py`:\r\n\r\n```python\r\nshutil.copytree(dependency, code_dir)\r\n```\r\n\r\nThe problem is that `code_dir` already exists at that point and hence `shutils.copytree` throws an error (cf. [shutils.copytree doc](https://docs.python.org/3/library/shutil.html#shutil.copytree)).\r\n\r\nThis problem only occurs when supplying the `MXNetModel` constructor with the parameter `framework_version`, which triggers a call to `utils.repack_model` from `FrameworkModel._upload_code`. \r\n\r\nWe believe the solution is to modify the aforementioned line to the following:\r\n```\r\nshutil.copytree(dependency, os.path.join(code_dir, os.path.basename(dependency)))\r\n```\r\nso that the dependency folder is copied into `code_dir` instead of trying to replace it.\r\n\r\n### Minimal repro / logs\r\n\r\nTo reproduce:\r\n\r\n1. \r\n```bash\r\ntouch inference.py\r\nmkdir -p path/to/package\r\ntouch path/to/package/utils.py\r\n```\r\n2. On a Python console, run:\r\n\r\n```python\r\nfrom sagemaker.mxnet.model import MXNetModel\r\n\r\ns3_data_bucket = 'bucket_with_model_artifacts'\r\nrole_arn = 'role_arn'\r\n\r\nmxnet_model = MXNetModel(model_data=s3_data_bucket,\r\n                         role=role_arn,\r\n                         entry_point='inference.py',\r\n                         dependencies=['path/to/package'],\r\n                         framework_version='1.4.1',\r\n                         py_version='py3')\r\n\r\nmxnet_model.deploy(instance_type='ml.c5.xlarge', initial_instance_count=1)\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1012/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1012/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1011", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1011/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1011/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1011/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/1011", "id": 487166763, "node_id": "MDU6SXNzdWU0ODcxNjY3NjM=", "number": 1011, "title": "Bug: Cannot use spot instances with hyperparameter tuning job", "user": {"login": "adrian-chang", "id": 601268, "node_id": "MDQ6VXNlcjYwMTI2OA==", "avatar_url": "https://avatars.githubusercontent.com/u/601268?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adrian-chang", "html_url": "https://github.com/adrian-chang", "followers_url": "https://api.github.com/users/adrian-chang/followers", "following_url": "https://api.github.com/users/adrian-chang/following{/other_user}", "gists_url": "https://api.github.com/users/adrian-chang/gists{/gist_id}", "starred_url": "https://api.github.com/users/adrian-chang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adrian-chang/subscriptions", "organizations_url": "https://api.github.com/users/adrian-chang/orgs", "repos_url": "https://api.github.com/users/adrian-chang/repos", "events_url": "https://api.github.com/users/adrian-chang/events{/privacy}", "received_events_url": "https://api.github.com/users/adrian-chang/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 850818746, "node_id": "MDU6TGFiZWw4NTA4MTg3NDY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/status:%20pending%20release", "name": "status: pending release", "color": "eee8d5", "default": false, "description": "issues for which fixes have been merged but not released to PyPI"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-08-29T20:42:45Z", "updated_at": "2019-09-09T17:48:46Z", "closed_at": "2019-09-09T17:48:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "Please fill out the form below.\r\n\r\n### System Information\r\n- **Python Version**:\r\n3.6.9\r\n- **Python SDK Version**:\r\n1.38.3\r\n\r\n### Describe the problem\r\nNot possible to use spot instances with the hyperparameter tuning job.\r\n\r\n### Minimal repro / logs\r\n\r\nhttps://github.com/aws/sagemaker-python-sdk/blob/9765de68ad8b776740d800148c861ca0e4794716/src/sagemaker/job.py\r\n\r\nDoesn't appear at all to copy over the `train_use_spot_instances` attribute of an estimator yet even though `train_max_wait` is used when set. This is problematic as you cannot use spot instances for hyperparameter tuning even though you can for individual tuning to the point where it's an issue if `train_max_wait` is set.\r\n\r\n  File \"/lib/python3.6/site-packages/sagemaker/tuner.py\", line 362, in fit\r\n    self.latest_tuning_job = _TuningJob.start_new(self, inputs)\r\n  File \"/lib/python3.6/site-packages/sagemaker/tuner.py\", line 893, in start_new\r\n    tuner.estimator.sagemaker_session.tune(**tuner_args)\r\n  File \"/lib/python3.6/site-packages/sagemaker/session.py\", line 574, in tune\r\n    self.sagemaker_client.create_hyper_parameter_tuning_job(**tune_request)\r\n  File \"/lib/python3.6/site-packages/botocore/client.py\", line 357, in _api_call\r\n    return self._make_api_call(operation_name, kwargs)\r\n  File \"/lib/python3.6/site-packages/botocore/client.py\", line 661, in _make_api_call\r\n    raise error_class(parsed_response, operation_name)\r\nbotocore.exceptions.ClientError: An error occurred (ValidationException) when calling the CreateHyperParameterTuningJob operation: Invalid MaxWaitTimeInSeconds. It is only supported when EnableManagedSpotTraining is set to true", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1011/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/1011/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/995", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/995/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/995/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/995/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/995", "id": 484356600, "node_id": "MDU6SXNzdWU0ODQzNTY2MDA=", "number": 995, "title": "Framework version is treated as None even though it was passed", "user": {"login": "rahul003", "id": 3457240, "node_id": "MDQ6VXNlcjM0NTcyNDA=", "avatar_url": "https://avatars.githubusercontent.com/u/3457240?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rahul003", "html_url": "https://github.com/rahul003", "followers_url": "https://api.github.com/users/rahul003/followers", "following_url": "https://api.github.com/users/rahul003/following{/other_user}", "gists_url": "https://api.github.com/users/rahul003/gists{/gist_id}", "starred_url": "https://api.github.com/users/rahul003/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rahul003/subscriptions", "organizations_url": "https://api.github.com/users/rahul003/orgs", "repos_url": "https://api.github.com/users/rahul003/repos", "events_url": "https://api.github.com/users/rahul003/events{/privacy}", "received_events_url": "https://api.github.com/users/rahul003/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-08-23T06:40:49Z", "updated_at": "2020-05-07T17:47:02Z", "closed_at": "2020-05-07T17:47:01Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Please fill out the form below.\r\n\r\n### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**: Tensorflow\r\n- **Framework Version**: 1.13.1\r\n- **Python Version**: py3\r\n- **CPU or GPU**: CPU\r\n- **Python SDK Version**: ?\r\n- **Are you using a custom image**: Yes\r\n\r\n### Describe the problem\r\nFramework_version was passed to the estimator but logs still say it was not passed.\r\n```\r\nmnist_estimator = TensorFlow(role=sagemaker.get_execution_role(),\r\n                  base_job_name='demo-mnist',\r\n                  train_instance_count=1,\r\n                  train_instance_type='ml.m4.xlarge',\r\n                  image_name=docker_image_name,\r\n                  entry_point=mnist_script,\r\n                  framework_version='1.13.1',\r\n                  py_version='py3',\r\n                  script_mode=True,\r\n                  hyperparameters=mnist_hyperparameters,\r\n                  train_max_run=1800,\r\n```\r\n\r\n```\r\nW0823 06:36:11.344061 140533465798464 estimator.py:280] No framework_version specified, defaulting to version 1.11. This is not the latest supported version. If you would like to use version 1.14, please add framework_version=1.14 to your constructor.\r\nW0823 06:36:11.344887 140533465798464 estimator.py:290] tensorflow py2 container will be deprecated soon.\r\n\r\n2019-08-23 06:36:10 Starting - Starting the training job...\r\n2019-08-23 06:36:24 Starting - Launching requested ML instances......\r\n2019-08-23 06:37:28 Starting - Preparing the instances for training......\r\n2019-08-23 06:38:41 Downloading - Downloading input data...\r\n2019-08-23 06:38:59 Training - Downloading the training image......\r\n2019-08-23 06:39:59 Training - Training image download completed. Training in progress.\r\n```\r\n### Minimal repro / logs\r\nHopefully above is enough, if not ping me on Chime. ", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/995/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/995/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/987", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/987/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/987/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/987/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/987", "id": 481876581, "node_id": "MDU6SXNzdWU0ODE4NzY1ODE=", "number": 987, "title": "Model deploy instance_type modification failed", "user": {"login": "Wei-1", "id": 10698262, "node_id": "MDQ6VXNlcjEwNjk4MjYy", "avatar_url": "https://avatars.githubusercontent.com/u/10698262?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Wei-1", "html_url": "https://github.com/Wei-1", "followers_url": "https://api.github.com/users/Wei-1/followers", "following_url": "https://api.github.com/users/Wei-1/following{/other_user}", "gists_url": "https://api.github.com/users/Wei-1/gists{/gist_id}", "starred_url": "https://api.github.com/users/Wei-1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Wei-1/subscriptions", "organizations_url": "https://api.github.com/users/Wei-1/orgs", "repos_url": "https://api.github.com/users/Wei-1/repos", "events_url": "https://api.github.com/users/Wei-1/events{/privacy}", "received_events_url": "https://api.github.com/users/Wei-1/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 749522457, "node_id": "MDU6TGFiZWw3NDk1MjI0NTc=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/type:%20feature%20request", "name": "type: feature request", "color": "a2eeef", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 27, "created_at": "2019-08-17T11:27:36Z", "updated_at": "2020-07-10T15:41:12Z", "closed_at": "2020-07-10T15:41:11Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Reference:\r\n* 0409412934\r\n* MLFW-1638\r\n\r\n### System Information\r\n- **Framework / Algorithm**: PCA\r\n- **Framework Version**: SageMaker Aug 12, 2019 09:03 UTC\r\n- **Python Version**: 3\r\n- **CPU or GPU**: CPU\r\n- **Python SDK Version**:\r\n- **Are you using a custom image**: No\r\n\r\n### Describe the problem\r\n\r\nRunning SageMaker example: PCA for MNIST\r\nIf a user try to deploy a model with an instance_type that is not available,\r\nthe user won't be able to simply replace the instance_type and deploy again.\r\n\r\n### Minimal repro / logs\r\n\r\nWhile running PCA for MNIST in the example project, and executing the following script: \r\n```\r\npca_predictor = pca.deploy(initial_instance_count=1, instance_type='ml.m4.xlarge') \r\n```\r\nWhen a user doesn't have any extra resource to launch new instance with the assigned instance_type. The user will get a `ResourceLimitExceeded` error.\r\nIf the user desides to change the instance_type and execute the script again.\r\n```\r\npca_predictor = pca.deploy(initial_instance_count=1, instance_type='ml.t2.medium') \r\n```\r\nThe the user will get this error:\r\n```\r\n--------------------------------------------------------------------------- \r\nResourceLimitExceeded Traceback (most recent call last) \r\n<ipython-input-18-b2bb257b120c> in <module>() \r\n1 pca_predictor = pca.deploy(initial_instance_count=1, \r\n----> 2 instance_type='ml.t2.medium') \r\n...... \r\nResourceLimitExceeded: An error occurred (ResourceLimitExceeded) when calling the CreateEndpoint operation: The account-level service limit 'ml.m4.xlarge for endpoint usage' is 0 Instances, with current utilization of 0 Instances and a request delta of 1 Instances... \r\n--------------------------------------------------------------------------- \r\n```\r\nFrom this error message, \r\nwe can see that although we are trying to set a new instance_type, \r\nthe instance_type is not really reset.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/987/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/987/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/963", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/963/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/963/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/963/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/963", "id": 475611662, "node_id": "MDU6SXNzdWU0NzU2MTE2NjI=", "number": 963, "title": "PipelineModel deploy method cannot find update_endpoint argument", "user": {"login": "markpurser", "id": 1463357, "node_id": "MDQ6VXNlcjE0NjMzNTc=", "avatar_url": "https://avatars.githubusercontent.com/u/1463357?v=4", "gravatar_id": "", "url": "https://api.github.com/users/markpurser", "html_url": "https://github.com/markpurser", "followers_url": "https://api.github.com/users/markpurser/followers", "following_url": "https://api.github.com/users/markpurser/following{/other_user}", "gists_url": "https://api.github.com/users/markpurser/gists{/gist_id}", "starred_url": "https://api.github.com/users/markpurser/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/markpurser/subscriptions", "organizations_url": "https://api.github.com/users/markpurser/orgs", "repos_url": "https://api.github.com/users/markpurser/repos", "events_url": "https://api.github.com/users/markpurser/events{/privacy}", "received_events_url": "https://api.github.com/users/markpurser/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-08-01T10:47:04Z", "updated_at": "2019-08-15T18:01:50Z", "closed_at": "2019-08-15T18:01:38Z", "author_association": "NONE", "active_lock_reason": null, "body": "Please fill out the form below.\r\n\r\n### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**:\r\nSKLearn with kNN\r\n- **Framework Version**:\r\n- **Python Version**:\r\nPython 3\r\n- **CPU or GPU**:\r\nCPU\r\n- **Python SDK Version**:\r\n- **Are you using a custom image**:\r\nNo\r\n\r\n### Describe the problem\r\nI want to update an endpoint that already exists when deploying from a PipelineModel. The update_endpoint flag is supported on Estimators.deploy but not on PipelineModel.deploy\r\n\r\n### Minimal repro / logs\r\n---------------------------------------------------------------------------\r\nTypeError                                 Traceback (most recent call last)\r\n<ipython-input-116-1bc40bd315b2> in <module>()\r\n     22                 instance_type='ml.t2.medium',\r\n     23                 endpoint_name=endpoint_name,\r\n---> 24                 update_endpoint=True)\r\n\r\nTypeError: deploy() got an unexpected keyword argument 'update_endpoint'\r\n\r\n- **Exact command to reproduce**:\r\nmodel_name = 'inference-pipeline-' + timestamp_prefix\r\nendpoint_name = 'sagemaker-ep'\r\nsm_model = PipelineModel(\r\n    name=model_name, \r\n    role=role, \r\n    models=[\r\n        sklearn_preprocessor_model, \r\n        sklearn_estimator_model])\r\n\r\nsm_model.deploy(initial_instance_count=1,\r\n                instance_type='ml.t2.medium',\r\n                endpoint_name=endpoint_name,\r\n                update_endpoint=True)", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/963/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/963/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/920", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/920/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/920/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/920/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/920", "id": 466469576, "node_id": "MDU6SXNzdWU0NjY0Njk1NzY=", "number": 920, "title": "DataProcessing object not supported when creating a batch transform job", "user": {"login": "shanedonburke", "id": 46410274, "node_id": "MDQ6VXNlcjQ2NDEwMjc0", "avatar_url": "https://avatars.githubusercontent.com/u/46410274?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shanedonburke", "html_url": "https://github.com/shanedonburke", "followers_url": "https://api.github.com/users/shanedonburke/followers", "following_url": "https://api.github.com/users/shanedonburke/following{/other_user}", "gists_url": "https://api.github.com/users/shanedonburke/gists{/gist_id}", "starred_url": "https://api.github.com/users/shanedonburke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shanedonburke/subscriptions", "organizations_url": "https://api.github.com/users/shanedonburke/orgs", "repos_url": "https://api.github.com/users/shanedonburke/repos", "events_url": "https://api.github.com/users/shanedonburke/events{/privacy}", "received_events_url": "https://api.github.com/users/shanedonburke/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 749522466, "node_id": "MDU6TGFiZWw3NDk1MjI0NjY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/type:%20question", "name": "type: question", "color": "d876e3", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-07-10T19:05:12Z", "updated_at": "2019-07-15T15:52:22Z", "closed_at": "2019-07-15T15:52:13Z", "author_association": "NONE", "active_lock_reason": null, "body": "Please fill out the form below.\r\n\r\n### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**: SageMaker / XGBoost\r\n- **Framework Version**: Unknown\r\n- **Python Version**: Lambda 3.6\r\n- **CPU or GPU**: Lambda\r\n- **Python SDK Version**: Lambda\r\n- **Are you using a custom image**: No\r\n\r\n### Describe the problem\r\nWhen using client.create_transform_job(...), the \"DataProcessing\" object that is mentioned in the documentation doesn't seem to be accepted. Even with the default values, the object is not accepted.\r\n\r\n### Minimal repro / logs\r\nParameter validation failed:\r\nUnknown parameter in input: \"DataProcessing\", must be one of: TransformJobName, ModelName, MaxConcurrentTransforms, MaxPayloadInMB, BatchStrategy, Environment, TransformInput, TransformOutput, TransformResources, Tags: ParamValidationError\r\nTraceback (most recent call last):\r\nFile \"/var/task/lambda_function.py\", line 19, in lambda_handler\r\nsm_response = batch_transform(s3_info, job_info, resources)\r\nFile \"/var/task/lambda_function.py\", line 56, in batch_transform\r\n'JoinSource': 'None'\r\nFile \"/var/runtime/botocore/client.py\", line 314, in _api_call\r\nreturn self._make_api_call(operation_name, kwargs)\r\nFile \"/var/runtime/botocore/client.py\", line 586, in _make_api_call\r\napi_params, operation_model, context=request_context)\r\nFile \"/var/runtime/botocore/client.py\", line 621, in _convert_to_request_dict\r\napi_params, operation_model)\r\nFile \"/var/runtime/botocore/validate.py\", line 291, in serialize_to_request\r\nraise ParamValidationError(report=report.generate_report())\r\nbotocore.exceptions.ParamValidationError: Parameter validation failed:\r\nUnknown parameter in input: \"DataProcessing\", must be one of: TransformJobName, ModelName, MaxConcurrentTransforms, MaxPayloadInMB, BatchStrategy, Environment, TransformInput, TransformOutput, TransformResources, Tags\r\n\r\n- **Exact command to reproduce**:\r\n\r\n```python\r\n    response = resources[SAGEMAKER].create_transform_job(\r\n        TransformJobName=job_info[JOB_ID],\r\n        ModelName=MODEL_NAME,\r\n        MaxConcurrentTransforms=5,\r\n        MaxPayloadInMB=5,\r\n        BatchStrategy='MultiRecord',\r\n        TransformInput={\r\n            'DataSource': {\r\n                'S3DataSource': {\r\n                    'S3DataType': 'S3Prefix',\r\n                    'S3Uri': s3_info[PARAMS_BASE_URI]\r\n                }\r\n            },\r\n            'ContentType': 'text/csv',\r\n            'SplitType': 'Line'\r\n        },\r\n        TransformOutput={\r\n            'S3OutputPath': s3_info[DEST_URI],\r\n            'AssembleWith': 'Line',\r\n            'Accept': 'text/csv'\r\n        },\r\n        TransformResources={\r\n            'InstanceType': 'ml.m5.large',\r\n            'InstanceCount': 3\r\n        },\r\n        DataProcessing={\r\n            'InputFilter': \"$[1:]\",\r\n            'OutputFilter': \"$\",\r\n            'JoinSource': 'None'\r\n        }\r\n    )\r\n```", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/920/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/920/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/911", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/911/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/911/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/911/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/911", "id": 464922386, "node_id": "MDU6SXNzdWU0NjQ5MjIzODY=", "number": 911, "title": "Not detect requirements.txt in TensorFlow script mode", "user": {"login": "xkumiyu", "id": 6437204, "node_id": "MDQ6VXNlcjY0MzcyMDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/6437204?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xkumiyu", "html_url": "https://github.com/xkumiyu", "followers_url": "https://api.github.com/users/xkumiyu/followers", "following_url": "https://api.github.com/users/xkumiyu/following{/other_user}", "gists_url": "https://api.github.com/users/xkumiyu/gists{/gist_id}", "starred_url": "https://api.github.com/users/xkumiyu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xkumiyu/subscriptions", "organizations_url": "https://api.github.com/users/xkumiyu/orgs", "repos_url": "https://api.github.com/users/xkumiyu/repos", "events_url": "https://api.github.com/users/xkumiyu/events{/privacy}", "received_events_url": "https://api.github.com/users/xkumiyu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 13, "created_at": "2019-07-07T07:07:47Z", "updated_at": "2020-11-04T04:03:45Z", "closed_at": "2019-07-10T15:17:25Z", "author_association": "NONE", "active_lock_reason": null, "body": "### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**: TensorFlow\r\n- **Framework Version**: 1.12.0\r\n- **Python Version**: 3.6\r\n- **CPU or GPU**: CPU\r\n- **Python SDK Version**: 1.32.1\r\n- **Are you using a custom image**: No\r\n\r\n### Describe the problem\r\nIn #839, it was mentioned that Docker Image detected requirements.txt and installed python libraries, but in my experiment it was not installed.\r\nI think the Image did not detect requirements.txt, but I confirmed that requirements.txt exists in sourcedir.tar.gz uploaded to S3.\r\n\r\n### Minimal repro / logs\r\n\r\n```\r\n2019-07-07 06:54:53 Starting - Starting the training job...\r\n2019-07-07 06:54:58 Starting - Launching requested ML instances......\r\n2019-07-07 06:56:05 Starting - Preparing the instances for training...\r\n2019-07-07 06:56:43 Downloading - Downloading input data...\r\n2019-07-07 06:57:31 Training - Training image download completed. Training in progress.\r\n2019-07-07 06:57:31 Uploading - Uploading generated training model\r\n2019-07-07 06:57:31 Failed - Training job failed\r\n\r\n2019-07-07 06:57:21,299 sagemaker-containers INFO     Imported framework sagemaker_tensorflow_container.training\r\n2019-07-07 06:57:21,306 sagemaker-containers INFO     No GPUs detected (normal if no gpus installed)\r\n2019-07-07 06:57:21,547 sagemaker-containers INFO     No GPUs detected (normal if no gpus installed)\r\n2019-07-07 06:57:21,561 sagemaker-containers INFO     No GPUs detected (normal if no gpus installed)\r\n2019-07-07 06:57:21,572 sagemaker-containers INFO     Invoking user script\r\n\r\nTraining Env:\r\n\r\n{\r\n    \"additional_framework_parameters\": {},\r\n    \"channel_input_dirs\": {\r\n        \"training\": \"/opt/ml/input/data/training\"\r\n    },\r\n    \"current_host\": \"algo-1\",\r\n    \"framework_module\": \"sagemaker_tensorflow_container.training:main\",\r\n    \"hosts\": [\r\n        \"algo-1\"\r\n    ],\r\n    \"hyperparameters\": {\r\n        \"model_dir\": \"s3://sagemaker-ap-northeast-1-xxx/sagemaker-tensorflow-scriptmode-2019-07-07-06-54-50-259/model\"\r\n    },\r\n    \"input_config_dir\": \"/opt/ml/input/config\",\r\n    \"input_data_config\": {\r\n        \"training\": {\r\n            \"TrainingInputMode\": \"File\",\r\n            \"S3DistributionType\": \"FullyReplicated\",\r\n            \"RecordWrapperType\": \"None\"\r\n        }\r\n    },\r\n    \"input_dir\": \"/opt/ml/input\",\r\n    \"is_master\": true,\r\n    \"job_name\": \"sagemaker-tensorflow-scriptmode-2019-07-07-06-54-50-259\",\r\n    \"log_level\": 20,\r\n    \"master_hostname\": \"algo-1\",\r\n    \"model_dir\": \"/opt/ml/model\",\r\n    \"module_dir\": \"s3://sagemaker-ap-northeast-1-xxx/sagemaker-tensorflow-scriptmode-2019-07-07-06-54-50-259/source/sourcedir.tar.gz\",\r\n    \"module_name\": \"train\",\r\n    \"network_interface_name\": \"eth0\",\r\n    \"num_cpus\": 2,\r\n    \"num_gpus\": 0,\r\n    \"output_data_dir\": \"/opt/ml/output/data\",\r\n    \"output_dir\": \"/opt/ml/output\",\r\n    \"output_intermediate_dir\": \"/opt/ml/output/intermediate\",\r\n    \"resource_config\": {\r\n        \"current_host\": \"algo-1\",\r\n        \"hosts\": [\r\n            \"algo-1\"\r\n        ],\r\n        \"network_interface_name\": \"eth0\"\r\n    },\r\n    \"user_entry_point\": \"train.py\"\r\n}\r\n\r\nEnvironment variables:\r\n\r\nSM_HOSTS=[\"algo-1\"]\r\nSM_NETWORK_INTERFACE_NAME=eth0\r\nSM_HPS={\"model_dir\":\"s3://sagemaker-ap-northeast-1-xxx/sagemaker-tensorflow-scriptmode-2019-07-07-06-54-50-259/model\"}\r\nSM_USER_ENTRY_POINT=train.py\r\nSM_FRAMEWORK_PARAMS={}\r\nSM_RESOURCE_CONFIG={\"current_host\":\"algo-1\",\"hosts\":[\"algo-1\"],\"network_interface_name\":\"eth0\"}\r\nSM_INPUT_DATA_CONFIG={\"training\":{\"RecordWrapperType\":\"None\",\"S3DistributionType\":\"FullyReplicated\",\"TrainingInputMode\":\"File\"}}\r\nSM_OUTPUT_DATA_DIR=/opt/ml/output/data\r\nSM_CHANNELS=[\"training\"]\r\nSM_CURRENT_HOST=algo-1\r\nSM_MODULE_NAME=train\r\nSM_LOG_LEVEL=20\r\nSM_FRAMEWORK_MODULE=sagemaker_tensorflow_container.training:main\r\nSM_INPUT_DIR=/opt/ml/input\r\nSM_INPUT_CONFIG_DIR=/opt/ml/input/config\r\nSM_OUTPUT_DIR=/opt/ml/output\r\nSM_NUM_CPUS=2\r\nSM_NUM_GPUS=0\r\nSM_MODEL_DIR=/opt/ml/model\r\nSM_MODULE_DIR=s3://sagemaker-ap-northeast-1-xxx/sagemaker-tensorflow-scriptmode-2019-07-07-06-54-50-259/source/sourcedir.tar.gz\r\nSM_TRAINING_ENV={\"additional_framework_parameters\":{},\"channel_input_dirs\":{\"training\":\"/opt/ml/input/data/training\"},\"current_host\":\"algo-1\",\"framework_module\":\"sagemaker_tensorflow_container.training:main\",\"hosts\":[\"algo-1\"],\"hyperparameters\":{\"model_dir\":\"s3://sagemaker-ap-northeast-1-xxx/sagemaker-tensorflow-scriptmode-2019-07-07-06-54-50-259/model\"},\"input_config_dir\":\"/opt/ml/input/config\",\"input_data_config\":{\"training\":{\"RecordWrapperType\":\"None\",\"S3DistributionType\":\"FullyReplicated\",\"TrainingInputMode\":\"File\"}},\"input_dir\":\"/opt/ml/input\",\"is_master\":true,\"job_name\":\"sagemaker-tensorflow-scriptmode-2019-07-07-06-54-50-259\",\"log_level\":20,\"master_hostname\":\"algo-1\",\"model_dir\":\"/opt/ml/model\",\"module_dir\":\"s3://sagemaker-ap-northeast-1-xxx/sagemaker-tensorflow-scriptmode-2019-07-07-06-54-50-259/source/sourcedir.tar.gz\",\"module_name\":\"train\",\"network_interface_name\":\"eth0\",\"num_cpus\":2,\"num_gpus\":0,\"output_data_dir\":\"/opt/ml/output/data\",\"output_dir\":\"/opt/ml/output\",\"output_intermediate_dir\":\"/opt/ml/output/intermediate\",\"resource_config\":{\"current_host\":\"algo-1\",\"hosts\":[\"algo-1\"],\"network_interface_name\":\"eth0\"},\"user_entry_point\":\"train.py\"}\r\nSM_USER_ARGS=[\"--model_dir\",\"s3://sagemaker-ap-northeast-1-xxx/sagemaker-tensorflow-scriptmode-2019-07-07-06-54-50-259/model\"]\r\nSM_OUTPUT_INTERMEDIATE_DIR=/opt/ml/output/intermediate\r\nSM_CHANNEL_TRAINING=/opt/ml/input/data/training\r\nSM_HP_MODEL_DIR=s3://sagemaker-ap-northeast-1-xxx/sagemaker-tensorflow-scriptmode-2019-07-07-06-54-50-259/model\r\nPYTHONPATH=/opt/ml/code:/usr/local/bin:/usr/lib/python36.zip:/usr/lib/python3.6:/usr/lib/python3.6/lib-dynload:/usr/local/lib/python3.6/dist-packages:/usr/lib/python3/dist-packages\r\n\r\nInvoking script with the following command:\r\n\r\n/usr/bin/python train.py --model_dir s3://sagemaker-ap-northeast-1-xxx/sagemaker-tensorflow-scriptmode-2019-07-07-06-54-50-259/model\r\n\r\n\r\nTraceback (most recent call last):\r\n  File \"train.py\", line 1, in <module>\r\n    import matplotlib.pyplot as plt\r\nModuleNotFoundError: No module named 'matplotlib'\r\n2019-07-07 06:57:21,597 sagemaker-containers ERROR    ExecuteUserScriptError:\r\nCommand \"/usr/bin/python train.py --model_dir s3://sagemaker-ap-northeast-1-xxx/sagemaker-tensorflow-scriptmode-2019-07-07-06-54-50-259/model\"\r\n```\r\n\r\n- **Exact command to reproduce**:\r\n\r\n``` python\r\nfrom sagemaker.tensorflow import TensorFlow\r\n\r\nestimator = TensorFlow(entry_point='train.py',\r\n                       source_dir='src',\r\n                       role=role,\r\n                       train_instance_type='ml.m5.large',\r\n                       train_instance_count=1,\r\n                       framework_version='1.12.0',\r\n                       py_version='py3')\r\nestimator.fit(input_data)\r\n```\r\n\r\n```\r\n$ tree src\r\nsrc\r\n|-- train.py\r\n`-- requirements.txt\r\n```\r\n\r\n- train.py\r\n``` python\r\nimport matplotlib.pyplot as plt\r\n\r\nif __name__ == \"__main__\":\r\n    pass\r\n```\r\n\r\n- requirements.txt\r\n```\r\n-i https://pypi.org/simple\r\nmatplotlib==3.1.1\r\n```", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/911/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/911/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/906", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/906/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/906/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/906/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/906", "id": 464718462, "node_id": "MDU6SXNzdWU0NjQ3MTg0NjI=", "number": 906, "title": "STS call on Session Object points to Global endpoint causing failure in case of Internet Disabled SageMaker notebooks", "user": {"login": "AnshumanRanjan", "id": 12955012, "node_id": "MDQ6VXNlcjEyOTU1MDEy", "avatar_url": "https://avatars.githubusercontent.com/u/12955012?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AnshumanRanjan", "html_url": "https://github.com/AnshumanRanjan", "followers_url": "https://api.github.com/users/AnshumanRanjan/followers", "following_url": "https://api.github.com/users/AnshumanRanjan/following{/other_user}", "gists_url": "https://api.github.com/users/AnshumanRanjan/gists{/gist_id}", "starred_url": "https://api.github.com/users/AnshumanRanjan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AnshumanRanjan/subscriptions", "organizations_url": "https://api.github.com/users/AnshumanRanjan/orgs", "repos_url": "https://api.github.com/users/AnshumanRanjan/repos", "events_url": "https://api.github.com/users/AnshumanRanjan/events{/privacy}", "received_events_url": "https://api.github.com/users/AnshumanRanjan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 850818746, "node_id": "MDU6TGFiZWw4NTA4MTg3NDY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/status:%20pending%20release", "name": "status: pending release", "color": "eee8d5", "default": false, "description": "issues for which fixes have been merged but not released to PyPI"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-07-05T17:08:35Z", "updated_at": "2019-09-09T17:49:06Z", "closed_at": "2019-09-09T17:49:06Z", "author_association": "NONE", "active_lock_reason": null, "body": "Please fill out the form below.\r\n\r\n### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**:  All\r\n- **Framework Version**: NA\r\n- **Python Version**: NA\r\n- **CPU or GPU**: NA\r\n- **Python SDK Version**: NA\r\n- **Are you using a custom image**: NA\r\n\r\n### Describe the problem\r\nmethods on Session.py  [(Session.py)](https://github.com/aws/sagemaker-python-sdk/blob/master/src/sagemaker/session.py)\r\nget_execution_role()\r\nhttps://github.com/aws/sagemaker-python-sdk/blob/6aa409bfdd1fc65212a787bb605dea558d033ab0/src/sagemaker/session.py#L194\r\nOR\r\ndefault_bucket() \r\nhttps://github.com/aws/sagemaker-python-sdk/blob/6aa409bfdd1fc65212a787bb605dea558d033ab0/src/sagemaker/session.py#L1243\r\n\r\nuse a STS client which does not use regional endpoints which means except for newer regions all region , this calls https://sts.amazonaws.com  instead of say https://sts.us-west-2.amazonaws.com\r\n\r\nThis usually is not a problem in normal cases , but with Internet disabled Notebooks using VPC endpoint this causes a issue  , as the global endpoint resolves to a Public IP and hence the above two methods would hang and timeout\r\n\r\nDue to implementation on boto3 side , even if you pass a region to the  boto client creation for sts it would still use the global endpoint . The only workaround is to pass a endpoint_url to the client passing the regional endpoint \r\n\r\nExample : \r\n```\r\nimport boto3\r\ns3 = boto3.client('sts',region='eu-west-1')\r\ns3.meta.endpoint_url\r\n'https://sts.amazonaws.com'\r\n\r\n```\r\nA way to fix this would be by doing : \r\n```\r\n\r\nboto3.client(\r\n    \"sts\", \r\n    region_name=\"us-west-2\", \r\n    endpoint_url=\"https://sts.us-west-2.amazonaws.com\"\r\n)\r\n```\r\nThe  Boto3 issue that addresses this problem is listed : https://github.com/boto/boto3/issues/1859\r\n###################################\r\nCurrently I am  working around the get_execution_role() by overriding the session object with below chunk of code , obviously this can also be done by just passing the role arn as .fit seems to work regardless :\r\n\r\n```\r\nimport re\r\nfrom sagemaker.session import Session\r\nfrom sagemaker import get_execution_role\r\nregion = Session().boto_region_name\r\nendpoint_url = \"https://sts.{}.amazonaws.com\".format(region)\r\n\r\ndef get_execution_role_override(sagemaker_session=None):\r\n    if not sagemaker_session:\r\n        sagemaker_session = Session()\r\n    arn = sagemaker_session.get_caller_identity_arn()\r\n    if \":role/\" in arn:\r\n        return arn\r\n    \r\ndef get_caller_identity_arn_override(self):\r\n\r\n        assumed_role = self.boto_session.client(\"sts\",region_name=region,endpoint_url=endpoint_url).get_caller_identity()[\"Arn\"]\r\n\r\n        if \"AmazonSageMaker-ExecutionRole\" in assumed_role:\r\n            role = re.sub(\r\n                r\"^(.+)sts::(\\d+):assumed-role/(.+?)/.*$\",\r\n                r\"\\1iam::\\2:role/service-role/\\3\",\r\n                assumed_role,\r\n            )\r\n            return role\r\n\r\n        role = re.sub(r\"^(.+)sts::(\\d+):assumed-role/(.+?)/.*$\", r\"\\1iam::\\2:role/\\3\", assumed_role)\r\n\r\n        # Call IAM to get the role's path\r\n        role_name = role[role.rfind(\"/\") + 1 :]\r\n        try:\r\n            role = self.boto_session.client(\"iam\").get_role(RoleName=role_name)[\"Role\"][\"Arn\"]\r\n        except ClientError:\r\n            LOGGER.warning(\r\n                \"Couldn't call 'get_role' to get Role ARN from role name {} to get Role path.\".format(\r\n                    role_name\r\n                )\r\n            )\r\n\r\n        return role\r\n    \r\n\r\nSession.get_caller_identity_arn = get_caller_identity_arn_override\r\nrole = get_execution_role_override()\r\nbucket = \"YOUR_BUCKET_NAME\"\r\n```\r\n\r\n\r\n### Minimal repro / logs\r\n\r\na) Create a Internet Disabled SageMaker Notebook \r\nb) Add sts VPC endpoint and also sagemaker.api VPC endpoint (also others if required like s3 and cloudwatch)\r\nc) Run any notebook  that calls any of the above function and it would hang\r\nd) From notebook terminal if you nslookup https://sts.amazonaws.com you would get a public IP and not a private IP as required by sts VPC endpoint .  But nslookup on https://sts.us-west-2.amazonaws.com  would give you a private IP that would go through the STS endpoint \r\n\r\n\r\n\r\nCan you see if this is something that needs to be fixed on the SageMaker SDK or followed up on boto3\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/906/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/906/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/889", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/889/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/889/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/889/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/889", "id": 461787183, "node_id": "MDU6SXNzdWU0NjE3ODcxODM=", "number": 889, "title": "Unable to pass eval_metrics to KMeans estimator", "user": {"login": "rddefauw", "id": 34320564, "node_id": "MDQ6VXNlcjM0MzIwNTY0", "avatar_url": "https://avatars.githubusercontent.com/u/34320564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rddefauw", "html_url": "https://github.com/rddefauw", "followers_url": "https://api.github.com/users/rddefauw/followers", "following_url": "https://api.github.com/users/rddefauw/following{/other_user}", "gists_url": "https://api.github.com/users/rddefauw/gists{/gist_id}", "starred_url": "https://api.github.com/users/rddefauw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rddefauw/subscriptions", "organizations_url": "https://api.github.com/users/rddefauw/orgs", "repos_url": "https://api.github.com/users/rddefauw/repos", "events_url": "https://api.github.com/users/rddefauw/events{/privacy}", "received_events_url": "https://api.github.com/users/rddefauw/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 850818746, "node_id": "MDU6TGFiZWw4NTA4MTg3NDY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/status:%20pending%20release", "name": "status: pending release", "color": "eee8d5", "default": false, "description": "issues for which fixes have been merged but not released to PyPI"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2019-06-27T23:12:44Z", "updated_at": "2019-07-19T20:39:56Z", "closed_at": "2019-07-19T20:39:56Z", "author_association": "NONE", "active_lock_reason": null, "body": "Please fill out the form below.\r\n\r\n### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**: KMeans (Sagemaker built-in algorithm)\r\n- **Framework Version**: n/a\r\n- **Python Version**: Python 3.6.5 :: Anaconda, Inc.\r\n- **CPU or GPU**: CPU\r\n- **Python SDK Version**: sagemaker==1.28.3\r\n- **Are you using a custom image**: no\r\n\r\n### Describe the problem\r\nI am trying to pass in the `eval_metrics` parameter to the `KMeans` estimator:\r\n\r\n    kmeans = KMeans(role=role,\r\n                train_instance_count=1,\r\n                train_instance_type='ml.c4.xlarge',\r\n                output_path='s3://____',              \r\n                k=3,\r\n               eval_metrics=[\"msd\", \"ssd\"])\r\n\r\nThat's the example value for `eval_metrics` used in the unit test for KMeans.  However, when I run the training job I get this error:\r\n\r\n    [06/27/2019 22:30:58 ERROR 139696703387456] Customer Error: Hyperparameter must be valid json, but found eval_metrics: (caused by ValueError)\r\n\r\n    Caused by: No JSON object could be decoded\r\n\r\nI tried several formats including `'eval_metrics': '[\\\"msd\\\",\\\"ssd\\\"]'`.\r\n\r\nHowever I am able to pass in the parameters if I use boto3:\r\n\r\n        import boto3\r\n    client = boto3.client('sagemaker')\r\n    response = client.create_training_job(\r\n        TrainingJobName='rdevalmetrics',\r\n        HyperParameters={\r\n            'feature_dim': '34',\r\n            'k': '3',\r\n            'eval_metrics': '[\\\"msd\\\",\\\"ssd\\\"]'\r\n        },\r\n        AlgorithmSpecification={\r\n            'TrainingImage': '174872318107.dkr.ecr.us-west-2.amazonaws.com/kmeans:1',\r\n            'TrainingInputMode': 'File'\r\n        },\r\n        RoleArn='arn:aws:iam::____:role/service-role/AmazonSageMaker-ExecutionRole-20180717T085401',\r\n        InputDataConfig=[\r\n            {\r\n                'ChannelName': 'train',\r\n                'DataSource': {\r\n                    'S3DataSource': {\r\n                        'S3DataType': 'ManifestFile',\r\n                        'S3Uri': 's3://sagemaker-us-west-2-____/sagemaker-record-sets/KMeans-2019-06-27-22-48-57-424/.amazon.manifest',\r\n                        'S3DataDistributionType': 'FullyReplicated'\r\n                        \r\n                    }\r\n                }\r\n                \r\n            }\r\n        ],\r\n        OutputDataConfig={\r\n            \r\n            'S3OutputPath': 's3://___/kmeanstest'\r\n        },\r\n        StoppingCondition={\r\n            'MaxRuntimeInSeconds': 600\r\n        },\r\n        ResourceConfig={\r\n            'InstanceType': 'ml.m4.xlarge',\r\n            'InstanceCount': 1,\r\n            'VolumeSizeInGB': 50,\r\n        }\r\n    )\r\n    \r\nThat job completed successfully.\r\n\r\n\r\n### Minimal repro / logs\r\n\r\nSee above code.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/889/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/889/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/820", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/820/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/820/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/820/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/820", "id": 448849583, "node_id": "MDU6SXNzdWU0NDg4NDk1ODM=", "number": 820, "title": "Batch transform fails to find container image that is present in model description", "user": {"login": "mmalahe", "id": 2665687, "node_id": "MDQ6VXNlcjI2NjU2ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/2665687?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mmalahe", "html_url": "https://github.com/mmalahe", "followers_url": "https://api.github.com/users/mmalahe/followers", "following_url": "https://api.github.com/users/mmalahe/following{/other_user}", "gists_url": "https://api.github.com/users/mmalahe/gists{/gist_id}", "starred_url": "https://api.github.com/users/mmalahe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mmalahe/subscriptions", "organizations_url": "https://api.github.com/users/mmalahe/orgs", "repos_url": "https://api.github.com/users/mmalahe/repos", "events_url": "https://api.github.com/users/mmalahe/events{/privacy}", "received_events_url": "https://api.github.com/users/mmalahe/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 850818746, "node_id": "MDU6TGFiZWw4NTA4MTg3NDY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/status:%20pending%20release", "name": "status: pending release", "color": "eee8d5", "default": false, "description": "issues for which fixes have been merged but not released to PyPI"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-05-27T13:07:52Z", "updated_at": "2019-06-04T08:15:26Z", "closed_at": "2019-06-04T08:15:26Z", "author_association": "NONE", "active_lock_reason": null, "body": "### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**: TensorFlow\r\n- **Framework Version**: 1.13.1\r\n- **Python Version**: 3.6\r\n- **CPU or GPU**: GPU\r\n- **Python SDK Version**: 1.22.0\r\n- **Are you using a custom image**: Yes\r\n\r\n### Describe the problem\r\nWhen creating a batch transform job for a model through the Python SDK, the transform operation fails on not finding the container image. This does not occur when creating a batch transform for the same model through the web interface.\r\n\r\n### Minimal repro / logs\r\nI create a model from my own custom image from the online interface. This results in a model called \"model-name\" with a single container with its image specified at \"xxxxxxxxxxxx.dkr.ecr.us-east-1.amazonaws.com/sagemaker/model-name:tag\". Now, I create a batch transform job through the Python SDK.\r\n\r\n- **Exact command to reproduce**:\r\n~~~~python\r\nfrom sagemaker.transformer import Transformer\r\ninput_dir = \"s3://some-bucket/test-input/\"\r\noutput_dir = \"s3://some-bucket/test-output/\"\r\ntransformer = \\\r\n    Transformer(model_name=\"model-name\",\r\n                instance_count=2,\r\n                instance_type='ml.p2.xlarge',\r\n                assemble_with='Line',\r\n                output_path=output_dir,\r\n                env={'ENV_VAR': 'VAL'})\r\ntransformer.transform(input_dir, data_type='S3Prefix', split_type='Line')\r\n~~~~\r\n\r\nThis results in\r\n~~~~\r\nTraceback (most recent call last):\r\n...\r\n  File \"/home/mmalahe/envs/ml/lib/python3.6/site-packages/sagemaker/transformer.py\", line 108, in transform\r\n    base_name = self.base_transform_job_name or base_name_from_image(self._retrieve_image_name())\r\n  File \"/home/mmalahe/envs/ml/lib/python3.6/site-packages/sagemaker/transformer.py\", line 126, in _retrieve_image_name\r\n    return model_desc['PrimaryContainer']['Image']\r\nKeyError: 'PrimaryContainer'\r\n~~~~\r\nThe `_retrieve_image_name` function it's looking for the \"PrimaryContainer\" key in the model description, which is not present. What is present is a key called \"Containers\", which is a list with a single entry. This entry has \"Image\" defined correctly. In a debugger:\r\n~~~~\r\nRunning 'cont' or 'step' will restart the program\r\n> /home/mmalahe/envs/ml/lib/python3.6/site-packages/sagemaker/transformer.py(126)_retrieve_image_name()\r\n-> return model_desc['PrimaryContainer']['Image']\r\n(Pdb) model_desc\r\n{'ModelName': 'model-name', 'Containers': [{'Image': 'xxxxxxxxxxxx.dkr.ecr.us-east-1.amazonaws.com/sagemaker/model-name:tag', ... }], ... }\r\n~~~~\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/820/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/820/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/778", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/778/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/778/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/778/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/778", "id": 440913604, "node_id": "MDU6SXNzdWU0NDA5MTM2MDQ=", "number": 778, "title": "airflow.py does not contain `TrainingJobEarlyStoppingType` under `HyperParameterTuningJobConfig`", "user": {"login": "abarbosa94", "id": 6608232, "node_id": "MDQ6VXNlcjY2MDgyMzI=", "avatar_url": "https://avatars.githubusercontent.com/u/6608232?v=4", "gravatar_id": "", "url": "https://api.github.com/users/abarbosa94", "html_url": "https://github.com/abarbosa94", "followers_url": "https://api.github.com/users/abarbosa94/followers", "following_url": "https://api.github.com/users/abarbosa94/following{/other_user}", "gists_url": "https://api.github.com/users/abarbosa94/gists{/gist_id}", "starred_url": "https://api.github.com/users/abarbosa94/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/abarbosa94/subscriptions", "organizations_url": "https://api.github.com/users/abarbosa94/orgs", "repos_url": "https://api.github.com/users/abarbosa94/repos", "events_url": "https://api.github.com/users/abarbosa94/events{/privacy}", "received_events_url": "https://api.github.com/users/abarbosa94/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-05-06T21:48:24Z", "updated_at": "2020-07-17T00:09:57Z", "closed_at": "2020-07-17T00:09:57Z", "author_association": "NONE", "active_lock_reason": null, "body": "Please fill out the form below.\r\n\r\n### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**: Airflow\r\n- **Framework Version**: 3.1.10\r\n- **Python Version**: 3.6.7\r\n- **CPU or GPU**: CPU\r\n\r\n\r\n### Describe the problem\r\nWhen I retrieve information about HyperparameterTuner this thows an error because tuning_config (from `sagemaker.workflow.airflow`) does not contain `TrainingJobEarlyStoppingType` under `HyperParameterTuningJobConfig`\r\n\r\n### Workaround\r\n\r\nThis is somewhat simple to solve. I produced the following workaround:\r\n```\r\n# setup an estimator                                                                                                                                                                                               \r\nestimator_c = dict_['estimator_config']                                                                                                                                                                        \r\nestimator_c[\"output_path\"] = \"s3://path                                                                                                                                       \r\nestimator_ = estimator.Estimator(**estimator_c)                                                                                                                                                                    \r\n                                                                                                                                                                                                                   \r\n# setup a hyperparameter tuner                                                                                                                                                                                     \r\ntuner_c = dict_['hyperparam_tuner_config']                                                                                                                                                                                \r\ntuner_c.update(estimator=estimator_)                                                                                                                                                                               \r\ntuner_ = tuner.HyperparameterTuner(**tuner_c)                                                                                                                                                                      \r\n                                                                                                                                                                                                                   \r\n# hyperparameter tuning configuration                                                                                                                                                                              \r\nnow_s = datetime.utcnow().strftime(\"%Y-%m-%d-%H-%M-%S\")                                                                                                                                        \r\ntuning_c = tuning_config(tuner=tuner_, inputs=inputs, job_name=job_name)                                                                                                                                           \r\ntuning_c[\"HyperParameterTuningJobConfig\"][                                                                                                                                                                         \r\n    \"TrainingJobEarlyStoppingType\"                                                                                                                                                                                 \r\n] = tuner_.early_stopping_type                                                                                                                                                                                     \r\n                                                  \r\n```\r\n\r\nSo I think it is pretty easy to solve. I tried to submit an PR but it seems that your unit test in airflow is also expecting this same behavior that do not include TrainingJobEarlyStoppingType key", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/778/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/778/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/770", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/770/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/770/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/770/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/770", "id": 438227982, "node_id": "MDU6SXNzdWU0MzgyMjc5ODI=", "number": 770, "title": "path is removed from entrypoint when using airflow operator", "user": {"login": "filthysocks", "id": 7404851, "node_id": "MDQ6VXNlcjc0MDQ4NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/7404851?v=4", "gravatar_id": "", "url": "https://api.github.com/users/filthysocks", "html_url": "https://github.com/filthysocks", "followers_url": "https://api.github.com/users/filthysocks/followers", "following_url": "https://api.github.com/users/filthysocks/following{/other_user}", "gists_url": "https://api.github.com/users/filthysocks/gists{/gist_id}", "starred_url": "https://api.github.com/users/filthysocks/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/filthysocks/subscriptions", "organizations_url": "https://api.github.com/users/filthysocks/orgs", "repos_url": "https://api.github.com/users/filthysocks/repos", "events_url": "https://api.github.com/users/filthysocks/events{/privacy}", "received_events_url": "https://api.github.com/users/filthysocks/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 814413598, "node_id": "MDU6TGFiZWw4MTQ0MTM1OTg=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/In%20progress", "name": "In progress", "color": "33E997", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-04-29T09:36:31Z", "updated_at": "2019-08-02T23:33:50Z", "closed_at": "2019-08-02T23:33:49Z", "author_association": "NONE", "active_lock_reason": null, "body": "Please fill out the form below.\r\n\r\n### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**:TensorFlow, Airflow\r\n- **Framework Version**: Airflow  1.10.1, tensorflow 1.13.1\r\n- **Python Version**: 3.7.1\r\n- **CPU or GPU**: CPU\r\n- **Python SDK Version**:1.18.11\r\n- **Are you using a custom image**:No\r\n\r\n### Describe the problem\r\nI want to use the Airflow operator 'SageMakerTrainingOperator'. When i define a path in the entypoint e.g. /my/path/to/entrypoint.py it will be converted to entrypoint.py.\r\nThis happens in the sagemaker/workkflow/airflow.py file in the function 'prepare_framework' (line 37)\r\n`script = os.path.basename(estimator.entry_point)`\r\nAccording to the documentary it should be possible to define entrypoints with relative or absolute paths.\r\n\r\n### Minimal repro / logs\r\n```python\r\nentry_path='/my/path/train.py'\r\ntf_estimator = TensorFlow(\r\n    entry_point=entry_path,\r\n    role=role,\r\n    train_instance_type='ml.m5.large',\r\n    train_instance_count=1,\r\n    framework_version='1.13.1',\r\n    py_version='py3',\r\n    model_dir='s3://some_dir'\r\n)\r\n\r\ninputs = {}\r\n\r\ntrain_config = training_config(estimator=tf_estimator, inputs=inputs)\r\nprint(train_config['HyperParameters']['sagemaker_program']) #train.py\r\nassert entry_path == train_config['HyperParameters']['sagemaker_program'] # won't work\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/770/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/770/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/755", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/755/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/755/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/755/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/755", "id": 434549223, "node_id": "MDU6SXNzdWU0MzQ1NDkyMjM=", "number": 755, "title": "Importing the sagemaker module change the logging setup", "user": {"login": "eprochasson", "id": 637354, "node_id": "MDQ6VXNlcjYzNzM1NA==", "avatar_url": "https://avatars.githubusercontent.com/u/637354?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eprochasson", "html_url": "https://github.com/eprochasson", "followers_url": "https://api.github.com/users/eprochasson/followers", "following_url": "https://api.github.com/users/eprochasson/following{/other_user}", "gists_url": "https://api.github.com/users/eprochasson/gists{/gist_id}", "starred_url": "https://api.github.com/users/eprochasson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eprochasson/subscriptions", "organizations_url": "https://api.github.com/users/eprochasson/orgs", "repos_url": "https://api.github.com/users/eprochasson/repos", "events_url": "https://api.github.com/users/eprochasson/events{/privacy}", "received_events_url": "https://api.github.com/users/eprochasson/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 850818746, "node_id": "MDU6TGFiZWw4NTA4MTg3NDY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/status:%20pending%20release", "name": "status: pending release", "color": "eee8d5", "default": false, "description": "issues for which fixes have been merged but not released to PyPI"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-04-18T01:17:56Z", "updated_at": "2019-04-24T21:13:51Z", "closed_at": "2019-04-24T21:13:51Z", "author_association": "NONE", "active_lock_reason": null, "body": "### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**: NA\r\n- **Framework Version**: NA\r\n- **Python Version**: 3.6.3\r\n- **CPU or GPU**: NA\r\n- **Python SDK Version**:  sagemaker-1.18.14.post1 (current version served by `pip install sagemaker`)\r\n- **Are you using a custom image**: no\r\n\r\n### Describe the problem\r\n\r\nSimply importing the sagemaker module alterates the logging module configuration.\r\n\r\n### Minimal repro / logs\r\nConsider the following code:\r\n\r\n```python\r\nimport logging\r\n\r\nlogging.basicConfig(level='DEBUG',\r\n                    format='%(asctime)s %(name)-12s %(levelname)-8s %(message)s',\r\n                    datefmt='%m-%d %H:%M')\r\n\r\nlogging.debug(\"debug\")\r\nlogging.info('info')\r\nlogging.error('error')\r\nlogging.warning(\"WARNING\")\r\n```\r\n\r\nWhen ran, will output:\r\n```\r\n04-18 09:15 root         DEBUG    debug\r\n04-18 09:15 root         INFO     info\r\n04-18 09:15 root         ERROR    error\r\n04-18 09:15 root         WARNING  WARNING\r\n```\r\nas expected. Now, the modified code, the only difference being the import of the sagemaker module:\r\n\r\n```python\r\nimport logging\r\nimport sagemaker\r\n\r\nlogging.basicConfig(level='DEBUG',\r\n                    format='%(asctime)s %(name)-12s %(levelname)-8s %(message)s',\r\n                    datefmt='%m-%d %H:%M')\r\n\r\nlogging.debug(\"debug\")\r\nlogging.info('info')\r\nlogging.error('error')\r\nlogging.warning(\"WARNING\")\r\n```\r\n\r\nwill output:\r\n```\r\nWARNING:root:pandas failed to import. Analytics features will be impaired or broken.\r\nERROR:root:error\r\nWARNING:root:WARNING\r\n```\r\n\r\nThe logging level and formatting has been overwritten (the warning about pandas is not the problem I'm pointing at).\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/755/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/755/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/754", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/754/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/754/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/754/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/754", "id": 434512437, "node_id": "MDU6SXNzdWU0MzQ1MTI0Mzc=", "number": 754, "title": "Unused variable LATEST_VERSION in TensorFlow estimator", "user": {"login": "mmeidl", "id": 6217488, "node_id": "MDQ6VXNlcjYyMTc0ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/6217488?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mmeidl", "html_url": "https://github.com/mmeidl", "followers_url": "https://api.github.com/users/mmeidl/followers", "following_url": "https://api.github.com/users/mmeidl/following{/other_user}", "gists_url": "https://api.github.com/users/mmeidl/gists{/gist_id}", "starred_url": "https://api.github.com/users/mmeidl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mmeidl/subscriptions", "organizations_url": "https://api.github.com/users/mmeidl/orgs", "repos_url": "https://api.github.com/users/mmeidl/repos", "events_url": "https://api.github.com/users/mmeidl/events{/privacy}", "received_events_url": "https://api.github.com/users/mmeidl/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 850818746, "node_id": "MDU6TGFiZWw4NTA4MTg3NDY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/status:%20pending%20release", "name": "status: pending release", "color": "eee8d5", "default": false, "description": "issues for which fixes have been merged but not released to PyPI"}, {"id": 892238348, "node_id": "MDU6TGFiZWw4OTIyMzgzNDg=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/type:%20documentation", "name": "type: documentation", "color": "002b36", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2019-04-17T22:27:20Z", "updated_at": "2019-04-24T21:13:34Z", "closed_at": "2019-04-24T21:13:34Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "This issue was reported by AWS customer Nishank Singla from GE Healthcare.\r\n\r\nThis is a small correction for some default variables used in the TensorFlow Estimator class.\r\n\r\nIt looks like in the TF 1.12 upgrade, someone meant to replace `TF_VERSION` with `LATEST_VERSION`: https://github.com/aws/sagemaker-python-sdk/blob/2763f9ac16cae778905dddbaa69ea63f4ae39adc/src/sagemaker/tensorflow/estimator.py#L174\r\n\r\nTF_VERSION is still set to 1.11: https://github.com/aws/sagemaker-python-sdk/blob/2763f9ac16cae778905dddbaa69ea63f4ae39adc/src/sagemaker/tensorflow/defaults.py#L15\r\n\r\nAnd LATEST_VERSION is not actually used as the default in the constructor: https://github.com/aws/sagemaker-python-sdk/blob/2763f9ac16cae778905dddbaa69ea63f4ae39adc/src/sagemaker/tensorflow/estimator.py#L231-L233", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/754/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/754/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/716", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/716/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/716/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/716/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/716", "id": 423945227, "node_id": "MDU6SXNzdWU0MjM5NDUyMjc=", "number": 716, "title": "s3_input with \"compression='Gzip', input_mode='Pipe'\" fails with ValidationError", "user": {"login": "andremoeller", "id": 5501191, "node_id": "MDQ6VXNlcjU1MDExOTE=", "avatar_url": "https://avatars.githubusercontent.com/u/5501191?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andremoeller", "html_url": "https://github.com/andremoeller", "followers_url": "https://api.github.com/users/andremoeller/followers", "following_url": "https://api.github.com/users/andremoeller/following{/other_user}", "gists_url": "https://api.github.com/users/andremoeller/gists{/gist_id}", "starred_url": "https://api.github.com/users/andremoeller/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andremoeller/subscriptions", "organizations_url": "https://api.github.com/users/andremoeller/orgs", "repos_url": "https://api.github.com/users/andremoeller/repos", "events_url": "https://api.github.com/users/andremoeller/events{/privacy}", "received_events_url": "https://api.github.com/users/andremoeller/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 993024953, "node_id": "MDU6TGFiZWw5OTMwMjQ5NTM=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/contributions%20welcome", "name": "contributions welcome", "color": "81f985", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-03-21T21:15:29Z", "updated_at": "2019-07-24T22:47:50Z", "closed_at": "2019-07-24T22:47:50Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Please fill out the form below.\r\n\r\n### System Information\r\n- **Python Version**: 3.6\r\n- **Python SDK Version**: 1.18\r\n\r\n### Describe the problem\r\n\r\nI'm trying to fit with an Estimator on Gzipped data with Pipe mode. I don't have input_mode set on the Estimator, but I do have it set in the s3_input, which should override the Estimator's input_mode:\r\n\r\nhttps://github.com/aws/sagemaker-python-sdk/blob/c2bac8fa23486469b6a27f5a82f1b4e4078a7efc/src/sagemaker/session.py#L1329-L1336\r\n\r\nMy `s3_input` is:\r\n\r\n`training_s3_input = s3_input('s3://my_training_data', compression='Gzip', input_mode='Pipe', shuffle_config=ShuffleConfig(1))`\r\n\r\nTrying to fit on an Estimator gives me back this ValidationError, even though I specify Pipe, not File:\r\n\r\n`An error occurred (ValidationException) when calling the CreateTrainingJob operation: Invalid compression type for channel training: File mode only supports NONE, got Gzip instead`\r\n\r\nSetting `input_mode='Pipe'` directly on the Estimator works as expected.", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/716/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/716/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/691", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/691/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/691/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/691/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/691", "id": 419127490, "node_id": "MDU6SXNzdWU0MTkxMjc0OTA=", "number": 691, "title": "Running multiple Transform jobs with same Transformer uses same output_path for all transform jobs", "user": {"login": "andremoeller", "id": 5501191, "node_id": "MDQ6VXNlcjU1MDExOTE=", "avatar_url": "https://avatars.githubusercontent.com/u/5501191?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andremoeller", "html_url": "https://github.com/andremoeller", "followers_url": "https://api.github.com/users/andremoeller/followers", "following_url": "https://api.github.com/users/andremoeller/following{/other_user}", "gists_url": "https://api.github.com/users/andremoeller/gists{/gist_id}", "starred_url": "https://api.github.com/users/andremoeller/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andremoeller/subscriptions", "organizations_url": "https://api.github.com/users/andremoeller/orgs", "repos_url": "https://api.github.com/users/andremoeller/repos", "events_url": "https://api.github.com/users/andremoeller/events{/privacy}", "received_events_url": "https://api.github.com/users/andremoeller/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-03-09T23:36:12Z", "updated_at": "2019-07-09T00:59:11Z", "closed_at": "2019-07-09T00:59:11Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Please fill out the form below.\r\n\r\n### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**: TensorFlow\r\n- **Framework Version**: 1.12.0\r\n- **Python Version**: 3\r\n- **CPU or GPU**: CPU\r\n- **Python SDK Version**: sagemaker==1.16.3\r\n- **Are you using a custom image**: No.\r\n\r\n### Describe the problem\r\n\r\nIf I run more than one Transform Job using a Transformer, the outputs are written to the same S3 output path, even though I'm running different transform jobs. So outputs can collide and be overwritten or I'll end up with outputs from multiple jobs in the same S3 output path\r\n\r\n### Minimal repro / logs\r\nI'm running tensorflow_batch_transform_mnist.ipynb.\r\n\r\nYou can reproduce this by doing:\r\ntransformer.transform([your batch s3 input path], content_type='text/csv')\r\nprint(transformer.output_path)\r\n\r\ntransformer.transform([some other batch s3 input path], content_type='text/csv')\r\nprint(transformer.output_path)\r\n\r\nAnd the transformer.output_path will be the same (but the jobs are different)", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/691/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/691/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/671", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/671/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/671/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/671/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/671", "id": 415663806, "node_id": "MDU6SXNzdWU0MTU2NjM4MDY=", "number": 671, "title": "Parser of framework and version from image URI does not work with TF script mode images", "user": {"login": "jonsnowseven", "id": 25992803, "node_id": "MDQ6VXNlcjI1OTkyODAz", "avatar_url": "https://avatars.githubusercontent.com/u/25992803?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonsnowseven", "html_url": "https://github.com/jonsnowseven", "followers_url": "https://api.github.com/users/jonsnowseven/followers", "following_url": "https://api.github.com/users/jonsnowseven/following{/other_user}", "gists_url": "https://api.github.com/users/jonsnowseven/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonsnowseven/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonsnowseven/subscriptions", "organizations_url": "https://api.github.com/users/jonsnowseven/orgs", "repos_url": "https://api.github.com/users/jonsnowseven/repos", "events_url": "https://api.github.com/users/jonsnowseven/events{/privacy}", "received_events_url": "https://api.github.com/users/jonsnowseven/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 13, "created_at": "2019-02-28T14:55:47Z", "updated_at": "2020-04-01T11:13:15Z", "closed_at": "2019-06-10T18:39:27Z", "author_association": "NONE", "active_lock_reason": null, "body": "### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**: TensorFlow/Neural Network\r\n- **Framework Version**: 1.12\r\n- **Python Version**: 3.6\r\n- **CPU or GPU**: CPU\r\n- **Python SDK Version**: 1.16.3 (and 1.18.3 also)\r\n- **Are you using a custom image**: No\r\n\r\n### Describe the problem\r\nhttps://github.com/aws/sagemaker-python-sdk/blob/2af36ade01fbd95cf1d1cc674a38662f71e41314/src/sagemaker/fw_utils.py#L223\r\n\r\nThis function does not parse container images in the form of \"*sagemaker-tensorflow-scriptmode*\".\r\n\r\n- **Exact command to reproduce**:\r\n\r\n```python\r\nfrom sagemaker.fw_utils import framework_name_from_image\r\n\r\nframework_name_from_image(\"520713654638.dkr.ecr.eu-west-1.amazonaws.com/sagemaker-tensorflow-scriptmode:1.12-cpu-py3\")\r\n```\r\n\r\n```\r\n(None, None, None)\r\n```", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/671/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/671/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/669", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/669/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/669/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/669/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/669", "id": 414905119, "node_id": "MDU6SXNzdWU0MTQ5MDUxMTk=", "number": 669, "title": "TensorFlow Estimator allows S3 location for source_dir, but fails requirements_file validation", "user": {"login": "mmeidl", "id": 6217488, "node_id": "MDQ6VXNlcjYyMTc0ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/6217488?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mmeidl", "html_url": "https://github.com/mmeidl", "followers_url": "https://api.github.com/users/mmeidl/followers", "following_url": "https://api.github.com/users/mmeidl/following{/other_user}", "gists_url": "https://api.github.com/users/mmeidl/gists{/gist_id}", "starred_url": "https://api.github.com/users/mmeidl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mmeidl/subscriptions", "organizations_url": "https://api.github.com/users/mmeidl/orgs", "repos_url": "https://api.github.com/users/mmeidl/repos", "events_url": "https://api.github.com/users/mmeidl/events{/privacy}", "received_events_url": "https://api.github.com/users/mmeidl/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 993024953, "node_id": "MDU6TGFiZWw5OTMwMjQ5NTM=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/contributions%20welcome", "name": "contributions welcome", "color": "81f985", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-02-27T01:46:26Z", "updated_at": "2019-07-24T23:12:10Z", "closed_at": "2019-07-24T23:12:10Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Opening this issue on behalf of a SageMaker customer. The customer has pre-compressed and uploaded their `source_dir` to S3, and wants to set `requirements_file` to a relative path contained in the source.\r\n\r\nThe generic Frameworks Estimator allows `source_dir` to be an S3 location. In this case it skips validation/upload.\r\nSkipping `source_dir` validation:\r\nhttps://github.com/aws/sagemaker-python-sdk/blob/8b33a305110997e18b1f2f2a37b2d3cdd98b2f91/src/sagemaker/estimator.py#L830-L833\r\nSkipping `source_dir` upload:\r\nhttps://github.com/aws/sagemaker-python-sdk/blob/8b33a305110997e18b1f2f2a37b2d3cdd98b2f91/src/sagemaker/fw_utils.py#L143-L144\r\n\r\nHowever the Tensorflow Estimator runs a validation for `requirements_file` which fails if the location `source_dir/requirements_file` is not a valid path on the local os: \r\nhttps://github.com/aws/sagemaker-python-sdk/blob/8b33a305110997e18b1f2f2a37b2d3cdd98b2f91/src/sagemaker/tensorflow/estimator.py#L273-L285\r\n\r\nSeems like it would be easy to skip the local path validation if `source_dir` is an S3 location. Something like this could be added to `_validate_requirements_file`:\r\n```\r\nif source_dir.lower().startswith('s3://'):\r\n  return\r\n```\r\n\r\nI know that support for `requirements.txt` files is limited between the \"legacy\" TensorFlow container and the newer \"script mode\" version. But this is a small bug in the SDK which could easily be fixed.", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/669/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/669/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/668", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/668/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/668/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/668/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/668", "id": 414811496, "node_id": "MDU6SXNzdWU0MTQ4MTE0OTY=", "number": 668, "title": "Using \"tensorflow-serving\" with Batch Transform", "user": {"login": "andremoeller", "id": 5501191, "node_id": "MDQ6VXNlcjU1MDExOTE=", "avatar_url": "https://avatars.githubusercontent.com/u/5501191?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andremoeller", "html_url": "https://github.com/andremoeller", "followers_url": "https://api.github.com/users/andremoeller/followers", "following_url": "https://api.github.com/users/andremoeller/following{/other_user}", "gists_url": "https://api.github.com/users/andremoeller/gists{/gist_id}", "starred_url": "https://api.github.com/users/andremoeller/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andremoeller/subscriptions", "organizations_url": "https://api.github.com/users/andremoeller/orgs", "repos_url": "https://api.github.com/users/andremoeller/repos", "events_url": "https://api.github.com/users/andremoeller/events{/privacy}", "received_events_url": "https://api.github.com/users/andremoeller/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-02-26T20:47:43Z", "updated_at": "2019-09-25T20:29:01Z", "closed_at": "2019-09-25T20:29:01Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Please fill out the form below.\r\n\r\n### System Information\r\n* **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**: N/A: TensorFlow Serving\r\n* **Framework Version**: N/A\r\n* **Python Version**: 3.5\r\n* **CPU or GPU**: CPU\r\n* **Python SDK Version**: 1.18.3\r\n* **Are you using a custom image**: No\r\n\r\n### Describe the problem\r\nIs there a way to use the \"tensorflow-serving\" endpoint type for Batch (or a reason this can't or shouldn't be done)?\r\n\r\nWould implementing this mostly be a matter of adding an endpoint_type parameter to def transform()?\r\n\r\nThanks!", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/668/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/668/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/649", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/649/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/649/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/649/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/649", "id": 411712467, "node_id": "MDU6SXNzdWU0MTE3MTI0Njc=", "number": 649, "title": "local mode batch transform does not work with predefined SageMaker model", "user": {"login": "ChoiByungWook", "id": 12059958, "node_id": "MDQ6VXNlcjEyMDU5OTU4", "avatar_url": "https://avatars.githubusercontent.com/u/12059958?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ChoiByungWook", "html_url": "https://github.com/ChoiByungWook", "followers_url": "https://api.github.com/users/ChoiByungWook/followers", "following_url": "https://api.github.com/users/ChoiByungWook/following{/other_user}", "gists_url": "https://api.github.com/users/ChoiByungWook/gists{/gist_id}", "starred_url": "https://api.github.com/users/ChoiByungWook/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ChoiByungWook/subscriptions", "organizations_url": "https://api.github.com/users/ChoiByungWook/orgs", "repos_url": "https://api.github.com/users/ChoiByungWook/repos", "events_url": "https://api.github.com/users/ChoiByungWook/events{/privacy}", "received_events_url": "https://api.github.com/users/ChoiByungWook/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-02-19T02:09:29Z", "updated_at": "2020-03-04T12:53:17Z", "closed_at": "2019-02-25T22:50:11Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Please fill out the form below.\r\n\r\n### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**:\r\n- **Framework Version**:\r\n- **Python Version**:  3.6\r\n- **CPU or GPU**: cpu\r\n- **Python SDK Version**: 1.18.1\r\n- **Are you using a custom image**: no\r\n\r\n### Describe the problem\r\nPassing a LocalSession into a Transformer object with a model_name that already exists within SageMaker fails, as the _retrieve_image_name function call to sagemaker_client.describe_model is done within the local_session class, which doesn't account for models outside of local mode.\r\n\r\n### Minimal repro / logs\r\nClientErrorTraceback (most recent call last)\r\n<ipython-input-13-036761a38d08> in <module>()\r\n     19     's3-input',\r\n     20     content_type='text/csv',\r\n---> 21     split_type='Line'\r\n     22 )\r\n\r\n/home/ec2-user/anaconda3/envs/tensorflow_p27/lib/python2.7/site-packages/sagemaker/transformer.pyc in transform(self, data, data_type, content_type, compression_type, split_type, job_name)\r\n    104             self._current_job_name = job_name\r\n    105         else:\r\n--> 106             base_name = self.base_transform_job_name or base_name_from_image(self._retrieve_image_name())\r\n    107             self._current_job_name = name_from_base(base_name)\r\n    108 \r\n\r\n/home/ec2-user/anaconda3/envs/tensorflow_p27/lib/python2.7/site-packages/sagemaker/transformer.pyc in _retrieve_image_name(self)\r\n    114 \r\n    115     def _retrieve_image_name(self):\r\n--> 116         model_desc = self.sagemaker_session.sagemaker_client.describe_model(ModelName=self.model_name)\r\n    117         return model_desc['PrimaryContainer']['Image']\r\n    118 \r\n\r\n/home/ec2-user/anaconda3/envs/tensorflow_p27/lib/python2.7/site-packages/sagemaker/local/local_session.pyc in describe_model(self, ModelName)\r\n    116         if ModelName not in LocalSagemakerClient._models:\r\n    117             error_response = {'Error': {'Code': 'ValidationException', 'Message': 'Could not find local model'}}\r\n--> 118             raise ClientError(error_response, 'describe_model')\r\n    119         else:\r\n    120             return LocalSagemakerClient._models[ModelName].describe()\r\n\r\nClientError: An error occurred (ValidationException) when calling the describe_model operation: Could not find local model\r\n\r\n- **Exact command to reproduce**:\r\n\r\nfrom sagemaker.transformer import Transformer\r\nfrom sagemaker.local import LocalSession\r\n\r\n\r\nlocal_session = LocalSession()\r\n\r\nt = Transformer(\r\n    model_name='model-existing-in-sagemaker',\r\n    instance_count=1,\r\n    instance_type='ml.m5.4xlarge',\r\n    strategy='MultiRecord',\r\n    max_payload=1,\r\n    env={'SAGEMAKER_TFS_GRPC_REQUEST_TIMEOUT': '300'},\r\n    max_concurrent_transforms=1,\r\n    sagemaker_session=local_session\r\n)\r\n\r\nt.transform(\r\n    's3-input',\r\n    content_type='text/csv',\r\n    split_type='Line'\r\n)", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/649/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/649/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/645", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/645/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/645/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/645/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/645", "id": 410673395, "node_id": "MDU6SXNzdWU0MTA2NzMzOTU=", "number": 645, "title": "CreateTrainingJob operation (reached max retries: 4): Rate exceeded ", "user": {"login": "coder2j", "id": 10175658, "node_id": "MDQ6VXNlcjEwMTc1NjU4", "avatar_url": "https://avatars.githubusercontent.com/u/10175658?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coder2j", "html_url": "https://github.com/coder2j", "followers_url": "https://api.github.com/users/coder2j/followers", "following_url": "https://api.github.com/users/coder2j/following{/other_user}", "gists_url": "https://api.github.com/users/coder2j/gists{/gist_id}", "starred_url": "https://api.github.com/users/coder2j/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coder2j/subscriptions", "organizations_url": "https://api.github.com/users/coder2j/orgs", "repos_url": "https://api.github.com/users/coder2j/repos", "events_url": "https://api.github.com/users/coder2j/events{/privacy}", "received_events_url": "https://api.github.com/users/coder2j/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2019-02-15T09:18:33Z", "updated_at": "2022-04-28T16:44:54Z", "closed_at": "2019-07-24T23:18:37Z", "author_association": "NONE", "active_lock_reason": null, "body": "Please fill out the form below.\r\n\r\n### System Information\r\n- **Framework (e.g. Sklearn) / Algorithm (e.g. Gradient boosting)**:\r\n- **Framework Version**: 0.19.2\r\n- **Python Version**: Python 3.6.6\r\n- **CPU or GPU**: CPU\r\n- **Python SDK Version**: 1.18.2\r\n- **Are you using a custom image**: No\r\n\r\n### Describe the problem\r\nI come across the API exceed rate error frequently. I run multiple jobs in parallel on the instance which has a max-parallel job of 20. I use python Pool to trigger it with maximum process of 5, and I got the exception code like following:\r\n\r\nbotocore.exceptions.ClientError: An error occurred (ThrottlingException) when calling the CreateTrainingJob operation (reached max retries: 4): Rate exceeded \r\n\r\n\r\n\r\n\r\n### Minimal repro / logs\r\nPlease provide any logs and a bare minimum reproducible test case, as this will be helpful to diagnose the problem. If including tracebacks, please include the full traceback. Large logs and files should be attached.\r\n\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3.6/multiprocessing/pool.py\", line 119, in worker\r\n    result = (True, func(*args, **kwds))\r\n  File \"/usr/lib/python3.6/multiprocessing/pool.py\", line 47, in starmapstar\r\n    return list(itertools.starmap(args[0], args[1]))\r\n  File \"../sgmk_utils.py\", line 225, in wait_sgmaker_job_success_description\r\n    job_name = sgmaker_train(config) if is_train else sgmaker_tune(config)\r\n  File \"../sgmk_utils.py\", line 163, in sgmaker_train\r\n    estimator.fit({'training': job_meta['input-path']}, wait)\r\n  File \"/home/secret/Documents/secret/env36/lib/python3.6/site-packages/sagemaker/estimator.py\", line 236, in fit\r\n    self.latest_training_job = _TrainingJob.start_new(self, inputs)\r\n  File \"/home/secret/Documents/secret/env36/lib/python3.6/site-packages/sagemaker/estimator.py\", line 578, in start_new\r\n    estimator.sagemaker_session.train(**train_args)\r\n  File \"/home/secret/Documents/secret/env36/lib/python3.6/site-packages/sagemaker/session.py\", line 320, in train\r\n    self.sagemaker_client.create_training_job(**train_request)\r\n  File \"/home/secret/Documents/secret/env36/lib/python3.6/site-packages/botocore/client.py\", line 320, in _api_call\r\n    return self._make_api_call(operation_name, kwargs)\r\n  File \"/home/secret/Documents/secret/env36/lib/python3.6/site-packages/botocore/client.py\", line 624, in _make_api_call\r\n    raise error_class(parsed_response, operation_name)\r\nbotocore.exceptions.ClientError: An error occurred (ThrottlingException) when calling the CreateTrainingJob operation (reached max retries: 4): Rate exceeded\r\n\"\"\"\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"learn_cli.py\", line 28, in <module>\r\n    cli()\r\n  File \"/home/secret/Documents/secret/env36/lib/python3.6/site-packages/click/core.py\", line 722, in __call__\r\n    return self.main(*args, **kwargs)\r\n  File \"/home/secret/Documents/secret/env36/lib/python3.6/site-packages/click/core.py\", line 697, in main\r\n    rv = self.invoke(ctx)\r\n  File \"/home/secret/Documents/secret/env36/lib/python3.6/site-packages/click/core.py\", line 1066, in invoke\r\n    return _process_result(sub_ctx.command.invoke(sub_ctx))\r\n  File \"/home/secret/Documents/secret/env36/lib/python3.6/site-packages/click/core.py\", line 1066, in invoke\r\n    return _process_result(sub_ctx.command.invoke(sub_ctx))\r\n  File \"/home/secret/Documents/secret/env36/lib/python3.6/site-packages/click/core.py\", line 895, in invoke\r\n    return ctx.invoke(self.callback, **ctx.params)\r\n  File \"/home/secret/Documents/secret/env36/lib/python3.6/site-packages/click/core.py\", line 535, in invoke\r\n    return callback(*args, **kwargs)\r\n  File \"../run_sagemaker.py\", line 60, in rolling_window_experiment\r\n    sgmk_utils.rolling_window_experiment_handler(config)\r\n  File \"../sgmk_utils.py\", line 398, in rolling_window_experiment_handler\r\n    job_metrics_estimator, train_jobs = rolling_window_experiment(estimator_config)\r\n  File \"../sgmk_utils.py\", line 382, in rolling_window_experiment\r\n    [(config, True, 30) for config in final_train_configs])\r\n  File \"/usr/lib/python3.6/multiprocessing/pool.py\", line 296, in starmap\r\n    return self._map_async(func, iterable, starmapstar, chunksize).get()\r\n  File \"/usr/lib/python3.6/multiprocessing/pool.py\", line 670, in get\r\n    raise self._value\r\nbotocore.exceptions.ClientError: An error occurred (ThrottlingException) when calling the CreateTrainingJob operation (reached max retries: 4): Rate exceeded\r\n\r\n- **Exact command to reproduce**:\r\nwith Pool(processes=min(5, len(final_train_configs))) as p:\r\n        results = p.starmap(wait_sgmaker_job_success_description,\r\n                            [(config, True, 40) for config in final_train_configs])", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/645/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/645/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/635", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/635/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/635/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/635/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/635", "id": 408333367, "node_id": "MDU6SXNzdWU0MDgzMzMzNjc=", "number": 635, "title": "Batch Transform not working with TensorFlow", "user": {"login": "zjost", "id": 9660566, "node_id": "MDQ6VXNlcjk2NjA1NjY=", "avatar_url": "https://avatars.githubusercontent.com/u/9660566?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zjost", "html_url": "https://github.com/zjost", "followers_url": "https://api.github.com/users/zjost/followers", "following_url": "https://api.github.com/users/zjost/following{/other_user}", "gists_url": "https://api.github.com/users/zjost/gists{/gist_id}", "starred_url": "https://api.github.com/users/zjost/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zjost/subscriptions", "organizations_url": "https://api.github.com/users/zjost/orgs", "repos_url": "https://api.github.com/users/zjost/repos", "events_url": "https://api.github.com/users/zjost/events{/privacy}", "received_events_url": "https://api.github.com/users/zjost/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-02-08T21:36:52Z", "updated_at": "2019-11-05T01:29:45Z", "closed_at": "2019-02-19T20:18:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "\r\n### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**:  TensorFlow\r\n- **Framework Version**: 1.11\r\n- **Python Version**:  2.7\r\n- **CPU or GPU**:  CPU\r\n- **Python SDK Version**:    1.18.2\r\n- **Are you using a custom image**:  No\r\n\r\n### Describe the problem\r\nBatch transform does not appear to create batches from input data.  This seems to cause the serving request to fail due to either timeout or resource exhaustion.\r\n\r\n### Minimal repro / logs\r\n```\r\n[2019-02-08 21:13:46,043] ERROR in serving: <_Rendezvous of RPC that terminated with:\r\n#011status = StatusCode.RESOURCE_EXHAUSTED\r\n#011details = \"Received message larger than max (170662612 vs. 4194304)\"\r\n#011debug_error_string = \"\r\n{\r\n    \"created\": \"@1549660426.041906580\",\r\n    \"description\": \"Received message larger than max (170662612 vs. 4194304)\",\r\n    \"file\": \"src/core/ext/filters/message_size/message_size_filter.cc\",\r\n    \"file_line\": 174,\r\n    \"grpc_status\": 8\r\n}\r\n\"\r\n>\r\nTraceback (most recent call last):\r\nFile \"/usr/local/lib/python2.7/dist-packages/container_support/serving.py\", line 221, in _invoke\r\nself.transformer.transform(content, input_content_type, requested_output_content_type)\r\nFile \"/usr/local/lib/python2.7/dist-packages/tf_container/serve.py\", line 297, in transform\r\nreturn self.transform_fn(data, content_type, accepts), accepts\r\nFile \"/usr/local/lib/python2.7/dist-packages/tf_container/serve.py\", line 224, in f\r\nprediction = self.predict_fn(input)\r\nFile \"/usr/local/lib/python2.7/dist-packages/tf_container/serve.py\", line 239, in predict_fn\r\nreturn self.proxy_client.request(data)\r\nFile \"/usr/local/lib/python2.7/dist-packages/tf_container/proxy_client.py\", line 82, in request\r\nreturn request_fn(data)\r\nFile \"/usr/local/lib/python2.7/dist-packages/tf_container/proxy_client.py\", line 110, in predict\r\nresult = self.prediction_service_stub.Predict(request, self.request_timeout)\r\nFile \"/usr/local/lib/python2.7/dist-packages/grpc/_channel.py\", line 550, in __call__\r\nreturn _end_unary_response_blocking(state, call, False, None)\r\nFile \"/usr/local/lib/python2.7/dist-packages/grpc/_channel.py\", line 467, in _end_unary_response_blocking\r\nraise _Rendezvous(state, None, None, deadline)\r\n```\r\n\r\n- **Exact command to reproduce**:\r\n```\r\nt = estimator.transformer(\r\n    1, \r\n    'ml.m5.4xlarge', \r\n    strategy='MultiRecord', \r\n    output_path='s3://<bucket>/<key>', \r\n    max_payload=1, \r\n    role='<role>', \r\n    env={'SAGEMAKER_TFS_GRPC_REQUEST_TIMEOUT': '300'}, \r\n    max_concurrent_transforms=1\r\n)\r\nt.transform(\r\n    's3://<bucket>/<input_file.csv>', \r\n    content_type='text/csv', \r\n    split_type='Line', \r\n    job_name='<job_name>'\r\n)\r\n```\r\nIf I do not include the `env={'SAGEMAKER_TFS_GRPC_REQUEST_TIMEOUT': '300'}`, then I get a timeout error.  If I do include it, I get a `RESOURCE_EXHAUSTED` error.  \r\n\r\nMy `input_fn` looks like:\r\n```\r\ndef input_fn(serialized_input, content_type):\r\n    if content_type == 'text/csv':\r\n        rows = list()\r\n        csv_buff = StringIO(serialized_input)\r\n        csv_to_parse = csv.reader(csv_buff, delimiter=',')\r\n        for row in csv_to_parse:\r\n            rows.append(row[0])\r\n        data = {\"input\": rows}\r\n        # Goes on to create predict_pb2.PredictRequest(), which works as intended with inference\r\n```\r\n\r\nI can confirm that this works when I manually invoke the endpoint with multiple records using `text/csv` and the csv_serializer.  \r\n\r\n### Questions\r\n1. Why is the message so large?  The entire file, uncompressed, is an 8.6 MB csv file.  I have requested a max payload size of 1 MB and 1 max concurrent transforms.  Why is TensorFlow serving reporting a message size of 170662612?  It seems like this message size is larger than my entire file.  My file is two columns: <str>,<int>, where <str> is model input and <int> is label.\r\n2.  How does the transform service decide how to split a single input csv file into batches?\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/635/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/635/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/633", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/633/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/633/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/633/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/633", "id": 408204007, "node_id": "MDU6SXNzdWU0MDgyMDQwMDc=", "number": 633, "title": "Inconsistent SKLearn image lookup causing image pull permission error", "user": {"login": "zjost", "id": 9660566, "node_id": "MDQ6VXNlcjk2NjA1NjY=", "avatar_url": "https://avatars.githubusercontent.com/u/9660566?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zjost", "html_url": "https://github.com/zjost", "followers_url": "https://api.github.com/users/zjost/followers", "following_url": "https://api.github.com/users/zjost/following{/other_user}", "gists_url": "https://api.github.com/users/zjost/gists{/gist_id}", "starred_url": "https://api.github.com/users/zjost/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zjost/subscriptions", "organizations_url": "https://api.github.com/users/zjost/orgs", "repos_url": "https://api.github.com/users/zjost/repos", "events_url": "https://api.github.com/users/zjost/events{/privacy}", "received_events_url": "https://api.github.com/users/zjost/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 850818746, "node_id": "MDU6TGFiZWw4NTA4MTg3NDY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/status:%20pending%20release", "name": "status: pending release", "color": "eee8d5", "default": false, "description": "issues for which fixes have been merged but not released to PyPI"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-02-08T15:36:15Z", "updated_at": "2019-02-15T03:43:26Z", "closed_at": "2019-02-15T03:43:25Z", "author_association": "NONE", "active_lock_reason": null, "body": "Please fill out the form below.\r\n\r\n### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**:  Sci-kit Learn\r\n- **Framework Version**:  0.20.0\r\n- **Python Version**:  2.7\r\n- **CPU or GPU**:  CPU\r\n- **Python SDK Version**:  1.18.2\r\n- **Are you using a custom image**:  No\r\n\r\n### Describe the problem\r\nI am trying to deploy a previously trained SKLearn model.  Training works fine when using the SDK.  However, when using the `SKLearnModel` class, a different account id is used for the base image.  This fails deployment with the error: \r\n```botocore.exceptions.ClientError: An error occurred (ValidationException) when calling the CreateModel operation: Role <my_role_arn> cannot pull 520713654638.dkr.ecr.us-east-1.amazonaws.com/sagemaker-scikit-learn:0.20.0-cpu-py3. Ensure that the role exists and the image was granted pull permission.```\r\n\r\n### Minimal repro / logs\r\n#### Train model\r\n```\r\nfrom sagemaker.sklearn.estimator import SKLearn\r\nfrom sagemaker import s3_input\r\nchannel = {\r\n        'training': s3_input(s3_training_key),\r\n}\r\n\r\nskl = SKLearn(\r\n        entry_point='./model.py',\r\n        role=role,\r\n        train_instance_type=\"ml.c4.xlarge\",\r\n        train_instance_count=1,\r\n        output_path=s3_output_prefix,\r\n        base_job_name=job_name,\r\n)\r\n\r\nskl.fit(\r\n        inputs=channel,\r\n        job_name=job_name,\r\n)\r\n```\r\n#### Create Model and deploy\r\n```\r\nimport sagemaker\r\nfrom sagemaker.sklearn.model import SKLearnModel\r\n\r\nestim = sagemaker.estimator.Estimator.attach(job_name)\r\nestim_data = str(estim.model_data)\r\n\r\nmodel = SKLearnModel(\r\n        model_data=estim_data,\r\n        role=role,\r\n        entry_point='./model.py',\r\n        name=job_name\r\n)\r\n\r\nmodel.deploy(\r\n            initial_instance_count=1,\r\n            instance_type=instance_type,\r\n            endpoint_name=endpoint_name,\r\n)\r\n```\r\n\r\n- **Exact command to reproduce**:\r\nThe call to `deploy` is what gives the error.  I think the problem comes from the account inconsistency between [`fw_utils`](https://github.com/aws/sagemaker-python-sdk/blob/db1876d0191e831fc397a00a633f7080e94d44ca/src/sagemaker/fw_utils.py#L47) and [`fw_registry`](https://github.com/aws/sagemaker-python-sdk/blob/db1876d0191e831fc397a00a633f7080e94d44ca/src/sagemaker/fw_registry.py#L27).  It seems that the `Estimator` class uses [`fw_registry.default_framework_uri`](https://github.com/aws/sagemaker-python-sdk/blob/db1876d0191e831fc397a00a633f7080e94d44ca/src/sagemaker/sklearn/estimator.py#L18) whereas the `SKLearnModel` class uses [`fw_utils.create_image_uri`](https://github.com/aws/sagemaker-python-sdk/blob/db1876d0191e831fc397a00a633f7080e94d44ca/src/sagemaker/sklearn/model.py#L16).  The error indicates that account id = 520713654638 is the problem, which is the default value of `create_image_uri`.  \r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/633/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/633/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/632", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/632/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/632/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/632/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/632", "id": 408135186, "node_id": "MDU6SXNzdWU0MDgxMzUxODY=", "number": 632, "title": "Sagemaker distributed xgboost error when reading LIBSVM files", "user": {"login": "gediminaszylius", "id": 18482669, "node_id": "MDQ6VXNlcjE4NDgyNjY5", "avatar_url": "https://avatars.githubusercontent.com/u/18482669?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gediminaszylius", "html_url": "https://github.com/gediminaszylius", "followers_url": "https://api.github.com/users/gediminaszylius/followers", "following_url": "https://api.github.com/users/gediminaszylius/following{/other_user}", "gists_url": "https://api.github.com/users/gediminaszylius/gists{/gist_id}", "starred_url": "https://api.github.com/users/gediminaszylius/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gediminaszylius/subscriptions", "organizations_url": "https://api.github.com/users/gediminaszylius/orgs", "repos_url": "https://api.github.com/users/gediminaszylius/repos", "events_url": "https://api.github.com/users/gediminaszylius/events{/privacy}", "received_events_url": "https://api.github.com/users/gediminaszylius/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-02-08T12:39:01Z", "updated_at": "2019-07-24T23:18:45Z", "closed_at": "2019-07-24T23:18:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "### System Information\r\n- **Framework: xgboost**:\r\n- **Framework Version: latest on 2019-02-01**:\r\n- **Python Version: 3.6**:\r\n- **CPU or GPU: cpu**:\r\n- **Python SDK Version: sagemaker version 1.17.2 (installed via pip)**:\r\n- **Are you using a custom image: no**:\r\n\r\n### Describe the problem\r\nI'm getting following xgboost error on sagemaker when i train on LIBSVM formatted data in s3:\r\n`\r\nValueError: Error for Training job xgboost-2019-02-01-09-57-04-694: Failed Reason: ClientError: Failed to load libsvm data with exception:\r\n[10:07:07] src/data/./row_block.h:177: Check failed: offset.back() == value.size() || value.size() == 0 \r\n`\r\nBut this happens randomly in distributed mode (sometimes i get it sometimes i dont and model trains normally) and i have noticed that it never happens when i use single instance instead of multiple ones (in single node mode, not in distributed) in Sagemaker, even though training and validation datasets are the same.\r\n\r\nI have checked xgboost of similar errors and I have found mentioned that some bad values may exist in files, but after training locally on my EC2 server and in Sagemaker on single node xgboost trains normally. So i suspect this may be distributed xgboost backend issue.\r\n### Minimal code\r\n\r\ninstance_type='ml.m5.4xlarge'\r\ninstance_count=3\r\ndisk_for_data_download_size=200\r\n\r\ncontainer = get_image_uri(boto3.Session().region_name, 'xgboost',repo_version='latest')\r\n\r\ns3_input_train = sagemaker.s3_input(s3_data=train_data, content_type='libsvm')\r\ns3_input_test = sagemaker.s3_input(s3_data=val_data, content_type='libsvm')\r\n\r\nsess = sagemaker.Session()\r\n\r\nxgb = sagemaker.estimator.Estimator(container,\r\n                                    iam_role, \r\n                                    train_instance_count=instance_count, \r\n                                    train_instance_type=instance_type,\r\n                                    output_path=output_model,\r\n                                    train_volume_size=disk_for_data_download_size,\r\n                                    sagemaker_session=sess)\r\n\r\nxgb.set_hyperparameters(max_depth=15,\r\n                        eta=0.1,\r\n                        silent=1,\r\n                        objective='reg:logistic',\r\n                        booster='gbtree',\r\n                        min_child_weight=100,\r\n                        eval_metric='auc',\r\n                        num_round=300,\r\n                        early_stopping_rounds=50\r\n                        )\r\n\r\nxgb.fit({'train': s3_input_train,'validation': s3_input_test})\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/632/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/632/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/593", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/593/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/593/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/593/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/593", "id": 397569197, "node_id": "MDU6SXNzdWUzOTc1NjkxOTc=", "number": 593, "title": "the model from sagemaker neo compilation can not be used in raspberry pi", "user": {"login": "fast4break", "id": 23101626, "node_id": "MDQ6VXNlcjIzMTAxNjI2", "avatar_url": "https://avatars.githubusercontent.com/u/23101626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fast4break", "html_url": "https://github.com/fast4break", "followers_url": "https://api.github.com/users/fast4break/followers", "following_url": "https://api.github.com/users/fast4break/following{/other_user}", "gists_url": "https://api.github.com/users/fast4break/gists{/gist_id}", "starred_url": "https://api.github.com/users/fast4break/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fast4break/subscriptions", "organizations_url": "https://api.github.com/users/fast4break/orgs", "repos_url": "https://api.github.com/users/fast4break/repos", "events_url": "https://api.github.com/users/fast4break/events{/privacy}", "received_events_url": "https://api.github.com/users/fast4break/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-01-09T21:27:03Z", "updated_at": "2019-02-25T15:33:44Z", "closed_at": "2019-02-25T15:33:44Z", "author_association": "NONE", "active_lock_reason": null, "body": "Please fill out the form below.\r\n\r\n### System Information\r\n- **Framework (e.g. MXNET)**: MXNET\r\n- **Framework Version**:lastest\r\n- **Python Version**: 2.7\r\n- **CPU or GPU**: CPU\r\n- **Python SDK Version**: latest\r\n- **Are you using a custom image**: no\r\n\r\n### Describe the problem\r\nFollowing the steps in https://docs.aws.amazon.com/sagemaker/latest/dg/neo-job-compilation-cli.html to convert a MXNET resnet50 model to one for Raspberry pi 3B.  All steps passsed except the final rasp3pi model can not predict a meaningful result.\r\nOriginal mnxet model: http://data.dmlc.ml/models/imagenet/resnet/50-layers/\r\nCompilation scripts and testing code: https://aws.amazon.com/blogs/aws/amazon-sagemaker-neo-train-your-machine-learning-models-once-run-them-anywhere/\r\nTesting image: /dlr-1.0-py2-armv7l/tests/dog.npy\r\n[IF use resnet50 model under /dlr-1.0-py2-armv7l/models, the result is good.]\r\n\r\n### Minimal repro / logs\r\nThe testing code output following log:\r\n(1, 3, 224, 224)\r\n/usr/local/lib/python2.7/dist-packages/numpy/core/_methods.py:26: RuntimeWarning: invalid value encountered in reduce\r\n  return umr_maximum(a, axis, None, out, keepdims)\r\nInference result: \"tench, Tinca tinca\" with probability nan.\r\n\r\n- **Exact command to reproduce**:\r\nfollow steps in \r\nhttps://docs.aws.amazon.com/sagemaker/latest/dg/neo-job-compilation-cli.html\r\nwith models in http://data.dmlc.ml/models/imagenet/resnet/", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/593/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/593/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/563", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/563/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/563/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/563/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/563", "id": 391493138, "node_id": "MDU6SXNzdWUzOTE0OTMxMzg=", "number": 563, "title": "DeepAR cardinality with empty string is not honored", "user": {"login": "ChandraLingam", "id": 20747492, "node_id": "MDQ6VXNlcjIwNzQ3NDky", "avatar_url": "https://avatars.githubusercontent.com/u/20747492?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ChandraLingam", "html_url": "https://github.com/ChandraLingam", "followers_url": "https://api.github.com/users/ChandraLingam/followers", "following_url": "https://api.github.com/users/ChandraLingam/following{/other_user}", "gists_url": "https://api.github.com/users/ChandraLingam/gists{/gist_id}", "starred_url": "https://api.github.com/users/ChandraLingam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ChandraLingam/subscriptions", "organizations_url": "https://api.github.com/users/ChandraLingam/orgs", "repos_url": "https://api.github.com/users/ChandraLingam/repos", "events_url": "https://api.github.com/users/ChandraLingam/events{/privacy}", "received_events_url": "https://api.github.com/users/ChandraLingam/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 749522466, "node_id": "MDU6TGFiZWw3NDk1MjI0NjY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/type:%20question", "name": "type: question", "color": "d876e3", "default": false, "description": ""}, {"id": 892238348, "node_id": "MDU6TGFiZWw4OTIyMzgzNDg=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/type:%20documentation", "name": "type: documentation", "color": "002b36", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": {"login": "ericangelokim", "id": 39601338, "node_id": "MDQ6VXNlcjM5NjAxMzM4", "avatar_url": "https://avatars.githubusercontent.com/u/39601338?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ericangelokim", "html_url": "https://github.com/ericangelokim", "followers_url": "https://api.github.com/users/ericangelokim/followers", "following_url": "https://api.github.com/users/ericangelokim/following{/other_user}", "gists_url": "https://api.github.com/users/ericangelokim/gists{/gist_id}", "starred_url": "https://api.github.com/users/ericangelokim/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ericangelokim/subscriptions", "organizations_url": "https://api.github.com/users/ericangelokim/orgs", "repos_url": "https://api.github.com/users/ericangelokim/repos", "events_url": "https://api.github.com/users/ericangelokim/events{/privacy}", "received_events_url": "https://api.github.com/users/ericangelokim/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "ericangelokim", "id": 39601338, "node_id": "MDQ6VXNlcjM5NjAxMzM4", "avatar_url": "https://avatars.githubusercontent.com/u/39601338?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ericangelokim", "html_url": "https://github.com/ericangelokim", "followers_url": "https://api.github.com/users/ericangelokim/followers", "following_url": "https://api.github.com/users/ericangelokim/following{/other_user}", "gists_url": "https://api.github.com/users/ericangelokim/gists{/gist_id}", "starred_url": "https://api.github.com/users/ericangelokim/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ericangelokim/subscriptions", "organizations_url": "https://api.github.com/users/ericangelokim/orgs", "repos_url": "https://api.github.com/users/ericangelokim/repos", "events_url": "https://api.github.com/users/ericangelokim/events{/privacy}", "received_events_url": "https://api.github.com/users/ericangelokim/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 11, "created_at": "2018-12-16T18:34:30Z", "updated_at": "2018-12-20T16:46:41Z", "closed_at": "2018-12-20T16:46:41Z", "author_association": "NONE", "active_lock_reason": null, "body": "Please fill out the form below.\r\n\r\n### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**: SageMaker/DeepAR\r\n- **Framework Version**: sagemaker notebook instance\r\n- **Python Version**: conda_python3\r\n- **CPU or GPU**: CPU\r\n- **Python SDK Version**:  conda_python3\r\n- **Are you using a custom image**: No\r\n\r\n### Describe the problem\r\nI have a DeepAR training set in JSON format.  It has \"cat\" field specified as part of time series.\r\nI wanted to train two models: one using categories and another without categories.\r\n\r\nAccording to sagemaker DeepAR hyperparameters document, I can control training process to use or ignore categories using **cardinality** hyperparameter.\r\n\r\nI specified these hyperparameters as part of the job\r\n`{'time_freq': 'H',\r\n 'epochs': '400',\r\n 'early_stopping_patience': '40',\r\n 'mini_batch_size': '64',\r\n 'learning_rate': '5E-4',\r\n 'context_length': '288',\r\n 'prediction_length': '288',\r\n 'cardinality': ''}`\r\n\r\nHowever, the training job is automatically setting cardinality to \"auto\" and using categories (even though I asked it to ignore it)\r\n```\r\n[12/16/2018 18:25:21 INFO 140678005200704] Reading default configuration from /opt/amazon/lib/python2.7/site-packages/algorithm/default-input.json: {u'num_dynamic_feat': u'auto', u'dropout_rate': u'0.10', u'mini_batch_size': u'128', u'test_quantiles': u'[0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9]', u'_tuning_objective_metric': u'', u'_num_gpus': u'auto', u'num_eval_samples': u'100', u'learning_rate': u'0.001', u'num_cells': u'40', u'num_layers': u'2', u'embedding_dimension': u'10', u'_kvstore': u'auto', u'_num_kv_servers': u'auto', u'cardinality': u'auto', u'likelihood': u'student-t', u'early_stopping_patience': u''}\r\n[12/16/2018 18:25:21 INFO 140678005200704] Reading provided configuration from /opt/ml/input/config/hyperparameters.json: {u'learning_rate': u'5E-4', u'prediction_length': u'288', u'epochs': u'400', u'time_freq': u'H', u'context_length': u'288', u'mini_batch_size': u'64', u'early_stopping_patience': u'40'}\r\n[12/16/2018 18:25:21 INFO 140678005200704] Final configuration: {u'dropout_rate': u'0.10', u'test_quantiles': u'[0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9]', u'_tuning_objective_metric': u'', u'num_eval_samples': u'100', u'learning_rate': u'5E-4', u'num_layers': u'2', u'epochs': u'400', u'embedding_dimension': u'10', u'num_cells': u'40', u'_num_kv_servers': u'auto', u'mini_batch_size': u'64', u'likelihood': u'student-t', u'num_dynamic_feat': u'auto', u'cardinality': u'auto', u'_num_gpus': u'auto', u'prediction_length': u'288', u'time_freq': u'H', u'context_length': u'288', u'_kvstore': u'auto', u'early_stopping_patience': u'40'}\r\n[12/16/2018 18:25:21 INFO 140678005200704] [cardinality=auto] `cat` field was found in the file `/opt/ml/input/data/train/train.json` and will be used for training.\r\n[12/16/2018 18:25:21 INFO 140678005200704] [num_dynamic_feat=auto] `dynamic_feat` field was NOT found in the file `/opt/ml/input/data/train/train.json` and will NOT be used for training.\r\n[12/16/2018 18:25:21 INFO 140678005200704] [cardinality=auto] Inferred value of cardinality=[3] from dataset.\r\n```\r\n\r\n**[12/16/2018 18:25:21 INFO 140678005200704] [cardinality=auto] Inferred value of cardinality=[3] from dataset.**\r\n\r\n\r\n### Minimal repro / logs\r\nPlease provide any logs and a bare minimum reproducible test case, as this will be helpful to diagnose the problem. If including tracebacks, please include the full traceback. Large logs and files should be attached.\r\n\r\n- **Exact command to reproduce**:\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/563/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/563/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/554", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/554/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/554/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/554/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/554", "id": 390732748, "node_id": "MDU6SXNzdWUzOTA3MzI3NDg=", "number": 554, "title": "AttributeError in sagemaker.local.image", "user": {"login": "tyrion", "id": 12343, "node_id": "MDQ6VXNlcjEyMzQz", "avatar_url": "https://avatars.githubusercontent.com/u/12343?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tyrion", "html_url": "https://github.com/tyrion", "followers_url": "https://api.github.com/users/tyrion/followers", "following_url": "https://api.github.com/users/tyrion/following{/other_user}", "gists_url": "https://api.github.com/users/tyrion/gists{/gist_id}", "starred_url": "https://api.github.com/users/tyrion/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tyrion/subscriptions", "organizations_url": "https://api.github.com/users/tyrion/orgs", "repos_url": "https://api.github.com/users/tyrion/repos", "events_url": "https://api.github.com/users/tyrion/events{/privacy}", "received_events_url": "https://api.github.com/users/tyrion/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 850818746, "node_id": "MDU6TGFiZWw4NTA4MTg3NDY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/status:%20pending%20release", "name": "status: pending release", "color": "eee8d5", "default": false, "description": "issues for which fixes have been merged but not released to PyPI"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2018-12-13T15:34:12Z", "updated_at": "2018-12-17T10:48:42Z", "closed_at": "2018-12-17T10:48:41Z", "author_association": "NONE", "active_lock_reason": null, "body": "On [line 316 of `sagemaker.local.image`][code] there is a reference to `sagemaker.rl.estimator` but the module is not imported. Therefore we get an error:\r\n```\r\nAttributeError: module 'sagemaker' has no attribute 'rl'\r\n```\r\nThe fix is also not trivial, because if you try adding the needed import at the top of the file you incur in an import loop.\r\n\r\nTo trigger this code I created an estimator, passing to it an `output_path` starting with `\"file://\"` and then called its `fit` method. \r\n\r\n[code]: https://github.com/aws/sagemaker-python-sdk/blob/4bac1856926ed9446f160d0b2e5554dac7bfb6a0/src/sagemaker/local/image.py#L316\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/554/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/554/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/551", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/551/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/551/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/551/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/551", "id": 390521847, "node_id": "MDU6SXNzdWUzOTA1MjE4NDc=", "number": 551, "title": "SageMaker endpoint and Numpy Arrays", "user": {"login": "NRauschmayr", "id": 12165606, "node_id": "MDQ6VXNlcjEyMTY1NjA2", "avatar_url": "https://avatars.githubusercontent.com/u/12165606?v=4", "gravatar_id": "", "url": "https://api.github.com/users/NRauschmayr", "html_url": "https://github.com/NRauschmayr", "followers_url": "https://api.github.com/users/NRauschmayr/followers", "following_url": "https://api.github.com/users/NRauschmayr/following{/other_user}", "gists_url": "https://api.github.com/users/NRauschmayr/gists{/gist_id}", "starred_url": "https://api.github.com/users/NRauschmayr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/NRauschmayr/subscriptions", "organizations_url": "https://api.github.com/users/NRauschmayr/orgs", "repos_url": "https://api.github.com/users/NRauschmayr/repos", "events_url": "https://api.github.com/users/NRauschmayr/events{/privacy}", "received_events_url": "https://api.github.com/users/NRauschmayr/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 993024953, "node_id": "MDU6TGFiZWw5OTMwMjQ5NTM=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/contributions%20welcome", "name": "contributions welcome", "color": "81f985", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2018-12-13T05:18:39Z", "updated_at": "2019-01-11T14:51:44Z", "closed_at": "2019-01-11T14:51:43Z", "author_association": "NONE", "active_lock_reason": null, "body": "When hosting a Gluon model (MXNet 1.3.0, Python 2, SageMaker default container), the endpoint does not accept Numpy arrays, so the following code crashes: \r\n\r\n```\r\npredictor = mxnet_estimator.deploy(instance_type='local_gpu', initial_instance_count=1)\r\ndata = np.zeros((1,10,227,227))\r\nprint (predictor.predict(data))\r\n```\r\nIn my entry point script I only defined ```model_fn``` for the inference:\r\n```\r\ndef model_fn(model_dir):\r\n    model = AutoEncoder()\r\n    model.load_parameters(\"%s/model.params\" %model_dir, ctx=ctx)\r\n    return model\r\n```\r\nI get the following stacktrace:\r\n```\r\nalgo-1-TZFX7_1_1307f2d8e109 |   File \"/usr/local/lib/python2.7/dist-packages/flask/app.py\", line 2292, in wsgi_app\r\nalgo-1-TZFX7_1_1307f2d8e109 |     response = self.full_dispatch_request()\r\nalgo-1-TZFX7_1_1307f2d8e109 |   File \"/usr/local/lib/python2.7/dist-packages/flask/app.py\", line 1815, in full_dispatch_request\r\nalgo-1-TZFX7_1_1307f2d8e109 |     rv = self.handle_user_exception(e)\r\nalgo-1-TZFX7_1_1307f2d8e109 |   File \"/usr/local/lib/python2.7/dist-packages/flask/app.py\", line 1718, in handle_user_exception\r\nalgo-1-TZFX7_1_1307f2d8e109 |     reraise(exc_type, exc_value, tb)\r\nalgo-1-TZFX7_1_1307f2d8e109 |   File \"/usr/local/lib/python2.7/dist-packages/flask/app.py\", line 1813, in full_dispatch_request\r\nalgo-1-TZFX7_1_1307f2d8e109 |     rv = self.dispatch_request()\r\nalgo-1-TZFX7_1_1307f2d8e109 |   File \"/usr/local/lib/python2.7/dist-packages/flask/app.py\", line 1799, in dispatch_request\r\nalgo-1-TZFX7_1_1307f2d8e109 |     return self.view_functions[rule.endpoint](**req.view_args)\r\nalgo-1-TZFX7_1_1307f2d8e109 |   File \"/usr/local/lib/python2.7/dist-packages/sagemaker_containers/_transformer.py\", line 171, in transform\r\nalgo-1-TZFX7_1_1307f2d8e109 |     result = self._transform_fn(self._model, request.content, request.content_type, request.accept)\r\nalgo-1-TZFX7_1_1307f2d8e109 |   File \"/usr/local/lib/python2.7/dist-packages/sagemaker_containers/_transformer.py\", line 201, in _default_transform_fn\r\nalgo-1-TZFX7_1_1307f2d8e109 |     prediction = self._predict_fn(data, model)\r\nalgo-1-TZFX7_1_1307f2d8e109 |   File \"/usr/local/lib/python2.7/dist-packages/sagemaker_containers/_functions.py\", line 86, in wrapper\r\nalgo-1-TZFX7_1_1307f2d8e109 |     six.reraise(error_class, error_class(e), sys.exc_info()[2])\r\nalgo-1-TZFX7_1_1307f2d8e109 | TypeError: 'NoneType' object is not callable\r\nTraceback (most recent call last):\r\nalgo-1-TZFX7_1_1307f2d8e109 | 172.21.0.1 - - [13/Dec/2018:05:05:06 +0000] \"POST /invocations HTTP/1.1\" 500 291 \"-\" \"-\"\r\n  File \"run.py\", line 34, in <module>\r\n    print (predictor.predict(data))\r\n  File \"/home/ubuntu/anaconda3/lib/python3.6/site-packages/sagemaker/predictor.py\", line 79, in predict\r\n    return self._handle_response(response)\r\n  File \"/home/ubuntu/anaconda3/lib/python3.6/site-packages/sagemaker/predictor.py\", line 85, in _handle_response\r\n    return self.deserializer(response_body, response['ContentType'])\r\n  File \"/home/ubuntu/anaconda3/lib/python3.6/site-packages/sagemaker/predictor.py\", line 289, in __call__\r\n    return json.load(codecs.getreader('utf-8')(stream))\r\n  File \"/home/ubuntu/anaconda3/lib/python3.6/json/__init__.py\", line 299, in load\r\n    parse_constant=parse_constant, object_pairs_hook=object_pairs_hook, **kw)\r\n  File \"/home/ubuntu/anaconda3/lib/python3.6/json/__init__.py\", line 354, in loads\r\n    return _default_decoder.decode(s)\r\n  File \"/home/ubuntu/anaconda3/lib/python3.6/json/decoder.py\", line 339, in decode\r\n    obj, end = self.raw_decode(s, idx=_w(s, 0).end())\r\n  File \"/home/ubuntu/anaconda3/lib/python3.6/json/decoder.py\", line 357, in raw_decode\r\n    raise JSONDecodeError(\"Expecting value\", s, err.value) from None\r\njson.decoder.JSONDecodeError: Expecting value: line 1 column 1 (char 0)\r\n```\r\n\r\nI debugged the issue by running SageMaker locally and I got it working by setting the content_type:\r\n```\r\ndata = np.zeros((1,10,227,227))\r\npredictor.accept = 'application/x-npy'\r\npredictor.content_type = 'application/x-npy'\r\npredictor.deserializer =  numpy_deserializer\r\npredictor.serializer =  npy_serializer\r\n\r\nprint (predictor.predict(data))\r\n```\r\n\r\nand in the entry point script I added ```transform_fn```:\r\n```\r\ndef transform_fn(model, data, content_type, accept):\r\n\r\n    tmp = np.load(StringIO(data))\r\n    mx_nd_array = mx.nd.array(tmp)\r\n    mx_nd_array = mx_nd_array.as_in_context(ctx)\r\n    output = model(mx_nd_array)\r\n    np_array = output.asnumpy()\r\n    np.save(\"output\", np_array)\r\n    f = open(\"output.npy\")\r\n    return f.read()\r\n```\r\nIs there an easier workaround to get this working? I was told SageMaker should accept Numpy arrays, and setting manually content types etc should actually not be done.\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/551/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/551/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/548", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/548/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/548/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/548/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/548", "id": 390313198, "node_id": "MDU6SXNzdWUzOTAzMTMxOTg=", "number": 548, "title": "Training a model in `local_code` mode does not work if `source_dir=\".\"`", "user": {"login": "tyrion", "id": 12343, "node_id": "MDQ6VXNlcjEyMzQz", "avatar_url": "https://avatars.githubusercontent.com/u/12343?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tyrion", "html_url": "https://github.com/tyrion", "followers_url": "https://api.github.com/users/tyrion/followers", "following_url": "https://api.github.com/users/tyrion/following{/other_user}", "gists_url": "https://api.github.com/users/tyrion/gists{/gist_id}", "starred_url": "https://api.github.com/users/tyrion/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tyrion/subscriptions", "organizations_url": "https://api.github.com/users/tyrion/orgs", "repos_url": "https://api.github.com/users/tyrion/repos", "events_url": "https://api.github.com/users/tyrion/events{/privacy}", "received_events_url": "https://api.github.com/users/tyrion/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 749522457, "node_id": "MDU6TGFiZWw3NDk1MjI0NTc=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/type:%20feature%20request", "name": "type: feature request", "color": "a2eeef", "default": false, "description": ""}, {"id": 892238348, "node_id": "MDU6TGFiZWw4OTIyMzgzNDg=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/type:%20documentation", "name": "type: documentation", "color": "002b36", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 15, "created_at": "2018-12-12T16:45:49Z", "updated_at": "2022-02-16T18:22:26Z", "closed_at": "2022-02-16T18:22:26Z", "author_association": "NONE", "active_lock_reason": null, "body": "### System Information\r\n- **Python Version**: 3.6\r\n- **Python SDK Version**: master\r\n- **Are you using a custom image**: yes\r\n\r\n### Describe the problem\r\nI am trying to train a model using the undocumented `local_code` mode. In case I don't specify `source_dir` or set it to `\".\"` the training procedure fails to mount the volumes correctly.\r\n\r\nI get:\r\n\r\n> Cannot create container for service algo-1-JFP46: create .: volume name is too short, names should be at least two alphanumeric characters\r\n\r\nI am reporting this even if `local_code` is still not documented, hoping it can be useful anyway.\r\n\r\n### Minimal repro / logs\r\nPlease provide any logs and a bare minimum reproducible test case, as this will be helpful to diagnose the problem. If including tracebacks, please include the full traceback. Large logs and files should be attached.\r\n\r\n```\r\nsession = LocalSession()\r\nsession.config = {'local': {'local_code': True}}\r\n\r\nest = MyEstimator(\r\n    entry_point='code.py',\r\n    train_instance_type='local',\r\n    train_instance_count=1,\r\n    role=role,\r\n    sagemaker_session=session,\r\n)\r\n\r\nest.fit()\r\n```\r\nSee the full [traceback](https://github.com/aws/sagemaker-python-sdk/files/2672666/traceback.txt).\r\n\r\nHere is the interesting part of the generated `docker-compose.yaml`:\r\n```yaml\r\nnetworks:\r\n  sagemaker-local:\r\n    name: sagemaker-local\r\nservices:\r\n    volumes:\r\n    - /tmp/tmp_i5dhjtn/algo-1-JFP46/output/data:/opt/ml/output/data\r\n    - /tmp/tmp_i5dhjtn/algo-1-JFP46/output:/opt/ml/output\r\n    - /tmp/tmp_i5dhjtn/algo-1-JFP46/input:/opt/ml/input\r\n    - /tmp/tmp_i5dhjtn/model:/opt/ml/model\r\n    - :/opt/ml/code\r\n    - /tmp/tmp_i5dhjtn/shared:/opt/ml/shared\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/548/reactions", "total_count": 4, "+1": 4, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/548/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/512", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/512/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/512/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/512/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/512", "id": 384738729, "node_id": "MDU6SXNzdWUzODQ3Mzg3Mjk=", "number": 512, "title": "SageMaker fails when using Multi-GPU with keras.utils.multi_gpu_model", "user": {"login": "loretoparisi", "id": 163333, "node_id": "MDQ6VXNlcjE2MzMzMw==", "avatar_url": "https://avatars.githubusercontent.com/u/163333?v=4", "gravatar_id": "", "url": "https://api.github.com/users/loretoparisi", "html_url": "https://github.com/loretoparisi", "followers_url": "https://api.github.com/users/loretoparisi/followers", "following_url": "https://api.github.com/users/loretoparisi/following{/other_user}", "gists_url": "https://api.github.com/users/loretoparisi/gists{/gist_id}", "starred_url": "https://api.github.com/users/loretoparisi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/loretoparisi/subscriptions", "organizations_url": "https://api.github.com/users/loretoparisi/orgs", "repos_url": "https://api.github.com/users/loretoparisi/repos", "events_url": "https://api.github.com/users/loretoparisi/events{/privacy}", "received_events_url": "https://api.github.com/users/loretoparisi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 749522466, "node_id": "MDU6TGFiZWw3NDk1MjI0NjY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/type:%20question", "name": "type: question", "color": "d876e3", "default": false, "description": ""}, {"id": 892238348, "node_id": "MDU6TGFiZWw4OTIyMzgzNDg=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/type:%20documentation", "name": "type: documentation", "color": "002b36", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2018-11-27T11:01:25Z", "updated_at": "2018-12-14T17:00:40Z", "closed_at": "2018-12-14T17:00:39Z", "author_association": "NONE", "active_lock_reason": null, "body": "Please fill out the form below.\r\n\r\n### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**: Keras (backend: Tensorflow)\r\n- **Framework Version**: Keras 2.2.0, Tensorflow 1.12.0\r\n- **Python Version**: 2.7\r\n- **CPU or GPU**: SageMaker CPU / GPU - ml.p3.8xlarge\r\n- **Python SDK Version**: 2.7\r\n- **Are you using a custom image**: Yes\r\n\r\n### Describe the problem\r\nRunning AWS SageMaker with a custom model, the TrainingJob fails with an **Algorithm Error** when using Keras plus a Tensorflow backend in multi-gpu configuration.\r\n\r\n\r\n### Minimal repro / logs\r\n\r\n  ```python\r\n def setup_multi_gpu(model):\r\n\r\n    import tensorflow as tf\r\n    from keras.utils.training_utils import multi_gpu_model\r\n    from tensorflow.python.client import device_lib\r\n\r\n    # IMPORTANT: Tells tf to not occupy a specific amount of memory\r\n    from keras.backend.tensorflow_backend import set_session\r\n\r\n    config = tf.ConfigProto()\r\n    config.gpu_options.allow_growth = True  # dynamically grow the memory used on the GPU\r\n    sess = tf.Session(config=config)\r\n    set_session(sess)  # set this TensorFlow session as the default session for Keras.\r\n\r\n    print('reading gpus avaliable..')\r\n    local_device_protos = device_lib.list_local_devices()\r\n    avail_gpus = [x.name for x in local_device_protos if x.device_type == 'GPU']\r\n    num_gpu = len(avail_gpus)\r\n    print('Amount of GPUs available: %s' % num_gpu)\r\n\r\n    multi_model = multi_gpu_model(model, gpus=num_gpu)\r\n\r\n    return multi_model \r\n\r\n_model = create_model()\r\nmodel = setup_multi_gpu(_model)\r\nmodel.compile(params)\r\nmodel.train(params)\r\n```\r\n\r\nThis parallel model loading will fail. There is no further error or exception from CloudWatch logging. This configuration works properly on local machine with 2x NVIDIA GTX 1080, same Keras Tensorflow backend.\r\n\r\nAccording to SageMaker documentation and [tutorials][1] the `multi_gpu_model` utility will work ok when Keras backend is MXNet, but I did not find any mention when the backend is Tensorflow with the same multi gpu configuration.\r\n\r\nIn the following some logging before the TrainingJob hangs. This logging repeats twice\r\n\r\n    2018-11-27 10:02:49.878414: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1511] Adding visible gpu devices: 0, 1, 2, 3\r\n    2018-11-27 10:02:49.878462: I tensorflow/core/common_runtime/gpu/gpu_device.cc:982] Device interconnect StreamExecutor with strength 1 edge matrix:\r\n    2018-11-27 10:02:49.878471: I tensorflow/core/common_runtime/gpu/gpu_device.cc:988] 0 1 2 3\r\n    2018-11-27 10:02:49.878477: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1001] 0: N Y Y Y\r\n    2018-11-27 10:02:49.878481: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1001] 1: Y N Y Y\r\n    2018-11-27 10:02:49.878486: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1001] 2: Y Y N Y\r\n    2018-11-27 10:02:49.878492: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1001] 3: Y Y Y N\r\n    2018-11-27 10:02:49.879340: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1115] Created TensorFlow device (/device:GPU:0 with 14874 MB memory) -> physical GPU (device: 0, name: Tesla V100-SXM2-16GB, pci bus id: 0000:00:1b.0, compute capability: 7.0)\r\n    2018-11-27 10:02:49.879486: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1115] Created TensorFlow device (/device:GPU:1 with 14874 MB memory) -> physical GPU (device: 1, name: Tesla V100-SXM2-16GB, pci bus id: 0000:00:1c.0, compute capability: 7.0)\r\n    2018-11-27 10:02:49.879694: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1115] Created TensorFlow device (/device:GPU:2 with 14874 MB memory) -> physical GPU (device: 2, name: Tesla V100-SXM2-16GB, pci bus id: 0000:00:1d.0, compute capability: 7.0)\r\n    2018-11-27 10:02:49.879872: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1115] Created TensorFlow device (/device:GPU:3 with 14874 MB memory) -> physical GPU (device: 3, name: Tesla V100-SXM2-16GB, pci bus id: 0000:00:1e.0, compute capability: 7.0)\r\n\r\nBefore there is some logging info about each GPU, that repeats 4 times\r\n\r\n    2018-11-27 10:02:46.447639: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1432] Found device 3 with properties:\r\n    name: Tesla V100-SXM2-16GB major: 7 minor: 0 memoryClockRate(GHz): 1.53\r\n    pciBusID: 0000:00:1e.0\r\n    totalMemory: 15.78GiB freeMemory: 15.37GiB\r\n\r\nAccording to the logging all the 4 GPUs are visible and loaded in the Tensorflow Keras backend. After that no application logging follows, the TrainingJob status is **inProgress** for a while, after that it becomes **Failed** with the same **Algorithm Error**.\r\n\r\n<img width=\"1434\" alt=\"schermata 2018-11-27 alle 11 15 04\" src=\"https://user-images.githubusercontent.com/163333/49077561-da0bd180-f23b-11e8-8960-48d532866444.png\">\r\n\r\n\r\nLooking at CloudWatch logging I can see some metrics at work. Specifically `GPU Memory Utilization`, `CPU Utilization` are ok, while `GPU utilization` is 0%.\r\n\r\n[![enter image description here][2]][2]\r\n\r\nI have posted the question to the forum [here](https://forums.aws.amazon.com/thread.jspa?threadID=294095&tstart=0).\r\n\r\n\r\n  [1]: https://github.com/awslabs/keras-apache-mxnet/wiki/Multi-GPU-Model-Training-with-Keras-MXNet\r\n  [2]: https://i.stack.imgur.com/260hL.png\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/512/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/512/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/451", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/451/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/451/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/451/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/451", "id": 376102190, "node_id": "MDU6SXNzdWUzNzYxMDIxOTA=", "number": 451, "title": "input data config ignored in local mode?", "user": {"login": "yifeim", "id": 8949994, "node_id": "MDQ6VXNlcjg5NDk5OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/8949994?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yifeim", "html_url": "https://github.com/yifeim", "followers_url": "https://api.github.com/users/yifeim/followers", "following_url": "https://api.github.com/users/yifeim/following{/other_user}", "gists_url": "https://api.github.com/users/yifeim/gists{/gist_id}", "starred_url": "https://api.github.com/users/yifeim/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yifeim/subscriptions", "organizations_url": "https://api.github.com/users/yifeim/orgs", "repos_url": "https://api.github.com/users/yifeim/repos", "events_url": "https://api.github.com/users/yifeim/events{/privacy}", "received_events_url": "https://api.github.com/users/yifeim/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2018-10-31T18:26:34Z", "updated_at": "2018-11-06T23:18:44Z", "closed_at": "2018-11-05T19:46:14Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The local image clearly ignores context_type of an input,\r\n\r\nhttps://github.com/aws/sagemaker-python-sdk/blob/385d40ab2325812104c050bdfe600764801ca550/src/sagemaker/local/image.py#L246\r\n\r\ndespite they somehow passed unit test\r\n\r\nhttps://github.com/aws/sagemaker-python-sdk/blob/c8006fab13f8fb2a9368f93e676c029c5a8862ae/tests/unit/test_local_session.py#L328\r\n\r\nMy same custom model runs in remote but not in local. This inspires my question: how are context types detected? E.g., by file suffix?\r\n\r\nThanks.", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/451/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/451/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/447", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/447/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/447/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/447/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/447", "id": 374592438, "node_id": "MDU6SXNzdWUzNzQ1OTI0Mzg=", "number": 447, "title": "Estimator.delete_endpoint does not delete the Model or Endpoint Configuration", "user": {"login": "mvsusp", "id": 142074, "node_id": "MDQ6VXNlcjE0MjA3NA==", "avatar_url": "https://avatars.githubusercontent.com/u/142074?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mvsusp", "html_url": "https://github.com/mvsusp", "followers_url": "https://api.github.com/users/mvsusp/followers", "following_url": "https://api.github.com/users/mvsusp/following{/other_user}", "gists_url": "https://api.github.com/users/mvsusp/gists{/gist_id}", "starred_url": "https://api.github.com/users/mvsusp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mvsusp/subscriptions", "organizations_url": "https://api.github.com/users/mvsusp/orgs", "repos_url": "https://api.github.com/users/mvsusp/repos", "events_url": "https://api.github.com/users/mvsusp/events{/privacy}", "received_events_url": "https://api.github.com/users/mvsusp/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-10-27T01:27:51Z", "updated_at": "2019-02-22T23:00:20Z", "closed_at": "2019-02-22T23:00:19Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Please fill out the form below.\r\n\r\n### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**:\r\nAny Framework Container\r\n- **Python Version**:\r\n2 and 3\r\n- **Python SDK Version**:\r\n1.12\r\n\r\n### Describe the problem\r\nIssue found by @andrewcking here https://github.com/aws/sagemaker-python-sdk/issues/402\r\n\r\nIn SageMaker Hosting, the process to create an endpoint requires to [create an model, an endpoint configuration, and an endpoint](https://docs.aws.amazon.com/sagemaker/latest/dg/how-it-works-hosting.html).\r\n\r\nSageMaker Python SDK abstract these 3 layers for you. These are the [lines where this process happens](https://github.com/aws/sagemaker-python-sdk/blob/dd44d25247927abe409f7bf9e5c4561f7e55585e/src/sagemaker/model.py#L105)\r\n\r\n```python\r\n        container_def = self.prepare_container_def(instance_type)\r\n        self.name = self.name or name_from_image(container_def['Image'])\r\n        self.sagemaker_session.create_model(self.name, self.role, container_def, vpc_config=self.vpc_config)\r\n        production_variant = sagemaker.production_variant(self.name, instance_type, initial_instance_count)\r\n        self.endpoint_name = endpoint_name or self.name\r\n        self.sagemaker_session.endpoint_from_production_variants(self.endpoint_name, [production_variant], tags)\r\n```\r\n\r\nTo be able to use Python SDK to create an endpoint with the same name, you will have to delete the model, the endpoint_config, and the endpoint. SageMaker Python SDK [delete_endpoint()](https://github.com/aws/sagemaker-python-sdk/blob/dd44d25247927abe409f7bf9e5c4561f7e55585e/src/sagemaker/estimator.py#L330) only deletes the endpoint, which is why the issue is happening.\r\n\r\n\r\n### Minimal repro / logs\r\nPlease provide any logs and a bare minimum reproducible test case, as this will be helpful to diagnose the problem. If including tracebacks, please include the full traceback. Large logs and files should be attached.\r\n\r\n- **Exact command to reproduce**:\r\n```python\r\nfrom sagemaker.pytorch import PyTorch\r\n\r\n# create estimator\r\nestimator = PyTorch(entry_point='train.py', \r\n                    role='SageMakerRole', \r\n                    framework_version='0.4.0', \r\n                    train_instance_count=1, \r\n                    train_instance_type='ml.c5.xlarge', \r\n                    source_dir='source', \r\n                    hyperparameters={'epochs': 6,})\r\n\r\n# fit estimator\r\nestimator.fit('s3://sagemaker-sample-data-us-west-2/spark/mnist/train/')\r\n\r\n# deploy estimator (except it doesn't deploy your new estimator if a previously used endpoint name is specified)\r\nestimator.deploy(instance_type='ml.c5.xlarge'', initial_instance_count=1)\r\n\r\n# delete endpoint\r\nestimator.delete_endpoint()\r\n\r\n# deploy again\r\nestimator.deploy(instance_type='ml.c5.xlarge'', initial_instance_count=1, endpoint_name=estimator.last_training_job.name)\r\n```", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/447/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/447/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/421", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/421/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/421/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/421/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/421", "id": 367530459, "node_id": "MDU6SXNzdWUzNjc1MzA0NTk=", "number": 421, "title": "[bug] broken custom image local mode training due to 1.11.1", "user": {"login": "yifeim", "id": 8949994, "node_id": "MDQ6VXNlcjg5NDk5OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/8949994?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yifeim", "html_url": "https://github.com/yifeim", "followers_url": "https://api.github.com/users/yifeim/followers", "following_url": "https://api.github.com/users/yifeim/following{/other_user}", "gists_url": "https://api.github.com/users/yifeim/gists{/gist_id}", "starred_url": "https://api.github.com/users/yifeim/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yifeim/subscriptions", "organizations_url": "https://api.github.com/users/yifeim/orgs", "repos_url": "https://api.github.com/users/yifeim/repos", "events_url": "https://api.github.com/users/yifeim/events{/privacy}", "received_events_url": "https://api.github.com/users/yifeim/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 13, "created_at": "2018-10-07T07:49:11Z", "updated_at": "2018-10-21T20:50:02Z", "closed_at": "2018-10-21T20:50:02Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Please fill out the form below.\r\n\r\n### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**: BYO scikit-learn\r\n- **Framework Version**: custom image\r\n- **Python Version**: 3.6.5\r\n- **CPU or GPU**: CPU\r\n- **Python SDK Version**: 1.11.1\r\n- **Are you using a custom image**: Yes\r\n\r\n### Describe the problem\r\nThe following codes were fine with sagemaker ==1.11.0, but not okay with sagemaker==1.11.1. Any guesses what might be missing? Thanks!\r\n\r\nPS: I did downgrade sagemaker to 1.11.0 and tested out that the example is okay.\r\n\r\n### Minimal repro / logs\r\n\r\n```\r\n    m = Estimator(\r\n        image_name='<some image>',\r\n                  role=get_execution_role(),\r\n                  train_instance_count=1,\r\n                  train_instance_type='local_gpu')\r\n    \r\n    m.set_hyperparameters(**hyperparameters)\r\n    m.fit({k:'file://'+v for k,v in inputs.items()})\r\n```\r\n\r\n\r\n```\r\n---------------------------------------------------------------------------\r\nTypeError                                 Traceback (most recent call last)\r\n<ipython-input-34-104847d86296> in <module>()\r\n     61     m.set_hyperparameters(**hyperparameters)\r\n     62 \r\n---> 63     m.fit({k:'file://'+v for k,v in inputs.items()})\r\n     64 \r\n     65     predictor = m.deploy(1, 'local_gpu')\r\n\r\n~/anaconda3/envs/mxnet_p36/lib/python3.6/site-packages/sagemaker/estimator.py in fit(self, inputs, wait, logs, job_name)\r\n    189         self._prepare_for_training(job_name=job_name)\r\n    190 \r\n--> 191         self.latest_training_job = _TrainingJob.start_new(self, inputs)\r\n    192         if wait:\r\n    193             self.latest_training_job.wait(logs=logs)\r\n\r\n~/anaconda3/envs/mxnet_p36/lib/python3.6/site-packages/sagemaker/estimator.py in start_new(cls, estimator, inputs)\r\n    415                                           resource_config=config['resource_config'], vpc_config=config['vpc_config'],\r\n    416                                           hyperparameters=hyperparameters, stop_condition=config['stop_condition'],\r\n--> 417                                           tags=estimator.tags)\r\n    418 \r\n    419         return cls(estimator.sagemaker_session, estimator._current_job_name)\r\n\r\n~/anaconda3/envs/mxnet_p36/lib/python3.6/site-packages/sagemaker/session.py in train(self, image, input_mode, input_config, role, job_name, output_config, resource_config, vpc_config, hyperparameters, stop_condition, tags)\r\n    276         LOGGER.info('Creating training-job with name: {}'.format(job_name))\r\n    277         LOGGER.debug('train request: {}'.format(json.dumps(train_request, indent=4)))\r\n--> 278         self.sagemaker_client.create_training_job(**train_request)\r\n    279 \r\n    280     def tune(self, job_name, strategy, objective_type, objective_metric_name,\r\n\r\n~/anaconda3/envs/mxnet_p36/lib/python3.6/site-packages/sagemaker/local/local_session.py in create_training_job(self, TrainingJobName, AlgorithmSpecification, InputDataConfig, OutputDataConfig, ResourceConfig, **kwargs)\r\n     73         training_job = _LocalTrainingJob(container)\r\n     74         hyperparameters = kwargs['HyperParameters'] if 'HyperParameters' in kwargs else {}\r\n---> 75         training_job.start(InputDataConfig, hyperparameters)\r\n     76 \r\n     77         LocalSagemakerClient._training_jobs[TrainingJobName] = training_job\r\n\r\n~/anaconda3/envs/mxnet_p36/lib/python3.6/site-packages/sagemaker/local/entities.py in start(self, input_data_config, hyperparameters)\r\n     58         self.state = self._TRAINING\r\n     59 \r\n---> 60         self.model_artifacts = self.container.train(input_data_config, hyperparameters)\r\n     61         self.end = datetime.datetime.now()\r\n     62         self.state = self._COMPLETED\r\n\r\n~/anaconda3/envs/mxnet_p36/lib/python3.6/site-packages/sagemaker/local/image.py in train(self, input_data_config, hyperparameters)\r\n    109         training_env_vars = {\r\n    110             REGION_ENV_NAME: self.sagemaker_session.boto_region_name,\r\n--> 111             TRAINING_JOB_NAME_ENV_NAME: json.loads(hyperparameters.get(sagemaker.model.JOB_NAME_PARAM_NAME)),\r\n    112         }\r\n    113         compose_data = self._generate_compose_file('train', additional_volumes=volumes,\r\n\r\n~/anaconda3/envs/mxnet_p36/lib/python3.6/json/__init__.py in loads(s, encoding, cls, object_hook, parse_float, parse_int, parse_constant, object_pairs_hook, **kw)\r\n    346         if not isinstance(s, (bytes, bytearray)):\r\n    347             raise TypeError('the JSON object must be str, bytes or bytearray, '\r\n--> 348                             'not {!r}'.format(s.__class__.__name__))\r\n    349         s = s.decode(detect_encoding(s), 'surrogatepass')\r\n    350 \r\n\r\nTypeError: the JSON object must be str, bytes or bytearray, not 'NoneType'\r\n```", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/421/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/421/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/413", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/413/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/413/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/413/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/413", "id": 365300856, "node_id": "MDU6SXNzdWUzNjUzMDA4NTY=", "number": 413, "title": "Unable to invoke SageMaker API endpoint - Vague Error: KeyError: u''", "user": {"login": "tlelson", "id": 4349566, "node_id": "MDQ6VXNlcjQzNDk1NjY=", "avatar_url": "https://avatars.githubusercontent.com/u/4349566?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tlelson", "html_url": "https://github.com/tlelson", "followers_url": "https://api.github.com/users/tlelson/followers", "following_url": "https://api.github.com/users/tlelson/following{/other_user}", "gists_url": "https://api.github.com/users/tlelson/gists{/gist_id}", "starred_url": "https://api.github.com/users/tlelson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tlelson/subscriptions", "organizations_url": "https://api.github.com/users/tlelson/orgs", "repos_url": "https://api.github.com/users/tlelson/repos", "events_url": "https://api.github.com/users/tlelson/events{/privacy}", "received_events_url": "https://api.github.com/users/tlelson/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 892238348, "node_id": "MDU6TGFiZWw4OTIyMzgzNDg=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/type:%20documentation", "name": "type: documentation", "color": "002b36", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 14, "created_at": "2018-10-01T03:59:03Z", "updated_at": "2020-05-21T15:43:46Z", "closed_at": "2020-05-21T15:43:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "This seems very likely conected to Issues: #99, #269 and #100. \r\n\r\n### System Information\r\n- Tensorflow /  `DNNClassifier`\r\n- TensorFlow v 1.10, `sagemaker==1.11.0`\r\n- `conda_tensorflow_p27` on hosted notebook\r\n\r\n### Describe the problem\r\nI'm running my own Iris classifier comparing Sagemaker to Google MLEngine.  I have taken standard TensorFlow code known to work, that deploys and predicts from MLE and repeated the steps in Sagemaker.  Everything goes as expected up until I invoke the endpoint.  At this stage I receive the following errors:\r\n\r\n### Minimal repro / logs\r\n\r\n#### Notebook Error \r\n\r\n```python\r\nModelErrorTraceback (most recent call last)\r\n<ipython-input-92-07d9ea9b1239> in <module>()\r\n      2 # iris_predictor.predict({u'' : list(sample0.values)})\r\n      3 # iris_predictor.predict({ u'instances': [dict(sample0)]})\r\n----> 4 iris_predictor.predict({ u'': [dict(sample0)]})\r\n\r\n/home/ec2-user/anaconda3/envs/tensorflow_p27/lib/python2.7/site-packages/sagemaker/predictor.pyc in predict(self, data)\r\n     84             request_args['Accept'] = self.accept\r\n     85 \r\n---> 86         response = self.sagemaker_session.sagemaker_runtime_client.invoke_endpoint(**request_args)\r\n     87 \r\n     88         response_body = response['Body']\r\n\r\n/home/ec2-user/anaconda3/envs/tensorflow_p27/lib/python2.7/site-packages/botocore/client.pyc in _api_call(self, *args, **kwargs)\r\n    312                     \"%s() only accepts keyword arguments.\" % py_operation_name)\r\n    313             # The \"self\" in this scope is referring to the BaseClient.\r\n--> 314             return self._make_api_call(operation_name, kwargs)\r\n    315 \r\n    316         _api_call.__name__ = str(py_operation_name)\r\n\r\n/home/ec2-user/anaconda3/envs/tensorflow_p27/lib/python2.7/site-packages/botocore/client.pyc in _make_api_call(self, operation_name, api_params)\r\n    610             error_code = parsed_response.get(\"Error\", {}).get(\"Code\")\r\n    611             error_class = self.exceptions.from_code(error_code)\r\n--> 612             raise error_class(parsed_response, operation_name)\r\n    613         else:\r\n    614             return parsed_response\r\n\r\nModelError: An error occurred (ModelError) when calling the InvokeEndpoint operation: Received server error (500) from model with message \"\". See https://ap-southeast-2.console.aws.amazon.com/cloudwatch/home?region=ap-southeast-2#logEventViewer:group=/aws/sagemaker/Endpoints/sagemaker-tensorflow-2018-10-01-02-17-54-088 in account XXXXX for more information.\r\n```\r\n#### Cloudwatch Errors:\r\n\r\n```bash\r\n...\r\n10.32.0.2 - - [01/Oct/2018:03:23:33 +0000] \"GET /ping HTTP/1.1\" 200 0 \"-\" \"AHC/2.0\"\r\n[2018-10-01 03:23:37,290] ERROR in serving: u''\r\nTraceback (most recent call last):\r\nFile \"/usr/local/lib/python2.7/dist-packages/container_support/serving.py\", line 182, in _invoke\r\nself.transformer.transform(content, input_content_type, requested_output_content_type)\r\nFile \"/usr/local/lib/python2.7/dist-packages/tf_container/serve.py\", line 281, in transform\r\nreturn self.transform_fn(data, content_type, accepts), accepts\r\nFile \"/usr/local/lib/python2.7/dist-packages/tf_container/serve.py\", line 208, in f\r\nprediction = self.predict_fn(input)\r\nFile \"/usr/local/lib/python2.7/dist-packages/tf_container/serve.py\", line 223, in predict_fn\r\nreturn self.proxy_client.request(data)\r\nFile \"/usr/local/lib/python2.7/dist-packages/tf_container/proxy_client.py\", line 66, in request\r\nrequest_fn = self.request_fn_map[self.prediction_type]\r\nKeyError: u''\r\n[2018-10-01 03:23:37,290] ERROR in serving: u''\r\n10.32.0.2 - - [01/Oct/2018:03:23:37 +0000] \"POST /invocations HTTP/1.1\" 500 0 \"-\" \"AHC/2.0\"\r\n...\r\n```\r\n\r\n## Reproducing the Error\r\n\r\nThe full model definition passed to Sagemaker for training and evaluation is [here](https://github.com/eL0ck/Cloud-Data-Science/blob/dev/Platform-Comparison/package/trainer/model.py)\r\n\r\nThe [notebook](https://github.com/eL0ck/Cloud-Data-Science/blob/dev/Platform-Comparison/Sagemaker/IrisCategorisation-TensorFlow-SageMaker.ipynb) currently produces the error.\r\n\r\nCreate the estimator with \r\n\r\n```python\r\nestimator = TensorFlow(entry_point='../package/trainer/model.py',\r\n                       role=execution_role,\r\n                       framework_version='1.10',\r\n                       output_path=model_artifacts_location,\r\n                       code_location=custom_code_upload_location,\r\n                       train_instance_count=1,\r\n                       training_steps=100,\r\n                       evaluation_steps=10,\r\n                       train_instance_type='ml.c4.xlarge')\r\n\r\n# Fit\r\nestimator.fit(s3_data)\r\n\r\n# Deploy\r\niris_predictor = estimator.deploy(initial_instance_count=1,\r\n                                  instance_type='ml.t2.medium')\r\n\r\ntest0 = {'PetalLength': 1.7, 'PetalWidth': 0.5, 'SepalLength': 5.1, 'SepalWidth': 3.3}\r\n\r\n# Predict (ERROR)\r\n# iris_predictor.predict(test0) \r\n# iris_predictor.predict([test0]) \r\n# iris_predictor.predict({ u'instances': [test0]}) \r\niris_predictor.predict({ u'': [test0]}) \r\n```\r\n\r\n... all produce the vague error.\r\n\r\nThanks for your help.\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/413/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/413/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/394", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/394/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/394/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/394/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/394", "id": 361562075, "node_id": "MDU6SXNzdWUzNjE1NjIwNzU=", "number": 394, "title": "Using customized tensor name for prediction after deploying the model", "user": {"login": "vbvg2008", "id": 27377212, "node_id": "MDQ6VXNlcjI3Mzc3MjEy", "avatar_url": "https://avatars.githubusercontent.com/u/27377212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vbvg2008", "html_url": "https://github.com/vbvg2008", "followers_url": "https://api.github.com/users/vbvg2008/followers", "following_url": "https://api.github.com/users/vbvg2008/following{/other_user}", "gists_url": "https://api.github.com/users/vbvg2008/gists{/gist_id}", "starred_url": "https://api.github.com/users/vbvg2008/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vbvg2008/subscriptions", "organizations_url": "https://api.github.com/users/vbvg2008/orgs", "repos_url": "https://api.github.com/users/vbvg2008/repos", "events_url": "https://api.github.com/users/vbvg2008/events{/privacy}", "received_events_url": "https://api.github.com/users/vbvg2008/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": {"login": "mvsusp", "id": 142074, "node_id": "MDQ6VXNlcjE0MjA3NA==", "avatar_url": "https://avatars.githubusercontent.com/u/142074?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mvsusp", "html_url": "https://github.com/mvsusp", "followers_url": "https://api.github.com/users/mvsusp/followers", "following_url": "https://api.github.com/users/mvsusp/following{/other_user}", "gists_url": "https://api.github.com/users/mvsusp/gists{/gist_id}", "starred_url": "https://api.github.com/users/mvsusp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mvsusp/subscriptions", "organizations_url": "https://api.github.com/users/mvsusp/orgs", "repos_url": "https://api.github.com/users/mvsusp/repos", "events_url": "https://api.github.com/users/mvsusp/events{/privacy}", "received_events_url": "https://api.github.com/users/mvsusp/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "mvsusp", "id": 142074, "node_id": "MDQ6VXNlcjE0MjA3NA==", "avatar_url": "https://avatars.githubusercontent.com/u/142074?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mvsusp", "html_url": "https://github.com/mvsusp", "followers_url": "https://api.github.com/users/mvsusp/followers", "following_url": "https://api.github.com/users/mvsusp/following{/other_user}", "gists_url": "https://api.github.com/users/mvsusp/gists{/gist_id}", "starred_url": "https://api.github.com/users/mvsusp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mvsusp/subscriptions", "organizations_url": "https://api.github.com/users/mvsusp/orgs", "repos_url": "https://api.github.com/users/mvsusp/repos", "events_url": "https://api.github.com/users/mvsusp/events{/privacy}", "received_events_url": "https://api.github.com/users/mvsusp/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2018-09-19T03:18:34Z", "updated_at": "2018-12-20T21:09:52Z", "closed_at": "2018-12-20T21:09:52Z", "author_association": "NONE", "active_lock_reason": null, "body": "Please fill out the form below.\r\n\r\n### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**: TensorFlow\r\n- **Framework Version**: 1.10\r\n- **Python Version**: 2.7\r\n- **CPU or GPU**: GPU \r\n- **Are you using a custom image**: No\r\n\r\n### Describe the problem\r\nAll of the Sagemaker tensorflow tutorial uses \"inputs\" as the input name for prediction.  for example, in \"tensorflow_resnet_cifar10_with_tensorboard\" example, the prediction is simply done by \r\n\r\nrandom_image = np.random.rand(32, 32, 3)\r\npredictor.predict(random_image_data)\r\n\r\nbut what if I trained a tensorflow model with a customized input name?  say my model inputs only accepts a dictionary like this: \r\ninputs = {\"input_image\": tf.placeholder(tf.float32, [None, 32, 32, 3])}\r\n\r\nAlthough I successfully trained and deployed the model, but when I try to do the prediction such as:\r\n\r\nrandom_image = np.random.rand(32, 32, 3)\r\npredictor.predict({'input_image':random_image})\r\n\r\nit gives me error saying my data is not JSON serializable. How do I use a customized name as input name for prediction? \r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/394/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/394/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/369", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/369/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/369/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/369/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/369", "id": 355541890, "node_id": "MDU6SXNzdWUzNTU1NDE4OTA=", "number": 369, "title": "Using the Bring Your Own Algorithm Config with Estimator , no way currently to pass VPC configs", "user": {"login": "whiletruelearn", "id": 1977850, "node_id": "MDQ6VXNlcjE5Nzc4NTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1977850?v=4", "gravatar_id": "", "url": "https://api.github.com/users/whiletruelearn", "html_url": "https://github.com/whiletruelearn", "followers_url": "https://api.github.com/users/whiletruelearn/followers", "following_url": "https://api.github.com/users/whiletruelearn/following{/other_user}", "gists_url": "https://api.github.com/users/whiletruelearn/gists{/gist_id}", "starred_url": "https://api.github.com/users/whiletruelearn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/whiletruelearn/subscriptions", "organizations_url": "https://api.github.com/users/whiletruelearn/orgs", "repos_url": "https://api.github.com/users/whiletruelearn/repos", "events_url": "https://api.github.com/users/whiletruelearn/events{/privacy}", "received_events_url": "https://api.github.com/users/whiletruelearn/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 993024953, "node_id": "MDU6TGFiZWw5OTMwMjQ5NTM=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/contributions%20welcome", "name": "contributions welcome", "color": "81f985", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-08-30T11:25:02Z", "updated_at": "2018-08-31T20:18:29Z", "closed_at": "2018-08-31T20:18:29Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Please fill out the form below.\r\n\r\n### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**: BYO Algorithm\r\n- **Framework Version**: NA\r\n- **Python Version**: 2.7\r\n- **CPU or GPU**: CPU\r\n- **Python SDK Version**: 1.9.2\r\n- **Are you using a custom image**: Yes\r\n\r\n### Describe the problem\r\nWe use `sage.estimator.Estimator` for passing the training image and other details needed for training. Currently this API doesn't accept any vpc config.\r\n\r\n### Minimal repro / logs\r\n\r\n- **Exact command to reproduce**:\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/369/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/369/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/330", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/330/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/330/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/330/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/330", "id": 346484375, "node_id": "MDU6SXNzdWUzNDY0ODQzNzU=", "number": 330, "title": "Check failed: work_element_count > 0 (0 vs. 0)", "user": {"login": "chang2394", "id": 6085397, "node_id": "MDQ6VXNlcjYwODUzOTc=", "avatar_url": "https://avatars.githubusercontent.com/u/6085397?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chang2394", "html_url": "https://github.com/chang2394", "followers_url": "https://api.github.com/users/chang2394/followers", "following_url": "https://api.github.com/users/chang2394/following{/other_user}", "gists_url": "https://api.github.com/users/chang2394/gists{/gist_id}", "starred_url": "https://api.github.com/users/chang2394/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chang2394/subscriptions", "organizations_url": "https://api.github.com/users/chang2394/orgs", "repos_url": "https://api.github.com/users/chang2394/repos", "events_url": "https://api.github.com/users/chang2394/events{/privacy}", "received_events_url": "https://api.github.com/users/chang2394/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-08-01T07:43:11Z", "updated_at": "2018-08-20T22:30:59Z", "closed_at": "2018-08-20T22:30:30Z", "author_association": "NONE", "active_lock_reason": null, "body": "### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**: Tensorflow-1.8 (Keras)\r\n- **Framework Version**: 1.7.1\r\n- **Python Version**: 2.7\r\n- **CPU or GPU**: GPU\r\n- **Python SDK Version**:\r\n- **Are you using a custom image**:\r\n\r\n### Describe the problem\r\nI am trying to run a stacked LSTM keras model but it fails with the error: \r\n**F ./tensorflow/core/util/cuda_launch_config.h:127] Check failed: work_element_count > 0 (0 vs. 0)**\r\n**Failed Reason: AlgorithmError: Exit Code: 139**\r\n\r\n```\r\ndef rmse_filtered(y_true, y_pred, low, high):\r\n    y_true_reshaped = K.flatten(y_true)\r\n    y_pred_reshaped = K.flatten(y_pred)\r\n\r\n    indices1 = array_ops.where(K.greater_equal(y_true_reshaped, low))\r\n    yf1_true = K.gather(y_true_reshaped, indices1)\r\n    yf1_pred = K.gather(y_pred_reshaped, indices1)\r\n\r\n    indices2 = array_ops.where(K.less(yf1_true, high))\r\n    yf2_true = K.gather(yf1_true, indices2)\r\n    yf2_pred = K.gather(yf1_pred, indices2)\r\n\r\n    return K.sqrt(mse(yf2_true, yf2_pred))\r\n\r\ndef range_rmse(low, high):\r\n    def loss(y_true, y_pred):\r\n        return rmse_filtered(y_true, y_pred, low, high)\r\n    loss.__name__ = \"rmse_{}_{}\".format(int(low), int(high))\r\n    return loss\r\n\r\nrmse_metrics = [\r\n    range_rmse(1.0, 5.0),\r\n    range_rmse(5.0, 10.0),\r\n    range_rmse(10.0, 20.0),\r\n    range_rmse(20.0, 50.0),\r\n    range_rmse(50.0, 100.0),\r\n    range_rmse(100.0, 200.0),\r\n    range_rmse(200.0, 500.0),\r\n    range_rmse(500.0, 1000.0),\r\n    range_rmse(1000.0, 2000.0),\r\n    range_rmse(2000.0, 5000.0)\r\n]\r\n\r\ndef keras_model_fn(hyperparameters):\r\n    model = Sequential()\r\n    model.add(Bidirectional(LSTM(100, return_sequences=True), input_shape=(12, 1), name=\"inputs\", merge_mode='ave'))\r\n    model.add(LSTM(100, return_sequences=False))\r\n    model.add(Dense(1))\r\n\r\n    model_metrics = ['mae', mape, mape_gz, msle] + rmse_metrics\r\n    model.compile(loss='mean_squared_error',\r\n                  optimizer=Adam(lr=0.001), metrics=model_metrics)\r\n    logger.info(model.summary())\r\n    return model\r\n\r\n\r\n```\r\nThe error seems to go away when i switch from p-series instance types to c-series.\r\n\r\n### Minimal repro / logs\r\n2018-07-31 15:09:40,402 INFO - root - running container entrypoint\r\n2018-07-31 15:09:40,403 INFO - root - starting train task\r\n2018-07-31 15:09:40,527 INFO - container_support.training - Training starting\r\n2018-07-31 15:09:43,036 INFO - botocore.vendored.requests.packages.urllib3.connectionpool - Starting new HTTP connection (1): 169.254.170.2\r\n2018-07-31 15:09:43,364 INFO - botocore.vendored.requests.packages.urllib3.connectionpool - Starting new HTTPS connection (1): sagemaker-poc-test.s3.amazonaws.com\r\n2018-07-31 15:09:43,503 INFO - sagemaker - TF VERSION: 1.8.0\r\n2018-07-31 15:09:43,509 INFO - botocore.vendored.requests.packages.urllib3.connectionpool - Starting new HTTPS connection (1): s3.amazonaws.com\r\n2018-07-31 15:09:43,608 INFO - tf_container - ----------------------TF_CONFIG--------------------------\r\n2018-07-31 15:09:43,608 INFO - tf_container - {\"environment\": \"cloud\", \"cluster\": {\"master\": [\"algo-1:2222\"]}, \"task\": {\"index\": 0, \"type\": \"master\"}}\r\n2018-07-31 15:09:43,608 INFO - tf_container - ---------------------------------------------------------\r\n2018-07-31 15:09:43,608 INFO - tf_container - creating RunConfig:\r\n2018-07-31 15:09:43,609 INFO - tf_container - {'save_checkpoints_secs': 300}\r\n2018-07-31 15:09:43,609 INFO - tensorflow - TF_CONFIG environment variable: {u'environment': u'cloud', u'cluster': {u'master': [u'algo-1:2222']}, u'task': {u'index': 0, u'type': u'master'}}\r\n2018-07-31 15:09:43,609 INFO - tf_container - invoking the user-provided keras_model_fn\r\n2018-07-31 15:09:44,629 INFO - sagemaker - None\r\n2018-07-31 15:09:44,629 INFO - tensorflow - Using the Keras model provided.\r\n2018-07-31 15:09:44,629 INFO - tensorflow - Using config: {'_save_checkpoints_secs': 300, '_session_config': None, '_keep_checkpoint_max': 5, '_tf_random_seed': None, '_task_type': u'master', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fdf257c3a50>, '_model_dir': u's3://sagemaker-poc-test/artifacts/tf-lstm-test-pipe-mode-temp16-2018-07-31-15-05-21-747/checkpoints', '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': 100, '_master': '', '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_evaluation_master': '', '_service': None, '_global_id_in_cluster': 0, '_save_summary_steps': 100, '_num_ps_replicas': 0}\r\n2018-07-31 15:09:58,402 INFO - tensorflow - Skip starting Tensorflow server as there is only one node in the cluster.\r\n2018-07-31 15:09:58,736 INFO - sagemaker - train input fn: None\r\n2018-07-31 15:09:58,768 INFO - tensorflow - Calling model_fn.\r\n2018-07-31 15:10:02,559 INFO - tensorflow - Done calling model_fn.\r\n2018-07-31 15:10:02,560 INFO - tensorflow - Create CheckpointSaverHook.\r\n2018-07-31 15:10:03,886 INFO - tensorflow - Graph was finalized.\r\n2018-07-31 15:10:04,228 INFO - tensorflow - Restoring parameters from s3://sagemaker-poc-test/artifacts/tf-lstm-test-pipe-mode-temp16-2018-07-31-15-05-21-747/checkpoints/keras_model.ckpt\r\n2018-07-31 15:10:05,005 INFO - tensorflow - Running local_init_op.\r\n2018-07-31 15:10:05,057 INFO - tensorflow - Done running local_init_op.\r\n2018-07-31 15:10:11,480 INFO - tensorflow - Saving checkpoints for 1 into s3://sagemaker-poc-test/artifacts/tf-lstm-test-pipe-mode-temp16-2018-07-31-15-05-21-747/checkpoints/model.ckpt.\r\n2018-07-31 15:10:14,595 INFO - sagemaker - eval input fn: None\r\n2018-07-31 15:10:14,616 INFO - tensorflow - Calling model_fn.\r\n2018-07-31 15:10:15,951 INFO - tensorflow - Done calling model_fn.\r\n2018-07-31 15:10:15,971 INFO - tensorflow - Starting evaluation at 2018-07-31-15:10:15\r\n2018-07-31 15:10:16,096 INFO - tensorflow - Graph was finalized.\r\n2018-07-31 15:10:16,098 INFO - tensorflow - Restoring parameters from s3://sagemaker-poc-test/artifacts/tf-lstm-test-pipe-mode-temp16-2018-07-31-15-05-21-747/checkpoints/model.ckpt-1\r\n2018-07-31 15:10:16,407 INFO - tensorflow - Running local_init_op.\r\n2018-07-31 15:10:16,450 INFO - tensorflow - Done running local_init_op.\r\n**2018-07-31 15:10:19.357309: F ./tensorflow/core/util/cuda_launch_config.h:127] Check failed: work_element_count > 0 (0 vs. 0)**\r\nDownloading s3://sagemaker-poc-test/customcode/tensorflow_test/tf-lstm-test-pipe-mode-temp16-2018-07-31-15-05-21-747/source/sourcedir.tar.gz to /tmp/script.tar.gz", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/330/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/330/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/296", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/296/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/296/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/296/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/296", "id": 341640825, "node_id": "MDU6SXNzdWUzNDE2NDA4MjU=", "number": 296, "title": "The TensorFlow container saves the exported models in Ascending order", "user": {"login": "chinazm", "id": 7229876, "node_id": "MDQ6VXNlcjcyMjk4NzY=", "avatar_url": "https://avatars.githubusercontent.com/u/7229876?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chinazm", "html_url": "https://github.com/chinazm", "followers_url": "https://api.github.com/users/chinazm/followers", "following_url": "https://api.github.com/users/chinazm/following{/other_user}", "gists_url": "https://api.github.com/users/chinazm/gists{/gist_id}", "starred_url": "https://api.github.com/users/chinazm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chinazm/subscriptions", "organizations_url": "https://api.github.com/users/chinazm/orgs", "repos_url": "https://api.github.com/users/chinazm/repos", "events_url": "https://api.github.com/users/chinazm/events{/privacy}", "received_events_url": "https://api.github.com/users/chinazm/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-07-16T19:07:47Z", "updated_at": "2018-07-19T21:06:59Z", "closed_at": "2018-07-19T21:06:54Z", "author_association": "NONE", "active_lock_reason": null, "body": "We found that there is a bug in sagemaker to export the model:\r\n\r\nsagemaker first exported checkpoints as exported models in the output folder and after training there will be a final model zipped and exported. We found sagemaker exported and zipped the models on ascending order not the most recent model exported.", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/296/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/296/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/291", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/291/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/291/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/291/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/291", "id": 341070231, "node_id": "MDU6SXNzdWUzNDEwNzAyMzE=", "number": 291, "title": "[Documentation Request] Sagemaker update requires new IAM permissions", "user": {"login": "zmjjmz", "id": 1694612, "node_id": "MDQ6VXNlcjE2OTQ2MTI=", "avatar_url": "https://avatars.githubusercontent.com/u/1694612?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zmjjmz", "html_url": "https://github.com/zmjjmz", "followers_url": "https://api.github.com/users/zmjjmz/followers", "following_url": "https://api.github.com/users/zmjjmz/following{/other_user}", "gists_url": "https://api.github.com/users/zmjjmz/gists{/gist_id}", "starred_url": "https://api.github.com/users/zmjjmz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zmjjmz/subscriptions", "organizations_url": "https://api.github.com/users/zmjjmz/orgs", "repos_url": "https://api.github.com/users/zmjjmz/repos", "events_url": "https://api.github.com/users/zmjjmz/events{/privacy}", "received_events_url": "https://api.github.com/users/zmjjmz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 892238348, "node_id": "MDU6TGFiZWw4OTIyMzgzNDg=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/type:%20documentation", "name": "type: documentation", "color": "002b36", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2018-07-13T15:49:36Z", "updated_at": "2020-03-17T17:42:45Z", "closed_at": "2018-12-24T22:43:41Z", "author_association": "NONE", "active_lock_reason": null, "body": "### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**: (n/a)\r\n- **Framework Version**: (n/a)\r\n- **Python Version**: 2.7.9\r\n- **CPU or GPU**: (n/a)\r\n- **Python SDK Version**: 1.5.3\r\n- **Are you using a custom image**: (n/a)\r\n\r\n### Describe the problem\r\nOur ops team has fairly locked down IAM permissions, and when initially using the Sagemaker SDK I had to trial-and-error which ones I needed. In the most recent version of the Sagemaker SDK PR [268](https://github.com/aws/sagemaker-python-sdk/pull/268) introduced a new requirement that any role used by the Sagemaker SDK needed `iam:GetRole` granted, which I did not have previously granted for this role. While it wasn't hard to get this role granted, it was a breaking change for us that I would have appreciated a warning for.\r\n\r\nIs there documentation on what IAM permissions are used by the SDK? If so, I'd just like to request that new permissions end up in the changelog / with a warning so that it's not a surprise.\r\n\r\n### Minimal repro / logs\r\nI don't have a good way to minimal repro this since of course you'd need our IAM setup, which is not doable :)\r\n\r\nHere's the exact error I got though:\r\n```\r\nbotocore.exceptions.ClientError: An error occurred (AccessDenied) when calling the GetRole operation: User: arn:aws:sts::<withheld>:assumed-role/sagemaker-user-role/\r\nbotocore-session-1531238236 is not authorized to perform: iam:GetRole on resource: role sagemaker-user-role\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/291/reactions", "total_count": 14, "+1": 14, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/291/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/276", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/276/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/276/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/276/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/276", "id": 338574961, "node_id": "MDU6SXNzdWUzMzg1NzQ5NjE=", "number": 276, "title": "[BUG] Error thrown when trying to enable instance metrics for MXNet", "user": {"login": "humanzz", "id": 5001, "node_id": "MDQ6VXNlcjUwMDE=", "avatar_url": "https://avatars.githubusercontent.com/u/5001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/humanzz", "html_url": "https://github.com/humanzz", "followers_url": "https://api.github.com/users/humanzz/followers", "following_url": "https://api.github.com/users/humanzz/following{/other_user}", "gists_url": "https://api.github.com/users/humanzz/gists{/gist_id}", "starred_url": "https://api.github.com/users/humanzz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/humanzz/subscriptions", "organizations_url": "https://api.github.com/users/humanzz/orgs", "repos_url": "https://api.github.com/users/humanzz/repos", "events_url": "https://api.github.com/users/humanzz/events{/privacy}", "received_events_url": "https://api.github.com/users/humanzz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 850818746, "node_id": "MDU6TGFiZWw4NTA4MTg3NDY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/status:%20pending%20release", "name": "status: pending release", "color": "eee8d5", "default": false, "description": "issues for which fixes have been merged but not released to PyPI"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2018-07-05T13:28:07Z", "updated_at": "2019-04-17T19:08:31Z", "closed_at": "2019-04-17T19:08:31Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Please fill out the form below.\r\n\r\n### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**: MXNet\r\n- **Framework Version**: 1.1\r\n- **Python Version**: 3\r\n- **CPU or GPU**: CPU\r\n- **Python SDK Version**: 1.5.1\r\n- **Are you using a custom image**: No\r\n\r\n### Describe the problem\r\nThe MXNet container by default does not emit instance metrics. When trying to enable it setting `enable_cloudwatch_metrics=True`, the training job fails with the exception pasted below.\r\n\r\n### Minimal repro / logs\r\n#### Command to train (note it uses some of my own python code as it's a custom MXNet model)\r\n```\r\n    m = MXNet(\"kamel_estimator.py\",\r\n              source_dir='src',\r\n              role=role,\r\n              train_instance_count=1,\r\n              train_instance_type=\"ml.m4.xlarge\",\r\n              sagemaker_session=sagemaker_session,\r\n              py_version=\"py3\",\r\n              base_job_name=\"kamel-test-20180705\",\r\n              enable_cloudwatch_metrics=True,\r\n              output_path=get_config(current_env, 'artifacts_s3_bucket'),\r\n              code_location=get_config(current_env, 'artifacts_s3_bucket'),\r\n              hyperparameters={'some_param': 1)\r\nm.fit('s3://kamel-data/training/data)\r\n```\r\n\r\n#### Training job CloudWatch log showing the error\r\n```\r\n2018-07-05 11:30:31,569 INFO - root - running container entrypoint\r\n2018-07-05 11:30:31,570 INFO - root - starting train task\r\n2018-07-05 11:30:31,573 INFO - container_support.training - Training starting\r\n2018-07-05 11:30:31,575 INFO - container_support.environment - starting metrics service\r\n2018-07-05 11:30:31,578 ERROR - container_support.training - uncaught exception during training: [Errno 2] No such file or directory: 'telegraf'\r\nTraceback (most recent call last):\r\nFile \"/usr/local/lib/python3.5/dist-packages/container_support/training.py\", line 32, in start\r\nenv.start_metrics_if_enabled()\r\nFile \"/usr/local/lib/python3.5/dist-packages/container_support/environment.py\", line 124, in start_metrics_if_enabled\r\nsubprocess.Popen(['telegraf', '--config', telegraf_conf])\r\nFile \"/usr/lib/python3.5/subprocess.py\", line 947, in __init__\r\nrestore_signals, start_new_session)\r\nFile \"/usr/lib/python3.5/subprocess.py\", line 1551, in _execute_child\r\nraise child_exception_type(errno_num, err_msg)\r\nFileNotFoundError: [Errno 2] No such file or directory: 'telegraf'\r\n```\r\n\r\n### Notes\r\n- I am suspecting the issue is not actually with the Python SDK, but with the container itself not having the necessary library\r\n- I am opening the issue here as this is the entry point that exposes the problem\r\n- All over the SDK, `enable_cloudwatch_metrics` is always set to `False`. This might be due to the knowledge that the containers not supporting it. Otherwise, testing for cases with `enable_cloudwatch_metrics=True` sound like something that should be added.\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/276/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/276/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/273", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/273/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/273/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/273/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/273", "id": 337290415, "node_id": "MDU6SXNzdWUzMzcyOTA0MTU=", "number": 273, "title": "Missing parameter in call to training_job_analytics", "user": {"login": "JonathanTaws", "id": 5551830, "node_id": "MDQ6VXNlcjU1NTE4MzA=", "avatar_url": "https://avatars.githubusercontent.com/u/5551830?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JonathanTaws", "html_url": "https://github.com/JonathanTaws", "followers_url": "https://api.github.com/users/JonathanTaws/followers", "following_url": "https://api.github.com/users/JonathanTaws/following{/other_user}", "gists_url": "https://api.github.com/users/JonathanTaws/gists{/gist_id}", "starred_url": "https://api.github.com/users/JonathanTaws/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JonathanTaws/subscriptions", "organizations_url": "https://api.github.com/users/JonathanTaws/orgs", "repos_url": "https://api.github.com/users/JonathanTaws/repos", "events_url": "https://api.github.com/users/JonathanTaws/events{/privacy}", "received_events_url": "https://api.github.com/users/JonathanTaws/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-07-01T13:16:17Z", "updated_at": "2018-07-05T23:41:58Z", "closed_at": "2018-07-05T23:41:58Z", "author_association": "NONE", "active_lock_reason": null, "body": "Code to reproduce (any initialized estimator): \r\n`estimator.training_job_analytics`\r\n\r\nhttps://github.com/aws/sagemaker-python-sdk/blob/864c653cfae62e9cbb1653ccf5648dc1bc246e65/src/sagemaker/estimator.py#L322\r\n\r\nWhen trying to get the training job analytics using the training_job_analytics property of an estimator, I get the following error:\r\n\r\n```\r\nTypeError                                 Traceback (most recent call last)\r\n<ipython-input-145-5976c283bde7> in <module>()\r\n----> 1 estimator.training_job_analytics\r\n\r\n~/anaconda3/envs/mxnet_p36/lib/python3.6/site-packages/sagemaker/estimator.py in training_job_analytics(self)\r\n    325         if self._current_job_name is None:\r\n    326             raise ValueError('Estimator is not associated with a TrainingJob')\r\n--> 327         return TrainingJobAnalytics(self._current_job_name)\r\n    328 \r\n    329 \r\n\r\nTypeError: __init__() missing 1 required positional argument: 'metric_names'\r\n```\r\n\r\nIt seems like the TrainingJobAnalytics class is expectif the metric_names parameter, but this property method is not supplying it, and it should be a parameter as such:\r\n`def training_job_analytics(self, metric_names)`", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/273/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/273/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/269", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/269/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/269/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/269/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/269", "id": 336909498, "node_id": "MDU6SXNzdWUzMzY5MDk0OTg=", "number": 269, "title": "Vague input error for trained TensorFlow model", "user": {"login": "teddyward", "id": 5324890, "node_id": "MDQ6VXNlcjUzMjQ4OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/5324890?v=4", "gravatar_id": "", "url": "https://api.github.com/users/teddyward", "html_url": "https://github.com/teddyward", "followers_url": "https://api.github.com/users/teddyward/followers", "following_url": "https://api.github.com/users/teddyward/following{/other_user}", "gists_url": "https://api.github.com/users/teddyward/gists{/gist_id}", "starred_url": "https://api.github.com/users/teddyward/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/teddyward/subscriptions", "organizations_url": "https://api.github.com/users/teddyward/orgs", "repos_url": "https://api.github.com/users/teddyward/repos", "events_url": "https://api.github.com/users/teddyward/events{/privacy}", "received_events_url": "https://api.github.com/users/teddyward/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-06-29T08:28:21Z", "updated_at": "2018-12-20T21:36:18Z", "closed_at": "2018-12-20T21:36:18Z", "author_association": "NONE", "active_lock_reason": null, "body": "I am trying to retrain and deploy our team's previously-already-working TensorFlow model onto SageMaker... having no luck after several days of banging my head against it. Any help that you all can provide on how to massage this into SageMaker would be greatly appreciated... about to give up and just run an AMI\r\n\r\nEvery time that I try to make a prediction/inference request on my trained, evaluated, and deployed model, I get the error\r\n```\r\nModelError: An error occurred (ModelError) when calling the InvokeEndpoint operation: Received server error (500) from model with message \"\"\r\n```\r\n\r\nSimilar to #67, and probably a duplicate of #99\r\n\r\nServing input function is basically identical to the TensorFlow tutorial:\r\n\r\n```\r\nCSV_COLUMNS = ['reading', 'temperature', 'hour', 'weekday', 'is_holiday', 'area', 'structure_area', 'has_pv']\r\nLABEL_COLUMN = 'reading'\r\nCSV_COLUMN_DEFAULTS = [[0.0], [0.0], [0], [0], [0], [0.0], [2000.0], [0]]\r\nUNUSED_COLUMNS = set(CSV_COLUMNS) - {col.name for col in INPUT_COLUMNS} - \\\r\n    {LABEL_COLUMN}\r\n\r\ndef estimator_fn(run_config, params):\r\n ... build and return DNNRegressor ...\r\n\r\ndef serving_input_fn():\r\n    csv_row = tf.placeholder(\r\n        shape=[None],\r\n        dtype=tf.string\r\n    )\r\n    features = parse_csv(csv_row)\r\n    features.pop(LABEL_COLUMN)\r\n    return tf.estimator.export.ServingInputReceiver(features, {'csv_row': csv_row})\r\n\r\n\r\ndef parse_csv(rows_string_tensor):\r\n    \"\"\"Takes the string input tensor and returns a dict of rank-2 tensors.\"\"\"\r\n\r\n    # Takes a rank-1 tensor and converts it into rank-2 tensor\r\n    # Example if the data is ['csv,line,1', 'csv,line,2', ..] to\r\n    # [['csv,line,1'], ['csv,line,2']] which after parsing will result in a\r\n    # tuple of tensors: [['csv'], ['csv']], [['line'], ['line']], [[1], [2]]\r\n    row_columns = tf.expand_dims(rows_string_tensor, -1)\r\n    columns = tf.decode_csv(row_columns, record_defaults=CSV_COLUMN_DEFAULTS)\r\n    features = dict(zip(CSV_COLUMNS, columns))\r\n\r\n    # Remove unused columns\r\n    for col in UNUSED_COLUMNS:\r\n      features.pop(col)\r\n    return features\r\n```\r\n\r\nLogs:\r\n```\r\n\uf13f\r\n17:04:12\r\nTraceback (most recent call last): File \"/usr/local/lib/python2.7/dist-packages/container_support/serving.py\", line 180, in _invoke self.transformer.transform(content, input_content_type, requested_output_content_type) File \"/usr/local/lib/python2.7/dist-packages/tf_container/serve.py\", line 281, in transform return self.transform_fn(data, content_type, accepts), accepts File \"/usr/l\r\n\uf189AllTraffic/i-0933877fa79ea8c2f\r\nTraceback (most recent call last):\r\nFile \"/usr/local/lib/python2.7/dist-packages/container_support/serving.py\", line 180, in _invoke\r\nself.transformer.transform(content, input_content_type, requested_output_content_type)\r\nFile \"/usr/local/lib/python2.7/dist-packages/tf_container/serve.py\", line 281, in transform\r\nreturn self.transform_fn(data, content_type, accepts), accepts\r\nFile \"/usr/local/lib/python2.7/dist-packages/tf_container/serve.py\", line 206, in f\r\nprediction = self.predict_fn(input)\r\nFile \"/usr/local/lib/python2.7/dist-packages/tf_container/serve.py\", line 221, in predict_fn\r\nreturn self.proxy_client.request(data)\r\nFile \"/usr/local/lib/python2.7/dist-packages/tf_container/proxy_client.py\", line 66, in request\r\nrequest_fn = self.request_fn_map[self.prediction_type]\r\n\uf13f\r\n17:04:12\r\nKeyError: u'tensorflow/serving/regress'\r\n\uf189AllTraffic/i-0933877fa79ea8c2f\r\nKeyError: u'tensorflow/serving/regress'\r\n\uf13f\r\n17:04:12\r\n[2018-06-29 17:04:11,861] ERROR in serving: u'tensorflow/serving/regress'\r\n\uf189AllTraffic/i-0933877fa79ea8c2f\r\n[2018-06-29 17:04:11,861] ERROR in serving: u'tensorflow/serving/regress'\r\n```", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/269/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/269/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/263", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/263/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/263/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/263/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/263", "id": 336384935, "node_id": "MDU6SXNzdWUzMzYzODQ5MzU=", "number": 263, "title": "tensorflow:1.8-gpu-py2 image doesn't utilize GPU ", "user": {"login": "WuyangLI", "id": 6955119, "node_id": "MDQ6VXNlcjY5NTUxMTk=", "avatar_url": "https://avatars.githubusercontent.com/u/6955119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WuyangLI", "html_url": "https://github.com/WuyangLI", "followers_url": "https://api.github.com/users/WuyangLI/followers", "following_url": "https://api.github.com/users/WuyangLI/following{/other_user}", "gists_url": "https://api.github.com/users/WuyangLI/gists{/gist_id}", "starred_url": "https://api.github.com/users/WuyangLI/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WuyangLI/subscriptions", "organizations_url": "https://api.github.com/users/WuyangLI/orgs", "repos_url": "https://api.github.com/users/WuyangLI/repos", "events_url": "https://api.github.com/users/WuyangLI/events{/privacy}", "received_events_url": "https://api.github.com/users/WuyangLI/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-06-27T20:58:12Z", "updated_at": "2018-06-29T21:00:35Z", "closed_at": "2018-06-29T21:00:35Z", "author_association": "NONE", "active_lock_reason": null, "body": "Please fill out the form below.\r\n\r\n### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**: Tensorflow\r\n- **Framework Version**: 1.8\r\n- **Python Version**: 2\r\n- **CPU or GPU**: GPU\r\n- **Python SDK Version**: 1.5.1\r\n- **Are you using a custom image**: no\r\n\r\n### Describe the problem\r\nI started a tensorflow job, which uses tensorflow:1.8-gpu-py2 image for training. Full tag of the image is :\r\n520713654638.dkr.ecr.us-east-1.amazonaws.com/sagemaker-tensorflow:1.8-gpu-py2\r\nI used ml.p2.xlarge for training, on which GPU is available.\r\nHowever, as the metrics on cloud watch shows, for both of the workers, GPU utilization stays zero.\r\n\r\n### Minimal repro / logs\r\nMetrics on cloud watch indicates that GPU is not used\r\n\r\n### Code\r\ncode for starting training job\r\n```\r\nimport sagemaker\r\n\r\nfrom sagemaker.tensorflow import TensorFlow\r\nfrom sagemaker.session import s3_input\r\nfrom sagemaker import get_execution_role\r\n\r\nsagemaker_session = sagemaker.Session()\r\nrole = get_execution_role()\r\ntraining_steps = 100\r\nevaluation_steps = 10\r\n\r\nestimator = TensorFlow(\r\n    entry_point='keras_distributed_transfer_learning.py',\r\n    source_dir='./',\r\n    role=role,\r\n    training_steps=100,\r\n    evaluation_steps=10,\r\n    train_instance_count=2,\r\n    train_instance_type='ml.p2.xlarge',\r\n    input_mode='File')\r\n\r\ninput_dataset = s3_input('s3://xxxx/cats_and_dogs/')\r\nestimator.fit(input_dataset)\r\n```\r\nkeras_distributed_transfer_learning.py\r\n```\r\nimport tensorflow as tf\r\nfrom tensorflow.python.estimator.model_fn import ModeKeys as Modes\r\n\r\nINPUT_TENSOR_NAME = \"input_1\"\r\nNUM_CLASSES = 2\r\nBATCH_SIZE = 10\r\n\r\n\r\ndef model_fn(features, labels, mode, params):\r\n    \"\"\"The model_fn argument for creating an Estimator.\"\"\"\r\n    backend = tf.keras.applications.vgg16.VGG16(weights=None, \r\n                                                include_top=False,\r\n                                                input_shape=(224, 224, 3))\r\n    x = backend.output\r\n    x = tf.keras.layers.Flatten()(x)\r\n    x = tf.keras.layers.Dense(NUM_CLASSES, activation='softmax')(x)\r\n    model = tf.keras.models.Model(inputs=backend.input, outputs=x)\r\n    image = tf.keras.layers.Input(tensor=features[INPUT_TENSOR_NAME])\r\n    # Define operations\r\n    if mode in (Modes.PREDICT, Modes.EVAL):\r\n        logits = model(image, training=False)\r\n        predicted_indices = tf.argmax(input=logits, axis=1)\r\n        probabilities = tf.nn.softmax(logits, name='softmax_tensor')\r\n\r\n    if mode in (Modes.TRAIN):\r\n        logits = model(image, training=True)\r\n        global_step = tf.train.get_or_create_global_step()\r\n        loss = tf.losses.softmax_cross_entropy(\r\n            onehot_labels=labels, logits=logits)\r\n        tf.summary.scalar('OptimizeLoss', loss)\r\n        \r\n    if mode in (Modes.EVAL):\r\n        logits = model(image, training=False)\r\n        global_step = tf.train.get_or_create_global_step()\r\n        loss = tf.losses.softmax_cross_entropy(\r\n            onehot_labels=labels, logits=logits)\r\n        tf.summary.scalar('OptimizeLoss', loss)\r\n\r\n    if mode == Modes.PREDICT:\r\n        predictions = {\r\n            'classes': predicted_indices,\r\n            'probabilities': probabilities\r\n        }\r\n        export_outputs = {\r\n            'predictions': tf.estimator.export.PredictOutput(predictions)\r\n        }\r\n        return tf.estimator.EstimatorSpec(\r\n            mode, predictions=predictions, export_outputs=export_outputs)\r\n\r\n    if mode == Modes.TRAIN:\r\n        optimizer = tf.train.AdamOptimizer(learning_rate=0.001)\r\n        train_op = optimizer.minimize(loss, global_step=global_step)\r\n        return tf.estimator.EstimatorSpec(mode, loss=loss, train_op=train_op)\r\n\r\n    if mode == Modes.EVAL:\r\n        eval_metric_ops = {\r\n            'accuracy': tf.metrics.accuracy(tf.argmax(labels, 1), predicted_indices)\r\n        }\r\n        return tf.estimator.EstimatorSpec(\r\n            mode, loss=loss, eval_metric_ops=eval_metric_ops)\r\n\r\n\r\ndef _input_fn(training_dir, input_shape, batch_size):\r\n    generator = tf.keras.preprocessing.image.ImageDataGenerator().flow_from_directory(training_dir, target_size=input_shape, batch_size=batch_size)\r\n\r\n    tensor_shapes = (tf.TensorShape([None, input_shape[0], input_shape[1], 3]), tf.TensorShape([None, NUM_CLASSES]))\r\n    tensor_types = (tf.float32, tf.float32)\r\n    dataset = tf.data.Dataset.from_generator(lambda: generator, tensor_types, tensor_shapes)\r\n    features, labels = dataset.make_one_shot_iterator().get_next()\r\n    return {INPUT_TENSOR_NAME: features}, labels\r\n\r\n\r\ndef train_input_fn(training_dir, hyperparameters):\r\n    return _input_fn(training_dir + '/train/', (224, 224), BATCH_SIZE)\r\n\r\n\r\ndef eval_input_fn(training_dir, hyperparameters):\r\n    return _input_fn(training_dir + '/test/', (224, 224), BATCH_SIZE)\r\n\r\n\r\ndef serving_input_fn(hyperparameters):\r\n    inputs = {INPUT_TENSOR_NAME: tf.placeholder(tf.float32, [None, 224, 224, 3])}\r\n    return tf.estimator.export.ServingInputReceiver(inputs, inputs)\r\n```", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/263/reactions", "total_count": 4, "+1": 4, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/263/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/245", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/245/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/245/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/245/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/245", "id": 334462381, "node_id": "MDU6SXNzdWUzMzQ0NjIzODE=", "number": 245, "title": "OSError: [Errno 21] Is a directory. (On local Mode)", "user": {"login": "Shivakishore14", "id": 13432471, "node_id": "MDQ6VXNlcjEzNDMyNDcx", "avatar_url": "https://avatars.githubusercontent.com/u/13432471?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Shivakishore14", "html_url": "https://github.com/Shivakishore14", "followers_url": "https://api.github.com/users/Shivakishore14/followers", "following_url": "https://api.github.com/users/Shivakishore14/following{/other_user}", "gists_url": "https://api.github.com/users/Shivakishore14/gists{/gist_id}", "starred_url": "https://api.github.com/users/Shivakishore14/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Shivakishore14/subscriptions", "organizations_url": "https://api.github.com/users/Shivakishore14/orgs", "repos_url": "https://api.github.com/users/Shivakishore14/repos", "events_url": "https://api.github.com/users/Shivakishore14/events{/privacy}", "received_events_url": "https://api.github.com/users/Shivakishore14/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 850818746, "node_id": "MDU6TGFiZWw4NTA4MTg3NDY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/status:%20pending%20release", "name": "status: pending release", "color": "eee8d5", "default": false, "description": "issues for which fixes have been merged but not released to PyPI"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2018-06-21T12:02:53Z", "updated_at": "2018-06-26T21:57:54Z", "closed_at": "2018-06-26T21:57:54Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**: Tensorflow custom algorithm\r\n- **Framework Version**: 1.4.1\r\n- **Python Version**: 2.7\r\n- **CPU or GPU**: CPU\r\n- **Python SDK Version**: 1.5.0\r\n- **Are you using a custom image**: No\r\n\r\n### Describe the problem\r\nI get `OSError: [Errno 21] Is a directory` when training locally on my machine(MacBook Pro). \r\n```\r\nfrom sagemaker.tensorflow import TensorFlow\r\n\r\n#Bucket location to save your custom code in tar.gz format.\r\ncustom_code_upload_location = 's3://sagemaker-<rest of bucket name>/customcode/tensorflow'\r\n\r\n#Bucket location where results of model training are saved.\r\nmodel_artifacts_location = 's3://sagemaker-<rest of bucket name>/artifacts'\r\n\r\nrole = \"arn:aws:iam::****\" # commented out\r\n\r\niris_estimator = TensorFlow(entry_point='sagemaker-test.py',\r\n                            role=role,\r\n                            output_path=model_artifacts_location,\r\n                            code_location=custom_code_upload_location,\r\n                            train_instance_count=1,\r\n                            hyperparameters={'dropout_keep_prob': 0.5},\r\n                            train_instance_type='local',\r\n                            training_steps=1000,\r\n                            evaluation_steps=10)\r\n\r\nprint (iris_estimator)\r\n\r\ntrain_data_location = 's3://sagemaker-<rest of bucket name>'\r\n\r\niris_estimator.fit(train_data_location)\r\n\r\n```\r\n\r\nthe custom algorithm `sagemaker-test.py` is created by following [this tutorial](https://docs.aws.amazon.com/sagemaker/latest/dg/tf-example1.html)\r\n\r\nthe above code is working in sagemaker notebook instance with `train_instance_type='ml.c4.xlarge'`, I am facing this issue only when running locally. \r\n\r\n### Minimal repro / logs\r\n```\r\n<sagemaker.tensorflow.estimator.TensorFlow object at 0x107b86610>\r\nINFO:sagemaker:Creating training-job with name: sagemaker-tensorflow-2018-06-21-11-17-58-273\r\nTraceback (most recent call last):\r\n  File \"test.py\", line 28, in <module>\r\n    iris_estimator.fit(train_data_location)\r\n  File \"/Library/Python/2.7/site-packages/sagemaker/tensorflow/estimator.py\", line 243, in fit\r\n    fit_super()\r\n  File \"/Library/Python/2.7/site-packages/sagemaker/tensorflow/estimator.py\", line 225, in fit_super\r\n    super(TensorFlow, self).fit(inputs, wait, logs, job_name)\r\n  File \"/Library/Python/2.7/site-packages/sagemaker/estimator.py\", line 177, in fit\r\n    self.latest_training_job = _TrainingJob.start_new(self, inputs)\r\n  File \"/Library/Python/2.7/site-packages/sagemaker/estimator.py\", line 362, in start_new\r\n    stop_condition=config['stop_condition'], tags=estimator.tags)\r\n  File \"/Library/Python/2.7/site-packages/sagemaker/session.py\", line 264, in train\r\n    self.sagemaker_client.create_training_job(**train_request)\r\n  File \"/Library/Python/2.7/site-packages/sagemaker/local/local_session.py\", line 75, in create_training_job\r\n    self.s3_model_artifacts = self.train_container.train(InputDataConfig, HyperParameters)\r\n  File \"/Library/Python/2.7/site-packages/sagemaker/local/image.py\", line 95, in train\r\n    volumes = self._prepare_training_volumes(data_dir, input_data_config, hyperparameters)\r\n  File \"/Library/Python/2.7/site-packages/sagemaker/local/image.py\", line 312, in _prepare_training_volumes\r\n    self._download_folder(bucket_name, key, channel_dir)\r\n  File \"/Library/Python/2.7/site-packages/sagemaker/local/image.py\", line 275, in _download_folder\r\n    obj.download_file(file_path)\r\n  File \"/Library/Python/2.7/site-packages/boto3/s3/inject.py\", line 314, in object_download_file\r\n    ExtraArgs=ExtraArgs, Callback=Callback, Config=Config)\r\n  File \"/Library/Python/2.7/site-packages/boto3/s3/inject.py\", line 172, in download_file\r\n    extra_args=ExtraArgs, callback=Callback)\r\n  File \"/Library/Python/2.7/site-packages/boto3/s3/transfer.py\", line 307, in download_file\r\n    future.result()\r\n  File \"/Library/Python/2.7/site-packages/s3transfer/futures.py\", line 73, in result\r\n    return self._coordinator.result()\r\n  File \"/Library/Python/2.7/site-packages/s3transfer/futures.py\", line 233, in result\r\n    raise self._exception\r\nOSError: [Errno 21] Is a directory\r\n```\r\nThanks in advance\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/245/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/245/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/231", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/231/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/231/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/231/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/231", "id": 332430185, "node_id": "MDU6SXNzdWUzMzI0MzAxODU=", "number": 231, "title": "ImportError: Could not import PIL.Image.", "user": {"login": "WuyangLI", "id": 6955119, "node_id": "MDQ6VXNlcjY5NTUxMTk=", "avatar_url": "https://avatars.githubusercontent.com/u/6955119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WuyangLI", "html_url": "https://github.com/WuyangLI", "followers_url": "https://api.github.com/users/WuyangLI/followers", "following_url": "https://api.github.com/users/WuyangLI/following{/other_user}", "gists_url": "https://api.github.com/users/WuyangLI/gists{/gist_id}", "starred_url": "https://api.github.com/users/WuyangLI/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WuyangLI/subscriptions", "organizations_url": "https://api.github.com/users/WuyangLI/orgs", "repos_url": "https://api.github.com/users/WuyangLI/repos", "events_url": "https://api.github.com/users/WuyangLI/events{/privacy}", "received_events_url": "https://api.github.com/users/WuyangLI/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 850818746, "node_id": "MDU6TGFiZWw4NTA4MTg3NDY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/status:%20pending%20release", "name": "status: pending release", "color": "eee8d5", "default": false, "description": "issues for which fixes have been merged but not released to PyPI"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-06-14T14:33:47Z", "updated_at": "2018-06-27T01:04:01Z", "closed_at": "2018-06-27T01:04:01Z", "author_association": "NONE", "active_lock_reason": null, "body": "### System Information\r\n- **Framework (e.g. TensorFlow) / Algorithm (e.g. KMeans)**: tensorflow, keras\r\n- **Framework Version**: 1.5.0\r\n- **Python Version**: 2.7\r\n- **CPU or GPU**: GPU\r\n- **Python SDK Version**: 1.4.1\r\n- **Are you using a custom image**: No\r\n\r\n### Describe the problem\r\nPillow installed using requirements.txt is not recognized by Keras.\r\nKeras ImageDataGenerator throws the following exception:\r\nUnknownError: exceptions.ImportError: Could not import PIL.Image. The use of `array_to_img` requires PIL.\r\nThis issue may be related to issue #84  Could Pillow also be included in the docker image (as done with h5py)?\r\n\r\n### Minimal repro / logs\r\n\r\n**keras_pillow.py** \r\n\r\n```\r\nimport tensorflow as tf\r\n\r\nINPUT_TENSOR_NAME = \"input_1\"\r\nNUM_CLASSES = 2\r\nBATCH_SIZE = 10\r\n\r\n\r\ndef keras_model_fn(hyperparameters):\r\n    model = tf.keras.applications.vgg16.VGG16(include_top=True, weights=None, classes=NUM_CLASSES)\r\n    model.compile(optimizer='adam', loss='categorical_crossentropy', metrics=['accuracy'])\r\n    return model\r\n\r\n\r\ndef _input_fn(training_dir, input_shape, batch_size):\r\n    preprocess_input = tf.keras.applications.vgg16.preprocess_input\r\n\r\n    generator = tf.keras.preprocessing.image.ImageDataGenerator(preprocessing_function=preprocess_input)\\\r\n        .flow_from_directory(training_dir, target_size=input_shape, batch_size=batch_size)\r\n\r\n    tensor_shapes = (tf.TensorShape([None, input_shape[0], input_shape[1], 3]), tf.TensorShape([None, NUM_CLASSES]))\r\n    tensor_types = (tf.float32, tf.float32)\r\n    dataset = tf.data.Dataset.from_generator(lambda: generator, tensor_types, tensor_shapes)\r\n    features, labels = dataset.make_one_shot_iterator().get_next()\r\n    return {INPUT_TENSOR_NAME: features}, labels\r\n\r\n\r\ndef train_input_fn(training_dir, hyperparameters):\r\n    return _input_fn(training_dir + '/train/', (224, 224), BATCH_SIZE)\r\n\r\n\r\ndef eval_input_fn(training_dir, hyperparameters):\r\n    return _input_fn(training_dir + '/test/', (224, 224), BATCH_SIZE)\r\n\r\n\r\ndef serving_input_fn(hyperparameters):\r\n    inputs = {INPUT_TENSOR_NAME: tf.placeholder(tf.float32, [None, 224, 224, 3])}\r\n    return tf.estimator.export.ServingInputReceiver(inputs, inputs)\r\n```\r\n\r\n\r\n**requirements.txt**\r\n\r\n```\r\nPillow\r\n```\r\n\r\n**Training job**\r\n\r\n```\r\nimport sagemaker\r\n\r\nfrom sagemaker.tensorflow import TensorFlow\r\nfrom sagemaker.session import s3_input\r\nfrom sagemaker import get_execution_role\r\n\r\nsagemaker_session = sagemaker.Session()\r\nrole = get_execution_role()\r\ntraining_steps = 100\r\nevaluation_steps = 10\r\n\r\nestimator = TensorFlow(\r\n    entry_point='keras_pillow.py',\r\n    source_dir='./',\r\n    role=role,\r\n    training_steps=100,\r\n    evaluation_steps=10,\r\n    train_instance_count=1,\r\n    train_instance_type='ml.p2.xlarge',\r\n    requirements_file='requirements.txt',\r\n    input_mode='File')\r\n\r\ninput_dataset = s3_input('s3://com.amazon.evi.multimedia.ingestion/temp/ocorcoll/datasets/cats_and_dogs/')\r\nestimator.fit(input_dataset)\r\n```\r\n\r\nThis produces the following logs:\r\n\r\n```\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 905, in run\r\n    run_metadata_ptr)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1137, in _run\r\n    feed_dict_tensor, options, run_metadata)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1355, in _do_run\r\n    options, run_metadata)\r\n  File \"/usr/local/lib/python2.7/dist-packages/tensorflow/python/client/session.py\", line 1374, in _do_call\r\n    raise type(e)(node_def, op, message)\r\nUnknownError: exceptions.ImportError: Could not import PIL.Image. The use of `array_to_img` requires PIL.\r\n#011 [[Node: PyFunc = PyFunc[Tin=[DT_INT64], Tout=[DT_FLOAT, DT_FLOAT], token=\"pyfunc_1\"](arg0)]]\r\n#011 [[Node: IteratorGetNext = IteratorGetNext[output_shapes=[[?,224,224,3], [?,2]], output_types=[DT_FLOAT, DT_FLOAT], _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](OneShotIterator)]]\r\n#011 [[Node: training/Adam/gradients/loss/predictions_loss/mul_grad/Shape/_833 = _HostRecv[client_terminated=false, recv_device=\"/job:localhost/replica:0/task:0/device:GPU:0\", send_device=\"/job:localhost/replica:0/task:0/device:CPU:0\", send_device_incarnation=1, tensor_name=\"edge_443_training/Adam/gradients/loss/predictions_loss/mul_grad/Shape\", tensor_type=DT_INT32, _device=\"/job:localhost/replica:0/task:0/device:GPU:0\"]()]]\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/231/reactions", "total_count": 3, "+1": 3, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/231/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/184", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/184/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/184/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/184/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/184", "id": 323091651, "node_id": "MDU6SXNzdWUzMjMwOTE2NTE=", "number": 184, "title": "`session.logs_for_job` waits indefinitely for stopped jobs", "user": {"login": "sshekh", "id": 3396633, "node_id": "MDQ6VXNlcjMzOTY2MzM=", "avatar_url": "https://avatars.githubusercontent.com/u/3396633?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sshekh", "html_url": "https://github.com/sshekh", "followers_url": "https://api.github.com/users/sshekh/followers", "following_url": "https://api.github.com/users/sshekh/following{/other_user}", "gists_url": "https://api.github.com/users/sshekh/gists{/gist_id}", "starred_url": "https://api.github.com/users/sshekh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sshekh/subscriptions", "organizations_url": "https://api.github.com/users/sshekh/orgs", "repos_url": "https://api.github.com/users/sshekh/repos", "events_url": "https://api.github.com/users/sshekh/events{/privacy}", "received_events_url": "https://api.github.com/users/sshekh/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 850818746, "node_id": "MDU6TGFiZWw4NTA4MTg3NDY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/status:%20pending%20release", "name": "status: pending release", "color": "eee8d5", "default": false, "description": "issues for which fixes have been merged but not released to PyPI"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-05-15T07:07:23Z", "updated_at": "2018-06-04T01:23:00Z", "closed_at": "2018-06-04T01:23:00Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### System Information\r\n- **Algorithm XGBoost**:\r\n- **Python 3.6.4**:\r\n- **CPU**:\r\n- **Python SDK version 1.2.4**:\r\n\r\n### Describe the problem\r\nWhen checking for logs of a submitted job `session.logs_for_job()` function only marks a job as completed if the job status is `Completed` or `Failed`. If the job was stopped (for example because of timeout), then the job status is `Stopped` and the function goes into an infinite loop.\r\n\r\n```python\r\nif status == 'Completed' or status == 'Failed':\r\n    state = LogState.JOB_COMPLETE\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/184/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/184/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/169", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/169/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/169/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/169/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/169", "id": 320737292, "node_id": "MDU6SXNzdWUzMjA3MzcyOTI=", "number": 169, "title": "UnicodeDecodeError with README.rst", "user": {"login": "pabloheimplatz", "id": 2726348, "node_id": "MDQ6VXNlcjI3MjYzNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/2726348?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pabloheimplatz", "html_url": "https://github.com/pabloheimplatz", "followers_url": "https://api.github.com/users/pabloheimplatz/followers", "following_url": "https://api.github.com/users/pabloheimplatz/following{/other_user}", "gists_url": "https://api.github.com/users/pabloheimplatz/gists{/gist_id}", "starred_url": "https://api.github.com/users/pabloheimplatz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pabloheimplatz/subscriptions", "organizations_url": "https://api.github.com/users/pabloheimplatz/orgs", "repos_url": "https://api.github.com/users/pabloheimplatz/repos", "events_url": "https://api.github.com/users/pabloheimplatz/events{/privacy}", "received_events_url": "https://api.github.com/users/pabloheimplatz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-05-07T09:31:56Z", "updated_at": "2018-07-30T23:44:59Z", "closed_at": "2018-07-30T23:44:59Z", "author_association": "NONE", "active_lock_reason": null, "body": "### System Information\r\n- **Python Version**: 3.6.4\r\n- **CPU or GPU**: Macbook Air 2017\r\n\r\n### Describe the problem\r\nThere is a problem with the `README.rst`. Python gave me an `UnicodeDecodeError`. I tried to install with pip and directly from this repo. Both throw the error I posted below.\r\n\r\nSolution for me: I cleared the `README.rst` so that there are no ASCI oder UTF-8 symbols in it. Works fine on my local Macbook.\r\n\r\n\r\n### Minimal repo / logs\r\n```\r\n$ pip install SageMaker\r\nCollecting SageMaker\r\n  Using cached https://files.pythonhosted.org/packages/81/13/709f55a8a74e8a3c7ead5a68453b82694c0d6a37fa4fdab0ac868fd5b4d8/sagemaker-1.2.4.tar.gz\r\n    Complete output from command python setup.py egg_info:\r\n    Traceback (most recent call last):\r\n      File \"<string>\", line 1, in <module>\r\n      File \"/private/var/folders/m9/lqnkhvb16w18p7wg6rx06c8w0000gq/T/pip-install-yhyu0eez/SageMaker/setup.py\", line 19, in <module>\r\n        long_description=read('README.rst'),\r\n      File \"/private/var/folders/m9/lqnkhvb16w18p7wg6rx06c8w0000gq/T/pip-install-yhyu0eez/SageMaker/setup.py\", line 10, in read\r\n        return open(os.path.join(os.path.dirname(__file__), fname)).read()\r\n      File \"/anaconda3/lib/python3.6/encodings/ascii.py\", line 26, in decode\r\n        return codecs.ascii_decode(input, self.errors)[0]\r\n    UnicodeDecodeError: 'ascii' codec can't decode byte 0xc2 in position 5556: ordinal not in range(128)\r\n\r\n----------------------------------------\r\nCommand \"python setup.py egg_info\" failed with error code 1 in /private/var/folders/m9/lqnkhvb16w18p7wg6rx06c8w0000gq/T/pip-install-yhyu0eez/SageMaker/\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/169/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/169/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/156", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/156/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/156/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/156/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/156", "id": 315660201, "node_id": "MDU6SXNzdWUzMTU2NjAyMDE=", "number": 156, "title": "Endpoint returning 500 for all input formats", "user": {"login": "OktayGardener", "id": 6593422, "node_id": "MDQ6VXNlcjY1OTM0MjI=", "avatar_url": "https://avatars.githubusercontent.com/u/6593422?v=4", "gravatar_id": "", "url": "https://api.github.com/users/OktayGardener", "html_url": "https://github.com/OktayGardener", "followers_url": "https://api.github.com/users/OktayGardener/followers", "following_url": "https://api.github.com/users/OktayGardener/following{/other_user}", "gists_url": "https://api.github.com/users/OktayGardener/gists{/gist_id}", "starred_url": "https://api.github.com/users/OktayGardener/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/OktayGardener/subscriptions", "organizations_url": "https://api.github.com/users/OktayGardener/orgs", "repos_url": "https://api.github.com/users/OktayGardener/repos", "events_url": "https://api.github.com/users/OktayGardener/events{/privacy}", "received_events_url": "https://api.github.com/users/OktayGardener/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2018-04-18T22:12:17Z", "updated_at": "2018-07-19T22:27:18Z", "closed_at": "2018-07-19T22:27:18Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hey guys\r\n\r\nSagemaker version used: 1.2.3\r\nPython version(s) used: 2.7, 3.6\r\nTraining image: Sagemaker's TF training image\r\n\r\nI am having problems with querying an endpoint with different formats.\r\nI have trained and deployed a Keras model on Sagemaker. I haven't found an example where you try to populate anything other than one tensor, so this might be where the problem lies. \r\nHere's the following serving_input_fn:\r\n\r\n```\r\ndef serving_input_fn(params):\r\n    user = tf.placeholder(tf.int64, shape=[1])\r\n    item = tf.placeholder(tf.int64, shape=[1])\r\n    return build_raw_serving_input_receiver_fn({\r\n        USER_TENSOR_NAME: user, ITEM_TENSOR_NAME: item\r\n    })()\r\n```\r\n\r\nI'm creating the endpoint like:\r\n\r\n```\r\npredictor = RealTimePredictor(endpoint='itemembd-3-tensorflow-endpoint',\r\n                              sagemaker_session=sagemaker_session,\r\n                              deserializer=tf_json_deserializer,\r\n                              serializer=tf_json_serializer)\r\n\r\n# also tried:\r\n\r\n```\r\n\r\nDictionary as such:\r\n`predictor.predict({'user': 10, 'item': 10})`\r\n`predictor.predict({'user': [10], 'item': [10]})`\r\n\r\nGives me following output:\r\n```\r\n[2018-04-18 22:03:05,068] ERROR in serving: Unsupported request data format: {u'item': 10, u'user': 10}.\r\n\r\n[2018-04-18 22:07:33,356] ERROR in serving: Unsupported request data format: {u'item': [10], u'user': [10]}.\r\n\r\nValid formats: tensor_pb2.TensorProto, dict<string, tensor_pb2.TensorProto> and predict_pb2.PredictRequest\r\nTraceback (most recent call last):\r\nValid formats: tensor_pb2.TensorProto, dict<string, tensor_pb2.TensorProto> and predict_pb2.PredictRequest\r\nTraceback (most recent call last):\r\nFile \"/usr/local/lib/python2.7/dist-packages/container_support/serving.py\", line 180, in _invoke\r\nself.transformer.transform(content, input_content_type, requested_output_content_type)\r\nFile \"/usr/local/lib/python2.7/dist-packages/tf_container/serve.py\", line 267, in transform\r\nreturn self.transform_fn(data, content_type, accepts), accepts\r\nFile \"/usr/local/lib/python2.7/dist-packages/tf_container/serve.py\", line 192, in f\r\nprediction = self.predict_fn(input)\r\nFile \"/usr/local/lib/python2.7/dist-packages/tf_container/serve.py\", line 207, in predict_fn\r\nreturn self.proxy_client.request(data)\r\nFile \"/usr/local/lib/python2.7/dist-packages/tf_container/proxy_client.py\", line 67, in request\r\nreturn request_fn(data)\r\nFile \"/usr/local/lib/python2.7/dist-packages/tf_container/proxy_client.py\", line 97, in predict\r\nrequest = self._create_predict_request(data)\r\nFile \"/usr/local/lib/python2.7/dist-packages/tf_container/proxy_client.py\", line 114, in _create_predict_request\r\ninput_map = self._create_input_map(data)\r\nFile \"/usr/local/lib/python2.7/dist-packages/tf_container/proxy_client.py\", line 211, in _create_input_map\r\nraise ValueError(msg.format(data))\r\nValueError: Unsupported request data format: {u'item': 10, u'user': 10}.\r\nValid formats: tensor_pb2.TensorProto, dict<string, tensor_pb2.TensorProto> and predict_pb2.PredictRequest\r\n[2018-04-18 22:03:05,068] ERROR in serving: Unsupported request data format: {u'item': 10, u'user': 10}.\r\nValid formats: tensor_pb2.TensorProto, dict<string, tensor_pb2.TensorProto> and predict_pb2.PredictRequest\r\n10.32.0.2 - - [18/Apr/2018:22:03:05 +0000] \"POST /invocations HTTP/1.1\" 500 0 \"-\" \"AHC/2.0\"\r\n```\r\n\r\nI thought this was fixed in 1.1.0?\r\n\r\nhttps://github.com/aws/sagemaker-python-sdk/pull/62\r\n\r\nEven when I try to follow the error message and use these types `dict<string, tensor_pb2.TensorProto>` like so:\r\n\r\n```\r\nuser = tf.make_tensor_proto(values=np.asarray([10]), shape=[1], dtype=tf.float64)\r\nitem = tf.make_tensor_proto(values=np.asarray([10]), shape=[1], dtype=tf.float64)\r\nd = {'user': user, 'item': item}\r\npredictor.predict(d)\r\n```\r\n\r\nI get:\r\n\r\n```\r\nTypeErrorTraceback (most recent call last)\r\n<ipython-input-35-9b9c7393b590> in <module>()\r\n      5 item = tf.make_tensor_proto(values=np.asarray([10]), shape=[1], dtype=tf.int64)\r\n      6 d = {'user': user, 'item': item}\r\n----> 7 predictor.predict(d)\r\n\r\n/home/ec2-user/anaconda3/envs/tensorflow_p27/lib/python2.7/site-packages/sagemaker/predictor.pyc in predict(self, data)\r\n     72         \"\"\"\r\n     73         if self.serializer is not None:\r\n---> 74             data = self.serializer(data)\r\n     75 \r\n     76         request_args = {\r\n\r\n/home/ec2-user/anaconda3/envs/tensorflow_p27/lib/python2.7/site-packages/sagemaker/tensorflow/predictor.pyc in __call__(self, data)\r\n     85             return json_format.MessageToJson(data)\r\n     86         else:\r\n---> 87             return json_serializer(data)\r\n     88 \r\n     89 \r\n\r\n/home/ec2-user/anaconda3/envs/tensorflow_p27/lib/python2.7/site-packages/sagemaker/predictor.pyc in __call__(self, data)\r\n    246             if not len(data.keys()) > 0:\r\n    247                 raise ValueError(\"empty dictionary can't be serialized\")\r\n--> 248             return _json_serialize_python_object(data)\r\n    249 \r\n    250         # files and buffers\r\n\r\n/home/ec2-user/anaconda3/envs/tensorflow_p27/lib/python2.7/site-packages/sagemaker/predictor.pyc in _json_serialize_python_object(data)\r\n    264 \r\n    265 def _json_serialize_python_object(data):\r\n--> 266     return _json_serialize_object(data)\r\n    267 \r\n    268 \r\n\r\n/home/ec2-user/anaconda3/envs/tensorflow_p27/lib/python2.7/site-packages/sagemaker/predictor.pyc in _json_serialize_object(data)\r\n    272 \r\n    273 def _json_serialize_object(data):\r\n--> 274     return json.dumps(data)\r\n    275 \r\n    276 \r\n\r\n/home/ec2-user/anaconda3/envs/tensorflow_p27/lib/python2.7/json/__init__.pyc in dumps(obj, skipkeys, ensure_ascii, check_circular, allow_nan, cls, indent, separators, encoding, default, sort_keys, **kw)\r\n    242         cls is None and indent is None and separators is None and\r\n    243         encoding == 'utf-8' and default is None and not sort_keys and not kw):\r\n--> 244         return _default_encoder.encode(obj)\r\n    245     if cls is None:\r\n    246         cls = JSONEncoder\r\n\r\n/home/ec2-user/anaconda3/envs/tensorflow_p27/lib/python2.7/json/encoder.pyc in encode(self, o)\r\n    205         # exceptions aren't as detailed.  The list call should be roughly\r\n    206         # equivalent to the PySequence_Fast that ''.join() would do.\r\n--> 207         chunks = self.iterencode(o, _one_shot=True)\r\n    208         if not isinstance(chunks, (list, tuple)):\r\n    209             chunks = list(chunks)\r\n\r\n/home/ec2-user/anaconda3/envs/tensorflow_p27/lib/python2.7/json/encoder.pyc in iterencode(self, o, _one_shot)\r\n    268                 self.key_separator, self.item_separator, self.sort_keys,\r\n    269                 self.skipkeys, _one_shot)\r\n--> 270         return _iterencode(o, 0)\r\n    271 \r\n    272 def _make_iterencode(markers, _default, _encoder, _indent, _floatstr,\r\n\r\n/home/ec2-user/anaconda3/envs/tensorflow_p27/lib/python2.7/json/encoder.pyc in default(self, o)\r\n    182 \r\n    183         \"\"\"\r\n--> 184         raise TypeError(repr(o) + \" is not JSON serializable\")\r\n    185 \r\n    186     def encode(self, o):\r\n\r\nTypeError: dtype: DT_INT64\r\ntensor_shape {\r\n  dim {\r\n    size: 1\r\n  }\r\n}\r\nint64_val: 10\r\n is not JSON serializable\r\n```\r\n\r\nThe only input that works is passing in one single tensor_proto:\r\n\r\n```\r\nitem = tf.make_tensor_proto(values=np.asarray([10]), shape=[1], dtype=tf.int64)\r\npredictor.predict(item)\r\n```\r\n\r\nwhich gives the following output (due to multiple tensors needing to get populated):\r\n\r\n```\r\n ERROR in serving: AbortionError(code=StatusCode.INVALID_ARGUMENT, details=\"input size does not match signature\")\r\nTraceback (most recent call last):\r\nFile \"/usr/local/lib/python2.7/dist-packages/container_support/serving.py\", line 180, in _invoke\r\nself.transformer.transform(content, input_content_type, requested_output_content_type)\r\nFile \"/usr/local/lib/python2.7/dist-packages/tf_container/serve.py\", line 267, in transform\r\nreturn self.transform_fn(data, content_type, accepts), accepts\r\nFile \"/usr/local/lib/python2.7/dist-packages/tf_container/serve.py\", line 192, in f\r\nprediction = self.predict_fn(input)\r\nFile \"/usr/local/lib/python2.7/dist-packages/tf_container/serve.py\", line 207, in predict_fn\r\nreturn self.proxy_client.request(data)\r\nFile \"/usr/local/lib/python2.7/dist-packages/tf_container/proxy_client.py\", line 67, in request\r\nreturn request_fn(data)\r\nFile \"/usr/local/lib/python2.7/dist-packages/tf_container/proxy_client.py\", line 99, in predict\r\nresult = stub.Predict(request, self.request_timeout)\r\nFile \"/usr/local/lib/python2.7/dist-packages/grpc/beta/_client_adaptations.py\", line 309, in __call__\r\nself._request_serializer, self._response_deserializer)\r\nFile \"/usr/local/lib/python2.7/dist-packages/grpc/beta/_client_adaptations.py\", line 195, in _blocking_unary_unary\r\nraise _abortion_error(rpc_error_call)\r\nAbortionError: AbortionError(code=StatusCode.INVALID_ARGUMENT, details=\"input size does not match signature\")\r\n[2018-04-18 22:12:40,641] ERROR in serving: AbortionError(code=StatusCode.INVALID_ARGUMENT, details=\"input size does not match signature\")\r\n10.32.0.2 - - [18/Apr/2018:22:12:40 +0000] \"POST /invocations HTTP/1.1\" 500 0 \"-\" \"AHC/2.0\"\r\n```\r\n\r\nI'm basically stuck with the endpoint saying that it requires some format, and the serializer not being able to serialize this format :( \r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/156/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/156/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/154", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/154/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/154/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/154/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/154", "id": 315246460, "node_id": "MDU6SXNzdWUzMTUyNDY0NjA=", "number": 154, "title": "requirements_file doesn't seem to do anything with TensorFlow estimator", "user": {"login": "zmjjmz", "id": 1694612, "node_id": "MDQ6VXNlcjE2OTQ2MTI=", "avatar_url": "https://avatars.githubusercontent.com/u/1694612?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zmjjmz", "html_url": "https://github.com/zmjjmz", "followers_url": "https://api.github.com/users/zmjjmz/followers", "following_url": "https://api.github.com/users/zmjjmz/following{/other_user}", "gists_url": "https://api.github.com/users/zmjjmz/gists{/gist_id}", "starred_url": "https://api.github.com/users/zmjjmz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zmjjmz/subscriptions", "organizations_url": "https://api.github.com/users/zmjjmz/orgs", "repos_url": "https://api.github.com/users/zmjjmz/repos", "events_url": "https://api.github.com/users/zmjjmz/events{/privacy}", "received_events_url": "https://api.github.com/users/zmjjmz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 850818746, "node_id": "MDU6TGFiZWw4NTA4MTg3NDY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/status:%20pending%20release", "name": "status: pending release", "color": "eee8d5", "default": false, "description": "issues for which fixes have been merged but not released to PyPI"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2018-04-17T21:43:18Z", "updated_at": "2018-05-17T11:58:18Z", "closed_at": "2018-05-09T14:52:43Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hey there,\r\n\r\nIn the documentation I see a pip-style [requirements.txt](https://github.com/aws/sagemaker-python-sdk#sagemakertensorflowtensorflow-class) is supposedly supported for installing arbitrary Python packages in the containers. I haven't seen the need to try it yet, but recently wanted to test out something that required a new package and was surprised to find that well, nothing happened, and then I got a fun little `ImportError`. \r\n\r\nTo test this further, I put some garbage into the requirements file, and found that (when I went back to the version of my code that didn't require the extra package) it chugged along just fine. I know that the SDK ensures that the requirements file *exists* in the source directory, since I tested that, but otherwise it seems to me like nothing is being done with it once it's sent over.\r\n\r\nHere's the sample requirements file that didn't seem to get parsed:\r\n\r\n```\r\ntensorflow==1.7.0      \r\ntqdm==4.7.4            \r\nsjdhjaskldhjaskl==1.2.0\r\n```\r\n\r\nWhen I use this file locally, I get the following:\r\n```\r\n(dataplayground2) zach@wa1okdba002:~/stats/omc/utils/sagemaker_source_dir$ pip install -r requirements.txt                                     \r\nRequirement already satisfied: tensorflow==1.7.0 in /home/u1/zach/proj/dataplayground2/lib/python2.7/site-packages (from -r requirements.txt (l\r\nine 1))                                                                                                                                        \r\nRequirement already satisfied: tqdm==4.7.4 in /home/u1/zach/proj/dataplayground2/lib/python2.7/site-packages (from -r requirements.txt (line 2)\r\n)                                                                                                                                              \r\nCollecting sjdhjaskldhjaskl==1.2.0 (from -r requirements.txt (line 3))                                                                         \r\n  Could not find a version that satisfies the requirement sjdhjaskldhjaskl==1.2.0 (from -r requirements.txt (line 3)) (from versions: )        \r\nNo matching distribution found for sjdhjaskldhjaskl==1.2.0 (from -r requirements.txt (line 3))                                                                                                                     \r\n```\r\n\r\nThanks,\r\nZach", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/154/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/154/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/123", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/123/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/123/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/123/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/123", "id": 310955427, "node_id": "MDU6SXNzdWUzMTA5NTU0Mjc=", "number": 123, "title": "Getting incorrect random string values from prediction output", "user": {"login": "mihi-r", "id": 37024793, "node_id": "MDQ6VXNlcjM3MDI0Nzkz", "avatar_url": "https://avatars.githubusercontent.com/u/37024793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mihi-r", "html_url": "https://github.com/mihi-r", "followers_url": "https://api.github.com/users/mihi-r/followers", "following_url": "https://api.github.com/users/mihi-r/following{/other_user}", "gists_url": "https://api.github.com/users/mihi-r/gists{/gist_id}", "starred_url": "https://api.github.com/users/mihi-r/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mihi-r/subscriptions", "organizations_url": "https://api.github.com/users/mihi-r/orgs", "repos_url": "https://api.github.com/users/mihi-r/repos", "events_url": "https://api.github.com/users/mihi-r/events{/privacy}", "received_events_url": "https://api.github.com/users/mihi-r/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": {"login": "mvsusp", "id": 142074, "node_id": "MDQ6VXNlcjE0MjA3NA==", "avatar_url": "https://avatars.githubusercontent.com/u/142074?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mvsusp", "html_url": "https://github.com/mvsusp", "followers_url": "https://api.github.com/users/mvsusp/followers", "following_url": "https://api.github.com/users/mvsusp/following{/other_user}", "gists_url": "https://api.github.com/users/mvsusp/gists{/gist_id}", "starred_url": "https://api.github.com/users/mvsusp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mvsusp/subscriptions", "organizations_url": "https://api.github.com/users/mvsusp/orgs", "repos_url": "https://api.github.com/users/mvsusp/repos", "events_url": "https://api.github.com/users/mvsusp/events{/privacy}", "received_events_url": "https://api.github.com/users/mvsusp/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "mvsusp", "id": 142074, "node_id": "MDQ6VXNlcjE0MjA3NA==", "avatar_url": "https://avatars.githubusercontent.com/u/142074?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mvsusp", "html_url": "https://github.com/mvsusp", "followers_url": "https://api.github.com/users/mvsusp/followers", "following_url": "https://api.github.com/users/mvsusp/following{/other_user}", "gists_url": "https://api.github.com/users/mvsusp/gists{/gist_id}", "starred_url": "https://api.github.com/users/mvsusp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mvsusp/subscriptions", "organizations_url": "https://api.github.com/users/mvsusp/orgs", "repos_url": "https://api.github.com/users/mvsusp/repos", "events_url": "https://api.github.com/users/mvsusp/events{/privacy}", "received_events_url": "https://api.github.com/users/mvsusp/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 5, "created_at": "2018-04-03T18:53:08Z", "updated_at": "2018-07-26T19:04:45Z", "closed_at": "2018-07-26T19:04:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "I've deployed a model which will return various things when making a prediction, including string values. Now, the int and float values are coming back fine, but my string outputs (defined as `labels` in my code) are returning as random strings. \r\n\r\nFor example, the string \"DEV01\" will return as \"REVWMDQ=\" instead.\r\n\r\nHere is my prediction block:\r\n\r\n```\r\n  if mode == tf.estimator.ModeKeys.PREDICT:\r\n    s3 = boto3.resource('s3')\r\n    content_object = s3.Object('sagemaker-blah', 'labels.json')\r\n    file_content = content_object.get()['Body'].read().decode('utf-8')\r\n    labels = json.loads(file_content)\r\n    labels = tf.convert_to_tensor(labels, dtype=tf.string)\r\n    predictions={\r\n      'index': predicted_class_index,\r\n      'classes': labels,\r\n      'predictions': tf.nn.softmax(scores)\r\n    }\r\n    export_outputs = {SIGNATURE_NAME: tf.estimator.export.PredictOutput(predictions)}\r\n    return tf.estimator.EstimatorSpec(mode=mode, predictions=predictions, export_outputs=export_outputs)\r\n```\r\nWhen I just run the block of code below locally, my string values are normal:\r\n```\r\ns3 = boto3.resource('s3')\r\ncontent_object = s3.Object('sagemaker-tcclassification', 'labels.json')\r\nfile_content = content_object.get()['Body'].read().decode('utf-8')\r\nlabels = json.loads(file_content)\r\nlabels = tf.convert_to_tensor(labels, dtype=tf.string)\r\n```\r\nWhy do the string values change when outputting through `tf.estimator.EstimatorSpec` and SageMaker? Are they getting serialized? If so, how can I deserialize them after getting the predictions back? \r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/123/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/123/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/109", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/109/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/109/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/109/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/109", "id": 309090062, "node_id": "MDU6SXNzdWUzMDkwOTAwNjI=", "number": 109, "title": "TensorFlow logs not showing up on CloudWatch or console", "user": {"login": "cgarciae", "id": 5862228, "node_id": "MDQ6VXNlcjU4NjIyMjg=", "avatar_url": "https://avatars.githubusercontent.com/u/5862228?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cgarciae", "html_url": "https://github.com/cgarciae", "followers_url": "https://api.github.com/users/cgarciae/followers", "following_url": "https://api.github.com/users/cgarciae/following{/other_user}", "gists_url": "https://api.github.com/users/cgarciae/gists{/gist_id}", "starred_url": "https://api.github.com/users/cgarciae/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cgarciae/subscriptions", "organizations_url": "https://api.github.com/users/cgarciae/orgs", "repos_url": "https://api.github.com/users/cgarciae/repos", "events_url": "https://api.github.com/users/cgarciae/events{/privacy}", "received_events_url": "https://api.github.com/users/cgarciae/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2018-03-27T18:50:20Z", "updated_at": "2020-04-22T15:16:06Z", "closed_at": "2018-04-06T04:38:42Z", "author_association": "NONE", "active_lock_reason": null, "body": "A recent changed on sagemaker caused tensorflow logs not showing up on the console and cloudwatch. This makes a lot of tasks very difficult including hyper parameter tunning. I've tested on my own code and the abalone example: no tf logs shown.", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/109/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/109/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/99", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/99/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/99/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/99/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/99", "id": 305724928, "node_id": "MDU6SXNzdWUzMDU3MjQ5Mjg=", "number": 99, "title": "Unable to invoke SageMaker API endpoint", "user": {"login": "damoresa", "id": 12097023, "node_id": "MDQ6VXNlcjEyMDk3MDIz", "avatar_url": "https://avatars.githubusercontent.com/u/12097023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/damoresa", "html_url": "https://github.com/damoresa", "followers_url": "https://api.github.com/users/damoresa/followers", "following_url": "https://api.github.com/users/damoresa/following{/other_user}", "gists_url": "https://api.github.com/users/damoresa/gists{/gist_id}", "starred_url": "https://api.github.com/users/damoresa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/damoresa/subscriptions", "organizations_url": "https://api.github.com/users/damoresa/orgs", "repos_url": "https://api.github.com/users/damoresa/repos", "events_url": "https://api.github.com/users/damoresa/events{/privacy}", "received_events_url": "https://api.github.com/users/damoresa/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2018-03-15T21:24:57Z", "updated_at": "2018-10-03T14:49:34Z", "closed_at": "2018-06-07T22:07:33Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hello!\r\n\r\nThe last few days I've been trying to deploy my trained model to SageMaker so I can query it from an AWS lambda using this SDK.\r\nSo far I've been able to train my POC model and deploy and endpoint, but I've not been able to query it after several tries. In the other hand, I've been able to query the generated _SavedModel_ on my own computer.\r\n\r\nThe API endpoint has been giving me errors I've not been able to decypher, would you be so kind to give me a hand with this?\r\n\r\nAll my code can be found on this [repository](https://github.com/damoresa/ecommerce-poc).\r\nI'll break down the sources for you:\r\n\r\n- **[aws_dnnreg.py](https://github.com/damoresa/ecommerce-poc/blob/master/aws_dnnreg.py)**: Script used to fit the model at _SageMaker_\r\n- **[aws_dnnreg_cli.py](https://github.com/damoresa/ecommerce-poc/blob/master/aws_dnnreg_cli.py)**: First client attempt, based on the _iris_ classifier example.\r\n- **[aws_dnnreg_cli_v2.py](https://github.com/damoresa/ecommerce-poc/blob/master/aws_dnnreg_cli_v2.py)**: Second client attempt, based on a issue I saw on this Github.\r\n- **[aws_ecommerce_poc_dnn.py](https://github.com/damoresa/ecommerce-poc/blob/master/aws_ecommerce_poc_dnn.py)**: Training script.\r\n- **[local/ecommerce-poc-dnn.py](https://github.com/damoresa/ecommerce-poc/blob/master/local/ecommerce-poc-dnn.py)**: Script I've been using to test the training script at local.\r\n- **[local/ecommerce-poc-predictor.py](https://github.com/damoresa/ecommerce-poc/blob/master/local/ecommerce-poc-predictor.py)**: Script I've been using to query the _SavedModel_ locally.\r\n\r\nThe datasets are as follows:\r\n\r\n- **[Train](https://github.com/damoresa/ecommerce-poc/blob/master/AWS-Ecommerce-Train.csv)**: AWS-Ecommerce-Train.csv\r\n- **[Test](https://github.com/damoresa/ecommerce-poc/blob/master/AWS-Ecommerce-Test.csv)**: AWS-Ecommerce-Test.csv\r\n\r\nThank you for your time.\r\nYours,\r\nDaniel.\r\n\r\n** EDIT ** : [This](https://github.com/aws/sagemaker-python-sdk/issues/18) is the issue I based my second client on.\r\n\r\nAlso adding the log trace I retrieved from _CloudWatch_:\r\n\r\n`[2018-03-15 20:33:55,234] ERROR in serving: u'tensorflow/serving/regress'\r\nTraceback (most recent call last):\r\nFile \"/opt/amazon/lib/python2.7/site-packages/container_support/serving.py\", line 165, in _invoke\r\nself.transformer.transform(content, input_content_type, requested_output_content_type)\r\nFile \"/opt/amazon/lib/python2.7/site-packages/tf_container/serve.py\", line 254, in transform\r\nreturn self.transform_fn(data, content_type, accepts), accepts\r\nFile \"/opt/amazon/lib/python2.7/site-packages/tf_container/serve.py\", line 178, in f\r\ninput = input_fn(serialized_data, content_type)\r\nFile \"/opt/amazon/lib/python2.7/site-packages/tf_container/serve.py\", line 211, in _default_input_fn\r\ndata = self.proxy_client.parse_request(serialized_data)\r\nFile \"/opt/amazon/lib/python2.7/site-packages/tf_container/proxy_client.py\", line 47, in parse_request\r\nrequest = request_fn_map[self.prediction_type]()\r\nKeyError: u'tensorflow/serving/regress'\r\n2018-03-15 20:33:55,234 ERROR - model server - u'tensorflow/serving/regress'\r\nTraceback (most recent call last):\r\nFile \"/opt/amazon/lib/python2.7/site-packages/container_support/serving.py\", line 165, in _invoke\r\nself.transformer.transform(content, input_content_type, requested_output_content_type)\r\nFile \"/opt/amazon/lib/python2.7/site-packages/tf_container/serve.py\", line 254, in transform\r\nreturn self.transform_fn(data, content_type, accepts), accepts\r\nFile \"/opt/amazon/lib/python2.7/site-packages/tf_container/serve.py\", line 178, in f\r\ninput = input_fn(serialized_data, content_type)\r\nFile \"/opt/amazon/lib/python2.7/site-packages/tf_container/serve.py\", line 211, in _default_input_fn\r\ndata = self.proxy_client.parse_request(serialized_data)\r\nFile \"/opt/amazon/lib/python2.7/site-packages/tf_container/proxy_client.py\", line 47, in parse_request\r\nrequest = request_fn_map[self.prediction_type]()\r\nKeyError: u'tensorflow/serving/regress'\r\n[2018-03-15 20:33:55,234] ERROR in serving: u'tensorflow/serving/regress'\r\n2018-03-15 20:33:55,234 ERROR - model server - u'tensorflow/serving/regress'`", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/99/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/99/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/90", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/90/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/90/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/90/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/90", "id": 303301603, "node_id": "MDU6SXNzdWUzMDMzMDE2MDM=", "number": 90, "title": "Documentation of requirements_file not on readthedocs.io", "user": {"login": "stephenash", "id": 573423, "node_id": "MDQ6VXNlcjU3MzQyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/573423?v=4", "gravatar_id": "", "url": "https://api.github.com/users/stephenash", "html_url": "https://github.com/stephenash", "followers_url": "https://api.github.com/users/stephenash/followers", "following_url": "https://api.github.com/users/stephenash/following{/other_user}", "gists_url": "https://api.github.com/users/stephenash/gists{/gist_id}", "starred_url": "https://api.github.com/users/stephenash/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/stephenash/subscriptions", "organizations_url": "https://api.github.com/users/stephenash/orgs", "repos_url": "https://api.github.com/users/stephenash/repos", "events_url": "https://api.github.com/users/stephenash/events{/privacy}", "received_events_url": "https://api.github.com/users/stephenash/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-03-07T23:40:31Z", "updated_at": "2019-02-06T21:43:43Z", "closed_at": "2018-03-08T02:05:04Z", "author_association": "NONE", "active_lock_reason": null, "body": "Was looking for details on how to use the [`requirements_file`](https://github.com/aws/sagemaker-python-sdk/blob/6b809eba605119ff274b39b3c8df3dd1163e784a/src/sagemaker/tensorflow/estimator.py#L123) parameter, but that does not appear to be listed on http://sagemaker.readthedocs.io/en/stable/sagemaker.tensorflow.html\r\n\r\nThe builds on RTD are failing, so nothing new has been published recently. https://readthedocs.org/projects/sagemaker/builds/\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/90/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/90/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/84", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/84/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/84/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/84/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/84", "id": 300452226, "node_id": "MDU6SXNzdWUzMDA0NTIyMjY=", "number": 84, "title": "No h5py libraries in the Tensorflow container", "user": {"login": "chinazm", "id": 7229876, "node_id": "MDQ6VXNlcjcyMjk4NzY=", "avatar_url": "https://avatars.githubusercontent.com/u/7229876?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chinazm", "html_url": "https://github.com/chinazm", "followers_url": "https://api.github.com/users/chinazm/followers", "following_url": "https://api.github.com/users/chinazm/following{/other_user}", "gists_url": "https://api.github.com/users/chinazm/gists{/gist_id}", "starred_url": "https://api.github.com/users/chinazm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chinazm/subscriptions", "organizations_url": "https://api.github.com/users/chinazm/orgs", "repos_url": "https://api.github.com/users/chinazm/repos", "events_url": "https://api.github.com/users/chinazm/events{/privacy}", "received_events_url": "https://api.github.com/users/chinazm/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2018-02-27T00:47:53Z", "updated_at": "2018-03-23T05:56:44Z", "closed_at": "2018-03-23T05:56:44Z", "author_association": "NONE", "active_lock_reason": null, "body": "no h5py library in the Tensorflow container, such that tf.keras.model.load_weights does not work!!!", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/84/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/84/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/57", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/57/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/57/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/57/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/57", "id": 291413307, "node_id": "MDU6SXNzdWUyOTE0MTMzMDc=", "number": 57, "title": "Cannot pull algorithm container", "user": {"login": "jpredham", "id": 122585, "node_id": "MDQ6VXNlcjEyMjU4NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/122585?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jpredham", "html_url": "https://github.com/jpredham", "followers_url": "https://api.github.com/users/jpredham/followers", "following_url": "https://api.github.com/users/jpredham/following{/other_user}", "gists_url": "https://api.github.com/users/jpredham/gists{/gist_id}", "starred_url": "https://api.github.com/users/jpredham/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jpredham/subscriptions", "organizations_url": "https://api.github.com/users/jpredham/orgs", "repos_url": "https://api.github.com/users/jpredham/repos", "events_url": "https://api.github.com/users/jpredham/events{/privacy}", "received_events_url": "https://api.github.com/users/jpredham/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2018-01-25T00:52:07Z", "updated_at": "2021-05-22T14:13:34Z", "closed_at": "2018-01-26T21:10:15Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hey there,\r\n\r\nI'm attempting to run a custom SageMaker job that I'm creating programmatically through this library using the `Session.train` method. All validation passes, the job is created, and my channel data is pulled from S3 (judging by how long it takes ~ 40 minutes). At this point I get the following error that I've been unable to diagnose:\r\n```\r\nFailed Reason: ClientError: Cannot pull algorithm container. Either the image does not exist or its permissions are incorrect.\r\n```\r\n\r\nAddressing each of these issues\r\n\r\n1. I've verified that my image uri leads to a proper ECS repo and looks like `\"1234567890.dkr.ecr.us-east-1.amazonaws.com/sage\"`. \r\n2. The execution role I created to run the job has the policies `AmazonSageMakerFullAccess`, `AmazonEC2ContainerRegistryFullAccess`, and an additional custom policy to limit the S3 access to my training bucket.\r\n\r\nWhat am I missing here? Is there another policy I need to add to the IAM role? Happy to provide any other relevant details.", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/57/reactions", "total_count": 6, "+1": 6, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/57/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/43", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/43/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/43/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/43/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/43", "id": 288418907, "node_id": "MDU6SXNzdWUyODg0MTg5MDc=", "number": 43, "title": "creating estimator with role name fails if role is default sagemaker service role", "user": {"login": "jesterhazy", "id": 505258, "node_id": "MDQ6VXNlcjUwNTI1OA==", "avatar_url": "https://avatars.githubusercontent.com/u/505258?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jesterhazy", "html_url": "https://github.com/jesterhazy", "followers_url": "https://api.github.com/users/jesterhazy/followers", "following_url": "https://api.github.com/users/jesterhazy/following{/other_user}", "gists_url": "https://api.github.com/users/jesterhazy/gists{/gist_id}", "starred_url": "https://api.github.com/users/jesterhazy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jesterhazy/subscriptions", "organizations_url": "https://api.github.com/users/jesterhazy/orgs", "repos_url": "https://api.github.com/users/jesterhazy/repos", "events_url": "https://api.github.com/users/jesterhazy/events{/privacy}", "received_events_url": "https://api.github.com/users/jesterhazy/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-01-14T16:03:11Z", "updated_at": "2018-02-02T22:56:27Z", "closed_at": "2018-02-02T22:56:27Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "if you pass a role name (instead of full ARN) to estimator constructor, and you are using default role created by SageMaker, training job will fail with \"unable to assume the role\" ClientError:\r\n\r\n`sagemaker-mxnet-py2-cpu-2018-01-14-15-35-12-859: Failed Reason: ClientError: SageMaker was unable to assume the role 'arn:aws:iam::<ACCOUNT>:role/AmazonSageMaker-ExecutionRole-20180114T073202'`\r\n\r\nerror message shows the sdk converted role name to ARN without the 'service-role' prefix. running the same job with corrected full ARN works:\r\n\r\n`arn:aws:iam::<ACCOUNT>:role/service-role/AmazonSageMaker-ExecutionRole-20180114T075260`\r\n\r\ni encountered this error starting a training job, but I assume it would impact endpoint creation in same way.\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/43/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/43/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/39", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/39/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/39/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/39/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/39", "id": 287387122, "node_id": "MDU6SXNzdWUyODczODcxMjI=", "number": 39, "title": "training a sequential keras model fails", "user": {"login": "jsaedtler", "id": 55700, "node_id": "MDQ6VXNlcjU1NzAw", "avatar_url": "https://avatars.githubusercontent.com/u/55700?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsaedtler", "html_url": "https://github.com/jsaedtler", "followers_url": "https://api.github.com/users/jsaedtler/followers", "following_url": "https://api.github.com/users/jsaedtler/following{/other_user}", "gists_url": "https://api.github.com/users/jsaedtler/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsaedtler/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsaedtler/subscriptions", "organizations_url": "https://api.github.com/users/jsaedtler/orgs", "repos_url": "https://api.github.com/users/jsaedtler/repos", "events_url": "https://api.github.com/users/jsaedtler/events{/privacy}", "received_events_url": "https://api.github.com/users/jsaedtler/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 749522466, "node_id": "MDU6TGFiZWw3NDk1MjI0NjY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/type:%20question", "name": "type: question", "color": "d876e3", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-01-10T10:40:46Z", "updated_at": "2018-01-29T18:13:51Z", "closed_at": "2018-01-29T18:13:51Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'm trying to run the model training for a keras sequential model on sagemaker and get this error message. Am I doing something wrong?\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"./train_and_deploy.py\", line 21, in <module>\r\n    if __name__ == \"__main__\": main()\r\n  File \"./train_and_deploy.py\", line 18, in main\r\n    estimator.fit(TRAING_DATA_BUCKET)\r\n  File \"/ANONYMIZED/venv/lib/python2.7/site-packages/sagemaker/tensorflow/estimator.py\", line 166, in fit\r\n    fit_super()\r\n  File \"/ANONYMIZED/venv/lib/python2.7/site-packages/sagemaker/tensorflow/estimator.py\", line 154, in fit_super\r\n    super(TensorFlow, self).fit(inputs, wait, logs, job_name)\r\n  File \"/ANONYMIZED/venv/lib/python2.7/site-packages/sagemaker/estimator.py\", line 517, in fit\r\n    super(Framework, self).fit(inputs, wait, logs, self._current_job_name)\r\n  File \"/ANONYMIZED/venv/lib/python2.7/site-packages/sagemaker/estimator.py\", line 154, in fit\r\n    self.latest_training_job.wait(logs=logs)\r\n  File \"/ANONYMIZED/venv/lib/python2.7/site-packages/sagemaker/estimator.py\", line 323, in wait\r\n    self.sagemaker_session.logs_for_job(self.job_name, wait=True)\r\n  File \"/ANONYMIZED/venv/lib/python2.7/site-packages/sagemaker/session.py\", line 647, in logs_for_job\r\n    self._check_job_status(job_name, description)\r\n  File \"/ANONYMIZED/venv/lib/python2.7/site-packages/sagemaker/session.py\", line 390, in _check_job_status\r\n    raise ValueError('Error training {}: {} Reason: {}'.format(job, status, reason))\r\nValueError: Error training binary-classification-sample-2018-01-10-10-24-07-871: Failed Reason: AlgorithmError: \r\nException during training:\r\nUnsuccessful TensorSliceReader constructor: Failed to find any matching files for s3://sagemaker-eu-west-1-ANONYMIZED/binary-classification-sample-2018-01-10-10-24-07-871/checkpoints/.\r\n\t [[Node: save/RestoreV2_2 = RestoreV2[dtypes=[DT_FLOAT], _device=\"/job:localhost/replica:0/task:0/device:CPU:0\"](_arg_save/Const_0_0, save/RestoreV2_2/tensor_names, save/RestoreV2_2/shape_and_slices)]]\r\n\r\nCaused by op u'save/RestoreV2_2', defined at:\r\n  File \"/opt/amazon/bin/entry.py\", line 32, in <module>\r\n    modes[mode]()\r\n  File \"/opt/amazon/lib/python2.7/site-packages/container_support/training.py\", line 15, in start\r\n    fw.train()\r\n  File \"/opt/amazon/lib/python2.7/site-packages/tf_container/train.py\", line 104, in train\r\n    run.train_and_log_exceptions(train_wrapper, env.output_dir)\r\n  File \"/opt/amazon/lib/python2.7/site-packages/tf_container/run.py\", line 20, in train_and_log_exceptions\r\n    test_wrapper.train()\r\n  File \"/opt/amazon/lib/python2.7/site-packages/tf_container/trainer.\r\n```\r\n\r\nThis is the model code, using the binary classification keras sample from here: https://keras.io/getting-started/sequential-model-guide/\r\n\r\n```\r\nimport numpy as np\r\nimport tensorflow as tf\r\n\r\nINPUT_TENSOR_NAME = 'inputs_input' # needs to match the name of the first layer + \"_input\"\r\n\r\ndef keras_model_fn(hyperparameters):\r\n    model = tf.keras.models.Sequential()\r\n    model.add(tf.keras.layers.Dense(64, input_dim=20, activation='relu', name='inputs'))\r\n    model.add(tf.keras.layers.Dropout(0.5))\r\n    model.add(tf.keras.layers.Dense(64, activation='relu'))\r\n    model.add(tf.keras.layers.Dropout(0.5))\r\n    model.add(tf.keras.layers.Dense(1, activation='sigmoid', name='output'))\r\n\r\n    model.compile(loss='binary_crossentropy',\r\n                  optimizer='rmsprop',\r\n                  metrics=['accuracy'])\r\n    return model\r\n\r\ndef train_input_fn(training_dir = None, hyperparameters = None):\r\n    return _input_fn()\r\n\r\ndef eval_input_fn(training_dir = None, hyperparameters = None):\r\n    return _input_fn()\r\n\r\n\r\ndef _load_data():\r\n    # Generate dummy data\r\n    X = np.random.random((1000, 20))\r\n    y = np.random.randint(2, size=(1000, 1))\r\n\r\n    return X.astype(np.float32), y.astype(np.float32)\r\n\r\ndef _input_fn():\r\n    X, y = _load_data()\r\n\r\n    return tf.estimator.inputs.numpy_input_fn(\r\n        x={INPUT_TENSOR_NAME: X},\r\n        y=y,\r\n        num_epochs=None,\r\n        shuffle=True)()\r\n\r\n```\r\n\r\nI start the training with this script:\r\n\r\n```\r\n#!/usr/bin/env python\r\nimport sagemaker\r\nfrom sagemaker.tensorflow import TensorFlow\r\n\r\nTRAING_DATA_BUCKET = 's3://ANONYMIZED'\r\n\r\ndef main():\r\n    estimator = TensorFlow(\r\n        entry_point='binary_classification_sample.py',\r\n        role='SageMakeFullAccess',\r\n        training_steps=1000,\r\n        evaluation_steps=1000,\r\n        hyperparameters={'learning_rate': 1e-04},\r\n        train_instance_count=1,\r\n        train_instance_type='ml.m4.xlarge',\r\n        base_job_name='binary-classification-sample')\r\n\r\n    estimator.fit(TRAING_DATA_BUCKET)\r\n\r\n\r\nif __name__ == \"__main__\": main()\r\n\r\n```\r\n\r\nLocal training works:\r\n\r\n```\r\n#!/usr/bin/env python\r\nimport tensorflow as tf\r\nfrom binary_classification_sample import keras_model_fn, _load_data\r\n\r\nEPOCHS = 10000\r\n\r\ndef main():\r\n    estimator = keras_model_fn({})\r\n    X, y = _load_data()\r\n    tensor_board_callback = tf.keras.callbacks.TensorBoard(log_dir='./graph_logs', histogram_freq=0,\r\n          write_graph=True, write_images=True)\r\n\r\n    estimator.fit(X,y, epochs=EPOCHS, callbacks=[tensor_board_callback])\r\n\r\n\r\nif __name__ == \"__main__\": main()\r\n```", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/39/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/39/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/26", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/26/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/26/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/26/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/26", "id": 283527937, "node_id": "MDU6SXNzdWUyODM1Mjc5Mzc=", "number": 26, "title": "Tensorboard not displaying scalars", "user": {"login": "vassiasim", "id": 13392031, "node_id": "MDQ6VXNlcjEzMzkyMDMx", "avatar_url": "https://avatars.githubusercontent.com/u/13392031?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vassiasim", "html_url": "https://github.com/vassiasim", "followers_url": "https://api.github.com/users/vassiasim/followers", "following_url": "https://api.github.com/users/vassiasim/following{/other_user}", "gists_url": "https://api.github.com/users/vassiasim/gists{/gist_id}", "starred_url": "https://api.github.com/users/vassiasim/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vassiasim/subscriptions", "organizations_url": "https://api.github.com/users/vassiasim/orgs", "repos_url": "https://api.github.com/users/vassiasim/repos", "events_url": "https://api.github.com/users/vassiasim/events{/privacy}", "received_events_url": "https://api.github.com/users/vassiasim/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}, {"id": 850818746, "node_id": "MDU6TGFiZWw4NTA4MTg3NDY=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/status:%20pending%20release", "name": "status: pending release", "color": "eee8d5", "default": false, "description": "issues for which fixes have been merged but not released to PyPI"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 18, "created_at": "2017-12-20T11:10:23Z", "updated_at": "2018-03-29T00:50:28Z", "closed_at": "2018-03-29T00:50:28Z", "author_association": "NONE", "active_lock_reason": null, "body": "When the flag `run_tensorboard_locally` is set to `True` , for example\r\n`estimator.fit(inputs, run_tensorboard_locally=True)`, where `estimator = TensorFlow(..)` ,\r\nTensorboard only displays the graph and projector but not any scalars or images.\r\n\r\nIf one run is terminated and a new one is started by running again:\r\n`estimator.fit(inputs, run_tensorboard_locally=True)`\r\nthen the scalars and images of the previous run are displayed on Tensorboard but they are not updated as training continues. \r\nIt seems like it, when training is restarted, Tensorboard loads the previously saved logs from the `/tmp/<temp_folder>/ `, which was created by `tempfile.mkdtemp()`, but the new logs are then saved to a newly created folder.\r\n\r\nAny way to get Tensorboard working properly?\r\nWould it make sense to add the ability to define `logdir` for `Tensorboard` when calling `TensorFlow`?\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/26/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/26/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/18", "repository_url": "https://api.github.com/repos/aws/sagemaker-python-sdk", "labels_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/18/labels{/name}", "comments_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/18/comments", "events_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/18/events", "html_url": "https://github.com/aws/sagemaker-python-sdk/issues/18", "id": 281490177, "node_id": "MDU6SXNzdWUyODE0OTAxNzc=", "number": 18, "title": "JSON examples for SageMaker / TF serving", "user": {"login": "nkconnor", "id": 6473809, "node_id": "MDQ6VXNlcjY0NzM4MDk=", "avatar_url": "https://avatars.githubusercontent.com/u/6473809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nkconnor", "html_url": "https://github.com/nkconnor", "followers_url": "https://api.github.com/users/nkconnor/followers", "following_url": "https://api.github.com/users/nkconnor/following{/other_user}", "gists_url": "https://api.github.com/users/nkconnor/gists{/gist_id}", "starred_url": "https://api.github.com/users/nkconnor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nkconnor/subscriptions", "organizations_url": "https://api.github.com/users/nkconnor/orgs", "repos_url": "https://api.github.com/users/nkconnor/repos", "events_url": "https://api.github.com/users/nkconnor/events{/privacy}", "received_events_url": "https://api.github.com/users/nkconnor/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 749522452, "node_id": "MDU6TGFiZWw3NDk1MjI0NTI=", "url": "https://api.github.com/repos/aws/sagemaker-python-sdk/labels/bug", "name": "bug", "color": "ee0701", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2017-12-12T18:27:24Z", "updated_at": "2018-02-27T23:43:53Z", "closed_at": "2018-02-27T23:43:53Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "```\r\ncols = [\r\n    tf.feature_column.numeric_column(\"age\"),\r\n    tf.feature_column.categorical_column_with_vocabulary_list(\"gender\", [\"m\", \"f\", \"other\"]),\r\n    tf.feature_column.categorical_column_with_hash_bucket(\"city\", hash_bucket_size=15000)\r\n]\r\n\r\nexample_spec = tf.feature_column.make_parse_example_spec\r\n\r\nprint(example_spec)\r\n# {'gender': VarLenFeature(dtype=tf.string), 'age': FixedLenFeature(shape=(1,), dtype=tf.float32, default_value=None), 'city': VarLenFeature(dtype=tf.string)}\r\n\r\nsrv_fun = tf.estimator.export.build_parsing_serving_input_receiver_fn(example_spec)()\r\n\r\nprint(str(srv_fun))\r\n#ServingInputReceiver(features={'city': <tensorflow.python.framework.sparse_tensor.SparseTensor object at 0x7f83c7509ad0>, 'age': <tf.Tensor 'ParseExample_7/ParseExample:6' shape=(?, 1) dtype=float32>, 'gender': <tensorflow.python.framework.sparse_tensor.SparseTensor object at 0x7f83c75093d0>}, receiver_tensors={'examples': <tf.Tensor 'input_example_tensor_8:0' shape=(?,) dtype=string>}, receiver_tensors_alternatives=None)\r\n```\r\n\r\nWhat format can we use to send `predict` requests using the Sagemaker SDK for input functions like the above?\r\n\r\nThe JSON serializer only handles arrays.. so it seems like `tf_estimator.predict({\"city\":\"Paris\", \"gender\":\"m\", \"age\":22})` is out. I tried variations of Array input and get cryptic errors from the TF serving proxy client (that source code is not available to my knowledge)\r\n\r\nLooking at the TF Iris DNN example notebook: it uses a syntax like `iris_predictor.predict([6.4, 3.2, 4.5, 1.5])` though the FeatureSpec is like `{'input': IrisArrayData}`. So perhaps the feature spec needs a top level?\r\n", "reactions": {"url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/18/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/aws/sagemaker-python-sdk/issues/18/timeline", "performed_via_github_app": null, "state_reason": "completed"}]