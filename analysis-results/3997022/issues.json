[{"url": "https://api.github.com/repos/Rapptz/discord.py/issues/9336", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/9336/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/9336/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/9336/events", "html_url": "https://github.com/Rapptz/discord.py/issues/9336", "id": 1654437883, "node_id": "I_kwDOAnRas85inLf7", "number": 9336, "title": "AuditLogEntry target always None for invite delete", "user": {"login": "LostLuma", "id": 38926001, "node_id": "MDQ6VXNlcjM4OTI2MDAx", "avatar_url": "https://avatars.githubusercontent.com/u/38926001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/LostLuma", "html_url": "https://github.com/LostLuma", "followers_url": "https://api.github.com/users/LostLuma/followers", "following_url": "https://api.github.com/users/LostLuma/following{/other_user}", "gists_url": "https://api.github.com/users/LostLuma/gists{/gist_id}", "starred_url": "https://api.github.com/users/LostLuma/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/LostLuma/subscriptions", "organizations_url": "https://api.github.com/users/LostLuma/orgs", "repos_url": "https://api.github.com/users/LostLuma/repos", "events_url": "https://api.github.com/users/LostLuma/events{/privacy}", "received_events_url": "https://api.github.com/users/LostLuma/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-04-04T19:14:38Z", "updated_at": "2023-04-18T10:17:03Z", "closed_at": "2023-04-18T10:17:03Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\r\n\r\nAuditLogEntry target always None for invite delete\r\n\r\n### Reproduction Steps\r\n\r\nFetch an audit log entry for the invite delete action type and access the `.target` attribute.\r\n\r\n### Minimal Reproducible Code\r\n\r\n```python\r\nasync for entry in guild.audit_logs(action=discord.AuditLogAction.invite_delete):\r\n  print(entry)\r\n  print(entry.target)  # Always None\r\n```\r\n\r\n\r\n### Expected Results\r\n\r\nThe target is the invite that was deleted.\r\n\r\n### Actual Results\r\n\r\nNo target is returned.\r\n\r\n### Intents\r\n\r\nall\r\n\r\n### System Information\r\n\r\n```sh\r\n$ python -m discord -v\r\n\r\n- Python v3.10.10-final\r\n- discord.py v2.3.0-alpha\r\n    - discord.py metadata: v2.3.0a4797+gab287e71\r\n- aiohttp v3.8.4\r\n- system info: Linux 6.1.3-arch1-1 #1 SMP PREEMPT_DYNAMIC Wed, 04 Jan 2023 16:28:15 +0000\r\n```\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### Additional Context\r\n\r\nCommit 517d7ae4fe352b795c9c7e3717f5e6fca1230a5c breaks this functionality, as noted in [audit_logs.py itself](https://github.com/Rapptz/discord.py/blob/ab287e71b8961cbe245e60ad220b7d0be9fd0b8a/discord/audit_logs.py#L775-L776).", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/9336/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/9336/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/9261", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/9261/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/9261/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/9261/events", "html_url": "https://github.com/Rapptz/discord.py/issues/9261", "id": 1599699931, "node_id": "I_kwDOAnRas85fWXvb", "number": 9261, "title": "ScheduledEvent edit method requires location for external events", "user": {"login": "Baviaan", "id": 45875243, "node_id": "MDQ6VXNlcjQ1ODc1MjQz", "avatar_url": "https://avatars.githubusercontent.com/u/45875243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Baviaan", "html_url": "https://github.com/Baviaan", "followers_url": "https://api.github.com/users/Baviaan/followers", "following_url": "https://api.github.com/users/Baviaan/following{/other_user}", "gists_url": "https://api.github.com/users/Baviaan/gists{/gist_id}", "starred_url": "https://api.github.com/users/Baviaan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Baviaan/subscriptions", "organizations_url": "https://api.github.com/users/Baviaan/orgs", "repos_url": "https://api.github.com/users/Baviaan/repos", "events_url": "https://api.github.com/users/Baviaan/events{/privacy}", "received_events_url": "https://api.github.com/users/Baviaan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-02-25T12:53:16Z", "updated_at": "2023-02-27T11:18:15Z", "closed_at": "2023-02-27T11:18:15Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nThe edit method requires a location and end_time to edit the name of external events\r\n\r\n### Reproduction Steps\r\n\r\n1. Create an external scheduled event\r\n2. Try to update the name of the event\r\n\r\n### Minimal Reproducible Code\r\n\r\n```python\r\nimport discord\r\nfrom discord.ext import commands\r\nfrom discord.utils import utcnow\r\nimport json\r\nfrom datetime import timedelta\r\n\r\nwith open('config.json', 'r') as f:\r\n    config = json.load(f)\r\ntoken = config['BOT_TOKEN']\r\nintents = discord.Intents.none()\r\nintents.guilds = True\r\n\r\nbot = commands.Bot(command_prefix=\"!\", case_insensitive=True, intents=intents)\r\n\r\n@bot.event\r\nasync def on_ready():\r\n    print(\"Logged in.\")\r\n    guild = bot.guilds[0]\r\n    start_time = utcnow() + timedelta(600)\r\n    end_time = utcnow() + timedelta(1200)\r\n    external = discord.EntityType.external\r\n    privacy = discord.PrivacyLevel.guild_only\r\n    location = \"https://example.com\"\r\n    event = await guild.create_scheduled_event(name=\"MWE\", start_time=start_time, end_time=end_time, entity_type=external, privacy_level=privacy, location=location)\r\n    await event.edit(name=\"Edit\")\r\n    #await event.edit(name=\"Edit\", location=location, end_time=end_time)\r\n\r\nbot.run(token)\r\n```\r\n\r\n\r\n### Expected Results\r\n\r\nI expected the name of my event to be updated.\r\n\r\nPer https://discord.com/developers/docs/resources/guild-scheduled-event#modify-guild-scheduled-event-json-params\r\nthe location and end time are only required if *changing* to an external event. This works correctly when calling the raw discord API directly.\r\n\r\n### Actual Results\r\n\r\nI got a TypeError location must be set for external events. (And if I set location, same thing for end_time.)\r\n\r\n2023-02-25 12:40:31 WARNING  discord.ext.commands.bot Privileged message content intent is missing, commands may not work as expected.\r\n2023-02-25 12:40:31 INFO     discord.client logging in using static token\r\n2023-02-25 12:40:32 INFO     discord.gateway Shard ID None has connected to Gateway (Session ID: f9802665bab0c999b126bbd8ab516c4f).\r\nLogged in.\r\n2023-02-25 12:40:34 ERROR    discord.client Ignoring exception in on_ready\r\nTraceback (most recent call last):\r\n  File \"\\~/.local/lib/python3.10/site-packages/discord/client.py\", line 409, in _run_event\r\n    await coro(*args, **kwargs)\r\n  File \"[..]/source/mwe.py\", line 25, in on_ready\r\n    await event.edit(name=\"Edit\")\r\n  File \"\\~/.local/lib/python3.10/site-packages/discord/scheduled_event.py\", line 443, in edit\r\n    raise TypeError('location must be set when entity_type is external')\r\nTypeError: location must be set when entity_type is external\r\n\r\n### Intents\r\n\r\nguilds\r\n\r\n### System Information\r\n\r\n- Python v3.10.6-final\r\n- [discord.py](http://discord.py/) v2.1.0-final\r\n- aiohttp v3.8.1\r\n- system info: Linux 5.15.0-60-generic # 66-Ubuntu SMP Fri Jan 20 14:29:49 UTC 2023\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### Additional Context\r\n\r\nI would like to avoid having to store the location when a user creates the guild event, because currently I need to do that and provide the location again when editing the name/time. (I don't think it's reasonable to ask users to provide the location again when they simply want to change the name/time.)", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/9261/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/9261/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/9205", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/9205/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/9205/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/9205/events", "html_url": "https://github.com/Rapptz/discord.py/issues/9205", "id": 1555671224, "node_id": "I_kwDOAnRas85cuai4", "number": 9205, "title": "The `on_command_error` method doesn't provide the error's traceback when used on a hybrid command.", "user": {"login": "Kyrela", "id": 44508673, "node_id": "MDQ6VXNlcjQ0NTA4Njcz", "avatar_url": "https://avatars.githubusercontent.com/u/44508673?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Kyrela", "html_url": "https://github.com/Kyrela", "followers_url": "https://api.github.com/users/Kyrela/followers", "following_url": "https://api.github.com/users/Kyrela/following{/other_user}", "gists_url": "https://api.github.com/users/Kyrela/gists{/gist_id}", "starred_url": "https://api.github.com/users/Kyrela/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Kyrela/subscriptions", "organizations_url": "https://api.github.com/users/Kyrela/orgs", "repos_url": "https://api.github.com/users/Kyrela/repos", "events_url": "https://api.github.com/users/Kyrela/events{/privacy}", "received_events_url": "https://api.github.com/users/Kyrela/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-01-24T21:09:45Z", "updated_at": "2023-01-25T15:29:40Z", "closed_at": "2023-01-25T08:05:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\n\nThe `on_command_error` method doesn't provide the error's traceback when used on a hybrid command.\n\n### Reproduction Steps\n\n1. Define an hybrid command that raise an error.\r\n2. Define an `on_command_error` event that prints the traceback of the given error.\r\n3. Run the bot\r\n4. Use the defined hybrid command as a slash command.\n\n### Minimal Reproducible Code\n\n```python\nimport discord\r\nfrom discord.ext import commands\r\n\r\nbot = commands.Bot(command_prefix=\"!\", intents=discord.Intents.all())\r\n\r\n@bot.hybrid_command()\r\nasync def crash(ctx):\r\n    raise Exception(\"crash\")\r\n\r\n\r\n@bot.event\r\nasync def on_command_error(ctx, error):\r\n    print(error)\r\n    print(error.__traceback__)\r\n    print(\"-\" * 20)\r\n\r\n\r\n@bot.event\r\nasync def on_ready():\r\n    await bot.tree.sync()\r\n\r\nbot.run(\"TOKEN\")\n```\n\n\n### Expected Results\n\nWhen using the hybrid command as a slash command, the traceback should be present in `error.__traceback__`.\n\n### Actual Results\n\n`error.__traceback__` is set to `None`\n\n### Intents\n\nIntents.all()\n\n### System Information\n\n- Python v3.11.1-final\r\n- discord.py v2.1.0-final\r\n- aiohttp v3.8.3\r\n- system info: Windows 10 10.0.22000\n\n### Checklist\n\n- [X] I have searched the open issues for duplicates.\n- [X] I have shown the entire traceback, if possible.\n- [X] I have removed my token from display, if visible.\n\n### Additional Context\n\nHere's the result of the code snippet after triggering the command as a message, then as a slash command :\r\n\r\n```\r\nCommand raised an exception: Exception: crash\r\n<traceback object at 0x000001DA0EC0EC00>\r\n--------------------\r\nHybrid command raised an error: Command 'crash' raised an exception: Exception: crash\r\nNone\r\n--------------------\r\n```\r\n\r\nHowever, please not that the `logging` module is capable of displaying the full traceback without any problem. Here's the related code snippet (just replace the `on_command_error` method of the previous snippet by this one)\r\n\r\n```py\r\n@bot.event\r\nasync def on_command_error(ctx, error):\r\n    print(error)\r\n    print(error.__traceback__)\r\n    import logging\r\n    _logger = logging.getLogger(__name__.split(\".\")[0])\r\n    _logger.error(\"error\", exc_info=error)\r\n    print(\"-\" * 20)\r\n```", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/9205/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/9205/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/9159", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/9159/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/9159/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/9159/events", "html_url": "https://github.com/Rapptz/discord.py/issues/9159", "id": 1514174336, "node_id": "I_kwDOAnRas85aQHeA", "number": 9159, "title": "AutoModRule.edit's `exempt_roles` kwarg uses a list of IDs instead of Snowflakes", "user": {"login": "Lee-matod", "id": 89663192, "node_id": "MDQ6VXNlcjg5NjYzMTky", "avatar_url": "https://avatars.githubusercontent.com/u/89663192?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Lee-matod", "html_url": "https://github.com/Lee-matod", "followers_url": "https://api.github.com/users/Lee-matod/followers", "following_url": "https://api.github.com/users/Lee-matod/following{/other_user}", "gists_url": "https://api.github.com/users/Lee-matod/gists{/gist_id}", "starred_url": "https://api.github.com/users/Lee-matod/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Lee-matod/subscriptions", "organizations_url": "https://api.github.com/users/Lee-matod/orgs", "repos_url": "https://api.github.com/users/Lee-matod/repos", "events_url": "https://api.github.com/users/Lee-matod/events{/privacy}", "received_events_url": "https://api.github.com/users/Lee-matod/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-12-30T01:34:15Z", "updated_at": "2022-12-30T07:00:19Z", "closed_at": "2022-12-30T07:00:19Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nCurrently, AutoModRule.edit's `exempt_roles` argument is typed and documented as a sequence of Snowflakes. However, the method doesn't like it when I pass a list of Role objects. I instead have to use the integer ID of the role to make it work.\r\n\r\n### Reproduction Steps\r\n\r\nPass a list of `discord.Role`s objects to `exempt_roles` in AutoModRule.edit.\r\n\r\n### Minimal Reproducible Code\r\n\r\n```python\r\nexempt_roles: list[discord.Role] = [...]  # Get role objects from somewhere\r\nrule: discord.AutoModRule = ...  # Get rule object from somewhere\r\n\r\nawait rule.edit(\r\n    exempt_roles=exempt_roles,\r\n    reason=\"...\"\r\n)\r\n```\r\n\r\n\r\n### Expected Results\r\n\r\nThe AutoMod rule should have been edited with the new exempt roles.\r\n\r\n### Actual Results\r\n\r\nAn exception is raised:\r\n```python\r\nTraceback (most recent call last):\r\n  File \"~/venv/lib/python3.10/site-packages/discord/app_commands/commands.py\", line 861, in _do_call\r\n    return await self._callback(self.binding, interaction, **params)  # type: ignore\r\n  File \"~/cogs/anti_ping.py\", line 78, in ensure_antiping\r\n    await rule.edit(\r\n  File \"~/venv/lib/python3.10/site-packages/discord/automod.py\", line 437, in edit\r\n    data = await self._state.http.edit_auto_moderation_rule(\r\n  File \"~/venv/lib/python3.10/site-packages/discord/http.py\", line 586, in request\r\n    kwargs['data'] = utils._to_json(kwargs.pop('json'))\r\n  File \"~/venv/lib/python3.10/site-packages/discord/utils.py\", line 643, in _to_json\r\n    return json.dumps(obj, separators=(',', ':'), ensure_ascii=True)\r\n  File \"/usr/lib/python3.10/json/__init__.py\", line 238, in dumps\r\n    **kw).encode(obj)\r\n  File \"/usr/lib/python3.10/json/encoder.py\", line 199, in encode\r\n    chunks = self.iterencode(o, _one_shot=True)\r\n  File \"/usr/lib/python3.10/json/encoder.py\", line 257, in iterencode\r\n    return _iterencode(o, 0)\r\n  File \"/usr/lib/python3.10/json/encoder.py\", line 179, in default\r\n    raise TypeError(f'Object of type {o.__class__.__name__} '\r\nTypeError: Object of type Role is not JSON serializable\r\n```\r\n\r\n### Intents\r\n\r\nAll\r\n\r\n### System Information\r\n\r\n- Python v3.10.6-final\r\n- discord.py v2.2.0-alpha\r\n    - discord.py metadata: v2.2.0a4661+g887ddbb4\r\n- aiohttp v3.8.3\r\n- system info: Linux 5.15.0-56-generic # 62-Ubuntu SMP Tue Nov 22 19:54:14 UTC 2022\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### Additional Context\r\n\r\nAutoModRule.edit is used in an application command, if that's of any use.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/9159/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/9159/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/9153", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/9153/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/9153/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/9153/events", "html_url": "https://github.com/Rapptz/discord.py/issues/9153", "id": 1509607425, "node_id": "I_kwDOAnRas85Z-sgB", "number": 9153, "title": "Incorrect implicit permission resolution in threads", "user": {"login": "Intery", "id": 59671042, "node_id": "MDQ6VXNlcjU5NjcxMDQy", "avatar_url": "https://avatars.githubusercontent.com/u/59671042?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Intery", "html_url": "https://github.com/Intery", "followers_url": "https://api.github.com/users/Intery/followers", "following_url": "https://api.github.com/users/Intery/following{/other_user}", "gists_url": "https://api.github.com/users/Intery/gists{/gist_id}", "starred_url": "https://api.github.com/users/Intery/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Intery/subscriptions", "organizations_url": "https://api.github.com/users/Intery/orgs", "repos_url": "https://api.github.com/users/Intery/repos", "events_url": "https://api.github.com/users/Intery/events{/privacy}", "received_events_url": "https://api.github.com/users/Intery/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-12-23T17:52:18Z", "updated_at": "2022-12-29T12:18:32Z", "closed_at": "2022-12-29T12:18:22Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\n\nImplicit channel permissions (confirmed for `attach_files`) are determined using `parent.send_messages` instead of `parent.send_messages_in_threads`\n\n### Reproduction Steps\n\n- Create text channel where client has:\r\n  - `send_messages` denied.\r\n  - `send_messages_in_threads` permitted.\r\n  - `attach_files` permitted.\r\n- Create a thread.\r\n- Execute `channel.permissions_for(guild.me).attach_files` in the thread.\n\n### Minimal Reproducible Code\n\n_No response_\n\n### Expected Results\n\nExpected result is `True`, since the client can demonstrably send files in the thread, and there are no other explicit fields governing this permission.\n\n### Actual Results\n\nActual result is `False`.\n\n### Intents\n\n`discord.Intents.all()`\n\n### System Information\n\n```\r\n- Python v3.10.8-final\r\n- discord.py v2.2.0-alpha\r\n    - discord.py metadata: v2.2.0\r\n- aiohttp v3.7.4.post0\r\n- system info: Linux 6.0.12-arch1-1 #1 SMP PREEMPT_DYNAMIC Thu, 08 Dec 2022 11:03:38 +0000\r\n```\n\n### Checklist\n\n- [X] I have searched the open issues for duplicates.\n- [X] I have shown the entire traceback, if possible.\n- [X] I have removed my token from display, if visible.\n\n### Additional Context\n\nImplicit channel permissions are determined [here](https://github.com/Rapptz/discord.py/blob/master/discord/abc.py#L769), and only take into account `send_messages`.\r\n\r\nThread permissions are determined [here](https://github.com/Rapptz/discord.py/blob/master/discord/threads.py#L423), and are directly inherited from the parent.\r\n\r\nIt appears that in Discord, implicit permissions for threads (at least for `attach_files`) are determined *after* inheriting permissions from the parent channel, and replacing the value of `send_messages` with that of `send_messages_in_threads`. This differs from permission resolution in discord.py.\r\n\r\nThe Discord Developer Docs say very little on the matter, with the relevant section being [here](https://discord.com/developers/docs/topics/permissions#inherited-permissions-threads).", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/9153/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 1, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/9153/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/9136", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/9136/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/9136/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/9136/events", "html_url": "https://github.com/Rapptz/discord.py/issues/9136", "id": 1499568303, "node_id": "I_kwDOAnRas85ZYZiv", "number": 9136, "title": "Generic Select types raise NameError due to #9126", "user": {"login": "AbstractUmbra", "id": 16031716, "node_id": "MDQ6VXNlcjE2MDMxNzE2", "avatar_url": "https://avatars.githubusercontent.com/u/16031716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AbstractUmbra", "html_url": "https://github.com/AbstractUmbra", "followers_url": "https://api.github.com/users/AbstractUmbra/followers", "following_url": "https://api.github.com/users/AbstractUmbra/following{/other_user}", "gists_url": "https://api.github.com/users/AbstractUmbra/gists{/gist_id}", "starred_url": "https://api.github.com/users/AbstractUmbra/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AbstractUmbra/subscriptions", "organizations_url": "https://api.github.com/users/AbstractUmbra/orgs", "repos_url": "https://api.github.com/users/AbstractUmbra/repos", "events_url": "https://api.github.com/users/AbstractUmbra/events{/privacy}", "received_events_url": "https://api.github.com/users/AbstractUmbra/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2022-12-16T04:33:09Z", "updated_at": "2022-12-18T10:17:42Z", "closed_at": "2022-12-18T10:17:42Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\r\n\r\nGeneric Type arguments for `discord.ui.Select` when used in a View class with decorator error.\r\n\r\n### Reproduction Steps\r\n\r\nI had a `ui.View` class that defined two selects. After updating beyond the commit from #9126 merge I now get a NameError on launch.\r\n\r\nThis will now raise a `NameError: name 'MangaView' is not defined`.\r\n\r\nTo reproduce:\r\n1) Define and use a View subclass.\r\n2) Define a method decorated with `discord.ui.select`\r\n2a) Have the argument for `select` be Generic over the subclass. \r\n\r\nFull traceback if needed:-\r\n\r\n<details>\r\n<br>\r\n\r\n```python3\r\nExtension 'extensions.manga' raised an error: NameError: name 'MangaView' is not defined\r\nTraceback (most recent call last):\r\n  File \"/home/penumbra/.cache/pypoetry/virtualenvs/mipha-kl4lG4Iw-py3.11/lib/python3.11/site-packages/discord/ext/commands/bot.py\", line 935, in _load_from_module_spec\r\n    spec.loader.exec_module(lib)  # type: ignore\r\n    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"<frozen importlib._bootstrap_external>\", line 940, in exec_module\r\n  File \"<frozen importlib._bootstrap>\", line 241, in _call_with_frames_removed\r\n  File \"/home/penumbra/projects/personal/mipha/extensions/manga.py\", line 60, in <module>\r\n    class MangaView(MiphaBaseView):\r\n  File \"/home/penumbra/projects/personal/mipha/extensions/manga.py\", line 74, in MangaView\r\n    @discord.ui.select(min_values=1, max_values=1, options=[])\r\n     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/home/penumbra/.cache/pypoetry/virtualenvs/mipha-kl4lG4Iw-py3.11/lib/python3.11/site-packages/discord/ui/select.py\", line 779, in decorator\r\n    callback_cls = _get_select_callback_parameter(func)\r\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/home/penumbra/.cache/pypoetry/virtualenvs/mipha-kl4lG4Iw-py3.11/lib/python3.11/site-packages/discord/ui/select.py\", line 681, in _get_select_callback_parameter\r\n    resolved = resolve_annotation(parameter.annotation, func.__globals__, func.__globals__, {})\r\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/home/penumbra/.cache/pypoetry/virtualenvs/mipha-kl4lG4Iw-py3.11/lib/python3.11/site-packages/discord/utils.py\", line 1144, in resolve_annotation\r\n    return evaluate_annotation(annotation, globalns, locals, cache)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/home/penumbra/.cache/pypoetry/virtualenvs/mipha-kl4lG4Iw-py3.11/lib/python3.11/site-packages/discord/utils.py\", line 1086, in evaluate_annotation\r\n    evaluated = evaluate_annotation(eval(tp, globals, locals), globals, locals, cache)\r\n                                    ^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"<string>\", line 1, in <module>\r\nNameError: name 'MangaView' is not defined\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/penumbra/projects/personal/mipha/bot.py\", line 511, in main\r\n    await bot.load_extension(ext)\r\n  File \"/home/penumbra/.cache/pypoetry/virtualenvs/mipha-kl4lG4Iw-py3.11/lib/python3.11/site-packages/discord/ext/commands/bot.py\", line 1013, in load_extension\r\n    await self._load_from_module_spec(spec, name)\r\n  File \"/home/penumbra/.cache/pypoetry/virtualenvs/mipha-kl4lG4Iw-py3.11/lib/python3.11/site-packages/discord/ext/commands/bot.py\", line 938, in _load_from_module_spec\r\n    raise errors.ExtensionFailed(key, e) from e\r\ndiscord.ext.commands.errors.ExtensionFailed: Extension 'extensions.manga' raised an error: NameError: name 'MangaView' is not defined\r\n```\r\n\r\n</details>\r\n\r\n### Minimal Reproducible Code\r\n\r\n```python\r\nclass MangaView(discord.ui.View):\r\n    def __init__(self) -> None:\r\n        ...\r\n\r\n    @discord.ui.select(min_values=1, max_values=1, options=[])\r\n    async def select(self, interaction: discord.Interaction, item: discord.ui.Select[\"MangaView\"]) -> None:\r\n        ...\r\n```\r\n\r\n\r\n### Expected Results\r\n\r\nI expected the class and decorators to function before #9126 was merged, that is to say, the decorator transformed `self.<method>` to a `ui.Select`.\r\n\r\n### Actual Results\r\n\r\nRaises a `NameError`.\r\n\r\n### Intents\r\n\r\n`discord.Intents(3258111)`\r\n\r\n### System Information\r\n\r\n$ python -m discord -v\r\n\r\n- Python v3.11.1-final\r\n- discord.py v2.2.0-alpha\r\n    - discord.py metadata: v2.2.0a4658+gb671958e\r\n- aiohttp v3.8.3\r\n- system info: Linux 5.10.0-15-amd64 #1 SMP Debian 5.10.120-1 (2022-06-09)\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### Additional Context\r\n\r\nThis can currently be worked around by using `typing.Self` or `typing_extensions.Self` but this relies on >Python 3.8 or an external dependency we technically do not rely on.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/9136/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/9136/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8963", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8963/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8963/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8963/events", "html_url": "https://github.com/Rapptz/discord.py/issues/8963", "id": 1388275388, "node_id": "I_kwDOAnRas85Sv2a8", "number": 8963, "title": "Errors in app commands not logged after recent commit", "user": {"login": "Pirulax", "id": 12902714, "node_id": "MDQ6VXNlcjEyOTAyNzE0", "avatar_url": "https://avatars.githubusercontent.com/u/12902714?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Pirulax", "html_url": "https://github.com/Pirulax", "followers_url": "https://api.github.com/users/Pirulax/followers", "following_url": "https://api.github.com/users/Pirulax/following{/other_user}", "gists_url": "https://api.github.com/users/Pirulax/gists{/gist_id}", "starred_url": "https://api.github.com/users/Pirulax/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Pirulax/subscriptions", "organizations_url": "https://api.github.com/users/Pirulax/orgs", "repos_url": "https://api.github.com/users/Pirulax/repos", "events_url": "https://api.github.com/users/Pirulax/events{/privacy}", "received_events_url": "https://api.github.com/users/Pirulax/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-09-27T19:44:27Z", "updated_at": "2022-09-28T03:50:27Z", "closed_at": "2022-09-28T03:50:27Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nErrors in app commands not logged, even though no custom error handle is set.\r\n\r\n### Reproduction Steps\r\n\r\nCreate a basic cog, add an app command and raise any exception inside it.\r\n\r\n### Minimal Reproducible Code\r\n\r\n_No response_\r\n\r\n### Expected Results\r\n\r\nError to get logged\r\n\r\n### Actual Results\r\n\r\nError not loged\r\n\r\n### Intents\r\n\r\nmembers, guilds\r\n\r\n### System Information\r\n\r\n- Python v3.10.4-final\r\n- discord.py v2.1.0-alpha\r\n    - discord.py metadata: v2.1.0a4606+g7b595fb0\r\n- aiohttp v3.8.3\r\n- system info: Linux 5.19.0-76051900-generic #202207312230~1663791054~22.04~28340d4 SMP PREEMPT_DYNAMIC Wed S\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### Additional Context\r\n\r\nFix would be (I assume) to revert the commit causing the issue: https://github.com/Rapptz/discord.py/commit/6e5392c6e2af1b93509c82c9124cee4239ccfb37 \r\nIf there are any questions, I'm happy to help.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8963/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8963/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8472", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8472/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8472/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8472/events", "html_url": "https://github.com/Rapptz/discord.py/issues/8472", "id": 1376657343, "node_id": "I_kwDOAnRas85SDh-_", "number": 8472, "title": "ForumChannel annotation throws TypeError", "user": {"login": "dfitzpatrick", "id": 980301, "node_id": "MDQ6VXNlcjk4MDMwMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/980301?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dfitzpatrick", "html_url": "https://github.com/dfitzpatrick", "followers_url": "https://api.github.com/users/dfitzpatrick/followers", "following_url": "https://api.github.com/users/dfitzpatrick/following{/other_user}", "gists_url": "https://api.github.com/users/dfitzpatrick/gists{/gist_id}", "starred_url": "https://api.github.com/users/dfitzpatrick/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dfitzpatrick/subscriptions", "organizations_url": "https://api.github.com/users/dfitzpatrick/orgs", "repos_url": "https://api.github.com/users/dfitzpatrick/repos", "events_url": "https://api.github.com/users/dfitzpatrick/events{/privacy}", "received_events_url": "https://api.github.com/users/dfitzpatrick/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-09-17T04:04:44Z", "updated_at": "2022-09-17T04:12:23Z", "closed_at": "2022-09-17T04:12:23Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\n\nForumChannels cannot be used as an app_command annotation\n\n### Reproduction Steps\n\nUpgraded to 2.1a on commits dated 9/15/22.\r\nAttempted to use ForumChannel as a annotation/converter in an app command\r\nTypeError is thrown when Cog is loaded:\r\n\r\n\r\n![image](https://user-images.githubusercontent.com/980301/190839588-a627bcf6-ef12-4360-865a-353f171cbccb.png)\r\n![image](https://user-images.githubusercontent.com/980301/190839598-592c3040-f2d9-4f88-b43b-190d8ab2a8ea.png)\r\n\n\n### Minimal Reproducible Code\n\n```python\n`class ReproduceCog(Cog):\r\n\r\n    def __init__(self, bot):\r\n        self.bot = bot\r\n\r\n    @app_commands.command(name='reproduce')\r\n    async def reproduce(self, interaction: discord.Interaction, channel: discord.ForumChannel):\r\n        await interaction.response.send_message(channel.name)\r\n`\n```\n\n\n### Expected Results\n\nResponds with the channel name\r\n\n\n### Actual Results\n\nTraceback (most recent call last):\r\n2022-09-17T04:03:06.325918700Z   File \"/usr/local/lib/python3.10/site-packages/discord/ext/commands/bot.py\", line 934, in _load_from_module_spec\r\n2022-09-17T04:03:06.325921300Z     spec.loader.exec_module(lib)  # type: ignore\r\n2022-09-17T04:03:06.325923700Z   File \"<frozen importlib._bootstrap_external>\", line 883, in exec_module\r\n2022-09-17T04:03:06.325926100Z   File \"<frozen importlib._bootstrap>\", line 241, in _call_with_frames_removed\r\n2022-09-17T04:03:06.325928600Z   File \"/home/bot/amelia/cogs/reproducecog.py\", line 21, in <module>\r\n2022-09-17T04:03:06.325931100Z     class ReproduceCog(Cog):\r\n2022-09-17T04:03:06.325933500Z   File \"/home/bot/amelia/cogs/reproducecog.py\", line 27, in ReproduceCog\r\n2022-09-17T04:03:06.325935900Z     async def reproduce(self, interaction: discord.Interaction, channel: discord.ForumChannel):\r\n2022-09-17T04:03:06.325938300Z   File \"/usr/local/lib/python3.10/site-packages/discord/app_commands/commands.py\", line 2010, in decorator\r\n2022-09-17T04:03:06.325940700Z     return Command(\r\n2022-09-17T04:03:06.325943000Z   File \"/usr/local/lib/python3.10/site-packages/discord/app_commands/commands.py\", line 680, in __init__\r\n2022-09-17T04:03:06.325945500Z     self._params: Dict[str, CommandParameter] = _extract_parameters_from_callback(callback, callback.__globals__)\r\n2022-09-17T04:03:06.325960600Z   File \"/usr/local/lib/python3.10/site-packages/discord/app_commands/commands.py\", line 393, in _extract_parameters_from_callback\r\n2022-09-17T04:03:06.325963400Z     param = annotation_to_parameter(resolved, parameter)\r\n2022-09-17T04:03:06.325965700Z   File \"/usr/local/lib/python3.10/site-packages/discord/app_commands/transformers.py\", line 831, in annotation_to_parameter\r\n2022-09-17T04:03:06.325968200Z     (inner, default, validate_default) = get_supported_annotation(annotation)\r\n2022-09-17T04:03:06.325970600Z   File \"/usr/local/lib/python3.10/site-packages/discord/app_commands/transformers.py\", line 790, in get_supported_annotation\r\n2022-09-17T04:03:06.325973000Z     raise TypeError(f'unsupported type annotation {annotation!r}')\r\n2022-09-17T04:03:06.325975400Z TypeError: unsupported type annotation <class 'discord.channel.ForumChannel'>\r\n2022-09-17T04:03:06.325977800Z \r\n2022-09-17T04:03:06.325980100Z The above exception was the direct cause of the following exception:\r\n2022-09-17T04:03:06.325982400Z \r\n2022-09-17T04:03:06.325984700Z Traceback (most recent call last):\r\n2022-09-17T04:03:06.325987400Z   File \"/usr/local/lib/python3.10/asyncio/events.py\", line 80, in _run\r\n2022-09-17T04:03:06.325989900Z     self._context.run(self._callback, *self._args)\r\n2022-09-17T04:03:06.325992200Z   File \"/home/bot/amelia/__main__.py\", line 25, in bot_task_callback\r\n2022-09-17T04:03:06.325994600Z     raise future.exception()\r\n2022-09-17T04:03:06.325996800Z   File \"/home/bot/amelia/__main__.py\", line 61, in run_bot\r\n2022-09-17T04:03:06.325999200Z     await bot.start(token)\r\n2022-09-17T04:03:06.326001500Z   File \"/usr/local/lib/python3.10/site-packages/discord/client.py\", line 745, in start\r\n2022-09-17T04:03:06.326003900Z     await self.login(token)\r\n2022-09-17T04:03:06.326006200Z   File \"/usr/local/lib/python3.10/site-packages/discord/client.py\", line 589, in login\r\n2022-09-17T04:03:06.326008600Z     await self.setup_hook()\r\n2022-09-17T04:03:06.326010900Z   File \"/home/bot/amelia/bot.py\", line 56, in setup_hook\r\n2022-09-17T04:03:06.326013200Z     await self._load_extension(ext)\r\n2022-09-17T04:03:06.326015500Z   File \"/home/bot/amelia/bot.py\", line 63, in _load_extension\r\n2022-09-17T04:03:06.326017900Z     await self.load_extension(name)\r\n2022-09-17T04:03:06.326020200Z   File \"/usr/local/lib/python3.10/site-packages/discord/ext/commands/bot.py\", line 1012, in load_extension\r\n2022-09-17T04:03:06.326022600Z     await self._load_from_module_spec(spec, name)\r\n2022-09-17T04:03:06.326024900Z   File \"/usr/local/lib/python3.10/site-packages/discord/ext/commands/bot.py\", line 937, in _load_from_module_spec\r\n2022-09-17T04:03:06.326027400Z     raise errors.ExtensionFailed(key, e) from e\r\n2022-09-17T04:03:06.326029700Z discord.ext.commands.errors.ExtensionFailed: Extension 'amelia.cogs.reproducecog' raised an error: TypeError: unsupported type annotation <class 'discord.channel.ForumChannel'>\n\n### Intents\n\nmembers, guilds, messages\n\n### System Information\n\n- Python v3.10.7-final\r\n- discord.py v2.1.0-alpha\r\n    - discord.py metadata: v2.1.0a4593+gb5dc9e54\r\n- aiohttp v3.7.4.post0\r\n- system info: Linux 4.9.184-linuxkit #1 SMP Tue Jul 2 22:58:16 UTC 2019\r\n\n\n### Checklist\n\n- [X] I have searched the open issues for duplicates.\n- [X] I have shown the entire traceback, if possible.\n- [X] I have removed my token from display, if visible.\n\n### Additional Context\n\n_No response_", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8472/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8472/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8461", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8461/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8461/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8461/events", "html_url": "https://github.com/Rapptz/discord.py/issues/8461", "id": 1369297455, "node_id": "I_kwDOAnRas85RndIv", "number": 8461, "title": "HybridGroup.before_invoke doesn't pass in self paramater when invoking via fallback slash command", "user": {"login": "ilovetocode2019", "id": 54194229, "node_id": "MDQ6VXNlcjU0MTk0MjI5", "avatar_url": "https://avatars.githubusercontent.com/u/54194229?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ilovetocode2019", "html_url": "https://github.com/ilovetocode2019", "followers_url": "https://api.github.com/users/ilovetocode2019/followers", "following_url": "https://api.github.com/users/ilovetocode2019/following{/other_user}", "gists_url": "https://api.github.com/users/ilovetocode2019/gists{/gist_id}", "starred_url": "https://api.github.com/users/ilovetocode2019/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ilovetocode2019/subscriptions", "organizations_url": "https://api.github.com/users/ilovetocode2019/orgs", "repos_url": "https://api.github.com/users/ilovetocode2019/repos", "events_url": "https://api.github.com/users/ilovetocode2019/events{/privacy}", "received_events_url": "https://api.github.com/users/ilovetocode2019/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-09-12T05:21:35Z", "updated_at": "2022-09-12T19:31:10Z", "closed_at": "2022-09-12T19:31:09Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\n\nWhen declaring a hybrid group in a cog with a fallback, the fallback fails to run if a before_invoke hook is set\n\n### Reproduction Steps\n\n1. Create a hybrid group with a callback, inside of a Cog\r\n2. Set a before_invoke hook that requires two parameters: self and ctx\r\n3. Use the fallback slash command, and the self parameter will not be passed into the before_invoke hook\n\n### Minimal Reproducible Code\n\n```python\nclass Cog(commands.Cog):\r\n    @commands.hybrid_group(fallback='show')\r\n    async def todo(self, ctx: commands.Context):\r\n        ...\r\n\r\n    @todo.before_invoke\r\n    async def some_hook(self, ctx: commands.Context):\r\n        ...\n```\n\n\n### Expected Results\n\nCalling !todo invokes the command, and so does calling /todo show.\n\n### Actual Results\n\nCalling !todo runs, while calling /todo show fails because only the context is passed to some_hook and not the self paramater.\r\n\r\n```python\r\n    await self._before_invoke(ctx)  # type: ignore\r\nTypeError: Cog.some_hook() missing 1 required positional argument: 'ctx'\r\n```\n\n### Intents\n\nAll intents\n\n### System Information\n\n- Python v3.10.6-final\r\n- discord.py v2.0.1-final\r\n- aiohttp v3.8.1\r\n- system info: Windows 10 10.0.22000\n\n### Checklist\n\n- [X] I have searched the open issues for duplicates.\n- [X] I have shown the entire traceback, if possible.\n- [X] I have removed my token from display, if visible.\n\n### Additional Context\n\nAfter some research, I've deduced that this happens because the HybridGroupCommand's fallback HybridAppCommand has a wrapped Command with the cog attribute set to None. ", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8461/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8461/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8455", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8455/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8455/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8455/events", "html_url": "https://github.com/Rapptz/discord.py/issues/8455", "id": 1368610028, "node_id": "I_kwDOAnRas85Rk1Ts", "number": 8455, "title": "cog_app_command_error still prints the traceback", "user": {"login": "Guddi8", "id": 59566564, "node_id": "MDQ6VXNlcjU5NTY2NTY0", "avatar_url": "https://avatars.githubusercontent.com/u/59566564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Guddi8", "html_url": "https://github.com/Guddi8", "followers_url": "https://api.github.com/users/Guddi8/followers", "following_url": "https://api.github.com/users/Guddi8/following{/other_user}", "gists_url": "https://api.github.com/users/Guddi8/gists{/gist_id}", "starred_url": "https://api.github.com/users/Guddi8/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Guddi8/subscriptions", "organizations_url": "https://api.github.com/users/Guddi8/orgs", "repos_url": "https://api.github.com/users/Guddi8/repos", "events_url": "https://api.github.com/users/Guddi8/events{/privacy}", "received_events_url": "https://api.github.com/users/Guddi8/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-09-10T12:39:12Z", "updated_at": "2022-11-15T12:48:05Z", "closed_at": "2022-09-24T05:22:48Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\n\nIf I have an cog_app_command_error function in my cog and a app command error apears, it does all the stuff in that cog_app_command_error but also prints the traceback (cog_command_error for normal commands works fine and does not print it)\n\n### Reproduction Steps\n\n- Create a `commands.Bot()`\r\n- add a cog with some `app_commands.command()` and a `cog_app_command_error` method\r\n- sync the commands tree\r\n- and use the commands\n\n### Minimal Reproducible Code\n\n```python\nimport discord\r\nfrom discord import app_commands\r\nfrom discord.ext import commands\r\n\r\nbot = commands.Bot(command_prefix=commands.when_mentioned, intents=discord.Intents.default())\r\n\r\n@bot.event\r\nasync def setup_hook():\r\n    await bot.add_cog(ErrorTesting(bot))\r\n    bot.tree.copy_global_to(guild=discord.Object(1014532056367235154))\r\n    await bot.tree.sync(guild=discord.Object(1014532056367235154))\r\n\r\n\r\nclass ErrorTesting(commands.Cog):\r\n    def __init__(self, bot):\r\n        self.bot = bot\r\n\r\n    async def cog_app_command_error(self, interaction, error) -> None:\r\n        print('app error', type(error), error)\r\n\r\n    @app_commands.command()\r\n    async def test001(self, interaction):\r\n        raise Exception('test001 app command')\r\n\r\n    @app_commands.command()\r\n    async def test002(self, interaction):\r\n        raise Exception('test002 app command')\r\n    \r\n\r\nbot.run('TOKEN')\n```\n\n\n### Expected Results\n\nthe `cog_app_command_error` mehtod handels the error and stops the traceback\r\noutput: \r\n```py\r\napp error <class 'discord.app_commands.errors.CommandInvokeError'> Command 'test001' raised an exception: Exception: test001 app command\r\n```\n\n### Actual Results\n\nthe `cog_app_command_error` mehtod did print, but the traceback is still there\r\noutput: \r\n```py\r\napp error <class 'discord.app_commands.errors.CommandInvokeError'> Command 'test001' raised an exception: Exception: test001 app command\r\n[2022-09-10 14:14:23] [ERROR   ] discord.app_commands.tree: Ignoring exception in command 'test001'\r\nTraceback (most recent call last):\r\n  File \"D:\\Path\\env\\lib\\site-packages\\discord\\app_commands\\commands.py\", line 850, in _do_call\r\n    return await self._callback(self.binding, interaction, **params)  # type: ignore\r\n  File \"D:\\Path\\main.py\", line 23, in test001\r\n    raise Exception('test001 app command')\r\nException: test001 app command\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"D:\\Path\\env\\lib\\site-packages\\discord\\app_commands\\tree.py\", line 1240, in _call\r\n    await command._invoke_with_namespace(interaction, namespace)\r\n  File \"D:\\Path\\env\\lib\\site-packages\\discord\\app_commands\\commands.py\", line 876, in _invoke_with_namespace\r\n    return await self._do_call(interaction, transformed_values)\r\n  File \"D:\\Path\\env\\lib\\site-packages\\discord\\app_commands\\commands.py\", line 869, in _do_call\r\n    raise CommandInvokeError(self, e) from e\r\ndiscord.app_commands.errors.CommandInvokeError: Command 'test001' raised an exception: Exception: test001 app command\r\n```\n\n### Intents\n\ndefault\n\n### System Information\n\n- Python v3.9.7-final\r\n- discord.py v2.0.1-final\r\n- aiohttp v3.8.1\r\n- system info: Windows 10 10.0.19043\n\n### Checklist\n\n- [X] I have searched the open issues for duplicates.\n- [X] I have shown the entire traceback, if possible.\n- [x] I have removed my token from display, if visible.\n\n### Additional Context\n\n- The `cog_command_error` works fine for normal command\r\n\r\n- Also tried raising a `discord.DiscordException` or `app_commands.AppCommandError`\r\n\r\n- Adding a `@test002.error` decorator to the `ErrorTesting` cog\r\n    ```py\r\n    @test002.error\r\n    async def test002_error(self, interaction, error):\r\n        print('test002_error', type(error), error)\r\n    ```\r\n    for `/test002` it now prints _below_ and no traceback\r\n    ```\r\n    test002_error <class 'discord.app_commands.errors.AppCommandError'> test002 app command\r\n    app error <class 'discord.app_commands.errors.AppCommandError'> test002 app command\r\n    ```\r\n\r\nAlready asked in the discord about this, [here](https://discord.com/channels/336642139381301249/1017967866806554685/1017967866806554685)", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8455/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8455/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8445", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8445/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8445/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8445/events", "html_url": "https://github.com/Rapptz/discord.py/issues/8445", "id": 1365558302, "node_id": "I_kwDOAnRas85RZMQe", "number": 8445, "title": "Python 3.10 Union syntax breaks when used with commands.Range", "user": {"login": "lmaotrigine", "id": 57328245, "node_id": "MDQ6VXNlcjU3MzI4MjQ1", "avatar_url": "https://avatars.githubusercontent.com/u/57328245?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lmaotrigine", "html_url": "https://github.com/lmaotrigine", "followers_url": "https://api.github.com/users/lmaotrigine/followers", "following_url": "https://api.github.com/users/lmaotrigine/following{/other_user}", "gists_url": "https://api.github.com/users/lmaotrigine/gists{/gist_id}", "starred_url": "https://api.github.com/users/lmaotrigine/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lmaotrigine/subscriptions", "organizations_url": "https://api.github.com/users/lmaotrigine/orgs", "repos_url": "https://api.github.com/users/lmaotrigine/repos", "events_url": "https://api.github.com/users/lmaotrigine/events{/privacy}", "received_events_url": "https://api.github.com/users/lmaotrigine/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-09-08T05:34:30Z", "updated_at": "2022-09-08T06:04:08Z", "closed_at": "2022-09-08T06:04:08Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\n\ntitle\n\n### Reproduction Steps\n\nannotate a commmand parameter as optional using the 3.10 `|` syntax and it fails with a TypeError on being initialized.\n\n### Minimal Reproducible Code\n\n```python\nfrom __future__ import annotations\r\n\r\nimport discord\r\nfrom discord.ext import commands\r\n\r\nimport config\r\n\r\nbot = commands.Bot(command_prefix=commands.when_mentioned, intents=discord.Intents.default())\r\n\r\n\r\n@bot.command()\r\nasync def echo(ctx: commands.Context, *, param: commands.Range[int, 1, 1000] | None) -> None:\r\n    await ctx.send(f\"{param or 'No param given'}\")\r\n\r\nbot.run(config.token)\n```\n\n\n### Expected Results\n\nThe annotation should get evaluated normally.\n\n### Actual Results\n\n```pytb\r\nTraceback (most recent call last):\r\n  File \"/home/***/_testing/range.py\", line 12, in <module>\r\n    async def echo(ctx: commands.Context, *, param: commands.Range[int, 1, 1000] | None) -> None:\r\n  File \"/home/***/.cache/pypoetry/virtualenvs/testing-a1XER55G-py3.10/lib/python3.10/site-packages/discord/ext/commands/core.py\", line 1512, in decorator\r\n    result = command(name=name, cls=cls, *args, **kwargs)(func)\r\n  File \"/home/***/.cache/pypoetry/virtualenvs/testing-a1XER55G-py3.10/lib/python3.10/site-packages/discord/ext/commands/core.py\", line 1785, in decorator\r\n    return cls(func, name=name, **attrs)\r\n  File \"/home/***/.cache/pypoetry/virtualenvs/testing-a1XER55G-py3.10/lib/python3.10/site-packages/discord/ext/commands/core.py\", line 400, in __init__\r\n    self.callback = func\r\n  File \"/home/***/.cache/pypoetry/virtualenvs/testing-a1XER55G-py3.10/lib/python3.10/site-packages/discord/ext/commands/core.py\", line 507, in callback\r\n    self.params: Dict[str, Parameter] = get_signature_parameters(function, globalns)\r\n  File \"/home/***/.cache/pypoetry/virtualenvs/testing-a1XER55G-py3.10/lib/python3.10/site-packages/discord/ext/commands/core.py\", line 161, in get_signature_parameters\r\n    annotation = eval_annotation(annotation, globalns, globalns, cache)\r\n  File \"/home/***/.cache/pypoetry/virtualenvs/testing-a1XER55G-py3.10/lib/python3.10/site-packages/discord/utils.py\", line 1074, in evaluate_annotation\r\n    evaluated = evaluate_annotation(eval(tp, globals, locals), globals, locals, cache)\r\n  File \"<string>\", line 1, in <module>\r\nTypeError: unsupported operand type(s) for |: 'Range' and 'NoneType'\r\n```\n\n### Intents\n\nNot applicable, but discord.Intents.default()\n\n### System Information\n\n- Python v3.10.4-final\r\n- discord.py v2.1.0-alpha\r\n    - discord.py metadata: v2.1.0a4584+g771476a8\r\n- aiohttp v3.8.1\r\n- system info: Linux 5.15.0-47-generic #51-Ubuntu SMP Thu Aug 11 07:51:15 UTC 2022\n\n### Checklist\n\n- [X] I have searched the open issues for duplicates.\n- [X] I have shown the entire traceback, if possible.\n- [X] I have removed my token from display, if visible.\n\n### Additional Context\n\n_No response_", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8445/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8445/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8319", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8319/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8319/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8319/events", "html_url": "https://github.com/Rapptz/discord.py/issues/8319", "id": 1333520483, "node_id": "I_kwDOAnRas85Pe-hj", "number": 8319, "title": "Multiple selects error", "user": {"login": "Randomneo", "id": 10756368, "node_id": "MDQ6VXNlcjEwNzU2MzY4", "avatar_url": "https://avatars.githubusercontent.com/u/10756368?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Randomneo", "html_url": "https://github.com/Randomneo", "followers_url": "https://api.github.com/users/Randomneo/followers", "following_url": "https://api.github.com/users/Randomneo/following{/other_user}", "gists_url": "https://api.github.com/users/Randomneo/gists{/gist_id}", "starred_url": "https://api.github.com/users/Randomneo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Randomneo/subscriptions", "organizations_url": "https://api.github.com/users/Randomneo/orgs", "repos_url": "https://api.github.com/users/Randomneo/repos", "events_url": "https://api.github.com/users/Randomneo/events{/privacy}", "received_events_url": "https://api.github.com/users/Randomneo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2022-08-09T16:43:58Z", "updated_at": "2022-08-14T19:25:44Z", "closed_at": "2022-08-14T19:25:44Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\n\nmaster commit breaks multiple selects\n\n### Reproduction Steps\n\nthis [commit](https://github.com/Rapptz/discord.py/tree/d826f4f3a8d4d97d24499f5de5c51e11e640e98f) provides global state for `Select` object \n\n### Minimal Reproducible Code\n\n_No response_\n\n### Expected Results\n\nNo global state\n\n### Actual Results\n\nglobal state\n\n### Intents\n\n...\n\n### System Information\n\n...\n\n### Checklist\n\n- [X] I have searched the open issues for duplicates.\n- [X] I have shown the entire traceback, if possible.\n- [X] I have removed my token from display, if visible.\n\n### Additional Context\n\n_No response_", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8319/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8319/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8309", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8309/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8309/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8309/events", "html_url": "https://github.com/Rapptz/discord.py/issues/8309", "id": 1330592746, "node_id": "I_kwDOAnRas85PTzvq", "number": 8309, "title": "Values inside \"extras\" dict for classic/hybrid commands/groups are not preserved unless some dict is explicitly passed in", "user": {"login": "Tomlacko", "id": 72975448, "node_id": "MDQ6VXNlcjcyOTc1NDQ4", "avatar_url": "https://avatars.githubusercontent.com/u/72975448?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Tomlacko", "html_url": "https://github.com/Tomlacko", "followers_url": "https://api.github.com/users/Tomlacko/followers", "following_url": "https://api.github.com/users/Tomlacko/following{/other_user}", "gists_url": "https://api.github.com/users/Tomlacko/gists{/gist_id}", "starred_url": "https://api.github.com/users/Tomlacko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Tomlacko/subscriptions", "organizations_url": "https://api.github.com/users/Tomlacko/orgs", "repos_url": "https://api.github.com/users/Tomlacko/repos", "events_url": "https://api.github.com/users/Tomlacko/events{/privacy}", "received_events_url": "https://api.github.com/users/Tomlacko/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-08-06T00:42:16Z", "updated_at": "2022-08-06T01:57:27Z", "closed_at": "2022-08-06T01:57:27Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nWhen creating a classic/hybrid command/group via a decorator inside a cog, the created command's `extras` dictionary and its values (and possibly other attributes that I haven't tested) aren't preserved unless something is passed to the `extras` argument of the decorator.\r\n\r\n### Reproduction Steps\r\n\r\nFor convenience, assume we have this import:\r\n```python\r\nfrom discord.ext import commands\r\n```\r\n\r\nDefine the following custom decorator somewhere in code:\r\n```python\r\ndef my_decorator(cmd):\r\n    cmd.extras[\"my_extra_value\"] = 1337\r\n    return cmd\r\n```\r\n\r\n#### Here's the example that DOESN'T work:\r\n(Here we're defining a command inside a cog)\r\n```python\r\n@my_decorator\r\n@commands.command(\"my_command\")\r\nasync def my_command(self, ctx):\r\n    pass\r\n```\r\nNow inside one of the cog's methods, we try get the command and its `extras` values:\r\n```python\r\nprint(\r\n    self.get_commands()[0].extras.get(\"my_extra_value\", None)\r\n)\r\n```\r\nThis prints `None` instead of `1337`.\r\n\r\n#### Now, here's the example that DOES work:\r\n(Again, defining a command inside a cog, this time passing in empty `extras` beforehand)\r\n```python\r\n@my_decorator\r\n@commands.command(\"my_command\", extras={})\r\nasync def my_command(self, ctx):\r\n    pass\r\n```\r\nIf we now try this inside one of the cog's methods:\r\n```python\r\nprint(\r\n    self.get_commands()[0].extras.get(\"my_extra_value\", None)\r\n)\r\n```\r\nWe see that `1337` gets correctly printed.\r\n\r\n### Expected Results\r\n\r\nI expected the values inside the `extras` dict to be preserved whether an empty dict is passed in or not.\r\n\r\n### Actual Results\r\n\r\nThe values inside the `extras` dict were only preserved when some dict was explicitly passed in.\r\n\r\n### Intents\r\n\r\n`discord.Intents.all()`\r\n\r\n### System Information\r\n\r\n```\r\n- Python v3.9.2-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a4459+gd7070193\r\n- aiohttp v3.7.4.post0\r\n- system info: Linux 5.10.0-9-amd64 #1 SMP Debian 5.10.70-1 (2021-09-30)\r\n```\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8309/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8309/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8276", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8276/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8276/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8276/events", "html_url": "https://github.com/Rapptz/discord.py/issues/8276", "id": 1322364149, "node_id": "I_kwDOAnRas85O0az1", "number": 8276, "title": "before and after invoke hooks for hybrid commands don't work the same as text commands", "user": {"login": "MrReacher", "id": 23434880, "node_id": "MDQ6VXNlcjIzNDM0ODgw", "avatar_url": "https://avatars.githubusercontent.com/u/23434880?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MrReacher", "html_url": "https://github.com/MrReacher", "followers_url": "https://api.github.com/users/MrReacher/followers", "following_url": "https://api.github.com/users/MrReacher/following{/other_user}", "gists_url": "https://api.github.com/users/MrReacher/gists{/gist_id}", "starred_url": "https://api.github.com/users/MrReacher/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MrReacher/subscriptions", "organizations_url": "https://api.github.com/users/MrReacher/orgs", "repos_url": "https://api.github.com/users/MrReacher/repos", "events_url": "https://api.github.com/users/MrReacher/events{/privacy}", "received_events_url": "https://api.github.com/users/MrReacher/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-07-29T15:05:14Z", "updated_at": "2022-07-30T08:44:27Z", "closed_at": "2022-07-30T08:44:27Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\n\nbefore and after invoke hooks behave differently\n\n### Reproduction Steps\n\n```python\r\n@commands.hybrid_command()\r\nasync def test(self, ctx):\r\n    print('called test command')\r\n    await ctx.send('some reply')\r\n\r\n@test.before_invoke\r\nasync def before_test(self, ctx):\r\n    print('called before_test')\r\n    raise commands.DisabledCommand()\r\n\r\n@test.after_invoke\r\nasync def after_test(self, ctx):\r\n    print('called after_test')\r\n```\n\n### Minimal Reproducible Code\n\n_No response_\n\n### Expected Results\n\nI would expect the slash command to work the same as the text command. That is, running `/test` would result in printing `\"called before_test\"` and stop there, without calling `after_invoke` or the command itself.\n\n### Actual Results\n\nRunning `?test` (text command) will print `\"called before_test\"` and stops there, but running `/test` (slash command) will print  `\"called before_test\"` and `\"called after_test\"`. In both cases the command isn't executed.\n\n### Intents\n\nall intents\n\n### System Information\n\n- Python v3.8.10-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a4437+gdc8cbc07\r\n- aiohttp v3.8.1\r\n- system info: `Linux 5.4.0-121-generic #137-Ubuntu SMP Wed Jun 15 13:33:07 UTC 2022`\n\n### Checklist\n\n- [X] I have searched the open issues for duplicates.\n- [X] I have shown the entire traceback, if possible.\n- [X] I have removed my token from display, if visible.\n\n### Additional Context\n\n_No response_", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8276/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8276/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8264", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8264/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8264/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8264/events", "html_url": "https://github.com/Rapptz/discord.py/issues/8264", "id": 1315724644, "node_id": "I_kwDOAnRas85ObF1k", "number": 8264, "title": "Crash from Automod due to missing key in data structure. ", "user": {"login": "aldalen", "id": 93111434, "node_id": "U_kgDOBYzEig", "avatar_url": "https://avatars.githubusercontent.com/u/93111434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aldalen", "html_url": "https://github.com/aldalen", "followers_url": "https://api.github.com/users/aldalen/followers", "following_url": "https://api.github.com/users/aldalen/following{/other_user}", "gists_url": "https://api.github.com/users/aldalen/gists{/gist_id}", "starred_url": "https://api.github.com/users/aldalen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aldalen/subscriptions", "organizations_url": "https://api.github.com/users/aldalen/orgs", "repos_url": "https://api.github.com/users/aldalen/repos", "events_url": "https://api.github.com/users/aldalen/events{/privacy}", "received_events_url": "https://api.github.com/users/aldalen/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 397573646, "node_id": "MDU6TGFiZWwzOTc1NzM2NDY=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/discord%20bug", "name": "discord bug", "color": "5319e7", "default": false, "description": "This is a Discord bug, not one with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-07-23T18:57:26Z", "updated_at": "2022-07-23T19:15:58Z", "closed_at": "2022-07-23T19:15:58Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nCrash from automod with \"content\" key not found. \r\n\r\n### Reproduction Steps\r\n\r\nI can't seem to replicate this locally since its dependent on certain discord settings, but I see it in my production bot instance. \r\n\r\n### Minimal Reproducible Code\r\n\r\n_No response_\r\n\r\n### Expected Results\r\n\r\nNo crash :) \r\n\r\n### Actual Results\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"./runtime.py\", line 31, in <module>\r\n    asyncio.run(main())\r\n  File \"/usr/lib/python3.10/asyncio/runners.py\", line 44, in run\r\n    return loop.run_until_complete(main)\r\n  File \"/usr/lib/python3.10/asyncio/base_events.py\", line 646, in run_until_complete\r\n    return future.result()\r\n  File \"./runtime.py\", line 27, in main\r\n    await bot.start(os.getenv('TOKEN', os.getenv(\"DISCORD_API_KEY\")))\r\n  File \"./.venv/lib/python3.10/site-packages/discord/client.py\", line 791, in start\r\n    await self.connect(reconnect=reconnect)\r\n  File \"./.venv/lib/python3.10/site-packages/discord/shard.py\", line 461, in connect\r\n    raise item.error\r\n  File \"./.venv/lib/python3.10/site-packages/discord/shard.py\", line 163, in worker\r\n    await self.ws.poll_event()\r\n  File \"./.venv/lib/python3.10/site-packages/discord/gateway.py\", line 608, in poll_event\r\n    await self.received_message(msg.data)\r\n  File \"./.venv/lib/python3.10/site-packages/discord/gateway.py\", line 558, in received_message\r\n    func(data)\r\n  File \"./.venv/lib/python3.10/site-packages/discord/state.py\", line 1121, in parse_auto_moderation_action_execution\r\n    execution = AutoModAction(data=data, state=self)\r\n  File \"./.venv/lib/python3.10/site-packages/discord/automod.py\", line 450, in __init__\r\n    self.content: str = data['content']\r\nKeyError: 'content'\r\n```\r\n\r\n### Intents\r\n\r\nIntents.default()\r\n\r\n### System Information\r\n\r\n- Python v3.10.5-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a4424+g31189191\r\n- aiohttp v3.8.1\r\n- system info: Linux 5.15.39-1-pve #1 SMP PVE 5.15.39-1 (Wed, 22 Jun 2022 17:22:00 +0200)\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### Additional Context\r\n\r\nI don't need automod in my bot, so to get around the issue I just changed the offending line to:\r\n`self.content: str = data['content'] if \"content\" in data else \"\"`\r\n\r\nI am not sure what is the best solution here. Could change to an `Optional[str]` as and then just set to None if not in the data dict?", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8264/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8264/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8257", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8257/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8257/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8257/events", "html_url": "https://github.com/Rapptz/discord.py/issues/8257", "id": 1312008068, "node_id": "I_kwDOAnRas85OM6eE", "number": 8257, "title": "cog_unload is not called when an exception is encountered while loading a cog, even if cog_load runs successfully", "user": {"login": "Tomlacko", "id": 72975448, "node_id": "MDQ6VXNlcjcyOTc1NDQ4", "avatar_url": "https://avatars.githubusercontent.com/u/72975448?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Tomlacko", "html_url": "https://github.com/Tomlacko", "followers_url": "https://api.github.com/users/Tomlacko/followers", "following_url": "https://api.github.com/users/Tomlacko/following{/other_user}", "gists_url": "https://api.github.com/users/Tomlacko/gists{/gist_id}", "starred_url": "https://api.github.com/users/Tomlacko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Tomlacko/subscriptions", "organizations_url": "https://api.github.com/users/Tomlacko/orgs", "repos_url": "https://api.github.com/users/Tomlacko/repos", "events_url": "https://api.github.com/users/Tomlacko/events{/privacy}", "received_events_url": "https://api.github.com/users/Tomlacko/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-07-20T22:06:16Z", "updated_at": "2022-07-21T02:31:15Z", "closed_at": "2022-07-21T02:31:15Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\n`cog_unload` is not called when an exception occurs while loading a cog. This by itself could be considered 'works as intended', since the cog is assumed to have failed to load, however this behavior occurs even if the `cog_load` method runs successfully, which is an issue, since any resources allocated by the cog here will never get unloaded.\r\n\r\n### Reproduction Steps\r\n\r\n1. Create a cog with a `cog_unload` method.\r\n2. Optionally add a `cog_load` method to the cog. This isn't required but it helps to demonstrate the issue.\r\n3. Do something that raises an exception during the cog loading process. This can be caused either by raising an exception in the `cog_load` method or by using a decorator with an invalid value (in my case, accidentally using the `discord.ext.commands.command()` decorator with a command name that is already registered elsewhere).\r\n4. Run the bot and attempt to load this cog/extension (in my case via `bot.load_extension`).\r\n5. (See Actual Results for what goes wrong.)\r\n\r\n### Minimal Reproducible Code\r\n\r\n```python\r\nfrom discord.ext import commands\r\n\r\n\r\nasync def setup(bot: commands.Bot):\r\n    await bot.add_cog(TestCog(bot))\r\n\r\nasync def teardown(bot: commands.Bot):\r\n    print(\"Teardown\") # This runs\r\n\r\n\r\n\r\nclass TestCog(commands.Cog):\r\n    def __init__(self, bot: commands.Bot):\r\n        print(\"Initializing cog!\") # This runs\r\n\r\n    async def cog_load(self):\r\n        print(\"Loading cog!\") # This runs\r\n    \r\n    async def cog_unload(self):\r\n        print(\"Unloading cog!\") # This DOESN'T run!\r\n\r\n    @commands.command(name=\"test\")\r\n    async def test1(self, ctx: commands.Context):\r\n        pass\r\n    \r\n    @commands.command(name=\"test\") # This causes the cog to crash while it's loading\r\n    async def test2(self, ctx: commands.Context):\r\n        pass\r\n```\r\n\r\n\r\n### Expected Results\r\n\r\nI would expect at least one (preferably both) of these things to happen:\r\n- The `cog_load` method doesn't run at all under these circumstances.\r\n- The `cog_unload` method should always run if a call to `cog_load` is made by the library.\r\n\r\n### Actual Results\r\n\r\nThis is what happens, step by step, when `bot.load_extension` gets called by the user while attempting to load the cog example above:\r\n1. The `setup` function gets successfully called.\r\n2. The `TestCog` is successfully instantiated (\"Initializing cog!\" gets printed).\r\n3. The `cog_load` method successfully runs (\"Loading cog!\" gets printed).\r\n4. The extension will raise a `CommandRegistrationError` because of the duplicate command names. This causes the extension to start unloading.\r\n5. The `cog_unload` method never runs! (\"Unloading cog!\" never gets printed)\r\n6. The `teardown` function gets successfully called (\"Teardown\" gets printed).\r\n7. The original `bot.load_extension` raises an exception, with the extension not being loaded, but any resources allocated in `cog_load` are still left open.\r\n\r\n### Intents\r\n\r\n`discord.Intents.all()`\r\n\r\n### System Information\r\n\r\n```\r\n- Python v3.9.2-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a4403+g1aaa32d4\r\n- aiohttp v3.7.4.post0\r\n- system info: Linux 5.10.0-9-amd64 #1 SMP Debian 5.10.70-1 (2021-09-30)\r\n```\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### Additional Context\r\n\r\nException generated by the code example given above:\r\n```\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.9/dist-packages/discord/ext/commands/bot.py\", line 929, in _load_from_module_spec\r\n    await setup(self)\r\n  File \"/root/bots/test.py\", line 5, in setup\r\n    await bot.add_cog(TestCog(bot))\r\n  File \"/usr/local/lib/python3.9/dist-packages/discord/ext/commands/bot.py\", line 765, in add_cog\r\n    cog = await cog._inject(self, override=override, guild=guild, guilds=guilds)\r\n  File \"/usr/local/lib/python3.9/dist-packages/discord/ext/commands/cog.py\", line 578, in _inject\r\n    raise e\r\n  File \"/usr/local/lib/python3.9/dist-packages/discord/ext/commands/cog.py\", line 572, in _inject\r\n    bot.add_command(command)\r\n  File \"/usr/local/lib/python3.9/dist-packages/discord/ext/commands/bot.py\", line 228, in add_command\r\n    super().add_command(command)\r\n  File \"/usr/local/lib/python3.9/dist-packages/discord/ext/commands/core.py\", line 1320, in add_command\r\n    raise CommandRegistrationError(command.name)\r\ndiscord.ext.commands.errors.CommandRegistrationError: The command test is already an existing command or alias.\r\n```", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8257/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8257/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8210", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8210/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8210/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8210/events", "html_url": "https://github.com/Rapptz/discord.py/issues/8210", "id": 1294879885, "node_id": "I_kwDOAnRas85NLkyN", "number": 8210, "title": "\"RuntimeError: Session is closed\" after using .close() in setup_hook()", "user": {"login": "Aguileitus", "id": 14335637, "node_id": "MDQ6VXNlcjE0MzM1NjM3", "avatar_url": "https://avatars.githubusercontent.com/u/14335637?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aguileitus", "html_url": "https://github.com/Aguileitus", "followers_url": "https://api.github.com/users/Aguileitus/followers", "following_url": "https://api.github.com/users/Aguileitus/following{/other_user}", "gists_url": "https://api.github.com/users/Aguileitus/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aguileitus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aguileitus/subscriptions", "organizations_url": "https://api.github.com/users/Aguileitus/orgs", "repos_url": "https://api.github.com/users/Aguileitus/repos", "events_url": "https://api.github.com/users/Aguileitus/events{/privacy}", "received_events_url": "https://api.github.com/users/Aguileitus/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-07-05T23:04:15Z", "updated_at": "2022-07-06T09:56:11Z", "closed_at": "2022-07-06T09:56:02Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nAfter using bot.close() inside setup_hook you see this \"RuntimeError: Session is closed\" error in the logs\r\n\r\n### Reproduction Steps\r\n\r\nUse bot.close inside setup_hook in Windows\r\n\r\n### Minimal Reproducible Code\r\n\r\n```python\r\nimport platform\r\n\r\nimport asyncio\r\nimport discord\r\n\r\nfrom discord.ext import commands\r\n\r\nclass TestBot(commands.AutoShardedBot):\r\n\r\n    def __init__(self) -> None:\r\n        intents: discord.Intents = discord.Intents.default()  # All but the 3 privileged ones\r\n\r\n        # Priviledged intents\r\n        # pylint: disable=assigning-non-slot\r\n        # intents.presences = True\r\n        intents.members = True\r\n        intents.message_content = True\r\n\r\n        super().__init__(command_prefix=\"!\", intents=intents)\r\n\r\n    async def setup_hook(self) -> None:\r\n        await self.close()\r\n\r\nif __name__ == \"__main__\":\r\n    if platform.system().lower() == 'windows':\r\n        # This is to prevent \"RuntimeError: Event loop is closed\" error on Client.close()\r\n        asyncio.set_event_loop_policy(asyncio.WindowsSelectorEventLoopPolicy())\r\n\r\n    bot = TestBot()\r\n    bot.run(\"TOKEN\", log_handler=None)\r\n```\r\n\r\n\r\n### Expected Results\r\n\r\nNot seeing this error.\r\n\r\n### Actual Results\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"D:\\Bot\\testbot.py\", line 41, in <module>\r\n    bot.run(Auth.TOKEN, log_handler=None)\r\n  File \"D:\\Bot\\venv\\lib\\site-packages\\discord\\client.py\", line 872, in run\r\n    asyncio.run(runner())\r\n  File \"C:\\Users\\...\\AppData\\Local\\Programs\\Python\\Python310\\lib\\asyncio\\runners.py\", line 44, in run\r\n    return loop.run_until_complete(main)\r\n  File \"C:\\Users\\...\\AppData\\Local\\Programs\\Python\\Python310\\lib\\asyncio\\base_events.py\", line 646, in run_until_complete\r\n    return future.result()\r\n  File \"D:\\Bot\\venv\\lib\\site-packages\\discord\\client.py\", line 847, in runner\r\n    await self.start(token, reconnect=reconnect)\r\n  File \"D:\\Bot\\venv\\lib\\site-packages\\discord\\client.py\", line 781, in start\r\n    await self.connect(reconnect=reconnect)\r\n  File \"D:\\Bot\\venv\\lib\\site-packages\\discord\\shard.py\", line 440, in connect\r\n    await self.launch_shards()\r\n  File \"D:\\Bot\\venv\\lib\\site-packages\\discord\\shard.py\", line 421, in launch_shards\r\n    self.shard_count, gateway = await self.http.get_bot_gateway()\r\n  File \"D:\\Bot\\venv\\lib\\site-packages\\discord\\http.py\", line 2118, in get_bot_gateway\r\n    data = await self.request(Route('GET', '/gateway/bot'))\r\n  File \"D:\\Bot\\venv\\lib\\site-packages\\discord\\http.py\", line 445, in request\r\n    async with self.__session.request(method, url, **kwargs) as response:\r\n  File \"D:\\Bot\\venv\\lib\\site-packages\\aiohttp\\client.py\", line 1138, in __aenter__\r\n    self._resp = await self._coro\r\n  File \"D:\\Bot\\venv\\lib\\site-packages\\aiohttp\\client.py\", line 399, in _request\r\n    raise RuntimeError(\"Session is closed\")\r\nRuntimeError: Session is closed\r\n```\r\n\r\n### Intents\r\n\r\nintents.members = True         intents.message_content = True\r\n\r\n### System Information\r\n\r\n- Python v3.10.4-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a4396+g9fe19dcc\r\n- aiohttp v3.8.1\r\n- system info: Windows 10 10.0.19043\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### Additional Context\r\n\r\n_No response_", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8210/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8210/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8209", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8209/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8209/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8209/events", "html_url": "https://github.com/Rapptz/discord.py/issues/8209", "id": 1294135216, "node_id": "I_kwDOAnRas85NIu-w", "number": 8209, "title": "Members that are in voice channels are not cached at startup when MemberCacheFlags is only set to voice ", "user": {"login": "Mihitoko", "id": 66904140, "node_id": "MDQ6VXNlcjY2OTA0MTQw", "avatar_url": "https://avatars.githubusercontent.com/u/66904140?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mihitoko", "html_url": "https://github.com/Mihitoko", "followers_url": "https://api.github.com/users/Mihitoko/followers", "following_url": "https://api.github.com/users/Mihitoko/following{/other_user}", "gists_url": "https://api.github.com/users/Mihitoko/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mihitoko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mihitoko/subscriptions", "organizations_url": "https://api.github.com/users/Mihitoko/orgs", "repos_url": "https://api.github.com/users/Mihitoko/repos", "events_url": "https://api.github.com/users/Mihitoko/events{/privacy}", "received_events_url": "https://api.github.com/users/Mihitoko/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-07-05T10:54:43Z", "updated_at": "2022-07-21T03:15:09Z", "closed_at": "2022-07-21T03:15:09Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nMembers that are in voice channels are not cached at startup when MemberCacheFlags is only set to voice \r\n\r\n### Reproduction Steps\r\n\r\nSetup a bot or client and set MemberCacheFlags only to voice and chunk_guild_at_startup to false\r\nJoin a voice channel and print member list in on_ready\r\n\r\nStartup bot\r\n\r\n\r\n### Minimal Reproducible Code\r\n\r\n```python\r\nimport discord\r\nfrom discord.ext.commands import Bot\r\n\r\n\r\nclass MyBot(Bot):\r\n    def __init__(self):\r\n        intents = discord.Intents.all()\r\n        intents.presences = False\r\n        intents.message_content = False\r\n        flags = discord.MemberCacheFlags.none()\r\n        flags.voice = True\r\n        print(flags.value)\r\n        super().__init__(\r\n            \"not_needed\",\r\n            intents=intents,\r\n            chunk_guilds_at_startup=False,\r\n            member_cache_flags=flags\r\n\r\n        )\r\n\r\n    async def on_ready(self):\r\n        print([i for i in self.get_all_members()])\r\n\r\n\r\nbot = MyBot()\r\nbot.run(\"<token>\")\r\n```\r\n\r\n\r\n### Expected Results\r\n\r\nThe members in voice should be cached at startup\r\n\r\n### Actual Results\r\n\r\nMembers are not cached \r\n\r\n### Intents\r\n\r\nAll except presence and and message_content (see code)\r\n\r\n### System Information\r\n\r\n- Python v3.9.5-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a4396+g9fe19dcc\r\n- aiohttp v3.8.1\r\n- system info: Windows 10 10.0.19044\r\n\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### Additional Context\r\n\r\n```py\r\ncache_joined = self._state.member_cache_flags.joined\r\n        self_id = self._state.self_id\r\n        for mdata in guild.get('members', []):\r\n            member = Member(data=mdata, guild=self, state=state)  # type: ignore # Members will have the 'user' key in this scenario\r\n            if cache_joined or member.id == self_id:\r\n                self._add_member(member)\r\n```\r\nThis is the code in guild.py in method _from_data(self, guild) at line 522.\r\nThere isnt a check to MemberCacheFlags.voice if MemberCacheFlags.join is false the member will never be cached.\r\nUnfortuany we cant ask for member.voice since voicestates are updated later and depend on cached members and channels so we cant drag it to the top.\r\n\r\n```py\r\n cache_joined = self._state.member_cache_flags.joined\r\n        self_id = self._state.self_id\r\n        for mdata in guild.get('members', []):\r\n            member = Member(data=mdata, guild=self, state=state)  # type: ignore # Members will have the 'user' key in this scenario\r\n            has_voice_state = False\r\n            for voice_state in guild.get('voice_states', []):\r\n                if voice_state[\"user_id\"] == str(member.id):\r\n                    has_voice_state = True\r\n                    break\r\n            if cache_joined or member.id == self_id or (has_voice_state and self._state.member_cache_flags.voice):\r\n                self._add_member(member)\r\n```\r\nThis could be a quick fix but im not so sure its good since we have nested for loop.\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8209/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8209/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8167", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8167/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8167/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8167/events", "html_url": "https://github.com/Rapptz/discord.py/issues/8167", "id": 1276649157, "node_id": "I_kwDOAnRas85MGB7F", "number": 8167, "title": "Context menus require resyncing after restarting the bot", "user": {"login": "ciufcia", "id": 81290016, "node_id": "MDQ6VXNlcjgxMjkwMDE2", "avatar_url": "https://avatars.githubusercontent.com/u/81290016?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ciufcia", "html_url": "https://github.com/ciufcia", "followers_url": "https://api.github.com/users/ciufcia/followers", "following_url": "https://api.github.com/users/ciufcia/following{/other_user}", "gists_url": "https://api.github.com/users/ciufcia/gists{/gist_id}", "starred_url": "https://api.github.com/users/ciufcia/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ciufcia/subscriptions", "organizations_url": "https://api.github.com/users/ciufcia/orgs", "repos_url": "https://api.github.com/users/ciufcia/repos", "events_url": "https://api.github.com/users/ciufcia/events{/privacy}", "received_events_url": "https://api.github.com/users/ciufcia/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-06-20T09:38:26Z", "updated_at": "2022-06-20T10:21:06Z", "closed_at": "2022-06-20T10:21:06Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\n\nEverytime i restart my bot, I must resync my commands first, otherwise using context menus results in \"CommandNotFound\"\n\n### Reproduction Steps\n\n- Run the bot\r\n- Sync commands\r\n- Restart the bot\r\n- Use any context menu\n\n### Minimal Reproducible Code\n\n```python\nimport discord\r\nfrom discord.ext import commands\r\n\r\nintents = discord.Intents.default()\r\nintents.presences = intents.members = intents.message_content = True\r\n\r\nbot = commands.Bot(\r\n    intents=intents,\r\n    command_prefix='.',\r\n    help_command=None,\r\n    case_insensitive=True\r\n)\r\n\r\n@bot.tree.context_menu(name='say')\r\nasync def say(interaction: discord.Interaction, member: discord.Member):\r\n    await interaction.response.send_message('I said something!')\r\n\r\n@bot.command(name='sync')\r\nasync def sync(ctx: commands.Context) -> None:\r\n    for guild in bot.guilds:\r\n        bot.tree.copy_global_to(guild=guild)\r\n        await bot.tree.sync(guild=guild)\r\n\r\nbot.run('token')\n```\n\n\n### Expected Results\n\nThe bot responds after the restart.\n\n### Actual Results\n\nTraceback (most recent call last):\r\n  File \"/home/user/.pyenv/versions/3.10.5/envs/chonker/lib/python3.10/site-packages/discord/app_commands/tree.py\", line 989, in wrapper\r\n    await self.call(interaction)\r\n  File \"/home/user/.pyenv/versions/3.10.5/envs/chonker/lib/python3.10/site-packages/discord/app_commands/tree.py\", line 1132, in call\r\n    await self._call_context_menu(interaction, data, type)\r\n  File \"/home/user/.pyenv/versions/3.10.5/envs/chonker/lib/python3.10/site-packages/discord/app_commands/tree.py\", line 1065, in _call_context_menu\r\n    raise CommandNotFound(name, [], AppCommandType(type))\r\ndiscord.app_commands.errors.CommandNotFound: Application command 'say' not found\n\n### Intents\n\nall intents are enabled\n\n### System Information\n\n- Python v3.10.5-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a4367+g64849ebc\r\n- aiohttp v3.7.4.post0\r\n- system info: Linux 5.10.16.3-microsoft-standard-WSL2 #1 SMP Fri Apr 2 22:23:49 UTC 2021\n\n### Checklist\n\n- [X] I have searched the open issues for duplicates.\n- [X] I have shown the entire traceback, if possible.\n- [X] I have removed my token from display, if visible.\n\n### Additional Context\n\n_No response_", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8167/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8167/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8155", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8155/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8155/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8155/events", "html_url": "https://github.com/Rapptz/discord.py/issues/8155", "id": 1273227394, "node_id": "I_kwDOAnRas85L4-iC", "number": 8155, "title": "View fails to dispatch crashing the bot", "user": {"login": "FrequencyX4", "id": 44416141, "node_id": "MDQ6VXNlcjQ0NDE2MTQx", "avatar_url": "https://avatars.githubusercontent.com/u/44416141?v=4", "gravatar_id": "", "url": "https://api.github.com/users/FrequencyX4", "html_url": "https://github.com/FrequencyX4", "followers_url": "https://api.github.com/users/FrequencyX4/followers", "following_url": "https://api.github.com/users/FrequencyX4/following{/other_user}", "gists_url": "https://api.github.com/users/FrequencyX4/gists{/gist_id}", "starred_url": "https://api.github.com/users/FrequencyX4/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/FrequencyX4/subscriptions", "organizations_url": "https://api.github.com/users/FrequencyX4/orgs", "repos_url": "https://api.github.com/users/FrequencyX4/repos", "events_url": "https://api.github.com/users/FrequencyX4/events{/privacy}", "received_events_url": "https://api.github.com/users/FrequencyX4/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 397573190, "node_id": "MDU6TGFiZWwzOTc1NzMxOTA=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/no%20repro", "name": "no repro", "color": "fef2c0", "default": false, "description": "Cannot be reproduced."}, {"id": 1368445796, "node_id": "MDU6TGFiZWwxMzY4NDQ1Nzk2", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/needs%20info", "name": "needs info", "color": "A5EF69", "default": false, "description": "This issue needs more information to be actionable."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2022-06-16T08:25:19Z", "updated_at": "2022-06-20T10:20:03Z", "closed_at": "2022-06-20T10:20:02Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nBot crashes a few minutes into running on all the latest commits within the last 2 months\r\n\r\n### Reproduction Steps\r\n\r\nInstall the latest version\r\n\r\n### Minimal Reproducible Code\r\n\r\n_No response_\r\n\r\n### Expected Results\r\n\r\nThe bot stays online without issue\r\n\r\n### Actual Results\r\n\r\nThe following error crashes the bot 5mins after initializing cache:\r\n```python\r\nTraceback (most recent call last):\r\n  File \"/home/luck/Fate/fate.py\", line 488, in <module>\r\n    print(\"Starting Bot\")\r\n  File \"/home/luck/Fate/fate.py\", line 372, in run\r\n\r\n  File \"/home/luck/.local/lib/python3.10/site-packages/discord/client.py\", line 736, in run\r\n    asyncio.run(runner())\r\n  File \"/usr/lib/python3.10/asyncio/runners.py\", line 44, in run\r\n    return loop.run_until_complete(main)\r\n  File \"/usr/lib/python3.10/asyncio/base_events.py\", line 646, in run_until_complete\r\n    return future.result()\r\n  File \"/home/luck/.local/lib/python3.10/site-packages/discord/client.py\", line 733, in runner\r\n    await self.start(*args, **kwargs)\r\n  File \"/home/luck/.local/lib/python3.10/site-packages/discord/client.py\", line 707, in start\r\n    await self.connect(reconnect=reconnect)\r\n  File \"/home/luck/.local/lib/python3.10/site-packages/discord/shard.py\", line 450, in connect\r\n    raise item.error\r\n  File \"/home/luck/.local/lib/python3.10/site-packages/discord/shard.py\", line 163, in worker\r\n    await self.ws.poll_event()\r\n  File \"/home/luck/.local/lib/python3.10/site-packages/discord/gateway.py\", line 622, in poll_event\r\n    await self.received_message(msg.data)\r\n  File \"/home/luck/.local/lib/python3.10/site-packages/discord/gateway.py\", line 572, in received_message\r\n    func(data)\r\n  File \"/home/luck/.local/lib/python3.10/site-packages/discord/state.py\", line 728, in parse_interaction_create\r\n    self._view_store.dispatch_view(component_type, custom_id, interaction)\r\n  File \"/home/luck/.local/lib/python3.10/site-packages/discord/ui/view.py\", line 611, in dispatch_view\r\n    item.view._dispatch_item(item, interaction)  # type: ignore\r\nAttributeError: 'NoneType' object has no attribute '_dispatch_item'\r\n```\r\n\r\n### Intents\r\n\r\nall\r\n\r\n### System Information\r\n\r\nI'm currently on a much older version than this shows to run the bot, but this occurs in the latest git version\r\n- Python v3.10.4-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a4224+g79d34fbe\r\n- aiohttp v3.7.4.post0\r\n- system info: Linux 5.15.0-37-generic #39-Ubuntu SMP Wed Jun 1 19:16:45 UTC 2022\r\n\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### Additional Context\r\n\r\n_No response_", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8155/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8155/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8151", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8151/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8151/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8151/events", "html_url": "https://github.com/Rapptz/discord.py/issues/8151", "id": 1270113836, "node_id": "I_kwDOAnRas85LtGYs", "number": 8151, "title": "Modifying task interval in `before_loop` silently throws `UnsupportedOperationException`", "user": {"login": "MajorTanya", "id": 39014446, "node_id": "MDQ6VXNlcjM5MDE0NDQ2", "avatar_url": "https://avatars.githubusercontent.com/u/39014446?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MajorTanya", "html_url": "https://github.com/MajorTanya", "followers_url": "https://api.github.com/users/MajorTanya/followers", "following_url": "https://api.github.com/users/MajorTanya/following{/other_user}", "gists_url": "https://api.github.com/users/MajorTanya/gists{/gist_id}", "starred_url": "https://api.github.com/users/MajorTanya/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MajorTanya/subscriptions", "organizations_url": "https://api.github.com/users/MajorTanya/orgs", "repos_url": "https://api.github.com/users/MajorTanya/repos", "events_url": "https://api.github.com/users/MajorTanya/events{/privacy}", "received_events_url": "https://api.github.com/users/MajorTanya/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-06-14T00:44:20Z", "updated_at": "2022-06-14T11:42:12Z", "closed_at": "2022-06-14T11:41:50Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\n\nWhen modifying a task's interval in before_loop, it fails silently and is never started. If the `change_interval` call is surrounded with try/except, an `UnsupportedOperationException` is caught, but the change goes through and the task seems to run as normal.\n\n### Reproduction Steps\n\n1) Schedule a task to run via `ext.tasks`\r\n2) Before the task is executed for the first time, call `task.change_interval` and enter any value (surround with try/except for any output at all)\r\n3) Start task (e.g. `on_ready`)\r\n4) Find the following traceback in output\r\n```python3\r\nTraceback (most recent call last):\r\n  File \"...\\main.py\", line 18, in before_testing_task\r\n    testing_task.change_interval(seconds=5)  # needs try/except, fails silently otherwise and never runs task\r\n  File \"...\\venv\\lib\\site-packages\\discord\\ext\\tasks\\__init__.py\", line 758, in change_interval\r\n    self._next_iteration = self._get_next_sleep_time()\r\n  File \"...\\venv\\lib\\site-packages\\discord\\ext\\tasks\\__init__.py\", line 627, in _get_next_sleep_time\r\n    return self._last_iteration + datetime.timedelta(seconds=self._sleep)\r\nTypeError: unsupported operand type(s) for +: '_MissingSentinel' and 'datetime.timedelta'\r\n```\r\n\r\nThis is the line in question:\r\nhttps://github.com/Rapptz/discord.py/blob/c0b4c3741877278ccd8a431f6249a45f4c58d07b/discord/ext/tasks/__init__.py#L627\n\n### Minimal Reproducible Code\n\n```python\nimport traceback\r\n\r\nimport discord\r\nfrom discord.ext import tasks\r\n\r\nclient = discord.Client(intents=discord.Intents.none())\r\n\r\n\r\n@tasks.loop(seconds=10)\r\nasync def testing_task():\r\n    print(\"Hello World!\")\r\n\r\n\r\n@testing_task.before_loop\r\nasync def before_testing_task():\r\n    print(\"Before Hello World!\")\r\n    try:\r\n        testing_task.change_interval(seconds=5)  # needs try/except, fails silently otherwise and never runs task at all\r\n    except Exception:\r\n        traceback.print_exc()\r\n\r\n\r\n@client.event\r\nasync def on_ready():\r\n    testing_task.start()\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    client.run(TOKEN)\n```\n\n\n### Expected Results\n\nI expected to be able to modify the interval (I wanted to load an interval from configuration after client start and supply it to the task in its `before_loop`).\n\n### Actual Results\n\nWithout try/except, the change didn't go through and the task never starts.\r\nWith the try/except, the `UnsupportedOperationException` occured.\n\n### Intents\n\n`discord.Intents.none()`\n\n### System Information\n\n- Python v3.10.4-final                               \r\n- discord.py v2.0.0-alpha                            \r\n    - discord.py pkg_resources: v2.0.0a4357+gc0b4c374\r\n- aiohttp v3.8.1                                     \r\n- system info: Windows 10 10.0.19044\n\n### Checklist\n\n- [X] I have searched the open issues for duplicates.\n- [X] I have shown the entire traceback, if possible.\n- [X] I have removed my token from display, if visible.\n\n### Additional Context\n\n`traceback` is only imported and used to show the traceback of the exception; it is not necessary for the bug to occur.\r\nJust using something like\r\n```python3\r\n[...]\r\ntry:\r\n   # change\r\nexcept Exception as e:\r\n    print(e)\r\n[...]\r\n```\r\nshows the exception message, without traceback.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8151/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8151/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8118", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8118/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8118/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8118/events", "html_url": "https://github.com/Rapptz/discord.py/issues/8118", "id": 1262558629, "node_id": "I_kwDOAnRas85LQR2l", "number": 8118, "title": "Optional's default doesn't get applied when it encounters parsing error", "user": {"login": "Jackenmen", "id": 6032823, "node_id": "MDQ6VXNlcjYwMzI4MjM=", "avatar_url": "https://avatars.githubusercontent.com/u/6032823?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jackenmen", "html_url": "https://github.com/Jackenmen", "followers_url": "https://api.github.com/users/Jackenmen/followers", "following_url": "https://api.github.com/users/Jackenmen/following{/other_user}", "gists_url": "https://api.github.com/users/Jackenmen/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jackenmen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jackenmen/subscriptions", "organizations_url": "https://api.github.com/users/Jackenmen/orgs", "repos_url": "https://api.github.com/users/Jackenmen/repos", "events_url": "https://api.github.com/users/Jackenmen/events{/privacy}", "received_events_url": "https://api.github.com/users/Jackenmen/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-06-07T00:01:39Z", "updated_at": "2022-06-07T00:18:25Z", "closed_at": "2022-06-07T00:18:25Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\n\nRelated to #7386, value of Optional arg is set to None regardless of its default value on parsing error\n\n### Reproduction Steps\n\n1. Add command from \"Minimal Reproducible Code\"\r\n2. Try running `issue8117 b\"lah`.\r\n3. See the issue.\n\n### Minimal Reproducible Code\n\n```python\nclass SampleCog(commands.Cog):\r\n    @commands.command()\r\n    async def issue8117(self, ctx, opt: Optional[int] = 1, *, rest):\r\n        await ctx.send(f\"{opt=} {rest=}\")\r\n\r\nawait bot.add_cog(SampleCog())\n```\n\n\n### Expected Results\n\nI expected `opt`'s value to be `1`\n\n### Actual Results\n\n![image](https://user-images.githubusercontent.com/6032823/172268207-87449f7c-2fce-4588-ac77-0e5bf5fcd4cf.png)\r\n\n\n### Intents\n\ndiscord.Intents.all()\n\n### System Information\n\n```\r\n\u03bb python -m discord -v\r\n- Python v3.8.10-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a4329+g75d57ab3\r\n- aiohttp v3.7.4.post0\r\n- system info: Windows 10 10.0.19043\r\n```\n\n### Checklist\n\n- [X] I have searched the open issues for duplicates.\n- [X] I have shown the entire traceback, if possible.\n- [X] I have removed my token from display, if visible.\n\n### Additional Context\n\n_No response_", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8118/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8118/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8114", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8114/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8114/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8114/events", "html_url": "https://github.com/Rapptz/discord.py/issues/8114", "id": 1261179990, "node_id": "I_kwDOAnRas85LLBRW", "number": 8114, "title": "[v2] Scheduled events not auto-starting, start() claims channel must be set", "user": {"login": "xSetrox", "id": 37757180, "node_id": "MDQ6VXNlcjM3NzU3MTgw", "avatar_url": "https://avatars.githubusercontent.com/u/37757180?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xSetrox", "html_url": "https://github.com/xSetrox", "followers_url": "https://api.github.com/users/xSetrox/followers", "following_url": "https://api.github.com/users/xSetrox/following{/other_user}", "gists_url": "https://api.github.com/users/xSetrox/gists{/gist_id}", "starred_url": "https://api.github.com/users/xSetrox/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xSetrox/subscriptions", "organizations_url": "https://api.github.com/users/xSetrox/orgs", "repos_url": "https://api.github.com/users/xSetrox/repos", "events_url": "https://api.github.com/users/xSetrox/events{/privacy}", "received_events_url": "https://api.github.com/users/xSetrox/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-06-05T22:46:53Z", "updated_at": "2022-06-06T12:57:24Z", "closed_at": "2022-06-06T12:57:24Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nScheduled events are not auto-starting, start() claims channel must be set\r\n\r\n### Reproduction Steps\r\n\r\nI created a scheduled event and then tried to start it. \r\n\r\n### Minimal Reproducible Code\r\n\r\n```python\r\nself.scheduled_event = await guild.create_scheduled_event(name = event_name, description = \"hello\", start_time = discord.utils.utcnow() + datetime.timedelta(seconds=5), entity_type = discord.EntityType.voice, channel = random.choice(active_vcs))\r\nawait self.scheduled_event.start()\r\n```\r\n\r\n\r\n### Expected Results\r\n\r\nI expected the event to start on its own since I specified a start time. Even if this was not the case I expected `start()` to start it.\r\n\r\n### Actual Results\r\n\r\nThe event does not auto-start despite the time for the event seeming correct in my guild. `start()`, which may or may not be redundant depending on what start_time should be doing, also produces an error:\r\n`TypeError: channel must be set when entity_type is voice or stage_instance`.\r\nFull error is [here](https://media.discordapp.net/attachments/669155775700271126/983130143071539310/unknown.png?width=1563&height=598)\r\n\r\n### Intents\r\n\r\nAll\r\n\r\n### System Information\r\n\r\n```\r\n(env) lance@ubuntu-4gb-ash-1:~/lanceBot$ python -m discord -v\r\n- Python v3.8.10-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a4283+g37076a04\r\n- aiohttp v3.8.1\r\n- system info: Linux 5.4.0-110-generic #124-Ubuntu SMP Thu Apr 14 19:46:19 UTC 2022\r\n```\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### Additional Context\r\n\r\n_No response_", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8114/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8114/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8110", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8110/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8110/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8110/events", "html_url": "https://github.com/Rapptz/discord.py/issues/8110", "id": 1260956839, "node_id": "I_kwDOAnRas85LKKyn", "number": 8110, "title": "Error setting default values while using a `discord.app_commands.Transformer`", "user": {"login": "emisdumb", "id": 30204467, "node_id": "MDQ6VXNlcjMwMjA0NDY3", "avatar_url": "https://avatars.githubusercontent.com/u/30204467?v=4", "gravatar_id": "", "url": "https://api.github.com/users/emisdumb", "html_url": "https://github.com/emisdumb", "followers_url": "https://api.github.com/users/emisdumb/followers", "following_url": "https://api.github.com/users/emisdumb/following{/other_user}", "gists_url": "https://api.github.com/users/emisdumb/gists{/gist_id}", "starred_url": "https://api.github.com/users/emisdumb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/emisdumb/subscriptions", "organizations_url": "https://api.github.com/users/emisdumb/orgs", "repos_url": "https://api.github.com/users/emisdumb/repos", "events_url": "https://api.github.com/users/emisdumb/events{/privacy}", "received_events_url": "https://api.github.com/users/emisdumb/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-06-05T04:23:25Z", "updated_at": "2022-06-05T05:25:06Z", "closed_at": "2022-06-05T05:25:06Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\n\nA `TypeError` is raised when setting a default value that matches the target type of the transformer.\n\n### Reproduction Steps\n\n1. Create a custom transformer by inheriting from `app_commands.Transformer`\r\n2. In an application command, use said transformer in an argument type hint with `app_commands.Transform` \r\n3. Set the argument's default value as a value whose type matches the type that the transformer is attempting to convert to\n\n### Minimal Reproducible Code\n\n```python\nimport discord\r\nfrom discord import app_commands\r\nfrom discord.ext import commands\r\n\r\nbot = commands.Bot(command_prefix='.', intents=discord.Intents.default())\r\n\r\nclass ColorTransformer(app_commands.Transformer):\r\n    @classmethod\r\n    async def transform(cls, interaction: discord.Interaction, value: str) -> discord.Color:\r\n        return discord.Color.from_str(value)\r\n\r\n@app_commands.command()\r\nasync def color(\r\n    interaction: discord.Interaction,\r\n    color: app_commands.Transform[discord.Color, ColorTransformer] = discord.Color.default()\r\n):\r\n    await interaction.response.send(f'your color: {color}')\r\n\r\nbot.tree.add_command(color)\r\n\r\nbot.run('token')\n```\n\n\n### Expected Results\n\nThe code should run without error and accept the type that properly matches the type hint.\n\n### Actual Results\n\nThe reproducible code results in this traceback:\r\n```python\r\nPS D:\\Users\\emily\\Downloads> python index.py\r\nTraceback (most recent call last):\r\n  File \"D:\\Users\\emily\\Downloads\\awa.py\", line 13, in <module>\r\n    async def color(\r\n  File \"C:\\Users\\emily\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\discord\\app_commands\\commands.py\", line 1594, in decorator\r\n    return Command(\r\n  File \"C:\\Users\\emily\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\discord\\app_commands\\commands.py\", line 523, in __init__\r\n    self._params: Dict[str, CommandParameter] = _extract_parameters_from_callback(callback, callback.__globals__)\r\n  File \"C:\\Users\\emily\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\discord\\app_commands\\commands.py\", line 383, in _extract_parameters_from_callback\r\n    param = annotation_to_parameter(resolved, parameter)\r\n  File \"C:\\Users\\emily\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\discord\\app_commands\\transformers.py\", line 712, in annotation_to_parameter\r\n    raise TypeError(f'invalid default parameter type given ({default.__class__}), expected {valid_types}')\r\nTypeError: invalid default parameter type given (<class 'discord.colour.Colour'>), expected (<class 'str'>, <class 'NoneType'>)\r\n```\n\n### Intents\n\n`discord.Intents.default()`\n\n### System Information\n\n- Python v3.10.4-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a4322+g87edabc5\r\n- aiohttp v3.8.1\r\n- system info: Windows 10 10.0.22621\n\n### Checklist\n\n- [x] I have searched the open issues for duplicates.\n- [X] I have shown the entire traceback, if possible.\n- [X] I have removed my token from display, if visible.\n\n### Additional Context\n\n_No response_", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8110/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8110/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8046", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8046/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8046/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8046/events", "html_url": "https://github.com/Rapptz/discord.py/issues/8046", "id": 1238167589, "node_id": "I_kwDOAnRas85JzPAl", "number": 8046, "title": "OpusError on macOS arm64 platform (only)", "user": {"login": "m13253", "id": 1808930, "node_id": "MDQ6VXNlcjE4MDg5MzA=", "avatar_url": "https://avatars.githubusercontent.com/u/1808930?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m13253", "html_url": "https://github.com/m13253", "followers_url": "https://api.github.com/users/m13253/followers", "following_url": "https://api.github.com/users/m13253/following{/other_user}", "gists_url": "https://api.github.com/users/m13253/gists{/gist_id}", "starred_url": "https://api.github.com/users/m13253/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m13253/subscriptions", "organizations_url": "https://api.github.com/users/m13253/orgs", "repos_url": "https://api.github.com/users/m13253/repos", "events_url": "https://api.github.com/users/m13253/events{/privacy}", "received_events_url": "https://api.github.com/users/m13253/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-05-17T07:01:40Z", "updated_at": "2022-05-18T10:37:34Z", "closed_at": "2022-05-18T10:37:34Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\r\n\r\nWhen creating an opus.Encoder() instance, an exception of discord.opus.OpusError: invalid argument is thrown\r\n\r\n### Reproduction Steps\r\n\r\nFirst, install either Python 3.9 or Python 3.10.\r\n```bash\r\n$ brew install python\r\n$ python3 -m pip install -U \"discord.py[voice]\"\r\n```\r\nThen, execute the code in the section below.\r\n\r\n### Minimal Reproducible Code\r\n\r\n```python\r\nimport discord.opus\r\nopus_encoder = discord.opus.Encoder()\r\n```\r\n\r\n\r\n### Expected Results\r\n\r\nShould load `libopus.dylib` and create an Opus encoder instance.\r\n\r\n### Actual Results\r\n\r\n```python\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/opt/homebrew/lib/python3.10/site-packages/discord/opus.py\", line 290, in __init__\r\n    self.set_bitrate(128)\r\n  File \"/opt/homebrew/lib/python3.10/site-packages/discord/opus.py\", line 308, in set_bitrate\r\n    _lib.opus_encoder_ctl(self._state, CTL_SET_BITRATE, kbps * 1024)\r\n  File \"/opt/homebrew/lib/python3.10/site-packages/discord/opus.py\", line 92, in _err_lt\r\n    raise OpusError(result)\r\ndiscord.opus.OpusError: invalid argument\r\n```\r\n\r\n### Intents\r\n\r\nNot applicable\r\n\r\n### System Information\r\n\r\n```\r\n- Python v3.10.4-final\r\n- discord.py v1.7.3-final\r\n- aiohttp v3.7.4.post0\r\n- system info: Darwin 21.4.0 Darwin Kernel Version 21.4.0: Fri Mar 18 00:46:32 PDT 2022; root:xnu-8020.101.4~15/RELEASE_ARM64_T6000\r\n```\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### Additional Context\r\n\r\n#### [1/4] This bug only happens on arm64 macOS?\r\n\r\nYes, only on arm64 macOS.\r\n\r\nConfirmed no issue on x86_64 macOS or Windows or Linux.\r\n\r\n#### [2/4] Why can't I use Windows or Linux instead?\r\n\r\nIt's because my music production software is on this platform.\r\n\r\nI'm willing to run test code snippets on my machine if you wish.\r\n\r\n#### [3/4] Some more check on libopus\r\n\r\nI try to check if libopus is correctly loaded.\r\n**Result:** yes.\r\n```python\r\n>>> import discord.opus\r\n>>> discord.opus._load_default()\r\nTrue\r\n>>> discord.opus._lib\r\n<CDLL '/opt/homebrew/lib/libopus.dylib', handle 209560680 at 0x104f380a0>\r\n>>> discord.opus._OpusStruct.get_opus_version()\r\n'libopus 1.3.1'\r\n```\r\n\r\nI try to check whether there is an architecture mismatch between Python and libopus.\r\n**Result:** Both arm64. None are \u201cfat binary\u201d.\r\n```bash\r\n$ file /opt/homebrew/bin/python3\r\n/opt/homebrew/bin/python3: Mach-O 64-bit executable arm64\r\n$ file /opt/homebrew/lib/libopus.dylib\r\n/opt/homebrew/lib/libopus.dylib: Mach-O 64-bit dynamically linked shared library arm64\r\n```\r\n\r\nI try to check if the request numbers are different on arm64.\r\n**Result:** The numbers are same with x86_64.\r\n```c\r\n$ cd /opt/homebrew/include/opus\r\n$ grep -r '#define OPUS_SET_[^ ]*_REQUEST'\r\n./opus_defines.h:#define OPUS_SET_APPLICATION_REQUEST         4000\r\n./opus_defines.h:#define OPUS_SET_BITRATE_REQUEST             4002\r\n./opus_defines.h:#define OPUS_SET_MAX_BANDWIDTH_REQUEST       4004\r\n./opus_defines.h:#define OPUS_SET_VBR_REQUEST                 4006\r\n./opus_defines.h:#define OPUS_SET_BANDWIDTH_REQUEST           4008\r\n./opus_defines.h:#define OPUS_SET_COMPLEXITY_REQUEST          4010\r\n./opus_defines.h:#define OPUS_SET_INBAND_FEC_REQUEST          4012\r\n./opus_defines.h:#define OPUS_SET_PACKET_LOSS_PERC_REQUEST    4014\r\n./opus_defines.h:#define OPUS_SET_DTX_REQUEST                 4016\r\n./opus_defines.h:#define OPUS_SET_VBR_CONSTRAINT_REQUEST      4020\r\n./opus_defines.h:#define OPUS_SET_FORCE_CHANNELS_REQUEST      4022\r\n./opus_defines.h:#define OPUS_SET_SIGNAL_REQUEST              4024\r\n./opus_defines.h:#define OPUS_SET_GAIN_REQUEST                4034\r\n./opus_defines.h:#define OPUS_SET_LSB_DEPTH_REQUEST           4036\r\n./opus_defines.h:#define OPUS_SET_EXPERT_FRAME_DURATION_REQUEST 4040\r\n./opus_defines.h:#define OPUS_SET_PREDICTION_DISABLED_REQUEST 4042\r\n./opus_defines.h:#define OPUS_SET_PHASE_INVERSION_DISABLED_REQUEST 4046\r\n```\r\n\r\n#### [4/4] Why am I directly calling `discord.opus.Encoder`? It's supposed to be a private API.\r\n\r\nFirst, the public API will eventually call into this private API and raise exception. There is no difference.\r\n\r\nSecond, [my bot program](https://github.com/m13253/discord-mic-bot) has to call into this private API in order to perform some WebRTC-level magic.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/8046/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/8046/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7978", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7978/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7978/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7978/events", "html_url": "https://github.com/Rapptz/discord.py/issues/7978", "id": 1222291472, "node_id": "I_kwDOAnRas85I2rAQ", "number": 7978, "title": "Appcommands autocomplete triggers cooldown warning. ", "user": {"login": "aldalen", "id": 93111434, "node_id": "U_kgDOBYzEig", "avatar_url": "https://avatars.githubusercontent.com/u/93111434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aldalen", "html_url": "https://github.com/aldalen", "followers_url": "https://api.github.com/users/aldalen/followers", "following_url": "https://api.github.com/users/aldalen/following{/other_user}", "gists_url": "https://api.github.com/users/aldalen/gists{/gist_id}", "starred_url": "https://api.github.com/users/aldalen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aldalen/subscriptions", "organizations_url": "https://api.github.com/users/aldalen/orgs", "repos_url": "https://api.github.com/users/aldalen/repos", "events_url": "https://api.github.com/users/aldalen/events{/privacy}", "received_events_url": "https://api.github.com/users/aldalen/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-05-01T21:14:44Z", "updated_at": "2022-05-01T22:55:00Z", "closed_at": "2022-05-01T22:54:44Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\n\nAppcommands autocomplete triggers cooldown warning. \n\n### Reproduction Steps\n\nCreate an app command with an autocomplete and cooldown.  \r\n\r\nThis seems to be caused by 5e98626d41e6e39f82b9fbdc7a0723311fe5751b , which was the fix for #7969.  Confirmed SHA before worked.  \n\n### Minimal Reproducible Code\n\n_No response_\n\n### Expected Results\n\nCooldown does not increment / trigger for autocomplete calls. \n\n### Actual Results\n\nAutocomplete calls increment cooldown buckets. \n\n### Intents\n\nNone\n\n### System Information\n\n- Python v3.9.12-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a4211+g0551214b\r\n- aiohttp v3.8.1\r\n- system info: Darwin 21.4.0 Darwin Kernel Version 21.4.0: Fri Mar 18 00:46:32 PDT 2022; root:xnu-8020.101.4~15/RELEASE_ARM64_T6000\n\n### Checklist\n\n- [X] I have searched the open issues for duplicates.\n- [X] I have shown the entire traceback, if possible.\n- [X] I have removed my token from display, if visible.\n\n### Additional Context\n\n_No response_", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7978/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7978/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7949", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7949/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7949/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7949/events", "html_url": "https://github.com/Rapptz/discord.py/issues/7949", "id": 1219348798, "node_id": "I_kwDOAnRas85Irck-", "number": 7949, "title": "[commands] issue with typing of commands.check_any", "user": {"login": "mikeshardmind", "id": 22035876, "node_id": "MDQ6VXNlcjIyMDM1ODc2", "avatar_url": "https://avatars.githubusercontent.com/u/22035876?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mikeshardmind", "html_url": "https://github.com/mikeshardmind", "followers_url": "https://api.github.com/users/mikeshardmind/followers", "following_url": "https://api.github.com/users/mikeshardmind/following{/other_user}", "gists_url": "https://api.github.com/users/mikeshardmind/gists{/gist_id}", "starred_url": "https://api.github.com/users/mikeshardmind/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mikeshardmind/subscriptions", "organizations_url": "https://api.github.com/users/mikeshardmind/orgs", "repos_url": "https://api.github.com/users/mikeshardmind/repos", "events_url": "https://api.github.com/users/mikeshardmind/events{/privacy}", "received_events_url": "https://api.github.com/users/mikeshardmind/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/8", "html_url": "https://github.com/Rapptz/discord.py/milestone/8", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/8/labels", "id": 4299068, "node_id": "MDk6TWlsZXN0b25lNDI5OTA2OA==", "number": 8, "title": "v2.0", "description": "The next major version with breaking changes for the library", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 1, "closed_issues": 13, "state": "open", "created_at": "2019-05-09T10:08:50Z", "updated_at": "2022-08-15T13:19:49Z", "due_on": null, "closed_at": null}, "comments": 0, "created_at": "2022-04-28T21:54:09Z", "updated_at": "2022-05-02T22:54:58Z", "closed_at": "2022-05-02T22:54:58Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\n\ncommands.check_any's typing is incompatible with the library's checks\n\n### Reproduction Steps\n\nused the commands.check_any decorator as documented.\n\n### Minimal Reproducible Code\n\n```python\nfrom discord.ext import commands\r\n\r\n\r\n@commands.check_any(commands.is_owner(), commands.is_nsfw())\r\n@commands.command()\r\nasync def example(ctx: commands.Context):\r\n    pass\n```\n\n\n### Expected Results\n\nThis to work at runtime, and be type checked properly (for the minimal example, I picked 2 checks from the library, but this holds for any use of the decorator as documented) \n\n### Actual Results\n\nWhile this works at runtime, pyright reports:\r\n```\r\nArgument of type \"(MaybeCoro[bool] | Context[Any]) -> (MaybeCoro[bool] | Context[Any])\" cannot be assigned to parameter \"checks\" of type \"Check[ContextT@check_any]\" in function \"check_any\"\r\n\u00a0\u00a0Type \"(MaybeCoro[bool] | Context[Any]) -> (MaybeCoro[bool] | Context[Any])\" cannot be assigned to type \"Check[ContextT@check_any]\"\r\n\u00a0\u00a0\u00a0\u00a0Function return type \"MaybeCoro[bool] | Context[Any]\" is incompatible with type \"MaybeCoro[bool]\"\r\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Type \"MaybeCoro[bool] | Context[Any]\" cannot be assigned to type \"MaybeCoro[bool]\"\r\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Type \"Context[Any]\" cannot be assigned to type \"MaybeCoro[bool]\"\r\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"Context[Any]\" is incompatible with \"bool\"\r\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"Context[Any]\" is incompatible with \"Coro[bool]\"\r\n```\r\n(twice, once for each check)\r\n\r\nThis also breaks the inferred type of the decorated command.\n\n### Intents\n\nN/A\n\n### System Information\n\n- Python v3.10.2-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a4184+g10af1ea2\r\n- aiohttp v3.8.1\r\n- system info: Windows 10 10.0.19043\n\n### Checklist\n\n- [X] I have searched the open issues for duplicates.\n- [X] I have shown the entire traceback, if possible.\n- [X] I have removed my token from display, if visible.\n\n### Additional Context\n\nI can go ahead and PR a fix for this later, but there are really multiple possible fixes.\r\n\r\n1. Change the typing of commands.check to return a protocol and accept that protocol in check_any\r\n2. Change the typing of check_any to have less detailed type information.\r\n\r\nI'd prefer the 1st route but figured this was worth running by others first.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7949/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7949/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7918", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7918/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7918/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7918/events", "html_url": "https://github.com/Rapptz/discord.py/issues/7918", "id": 1212015969, "node_id": "I_kwDOAnRas85IPeVh", "number": 7918, "title": "Application commands not using proxy", "user": {"login": "CoolSpring8", "id": 8985327, "node_id": "MDQ6VXNlcjg5ODUzMjc=", "avatar_url": "https://avatars.githubusercontent.com/u/8985327?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CoolSpring8", "html_url": "https://github.com/CoolSpring8", "followers_url": "https://api.github.com/users/CoolSpring8/followers", "following_url": "https://api.github.com/users/CoolSpring8/following{/other_user}", "gists_url": "https://api.github.com/users/CoolSpring8/gists{/gist_id}", "starred_url": "https://api.github.com/users/CoolSpring8/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CoolSpring8/subscriptions", "organizations_url": "https://api.github.com/users/CoolSpring8/orgs", "repos_url": "https://api.github.com/users/CoolSpring8/repos", "events_url": "https://api.github.com/users/CoolSpring8/events{/privacy}", "received_events_url": "https://api.github.com/users/CoolSpring8/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-04-22T08:32:26Z", "updated_at": "2022-05-10T15:45:14Z", "closed_at": "2022-05-06T02:29:19Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\r\n\r\nApplication commands are not using proxy\r\n\r\n### Reproduction Steps\r\n\r\n1. Build a `discord.ext.commands.Bot` with one `discord.app_commands` and one `discord.ext.commands.Command`, and pass a proxy URL to `proxy` parameter on creation (the bot runs in a network where all requests should go through the proxy);\r\n2. In Discord, call the bot with normal commands and application (slash) commands.\r\n\r\n### Minimal Reproducible Code\r\n\r\n_No response_\r\n\r\n### Expected Results\r\n\r\nBot responds to both normal commands and application commands.\r\n\r\n### Actual Results\r\n\r\nBot responds to normal commands. But for slash commands, interaction shows \"The application did not respond\", and python throws `aiohttp.client_exceptions.ClientConnectorError: Cannot connect to host discord.com:443 ssl:default`.\r\n\r\n### Intents\r\n\r\nintents = discord.Intents.default(); intents.message_content = True\r\n\r\n### System Information\r\n\r\n- Python v3.9.12-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a4122+gbc07a02\r\n- aiohttp v3.7.4.post0\r\n- system info: Darwin 21.4.0 Darwin Kernel Version 21.4.0: Fri Mar 18 00:47:26 PDT 2022; root:xnu-8020.101.4~15/RELEASE_ARM64_T8101\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### Additional Context\r\n\r\nTurns out the bot is using proxy for normal commands, but not for application commands.\r\n\r\nLooking into the code, I find out the probable reason is that the `aiohttp.ClientSession` which is reused by `webhook/async_.py` to send interaction response, does not store the `proxy` info in its internal state, instead `proxy` parameter has to be passed into every `session.request()` call. This limitation has been tracked in https://github.com/aio-libs/aiohttp/issues/2580, but no recent fixing signal there.\r\n\r\nSuggestion: in `webhook/async_.py`, pass down `proxy` parameter to `session.request()`, or use `discord.HTTPClient` instead of `aiohttp.ClientSession`?", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7918/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7918/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7889", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7889/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7889/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7889/events", "html_url": "https://github.com/Rapptz/discord.py/issues/7889", "id": 1205384029, "node_id": "I_kwDOAnRas85H2LNd", "number": 7889, "title": "`@app_commands.guilds` doesn't work with `@app_commands.context_menu`", "user": {"login": "Harmon758", "id": 9403740, "node_id": "MDQ6VXNlcjk0MDM3NDA=", "avatar_url": "https://avatars.githubusercontent.com/u/9403740?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Harmon758", "html_url": "https://github.com/Harmon758", "followers_url": "https://api.github.com/users/Harmon758/followers", "following_url": "https://api.github.com/users/Harmon758/following{/other_user}", "gists_url": "https://api.github.com/users/Harmon758/gists{/gist_id}", "starred_url": "https://api.github.com/users/Harmon758/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Harmon758/subscriptions", "organizations_url": "https://api.github.com/users/Harmon758/orgs", "repos_url": "https://api.github.com/users/Harmon758/repos", "events_url": "https://api.github.com/users/Harmon758/events{/privacy}", "received_events_url": "https://api.github.com/users/Harmon758/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 2851939991, "node_id": "MDU6TGFiZWwyODUxOTM5OTkx", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/unconfirmed%20bug", "name": "unconfirmed bug", "color": "d4c5f9", "default": false, "description": "A bug report that needs triaging"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-04-15T08:26:42Z", "updated_at": "2022-04-15T09:06:58Z", "closed_at": "2022-04-15T09:00:24Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\n\nThe `app_commands.guilds` decorator doesn't work with the `app_commands.context_menu` decorator. The `app_commands.guilds` decorator is ignored and the context menu application command is added as a global command. This also applies to the `app_commands.CommandTree.context_menu` decorator.\n\n### Reproduction Steps\n\n- Use the `app_commands.guilds` decorator with the `app_commands.context_menu` (or `app_commands.CommandTree.context_menu`) decorator.\r\n- Attempt to sync the context menu application command as a guild command\r\n- Notice the command was not synced\r\n- Attempt to sync the same command as a global command\r\n- Notice the command was successfully synced\r\n\r\nWith the following code this can be accomplished by the following steps:\r\n- Run the bot\r\n- Use the `!sync_guild` command\r\n- Check the console (and/or check for the context menu application command in the guild)\r\n- Use the `!sync_global` command\r\n- Check the console (and/or check for the context menu application command in any guild)\n\n### Minimal Reproducible Code\n\n```python\nimport discord\r\nfrom discord import app_commands\r\nfrom discord.ext import commands\r\n\r\n\r\nGUILD_ID = 336642139381301249  # Replace as needed\r\nTOKEN = \"Token Here\"\r\n\r\n\r\nintents = discord.Intents.default()\r\nintents.message_content = True\r\n\r\nbot = commands.Bot(command_prefix='!', intents=intents)\r\n\r\n\r\n@app_commands.context_menu()\r\n@app_commands.guilds(GUILD_ID)\r\nasync def test(interaction, message: discord.Message):\r\n    await interaction.response.send_message(\"Test response message\")\r\n\r\nbot.tree.add_command(test)\r\n\r\n# This results in the same behavior:\r\n# @bot.tree.context_menu()\r\n# @app_commands.guilds(GUILD_ID)\r\n# async def test(interaction, message: discord.Message):\r\n#     await interaction.response.send_message(\"Test response message\")\r\n\r\n# However, this works as expected:\r\n# @bot.tree.context_menu(guild = discord.Object(GUILD_ID))\r\n# async def test(interaction, message: discord.Message):\r\n#     await interaction.response.send_message(\"Test response message\")\r\n\r\n\r\n@bot.command()\r\nasync def sync_guild(ctx):\r\n    synced = await ctx.bot.tree.sync(guild = discord.Object(GUILD_ID))\r\n    print(len(synced))\r\n\r\n\r\n@bot.command()\r\nasync def sync_global(ctx):\r\n    synced = await ctx.bot.tree.sync()\r\n    print(len(synced))\r\n\r\n\r\nbot.run(TOKEN)\n```\n\n\n### Expected Results\n\nThe `!sync_guild` command should print `1` in the console when executed (and the context menu application command should be available in the guild) and the `!sync_global` command should print `0` in the console when executed.\n\n### Actual Results\n\nThe `!sync_guild` command prints `0` in the console when executed (and the context menu application command is not available in the guild) and the `!sync_global` command prints `1` in the console when executed (and the context menu application command is then available in all guilds).\n\n### Intents\n\nDefault with message content (to sync the command)\n\n### System Information\n\n- Python v3.9.10-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a4106+g242d3f7\r\n- aiohttp v3.8.1\r\n- system info: Windows 10 10.0.19043\n\n### Checklist\n\n- [X] I have searched the open issues for duplicates.\n- [X] I have shown the entire traceback, if possible.\n- [X] I have removed my token from display, if visible.\n\n### Additional Context\n\nThe cause of this seems to be that the `app_commands.guild` decorator assigns the guild IDs to the `__discord_app_commands_default_guilds__ ` attribute of the callback:\r\nhttps://github.com/Rapptz/discord.py/blob/4fb1309e2ae103820e980697e90f4345597d4f3e/discord/app_commands/commands.py#L1639-L1655 which isn't used for `ContextMenu._guild_ids` in `ContextMenu.__init__`:\r\nhttps://github.com/Rapptz/discord.py/blob/4fb1309e2ae103820e980697e90f4345597d4f3e/discord/app_commands/commands.py#L876 whereas it *is* used for `Command._guild_ids` in `Command.__init__`:\r\nhttps://github.com/Rapptz/discord.py/blob/4fb1309e2ae103820e980697e90f4345597d4f3e/discord/app_commands/commands.py#L494-L496", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7889/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7889/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7842", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7842/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7842/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7842/events", "html_url": "https://github.com/Rapptz/discord.py/issues/7842", "id": 1191234059, "node_id": "I_kwDOAnRas85HAMoL", "number": 7842, "title": "Webhook.edit_message leads to internal exception", "user": {"login": "aldalen", "id": 93111434, "node_id": "U_kgDOBYzEig", "avatar_url": "https://avatars.githubusercontent.com/u/93111434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aldalen", "html_url": "https://github.com/aldalen", "followers_url": "https://api.github.com/users/aldalen/followers", "following_url": "https://api.github.com/users/aldalen/following{/other_user}", "gists_url": "https://api.github.com/users/aldalen/gists{/gist_id}", "starred_url": "https://api.github.com/users/aldalen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aldalen/subscriptions", "organizations_url": "https://api.github.com/users/aldalen/orgs", "repos_url": "https://api.github.com/users/aldalen/repos", "events_url": "https://api.github.com/users/aldalen/events{/privacy}", "received_events_url": "https://api.github.com/users/aldalen/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-04-04T04:24:30Z", "updated_at": "2022-04-05T08:31:36Z", "closed_at": "2022-04-04T04:50:27Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nWebhook.edit_message throws \"AttributeError: PartialWebhookState does not support 'get_reaction_emoji'\"\r\n\r\n### Reproduction Steps\r\n\r\nMy bot updates an embed on a regular cadence, so I store webhook urls in my database, then iterate through them. When posting the new embed, on some servers, I was seeing this in my logs.\r\n\r\nI tried with or without \"webhook = await webhook.fetch()\" to get the \"full webhook\" and still ran into the same exception. Seems like something on some servers is causing a path to look for reaction emoji.\r\n\r\n### Minimal Reproducible Code\r\n\r\n```python\r\nasync with aiohttp.ClientSession() as session:\r\n            try:\r\n                webhook = discord.Webhook.from_url(hook_url, session=session)\r\n                webhook = await webhook.fetch()\r\n            except discord.InvalidArgument:\r\n                self.logging.error(\"Error: Webhook invalid.\")\r\n                return\r\n\r\n            try:\r\n                await webhook.edit_message(config.message_id, content=\"\", embed=append_advert_if_needed(self.bot, config.server.pk, new_embed, lang=config.locale))\r\n\r\n            except AttributeError as error:\r\n                # Here is where the PartialWebhookState error is caught\r\n                self.logging.error(\"CAUGHT AttributeError `{}`\".format(str(error)))\r\n                traceback.print_exc(file=sys.stdout)\r\n                pass\r\n```\r\n\r\n\r\n### Expected Results\r\n\r\nNo exception\r\n\r\n### Actual Results\r\n ```\r\nAttributeError `PartialWebhookState does not support 'get_reaction_emoji'.`\r\nTraceback (most recent call last):\r\n  File \"../countdown/loops.py\", line 131, in update_message\r\n    await webhook.edit_message(config.message_id, content=\"\", embed=append_advert_if_needed(self.bot, config.server.pk, new_embed, lang=config.locale))\r\n  File \"[path_removed]/lib/python3.9/site-packages/discord/webhook/async_.py\", line 1722, in edit_message\r\n    message = self._create_message(data, thread=thread)\r\n  File \"[path_removed]/lib/python3.9/site-packages/discord/webhook/async_.py\", line 1334, in _create_message\r\n    return WebhookMessage(data=data, state=state, channel=channel)  # type: ignore\r\n  File \"[path_removed]/lib/python3.9/site-packages/discord/message.py\", line 1383, in __init__\r\n    self.reactions: List[Reaction] = [Reaction(message=self, data=d) for d in data.get('reactions', [])]\r\n  File \"[path_removed]/lib/python3.9/site-packages/discord/message.py\", line 1383, in <listcomp>\r\n    self.reactions: List[Reaction] = [Reaction(message=self, data=d) for d in data.get('reactions', [])]\r\n  File \"[path_removed]/lib/python3.9/site-packages/discord/reaction.py\", line 88, in __init__\r\n    self.emoji: Union[PartialEmoji, Emoji, str] = emoji or message._state.get_reaction_emoji(data['emoji'])\r\n  File \"[path_removed]/lib/python3.9/site-packages/discord/webhook/async_.py\", line 664, in __getattr__\r\n    raise AttributeError(f'PartialWebhookState does not support {attr!r}.')\r\nAttributeError: PartialWebhookState does not support 'get_reaction_emoji'.\r\n```\r\n### Intents\r\n\r\nNone\r\n\r\n### System Information\r\n\r\n- Python v3.9.12-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a4041+gd5d9a53\r\n- aiohttp v3.8.1\r\n- system info: Linux 5.13.19-6-pve #1 SMP PVE 5.13.19-15 (Tue, 29 Mar 2022 15:59:50 +0200)\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### Additional Context\r\n\r\n_No response_", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7842/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7842/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7818", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7818/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7818/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7818/events", "html_url": "https://github.com/Rapptz/discord.py/issues/7818", "id": 1189677412, "node_id": "I_kwDOAnRas85G6Qlk", "number": 7818, "title": "Unable to create nested groups with explicit parent set", "user": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-04-01T11:44:03Z", "updated_at": "2022-04-01T13:14:02Z", "closed_at": "2022-04-01T13:14:02Z", "author_association": "OWNER", "active_lock_reason": null, "body": "_Originally posted by @leirn in https://github.com/Rapptz/discord.py/discussions/7811#discussioncomment-2480748_", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7818/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7818/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7810", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7810/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7810/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7810/events", "html_url": "https://github.com/Rapptz/discord.py/issues/7810", "id": 1186957675, "node_id": "I_kwDOAnRas85Gv4lr", "number": 7810, "title": "Renaming app_command argument makes autocompleters doesn't work.", "user": {"login": "AiroPi", "id": 47398145, "node_id": "MDQ6VXNlcjQ3Mzk4MTQ1", "avatar_url": "https://avatars.githubusercontent.com/u/47398145?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AiroPi", "html_url": "https://github.com/AiroPi", "followers_url": "https://api.github.com/users/AiroPi/followers", "following_url": "https://api.github.com/users/AiroPi/following{/other_user}", "gists_url": "https://api.github.com/users/AiroPi/gists{/gist_id}", "starred_url": "https://api.github.com/users/AiroPi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AiroPi/subscriptions", "organizations_url": "https://api.github.com/users/AiroPi/orgs", "repos_url": "https://api.github.com/users/AiroPi/repos", "events_url": "https://api.github.com/users/AiroPi/events{/privacy}", "received_events_url": "https://api.github.com/users/AiroPi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-03-30T20:33:49Z", "updated_at": "2022-03-30T23:51:54Z", "closed_at": "2022-03-30T23:49:10Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\n\nRenaming app_command argument makes autocompleters doesn't work.\n\n### Reproduction Steps\n\nDo a slash command with renamed arguments. Then assign autocompleters using `command_function.autocomplete('argument_name')`. Sync is done correctly at startup, but when we try to use the command, we get this error :\r\n```\r\nIgnoring exception in command tree:\r\nTraceback (most recent call last):\r\n  File \"c:\\path\\venv\\lib\\site-packages\\discord\\app_commands\\tree.py\", line 880, in wrapper\r\n    await self.call(interaction)\r\n  File \"c:\\path\\venv\\lib\\site-packages\\discord\\app_commands\\tree.py\", line 1036, in call\r\n  File \"c:\\path\\venv\\lib\\site-packages\\discord\\app_commands\\commands.py\", line 557, in _invoke_autocomplete\r\n    raise CommandSignatureMismatch(self) from None\r\ndiscord.app_commands.errors.CommandSignatureMismatch: The signature for command 'tag' is different from the one provided by Discord. This can happen because either your \r\nIgnoring exception in command tree:\r\nTraceback (most recent call last):\r\n  File \"c:\\path\\venv\\lib\\site-packages\\discord\\app_commands\\tree.py\", line 880, in wrapper\r\n    await self.call(interaction)\r\n  File \"c:\\path\\venv\\lib\\site-packages\\discord\\app_commands\\tree.py\", line 1036, in call\r\n    await command._invoke_autocomplete(interaction, focused, namespace)\r\n  File \"c:\\path\\venv\\lib\\site-packages\\discord\\app_commands\\commands.py\", line 557, in _invoke_autocomplete\r\n    raise CommandSignatureMismatch(self) from None\r\ndiscord.app_commands.errors.CommandSignatureMismatch: The signature for command 'tag' is different from the one provided by Discord. This can happen because either your \r\ncode is out of date or you have not synced the commands with Discord, causing the mismatch in data. It is recommended to sync the command tree to fix this issue. \r\n```\n\n### Minimal Reproducible Code\n\n```python\n@app_commands.command()\r\n@app_commands.rename(argument=\"my_argument\")\r\nasync def my_command(inter: discord.Interaction, argument: str):\r\n  # stuff\r\n\r\n@my_command.autocomplete(\"argument\")\r\nasync def argument_autocomplete(inter: discord.Interaction, current: str):\r\n  # other stuff\n```\n\n\n### Expected Results\n\nDon't get error, see the autocomplete result in Discord\n\n### Actual Results\n\nAn error occur.\n\n### Intents\n\ndiscord.Intents.all()\n\n### System Information\n\n- Python v3.10.0-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a3989+ge5153780\r\n- aiohttp v3.7.4.post0\r\n- system info: Windows 10 10.0.19043\n\n### Checklist\n\n- [X] I have searched the open issues for duplicates.\n- [X] I have shown the entire traceback, if possible.\n- [X] I have removed my token from display, if visible.\n\n### Additional Context\n\n_No response_", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7810/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7810/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7698", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7698/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7698/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7698/events", "html_url": "https://github.com/Rapptz/discord.py/issues/7698", "id": 1170487062, "node_id": "I_kwDOAnRas85FxDcW", "number": 7698, "title": "Support for foreign language command name", "user": {"login": "quesera2", "id": 2074276, "node_id": "MDQ6VXNlcjIwNzQyNzY=", "avatar_url": "https://avatars.githubusercontent.com/u/2074276?v=4", "gravatar_id": "", "url": "https://api.github.com/users/quesera2", "html_url": "https://github.com/quesera2", "followers_url": "https://api.github.com/users/quesera2/followers", "following_url": "https://api.github.com/users/quesera2/following{/other_user}", "gists_url": "https://api.github.com/users/quesera2/gists{/gist_id}", "starred_url": "https://api.github.com/users/quesera2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/quesera2/subscriptions", "organizations_url": "https://api.github.com/users/quesera2/orgs", "repos_url": "https://api.github.com/users/quesera2/repos", "events_url": "https://api.github.com/users/quesera2/events{/privacy}", "received_events_url": "https://api.github.com/users/quesera2/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-03-16T03:13:15Z", "updated_at": "2022-03-16T03:38:02Z", "closed_at": "2022-03-16T03:38:02Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nAllow languages without the concept of capitalization\r\n\r\n### What is the feature request for?\r\n\r\nThe core library\r\n\r\n### The Problem\r\n\r\nhttps://github.com/Rapptz/discord.py/blob/2d28d7b765016e0cf01b12048926ea2d6b52d24a/discord/app_commands/commands.py#L141-L147\r\n\r\nAn exception is raised if the app command name is not lower-cased according to the specification. However, some languages(e.g. Japanese) always treat it as an invalid name.\r\n\r\n### The Ideal Solution\r\n\r\nDetermine if the characters made lower case with `lower()` are the same as the original name.\r\n\r\n```python\r\nif name.lower() != name: \r\n    raise ValueError('names must be all lower case') \r\n```\r\n\r\n### The Current Solution\r\n\r\n_No response_\r\n\r\n### Additional Context\r\n\r\n_No response_", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7698/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7698/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7690", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7690/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7690/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7690/events", "html_url": "https://github.com/Rapptz/discord.py/issues/7690", "id": 1169027229, "node_id": "I_kwDOAnRas85FrfCd", "number": 7690, "title": "Problem with typing.Literal", "user": {"login": "srlightt", "id": 65732030, "node_id": "MDQ6VXNlcjY1NzMyMDMw", "avatar_url": "https://avatars.githubusercontent.com/u/65732030?v=4", "gravatar_id": "", "url": "https://api.github.com/users/srlightt", "html_url": "https://github.com/srlightt", "followers_url": "https://api.github.com/users/srlightt/followers", "following_url": "https://api.github.com/users/srlightt/following{/other_user}", "gists_url": "https://api.github.com/users/srlightt/gists{/gist_id}", "starred_url": "https://api.github.com/users/srlightt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/srlightt/subscriptions", "organizations_url": "https://api.github.com/users/srlightt/orgs", "repos_url": "https://api.github.com/users/srlightt/repos", "events_url": "https://api.github.com/users/srlightt/events{/privacy}", "received_events_url": "https://api.github.com/users/srlightt/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-03-14T23:46:07Z", "updated_at": "2022-03-15T01:18:03Z", "closed_at": "2022-03-15T01:18:03Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\n\nI ran into maybe a problem with the library, using the special converter typing.Literal, currently I can't pass just one parameter\n\n### Reproduction Steps\n\nI used it with my parameter to be a literal string \"guild-avatar\", in app command\r\n\r\n```py\r\n    @app_commands.command()\r\n    async def avatar(self, interaction: discord.Interaction, user: discord.Member = None, argument: typing.Literal['guild-avatar'] = None):\r\n```\n\n### Minimal Reproducible Code\n\n_No response_\n\n### Expected Results\n\nI hope typing.Literal only accepts one argument too, currently generating this error:\r\n\r\n```py\r\n  File \"C:\\Users\\light\\Documents\\pycharm\\newdiscordpy\\venv\\lib\\site-packages\\discord\\app_commands\\transformers.py\", line 271, in _make_literal_transformer\r\n    raise TypeError(f'typing.Literal requires at least two values.')\r\ndiscord.ext.commands.errors.ExtensionFailed: Extension 'cogs.Info.avatar' raised an error: TypeError: typing.Literal requires at least two values.\r\n```\n\n### Actual Results\n\nApparently this is accepting 2 parameters upwards, the error is coming if we put only one argument\r\n\r\nIt currently does not generate an error if we use it this way:\r\n```py\r\n    @app_commands.command()\r\n    async def avatar(self, interaction: discord.Interaction, user: discord.Member = None, argument: typing.Literal['guild-avatar', 'avatar'] = None):\r\n```\n\n### Intents\n\nNone\n\n### System Information\n\n- Python v3.9.6-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a3881+g6dd8845\r\n- aiohttp v3.7.4.post0\r\n- system info: Windows 10 10.0.19044\n\n### Checklist\n\n- [X] I have searched the open issues for duplicates.\n- [X] I have shown the entire traceback, if possible.\n- [X] I have removed my token from display, if visible.\n\n### Additional Context\n\n_No response_", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7690/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7690/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7676", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7676/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7676/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7676/events", "html_url": "https://github.com/Rapptz/discord.py/issues/7676", "id": 1167655993, "node_id": "I_kwDOAnRas85FmQQ5", "number": 7676, "title": "tasks.loop display too many warning.", "user": {"login": "hawk-tomy", "id": 67221751, "node_id": "MDQ6VXNlcjY3MjIxNzUx", "avatar_url": "https://avatars.githubusercontent.com/u/67221751?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hawk-tomy", "html_url": "https://github.com/hawk-tomy", "followers_url": "https://api.github.com/users/hawk-tomy/followers", "following_url": "https://api.github.com/users/hawk-tomy/following{/other_user}", "gists_url": "https://api.github.com/users/hawk-tomy/gists{/gist_id}", "starred_url": "https://api.github.com/users/hawk-tomy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hawk-tomy/subscriptions", "organizations_url": "https://api.github.com/users/hawk-tomy/orgs", "repos_url": "https://api.github.com/users/hawk-tomy/repos", "events_url": "https://api.github.com/users/hawk-tomy/events{/privacy}", "received_events_url": "https://api.github.com/users/hawk-tomy/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2022-03-13T18:22:23Z", "updated_at": "2022-03-14T10:09:27Z", "closed_at": "2022-03-14T10:09:27Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\n\n#7659 is probably not fixed. \n\n### Reproduction Steps\n\nuse tasks.loop\r\nset not utc timezone for time parameter in loop decorator (@loop(time=[...]))\r\nrun program\r\nlogged too many warning. (I run it when 03:00 ~ )\n\n### Minimal Reproducible Code\n\n```python\nimport asyncio\r\nfrom datetime import time, timedelta, timezone\r\nfrom logging import basicConfig\r\n\r\nfrom discord.ext import tasks\r\nfrom discord.utils import utcnow\r\n\r\njst = tzinfo=timezone(timedelta(hours=9.))\r\n\r\n@tasks.loop(time=[time(hour=h, jst) for h in range(0, 24, 3)])\r\nasync def loop():\r\n    pass\r\n\r\nasync def main():\r\n    basicConfig()\r\n    loop.start()\r\n    while 1:\r\n        await asyncio.sleep(10.)\r\n\r\nasyncio.run(main())\n```\n\n\n### Expected Results\n\nwait until 06:00(JST) + few log\n\n### Actual Results\n\nlogged too many warning. (not 3 times. 700+ in 1s or less.)\r\n```\r\nWARNING:discord.ext.tasks:Clock drift detected for task loop. Woke up at 2022-03-13 18:05:24.416040+00:00 but needed to sleep until 2022-03-14 00:00:00+09:00. Sleeping until 2022-03-14 00:00:00+09:00 again to correct clock\r\nWARNING:discord.ext.tasks:Clock drift detected for task loop. Woke up at 2022-03-13 18:05:24.417041+00:00 but needed to sleep until 2022-03-14 00:00:00+09:00. Sleeping until 2022-03-14 00:00:00+09:00 again to correct clock\r\nWARNING:discord.ext.tasks:Clock drift detected for task loop. Woke up at 2022-03-13 18:05:24.417041+00:00 but needed to sleep until 2022-03-14 00:00:00+09:00. Sleeping until 2022-03-14 00:00:00+09:00 again to correct clock\r\nWARNING:discord.ext.tasks:Clock drift detected for task loop. Woke up at 2022-03-13 18:05:24.417041+00:00 but needed to sleep until 2022-03-14 00:00:00+09:00. Sleeping until 2022-03-14 00:00:00+09:00 again to correct clock\r\n```\n\n### Intents\n\nnothing\n\n### System Information\n\n- Python v3.9.4-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a3865+g58ad146\r\n- aiohttp v3.8.1\r\n- system info: Windows 10 10.0.19041\n\n### Checklist\n\n- [X] I have searched the open issues for duplicates.\n- [X] I have shown the entire traceback, if possible.\n- [X] I have removed my token from display, if visible.\n\n### Additional Context\n\nI suspect this line is the cause, but I don't know the solution.\r\n\r\nhttps://github.com/Rapptz/discord.py/blob/58ad146a4e051bfcbcdc2d626f6ce2941c60265a/discord/ext/tasks/__init__.py#L608\r\n```py\r\n>>> time(hour=3, tzinfo=timezone(timedelta(hours=9))) >= time(hour=0, tzinfo=timezone.utc)\r\nFalse\r\n```", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7676/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 1}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7676/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7659", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7659/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7659/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7659/events", "html_url": "https://github.com/Rapptz/discord.py/issues/7659", "id": 1167320419, "node_id": "I_kwDOAnRas85Fk-Vj", "number": 7659, "title": "tasks.loop run too many times, if I use not utc timezone.", "user": {"login": "hawk-tomy", "id": 67221751, "node_id": "MDQ6VXNlcjY3MjIxNzUx", "avatar_url": "https://avatars.githubusercontent.com/u/67221751?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hawk-tomy", "html_url": "https://github.com/hawk-tomy", "followers_url": "https://api.github.com/users/hawk-tomy/followers", "following_url": "https://api.github.com/users/hawk-tomy/following{/other_user}", "gists_url": "https://api.github.com/users/hawk-tomy/gists{/gist_id}", "starred_url": "https://api.github.com/users/hawk-tomy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hawk-tomy/subscriptions", "organizations_url": "https://api.github.com/users/hawk-tomy/orgs", "repos_url": "https://api.github.com/users/hawk-tomy/repos", "events_url": "https://api.github.com/users/hawk-tomy/events{/privacy}", "received_events_url": "https://api.github.com/users/hawk-tomy/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-03-12T15:40:53Z", "updated_at": "2022-03-13T15:43:01Z", "closed_at": "2022-03-13T15:43:01Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\r\n\r\nI'm live in Japan, and I want to use timezone(JST, utc+09:00) for times parameter, but tasks.loop run too many times.\r\n\r\n### Reproduction Steps\r\n\r\nuse `tasks.loop`\r\nset **not** utc timezone for `times` parameter in loop decorator (`@loop(times=[...])`)\r\nrun bot\r\ntoo many times run seted func, when 00:00(JST) ~ 09:00(JST) (UCT: 15:00 ~ 00:00)\r\n\r\n### Minimal Reproducible Code\r\n\r\n```python\r\nimport asyncio\r\nfrom datetime import time, timedelta, timezone\r\n\r\nfrom discord.ext import tasks\r\nfrom discord.utils import utcnow\r\n\r\n\r\n@tasks.loop(\r\n    time=[\r\n        time(hour=h, tzinfo=timezone(timedelta(hours=9.))) #JST is utc + 09:00\r\n            for h in range(0, 24, 3)\r\n        ]\r\n    )\r\nasync def loop():\r\n    print(f'call: {utcnow()=}')\r\n\r\nasync def main():\r\n    loop.start()\r\n    while 1:\r\n        await asyncio.sleep(1.)\r\n\r\nasyncio.run(main())\r\n```\r\n\r\n\r\n### Expected Results\r\n\r\nrun before midnight(JST) -> end after midnight(JST)\r\none line.\r\n```\r\ncall: utcnow()=datetime.datetime(2022, 3, 12, 15, 0, 0, 7839, tzinfo=datetime.timezone.utc)\r\n```\r\n\r\n### Actual Results\r\n\r\nnot one line.\r\n```\r\ncall: utcnow()=datetime.datetime(2022, 3, 12, 15, 0, 0, 7839, tzinfo=datetime.timezone.utc)\r\ncall: utcnow()=datetime.datetime(2022, 3, 12, 15, 0, 0, 11839, tzinfo=datetime.timezone.utc)\r\ncall: utcnow()=datetime.datetime(2022, 3, 12, 15, 0, 0, 12839, tzinfo=datetime.timezone.utc)\r\ncall: utcnow()=datetime.datetime(2022, 3, 12, 15, 0, 0, 13838, tzinfo=datetime.timezone.utc)\r\ncall: utcnow()=datetime.datetime(2022, 3, 12, 15, 0, 0, 14838, tzinfo=datetime.timezone.utc)\r\ncall: utcnow()=datetime.datetime(2022, 3, 12, 15, 0, 0, 14838, tzinfo=datetime.timezone.utc)\r\ncall: utcnow()=datetime.datetime(2022, 3, 12, 15, 0, 0, 15837, tzinfo=datetime.timezone.utc)\r\ncall: utcnow()=datetime.datetime(2022, 3, 12, 15, 0, 0, 15837, tzinfo=datetime.timezone.utc)\r\ncall: utcnow()=datetime.datetime(2022, 3, 12, 15, 0, 0, 16842, tzinfo=datetime.timezone.utc)\r\ncall: utcnow()=datetime.datetime(2022, 3, 12, 15, 0, 0, 17841, tzinfo=datetime.timezone.utc)\r\n```\r\n\r\n### Intents\r\n\r\nnothing\r\n\r\n### System Information\r\n\r\n- Python v3.9.4-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a3844+gd68f2db\r\n- aiohttp v3.8.1\r\n- system info: Windows 10 10.0.19041\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### Additional Context\r\n\u65e5\u672c\u8a9e\u3067\u66f8\u3044\u3066\u3082\u3088\u3044\u306e\u3067\u3042\u308c\u3070\u3001\u3068\u3066\u3082\u3042\u308a\u304c\u305f\u3044\u3067\u3059\u3002\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7659/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7659/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7650", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7650/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7650/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7650/events", "html_url": "https://github.com/Rapptz/discord.py/issues/7650", "id": 1167008535, "node_id": "I_kwDOAnRas85FjyMX", "number": 7650, "title": "Context menu not syncing unless there are slash commands", "user": {"login": "nmsturcke", "id": 30734036, "node_id": "MDQ6VXNlcjMwNzM0MDM2", "avatar_url": "https://avatars.githubusercontent.com/u/30734036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nmsturcke", "html_url": "https://github.com/nmsturcke", "followers_url": "https://api.github.com/users/nmsturcke/followers", "following_url": "https://api.github.com/users/nmsturcke/following{/other_user}", "gists_url": "https://api.github.com/users/nmsturcke/gists{/gist_id}", "starred_url": "https://api.github.com/users/nmsturcke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nmsturcke/subscriptions", "organizations_url": "https://api.github.com/users/nmsturcke/orgs", "repos_url": "https://api.github.com/users/nmsturcke/repos", "events_url": "https://api.github.com/users/nmsturcke/events{/privacy}", "received_events_url": "https://api.github.com/users/nmsturcke/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2022-03-11T23:49:04Z", "updated_at": "2022-03-12T14:36:33Z", "closed_at": "2022-03-12T14:36:09Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\n\nContext menu not syncing unless there are slash commands\n\n### Reproduction Steps\n\n> 1. Make a bot\r\n> 2. Create a cog and in it add a context menu (in my case I bound it to a specific guild)\r\n> 3. Sync commands (in my case for the specific guild)\r\n\r\n> **Observe** -  if you did not add any slash commands, the context menu won't appear\r\n\r\n> 5. Add a slash command (in my case to the specific guild) and sync again\r\n\r\n> **Observe** - Both the slash command and the context menus appear\n\n### Minimal Reproducible Code\n\n_No response_\n\n### Expected Results\n\nThe context menu appears without having to add a slash command.\n\n### Actual Results\n\nThe context menu is not available unless you add a slash command.\n\n### Intents\n\ndiscord.Intents.none()\n\n### System Information\n\n- Python v3.8.9-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a3817+gd22a7fb7\r\n- aiohttp v3.8.1\r\n- system info: Darwin 21.2.0 Darwin Kernel Version 21.2.0: Sun Nov 28 20:28:54 PST 2021; root:xnu-8019.61.5~1/RELEASE_X86_64\n\n### Checklist\n\n- [X] I have searched the open issues for duplicates.\n- [X] I have shown the entire traceback, if possible.\n- [X] I have removed my token from display, if visible.\n\n### Additional Context\n\n_No response_", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7650/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7650/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7641", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7641/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7641/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7641/events", "html_url": "https://github.com/Rapptz/discord.py/issues/7641", "id": 1166418345, "node_id": "I_kwDOAnRas85FhiGp", "number": 7641, "title": "Broken transmission of multiple guilds when registering a slash command.", "user": {"login": "MeidoNoHitsuji", "id": 8300123, "node_id": "MDQ6VXNlcjgzMDAxMjM=", "avatar_url": "https://avatars.githubusercontent.com/u/8300123?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MeidoNoHitsuji", "html_url": "https://github.com/MeidoNoHitsuji", "followers_url": "https://api.github.com/users/MeidoNoHitsuji/followers", "following_url": "https://api.github.com/users/MeidoNoHitsuji/following{/other_user}", "gists_url": "https://api.github.com/users/MeidoNoHitsuji/gists{/gist_id}", "starred_url": "https://api.github.com/users/MeidoNoHitsuji/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MeidoNoHitsuji/subscriptions", "organizations_url": "https://api.github.com/users/MeidoNoHitsuji/orgs", "repos_url": "https://api.github.com/users/MeidoNoHitsuji/repos", "events_url": "https://api.github.com/users/MeidoNoHitsuji/events{/privacy}", "received_events_url": "https://api.github.com/users/MeidoNoHitsuji/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-03-11T13:29:17Z", "updated_at": "2022-03-11T13:34:37Z", "closed_at": "2022-03-11T13:34:37Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nIf you pass several guilds to the slash command, then it does not work.\r\n\r\n### Reproduction Steps\r\n\r\nDoes not work:\r\n`@tree.command(guilds=[discord.Object(id=GUILD_ID), discord.Object(id=GUILD_ID)])`\r\n\r\n### Minimal Reproducible Code\r\n\r\n_No response_\r\n\r\n### Expected Results\r\n\r\nThe team will be registered in several guilds.\r\n\r\n### Actual Results\r\n\r\nThe team was not registered anywhere.\r\n\r\n### Intents\r\n\r\ndiscord.Intents.all()\r\n\r\n### System Information\r\n\r\n- Python v3.9.10-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a3833+g740c156\r\n- aiohttp v3.7.4.post0\r\n- system info: Linux 5.10.0-hiveos #83.hiveos.211201 SMP Wed Dec 1 11:51:04 UTC 2021\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### Additional Context\r\n\r\nThis problem is extremely easy to fix. In the tree.py file, you need to replace the line with the `if guild is MISSING:` check with `if guilds is MISSING:` (this is even mentioned in the comments above the condition line).\r\nHere's an example of what the final code should look like:\r\n\r\n`def _retrieve_guild_ids(\r\n    command: Any, guild: Optional[Snowflake] = MISSING, guilds: List[Snowflake] = MISSING\r\n) -> Optional[Set[int]]:\r\n    if guild is not MISSING and guilds is not MISSING:\r\n        raise TypeError('cannot mix guild and guilds keyword arguments')\r\n\r\n    # guilds=[] or guilds=[...]\r\n    if guild is MISSING:\r\n        # If no arguments are given then it should default to the ones\r\n        # given to the guilds(...) decorator or None for global.\r\n        if guilds is MISSING:\r\n            return getattr(command, '_guild_ids', None)\r\n\r\n        # guilds=[] is the same as global\r\n        if len(guilds) == 0:\r\n            return None\r\n\r\n        return {g.id for g in guilds}\r\n\r\n    # At this point it should be...\r\n    # guild=None or guild=Object\r\n    if guild is None:\r\n        return None\r\n    return {guild.id}`", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7641/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7641/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7624", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7624/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7624/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7624/events", "html_url": "https://github.com/Rapptz/discord.py/issues/7624", "id": 1165476265, "node_id": "I_kwDOAnRas85Fd8Gp", "number": 7624, "title": "Slash autocomplete in a cog bug", "user": {"login": "Soheab", "id": 33902984, "node_id": "MDQ6VXNlcjMzOTAyOTg0", "avatar_url": "https://avatars.githubusercontent.com/u/33902984?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Soheab", "html_url": "https://github.com/Soheab", "followers_url": "https://api.github.com/users/Soheab/followers", "following_url": "https://api.github.com/users/Soheab/following{/other_user}", "gists_url": "https://api.github.com/users/Soheab/gists{/gist_id}", "starred_url": "https://api.github.com/users/Soheab/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Soheab/subscriptions", "organizations_url": "https://api.github.com/users/Soheab/orgs", "repos_url": "https://api.github.com/users/Soheab/repos", "events_url": "https://api.github.com/users/Soheab/events{/privacy}", "received_events_url": "https://api.github.com/users/Soheab/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/8", "html_url": "https://github.com/Rapptz/discord.py/milestone/8", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/8/labels", "id": 4299068, "node_id": "MDk6TWlsZXN0b25lNDI5OTA2OA==", "number": 8, "title": "v2.0", "description": "The next major version with breaking changes for the library", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 1, "closed_issues": 13, "state": "open", "created_at": "2019-05-09T10:08:50Z", "updated_at": "2022-08-15T13:19:49Z", "due_on": null, "closed_at": null}, "comments": 2, "created_at": "2022-03-10T16:52:29Z", "updated_at": "2022-04-23T07:48:32Z", "closed_at": "2022-03-11T00:32:06Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\r\n\r\nThe library still passes self if the autocomplete callable is outside the class\r\n\r\n### Reproduction Steps\r\n\r\nThe library tries to pass in `self` as the first parameter but it does not check if the callable is in a class or not, this makes it raise the following TypeError:\r\n```py\r\nTraceback (most recent call last):\r\n  File '...\\lib\\site-packages\\discord\\app_commands\\tree.py\", line 666, in wrapper\r\n    await self.call(interaction)\r\n  File \"...\\lib\\site-packages\\discord\\app_commands\\tree.py\", line 782, in call\r\n    await command._invoke_autocomplete(interaction, focused, namespace)\r\n  File \"...\\lib\\site-packages\\discord\\app_commands\\commands.py\", line 438, in _invoke_autocomplete\r\n    choices = await param.autocomplete(self.binding, interaction, value, namespace)\r\nTypeError: my_autocomplete() takes 3 positional arguments but 4 were given\r\n```\r\n\r\n### Minimal Reproducible Code\r\n\r\n```python\r\nfrom typing import List\r\n\r\nfrom discord import Interaction, Intents\r\nfrom discord.ext.commands import Bot, Cog\r\nfrom discord.app_commands import autocomplete, command, Choice, Namespace\r\n\r\n\r\nasync def my_autocomplete(interaction: Interaction, current: str, namespace: Namespace) -> List[Choice]:\r\n  my_list: List[str] = [\"alpha\", \"beta\", \"candidate\", \"final\"]\r\n  return [Choice(name=value, value=value) for value in my_list if value.startwith(current)]\r\n\r\n\r\nclass MyCog(Cog):\r\n  \r\n  @command(name=\"testing_issue7624\", guild=123):\r\n  @autocomplete(example=my_autocomplete)\r\n  async def testing_command(self, interaction: Interaction, example: str):\r\n    await interaction.response.send_message(f\"{example=}\")\r\n\r\n\r\nbot = commands.Bot(\"...?!\", intents=Intents.none())\r\n\r\n@bot.event\r\nasync def on_ready():\r\n  await bot.tree.sync()\r\n\r\nbot.add_cog(MyCog())\r\nbot.run(...)\r\n```\r\n\r\n\r\n### Expected Results\r\n\r\nIt calling my_autocomplete correctly.\r\n\r\n### Actual Results\r\n\r\nRaised a TypeError\r\n\r\n### Intents\r\n\r\nNot relevant but: `guilds, emojis, presences, messages, reactions, voice_states, message_content`\r\n\r\n### System Information\r\n\r\n- Python v3.9.6-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a3817+gd22a7fb7\r\n- aiohttp v3.7.4.post0\r\n- system info: Windows 10 10.0.22000 (11 tho)\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### Additional Context\r\n\r\n_No response_", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7624/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7624/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7602", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7602/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7602/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7602/events", "html_url": "https://github.com/Rapptz/discord.py/issues/7602", "id": 1163510661, "node_id": "I_kwDOAnRas85FWcOF", "number": 7602, "title": "If a guild and global command have the same name, the guild command will always be invoked.", "user": {"login": "Matthew1177", "id": 56777713, "node_id": "MDQ6VXNlcjU2Nzc3NzEz", "avatar_url": "https://avatars.githubusercontent.com/u/56777713?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Matthew1177", "html_url": "https://github.com/Matthew1177", "followers_url": "https://api.github.com/users/Matthew1177/followers", "following_url": "https://api.github.com/users/Matthew1177/following{/other_user}", "gists_url": "https://api.github.com/users/Matthew1177/gists{/gist_id}", "starred_url": "https://api.github.com/users/Matthew1177/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Matthew1177/subscriptions", "organizations_url": "https://api.github.com/users/Matthew1177/orgs", "repos_url": "https://api.github.com/users/Matthew1177/repos", "events_url": "https://api.github.com/users/Matthew1177/events{/privacy}", "received_events_url": "https://api.github.com/users/Matthew1177/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/8", "html_url": "https://github.com/Rapptz/discord.py/milestone/8", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/8/labels", "id": 4299068, "node_id": "MDk6TWlsZXN0b25lNDI5OTA2OA==", "number": 8, "title": "v2.0", "description": "The next major version with breaking changes for the library", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 1, "closed_issues": 13, "state": "open", "created_at": "2019-05-09T10:08:50Z", "updated_at": "2022-08-15T13:19:49Z", "due_on": null, "closed_at": null}, "comments": 2, "created_at": "2022-03-09T05:33:07Z", "updated_at": "2022-03-11T01:11:27Z", "closed_at": "2022-03-11T01:11:26Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\n\nIf a guild and global command have the same name, the guild command will always be invoked regardless of which is called.\n\n### Reproduction Steps\n\n- Create a guild command and global command with the same name\r\n- Run both and observe\n\n### Minimal Reproducible Code\n\n```python\nimport discord\r\nfrom discord import app_commands\r\n\r\nbot = discord.Client()\r\ntree = app_commands.CommandTree(bot)\r\n\r\n\r\n@tree.command(name=\"test\", description=\"global\")\r\nasync def test_global(inter: discord.Interaction):\r\n    await inter.response.send_message(\"global command\")\r\n\r\n\r\n@tree.command(name=\"test\", guild=discord.Object(GUILD_ID), description=\"guild\")\r\nasync def test_guild(inter: discord.Interaction):\r\n    await inter.response.send_message(\"guild command\")\r\n\r\n\r\n@bot.event\r\nasync def on_ready():\r\n    await tree.sync(guild=discord.Object(GUILD_ID))\r\n    await tree.sync()\r\n\r\n\r\nbot.run(TOKEN)\n```\n\n\n### Expected Results\n\nWhen running the global `/test`, the global `/test` is invoked.\n\n### Actual Results\n\nWhen running the global `/test`, the guild `/test` is invoked.\n\n### Intents\n\ndiscord.Intents.default()\n\n### System Information\n\n- Python v3.10.1-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a3786+g3d74da8\r\n- aiohttp v3.7.4.post0\n\n### Checklist\n\n- [X] I have searched the open issues for duplicates.\n- [X] I have shown the entire traceback, if possible.\n- [X] I have removed my token from display, if visible.\n\n### Additional Context\n\nThis causes a CommandSignatureMismatch if the guild command has a different signature than the global command. ", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7602/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7602/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7541", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7541/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7541/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7541/events", "html_url": "https://github.com/Rapptz/discord.py/issues/7541", "id": 1160626694, "node_id": "I_kwDOAnRas85FLcIG", "number": 7541, "title": "Archived threads do not get evicted from Guild.threads cache", "user": {"login": "Jackenmen", "id": 6032823, "node_id": "MDQ6VXNlcjYwMzI4MjM=", "avatar_url": "https://avatars.githubusercontent.com/u/6032823?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jackenmen", "html_url": "https://github.com/Jackenmen", "followers_url": "https://api.github.com/users/Jackenmen/followers", "following_url": "https://api.github.com/users/Jackenmen/following{/other_user}", "gists_url": "https://api.github.com/users/Jackenmen/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jackenmen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jackenmen/subscriptions", "organizations_url": "https://api.github.com/users/Jackenmen/orgs", "repos_url": "https://api.github.com/users/Jackenmen/repos", "events_url": "https://api.github.com/users/Jackenmen/events{/privacy}", "received_events_url": "https://api.github.com/users/Jackenmen/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-03-06T14:35:46Z", "updated_at": "2022-03-09T02:16:47Z", "closed_at": "2022-03-09T02:16:47Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\r\n\r\nThread stays in Guild.threads when it's archived during bot's runtime.\r\n\r\n### Reproduction Steps\r\n\r\nCheck the value of `guild.threads` after each step:\r\n1. Create a public thread.\r\n2. Archive a thread.\r\n3. Check the value of `Guild.threads` and notice that the thread was not evicted from cache\r\n\r\n### Minimal Reproducible Code\r\n\r\n```python\r\nHere's a few tests and their results:\r\n\r\nprint(guild.threads)\r\n\r\nthread = await channel.create_thread(name=\"example-thread\", type=discord.ChannelType.public_thread)\r\nawait asyncio.sleep(0)  # allow the gateway events to come\r\nprint(guild.threads)\r\n\r\nawait thread.edit(archived=True)\r\nawait asyncio.sleep(0)  # allow the gateway events to come\r\nprint(guild.threads)\r\n\r\nawait thread.edit(archived=False)\r\nawait asyncio.sleep(0)  # allow the gateway events to come\r\nprint(guild.threads)\r\n\r\nawait thread.edit(locked=True)\r\nawait asyncio.sleep(0)  # allow the gateway events to come\r\nprint(guild.threads)\r\n```\r\n\r\nResults:\r\n```\r\n[]\r\n[<Thread id=950038334057644153 name='example-thread' parent=commands owner_id=536260979772882946 locked=False archived=False>]\r\n[<Thread id=950038334057644153 name='example-thread' parent=commands owner_id=536260979772882946 locked=False archived=True>]\r\n[<Thread id=950038334057644153 name='example-thread' parent=commands owner_id=536260979772882946 locked=False archived=False>]\r\n[<Thread id=950038334057644153 name='example-thread' parent=commands owner_id=536260979772882946 locked=True archived=False>]\r\n```\r\n\r\n\r\n### Expected Results\r\n\r\nI expected the thread to be evicted from the cache.\r\n\r\n### Actual Results\r\n\r\nThe thread was not evicted from the cache.\r\n\r\n### Intents\r\n\r\ndiscord.Intents.all()\r\n\r\n### System Information\r\n\r\n\u03bb python -m discord -v\r\n- Python v3.8.10-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a3741+ga909c1ff\r\n- aiohttp v3.7.4.post0\r\n- system info: Windows 10 10.0.19043\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### Additional Context\r\n\r\n_No response_", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7541/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7541/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7531", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7531/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7531/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7531/events", "html_url": "https://github.com/Rapptz/discord.py/issues/7531", "id": 1160562324, "node_id": "I_kwDOAnRas85FLMaU", "number": 7531, "title": "Lost audio can't not play ", "user": {"login": "thedtvn", "id": 80153297, "node_id": "MDQ6VXNlcjgwMTUzMjk3", "avatar_url": "https://avatars.githubusercontent.com/u/80153297?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thedtvn", "html_url": "https://github.com/thedtvn", "followers_url": "https://api.github.com/users/thedtvn/followers", "following_url": "https://api.github.com/users/thedtvn/following{/other_user}", "gists_url": "https://api.github.com/users/thedtvn/gists{/gist_id}", "starred_url": "https://api.github.com/users/thedtvn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thedtvn/subscriptions", "organizations_url": "https://api.github.com/users/thedtvn/orgs", "repos_url": "https://api.github.com/users/thedtvn/repos", "events_url": "https://api.github.com/users/thedtvn/events{/privacy}", "received_events_url": "https://api.github.com/users/thedtvn/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2022-03-06T09:28:32Z", "updated_at": "2022-03-08T06:19:25Z", "closed_at": "2022-03-08T06:18:42Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nnot play audio\r\n\r\n### Reproduction Steps\r\n\r\n-re update 2.0.0a at 06/3/2022\r\n-test music \r\n- bot join no error log but no audio\r\n\r\n### Minimal Reproducible Code\r\n\r\n```python\r\n#code test for audio\r\n#am use eval command\r\nfrom discord import FFmpegPCMAudio\r\na = await ctx.author.voice.channel.connect()\r\nsource = FFmpegPCMAudio(\"https://radio.garden/api/ara/content/listen/P7TysNHJ/channel.mp3?1646558234850\")\r\nctx.voice_client.play(source)\r\n```\r\n\r\n\r\n### Expected Results\r\n\r\nbot join and play audio\r\n\r\n### Actual Results\r\n\r\nnothing bot just join and has no audio\r\n\r\n### Intents\r\n\r\nall\r\n\r\n### System Information\r\n\r\n- Python v3.10.1-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a3733+g07a1311\r\n- aiohttp v3.7.4.post0\r\n- system info: Windows 10 10.0.19042\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### Additional Context\r\n\r\n![image](https://user-images.githubusercontent.com/80153297/156917201-9ae27cb0-26b8-42d7-9977-bf1cdee65c6c.png)\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7531/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7531/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7386", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7386/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7386/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7386/events", "html_url": "https://github.com/Rapptz/discord.py/issues/7386", "id": 970694575, "node_id": "MDU6SXNzdWU5NzA2OTQ1NzU=", "number": 7386, "title": "UnexpectedQuoteError for keyword only args when preceded by optional argument", "user": {"login": "s0hv", "id": 17063236, "node_id": "MDQ6VXNlcjE3MDYzMjM2", "avatar_url": "https://avatars.githubusercontent.com/u/17063236?v=4", "gravatar_id": "", "url": "https://api.github.com/users/s0hv", "html_url": "https://github.com/s0hv", "followers_url": "https://api.github.com/users/s0hv/followers", "following_url": "https://api.github.com/users/s0hv/following{/other_user}", "gists_url": "https://api.github.com/users/s0hv/gists{/gist_id}", "starred_url": "https://api.github.com/users/s0hv/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/s0hv/subscriptions", "organizations_url": "https://api.github.com/users/s0hv/orgs", "repos_url": "https://api.github.com/users/s0hv/repos", "events_url": "https://api.github.com/users/s0hv/events{/privacy}", "received_events_url": "https://api.github.com/users/s0hv/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-08-13T20:34:11Z", "updated_at": "2021-08-19T23:56:28Z", "closed_at": "2021-08-19T23:56:28Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\n\nWhen a keyword only argument contains a single quote character such as \" an error if thrown if that argument is preceded by an optional argument.\n\n### Reproduction Steps\n\nReproduction code below. Here are the commands used to reproduce the bug in command response pairs\r\n\r\n`-test1 abc\"`\r\nThrows UnexpectedQuoteError\r\n\r\n`-test2 abc\"`\r\n`This works. abc\"`\r\n\r\n`-test3 1 abc\"`\r\n`This works. 1 abc\"`\r\n\n\n### Minimal Reproducible Code\n\n```python\nfrom typing import Optional\r\n\r\nfrom discord.ext.commands import Bot\r\n\r\nbot = Bot('-')\r\n\r\n\r\n@bot.event\r\nasync def on_ready():\r\n    print('ready')\r\n\r\n\r\n@bot.command()\r\nasync def test1(ctx, optional: Optional[int], *, rest):\r\n    await ctx.send(f'This does not work. {rest}')\r\n\r\n\r\n@bot.command()\r\nasync def test2(ctx, *, rest):\r\n    await ctx.send(f'This works. {rest}')\r\n\r\n\r\n@bot.command()\r\nasync def test3(ctx, required: int, *, rest):\r\n    await ctx.send(f'This works. {required} {rest}')\r\n\r\n\r\nbot.run('token')\n```\n\n\n### Expected Results\n\nI expected no error to be thrown when calling the test1 command.\n\n### Actual Results\n\nUnexpectedQuoteError was thrown when string contained a quote character.\n\n### Intents\n\nDefault intents\n\n### System Information\n\n- Python v3.7.4-final\r\n- discord.py v1.7.3-final\r\n- aiohttp v3.7.4.post0\r\n- system info: Windows 10 10.0.18362\r\n\n\n### Checklist\n\n- [X] I have searched the open issues for duplicates.\n- [X] I have shown the entire traceback, if possible.\n- [X] I have removed my token from display, if visible.\n\n### Additional Context\n\nExpectedClosingQuoteError is also thrown for test1 if the string starts with a quote while it is not thrown for the other two commands.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7386/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7386/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7345", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7345/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7345/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7345/events", "html_url": "https://github.com/Rapptz/discord.py/issues/7345", "id": 963325010, "node_id": "MDU6SXNzdWU5NjMzMjUwMTA=", "number": 7345, "title": "Asset replacing breaks sometimes when using 'gif' as `format`", "user": {"login": "AstreaTSS", "id": 25420078, "node_id": "MDQ6VXNlcjI1NDIwMDc4", "avatar_url": "https://avatars.githubusercontent.com/u/25420078?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AstreaTSS", "html_url": "https://github.com/AstreaTSS", "followers_url": "https://api.github.com/users/AstreaTSS/followers", "following_url": "https://api.github.com/users/AstreaTSS/following{/other_user}", "gists_url": "https://api.github.com/users/AstreaTSS/gists{/gist_id}", "starred_url": "https://api.github.com/users/AstreaTSS/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AstreaTSS/subscriptions", "organizations_url": "https://api.github.com/users/AstreaTSS/orgs", "repos_url": "https://api.github.com/users/AstreaTSS/repos", "events_url": "https://api.github.com/users/AstreaTSS/events{/privacy}", "received_events_url": "https://api.github.com/users/AstreaTSS/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-08-08T00:13:26Z", "updated_at": "2022-06-10T05:50:19Z", "closed_at": "2022-06-10T05:50:19Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nAsset replacing breaks sometimes when using 'gif' as `format`\r\n\r\n### Reproduction Steps\r\n\r\n- Use discord.py 2.0 (the alpha version, anyways).\r\n- Get an avatar asset of a user (in this case the bot, though this can apply to other types of avatars and possibly other types of assets as well).\r\n- Use the `replace` function to get either an animated GIF or a static PNG of said icon depending on what's provided.\r\n  - In this specific use case and error, the icon needs to be static for the error to happen.\r\n  - Also worth of note is that I get the URL right after by using `str`, though I don't think that matters too much.\r\n  - In the example below I'm using the bot's icon so this is *technically* wasteful, but I only did it this way because I just wanted to use the same line of code for all avatar assets.\r\n\r\n### Minimal Reproducible Code\r\n\r\n```python\r\nctx.guild.me.avatar.replace(format='gif',static_format='png',size=128) # should do the trick in a command\r\n```\r\n\r\n\r\n### Expected Results\r\n\r\nIt to get the new asset just fine.\r\n\r\n### Actual Results\r\n\r\n```python\r\nTraceback (most recent call last):\r\n  File \"PATH_TO_PYTHON\\discord\\ext\\commands\\core.py\", line 125, in wrapped\r\n    ret = await coro(*args, **kwargs)\r\n  File \"PATH_TO_COG\", line 123, in about\r\n    icon_url=f\"{str(ctx.guild.me.avatar.replace(format='gif',static_format='png',size=128))}\",\r\n  File \"PATH_TO_PYTHON\\discord\\asset.py\", line 307, in replace\r\n    raise InvalidArgument(f'format must be one of {VALID_STATIC_FORMATS}')\r\ndiscord.errors.InvalidArgument: format must be one of frozenset({'jpeg', 'webp', 'png', 'jpg'})\r\n```\r\n\r\n### Intents\r\n\r\n`guilds=True, members=True, emojis=True, messages=True, reactions=True`\r\n\r\n### System Information\r\n\r\n```\r\n- Python v3.8.9-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a3453+g58ca9e99\r\n- aiohttp v3.7.4.post0\r\n- system info: Windows 10 10.0.19041\r\n```\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7345/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7345/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7319", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7319/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7319/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7319/events", "html_url": "https://github.com/Rapptz/discord.py/issues/7319", "id": 957417677, "node_id": "MDU6SXNzdWU5NTc0MTc2Nzc=", "number": 7319, "title": "client.add_view() not working after about [01/07/2021 - 9 am India]", "user": {"login": "ELEXR", "id": 76996596, "node_id": "MDQ6VXNlcjc2OTk2NTk2", "avatar_url": "https://avatars.githubusercontent.com/u/76996596?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ELEXR", "html_url": "https://github.com/ELEXR", "followers_url": "https://api.github.com/users/ELEXR/followers", "following_url": "https://api.github.com/users/ELEXR/following{/other_user}", "gists_url": "https://api.github.com/users/ELEXR/gists{/gist_id}", "starred_url": "https://api.github.com/users/ELEXR/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ELEXR/subscriptions", "organizations_url": "https://api.github.com/users/ELEXR/orgs", "repos_url": "https://api.github.com/users/ELEXR/repos", "events_url": "https://api.github.com/users/ELEXR/events{/privacy}", "received_events_url": "https://api.github.com/users/ELEXR/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-08-01T07:25:35Z", "updated_at": "2021-08-01T09:58:00Z", "closed_at": "2021-08-01T07:30:53Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\npersistent view showing \"This interaction failed\"and not even throwing errors\r\n\r\n### Reproduction Steps\r\n\r\nthe code is revised by 2 more dev ; and there is no problem with the code , and i update the discord.py lib everytime (everyday).\r\nso ig the problem is with the library\r\n\r\n### Minimal Reproducible Code\r\n\r\n```python\r\n@client.event\r\nasync def on_ready():\r\n    await client.change_presence(status=discord.Status.online, activity=discord.Activity(name=\"how much time you study\", type=discord.ActivityType.watching))\r\n    print('loaded.')\r\n    fetchedchannel = client.get_channel(int(taskoverwatch_ch_id))\r\n    \r\n    client.add_view(Dash())\r\n\r\n    await fetchedchannel.send('DV2L3 RSD <@!615123886748467229> `<@!711957990999195669>`')\r\n    stats_updation.start()\r\n    cleaningbucket.start()\r\n    dashup.start()\r\n\r\nclass Dash(discord.ui.View):\r\n    def __init__(self):\r\n        super().__init__(timeout=None)\r\n        \r\n\r\n    @discord.ui.button(label=\"\ud83d\udcc8 Stats\",style=discord.ButtonStyle.grey,custom_id='Dash01')\r\n    async def DT(self,button : discord.Button, intr : discord.Interaction):\r\n    #debugged code\r\n    pass\r\n\r\n# a command to send the view panel\r\n@client.command()\r\n@commands.has_permissions(administrator=True)\r\nasync def t2(ctx):\r\n    E = discord.Embed()\r\n    E.set_author(name=\"Click on the button below to get your study statastics.\")\r\n    v = Dash()\r\n    await ctx.send(embed=E,view=v)\r\n    await v.wait()\r\n```\r\n\r\n\r\n### Expected Results\r\n\r\nwell . . . \r\n\r\n### Actual Results\r\n\r\nit shows \"This interaction failed\" on clicking the button\r\n\r\n### Intents\r\n\r\ndiscord.Intents.all\r\n\r\n### System Information\r\n\r\n- Python v3.8.10-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a3451+g035d1108\r\n- aiohttp v3.7.4.post0\r\n- system info: Linux 5.8.0-1038-gcp #40~20.04.1-Ubuntu SMP Thu Jul 15 11:55:03 UTC 2021\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### Additional Context\r\n\r\nwell . . . ", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7319/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7319/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7310", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7310/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7310/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7310/events", "html_url": "https://github.com/Rapptz/discord.py/issues/7310", "id": 957141708, "node_id": "MDU6SXNzdWU5NTcxNDE3MDg=", "number": 7310, "title": "Sync webhooks not working when run in threadpoolexecutor", "user": {"login": "JEF1056", "id": 22546776, "node_id": "MDQ6VXNlcjIyNTQ2Nzc2", "avatar_url": "https://avatars.githubusercontent.com/u/22546776?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JEF1056", "html_url": "https://github.com/JEF1056", "followers_url": "https://api.github.com/users/JEF1056/followers", "following_url": "https://api.github.com/users/JEF1056/following{/other_user}", "gists_url": "https://api.github.com/users/JEF1056/gists{/gist_id}", "starred_url": "https://api.github.com/users/JEF1056/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JEF1056/subscriptions", "organizations_url": "https://api.github.com/users/JEF1056/orgs", "repos_url": "https://api.github.com/users/JEF1056/repos", "events_url": "https://api.github.com/users/JEF1056/events{/privacy}", "received_events_url": "https://api.github.com/users/JEF1056/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2021-07-31T01:14:48Z", "updated_at": "2021-07-31T03:00:28Z", "closed_at": "2021-07-31T02:59:50Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nSync webhooks don't send with attributeerror\r\n\r\n### Reproduction Steps\r\n\r\nCreate a file with reproduction code below. Note: needs to be using the version in master\r\n\r\n### Minimal Reproducible Code\r\n\r\n```python\r\nimport os\r\nfrom discord import SyncWebhook\r\n\r\nwhch= SyncWebhook.from_url(os.environ['LOG_URL'])\r\nwhch.send(\"something\")\r\n```\r\n\r\n\r\n### Expected Results\r\n\r\nthe text \"something\" is sent to the webhook as defined in the enviorment variable LOG_URL\r\n\r\n### Actual Results\r\n\r\nthe error below:\r\n```\r\nFile \"/src/discord/discord/webhook/sync.py\", line 876, in send\r\n     adapter: WebhookAdapter = _context.adapter\r\nAttributeError: '_thread._local' object has no attribute 'adapter'\r\n```\r\n\r\n\r\n### Intents\r\n\r\ndiscord.Intents(messages=True, guilds=True, typing = False, presences = False, members=True, reactions=True)\r\n\r\n### System Information\r\n\r\n- Python v3.8.8-final\r\n- discord.py v2.0.0-alpha\r\n- discord.py pkg_resources: v2.0.0a3428+gecf239d2\r\n- aiohttp v3.7.4.post0\r\n- system info: Linux 4.4.0-1094-aws #99-Ubuntu SMP Thu Jul 15 22:47:31 UTC 2021\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### Additional Context\r\n\r\n_No response_", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7310/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7310/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7292", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7292/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7292/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7292/events", "html_url": "https://github.com/Rapptz/discord.py/issues/7292", "id": 955121889, "node_id": "MDU6SXNzdWU5NTUxMjE4ODk=", "number": 7292, "title": "discord.ext.commands.Flag disregards explicit annotation argument", "user": {"login": "PythonCoderAS", "id": 13932583, "node_id": "MDQ6VXNlcjEzOTMyNTgz", "avatar_url": "https://avatars.githubusercontent.com/u/13932583?v=4", "gravatar_id": "", "url": "https://api.github.com/users/PythonCoderAS", "html_url": "https://github.com/PythonCoderAS", "followers_url": "https://api.github.com/users/PythonCoderAS/followers", "following_url": "https://api.github.com/users/PythonCoderAS/following{/other_user}", "gists_url": "https://api.github.com/users/PythonCoderAS/gists{/gist_id}", "starred_url": "https://api.github.com/users/PythonCoderAS/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/PythonCoderAS/subscriptions", "organizations_url": "https://api.github.com/users/PythonCoderAS/orgs", "repos_url": "https://api.github.com/users/PythonCoderAS/repos", "events_url": "https://api.github.com/users/PythonCoderAS/events{/privacy}", "received_events_url": "https://api.github.com/users/PythonCoderAS/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-07-28T18:18:17Z", "updated_at": "2022-04-29T07:46:14Z", "closed_at": "2022-04-29T07:46:13Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\r\n\r\nThe discord.ext.commands.Flag constructor takes a type annotation but completely disregards it when doing flag processing.\r\n\r\n### Reproduction Steps\r\n\r\nI made a custom converter and a datatype that is returned by it. I then constructed a flag and gave the converter as the `annotation` parameter, **but also gave the field its own type argument of the datatype**. When the flags are processed, it uses the type hint I gave and disregards the one specified in the Flag constructor.\r\n\r\n### Minimal Reproducible Code\r\n\r\n```python\r\nclass MyDataType:\r\n    def __init__(self, pos_1, pos2): ...\r\n\r\nclass GenericDataTypeConverter(Converter):\r\n    def __init__(self, type_to_convert): ...\r\n \r\n   async def convert(self, ctx, arg): ...\r\n\r\nclass MyFlags(Flag):\r\n    my_type: MyDataType = Flag(name=\"type\", annotation=GenericDataTypeConverter(MyDataType))\r\n    some_arg: str\r\n\r\n@command\r\nasync def my_command(ctx, *, flags: MyFlags): ...\r\n```\r\n\r\n\r\n### Expected Results\r\n\r\nIt should use `GenericDataTypeConverter.convert`.\r\n\r\n### Actual Results\r\n\r\nIt tries to do `MyDataType.__init__`, which will fail since it requires positional arguments.\r\n\r\n### Intents\r\n\r\ndiscord.Intents.all()\r\n\r\n### System Information\r\n\r\n- Python v3.8.11-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a3407+gfc51736b\r\n- aiohttp v3.7.4.post0\r\n- system info: Darwin 20.5.0 Darwin Kernel Version 20.5.0: Sat May  8 05:10:33 PDT 2021; root:xnu-7195.121.3~9/RELEASE_X86_64\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### Additional Context\r\n\r\n_No response_", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7292/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7292/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7231", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7231/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7231/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7231/events", "html_url": "https://github.com/Rapptz/discord.py/issues/7231", "id": 944121893, "node_id": "MDU6SXNzdWU5NDQxMjE4OTM=", "number": 7231, "title": "Components get moved randomly in a full Action Row on message/view update", "user": {"login": "Luc1412", "id": 24532065, "node_id": "MDQ6VXNlcjI0NTMyMDY1", "avatar_url": "https://avatars.githubusercontent.com/u/24532065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Luc1412", "html_url": "https://github.com/Luc1412", "followers_url": "https://api.github.com/users/Luc1412/followers", "following_url": "https://api.github.com/users/Luc1412/following{/other_user}", "gists_url": "https://api.github.com/users/Luc1412/gists{/gist_id}", "starred_url": "https://api.github.com/users/Luc1412/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Luc1412/subscriptions", "organizations_url": "https://api.github.com/users/Luc1412/orgs", "repos_url": "https://api.github.com/users/Luc1412/repos", "events_url": "https://api.github.com/users/Luc1412/events{/privacy}", "received_events_url": "https://api.github.com/users/Luc1412/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-07-14T07:13:53Z", "updated_at": "2022-06-13T21:22:40Z", "closed_at": "2022-04-27T05:28:00Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\r\n\r\nThe 3 Link buttons get moved into the Select ActionRow which causes an error\r\n\r\n### Reproduction Steps\r\n\r\n1. Use the following code below and start the view\r\n2. select the 2nd select item multiple times\r\n3. An error will randomly? occur\r\n\r\n### Minimal Reproducible Code\r\n\r\n```python\r\nclass TestView(discord.ui.View):\r\n\r\n    def __init__(self):\r\n        super().__init__()\r\n        help_select = discord.ui.Select(options=[\r\n            discord.SelectOption(label='Home', value='home', emoji='\ud83c\udfe0', default=True),\r\n            discord.SelectOption(label='Name', value='stats', emoji='\ud83d\udcca'),\r\n        ])\r\n        help_select.callback = self.select_page\r\n        self.add_item(help_select)\r\n\r\n        self.add_item(discord.ui.Button(style=discord.ButtonStyle.url, label='Example 1', url=f'https://youtube.com'))\r\n        self.add_item(discord.ui.Button(style=discord.ButtonStyle.url, label='Example 2', url='https://discord.com'))\r\n        self.add_item(discord.ui.Button(style=discord.ButtonStyle.url, label='Example 3', url='https://google.com'))\r\n\r\n    async def select_page(self, interaction: discord.Interaction):\r\n        select: discord.ui.Select = discord.utils.get(self.children, custom_id=interaction.data['custom_id'])\r\n        if not select.values:\r\n            return\r\n        await interaction.message.edit(view=self)\r\n```\r\n\r\n\r\n### Expected Results\r\n\r\nThe components just normally update.\r\n\r\n`to_components()` looks like:\r\n[{'type': 1, 'components': [{'type': 3, 'custom_id': 'f0a5a63f62e6b58e179eadba3014652b', 'min_values': 1, 'max_values': 1, 'options': [{'label': 'Home', 'value': 'home', 'default': True, 'emoji': {'name': '\ud83c\udfe0'}}, {'label': 'Name', 'value': 'stats', 'default': False, 'emoji': {'name': '\ud83d\udcca'}}]}]}, {'type': 1, 'components': [{'type': 2, 'style': 5, 'label': 'Example 1', 'disabled': False, 'url': 'https://youtube.com'}, {'type': 2, 'style': 5, 'label': 'Example 2', 'disabled': False, 'url': 'https://discord.com'}, {'type': 2, 'style': 5, 'label': 'Example 3', 'disabled': False, 'url': 'https://google.com'}]}]\r\n\r\n\r\n### Actual Results\r\n\r\nAn error occurrs:\r\n```py\r\nIgnoring exception in view <TestView timeout=180.0 children=4> for item <Select placeholder=None min_values=1 max_values=1 options=[<SelectOption label='Home' value='home' description=None emoji=<PartialEmoji animated=False name='\ud83c\udfe0' id=None> default=True>, <SelectOption label='Name' value='stats' description=None emoji=<PartialEmoji animated=False name='\ud83d\udcca' id=None> default=False>]>:\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\Lucas Hardt\\Development\\EasySystem\\EasyFnStatsV3\\venv\\lib\\site-packages\\discord\\ui\\view.py\", line 358, in _scheduled_task\r\n    await item.callback(interaction)\r\n  File \"C:\\Users\\Lucas Hardt\\Development\\EasySystem\\EasyFnStatsV3\\utils\\views.py\", line 2516, in select_page\r\n    await interaction.message.edit(view=self)\r\n  File \"C:\\Users\\Lucas Hardt\\Development\\EasySystem\\EasyFnStatsV3\\venv\\lib\\site-packages\\discord\\message.py\", line 1249, in edit\r\n    data = await self._state.http.edit_message(self.channel.id, self.id, **payload)\r\n  File \"C:\\Users\\Lucas Hardt\\Development\\EasySystem\\EasyFnStatsV3\\venv\\lib\\site-packages\\discord\\http.py\", line 337, in request\r\n    raise HTTPException(response, data)\r\ndiscord.errors.HTTPException: 400 Bad Request (error code: 50035): Invalid Form Body\r\nIn components.0.components.1: The specified component exceeds the maximum width\r\nIn components.0.components.2: The specified component exceeds the maximum width\r\nIn components.0.components.3: The specified component exceeds the maximum width\r\n```\r\n`to_components()` looks like:\r\n[{'type': 1, 'components': [{'type': 3, 'custom_id': 'f0a5a63f62e6b58e179eadba3014652b', 'min_values': 1, 'max_values': 1, 'options': [{'label': 'Home', 'value': 'home', 'default': True, 'emoji': {'name': '\ud83c\udfe0'}}, {'label': 'Name', 'value': 'stats', 'default': False, 'emoji': {'name': '\ud83d\udcca'}}]}, {'type': 2, 'style': 5, 'label': 'Example 1', 'disabled': False, 'url': 'https://youtube.com'}, {'type': 2, 'style': 5, 'label': 'Example 2', 'disabled': False, 'url': 'https://discord.com'}, {'type': 2, 'style': 5, 'label': 'Example 3', 'disabled': False, 'url': 'https://google.com'}]}]\r\noccurs\r\n\r\n### Intents\r\n\r\nguilds, members, emojis, webhooks, voice_states, guild_messages, guild_reactions, dm_messages, dm_reactions\r\n\r\n### System Information\r\n\r\n- Python v3.9.0-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a0\r\n- aiohttp v3.7.4.post0\r\n- system info: Windows 10 10.0.22000\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### Additional Context\r\n\r\n_No response_", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7231/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7231/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7171", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7171/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7171/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7171/events", "html_url": "https://github.com/Rapptz/discord.py/issues/7171", "id": 936557338, "node_id": "MDU6SXNzdWU5MzY1NTczMzg=", "number": 7171, "title": "Error accessing the changes attribute to an audit log action", "user": {"login": "FrequencyX4", "id": 44416141, "node_id": "MDQ6VXNlcjQ0NDE2MTQx", "avatar_url": "https://avatars.githubusercontent.com/u/44416141?v=4", "gravatar_id": "", "url": "https://api.github.com/users/FrequencyX4", "html_url": "https://github.com/FrequencyX4", "followers_url": "https://api.github.com/users/FrequencyX4/followers", "following_url": "https://api.github.com/users/FrequencyX4/following{/other_user}", "gists_url": "https://api.github.com/users/FrequencyX4/gists{/gist_id}", "starred_url": "https://api.github.com/users/FrequencyX4/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/FrequencyX4/subscriptions", "organizations_url": "https://api.github.com/users/FrequencyX4/orgs", "repos_url": "https://api.github.com/users/FrequencyX4/repos", "events_url": "https://api.github.com/users/FrequencyX4/events{/privacy}", "received_events_url": "https://api.github.com/users/FrequencyX4/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2021-07-04T23:02:24Z", "updated_at": "2021-07-04T23:13:31Z", "closed_at": "2021-07-04T23:13:31Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nWhen accessing AuditLogAction.changes.name attribute an exception is raised\r\n\r\n### Reproduction Steps\r\n\r\nI was checking if entry.changes.before.name was in another a str object\r\n\r\n### Minimal Reproducible Code\r\n\r\n```python\r\nafter = datetime.now(tz=timezone.utc) - timedelta(hours=12)\r\naction = discord.AuditLogAction.channel_delete\r\nasync for entry in category.guild.audit_logs(after=after, action=action):\r\n    if \"case-\" in entry.changes.before.name and str(case) in entry.changes.before.name:\r\n        # this lines unreachable due to the error\r\n```\r\n\r\n\r\n### Expected Results\r\n\r\nGet the entry.changes.name without error\r\n\r\n### Actual Results\r\n\r\nThe following traceback:\r\n\r\nFile \"/home/luck/.local/lib/python3.8/site-packages/discord/ext/commands/core.py\", line 125, in wrapped\r\n    ret = await coro(*args, **kwargs)\r\n\r\nFile \"/mnt/drive1/Fate/cogs/moderation/modmail.py\", line 272, in reply\r\n    if \"case-\" in entry.changes.before.name and str(case) in entry.changes.before.name:\r\n\r\nFile \"/home/luck/.local/lib/python3.8/site-packages/discord/utils.py\", line 106, in get\r\n    value = self.function(instance)\r\n\r\nFile \"/home/luck/.local/lib/python3.8/site-packages/discord/audit_logs.py\", line 453, in changes\r\n    obj = AuditLogChanges(self, self._changes)\r\n\r\nFile \"/home/luck/.local/lib/python3.8/site-packages/discord/audit_logs.py\", line 234, in init\r\n    before = transformer(entry, before)\r\n\r\nFile \"/home/luck/.local/lib/python3.8/site-packages/discord/audit_logs.py\", line 95, in _transform_overwrites\r\n    allow = Permissions(elem['allow'])\r\n\r\nFile \"/home/luck/.local/lib/python3.8/site-packages/discord/permissions.py\", line 104, in __init__\r\n    raise TypeError(f'Expected int parameter, received {permissions.__class__.__name__} instead.')\r\n\r\nTypeError: Expected int parameter, received str instead.\r\n\r\n\r\n### Intents\r\n\r\nall\r\n\r\n### System Information\r\n\r\n- Python v3.8.10-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a3365+g750ba88f\r\n- aiohttp v3.6.3\r\n- system info: Linux 5.8.0-55-generic #62~20.04.1-Ubuntu SMP Wed Jun 2 08:55:04 UTC 2021\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### Additional Context\r\n\r\n_No response_", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7171/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7171/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7159", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7159/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7159/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7159/events", "html_url": "https://github.com/Rapptz/discord.py/issues/7159", "id": 936268837, "node_id": "MDU6SXNzdWU5MzYyNjg4Mzc=", "number": 7159, "title": "Error when importing Discord", "user": {"login": "AomiVel", "id": 69065737, "node_id": "MDQ6VXNlcjY5MDY1NzM3", "avatar_url": "https://avatars.githubusercontent.com/u/69065737?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AomiVel", "html_url": "https://github.com/AomiVel", "followers_url": "https://api.github.com/users/AomiVel/followers", "following_url": "https://api.github.com/users/AomiVel/following{/other_user}", "gists_url": "https://api.github.com/users/AomiVel/gists{/gist_id}", "starred_url": "https://api.github.com/users/AomiVel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AomiVel/subscriptions", "organizations_url": "https://api.github.com/users/AomiVel/orgs", "repos_url": "https://api.github.com/users/AomiVel/repos", "events_url": "https://api.github.com/users/AomiVel/events{/privacy}", "received_events_url": "https://api.github.com/users/AomiVel/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-07-03T14:47:10Z", "updated_at": "2021-07-03T14:53:40Z", "closed_at": "2021-07-03T14:53:40Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\r\n\r\nError when importing Discord\r\n\r\n### Reproduction Steps\r\n\r\n```py\r\nimport discord\r\n```\r\n\r\n### Minimal Reproducible Code\r\n\r\n```python\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\<username>\\AppData\\Local\\Programs\\Python\\Python39\\lib\\runpy.py\", line 188, in _run_module_as_main\r\n    mod_name, mod_spec, code = _get_module_details(mod_name, _Error)\r\n  File \"C:\\Users\\<username>\\AppData\\Local\\Programs\\Python\\Python39\\lib\\runpy.py\", line 147, in _get_module_details\r\n    return _get_module_details(pkg_main_name, error)\r\n  File \"C:\\Users\\<username>\\AppData\\Local\\Programs\\Python\\Python39\\lib\\runpy.py\", line 111, in _get_module_details\r\n    __import__(pkg_name)\r\n  File \"C:\\Users\\<username>\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\discord\\__init__.py\", line 23, in <module>\r\n    from .client import *\r\n  File \"C:\\Users\\<username>\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\discord\\client.py\", line 36, in <module>\r\n    from .user import User\r\n  File \"C:\\Users\\<username>\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\discord\\user.py\", line 26, in <module>\r\n    import discord.abc\r\n  File \"C:\\Users\\<username>\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\discord\\abc.py\", line 45, in <module>\r\n    from .iterators import HistoryIterator\r\n  File \"C:\\Users\\<username>\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\discord\\iterators.py\", line 34, in <module>\r\n    from .audit_logs import AuditLogEntry\r\n  File \"C:\\Users\\<username>\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\discord\\audit_logs.py\", line 35, in <module>\r\n    from .permissions import PermissionOverwrite, Permissions\r\n  File \"C:\\Users\\<username>\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\discord\\permissions.py\", line 28, in <module>\r\n    from .flags import BaseFlags, flag_value, fill_with_flags, alias_flag_value\r\n  File \"C:\\Users\\<username>\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\discord\\flags.py\", line 293, in <module>\r\n    class PublicUserFlags(BaseFlags):\r\n  File \"C:\\Users\\<username>\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\discord\\flags.py\", line 391, in PublicUserFlags\r\n    def early_verified_bot_developer(self):\r\n  File \"C:\\Users\\<username>\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\discord\\flags.py\", line 49, in __init__\r\n    self.__doc__ = func.__doc__\r\nAttributeError: 'alias_flag_value' object attribute '__doc__' is read-only\r\n```\r\n\r\n\r\n### Expected Results\r\n\r\nI don't get this error.\r\n\r\n### Actual Results\r\n\r\nWhen I try to import discord, raised this error.\r\n\r\n### Intents\r\n\r\nNone\r\n\r\n### System Information\r\n\r\nI can't import discord so can't show this information\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### Additional Context\r\n\r\n_No response_", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7159/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7159/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7147", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7147/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7147/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7147/events", "html_url": "https://github.com/Rapptz/discord.py/issues/7147", "id": 934744919, "node_id": "MDU6SXNzdWU5MzQ3NDQ5MTk=", "number": 7147, "title": "TextChannelConverter appears broken for DMs in 2.0a", "user": {"login": "mirnovov", "id": 73574818, "node_id": "MDQ6VXNlcjczNTc0ODE4", "avatar_url": "https://avatars.githubusercontent.com/u/73574818?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mirnovov", "html_url": "https://github.com/mirnovov", "followers_url": "https://api.github.com/users/mirnovov/followers", "following_url": "https://api.github.com/users/mirnovov/following{/other_user}", "gists_url": "https://api.github.com/users/mirnovov/gists{/gist_id}", "starred_url": "https://api.github.com/users/mirnovov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mirnovov/subscriptions", "organizations_url": "https://api.github.com/users/mirnovov/orgs", "repos_url": "https://api.github.com/users/mirnovov/repos", "events_url": "https://api.github.com/users/mirnovov/events{/privacy}", "received_events_url": "https://api.github.com/users/mirnovov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-07-01T11:33:17Z", "updated_at": "2021-07-01T11:47:19Z", "closed_at": "2021-07-01T11:47:06Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\r\n\r\nWhen using TextChannelConverter in DMs, it produces an error in 2.0a. \r\n\r\n### Reproduction Steps\r\n\r\nI first discovered this apparent issue when working on my own bot, and then reproduced it using the sample code below.\r\n\r\n1. Run the sample code\r\n2. In the bot's DMs, use the `test` command with a channel name as an parameter. Of course, this must be a channel otherwise visible to the bot.\r\n\r\n### Minimal Reproducible Code\r\n\r\n```python\r\nimport discord, logging\r\nfrom discord.ext import commands\r\n\r\ntoken = \"token_goes_here\"\r\nbot = commands.Bot(command_prefix = \"!\")\r\n\r\nlogging.basicConfig(level = logging.INFO)\r\n\r\n@bot.command()\t\r\nasync def test(ctx, channel : discord.TextChannel):\r\n\tawait ctx.send(f\"{channel.name} {channel.id}\")\r\n\t\r\nif __name__ == \"__main__\":\r\n\tlogging.warning(f\"discord.py version: {discord.__version__}\")\r\n\tbot.run(token)\r\n```\r\n\r\n\r\n### Expected Results\r\n\r\nFor the example code to produce the channel name and id. This occurs when the same code is run on discord.py version 1.7.2.\r\n\r\nI have searched the 2.0 roadmap for changes in this department and failed to find any that would cause such an issue. If there's any that I've missed, apologies. At the very least, it should handle the fact that it's in a DM in a cleaner manner.\r\n\r\n### Actual Results\r\n\r\nAn exception was produced, and the code failed to continue executing:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/lib/python3.9/site-packages/discord/ext/commands/converter.py\", line 970, in _actual_conversion\r\n    return await converter().convert(ctx, argument)\r\n  File \"/lib/python3.9/site-packages/discord/ext/commands/converter.py\", line 446, in convert\r\n    return GuildChannelConverter._resolve_channel(ctx, argument, ctx.guild.text_channels, discord.TextChannel)\r\nAttributeError: 'NoneType' object has no attribute 'text_channels'\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"/lib/python3.9/site-packages/discord/ext/commands/bot.py\", line 960, in invoke\r\n    await ctx.command.invoke(ctx)\r\n  File \"/lib/python3.9/site-packages/discord/ext/commands/core.py\", line 817, in invoke\r\n    await self.prepare(ctx)\r\n  File \"/lib/python3.9/site-packages/discord/ext/commands/core.py\", line 751, in prepare\r\n    await self._parse_arguments(ctx)\r\n  File \"/lib/python3.9/site-packages/discord/ext/commands/core.py\", line 658, in _parse_arguments\r\n    transformed = await self.transform(ctx, param)\r\n  File \"/lib/python3.9/site-packages/discord/ext/commands/core.py\", line 511, in transform\r\n    return await run_converters(ctx, converter, argument, param)\r\n  File \"/lib/python3.9/site-packages/discord/ext/commands/converter.py\", line 1076, in run_converters\r\n    return await _actual_conversion(ctx, converter, argument, param)\r\n  File \"/lib/python3.9/site-packages/discord/ext/commands/converter.py\", line 976, in _actual_conversion\r\n    raise ConversionError(converter, exc) from exc\r\ndiscord.ext.commands.errors.ConversionError: (<class 'discord.ext.commands.converter.TextChannelConverter'>, AttributeError(\"'NoneType' object has no attribute 'text_channels'\"))\r\n```\r\nNote that I have stripped identifying information from the file paths above. Other than that, the traceback is exactly as reported. From it; I suspect that the bot is attempting to grab the current guild regardless of whether it is in a DM.\r\n\r\n### Intents\r\n\r\ndefault; see example\r\n\r\n### System Information\r\n\r\n```\r\n- Python v3.9.5-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a3324+g12e3eba0\r\n- aiohttp v3.7.4.post0\r\n- system info: Darwin 20.5.0 Darwin Kernel Version 20.5.0: Sat May  8 05:10:33 PDT 2021; root:xnu-7195.121.3~9/RELEASE_X86_64\r\n```\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### Additional Context\r\n\r\nIf I didn't miss something obvious, this regression appears to have been introduced as part of commit 353737239a61444c0b7ca89144602bbbcf4906b6 (`[commands] Minimise code duplication in channel converters`).", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7147/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7147/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7116", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7116/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7116/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7116/events", "html_url": "https://github.com/Rapptz/discord.py/issues/7116", "id": 930854578, "node_id": "MDU6SXNzdWU5MzA4NTQ1Nzg=", "number": 7116, "title": "crash bug", "user": {"login": "FrequencyX4", "id": 44416141, "node_id": "MDQ6VXNlcjQ0NDE2MTQx", "avatar_url": "https://avatars.githubusercontent.com/u/44416141?v=4", "gravatar_id": "", "url": "https://api.github.com/users/FrequencyX4", "html_url": "https://github.com/FrequencyX4", "followers_url": "https://api.github.com/users/FrequencyX4/followers", "following_url": "https://api.github.com/users/FrequencyX4/following{/other_user}", "gists_url": "https://api.github.com/users/FrequencyX4/gists{/gist_id}", "starred_url": "https://api.github.com/users/FrequencyX4/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/FrequencyX4/subscriptions", "organizations_url": "https://api.github.com/users/FrequencyX4/orgs", "repos_url": "https://api.github.com/users/FrequencyX4/repos", "events_url": "https://api.github.com/users/FrequencyX4/events{/privacy}", "received_events_url": "https://api.github.com/users/FrequencyX4/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-06-27T05:38:54Z", "updated_at": "2021-06-28T03:46:15Z", "closed_at": "2021-06-28T03:46:15Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nlarger bots crash every 20 or so minutes due to an error\r\n\r\n### Reproduction Steps\r\n\r\nrun any code in a larger bot and leave it running for awhile\r\n\r\n### Minimal Reproducible Code\r\n\r\n```python\r\nnone, i believe its just a typehint issue in the lib\r\n```\r\n\r\n\r\n### Expected Results\r\n\r\nthe bot to run forever\r\n\r\n### Actual Results\r\n\r\nthe whole bot crashes with the following traceback\r\n\r\n  File \"fate.py\", line 533, in <module>\r\n    bot.run()\r\n  File \"fate.py\", line 371, in run\r\n    super().run(self.auth[\"tokens\"][self.config[\"token_id\"]])\r\n  File \"discord/client.py\", line 625, in run\r\n    return future.result()\r\n  File \"discord/client.py\", line 604, in runner\r\n    await self.start(*args, **kwargs)\r\n  File \"discord/client.py\", line 568, in start\r\n    await self.connect(reconnect=reconnect)\r\n  File \"discord/shard.py\", line 412, in connect\r\n    raise item.error\r\n  File \"discord/shard.py\", line 154, in worker\r\n    await self.ws.poll_event()\r\n  File \"discord/gateway.py\", line 553, in poll_event\r\n    await self.received_message(msg.data)\r\n  File \"discord/gateway.py\", line 503, in received_message\r\n    func(data)\r\n  File \"discord/state.py\", line 1106, in parse_integration_update\r\n    integration = cls(data=data, guild=guild)\r\n  File \"discord/integrations.py\", line 115, in __init__\r\n    self._from_data(data)\r\n  File \"discord/integrations.py\", line 199, in _from_data\r\n    self._role_id: int = int(data['role_id'])\r\nTypeError: int() argument must be a string, a bytes-like object or a number, not 'NoneType'\r\n\r\n### Intents\r\n\r\nall\r\n\r\n### System Information\r\n\r\n- Python v3.8.5-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a3267+gd30fea5b\r\n- aiohttp v3.6.3\r\n- system info: Linux 5.8.0-55-generic #62~20.04.1-Ubuntu SMP Wed Jun 2 08:55:04 UTC 2021\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### Additional Context\r\n\r\n_No response_", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7116/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7116/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7103", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7103/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7103/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7103/events", "html_url": "https://github.com/Rapptz/discord.py/issues/7103", "id": 929360065, "node_id": "MDU6SXNzdWU5MjkzNjAwNjU=", "number": 7103, "title": "`guild.vanity_invite()` raises error even with correct permissions", "user": {"login": "scrazzz", "id": 70033559, "node_id": "MDQ6VXNlcjcwMDMzNTU5", "avatar_url": "https://avatars.githubusercontent.com/u/70033559?v=4", "gravatar_id": "", "url": "https://api.github.com/users/scrazzz", "html_url": "https://github.com/scrazzz", "followers_url": "https://api.github.com/users/scrazzz/followers", "following_url": "https://api.github.com/users/scrazzz/following{/other_user}", "gists_url": "https://api.github.com/users/scrazzz/gists{/gist_id}", "starred_url": "https://api.github.com/users/scrazzz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/scrazzz/subscriptions", "organizations_url": "https://api.github.com/users/scrazzz/orgs", "repos_url": "https://api.github.com/users/scrazzz/repos", "events_url": "https://api.github.com/users/scrazzz/events{/privacy}", "received_events_url": "https://api.github.com/users/scrazzz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2021-06-24T15:40:48Z", "updated_at": "2021-06-28T05:09:27Z", "closed_at": "2021-06-28T05:09:27Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\n\n`guild.vanity_invite()` raises error even when the bot has admin perms.\n\n### Reproduction Steps\n\nI made a command that returns the guild's vanity invite.\n\n### Minimal Reproducible Code\n\n```python\n@bot.command()\r\nasync def foo(ctx):\r\n    print(True if ctx.guild.me.guild_permissions.administrator else False)\r\n    inv = await ctx.guild.vanity_invite()\r\n    await ctx.send(inv)\n```\n\n\n### Expected Results\n\nI expected it to not error.\n\n### Actual Results\n\nIt errors. This is the output of the command below.\r\n```py\r\nTrue\r\nIgnoring exception in on_command_error\r\nTraceback (most recent call last):\r\n  File \"/python3/lib/python3.8/site-packages/discord/ext/commands/core.py\", line 85, in wrapped\r\n    ret = await coro(*args, **kwargs)\r\n  File \"main.py\", line 46, in foo\r\n    inv = await ctx.guild.vanity_invite()\r\n  File \"/python3/lib/python3.8/site-packages/discord/guild.py\", line 2078, in vanity_invite\r\n    payload = await self._state.http.get_vanity_code(self.id)\r\n  File \"/python3/lib/python3.8/site-packages/discord/http.py\", line 248, in request\r\n    raise Forbidden(r, data)\r\ndiscord.errors.Forbidden: 403 Forbidden (error code: 50001): Missing Access\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"/python3/lib/python3.8/site-packages/discord/client.py\", line 343, in _run_event\r\n    await coro(*args, **kwargs)\r\n  File \"main.py\", line 82, in on_command_error\r\n    raise error\r\n  File \"/python3/lib/python3.8/site-packages/discord/ext/commands/bot.py\", line 939, in invoke\r\n    await ctx.command.invoke(ctx)\r\n  File \"/python3/lib/python3.8/site-packages/discord/ext/commands/core.py\", line 863, in invoke\r\n    await injected(*ctx.args, **ctx.kwargs)\r\n  File \"/python3/lib/python3.8/site-packages/discord/ext/commands/core.py\", line 94, in wrapped\r\n    raise CommandInvokeError(exc) from exc\r\ndiscord.ext.commands.errors.CommandInvokeError: Command raised an exception: Forbidden: 403 Forbidden (error code: 50001): Missing Access\r\n```\n\n### Intents\n\nall\n\n### System Information\n\n- Python v3.8.10-final\r\n- discord.py v1.7.3-final\r\n- aiohttp v3.7.4.post0\r\n- system info: Linux\n\n### Checklist\n\n- [X] I have searched the open issues for duplicates.\n- [X] I have shown the entire traceback, if possible.\n- [X] I have removed my token from display, if visible.\n\n### Additional Context\n\nN/A", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7103/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7103/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7047", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7047/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7047/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7047/events", "html_url": "https://github.com/Rapptz/discord.py/issues/7047", "id": 918388045, "node_id": "MDU6SXNzdWU5MTgzODgwNDU=", "number": 7047, "title": "Bot crashes with ValueError (integrations)", "user": {"login": "FightMan01", "id": 29693718, "node_id": "MDQ6VXNlcjI5NjkzNzE4", "avatar_url": "https://avatars.githubusercontent.com/u/29693718?v=4", "gravatar_id": "", "url": "https://api.github.com/users/FightMan01", "html_url": "https://github.com/FightMan01", "followers_url": "https://api.github.com/users/FightMan01/followers", "following_url": "https://api.github.com/users/FightMan01/following{/other_user}", "gists_url": "https://api.github.com/users/FightMan01/gists{/gist_id}", "starred_url": "https://api.github.com/users/FightMan01/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/FightMan01/subscriptions", "organizations_url": "https://api.github.com/users/FightMan01/orgs", "repos_url": "https://api.github.com/users/FightMan01/repos", "events_url": "https://api.github.com/users/FightMan01/events{/privacy}", "received_events_url": "https://api.github.com/users/FightMan01/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 2851939991, "node_id": "MDU6TGFiZWwyODUxOTM5OTkx", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/unconfirmed%20bug", "name": "unconfirmed bug", "color": "d4c5f9", "default": false, "description": "A bug report that needs triaging"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-06-11T08:06:36Z", "updated_at": "2021-06-17T10:38:03Z", "closed_at": "2021-06-11T08:25:23Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nBot crashes (i don't know the whole context)\r\n\r\n### Reproduction Steps\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"bot.py\", line 2754, in <module>\r\n    csatlakoz()\r\n  File \"bot.py\", line 2700, in csatlakoz\r\n    loop.run_until_complete(client.start(\"token\"))\r\n  File \"/usr/lib/python3.8/asyncio/base_events.py\", line 616, in run_until_complete\r\n    return future.result()\r\n  File \"/home/fightman/.local/lib/python3.8/site-packages/discord/client.py\", line 568, in start\r\n    await self.connect(reconnect=reconnect)\r\n  File \"/home/fightman/.local/lib/python3.8/site-packages/discord/shard.py\", line 412, in connect\r\n    raise item.error\r\n  File \"/home/fightman/.local/lib/python3.8/site-packages/discord/shard.py\", line 154, in worker\r\n    await self.ws.poll_event()\r\n  File \"/home/fightman/.local/lib/python3.8/site-packages/discord/gateway.py\", line 553, in poll_event\r\n    await self.received_message(msg.data)\r\n  File \"/home/fightman/.local/lib/python3.8/site-packages/discord/gateway.py\", line 503, in received_message\r\n    func(data)\r\n  File \"/home/fightman/.local/lib/python3.8/site-packages/discord/state.py\", line 1106, in parse_integration_update\r\n    integration = cls(data=data, guild=guild)\r\n  File \"/home/fightman/.local/lib/python3.8/site-packages/discord/integrations.py\", line 115, in __init__\r\n    self._from_data(data)\r\n  File \"/home/fightman/.local/lib/python3.8/site-packages/discord/integrations.py\", line 194, in _from_data\r\n    super()._from_data(data)\r\n  File \"/home/fightman/.local/lib/python3.8/site-packages/discord/integrations.py\", line 124, in _from_data\r\n    self.account: IntegrationAccount = IntegrationAccount(data['account'])\r\n  File \"/home/fightman/.local/lib/python3.8/site-packages/discord/integrations.py\", line 71, in __init__\r\n    self.id: Optional[int] = _get_as_snowflake(data, 'id')\r\n  File \"/home/fightman/.local/lib/python3.8/site-packages/discord/utils.py\", line 440, in _get_as_snowflake\r\n    return value and int(value)\r\nValueError: invalid literal for int() with base 10: 'UCIVh3L4yJWs2CLgxnXxciqw'\r\n```\r\n\r\n### Minimal Reproducible Code\r\n\r\n_No response_\r\n\r\n### Expected Results\r\n\r\nError will be handled.\r\n\r\n### Actual Results\r\n\r\nBot crashes\r\n\r\n### Intents\r\n\r\nall\r\n\r\n### System Information\r\n\r\n- Python v3.8.5-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a3261+g04573c3c\r\n- aiohttp v3.6.2\r\n- system info: Linux 5.4.0-74-generic #83-Ubuntu SMP Sat May 8 02:35:39 UTC 2021\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### Additional Context\r\n\r\n_No response_", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7047/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7047/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7031", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7031/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7031/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7031/events", "html_url": "https://github.com/Rapptz/discord.py/issues/7031", "id": 915165063, "node_id": "MDU6SXNzdWU5MTUxNjUwNjM=", "number": 7031, "title": "await me.edit() results in a error('channel_id': self.voice.channel.id, AttributeError: 'NoneType' object has no attribute 'channel')", "user": {"login": "Minlor", "id": 40441731, "node_id": "MDQ6VXNlcjQwNDQxNzMx", "avatar_url": "https://avatars.githubusercontent.com/u/40441731?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Minlor", "html_url": "https://github.com/Minlor", "followers_url": "https://api.github.com/users/Minlor/followers", "following_url": "https://api.github.com/users/Minlor/following{/other_user}", "gists_url": "https://api.github.com/users/Minlor/gists{/gist_id}", "starred_url": "https://api.github.com/users/Minlor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Minlor/subscriptions", "organizations_url": "https://api.github.com/users/Minlor/orgs", "repos_url": "https://api.github.com/users/Minlor/repos", "events_url": "https://api.github.com/users/Minlor/events{/privacy}", "received_events_url": "https://api.github.com/users/Minlor/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-06-08T15:16:41Z", "updated_at": "2022-08-17T14:54:36Z", "closed_at": "2022-08-17T14:54:36Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\n\nEditing a fetched member results in a error\n\n### Reproduction Steps\n\n* Join a stage channel\r\n* Try to fetch a member in the channel and then try to unsupress them\n\n### Minimal Reproducible Code\n\n```python\nguild = await self.Aivo.fetch_guild(guildid)\r\nme = await guild.fetch_member(self.Aivo.user.id)\r\nawait me.edit(suppress = False)\n```\n\n\n### Expected Results\n\nIt should unsupress the member with the id\n\n### Actual Results\n\n```\r\n Unhandled exception in internal background task 'join_vc'.\r\n Traceback (most recent call last):\r\n   File \"/usr/local/lib/python3.9/dist-packages/discord/ext/tasks/__init__.py\", line 101, in _loop\r\n     await self.coro(*args, **kwargs)\r\n   File \"/root/Azure/Cogs/Music.py\", line 51, in join_vc\r\n     await me.edit(suppress = False) # THIS NU WORK\r\n   File \"/usr/local/lib/python3.9/dist-packages/discord/member.py\", line 652, in edit\r\n     'channel_id': self.voice.channel.id,\r\n AttributeError: 'NoneType' object has no attribute 'channel'\r\n```\n\n### Intents\n\nAll intents enabled\n\n### System Information\n\n- Python v3.9.5-final\r\n- discord.py v1.7.2-final\r\n- aiohttp v3.6.3\r\n- system info: Linux 5.11.0-16-generic #17-Ubuntu SMP Wed Apr 14 20:12:43 UTC 2021\n\n### Checklist\n\n- [X] I have searched the open issues for duplicates.\n- [X] I have shown the entire traceback, if possible.\n- [X] I have removed my token from display, if visible.\n\n### Additional Context\n\n_No response_", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/7031/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/7031/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6979", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6979/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6979/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6979/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6979", "id": 905345549, "node_id": "MDU6SXNzdWU5MDUzNDU1NDk=", "number": 6979, "title": "'View' object has no attribute '_timeout_handler'", "user": {"login": "itzFlubby", "id": 20861978, "node_id": "MDQ6VXNlcjIwODYxOTc4", "avatar_url": "https://avatars.githubusercontent.com/u/20861978?v=4", "gravatar_id": "", "url": "https://api.github.com/users/itzFlubby", "html_url": "https://github.com/itzFlubby", "followers_url": "https://api.github.com/users/itzFlubby/followers", "following_url": "https://api.github.com/users/itzFlubby/following{/other_user}", "gists_url": "https://api.github.com/users/itzFlubby/gists{/gist_id}", "starred_url": "https://api.github.com/users/itzFlubby/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/itzFlubby/subscriptions", "organizations_url": "https://api.github.com/users/itzFlubby/orgs", "repos_url": "https://api.github.com/users/itzFlubby/repos", "events_url": "https://api.github.com/users/itzFlubby/events{/privacy}", "received_events_url": "https://api.github.com/users/itzFlubby/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-05-28T12:48:26Z", "updated_at": "2021-05-28T12:55:56Z", "closed_at": "2021-05-28T12:55:26Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\n\nView object is missing attributes in __slots__\n\n### Reproduction Steps\n\n1. Create View-object\r\n2. Encounter bug\n\n### Minimal Reproducible Code\n\n```python\n@client.event\r\nasync def on_message(message):\r\n    view = discord.ui.View(timeout = None)\n```\n\n\n### Expected Results\n\nConstruction of discord.ui.View object\n\n### Actual Results\n\n```\r\nTraceback (most recent call last):\r\n  File \"bot.py\", line 148, in on_message\r\n    await getattr(module.module, command)(client, message, botData)\r\n  File \"\\modules\\dev.py\", line 96, in devtest\r\n    view = discord.ui.View(timeout = None)\r\n  File \"C:\\Users\\itzFlubby\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\discord\\ui\\view.py\", line 126, in __init__\r\n    self._timeout_handler: Optional[asyncio.TimerHandle] = None\r\nAttributeError: 'View' object has no attribute '_timeout_handler'\r\n```\n\n### Intents\n\n32511\n\n### System Information\n\n- Python v3.9.5-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a0\r\n- aiohttp v3.7.4.post0\r\n- system info: Windows 10 10.0.19041\n\n### Checklist\n\n- [X] I have searched the open issues for duplicates.\n- [X] I have shown the entire traceback, if possible.\n- [X] I have removed my token from display, if visible.\n\n### Additional Context\n\nBugfix is to add the missing attributes to `__slots__` in `/ui/view.py`\r\n\r\n```\r\n    __slots__ = (\r\n        'timeout',\r\n        'children',\r\n        'id',\r\n        '_cancel_callback',\r\n        '_timeout_handler',\r\n        '_stopped',\r\n    )\r\n```", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6979/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6979/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6851", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6851/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6851/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6851/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6851", "id": 875813492, "node_id": "MDU6SXNzdWU4NzU4MTM0OTI=", "number": 6851, "title": "AuditLogEntry.target with action being MESSAGE_BULK_DELETE always returns None.", "user": {"login": "Killerakoz", "id": 63569424, "node_id": "MDQ6VXNlcjYzNTY5NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/63569424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Killerakoz", "html_url": "https://github.com/Killerakoz", "followers_url": "https://api.github.com/users/Killerakoz/followers", "following_url": "https://api.github.com/users/Killerakoz/following{/other_user}", "gists_url": "https://api.github.com/users/Killerakoz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Killerakoz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Killerakoz/subscriptions", "organizations_url": "https://api.github.com/users/Killerakoz/orgs", "repos_url": "https://api.github.com/users/Killerakoz/repos", "events_url": "https://api.github.com/users/Killerakoz/events{/privacy}", "received_events_url": "https://api.github.com/users/Killerakoz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-05-04T20:33:20Z", "updated_at": "2021-05-05T21:11:43Z", "closed_at": "2021-05-05T02:04:04Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nSo when I try to fetch the AuditLogEntry.target from AuditLogEntry with action being MESSAGE_BULK_DELETE it always returns None when it should be returning either a channel object or an ID if the channel is deleted.\r\n\r\n### Reproduction Steps\r\n\r\nI tried fetching the latest audit log for action bulk message delete with a check of user being my bot.\r\n\r\n### Minimal Reproducible Code\r\n\r\n```python\r\nlog = await bot.get_guild(687435617453473805).audit_logs(action=discord.AuditLogAction.message_bulk_delete).get(user=discord.Object(id=816739493951569940))\r\nprint(f\"**{log.user}** deleted **{log.extra['count']} messages** in **#{log.target}**\")\r\n\r\n>>> Reaper#5820 deleted 3 messages in #None\r\n```\r\n\r\n\r\n### Expected Results\r\n\r\nI expected log.target to return the channel object or the channel ID if the channel was deleted.\r\n\r\n### Actual Results\r\n\r\nIt returned None.\r\n\r\n### Intents\r\n\r\ndiscord.Intents.all()\r\n\r\n### System Information\r\n\r\n- Python v3.8.5-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a2857+g54288879\r\n- aiohttp v3.7.4.post0\r\n- system info: Linux 5.4.0-67-generic #75-Ubuntu SMP Fri Feb 19 18:03:38 UTC 2021\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### Additional Context\r\n\r\n_No response_", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6851/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6851/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6825", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6825/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6825/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6825/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6825", "id": 873535215, "node_id": "MDU6SXNzdWU4NzM1MzUyMTU=", "number": 6825, "title": "SyncWebhook fails to send if files are attached", "user": {"login": "Gorialis", "id": 8049998, "node_id": "MDQ6VXNlcjgwNDk5OTg=", "avatar_url": "https://avatars.githubusercontent.com/u/8049998?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Gorialis", "html_url": "https://github.com/Gorialis", "followers_url": "https://api.github.com/users/Gorialis/followers", "following_url": "https://api.github.com/users/Gorialis/following{/other_user}", "gists_url": "https://api.github.com/users/Gorialis/gists{/gist_id}", "starred_url": "https://api.github.com/users/Gorialis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Gorialis/subscriptions", "organizations_url": "https://api.github.com/users/Gorialis/orgs", "repos_url": "https://api.github.com/users/Gorialis/repos", "events_url": "https://api.github.com/users/Gorialis/events{/privacy}", "received_events_url": "https://api.github.com/users/Gorialis/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-05-01T04:51:16Z", "updated_at": "2021-05-01T13:29:00Z", "closed_at": "2021-05-01T13:25:24Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\n\nTrying to send a file or files using SyncWebhook fails to handle the multipart data processing correctly.\n\n### Reproduction Steps\n\nUse `SyncWebhook.send` on an instance, passing either `file` or `files` (they both get rolled into the same thing internally)\n\n### Minimal Reproducible Code\n\n```python\nimport io\r\n\r\nimport discord\r\n\r\n# A valid webhook URL (any other construction of SyncWebhook will work as well)\r\nwebhook_url = \"https://discordapp.com/api/webhooks/123456789012345678/...\"\r\nwebhook = discord.SyncWebhook.from_url(webhook_url)\r\n\r\n# Works\r\nwebhook.send(content=\"Hello\")\r\n\r\n# Doesn't work\r\nwebhook.send(file=discord.File(fp=io.BytesIO(\"Hello\".encode(\"utf-8\")), filename=\"test.txt\"))\n```\n\n\n### Expected Results\n\nThe file(s) to be sent.\n\n### Actual Results\n\n```py\r\n  File \"/usr/local/lib/python3.9/site-packages/discord/webhook/sync.py\", line 864, in send\r\n    data = adapter.execute_webhook(\r\n  File \"/usr/local/lib/python3.9/site-packages/discord/webhook/sync.py\", line 262, in execute_webhook\r\n    return self.request(route, session, payload=payload, multipart=multipart, files=files, params=params)\r\n  File \"/usr/local/lib/python3.9/site-packages/discord/webhook/sync.py\", line 142, in request\r\n    form_data[p['name']] = (p['filename'], p['value'], p['content_type'])\r\nKeyError: 'filename'\r\n```\n\n### Intents\n\nNot applicable - this is a webhook.\n\n### System Information\n\n- Python v3.9.4-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a3060+g66b17f5a\r\n- aiohttp v3.7.4.post0\r\n- system info: Linux 5.11.15-arch1-2 #1 SMP PREEMPT Sat, 17 Apr 2021 00:22:30 +0000\n\n### Checklist\n\n- [X] I have searched the open issues for duplicates.\n- [X] I have shown the entire traceback, if possible.\n- [X] I have removed my token from display, if visible.\n\n### Additional Context\n\nThis is most likely caused by `handle_message_parameters` adding a multipart field without a filename:\r\nhttps://github.com/Rapptz/discord.py/blob/66b17f5afbbde2bbe867b70d4333d77e528d758c/discord/webhook/async_.py#L397\r\n\r\nAsyncWebhook uses aiohttp.FormData and is unlikely to be affected, but I haven't actually tried.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6825/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6825/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6794", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6794/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6794/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6794/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6794", "id": 867896024, "node_id": "MDU6SXNzdWU4Njc4OTYwMjQ=", "number": 6794, "title": "[Interactions, v2.0] Interaction done in DMs causes a ValueError trying to fetch guild", "user": {"login": "stxticOVFL", "id": 29069561, "node_id": "MDQ6VXNlcjI5MDY5NTYx", "avatar_url": "https://avatars.githubusercontent.com/u/29069561?v=4", "gravatar_id": "", "url": "https://api.github.com/users/stxticOVFL", "html_url": "https://github.com/stxticOVFL", "followers_url": "https://api.github.com/users/stxticOVFL/followers", "following_url": "https://api.github.com/users/stxticOVFL/following{/other_user}", "gists_url": "https://api.github.com/users/stxticOVFL/gists{/gist_id}", "starred_url": "https://api.github.com/users/stxticOVFL/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/stxticOVFL/subscriptions", "organizations_url": "https://api.github.com/users/stxticOVFL/orgs", "repos_url": "https://api.github.com/users/stxticOVFL/repos", "events_url": "https://api.github.com/users/stxticOVFL/events{/privacy}", "received_events_url": "https://api.github.com/users/stxticOVFL/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-04-26T16:28:26Z", "updated_at": "2021-04-27T01:52:47Z", "closed_at": "2021-04-27T01:43:38Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nTrying to run an Interaction in DMs will throw a ValueError\r\n\r\n### Reproduction Steps\r\n\r\n1. Add slash commands to a bot\r\n2. Create a dummy `on_interaction` event\r\n3. Try to run a slash command in DMs\r\n\r\n### Minimal Reproducible Code\r\n\r\n```python\r\n#bot bot, token t\r\n@bot.event\r\nasync def on_interaction(interaction):\r\n    pass\r\n\r\nbot.run(t)\r\n```\r\n\r\n\r\n### Expected Results\r\n\r\nNothing should happen due to the `pass`.\r\n\r\n### Actual Results\r\n\r\n`object.py:68` throws a ValueError, coming from `interactions.py:120` because `self.guild` and `self.guild_id` are both `None`.\r\n\r\nTraceback:\r\n```\r\nTraceback (most recent call last):\r\n  File \"bot.py\", line 678, in <module>\r\n    bot.run(t, reconnect=True)\r\n  File \"...\\discord\\client.py\", line 618, in run\r\n    return future.result()\r\n  File \"...\\discord\\client.py\", line 597, in runner\r\n    await self.start(*args, **kwargs)\r\n  File \"...discord\\client.py\", line 561, in start\r\n    await self.connect(reconnect=reconnect)\r\n  File \"...\\discord\\client.py\", line 467, in connect\r\n    await self.ws.poll_event()\r\n  File \"...\\discord\\gateway.py\", line 553, in poll_event\r\n    await self.received_message(msg.data)\r\n  File \"...\\discord\\gateway.py\", line 503, in received_message\r\n    func(data)\r\n  File \"...\\discord\\state.py\", line 591, in parse_interaction_create\r\n    interaction = Interaction(data=data, state=self)\r\n  File \"...\\discord\\interactions.py\", line 96, in __init__\r\n    self._from_data(data)\r\n  File \"...\\discord\\interactions.py\", line 120, in _from_data\r\n    guild = self.guild or Object(id=self.guild_id)\r\n  File \"...\\discord\\object.py\", line 68, in __init__\r\n    id = int(id)\r\nTypeError: int() argument must be a string, a bytes-like object or a number, not 'NoneType'\r\n```\r\n\r\n### Intents\r\n\r\nDefault, members, and presences \r\n\r\n### System Information\r\n\r\n- Python v3.8.5-final\r\n- discord.py v2.0.0-alpha\r\n    - discord.py pkg_resources: v2.0.0a3043+g184492af\r\n- aiohttp v3.6.2\r\n- system info: Windows 10 10.0.19041\r\n- I'm also on the `interactions` branch.\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### Additional Context\r\n\r\n_No response_", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6794/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6794/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6745", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6745/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6745/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6745/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6745", "id": 860307065, "node_id": "MDU6SXNzdWU4NjAzMDcwNjU=", "number": 6745, "title": "Message.edit() ignores client-wide allowed_mentions if argument not passed", "user": {"login": "zhudotexe", "id": 8866981, "node_id": "MDQ6VXNlcjg4NjY5ODE=", "avatar_url": "https://avatars.githubusercontent.com/u/8866981?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zhudotexe", "html_url": "https://github.com/zhudotexe", "followers_url": "https://api.github.com/users/zhudotexe/followers", "following_url": "https://api.github.com/users/zhudotexe/following{/other_user}", "gists_url": "https://api.github.com/users/zhudotexe/gists{/gist_id}", "starred_url": "https://api.github.com/users/zhudotexe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zhudotexe/subscriptions", "organizations_url": "https://api.github.com/users/zhudotexe/orgs", "repos_url": "https://api.github.com/users/zhudotexe/repos", "events_url": "https://api.github.com/users/zhudotexe/events{/privacy}", "received_events_url": "https://api.github.com/users/zhudotexe/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-04-17T02:54:06Z", "updated_at": "2021-04-17T03:02:02Z", "closed_at": "2021-04-17T03:02:02Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nWhen calling `Message.edit()`, if `allowed_mentions` is set at the client level but the argument is not passed into `.edit()`, the edited message does not take the client-scoped allowed mentions into account\r\n\r\n### Reproduction Steps\r\n\r\n1. Initialize the client with `allowed_mentions=discord.AllowedMentions.none()`\r\n2. Send a message\r\n3. Edit the message with content that includes the ping using `Message.edit()`\r\n4. Observe that the message is highlighted\r\n\r\n### Minimal Reproducible Code\r\n\r\n```python\r\nclient = discord.Client(allowed_mentions=discord.AllowedMentions.none())\r\n\r\n\r\n@client.event\r\nasync def on_ready():\r\n    channel = client.get_channel(SOME_CHANNEL_ID)\r\n    message = await channel.send(\"Hello @here\")  # the message does not ping here\r\n    await asyncio.sleep(2)\r\n    await message.edit(content=\"Hello2 @here\")  # now it does!\r\n```\r\n\r\n\r\n### Expected Results\r\n\r\nThe client-scoped `allowed_mentions` is attached to the edited message, as per docs:\r\n> If no object is passed at all then the defaults given by :attr:`~discord.Client.allowed_mentions` are used instead.\r\n\r\n### Actual Results\r\n\r\nNo `allowed_mentions` is attached to the edited message\r\n\r\n### Intents\r\n\r\ndiscord.Intents.all()\r\n\r\n### System Information\r\n\r\n- Python v3.8.0-final\r\n- discord.py v1.7.1-final\r\n- aiohttp v3.7.4.post0\r\n- system info: Darwin 18.7.0 Darwin Kernel Version 18.7.0: Tue Aug 20 16:57:14 PDT 2019; root:xnu-4903.271.2~2/RELEASE_X86_64\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### Additional Context\r\n\r\nThis seems like a duplicate of #6331, which was marked as a Discord bug, but it appears this is in the library: passing an `allowed_mentions` parameter to the http client behaves as expected (i.e. \r\n```py\r\nawait client.http.edit_message(channel_id=..., message_id=..., content=\"@\"+\"everyone\", allowed_mentions={\"parse\": []})\r\n```\r\n)\r\n\r\nComparing the send and edit code, it looks like the code for `.edit()` simply skips merging in the client-wide `allowed_mentions` if a non-None argument is not passed to `.edit()` directly: https://github.com/Rapptz/discord.py/blob/master/discord/message.py#L1516; whereas `.send()` falls back to the client default: https://github.com/Rapptz/discord.py/blob/master/discord/abc.py#L1061", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6745/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6745/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6602", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6602/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6602/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6602/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6602", "id": 847395218, "node_id": "MDU6SXNzdWU4NDczOTUyMTg=", "number": 6602, "title": "voicechannel.members result in a error ('NoneType' object has no attribute 'id')", "user": {"login": "Minlor", "id": 40441731, "node_id": "MDQ6VXNlcjQwNDQxNzMx", "avatar_url": "https://avatars.githubusercontent.com/u/40441731?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Minlor", "html_url": "https://github.com/Minlor", "followers_url": "https://api.github.com/users/Minlor/followers", "following_url": "https://api.github.com/users/Minlor/following{/other_user}", "gists_url": "https://api.github.com/users/Minlor/gists{/gist_id}", "starred_url": "https://api.github.com/users/Minlor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Minlor/subscriptions", "organizations_url": "https://api.github.com/users/Minlor/orgs", "repos_url": "https://api.github.com/users/Minlor/repos", "events_url": "https://api.github.com/users/Minlor/events{/privacy}", "received_events_url": "https://api.github.com/users/Minlor/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/13", "html_url": "https://github.com/Rapptz/discord.py/milestone/13", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/13/labels", "id": 6315233, "node_id": "MDk6TWlsZXN0b25lNjMxNTIzMw==", "number": 13, "title": "v1.7", "description": "", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 41, "state": "open", "created_at": "2021-01-15T10:24:32Z", "updated_at": "2021-04-04T03:26:42Z", "due_on": null, "closed_at": null}, "comments": 6, "created_at": "2021-03-31T21:47:02Z", "updated_at": "2021-04-04T03:03:33Z", "closed_at": "2021-04-04T03:03:33Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nDue to a new update on discord (stage channels) getting members from a voice channel results in a error.\r\n\r\n### Reproduction Steps\r\n\r\nI enabled community on my guild and then made a stage channel after that I joined a normal voice channel and when I tried to grab the members of a voice channel I would always get a error\r\n\r\n### Minimal Reproducible Code\r\n\r\n```python\r\nAivo.get_channel(channelid).members\r\n```\r\n\r\n\r\n### Expected Results\r\n\r\nReturns all the members in a normal voice channel\r\n\r\n### Actual Results\r\n\r\nIt errors out\r\n\r\nScreenshot:\r\nhttps://cdn.discordapp.com/attachments/821520339242057749/826935480531943424/Discord_tE2MBXrLAD.png\r\n\r\n\r\nError:\r\n\r\nIgnoring exception in on_voice_state_update\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.8/dist-packages/discord/client.py\", line 343, in _run_event\r\n    await coro(*args, **kwargs)\r\n  File \"/root/Azure/Azure.py\", line 137, in on_voice_state_update\r\n    await if_channel_empty_delete(member, before, after)\r\n  File \"/root/Azure/Azure.py\", line 118, in if_channel_empty_delete\r\n    check = checkch.members\r\n  File \"/usr/local/lib/python3.8/dist-packages/discord/channel.py\", line 630, in members\r\n    if state.channel.id == self.id:\r\nAttributeError: 'NoneType' object has no attribute 'id'\r\n\r\n### Intents\r\n\r\nAll intents enabled\r\n\r\n### System Information\r\n\r\n- Python v3.8.5-final\r\n- discord.py v1.6.0-final\r\n- aiohttp v3.7.4.post0\r\n- system info: Linux 5.4.0-65-generic #73-Ubuntu SMP Mon Jan 18 17:25:17 UTC 2021\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6602/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6602/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6553", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6553/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6553/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6553/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6553", "id": 837019203, "node_id": "MDU6SXNzdWU4MzcwMTkyMDM=", "number": 6553, "title": "API Reference missing", "user": {"login": "karintou8710", "id": 80200187, "node_id": "MDQ6VXNlcjgwMjAwMTg3", "avatar_url": "https://avatars.githubusercontent.com/u/80200187?v=4", "gravatar_id": "", "url": "https://api.github.com/users/karintou8710", "html_url": "https://github.com/karintou8710", "followers_url": "https://api.github.com/users/karintou8710/followers", "following_url": "https://api.github.com/users/karintou8710/following{/other_user}", "gists_url": "https://api.github.com/users/karintou8710/gists{/gist_id}", "starred_url": "https://api.github.com/users/karintou8710/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/karintou8710/subscriptions", "organizations_url": "https://api.github.com/users/karintou8710/orgs", "repos_url": "https://api.github.com/users/karintou8710/repos", "events_url": "https://api.github.com/users/karintou8710/events{/privacy}", "received_events_url": "https://api.github.com/users/karintou8710/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-03-21T08:44:33Z", "updated_at": "2021-03-24T12:19:05Z", "closed_at": "2021-03-24T12:19:05Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\n\ndiscord.Member.create_dm() is async def, but the API reference says def.\n\n### Reproduction Steps\n\nasync def on_message(self, message):\r\n        dmChannel = message.author.create_dm()\r\n\tprint(type(dmChannel))\r\n\r\nIt can be reproduced by the user sending a message.\n\n### Expected Results\n\n<class 'discord.channel.DMChannel'> is output\n\n### Actual Results\n\n<class 'coroutine'> is output\n\n### Intents\n\nall intents.\n\n### System Information\n\n- Python v3.8.5-final\r\n- discord.py v1.7.0-alpha\r\n    - discord.py pkg_resources: v1.6.0\r\n- aiohttp v3.7.4.post0\r\n- system info: Linux 4.19.128-microsoft-standard #1 SMP Tue Jun 23 12:58:10 UTC 2020\n\n### Checklist\n\n- [X] I have searched the open issues for duplicates.\n- [X] I have shown the entire traceback, if possible.\n- [X] I have removed my token from display, if visible.\n\nAPI Reference version : latest  \r\n\r\n<img width=\"394\" alt=\"discord-issue\" src=\"https://user-images.githubusercontent.com/80200187/111898997-e6e80b00-8a6c-11eb-9543-a1a4d1ad2fd5.png\">\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6553/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6553/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6531", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6531/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6531/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6531/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6531", "id": 831044590, "node_id": "MDU6SXNzdWU4MzEwNDQ1OTA=", "number": 6531, "title": "API requests with files error on retry with aiohttp 3.7", "user": {"login": "Jackenmen", "id": 6032823, "node_id": "MDQ6VXNlcjYwMzI4MjM=", "avatar_url": "https://avatars.githubusercontent.com/u/6032823?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jackenmen", "html_url": "https://github.com/Jackenmen", "followers_url": "https://api.github.com/users/Jackenmen/followers", "following_url": "https://api.github.com/users/Jackenmen/following{/other_user}", "gists_url": "https://api.github.com/users/Jackenmen/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jackenmen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jackenmen/subscriptions", "organizations_url": "https://api.github.com/users/Jackenmen/orgs", "repos_url": "https://api.github.com/users/Jackenmen/repos", "events_url": "https://api.github.com/users/Jackenmen/events{/privacy}", "received_events_url": "https://api.github.com/users/Jackenmen/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-03-14T02:01:19Z", "updated_at": "2021-03-24T12:51:16Z", "closed_at": "2021-03-24T12:51:16Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\n\nIf API request with a file (i.e. sending a message with a file) fails and d.py needs to try the request, it errors out\n\n### Reproduction Steps\n\nReliable repro is a bit hard to make as this only happens if d.py needs to retry the API request.\r\nThe code with which this can happen can be something like this:\r\n```py\r\nfrom io import BytesIO\r\nfp = BytesIO(b\"foobar\")\r\nawait ctx.send(\"message\", discord.File(fp, \"testfile.txt\"))\r\n```\n\n### Expected Results\n\nNo error\n\n### Actual Results\n\nTraceback:\r\n```\r\nFile \"python3.8/site-packages/discord/abc.py\", line 915, in send\r\n  data = await state.http.send_files(channel.id, files=[file], allowed_mentions=allowed_mentions,\r\nFile \"python3.8/site-packages/discord/http.py\", line 185, in request\r\n  async with self.__session.request(method, url, **kwargs) as r:\r\nFile \"python3.8/site-packages/aiohttp/client.py\", line 1117, in __aenter__\r\n  self._resp = await self._coro\r\nFile \"python3.8/site-packages/aiohttp/client.py\", line 492, in _request\r\n  req = self._request_class(\r\nFile \"python3.8/site-packages/aiohttp/client_reqrep.py\", line 313, in __init__\r\n  self.update_body_from_data(data)\r\nFile \"python3.8/site-packages/aiohttp/client_reqrep.py\", line 507, in update_body_from_data\r\n  body = body()\r\nFile \"python3.8/site-packages/aiohttp/formdata.py\", line 168, in __call__\r\n  return self._gen_form_data()\r\nFile \"python3.8/site-packages/aiohttp/formdata.py\", line 132, in _gen_form_data\r\n  raise RuntimeError(\"Form data has been processed already\")\r\nRuntimeError: Form data has been processed already\r\n```\n\n### Intents\n\ndiscord.Intents.all()\n\n### System Information\n\n- Python v3.8.8-final\r\n- discord.py v1.6.0-final\r\n- aiohttp v3.7.3\r\n- system info: Windows 10 10.0.19041\n\n### Checklist\n\n- [X] I have searched the open issues for duplicates.\n- [X] I have shown the entire traceback, if possible.\n- [X] I have removed my token from display, if visible.\n\nThis happens on aiohttp 3.7 as the `FormData` object has been changed so that it only can be used once.\r\n\r\nRelated commit and issues:\r\nhttps://github.com/aio-libs/aiohttp/commit/d931f10207d5ab9f0c63c6164c762bdbaf94e969\r\nhttps://github.com/aio-libs/aiohttp/pull/4351\r\nhttps://github.com/aio-libs/aiohttp/issues/4345\r\n\r\nI know you're already aware of this issue but I figured it might be worth making a tracking issue for this so that it doesn't get lost.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6531/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6531/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6529", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6529/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6529/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6529/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6529", "id": 831036640, "node_id": "MDU6SXNzdWU4MzEwMzY2NDA=", "number": 6529, "title": "Subcommand signature in default help formatter doesn't include group's args", "user": {"login": "Jackenmen", "id": 6032823, "node_id": "MDQ6VXNlcjYwMzI4MjM=", "avatar_url": "https://avatars.githubusercontent.com/u/6032823?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jackenmen", "html_url": "https://github.com/Jackenmen", "followers_url": "https://api.github.com/users/Jackenmen/followers", "following_url": "https://api.github.com/users/Jackenmen/following{/other_user}", "gists_url": "https://api.github.com/users/Jackenmen/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jackenmen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jackenmen/subscriptions", "organizations_url": "https://api.github.com/users/Jackenmen/orgs", "repos_url": "https://api.github.com/users/Jackenmen/repos", "events_url": "https://api.github.com/users/Jackenmen/events{/privacy}", "received_events_url": "https://api.github.com/users/Jackenmen/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-03-14T01:03:39Z", "updated_at": "2021-03-24T12:16:23Z", "closed_at": "2021-03-24T12:16:23Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\n\nWhen a parent group has arguments, they aren't shown in subcommand's help\n\n### Reproduction Steps\n\n1. Use default help formatter (so just don't specify one at all)\r\n2. Put\r\n```py\r\nclass X(commands.Cog):\r\n  @commands.group(invoke_without_command=True)\r\n  async def cogname(self, ctx):\r\n    pass\r\n\r\n  @cogname.group()\r\n  async def edit(self, ctx, channel: discord.TextChannel):\r\n    pass\r\n\r\n  @edit.group(name='name')\r\n  async def edit_name(self, ctx):\r\n    pass\r\n\r\n  @edit_name.group(name='format')\r\n  async def edit_name_format(self, ctx, option: str):\r\n    pass\r\n```\r\n3. Start the bot\r\n4. Try running `[p]help cogname edit name format` (`[p]` being bot's prefix)\n\n### Expected Results\n\nI expected the output to be:\r\n```\r\n[p]cogname edit <channel> name format <option>\r\n```\n\n### Actual Results\n\nThe output was:\r\n```\r\n[p]cogname edit name format <option>\r\n```\n\n### Intents\n\ndiscord.Intents.all()\n\n### System Information\n\n```\r\n- Python v3.8.8-final\r\n- discord.py v1.6.0-final\r\n- aiohttp v3.7.3\r\n- system info: Windows 10 10.0.19041\r\n```\n\n### Checklist\n\n- [X] I have searched the open issues for duplicates.\n- [X] I have shown the entire traceback, if possible.\n- [X] I have removed my token from display, if visible.\n\nNote: When `invoke_without_command` is set to `True`, the signature should continue to not include the arguments of the parent as then, those arguments are not required to run subcommands.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6529/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6529/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6527", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6527/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6527/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6527/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6527", "id": 831006811, "node_id": "MDU6SXNzdWU4MzEwMDY4MTE=", "number": 6527, "title": "wait_for doesn't actually add listener for the event, and causes it to block forever", "user": {"login": "dyc3", "id": 1808807, "node_id": "MDQ6VXNlcjE4MDg4MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/1808807?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dyc3", "html_url": "https://github.com/dyc3", "followers_url": "https://api.github.com/users/dyc3/followers", "following_url": "https://api.github.com/users/dyc3/following{/other_user}", "gists_url": "https://api.github.com/users/dyc3/gists{/gist_id}", "starred_url": "https://api.github.com/users/dyc3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dyc3/subscriptions", "organizations_url": "https://api.github.com/users/dyc3/orgs", "repos_url": "https://api.github.com/users/dyc3/repos", "events_url": "https://api.github.com/users/dyc3/events{/privacy}", "received_events_url": "https://api.github.com/users/dyc3/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 251130945, "node_id": "MDU6TGFiZWwyNTExMzA5NDU=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/invalid", "name": "invalid", "color": "e6e6e6", "default": true, "description": "This is not right."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-03-13T22:02:33Z", "updated_at": "2021-06-10T18:13:01Z", "closed_at": "2021-03-13T23:48:29Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nclient.wait_for doesn't actually add listener for the event, and causes it to block forever\r\n\r\n### Reproduction Steps\r\n\r\n2 files are required\r\n\r\n`bot.py`:\r\n```python\r\nfrom turns import *\r\nimport logging\r\nfrom discord.ext import commands\r\nimport test\r\n\r\nlogging.basicConfig(level=logging.DEBUG)\r\n\r\nbot = commands.Bot(command_prefix='>')\r\n\r\n@bot.command()\r\nasync def bug(ctx: commands.Context):\r\n\tawait test.act(ctx)\r\n\r\n@bot.command()\r\nasync def nobug(ctx: commands.Context):\r\n\tawait prompt(ctx.author)\r\n\tawait ctx.send(\"Success!\")\r\n\r\nasync def prompt(user):\r\n\tif not user.dm_channel:\r\n\t\tawait user.create_dm()\r\n\tmsg = await user.dm_channel.send(content=\"react to me\")\r\n\tdef check(payload):\r\n\t\tlogging.debug(f\"checking payload {payload}\")\r\n\t\treturn payload.message_id == msg.id and payload.user_id == user.id\r\n\tawait bot.wait_for(\"raw_reaction_add\", check=check)\r\n\r\ndef get_token():\r\n\twith open(\"token\", \"r\") as f:\r\n\t\treturn \"\".join(f.readlines()).strip()\r\n\r\nif __name__ == \"__main__\":\r\n\tbot.run(get_token())\r\n\r\n```\r\n\r\n`test.py`:\r\n```python\r\nfrom discord.ext import commands\r\nimport bot\r\n\r\nasync def act(ctx: commands.Context):\r\n\tawait bot.prompt(ctx.author)\r\n\tawait ctx.send(\"Success!\")\r\n```\r\n\r\nRun with `python3 bot.py`.\r\n- `>nobug` to demonstrate that `prompt` should work\r\n- `>bug` to reproduce bug, and invoke insanity. Somehow the same code, when put in a different file, produces different results.\r\n\r\n### Expected Results\r\n\r\nExpected `wait_for` to stop blocking when the condition is met\r\n\r\n### Actual Results\r\n\r\n`wait_for` blocks forever\r\n\r\n### Intents\r\n\r\nunknown\r\n\r\n### System Information\r\n\r\n- Python v3.9.2-final\r\n- discord.py v1.6.0-final\r\n- aiohttp v3.7.4.post0\r\n- system info: Linux 5.4.0-66-generic \\#\\74-Ubuntu SMP Wed Jan 27 22:54:38 UTC 2021\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6527/reactions", "total_count": 4, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 4, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6527/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6510", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6510/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6510/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6510/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6510", "id": 823370039, "node_id": "MDU6SXNzdWU4MjMzNzAwMzk=", "number": 6510, "title": "Context.channel", "user": {"login": "BIRD-UP73", "id": 57305556, "node_id": "MDQ6VXNlcjU3MzA1NTU2", "avatar_url": "https://avatars.githubusercontent.com/u/57305556?v=4", "gravatar_id": "", "url": "https://api.github.com/users/BIRD-UP73", "html_url": "https://github.com/BIRD-UP73", "followers_url": "https://api.github.com/users/BIRD-UP73/followers", "following_url": "https://api.github.com/users/BIRD-UP73/following{/other_user}", "gists_url": "https://api.github.com/users/BIRD-UP73/gists{/gist_id}", "starred_url": "https://api.github.com/users/BIRD-UP73/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/BIRD-UP73/subscriptions", "organizations_url": "https://api.github.com/users/BIRD-UP73/orgs", "repos_url": "https://api.github.com/users/BIRD-UP73/repos", "events_url": "https://api.github.com/users/BIRD-UP73/events{/privacy}", "received_events_url": "https://api.github.com/users/BIRD-UP73/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-03-05T19:53:46Z", "updated_at": "2021-03-13T06:46:31Z", "closed_at": "2021-03-13T06:46:31Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nThe type for [Context.channel](https://discordpy.readthedocs.io/en/latest/api.html?highlight=message%20channel#discord.Message.channel) seems to be incorrect in the doc\r\n\r\n### Reproduction Steps\r\n\r\nSee [Context.channel](https://discordpy.readthedocs.io/en/latest/ext/commands/api.html?highlight=context%20channel#discord.ext.commands.Context.channel)\r\n\r\nThe type shown here is `TextChannel`, although this could also be a `DMChannel`.\r\n\r\n### Expected Results\r\n\r\nThe type for Context.channel should be the same as [Message.channel](https://discordpy.readthedocs.io/en/latest/api.html?highlight=message%20channel#discord.Message.channel) which is `Union[abc.Messageable]`\r\n\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\nI was unsure which template to use, so I picked this one.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6510/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6510/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6461", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6461/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6461/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6461/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6461", "id": 813463928, "node_id": "MDU6SXNzdWU4MTM0NjM5Mjg=", "number": 6461, "title": "Context.reinvoke improperly assigns invoked_with", "user": {"login": "SebbyLaw", "id": 44045823, "node_id": "MDQ6VXNlcjQ0MDQ1ODIz", "avatar_url": "https://avatars.githubusercontent.com/u/44045823?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SebbyLaw", "html_url": "https://github.com/SebbyLaw", "followers_url": "https://api.github.com/users/SebbyLaw/followers", "following_url": "https://api.github.com/users/SebbyLaw/following{/other_user}", "gists_url": "https://api.github.com/users/SebbyLaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/SebbyLaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SebbyLaw/subscriptions", "organizations_url": "https://api.github.com/users/SebbyLaw/orgs", "repos_url": "https://api.github.com/users/SebbyLaw/repos", "events_url": "https://api.github.com/users/SebbyLaw/events{/privacy}", "received_events_url": "https://api.github.com/users/SebbyLaw/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-02-22T12:38:42Z", "updated_at": "2021-02-23T08:39:08Z", "closed_at": "2021-02-23T08:39:08Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**Summary**\r\n\r\ntitle\r\n\r\n**Reproduction Steps**\r\n\r\ncode:\r\n```py\r\n@bot.group(aliases=['fooo', 'foooo'])\r\nasync def foo(c):\r\n  await c.send(f\"foo invoked_with: ({c.invoked_with})\")\r\n\r\n@foo.group(aliases=['barr', 'barrr'])\r\nasync def bar(c):\r\n  await c.send(f\"bar invoked_with: ({c.invoked_with})\")\r\n\r\n@bar.command()\r\nasync def baz(c):\r\n  await c.send(f\"baz invoked_with: ({c.invoked_with})\")\r\n```\r\nRun the command `?fooo barr baz` then reinvoke the context with `restart=True`\r\n\r\n**Expected Results**\r\n\r\n```\r\nfoo invoked_with: (foooo)\r\nbar invoked_with: (barr)\r\nbaz invoked_with: (baz)\r\nfoo invoked_with: (foooo) \r\nbar invoked_with: (barr)\r\nbaz invoked_with: (baz)\r\n```\r\n\r\n**Actual Results**\r\n\r\n```\r\nfoo invoked_with: (foooo)\r\nbar invoked_with: (barr)\r\nbaz invoked_with: (baz)\r\nfoo invoked_with: (baz) \r\nbar invoked_with: (barr)\r\nbaz invoked_with: (baz)\r\n```\r\n\r\n**Intents**\r\n\r\nNot applicable\r\n\r\n**System Information**\r\n\r\nNot applicable\r\n\r\n**Checklist**\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6461/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6461/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6430", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6430/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6430/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6430/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6430", "id": 809730095, "node_id": "MDU6SXNzdWU4MDk3MzAwOTU=", "number": 6430, "title": "Voice Client average latency issue", "user": {"login": "Shifty6", "id": 33166535, "node_id": "MDQ6VXNlcjMzMTY2NTM1", "avatar_url": "https://avatars.githubusercontent.com/u/33166535?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Shifty6", "html_url": "https://github.com/Shifty6", "followers_url": "https://api.github.com/users/Shifty6/followers", "following_url": "https://api.github.com/users/Shifty6/following{/other_user}", "gists_url": "https://api.github.com/users/Shifty6/gists{/gist_id}", "starred_url": "https://api.github.com/users/Shifty6/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Shifty6/subscriptions", "organizations_url": "https://api.github.com/users/Shifty6/orgs", "repos_url": "https://api.github.com/users/Shifty6/repos", "events_url": "https://api.github.com/users/Shifty6/events{/privacy}", "received_events_url": "https://api.github.com/users/Shifty6/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-02-16T23:43:01Z", "updated_at": "2021-02-18T11:53:08Z", "closed_at": "2021-02-18T11:53:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Summary**\r\n\r\nVoice Client average latency zero division error\r\n\r\n**Reproduction Steps**\r\n\r\nFor the first 5~ seconds after joining a voice channel (until the first heartbeat ack), the `average_latency` property results in a `ZeroDivisionError`.\r\n\r\n```py\r\nasync def join(ctx):\r\n    voice_channel = ctx.author.voice.channel\r\n    if voice_channel:\r\n        await voice_channel.connect()\r\n        print(ctx.guild.voice_client.average_latency)\r\n```\r\n\r\n**Expected Results**\r\n\r\nReturn `float('inf')` if there have been no heartbeat acks, just as it would if there was no heartbeat at all.\r\n\r\n**Actual Results**\r\n\r\nThe bot attempts to calculate average -- `sum(recent_acks) / len(recent_acks)` -- resulting in `ZeroDivisionError`.\r\n\r\n**Intents**\r\n\r\ndefault intents\r\n\r\n**System Information**\r\n\r\n- Python v3.9.0-final\r\n- discord.py v1.6.0-final\r\n- aiohttp v3.6.3\r\n- system info: Windows 10 10.0.19041\r\n\r\n**Checklist**\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6430/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6430/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6427", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6427/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6427/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6427/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6427", "id": 809425378, "node_id": "MDU6SXNzdWU4MDk0MjUzNzg=", "number": 6427, "title": "add_reaction event not working properly on DMChannels", "user": {"login": "applejuiceyy", "id": 30875598, "node_id": "MDQ6VXNlcjMwODc1NTk4", "avatar_url": "https://avatars.githubusercontent.com/u/30875598?v=4", "gravatar_id": "", "url": "https://api.github.com/users/applejuiceyy", "html_url": "https://github.com/applejuiceyy", "followers_url": "https://api.github.com/users/applejuiceyy/followers", "following_url": "https://api.github.com/users/applejuiceyy/following{/other_user}", "gists_url": "https://api.github.com/users/applejuiceyy/gists{/gist_id}", "starred_url": "https://api.github.com/users/applejuiceyy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/applejuiceyy/subscriptions", "organizations_url": "https://api.github.com/users/applejuiceyy/orgs", "repos_url": "https://api.github.com/users/applejuiceyy/repos", "events_url": "https://api.github.com/users/applejuiceyy/events{/privacy}", "received_events_url": "https://api.github.com/users/applejuiceyy/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 2424324063, "node_id": "MDU6TGFiZWwyNDI0MzI0MDYz", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/intents%20related", "name": "intents related", "color": "99d4f7", "default": false, "description": "User provided bad/invalid intents"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-02-16T15:48:13Z", "updated_at": "2021-06-10T10:46:15Z", "closed_at": "2021-02-17T09:17:59Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Summary**\r\n\r\nadd_reaction event is not dispatched on direct messages\r\n\r\n**Reproduction Steps**\r\n\r\nrun this code with the the necessary changes\r\n```py\r\nimport asyncio\r\n\r\nimport discord\r\n\r\nclient = discord.Client()\r\n\r\n@client.event\r\nasync def on_message(message):\r\n    if isinstance(message.channel, discord.DMChannel) and message.content == \"hey\":\r\n        target_message = await message.channel.send(\"Hey there buddy react this message please\")\r\n        await target_message.add_reaction(\"\u2705\")\r\n\r\n        def check(r, u):\r\n            return u.id == message.author.id and target_message.id == r.message.id\r\n\r\n        try:\r\n            await client.wait_for(\"reaction_add\", timeout=30, check=check)\r\n        except asyncio.exceptions.TimeoutError:\r\n            await message.channel.send(\"You didn't react...\")\r\n        else:\r\n            await message.channel.send(\"Thanks!\")\r\n\r\nclient.run(\"<token>\")\r\n```\r\n\r\n**Expected Results**\r\n\r\nThe bot should respond after the reaction\r\n(this behaviour happens on discord.py 1.5)\r\n\r\n**Actual Results**\r\n\r\nThe bot does not respond to the reaction, and will blame it on you for not reacting after the timeout\r\n(this behaviour happens on latest)\r\n\r\n**Intents**\r\n\r\ndefault intents\r\n\r\n**System Information**\r\n\r\n- Python v3.8.3-final\r\n- discord.py v1.6.0-final\r\n- aiohttp v3.6.3\r\n- system info: Windows 10 10.0.18362\r\n\r\n\r\n**Checklist**\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6427/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6427/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6421", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6421/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6421/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6421/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6421", "id": 807953465, "node_id": "MDU6SXNzdWU4MDc5NTM0NjU=", "number": 6421, "title": "Command error handle still work although it already got removed", "user": {"login": "WinXPDev", "id": 69248513, "node_id": "MDQ6VXNlcjY5MjQ4NTEz", "avatar_url": "https://avatars.githubusercontent.com/u/69248513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WinXPDev", "html_url": "https://github.com/WinXPDev", "followers_url": "https://api.github.com/users/WinXPDev/followers", "following_url": "https://api.github.com/users/WinXPDev/following{/other_user}", "gists_url": "https://api.github.com/users/WinXPDev/gists{/gist_id}", "starred_url": "https://api.github.com/users/WinXPDev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WinXPDev/subscriptions", "organizations_url": "https://api.github.com/users/WinXPDev/orgs", "repos_url": "https://api.github.com/users/WinXPDev/repos", "events_url": "https://api.github.com/users/WinXPDev/events{/privacy}", "received_events_url": "https://api.github.com/users/WinXPDev/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 251130945, "node_id": "MDU6TGFiZWwyNTExMzA5NDU=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/invalid", "name": "invalid", "color": "e6e6e6", "default": true, "description": "This is not right."}, {"id": 397573190, "node_id": "MDU6TGFiZWwzOTc1NzMxOTA=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/no%20repro", "name": "no repro", "color": "fef2c0", "default": false, "description": "Cannot be reproduced."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-02-14T12:41:33Z", "updated_at": "2021-06-10T10:45:18Z", "closed_at": "2021-02-14T13:31:00Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Summary**\n\nI had a command error handle and then I removed it but the command error handle still working\n\n**Reproduction Steps**\n\nI'm not really good in describe anything but\r\n![Problem](https://cdn.discordapp.com/attachments/808698335618662403/810488399982100541/unknown.png)\r\nin this image you can see the command error handle\r\nand in my code, there's no command error handle function\r\n\r\n[Code](https://paste.pythondiscord.com/amenemefur.py)\r\n\r\nAlso there's no error\n\n**Expected Results**\n\nI expect it to not handle command error since I removed it\n\n**Actual Results**\n\ninstead it actually handle the command error\n\n**Intents**\n\n4\n\n**System Information**\n\nDiscord.py version: 1.6.0\r\n\n\n**Checklist**\n\n- [X] I have searched the open issues for duplicates.\n- [x] I have shown the entire traceback, if possible.\n- [X] I have removed my token from display, if visible.\n\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6421/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6421/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6414", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6414/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6414/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6414/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6414", "id": 806898853, "node_id": "MDU6SXNzdWU4MDY4OTg4NTM=", "number": 6414, "title": "Editing a Reply Message Does Not Conform to Allowed Mentions", "user": {"login": "xiaomyer", "id": 19848162, "node_id": "MDQ6VXNlcjE5ODQ4MTYy", "avatar_url": "https://avatars.githubusercontent.com/u/19848162?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xiaomyer", "html_url": "https://github.com/xiaomyer", "followers_url": "https://api.github.com/users/xiaomyer/followers", "following_url": "https://api.github.com/users/xiaomyer/following{/other_user}", "gists_url": "https://api.github.com/users/xiaomyer/gists{/gist_id}", "starred_url": "https://api.github.com/users/xiaomyer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xiaomyer/subscriptions", "organizations_url": "https://api.github.com/users/xiaomyer/orgs", "repos_url": "https://api.github.com/users/xiaomyer/repos", "events_url": "https://api.github.com/users/xiaomyer/events{/privacy}", "received_events_url": "https://api.github.com/users/xiaomyer/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 251130942, "node_id": "MDU6TGFiZWwyNTExMzA5NDI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/duplicate", "name": "duplicate", "color": "cccccc", "default": true, "description": "This is a duplicate of another issue or PR."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-02-12T02:34:01Z", "updated_at": "2021-06-10T04:05:18Z", "closed_at": "2021-02-12T02:44:07Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\n\r\nIf a message sent as a reply is edited, the occurring edited message will not have the proper allowed mentions applied to it.\r\n\r\n## Reproduction Steps\r\n\r\nTo reproduce this bug, first, make sure the `discord.AllowedMentions` class passed during bot initialization disables mentions for `replied_users`. Then, fetch a message from a channel that you (the user trying to reproduce; this assumes that you are logged in to the Discord client) sent, reply to it, and assign the new message to a variable. Preferably, sleep a few seconds so this does not happen too fast, and then edit the message's content. Full code snippets are down below.\r\n\r\n## Expected Results\r\n\r\nI expected neither the message initially sent nor the edited version of the message sent later on to mention me (\"mention me\" here can be easily defined as the message turning yellow in the Discord application).\r\n\r\n## Actual Results\r\n\r\nThe message sent initially did not mention me (expected), but after being edited, the message mentions me (the message turns yellow in the Discord client). This is unexpected.\r\n\r\n## Intents\r\n\r\n`discord.Intents.all()`\r\n\r\n## System Information\r\n\r\n$ `/home/myer/Myaer/bin/python -m discord -v`\r\n\r\n- `Python v3.9.1-final`\r\n- `discord.py v1.6.0-final`\r\n- `aiohttp v3.7.3`\r\n- `system info: Linux 5.4.0-52-generic #57-Ubuntu SMP Thu Oct 15 10:57:00 UTC 2020`\r\n\r\n## Checklist\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n## In `bot.py`: \r\n```python\r\nbot = commands.Bot(\r\n    ...,\r\n    allowed_mentions=discord.AllowedMentions(everyone=False, replied_user=False),\r\n    ...,\r\n)\r\n```\r\n## Testing In Jishaku:\r\n```python\r\nm = await message.reply(\"lol?\")\r\nawait asyncio!.sleep(5)\r\nm = await m.edit(content=\"xddd!!!!\")\r\n```\r\n\r\n## Demonstration:\r\n![Demonstration](https://i.myer.wtf/bxZui8s.gif)", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6414/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6414/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6413", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6413/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6413/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6413/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6413", "id": 806404073, "node_id": "MDU6SXNzdWU4MDY0MDQwNzM=", "number": 6413, "title": "'ctx.voice_client.is_playing()' returns False while bot is playing", "user": {"login": "Zabnarax", "id": 71614786, "node_id": "MDQ6VXNlcjcxNjE0Nzg2", "avatar_url": "https://avatars.githubusercontent.com/u/71614786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Zabnarax", "html_url": "https://github.com/Zabnarax", "followers_url": "https://api.github.com/users/Zabnarax/followers", "following_url": "https://api.github.com/users/Zabnarax/following{/other_user}", "gists_url": "https://api.github.com/users/Zabnarax/gists{/gist_id}", "starred_url": "https://api.github.com/users/Zabnarax/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Zabnarax/subscriptions", "organizations_url": "https://api.github.com/users/Zabnarax/orgs", "repos_url": "https://api.github.com/users/Zabnarax/repos", "events_url": "https://api.github.com/users/Zabnarax/events{/privacy}", "received_events_url": "https://api.github.com/users/Zabnarax/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 251130945, "node_id": "MDU6TGFiZWwyNTExMzA5NDU=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/invalid", "name": "invalid", "color": "e6e6e6", "default": true, "description": "This is not right."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-02-11T13:45:31Z", "updated_at": "2021-02-11T22:04:36Z", "closed_at": "2021-02-11T14:30:06Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Summary**\n\nWhen executing the command 'ctx.voice_client.is_playing()' returns False while bot is playing but when i do 'await ctx.send(str(ctx.voice_client.is_playing()))' it rerutns correct value\n\n**Reproduction Steps**\n\n```py\r\n@command()\r\n@guild_only()\r\nasync def play(self, ctx, url: str):\r\n    await ctx.message.delete()\r\n    if ctx.voice_client.is_playing() == False:\r\n        await self.play_(ctx, url)\r\n    else:\r\n        await self.add_(url)\r\n        await ctx.send(f'**+**')\r\n\r\n#or\r\n\r\n@command()\r\n@guild_only()\r\nasync def play(self, ctx, url: str):\r\n    await ctx.message.delete()\r\n    if ctx.voice_client.is_playing():\r\n        await self.add_(url)\r\n        await ctx.send(f'**+**')\r\n    else:\r\n        await self.play_(ctx, url)\r\n```\n\n**Expected Results**\n\nif bot is playing song - link is append to the playlist\r\nif don`t - plays curent song\n\n**Actual Results**\n\n'ctx.voice_client.is_playing()' always retutns False and do 'await self.play_(ctx, url)' \r\n\n\n**Intents**\n\nguilds, members, messages, reactions, presences, bans, voice_states, emojis\n\n**System Information**\n\n- Python v3.8.6-final\r\n- discord.py v1.6.0-final\r\n- aiohttp v3.6.3\r\n- system info: Windows 7 6.1.7601\n\n**Checklist**\n\n- [x] I have searched the open issues for duplicates.\n- [x] I have shown the entire traceback, if possible.\n- [X] I have removed my token from display, if visible.\n\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6413/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6413/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6385", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6385/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6385/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6385/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6385", "id": 801568930, "node_id": "MDU6SXNzdWU4MDE1Njg5MzA=", "number": 6385, "title": "io.BufferedIOBase doesn't work with FFmpegPCMAudio despite what the documentation says", "user": {"login": "RioghanDer2te", "id": 39881274, "node_id": "MDQ6VXNlcjM5ODgxMjc0", "avatar_url": "https://avatars.githubusercontent.com/u/39881274?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RioghanDer2te", "html_url": "https://github.com/RioghanDer2te", "followers_url": "https://api.github.com/users/RioghanDer2te/followers", "following_url": "https://api.github.com/users/RioghanDer2te/following{/other_user}", "gists_url": "https://api.github.com/users/RioghanDer2te/gists{/gist_id}", "starred_url": "https://api.github.com/users/RioghanDer2te/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RioghanDer2te/subscriptions", "organizations_url": "https://api.github.com/users/RioghanDer2te/orgs", "repos_url": "https://api.github.com/users/RioghanDer2te/repos", "events_url": "https://api.github.com/users/RioghanDer2te/events{/privacy}", "received_events_url": "https://api.github.com/users/RioghanDer2te/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-02-04T19:23:39Z", "updated_at": "2021-08-24T01:05:31Z", "closed_at": "2021-08-24T01:05:31Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "# **Summary**\r\n\r\nwhen supplying a `io.BufferedIOBase` object as `source` to `FFmpegPCMAudio`, it get complete instantly when played.\r\n\r\n\r\n# **Reproduction Steps**\r\n\r\nexample `io.BufferedIOBase` object:\r\n```py\r\nbuffer = io.BytesIO()\r\ngTTS(\"test\").write_to_fp(buffer)\r\nbuffer.seek(0)\r\n```\r\nexecution with that object:\r\n```FFmpegPCMAudio(buffer, options=\"-vn -loglevel fatal\")```\r\n\r\nwith `pipe = True`, there's an `io.UnsupportedOperation: fileno` exception, because the file-like object is no actual file.\r\n\r\n\r\n# **Expected Results**\r\n\r\nI expected the audio to play, hearing \"test\"\r\n\r\n\r\n# **Actual Results**\r\n\r\nthe audio got 'skipped'. It instantly compelted after starting without raising any exception\r\n\r\nException for `source: io.BufferedIOBase` and `pipe = True`:\r\n```py\r\nTraceback (most recent call last):\r\n  File \"D:\\PyCharm\\Project\\DiscordBot\\venv\\lib\\site-packages\\discord\\client.py\", line 343, in _run_event\r\n    await coro(*args, **kwargs)\r\n  File \"D:/PyCharm/Project/DiscordBot/main.py\", line 91, in on_voice_state_update\r\n    await cmd_music.ex([], None, client, \"play\", file=buffer, channel=after.channel)\r\n  File \"D:\\PyCharm\\Project\\DiscordBot\\commands\\cmd_music.py\", line 224, in ex\r\n    vc.play(discord.PCMVolumeTransformer(discord.FFmpegPCMAudio(file, pipe=True, options=ffmpeg_options[\"options\"], executable=ffmpeg_path.path), 0.5))\r\n  File \"D:\\PyCharm\\Project\\DiscordBot\\venv\\lib\\site-packages\\discord\\player.py\", line 225, in __init__\r\n    super().__init__(source, executable=executable, args=args, **subprocess_kwargs)\r\n  File \"D:\\PyCharm\\Project\\DiscordBot\\venv\\lib\\site-packages\\discord\\player.py\", line 138, in __init__\r\n    self._process = self._spawn_process(args, **kwargs)\r\n  File \"D:\\PyCharm\\Project\\DiscordBot\\venv\\lib\\site-packages\\discord\\player.py\", line 144, in _spawn_process\r\n    process = subprocess.Popen(args, creationflags=CREATE_NO_WINDOW, **subprocess_kwargs)\r\n  File \"D:\\Python373\\lib\\subprocess.py\", line 728, in __init__\r\n    errread, errwrite) = self._get_handles(stdin, stdout, stderr)\r\n  File \"D:\\Python373\\lib\\subprocess.py\", line 1039, in _get_handles\r\n    p2cread = msvcrt.get_osfhandle(stdin.fileno())\r\nio.UnsupportedOperation: fileno\r\n```\r\n\r\n\r\nA temporary fix for this is the answer to #5192, where \r\n```py\r\nprocess = subprocess.Popen(args, creationflags=CREATE_NO_WINDOW, **subprocess_kwargs)\r\n```\r\nis changed to \r\n```py\r\nself._process = subprocess.Popen(args, stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=stderr)\r\nself._stdout = io.BytesIO(self._process.communicate(input=stdin)[0])\r\n``` \r\nand the `io.BufferedIOBase` is `read()`\r\nThe problem with this fix is that it only works for `io.BufferedIOBase` types though.\r\n\r\n\r\n# **Intents**\r\n\r\n`discord.Intents.all()`\r\n\r\n# **System Information**\r\n\r\ndiscord.py version: 1.6.0\r\npython version: 3.7\r\nwindows version: 10 build 1903\r\n\r\n# **Checklist**\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6385/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6385/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6314", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6314/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6314/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6314/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6314", "id": 787163901, "node_id": "MDU6SXNzdWU3ODcxNjM5MDE=", "number": 6314, "title": "TypeError: unhashable type: 'list'", "user": {"login": "shahriyardx", "id": 40076722, "node_id": "MDQ6VXNlcjQwMDc2NzIy", "avatar_url": "https://avatars.githubusercontent.com/u/40076722?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shahriyardx", "html_url": "https://github.com/shahriyardx", "followers_url": "https://api.github.com/users/shahriyardx/followers", "following_url": "https://api.github.com/users/shahriyardx/following{/other_user}", "gists_url": "https://api.github.com/users/shahriyardx/gists{/gist_id}", "starred_url": "https://api.github.com/users/shahriyardx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shahriyardx/subscriptions", "organizations_url": "https://api.github.com/users/shahriyardx/orgs", "repos_url": "https://api.github.com/users/shahriyardx/repos", "events_url": "https://api.github.com/users/shahriyardx/events{/privacy}", "received_events_url": "https://api.github.com/users/shahriyardx/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 251130945, "node_id": "MDU6TGFiZWwyNTExMzA5NDU=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/invalid", "name": "invalid", "color": "e6e6e6", "default": true, "description": "This is not right."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-01-15T20:09:51Z", "updated_at": "2021-06-09T22:04:06Z", "closed_at": "2021-01-15T21:13:10Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\n\r\n<!-- A summary of your bug report -->\r\nI am trying to get all the commands of bot through `bot.commands`\r\nBut I am getting some error\r\n\r\n## Reproduction Steps\r\nAnywhere I put `bot.command` I get the error\r\n\r\n## Expected Results\r\n\r\nIt should return a set of commands of the bot. As it was returning in the previous versions of discord.py\r\n\r\n## Actual Results\r\n\r\n```sh\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\Shahriyar\\AppData\\Local\\Programs\\Python\\Python38-32\\lib\\site-packages\\jishaku\\cog_base.py\", line 513, in jsk_python\r\n    async for send, result in AsyncSender(executor):\r\n  File \"C:\\Users\\Shahriyar\\AppData\\Local\\Programs\\Python\\Python38-32\\lib\\site-packages\\jishaku\\functools.py\", line 109, in _internal\r\n    value = await base.asend(self.send_value)\r\n  File \"C:\\Users\\Shahriyar\\AppData\\Local\\Programs\\Python\\Python38-32\\lib\\site-packages\\jishaku\\repl\\compilation.py\", line 137, in traverse\r\n    async for send, result in AsyncSender(func(*self.args)):\r\n  File \"C:\\Users\\Shahriyar\\AppData\\Local\\Programs\\Python\\Python38-32\\lib\\site-packages\\jishaku\\functools.py\", line 109, in _internal\r\n    value = await base.asend(self.send_value)\r\n  File \"<repl>\", line 1, in _repl_coroutine\r\n  File \"C:\\Users\\Shahriyar\\AppData\\Local\\Programs\\Python\\Python38-32\\lib\\site-packages\\discord\\ext\\commands\\core.py\", line 1106, in commands\r\n    return set(self.all_commands.values())\r\nTypeError: unhashable type: 'list'\r\n```\r\n\r\n## Intents\r\n\r\nMy bot uses no intent\r\n\r\n## Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n- [x] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\n<!-- Run `python -m discord -v` and paste this information below. -->\r\n<!-- This command is available in v1.1.0 or higher. If you are unable to run this command, paste basic info (ie. Python version, library version, and your operating system -->\r\n\r\n- Python v3.8.1-final\r\n- discord.py v1.6.0-final\r\n- aiohttp v3.6.3\r\n- system info: Windows 10 10.0.19041\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6314/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6314/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6298", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6298/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6298/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6298/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6298", "id": 784689557, "node_id": "MDU6SXNzdWU3ODQ2ODk1NTc=", "number": 6298, "title": "Python Bot Is Not Running.", "user": {"login": "CallMeAxis", "id": 77366347, "node_id": "MDQ6VXNlcjc3MzY2MzQ3", "avatar_url": "https://avatars.githubusercontent.com/u/77366347?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CallMeAxis", "html_url": "https://github.com/CallMeAxis", "followers_url": "https://api.github.com/users/CallMeAxis/followers", "following_url": "https://api.github.com/users/CallMeAxis/following{/other_user}", "gists_url": "https://api.github.com/users/CallMeAxis/gists{/gist_id}", "starred_url": "https://api.github.com/users/CallMeAxis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CallMeAxis/subscriptions", "organizations_url": "https://api.github.com/users/CallMeAxis/orgs", "repos_url": "https://api.github.com/users/CallMeAxis/repos", "events_url": "https://api.github.com/users/CallMeAxis/events{/privacy}", "received_events_url": "https://api.github.com/users/CallMeAxis/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 251130945, "node_id": "MDU6TGFiZWwyNTExMzA5NDU=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/invalid", "name": "invalid", "color": "e6e6e6", "default": true, "description": "This is not right."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-01-13T00:23:44Z", "updated_at": "2021-06-09T14:32:19Z", "closed_at": "2021-01-13T07:39:47Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\n\r\nHello i have been trying to figure out a Discord Python bot for 2 days now i am very new to Python.\r\nThe Only Thing That's Going On Is It Can't get the token.\r\n`import os\r\n\r\nimport discord\r\nfrom dotenv import load_dotenv\r\n\r\nload_dotenv()\r\n\r\n\r\nclient = discord.Client()\r\n\r\n@client.event\r\nasync def on_ready():\r\n    print(f'{client.user.name} has connected to Discord!')\r\n\r\n@client.event\r\nasync def on_member_join(member):\r\n    await member.create_dm()\r\n    await member.dm_channel.send(\r\n        f'Hello {member.name}, Thanks For Joining Loser Land! Basic Rules: Dont Spam Please,Advertise In General,No Foul Language,Have Fun!'\r\n    )\r\nclient.run(os.getenv('TOKEN'))`\r\n## Reproduction Steps\r\nI Looked On here other sites Youtube videos tryed serval methods\r\n\r\n## Expected Results\r\n\r\nThe Bot To Run And Greet New Members\r\n\r\n## Actual Results\r\n\r\nThe Bot Fails To Get The Token And Cant Run.\r\n\r\n## Intents\r\n\r\nTo greet new Members\r\n\r\n## Checklist\r\n- [ x] I have searched the open issues for duplicates.\r\n- [ x] I have shown the entire traceback, if possible.\r\n- [ x] I have removed my token from display, if visible.\r\n- [x ] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\ni'm using pip install m- discord version 1.6.0 \r\nI'm Not Sure What Version I'm Using I Guess The Latest.\r\nWindows 10\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6298/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6298/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6296", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6296/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6296/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6296/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6296", "id": 784056066, "node_id": "MDU6SXNzdWU3ODQwNTYwNjY=", "number": 6296, "title": "get_quoted_word is confused by u2019 (\u2019)", "user": {"login": "GriffinG1", "id": 28538707, "node_id": "MDQ6VXNlcjI4NTM4NzA3", "avatar_url": "https://avatars.githubusercontent.com/u/28538707?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GriffinG1", "html_url": "https://github.com/GriffinG1", "followers_url": "https://api.github.com/users/GriffinG1/followers", "following_url": "https://api.github.com/users/GriffinG1/following{/other_user}", "gists_url": "https://api.github.com/users/GriffinG1/gists{/gist_id}", "starred_url": "https://api.github.com/users/GriffinG1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GriffinG1/subscriptions", "organizations_url": "https://api.github.com/users/GriffinG1/orgs", "repos_url": "https://api.github.com/users/GriffinG1/repos", "events_url": "https://api.github.com/users/GriffinG1/events{/privacy}", "received_events_url": "https://api.github.com/users/GriffinG1/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-01-12T09:15:49Z", "updated_at": "2021-01-12T10:46:20Z", "closed_at": "2021-01-12T10:46:06Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\n\r\nget_quoted_word throws an UnexpectedQuoteError when u2019 (`\u2019`) is used in the contents of a command invoke\r\n\r\n## Reproduction Steps\r\n\r\n```py\r\n@bot.command()\r\nasync def foo(ctx, s):\r\n    await ctx.send(s)\r\n```\r\nPass in a string containing characters combined with u2019 to foo (ex. `test\u2019`)\r\n\r\n## Expected Results\r\n\r\nFoo then sends the passed in string\r\n\r\n## Actual Results\r\n\r\nFoo throws an UnexpectedQuoteError, based off of u2019\r\n```\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\gpgro\\AppData\\Local\\Programs\\Python\\Python38\\lib\\site-packages\\discord\\ext\\commands\\bot.py\", line 902, in invoke\r\n    await ctx.command.invoke(ctx)\r\n  File \"C:\\Users\\gpgro\\AppData\\Local\\Programs\\Python\\Python38\\lib\\site-packages\\discord\\ext\\commands\\core.py\", line 856, in invoke\r\n    await self.prepare(ctx)\r\n  File \"C:\\Users\\gpgro\\AppData\\Local\\Programs\\Python\\Python38\\lib\\site-packages\\discord\\ext\\commands\\core.py\", line 790, in prepare\r\n    await self._parse_arguments(ctx)\r\n  File \"C:\\Users\\gpgro\\AppData\\Local\\Programs\\Python\\Python38\\lib\\site-packages\\discord\\ext\\commands\\core.py\", line 697, in _parse_arguments\r\n    transformed = await self.transform(ctx, param)\r\n  File \"C:\\Users\\gpgro\\AppData\\Local\\Programs\\Python\\Python38\\lib\\site-packages\\discord\\ext\\commands\\core.py\", line 549, in transform\r\n    argument = view.get_quoted_word()\r\n  File \"C:\\Users\\gpgro\\AppData\\Local\\Programs\\Python\\Python38\\lib\\site-packages\\discord\\ext\\commands\\view.py\", line 174, in get_quoted_word\r\n    raise UnexpectedQuoteError(current)\r\ndiscord.ext.commands.errors.UnexpectedQuoteError: Unexpected quote mark, '\u2019', in non-quoted string\r\n```\r\n\r\n## Intents\r\n\r\nAll.\r\n\r\n## Checklist\r\n\r\n- [x] I have searched the open issues for duplicates. (#4175 seems tangentially related, but not directly)\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n- [x] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\n- Python v3.8.1-final\r\n- discord.py v1.6.0-final\r\n- aiohttp v3.6.2\r\n- system info: Windows 10 10.0.18362\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6296/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6296/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6288", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6288/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6288/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6288/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6288", "id": 782756995, "node_id": "MDU6SXNzdWU3ODI3NTY5OTU=", "number": 6288, "title": "public_flags.all() doesn't return updated badges.", "user": {"login": "kirbyyourmom", "id": 34996878, "node_id": "MDQ6VXNlcjM0OTk2ODc4", "avatar_url": "https://avatars.githubusercontent.com/u/34996878?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kirbyyourmom", "html_url": "https://github.com/kirbyyourmom", "followers_url": "https://api.github.com/users/kirbyyourmom/followers", "following_url": "https://api.github.com/users/kirbyyourmom/following{/other_user}", "gists_url": "https://api.github.com/users/kirbyyourmom/gists{/gist_id}", "starred_url": "https://api.github.com/users/kirbyyourmom/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kirbyyourmom/subscriptions", "organizations_url": "https://api.github.com/users/kirbyyourmom/orgs", "repos_url": "https://api.github.com/users/kirbyyourmom/repos", "events_url": "https://api.github.com/users/kirbyyourmom/events{/privacy}", "received_events_url": "https://api.github.com/users/kirbyyourmom/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-01-10T06:51:17Z", "updated_at": "2021-01-17T05:09:16Z", "closed_at": "2021-01-17T05:09:16Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\n\r\nDoing discord.Member.public_flags.all() doesn't return updated badge list unless the bot's reran.\r\n\r\n## Reproduction Steps\r\n\r\nCommand made in a cog that prints the current list of public badges/flags of a member. \r\n\r\nHere's the source code for the current command:\r\n\r\n```py\r\n@commands.command()\r\nasync def test(self, ctx: commands.Context):\r\n    print(ctx.author.public_flags.all())\r\n```\r\nBe aware that this is in a cog and it's an AutoShardedBot.\r\n\r\n## Expected Results\r\n\r\nI was expecting the command to print an updated list of badges. I printed all the badges I had (HypeSquad House), this printed the current one I had. I changed the hypesquad houses from the settings and ran the command again. **I expected the house to change**\r\n\r\n## Actual Results\r\n\r\nTo my surprise, it didn't. **It printed the ones I had before and not the updated house**. I reran the bot and invoked the command, and it printed the updated one. There were no errors.\r\n\r\n## Intents\r\n\r\nI have these intents turned on in the source code:\r\n\r\n```py\r\ndiscord.Intents(messages=True, guilds=True, members=True,\r\n                webhooks=False, invites=True, presences=True,\r\n                reactions=True, typing=True)\r\n```\r\n\r\nAnd these in the dev portal:\r\n\r\n![Discord dev portal intents](https://i.imgur.com/RhoU2ya.png)\r\n\r\n## Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n- [x] I have provided the intents that my bot is using.\r\n> [x] I have searched the open issues for duplicates.\r\n\r\nI managed to find the a similar (but not exact) problem but with Roles instead. [Here's that](https://github.com/Rapptz/discord.py/issues/6262)\r\n\r\n## System Info\r\n\r\n```md\r\n- Python v3.8.6-final\r\n- discord.py v1.6.0-final\r\n- aiohttp v3.6.3\r\n- system info: Windows 10 10.0.18362\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6288/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6288/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6280", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6280/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6280/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6280/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6280", "id": 782419993, "node_id": "MDU6SXNzdWU3ODI0MTk5OTM=", "number": 6280, "title": "Regression or other impact to wait_for reaction in 1.6.0", "user": {"login": "DefiDebauchery", "id": 75273961, "node_id": "MDQ6VXNlcjc1MjczOTYx", "avatar_url": "https://avatars.githubusercontent.com/u/75273961?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DefiDebauchery", "html_url": "https://github.com/DefiDebauchery", "followers_url": "https://api.github.com/users/DefiDebauchery/followers", "following_url": "https://api.github.com/users/DefiDebauchery/following{/other_user}", "gists_url": "https://api.github.com/users/DefiDebauchery/gists{/gist_id}", "starred_url": "https://api.github.com/users/DefiDebauchery/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DefiDebauchery/subscriptions", "organizations_url": "https://api.github.com/users/DefiDebauchery/orgs", "repos_url": "https://api.github.com/users/DefiDebauchery/repos", "events_url": "https://api.github.com/users/DefiDebauchery/events{/privacy}", "received_events_url": "https://api.github.com/users/DefiDebauchery/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 2424324063, "node_id": "MDU6TGFiZWwyNDI0MzI0MDYz", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/intents%20related", "name": "intents related", "color": "99d4f7", "default": false, "description": "User provided bad/invalid intents"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2021-01-08T21:54:35Z", "updated_at": "2021-06-09T07:21:57Z", "closed_at": "2021-01-08T22:22:33Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\n\r\nIn version 1.6.0, the `wait_for` routine does not appear to return in the same manner as 1.5.1. \r\nWhile the check may or may not fire with the bot's `add_reaction` (just prior to the check), it never seems to handle subsequent user interaction.\r\n\r\n## Reproduction Steps\r\n\r\n```py\r\nimport asyncio\r\nimport discord\r\nfrom discord.ext import commands\r\n\r\nclass TestCog(commands.Cog):\r\n    def __init__(self, bot):\r\n        self.bot = bot\r\n        self.prompt = ['\u2705', '\u274c']\r\n\r\n    @commands.command()\r\n    @commands.dm_only()\r\n    async def test(self, ctx, *, test_input):\r\n        embed = discord.Embed(title='Your input', description='Please confirm the value below.')\r\n        embed.add_field(name='Input', value=test_input)\r\n\r\n        prompt = await ctx.channel.send(embed=embed)\r\n        for emoji in self.prompt:\r\n            await prompt.add_reaction(emoji=emoji)\r\n\r\n        def check(reaction, user):\r\n            print('Checking user interaction for', user, emoji)\r\n            return user == ctx.author and str(reaction.emoji) in self.prompt\r\n\r\n        try:\r\n            print('pre-reaction')\r\n            reaction, user = await self.bot.wait_for('reaction_add', timeout=5.0, check=check)\r\n            print('post-reaction')\r\n\r\n            await ctx.channel.send('Post-reaction!')\r\n        except asyncio.TimeoutError:\r\n            await ctx.channel.send(\"We did not receive a response\")\r\n\r\ndef setup(bot):\r\n    bot.add_cog(TestCog(bot))\r\n```\r\n\r\n## Expected Results\r\n\r\nAs with 1.5.1, we would expect the following output:\r\n\r\n```\r\n\u276f python3 main.py\r\npre-reaction\r\nChecking user interaction for theBot#9876 \u274c\r\nChecking user interaction for MyUser#1234 \u2705\r\npost-reaction\r\n```\r\n\r\n<img width=\"273\" alt=\"Screen Shot 2021-01-08 at 4 37 59 PM\" src=\"https://user-images.githubusercontent.com/75273961/104066748-ec54e980-51cf-11eb-96cc-e309c2b1544b.png\">\r\n\r\n\r\n## Actual Results\r\n\r\nWhen changed to 1.6.0, this is no longer handled in the same way\r\n\r\n```\r\n\u276f pip3 install discord.py==1.6.0\r\n\u276f python3 main.py\r\npre-reaction\r\nChecking user interaction for theBot#9876 \u274c\r\n```\r\n\r\nAnd after 5 seconds, the bot states that it did not receive any input\r\n\r\n<img width=\"257\" alt=\"Screen Shot 2021-01-08 at 4 40 44 PM\" src=\"https://user-images.githubusercontent.com/75273961/104066983-51104400-51d0-11eb-8b4c-1d2839daa672.png\">\r\n\r\n## Intents\r\n\r\nNo intents specifically defined, but do not believe changes would affect the outcome\r\n\r\n## Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n- [X] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\n<!-- Run `python -m discord -v` and paste this information below. -->\r\n<!-- This command is available in v1.1.0 or higher. If you are unable to run this command, paste basic info (ie. Python version, library version, and your operating system -->\r\n\r\n- Python v3.8.7-final\r\n- discord.py v1.6.0-final\r\n- aiohttp v3.6.3\r\n- system info: Darwin 20.2.0 Darwin Kernel Version 20.2.0: Wed Dec  2 20:39:59 PST 2020; root:xnu-7195.60.75~1/RELEASE_X86_64", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6280/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6280/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6273", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6273/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6273/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6273/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6273", "id": 781597237, "node_id": "MDU6SXNzdWU3ODE1OTcyMzc=", "number": 6273, "title": "avatar_url is returning old avatar", "user": {"login": "MangaD", "id": 11088596, "node_id": "MDQ6VXNlcjExMDg4NTk2", "avatar_url": "https://avatars.githubusercontent.com/u/11088596?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MangaD", "html_url": "https://github.com/MangaD", "followers_url": "https://api.github.com/users/MangaD/followers", "following_url": "https://api.github.com/users/MangaD/following{/other_user}", "gists_url": "https://api.github.com/users/MangaD/gists{/gist_id}", "starred_url": "https://api.github.com/users/MangaD/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MangaD/subscriptions", "organizations_url": "https://api.github.com/users/MangaD/orgs", "repos_url": "https://api.github.com/users/MangaD/repos", "events_url": "https://api.github.com/users/MangaD/events{/privacy}", "received_events_url": "https://api.github.com/users/MangaD/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 2424324063, "node_id": "MDU6TGFiZWwyNDI0MzI0MDYz", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/intents%20related", "name": "intents related", "color": "99d4f7", "default": false, "description": "User provided bad/invalid intents"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 12, "created_at": "2021-01-07T20:44:05Z", "updated_at": "2021-01-08T21:11:31Z", "closed_at": "2021-01-07T23:41:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\n\r\nI have a bot command for fetching a user's avatar, but it is returning an old avatar. I have to restart the bot for it to fetch the new avatar.\r\n\r\n## Reproduction Steps\r\n\r\nHere is the code corresponding to the command:\r\n\r\n```py\r\n@commands.command(description=\"Get the avatar image of a user. Usage: .avatar @user\")\r\n        async def avatar(self, ctx, *,  avamember : discord.Member=None):\r\n                \"\"\"Get the avatar image of a user. Usage: .avatar @user\"\"\"\r\n                userAvatarUrl = avamember.avatar_url\r\n                await ctx.send(userAvatarUrl)\r\n```\r\n\r\n## Expected Results\r\n\r\nReturn the latest avatar.\r\n\r\n## Actual Results\r\n\r\nReturned the old avatar.\r\n\r\n## Intents\r\n\r\nNot using this feature I think.\r\n\r\n## Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [ ] I have shown the entire traceback, if possible.\r\n- [ ] I have removed my token from display, if visible.\r\n- [ ] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\n- Python v3.7.3-final\r\n- discord.py v1.5.1-final\r\n- aiohttp v3.6.2\r\n- system info: Linux 5.4.79-v7l+ #1373 SMP Mon Nov 23 13:27:40 GMT 2020\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6273/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6273/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6240", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6240/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6240/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6240/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6240", "id": 777489454, "node_id": "MDU6SXNzdWU3Nzc0ODk0NTQ=", "number": 6240, "title": "Bot.check() is not properly permalinked", "user": {"login": "mesub7", "id": 49169805, "node_id": "MDQ6VXNlcjQ5MTY5ODA1", "avatar_url": "https://avatars.githubusercontent.com/u/49169805?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mesub7", "html_url": "https://github.com/mesub7", "followers_url": "https://api.github.com/users/mesub7/followers", "following_url": "https://api.github.com/users/mesub7/following{/other_user}", "gists_url": "https://api.github.com/users/mesub7/gists{/gist_id}", "starred_url": "https://api.github.com/users/mesub7/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mesub7/subscriptions", "organizations_url": "https://api.github.com/users/mesub7/orgs", "repos_url": "https://api.github.com/users/mesub7/repos", "events_url": "https://api.github.com/users/mesub7/events{/privacy}", "received_events_url": "https://api.github.com/users/mesub7/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-01-02T16:47:21Z", "updated_at": "2021-01-06T04:53:17Z", "closed_at": "2021-01-06T04:53:17Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## Summary\r\n\r\n<!-- A summary of your bug report -->\r\nIn the commands documentation, `Bot.check()` is not permalinked.\r\n\r\n## Reproduction Steps\r\n\r\n<!-- What you did to make it happen. Ideally there should be a short code snippet in this section to help reproduce the bug. -->\r\nHead to [the commands page of the ext.commands documentation](https://discordpy.readthedocs.io/en/latest/ext/commands/commands.html#global-checks) and look at `Bot.check()`.\r\n\r\n## Expected Results\r\n\r\n<!-- What you expected to happen -->\r\nJust like other functions on the page, `Bot.check()` should be permalinked.\r\n\r\n## Actual Results\r\n\r\n<!-- What actually happened. If there is a traceback, please show the entire thing. -->\r\nIt is not.\r\n![image](https://user-images.githubusercontent.com/49169805/103461993-23338700-4d1a-11eb-9dca-41455e1766d1.png)\r\n\r\n\r\n## Intents\r\n\r\n<!-- What intents are you using for your bot? This is the `discord.Intents` class you pass to the client -->\r\n\r\nN/A\r\n\r\n## Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n- [ ] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\n<!-- Run `python -m discord -v` and paste this information below. -->\r\n<!-- This command is available in v1.1.0 or higher. If you are unable to run this command, paste basic info (ie. Python version, library version, and your operating system -->\r\n\r\nWindows 10 v1909 - x64\r\nChrome 87", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6240/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6240/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6228", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6228/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6228/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6228/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6228", "id": 776857342, "node_id": "MDU6SXNzdWU3NzY4NTczNDI=", "number": 6228, "title": "Typos discovered by codespell", "user": {"login": "cclauss", "id": 3709715, "node_id": "MDQ6VXNlcjM3MDk3MTU=", "avatar_url": "https://avatars.githubusercontent.com/u/3709715?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cclauss", "html_url": "https://github.com/cclauss", "followers_url": "https://api.github.com/users/cclauss/followers", "following_url": "https://api.github.com/users/cclauss/following{/other_user}", "gists_url": "https://api.github.com/users/cclauss/gists{/gist_id}", "starred_url": "https://api.github.com/users/cclauss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cclauss/subscriptions", "organizations_url": "https://api.github.com/users/cclauss/orgs", "repos_url": "https://api.github.com/users/cclauss/repos", "events_url": "https://api.github.com/users/cclauss/events{/privacy}", "received_events_url": "https://api.github.com/users/cclauss/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-12-31T07:43:46Z", "updated_at": "2021-02-05T17:07:58Z", "closed_at": "2021-02-05T17:07:58Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## Summary \r\n\r\n<!-- A summary of your bug report -->\r\n\r\nDIscovered in #6227\r\n\r\n$ __codespell --ignore-words-list=\"nd\" --quiet-level=2__\r\n```\r\n./discord/object.py:68: convertable ==> convertible\r\n./discord/enums.py:247: noone ==> no one\r\n./discord/guild.py:1317: Retreives ==> Retrieves\r\n./discord/ext/commands/cooldowns.py:66: recieving ==> receiving\r\n./discord/ext/commands/errors.py:377: convertable ==> convertible\r\n./docs/api.rst:1936: noone ==> no one\r\n./docs/locale/ja/LC_MESSAGES/intro.po:81: libaries ==> libraries\r\n./docs/locale/ja/LC_MESSAGES/api.po:11075: Retreives ==> Retrieves\r\n./docs/locale/ja/LC_MESSAGES/ext/commands/api.po:5549: convertable ==> convertible\r\n./examples/custom_context.py:42: wasnt ==> wasn't\r\n./examples/custom_context.py:45: shouldnt ==> shouldn't\r\n```\r\n\r\n## Reproduction Steps\r\n\r\n<!-- What you did to make it happen. Ideally, there should be a short code snippet in this section to help reproduce the bug. -->\r\n\r\n## Expected Results\r\n\r\n<!-- What you expected to happen -->\r\n\r\n## Actual Results\r\n\r\n<!-- What actually happened. If there is a traceback, please show the entire thing. -->\r\n\r\n## Intents\r\n\r\n<!-- What intents are you using for your bot? This is the `discord.Intents` class you pass to the client -->\r\n\r\n## Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [ ] I have searched the open issues for duplicates.\r\n- [ ] I have shown the entire traceback, if possible.\r\n- [ ] I have removed my token from display, if visible.\r\n- [ ] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\n<!-- Run `python -m discord -v` and paste this information below. -->\r\n<!-- This command is available in v1.1.0 or higher. If you are unable to run this command, paste basic info (ie. Python version, library version, and your operating system -->\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6228/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6228/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6220", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6220/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6220/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6220/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6220", "id": 775782967, "node_id": "MDU6SXNzdWU3NzU3ODI5Njc=", "number": 6220, "title": "Webhook-sent messages are no longer directly publishable in 1.6.0a", "user": {"login": "bast0006", "id": 52266665, "node_id": "MDQ6VXNlcjUyMjY2NjY1", "avatar_url": "https://avatars.githubusercontent.com/u/52266665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bast0006", "html_url": "https://github.com/bast0006", "followers_url": "https://api.github.com/users/bast0006/followers", "following_url": "https://api.github.com/users/bast0006/following{/other_user}", "gists_url": "https://api.github.com/users/bast0006/gists{/gist_id}", "starred_url": "https://api.github.com/users/bast0006/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bast0006/subscriptions", "organizations_url": "https://api.github.com/users/bast0006/orgs", "repos_url": "https://api.github.com/users/bast0006/repos", "events_url": "https://api.github.com/users/bast0006/events{/privacy}", "received_events_url": "https://api.github.com/users/bast0006/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-12-29T09:03:16Z", "updated_at": "2020-12-29T13:28:20Z", "closed_at": "2020-12-29T13:27:16Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\n\r\nPrior to changes involved in #6058 , webhooks would return the Message object sent by a webhook. While this didn't permit editing, it did permit deleting and it also permitted publishing a webhook-sent message. When they were translated over to the new WebhookMessage backend the publish() function was missed, and now throws an error. \r\n\r\n## Reproduction Steps\r\n\r\n```py\r\nwh = (await channel.webhooks())[0]\r\nprint(wh)\r\nmsg = await wh.send(\"test\", wait=True)\r\nawait msg.publish()\r\n```\r\n\r\n## Expected Results\r\n\r\nThe message to be published, like before.\r\n\r\n## Actual Results\r\n\r\nA WebhookMessage does not set up its http state, and therefore the publish() command fails:\r\n\r\n```\r\nFile \"<string>\", line 9, in func\r\n     await msg.publish()\r\nFile \"/usr/local/lib/python3.8/site-packages/discord/message.py\", line 1061, in publish\r\n    await self._state.http.publish_message(self.channel.id, self.id)\r\nFile \"/usr/local/lib/python3.8/site-packages/discord/webhook.py\", line 382, in __getattr__\r\n    raise AttributeError('PartialWebhookState does not support http methods.')\r\nAttributeError: PartialWebhookState does not support http methods.\r\n```\r\n\r\n## Intents\r\n\r\nMembers, Presences\r\n\r\n## Checklist\r\n\r\n- [ x ] I have searched the open issues for duplicates.\r\n- [ x ] I have shown the entire traceback, if possible.\r\n- [ x ] I have removed my token from display, if visible.\r\n- [ x ] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\n- Python v3.8.1-final\r\n- discord.py v1.6.0-alpha\r\n    - discord.py pkg_resources: v1.6.0a2618+g93f102c\r\n- aiohttp v3.7.3\r\n- system info: Linux 5.4.0-58-generic #64-Ubuntu SMP Wed Dec 9 08:16:25 UTC 2020\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6220/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6220/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6215", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6215/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6215/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6215/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6215", "id": 774855834, "node_id": "MDU6SXNzdWU3NzQ4NTU4MzQ=", "number": 6215, "title": "[docs] Badly readable text in dark theme", "user": {"login": "sinus-x", "id": 14353790, "node_id": "MDQ6VXNlcjE0MzUzNzkw", "avatar_url": "https://avatars.githubusercontent.com/u/14353790?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sinus-x", "html_url": "https://github.com/sinus-x", "followers_url": "https://api.github.com/users/sinus-x/followers", "following_url": "https://api.github.com/users/sinus-x/following{/other_user}", "gists_url": "https://api.github.com/users/sinus-x/gists{/gist_id}", "starred_url": "https://api.github.com/users/sinus-x/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sinus-x/subscriptions", "organizations_url": "https://api.github.com/users/sinus-x/orgs", "repos_url": "https://api.github.com/users/sinus-x/repos", "events_url": "https://api.github.com/users/sinus-x/events{/privacy}", "received_events_url": "https://api.github.com/users/sinus-x/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-12-26T10:40:13Z", "updated_at": "2020-12-27T01:49:41Z", "closed_at": "2020-12-27T01:49:41Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## Summary\r\n\r\nWith the new design of the docs, there is a problem with highlighting. If you search for a term which is link, the result is non-pleasant combination of yellow and blue (see the screenshot).\r\n\r\n![image](https://user-images.githubusercontent.com/14353790/103149936-d4607d00-476e-11eb-9707-74ed628a9c51.png)\r\n\r\n\r\nI've tried to make the highlighted code white and it is much more readable:\r\n![image](https://user-images.githubusercontent.com/14353790/103149911-9ebb9400-476e-11eb-83bf-99a06b07c3f2.png)\r\n\r\nAll I did was to add `color: #ffffff` to the CSS selector `span.highlighted`, but I'm not sure what else could have been affected by this.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6215/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6215/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6210", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6210/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6210/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6210/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6210", "id": 774772366, "node_id": "MDU6SXNzdWU3NzQ3NzIzNjY=", "number": 6210, "title": "[commands] Using search produces an error", "user": {"login": "mesub7", "id": 49169805, "node_id": "MDQ6VXNlcjQ5MTY5ODA1", "avatar_url": "https://avatars.githubusercontent.com/u/49169805?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mesub7", "html_url": "https://github.com/mesub7", "followers_url": "https://api.github.com/users/mesub7/followers", "following_url": "https://api.github.com/users/mesub7/following{/other_user}", "gists_url": "https://api.github.com/users/mesub7/gists{/gist_id}", "starred_url": "https://api.github.com/users/mesub7/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mesub7/subscriptions", "organizations_url": "https://api.github.com/users/mesub7/orgs", "repos_url": "https://api.github.com/users/mesub7/repos", "events_url": "https://api.github.com/users/mesub7/events{/privacy}", "received_events_url": "https://api.github.com/users/mesub7/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-12-25T18:51:35Z", "updated_at": "2020-12-26T14:55:23Z", "closed_at": "2020-12-25T19:22:23Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## Summary\r\n\r\n<!-- A summary of your bug report -->\r\nWhen using search for the documentation (discord.ext.commands) on the latest branch, a 404 error appears.\r\n## Reproduction Steps\r\n\r\n<!-- What you did to make it happen. Ideally there should be a short code snippet in this section to help reproduce the bug. -->\r\n\u2022 Navigate to the ext.commands documentation on the latest branch.\r\n\u2022 Search for any term (for consistency we could just say commands.Bot)\r\n## Expected Results\r\n\r\nIt produces results on your search term.\r\n\r\n## Actual Results\r\n\r\nIt produces a 404 error ('Sorry this page doesn't exist yet').\r\n\r\n<!-- What actually happened. If there is a traceback, please show the entire thing. -->\r\n\r\n## Intents\r\n\r\n<!-- What intents are you using for your bot? This is the `discord.Intents` class you pass to the client -->\r\n\r\nN/A\r\n\r\n## Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have removed my token from display, if visible.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have searched the open issues for duplicates.\r\n- [] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\n<!-- Run `python -m discord -v` and paste this information below. -->\r\n<!-- This command is available in v1.1.0 or higher. If you are unable to run this command, paste basic info (ie. Python version, library version, and your operating system -->\r\n\r\nPython Version: N/A\r\nDevice: Motorola Moto G6 Play, Android 9\r\nWeb browser: Google Chrome 87", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6210/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6210/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6209", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6209/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6209/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6209/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6209", "id": 774703460, "node_id": "MDU6SXNzdWU3NzQ3MDM0NjA=", "number": 6209, "title": "[docs] The description of the `on_member_update` function is not clear", "user": {"login": "ishowta", "id": 7393198, "node_id": "MDQ6VXNlcjczOTMxOTg=", "avatar_url": "https://avatars.githubusercontent.com/u/7393198?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ishowta", "html_url": "https://github.com/ishowta", "followers_url": "https://api.github.com/users/ishowta/followers", "following_url": "https://api.github.com/users/ishowta/following{/other_user}", "gists_url": "https://api.github.com/users/ishowta/gists{/gist_id}", "starred_url": "https://api.github.com/users/ishowta/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ishowta/subscriptions", "organizations_url": "https://api.github.com/users/ishowta/orgs", "repos_url": "https://api.github.com/users/ishowta/repos", "events_url": "https://api.github.com/users/ishowta/events{/privacy}", "received_events_url": "https://api.github.com/users/ishowta/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-12-25T10:24:47Z", "updated_at": "2020-12-25T11:16:58Z", "closed_at": "2020-12-25T11:12:19Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\n\r\n(Sorry if there is/are some mistakes, i'm not an English speaker)\r\nIn the description of the `on_member_update` function, it says _Called when a Member updates their profile._ But this is probably misleading, because `status` and `activity` property changes are done automatically by Discord, not by Member.\r\n\r\nhttps://github.com/Rapptz/discord.py/blob/master/docs/api.rst#event-reference\r\n```\r\n.. function:: on_member_update(before, after)\r\n\r\n    Called when a :class:`Member` updates their profile.\r\n\r\n    This is called when one or more of the following things change:\r\n\r\n    - status\r\n    - activity\r\n    - nickname\r\n    - roles\r\n\r\n    This requires :attr:`Intents.members` to be enabled.\r\n\r\n    :param before: The updated member's old info.\r\n    :type before: :class:`Member`\r\n    :param after: The updated member's updated info.\r\n    :type after: :class:`Member`\r\n```\r\n\r\n## Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n- [ ] I have provided the intents that my bot is using.\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6209/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6209/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6192", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6192/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6192/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6192/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6192", "id": 774120786, "node_id": "MDU6SXNzdWU3NzQxMjA3ODY=", "number": 6192, "title": "unexpected allowed_mentions when set on message.send but not on Client", "user": {"login": "Yay295", "id": 8922038, "node_id": "MDQ6VXNlcjg5MjIwMzg=", "avatar_url": "https://avatars.githubusercontent.com/u/8922038?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Yay295", "html_url": "https://github.com/Yay295", "followers_url": "https://api.github.com/users/Yay295/followers", "following_url": "https://api.github.com/users/Yay295/following{/other_user}", "gists_url": "https://api.github.com/users/Yay295/gists{/gist_id}", "starred_url": "https://api.github.com/users/Yay295/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Yay295/subscriptions", "organizations_url": "https://api.github.com/users/Yay295/orgs", "repos_url": "https://api.github.com/users/Yay295/repos", "events_url": "https://api.github.com/users/Yay295/events{/privacy}", "received_events_url": "https://api.github.com/users/Yay295/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 251130944, "node_id": "MDU6TGFiZWwyNTExMzA5NDQ=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/help%20appreciated", "name": "help appreciated", "color": "159818", "default": false, "description": "Good issue to work on"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-12-24T01:21:01Z", "updated_at": "2021-02-24T08:06:44Z", "closed_at": "2021-02-24T08:06:44Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\n\r\nIn `discord.Client` `allowed_mentions` is not set to anything by default. When a message is sent without specifying `allowed_mentions` but specifying `mention_author`, `allowed_mentions` gets set to an empty dict with `replied_user` set<sup>[1]</sup>.\r\n\r\nTo put it another way:\r\n```python\r\nif not client.allowed_mentions and not message.allowed_mentions:\r\n    if message.mention_author is None:\r\n        allowed_mentions = discord.AllowedMentions(everyone=True, users=True, roles=True, replied_user=False)\r\n    else:\r\n        allowed_mentions = discord.AllowedMentions(everyone=False, users=False, roles=False, replied_user=message.mention_author)\r\n```\r\n(note: that is pseudocode, not how it actually works)\r\n\r\n## Reproduction Steps\r\n\r\nDon't set `allowed_mentions` when creating a client. Send a message that has mentions in its text, set `mention_author` to anything other than `None`, and do not set `allowed_mentions`.\r\n\r\n## Expected Results\r\n\r\nThe users mentioned in the message text will be pinged.\r\n\r\n## Actual Results\r\n\r\nThe users mentioned in the message text are not pinged.\r\n\r\n## Intents\r\n\r\n```python\r\ndiscord.Intents(guilds=True,members=True,messages=True,reactions=True)\r\n```\r\n\r\n## Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n- [X] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\n- Python v3.8.5-final\r\n- discord.py v1.6.0-alpha\r\n    - discord.py pkg_resources: v1.6.0a2705+geb11079\r\n- aiohttp v3.6.2\r\n- system info: Linux 5.4.0-48-generic #52-Ubuntu SMP Thu Sep 10 10:58:49 UTC 2020\r\n\r\n[1]: https://github.com/Rapptz/discord.py/blob/eb11079569570ce991d9468ca40eb8fcf129e0be/discord/abc.py#L889-L899", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6192/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6192/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6180", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6180/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6180/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6180/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6180", "id": 771419933, "node_id": "MDU6SXNzdWU3NzE0MTk5MzM=", "number": 6180, "title": "shard.is_closed says False, even if bot is offline.", "user": {"login": "Miolus", "id": 69853686, "node_id": "MDQ6VXNlcjY5ODUzNjg2", "avatar_url": "https://avatars.githubusercontent.com/u/69853686?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Miolus", "html_url": "https://github.com/Miolus", "followers_url": "https://api.github.com/users/Miolus/followers", "following_url": "https://api.github.com/users/Miolus/following{/other_user}", "gists_url": "https://api.github.com/users/Miolus/gists{/gist_id}", "starred_url": "https://api.github.com/users/Miolus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Miolus/subscriptions", "organizations_url": "https://api.github.com/users/Miolus/orgs", "repos_url": "https://api.github.com/users/Miolus/repos", "events_url": "https://api.github.com/users/Miolus/events{/privacy}", "received_events_url": "https://api.github.com/users/Miolus/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-12-19T17:24:55Z", "updated_at": "2020-12-31T19:34:45Z", "closed_at": "2020-12-31T19:34:45Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## Summary\r\n\r\nshard.is_closed is False if shard is offline after some disconnects\r\n\r\n## Reproduction Steps\r\n\r\nstrange but it will proof it:\r\n\r\n```\r\n@bot.event\r\nasync def on_shard_disconnect(id): <- only for proof\r\nwhile True:\r\n    await asyncio.sleep(10)\r\n    sh = bot.get_shard(id)\r\n    if sh.is_closed():\r\n            await sh.connect()\r\n\r\nbot.run(token, reconnect=True)\r\n\r\n```\r\n\r\n## Expected Results\r\n\r\nshard reconnects automatically everytime, should also do it without the event which was only written for the proof.\r\n\r\n## Actual Results\r\n\r\nAfter some hours and some normal reconnects, the shard won't reconnect again, probably cause ws.is_closed is false all the time. Also the bot.run(...., reconnect=True) doesn't reconnect the shard anymore. \nAfter further investigation I found out the event didnt even fire. My small sharded test bot does not get this bug, my big bot with the same code does.\r\n\r\n## Intents\r\n\r\nmembers\r\n\r\n## Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x ] I have searched the open issues for duplicates.\r\n- [x ] I have shown the entire traceback, if possible.\r\n- [x ] I have removed my token from display, if visible.\r\n- [x ] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\ndiscord.py 1.5.1, python3.8.2\r``", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6180/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6180/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6172", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6172/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6172/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6172/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6172", "id": 770476398, "node_id": "MDU6SXNzdWU3NzA0NzYzOTg=", "number": 6172, "title": "When max concurrency is triggered, the command invocation still counts towards cooldown", "user": {"login": "Jackenmen", "id": 6032823, "node_id": "MDQ6VXNlcjYwMzI4MjM=", "avatar_url": "https://avatars.githubusercontent.com/u/6032823?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jackenmen", "html_url": "https://github.com/Jackenmen", "followers_url": "https://api.github.com/users/Jackenmen/followers", "following_url": "https://api.github.com/users/Jackenmen/following{/other_user}", "gists_url": "https://api.github.com/users/Jackenmen/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jackenmen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jackenmen/subscriptions", "organizations_url": "https://api.github.com/users/Jackenmen/orgs", "repos_url": "https://api.github.com/users/Jackenmen/repos", "events_url": "https://api.github.com/users/Jackenmen/events{/privacy}", "received_events_url": "https://api.github.com/users/Jackenmen/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/12", "html_url": "https://github.com/Rapptz/discord.py/milestone/12", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/12/labels", "id": 6134466, "node_id": "MDk6TWlsZXN0b25lNjEzNDQ2Ng==", "number": 12, "title": "v1.6", "description": "A minor version bump to appease the masses. ", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 30, "state": "closed", "created_at": "2020-11-22T03:43:55Z", "updated_at": "2021-01-15T10:25:08Z", "due_on": null, "closed_at": "2021-01-15T10:25:08Z"}, "comments": 1, "created_at": "2020-12-18T00:36:24Z", "updated_at": "2020-12-18T03:24:39Z", "closed_at": "2020-12-18T03:24:38Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## Summary\r\n\r\nWhen max concurrency is triggered, the command invocation still counts towards cooldown. While I'm not sure if it's not intentional, it's not documented and might be a bit confusing for someone who doesn't know how it works internally.\r\n\r\n## Reproduction Steps\r\n\r\nThis should do as an example command:\r\n```py\r\n@commands.max_concurrency(1)\r\n@commands.cooldown(1, 15)\r\n@commands.command()\r\nasync def test(ctx):\r\n    await asyncio.sleep(20)\r\n```\r\nSo, to reproduce this, you need to:\r\n1. Run `test` command.\r\n2. Run `test` command after the cooldown wears off, but before the command from `1` stops running.\r\n2.1. This should result in an error about the concurrency.\r\n3. Try running `test` command either right after that or when the command from `1` stops running, but before cooldown wears off, it doesn't matter.\r\n3.1. You should see that the command gets cooldowned even though it didn't run in `2`.\r\n\r\n## Expected Results\r\n\r\nWhen max concurrency is triggered, I expected the command invocation to not count towards cooldown.\r\n\r\n## Actual Results\r\n\r\nWhen max concurrency is triggered, the command invocation still counts towards cooldown.\r\n\r\n## Intents\r\n\r\nShouldn't be needed in this, but I use `discord.Intents.all()` as my intents.\r\n\r\n## Checklist\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n- [x] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\n```\r\n- Python v3.8.6-final\r\n- discord.py v1.5.1-final\r\n- aiohttp v3.6.2\r\n- system info: Windows 10 10.0.19041\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6172/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6172/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6170", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6170/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6170/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6170/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6170", "id": 769506247, "node_id": "MDU6SXNzdWU3Njk1MDYyNDc=", "number": 6170, "title": "Error upgrading discord.py to 1.5.1", "user": {"login": "NicerNewerCar", "id": 30351234, "node_id": "MDQ6VXNlcjMwMzUxMjM0", "avatar_url": "https://avatars.githubusercontent.com/u/30351234?v=4", "gravatar_id": "", "url": "https://api.github.com/users/NicerNewerCar", "html_url": "https://github.com/NicerNewerCar", "followers_url": "https://api.github.com/users/NicerNewerCar/followers", "following_url": "https://api.github.com/users/NicerNewerCar/following{/other_user}", "gists_url": "https://api.github.com/users/NicerNewerCar/gists{/gist_id}", "starred_url": "https://api.github.com/users/NicerNewerCar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/NicerNewerCar/subscriptions", "organizations_url": "https://api.github.com/users/NicerNewerCar/orgs", "repos_url": "https://api.github.com/users/NicerNewerCar/repos", "events_url": "https://api.github.com/users/NicerNewerCar/events{/privacy}", "received_events_url": "https://api.github.com/users/NicerNewerCar/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 653343598, "node_id": "MDU6TGFiZWw2NTMzNDM1OTg=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/off-topic", "name": "off-topic", "color": "d4c5f9", "default": false, "description": "This does not belong here."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-12-17T04:37:02Z", "updated_at": "2020-12-17T22:53:31Z", "closed_at": "2020-12-17T22:53:31Z", "author_association": "NONE", "active_lock_reason": null, "body": "I keep getting the following error whenever I try to update to 1.5.1, I have no outdated packages in my pip (aside from discord): Any help will be appreciated.\r\n\r\n>pip install discord.py\r\nCollecting discord.py\r\n  Using cached discord.py-1.5.1-py3-none-any.whl (701 kB)\r\nCollecting aiohttp<3.7.0,>=3.6.0\r\n  Using cached aiohttp-3.6.3.tar.gz (1.1 MB)\r\n  Installing build dependencies ... error\r\n  ERROR: Command errored out with exit status 1:\r\n   command: 'c:\\python38\\python.exe' 'c:\\python38\\lib\\site-packages\\pip' install --ignore-installed --no-user --prefix 'C:\\Users\\~~~~~\\AppData\\Local\\Temp\\pip-build-env-zshjnipi\\overlay' --no-warn-script-location --no-binary :none: --only-binary :none: -i https://pypi.org/simple -- 'setuptools>=40.8.0' wheel\r\n       cwd: None\r\n  Complete output (42 lines):\r\n  Traceback (most recent call last):\r\n    File \"c:\\python38\\lib\\runpy.py\", line 194, in _run_module_as_main\r\n      return _run_code(code, main_globals, None,\r\n    File \"c:\\python38\\lib\\runpy.py\", line 87, in _run_code\r\n      exec(code, run_globals)\r\n    File \"c:\\python38\\lib\\site-packages\\pip\\__main__.py\", line 26, in <module>\r\n      sys.exit(_main())\r\n    File \"c:\\python38\\lib\\site-packages\\pip\\_internal\\cli\\main.py\", line 73, in main\r\n      command = create_command(cmd_name, isolated=(\"--isolated\" in cmd_args))\r\n    File \"c:\\python38\\lib\\site-packages\\pip\\_internal\\commands\\__init__.py\", line 105, in create_command\r\n      module = importlib.import_module(module_path)\r\n    File \"c:\\python38\\lib\\importlib\\__init__.py\", line 127, in import_module\r\n      return _bootstrap._gcd_import(name[level:], package, level)\r\n    File \"<frozen importlib._bootstrap>\", line 1014, in _gcd_import\r\n    File \"<frozen importlib._bootstrap>\", line 991, in _find_and_load\r\n    File \"<frozen importlib._bootstrap>\", line 975, in _find_and_load_unlocked\r\n    File \"<frozen importlib._bootstrap>\", line 671, in _load_unlocked\r\n    File \"<frozen importlib._bootstrap_external>\", line 783, in exec_module\r\n    File \"<frozen importlib._bootstrap>\", line 219, in _call_with_frames_removed\r\n    File \"c:\\python38\\lib\\site-packages\\pip\\_internal\\commands\\install.py\", line 17, in <module>\r\n      from pip._internal.cli.req_command import RequirementCommand, with_cleanup\r\n    File \"c:\\python38\\lib\\site-packages\\pip\\_internal\\cli\\req_command.py\", line 18, in <module>\r\n      from pip._internal.index.collector import LinkCollector\r\n    File \"c:\\python38\\lib\\site-packages\\pip\\_internal\\index\\collector.py\", line 14, in <module>\r\n      from pip._vendor import html5lib, requests\r\n    File \"c:\\python38\\lib\\site-packages\\pip\\_vendor\\requests\\__init__.py\", line 125, in <module>\r\n      from . import utils\r\n    File \"c:\\python38\\lib\\site-packages\\pip\\_vendor\\requests\\utils.py\", line 25, in <module>\r\n      from . import certs\r\n    File \"c:\\python38\\lib\\site-packages\\pip\\_vendor\\requests\\certs.py\", line 15, in <module>\r\n      from pip._vendor.certifi import where\r\n    File \"c:\\python38\\lib\\site-packages\\pip\\_vendor\\certifi\\__init__.py\", line 1, in <module>\r\n      from .core import contents, where\r\n    File \"c:\\python38\\lib\\site-packages\\pip\\_vendor\\certifi\\core.py\", line 12, in <module>\r\n      from importlib.resources import path as get_path, read_text\r\n    File \"c:\\python38\\lib\\importlib\\resources.py\", line 11, in <module>\r\n      from typing import Iterable, Iterator, Optional, Set, Union   # noqa: F401\r\n    File \"c:\\python38\\lib\\site-packages\\typing.py\", line 1359, in <module>\r\n      class Callable(extra=collections_abc.Callable, metaclass=CallableMeta):\r\n    File \"c:\\python38\\lib\\site-packages\\typing.py\", line 1007, in __new__\r\n      self._abc_registry = extra._abc_registry\r\n  AttributeError: type object 'Callable' has no attribute '_abc_registry'\r\n  ----------------------------------------\r\nERROR: Command errored out with exit status 1: 'c:\\python38\\python.exe' 'c:\\python38\\lib\\site-packages\\pip' install --ignore-installed --no-user --prefix 'C:\\Users\\~~~~~\\AppData\\Local\\Temp\\pip-build-env-zshjnipi\\overlay' --no-warn-script-location --no-binary :none: --only-binary :none: -i https://pypi.org/simple -- 'setuptools>=40.8.0' wheel Check the logs for full command output.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6170/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6170/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6159", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6159/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6159/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6159/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6159", "id": 764536663, "node_id": "MDU6SXNzdWU3NjQ1MzY2NjM=", "number": 6159, "title": "Impossible to differentiate added and removed roles in member_role_update audit log", "user": {"login": "Bluenix2", "id": 38372706, "node_id": "MDQ6VXNlcjM4MzcyNzA2", "avatar_url": "https://avatars.githubusercontent.com/u/38372706?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Bluenix2", "html_url": "https://github.com/Bluenix2", "followers_url": "https://api.github.com/users/Bluenix2/followers", "following_url": "https://api.github.com/users/Bluenix2/following{/other_user}", "gists_url": "https://api.github.com/users/Bluenix2/gists{/gist_id}", "starred_url": "https://api.github.com/users/Bluenix2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Bluenix2/subscriptions", "organizations_url": "https://api.github.com/users/Bluenix2/orgs", "repos_url": "https://api.github.com/users/Bluenix2/repos", "events_url": "https://api.github.com/users/Bluenix2/events{/privacy}", "received_events_url": "https://api.github.com/users/Bluenix2/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 251130945, "node_id": "MDU6TGFiZWwyNTExMzA5NDU=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/invalid", "name": "invalid", "color": "e6e6e6", "default": true, "description": "This is not right."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-12-12T22:59:53Z", "updated_at": "2021-05-29T20:09:57Z", "closed_at": "2020-12-12T23:14:38Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## Summary\r\n\r\nLooking at [AuditLogAction.member_role_update](https://discordpy.readthedocs.io/en/latest/api.html#discord.AuditLogAction.member_role_update)  we can see that the attribute of AuditLogDiff we can expect is [roles](https://discordpy.readthedocs.io/en/latest/api.html#discord.AuditLogDiff.roles). Further reading tells us that `AuditLogDiff.roles` is only a List of roles that were added or removed.\r\nBut then at the [Discord API documentation for Audit Log Entries](https://discord.com/developers/docs/resources/audit-log-entry-object) we can see that we get several changes, in the case of `member_role_update` this means both `$add` and `$remove` Audit Log Change Keys.\r\n\r\n**So, it is impossible to differentiate between added, and removed roles in discord.py**\r\n\r\nFor simplicity in breaking changes, I propose the idea of just adding `added_roles` and `removed_roles` attributes, keeping the original `roles` list which is still a composite list of both added and removed roles", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6159/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6159/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6143", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6143/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6143/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6143/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6143", "id": 760809954, "node_id": "MDU6SXNzdWU3NjA4MDk5NTQ=", "number": 6143, "title": "Python 3.7.9: No module named 'discord'", "user": {"login": "hoverdoge", "id": 44949608, "node_id": "MDQ6VXNlcjQ0OTQ5NjA4", "avatar_url": "https://avatars.githubusercontent.com/u/44949608?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hoverdoge", "html_url": "https://github.com/hoverdoge", "followers_url": "https://api.github.com/users/hoverdoge/followers", "following_url": "https://api.github.com/users/hoverdoge/following{/other_user}", "gists_url": "https://api.github.com/users/hoverdoge/gists{/gist_id}", "starred_url": "https://api.github.com/users/hoverdoge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hoverdoge/subscriptions", "organizations_url": "https://api.github.com/users/hoverdoge/orgs", "repos_url": "https://api.github.com/users/hoverdoge/repos", "events_url": "https://api.github.com/users/hoverdoge/events{/privacy}", "received_events_url": "https://api.github.com/users/hoverdoge/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 251130945, "node_id": "MDU6TGFiZWwyNTExMzA5NDU=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/invalid", "name": "invalid", "color": "e6e6e6", "default": true, "description": "This is not right."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-12-10T01:48:55Z", "updated_at": "2021-05-29T11:21:18Z", "closed_at": "2020-12-10T03:51:53Z", "author_association": "NONE", "active_lock_reason": null, "body": "## EDIT\r\n\r\nI was running the wrong interpreter in VS Code.\r\n\r\n## Summary\r\n\r\nI just switched from a web-based IDE(repl.it) to VS Code on my Mac running Catalina. I have installed 3.7.9 and set it as global, and of course installed discord.py with pip. However, running `import discord` still causes the following error to appear: `ModuleNotFoundError: No module named 'discord'`. \r\nI also have the following packages: https://i.stack.imgur.com/dlnTq.png\r\n\r\n## Reproduction Steps\r\n\r\n```import discord``` in VS Code running Python 3.7.9\r\n\r\n## Expected Results\r\n\r\nI expected discord to reflect its status as being installed.\r\n\r\n## Actual Results\r\n\r\n`ModuleNotFoundError: No module named 'discord'`\r\n`Traceback (most recent call last):\r\n  File \"/Users/myname/Desktop/CM-Public/main.py\", line 6, in <module>\r\n    import discord\r\nModuleNotFoundError: No module named 'discord'`\r\n\r\n## Intents\r\n\r\nI am using all intents, though I doubt it's relevant to this.\r\n\r\n## Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates. (i have looked and found all issues and soverflow posts and none have solved my issue)\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n- [x] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\n<!-- Run `python -m discord -v` and paste this information below. -->\r\n- Python v3.7.9-final\r\n- discord.py v1.5.1-final\r\n- aiohttp v3.6.3\r\n- system info: Darwin 19.6.0 Darwin Kernel Version 19.6.0: Thu Jun 18 20:49:00 PDT 2020; root:xnu-6153.141.1~1/RELEASE_X86_64\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6143/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6143/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6133", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6133/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6133/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6133/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6133", "id": 759834488, "node_id": "MDU6SXNzdWU3NTk4MzQ0ODg=", "number": 6133, "title": "Suppressing embeds in another user's message doesn't work anymore", "user": {"login": "muddyfish", "id": 5381483, "node_id": "MDQ6VXNlcjUzODE0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/5381483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/muddyfish", "html_url": "https://github.com/muddyfish", "followers_url": "https://api.github.com/users/muddyfish/followers", "following_url": "https://api.github.com/users/muddyfish/following{/other_user}", "gists_url": "https://api.github.com/users/muddyfish/gists{/gist_id}", "starred_url": "https://api.github.com/users/muddyfish/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/muddyfish/subscriptions", "organizations_url": "https://api.github.com/users/muddyfish/orgs", "repos_url": "https://api.github.com/users/muddyfish/repos", "events_url": "https://api.github.com/users/muddyfish/events{/privacy}", "received_events_url": "https://api.github.com/users/muddyfish/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-12-08T22:29:59Z", "updated_at": "2020-12-09T02:14:06Z", "closed_at": "2020-12-09T02:14:06Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## Summary\r\n\r\nIf you do `message.edit(suppress=True)` on a message not sent by you, you get the 'Cannot edit a message authored by another user' message\r\n\r\nThe issue is in [this piece of code](https://github.com/Rapptz/discord.py/blob/master/discord/message.py#L1006-L1023); it always adds a `allowed_mentions` field to the http request, which causes the issue, as the only thing allowed to be edited in another user's messages is the flags\r\n\r\n## Reproduction Steps\r\n\r\n```\r\nawait message.edit(suppress=True)\r\n```\r\nor \r\n```\r\nawait sent_message.edit(flags=MessageFlags.suppress_embeds.flag)\r\n```\r\n\r\n<!-- What you did to make it happen. Ideally there should be a short code snippet in this section to help reproduce the bug. -->\r\n\r\n## Expected Results\r\n\r\n<!-- What you expected to happen -->\r\nEmbeds in the message disappear\r\n\r\n## Actual Results\r\n\r\n<!-- What actually happened. If there is a traceback, please show the entire thing. -->\r\n> 403 Forbidden (error code: 50005): Cannot edit a message authored by another user\r\n\r\n## Intents\r\n\r\n<!-- What intents are you using for your bot? This is the `discord.Intents` class you pass to the client -->\r\nIrrelevant \r\n\r\n## Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n- [ ] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\n<!-- Run `python -m discord -v` and paste this information below. -->\r\n<!-- This command is available in v1.1.0 or higher. If you are unable to run this command, paste basic info (ie. Python version, library version, and your operating system -->\r\n\r\nCurrent HEAD (0995d077271ed97129c9d06833f710d2c2744dae)", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6133/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6133/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6116", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6116/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6116/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6116/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6116", "id": 756231514, "node_id": "MDU6SXNzdWU3NTYyMzE1MTQ=", "number": 6116, "title": "Mute members permission doesn't work", "user": {"login": "Lexzach", "id": 53662039, "node_id": "MDQ6VXNlcjUzNjYyMDM5", "avatar_url": "https://avatars.githubusercontent.com/u/53662039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Lexzach", "html_url": "https://github.com/Lexzach", "followers_url": "https://api.github.com/users/Lexzach/followers", "following_url": "https://api.github.com/users/Lexzach/following{/other_user}", "gists_url": "https://api.github.com/users/Lexzach/gists{/gist_id}", "starred_url": "https://api.github.com/users/Lexzach/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Lexzach/subscriptions", "organizations_url": "https://api.github.com/users/Lexzach/orgs", "repos_url": "https://api.github.com/users/Lexzach/repos", "events_url": "https://api.github.com/users/Lexzach/events{/privacy}", "received_events_url": "https://api.github.com/users/Lexzach/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 251130945, "node_id": "MDU6TGFiZWwyNTExMzA5NDU=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/invalid", "name": "invalid", "color": "e6e6e6", "default": true, "description": "This is not right."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-12-03T14:16:03Z", "updated_at": "2020-12-03T15:10:14Z", "closed_at": "2020-12-03T15:10:13Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\nMute members permission doesn't work, even if you have the permission or the owner of the server.\r\n\r\n## Reproduction Steps\r\n\r\nHave a command that requires mute_members permission.\r\n\r\n## Expected Results\r\n\r\nThe command is executed if the user has `Mute Members` permission.\r\n\r\n## Actual Results\r\n\r\nTraceback says that you need `Mute Members` permission even though I am the owner of the server.\r\n\r\n```\r\nFile \"C:\\Users\\Lexzach\\AppData\\Local\\Packages\\PythonSoftwareFoundation.Python.3.8_qbz5n2kfra8p0\\LocalCache\\local-packages\\Python38\\site-packages\\discord\\ext\\commands\\bot.py\", line 903, in invoke\r\n    await ctx.command.invoke(ctx)\r\n  File \"C:\\Users\\Lexzach\\AppData\\Local\\Packages\\PythonSoftwareFoundation.Python.3.8_qbz5n2kfra8p0\\LocalCache\\local-packages\\Python38\\site-packages\\discord\\ext\\commands\\core.py\", line 851, in invoke\r\n    await self.prepare(ctx)\r\n  File \"C:\\Users\\Lexzach\\AppData\\Local\\Packages\\PythonSoftwareFoundation.Python.3.8_qbz5n2kfra8p0\\LocalCache\\local-packages\\Python38\\site-packages\\discord\\ext\\commands\\core.py\", line 778, in prepare\r\n    if not await self.can_run(ctx):\r\n  File \"C:\\Users\\Lexzach\\AppData\\Local\\Packages\\PythonSoftwareFoundation.Python.3.8_qbz5n2kfra8p0\\LocalCache\\local-packages\\Python38\\site-packages\\discord\\ext\\commands\\core.py\", line 1076, in can_run\r\n    return await discord.utils.async_all(predicate(ctx) for predicate in predicates)\r\n  File \"C:\\Users\\Lexzach\\AppData\\Local\\Packages\\PythonSoftwareFoundation.Python.3.8_qbz5n2kfra8p0\\LocalCache\\local-packages\\Python38\\site-packages\\discord\\utils.py\", line 338, in async_all\r\n    for elem in gen:\r\n  File \"C:\\Users\\Lexzach\\AppData\\Local\\Packages\\PythonSoftwareFoundation.Python.3.8_qbz5n2kfra8p0\\LocalCache\\local-packages\\Python38\\site-packages\\discord\\ext\\commands\\core.py\", line 1076, in <genexpr>\r\n    return await discord.utils.async_all(predicate(ctx) for predicate in predicates)\r\n  File \"C:\\Users\\Lexzach\\AppData\\Local\\Packages\\PythonSoftwareFoundation.Python.3.8_qbz5n2kfra8p0\\LocalCache\\local-packages\\Python38\\site-packages\\discord\\ext\\commands\\core.py\", line 1769, in predicate\r\n    raise MissingPermissions(missing)\r\ndiscord.ext.commands.errors.MissingPermissions: You are missing Mute Members permission(s) to run this command.\r\n```\r\n\r\n## Intents\r\n\r\n- Messages\r\n- Guilds\r\n- Reactions\r\n- Members\r\n- Presences\r\n\r\n## Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n- [x] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\n- Python v3.8.6-final\r\n- discord.py v1.5.1-final\r\n- aiohttp v3.6.3\r\n- system info: Windows 10 10.0.19041\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6116/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6116/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6115", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6115/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6115/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6115/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6115", "id": 755550220, "node_id": "MDU6SXNzdWU3NTU1NTAyMjA=", "number": 6115, "title": "magic async def that remains in the cog on any changes", "user": {"login": "ghost", "id": 10137, "node_id": "MDQ6VXNlcjEwMTM3", "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghost", "html_url": "https://github.com/ghost", "followers_url": "https://api.github.com/users/ghost/followers", "following_url": "https://api.github.com/users/ghost/following{/other_user}", "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghost/subscriptions", "organizations_url": "https://api.github.com/users/ghost/orgs", "repos_url": "https://api.github.com/users/ghost/repos", "events_url": "https://api.github.com/users/ghost/events{/privacy}", "received_events_url": "https://api.github.com/users/ghost/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 251130945, "node_id": "MDU6TGFiZWwyNTExMzA5NDU=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/invalid", "name": "invalid", "color": "e6e6e6", "default": true, "description": "This is not right."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-12-02T19:27:33Z", "updated_at": "2020-12-02T19:39:52Z", "closed_at": "2020-12-02T19:31:54Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\n\r\nIt's time to create a new async def (not command) for my cog ('Economy') to send server transaction information to a specific channel. Having created an async def in Economy, I tried it from another cog to check it works (everything was correct). After supplementing that async def again with new transaction types, I reload cog (unload + load), tested again from another cog, I noticed that my changes did not take effect. I updated the async def a couple of times, did a reload cog, but nothing changed (as if it worked like the very first time). After rebooting the machine, it was again the same. I tried commenting out this function, reload cog again, but it still worked like the very first time. I tried changing other functions in the cog (commands, simple def), after reloading the cog they worked with the changes, but not the same async def. (async def works even by calling inside the cog when it is commented out)\r\n_note_ - I have the same thing with my classes, I update them, reload cog, but there are no changes in the work of the class, only after restarting the bot does it start working\r\n\r\n## Reproduction Steps\r\n\r\n1. Create a bot with cogs\r\n2. Write a simple async def (not a command) to one of the cogs\r\n3. reload cog\r\n4. Rewrite async def work\r\n5. reload cog\r\n\r\n<!-- What you did to make it happen. Ideally there should be a short code snippet in this section to help reproduce the bug. -->\r\n\r\n## Expected Results\r\n\r\nI was expecting working changes to async def after reload cog\r\n\r\n<!-- What you expected to happen -->\r\n\r\n## Actual Results\r\n\r\nasync def remains working as it was the first time for any changes\r\n\r\n<!-- What actually happened. If there is a traceback, please show the entire thing. -->\r\n\r\n## Intents\r\n\r\nfrom none to guilds, members, bans, emojis, voice_states, guild_messsages, guild_reactions, presences = True\r\n\r\n## Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [ ] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n- [x] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\nPython 3.8.5\r\ndiscord.py 1.5.1\r\nLinux bot-machine 5.4.0-56-generic 62-Ubuntu SMP Mon Nov 23 19:20:19 UTC 2020 x86_64 GNU/Linux _(uname -a)_\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6115/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6115/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6113", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6113/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6113/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6113/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6113", "id": 755224027, "node_id": "MDU6SXNzdWU3NTUyMjQwMjc=", "number": 6113, "title": "Exception in cog_unload stops module cleanup", "user": {"login": "SebbyLaw", "id": 44045823, "node_id": "MDQ6VXNlcjQ0MDQ1ODIz", "avatar_url": "https://avatars.githubusercontent.com/u/44045823?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SebbyLaw", "html_url": "https://github.com/SebbyLaw", "followers_url": "https://api.github.com/users/SebbyLaw/followers", "following_url": "https://api.github.com/users/SebbyLaw/following{/other_user}", "gists_url": "https://api.github.com/users/SebbyLaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/SebbyLaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SebbyLaw/subscriptions", "organizations_url": "https://api.github.com/users/SebbyLaw/orgs", "repos_url": "https://api.github.com/users/SebbyLaw/repos", "events_url": "https://api.github.com/users/SebbyLaw/events{/privacy}", "received_events_url": "https://api.github.com/users/SebbyLaw/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/12", "html_url": "https://github.com/Rapptz/discord.py/milestone/12", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/12/labels", "id": 6134466, "node_id": "MDk6TWlsZXN0b25lNjEzNDQ2Ng==", "number": 12, "title": "v1.6", "description": "A minor version bump to appease the masses. ", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 30, "state": "closed", "created_at": "2020-11-22T03:43:55Z", "updated_at": "2021-01-15T10:25:08Z", "due_on": null, "closed_at": "2021-01-15T10:25:08Z"}, "comments": 1, "created_at": "2020-12-02T12:17:47Z", "updated_at": "2020-12-04T00:18:09Z", "closed_at": "2020-12-04T00:17:42Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## Summary\r\n\r\nThrowing an error in a cog's `cog_unload` method leaves the cog's module to stay in `sys.modules` and the internal `Bot.__extensions` list. This means that the cog is stuck in a state where it can't be loaded (since the module it resides in is \"still loaded\") until the `unload_extension` is called for a second time to clean up. (For `n` cogs in an extension raising errors, the extension must be unloaded `n + 1` times for the module to be fully unloaded.)\r\n\r\n## Reproduction Steps\r\n\r\nin `cogs/BadCog.py`:\r\n\r\n```py\r\nfrom discord.ext import commands\r\n\r\nclass BadCog(commands.Cog):\r\n    def cog_unload(self):\r\n        raise Exception()\r\n\r\n    @commands.command()\r\n    async def foo(self, ctx):\r\n        await ctx.send(\"still loaded!\")\r\n\r\ndef setup(bot):\r\n    bot.add_cog(BadCog())\r\n```\r\n\r\nUsing [jishaku](https://github.com/Gorialis/jishaku/tree/master/jishaku):\r\n\r\n?jsk load cogs.BadCog\r\n:inbox_tray: `cogs.BadCog`\r\n\r\n?foo\r\nstill loaded!\r\n\r\n?jsk unload cogs.BadCog\r\n:outbox_tray::warning: cogs.BadCog`\r\n\r\n?foo << this message receives no response\r\n\r\n?jsk unload cogs.BadCog\r\n:outbox_tray: cogs.BadCog\r\n\r\n## Expected Results\r\n\r\nOne of the following:\r\n- Proper cleanup ignoring exceptions in either `Cog._eject`, `Bot.remove_cog`, `Bot._remove_module_references`, or `Bot.unload_extension`\r\n- Atomic unloading, meaning that Cogs are re-loaded to the bot if unloading the extension fails.\r\n\r\n## Actual Results\r\n\r\nI am sad.\r\n\r\n## Intents\r\n\r\nN/A.\r\n\r\n## Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n- [x] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\nN/A.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6113/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6113/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6086", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6086/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6086/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6086/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6086", "id": 751134647, "node_id": "MDU6SXNzdWU3NTExMzQ2NDc=", "number": 6086, "title": "Sound Scrambles when playing", "user": {"login": "js802025", "id": 30957566, "node_id": "MDQ6VXNlcjMwOTU3NTY2", "avatar_url": "https://avatars.githubusercontent.com/u/30957566?v=4", "gravatar_id": "", "url": "https://api.github.com/users/js802025", "html_url": "https://github.com/js802025", "followers_url": "https://api.github.com/users/js802025/followers", "following_url": "https://api.github.com/users/js802025/following{/other_user}", "gists_url": "https://api.github.com/users/js802025/gists{/gist_id}", "starred_url": "https://api.github.com/users/js802025/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/js802025/subscriptions", "organizations_url": "https://api.github.com/users/js802025/orgs", "repos_url": "https://api.github.com/users/js802025/repos", "events_url": "https://api.github.com/users/js802025/events{/privacy}", "received_events_url": "https://api.github.com/users/js802025/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 840896122, "node_id": "MDU6TGFiZWw4NDA4OTYxMjI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/stale", "name": "stale", "color": "a0c92e", "default": false, "description": "This issue is too old."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-11-25T21:44:08Z", "updated_at": "2022-03-09T22:49:56Z", "closed_at": "2022-03-09T22:49:56Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\nWhen using vc.play with FFmpegPCMAudio the sound condenses into a short bit, doesn't play at all or cuts off.\r\n\r\n\r\n## Reproduction Steps\r\n`if message.author.voice and message.author.voice.channel:\r\n            vc = await message.author.voice.channel.connect()\r\n            source = discord.FFmpegPCMAudio('sound_file.mp3')\r\n            vc.play(source, after=lambda e: print('done', e))`\r\n\r\n\r\n## Expected Results\r\nthe audio file to play correctly\r\n\r\n## Actual Results\r\nthe audio plays flawed\r\n<!-- What actually happened. If there is a traceback, please show the entire thing. -->\r\n\r\n## Intents\r\n\r\ndefault\r\n\r\n## Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x ] I have searched the open issues for duplicates.\r\n- [x ] I have shown the entire traceback, if possible.\r\n- [ x] I have removed my token from display, if visible.\r\n- [ x] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n- Python v3.8.5-final\r\n- discord.py v1.5.1-final\r\n- aiohttp v3.6.3\r\n- system info: Darwin 19.6.0 Darwin Kernel Version 19.6.0: Mon Aug 31 22:12:52 PDT 2020; root:xnu-6153.141.2~1/RELEASE_X86_64\r\n<!-- Run `python -m discord -v` and paste this information below. -->\r\n<!-- This command is available in v1.1.0 or higher. If you are unable to run this command, paste basic info (ie. Python version, library version, and your operating system -->\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6086/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6086/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6081", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6081/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6081/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6081/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6081", "id": 749920470, "node_id": "MDU6SXNzdWU3NDk5MjA0NzA=", "number": 6081, "title": "discord-py 1.5.1 requires aiohttp<3.7.0,>=3.6.0, but you'll have aiohttp 3.7.3 which is incompatible.", "user": {"login": "johnsturgeon", "id": 9746310, "node_id": "MDQ6VXNlcjk3NDYzMTA=", "avatar_url": "https://avatars.githubusercontent.com/u/9746310?v=4", "gravatar_id": "", "url": "https://api.github.com/users/johnsturgeon", "html_url": "https://github.com/johnsturgeon", "followers_url": "https://api.github.com/users/johnsturgeon/followers", "following_url": "https://api.github.com/users/johnsturgeon/following{/other_user}", "gists_url": "https://api.github.com/users/johnsturgeon/gists{/gist_id}", "starred_url": "https://api.github.com/users/johnsturgeon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/johnsturgeon/subscriptions", "organizations_url": "https://api.github.com/users/johnsturgeon/orgs", "repos_url": "https://api.github.com/users/johnsturgeon/repos", "events_url": "https://api.github.com/users/johnsturgeon/events{/privacy}", "received_events_url": "https://api.github.com/users/johnsturgeon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 251130942, "node_id": "MDU6TGFiZWwyNTExMzA5NDI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/duplicate", "name": "duplicate", "color": "cccccc", "default": true, "description": "This is a duplicate of another issue or PR."}, {"id": 251130945, "node_id": "MDU6TGFiZWwyNTExMzA5NDU=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/invalid", "name": "invalid", "color": "e6e6e6", "default": true, "description": "This is not right."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-11-24T17:53:36Z", "updated_at": "2020-11-24T19:00:59Z", "closed_at": "2020-11-24T19:00:59Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\n\r\nNeed to support the new aiohttp\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6081/reactions", "total_count": 4, "+1": 0, "-1": 4, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6081/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6078", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6078/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6078/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6078/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6078", "id": 748469684, "node_id": "MDU6SXNzdWU3NDg0Njk2ODQ=", "number": 6078, "title": "Setting position=0 in create_text_channel() and create_voice_channel() doesn't work", "user": {"login": "Zahariel", "id": 2659411, "node_id": "MDQ6VXNlcjI2NTk0MTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2659411?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Zahariel", "html_url": "https://github.com/Zahariel", "followers_url": "https://api.github.com/users/Zahariel/followers", "following_url": "https://api.github.com/users/Zahariel/following{/other_user}", "gists_url": "https://api.github.com/users/Zahariel/gists{/gist_id}", "starred_url": "https://api.github.com/users/Zahariel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Zahariel/subscriptions", "organizations_url": "https://api.github.com/users/Zahariel/orgs", "repos_url": "https://api.github.com/users/Zahariel/repos", "events_url": "https://api.github.com/users/Zahariel/events{/privacy}", "received_events_url": "https://api.github.com/users/Zahariel/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 397573646, "node_id": "MDU6TGFiZWwzOTc1NzM2NDY=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/discord%20bug", "name": "discord bug", "color": "5319e7", "default": false, "description": "This is a Discord bug, not one with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-11-23T05:08:24Z", "updated_at": "2021-06-13T01:21:04Z", "closed_at": "2021-04-10T02:14:13Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\n\r\nI have a bot that creates channels in my discord server. Some channels are \"special\", and I would like them to be created so that they sort to the top of their category (and I don't care how they sort within that; there's usually only one special channel in a category anyway). Most channels are not \"special\", and I'm fine with them sorting in creation order, or really anything else; I don't care. I tried to do this by using `create_text_channel(name, position=positive_number)` for non-special channels and `position=0` for special channels. This did not work; the special channel sorted to the bottom when it was created. It seems like 0 specifically is being treated the same as None. I can work around this personally by setting `position=at_least_two` for non-special channels and `position=1` for special channels, since I control everything in my current situation, but it still means that a bot has no reliable way to create a channel at the top of a category unless it can know that everything else has a higher number. I haven't tried `channel.edit(position=0)` but it wouldn't surprise me if it has the same problem.\r\n\r\n## Reproduction Steps\r\n```\r\n# this is from a Cog but it doesn't actually matter\r\ncategory = self.bot.get_channel(CATEGORY_CHANNEL_ID)\r\nawait category.create_text_channel(\"test-one\", position=1)\r\nawait category.create_text_channel(\"test-three\", position=3)\r\nawait category.create_text_channel(\"test-zero\", position=0)\r\nawait category.create_text_channel(\"test-two\", position=2)\r\n```\r\n\r\n## Expected Results\r\nI wanted setting `position=0` to show up at the top of the category, or at worst after all other channels created with `position=0` (either of these would be fine); therefore, the channels in the above test would appear as test-zero, test-one, test-two, test-three\r\n\r\n## Actual Results\r\nThe channels in the above test appear in the client in the order test-one, test-two, test-three, test-zero.\r\n\r\n## Intents\r\nDefault Intents, didn't do anything special. I don't have Members and Presences activated but they really shouldn't matter here.\r\n\r\n## Checklist\r\n- [x] I have searched the open issues for duplicates.\r\nI originally thought #2392 was the problem I was encountering, but I don't think it is. That issue refers to the actual value of `position` not matching the observed position in the client. I don't care about that; I just want a way to create a channel reliably at the top of its category.\r\n\r\n## System Information\r\n\r\n<!-- Run `python -m discord -v` and paste this information below. -->\r\n<!-- This command is available in v1.1.0 or higher. If you are unable to run this command, paste basic info (ie. Python version, library version, and your operating system -->\r\n- Python v3.8.5-final\r\n- discord.py v1.5.1-final\r\n- aiohttp v3.6.3\r\n- system info: Linux 4.19.128-microsoft-standard #1 SMP Tue Jun 23 12:58:10 UTC 2020\r\n\r\n(this looks weird because it's in a Docker Compose on Docker Desktop for Windows)\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6078/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6078/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6077", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6077/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6077/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6077/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6077", "id": 748292147, "node_id": "MDU6SXNzdWU3NDgyOTIxNDc=", "number": 6077, "title": "installation error", "user": {"login": "appleGun22", "id": 68515404, "node_id": "MDQ6VXNlcjY4NTE1NDA0", "avatar_url": "https://avatars.githubusercontent.com/u/68515404?v=4", "gravatar_id": "", "url": "https://api.github.com/users/appleGun22", "html_url": "https://github.com/appleGun22", "followers_url": "https://api.github.com/users/appleGun22/followers", "following_url": "https://api.github.com/users/appleGun22/following{/other_user}", "gists_url": "https://api.github.com/users/appleGun22/gists{/gist_id}", "starred_url": "https://api.github.com/users/appleGun22/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/appleGun22/subscriptions", "organizations_url": "https://api.github.com/users/appleGun22/orgs", "repos_url": "https://api.github.com/users/appleGun22/repos", "events_url": "https://api.github.com/users/appleGun22/events{/privacy}", "received_events_url": "https://api.github.com/users/appleGun22/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 653343598, "node_id": "MDU6TGFiZWw2NTMzNDM1OTg=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/off-topic", "name": "off-topic", "color": "d4c5f9", "default": false, "description": "This does not belong here."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-11-22T17:31:58Z", "updated_at": "2020-11-24T21:29:59Z", "closed_at": "2020-11-22T20:42:59Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'm trying to download discord.py libray but i get every time this wierd error\r\n\r\nC:\\python>pip3 install discord.py\r\nCollecting discord.py\r\n  Using cached discord.py-1.5.1-py3-none-any.whl (701 kB)\r\nCollecting aiohttp<3.7.0,>=3.6.0\r\n  Using cached aiohttp-3.6.3.tar.gz (1.1 MB)\r\nERROR: Exception:\r\nTraceback (most recent call last):\r\n  File \"c:\\users\\***\\appdata\\local\\programs\\python\\python39\\lib\\site-packages\\pip\\_internal\\cli\\base_command.py\", line 228, in _main\r\n    status = self.run(options, args)\r\n  File \"c:\\users\\***\\appdata\\local\\programs\\python\\python39\\lib\\site-packages\\pip\\_internal\\cli\\req_command.py\", line 182, in wrapper\r\n    return func(self, options, args)\r\n  File \"c:\\users\\***\\appdata\\local\\programs\\python\\python39\\lib\\site-packages\\pip\\_internal\\commands\\install.py\", line 323, in run\r\n    requirement_set = resolver.resolve(\r\n  File \"c:\\users\\***\\appdata\\local\\programs\\python\\python39\\lib\\site-packages\\pip\\_internal\\resolution\\legacy\\resolver.py\", line 183, in resolve\r\n    discovered_reqs.extend(self._resolve_one(requirement_set, req))\r\n  File \"c:\\users\\***\\appdata\\local\\programs\\python\\python39\\lib\\site-packages\\pip\\_internal\\resolution\\legacy\\resolver.py\", line 388, in _resolve_one\r\n    abstract_dist = self._get_abstract_dist_for(req_to_install)\r\n  File \"c:\\users\\***\\appdata\\local\\programs\\python\\python39\\lib\\site-packages\\pip\\_internal\\resolution\\legacy\\resolver.py\", line 340, in _get_abstract_dist_for\r\n    abstract_dist = self.preparer.prepare_linked_requirement(req)\r\n  File \"c:\\users\\***\\appdata\\local\\programs\\python\\python39\\lib\\site-packages\\pip\\_internal\\operations\\prepare.py\", line 482, in prepare_linked_requirement\r\n    abstract_dist = _get_prepared_distribution(\r\n  File \"c:\\users\\***\\appdata\\local\\programs\\python\\python39\\lib\\site-packages\\pip\\_internal\\operations\\prepare.py\", line 91, in _get_prepared_distribution\r\n    abstract_dist.prepare_distribution_metadata(finder, build_isolation)\r\n  File \"c:\\users\\***\\appdata\\local\\programs\\python\\python39\\lib\\site-packages\\pip\\_internal\\distributions\\sdist.py\", line 38, in prepare_distribution_metadata\r\n    self._setup_isolation(finder)\r\n  File \"c:\\users\\***\\appdata\\local\\programs\\python\\python39\\lib\\site-packages\\pip\\_internal\\distributions\\sdist.py\", line 65, in _setup_isolation\r\n    self.req.build_env = BuildEnvironment()\r\n  File \"c:\\users\\***\\appdata\\local\\programs\\python\\python39\\lib\\site-packages\\pip\\_internal\\build_env.py\", line 82, in __init__\r\n    fp.write(textwrap.dedent(\r\n  File \"c:\\users\\***\\appdata\\local\\programs\\python\\python39\\lib\\encodings\\cp1251.py\", line 19, in encode\r\n    return codecs.charmap_encode(input,self.errors,encoding_table)[0]\r\nUnicodeEncodeError: 'charmap' codec can't encode characters in position 148-152: character maps to <undefined>\r\n\r\nim guessing its because my user name(c:\\users\\\\***) is not an english text, but i didn't had problems with it before", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6077/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6077/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6070", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6070/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6070/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6070/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6070", "id": 747664457, "node_id": "MDU6SXNzdWU3NDc2NjQ0NTc=", "number": 6070, "title": "message.reactions is not a PartialEmoji", "user": {"login": "Snawe", "id": 17966466, "node_id": "MDQ6VXNlcjE3OTY2NDY2", "avatar_url": "https://avatars.githubusercontent.com/u/17966466?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Snawe", "html_url": "https://github.com/Snawe", "followers_url": "https://api.github.com/users/Snawe/followers", "following_url": "https://api.github.com/users/Snawe/following{/other_user}", "gists_url": "https://api.github.com/users/Snawe/gists{/gist_id}", "starred_url": "https://api.github.com/users/Snawe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Snawe/subscriptions", "organizations_url": "https://api.github.com/users/Snawe/orgs", "repos_url": "https://api.github.com/users/Snawe/repos", "events_url": "https://api.github.com/users/Snawe/events{/privacy}", "received_events_url": "https://api.github.com/users/Snawe/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 251130945, "node_id": "MDU6TGFiZWwyNTExMzA5NDU=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/invalid", "name": "invalid", "color": "e6e6e6", "default": true, "description": "This is not right."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2020-11-20T17:20:27Z", "updated_at": "2020-11-23T11:09:12Z", "closed_at": "2020-11-20T19:21:09Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\n\r\nIn the doc is written that `on_raw_reaction_add()` and `Message.reactions` both return a partial emoji\r\nhttps://discordpy.readthedocs.io/en/latest/api.html?highlight=file#discord.PartialEmoji\r\n\r\nHowever, if I am not wrong it seems like message.reactions returns a reaction (https://discordpy.readthedocs.io/en/latest/api.html?highlight=file#discord.Reaction)  and `on_raw_reaction_add` => payload.emoji is a PartialEmoji\r\n\r\n## Reproduction Steps\r\n\r\n`payload.emoji` in `on_raw_reaction_add()` looks like:\r\n```\r\nanimated:False\r\nid:None\r\nname:'\u2694'\r\n```\r\n\r\n```for reaction in message.reactions:```\r\nreaction:\r\n```\r\ncount:1\r\ncustom_emoji:False\r\nemoji:':crossed_swords:'\r\nme:True\r\n```\r\n\r\n=> You can see, the ID is missing in the message.reactions.\r\n\r\nEven stranger is that if you pass a custom emoji to the  message.reactions you get:\r\n```\r\ncount:1\r\ncustom_emoji:True\r\n  emoji:<Emoji id=XXX name='name' animated=False managed=False>\r\n  ...\r\n  id:XXX\r\n  managed:False\r\n  name:'name'\r\n```\r\n<!-- What you did to make it happen. Ideally there should be a short code snippet in this section to help reproduce the bug. -->\r\n\r\n## Intents\r\nAll but presences\r\n\r\n## Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\nDiscord py 1.5.1\r\n\r\n\r\nI stumble over it because I need the emoji id (even if its None) in `for reaction in message.reactions:` :/", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6070/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6070/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6066", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6066/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6066/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6066/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6066", "id": 746418348, "node_id": "MDU6SXNzdWU3NDY0MTgzNDg=", "number": 6066, "title": "commands.Bot.guilds returns empty list, when the bot is in multiple servers", "user": {"login": "erick-dsnk", "id": 64867406, "node_id": "MDQ6VXNlcjY0ODY3NDA2", "avatar_url": "https://avatars.githubusercontent.com/u/64867406?v=4", "gravatar_id": "", "url": "https://api.github.com/users/erick-dsnk", "html_url": "https://github.com/erick-dsnk", "followers_url": "https://api.github.com/users/erick-dsnk/followers", "following_url": "https://api.github.com/users/erick-dsnk/following{/other_user}", "gists_url": "https://api.github.com/users/erick-dsnk/gists{/gist_id}", "starred_url": "https://api.github.com/users/erick-dsnk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/erick-dsnk/subscriptions", "organizations_url": "https://api.github.com/users/erick-dsnk/orgs", "repos_url": "https://api.github.com/users/erick-dsnk/repos", "events_url": "https://api.github.com/users/erick-dsnk/events{/privacy}", "received_events_url": "https://api.github.com/users/erick-dsnk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 251130945, "node_id": "MDU6TGFiZWwyNTExMzA5NDU=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/invalid", "name": "invalid", "color": "e6e6e6", "default": true, "description": "This is not right."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-11-19T09:51:30Z", "updated_at": "2020-11-23T11:01:39Z", "closed_at": "2020-11-19T10:23:07Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\n\r\nI recently needed a list of all the guilds my bot is in to set up a database for an economy system I wanted to implement. Only to find out that for some reason, the `guilds` property is an empty list. I checked multiple times and I am 100% sure that my bot is in multiple servers.\r\n\r\n## Reproduction Steps\r\n\r\nThis is issue hasn't happened before since I used this property in other things.\r\nWhat I did was: I iterated through the guilds list to add to a MongoDB collection, and i noticed that the code inside the for loop was never triggered. Then when I tried printing `client.guilds` it returned `[]`. My code for setting up the bot and the database:\r\n```python\r\nimport discord\r\nfrom discord.ext import commands\r\nfrom exts.database import economy_collection # the mongo db collection, its in another file\r\n\r\nintents = discord.Intents.all()\r\nclient = commands.Bot(command_prefix = '-', intents=intents)\r\nclient.remove_command('help')\r\n\r\nprint(client.guilds) #  []\r\n\r\ndef setup_database():\r\n    for guild in client.guilds:\r\n        if not economy_collection.find_one({\"_id\": guild.id}):\r\n            members = []\r\n\r\n            for member in guild.members:\r\n                members.append(\r\n                    {\"id\": member.id, \"money\": 0}\r\n                )\r\n\r\n            economy_collection.insert_one(\r\n                {\r\n                    \"_id\": guild.id,\r\n                    \"name\": guild.name,\r\n                    \"members\": members\r\n                }\r\n            )\r\n        \r\n        else:\r\n            pass\r\n\r\nsetup_database()\r\n\r\nclient.run(\"my token\")\r\n```\r\n\r\n## Expected Results\r\n\r\nI expected a list with all the guilds\r\n\r\n## Actual Results\r\n\r\nThere's no error, but the client.guilds is empty\r\n\r\n## Intents\r\n\r\n```python\r\nintents = discord.Intents.all()\r\nclient = commands.Bot(command_prefix = '-', intents=intents)\r\n```\r\n\r\n## Checklist\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n- [x] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\nPython version: `3.9.0-final`\r\ndiscord.py version: `1.5.1-final`\r\naiohttp version: `3.6.3`\r\n\r\nOperating System: `Microsoft Windows 10 Home 10.0.18363 N/A Build 18363`\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6066/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6066/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6047", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6047/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6047/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6047/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6047", "id": 744034748, "node_id": "MDU6SXNzdWU3NDQwMzQ3NDg=", "number": 6047, "title": "Trying to get the all the members", "user": {"login": "Bryan-u-2", "id": 66239183, "node_id": "MDQ6VXNlcjY2MjM5MTgz", "avatar_url": "https://avatars.githubusercontent.com/u/66239183?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Bryan-u-2", "html_url": "https://github.com/Bryan-u-2", "followers_url": "https://api.github.com/users/Bryan-u-2/followers", "following_url": "https://api.github.com/users/Bryan-u-2/following{/other_user}", "gists_url": "https://api.github.com/users/Bryan-u-2/gists{/gist_id}", "starred_url": "https://api.github.com/users/Bryan-u-2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Bryan-u-2/subscriptions", "organizations_url": "https://api.github.com/users/Bryan-u-2/orgs", "repos_url": "https://api.github.com/users/Bryan-u-2/repos", "events_url": "https://api.github.com/users/Bryan-u-2/events{/privacy}", "received_events_url": "https://api.github.com/users/Bryan-u-2/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 2424324063, "node_id": "MDU6TGFiZWwyNDI0MzI0MDYz", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/intents%20related", "name": "intents related", "color": "99d4f7", "default": false, "description": "User provided bad/invalid intents"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-11-16T17:44:23Z", "updated_at": "2020-11-23T10:42:16Z", "closed_at": "2020-11-16T17:59:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\n\r\n I am trying to generate list of all members but its not working as intented \r\n\r\n## Reproduction Steps\r\n\r\n import discord\r\nfrom discord.ext import commands\r\n\r\nprefix = '.'\r\nbot = commands.Bot(prefix)\r\n\r\n\r\n@bot.event\r\nasync def on_ready():\r\n    for member in bot.get_all_members():\r\n        print(member)\r\n        \r\nbot.run(\"...\") \r\n\r\n## Expected Results\r\n\r\n It should print out user names of all the members in a server \r\n\r\n## Actual Results\r\n\r\nNameofthebot#2342 \r\nthe name of the bot is repeated for the total number of the server\r\n\r\n## Intents\r\n\r\n<!-- What intents are you using for your bot? This is the `discord.Intents` class you pass to the client -->\r\n\r\n## Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [ ] I have searched the open issues for duplicates.\r\n- [ ] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n- [ ] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\n- Python v3.6.9-final\r\n- discord.py v1.5.1-final\r\n- aiohttp v3.6.3\r\n- system info: Linux 5.4.0-53-generic #59~18.04.1-Ubuntu SMP Wed Oct 21 12:14:56 UTC 2020\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6047/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6047/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6040", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6040/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6040/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6040/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6040", "id": 742590547, "node_id": "MDU6SXNzdWU3NDI1OTA1NDc=", "number": 6040, "title": "putting <> around @everyone bypasses \"message.mention_everyone\"", "user": {"login": "Chrisdies", "id": 51842970, "node_id": "MDQ6VXNlcjUxODQyOTcw", "avatar_url": "https://avatars.githubusercontent.com/u/51842970?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Chrisdies", "html_url": "https://github.com/Chrisdies", "followers_url": "https://api.github.com/users/Chrisdies/followers", "following_url": "https://api.github.com/users/Chrisdies/following{/other_user}", "gists_url": "https://api.github.com/users/Chrisdies/gists{/gist_id}", "starred_url": "https://api.github.com/users/Chrisdies/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Chrisdies/subscriptions", "organizations_url": "https://api.github.com/users/Chrisdies/orgs", "repos_url": "https://api.github.com/users/Chrisdies/repos", "events_url": "https://api.github.com/users/Chrisdies/events{/privacy}", "received_events_url": "https://api.github.com/users/Chrisdies/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 397573190, "node_id": "MDU6TGFiZWwzOTc1NzMxOTA=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/no%20repro", "name": "no repro", "color": "fef2c0", "default": false, "description": "Cannot be reproduced."}, {"id": 397573646, "node_id": "MDU6TGFiZWwzOTc1NzM2NDY=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/discord%20bug", "name": "discord bug", "color": "5319e7", "default": false, "description": "This is a Discord bug, not one with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-11-13T16:37:13Z", "updated_at": "2020-11-23T10:21:45Z", "closed_at": "2020-11-13T16:42:04Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\n\r\n\"message.mention_everyone\" results in false if the user puts <> around @everyone\r\n\r\n## Reproduction Steps\r\n\r\n1) create a bot that responds back the same message it's sent but if message.mention_everyone is true don't do anything. \r\n2) send the bot @everyone\r\n3) send the bot <@everyone>\r\n\r\n## Expected Results\r\nboth times the bot shouldn't respond as they both mention @everyone\r\n## Actual Results\r\nthe bot will mention @everyone on the second case\r\n## Intents\r\ndoesn't pertain to the issue\r\n## Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n- [x] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\n- Python v3.7.6-final\r\n- discord.py v1.5.1-final\r\n- aiohttp v3.6.3\r\n- system info: Windows 10 10.0.18362\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6040/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6040/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6039", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6039/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6039/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6039/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6039", "id": 742218811, "node_id": "MDU6SXNzdWU3NDIyMTg4MTE=", "number": 6039, "title": "AttributeError raised on voice channel connection timeout", "user": {"login": "jkchen2", "id": 10703688, "node_id": "MDQ6VXNlcjEwNzAzNjg4", "avatar_url": "https://avatars.githubusercontent.com/u/10703688?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jkchen2", "html_url": "https://github.com/jkchen2", "followers_url": "https://api.github.com/users/jkchen2/followers", "following_url": "https://api.github.com/users/jkchen2/following{/other_user}", "gists_url": "https://api.github.com/users/jkchen2/gists{/gist_id}", "starred_url": "https://api.github.com/users/jkchen2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jkchen2/subscriptions", "organizations_url": "https://api.github.com/users/jkchen2/orgs", "repos_url": "https://api.github.com/users/jkchen2/repos", "events_url": "https://api.github.com/users/jkchen2/events{/privacy}", "received_events_url": "https://api.github.com/users/jkchen2/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/12", "html_url": "https://github.com/Rapptz/discord.py/milestone/12", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/12/labels", "id": 6134466, "node_id": "MDk6TWlsZXN0b25lNjEzNDQ2Ng==", "number": 12, "title": "v1.6", "description": "A minor version bump to appease the masses. ", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 30, "state": "closed", "created_at": "2020-11-22T03:43:55Z", "updated_at": "2021-01-15T10:25:08Z", "due_on": null, "closed_at": "2021-01-15T10:25:08Z"}, "comments": 1, "created_at": "2020-11-13T07:14:25Z", "updated_at": "2020-11-22T04:14:18Z", "closed_at": "2020-11-22T04:14:18Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\n\r\nIf the bot times out when connecting to a voice channel, an `AttributeError: 'VoiceClient' object has no attribute 'ws'` exception is thrown. This results in the bot getting stuck in a bad voice channel connection state, and a restart is needed to clear it.\r\n\r\n## Reproduction Steps\r\n\r\nA bit inconsistent to reproduce as it really only happens on network blips, but can be mostly reproduced if the timeout is set to a small enough value:\r\n\r\n```python\r\nvoice_channel = await bot.fetch_channel(...)\r\nawait voice_channel.connect(timeout=0.1)\r\n```\r\n\r\n## Expected Results\r\n\r\nIf a `TimeoutError` occurs, no `AttributeError` is raised, and the bot cleanly disconnects itself from the voice channel from an incomplete connection state.\r\n\r\n## Actual Results\r\n\r\nIf a `TimeoutError` occurs, the bot will attempt to call `disconnect`, which will then attempt to access a not yet instantiated `self.ws`.\r\n\r\nThis results in the bot getting stuck in a bad state where it shows up as connected to the voice channel for an end user, but it isn't actually (i.e. no matching `VoiceClient` in `bot.voice_clients`). Additionally, further attempts to connect to the voice channel will fail with a `TimeoutError`.\r\n\r\nPartial traceback:\r\n\r\n```\r\n  File \"/usr/local/lib/python3.6/dist-packages/discord/abc.py\", line 1122, in connect\r\n    await voice.connect(timeout=timeout, reconnect=reconnect)\r\n  File \"/usr/local/lib/python3.6/dist-packages/discord/voice_client.py\", line 346, in connect\r\n    await self.disconnect(force=True)\r\n  File \"/usr/local/lib/python3.6/dist-packages/discord/voice_client.py\", line 460, in disconnect\r\n    if self.ws:\r\nAttributeError: 'VoiceClient' object has no attribute 'ws'\r\n```\r\n\r\n## Intents\r\n\r\nNo additional intents are passed to the bot, but I don't think intents are related to this issue anyway.\r\n\r\n## Checklist\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n- [x] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\n```\r\n- Python v3.6.7-final\r\n- discord.py v1.5.1-final\r\n- aiohttp v3.6.3\r\n- [I have omitted the system info line because frankly, it is too embarrassing to admit that I haven't updated my kernel in literally over 3 years]\r\n```", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6039/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6039/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6037", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6037/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6037/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6037/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6037", "id": 742098065, "node_id": "MDU6SXNzdWU3NDIwOTgwNjU=", "number": 6037, "title": "ClientOSError: [WinError 64] The specified network name is no longer available", "user": {"login": "xPolar", "id": 50601857, "node_id": "MDQ6VXNlcjUwNjAxODU3", "avatar_url": "https://avatars.githubusercontent.com/u/50601857?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xPolar", "html_url": "https://github.com/xPolar", "followers_url": "https://api.github.com/users/xPolar/followers", "following_url": "https://api.github.com/users/xPolar/following{/other_user}", "gists_url": "https://api.github.com/users/xPolar/gists{/gist_id}", "starred_url": "https://api.github.com/users/xPolar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xPolar/subscriptions", "organizations_url": "https://api.github.com/users/xPolar/orgs", "repos_url": "https://api.github.com/users/xPolar/repos", "events_url": "https://api.github.com/users/xPolar/events{/privacy}", "received_events_url": "https://api.github.com/users/xPolar/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2020-11-13T03:28:58Z", "updated_at": "2021-06-22T07:10:08Z", "closed_at": "2020-11-13T20:32:21Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## Summary\r\n\r\n<!-- A summary of your bug report -->\r\n\r\n## Reproduction Steps\r\n\r\n<!-- What you did to make it happen. Ideally, there should be a short code snippet in this section to help reproduce the bug. -->\r\nRan a command called `!export` within a text channel inside of a guild, the command should then get all of the messages within the text channel and write them into a text file. Once said text file is done it should try to send the file to the person who invoked the command if `discord.Forbidden` is raised then send the file to the channel it was invoked in.\r\n\r\n```py3\r\nwith open(\"export.txt\", \"w+\", encoding=\"utf-8\") as file:\r\n    file.write(f\"Guild: {ctx.guild.name}\\nChannel: {ctx.channel.name}\\n{ f'Topic: {ctx.channel.topic}' if ctx.channel.topic else '' }\")\r\n    async for message in ctx.channel.history(oldest_first = True):\r\n        file.write(f\"\\n[{message.created_at.strftime('%d-%b-%y %I:%M %p')}] {message.author}: {message.content}\")\r\n    file.seek(0)\r\n    try:\r\n        await ctx.author.send(file = discord.File(file, \"export.txt\"))\r\n    except discord.Forbidden:\r\n        await ctx.channel.send(file = discord.File(file, \"export.txt\"))\r\ntry:\r\n    remove(\"export.txt\")\r\nexcept:\r\n    return\r\n```\r\n\r\n## Expected Results\r\n\r\n<!-- What you expected to happen -->\r\nIt should have exported the messages, sent it either to DMs or the channel, and then deleted it.\r\n\r\n## Actual Results\r\n\r\n<!-- What actually happened. If there is a traceback, please show the entire thing. -->\r\nIt exports like three or so messages and then stops exporting anything and raises the following traceback.\r\n\r\n```\r\nIgnoring exception in on_command_error\r\nTraceback (most recent call last):\r\n  File \"C:\\Python38\\lib\\site-packages\\discord\\ext\\commands\\core.py\", line 85, in wrapped\r\n    ret = await coro(*args, **kwargs)\r\n  File \"c:\\Users\\Haris\\Desktop\\Code\\SimBuilder\\MessageExporter\\Main.py\", line 137, in export       \r\n    await ctx.author.send(file = discord.File(file, \"export.txt\"))\r\n  File \"C:\\Python38\\lib\\site-packages\\discord\\abc.py\", line 886, in send\r\n    data = await state.http.send_files(channel.id, files=[file], allowed_mentions=allowed_mentions,\r\n  File \"C:\\Python38\\lib\\site-packages\\discord\\http.py\", line 185, in request\r\n    async with self.__session.request(method, url, **kwargs) as r:\r\n  File \"C:\\Python38\\lib\\site-packages\\aiohttp\\client.py\", line 1012, in __aenter__\r\n    self._resp = await self._coro\r\n  File \"C:\\Python38\\lib\\site-packages\\aiohttp\\client.py\", line 504, in _request\r\n    await resp.start(conn)\r\n  File \"C:\\Python38\\lib\\site-packages\\aiohttp\\client_reqrep.py\", line 847, in start\r\n    message, payload = await self._protocol.read()  # type: ignore  # noqa\r\n  File \"C:\\Python38\\lib\\site-packages\\aiohttp\\streams.py\", line 591, in read\r\n    await self._waiter\r\naiohttp.client_exceptions.ClientOSError: [WinError 64] The specified network name is no longer available\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"C:\\Python38\\lib\\site-packages\\discord\\client.py\", line 333, in _run_event\r\n    await coro(*args, **kwargs)\r\n  File \"c:\\Users\\Haris\\Desktop\\Code\\SimBuilder\\MessageExporter\\Main.py\", line 191, in on_command_error\r\n    raise error\r\n  File \"C:\\Python38\\lib\\site-packages\\discord\\ext\\commands\\bot.py\", line 903, in invoke\r\n    await ctx.command.invoke(ctx)\r\n  File \"C:\\Python38\\lib\\site-packages\\discord\\ext\\commands\\core.py\", line 859, in invoke\r\n    await injected(*ctx.args, **ctx.kwargs)\r\n  File \"C:\\Python38\\lib\\site-packages\\discord\\ext\\commands\\core.py\", line 94, in wrapped\r\n    raise CommandInvokeError(exc) from exc\r\ndiscord.ext.commands.errors.CommandInvokeError: Command raised an exception: ClientOSError: [WinError 64] The specified network name is no longer available\r\n```\r\n\r\n## Intents\r\n\r\n<!-- What intents are you using for your bot? This is the `discord.Intents` class you pass to the client -->\r\nDefault\r\n\r\n## Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n- [x] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\n<!-- Run `python -m discord -v` and paste this information below. -->\r\n<!-- This command is available in v1.1.0 or higher. If you are unable to run this command, paste basic info (ie. Python version, library version, and your operating system -->\r\n- Python v3.8.6-final\r\n- discord.py v1.5.0-final\r\n- aiohttp v3.6.2\r\n- system info: Windows 10 10.0.19041\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6037/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6037/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6015", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6015/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6015/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6015/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6015", "id": 737728876, "node_id": "MDU6SXNzdWU3Mzc3Mjg4NzY=", "number": 6015, "title": "Can't set Intent.members to True", "user": {"login": "Jahn16", "id": 40438992, "node_id": "MDQ6VXNlcjQwNDM4OTky", "avatar_url": "https://avatars.githubusercontent.com/u/40438992?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jahn16", "html_url": "https://github.com/Jahn16", "followers_url": "https://api.github.com/users/Jahn16/followers", "following_url": "https://api.github.com/users/Jahn16/following{/other_user}", "gists_url": "https://api.github.com/users/Jahn16/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jahn16/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jahn16/subscriptions", "organizations_url": "https://api.github.com/users/Jahn16/orgs", "repos_url": "https://api.github.com/users/Jahn16/repos", "events_url": "https://api.github.com/users/Jahn16/events{/privacy}", "received_events_url": "https://api.github.com/users/Jahn16/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 251130945, "node_id": "MDU6TGFiZWwyNTExMzA5NDU=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/invalid", "name": "invalid", "color": "e6e6e6", "default": true, "description": "This is not right."}, {"id": 2424324063, "node_id": "MDU6TGFiZWwyNDI0MzI0MDYz", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/intents%20related", "name": "intents related", "color": "99d4f7", "default": false, "description": "User provided bad/invalid intents"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-11-06T12:41:04Z", "updated_at": "2020-11-07T00:38:17Z", "closed_at": "2020-11-06T14:07:35Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\n\r\n<!-- A summary of your bug report -->\r\n\r\n## Reproduction Steps\r\n\r\nintent = discord.Intents(messages=True,members = True, guilds=True)\r\nbot = commands.Bot(command_prefix = '-',intent = intent)\r\nprint(intent.members)\r\nprint(bot.intents.members)\r\n\r\n## Expected Results\r\nBoth prints displaying True, bot intent.members  be set to true and my bot being able to use functions like guild.chunk()\r\n\r\n## Actual Results\r\n\r\nTrue\r\nFalse\r\nThe Bot is ready.\r\nIgnoring exception in command ajuda:\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\jpdeo\\.virtualenvs\\JboTSeries-_H1W6chR\\lib\\site-packages\\discord\\ext\\commands\\core.py\", line 85, in wrapped\r\n    ret = await coro(*args, **kwargs)\r\n  File \"C:/JboTSeries/discord_files/bot.py\", line 30, in ajuda\r\n    print(len(await ctx.guild.chunk()))\r\n  File \"C:\\Users\\jpdeo\\.virtualenvs\\JboTSeries-_H1W6chR\\lib\\site-packages\\discord\\guild.py\", line 2073, in chunk\r\n    raise ClientException('Intents.members must be enabled to use this.')\r\ndiscord.errors.ClientException: Intents.members must be enabled to use this.\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\jpdeo\\.virtualenvs\\JboTSeries-_H1W6chR\\lib\\site-packages\\discord\\ext\\commands\\bot.py\", line 903, in invoke\r\n    await ctx.command.invoke(ctx)\r\n  File \"C:\\Users\\jpdeo\\.virtualenvs\\JboTSeries-_H1W6chR\\lib\\site-packages\\discord\\ext\\commands\\core.py\", line 859, in invoke\r\n    await injected(*ctx.args, **ctx.kwargs)\r\n  File \"C:\\Users\\jpdeo\\.virtualenvs\\JboTSeries-_H1W6chR\\lib\\site-packages\\discord\\ext\\commands\\core.py\", line 94, in wrapped\r\n    raise CommandInvokeError(exc) from exc\r\ndiscord.ext.commands.errors.CommandInvokeError: Command raised an exception: ClientException: Intents.members must be enabled to use this.\r\n\r\n\r\n## Intents\r\n\r\nintent = discord.Intents(messages=True,members = True, guilds=True)\r\nbot = commands.Bot(command_prefix = '-',intent = intent)\r\n\r\n## Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n- [x] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\n- Python v3.8.5-final\r\n- discord.py v1.5.1-final\r\n- aiohttp v3.6.3\r\n- system info: Windows 10 10.0.19041\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6015/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6015/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6008", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6008/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6008/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6008/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6008", "id": 736411759, "node_id": "MDU6SXNzdWU3MzY0MTE3NTk=", "number": 6008, "title": "'HistoryIterator' object is not an iterator ", "user": {"login": "BLucky-gh", "id": 41377306, "node_id": "MDQ6VXNlcjQxMzc3MzA2", "avatar_url": "https://avatars.githubusercontent.com/u/41377306?v=4", "gravatar_id": "", "url": "https://api.github.com/users/BLucky-gh", "html_url": "https://github.com/BLucky-gh", "followers_url": "https://api.github.com/users/BLucky-gh/followers", "following_url": "https://api.github.com/users/BLucky-gh/following{/other_user}", "gists_url": "https://api.github.com/users/BLucky-gh/gists{/gist_id}", "starred_url": "https://api.github.com/users/BLucky-gh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/BLucky-gh/subscriptions", "organizations_url": "https://api.github.com/users/BLucky-gh/orgs", "repos_url": "https://api.github.com/users/BLucky-gh/repos", "events_url": "https://api.github.com/users/BLucky-gh/events{/privacy}", "received_events_url": "https://api.github.com/users/BLucky-gh/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 251130945, "node_id": "MDU6TGFiZWwyNTExMzA5NDU=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/invalid", "name": "invalid", "color": "e6e6e6", "default": true, "description": "This is not right."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-11-04T20:44:54Z", "updated_at": "2020-11-23T00:25:14Z", "closed_at": "2020-11-04T20:49:16Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\nWhen I try to iterate over the last several messages in a channel that I got with  `messages = channel.history(limit=10)` I get the error ``TypeError: 'HistoryIterator' object is not an iterator ``\r\n\r\nhere's the code:\r\n```python\r\n@client.event\r\nasync def on_ready():\r\n    print(\"The bot is running as \"+str(client.user))\r\n    channel=client.get_channel(channel_id)\r\n    messages = channel.history(limit=10)\r\n    print(messages)\r\n    for i in range(1,10):\r\n        print(next(messages))\r\n```\r\n(this is not the code that is gonna be used for what I described in the intents section but it's the code that's returning the error while I was trying to make it work before starting to code the actual code itself)\r\n\r\n## Reproduction Steps\r\n\r\nGet a HistoryIterator object with `messages = channel.history(limit=10)` and try to iterate over it or even use `next(messages)`\r\n\r\n## Expected Results\r\n\r\nI expect the iterator to be an iterator\r\n\r\n## Actual Results\r\n\r\nThe iterator decides to use it's freedom of self expression and identifies as something else, idk\r\n\r\n## Intents\r\n\r\nI'm trying to check if the last message was sent by a certain user and send a new message only if the previous message was indeed sent by that user\r\n\r\n## Checklist\r\n- [Yes] I have searched the open issues for duplicates.\r\n- [Yes] I have shown the entire traceback, if possible.\r\n- [Yes] I have removed my token from display, if visible.\r\n- [Yes] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\n<!-- Run `python -m discord -v` and paste this information below. -->\r\n- Python v3.8.1-final\r\n- discord.py v1.5.1-final\r\n- aiohttp v3.7.2\r\n- system info: Darwin 19.6.0 Darwin Kernel Version 19.6.0: Mon Aug 31 22:12:52 PDT 2020; root:xnu-6153.141.2~1/RELEASE_X86_64\r\n\r\n<!-- This command is available in v1.1.0 or higher. If you are unable to run this command, paste basic info (ie. Python version, library version, and your operating system -->\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6008/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6008/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6005", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6005/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6005/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6005/events", "html_url": "https://github.com/Rapptz/discord.py/issues/6005", "id": 735604525, "node_id": "MDU6SXNzdWU3MzU2MDQ1MjU=", "number": 6005, "title": "Documentation error", "user": {"login": "ascpial", "id": 72463129, "node_id": "MDQ6VXNlcjcyNDYzMTI5", "avatar_url": "https://avatars.githubusercontent.com/u/72463129?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ascpial", "html_url": "https://github.com/ascpial", "followers_url": "https://api.github.com/users/ascpial/followers", "following_url": "https://api.github.com/users/ascpial/following{/other_user}", "gists_url": "https://api.github.com/users/ascpial/gists{/gist_id}", "starred_url": "https://api.github.com/users/ascpial/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ascpial/subscriptions", "organizations_url": "https://api.github.com/users/ascpial/orgs", "repos_url": "https://api.github.com/users/ascpial/repos", "events_url": "https://api.github.com/users/ascpial/events{/privacy}", "received_events_url": "https://api.github.com/users/ascpial/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 251130945, "node_id": "MDU6TGFiZWwyNTExMzA5NDU=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/invalid", "name": "invalid", "color": "e6e6e6", "default": true, "description": "This is not right."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-11-03T20:11:25Z", "updated_at": "2020-11-23T00:21:39Z", "closed_at": "2020-11-05T07:47:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "I have found an error in the documentation page : for the `User` object, `avatar` and `avatar_url` are inverted\r\n\r\n[avatar ](https://discordpy.readthedocs.io/en/latest/api.html#discord.User.avatar)\r\n[avatar_url](https://discordpy.readthedocs.io/en/latest/api.html#discord.User.avatar_url)\r\n\r\nPs : I'm french and my english aren't good", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/6005/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/6005/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5999", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5999/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5999/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5999/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5999", "id": 734705777, "node_id": "MDU6SXNzdWU3MzQ3MDU3Nzc=", "number": 5999, "title": "The event on_message_edit always return a type User for message.author", "user": {"login": "AiroPi", "id": 47398145, "node_id": "MDQ6VXNlcjQ3Mzk4MTQ1", "avatar_url": "https://avatars.githubusercontent.com/u/47398145?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AiroPi", "html_url": "https://github.com/AiroPi", "followers_url": "https://api.github.com/users/AiroPi/followers", "following_url": "https://api.github.com/users/AiroPi/following{/other_user}", "gists_url": "https://api.github.com/users/AiroPi/gists{/gist_id}", "starred_url": "https://api.github.com/users/AiroPi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AiroPi/subscriptions", "organizations_url": "https://api.github.com/users/AiroPi/orgs", "repos_url": "https://api.github.com/users/AiroPi/repos", "events_url": "https://api.github.com/users/AiroPi/events{/privacy}", "received_events_url": "https://api.github.com/users/AiroPi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-11-02T17:53:37Z", "updated_at": "2020-11-23T11:05:43Z", "closed_at": "2020-11-23T11:05:43Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## Summary\r\n\r\nWhen the \"on_message_edit\" is called, the \"after message\" argument has its \"author\" argument that is ALWAYS of type User (and not of type Member like it should bot if it's in a server).\r\nI have the \"members\" intents activated.\r\n\r\n## Reproduction Steps\r\n\r\nJust look the type of the attribute \"author\" in the message which is given in \"on_message_edit\" event.\r\n\r\n## Expected Results\r\n\r\nBefore the 1.5 update, I'm 99% sure that, if the message edited was in a server, its author attribute was of type Member\r\n\r\n## Actual Results\r\n\r\nIt's always of type \"User\"\r\n\r\n## Intents\r\n\r\nAll intents except presence\r\n\r\n## Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n- [x] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\n<!-- Run `python -m discord -v` and paste this information below. -->\r\n- Python v3.8.2-final\r\n- discord.py v1.5.1-final\r\n- aiohttp v3.6.2\r\n- system info: Windows 10 10.0.18362\r\n\r\n<!-- This command is available in v1.1.0 or higher. If you are unable to run this command, paste basic info (ie. Python version, library version, and your operating system -->\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5999/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5999/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5995", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5995/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5995/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5995/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5995", "id": 733962338, "node_id": "MDU6SXNzdWU3MzM5NjIzMzg=", "number": 5995, "title": "\"ClientException: Not connected to voice\" after attempting to play audio in a VoiceChannel", "user": {"login": "DavMrc", "id": 45066379, "node_id": "MDQ6VXNlcjQ1MDY2Mzc5", "avatar_url": "https://avatars.githubusercontent.com/u/45066379?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DavMrc", "html_url": "https://github.com/DavMrc", "followers_url": "https://api.github.com/users/DavMrc/followers", "following_url": "https://api.github.com/users/DavMrc/following{/other_user}", "gists_url": "https://api.github.com/users/DavMrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/DavMrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DavMrc/subscriptions", "organizations_url": "https://api.github.com/users/DavMrc/orgs", "repos_url": "https://api.github.com/users/DavMrc/repos", "events_url": "https://api.github.com/users/DavMrc/events{/privacy}", "received_events_url": "https://api.github.com/users/DavMrc/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2020-11-01T13:10:12Z", "updated_at": "2020-11-02T12:44:10Z", "closed_at": "2020-11-01T13:13:54Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\n\r\nMy bot is always connected to a VoiceChannel and every time a user logs into such channel, I use the `on_voice_state_update` callback to play an audio in the channel.  \r\nI noticed that sometimes (but not every time), the audio isn't played and I get this error: `ClientException: Not connected to voice`.  \r\nI have tried to catch the exception, disconnect the bot for a second, then reconnect it and try to play the audio again, but doesn't solve the issue.\r\n\r\n```python\r\nasync def on_voice_state_update(self, member, voice_state_before, voice_state_after):\r\n    if member.name != self.bot.user.name:  # opts out events triggered from the bot\r\n        fname = None\r\n        if str(voice_state_after.channel) == 'None':\r\n            fname = \"left_se.wav\"\r\n        elif (str(voice_state_before.channel) != str(voice_state_after.channel) and\r\n            str(voice_state_before.channel) == \"General\"  # name of the voice channel\r\n        ):\r\n            fname = \"left_ch.wav\"\r\n        elif(str(voice_state_after.channel) != 'None' and\r\n            str(voice_state_before.channel) != str(voice_state_after.channel)\r\n        ):\r\n            fname = \"join.wav\"\r\n\r\n        if fname is not None:\r\n            audio = discord.FFmpegOpusAudio(fname, codec='copy')\r\n            try:\r\n                await asyncio.sleep(0.5)\r\n                # vc_connection was created when connecting via `await connect()`\r\n                self.vc_connection.play(audio)\r\n            except discord.errors.ClientException as e:\r\n                # another announcement is playing\r\n                if str(e).startswith(\"Already playing audio\"):\r\n                    print(f'ClientException while attempting to play audio: {e}')\r\n\r\n                elif str(e).startswith(\"Not connected to voice\"):\r\n                    print(f'ClientException while attempting to play audio: {e}')\r\n\r\n                    # disconnect, reconnect and retry audio playback\r\n                    await self.vc_connection.disconnect(force=True)\r\n                    await asyncio.sleep(0.2)\r\n                    self.vc_connection = await self.vc.connect()\r\n                    await asyncio.sleep(0.5)\r\n                    self.vc_connection.play(audio)\r\n```\r\n\r\n## Reproduction Steps\r\n\r\n1. Create a bot and add a `Cog`\r\n2. Register `on_voice_state_update`\r\n3. Connect the bot to a VoiceChannel\r\n4. Add some logic to filter only the case when a user is logging in/out\r\n6. Play an audio\r\n7. Host the bot on a 24/7 platform (don't think this matters much, but I was using Heroku. When I started to have this issue, I tried it also on my Raspberry Pi4)\r\n\r\n## Expected Results\r\n\r\nBot always plays this audio.\r\n\r\n## Actual Results\r\n\r\nSometimes (generally just an hour after the boot) I get this error and the bot doesn't play the audio. After that, generally everthing returns normal but it might happen again.\r\n\r\n## Intents\r\n\r\nMy bot has all the Intents.\r\n\r\n## Checklist\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have provided the intents that my bot is using.\r\n- [ ] I have shown the entire traceback, if possible.\r\n- [ ] I have removed my token from display, if visible.\r\n\r\n## System Information\r\n\r\nWhen on Heroku, I know for sure that it utilizes Python 3.9.0 and the latest releases of `discord.py[voice]` and `aiohttp`. System is Ubuntu 18.04.\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5995/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5995/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5986", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5986/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5986/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5986/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5986", "id": 733416410, "node_id": "MDU6SXNzdWU3MzM0MTY0MTA=", "number": 5986, "title": "PartialTemplateState does not support '_member_cache_flags' | When `fetch_template` is called", "user": {"login": "Lost1419", "id": 73212659, "node_id": "MDQ6VXNlcjczMjEyNjU5", "avatar_url": "https://avatars.githubusercontent.com/u/73212659?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Lost1419", "html_url": "https://github.com/Lost1419", "followers_url": "https://api.github.com/users/Lost1419/followers", "following_url": "https://api.github.com/users/Lost1419/following{/other_user}", "gists_url": "https://api.github.com/users/Lost1419/gists{/gist_id}", "starred_url": "https://api.github.com/users/Lost1419/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Lost1419/subscriptions", "organizations_url": "https://api.github.com/users/Lost1419/orgs", "repos_url": "https://api.github.com/users/Lost1419/repos", "events_url": "https://api.github.com/users/Lost1419/events{/privacy}", "received_events_url": "https://api.github.com/users/Lost1419/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/12", "html_url": "https://github.com/Rapptz/discord.py/milestone/12", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/12/labels", "id": 6134466, "node_id": "MDk6TWlsZXN0b25lNjEzNDQ2Ng==", "number": 12, "title": "v1.6", "description": "A minor version bump to appease the masses. ", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 30, "state": "closed", "created_at": "2020-11-22T03:43:55Z", "updated_at": "2021-01-15T10:25:08Z", "due_on": null, "closed_at": "2021-01-15T10:25:08Z"}, "comments": 1, "created_at": "2020-10-30T18:20:14Z", "updated_at": "2020-11-22T04:14:18Z", "closed_at": "2020-11-22T04:14:17Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\n\r\nIt seems like when I call a `fetch_template` it says that \r\n`raise AttributeError('PartialTemplateState does not support {0!r}.'.format(attr))\r\nAttributeError: PartialTemplateState does not support '_member_cache_flags'.`\r\n\r\n## Reproduction Steps\r\n\r\n```py\r\n@commands.command()\r\n@commands.is_owner()\r\nasync def guild(self, ctx, code):\r\n        temp = await self.bot.fetch_template(code)\r\n        guild = await temp.create_guild(name=\"Test Server\", region=None, icon=None)\r\n        channel = [channel.id for channel in guild.channels]\r\n        for id in channel:\r\n            invite = await ctx.channel.create_invite()\r\n            await ctx.send(invite)\r\n```\r\n\r\n\r\n## Expected Results\r\n\r\nShould have made a guild and sent an invite for every channel in the server\r\n\r\n## Actual Results\r\n\r\n```py\r\nIgnoring exception in command guild:\r\nTraceback (most recent call last):\r\n  File \"\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\discord\\ext\\commands\\core.py\", line 85, in wrapped\r\n    ret = await coro(*args, **kwargs)\r\n  File \"C:\\Users\\\\Desktop\\Coding\\Python\\Lost... Bot\\Cogs\\staff.py\", line 36, in guild\r\n    temp = await self.bot.fetch_template(code)\r\n  File \"C:\\Users\\\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\discord\\client.py\", line 1144, in fetch_template\r\n    return Template(data=data, state=self._connection)\r\n  File \"C:\\Users\\\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\discord\\template.py\", line 120, in __init__\r\n    self.source_guild = Guild(data=source_serialised, state=state)\r\n  File \"C:\\Users\\\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\discord\\guild.py\", line 190, in __init__\r\n    self._from_data(data)\r\n  File \"C:\\Users\\\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\discord\\guild.py\", line 308, in _from_data\r\n    cache_online_members = self._state._member_cache_flags.online\r\n  File \"C:\\Users\\\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\discord\\template.py\", line 75, in __getattr__\r\n    raise AttributeError('PartialTemplateState does not support {0!r}.'.format(attr))\r\nAttributeError: PartialTemplateState does not support '_member_cache_flags'.\r\n```\r\n\r\n## Intents\r\n\r\n<!-- What intents are you using for your bot? This is the `discord.Intents` class you pass to the client -->\r\n\r\n```py\r\nintents = discord.Intents.all()\r\n```\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n- [x] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\n- Python v3.9.0-final\r\n- discord.py v1.5.1-final\r\n- aiohttp v3.6.3\r\n- system info: Windows 10 10.0.19041\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5986/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5986/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5974", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5974/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5974/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5974/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5974", "id": 729877556, "node_id": "MDU6SXNzdWU3Mjk4Nzc1NTY=", "number": 5974, "title": "\"after\" parameter of fetch_members does not work (well) using datetime", "user": {"login": "tilnow", "id": 44685516, "node_id": "MDQ6VXNlcjQ0Njg1NTE2", "avatar_url": "https://avatars.githubusercontent.com/u/44685516?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tilnow", "html_url": "https://github.com/tilnow", "followers_url": "https://api.github.com/users/tilnow/followers", "following_url": "https://api.github.com/users/tilnow/following{/other_user}", "gists_url": "https://api.github.com/users/tilnow/gists{/gist_id}", "starred_url": "https://api.github.com/users/tilnow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tilnow/subscriptions", "organizations_url": "https://api.github.com/users/tilnow/orgs", "repos_url": "https://api.github.com/users/tilnow/repos", "events_url": "https://api.github.com/users/tilnow/events{/privacy}", "received_events_url": "https://api.github.com/users/tilnow/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 251130942, "node_id": "MDU6TGFiZWwyNTExMzA5NDI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/duplicate", "name": "duplicate", "color": "cccccc", "default": true, "description": "This is a duplicate of another issue or PR."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-10-26T20:21:34Z", "updated_at": "2020-10-27T02:11:02Z", "closed_at": "2020-10-27T02:11:02Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\n\r\nthe after parameter in fetch_members() does not work if after is a datetime object.\r\n\r\n## Reproduction Steps\r\n\r\nmem=await g.fetch_members(after=datetime.datetime.fromtimestamp(prevread)).flatten()\r\n\r\n(where prevread is zero)\r\n\r\nwhen run as `mem=await g.fetch_members()` it returns all 656 members\r\n\r\n## Expected Results\r\n\r\n656 members\r\n\r\n## Actual Results\r\n\r\nWe have logged in as Shepherd#2960 [...  shard_id=None chunked=True member_count=656>]\r\n...\r\n\r\n.....\r\n0 1970-01-01 00:00:00 ### is printed by `print(prevread,datetime.datetime.fromtimestamp(prevread))`\r\nIgnoring exception in on_ready\r\nTraceback (most recent call last):\r\n  File \"/home/yak/.local/lib/python3.6/site-packages/discord/client.py\", line 333, in _run_event\r\n    await coro(*args, **kwargs)\r\n  File \"shepherd.py\", line 49, in on_ready\r\n    await update_database()\r\n  File \"shepherd.py\", line 108, in update_database\r\n    await read_and_add()\r\n  File \"shepherd.py\", line 117, in read_and_add\r\n    mem=await g.fetch_members(after=datetime.datetime.fromtimestamp(prevread)).flatten() # reads only ones added since prevread\r\n  File \"/home/yak/.local/lib/python3.6/site-packages/discord/iterators.py\", line 75, in flatten\r\n    item = await self.next()\r\n  File \"/home/yak/.local/lib/python3.6/site-packages/discord/iterators.py\", line 605, in next\r\n    await self.fill_members()\r\n  File \"/home/yak/.local/lib/python3.6/site-packages/discord/iterators.py\", line 627, in fill_members\r\n    data = await self.get_members(self.guild.id, self.retrieve, after)\r\n  File \"/home/yak/.local/lib/python3.6/site-packages/discord/http.py\", line 245, in request\r\n    raise HTTPException(r, data)\r\ndiscord.errors.HTTPException: 400 Bad Request (error code: 50035): Invalid Form Body\r\nIn after: long value should be greater than or equal to 0.\r\n\r\n\r\n*when prevread was set to be a timestamp of 1973, it also failed. when set to be 2019, a date when the guild did not exist yet, it read only 304 members out of >500 (maybe it used it as a snowflake?).\r\n\r\n## Intents\r\n\r\nintents = discord.Intents.default()\r\nintents.members = True\r\nclient = discord.Client(intents=intents)\r\n\r\n## Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x ] I have searched the open issues for duplicates.\r\n- [x ] I have shown the entire traceback, if possible.\r\n- [x ] I have removed my token from display, if visible.\r\n- [x ] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\npython3 -m discord -v\r\n- Python v3.6.9-final\r\n- discord.py v1.5.0-final\r\n- aiohttp v3.6.2\r\n- system info: Linux 4.15.0-112-generic #113-Ubuntu SMP Thu Jul 9 23:41:39 UTC 2020\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5974/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5974/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5971", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5971/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5971/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5971/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5971", "id": 729740513, "node_id": "MDU6SXNzdWU3Mjk3NDA1MTM=", "number": 5971, "title": "guild get_channel voicechannel members does not update correct", "user": {"login": "IHASASUSHI", "id": 12938030, "node_id": "MDQ6VXNlcjEyOTM4MDMw", "avatar_url": "https://avatars.githubusercontent.com/u/12938030?v=4", "gravatar_id": "", "url": "https://api.github.com/users/IHASASUSHI", "html_url": "https://github.com/IHASASUSHI", "followers_url": "https://api.github.com/users/IHASASUSHI/followers", "following_url": "https://api.github.com/users/IHASASUSHI/following{/other_user}", "gists_url": "https://api.github.com/users/IHASASUSHI/gists{/gist_id}", "starred_url": "https://api.github.com/users/IHASASUSHI/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/IHASASUSHI/subscriptions", "organizations_url": "https://api.github.com/users/IHASASUSHI/orgs", "repos_url": "https://api.github.com/users/IHASASUSHI/repos", "events_url": "https://api.github.com/users/IHASASUSHI/events{/privacy}", "received_events_url": "https://api.github.com/users/IHASASUSHI/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 2424324063, "node_id": "MDU6TGFiZWwyNDI0MzI0MDYz", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/intents%20related", "name": "intents related", "color": "99d4f7", "default": false, "description": "User provided bad/invalid intents"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-10-26T16:59:10Z", "updated_at": "2020-11-22T23:36:27Z", "closed_at": "2020-10-26T17:04:36Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\nEither the `guild.get_channel([channel id]).members` or the voice `channel.members` does not update what members it can see.\r\n\r\nThe members it cannot see specifically are those that connected to a voice channel before it has joined.\r\nHowever, it will recognize the member if bot has seen user join it after once. i.e.\r\n1. Bot joins voice channel\r\n2. User joins voice channel\r\n3. Bot disconnects from voice channel\r\n4. Bot reconnects to voice channel\r\nThe bot will be able to still see that user even in they are in a different voice channel\r\n\r\n## Reproduction Steps\r\nboot up the bot\r\nhave someone join a voice channel\r\nhave the bot join after said person has successfully joined the voice channel\r\ncheck `channel.members`\r\n\r\n## Expected Results\r\nthe members list should have both the bot and the member\r\n\r\n## Actual Results\r\nthe members list will only have the bot\r\n\r\n## Intents\r\n\r\nN/A\r\n\r\n## Checklist\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n- [x] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\n- Python v3.8.5-final\r\n- discord.py v1.5.1-final\r\n- aiohttp v3.6.2\r\n- system info: Windows 10 10.0.19041\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5971/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5971/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5968", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5968/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5968/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5968/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5968", "id": 729125550, "node_id": "MDU6SXNzdWU3MjkxMjU1NTA=", "number": 5968, "title": "[Ubuntu] Unable to get local issuer certificate (_ssl.c:1108)", "user": {"login": "MyselfLeo", "id": 50076540, "node_id": "MDQ6VXNlcjUwMDc2NTQw", "avatar_url": "https://avatars.githubusercontent.com/u/50076540?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MyselfLeo", "html_url": "https://github.com/MyselfLeo", "followers_url": "https://api.github.com/users/MyselfLeo/followers", "following_url": "https://api.github.com/users/MyselfLeo/following{/other_user}", "gists_url": "https://api.github.com/users/MyselfLeo/gists{/gist_id}", "starred_url": "https://api.github.com/users/MyselfLeo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MyselfLeo/subscriptions", "organizations_url": "https://api.github.com/users/MyselfLeo/orgs", "repos_url": "https://api.github.com/users/MyselfLeo/repos", "events_url": "https://api.github.com/users/MyselfLeo/events{/privacy}", "received_events_url": "https://api.github.com/users/MyselfLeo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-10-25T22:06:37Z", "updated_at": "2022-09-29T22:40:58Z", "closed_at": "2020-10-25T22:28:02Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\n\r\nI've got the `aiohttp.client_exceptions.ClientConnectorCertificateError: Cannot connect to host discord.com:443 ssl:True [SSLCertVerificationError: (1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1108)')]` error, same as #4146, however I'm running WSL Ubuntu 18.04.02 LTS and not MacOS. I've tried every answers to most of the SSL issues I could find but nothing fixed my problem.\r\n\r\nIt may be a problem with WSL as running the same script on my Ubuntu 18.04 LTS VPS does not cause any errror.\r\n\r\n## Reproduction Steps\r\n\r\nThe error comes from the `run()` command.\r\n\r\n## Actual Results\r\n\r\n```Traceback (most recent call last):\r\n  File \"/home/leo/.local/lib/python3.8/site-packages/aiohttp/connector.py\", line 936, in _wrap_create_connection\r\n    return await self._loop.create_connection(*args, **kwargs)  # type: ignore  # noqa\r\n  File \"/usr/local/lib/python3.8/asyncio/base_events.py\", line 1042, in create_connection\r\n    transport, protocol = await self._create_connection_transport(\r\n  File \"/usr/local/lib/python3.8/asyncio/base_events.py\", line 1072, in _create_connection_transport\r\n    await waiter\r\n  File \"/usr/local/lib/python3.8/asyncio/sslproto.py\", line 529, in data_received\r\n    ssldata, appdata = self._sslpipe.feed_ssldata(data)\r\n  File \"/usr/local/lib/python3.8/asyncio/sslproto.py\", line 189, in feed_ssldata\r\n    self._sslobj.do_handshake()\r\n  File \"/usr/local/lib/python3.8/ssl.py\", line 944, in do_handshake\r\n    self._sslobj.do_handshake()\r\nssl.SSLCertVerificationError: [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1108)\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"main.py\", line 609, in <module>\r\n    client.run('TOKEN') # Stable\r\n  File \"/home/leo/.local/lib/python3.8/site-packages/discord/client.py\", line 678, in run\r\n    return future.result()\r\n  File \"/home/leo/.local/lib/python3.8/site-packages/discord/client.py\", line 658, in runner\r\n    await self.start(*args, **kwargs)\r\n  File \"/home/leo/.local/lib/python3.8/site-packages/discord/client.py\", line 621, in start\r\n    await self.login(*args, bot=bot)\r\n  File \"/home/leo/.local/lib/python3.8/site-packages/discord/client.py\", line 472, in login\r\n    await self.http.static_login(token.strip(), bot=bot)\r\n  File \"/home/leo/.local/lib/python3.8/site-packages/discord/http.py\", line 288, in static_login\r\n    data = await self.request(Route('GET', '/users/@me'))\r\n  File \"/home/leo/.local/lib/python3.8/site-packages/discord/http.py\", line 185, in request\r\n    async with self.__session.request(method, url, **kwargs) as r:\r\n  File \"/home/leo/.local/lib/python3.8/site-packages/aiohttp/client.py\", line 1012, in __aenter__\r\n    self._resp = await self._coro\r\n  File \"/home/leo/.local/lib/python3.8/site-packages/aiohttp/client.py\", line 480, in _request\r\n    conn = await self._connector.connect(\r\n  File \"/home/leo/.local/lib/python3.8/site-packages/aiohttp/connector.py\", line 523, in connect\r\n    proto = await self._create_connection(req, traces, timeout)\r\n  File \"/home/leo/.local/lib/python3.8/site-packages/aiohttp/connector.py\", line 858, in _create_connection\r\n    _, proto = await self._create_direct_connection(\r\n  File \"/home/leo/.local/lib/python3.8/site-packages/aiohttp/connector.py\", line 1004, in _create_direct_connection\r\n    raise last_exc\r\n  File \"/home/leo/.local/lib/python3.8/site-packages/aiohttp/connector.py\", line 980, in _create_direct_connection\r\n    transp, proto = await self._wrap_create_connection(\r\n  File \"/home/leo/.local/lib/python3.8/site-packages/aiohttp/connector.py\", line 938, in _wrap_create_connection\r\n    raise ClientConnectorCertificateError(\r\naiohttp.client_exceptions.ClientConnectorCertificateError: Cannot connect to host discord.com:443 ssl:True [SSLCertVerificationError: (1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1108)')]\r\n```\r\n\r\n## Intents\r\n\r\nI'm not using any intents, it's been some time that I didn't program my bot and back then Intents where not a thing (i think ?).\r\n\r\n## Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n- [x] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\n- Python v3.8.0-final\r\n- discord.py v1.4.1-final\r\n- aiohttp v3.6.3\r\n- system info: Linux 4.4.0-19041-Microsoft #488-Microsoft Mon Sep 01 13:43:00 PST 2020\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5968/reactions", "total_count": 1, "+1": 0, "-1": 1, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5968/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5967", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5967/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5967/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5967/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5967", "id": 728926458, "node_id": "MDU6SXNzdWU3Mjg5MjY0NTg=", "number": 5967, "title": "Cannot run discord bot, with SSL error.", "user": {"login": "CocoaCrispies", "id": 67450207, "node_id": "MDQ6VXNlcjY3NDUwMjA3", "avatar_url": "https://avatars.githubusercontent.com/u/67450207?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CocoaCrispies", "html_url": "https://github.com/CocoaCrispies", "followers_url": "https://api.github.com/users/CocoaCrispies/followers", "following_url": "https://api.github.com/users/CocoaCrispies/following{/other_user}", "gists_url": "https://api.github.com/users/CocoaCrispies/gists{/gist_id}", "starred_url": "https://api.github.com/users/CocoaCrispies/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CocoaCrispies/subscriptions", "organizations_url": "https://api.github.com/users/CocoaCrispies/orgs", "repos_url": "https://api.github.com/users/CocoaCrispies/repos", "events_url": "https://api.github.com/users/CocoaCrispies/events{/privacy}", "received_events_url": "https://api.github.com/users/CocoaCrispies/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 861992193, "node_id": "MDU6TGFiZWw4NjE5OTIxOTM=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/dep%20bug", "name": "dep bug", "color": "ffc4ef", "default": false, "description": "A bug with the dependencies"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-10-25T02:57:38Z", "updated_at": "2020-11-22T20:09:01Z", "closed_at": "2020-10-26T21:43:02Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\n\r\nWhenever I try to run my discord bot, I get an error from aiohttp, talking about how my SSL certificates are outdated. I tried this on a VPS and local, and same error everytime.\r\n\r\n## Reproduction Steps\r\n\r\nI simply run by bot's `server.py` file, and get the error. I haven't changed anything and get this error.\r\n\r\n## Expected Results\r\n\r\nMy bot to run normally.\r\n\r\n## Actual Results\r\n\r\nMy error:\r\n` raise ClientConnectorCertificateError(\r\naiohttp.client_exceptions.ClientConnectorCertificateError: Cannot connect to host discord.com:443 ssl:True [SSLCertVerificationError: (1, \"[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: IP address mismatch, certificate is not valid for '162.159.135.232'. (_ssl.c:1122)\")]`\r\n\r\n## Intents\r\n\r\nN/A\r\n\r\n## Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [ x] I have searched the open issues for duplicates.\r\n- [x ] I have shown the entire traceback, if possible.\r\n- [ x] I have removed my token from display, if visible.\r\n- [ x] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\n- Python v3.9.0-final\r\n- discord.py v1.5.1-final\r\n- aiohttp v3.7.0\r\n- system info: Windows 10 10.0.1904`\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5967/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5967/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5965", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5965/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5965/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5965/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5965", "id": 728783401, "node_id": "MDU6SXNzdWU3Mjg3ODM0MDE=", "number": 5965, "title": "typing event does not fire for TextChannels if members intents is not enabled", "user": {"login": "Willy-C", "id": 19799671, "node_id": "MDQ6VXNlcjE5Nzk5Njcx", "avatar_url": "https://avatars.githubusercontent.com/u/19799671?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Willy-C", "html_url": "https://github.com/Willy-C", "followers_url": "https://api.github.com/users/Willy-C/followers", "following_url": "https://api.github.com/users/Willy-C/following{/other_user}", "gists_url": "https://api.github.com/users/Willy-C/gists{/gist_id}", "starred_url": "https://api.github.com/users/Willy-C/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Willy-C/subscriptions", "organizations_url": "https://api.github.com/users/Willy-C/orgs", "repos_url": "https://api.github.com/users/Willy-C/repos", "events_url": "https://api.github.com/users/Willy-C/events{/privacy}", "received_events_url": "https://api.github.com/users/Willy-C/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-10-24T12:52:28Z", "updated_at": "2020-10-29T09:23:26Z", "closed_at": "2020-10-24T13:53:01Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## Summary\r\n\r\nIf members intents is not enabled and the typing occurs in a guild, then the event does not fire because `Guild.get_member` is used, so `member` is None. (The event still fires if typing in DM even with members intent disabled)\r\nhttps://github.com/Rapptz/discord.py/blob/763d46cd7ab14a4b0345a69fd862de8a4eb6da10/discord/state.py#L1032-L1033\r\nhttps://github.com/Rapptz/discord.py/blob/763d46cd7ab14a4b0345a69fd862de8a4eb6da10/discord/state.py#L1037-L1039\r\n\r\n## Reproduction Steps\r\n\r\n1. Have `typing` intents enabled and `members` disabled\r\n2. Have an on_typing or a wait_for('typing')\r\n3. Start typing in a guild\r\n\r\n## Expected Results\r\n\r\nThe event fires\r\n\r\n## Actual Results\r\n\r\nNothing happens because `member` is None\r\n\r\n## Intents\r\n\r\n- Typing enabled\r\n- Members disabled\r\n\r\n## Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n- [x] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\nd.py 1.5.1\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5965/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5965/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5955", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5955/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5955/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5955/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5955", "id": 726137408, "node_id": "MDU6SXNzdWU3MjYxMzc0MDg=", "number": 5955, "title": "Len of commands.Bot.guilds returning 0", "user": {"login": "Lost1419", "id": 73212659, "node_id": "MDQ6VXNlcjczMjEyNjU5", "avatar_url": "https://avatars.githubusercontent.com/u/73212659?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Lost1419", "html_url": "https://github.com/Lost1419", "followers_url": "https://api.github.com/users/Lost1419/followers", "following_url": "https://api.github.com/users/Lost1419/following{/other_user}", "gists_url": "https://api.github.com/users/Lost1419/gists{/gist_id}", "starred_url": "https://api.github.com/users/Lost1419/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Lost1419/subscriptions", "organizations_url": "https://api.github.com/users/Lost1419/orgs", "repos_url": "https://api.github.com/users/Lost1419/repos", "events_url": "https://api.github.com/users/Lost1419/events{/privacy}", "received_events_url": "https://api.github.com/users/Lost1419/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-10-21T05:08:45Z", "updated_at": "2020-10-21T06:01:39Z", "closed_at": "2020-10-21T06:01:39Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\n\r\nWhen I do get the guilds the bot is in it returns 0 The bot is in 4 server and it seems like even when I try and get them in multiple ways such as using `guilds = [guild.id for guild in cient.guilds]` it still will return 0 or an empty list\r\n\r\n## Reproduction Steps\r\n\r\n`\r\nguilds = client.guilds\r\nprint(len(guilds))\r\n`\r\n\r\n## Expected Results\r\n\r\nIt should print 4 or the list of guild the bot is in.\r\n\r\n## Actual Results\r\n\r\nReturns 0 when using `len` and an empty list when just using `print(guilds)`\r\n\r\n## Intents\r\n\r\n`\r\nintents = discord.Intents.default()\r\n`\r\n`\r\nintents.members = True\r\n`\r\n`\r\nintents.presences = True\r\n`\r\n\r\n## Checklist\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n- [x] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\n- Python v3.8.6-candidate\r\n- discord.py v1.5.1-final\r\n- aiohttp v3.6.2\r\n- system info: Windows 10 10.0.19041\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5955/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5955/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5953", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5953/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5953/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5953/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5953", "id": 725415533, "node_id": "MDU6SXNzdWU3MjU0MTU1MzM=", "number": 5953, "title": "Not connected to voice when moving bot to another voice channel", "user": {"login": "Travisivart", "id": 11952514, "node_id": "MDQ6VXNlcjExOTUyNTE0", "avatar_url": "https://avatars.githubusercontent.com/u/11952514?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Travisivart", "html_url": "https://github.com/Travisivart", "followers_url": "https://api.github.com/users/Travisivart/followers", "following_url": "https://api.github.com/users/Travisivart/following{/other_user}", "gists_url": "https://api.github.com/users/Travisivart/gists{/gist_id}", "starred_url": "https://api.github.com/users/Travisivart/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Travisivart/subscriptions", "organizations_url": "https://api.github.com/users/Travisivart/orgs", "repos_url": "https://api.github.com/users/Travisivart/repos", "events_url": "https://api.github.com/users/Travisivart/events{/privacy}", "received_events_url": "https://api.github.com/users/Travisivart/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/12", "html_url": "https://github.com/Rapptz/discord.py/milestone/12", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/12/labels", "id": 6134466, "node_id": "MDk6TWlsZXN0b25lNjEzNDQ2Ng==", "number": 12, "title": "v1.6", "description": "A minor version bump to appease the masses. ", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 30, "state": "closed", "created_at": "2020-11-22T03:43:55Z", "updated_at": "2021-01-15T10:25:08Z", "due_on": null, "closed_at": "2021-01-15T10:25:08Z"}, "comments": 2, "created_at": "2020-10-20T09:57:30Z", "updated_at": "2020-11-22T04:14:18Z", "closed_at": "2020-11-22T04:14:18Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\nI believe this may be somewhat related to #5904 \r\nI was using discord.py 1.5.0 and experienced the issue in #5904 where upon moving the bot either with the move_to method or manually moving using right click -> move to the bot would connect to the channel and then immediately disconnect.\r\n\r\nOnce upgrading to 1.5.1 the above issue was resolved, however, there is still some oddness when moving the bot. Sometimes the bot will move correctly and other times it encounters an error:\r\n\r\n## Reproduction Steps\r\n\r\nStart a bot and have it play audio. Use a command to execute the move_to method or manually move the bot to another voice channel while it is playing audio.\r\n\r\nUsually, whatever audio is currently playing will end and the play methods after=lambda function will execute, in my case it will move onto the next song in the queue.\r\n\r\nThis is tricky to reproduce because you have to keep moving the bot between channels until it occurs. Occasionally the bot will encounter the error described above. This would sometimes occur on the first move_to and on other times would take 10 or even 20 moves before the error would occur.\r\n\r\n## Expected Results\r\n\r\nThere are two things which I would expect to occur.\r\n\r\nPreviously (in 1.4.0) when the bot would move between channels with the move_to command, the audio stream wouldn't end and the after=lambda would not execute moving onto the next audio stream. It would rather flawlessly just continue the current audio stream. Now the audio stream ends and the next one begins when switching voice channels. I have been able to somewhat mitigate this by executing a pause() before executing the move_to(new_voice_channel) then using a resume() afterwards, however I still encounter the above Not connected to voice error on occasion.\r\n\r\nSecondly, I would expect the bot to move to a channel without the strange occasional error described above.\r\n\r\n## Actual Results\r\n\r\nOn occasion, sometimes on the first move_to, other times, after 10 or 20 moves the bot will encounter an error:\r\n\r\n```sh\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3.8/site-packages/discord/player.py\", line 598, in run\r\n    self._do_run()\r\n  File \"/usr/lib/python3.8/site-packages/discord/player.py\", line 591, in _do_run\r\n    play_audio(data, encode=not self.source.is_opus())\r\n  File \"/usr/lib/python3.8/site-packages/discord/voice_client.py\", line 635, in send_audio_packet\r\n    self.socket.sendto(packet, (self.endpoint_ip, self.voice_port))\r\nTypeError: str, bytes or bytearray expected, not NoneType\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3.8/site-packages/discord/player.py\", line 611, in _call_after\r\n    self.after(error)\r\n  File \"/tga-bot/TGA-Bot/bot/features/music/music.py\", line 96, in <lambda>\r\n    after=lambda e: self._finished_song())\r\n  File \"/tga-bot/TGA-Bot/bot/features/music/music.py\", line 102, in _finished_song\r\n    self._play_next()\r\n  File \"/tga-bot/TGA-Bot/bot/features/music/music.py\", line 92, in _play_next\r\n    self.voice_client.play(discord.PCMVolumeTransformer(\r\n  File \"/usr/lib/python3.8/site-packages/discord/voice_client.py\", line 552, in play\r\n    raise ClientException('Not connected to voice.')\r\ndiscord.errors.ClientException: Not connected to voice.\r\n```\r\n\r\n## Intents\r\n\r\nIntents are not passed and thus defaults to every intent being enabled except privileged as described [here](https://discordpy.readthedocs.io/ja/latest/intents.html)\r\n\r\n## Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n- [X] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\n- Python v3.8.5-final\r\n- discord.py v1.5.1-final\r\n- aiohttp v3.6.2\r\n- system info: Linux 5.4.0-48-generic #52-Ubuntu SMP Thu Sep 10 10:58:49 UTC 2020\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5953/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5953/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5951", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5951/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5951/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5951/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5951", "id": 724600858, "node_id": "MDU6SXNzdWU3MjQ2MDA4NTg=", "number": 5951, "title": "on_guild_join does not get a list of all server members", "user": {"login": "SteweX", "id": 71728819, "node_id": "MDQ6VXNlcjcxNzI4ODE5", "avatar_url": "https://avatars.githubusercontent.com/u/71728819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SteweX", "html_url": "https://github.com/SteweX", "followers_url": "https://api.github.com/users/SteweX/followers", "following_url": "https://api.github.com/users/SteweX/following{/other_user}", "gists_url": "https://api.github.com/users/SteweX/gists{/gist_id}", "starred_url": "https://api.github.com/users/SteweX/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SteweX/subscriptions", "organizations_url": "https://api.github.com/users/SteweX/orgs", "repos_url": "https://api.github.com/users/SteweX/repos", "events_url": "https://api.github.com/users/SteweX/events{/privacy}", "received_events_url": "https://api.github.com/users/SteweX/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2020-10-19T13:17:09Z", "updated_at": "2020-10-19T19:16:37Z", "closed_at": "2020-10-19T13:58:53Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi, after the update, I just can't get a list of all server members when the bot connects to it\r\n\r\n```\r\nimport discord\r\nintents = discord.Intents.default()\r\nintents.members = True\r\nintents.guilds = True\r\n```\r\n\r\nHere is the event itself\r\n```\r\n@bot.event\r\nasync def on_guild_join(guild):\r\n    for member in guild.members:\r\n        print('-------------------')\r\n        print (member.id)\r\n```\r\nFor some reason, it only displays the bot itself\r\nAnd I don't know what to do, it's either a bug, or I'm crooked", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5951/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5951/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5949", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5949/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5949/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5949/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5949", "id": 724188698, "node_id": "MDU6SXNzdWU3MjQxODg2OTg=", "number": 5949, "title": "Bot user is deleted from Member cache when disconnecting from voice", "user": {"login": "tctree333", "id": 32943907, "node_id": "MDQ6VXNlcjMyOTQzOTA3", "avatar_url": "https://avatars.githubusercontent.com/u/32943907?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tctree333", "html_url": "https://github.com/tctree333", "followers_url": "https://api.github.com/users/tctree333/followers", "following_url": "https://api.github.com/users/tctree333/following{/other_user}", "gists_url": "https://api.github.com/users/tctree333/gists{/gist_id}", "starred_url": "https://api.github.com/users/tctree333/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tctree333/subscriptions", "organizations_url": "https://api.github.com/users/tctree333/orgs", "repos_url": "https://api.github.com/users/tctree333/repos", "events_url": "https://api.github.com/users/tctree333/events{/privacy}", "received_events_url": "https://api.github.com/users/tctree333/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-10-19T01:10:15Z", "updated_at": "2021-02-21T06:58:58Z", "closed_at": "2020-10-19T01:48:51Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\nCalling `client.disconnect()` causes the bot user to be removed from the member cache and `ctx.guild.me` to return `None`.\r\n\r\n## Reproduction Steps\r\nI have a disconnect function:\r\n```python\r\nasync def disconnect(ctx):\r\n    client = await get_voice_client(ctx) # returns a VoiceClient\r\n    client.stop()\r\n    print(\"1\", ctx.guild.me)\r\n    await client.disconnect()\r\n    print(\"2\", ctx.guild.me)\r\n    await ctx.send(\"Bye!\")\r\n    print(\"3\", ctx.guild.me)\r\n```\r\nWhich outputs:\r\n```\r\n1 botuser#discrim\r\n2 botuser#discrim\r\n3 None\r\n```\r\nCommenting out the `await client.disconnect()` line causes all 3 print statements to print the `botuser#discrim` as expected. \r\n\r\nThere also seems to be a 0.1 - 0.2 second delay between calling `client.disconnect()` and when `ctx.guild.me` starts returning `None`, so the 2nd print outputs the expected result while the 3rd print does not. Replacing `await ctx.send(\"Bye!\")` with `await asyncio.sleep(0.2)` also causes the 3rd print to become `None`, while sleeping for only 0.1 seconds doesn't.\r\n\r\n## Expected Results\r\n`ctx.guild.me` should return the Member version of the current user (the bot).\r\n\r\n## Actual Results\r\n`ctx.guild.me` is None after the `ctx.send()` and the `client.disconnect()`.\r\n\r\n## Intents\r\n```python\r\nintent: discord.Intents = discord.Intents.none()\r\nintent.guilds = True\r\nintent.messages = True\r\nintent.voice_states = True\r\n```\r\nI'm not using the Member intent, but the docs say that the bot's own member should always be cached.\r\n\r\n## Checklist\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n- [x] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n```\r\n- Python v3.7.9-final\r\n- discord.py v1.5.0-final\r\n- aiohttp v3.6.2\r\n- system info: Darwin 19.6.0 Darwin Kernel Version 19.6.0: Mon Aug 31 22:12:52 PDT 2020; root:xnu-6153.141.2~1/RELEASE_X86_64\r\n```", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5949/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5949/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5945", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5945/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5945/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5945/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5945", "id": 723834536, "node_id": "MDU6SXNzdWU3MjM4MzQ1MzY=", "number": 5945, "title": "Shortcuts combining other intents in `discord.Intents` are returned in `iter(x)`", "user": {"login": "Jackenmen", "id": 6032823, "node_id": "MDQ6VXNlcjYwMzI4MjM=", "avatar_url": "https://avatars.githubusercontent.com/u/6032823?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jackenmen", "html_url": "https://github.com/Jackenmen", "followers_url": "https://api.github.com/users/Jackenmen/followers", "following_url": "https://api.github.com/users/Jackenmen/following{/other_user}", "gists_url": "https://api.github.com/users/Jackenmen/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jackenmen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jackenmen/subscriptions", "organizations_url": "https://api.github.com/users/Jackenmen/orgs", "repos_url": "https://api.github.com/users/Jackenmen/repos", "events_url": "https://api.github.com/users/Jackenmen/events{/privacy}", "received_events_url": "https://api.github.com/users/Jackenmen/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-10-17T19:42:56Z", "updated_at": "2020-10-17T22:51:54Z", "closed_at": "2020-10-17T22:51:54Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## Summary\r\n\r\nI'm making the issue per earlier conversation in #bikeshedding.\r\n\r\nIterator `iter(intents_object)` returns the shortcuts (i.e. `typing`) combining other intents (`guild_typing` and `dm_typing` in `typing`'s case), which makes it a bit harder to work for, when you want to get a list of disabled intents.\r\n\r\n## Reproduction Steps\r\n\r\n```py\r\nintents = discord.Intents(typing=True)\r\nfor intent_name, value in intents:\r\n    if value is True:\r\n        print(intent_name)\r\n```\r\n\r\n## Expected Results\r\n\r\nI expected the result to be:\r\n```\r\nguild_typing\r\ndm_typing\r\n```\r\n\r\n## Actual Results\r\n\r\nThe result was:\r\n```\r\ntyping\r\nguild_typing\r\ndm_typing\r\n```\r\n\r\n## Intents\r\n\r\n`discord.Intents(typing=True)`\r\n\r\n## Checklist\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n- [x] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\n```\r\n- Python v3.8.6-final\r\n- discord.py v1.5.0-final\r\n- aiohttp v3.6.2\r\n- system info: Windows 10 10.0.18362\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5945/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5945/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5943", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5943/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5943/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5943/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5943", "id": 723737093, "node_id": "MDU6SXNzdWU3MjM3MzcwOTM=", "number": 5943, "title": "Install Python Discord", "user": {"login": "NimaWoods", "id": 50515051, "node_id": "MDQ6VXNlcjUwNTE1MDUx", "avatar_url": "https://avatars.githubusercontent.com/u/50515051?v=4", "gravatar_id": "", "url": "https://api.github.com/users/NimaWoods", "html_url": "https://github.com/NimaWoods", "followers_url": "https://api.github.com/users/NimaWoods/followers", "following_url": "https://api.github.com/users/NimaWoods/following{/other_user}", "gists_url": "https://api.github.com/users/NimaWoods/gists{/gist_id}", "starred_url": "https://api.github.com/users/NimaWoods/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/NimaWoods/subscriptions", "organizations_url": "https://api.github.com/users/NimaWoods/orgs", "repos_url": "https://api.github.com/users/NimaWoods/repos", "events_url": "https://api.github.com/users/NimaWoods/events{/privacy}", "received_events_url": "https://api.github.com/users/NimaWoods/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-10-17T11:31:44Z", "updated_at": "2020-10-17T11:32:33Z", "closed_at": "2020-10-17T11:32:22Z", "author_association": "NONE", "active_lock_reason": null, "body": "", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5943/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5943/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5929", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5929/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5929/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5929/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5929", "id": 721110322, "node_id": "MDU6SXNzdWU3MjExMTAzMjI=", "number": 5929, "title": "PermissionOverwrite's __eq__ has a logic error", "user": {"login": "egnor", "id": 279819, "node_id": "MDQ6VXNlcjI3OTgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/279819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/egnor", "html_url": "https://github.com/egnor", "followers_url": "https://api.github.com/users/egnor/followers", "following_url": "https://api.github.com/users/egnor/following{/other_user}", "gists_url": "https://api.github.com/users/egnor/gists{/gist_id}", "starred_url": "https://api.github.com/users/egnor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/egnor/subscriptions", "organizations_url": "https://api.github.com/users/egnor/orgs", "repos_url": "https://api.github.com/users/egnor/repos", "events_url": "https://api.github.com/users/egnor/events{/privacy}", "received_events_url": "https://api.github.com/users/egnor/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2020-10-14T03:44:59Z", "updated_at": "2020-10-17T21:21:05Z", "closed_at": "2020-10-17T08:20:03Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\n\r\nThe `PermissionOverwrite` class's `__eq__` method gives a false negative (says two things are not equal when they are) if one instance has had a permission set to None, where the other has never had it set.\r\n\r\n## Reproduction Steps\r\n\r\n```\r\n% python\r\nPython 3.8.2 (default, Jul 16 2020, 14:00:26) \r\n[GCC 9.3.0] on linux\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import discord\r\n>>> o1 = discord.PermissionOverwrite(read_messages=None)\r\n>>> o2 = discord.PermissionOverwrite()\r\n>>> o1 == o2\r\nFalse\r\n```\r\n\r\n## Expected Results\r\n\r\n`True`\r\n\r\n## Actual Results\r\n\r\n`False`\r\n\r\n## Intents\r\n\r\nN/A\r\n\r\n## Checklist\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n- [x] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\n```\r\n- Python v3.8.2-final\r\n- discord.py v1.5.0-final\r\n- aiohttp v3.6.2\r\n- system info: Linux 5.4.0-26-generic #30-Ubuntu SMP Mon Apr 20 16:58:30 UTC 2020\r\n```", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5929/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5929/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5923", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5923/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5923/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5923/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5923", "id": 719823054, "node_id": "MDU6SXNzdWU3MTk4MjMwNTQ=", "number": 5923, "title": "Logic error in channel re-sorting when assigning position", "user": {"login": "egnor", "id": 279819, "node_id": "MDQ6VXNlcjI3OTgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/279819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/egnor", "html_url": "https://github.com/egnor", "followers_url": "https://api.github.com/users/egnor/followers", "following_url": "https://api.github.com/users/egnor/following{/other_user}", "gists_url": "https://api.github.com/users/egnor/gists{/gist_id}", "starred_url": "https://api.github.com/users/egnor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/egnor/subscriptions", "organizations_url": "https://api.github.com/users/egnor/orgs", "repos_url": "https://api.github.com/users/egnor/repos", "events_url": "https://api.github.com/users/egnor/events{/privacy}", "received_events_url": "https://api.github.com/users/egnor/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2020-10-13T03:20:00Z", "updated_at": "2020-10-17T21:21:46Z", "closed_at": "2020-10-17T08:20:03Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\n\r\nThere's a logic error in the way the channel list is sorted when setting the position of a channel, which leads to channels being moved to the wrong location. This is the code from [abc.py line 230](https://github.com/Rapptz/discord.py/blob/master/discord/abc.py#L230):\r\n\r\n```\r\nindex = next((i for i, c in enumerate(channels) if c.position >= position), -1)\r\n# add ourselves at our designated position\r\nchannels.insert(index, self)\r\n```\r\n\r\nIf the desired position is at the end of the list (higher than all existing position values), index = -1. However, list.insert(-1, value) does not insert at the end -- it inserts one before the end. This ordering is then captured and used in the renumbering of position values, with the effect that you can't place a channel at the end of its group.\r\n\r\nThe fix should be quite straightforward. Let me know if you would like a PR.\r\n\r\n## Reproduction Steps\r\n\r\nWrite a bot that uses TextChannel.edit() to assign a position value at the end of the current list of channels.\r\n\r\n## Expected Results\r\n\r\nThe channel moves to the end of the list.\r\n\r\n## Actual Results\r\n\r\nThe channel moves to one before the end of the list.\r\n\r\n## Intents\r\n\r\n(I don't think this matters, but...)\r\n```\r\nintents=discord.Intents(\r\n    guilds=True, members=True,\r\n    guild_messages=True, guild_reactions=True))\r\n```\r\n\r\n## Checklist\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n- [x] I have provided the intents that my bot is using.\r\n\r\n## System Information\r\n\r\n```\r\n- Python v3.8.5-final\r\n- discord.py v1.5.0-final\r\n- aiohttp v3.6.2\r\n- system info: Linux 5.4.0-48-generic #52-Ubuntu SMP Thu Sep 10 10:58:49 UTC 2020\r\n```", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5923/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5923/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5904", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5904/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5904/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5904/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5904", "id": 715817555, "node_id": "MDU6SXNzdWU3MTU4MTc1NTU=", "number": 5904, "title": "4014 error when moving bot to another voice channel", "user": {"login": "TimK50", "id": 35925480, "node_id": "MDQ6VXNlcjM1OTI1NDgw", "avatar_url": "https://avatars.githubusercontent.com/u/35925480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TimK50", "html_url": "https://github.com/TimK50", "followers_url": "https://api.github.com/users/TimK50/followers", "following_url": "https://api.github.com/users/TimK50/following{/other_user}", "gists_url": "https://api.github.com/users/TimK50/gists{/gist_id}", "starred_url": "https://api.github.com/users/TimK50/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TimK50/subscriptions", "organizations_url": "https://api.github.com/users/TimK50/orgs", "repos_url": "https://api.github.com/users/TimK50/repos", "events_url": "https://api.github.com/users/TimK50/events{/privacy}", "received_events_url": "https://api.github.com/users/TimK50/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 15, "created_at": "2020-10-06T15:58:06Z", "updated_at": "2020-10-20T08:38:40Z", "closed_at": "2020-10-18T01:58:17Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\n\r\nI'm trying to move bot to another voice channel after it connects. But it disconnects after moving with Gateway Intent Error 4014\r\n\r\n## Reproduction Steps\r\n\r\nintents = discord.Intents.all()\r\nbot = commands.Bot(command_prefix=def_prefix, intents=intents)\r\nawait ctx.author.voice.channel.connect()\r\n\r\nthen await ctx.guild.voice_client.move_to(another.voice.channel) or manual moving\r\n\r\nthen in log:\r\n \r\n> 2020-10-06 17:40:19,780:DEBUG:discord.gateway: Keeping shard ID None voice websocket alive with timestamp 1601995219780.\r\n> 2020-10-06 17:40:19,780:DEBUG:discord.gateway: Sending voice websocket frame: {'op': 3, 'd': 1601995219780}.\r\n> 2020-10-06 17:40:19,789:DEBUG:discord.gateway: Voice websocket frame received: {'op': 6, 'd': 1601995219780}\r\n> 2020-10-06 17:40:21,111:DEBUG:discord.gateway: Received WSMessage(type=<WSMsgType.CLOSE: 8>, data=4014, extra='Disconnected.')\r\n> 2020-10-06 17:40:21,111:INFO:discord.voice_client: Disconnecting from voice normally, close code 4014.\r\n> 2020-10-06 17:40:21,112:INFO:discord.voice_client: The voice handshake is being terminated for Channel ID 732706167028973769 (Guild ID 659036893870293022)\r\n\r\n## Expected Results\r\n\r\nBot not disconnects after moving and continue working (before.channel = smth, after.channel = smth)\r\n\r\n## Actual Results\r\n\r\nBot moves (before.channel = smth1, after.channel = smth2)\r\nBot disconnects (before.channel = smth2, after.channel = None)\r\n\r\n## Intents\r\n\r\nintents = discord.Intents.all()\r\n\r\n## Checklist\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n- [x] I have provided the intents that my bot is using.\r\n\r\n> 4014 | Disallowed intent(s) \r\n> You sent a disallowed intent for a Gateway Intent. You may have tried to specify an intent that you have not enabled or are not whitelisted for.\r\n\r\n\r\n\r\n## System Information\r\n\r\n- Python v3.8.2-final\r\n- discord.py v1.5.0-final\r\n- aiohttp v3.6.2\r\n- system info: Windows 10 10.0.19041\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5904/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5904/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5897", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5897/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5897/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5897/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5897", "id": 715295944, "node_id": "MDU6SXNzdWU3MTUyOTU5NDQ=", "number": 5897, "title": "escape_markdown does not escape > characters after newlines", "user": {"login": "MarkKoz", "id": 1515135, "node_id": "MDQ6VXNlcjE1MTUxMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/1515135?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MarkKoz", "html_url": "https://github.com/MarkKoz", "followers_url": "https://api.github.com/users/MarkKoz/followers", "following_url": "https://api.github.com/users/MarkKoz/following{/other_user}", "gists_url": "https://api.github.com/users/MarkKoz/gists{/gist_id}", "starred_url": "https://api.github.com/users/MarkKoz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MarkKoz/subscriptions", "organizations_url": "https://api.github.com/users/MarkKoz/orgs", "repos_url": "https://api.github.com/users/MarkKoz/repos", "events_url": "https://api.github.com/users/MarkKoz/events{/privacy}", "received_events_url": "https://api.github.com/users/MarkKoz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2020-10-06T02:50:25Z", "updated_at": "2020-10-17T08:20:02Z", "closed_at": "2020-10-17T08:20:02Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## Summary\r\n\r\n<!-- A summary of your bug report -->\r\n\r\n`discord.utils.escape_markdown` does not escape `>` characters which follow newlines. This is because the regex is `^>` and the `re.MULTILINE` flag isn't set.\r\n\r\n## Reproduction Steps\r\n\r\n<!-- What you did to make it happen. Ideally there should be a short code snippet in this section to help reproduce the bug. -->\r\n```py\r\nfrom discord.utils import escape_markdown\r\nescape_markdown(\"hello\\n> world\")\r\n```\r\n## Expected Results\r\n\r\n<!-- What you expected to happen -->\r\n\r\n```py\r\n>>> escape_markdown(\"hello\\n> world\")\r\n'hello\\n\\\\> world'\r\n```\r\n\r\n## Actual Results\r\n\r\n<!-- What actually happened. If there is a traceback, please show the entire thing. -->\r\n\r\n```py\r\n>>> escape_markdown(\"hello\\n> world\")\r\n'hello\\n> world'\r\n```\r\n\r\n## Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [ ] I have shown the entire traceback, if possible. (not applicable)\r\n- [ ] I have removed my token from display, if visible. (not applicable)\r\n- [ ] I have provided the intents that my bot is using. (not applicable)\r\n\r\n## System Information\r\n\r\n<!-- Run `python -m discord -v` and paste this information below. -->\r\n<!-- This command is available in v1.1.0 or higher. If you are unable to run this command, paste basic info (ie. Python version, library version, and your operating system -->\r\n\r\n```\r\n- Python v3.8.5-final\r\n- discord.py v1.5.0-final\r\n- aiohttp v3.6.2\r\n- system info: Linux 5.8.5-arch1-1 #1 SMP PREEMPT Thu, 27 Aug 2020 18:53:02 +0000\r\n```", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5897/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5897/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5866", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5866/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5866/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5866/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5866", "id": 711460591, "node_id": "MDU6SXNzdWU3MTE0NjA1OTE=", "number": 5866, "title": "Messages aren't hashable", "user": {"login": "PythonCoderAS", "id": 13932583, "node_id": "MDQ6VXNlcjEzOTMyNTgz", "avatar_url": "https://avatars.githubusercontent.com/u/13932583?v=4", "gravatar_id": "", "url": "https://api.github.com/users/PythonCoderAS", "html_url": "https://github.com/PythonCoderAS", "followers_url": "https://api.github.com/users/PythonCoderAS/followers", "following_url": "https://api.github.com/users/PythonCoderAS/following{/other_user}", "gists_url": "https://api.github.com/users/PythonCoderAS/gists{/gist_id}", "starred_url": "https://api.github.com/users/PythonCoderAS/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/PythonCoderAS/subscriptions", "organizations_url": "https://api.github.com/users/PythonCoderAS/orgs", "repos_url": "https://api.github.com/users/PythonCoderAS/repos", "events_url": "https://api.github.com/users/PythonCoderAS/events{/privacy}", "received_events_url": "https://api.github.com/users/PythonCoderAS/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2020-09-29T21:22:46Z", "updated_at": "2020-10-17T02:46:09Z", "closed_at": "2020-10-17T02:46:09Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## Summary\r\n\r\n<!-- A summary of your bug report -->\r\n\r\nThe Message type is not hashable.\r\n\r\n## Reproduction Steps\r\n\r\n<!-- What you did to make it happen. Ideally there should be a short code snippet in this section to help reproduce the bug. -->\r\n\r\nGet a message object and try to hash it\r\n\r\n## Expected Results\r\n\r\n<!-- What you expected to happen -->\r\n\r\nThe message should have a hash, which would be the value of the guild, user/member sending it, and the message ID itself.\r\n\r\n## Actual Results\r\n\r\n<!-- What actually happened. If there is a traceback, please show the entire thing. -->\r\n\r\nTypeError: unhashable type: 'Message'\r\n\r\n\r\n## Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n\r\n## System Information\r\n\r\n<!-- Run `python -m discord -v` and paste this information below. -->\r\n<!-- This command is available in v1.1.0 or higher. If you are unable to run this command, paste basic info (ie. Python version, library version, and your operating system -->\r\n- Python v3.8.5-final\r\n- discord.py v1.5.0-final\r\n- aiohttp v3.6.2\r\n- system info: Darwin 19.6.0 Darwin Kernel Version 19.6.0: Thu Jun 18 20:49:00 PDT 2020; root:xnu-6153.141.1~1/RELEASE_X86_64\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5866/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5866/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5847", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5847/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5847/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5847/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5847", "id": 707620689, "node_id": "MDU6SXNzdWU3MDc2MjA2ODk=", "number": 5847, "title": "Bot Cant Run", "user": {"login": "johndoe434", "id": 68118162, "node_id": "MDQ6VXNlcjY4MTE4MTYy", "avatar_url": "https://avatars.githubusercontent.com/u/68118162?v=4", "gravatar_id": "", "url": "https://api.github.com/users/johndoe434", "html_url": "https://github.com/johndoe434", "followers_url": "https://api.github.com/users/johndoe434/followers", "following_url": "https://api.github.com/users/johndoe434/following{/other_user}", "gists_url": "https://api.github.com/users/johndoe434/gists{/gist_id}", "starred_url": "https://api.github.com/users/johndoe434/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/johndoe434/subscriptions", "organizations_url": "https://api.github.com/users/johndoe434/orgs", "repos_url": "https://api.github.com/users/johndoe434/repos", "events_url": "https://api.github.com/users/johndoe434/events{/privacy}", "received_events_url": "https://api.github.com/users/johndoe434/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 251130945, "node_id": "MDU6TGFiZWwyNTExMzA5NDU=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/invalid", "name": "invalid", "color": "e6e6e6", "default": true, "description": "This is not right."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 24, "created_at": "2020-09-23T19:23:28Z", "updated_at": "2022-10-13T14:46:16Z", "closed_at": "2020-09-23T20:04:44Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\n\r\nThe bot can't run\r\n## Reproduction Steps\r\n\r\n<!-- What you did to make it happen. Ideally there should be a short code snippet in this section to help reproduce the bug. -->\r\n\r\n## Expected Results\r\n\r\n<!-- What you expected to happen -->\r\nthe bot gets on\r\n\r\n## Actual Results\r\n\r\n<!-- What actually happened. If there is a traceback, please show the entire thing. -->\r\nThe bot can't run\r\n```\r\nTraceback (most recent call last):\r\n  File \"/Users/(personal info you do not need to know)/main.py\", line 34, in <module>\r\n    client.run(\"my bot token\")\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/site-packages/discord/client.py\", line 678, in run\r\n    return future.result()\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/site-packages/discord/client.py\", line 658, in runner\r\n    await self.start(*args, **kwargs)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/site-packages/discord/client.py\", line 621, in start\r\n    await self.login(*args, bot=bot)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/site-packages/discord/client.py\", line 472, in login\r\n    await self.http.static_login(token.strip(), bot=bot)\r\nAttributeError: 'NoneType' object has no attribute 'strip'\r\n```\r\n\r\n## Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n\r\n## System Information\r\n\r\n<!-- Run `python -m discord -v` and paste this information below. -->\r\n<!-- This command is available in v1.1.0 or higher. If you are unable to run this command, paste basic info (ie. Python version, library version, and your operating system -->\r\nlatest version of python and discord.py\r\nmacOS Catalina\r\n\r\n\r\n**I can't join servers not owned by someone I know**", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5847/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5847/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5846", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5846/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5846/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5846/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5846", "id": 707551427, "node_id": "MDU6SXNzdWU3MDc1NTE0Mjc=", "number": 5846, "title": "Bugged code? Im not 100% sure...", "user": {"login": "jumpy72red", "id": 37401240, "node_id": "MDQ6VXNlcjM3NDAxMjQw", "avatar_url": "https://avatars.githubusercontent.com/u/37401240?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jumpy72red", "html_url": "https://github.com/jumpy72red", "followers_url": "https://api.github.com/users/jumpy72red/followers", "following_url": "https://api.github.com/users/jumpy72red/following{/other_user}", "gists_url": "https://api.github.com/users/jumpy72red/gists{/gist_id}", "starred_url": "https://api.github.com/users/jumpy72red/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jumpy72red/subscriptions", "organizations_url": "https://api.github.com/users/jumpy72red/orgs", "repos_url": "https://api.github.com/users/jumpy72red/repos", "events_url": "https://api.github.com/users/jumpy72red/events{/privacy}", "received_events_url": "https://api.github.com/users/jumpy72red/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 251130945, "node_id": "MDU6TGFiZWwyNTExMzA5NDU=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/invalid", "name": "invalid", "color": "e6e6e6", "default": true, "description": "This is not right."}, {"id": 251130946, "node_id": "MDU6TGFiZWwyNTExMzA5NDY=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/question", "name": "question", "color": "cc317c", "default": true, "description": "This is a question about the library"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-09-23T17:32:27Z", "updated_at": "2020-09-23T17:59:17Z", "closed_at": "2020-09-23T17:59:16Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\nI am trying to get a discord bot to work, so I got round a bunch of Linux issues, and finally managed to get everything in place and I get loads of errors.\r\n<!-- A summary of your bug report -->\r\n\r\n## Reproduction Steps\r\nharry@debian:~/Code/Python$ python3.8 Bot.py\r\n(Screenshots show the python code)\r\n<!-- What you did to make it happen. Ideally there should be a short code snippet in this section to help reproduce the bug. -->\r\n\r\n## Expected Results\r\n\r\n<!-- What you expected to happen -->\r\nThe code to run.\r\n## Actual Results\r\nTraceback (most recent call last):\r\n  File \"Bot.py\", line 15, in <module>\r\n    client.run(TOKEN)\r\n  File \"/home/harry/.local/lib/python3.8/site-packages/discord/client.py\", line 678, in run\r\n    return future.result()\r\n  File \"/home/harry/.local/lib/python3.8/site-packages/discord/client.py\", line 658, in runner\r\n    await self.start(*args, **kwargs)\r\n  File \"/home/harry/.local/lib/python3.8/site-packages/discord/client.py\", line 621, in start\r\n    await self.login(*args, bot=bot)\r\n  File \"/home/harry/.local/lib/python3.8/site-packages/discord/client.py\", line 472, in login\r\n    await self.http.static_login(token.strip(), bot=bot)\r\nAttributeError: 'NoneType' object has no attribute 'strip'\r\n\r\n![Screenshot from 2020-09-23 18-27-31](https://user-images.githubusercontent.com/37401240/94048141-f1319100-fdca-11ea-827a-22f8ed343906.png)\r\n![Screenshot from 2020-09-23 18-27-52](https://user-images.githubusercontent.com/37401240/94048146-f55dae80-fdca-11ea-90b7-82d7234b7c94.png)\r\n\r\n<!-- What actually happened. If there is a traceback, please show the entire thing. -->\r\n\r\n\r\n## Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [ x] I have searched the open issues for duplicates.\r\n- [ x] I have shown the entire traceback, if possible.\r\n- [ x] I have removed my token from display, if visible.\r\n\r\n## System Information\r\n\r\n<!-- Run `python -m discord -v` and paste this information below. -->\r\n<!-- This command is available in v1.1.0 or higher. If you are unable to run this command, paste basic info (ie. Python version, library version, and your operating system -->\r\nharry@debian:~/Code/Python$ python3.8 -m discord -v\r\n- Python v3.8.5-final\r\n- discord.py v1.4.1-final\r\n- aiohttp v3.6.2\r\n- system info: Linux 4.19.0-10-amd64 #1 SMP Debian 4.19.132-1 (2020-07-24)\r\nharry@debian:~/Code/Python$ \r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5846/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5846/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5845", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5845/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5845/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5845/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5845", "id": 707455866, "node_id": "MDU6SXNzdWU3MDc0NTU4NjY=", "number": 5845, "title": "Custom Context returning error", "user": {"login": "12944qwerty", "id": 45984786, "node_id": "MDQ6VXNlcjQ1OTg0Nzg2", "avatar_url": "https://avatars.githubusercontent.com/u/45984786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/12944qwerty", "html_url": "https://github.com/12944qwerty", "followers_url": "https://api.github.com/users/12944qwerty/followers", "following_url": "https://api.github.com/users/12944qwerty/following{/other_user}", "gists_url": "https://api.github.com/users/12944qwerty/gists{/gist_id}", "starred_url": "https://api.github.com/users/12944qwerty/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/12944qwerty/subscriptions", "organizations_url": "https://api.github.com/users/12944qwerty/orgs", "repos_url": "https://api.github.com/users/12944qwerty/repos", "events_url": "https://api.github.com/users/12944qwerty/events{/privacy}", "received_events_url": "https://api.github.com/users/12944qwerty/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 251130945, "node_id": "MDU6TGFiZWwyNTExMzA5NDU=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/invalid", "name": "invalid", "color": "e6e6e6", "default": true, "description": "This is not right."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-09-23T15:15:00Z", "updated_at": "2020-11-18T06:41:27Z", "closed_at": "2020-09-23T15:36:24Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\n\r\nI've made a custom context with only one extra command that inherits from `Context`. I've made my own `get_context` command which just passes `MyCtx` as the `cls` arg. However, I'm getting the following error.\r\n\r\nThis code used to work a couple days ago, but it's not working anymore.\r\n\r\n```\r\nIgnoring exception in on_message\r\nTraceback (most recent call last):\r\n  File \"/opt/virtualenvs/python3/lib/python3.8/site-packages/discord/client.py\", line 312, in _run_event\r\n    await coro(*args, **kwargs)\r\n  File \"main.py\", line 52, in on_message\r\n    await self.process_commands(message)\r\n  File \"/opt/virtualenvs/python3/lib/python3.8/site-packages/discord/ext/commands/bot.py\", line 926, in process_commands\r\n    ctx = await self.get_context(message)\r\n  File \"main.py\", line 66, in get_context\r\n    return await super().get_context(message=message, cls=MyCtx)\r\n  File \"/opt/virtualenvs/python3/lib/python3.8/site-packages/discord/ext/commands/bot.py\", line 837, in get_context\r\n    ctx = cls(prefix=None, view=view, bot=self, message=message)\r\n  File \"/home/runner/Ratchet/cogs/utils/context.py\", line 7, in __init__\r\n    super().__init__(self, *args, **kwargs)\r\nTypeError: __init__() takes 1 positional argument but 2 were given\r\n```\r\n\r\n## Reproduction Steps\r\n\r\nMyCtx Code:\r\n```py\r\nfrom discord.ext import commands\r\nimport discord\r\n\r\n\r\nclass MyCtx(commands.Context):\r\n\tdef __init__(self, *args, **kwargs):\r\n\t\tsuper().__init__(self, *args, **kwargs)\r\n\r\n\tasync def em(self, *, title, description=None, bot=None, **kwargs):\r\n\t\t\"\"\"Quick embed sending.\"\"\"\r\n\t\tkwargs.pop('title', None)\r\n\t\tkwargs.pop('description', None)\r\n\t\tkwargs.pop('color', None)\r\n\t\tkwargs.pop('bot', None)\r\n\t\tem = discord.Embed(title=title, description=description, color=discord.Color.blue())\r\n\t\tif bot is not None:\r\n\t\t\tem.set_author(name=self.bot.user.display_name, icon_url=self.bot.user.avatar_url)\r\n\t\treturn super().send(embed=em, **kwargs)\r\n```\r\n\r\n## Expected Results\r\n\r\nFor my bot to work properly without getting an error from context.\r\n\r\n\r\n## Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n\r\n## System Information\r\n\r\nrepl.it python 3.8.3\r\ndiscord.py 1.4.1\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5845/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5845/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5835", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5835/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5835/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5835/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5835", "id": 704852591, "node_id": "MDU6SXNzdWU3MDQ4NTI1OTE=", "number": 5835, "title": "\"abc.Messageable.send\" ignores \"allowed_mentions\" when \"file\" kwarg is specified", "user": {"login": "fixator10", "id": 11073934, "node_id": "MDQ6VXNlcjExMDczOTM0", "avatar_url": "https://avatars.githubusercontent.com/u/11073934?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fixator10", "html_url": "https://github.com/fixator10", "followers_url": "https://api.github.com/users/fixator10/followers", "following_url": "https://api.github.com/users/fixator10/following{/other_user}", "gists_url": "https://api.github.com/users/fixator10/gists{/gist_id}", "starred_url": "https://api.github.com/users/fixator10/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fixator10/subscriptions", "organizations_url": "https://api.github.com/users/fixator10/orgs", "repos_url": "https://api.github.com/users/fixator10/repos", "events_url": "https://api.github.com/users/fixator10/events{/privacy}", "received_events_url": "https://api.github.com/users/fixator10/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/11", "html_url": "https://github.com/Rapptz/discord.py/milestone/11", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/11/labels", "id": 5810051, "node_id": "MDk6TWlsZXN0b25lNTgxMDA1MQ==", "number": 11, "title": "1.5", "description": "The last major version in the 1.x series (probably).", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 18, "state": "closed", "created_at": "2020-08-26T02:50:17Z", "updated_at": "2020-09-29T01:07:35Z", "due_on": "2020-09-28T07:00:00Z", "closed_at": "2020-09-29T01:07:35Z"}, "comments": 2, "created_at": "2020-09-19T09:59:35Z", "updated_at": "2020-09-20T04:14:30Z", "closed_at": "2020-09-20T04:14:00Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\n\r\n\"abc.Messageable.send\" ignores \"allowed_mentions\" when \"file\" kwarg is specified\r\n\r\n## Reproduction Steps\r\n\r\n```py\r\nfile = discord.File(BytesIO())\r\nawait ctx.send(ctx.author.mention, file=file, allowed_mentions=discord.AllowedMentions(users=False))\r\n```\r\n\r\n## Expected Results\r\n\r\nUser was not mentioned\r\n\r\n## Actual Results\r\n\r\nUser was mentioned\r\n\r\n\r\n## Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n## System Information\r\n\r\n```\r\n- Python v3.8.5-final\r\n- discord.py v1.4.1-final\r\n- aiohttp v3.6.2\r\n- system info: Linux 4.15.0-112-generic #113-Ubuntu SMP Thu Jul 9 23:41:39 UTC 2020\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5835/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5835/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5819", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5819/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5819/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5819/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5819", "id": 701546960, "node_id": "MDU6SXNzdWU3MDE1NDY5NjA=", "number": 5819, "title": "Disabling guild subscriptions causes stale Message.author.roles", "user": {"login": "ioistired", "id": 538336, "node_id": "MDQ6VXNlcjUzODMzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/538336?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ioistired", "html_url": "https://github.com/ioistired", "followers_url": "https://api.github.com/users/ioistired/followers", "following_url": "https://api.github.com/users/ioistired/following{/other_user}", "gists_url": "https://api.github.com/users/ioistired/gists{/gist_id}", "starred_url": "https://api.github.com/users/ioistired/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ioistired/subscriptions", "organizations_url": "https://api.github.com/users/ioistired/orgs", "repos_url": "https://api.github.com/users/ioistired/repos", "events_url": "https://api.github.com/users/ioistired/events{/privacy}", "received_events_url": "https://api.github.com/users/ioistired/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/11", "html_url": "https://github.com/Rapptz/discord.py/milestone/11", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/11/labels", "id": 5810051, "node_id": "MDk6TWlsZXN0b25lNTgxMDA1MQ==", "number": 11, "title": "1.5", "description": "The last major version in the 1.x series (probably).", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 18, "state": "closed", "created_at": "2020-08-26T02:50:17Z", "updated_at": "2020-09-29T01:07:35Z", "due_on": "2020-09-28T07:00:00Z", "closed_at": "2020-09-29T01:07:35Z"}, "comments": 2, "created_at": "2020-09-15T02:02:20Z", "updated_at": "2020-09-17T07:00:10Z", "closed_at": "2020-09-17T07:00:10Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## Summary\r\n\r\nDisabling guild subscriptions can prevent Message.author from having up to date role information.\r\n\r\n## Reproduction Steps\r\n\r\nNote that I cannot reproduce this on my local machine, only in production. As such I cannot provide less code than the entire [bot's codebase](https://github.com/EmoteBot/EmoteManager). I am using guild_subscriptions=False, request_offline_members=False in the bot's constructor call. If, after the bot boots up, a user Muhammad grants a role to another user Rohit that in turn grants the Manage Emojis permission, Rohit cannot use any of my emoji management commands due to the [cog_check](https://github.com/EmoteBot/EmoteManager/blob/56e9d00c03211e6890531d917409859be8be9a67/cogs/emote.py#L103-L107) on those commands.\r\n\r\n## Expected Results\r\n\r\nI would expect that Rohit would be able to use them given that they have the right permissions.\r\n\r\n## Actual Results\r\n\r\nRohit is not able to use emoji management commands.\r\n\r\n## Details\r\n\r\nAs you can see, the MESSAGE_CREATE event did contain all the proper roles:\r\n\r\n```\r\nDEBUG:discord.gateway:For Shard ID 4: WebSocket Event: {'t': 'MESSAGE_CREATE', 's': 455247, 'op': 0, 'd': {'type': 0, 'tts': False, 'timestamp': '2020-09-14T23:57:30.596000+00:00', 'pinned': False, 'nonce': '755215684673208320', 'mentions': [{'username': 'Emote Manager', 'public_flags': 65536, 'member': {'roles': ['634444732071673856', '734054422409248800', '731091525139955812'], 'premium_since': None, 'nick': None, 'mute': False, 'joined_at': '2020-07-10T10:16:42.637401+00:00', 'hoisted_role': '734054422409248800', 'deaf': False}, 'id': '473370418007244852', 'discriminator': '7300', 'bot': True, 'avatar': '170751ffbf88b653b1388c95aafff606'}], 'mention_roles': [], 'mention_everyone': False, 'member': {'roles': ['734054422409248800', '731093012192690207'], 'premium_since': None, 'nick': None, 'mute': False, 'joined_at': [REDACTED], 'hoisted_role': '734054422409248800', 'deaf': False}, 'id': '755215685264605184', 'flags': 0, 'embeds': [], 'edited_timestamp': None, 'content': '<@473370418007244852> add [REDACTED]', 'channel_id': [REDACTED], 'author': {'username': [REDACTED], 'public_flags': 256, 'id': [REDACTED], 'discriminator': [REDACTED], 'avatar': [REDACTED]}, 'attachments': [], 'guild_id': [REDACTED]}}\r\n```\r\n\r\nThe important part here is\r\n\r\n```py\r\n'member': {'roles': ['734054422409248800', '731093012192690207'], ...}\r\n```\r\n\r\nhowever the actual Message object received in dpy does not contain role ID 731093012192690207. `Message.author.roles` only contains @everyone and 734054422409248800. Role ID 731093012192690207 was only added after the bot did its initial chunking on bootup.\r\n\r\n## Checklist\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n\r\n## System Information\r\n\r\n- Python v3.8.2-final\r\n- discord.py v1.4.0-final\r\n- aiohttp v3.6.2\r\n- system info: Linux 4.19.0-9-amd64 #1 SMP Debian 4.19.118-2+deb10u1 (2020-06-07)", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5819/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5819/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5808", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5808/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5808/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5808/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5808", "id": 697200572, "node_id": "MDU6SXNzdWU2OTcyMDA1NzI=", "number": 5808, "title": "[discord.ext.tasks] Loop Coro doesn't start", "user": {"login": "Luc1412", "id": 24532065, "node_id": "MDQ6VXNlcjI0NTMyMDY1", "avatar_url": "https://avatars.githubusercontent.com/u/24532065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Luc1412", "html_url": "https://github.com/Luc1412", "followers_url": "https://api.github.com/users/Luc1412/followers", "following_url": "https://api.github.com/users/Luc1412/following{/other_user}", "gists_url": "https://api.github.com/users/Luc1412/gists{/gist_id}", "starred_url": "https://api.github.com/users/Luc1412/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Luc1412/subscriptions", "organizations_url": "https://api.github.com/users/Luc1412/orgs", "repos_url": "https://api.github.com/users/Luc1412/repos", "events_url": "https://api.github.com/users/Luc1412/events{/privacy}", "received_events_url": "https://api.github.com/users/Luc1412/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/11", "html_url": "https://github.com/Rapptz/discord.py/milestone/11", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/11/labels", "id": 5810051, "node_id": "MDk6TWlsZXN0b25lNTgxMDA1MQ==", "number": 11, "title": "1.5", "description": "The last major version in the 1.x series (probably).", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 18, "state": "closed", "created_at": "2020-08-26T02:50:17Z", "updated_at": "2020-09-29T01:07:35Z", "due_on": "2020-09-28T07:00:00Z", "closed_at": "2020-09-29T01:07:35Z"}, "comments": 3, "created_at": "2020-09-09T22:24:35Z", "updated_at": "2021-02-12T11:31:57Z", "closed_at": "2020-09-10T04:01:53Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\r\n \r\nAm using the `discord.ext.tasks` extension in my project. When I use it in a cog it works fine. In other cases outside a cog, the task gets created, but the core (including before_loop) doesn't start. \r\n\r\nI also got the same issue some time ago, that the task doesn't start in a specific cog.\r\n\r\nThis is a test environment and gets frequently restarted without canceling the task.\r\n\r\n\r\n### Reproduction Steps\r\n\r\n```py\r\nclass Cache:\r\n\r\n    def __init__(self):\r\n        self.bot = bot\r\n        self.cache_update_loop.start()\r\n        print('init')\r\n\r\n    @tasks.loop(seconds=5)\r\n    async def cache_update_loop(self):\r\n        print(1)\r\n\r\n    @cache_update_loop.before_loop\r\n    async def before_cache_update_loop(self):\r\n        print('before')\r\n```\r\n\r\n```py\r\n    async def connect_all(self):\r\n        self.cache= Cache()\r\n        await self.start(self.config.get('core.{mode}.token'))\r\n\r\nif __name__ == '__main__':\r\n    if sys.platform == 'win32' and sys.version_info >= (3, 8):\r\n        asyncio.set_event_loop_policy(asyncio.WindowsSelectorEventLoopPolicy())\r\n    elif sys.platform == 'linux':\r\n        asyncio.set_event_loop_policy(uvloop.EventLoopPolicy())\r\n\r\n    bot = Bot()\r\n\r\n    loop = asyncio.get_event_loop()\r\n    try:\r\n        loop.run_until_complete(bot.connect_all())\r\n    except discord.LoginFailure:\r\n        bot.logger.exception(traceback.format_exc())\r\n    except Exception as exc:\r\n        bot.logger.exception(f'[CORE] Fatal exception! Bot is not able to login. Attempting graceful logout!\\n\\n'\r\n                             f'```py\\n{traceback.format_exc()}```')\r\n        loop.run_until_complete(bot.logout())\r\n    finally:\r\n        if hasattr(loop, 'shutdown_asyncgens'):\r\n            loop.run_until_complete(loop.shutdown_asyncgens())\r\n        loop.close()\r\n```\r\n\r\n\r\nResult:\r\n```\r\ninit\r\n```\r\n\r\n### Expected Results\r\n\r\nIt prints 'before'.  Afterward '1' every 5 seconds.\r\n\r\n### Actual Results\r\n\r\nOnly 'init' gets printed. `start()` returns a Task\r\n\r\n\r\n### Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n\r\n- Python v3.8.2-final\r\n- discord.py v1.4.1-final\r\n- aiohttp v3.6.2\r\n- system info: Windows 10 10.0.19041\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5808/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5808/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5800", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5800/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5800/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5800/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5800", "id": 696023766, "node_id": "MDU6SXNzdWU2OTYwMjM3NjY=", "number": 5800, "title": "AttributeError: 'NoneType' object has no attribute 'ack'", "user": {"login": "SamSanai", "id": 38131935, "node_id": "MDQ6VXNlcjM4MTMxOTM1", "avatar_url": "https://avatars.githubusercontent.com/u/38131935?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SamSanai", "html_url": "https://github.com/SamSanai", "followers_url": "https://api.github.com/users/SamSanai/followers", "following_url": "https://api.github.com/users/SamSanai/following{/other_user}", "gists_url": "https://api.github.com/users/SamSanai/gists{/gist_id}", "starred_url": "https://api.github.com/users/SamSanai/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SamSanai/subscriptions", "organizations_url": "https://api.github.com/users/SamSanai/orgs", "repos_url": "https://api.github.com/users/SamSanai/repos", "events_url": "https://api.github.com/users/SamSanai/events{/privacy}", "received_events_url": "https://api.github.com/users/SamSanai/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/11", "html_url": "https://github.com/Rapptz/discord.py/milestone/11", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/11/labels", "id": 5810051, "node_id": "MDk6TWlsZXN0b25lNTgxMDA1MQ==", "number": 11, "title": "1.5", "description": "The last major version in the 1.x series (probably).", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 18, "state": "closed", "created_at": "2020-08-26T02:50:17Z", "updated_at": "2020-09-29T01:07:35Z", "due_on": "2020-09-28T07:00:00Z", "closed_at": "2020-09-29T01:07:35Z"}, "comments": 1, "created_at": "2020-09-08T16:42:09Z", "updated_at": "2020-09-10T01:25:44Z", "closed_at": "2020-09-10T01:25:43Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nAt random times every other day I get this error and it just shuts down one of my clusters having to restart it. Only started happening a week maybe 2 ago.\r\n\r\n### Reproduction Steps\r\n\r\nHappens while the bot is running no idea how to reproduce it.\r\n\r\n### Expected Results\r\n\r\nBot running as usual without an issue.\r\n\r\n### Actual Results\r\nTraceback:\r\n```\r\n2020-09-08 09:18:22   -   ready to go...\r\n\r\nTraceback (most recent call last):\r\n  File \"voicemaster.py\", line 264, in <module>\r\n    bot.run(bot_token)\r\n  File \"/usr/local/lib/python3.6/dist-packages/discord/client.py\", line 678, in run\r\n    return future.result()\r\n  File \"/usr/local/lib/python3.6/dist-packages/discord/client.py\", line 658, in runner\r\n    await self.start(*args, **kwargs)\r\n  File \"/usr/local/lib/python3.6/dist-packages/discord/client.py\", line 622, in start\r\n    await self.connect(reconnect=reconnect)\r\n  File \"/usr/local/lib/python3.6/dist-packages/discord/shard.py\", line 414, in connect\r\n    raise item.error\r\n  File \"/usr/local/lib/python3.6/dist-packages/discord/shard.py\", line 140, in worker\r\n    await self.ws.poll_event()\r\n  File \"/usr/local/lib/python3.6/dist-packages/discord/gateway.py\", line 504, in poll_event\r\n    await self.received_message(msg.data)\r\n  File \"/usr/local/lib/python3.6/dist-packages/discord/gateway.py\", line 401, in received_message\r\n    self._keep_alive.ack()\r\nAttributeError: 'NoneType' object has no attribute 'ack'\r\nUnclosed client session\r\nclient_session: <aiohttp.client.ClientSession object at 0x7f88a6110828>\r\n```\r\nlogging.INFO logs:\r\n\r\n```\r\n2020-09-08 09:15:16,922:WARNING:discord.client: PyNaCl is not installed, voice will NOT be supported\r\n2020-09-08 09:15:16,978:INFO:discord.client: logging in using static token\r\n2020-09-08 09:15:17,161:INFO:discord.gateway: Shard ID 20 has sent the IDENTIFY payload.\r\n2020-09-08 09:15:19,908:INFO:discord.gateway: Shard ID 20 has connected to Gateway: [\"gateway-prd-main-2j63\",{\"micros\":2706904,\"calls\":[\"discord-sessions-prd-2-8\",{\"micros\":2698737,\"calls\":[\"start_session\",{\"micros\":312750,\"calls\":[\"api-prd-main-h0tw\",{\"micros\":309532,\"calls\":[\"get_user\",{\"micros\":2331},\"add_authorized_ip\",{\"micros\":1428},\"get_guilds\",{\"micros\":274016},\"coros_wait\",{\"micros\":1}]}]},\"guilds_connect\",{\"micros\":247,\"calls\":[]},\"presence_connect\",{\"micros\":2,\"calls\":[]}]}]}] (Session ID: f24b951795256219ffd2ff261f316e58).\r\n2020-09-08 09:15:22,497:INFO:discord.gateway: Shard ID 21 has sent the IDENTIFY payload.\r\n2020-09-08 09:15:25,932:INFO:discord.gateway: Shard ID 21 has connected to Gateway: [\"gateway-prd-main-1m02\",{\"micros\":3052390,\"calls\":[\"discord-sessions-prd-2-37\",{\"micros\":3045827,\"calls\":[\"start_session\",{\"micros\":330474,\"calls\":[\"api-prd-main-6vkw\",{\"micros\":327521,\"calls\":[\"get_user\",{\"micros\":3166},\"add_authorized_ip\",{\"micros\":3395},\"get_guilds\",{\"micros\":289982},\"coros_wait\",{\"micros\":2}]}]},\"guilds_connect\",{\"micros\":316,\"calls\":[]},\"presence_connect\",{\"micros\":2,\"calls\":[]}]}]}] (Session ID: 5c2a13dee95a5e8806c5851fe4304a46).\r\n2020-09-08 09:15:29,782:INFO:discord.gateway: Shard ID 22 has sent the IDENTIFY payload.\r\n2020-09-08 09:15:32,499:INFO:discord.gateway: Shard ID 22 has connected to Gateway: [\"gateway-prd-main-s26j\",{\"micros\":2411567,\"calls\":[\"discord-sessions-prd-2-14\",{\"micros\":2410148,\"calls\":[\"start_session\",{\"micros\":344898,\"calls\":[\"api-prd-main-2zjb\",{\"micros\":341073,\"calls\":[\"get_user\",{\"micros\":4378},\"add_authorized_ip\",{\"micros\":1150},\"get_guilds\",{\"micros\":301009},\"coros_wait\",{\"micros\":1}]}]},\"guilds_connect\",{\"micros\":327,\"calls\":[]},\"presence_connect\",{\"micros\":1,\"calls\":[]}]}]}] (Session ID: 847f17168c4fed7002bfb2ee090ce6d5).\r\n2020-09-08 09:15:38,889:INFO:discord.gateway: Shard ID 23 has sent the IDENTIFY payload.\r\n2020-09-08 09:15:41,996:INFO:discord.gateway: Shard ID 23 has connected to Gateway: [\"gateway-prd-main-03dm\",{\"micros\":2696066,\"calls\":[\"discord-sessions-prd-2-64\",{\"micros\":2693648,\"calls\":[\"start_session\",{\"micros\":364325,\"calls\":[\"api-prd-main-p2gv\",{\"micros\":360985,\"calls\":[\"get_user\",{\"micros\":2164},\"add_authorized_ip\",{\"micros\":1576},\"get_guilds\",{\"micros\":302213},\"coros_wait\",{\"micros\":2}]}]},\"guilds_connect\",{\"micros\":294,\"calls\":[]},\"presence_connect\",{\"micros\":1,\"calls\":[]}]}]}] (Session ID: 312d352583211747b4ab9b5f368f6f16).\r\n2020-09-08 09:15:49,855:INFO:discord.gateway: Shard ID 24 has sent the IDENTIFY payload.\r\n2020-09-08 09:15:53,051:INFO:discord.gateway: Shard ID 24 has connected to Gateway: [\"gateway-prd-main-tm2c\",{\"micros\":2780324,\"calls\":[\"discord-sessions-prd-2-55\",{\"micros\":2778892,\"calls\":[\"start_session\",{\"micros\":702783,\"calls\":[\"api-prd-main-wt4c\",{\"micros\":362976,\"calls\":[\"get_user\",{\"micros\":9065},\"add_authorized_ip\",{\"micros\":3078},\"get_guilds\",{\"micros\":285071},\"coros_wait\",{\"micros\":2}]}]},\"guilds_connect\",{\"micros\":334,\"calls\":[]},\"presence_connect\",{\"micros\":2,\"calls\":[]}]}]}] (Session ID: 9ca5f871f05ff3f3e13a37c03838f3ae).\r\n2020-09-08 09:16:02,620:INFO:discord.gateway: Shard ID 25 has sent the IDENTIFY payload.\r\n2020-09-08 09:16:10,111:INFO:discord.gateway: Shard ID 25 has connected to Gateway: [\"gateway-prd-main-z971\",{\"micros\":2477527,\"calls\":[\"discord-sessions-prd-2-30\",{\"micros\":2471539,\"calls\":[\"start_session\",{\"micros\":389085,\"calls\":[\"api-prd-main-pt6w\",{\"micros\":383349,\"calls\":[\"get_user\",{\"micros\":7201},\"add_authorized_ip\",{\"micros\":1152},\"get_guilds\",{\"micros\":323830},\"coros_wait\",{\"micros\":1}]}]},\"guilds_connect\",{\"micros\":367,\"calls\":[]},\"presence_connect\",{\"micros\":2,\"calls\":[]}]}]}] (Session ID: 655f3edcde8af9dd334f89ff94b79290).\r\n2020-09-08 09:16:23,644:INFO:discord.gateway: Shard ID 26 has sent the IDENTIFY payload.\r\n2020-09-08 09:16:27,988:INFO:discord.gateway: Shard ID 26 has connected to Gateway: [\"gateway-prd-main-lnn3\",{\"micros\":3144030,\"calls\":[\"discord-sessions-prd-2-83\",{\"micros\":3117874,\"calls\":[\"start_session\",{\"micros\":363126,\"calls\":[\"api-prd-main-cw38\",{\"micros\":358212,\"calls\":[\"get_user\",{\"micros\":4005},\"add_authorized_ip\",{\"micros\":2811},\"get_guilds\",{\"micros\":300032},\"coros_wait\",{\"micros\":1}]}]},\"guilds_connect\",{\"micros\":290,\"calls\":[]},\"presence_connect\",{\"micros\":1,\"calls\":[]}]}]}] (Session ID: 2bec50d228c730b3be390b4d57d4faa5).\r\n2020-09-08 09:16:30,951:WARNING:discord.gateway: Can't keep up, shard ID 21 websocket is 31.9s behind.\r\n2020-09-08 09:16:35,969:WARNING:discord.gateway: Can't keep up, shard ID 22 websocket is 23.7s behind.\r\n2020-09-08 09:16:47,269:INFO:discord.gateway: Shard ID 27 has sent the IDENTIFY payload.\r\n2020-09-08 09:16:48,628:WARNING:discord.gateway: Can't keep up, shard ID 27 websocket is 11.5s behind.\r\n2020-09-08 09:16:51,405:INFO:discord.gateway: Shard ID 27 has connected to Gateway: [\"gateway-prd-main-kb8w\",{\"micros\":2946426,\"calls\":[\"discord-sessions-prd-2-90\",{\"micros\":2944703,\"calls\":[\"start_session\",{\"micros\":348158,\"calls\":[\"api-prd-main-txfb\",{\"micros\":344844,\"calls\":[\"get_user\",{\"micros\":2055},\"add_authorized_ip\",{\"micros\":1363},\"get_guilds\",{\"micros\":306547},\"coros_wait\",{\"micros\":2}]}]},\"guilds_connect\",{\"micros\":321,\"calls\":[]},\"presence_connect\",{\"micros\":1,\"calls\":[]}]}]}] (Session ID: 3a50213defa37b7503ad9b5eed18fe0a).\r\n2020-09-08 09:16:56,861:WARNING:discord.gateway: Shard ID 23 has stopped responding to the gateway. Closing and restarting.\r\n2020-09-08 09:16:58,210:INFO:discord.gateway: Websocket closed with 4000, attempting a reconnect.\r\n2020-09-08 09:17:07,911:WARNING:discord.gateway: Shard ID 24 has stopped responding to the gateway. Closing and restarting.\r\n2020-09-08 09:17:09,297:INFO:discord.gateway: Shard ID 28 has sent the IDENTIFY payload.\r\n2020-09-08 09:17:16,513:INFO:discord.gateway: Websocket closed with 4000, attempting a reconnect.\r\n2020-09-08 09:17:16,797:WARNING:discord.gateway: Can't keep up, shard ID 28 websocket is 15.3s behind.\r\n2020-09-08 09:17:16,798:INFO:discord.gateway: Shard ID 28 has connected to Gateway: [\"gateway-prd-main-5xkz\",{\"micros\":2773752,\"calls\":[\"discord-sessions-prd-2-2\",{\"micros\":2768516,\"calls\":[\"start_session\",{\"micros\":444463,\"calls\":[\"api-prd-main-cp73\",{\"micros\":433409,\"calls\":[\"get_user\",{\"micros\":4161},\"add_authorized_ip\",{\"micros\":8450},\"get_guilds\",{\"micros\":334813},\"coros_wait\",{\"micros\":1}]}]},\"guilds_connect\",{\"micros\":368,\"calls\":[]},\"presence_connect\",{\"micros\":1,\"calls\":[]}]}]}] (Session ID: 2c8d94c5c250be742700228c907ccd2f).\r\n2020-09-08 09:17:20,630:WARNING:discord.gateway: Shard ID 25 has stopped responding to the gateway. Closing and restarting.\r\n2020-09-08 09:17:21,431:INFO:discord.gateway: Websocket closed with 4000, attempting a reconnect.\r\n2020-09-08 09:17:25,242:WARNING:discord.gateway: Can't keep up, shard ID 20 websocket is 43.4s behind.\r\n2020-09-08 09:17:31,898:INFO:discord.gateway: Shard ID 29 has sent the IDENTIFY payload.\r\n2020-09-08 09:17:32,194:INFO:discord.shard: Got a request to RESUME the websocket at Shard ID 23.\r\n2020-09-08 09:17:41,700:INFO:discord.gateway: Shard ID 29 has connected to Gateway: [\"gateway-prd-main-lvh8\",{\"micros\":2956798,\"calls\":[\"discord-sessions-prd-1-3\",{\"micros\":2952611,\"calls\":[\"start_session\",{\"micros\":401718,\"calls\":[\"api-prd-main-t21x\",{\"micros\":398278,\"calls\":[\"get_user\",{\"micros\":8808},\"add_authorized_ip\",{\"micros\":2558},\"get_guilds\",{\"micros\":330566},\"coros_wait\",{\"micros\":1}]}]},\"guilds_connect\",{\"micros\":196,\"calls\":[]},\"presence_connect\",{\"micros\":2,\"calls\":[]}]}]}] (Session ID: a1facf6bf240fa85226ab6b11ca5b415).\r\n2020-09-08 09:17:46,242:WARNING:discord.gateway: Shard ID 26 has stopped responding to the gateway. Closing and restarting.\r\n2020-09-08 09:17:47,589:INFO:discord.gateway: Websocket closed with 4000, attempting a reconnect.\r\n2020-09-08 09:17:53,235:INFO:discord.gateway: Shard ID 23 has sent the RESUME payload.\r\n2020-09-08 09:17:53,737:INFO:discord.shard: Got a request to RESUME the websocket at Shard ID 24.\r\n2020-09-08 09:17:57,557:INFO:discord.gateway: Shard ID 23 session has been invalidated.\r\n2020-09-08 09:17:59,644:INFO:discord.gateway: Shard ID 24 has sent the RESUME payload.\r\n2020-09-08 09:18:00,022:INFO:discord.shard: Got a request to RESUME the websocket at Shard ID 25.\r\n2020-09-08 09:18:02,231:WARNING:discord.gateway: Shard ID 27 has stopped responding to the gateway. Closing and restarting.\r\n2020-09-08 09:18:03,105:INFO:discord.gateway: Websocket closed with 4000, attempting a reconnect.\r\n2020-09-08 09:18:10,635:INFO:discord.gateway: Shard ID 24 session has been invalidated.\r\n2020-09-08 09:18:11,397:INFO:discord.gateway: Shard ID 25 has sent the RESUME payload.\r\n2020-09-08 09:18:11,685:INFO:discord.shard: Got a request to RESUME the websocket at Shard ID 26.\r\n2020-09-08 09:18:15,388:WARNING:discord.gateway: Can't keep up, shard ID 28 websocket is 27.4s behind.\r\n2020-09-08 09:18:16,078:INFO:discord.gateway: Shard ID 26 has sent the RESUME payload.\r\n2020-09-08 09:18:16,274:INFO:discord.gateway: Shard ID 25 session has been invalidated.\r\n2020-09-08 09:18:16,672:INFO:discord.shard: Got a request to RESUME the websocket at Shard ID 27.\r\n2020-09-08 09:18:18,375:INFO:discord.gateway: Shard ID 27 has sent the RESUME payload.\r\n2020-09-08 09:18:18,406:INFO:discord.shard: Got a request to IDENTIFY the websocket at Shard ID 23.\r\n2020-09-08 09:18:20,247:WARNING:discord.state: GUILD_MEMBER_UPDATE referencing an unknown member ID: 732729941413593149. Discarding.\r\n2020-09-08 09:18:20,774:WARNING:discord.state: GUILD_MEMBER_UPDATE referencing an unknown member ID: 707974029482524843. Discarding.\r\n2020-09-08 09:18:21,694:WARNING:discord.gateway: Can't keep up, shard ID 29 websocket is 10.9s behind.\r\n2020-09-08 09:18:22,103:WARNING:discord.state: GUILD_MEMBER_UPDATE referencing an unknown member ID: 613807479318511656. Discarding.\r\n2020-09-08 09:18:22,147:INFO:discord.gateway: Shard ID 26 session has been invalidated.\r\n2020-09-08 09:18:22,464:INFO:discord.gateway: Shard ID 27 session has been invalidated.\r\n2020-09-08 09:18:22,516:WARNING:discord.state: GUILD_MEMBER_UPDATE referencing an unknown member ID: 476282438457360385. Discarding.\r\n2020-09-08 09:18:25,191:INFO:discord.gateway: Shard ID 23 has sent the IDENTIFY payload.\r\n2020-09-08 09:18:25,193:INFO:discord.shard: Got a request to IDENTIFY the websocket at Shard ID 24.\r\n2020-09-08 09:18:27,509:WARNING:discord.state: GUILD_MEMBER_UPDATE referencing an unknown member ID: 720159593443098665. Discarding.\r\n2020-09-08 09:18:28,119:INFO:discord.gateway: Shard ID 23 has connected to Gateway: [\"gateway-prd-main-l5rc\",{\"micros\":2867935,\"calls\":[\"discord-sessions-prd-2-35\",{\"micros\":2865720,\"calls\":[\"start_session\",{\"micros\":288478,\"calls\":[\"api-prd-main-2zjb\",{\"micros\":285912,\"calls\":[\"get_user\",{\"micros\":2310},\"add_authorized_ip\",{\"micros\":1390},\"get_guilds\",{\"micros\":260897},\"coros_wait\",{\"micros\":2}]}]},\"guilds_connect\",{\"micros\":243,\"calls\":[]},\"presence_connect\",{\"micros\":1,\"calls\":[]}]}]}] (Session ID: b2c22c0533f5b4fffa174e24d6cbf73e).\r\n2020-09-08 09:18:37,268:INFO:discord.gateway: Shard ID 24 has sent the IDENTIFY payload.\r\n2020-09-08 09:18:37,579:INFO:discord.shard: Got a request to IDENTIFY the websocket at Shard ID 26.\r\n2020-09-08 09:18:38,317:WARNING:discord.gateway: Can't keep up, shard ID 24 websocket is 13.0s behind.\r\n2020-09-08 09:18:40,930:INFO:discord.gateway: Shard ID 24 has connected to Gateway: [\"gateway-prd-main-0qhl\",{\"micros\":2662003,\"calls\":[\"discord-sessions-prd-1-15\",{\"micros\":2657197,\"calls\":[\"start_session\",{\"micros\":309374,\"calls\":[\"api-prd-main-nssz\",{\"micros\":305972,\"calls\":[\"get_user\",{\"micros\":2500},\"add_authorized_ip\",{\"micros\":1273},\"get_guilds\",{\"micros\":282041},\"coros_wait\",{\"micros\":1}]}]},\"guilds_connect\",{\"micros\":360,\"calls\":[]},\"presence_connect\",{\"micros\":1,\"calls\":[]}]}]}] (Session ID: cc18d29da330c64934aa86f7122e4d88).\r\n2020-09-08 09:18:48,477:WARNING:discord.state: GUILD_MEMBER_UPDATE referencing an unknown member ID: 142280884219805696. Discarding.\r\n2020-09-08 09:18:56,331:WARNING:discord.state: GUILD_MEMBER_UPDATE referencing an unknown member ID: 690959611716436019. Discarding.\r\n2020-09-08 09:19:01,910:WARNING:discord.state: GUILD_MEMBER_UPDATE referencing an unknown member ID: 402079984807575552. Discarding.\r\n2020-09-08 09:19:02,859:INFO:discord.gateway: Shard ID 26 has sent the IDENTIFY payload.\r\n2020-09-08 09:19:03,209:INFO:discord.shard: Got a request to IDENTIFY the websocket at Shard ID 25.\r\n2020-09-08 09:19:03,803:WARNING:discord.gateway: Can't keep up, shard ID 26 websocket is 10.4s behind.\r\n2020-09-08 09:19:07,360:INFO:discord.gateway: Shard ID 26 has connected to Gateway: [\"gateway-prd-main-59ft\",{\"micros\":3516608,\"calls\":[\"discord-sessions-prd-1-10\",{\"micros\":3514130,\"calls\":[\"start_session\",{\"micros\":754318,\"calls\":[\"api-prd-main-nnm0\",{\"micros\":750671,\"calls\":[\"get_user\",{\"micros\":3096},\"add_authorized_ip\",{\"micros\":2333},\"get_guilds\",{\"micros\":697028},\"coros_wait\",{\"micros\":1}]}]},\"guilds_connect\",{\"micros\":286,\"calls\":[]},\"presence_connect\",{\"micros\":2,\"calls\":[]}]}]}] (Session ID: 4af5cdea8c3f10c0328addb89994ee0e).\r\n2020-09-08 09:19:14,764:WARNING:discord.state: GUILD_MEMBER_UPDATE referencing an unknown member ID: 662371003409760298. Discarding.\r\n2020-09-08 09:19:17,656:WARNING:discord.state: GUILD_MEMBER_UPDATE referencing an unknown member ID: 347563165615390732. Discarding.\r\n2020-09-08 09:19:18,095:WARNING:discord.state: GUILD_MEMBER_UPDATE referencing an unknown member ID: 717220354669674556. Discarding.\r\n2020-09-08 09:19:22,804:INFO:discord.gateway: Shard ID 25 has sent the IDENTIFY payload.\r\n2020-09-08 09:19:23,309:INFO:discord.shard: Got a request to IDENTIFY the websocket at Shard ID 27.\r\n2020-09-08 09:19:26,123:INFO:discord.gateway: Shard ID 25 has connected to Gateway: [\"gateway-prd-main-ftqk\",{\"micros\":2460180,\"calls\":[\"discord-sessions-prd-2-70\",{\"micros\":2458583,\"calls\":[\"start_session\",{\"micros\":373347,\"calls\":[\"api-prd-main-9s61\",{\"micros\":368662,\"calls\":[\"get_user\",{\"micros\":4199},\"add_authorized_ip\",{\"micros\":1873},\"get_guilds\",{\"micros\":321653},\"coros_wait\",{\"micros\":1}]}]},\"guilds_connect\",{\"micros\":319,\"calls\":[]},\"presence_connect\",{\"micros\":2,\"calls\":[]}]}]}] (Session ID: 71f3a176f23bbb281df009276079bc86).\r\n2020-09-08 09:19:44,557:WARNING:discord.gateway: Shard ID 23 has stopped responding to the gateway. Closing and restarting.\r\n2020-09-08 09:19:46,723:WARNING:discord.state: GUILD_MEMBER_UPDATE referencing an unknown member ID: 535151998199136282. Discarding.\r\n2020-09-08 09:19:47,999:INFO:discord.gateway: Websocket closed with 4000, attempting a reconnect.\r\n2020-09-08 09:19:48,000:INFO:discord.gateway: Shard ID 27 has sent the IDENTIFY payload.\r\n2020-09-08 09:19:48,429:INFO:discord.shard: Got a request to RESUME the websocket at Shard ID 23.\r\n2020-09-08 09:19:49,931:WARNING:discord.gateway: Can't keep up, shard ID 27 websocket is 10.1s behind.\r\n2020-09-08 09:19:52,242:INFO:discord.gateway: Shard ID 27 has connected to Gateway: [\"gateway-prd-main-fk5n\",{\"micros\":2813932,\"calls\":[\"discord-sessions-prd-2-17\",{\"micros\":2809549,\"calls\":[\"start_session\",{\"micros\":282855,\"calls\":[\"api-prd-main-4mft\",{\"micros\":279794,\"calls\":[\"get_user\",{\"micros\":2090},\"add_authorized_ip\",{\"micros\":1841},\"get_guilds\",{\"micros\":254247},\"coros_wait\",{\"micros\":1}]}]},\"guilds_connect\",{\"micros\":227,\"calls\":[]},\"presence_connect\",{\"micros\":1,\"calls\":[]}]}]}] (Session ID: c681f4c09860e4d9ecac30c61d9524f8).\r\n2020-09-08 09:19:59,392:WARNING:discord.gateway: Shard ID 24 has stopped responding to the gateway. Closing and restarting.\r\n2020-09-08 09:20:01,288:WARNING:discord.state: GUILD_MEMBER_UPDATE referencing an unknown member ID: 165119165286318080. Discarding.\r\n2020-09-08 09:20:01,320:WARNING:discord.state: GUILD_MEMBER_UPDATE referencing an unknown member ID: 709618535789363202. Discarding.\r\n2020-09-08 09:20:01,508:WARNING:discord.state: GUILD_MEMBER_UPDATE referencing an unknown member ID: 665423770273579041. Discarding.\r\n2020-09-08 09:20:04,283:WARNING:discord.state: GUILD_MEMBER_UPDATE referencing an unknown member ID: 442417222317637642. Discarding.\r\n2020-09-08 09:20:09,452:INFO:discord.gateway: Shard ID 23 has sent the RESUME payload.\r\n2020-09-08 09:20:12,752:INFO:discord.client: Cleaning up tasks.\r\n2020-09-08 09:20:12,752:INFO:discord.client: Cleaning up after 6 tasks.\r\n2020-09-08 09:20:12,773:INFO:discord.client: All tasks finished cancelling.\r\n2020-09-08 09:20:12,773:INFO:discord.client: Closing the event loop.\r\n```\r\n\r\n### Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x ] I have searched the open issues for duplicates.\r\n- [x ] I have shown the entire traceback, if possible.\r\n- [x ] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n\r\n<!-- Run `python -m discord -v` and paste this information below. -->\r\n- Python v3.6.9-final\r\n- discord.py v1.4.1-final\r\n- aiohttp v3.6.2\r\n- system info: Linux 4.15.0-51-generic #55-Ubuntu SMP Wed May 15 14:27:21 UTC 2019\r\n<!-- This command is available in v1.1.0 or higher. If you are unable to run this command, paste basic info (ie. Python version, library version, and your operating system -->\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5800/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5800/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5772", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5772/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5772/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5772/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5772", "id": 688607128, "node_id": "MDU6SXNzdWU2ODg2MDcxMjg=", "number": 5772, "title": "channel.permissions_synced is always False if any category overwrites are set", "user": {"login": "object-Object", "id": 37044997, "node_id": "MDQ6VXNlcjM3MDQ0OTk3", "avatar_url": "https://avatars.githubusercontent.com/u/37044997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/object-Object", "html_url": "https://github.com/object-Object", "followers_url": "https://api.github.com/users/object-Object/followers", "following_url": "https://api.github.com/users/object-Object/following{/other_user}", "gists_url": "https://api.github.com/users/object-Object/gists{/gist_id}", "starred_url": "https://api.github.com/users/object-Object/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/object-Object/subscriptions", "organizations_url": "https://api.github.com/users/object-Object/orgs", "repos_url": "https://api.github.com/users/object-Object/repos", "events_url": "https://api.github.com/users/object-Object/events{/privacy}", "received_events_url": "https://api.github.com/users/object-Object/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/11", "html_url": "https://github.com/Rapptz/discord.py/milestone/11", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/11/labels", "id": 5810051, "node_id": "MDk6TWlsZXN0b25lNTgxMDA1MQ==", "number": 11, "title": "1.5", "description": "The last major version in the 1.x series (probably).", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 18, "state": "closed", "created_at": "2020-08-26T02:50:17Z", "updated_at": "2020-09-29T01:07:35Z", "due_on": "2020-09-28T07:00:00Z", "closed_at": "2020-09-29T01:07:35Z"}, "comments": 0, "created_at": "2020-08-29T21:30:01Z", "updated_at": "2020-09-09T23:49:06Z", "closed_at": "2020-09-09T23:49:06Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\n`channel.permissions_synced` is always `False` if any permission overwrites are set in the channel's category, even if the channel's permissions are synced.\r\n\r\n### Reproduction Steps\r\n\r\n1. In Discord, create a new category and create a text channel within it.\r\n2. Check the value of `channel.permissions_synced` for the text channel. (`True`)\r\n3. In Discord, set any permission overwrite for the category and make sure the text channel's permissions are still synced.\r\n4. Again, check the value of `channel.permissions_synced` for the text channel.\r\n\r\n### Expected Results\r\n\r\nIn step 4, `channel.permissions_synced` should be `True`, because the permissions are still synced.\r\n\r\n### Actual Results\r\n\r\n`channel.permissions_synced` is `False`.\r\n\r\n### Checklist\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n\r\n```\r\n- Python v3.7.3-final\r\n- discord.py v1.4.1-final\r\n- aiohttp v3.6.2\r\n- system info: Linux 4.19.0-8-amd64 #1 SMP Debian 4.19.98-1 (2020-01-26)\r\n```", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5772/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5772/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5762", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5762/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5762/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5762/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5762", "id": 687678222, "node_id": "MDU6SXNzdWU2ODc2NzgyMjI=", "number": 5762, "title": "discord.ext.tasks adds time to the next iteration on retry", "user": {"login": "PythonCoderAS", "id": 13932583, "node_id": "MDQ6VXNlcjEzOTMyNTgz", "avatar_url": "https://avatars.githubusercontent.com/u/13932583?v=4", "gravatar_id": "", "url": "https://api.github.com/users/PythonCoderAS", "html_url": "https://github.com/PythonCoderAS", "followers_url": "https://api.github.com/users/PythonCoderAS/followers", "following_url": "https://api.github.com/users/PythonCoderAS/following{/other_user}", "gists_url": "https://api.github.com/users/PythonCoderAS/gists{/gist_id}", "starred_url": "https://api.github.com/users/PythonCoderAS/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/PythonCoderAS/subscriptions", "organizations_url": "https://api.github.com/users/PythonCoderAS/orgs", "repos_url": "https://api.github.com/users/PythonCoderAS/repos", "events_url": "https://api.github.com/users/PythonCoderAS/events{/privacy}", "received_events_url": "https://api.github.com/users/PythonCoderAS/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/11", "html_url": "https://github.com/Rapptz/discord.py/milestone/11", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/11/labels", "id": 5810051, "node_id": "MDk6TWlsZXN0b25lNTgxMDA1MQ==", "number": 11, "title": "1.5", "description": "The last major version in the 1.x series (probably).", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 18, "state": "closed", "created_at": "2020-08-26T02:50:17Z", "updated_at": "2020-09-29T01:07:35Z", "due_on": "2020-09-28T07:00:00Z", "closed_at": "2020-09-29T01:07:35Z"}, "comments": 0, "created_at": "2020-08-28T03:13:07Z", "updated_at": "2020-08-29T03:12:18Z", "closed_at": "2020-08-29T03:12:07Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\r\n\r\n<!-- A summary of your bug report -->\r\n\r\nWhen the Task hits an exception that it can reconnect on, it will add the loop time to the next iteration counter. This is obviously not right, because it should be the loop time from the latest retry.\r\n\r\n### Reproduction Steps\r\n\r\n<!-- What you did to make it happen. Ideally there should be a short code snippet in this section to help reproduce the bug. -->\r\n\r\n```python\r\nimport asyncio\r\nimport datetime\r\n\r\nimport discord.ext.tasks\r\n\r\n\r\n@discord.ext.tasks.loop(hours=1)\r\nasync def do_something():\r\n    # await asyncio.sleep(1)\r\n    print(str(do_something.next_iteration))\r\n    if (do_something.next_iteration.replace(tzinfo=None) - datetime.datetime.utcnow()) > datetime.timedelta(hours=4):\r\n        do_something.stop()\r\n        return\r\n    raise ValueError(\"Force Loop Reconnect\")\r\n\r\n\r\ndo_something.add_exception_type(ValueError)\r\n\r\n\r\nasync def start():\r\n    await do_something.start()\r\n\r\n\r\nloop = asyncio.get_event_loop()\r\nloop.run_until_complete(start())\r\n```\r\n\r\n### Expected Results\r\n\r\n<!-- What you expected to happen -->\r\n\r\nThe output to be: \r\n\r\n```\r\n2020-08-28 04:11:12.031077+00:00\r\n2020-08-28 04:11:13.031077+00:00\r\n2020-08-28 04:11:14.031077+00:00\r\n2020-08-28 04:11:15.031077+00:00\r\n2020-08-28 04:11:16.031077+00:00\r\n\r\nProcess finished with exit code 0\r\n```\r\n\r\n### Actual Results\r\n\r\n<!-- What actually happened. If there is a traceback, please show the entire thing. -->\r\n\r\n```\r\n2020-08-28 04:11:12.031077+00:00\r\n2020-08-28 05:11:12.031077+00:00\r\n2020-08-28 06:11:12.031077+00:00\r\n2020-08-28 07:11:12.031077+00:00\r\n2020-08-28 08:11:12.031077+00:00\r\n\r\nProcess finished with exit code 0\r\n```\r\n\r\n\r\n### Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n\r\n<!-- Run `python -m discord -v` and paste this information below. -->\r\n<!-- This command is available in v1.1.0 or higher. If you are unable to run this command, paste basic info (ie. Python version, library version, and your operating system -->\r\n\r\n```\r\n- Python v3.8.5-final\r\n- discord.py v1.4.1-final\r\n- aiohttp v3.6.2\r\n- system info: Darwin 19.6.0 Darwin Kernel Version 19.6.0: Thu Jun 18 20:49:00 PDT 2020; root:xnu-6153.141.1~1/RELEASE_X86_64\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5762/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5762/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5756", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5756/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5756/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5756/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5756", "id": 685853788, "node_id": "MDU6SXNzdWU2ODU4NTM3ODg=", "number": 5756, "title": "Channel overwrites are not changed if the overwrite dictionary is empty", "user": {"login": "parafoxia", "id": 43846948, "node_id": "MDQ6VXNlcjQzODQ2OTQ4", "avatar_url": "https://avatars.githubusercontent.com/u/43846948?v=4", "gravatar_id": "", "url": "https://api.github.com/users/parafoxia", "html_url": "https://github.com/parafoxia", "followers_url": "https://api.github.com/users/parafoxia/followers", "following_url": "https://api.github.com/users/parafoxia/following{/other_user}", "gists_url": "https://api.github.com/users/parafoxia/gists{/gist_id}", "starred_url": "https://api.github.com/users/parafoxia/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/parafoxia/subscriptions", "organizations_url": "https://api.github.com/users/parafoxia/orgs", "repos_url": "https://api.github.com/users/parafoxia/repos", "events_url": "https://api.github.com/users/parafoxia/events{/privacy}", "received_events_url": "https://api.github.com/users/parafoxia/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/11", "html_url": "https://github.com/Rapptz/discord.py/milestone/11", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/11/labels", "id": 5810051, "node_id": "MDk6TWlsZXN0b25lNTgxMDA1MQ==", "number": 11, "title": "1.5", "description": "The last major version in the 1.x series (probably).", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 18, "state": "closed", "created_at": "2020-08-26T02:50:17Z", "updated_at": "2020-09-29T01:07:35Z", "due_on": "2020-09-28T07:00:00Z", "closed_at": "2020-09-29T01:07:35Z"}, "comments": 0, "created_at": "2020-08-25T21:57:48Z", "updated_at": "2020-11-10T01:02:04Z", "closed_at": "2020-08-26T02:45:33Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\r\n\r\nChannel overwrites are not updated if the passed dictionary is empty.\r\n\r\n### Reproduction Steps\r\n\r\n1. Take a channel with no permissions, and add a permissions override for a specific member.\r\n2. Create a command to remove that permission overwrite, like so:\r\n```py\r\nasync def remove_overwrite(self, ctx, channel: discord.TextChannel, member: discord.Member):\r\n    overwrites = channel.overwrites.copy()\r\n    overwrites.pop(member) # overwrites would now be {}\r\n    await channel.edit(overwrites=overwrites)\r\n```\r\n3. Run the command.\r\n\r\n### Expected Results\r\n\r\nThe member overwrite is removed.\r\n\r\n### Actual Results\r\n\r\nNothing changes.\r\n\r\n### Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n\r\n- Python v3.8.5-final\r\n- discord.py v1.4.1-final\r\n- aiohttp v3.6.2\r\n- system info: Windows 10 10.0.19041\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5756/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5756/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5221", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5221/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5221/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5221/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5221", "id": 676781331, "node_id": "MDU6SXNzdWU2NzY3ODEzMzE=", "number": 5221, "title": "KeyError: 'retry_after' when hitting excessive ratelimits for webhooks.", "user": {"login": "mathsman5133", "id": 38833292, "node_id": "MDQ6VXNlcjM4ODMzMjky", "avatar_url": "https://avatars.githubusercontent.com/u/38833292?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mathsman5133", "html_url": "https://github.com/mathsman5133", "followers_url": "https://api.github.com/users/mathsman5133/followers", "following_url": "https://api.github.com/users/mathsman5133/following{/other_user}", "gists_url": "https://api.github.com/users/mathsman5133/gists{/gist_id}", "starred_url": "https://api.github.com/users/mathsman5133/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mathsman5133/subscriptions", "organizations_url": "https://api.github.com/users/mathsman5133/orgs", "repos_url": "https://api.github.com/users/mathsman5133/repos", "events_url": "https://api.github.com/users/mathsman5133/events{/privacy}", "received_events_url": "https://api.github.com/users/mathsman5133/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/11", "html_url": "https://github.com/Rapptz/discord.py/milestone/11", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/11/labels", "id": 5810051, "node_id": "MDk6TWlsZXN0b25lNTgxMDA1MQ==", "number": 11, "title": "1.5", "description": "The last major version in the 1.x series (probably).", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 18, "state": "closed", "created_at": "2020-08-26T02:50:17Z", "updated_at": "2020-09-29T01:07:35Z", "due_on": "2020-09-28T07:00:00Z", "closed_at": "2020-09-29T01:07:35Z"}, "comments": 2, "created_at": "2020-08-11T10:57:09Z", "updated_at": "2020-09-10T20:44:12Z", "closed_at": "2020-09-10T01:25:43Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\r\n\r\nI've noticed sometimes when sending logs to discord via webhooks that hitting the ratelimits excessively (yes, bad design on my part and it's fixed, but nonetheless a valid bug report I feel) raises a KeyError when looking for the [time to retry after](https://github.com/Rapptz/discord.py/blob/master/discord/webhook.py#L218). I did a bit of digging and pulled up this as the response payload:\r\n\r\n```py\r\n{\r\ncode: 0, \r\nmessage: 'You are being blocked from accessing our API temporarily due to exceeding our rate limits frequently. Please read our docs at https://discord.com/developers/docs/topics/rate-limits to prevent this moving forward.'\r\n}\r\n```\r\n\r\nWould it be helpful to forward this error to the user?\r\n\r\n\r\n### Reproduction Steps\r\n\r\n```py\r\nimport discord\r\nimport asyncio\r\nimport aiohttp\r\n\r\nwebhook = discord.Webhook.from_url(\"webhook url\", adapter=discord.AsyncWebhookAdapter(session=aiohttp.ClientSession()))\r\n\r\nasync def suppress_exc():\r\n    try:\r\n        await webhook.send(\"test\")\r\n    except discord.HTTPException:\r\n        await suppress_exc()  # we just want to make more requests that hit the ratelimit\r\n\r\n\r\nasync def test():\r\n    tasks = []\r\n    for _ in range(60):\r\n        tasks.append(suppress_exc())\r\n\r\n    await asyncio.gather(*tasks)\r\n\r\nasyncio.get_event_loop().run_until_complete(test())\r\n```\r\n\r\n### Expected Results\r\n\r\nTell me I shouldn't try to abuse ratelimits\r\n\r\n### Actual Results\r\n\r\n```py\r\nTraceback (most recent call last):\r\n  File \"C:/Users/User/py/donationbot/webhook_bug.py\", line 21, in <module>\r\n    asyncio.get_event_loop().run_until_complete(test())\r\n  File \"C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python37-32\\lib\\asyncio\\base_events.py\", line 584, in run_until_complete\r\n    return future.result()\r\n  File \"C:/Users/User/py/donationbot/webhook_bug.py\", line 19, in test\r\n    await asyncio.gather(*tasks)\r\n  File \"C:/Users/User/py/donationbot/webhook_bug.py\", line 9, in suppress_exc\r\n    await webhook.send(\"test\")\r\n  File \"C:\\Users\\User\\.virtualenvs\\donationbot\\lib\\site-packages\\discord\\webhook.py\", line 236, in handle_execution_response\r\n    data = await response\r\n  File \"C:\\Users\\User\\.virtualenvs\\donationbot\\lib\\site-packages\\discord\\webhook.py\", line 218, in request\r\n    retry_after = response['retry_after'] / 1000.0\r\nKeyError: 'retry_after'\r\n```\r\n\r\n### Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n\r\n- Python v3.7.3-final\r\n- discord.py v1.4.1-final\r\n- aiohttp v3.6.2\r\n- system info: Windows 10 10.0.18362\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5221/reactions", "total_count": 3, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 3}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5221/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5210", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5210/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5210/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5210/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5210", "id": 674568248, "node_id": "MDU6SXNzdWU2NzQ1NjgyNDg=", "number": 5210, "title": "Embed.Empty functionality does not work as expected.", "user": {"login": "parafoxia", "id": 43846948, "node_id": "MDQ6VXNlcjQzODQ2OTQ4", "avatar_url": "https://avatars.githubusercontent.com/u/43846948?v=4", "gravatar_id": "", "url": "https://api.github.com/users/parafoxia", "html_url": "https://github.com/parafoxia", "followers_url": "https://api.github.com/users/parafoxia/followers", "following_url": "https://api.github.com/users/parafoxia/following{/other_user}", "gists_url": "https://api.github.com/users/parafoxia/gists{/gist_id}", "starred_url": "https://api.github.com/users/parafoxia/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/parafoxia/subscriptions", "organizations_url": "https://api.github.com/users/parafoxia/orgs", "repos_url": "https://api.github.com/users/parafoxia/repos", "events_url": "https://api.github.com/users/parafoxia/events{/privacy}", "received_events_url": "https://api.github.com/users/parafoxia/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-08-06T20:03:42Z", "updated_at": "2020-08-07T05:07:55Z", "closed_at": "2020-08-07T05:07:55Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\r\n\r\nAccording to the documentation for `set_thumbnail` and `set_image`:\r\n\r\n> Changed in version 1.4: Passing Empty removes the thumbnail.\r\n\r\nThis does not function as expected. `set_author` and `set_footer` do not share the same problem.\r\n\r\n### Reproduction Steps\r\n\r\n```\r\nembed = discord.Embed(...)\r\nembed.set_thumbnail(url=Embed.Empty)\r\nembed.set_image(url=Embed.Empty)\r\n```\r\n\r\n### Expected Results\r\n\r\nThe thumbnail and image both appear unset.\r\n\r\n### Actual Results\r\n\r\n```\r\n_ClientEventTask exception was never retrieved\r\nfuture: <ClientEventTask state=finished event=on_command_error coro=<bound method Bot.on_command_error of <s4.bot.bot.Bot object at 0x000001E116E814F0>> exception=AttributeError('_thumbnail')>\r\nTraceback (most recent call last):\r\n  File \"D:\\Programs\\Python\\Discord Bots\\Bots\\S4\\.venv\\lib\\site-packages\\discord\\client.py\", line 317, in _run_event\r\n    await self.on_error(event_name, *args, **kwargs)\r\n  File \"D:\\Programs\\Python\\Discord Bots\\Bots\\S4\\s4\\bot\\bot.py\", line 103, in on_error\r\n    await error.error(err, *args, **kwargs)\r\n  File \"D:\\Programs\\Python\\Discord Bots\\Bots\\S4\\.venv\\lib\\site-packages\\discord\\client.py\", line 312, in _run_event\r\n    await coro(*args, **kwargs)\r\n  File \"D:\\Programs\\Python\\Discord Bots\\Bots\\S4\\s4\\bot\\bot.py\", line 107, in on_command_error\r\n    await error.command_error(ctx, exc)\r\n  File \"D:\\Programs\\Python\\Discord Bots\\Bots\\S4\\s4\\bot\\cogs\\error.py\", line 124, in command_error\r\n    raise original\r\n  File \"D:\\Programs\\Python\\Discord Bots\\Bots\\S4\\.venv\\lib\\site-packages\\discord\\ext\\commands\\core.py\", line 85, in wrapped\r\n    ret = await coro(*args, **kwargs)\r\n  File \"D:\\Programs\\Python\\Discord Bots\\Bots\\S4\\s4\\bot\\cogs\\meta.py\", line 160, in botinfo_command\r\n    embed=self.bot.embed.build(\r\n  File \"D:\\Programs\\Python\\Discord Bots\\Bots\\S4\\s4\\utils\\embed.py\", line 35, in build\r\n    embed.set_thumbnail(url=Embed.Empty)\r\n  File \"D:\\Programs\\Python\\Discord Bots\\Bots\\S4\\.venv\\lib\\site-packages\\discord\\embeds.py\", line 328, in set_thumbnail\r\n    del self._thumbnail\r\nAttributeError: _thumbnail\r\n```\r\n\r\n### Checklist\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n\r\n- Python v3.8.5-final\r\n- discord.py v1.4.0-final\r\n- aiohttp v3.6.2\r\n- system info: Windows 10 10.0.19041\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5210/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5210/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5207", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5207/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5207/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5207/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5207", "id": 674263485, "node_id": "MDU6SXNzdWU2NzQyNjM0ODU=", "number": 5207, "title": "Can't close discord connection", "user": {"login": "NicolasAlmerge", "id": 44474247, "node_id": "MDQ6VXNlcjQ0NDc0MjQ3", "avatar_url": "https://avatars.githubusercontent.com/u/44474247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/NicolasAlmerge", "html_url": "https://github.com/NicolasAlmerge", "followers_url": "https://api.github.com/users/NicolasAlmerge/followers", "following_url": "https://api.github.com/users/NicolasAlmerge/following{/other_user}", "gists_url": "https://api.github.com/users/NicolasAlmerge/gists{/gist_id}", "starred_url": "https://api.github.com/users/NicolasAlmerge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/NicolasAlmerge/subscriptions", "organizations_url": "https://api.github.com/users/NicolasAlmerge/orgs", "repos_url": "https://api.github.com/users/NicolasAlmerge/repos", "events_url": "https://api.github.com/users/NicolasAlmerge/events{/privacy}", "received_events_url": "https://api.github.com/users/NicolasAlmerge/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-08-06T12:09:12Z", "updated_at": "2020-08-06T20:43:37Z", "closed_at": "2020-08-06T13:56:54Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\r\n\r\nThank you everyone for releasing `discord.py` version 1.4 (final), you are amazing. However, with this new version, I am enable to close the discord connection with my bot. Here is a minimal reproducible example:\r\n\r\nFile: **main.py**\r\n```python\r\nimport discord, asyncio\r\nfrom discord.ext import commands\r\n\r\nbot = commands.Bot(\"!\")\r\n\r\nif __name__ == \"__main__\":\r\n    bot.load_extension(\"cogs.owner\")\r\n    bot.run(TOKEN)\r\n```\r\n\r\nFile: **cogs/owner.py**\r\n```python\r\nimport discord, asyncio\r\nfrom discord.ext import commands\r\n\r\nclass Owner(commands.Cog):\r\n    def __init__(self, bot):\r\n        self.bot = bot\r\n\r\n    @commands.command()\r\n    @commands.is_owner()\r\n    async def shutdown(self, ctx):\r\n        await self.bot.close()\r\n\r\ndef setup(bot):\r\n    bot.add_cog(Owner(bot))\r\n```\r\n\r\nNow when I run the `shutdown` command, the whole program just freezes (it doesn't terminate) and the fans on my computer start to spin faster. The bot still appears online but is not responding. This is weird, as everything worked alright before the update.\r\n\r\n### Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5207/reactions", "total_count": 4, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 4}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5207/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5198", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5198/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5198/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5198/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5198", "id": 673483278, "node_id": "MDU6SXNzdWU2NzM0ODMyNzg=", "number": 5198, "title": "[Commands] Context.subcommand_passed is not filled correct in subgroups", "user": {"login": "alkatar21", "id": 61387986, "node_id": "MDQ6VXNlcjYxMzg3OTg2", "avatar_url": "https://avatars.githubusercontent.com/u/61387986?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alkatar21", "html_url": "https://github.com/alkatar21", "followers_url": "https://api.github.com/users/alkatar21/followers", "following_url": "https://api.github.com/users/alkatar21/following{/other_user}", "gists_url": "https://api.github.com/users/alkatar21/gists{/gist_id}", "starred_url": "https://api.github.com/users/alkatar21/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alkatar21/subscriptions", "organizations_url": "https://api.github.com/users/alkatar21/orgs", "repos_url": "https://api.github.com/users/alkatar21/repos", "events_url": "https://api.github.com/users/alkatar21/events{/privacy}", "received_events_url": "https://api.github.com/users/alkatar21/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/10", "html_url": "https://github.com/Rapptz/discord.py/milestone/10", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/10/labels", "id": 5273240, "node_id": "MDk6TWlsZXN0b25lNTI3MzI0MA==", "number": 10, "title": "1.4", "description": "", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 59, "state": "closed", "created_at": "2020-04-04T06:24:09Z", "updated_at": "2020-08-06T04:03:45Z", "due_on": null, "closed_at": "2020-08-06T04:03:45Z"}, "comments": 0, "created_at": "2020-08-05T11:57:59Z", "updated_at": "2020-08-05T12:37:46Z", "closed_at": "2020-08-05T12:37:46Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\r\n\r\nIf I use a `@group` in a `@group` the parameter `subcommand_passed` is not filled correctly if no command is given.\r\n\r\n### Reproduction Steps\r\nRun the following Code:\r\n```py\r\nfrom discord.ext.commands import Cog, Bot, Context\r\nfrom discord.ext import commands\r\n\r\nclass Reproduction(Cog):\r\n    @commands.group()\r\n    async def show(self, ctx: Context):\r\n        print(f\"show: {ctx.subcommand_passed}\")\r\n        return\r\n\r\n    @show.group()\r\n    async def this(self, ctx: Context):\r\n        print(f\"this: {ctx.subcommand_passed}\")\r\n        return\r\n\r\n    @this.command()\r\n    async def problem(self, ctx: Context):\r\n        return\r\n\r\nif __name__ == '__main__':\r\n    b = Bot('!')\r\n    b.add_cog(Reproduction())\r\n    b.run(<Token>)\r\n```\r\n\r\n### Expected Results\r\n\r\nUser: !show\r\n`show: None`\r\nUser: !show this\r\n```\r\nshow: this\r\nthis: None\r\n```\r\nUser: !show this problem\r\n```\r\nshow: this\r\nthis: problem\r\n```\r\nUser: !show this dummy\r\n```\r\nshow: this\r\nthis: dummy\r\n```\r\n\r\n\r\n### Actual Results\r\n\r\nUser: !show\r\n`show: None`\r\nUser: !show this\r\n```\r\nshow: this\r\nthis: this   <- expect None\r\n```\r\nUser: !show this problem\r\n```\r\nshow: this\r\nthis: problem\r\n```\r\nUser: !show this dummy\r\n```\r\nshow: this\r\nthis: dummy\r\n```\r\n\r\n### Checklist\r\n- [x] I have searched the open issues for duplicates. (Not checked for Version 1.4)\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n\r\n### System Information\r\nPython==3.8.3 and discord.py==1.3.4\r\n\r\n<!-- Run `python -m discord -v` and paste this information below. -->\r\n<!-- This command is available in v1.1.0 or higher. If you are unable to run this command, paste basic info (ie. Python version, library version, and your operating system -->\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5198/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5198/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5191", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5191/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5191/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5191/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5191", "id": 673244306, "node_id": "MDU6SXNzdWU2NzMyNDQzMDY=", "number": 5191, "title": "socket.gaierror: [Errno 11001] getaddrinfo failed", "user": {"login": "ashitamo", "id": 52968572, "node_id": "MDQ6VXNlcjUyOTY4NTcy", "avatar_url": "https://avatars.githubusercontent.com/u/52968572?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ashitamo", "html_url": "https://github.com/ashitamo", "followers_url": "https://api.github.com/users/ashitamo/followers", "following_url": "https://api.github.com/users/ashitamo/following{/other_user}", "gists_url": "https://api.github.com/users/ashitamo/gists{/gist_id}", "starred_url": "https://api.github.com/users/ashitamo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ashitamo/subscriptions", "organizations_url": "https://api.github.com/users/ashitamo/orgs", "repos_url": "https://api.github.com/users/ashitamo/repos", "events_url": "https://api.github.com/users/ashitamo/events{/privacy}", "received_events_url": "https://api.github.com/users/ashitamo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/10", "html_url": "https://github.com/Rapptz/discord.py/milestone/10", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/10/labels", "id": 5273240, "node_id": "MDk6TWlsZXN0b25lNTI3MzI0MA==", "number": 10, "title": "1.4", "description": "", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 59, "state": "closed", "created_at": "2020-04-04T06:24:09Z", "updated_at": "2020-08-06T04:03:45Z", "due_on": null, "closed_at": "2020-08-06T04:03:45Z"}, "comments": 1, "created_at": "2020-08-05T04:29:55Z", "updated_at": "2020-08-05T08:34:27Z", "closed_at": "2020-08-05T08:34:27Z", "author_association": "NONE", "active_lock_reason": null, "body": "### socket.gaierror: [Errno 11001] \r\ni got this error:\r\n\r\n    Task exception was never retrieved\r\n    future: <Task finished coro=<VoiceClient._create_socket() done, defined at D:\\Python\\lib\\site- \r\n    packages\\discord\\voice_client.py:172> exception=gaierror(11001, 'getaddrinfo failed')>\r\n    Traceback (most recent call last):\r\n      File \"D:\\Python\\lib\\site-packages\\discord\\voice_client.py\", line 192, in _create_socket\r\n        self.endpoint_ip = socket.gethostbyname(self.endpoint)\r\n    socket.gaierror: [Errno 11001] getaddrinfo failed\r\n\r\ni find it in './discord/voice_client.py'\r\n\r\n    self.endpoint = endpoint.replace(':80', '')\r\n    self.endpoint_ip = socket.gethostbyname(self.endpoint)\r\n\r\nchange\r\n\r\n    self.endpoint = endpoint.replace(':80', '').replace(':443','')\r\n    self.endpoint_ip = socket.gethostbyname(self.endpoint)\r\n\r\nit's working", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5191/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5191/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5181", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5181/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5181/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5181/events", "html_url": "https://github.com/Rapptz/discord.py/pull/5181", "id": 671381387, "node_id": "MDExOlB1bGxSZXF1ZXN0NDYxNTk2MTUy", "number": 5181, "title": "Check if self.guild is object as well as not None", "user": {"login": "tnoff", "id": 1326564, "node_id": "MDQ6VXNlcjEzMjY1NjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1326564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tnoff", "html_url": "https://github.com/tnoff", "followers_url": "https://api.github.com/users/tnoff/followers", "following_url": "https://api.github.com/users/tnoff/following{/other_user}", "gists_url": "https://api.github.com/users/tnoff/gists{/gist_id}", "starred_url": "https://api.github.com/users/tnoff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tnoff/subscriptions", "organizations_url": "https://api.github.com/users/tnoff/orgs", "repos_url": "https://api.github.com/users/tnoff/repos", "events_url": "https://api.github.com/users/tnoff/events{/privacy}", "received_events_url": "https://api.github.com/users/tnoff/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/10", "html_url": "https://github.com/Rapptz/discord.py/milestone/10", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/10/labels", "id": 5273240, "node_id": "MDk6TWlsZXN0b25lNTI3MzI0MA==", "number": 10, "title": "1.4", "description": "", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 59, "state": "closed", "created_at": "2020-04-04T06:24:09Z", "updated_at": "2020-08-06T04:03:45Z", "due_on": null, "closed_at": "2020-08-06T04:03:45Z"}, "comments": 4, "created_at": "2020-08-02T01:39:13Z", "updated_at": "2020-08-02T02:01:15Z", "closed_at": "2020-08-02T02:00:38Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/Rapptz/discord.py/pulls/5181", "html_url": "https://github.com/Rapptz/discord.py/pull/5181", "diff_url": "https://github.com/Rapptz/discord.py/pull/5181.diff", "patch_url": "https://github.com/Rapptz/discord.py/pull/5181.patch", "merged_at": "2020-08-02T02:00:38Z"}, "body": "### Summary\r\n\r\nCatch AttributeError exception on user reactions iterator\r\n\r\nIt seems that sometimes the guild is a simple object file, and doesnt have get_member\r\n\r\nFile \"/home/user/.envs/discord/lib/python3.6/site-packages/discord/iterators.py\", line 166, in fill_users\r\n    member = self.guild.get_member(member_id)\r\nAttributeError: 'Object' object has no attribute 'get_member'\r\n\r\nAdd generic try/except to catch this case, and set member to zero.\r\n\r\nTested in my app and fixes issue\r\n\r\n### Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [X ] If code changes were made then they have been tested.\r\n    - [ ] I have updated the documentation to reflect the changes.\r\n- [X] This PR fixes an issue.\r\n- [ ] This PR adds something new (e.g. new method or parameters).\r\n- [ ] This PR is a breaking change (e.g. methods or parameters removed/renamed)\r\n- [ ] This PR is **not** a code change (e.g. documentation, README, ...)\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5181/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5181/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5180", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5180/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5180/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5180/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5180", "id": 671075328, "node_id": "MDU6SXNzdWU2NzEwNzUzMjg=", "number": 5180, "title": "AutoShardedClient.run() does not return after AutoShardedClient.close() is called", "user": {"login": "NotMaxee", "id": 45785407, "node_id": "MDQ6VXNlcjQ1Nzg1NDA3", "avatar_url": "https://avatars.githubusercontent.com/u/45785407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/NotMaxee", "html_url": "https://github.com/NotMaxee", "followers_url": "https://api.github.com/users/NotMaxee/followers", "following_url": "https://api.github.com/users/NotMaxee/following{/other_user}", "gists_url": "https://api.github.com/users/NotMaxee/gists{/gist_id}", "starred_url": "https://api.github.com/users/NotMaxee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/NotMaxee/subscriptions", "organizations_url": "https://api.github.com/users/NotMaxee/orgs", "repos_url": "https://api.github.com/users/NotMaxee/repos", "events_url": "https://api.github.com/users/NotMaxee/events{/privacy}", "received_events_url": "https://api.github.com/users/NotMaxee/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-08-01T18:09:03Z", "updated_at": "2020-08-01T23:49:36Z", "closed_at": "2020-08-01T23:49:07Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nWhen using `AutoShardedClient` (and by inheritance `AutoShardedBot`) manually closing the client using `AutoShardedClient.close()` closes the connection to Discord, but never actually causes ``AutoShardedClient.run()`` to return, preventing the program from terminating.\r\n\r\nThis is caused by an issue in `shard.py` inside `AutoShardedClient.connect()` ([shard.py, line 401](https://github.com/Rapptz/discord.py/blob/master/discord/shard.py#L401)) where the while-loop never actually terminates due to no more events being added to the internal queue, causing it to forever wait on the next item.\r\n\r\nWhen `AutoShardedClient.close()` is called, and all shards are closed, no further events are added to `AutoShardedClient.__queue`, causing the loop to wait indefinitely for the next item from the queue.\r\n\r\nA possible solution that I have found, although I don't know how good it is, is to add the following code to the end of the current `AutoShardedClient.close()` method, after the call to `await self.http.close()`:\r\n\r\n```\r\nself.__queue.put(EventItem(None, None, None))\r\n```\r\n\r\nThe event item is received from the queue, its type does not match any of `EventType` and thus directly leads into the next iteration of the loop, where the check in `while not self.is_closed()` causes the loop to exit, and `AutoShardedBot.connect()` to return.\r\n\r\n### Reproduction Steps\r\n\r\nThe following code is enough to reproduce the bug:\r\n\r\n```\r\nimport discord\r\n\r\ntoken = \"YOUR TOKEN GOES HERE\"\r\nclient = discord.AutoShardedClient()\r\n\r\n@client.event\r\nasync def on_ready():\r\n    print(\"calling client.close()\")\r\n    await client.close()\r\n    print(\"client.close() was called\")\r\n\r\nprint(\"calling client.run()\")\r\nclient.run(token)\r\nprint(\"this is never printed\")\r\n```\r\n\r\nThis prints the following, showcasing that the final `print()` after `client.run(token)` is never called.\r\n\r\n```\r\ncalling client.run()\r\ncalling client.close()\r\nclient.close() was called\r\n```\r\n\r\n### Expected Results\r\n\r\n`AutoShardedClient.run()` should return after a successful call to `AutoShardedClient.close()`.\r\n\r\n### Actual Results\r\n\r\n`AutoShardedClient.run()` blocks indefinitely, causing the program to never finish.\r\n\r\n### Checklist\r\n\r\n- [ x ] I have searched the open issues for duplicates.\r\n- [ x ] I have shown the entire traceback, if possible.\r\n- [ x ] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n\r\n- Python v3.8.3-final\r\n- discord.py v1.4.0-alpha\r\n    - discord.py pkg_resources: v1.4.0a2412+gb2065c9\r\n- aiohttp v3.6.2\r\n- system info: Windows 10 10.0.18362\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5180/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5180/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5154", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5154/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5154/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5154/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5154", "id": 664136260, "node_id": "MDU6SXNzdWU2NjQxMzYyNjA=", "number": 5154, "title": "Mention that a Help Command has to be added to a bot before adding it to the Cog", "user": {"login": "PythonCoderAS", "id": 13932583, "node_id": "MDQ6VXNlcjEzOTMyNTgz", "avatar_url": "https://avatars.githubusercontent.com/u/13932583?v=4", "gravatar_id": "", "url": "https://api.github.com/users/PythonCoderAS", "html_url": "https://github.com/PythonCoderAS", "followers_url": "https://api.github.com/users/PythonCoderAS/followers", "following_url": "https://api.github.com/users/PythonCoderAS/following{/other_user}", "gists_url": "https://api.github.com/users/PythonCoderAS/gists{/gist_id}", "starred_url": "https://api.github.com/users/PythonCoderAS/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/PythonCoderAS/subscriptions", "organizations_url": "https://api.github.com/users/PythonCoderAS/orgs", "repos_url": "https://api.github.com/users/PythonCoderAS/repos", "events_url": "https://api.github.com/users/PythonCoderAS/events{/privacy}", "received_events_url": "https://api.github.com/users/PythonCoderAS/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2020-07-23T00:59:30Z", "updated_at": "2021-03-28T22:53:15Z", "closed_at": "2021-03-28T22:53:15Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### The Problem\r\n\r\n<!--\r\nWhat problem is your feature trying to solve? What becomes easier or possible when this feature is implemented?\r\n-->\r\n\r\nIn my extension setup code, I tried to add my help command to my Help cog and then add it to the bot. However, it expects a private variable to be present. Upon further inspection, it seems that this private variable is filled when the help command is added to the bot.\r\n\r\n### The Ideal Solution\r\n\r\n<!--\r\nWhat is your ideal solution to the problem? What would you like this feature to do?\r\n-->\r\n\r\nThe ideal solution is to make a note in `HelpCommand.cog` that it needs to be added to the bot before adding a Cog.\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5154/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5154/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5143", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5143/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5143/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5143/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5143", "id": 663430260, "node_id": "MDU6SXNzdWU2NjM0MzAyNjA=", "number": 5143, "title": "JPEG file not identified properly when setting server banner", "user": {"login": "Jefffrey", "id": 22608443, "node_id": "MDQ6VXNlcjIyNjA4NDQz", "avatar_url": "https://avatars.githubusercontent.com/u/22608443?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jefffrey", "html_url": "https://github.com/Jefffrey", "followers_url": "https://api.github.com/users/Jefffrey/followers", "following_url": "https://api.github.com/users/Jefffrey/following{/other_user}", "gists_url": "https://api.github.com/users/Jefffrey/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jefffrey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jefffrey/subscriptions", "organizations_url": "https://api.github.com/users/Jefffrey/orgs", "repos_url": "https://api.github.com/users/Jefffrey/repos", "events_url": "https://api.github.com/users/Jefffrey/events{/privacy}", "received_events_url": "https://api.github.com/users/Jefffrey/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/10", "html_url": "https://github.com/Rapptz/discord.py/milestone/10", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/10/labels", "id": 5273240, "node_id": "MDk6TWlsZXN0b25lNTI3MzI0MA==", "number": 10, "title": "1.4", "description": "", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 59, "state": "closed", "created_at": "2020-04-04T06:24:09Z", "updated_at": "2020-08-06T04:03:45Z", "due_on": null, "closed_at": "2020-08-06T04:03:45Z"}, "comments": 1, "created_at": "2020-07-22T02:41:43Z", "updated_at": "2020-07-22T02:57:53Z", "closed_at": "2020-07-22T02:57:31Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\r\n\r\nIn the[ _get_mime_type_for_image function in utils.py](https://github.com/Rapptz/discord.py/blob/master/discord/utils.py#L302), it relies on JPEG files having JFIF or Exif in the header, else it won't recognize the file as JPEG. However there may be JPEG files without JFIF or Exif in the header, such as [this one](https://i.imgur.com/v7oSOEQ.jpg). Setting it manually via discord client as banner works fine.\r\n\r\n### Reproduction Steps\r\n\r\n```py\r\n\tasync def set_server_banner(self, guild, filepath):\r\n\t\tasync with aiofiles.open(filepath, \"rb\") as f:\r\n\t\t\tb = await f.read()\r\n\t\t\tawait guild.edit(banner=bytearray(b))\r\n```\r\n\r\nWhere filepath is pointing to a local copy of the above mentioned image.\r\n\r\n### Expected Results\r\n\r\nBe recognized as JPEG image, thus be able to set as server banner.\r\n\r\n### Actual Results\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/discord/ext/tasks/__init__.py\", line 73, in _loop\r\n    await self.coro(*args, **kwargs)\r\n  File \"/home/ubuntu/bot/cogs/cog.py\", line 556, in check\r\n    await self.set_server_banner(guild, config[\"banner_filepath\"])\r\n  File \"/home/ubuntu/bot/cogs/cog.py\", line 423, in set_server_banner\r\n    await guild.edit(banner=bytearray(b))\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/discord/guild.py\", line 1027, in edit\r\n    banner = utils._bytes_to_base64_data(banner_bytes)\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/discord/utils.py\", line 299, in _bytes_to_base64_data\r\n    mime = _get_mime_type_for_image(data)\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/discord/utils.py\", line 295, in _get_mime_type_for_image\r\n    raise InvalidArgument('Unsupported image type given')\r\ndiscord.errors.InvalidArgument: Unsupported image type given\r\n```\r\n\r\n### Checklist\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n- Python v3.7.7-final\r\n- discord.py v1.3.4-final\r\n- aiohttp v3.6.2\r\n- websockets v6.0\r\n- system info: Linux 4.4.0-1052-aws #61-Ubuntu SMP Mon Feb 12 23:05:58 UTC 2018", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5143/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5143/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5109", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5109/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5109/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5109/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5109", "id": 653699806, "node_id": "MDU6SXNzdWU2NTM2OTk4MDY=", "number": 5109, "title": "'Overwrites' got an unexpected keyword argument 'deny_new'/'allow_new'", "user": {"login": "XuaTheGrate", "id": 17090652, "node_id": "MDQ6VXNlcjE3MDkwNjUy", "avatar_url": "https://avatars.githubusercontent.com/u/17090652?v=4", "gravatar_id": "", "url": "https://api.github.com/users/XuaTheGrate", "html_url": "https://github.com/XuaTheGrate", "followers_url": "https://api.github.com/users/XuaTheGrate/followers", "following_url": "https://api.github.com/users/XuaTheGrate/following{/other_user}", "gists_url": "https://api.github.com/users/XuaTheGrate/gists{/gist_id}", "starred_url": "https://api.github.com/users/XuaTheGrate/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/XuaTheGrate/subscriptions", "organizations_url": "https://api.github.com/users/XuaTheGrate/orgs", "repos_url": "https://api.github.com/users/XuaTheGrate/repos", "events_url": "https://api.github.com/users/XuaTheGrate/events{/privacy}", "received_events_url": "https://api.github.com/users/XuaTheGrate/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/10", "html_url": "https://github.com/Rapptz/discord.py/milestone/10", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/10/labels", "id": 5273240, "node_id": "MDk6TWlsZXN0b25lNTI3MzI0MA==", "number": 10, "title": "1.4", "description": "", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 59, "state": "closed", "created_at": "2020-04-04T06:24:09Z", "updated_at": "2020-08-06T04:03:45Z", "due_on": null, "closed_at": "2020-08-06T04:03:45Z"}, "comments": 12, "created_at": "2020-07-09T01:45:13Z", "updated_at": "2020-07-22T07:48:55Z", "closed_at": "2020-07-09T03:21:18Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "### Summary\r\n\r\nDiscord pushed a new change that changes the overwrites object.\r\n\r\n~~However, after testing a bit, it seems to be completely random when it happens.~~ This seems to no longer hold true.\r\n\r\n### Reproduction Steps\r\n\r\n```py\r\nwhile True:\r\n  await bot.fetch_channel(any_text_channel.id)\r\n```\r\nThe `while True` is just to make sure the error appears, as it is random when it appears.\r\n\r\n### Expected Results\r\n\r\nFor an error to not occur while I'm executing this function.\r\n\r\n### Actual Results\r\n\r\n```py\r\nTraceback (most recent call last):\r\n  File \"/home/xua/abyss/venv/lib/python3.7/site-packages/discord/client.py\", line 1376, in fetch_channel\r\n    channel = factory(guild=guild, state=self._connection, data=data)\r\n  File \"/home/xua/abyss/venv/lib/python3.7/site-packages/discord/channel.py\", line 107, in __init__\r\n    self._update(guild, data)\r\n  File \"/home/xua/abyss/venv/lib/python3.7/site-packages/discord/channel.py\", line 131, in _update\r\n    self._fill_overwrites(data)\r\n  File \"/home/xua/abyss/venv/lib/python3.7/site-packages/discord/abc.py\", line 304, in _fill_overwrites\r\n    self._overwrites.append(_Overwrites(id=overridden_id, **overridden))\r\nTypeError: __new__() got an unexpected keyword argument 'allow_new'\r\n```\r\n\r\n\r\n### Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n\r\n- Python v3.7.8-final\r\n- discord.py v1.4.0-alpha\r\n    - discord.py pkg_resources: v1.4.0a2373+gc995a5e\r\n- aiohttp v3.6.2\r\n- system info: Linux 4.19.0-9-amd64 #1 SMP Debian 4.19.118-2 (2020-04-29)\r\n\r\nThis has also been reproduced on 1.3.3, and a new payload example can be found: \r\n```json\r\n        {\r\n            \"allow\": 0,\r\n            \"allow_new\": \"0\",\r\n            \"deny\": 3072,\r\n            \"deny_new\": \"3072\",\r\n            \"id\": \"448666839778590730\",\r\n            \"type\": \"role\"\r\n        }\r\n```", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5109/reactions", "total_count": 19, "+1": 19, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5109/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/4206", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4206/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4206/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4206/events", "html_url": "https://github.com/Rapptz/discord.py/issues/4206", "id": 640454886, "node_id": "MDU6SXNzdWU2NDA0NTQ4ODY=", "number": 4206, "title": "escape_markdown does not escape masked links", "user": {"login": "LostLuma", "id": 38926001, "node_id": "MDQ6VXNlcjM4OTI2MDAx", "avatar_url": "https://avatars.githubusercontent.com/u/38926001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/LostLuma", "html_url": "https://github.com/LostLuma", "followers_url": "https://api.github.com/users/LostLuma/followers", "following_url": "https://api.github.com/users/LostLuma/following{/other_user}", "gists_url": "https://api.github.com/users/LostLuma/gists{/gist_id}", "starred_url": "https://api.github.com/users/LostLuma/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/LostLuma/subscriptions", "organizations_url": "https://api.github.com/users/LostLuma/orgs", "repos_url": "https://api.github.com/users/LostLuma/repos", "events_url": "https://api.github.com/users/LostLuma/events{/privacy}", "received_events_url": "https://api.github.com/users/LostLuma/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/10", "html_url": "https://github.com/Rapptz/discord.py/milestone/10", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/10/labels", "id": 5273240, "node_id": "MDk6TWlsZXN0b25lNTI3MzI0MA==", "number": 10, "title": "1.4", "description": "", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 59, "state": "closed", "created_at": "2020-04-04T06:24:09Z", "updated_at": "2020-08-06T04:03:45Z", "due_on": null, "closed_at": "2020-08-06T04:03:45Z"}, "comments": 0, "created_at": "2020-06-17T13:43:54Z", "updated_at": "2020-06-22T08:00:51Z", "closed_at": "2020-06-22T08:00:50Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\r\n\r\nUsing escape_markdown to remove masked links from content before sending it with a webhook does not escape them as expected.\r\n\r\n### Reproduction Steps\r\n\r\nCall `utils.escape_markdown` on a piece of text with a masked link:\r\n\r\n```python3\r\n>>> import discord\r\n>>>\r\n>>> discord.utils.escape_markdown('[Hello World](https://example.com)')\r\n'[Hello World](https://example.com)'\r\n>>>\r\n```\r\n\r\n### Expected Results\r\n\r\nI expected the returned text to be `\\[Hello World\\](https://example.com)` or similar.\r\n\r\n### Actual Results\r\n\r\nThe text is unchanged, and will display a masked link in chat.\r\n\r\n### Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n\r\n- Python v3.8.1-final\r\n- discord.py v1.4.0-alpha\r\n    - discord.py pkg_resources: v1.4.0a2301+g98515ca\r\n- aiohttp v3.6.2\r\n- system info: Windows 10 10.0.19645\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/4206/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4206/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/4186", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4186/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4186/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4186/events", "html_url": "https://github.com/Rapptz/discord.py/issues/4186", "id": 634640640, "node_id": "MDU6SXNzdWU2MzQ2NDA2NDA=", "number": 4186, "title": "guild.by_category() not returning empty categories", "user": {"login": "eri", "id": 38740024, "node_id": "MDQ6VXNlcjM4NzQwMDI0", "avatar_url": "https://avatars.githubusercontent.com/u/38740024?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eri", "html_url": "https://github.com/eri", "followers_url": "https://api.github.com/users/eri/followers", "following_url": "https://api.github.com/users/eri/following{/other_user}", "gists_url": "https://api.github.com/users/eri/gists{/gist_id}", "starred_url": "https://api.github.com/users/eri/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eri/subscriptions", "organizations_url": "https://api.github.com/users/eri/orgs", "repos_url": "https://api.github.com/users/eri/repos", "events_url": "https://api.github.com/users/eri/events{/privacy}", "received_events_url": "https://api.github.com/users/eri/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/10", "html_url": "https://github.com/Rapptz/discord.py/milestone/10", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/10/labels", "id": 5273240, "node_id": "MDk6TWlsZXN0b25lNTI3MzI0MA==", "number": 10, "title": "1.4", "description": "", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 59, "state": "closed", "created_at": "2020-04-04T06:24:09Z", "updated_at": "2020-08-06T04:03:45Z", "due_on": null, "closed_at": "2020-08-06T04:03:45Z"}, "comments": 1, "created_at": "2020-06-08T13:56:21Z", "updated_at": "2020-06-27T08:12:52Z", "closed_at": "2020-06-27T08:12:51Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nI was looking for listing all of the channels (including all types) with categories (sorted correctly like in UI) and found that comment from Danny on [issue #2392](https://github.com/Rapptz/discord.py/issues/2392#issuecomment-545738318). I noticed that the result returned by that method ignores empty categories (categories with no channels in it) for some reasons.\r\n\r\n### Reproduction Steps\r\n\r\n- Create a guild with two categories\r\n- Create some test channels under one of the categories, leave the other empty \r\n- Use `ctx.guild.by_category()` and see results\r\n```py\r\n    @commands.command()\r\n    async def test(self, ctx):\r\n      await ctx.send(ctx.guild.by_category()) # Supposed to return both categories\r\n      await ctx.send(len(ctx.guild.by_category())) # Supposed to return 2\r\n```\r\n\r\n### Expected Results\r\n\r\nIt should return all categories, so 2 in total.\r\n\r\n### Actual Results\r\n\r\nIt ignores the empty category and only returns one.\r\n\r\n### Checklist\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n\r\n- Python v3.6.9-final\r\n- discord.py v1.3.3-final\r\n- aiohttp v3.6.2\r\n- websockets v8.1\r\n- system info: Linux 4.15.0-99-generic #100-Ubuntu SMP Wed Apr 22 20:32:56 UTC 2\r\n020\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/4186/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4186/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/4152", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4152/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4152/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4152/events", "html_url": "https://github.com/Rapptz/discord.py/issues/4152", "id": 627492099, "node_id": "MDU6SXNzdWU2Mjc0OTIwOTk=", "number": 4152, "title": "Activity custom emoji id is str", "user": {"login": "Fogapod", "id": 22667809, "node_id": "MDQ6VXNlcjIyNjY3ODA5", "avatar_url": "https://avatars.githubusercontent.com/u/22667809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Fogapod", "html_url": "https://github.com/Fogapod", "followers_url": "https://api.github.com/users/Fogapod/followers", "following_url": "https://api.github.com/users/Fogapod/following{/other_user}", "gists_url": "https://api.github.com/users/Fogapod/gists{/gist_id}", "starred_url": "https://api.github.com/users/Fogapod/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Fogapod/subscriptions", "organizations_url": "https://api.github.com/users/Fogapod/orgs", "repos_url": "https://api.github.com/users/Fogapod/repos", "events_url": "https://api.github.com/users/Fogapod/events{/privacy}", "received_events_url": "https://api.github.com/users/Fogapod/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/10", "html_url": "https://github.com/Rapptz/discord.py/milestone/10", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/10/labels", "id": 5273240, "node_id": "MDk6TWlsZXN0b25lNTI3MzI0MA==", "number": 10, "title": "1.4", "description": "", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 59, "state": "closed", "created_at": "2020-04-04T06:24:09Z", "updated_at": "2020-08-06T04:03:45Z", "due_on": null, "closed_at": "2020-08-06T04:03:45Z"}, "comments": 0, "created_at": "2020-05-29T19:29:26Z", "updated_at": "2020-05-30T03:26:08Z", "closed_at": "2020-05-30T03:26:08Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\r\n\r\n<!-- A summary of your bug report -->\r\nids of custom emojis in member activities are always strings instead of ints.\r\n\r\n`id` from `data` doesnt get converted to int here: https://github.com/Rapptz/discord.py/blob/cbdf660ddcee8b3d25d69b3504c2975900b6da91/discord/partial_emoji.py#L80\r\n`from_dict` method is called from 2 places with raw data from discord (ids are strings):\r\nhttps://github.com/Rapptz/discord.py/blob/cbdf660ddcee8b3d25d69b3504c2975900b6da91/discord/activity.py#L193\r\nhttps://github.com/Rapptz/discord.py/blob/cbdf660ddcee8b3d25d69b3504c2975900b6da91/discord/activity.py#L696\r\n\r\nEither id should be converted to int in both these places like here: https://github.com/Rapptz/discord.py/blob/cbdf660ddcee8b3d25d69b3504c2975900b6da91/discord/state.py#L479\r\n\r\nOr converted to `int` in `PartialEmoji.from_dict`.\r\n\r\n### Reproduction Steps\r\nRun this on server where someone has emoji in their status:\r\n```python\r\nfor m in guild.members:\r\n    if not m.activity:\r\n        continue\r\n    if not getattr(m.activity, 'emoji', None):\r\n        continue\r\n    if not m.activity.emoji.id:\r\n        continue\r\n\r\n    print(type(m.activity.emoji.id))\r\n    break\r\n\r\n# Outputs:\r\n# <class 'str'>\r\n```\r\n\r\n### Expected Results\r\n\r\n<!-- What you expected to happen -->\r\nid to be an int.\r\n\r\n### Actual Results\r\n\r\n<!-- What actually happened. If there is a traceback, please show the entire thing. -->\r\n\r\nid is a str.\r\n\r\n### Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [ ] I have shown the entire traceback, if possible.\r\n- [ ] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n\r\n<!-- Run `python -m discord -v` and paste this information below. -->\r\n<!-- This command is available in v1.1.0 or higher. If you are unable to run this command, paste basic info (ie. Python version, library version, and your operating system -->\r\n```\r\n- Python v3.7.7-final\r\n- discord.py v1.4.0-alpha\r\n    - discord.py pkg_resources: v1.4.0a2338+g1ee1b7f\r\n- aiohttp v3.6.2\r\n- websockets v8.1\r\n- system info: Linux 4.15.0-72-generic #81-Ubuntu SMP Tue Nov 26 12:20:02 UTC 2019\r\n```", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/4152/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4152/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/4114", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4114/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4114/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4114/events", "html_url": "https://github.com/Rapptz/discord.py/issues/4114", "id": 621620254, "node_id": "MDU6SXNzdWU2MjE2MjAyNTQ=", "number": 4114, "title": "Widget members can have channels that aren't in the JSON", "user": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/10", "html_url": "https://github.com/Rapptz/discord.py/milestone/10", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/10/labels", "id": 5273240, "node_id": "MDk6TWlsZXN0b25lNTI3MzI0MA==", "number": 10, "title": "1.4", "description": "", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 59, "state": "closed", "created_at": "2020-04-04T06:24:09Z", "updated_at": "2020-08-06T04:03:45Z", "due_on": null, "closed_at": "2020-08-06T04:03:45Z"}, "comments": 0, "created_at": "2020-05-20T09:45:15Z", "updated_at": "2020-05-30T03:26:07Z", "closed_at": "2020-05-30T03:26:07Z", "author_association": "OWNER", "active_lock_reason": null, "body": "### Summary\r\n\r\nThe code assumed that if a widget member has a channel_id key set then it should be in the channels provided. This assumption is no longer true.\r\n\r\nThe proper solution in this case can either be:\r\n\r\n1. Ignore it if the key isn't there\r\n2. Use `discord.Object` if the channel isn't found. This requires a change to the signature.\r\n3. Same as number 2 but fake a WidgetChannel to avoid the change to the signature.\r\n\r\n### Reproduction Steps\r\n\r\nFetch a widget with someone in a voice channel.\r\n\r\n### Expected Results\r\n\r\nNo error\r\n\r\n### Actual Results\r\n\r\n```py\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.8/dist-packages/discord/ext/commands/core.py\", line 83, in wrapped\r\n    ret = await coro(*args, **kwargs)\r\n  File \"/home/getbeaned-discordbot/cogs/support.py\", line 478, in doctor\r\n    widget = await guild.widget()\r\n  File \"/usr/local/lib/python3.8/dist-packages/discord/guild.py\", line 1827, in widget\r\n    return Widget(state=self._state, data=data)\r\n  File \"/usr/local/lib/python3.8/dist-packages/discord/widget.py\", line 208, in __init__\r\n    connected_channel = channels[connected_channel]\r\nKeyError: 71256824866275335\r\n```\r\n\r\n\r\n### Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n\r\n- Python v3.7.3-final\r\n- discord.py v1.4.0-alpha\r\n    - discord.py pkg_resources: v1.3.3\r\n- aiohttp v3.5.4\r\n- websockets v6.0\r\n- system info: Windows 8.1 6.3.9600\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/4114/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4114/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/4087", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4087/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4087/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4087/events", "html_url": "https://github.com/Rapptz/discord.py/issues/4087", "id": 615490854, "node_id": "MDU6SXNzdWU2MTU0OTA4NTQ=", "number": 4087, "title": "Member.top_role not updating when positions change", "user": {"login": "Silari", "id": 8951819, "node_id": "MDQ6VXNlcjg5NTE4MTk=", "avatar_url": "https://avatars.githubusercontent.com/u/8951819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Silari", "html_url": "https://github.com/Silari", "followers_url": "https://api.github.com/users/Silari/followers", "following_url": "https://api.github.com/users/Silari/following{/other_user}", "gists_url": "https://api.github.com/users/Silari/gists{/gist_id}", "starred_url": "https://api.github.com/users/Silari/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Silari/subscriptions", "organizations_url": "https://api.github.com/users/Silari/orgs", "repos_url": "https://api.github.com/users/Silari/repos", "events_url": "https://api.github.com/users/Silari/events{/privacy}", "received_events_url": "https://api.github.com/users/Silari/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/10", "html_url": "https://github.com/Rapptz/discord.py/milestone/10", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/10/labels", "id": 5273240, "node_id": "MDk6TWlsZXN0b25lNTI3MzI0MA==", "number": 10, "title": "1.4", "description": "", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 59, "state": "closed", "created_at": "2020-04-04T06:24:09Z", "updated_at": "2020-08-06T04:03:45Z", "due_on": null, "closed_at": "2020-08-06T04:03:45Z"}, "comments": 1, "created_at": "2020-05-10T22:31:27Z", "updated_at": "2020-06-05T03:38:12Z", "closed_at": "2020-06-05T03:38:12Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nIf a role position is changed, calling member.top_role does not update the top role if it has changed. It still shows whatever the old top position was.\r\n\r\nOnly similar issue still open is #2142 but that involved role creation and the cache, where these roles are being edited and the new position is set correctly. \r\n\r\n### Expected Results\r\n\r\nThe top_role property to always return the role with the highest position.\r\n\r\n### Actual Results\r\nThe old top role is still returned as the top role, despite it being moved to a lower position or another role being moved higher. The output of the following code in an on_message(message) event shows the issue.\r\n\r\n    msg = \"Roles:\"\r\n    for myrole in message.guild.me.roles:\r\n        msg += \" Name: \" + myrole.name + \" Position:\" + str(myrole.position)\r\n    print(msg)\r\n    msg = \"Top Role: \" + message.guild.me.top_role.name + \" \" str(message.guild.me.top_role.position)\r\n    print(msg)\r\n\r\n> Roles: Name: @everyone Position:0 Name: PicartoBot-Dev Position:2 Name: Trixie Position:5\r\n> Top Role: Trixie 5\r\n\r\nThe highest role is Trixie, as it should be. After moving the Trixie role to just above @everyone (Position 1) and rerunning:\r\n\r\n> Roles: Name: @everyone Position:0 Name: PicartoBot-Dev Position:3 Name: Trixie Position:1\r\n> Top Role: Trixie 1\r\n\r\nIt still lists Trixie as the highest role, despite having updated the role with it's new position.\r\n\r\nLooking at the code for Member.top_role, it seems like the list of roles should be sorted in ascending position order, but it's not being resorted when the role position is updated, thus causing top_role to return the wrong role.\r\n\r\n### Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n\r\n- Python v3.7.2-final\r\n- discord.py v1.3.3-final\r\n- aiohttp v3.6.2\r\n- websockets v6.0\r\n- system info: Windows 10 10.0.18362\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/4087/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4087/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/4058", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4058/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4058/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4058/events", "html_url": "https://github.com/Rapptz/discord.py/issues/4058", "id": 611840475, "node_id": "MDU6SXNzdWU2MTE4NDA0NzU=", "number": 4058, "title": "Regex characters not escaped in clean_prefix", "user": {"login": "s0hv", "id": 17063236, "node_id": "MDQ6VXNlcjE3MDYzMjM2", "avatar_url": "https://avatars.githubusercontent.com/u/17063236?v=4", "gravatar_id": "", "url": "https://api.github.com/users/s0hv", "html_url": "https://github.com/s0hv", "followers_url": "https://api.github.com/users/s0hv/followers", "following_url": "https://api.github.com/users/s0hv/following{/other_user}", "gists_url": "https://api.github.com/users/s0hv/gists{/gist_id}", "starred_url": "https://api.github.com/users/s0hv/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/s0hv/subscriptions", "organizations_url": "https://api.github.com/users/s0hv/orgs", "repos_url": "https://api.github.com/users/s0hv/repos", "events_url": "https://api.github.com/users/s0hv/events{/privacy}", "received_events_url": "https://api.github.com/users/s0hv/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/10", "html_url": "https://github.com/Rapptz/discord.py/milestone/10", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/10/labels", "id": 5273240, "node_id": "MDk6TWlsZXN0b25lNTI3MzI0MA==", "number": 10, "title": "1.4", "description": "", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 59, "state": "closed", "created_at": "2020-04-04T06:24:09Z", "updated_at": "2020-08-06T04:03:45Z", "due_on": null, "closed_at": "2020-08-06T04:03:45Z"}, "comments": 0, "created_at": "2020-05-04T12:33:15Z", "updated_at": "2020-05-07T06:32:49Z", "closed_at": "2020-05-07T06:32:49Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\n[clean_prefix](https://github.com/Rapptz/discord.py/blob/master/discord/ext/commands/help.py#L348) doesn't escape regex from the bots display name. This causes an error when the bot has for example a single \\ in its name. `re.escape(user.display_name)` Seemed to fix it\r\n\r\n### Reproduction Steps\r\n\r\nNickname your bot to `\\` and call the help command for a single command\r\n\r\n### Expected Results\r\n\r\nclean_prefix returning @\\ and the help command working normally\r\n\r\n### Actual Results\r\nThis error\r\n```\r\nTraceback (most recent call last):\r\n  File \"/home/s0hvaperuna/.local/lib/python3.6/site-packages/discord/ext/commands/core.py\", line 83, in wrapped\r\n    ret = await coro(*args, **kwargs)\r\n  File \"/home/s0hvaperuna/.local/lib/python3.6/site-packages/discord/ext/commands/help.py\", line 815, in command_callback\r\n    return await self.send_group_help(cmd)\r\n  File \"/home/s0hvaperuna/Python/Not-a-bot/bot/formatter.py\", line 210, in send_group_help\r\n    paginator = await self.create_command_page(ctx, group)\r\n  File \"/home/s0hvaperuna/Python/Not-a-bot/bot/formatter.py\", line 252, in create_command_page\r\n    signature = self.get_command_signature(command)\r\n  File \"/home/s0hvaperuna/.local/lib/python3.6/site-packages/discord/ext/commands/help.py\", line 395, in get_command_signature\r\n    return '%s%s %s' % (self.clean_prefix, alias, command.signature)\r\n  File \"/home/s0hvaperuna/.local/lib/python3.6/site-packages/discord/ext/commands/help.py\", line 348, in clean_prefix\r\n    return pattern.sub(\"@%s\" % user.display_name, self.context.prefix)\r\n  File \"/usr/lib/python3.6/re.py\", line 326, in _subx\r\n    template = _compile_repl(template, pattern)\r\n  File \"/usr/lib/python3.6/re.py\", line 317, in _compile_repl\r\n    return sre_parse.parse_template(repl, pattern)\r\n  File \"/usr/lib/python3.6/sre_parse.py\", line 895, in parse_template\r\n    this = sget()\r\n  File \"/usr/lib/python3.6/sre_parse.py\", line 255, in get\r\n    self.__next()\r\n  File \"/usr/lib/python3.6/sre_parse.py\", line 245, in __next\r\n    self.string, len(self.string) - 1) from None\r\nsre_constants.error: bad escape (end of pattern) at position 1\r\n```\r\nand no help message being sent\r\n\r\n### Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n\r\n- Python v3.6.9-final\r\n- discord.py v1.3.3-final\r\n- aiohttp v3.6.2\r\n- websockets v6.0\r\n- system info: Linux 4.15.0-58-generic #<span/>64-Ubuntu SMP Tue Aug 6 11:12:41 UTC 2019\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/4058/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4058/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/4037", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4037/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4037/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4037/events", "html_url": "https://github.com/Rapptz/discord.py/issues/4037", "id": 607947265, "node_id": "MDU6SXNzdWU2MDc5NDcyNjU=", "number": 4037, "title": "Executing a webhook with attachments fails if the per-channel ratelimit has been exhausted", "user": {"login": "RocketRace", "id": 35444188, "node_id": "MDQ6VXNlcjM1NDQ0MTg4", "avatar_url": "https://avatars.githubusercontent.com/u/35444188?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RocketRace", "html_url": "https://github.com/RocketRace", "followers_url": "https://api.github.com/users/RocketRace/followers", "following_url": "https://api.github.com/users/RocketRace/following{/other_user}", "gists_url": "https://api.github.com/users/RocketRace/gists{/gist_id}", "starred_url": "https://api.github.com/users/RocketRace/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RocketRace/subscriptions", "organizations_url": "https://api.github.com/users/RocketRace/orgs", "repos_url": "https://api.github.com/users/RocketRace/repos", "events_url": "https://api.github.com/users/RocketRace/events{/privacy}", "received_events_url": "https://api.github.com/users/RocketRace/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-04-28T00:57:19Z", "updated_at": "2021-04-16T01:56:10Z", "closed_at": "2021-04-16T01:56:09Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\r\n\r\nRefer to #2272 and potentially also #4026.\r\n\r\nWhen sending messages using a webhook, after the 30 messages / 60 seconds per-channel rate limit has been exhausted, trying to execute the webhook again triggers a 429 HTTP response. _Internally,_ after waiting for the `retry_after` to elapse, trying to re-send the request triggers a `aiohttp.client_exceptions.ClientOSError: [Errno 54] Connection reset by peer` (Likely analogous to `[Errno 104] Connection reset by peer`), _if_ the message contains any attachments.\r\n\r\nNote that this only applies for non-empty attachments (at least 1 byte in length).\r\n\r\n### Reproduction Steps\r\n\r\nMinimal reproduction steps:\r\n```py\r\nfor i in range(30):\r\n   await webhook.send(f\"Message #{i}\")\r\nfile = discord.File(\"foo\")\r\nawait webhook.send(f\"Message #30\", file=file)\r\n```\r\n\r\n### Expected Results\r\n\r\nThe first 30 messages are sent as expected. The message with attachments is successfully sent after waiting for the per-channel rate limit to be refreshed.\r\n\r\n### Actual Results\r\n\r\nThe first 30 messages are sent successfully. The bot then encounters a 429 sending the last messafe, and waits until the cooldown elapses. It tries to re-send the message, which results in the following traceback:\r\n\r\nTraceback:\r\n```\r\nTraceback (most recent call last):\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/site-packages/discord/client.py\", line 317, in _run_event\r\n    await coro(*args, **kwargs)\r\n  File \"bugtest.py\", line 16, in on_ready\r\n    await webhook.send(f\"Message #30\", file=file)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/site-packages/discord/webhook.py\", line 231, in handle_execution_response\r\n    data = await response\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/site-packages/discord/webhook.py\", line 112, in _wrap_coroutine_and_cleanup\r\n    return await coro\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/site-packages/discord/webhook.py\", line 196, in request\r\n    async with self.session.request(verb, url, headers=headers, data=data) as r:\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/site-packages/aiohttp/client.py\", line 1012, in __aenter__\r\n    self._resp = await self._coro\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/site-packages/aiohttp/client.py\", line 504, in _request\r\n    await resp.start(conn)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/site-packages/aiohttp/client_reqrep.py\", line 847, in start\r\n    message, payload = await self._protocol.read()  # type: ignore  # noqa\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/site-packages/aiohttp/streams.py\", line 591, in read\r\n    await self._waiter\r\naiohttp.client_exceptions.ClientOSError: [Errno 54] Connection reset by peer\r\n```\r\n\r\nHere is a dump of the logs for the minimal reproduction code in DEBUG level. This specific bot has only access to one guild, channel and user to minimize noise in the logs.\r\n\r\nhttps://hastebin.com/lowilegoja.php\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n\r\n- Python v3.8.2-final\r\n- discord.py v1.4.0-alpha\r\n    - discord.py pkg_resources: v1.4.0a2308+ge473f3c\r\n- aiohttp v3.6.2\r\n- websockets v8.1\r\n- system info: Darwin 19.4.0 Darwin Kernel Version 19.4.0: Wed Mar  4 22:28:40 PST 2020; root:xnu-6153.101.6~15/RELEASE_X86_64", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/4037/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4037/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/4021", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4021/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4021/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4021/events", "html_url": "https://github.com/Rapptz/discord.py/issues/4021", "id": 602834557, "node_id": "MDU6SXNzdWU2MDI4MzQ1NTc=", "number": 4021, "title": "`parse_guild_member_remove` does not remove member from count if not cached", "user": {"login": "muddyfish", "id": 5381483, "node_id": "MDQ6VXNlcjUzODE0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/5381483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/muddyfish", "html_url": "https://github.com/muddyfish", "followers_url": "https://api.github.com/users/muddyfish/followers", "following_url": "https://api.github.com/users/muddyfish/following{/other_user}", "gists_url": "https://api.github.com/users/muddyfish/gists{/gist_id}", "starred_url": "https://api.github.com/users/muddyfish/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/muddyfish/subscriptions", "organizations_url": "https://api.github.com/users/muddyfish/orgs", "repos_url": "https://api.github.com/users/muddyfish/repos", "events_url": "https://api.github.com/users/muddyfish/events{/privacy}", "received_events_url": "https://api.github.com/users/muddyfish/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/10", "html_url": "https://github.com/Rapptz/discord.py/milestone/10", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/10/labels", "id": 5273240, "node_id": "MDk6TWlsZXN0b25lNTI3MzI0MA==", "number": 10, "title": "1.4", "description": "", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 59, "state": "closed", "created_at": "2020-04-04T06:24:09Z", "updated_at": "2020-08-06T04:03:45Z", "due_on": null, "closed_at": "2020-08-06T04:03:45Z"}, "comments": 0, "created_at": "2020-04-19T22:14:17Z", "updated_at": "2020-04-19T22:23:01Z", "closed_at": "2020-04-19T22:23:01Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\r\n\r\nIf a `guild_member_remove` event is received from the gateway before the member has loaded in, then `guild.member_count` does not go down.\r\n\r\n### Reproduction Steps\r\n\r\nStart a bot, and have a member leave before the corresponding guild_member_add event is called.\r\n\r\n### Expected Results\r\n\r\n`guild.member_count` matches `len(guild.members)`\r\n\r\n### Actual Results\r\n\r\n`guild.member_count` is bigger than `len(guild.members)`\r\n\r\n### Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [ ] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n\r\n<!-- Run `python -m discord -v` and paste this information below. -->\r\n<!-- This command is available in v1.1.0 or higher. If you are unable to run this command, paste basic info (ie. Python version, library version, and your operating system -->\r\n\r\nPy 3.6.8\r\nd.py v1.3.3", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/4021/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4021/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/4017", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4017/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4017/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4017/events", "html_url": "https://github.com/Rapptz/discord.py/issues/4017", "id": 602431544, "node_id": "MDU6SXNzdWU2MDI0MzE1NDQ=", "number": 4017, "title": "PartialEmoji should always have state if the emoji is custom", "user": {"login": "apple502j", "id": 33279053, "node_id": "MDQ6VXNlcjMzMjc5MDUz", "avatar_url": "https://avatars.githubusercontent.com/u/33279053?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apple502j", "html_url": "https://github.com/apple502j", "followers_url": "https://api.github.com/users/apple502j/followers", "following_url": "https://api.github.com/users/apple502j/following{/other_user}", "gists_url": "https://api.github.com/users/apple502j/gists{/gist_id}", "starred_url": "https://api.github.com/users/apple502j/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apple502j/subscriptions", "organizations_url": "https://api.github.com/users/apple502j/orgs", "repos_url": "https://api.github.com/users/apple502j/repos", "events_url": "https://api.github.com/users/apple502j/events{/privacy}", "received_events_url": "https://api.github.com/users/apple502j/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 251130944, "node_id": "MDU6TGFiZWwyNTExMzA5NDQ=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/help%20appreciated", "name": "help appreciated", "color": "159818", "default": false, "description": "Good issue to work on"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-04-18T10:48:23Z", "updated_at": "2022-03-11T01:56:20Z", "closed_at": "2022-03-11T01:56:20Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "PartialEmoji.url.read fails if PartialEmoji doesn't have state, so if the partial emoji is custom emoji, it should always have state. However, in some cases they don't:\r\n\r\n## Checklist\r\n- [x] `Message.reactions[0].emoji` - #4015, #4016 (pr)\r\n- [ ] `CustomActivity.emoji`\r\n- [ ] `Activity.emoji`", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/4017/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4017/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/4008", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4008/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4008/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4008/events", "html_url": "https://github.com/Rapptz/discord.py/issues/4008", "id": 601121520, "node_id": "MDU6SXNzdWU2MDExMjE1MjA=", "number": 4008, "title": "AttributeError: _member_count", "user": {"login": "Cleanish", "id": 62071019, "node_id": "MDQ6VXNlcjYyMDcxMDE5", "avatar_url": "https://avatars.githubusercontent.com/u/62071019?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Cleanish", "html_url": "https://github.com/Cleanish", "followers_url": "https://api.github.com/users/Cleanish/followers", "following_url": "https://api.github.com/users/Cleanish/following{/other_user}", "gists_url": "https://api.github.com/users/Cleanish/gists{/gist_id}", "starred_url": "https://api.github.com/users/Cleanish/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Cleanish/subscriptions", "organizations_url": "https://api.github.com/users/Cleanish/orgs", "repos_url": "https://api.github.com/users/Cleanish/repos", "events_url": "https://api.github.com/users/Cleanish/events{/privacy}", "received_events_url": "https://api.github.com/users/Cleanish/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-04-16T14:45:27Z", "updated_at": "2020-11-07T00:48:19Z", "closed_at": "2020-04-17T03:38:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\nBasically when particular user tokens try run the bot it throws out this Traceback (most recent call last) error\r\n### Reproduction Steps\r\nTo reproduce this, you just need to find one of the usertokens that throws the Traceback, i obviously can't provide one for specific reasons but it's not all user tokens.\r\n### Expected Results\r\nThe expected result is for the bot to load and function as it is suppose to, (Selfbot).\r\n### Actual Results\r\nWhat actually happened is that it returned a Traceback error when trying to i assume connect.\r\n\r\n`Traceback (most recent call last):\r\n  File \"c:/Users/Caleb/Desktop/Sanitary Source/Maincopy.py\", line 2253, in <module>\r\n    Init()\r\n  File \"c:/Users/Caleb/Desktop/Sanitary Source/Maincopy.py\", line 145, in Init\r\n    Sanitary.run(token, bot=False, reconnect=True)\r\n  File \"C:\\Users\\Caleb\\AppData\\Local\\Programs\\Python\\Python38\\lib\\site-packages\\discord\\client.py\", line 640, in run\r\n    return future.result()\r\n  File \"C:\\Users\\Caleb\\AppData\\Local\\Programs\\Python\\Python38\\lib\\site-packages\\discord\\client.py\", line 621, in runner\r\n    await self.start(*args, **kwargs)\r\n  File \"C:\\Users\\Caleb\\AppData\\Local\\Programs\\Python\\Python38\\lib\\site-packages\\discord\\client.py\", line 585, in start\r\n    await self.connect(reconnect=reconnect)\r\n  File \"C:\\Users\\Caleb\\AppData\\Local\\Programs\\Python\\Python38\\lib\\site-packages\\discord\\client.py\", line 499, in connect\r\n    await self._connect()\r\n  File \"C:\\Users\\Caleb\\AppData\\Local\\Programs\\Python\\Python38\\lib\\site-packages\\discord\\client.py\", line 463, in _connect\r\n    await self.ws.poll_event()\r\n  File \"C:\\Users\\Caleb\\AppData\\Local\\Programs\\Python\\Python38\\lib\\site-packages\\discord\\gateway.py\", line 471, in poll_event\r\n    await self.received_message(msg)\r\n  File \"C:\\Users\\Caleb\\AppData\\Local\\Programs\\Python\\Python38\\lib\\site-packages\\discord\\gateway.py\", line 425, in received_message\r\n    func(data)\r\n  File \"C:\\Users\\Caleb\\AppData\\Local\\Programs\\Python\\Python38\\lib\\site-packages\\discord\\state.py\", line 394, in parse_ready\r\n    guild = self._add_guild_from_data(guild_data)\r\n  File \"C:\\Users\\Caleb\\AppData\\Local\\Programs\\Python\\Python38\\lib\\site-packages\\discord\\state.py\", line 274, in _add_guild_from_data\r\n    guild = Guild(data=guild, state=self)\r\n  File \"C:\\Users\\Caleb\\AppData\\Local\\Programs\\Python\\Python38\\lib\\site-packages\\discord\\guild.py\", line 177, in __init__\r\n    self._from_data(data)\r\n  File \"C:\\Users\\Caleb\\AppData\\Local\\Programs\\Python\\Python38\\lib\\site-packages\\discord\\guild.py\", line 298, in _from_data\r\n    self._large = None if member_count is None else self._member_count >= 250\r\nAttributeError: _member_count`\r\n\r\n\r\n### Checklist\r\n\r\n\r\n- [x ] I have searched the open issues for duplicates.\r\n- [x ] I have shown the entire traceback, if possible.\r\n- [x ] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n- Python v3.8.2-final\r\n- discord.py v1.3.3-final\r\n- aiohttp v3.6.2\r\n- websockets v8.1\r\n- system info: Windows 10 10.0.18362\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/4008/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4008/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/4005", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4005/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4005/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4005/events", "html_url": "https://github.com/Rapptz/discord.py/issues/4005", "id": 600492322, "node_id": "MDU6SXNzdWU2MDA0OTIzMjI=", "number": 4005, "title": "sharding-rework branch exception", "user": {"login": "sla-te", "id": 22568014, "node_id": "MDQ6VXNlcjIyNTY4MDE0", "avatar_url": "https://avatars.githubusercontent.com/u/22568014?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sla-te", "html_url": "https://github.com/sla-te", "followers_url": "https://api.github.com/users/sla-te/followers", "following_url": "https://api.github.com/users/sla-te/following{/other_user}", "gists_url": "https://api.github.com/users/sla-te/gists{/gist_id}", "starred_url": "https://api.github.com/users/sla-te/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sla-te/subscriptions", "organizations_url": "https://api.github.com/users/sla-te/orgs", "repos_url": "https://api.github.com/users/sla-te/repos", "events_url": "https://api.github.com/users/sla-te/events{/privacy}", "received_events_url": "https://api.github.com/users/sla-te/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-04-15T18:10:56Z", "updated_at": "2020-11-07T00:49:15Z", "closed_at": "2020-04-17T03:39:07Z", "author_association": "NONE", "active_lock_reason": null, "body": "This configuration:\r\n\r\n```\r\nfrom aiohttp import BasicAuth\r\nimport discord\r\n\r\nproxy_auth = BasicAuth(login=\"proxy_username\", password=\"proxy_password\", encoding='latin1')\r\nproxy = \"http://proxyip.com:1234\"\r\n\r\nclient = discord.Client(\r\n\t\tproxy=proxy,\r\n\t\tproxy_auth=proxy_auth,\r\n\t\tstatus=new_status,\r\n\t\tactivity=new_activity,\r\n\t\tmax_messages=None,  # disables client-internal message cache\r\n\t\tfetch_offline_members=False,  # disables trying to load guild members to memory\r\n\t\tguild_subscriptions=False  # disables guild updates\r\n)\r\n```\r\nresults in multiple:\r\n```\r\nself._large = None if member_count is None else self._member_count >= 250\r\nAttributeError: _member_count\r\n```\r\nand multiple:\r\n```\r\nwebsocket connection is closing.\r\n```\r\n\r\nin the log. As it seems, its also very unstable at the moment, meaning a lot of online/offlines.\r\n\r\n->I am using this branch, because the master branch does not offer proxy support for websocket connections.\r\n->Before I was using the aiohttp-websockets branch, on this one I was getting the same errors but it was a lot more stable. While using this one the bot would just fail on certain guilds but work stable on all others without any frequent going online and offline repeatedly\r\n\r\nEDIT: It definitly got something to do with the guild the bot is joined to. This one causes it to crash: https://discord.gg/5WyAqg (if not its definitly this one: https://discord.gg/JAW99G).\r\n\r\nEDIT2: I believe it crashes if the guild is very large, one of the above two guilds got 250k users", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/4005/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4005/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/4002", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4002/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4002/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4002/events", "html_url": "https://github.com/Rapptz/discord.py/issues/4002", "id": 599133716, "node_id": "MDU6SXNzdWU1OTkxMzM3MTY=", "number": 4002, "title": "Object.__init__ doesn't validate the type of id", "user": {"login": "Silari", "id": 8951819, "node_id": "MDQ6VXNlcjg5NTE4MTk=", "avatar_url": "https://avatars.githubusercontent.com/u/8951819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Silari", "html_url": "https://github.com/Silari", "followers_url": "https://api.github.com/users/Silari/followers", "following_url": "https://api.github.com/users/Silari/following{/other_user}", "gists_url": "https://api.github.com/users/Silari/gists{/gist_id}", "starred_url": "https://api.github.com/users/Silari/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Silari/subscriptions", "organizations_url": "https://api.github.com/users/Silari/orgs", "repos_url": "https://api.github.com/users/Silari/repos", "events_url": "https://api.github.com/users/Silari/events{/privacy}", "received_events_url": "https://api.github.com/users/Silari/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/10", "html_url": "https://github.com/Rapptz/discord.py/milestone/10", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/10/labels", "id": 5273240, "node_id": "MDk6TWlsZXN0b25lNTI3MzI0MA==", "number": 10, "title": "1.4", "description": "", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 59, "state": "closed", "created_at": "2020-04-04T06:24:09Z", "updated_at": "2020-08-06T04:03:45Z", "due_on": null, "closed_at": "2020-08-06T04:03:45Z"}, "comments": 0, "created_at": "2020-04-13T21:01:02Z", "updated_at": "2020-04-19T22:33:20Z", "closed_at": "2020-04-19T22:33:19Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nObject.__init__ doesn't validate the input value is an int - any type is accepted and set. This leads to errors later due to the type mismatch which are harder to debug than if it explicitly raised a TypeError immediately.\r\n\r\n### Reproduction Steps\r\nIn my particular case, it came up when running\r\n`await message.channel.purge(after=discord.Object(command[1]))`\r\nin an on_message event, and command[1] was part of the message text containing the string '692929041233084436', but you can put whatever into the Object constructor and it'll succeed.\r\n\r\n### Expected Results\r\n\r\nObject.__init__ to raise a TypeError if value is not an int, similar to what Colour.__init__ does.\r\n\r\n### Actual Results\r\n\r\nObject creation succeeded with the improper type, causing an error later when it attempted to use the Object.id. \r\n\r\n> Ignoring exception in on_message\r\n> Traceback (most recent call last):\r\n>   File \"C:\\Python37\\lib\\site-packages\\discord\\client.py\", line 312, in _run_event\r\n>     await coro(*args, **kwargs)\r\n>   File \"C:\\Python37\\dbcontext.py\", line 984, in on_message\r\n>     await getcontext(command[1],message)\r\n>   File \"C:\\Python37\\dbcontext.py\", line 333, in getcontext\r\n>     await contfuncs[name](message.content.split()[2:],message)\r\n>   File \"C:\\Python37\\dbcontext.py\", line 777, in debughandler\r\n>     await message.channel.purge(after=discord.Object(command[1]))\r\n>   File \"C:\\Python37\\lib\\site-packages\\discord\\channel.py\", line 372, in purge\r\n>     msg = await iterator.next()\r\n>   File \"C:\\Python37\\lib\\site-packages\\discord\\iterators.py\", line 262, in next\r\n>     await self.fill_messages()\r\n>   File \"C:\\Python37\\lib\\site-packages\\discord\\iterators.py\", line 318, in fill_messages\r\n>     for element in data:\r\n>   File \"C:\\Python37\\lib\\site-packages\\discord\\iterators.py\", line 258, in <lambda>\r\n>     self._filter = lambda m: int(m['id']) > self.after.id\r\n> TypeError: '>' not supported between instances of 'int' and 'str'\r\n\r\nThis traceback makes it look like the issue is within the library itself, rather than simply needing to cast the str to int when passing to Object.\r\n\r\n### Checklist\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n- Python v3.7.2-final\r\n- discord.py v1.3.3-final\r\n- aiohttp v3.6.2\r\n- websockets v6.0\r\n- system info: Windows 10 10.0.18362", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/4002/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/4002/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/3996", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/3996/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/3996/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/3996/events", "html_url": "https://github.com/Rapptz/discord.py/issues/3996", "id": 598418813, "node_id": "MDU6SXNzdWU1OTg0MTg4MTM=", "number": 3996, "title": "Reconnecting Loop because of VoiceRegion Change", "user": {"login": "aschenkuttel", "id": 31082646, "node_id": "MDQ6VXNlcjMxMDgyNjQ2", "avatar_url": "https://avatars.githubusercontent.com/u/31082646?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aschenkuttel", "html_url": "https://github.com/aschenkuttel", "followers_url": "https://api.github.com/users/aschenkuttel/followers", "following_url": "https://api.github.com/users/aschenkuttel/following{/other_user}", "gists_url": "https://api.github.com/users/aschenkuttel/gists{/gist_id}", "starred_url": "https://api.github.com/users/aschenkuttel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aschenkuttel/subscriptions", "organizations_url": "https://api.github.com/users/aschenkuttel/orgs", "repos_url": "https://api.github.com/users/aschenkuttel/repos", "events_url": "https://api.github.com/users/aschenkuttel/events{/privacy}", "received_events_url": "https://api.github.com/users/aschenkuttel/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/10", "html_url": "https://github.com/Rapptz/discord.py/milestone/10", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/10/labels", "id": 5273240, "node_id": "MDk6TWlsZXN0b25lNTI3MzI0MA==", "number": 10, "title": "1.4", "description": "", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 59, "state": "closed", "created_at": "2020-04-04T06:24:09Z", "updated_at": "2020-08-06T04:03:45Z", "due_on": null, "closed_at": "2020-08-06T04:03:45Z"}, "comments": 3, "created_at": "2020-04-12T06:05:11Z", "updated_at": "2020-06-22T08:01:30Z", "closed_at": "2020-06-22T08:01:22Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\nI still have problems with the bot permanently reconnecting after a while. The reason seems to be some discord internal voiceserver change for my guild since you can reproduce that behaviour by changing the voice region while the bot is in voice. It then disconnects and connects every minute till you force it to disconnect / restart. It's not my code, I reproduced it with a dummy bot aswell.\r\n\r\n### Reproduction Steps\r\nConnect your bot to any voice channel and change the server region\r\n\r\n### Expected Results\r\nA Reconnect once\r\n\r\n### Actual Results\r\nInfinite reconnects every minute with this failure:\r\n\r\n> ERROR:discord.voice_client: Disconnected from voice... Reconnecting in 0.05s.\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\Neel\\AppData\\Local\\Programs\\Python\\Python37\\lib\\site-packages\\discord\\gateway.py\", line 746, in poll_event\r\n    msg = await asyncio.wait_for(self.recv(), timeout=30.0)\r\n  File \"C:\\Users\\Neel\\AppData\\Local\\Programs\\Python\\Python37\\lib\\asyncio\\tasks.py\", line 442, in wait_for\r\n    return fut.result()\r\n  File \"C:\\Users\\Neel\\AppData\\Local\\Programs\\Python\\Python37\\lib\\site-packages\\websockets\\protocol.py\", line 350, in recv\r\n    yield from self.ensure_open()\r\n  File \"C:\\Users\\Neel\\AppData\\Local\\Programs\\Python\\Python37\\lib\\site-packages\\websockets\\protocol.py\", line 512, in ensure_open\r\n    self.close_code, self.close_reason) from self.transfer_data_exc\r\nwebsockets.exceptions.ConnectionClosed: WebSocket connection is closed: code = 4000 (private use), no reason\r\nThe above exception was the direct cause of the following exception:\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\Neel\\AppData\\Local\\Programs\\Python\\Python37\\lib\\site-packages\\discord\\voice_client.py\", line 243, in poll_voice_ws\r\n    await self.ws.poll_event()\r\n  File \"C:\\Users\\Neel\\AppData\\Local\\Programs\\Python\\Python37\\lib\\site-packages\\discord\\gateway.py\", line 749, in poll_event\r\n    raise ConnectionClosed(exc, shard_id=None) from exc\r\ndiscord.errors.ConnectionClosed: WebSocket connection is closed: code = 4000 (private use), no reason\r\n\r\nHere's the complete log from reproducing it:\r\n[discord.log](https://github.com/Rapptz/discord.py/files/4465911/discord.log)\r\n\r\n### Checklist\r\n\r\n- [X]  I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n- Python v3.7.4-final\r\n- discord.py v1.3.3-final\r\n- aiohttp v3.6.2\r\n- websockets v6.0\r\n- system info: Windows 10 10.0.18362", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/3996/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/3996/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2473", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2473/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2473/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2473/events", "html_url": "https://github.com/Rapptz/discord.py/issues/2473", "id": 534550570, "node_id": "MDU6SXNzdWU1MzQ1NTA1NzA=", "number": 2473, "title": "fetch_member is not optional, despite documentation", "user": {"login": "ghost", "id": 10137, "node_id": "MDQ6VXNlcjEwMTM3", "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghost", "html_url": "https://github.com/ghost", "followers_url": "https://api.github.com/users/ghost/followers", "following_url": "https://api.github.com/users/ghost/following{/other_user}", "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghost/subscriptions", "organizations_url": "https://api.github.com/users/ghost/orgs", "repos_url": "https://api.github.com/users/ghost/repos", "events_url": "https://api.github.com/users/ghost/events{/privacy}", "received_events_url": "https://api.github.com/users/ghost/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2019-12-08T14:36:30Z", "updated_at": "2020-01-12T08:29:46Z", "closed_at": "2020-01-12T08:29:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "I am not sure if this is a bug, or a misunderstanding of what `Optional` implies, which I assume this library is following, but this is assuming that `Optional[T]` is used with the same meaning as `typing.Optional[T]` and is thus the same as `typing.Union[T, None]` as per the Python documentation.\r\n\r\nSuppose I make the following call in 1b9108f:\r\n\r\n```py\r\nguild_obj: discord.Guild = ...\r\n\r\n# I want to fetch all members in the guild.\r\nasync for member_obj in guild_obj.fetch_members(limit=None):\r\n    ...\r\n```\r\nI will receive the following error on execution:\r\n```\r\nIgnoring exception in on_guild_available\r\nTraceback (most recent call last):\r\n  File \"/usr/local/src/discord.py/discord/client.py\", line 312, in _run_event\r\n    await coro(*args, **kwargs)\r\n  File \"/neko3/neko3/features/autorole.py\", line 51, in on_guild_available\r\n    async for member_obj in guild_obj.fetch_members(limit=None):\r\n  File \"/usr/local/src/discord.py/discord/iterators.py\", line 86, in __anext__\r\n    msg = await self.next()\r\n  File \"/usr/local/src/discord.py/discord/iterators.py\", line 607, in next\r\n    await self.fill_members()\r\n  File \"/usr/local/src/discord.py/discord/iterators.py\", line 615, in fill_members\r\n    if self.limit > 0:\r\nTypeError: '>' not supported between instances of 'NoneType' and 'int'\r\n```\r\nHowever, [the documentation for `1b9108f`](https://github.com/Rapptz/discord.py/blob/1b9108ffd75fb257b699d1af41f0b9c22fc04a97/discord/guild.py#L1210)  states that this is an `Optional`, so I assume that the above example should work correctly.\r\n\r\nSide note, I am aware that in most cases, the `members` attribute would provide the same behaviour without the network overhead, and thus using that would be a work around for this.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2473/reactions", "total_count": 2, "+1": 0, "-1": 0, "laugh": 1, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 1}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2473/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2420", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2420/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2420/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2420/events", "html_url": "https://github.com/Rapptz/discord.py/issues/2420", "id": 523516278, "node_id": "MDU6SXNzdWU1MjM1MTYyNzg=", "number": 2420, "title": "URLs in escape_markdown() not properly matched", "user": {"login": "Jefffrey", "id": 22608443, "node_id": "MDQ6VXNlcjIyNjA4NDQz", "avatar_url": "https://avatars.githubusercontent.com/u/22608443?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jefffrey", "html_url": "https://github.com/Jefffrey", "followers_url": "https://api.github.com/users/Jefffrey/followers", "following_url": "https://api.github.com/users/Jefffrey/following{/other_user}", "gists_url": "https://api.github.com/users/Jefffrey/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jefffrey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jefffrey/subscriptions", "organizations_url": "https://api.github.com/users/Jefffrey/orgs", "repos_url": "https://api.github.com/users/Jefffrey/repos", "events_url": "https://api.github.com/users/Jefffrey/events{/privacy}", "received_events_url": "https://api.github.com/users/Jefffrey/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-11-15T14:56:40Z", "updated_at": "2019-11-19T03:23:05Z", "closed_at": "2019-11-19T03:23:05Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\r\n\r\nWhen using escape_markdown() from discord.utils, URLs are not properly recognized when the ignore_links argument is set to True. Issue lies with the regex string used for matching URLs:\r\n\r\n`(?P<url>(?:https?|steam)://(?:-\\.)?(?:[^\\s/?\\.#-]+\\.?)+(?:/[^\\s]*)?)`\r\n\r\nParticularly, in the `(?:[^\\s/?\\.#-]+\\.?)` group, why is the - dash character included? This regex string wouldn't work with some URLs that I will be encountering. Also, what purpose does the initial `(?:-\\.)?` group right after the `(?:https?|steam)://` serve?\r\n\r\n### Reproduction Steps\r\n\r\n```python\r\nimport discord\r\n\r\ntest_string = \"\"\"__Nijigasaki High School Idol Club 1st Live__\r\nOfficial site: http://www.lovelive-anime.jp/nijigasaki/sp_1stlive.php\r\nDecember 14 (Sat), 15 (Sun)\"\"\"\r\n\r\nprint(discord.utils.escape_markdown(test_string))\r\n```\r\n\r\n### Expected Results\r\n\r\n```\r\n\\_\\_Nijigasaki High School Idol Club 1st Live\\_\\_\r\nOfficial site: http://www.lovelive-anime.jp/nijigasaki/sp_1stlive.php\r\nDecember 14 (Sat), 15 (Sun)\r\n```\r\n\r\n### Actual Results\r\n\r\n```\r\n\\_\\_Nijigasaki High School Idol Club 1st Live\\_\\_\r\nOfficial site: http://www.lovelive-anime.jp/nijigasaki/sp\\_1stlive.php\r\nDecember 14 (Sat), 15 (Sun)\r\n```\r\n\r\n### Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n\r\n- Python v3.7.1-final\r\n- discord.py v1.2.3-final\r\n- aiohttp v3.5.4\r\n- websockets v6.0\r\n- system info: Windows 10 10.0.17763\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2420/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2420/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2413", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2413/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2413/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2413/events", "html_url": "https://github.com/Rapptz/discord.py/issues/2413", "id": 517615991, "node_id": "MDU6SXNzdWU1MTc2MTU5OTE=", "number": 2413, "title": "OggStream doesn't check for end of stream", "user": {"login": "rkevin-arch", "id": 5837628, "node_id": "MDQ6VXNlcjU4Mzc2Mjg=", "avatar_url": "https://avatars.githubusercontent.com/u/5837628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rkevin-arch", "html_url": "https://github.com/rkevin-arch", "followers_url": "https://api.github.com/users/rkevin-arch/followers", "following_url": "https://api.github.com/users/rkevin-arch/following{/other_user}", "gists_url": "https://api.github.com/users/rkevin-arch/gists{/gist_id}", "starred_url": "https://api.github.com/users/rkevin-arch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rkevin-arch/subscriptions", "organizations_url": "https://api.github.com/users/rkevin-arch/orgs", "repos_url": "https://api.github.com/users/rkevin-arch/repos", "events_url": "https://api.github.com/users/rkevin-arch/events{/privacy}", "received_events_url": "https://api.github.com/users/rkevin-arch/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-11-05T08:23:30Z", "updated_at": "2019-11-20T02:27:43Z", "closed_at": "2019-11-20T02:27:43Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\r\n\r\nOggStream doesn't seem to check if the stream is finished or not. If the stream is finished, [the read](https://github.com/Rapptz/discord.py/blob/4c3e53edf4ff90e3fcf195c429601a553d661cd8/discord/oggparse.py#L77) reads 0 bytes, which doesn't match an 'OggS' header, which causes it to raise an exception even when the audio was played successfully.\r\n\r\n### Reproduction Steps\r\n\r\n```python\r\n#!/usr/bin/python3.5\r\nimport discord\r\nfrom BOT_TOKEN import TOKEN\r\n\r\ndef print_exception(e):\r\n    if e is not None:\r\n        print(\"Exception!\")\r\n        print(e)\r\n\r\nclass TestBot(discord.Client):\r\n    async def on_ready(self):\r\n        vc=await self.get_channel(640586707384795150).connect()\r\n        vc.play(discord.FFmpegOpusAudio(\"test.mp3\"), after=print_exception)\r\n\r\nTestBot().run(TOKEN)\r\n```\r\n\r\n### Expected Results\r\n\r\nWhen the audio finishes playing successfully, there are no exceptions.\r\n\r\n### Actual Results\r\n\r\n```\r\nException!\r\ninvalid header magic\r\n```\r\n\r\n### Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n\r\n- Python v3.5.3-final\r\n- discord.py v1.3.0-alpha\r\n    - discord.py pkg_resources: v1.3.0a2121+g4c3e53e\r\n- aiohttp v3.5.4\r\n- websockets v6.0\r\n- system info: Linux 4.19.66-v7+ #1253 SMP Thu Aug 15 11:49:46 BST 2019\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2413/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2413/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2383", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2383/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2383/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2383/events", "html_url": "https://github.com/Rapptz/discord.py/issues/2383", "id": 509662619, "node_id": "MDU6SXNzdWU1MDk2NjI2MTk=", "number": 2383, "title": "Bot.fetch_invite() returns KeyError when trying to resolve Group DM invites", "user": {"login": "AlexFlipnote", "id": 19587382, "node_id": "MDQ6VXNlcjE5NTg3Mzgy", "avatar_url": "https://avatars.githubusercontent.com/u/19587382?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AlexFlipnote", "html_url": "https://github.com/AlexFlipnote", "followers_url": "https://api.github.com/users/AlexFlipnote/followers", "following_url": "https://api.github.com/users/AlexFlipnote/following{/other_user}", "gists_url": "https://api.github.com/users/AlexFlipnote/gists{/gist_id}", "starred_url": "https://api.github.com/users/AlexFlipnote/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AlexFlipnote/subscriptions", "organizations_url": "https://api.github.com/users/AlexFlipnote/orgs", "repos_url": "https://api.github.com/users/AlexFlipnote/repos", "events_url": "https://api.github.com/users/AlexFlipnote/events{/privacy}", "received_events_url": "https://api.github.com/users/AlexFlipnote/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2019-10-20T22:32:29Z", "updated_at": "2020-01-20T12:22:34Z", "closed_at": "2020-01-20T12:22:34Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\nWhenever I try to resolve an invite made for group DMs, it prompts with KeyError instead of saying something in the lines of being a group DM instead of a regular Discord server.\r\n\r\n### Reproduction Steps\r\n```py\r\n# YXHVVE | This was (or still is) a valid group DM invite code\r\n>>> await self.bot.fetch_invite(\"YXHVVE\")\r\n```\r\n\r\n### Expected Results\r\nWas expecting it to return the invite as valid but not a guild invite.\r\n\r\n### Actual Results\r\n```py\r\n>>> await self.bot.fetch_invite(\"YXHVVE\")\r\nTraceback (most recent call last):\r\n  File \"/home/alexflipnote/Desktop/xelA/cogs/eval.py\", line 62, in _eval\r\n    res = await func()\r\n  File \"<string>\", line 5, in func\r\n  File \"/usr/local/lib/python3.7/site-packages/discord/client.py\", line 1054, in fetch_invite\r\n    return Invite.from_incomplete(state=self._connection, data=data)\r\n  File \"/usr/local/lib/python3.7/site-packages/discord/invite.py\", line 278, in from_incomplete\r\n    guild_id = int(data['guild']['id'])\r\nKeyError: 'guild'\r\n```\r\n\r\n### Checklist\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n```\r\n- Python v3.7.0-final\r\n- discord.py v1.2.4-final\r\n- aiohttp v3.5.4\r\n- websockets v6.0\r\n- system info: Linux 4.9.58-xxxx-std-ipv6-64 #1 SMP Mon Oct 23 11:35:59 CEST 2017\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2383/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2383/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2325", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2325/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2325/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2325/events", "html_url": "https://github.com/Rapptz/discord.py/issues/2325", "id": 486011473, "node_id": "MDU6SXNzdWU0ODYwMTE0NzM=", "number": 2325, "title": "Crash on reaction add", "user": {"login": "gardspirito", "id": 29687558, "node_id": "MDQ6VXNlcjI5Njg3NTU4", "avatar_url": "https://avatars.githubusercontent.com/u/29687558?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gardspirito", "html_url": "https://github.com/gardspirito", "followers_url": "https://api.github.com/users/gardspirito/followers", "following_url": "https://api.github.com/users/gardspirito/following{/other_user}", "gists_url": "https://api.github.com/users/gardspirito/gists{/gist_id}", "starred_url": "https://api.github.com/users/gardspirito/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gardspirito/subscriptions", "organizations_url": "https://api.github.com/users/gardspirito/orgs", "repos_url": "https://api.github.com/users/gardspirito/repos", "events_url": "https://api.github.com/users/gardspirito/events{/privacy}", "received_events_url": "https://api.github.com/users/gardspirito/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-08-27T20:13:31Z", "updated_at": "2019-08-27T21:47:50Z", "closed_at": "2019-08-27T21:47:50Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nBot crashes when somebody adds a reaction to a message. No appropriate callbacks are provided (I am using only `on_message` callback).\r\n\r\n### Reproduction Steps\r\n\r\nAdd reaction to literally any message that bot can see.\r\n\r\n### Expected Results\r\n\r\nNo error.\r\n\r\n### Actual Results\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"bot.py\", line 580, in <module>\r\n    client.run(TOKEN);\r\n  File \"/app/.heroku/python/lib/python3.7/site-packages/discord/client.py\", line 631, in run\r\n    return future.result()\r\n  File \"/app/.heroku/python/lib/python3.7/site-packages/discord/client.py\", line 612, in runner\r\n    await self.start(*args, **kwargs)\r\n  File \"/app/.heroku/python/lib/python3.7/site-packages/discord/client.py\", line 576, in start\r\n    await self.connect(reconnect=reconnect)\r\n  File \"/app/.heroku/python/lib/python3.7/site-packages/discord/client.py\", line 490, in connect\r\n    await self._connect()\r\n  File \"/app/.heroku/python/lib/python3.7/site-packages/discord/client.py\", line 454, in _connect\r\n    await self.ws.poll_event()\r\n  File \"/app/.heroku/python/lib/python3.7/site-packages/discord/gateway.py\", line 470, in poll_event\r\n    await self.received_message(msg)\r\n  File \"/app/.heroku/python/lib/python3.7/site-packages/discord/gateway.py\", line 424, in received_message\r\n    func(data)\r\n  File \"/app/.heroku/python/lib/python3.7/site-packages/discord/state.py\", line 454, in parse_message_reaction_add\r\n    reaction = message._add_reaction(data, emoji, raw.user_id)\r\nAttributeError: 'collections.deque' object has no attribute '_add_reaction'\r\n```\r\n\r\n### Checklist\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n\r\nPython 3.7.3, latest Discord.py version. Hosted on http://heroku.com.\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2325/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2325/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2310", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2310/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2310/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2310/events", "html_url": "https://github.com/Rapptz/discord.py/issues/2310", "id": 480086165, "node_id": "MDU6SXNzdWU0ODAwODYxNjU=", "number": 2310, "title": "Edit timestamp is not updated on cached messages", "user": {"login": "Exploder98", "id": 22271977, "node_id": "MDQ6VXNlcjIyMjcxOTc3", "avatar_url": "https://avatars.githubusercontent.com/u/22271977?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Exploder98", "html_url": "https://github.com/Exploder98", "followers_url": "https://api.github.com/users/Exploder98/followers", "following_url": "https://api.github.com/users/Exploder98/following{/other_user}", "gists_url": "https://api.github.com/users/Exploder98/gists{/gist_id}", "starred_url": "https://api.github.com/users/Exploder98/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Exploder98/subscriptions", "organizations_url": "https://api.github.com/users/Exploder98/orgs", "repos_url": "https://api.github.com/users/Exploder98/repos", "events_url": "https://api.github.com/users/Exploder98/events{/privacy}", "received_events_url": "https://api.github.com/users/Exploder98/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-08-13T10:43:31Z", "updated_at": "2019-08-13T10:44:46Z", "closed_at": "2019-08-13T10:44:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nWhen a message is edited, the edit timestamp is not actually updated on cached messages. This means that the edit timestamp is inaccessible in any method that uses the cached messages, such as `on_message_edit` and `on_message_delete`. This does not affect `fetch_message`, since that method loads the message as new instead of taking it from the cache.\r\n\r\n### Reproduction Steps\r\n\r\n1. Run the following client code:\r\n```python\r\nimport discord\r\n\r\nclient = discord.Client()\r\n\r\n@client.event\r\nasync def on_ready():\r\n    print('Ready!')\r\n\r\n@client.event\r\nasync def on_message_edit(before, after):\r\n    print(after.edited_at)\r\n    msg = await after.channel.fetch_message(after.id)\r\n    print(msg.edited_at)\r\n\r\n@client.event\r\nasync def on_message_delete(msg):\r\n    print(msg.edited_at)\r\n\r\nclient.run('token')\r\n```\r\n2. Wait until the client is ready.\r\n3. Send a message to a channel where the bot user has permissions to read messages, then edit that message.\r\n4. Check the console output.\r\n5. Delete the sent message.\r\n6. Check the console output again.\r\n\r\n### Expected Results\r\n\r\nThe edit timestamp is printed twice when the message is edited and once when it's deleted.\r\n\r\n### Actual Results\r\n\r\n`None` is printed first, meaning that the timestamp was not updated on the cached message. Then the timestamp is printed correctly, since `fetch_message` creates a new `discord.Message` object. Then `None` is printed again, this time in `on_message_delete`.\r\n\r\n\r\n### Checklist\r\n\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n```\r\n$ python -m discord -v\r\n- Python v3.7.3-final\r\n- discord.py v1.2.3-final\r\n- aiohttp v3.5.4\r\n- websockets v6.0\r\n- system info: Linux 5.0.0-23-generic #24-Ubuntu SMP Mon Jul 29 15:36:44 UTC 2019\r\n```", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2310/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2310/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2294", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2294/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2294/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2294/events", "html_url": "https://github.com/Rapptz/discord.py/issues/2294", "id": 475731406, "node_id": "MDU6SXNzdWU0NzU3MzE0MDY=", "number": 2294, "title": "discord.ext.tasks.loop stores task globally", "user": {"login": "dfitzpatrick", "id": 980301, "node_id": "MDQ6VXNlcjk4MDMwMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/980301?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dfitzpatrick", "html_url": "https://github.com/dfitzpatrick", "followers_url": "https://api.github.com/users/dfitzpatrick/followers", "following_url": "https://api.github.com/users/dfitzpatrick/following{/other_user}", "gists_url": "https://api.github.com/users/dfitzpatrick/gists{/gist_id}", "starred_url": "https://api.github.com/users/dfitzpatrick/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dfitzpatrick/subscriptions", "organizations_url": "https://api.github.com/users/dfitzpatrick/orgs", "repos_url": "https://api.github.com/users/dfitzpatrick/repos", "events_url": "https://api.github.com/users/dfitzpatrick/events{/privacy}", "received_events_url": "https://api.github.com/users/dfitzpatrick/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/10", "html_url": "https://github.com/Rapptz/discord.py/milestone/10", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/10/labels", "id": 5273240, "node_id": "MDk6TWlsZXN0b25lNTI3MzI0MA==", "number": 10, "title": "1.4", "description": "", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 59, "state": "closed", "created_at": "2020-04-04T06:24:09Z", "updated_at": "2020-08-06T04:03:45Z", "due_on": null, "closed_at": "2020-08-06T04:03:45Z"}, "comments": 0, "created_at": "2019-08-01T14:56:21Z", "updated_at": "2020-04-14T08:40:39Z", "closed_at": "2020-04-14T08:40:39Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\ndiscord.ext.Tasks stores the current task in _task and will not spawn another instance of it.\r\n\r\n<!-- A summary of your bug report -->\r\nI assume this was designed at COG level, but suppose you have a custom class that you have a unique task start in, you cannot instantiate more than one class with that task.\r\n### Reproduction Steps\r\ncreate custom class with a task\r\n\r\n\r\n### Expected Results\r\nTasks should not be global to the package, but to the instance.\r\n\r\n### Actual Results\r\ndispatches command_error at the COG level that the Task already exists.\r\n\r\n```py\r\n if self._task is not None and not self._task.done():\r\n            raise RuntimeError('Task is already launched and is not completed.')\r\n```\r\n\r\n### Checklist\r\n\r\n<!-- Put an x inside [ ] to check it, like so: [x] -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [ ] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n\r\n<!-- Run `python -m discord -v` and paste this information below. -->\r\n<!-- This command is available in v1.1.0 or higher. If you are unable to run this command, paste basic info (ie. Python version, library version, and your operating system -->\r\n Python v3.6.7-final\r\n- discord.py v1.2.3-final\r\n- aiohttp v3.5.4\r\n- websockets v6.0\r\n- system info: Windows 10 10.0.18362", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2294/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2294/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2291", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2291/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2291/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2291/events", "html_url": "https://github.com/Rapptz/discord.py/issues/2291", "id": 473696529, "node_id": "MDU6SXNzdWU0NzM2OTY1Mjk=", "number": 2291, "title": "[commands] AttributeError: module has no attribute 'loader' in Bot.reload_extension", "user": {"login": "Harmon758", "id": 9403740, "node_id": "MDQ6VXNlcjk0MDM3NDA=", "avatar_url": "https://avatars.githubusercontent.com/u/9403740?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Harmon758", "html_url": "https://github.com/Harmon758", "followers_url": "https://api.github.com/users/Harmon758/followers", "following_url": "https://api.github.com/users/Harmon758/following{/other_user}", "gists_url": "https://api.github.com/users/Harmon758/gists{/gist_id}", "starred_url": "https://api.github.com/users/Harmon758/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Harmon758/subscriptions", "organizations_url": "https://api.github.com/users/Harmon758/orgs", "repos_url": "https://api.github.com/users/Harmon758/repos", "events_url": "https://api.github.com/users/Harmon758/events{/privacy}", "received_events_url": "https://api.github.com/users/Harmon758/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2019-07-28T02:08:20Z", "updated_at": "2019-07-28T03:22:01Z", "closed_at": "2019-07-28T03:22:01Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\r\n\r\nWhen an extension is reloaded and contains an import that fails, an `AttributeError` is raised and the extension remains unloaded instead of rolled back to the previous version.\r\n\r\n### Reproduction Steps\r\n\r\n- Load an extension\r\n- Add an import that fails to this extension\r\n- Attempt to use `Bot.reload_extension` to reload the extension (e.g. through a command)\r\n\r\n### Expected Results\r\n\r\n`ExtensionFailed` should be raised and the previous version of the extension should remain loaded.\r\n\r\n### Actual Results\r\n\r\nDue to changes in https://github.com/Rapptz/discord.py/commit/0a21591d0c778f3f3596362fb1ae92ffc137e576, when `Bot.reload_extension` attempts to revert to the old version of the extension here:\r\nhttps://github.com/Rapptz/discord.py/blob/18fe2035ef33b9bbaa2f8504c787a40bdaf247fe/discord/ext/commands/bot.py#L727-L732 `_load_from_module_spec` attempts to use `importlib.util.module_from_spec` with the `module` that's passed, expecting a `ModuleSpec` instead:\r\nhttps://github.com/Rapptz/discord.py/blob/18fe2035ef33b9bbaa2f8504c787a40bdaf247fe/discord/ext/commands/bot.py#L590-L592 resulting in the `AttributeError`:\r\n```\r\nTraceback (most recent call last):\r\n  File \"C:\\Program Files\\Python37\\lib\\site-packages\\discord\\ext\\commands\\bot.py\", line 595, in _load_from_module_spec\r\n    spec.loader.exec_module(lib)\r\n  File \"<frozen importlib._bootstrap_external>\", line 728, in exec_module\r\n  File \"<frozen importlib._bootstrap>\", line 219, in _call_with_frames_removed\r\n  File \"C:\\Users\\User\\Desktop\\Test_Bot\\cogs\\test.py\", line 2, in <module>\r\n    import testing\r\nModuleNotFoundError: No module named 'testing'\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"C:\\Program Files\\Python37\\lib\\site-packages\\discord\\ext\\commands\\bot.py\", line 727, in reload_extension\r\n    self.load_extension(name)\r\n  File \"C:\\Program Files\\Python37\\lib\\site-packages\\discord\\ext\\commands\\bot.py\", line 652, in load_extension\r\n    self._load_from_module_spec(spec, name)\r\n  File \"C:\\Program Files\\Python37\\lib\\site-packages\\discord\\ext\\commands\\bot.py\", line 598, in _load_from_module_spec\r\n    raise errors.ExtensionFailed(key, e) from e\r\ndiscord.ext.commands.errors.ExtensionFailed: Extension 'cogs.test' raised an error: ModuleNotFoundError: No module named 'testing'\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"C:\\Program Files\\Python37\\lib\\site-packages\\discord\\ext\\commands\\core.py\", line 79, in wrapped\r\n    ret = await coro(*args, **kwargs)\r\n  File \"C:\\Users\\User\\Desktop\\Test_Bot\\test_bot.py\", line 71, in reload\r\n    ctx.bot.reload_extension(\"cogs.\" + cog)\r\n  File \"C:\\Program Files\\Python37\\lib\\site-packages\\discord\\ext\\commands\\bot.py\", line 732, in reload_extension\r\n    self._load_from_module_spec(lib, name)\r\n  File \"C:\\Program Files\\Python37\\lib\\site-packages\\discord\\ext\\commands\\bot.py\", line 592, in _load_from_module_spec\r\n    lib = importlib.util.module_from_spec(spec)\r\n  File \"<frozen importlib._bootstrap>\", line 580, in module_from_spec\r\nAttributeError: module 'cogs.test' has no attribute 'loader'\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"C:\\Program Files\\Python37\\lib\\site-packages\\discord\\ext\\commands\\bot.py\", line 890, in invoke\r\n    await ctx.command.invoke(ctx)\r\n  File \"C:\\Program Files\\Python37\\lib\\site-packages\\discord\\ext\\commands\\core.py\", line 728, in invoke\r\n    await injected(*ctx.args, **ctx.kwargs)\r\n  File \"C:\\Program Files\\Python37\\lib\\site-packages\\discord\\ext\\commands\\core.py\", line 88, in wrapped\r\n    raise CommandInvokeError(exc) from exc\r\ndiscord.ext.commands.errors.CommandInvokeError: Command raised an exception: AttributeError: module 'cogs.test' has no attribute 'loader'\r\n```\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [N/A] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n\r\n- Python v3.7.3-final\r\n- discord.py v1.2.3-final (https://github.com/Rapptz/discord.py/commit/18fe2035ef33b9bbaa2f8504c787a40bdaf247fe)\r\n- aiohttp v3.5.4\r\n- websockets v8.0.1\r\n- system info: Windows 7 6.1.7601\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2291/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2291/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2253", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2253/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2253/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2253/events", "html_url": "https://github.com/Rapptz/discord.py/issues/2253", "id": 462370866, "node_id": "MDU6SXNzdWU0NjIzNzA4NjY=", "number": 2253, "title": "[Commands] Using a typing.Optional[] converter in a commands.Greedy[] one", "user": {"login": "jschmitz3141", "id": 52333680, "node_id": "MDQ6VXNlcjUyMzMzNjgw", "avatar_url": "https://avatars.githubusercontent.com/u/52333680?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jschmitz3141", "html_url": "https://github.com/jschmitz3141", "followers_url": "https://api.github.com/users/jschmitz3141/followers", "following_url": "https://api.github.com/users/jschmitz3141/following{/other_user}", "gists_url": "https://api.github.com/users/jschmitz3141/gists{/gist_id}", "starred_url": "https://api.github.com/users/jschmitz3141/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jschmitz3141/subscriptions", "organizations_url": "https://api.github.com/users/jschmitz3141/orgs", "repos_url": "https://api.github.com/users/jschmitz3141/repos", "events_url": "https://api.github.com/users/jschmitz3141/events{/privacy}", "received_events_url": "https://api.github.com/users/jschmitz3141/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-06-30T05:57:05Z", "updated_at": "2020-06-28T07:54:35Z", "closed_at": "2020-06-28T07:54:35Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nI tried making a command with an argument like\r\n`cmd(ctx, arg: commands.Greedy[typing.Optional[int]])`\r\n(actual command and types not shown, but they work on their own)\r\nHowever, the bot gets stuck in an infinite loop in Command._transform_greedy_pos().\r\n\r\n### Reproduction Steps\r\n\r\nI had a typing.optional[] type in a command's commands.Greedy[] converter. Similar to\r\n`cmd(ctx, arg: commands.Greedy[typing.Optional[int]])`\r\n\r\n### Expected Results\r\n\r\nFor this example, if I had a command like\r\n`>command str 1 2 str 3`\r\narg would be passed a value of\r\n`[None, 1, 2, None, 3]`\r\nsince the strings would get converted to `None` under the typing.Optional converter\r\n\r\n### Actual Results\r\n\r\nThe bot is stuck in an infinite loop between lines 460-476 of core.py, in Command._transform_greedy_pos() at the loop 'while not view.eof'\r\n\r\n\r\n### Checklist\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [ ] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n\r\n```\r\n- Python v3.6.8-final\r\n- discord.py v1.2.3-final\r\n- aiohttp v3.5.4\r\n- websockets v6.0\r\n- system info: Windows 10 10.0.17134\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2253/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2253/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2192", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2192/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2192/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2192/events", "html_url": "https://github.com/Rapptz/discord.py/issues/2192", "id": 450282637, "node_id": "MDU6SXNzdWU0NTAyODI2Mzc=", "number": 2192, "title": "Pins endpoint has incorrect bucket", "user": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 397573646, "node_id": "MDU6TGFiZWwzOTc1NzM2NDY=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/discord%20bug", "name": "discord bug", "color": "5319e7", "default": false, "description": "This is a Discord bug, not one with the library."}], "state": "closed", "locked": false, "assignee": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/7", "html_url": "https://github.com/Rapptz/discord.py/milestone/7", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/7/labels", "id": 4299004, "node_id": "MDk6TWlsZXN0b25lNDI5OTAwNA==", "number": 7, "title": "v1.2", "description": "", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 18, "state": "closed", "created_at": "2019-05-09T09:51:45Z", "updated_at": "2019-06-09T04:43:02Z", "due_on": null, "closed_at": "2019-06-09T04:43:02Z"}, "comments": 1, "created_at": "2019-05-30T12:28:03Z", "updated_at": "2019-06-07T02:45:05Z", "closed_at": "2019-06-07T02:45:04Z", "author_association": "OWNER", "active_lock_reason": null, "body": "Apparently Discord lies and places it on a guild_id bucket rather than the channel_id bucket that it should have. \n\nLogs: https://hastebin.com/ufizobihup.bash (thanks to Pantsu)", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2192/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2192/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2142", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2142/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2142/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2142/events", "html_url": "https://github.com/Rapptz/discord.py/issues/2142", "id": 442704733, "node_id": "MDU6SXNzdWU0NDI3MDQ3MzM=", "number": 2142, "title": "Invalid behaviour of role position updates", "user": {"login": "Fogapod", "id": 22667809, "node_id": "MDQ6VXNlcjIyNjY3ODA5", "avatar_url": "https://avatars.githubusercontent.com/u/22667809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Fogapod", "html_url": "https://github.com/Fogapod", "followers_url": "https://api.github.com/users/Fogapod/followers", "following_url": "https://api.github.com/users/Fogapod/following{/other_user}", "gists_url": "https://api.github.com/users/Fogapod/gists{/gist_id}", "starred_url": "https://api.github.com/users/Fogapod/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Fogapod/subscriptions", "organizations_url": "https://api.github.com/users/Fogapod/orgs", "repos_url": "https://api.github.com/users/Fogapod/repos", "events_url": "https://api.github.com/users/Fogapod/events{/privacy}", "received_events_url": "https://api.github.com/users/Fogapod/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-05-10T12:52:46Z", "updated_at": "2020-09-10T00:13:56Z", "closed_at": "2020-09-10T00:13:55Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\r\n\r\nI create 10-15 roles with my command and place them below author's top role.\r\nThe problem is the order is broken. 20-30% of roles remain at the bottom.\r\n\r\n### Reproduction Steps\r\n\r\nThe following code reproduces issue in 90% of the time for me\r\n```\r\ninsert_pos = ctx.author.top_role.position - 1\r\n\r\nfor i in range(10):\r\n  created = await ctx.guild.create_role(name=str(i))\r\n  await created.edit(position=insert_pos)\r\n```\r\n\r\n### Expected Results\r\n\r\nRoles to be placed in the following order: `[..., top_role, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, ...]`\r\n\r\n### Actual Results\r\n\r\nRoles are placed in the following order: `[..., top_role, 0, 1, 3, 4, 5, 6, 8, 9, ..., 2, 7, @everyone]`\r\n(order is random all the time)\r\n\r\n### Checklist\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n\r\n- discord.py version: 1.0.1\r\n- Python version: 3.7.3\r\n- Operating system: Manjaro Linux x86_64\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2142/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2142/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2140", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2140/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2140/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2140/events", "html_url": "https://github.com/Rapptz/discord.py/issues/2140", "id": 441508811, "node_id": "MDU6SXNzdWU0NDE1MDg4MTE=", "number": 2140, "title": "Webhook retry mechanic bug", "user": {"login": "Werseter", "id": 15786037, "node_id": "MDQ6VXNlcjE1Nzg2MDM3", "avatar_url": "https://avatars.githubusercontent.com/u/15786037?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Werseter", "html_url": "https://github.com/Werseter", "followers_url": "https://api.github.com/users/Werseter/followers", "following_url": "https://api.github.com/users/Werseter/following{/other_user}", "gists_url": "https://api.github.com/users/Werseter/gists{/gist_id}", "starred_url": "https://api.github.com/users/Werseter/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Werseter/subscriptions", "organizations_url": "https://api.github.com/users/Werseter/orgs", "repos_url": "https://api.github.com/users/Werseter/repos", "events_url": "https://api.github.com/users/Werseter/events{/privacy}", "received_events_url": "https://api.github.com/users/Werseter/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/7", "html_url": "https://github.com/Rapptz/discord.py/milestone/7", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/7/labels", "id": 4299004, "node_id": "MDk6TWlsZXN0b25lNDI5OTAwNA==", "number": 7, "title": "v1.2", "description": "", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 18, "state": "closed", "created_at": "2019-05-09T09:51:45Z", "updated_at": "2019-06-09T04:43:02Z", "due_on": null, "closed_at": "2019-06-09T04:43:02Z"}, "comments": 3, "created_at": "2019-05-08T01:19:37Z", "updated_at": "2019-05-11T01:00:38Z", "closed_at": "2019-05-11T01:00:38Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nCurrently, the mechanic allowing multiple attempts to send a webhook mechanic has a bug, that overwrites the request data with the response, rendering every attempt latter than the first one to send an incorrect request.\r\n\r\n### Reproduction Steps\r\n\r\nFor example, sending executing multiple webhooks executions in short succession, triggering ratelimiting asynchronous sleep period.\r\n\r\n### Expected Results\r\n\r\nWe are supposed to still send the same request we tried to send prior to retrying.\r\n\r\n### Actual Results\r\n\r\nServer response is fed back. This can cause multitude of errors, i.e 'Cannot send an empty message' due to last response from 'X-Ratelimit-Remaining' being empty prior to continuing.\r\n\r\n### Checklist\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [ ] I have shown the entire traceback, if possible.\r\n- [ ] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n\r\n- discord.py version: latest commit 792b318 (running from source)\r\n- Python version: Python 3.6\r\n- Operating system: Windows 8.1\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2140/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2140/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2130", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2130/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2130/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2130/events", "html_url": "https://github.com/Rapptz/discord.py/issues/2130", "id": 439058060, "node_id": "MDU6SXNzdWU0MzkwNTgwNjA=", "number": 2130, "title": "Internal state doesn't handle being kicked from voice, resulting in infinite reconnections upon connecting back to the channel", "user": {"login": "slice", "id": 4206232, "node_id": "MDQ6VXNlcjQyMDYyMzI=", "avatar_url": "https://avatars.githubusercontent.com/u/4206232?v=4", "gravatar_id": "", "url": "https://api.github.com/users/slice", "html_url": "https://github.com/slice", "followers_url": "https://api.github.com/users/slice/followers", "following_url": "https://api.github.com/users/slice/following{/other_user}", "gists_url": "https://api.github.com/users/slice/gists{/gist_id}", "starred_url": "https://api.github.com/users/slice/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/slice/subscriptions", "organizations_url": "https://api.github.com/users/slice/orgs", "repos_url": "https://api.github.com/users/slice/repos", "events_url": "https://api.github.com/users/slice/events{/privacy}", "received_events_url": "https://api.github.com/users/slice/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 397573646, "node_id": "MDU6TGFiZWwzOTc1NzM2NDY=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/discord%20bug", "name": "discord bug", "color": "5319e7", "default": false, "description": "This is a Discord bug, not one with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/6", "html_url": "https://github.com/Rapptz/discord.py/milestone/6", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/6/labels", "id": 4215832, "node_id": "MDk6TWlsZXN0b25lNDIxNTgzMg==", "number": 6, "title": "v1.1", "description": "", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 25, "state": "closed", "created_at": "2019-04-10T01:58:39Z", "updated_at": "2019-05-14T00:29:41Z", "due_on": null, "closed_at": "2019-05-14T00:29:41Z"}, "comments": 3, "created_at": "2019-05-01T03:30:12Z", "updated_at": "2019-05-09T10:13:10Z", "closed_at": "2019-05-09T10:13:10Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\r\n\r\nThe library doesn't handle being kicked from voice very well. The only indication sent by Discord that you have been kicked is a self-referencial `VOICE_STATE_UPDATE` with `\"channel_id\": null` sent through the main WS. Nothing appears to be sent from the voice WS.\r\n\r\n<details>\r\n  <summary><b>Running the command to kick itself</b></summary>\r\n<pre><code>[2019-04-30 20:24:34] [DEBUG] discord.gateway: For Shard ID None: WebSocket Event: {'t': 'MESSAGE_CREATE', 's': 9, 'op': 0, 'd': {'type': 0, 'tts': False, 'timestamp': '...', 'pinned': False, 'nonce': '...', 'mentions': [], 'mention_roles': [], 'mention_everyone': False, 'member': {'roles': [], 'nick': None, 'mute': False, 'joined_at': '...', 'deaf': False}, 'id': '...', 'embeds': [], 'edited_timestamp': None, 'content': 'd_jsk py await _guild.me.move_to(None)', 'channel_id': '...', 'author': {'username': 'slice', 'id': '...', 'discriminator': '0001', 'avatar': '...'}, 'attachments': [], 'guild_id': '...'}}\r\n[2019-04-30 20:24:34] [DEBUG] discord.client: Dispatching event socket_response\r\n[2019-04-30 20:24:34] [DEBUG] discord.client: Dispatching event message\r\n[2019-04-30 20:24:34] [DEBUG] discord.client: Dispatching event command\r\n[2019-04-30 20:24:34] [DEBUG] discord.http: PATCH https://discordapp.com/api/v7/guilds/.../members/... with {\"channel_id\":null} has returned 204\r\n[2019-04-30 20:24:34] [DEBUG] discord.http: PATCH https://discordapp.com/api/v7/guilds/.../members/... has received</code></pre>\r\n</details>\r\n\r\n<details>\r\n<summary><b>Websocket data received upon being kicked</b></summary>\r\n<pre><code>[2019-04-30 20:24:34] [DEBUG] websockets.protocol: client < Frame(fin=True, opcode=2, data=b'...', rsv1=False, rsv2=False, rsv3=False)\r\n[2019-04-30 20:24:34] [DEBUG] discord.client: Dispatching event socket_raw_receive\r\n[2019-04-30 20:24:34] [DEBUG] discord.gateway: For Shard ID None: WebSocket Event: {'t': 'VOICE_STATE_UPDATE', 's': 10, 'op': 0, 'd': {'member': {'user': {'username': '...', 'id': '...', 'discriminator': '...', 'bot': True, 'avatar': '...'}, 'roles': ['...'], 'nick': None, 'mute': False, 'joined_at': '...', 'deaf': False}, 'user_id': '...', 'suppress': False, 'session_id': '...', 'self_video': False, 'self_mute': False, 'self_deaf': False, 'mute': False, 'guild_id': '...', 'deaf': False, 'channel_id': None}}\r\n[2019-04-30 20:24:34] [DEBUG] discord.client: Dispatching event socket_response\r\n[2019-04-30 20:24:34] [DEBUG] discord.client: Dispatching event voice_state_update\r\n[2019-04-30 20:24:35] [DEBUG] websockets.protocol: client < Frame(fin=True, opcode=2, data=b'...', rsv1=False, rsv2=False, rsv3=False)</code></pre>\r\n</details>\r\n\r\nUpon being kicked, the voice WS remains alive, and pings are sent as normal. It appears that the lib doesn't update its internal state; it doesn't seem to notice that it was kicked. Upon having the bot connect again once kicked, the bot immediately gets closed with `4000`:\r\n\r\n<details>\r\n  <summary><b>Upon reconnecting after being kicked</b></summary>\r\n<pre><code>[2019-04-30 20:24:38] [DEBUG] websockets.protocol: client - state = CLOSING\r\n[2019-04-30 20:24:38] [DEBUG] websockets.protocol: client > Frame(fin=True, opcode=8, data=b'\\x0f\\xa0', rsv1=False, rsv2=False, rsv3=False)\r\n[2019-04-30 20:24:39] [DEBUG] websockets.protocol: client - event = eof_received()\r\n[2019-04-30 20:24:39] [DEBUG] websockets.protocol: client < Frame(fin=True, opcode=8, data=b'\\x0f\\xa0', rsv1=False, rsv2=False, rsv3=False)\r\n[2019-04-30 20:24:39] [DEBUG] websockets.protocol: client - event = connection_lost(None)\r\n[2019-04-30 20:24:39] [DEBUG] websockets.protocol: client - state = CLOSED\r\n[2019-04-30 20:24:39] [DEBUG] websockets.protocol: client x code = 4000, reason = [empty]\r\n[2019-04-30 20:24:39] [ERROR] discord.voice_client: Disconnected from voice... Reconnecting in 1.54s.\r\nTraceback (most recent call last):\r\n  File \"/Users/slice/Code/lib/discord.py/discord/gateway.py\", line 735, in poll_event\r\n    msg = await asyncio.wait_for(self.recv(), timeout=30.0, loop=self.loop)\r\n  File \"/usr/local/Cellar/python/3.7.3/Frameworks/Python.framework/Versions/3.7/lib/python3.7/asyncio/tasks.py\", line 416, in wait_for\r\n    return fut.result()\r\n  File \"/usr/local/lib/python3.7/site-packages/websockets/protocol.py\", line 350, in recv\r\n    yield from self.ensure_open()\r\n  File \"/usr/local/lib/python3.7/site-packages/websockets/protocol.py\", line 512, in ensure_open\r\n    self.close_code, self.close_reason) from self.transfer_data_exc\r\nwebsockets.exceptions.ConnectionClosed: WebSocket connection is closed: code = 4000 (private use), no reason\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"/Users/slice/Code/lib/discord.py/discord/voice_client.py\", line 242, in poll_voice_ws\r\n    await self.ws.poll_event()\r\n  File \"/Users/slice/Code/lib/discord.py/discord/gateway.py\", line 738, in poll_event\r\n    raise ConnectionClosed(exc, shard_id=None) from exc\r\ndiscord.errors.ConnectionClosed: WebSocket connection is closed: code = 4000 (private use), no reason\r\n[2019-04-30 20:24:39] [DEBUG] websockets.protocol: client x closing TCP connection\r\n</code></pre>\r\n</details>\r\n\r\nFrom here on out it gets stuck in a loop of being closed with `4000` and reconnecting every 30s or so. \r\n\r\n### Reproduction Steps\r\n\r\n- Make the bot connect to voice channel A\r\n- Make the bot kick itself (`await _guild.me.move_to(None)`)\r\n- Make the bot connect to voice channel A again\r\n\r\n### Expected Results\r\n\r\n- The bot closes the voice WS upon being kicked (?)\r\n- The bot doesn't get stuck in a loop after reconnecting to the voice channel \r\n\r\n### Actual Results\r\n\r\n- The bot keeps the voice WS open after being kicked\r\n- Attempting to reconnect to the voice channel results in an infinite loop of code `4000` closes and reconnects\r\n\r\n### Checklist\r\n\r\n<!-- Put an x inside [ ] to check it -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n\r\n- discord.py version: 1.1.0a1919+g91e00d8\r\n- Python version: Python 3.7.3\r\n- Operating system: macOS 10.14\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2130/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2130/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2123", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2123/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2123/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2123/events", "html_url": "https://github.com/Rapptz/discord.py/issues/2123", "id": 438122082, "node_id": "MDU6SXNzdWU0MzgxMjIwODI=", "number": 2123, "title": "HelpCommand implementation subject to race conditions.", "user": {"login": "mikeshardmind", "id": 22035876, "node_id": "MDQ6VXNlcjIyMDM1ODc2", "avatar_url": "https://avatars.githubusercontent.com/u/22035876?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mikeshardmind", "html_url": "https://github.com/mikeshardmind", "followers_url": "https://api.github.com/users/mikeshardmind/followers", "following_url": "https://api.github.com/users/mikeshardmind/following{/other_user}", "gists_url": "https://api.github.com/users/mikeshardmind/gists{/gist_id}", "starred_url": "https://api.github.com/users/mikeshardmind/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mikeshardmind/subscriptions", "organizations_url": "https://api.github.com/users/mikeshardmind/orgs", "repos_url": "https://api.github.com/users/mikeshardmind/repos", "events_url": "https://api.github.com/users/mikeshardmind/events{/privacy}", "received_events_url": "https://api.github.com/users/mikeshardmind/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/6", "html_url": "https://github.com/Rapptz/discord.py/milestone/6", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/6/labels", "id": 4215832, "node_id": "MDk6TWlsZXN0b25lNDIxNTgzMg==", "number": 6, "title": "v1.1", "description": "", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 25, "state": "closed", "created_at": "2019-04-10T01:58:39Z", "updated_at": "2019-05-14T00:29:41Z", "due_on": null, "closed_at": "2019-05-14T00:29:41Z"}, "comments": 1, "created_at": "2019-04-29T01:18:53Z", "updated_at": "2019-05-10T23:45:21Z", "closed_at": "2019-04-29T04:06:10Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\r\n\r\nBy using a single instance of a help command and doing preparation work (including assigning of context) to said single instance while also relying on that in other places , the help formatter is subject to race conditions.\r\n\r\n### Reproduction Steps\r\n\r\nHave a bot under heavy load such that if 2 help commands are issued at the same time, it's possible for results to not end up truly FIFO due to channel based ratelimits. and context switching with asyncio\r\n\r\n### Expected Results\r\n\r\nAll prep work would be kept separate per invoke, including keeping context correct.\r\n\r\n### Actual Results\r\n\r\n\r\n\r\n### Checklist\r\n\r\n- [X] I have searched the open issues for duplicates.\r\n- [X] I have shown the entire traceback, if possible.\r\n- [X] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n\r\n- discord.py version: 1.0.1\r\n- Python version: 3.7.2\r\n- Operating system: Windows, for testing, but can confirm this is not system specific.\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2123/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2123/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2113", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2113/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2113/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2113/events", "html_url": "https://github.com/Rapptz/discord.py/issues/2113", "id": 435782751, "node_id": "MDU6SXNzdWU0MzU3ODI3NTE=", "number": 2113, "title": "Spotify objects with different songs are equal in on_member_update", "user": {"login": "Pao-Lumu", "id": 8527287, "node_id": "MDQ6VXNlcjg1MjcyODc=", "avatar_url": "https://avatars.githubusercontent.com/u/8527287?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Pao-Lumu", "html_url": "https://github.com/Pao-Lumu", "followers_url": "https://api.github.com/users/Pao-Lumu/followers", "following_url": "https://api.github.com/users/Pao-Lumu/following{/other_user}", "gists_url": "https://api.github.com/users/Pao-Lumu/gists{/gist_id}", "starred_url": "https://api.github.com/users/Pao-Lumu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Pao-Lumu/subscriptions", "organizations_url": "https://api.github.com/users/Pao-Lumu/orgs", "repos_url": "https://api.github.com/users/Pao-Lumu/repos", "events_url": "https://api.github.com/users/Pao-Lumu/events{/privacy}", "received_events_url": "https://api.github.com/users/Pao-Lumu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/6", "html_url": "https://github.com/Rapptz/discord.py/milestone/6", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/6/labels", "id": 4215832, "node_id": "MDk6TWlsZXN0b25lNDIxNTgzMg==", "number": 6, "title": "v1.1", "description": "", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 25, "state": "closed", "created_at": "2019-04-10T01:58:39Z", "updated_at": "2019-05-14T00:29:41Z", "due_on": null, "closed_at": "2019-05-14T00:29:41Z"}, "comments": 3, "created_at": "2019-04-22T16:07:41Z", "updated_at": "2019-05-09T10:20:21Z", "closed_at": "2019-05-09T10:20:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\nWhen a song progresses to a different one on Spotify, `on_member_update` is called, but `before == after`, and `before.activities == after.activities`.\r\n\r\nSeems to be caused by [hashing the session id](https://github.com/Rapptz/discord.py/blob/a7f3300821a47c7fc5fb7531ca1a72c3864ca545/discord/activity.py#L500), which doesn't change between songs.\r\n\r\n### Reproduction Steps\r\n```\r\n@bot.event\r\nasync def on_member_update(b,a)\r\n    print(b==a)\r\n    print(b.activities == a.activities)\r\n```\r\n### Expected Results\r\n\r\n#### Output:\r\n`False`\r\n`False`\r\n\r\n### Actual Results\r\n\r\n#### Output:\r\n`True`\r\n`True`\r\n\r\n### Checklist\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] ~I have shown the entire traceback, if possible.~ N/A\r\n- [x] ~I have removed my token from display, if visible.~ N/A\r\n\r\n### System Information\r\n\r\n- discord.py version: 1.0.1\r\n- Python version: 3.7.1\r\n- Operating system: Platform-independent (Tested on Centos 7, Win7/10)\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2113/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2113/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2085", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2085/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2085/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2085/events", "html_url": "https://github.com/Rapptz/discord.py/issues/2085", "id": 433032754, "node_id": "MDU6SXNzdWU0MzMwMzI3NTQ=", "number": 2085, "title": "Pruning on mega-guilds", "user": {"login": "Kowlin", "id": 10947836, "node_id": "MDQ6VXNlcjEwOTQ3ODM2", "avatar_url": "https://avatars.githubusercontent.com/u/10947836?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Kowlin", "html_url": "https://github.com/Kowlin", "followers_url": "https://api.github.com/users/Kowlin/followers", "following_url": "https://api.github.com/users/Kowlin/following{/other_user}", "gists_url": "https://api.github.com/users/Kowlin/gists{/gist_id}", "starred_url": "https://api.github.com/users/Kowlin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Kowlin/subscriptions", "organizations_url": "https://api.github.com/users/Kowlin/orgs", "repos_url": "https://api.github.com/users/Kowlin/repos", "events_url": "https://api.github.com/users/Kowlin/events{/privacy}", "received_events_url": "https://api.github.com/users/Kowlin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/6", "html_url": "https://github.com/Rapptz/discord.py/milestone/6", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/6/labels", "id": 4215832, "node_id": "MDk6TWlsZXN0b25lNDIxNTgzMg==", "number": 6, "title": "v1.1", "description": "", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 25, "state": "closed", "created_at": "2019-04-10T01:58:39Z", "updated_at": "2019-05-14T00:29:41Z", "due_on": null, "closed_at": "2019-05-14T00:29:41Z"}, "comments": 0, "created_at": "2019-04-14T20:57:44Z", "updated_at": "2019-05-10T23:45:04Z", "closed_at": "2019-04-14T21:35:16Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Summary\r\n\r\nI'll be referencing mega-guilds a lot here in this issue, so for our sake consider a mega-guild on Discord a guild with over 200K members.\r\n\r\nThere currently exists an issue on Discord whereby pruning on mega-guilds will take to long that the endpoint will often fail to respond at all, but the prune will still be initiated. This will occur for both the functions ``client.estimate_pruned_members`` and ``client.prune_members`` Discord has addressed this with a new field on the prune endpoint. ([docs](https://discordapp.com/developers/docs/resources/guild#begin-guild-prune)) Which will return ``None`` on the number of members pruned immediately and start the prune. \r\n\r\nHowever, without the use of ``compute_prune_count=False`` the response from Discord will take long enough that the bot will try and initiate another prune until it reaches it maximum retries.\r\n\r\n### Reproduction Steps\r\n\r\n1. Initiate a prune on a mega-guild\r\n2. Discord will not return a response in time\r\n3. The bot will retry to start a prune while in reality one is already on going.\r\n\r\n### System Information\r\n\r\n- discord.py version: Any version of rewrite\r\n- Python version: 3.7\r\n- Operating system: Linux Ubuntu 18.04 LTS\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2085/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2085/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2056", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2056/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2056/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2056/events", "html_url": "https://github.com/Rapptz/discord.py/issues/2056", "id": 430784122, "node_id": "MDU6SXNzdWU0MzA3ODQxMjI=", "number": 2056, "title": "Race condition in voice connection flow", "user": {"login": "imayhaveborkedit", "id": 1907538, "node_id": "MDQ6VXNlcjE5MDc1Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1907538?v=4", "gravatar_id": "", "url": "https://api.github.com/users/imayhaveborkedit", "html_url": "https://github.com/imayhaveborkedit", "followers_url": "https://api.github.com/users/imayhaveborkedit/followers", "following_url": "https://api.github.com/users/imayhaveborkedit/following{/other_user}", "gists_url": "https://api.github.com/users/imayhaveborkedit/gists{/gist_id}", "starred_url": "https://api.github.com/users/imayhaveborkedit/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/imayhaveborkedit/subscriptions", "organizations_url": "https://api.github.com/users/imayhaveborkedit/orgs", "repos_url": "https://api.github.com/users/imayhaveborkedit/repos", "events_url": "https://api.github.com/users/imayhaveborkedit/events{/privacy}", "received_events_url": "https://api.github.com/users/imayhaveborkedit/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2019-04-09T06:11:43Z", "updated_at": "2019-04-10T05:22:39Z", "closed_at": "2019-04-10T05:22:39Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "There was a report of an unusual voice related error.\r\n\r\n```py\r\nTask exception was never retrieved\r\nfuture: <Task finished coro=<VoiceClient._create_socket() done, defined at /usr/local/lib/python3.7/site-packages/discord/voice_client.py:168> exception=AttributeError(\"'NoneType' object has no attribute 'close'\")>\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.7/site-packages/discord/voice_client.py\", line 195, in _create_socket\r\n    await self.ws.close(4000)\r\nAttributeError: 'NoneType' object has no attribute 'close'\r\n```\r\nAt first glance this looks a bit odd and upon further inspection it looks downright peculiar.  Apparently `VoiceClient.ws` is None and something is trying to close it.  How has this happened?  Surely it's not the user since if the user ever got ahold of a VoiceClient it would be properly constructed.  We must dig deeper.\r\n\r\n1. The only time `VoiceClient.ws` is None is between `__init__` and right until `DiscordVoiceWebSocket.from_client` returns in `VoiceClient.connect()`.\r\n2. The error occurred in `VoiceClient._create_socket()`, which is only called by `ConnectionState.parse_voice_server_update()` in state.py,\r\n3. `_create_socket` is where the library opens the voice socket after receiving a `VOICE_SERVER_UPDATE` event, which means **waiting** for discord to send it.\r\n4. `parse_voice_server_update` gets a VoiceClient by key and checks if it exists to call `_create_socket`.\r\n\r\nThis is all happening while the user is trying to create a VoiceClient object via `VoiceChannel.connect()`.  The code for this is:\r\n```py\r\nvoice = VoiceClient(state=state, timeout=timeout, channel=self)\r\nstate._add_voice_client(key_id, voice)\r\ntry:\r\n    await voice.connect(reconnect=reconnect)\r\nexcept asyncio.TimeoutError:\r\n    ...\r\n```\r\nThe issue here is the time between adding the VoiceClient+key and `connect()` returning.  It's during `VoiceClient.connect()` that `VoiceClient.ws` is set, but *not before the handshake is complete*.  The handshake is complete when `VoiceClient._create_socket` returns successfully.  The line from the error is the `self.ws.close(4000)` line in `_create_socket`, but this is only run if the handshake event has been set, which is only ever set in this function at the very end.\r\n\r\nFor this error to occur, a VoiceClient needs to be in the process of connecting, before the `ws` attribute has been set, has to have completed the handshake once, and then have another handshake triggered before the waiter in `VoiceClient.start_handshake()` returns and sets the `ws` attribute.\r\n\r\nTo me, this seems like the combination of a *very* close race condition combined with Discord's signature Eventual Consistency\u2122.  A second `VOICE_SERVER_UPDATE` event would have to arrive before the connection flow completed.\r\n\r\nAs for how to fix this, I have two possible ideas at the moment:\r\n1. Add a check for the `ws` attribute before attempting to close it.\r\n2. Add a new Event (or other state object) to indicate the VoiceClient is in the middle of the connection flow and should ignore or defer connection related calls (probably just `_create_socket`) until connecting has finished.\r\n\r\nOnce I do some testing to see if I can reproduce this I will see if I can come up with a suitable fix.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2056/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2056/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2035", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2035/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2035/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2035/events", "html_url": "https://github.com/Rapptz/discord.py/issues/2035", "id": 427374219, "node_id": "MDU6SXNzdWU0MjczNzQyMTk=", "number": 2035, "title": "Cloudflare bans not properly parsed", "user": {"login": "thecaralice", "id": 43097806, "node_id": "MDQ6VXNlcjQzMDk3ODA2", "avatar_url": "https://avatars.githubusercontent.com/u/43097806?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thecaralice", "html_url": "https://github.com/thecaralice", "followers_url": "https://api.github.com/users/thecaralice/followers", "following_url": "https://api.github.com/users/thecaralice/following{/other_user}", "gists_url": "https://api.github.com/users/thecaralice/gists{/gist_id}", "starred_url": "https://api.github.com/users/thecaralice/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thecaralice/subscriptions", "organizations_url": "https://api.github.com/users/thecaralice/orgs", "repos_url": "https://api.github.com/users/thecaralice/repos", "events_url": "https://api.github.com/users/thecaralice/events{/privacy}", "received_events_url": "https://api.github.com/users/thecaralice/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 251130945, "node_id": "MDU6TGFiZWwyNTExMzA5NDU=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/invalid", "name": "invalid", "color": "e6e6e6", "default": true, "description": "This is not right."}, {"id": 511299952, "node_id": "MDU6TGFiZWw1MTEyOTk5NTI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/v1.0-alpha", "name": "v1.0-alpha", "color": "0052cc", "default": false, "description": "This pertains to the rewrite version"}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-03-31T09:00:06Z", "updated_at": "2020-05-13T07:34:01Z", "closed_at": "2019-03-31T09:27:32Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "### Summary\r\n\r\n<!-- A summary of your bug report -->\r\n\r\n### Reproduction Steps\r\n\r\nI added this cog and ran `=start @Some role`\r\n```py\r\nimport asyncio\r\nfrom colorsys import hls_to_rgb\r\n\r\nimport discord\r\nfrom discord.ext import commands\r\n\r\nclass Rainbow(commands.Cog):\r\n    def __init__(self, bot: commands.Bot):\r\n        self.bot = bot\r\n        self.roles = set()\r\n        self.on_low_role = 'Sorry, your role isn\\'t high enough'\r\n        self.step = 7\r\n        self.delay = 0.1\r\n        self.hue = 0\r\n        self.bot.loop.create_task(self.loop())\r\n     \r\n    async def loop(self):\r\n        await self.bot.wait_until_ready()\r\n        while not self.bot.is_closed():\r\n            for i in self.roles:\r\n                #print(i.name, i.colour)\r\n                self.hue = (self.hue + self.step) % 360\r\n                rgb = [int(x * 255) for x in hls_to_rgb(self.hue / 360, 0.5, 1)]\r\n                clr = discord.Colour(((rgb[0] << 16) + (rgb[1] << 8) + rgb[2]))\r\n                await i.edit(colour=clr, reason='Automatic rainbow color change')\r\n            await asyncio.sleep(self.delay)\r\n    \r\n    @commands.command()\r\n    @commands.has_permissions(manage_roles=True)\r\n    async def start(self, ctx: commands.Context, role: discord.Role):\r\n        if ctx.author.top_role > role:\r\n            m: discord.Message = await ctx.send('Starting...')\r\n            self.roles.add(role)\r\n            await m.edit(content='Started!')\r\n        else:\r\n            await ctx.send(self.on_low_role)\r\n    \r\n    @commands.command()\r\n    @commands.has_permissions(manage_roles=True)\r\n    async def stop(self, ctx: commands.Context, role: discord.Role):\r\n        if ctx.author.top_role > role:\r\n            m: discord.Message = await ctx.send('Stopping...')\r\n            try:\r\n                self.roles.remove(role)\r\n            except KeyError:\r\n                await m.edit('This role doesn\\'t rainbowin\\'')\r\n            else:\r\n                await m.edit('Started!')\r\n        else:\r\n            await ctx.send(self.on_low_role)\r\n\r\ndef setup(bot: commands.Bot):\r\n    bot.add_cog(Rainbow(bot))\r\n```\r\n\r\n### Expected Results\r\n\r\nLib should handle normally and wait until rate limit reset\r\n\r\n### Actual Results\r\n\r\n```\r\nTask exception was never retrieved\r\nfuture: <Task finished coro=<Rainbow.loop() done, defined at C:\\Users\\iVan\\Desktop\\Movert\\cogs\\rainbow.py:17> exception=TypeError('string indices must be integers')>\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\iVan\\Desktop\\Movert\\cogs\\rainbow.py\", line 25, in loop\r\n    await i.edit(colour=clr, reason='Automatic rainbow color change')\r\n  File \"C:\\Users\\iVan\\AppData\\Local\\Programs\\Python\\Python37\\lib\\site-packages\\discord\\role.py\", line 259, in edit\r\n    data = await self._state.http.edit_role(self.guild.id, self.id, reason=reason, **payload)\r\n  File \"C:\\Users\\iVan\\AppData\\Local\\Programs\\Python\\Python37\\lib\\site-packages\\discord\\http.py\", line 187, in request\r\n    retry_after = data['retry_after'] / 1000.0\r\nTypeError: string indices must be integers\r\n```\r\n\r\n\r\n### Checklist\r\n\r\n<!-- Put an x inside [ ] to check it -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] I have removed my token from display, if visible.\r\n\r\n### System Information\r\n\r\n- discord.py version: 1.0.0a\r\n- Python version: 3.7.3\r\n- Operating system: Windows 7 Pro\r\n\r\n### Note\r\n\r\nThis issue is about rate limits bug, not about rainbow roles. Rainbow role is just an example, that's why there is 0.1 second as well. And i know they are forbidden.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/2035/reactions", "total_count": 3, "+1": 1, "-1": 1, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 1}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/2035/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1973", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1973/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1973/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1973/events", "html_url": "https://github.com/Rapptz/discord.py/issues/1973", "id": 419242592, "node_id": "MDU6SXNzdWU0MTkyNDI1OTI=", "number": 1973, "title": "Attachment.save() throws HTTPException when used on non-image attachment file with default parameters.", "user": {"login": "xSke", "id": 16242158, "node_id": "MDQ6VXNlcjE2MjQyMTU4", "avatar_url": "https://avatars.githubusercontent.com/u/16242158?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xSke", "html_url": "https://github.com/xSke", "followers_url": "https://api.github.com/users/xSke/followers", "following_url": "https://api.github.com/users/xSke/following{/other_user}", "gists_url": "https://api.github.com/users/xSke/gists{/gist_id}", "starred_url": "https://api.github.com/users/xSke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xSke/subscriptions", "organizations_url": "https://api.github.com/users/xSke/orgs", "repos_url": "https://api.github.com/users/xSke/repos", "events_url": "https://api.github.com/users/xSke/events{/privacy}", "received_events_url": "https://api.github.com/users/xSke/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 511299952, "node_id": "MDU6TGFiZWw1MTEyOTk5NTI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/v1.0-alpha", "name": "v1.0-alpha", "color": "0052cc", "default": false, "description": "This pertains to the rewrite version"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-03-10T22:41:05Z", "updated_at": "2019-03-11T00:12:51Z", "closed_at": "2019-03-11T00:12:51Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\r\n\r\n[This commit](https://github.com/Rapptz/discord.py/commit/aceec2009a7c819d2236884fa9ccc5ce58a92bea) changes the default behaviour of `Attachment.save()` to use the given proxy URL from the message object to fetch the attachment file. This URL is invalid for non-image attachments, and will result in a 415 being returned from the proxy server.\r\n\r\nThe proper default behaviour would either be to use the non-proxy URL to fetch the file if the file isn't an image, or to try the proxy URL first and fall back to the non-proxy URL in case of a 415 being returned.\r\n\r\nA workaround for this is of course to set `use_cached=False`, but it feels wrong to have the default behavior explode on edge cases rather than Do The Right Thing :tm:.\r\n\r\n### Reproduction Steps\r\n\r\n`message.attachments[0].save(\"whatever\")` on a message containing a non-image attachment.\r\n\r\n### Expected Results\r\n\r\nI expect the file to save properly.\r\n\r\n### Actual Results\r\n\r\nThis error gets thrown:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/home/astrid/Projects/PluralKit/venv/lib/python3.6/site-packages/discord/client.py\", line 227, in _run_event\r\n    await coro(*args, **kwargs)\r\n  File \"/home/astrid/Projects/PluralKit/src/pluralkit/bot/__init__.py\", line 84, in on_message\r\n    did_run_command = await commands.command_dispatch(client, message, conn)\r\n  File \"/home/astrid/Projects/PluralKit/src/pluralkit/bot/commands/__init__.py\", line 237, in command_dispatch\r\n    await run_command(ctx, command_root)\r\n  File \"/home/astrid/Projects/PluralKit/src/pluralkit/bot/commands/__init__.py\", line 214, in run_command\r\n    await func(ctx)\r\n  File \"/home/astrid/Projects/PluralKit/src/pluralkit/bot/commands/__init__.py\", line 195, in command_root\r\n    await import_commands.import_root(ctx)\r\n  File \"/home/astrid/Projects/PluralKit/src/pluralkit/bot/commands/import_commands.py\", line 13, in import_root\r\n    await import_tupperbox(ctx)\r\n  File \"/home/astrid/Projects/PluralKit/src/pluralkit/bot/commands/import_commands.py\", line 33, in import_tupperbox\r\n    await message.attachments[0].save(s)\r\n  File \"/home/astrid/Projects/PluralKit/venv/lib/python3.6/site-packages/discord/message.py\", line 114, in save\r\n    data = await self._http.get_attachment(url)\r\n  File \"/home/astrid/Projects/PluralKit/venv/lib/python3.6/site-packages/discord/http.py\", line 228, in get_attachment\r\n    raise HTTPException(resp, 'failed to get attachment')\r\ndiscord.errors.HTTPException: Unsupported Media Type (status code: 415): failed to get attachment\r\n```\r\n\r\n### Checklist\r\n\r\n<!-- Put an x inside [ ] to check it -->\r\n\r\n- [x] I have searched the open issues for duplicates.\r\n- [x] I have shown the entire traceback, if possible.\r\n- [x] have removed my token from display, if visible.\r\n\r\n### System Information\r\n\r\n- discord.py version: https://github.com/Rapptz/discord.py/commit/aceec2009a7c819d2236884fa9ccc5ce58a92bea\r\n- Python version: 3.6\r\n- Operating system: Arch Linux", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1973/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1973/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1954", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1954/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1954/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1954/events", "html_url": "https://github.com/Rapptz/discord.py/issues/1954", "id": 417033178, "node_id": "MDU6SXNzdWU0MTcwMzMxNzg=", "number": 1954, "title": "VoiceClient reconnect lasting when connected voice channel deleted", "user": {"login": "zomysan", "id": 46142035, "node_id": "MDQ6VXNlcjQ2MTQyMDM1", "avatar_url": "https://avatars.githubusercontent.com/u/46142035?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zomysan", "html_url": "https://github.com/zomysan", "followers_url": "https://api.github.com/users/zomysan/followers", "following_url": "https://api.github.com/users/zomysan/following{/other_user}", "gists_url": "https://api.github.com/users/zomysan/gists{/gist_id}", "starred_url": "https://api.github.com/users/zomysan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zomysan/subscriptions", "organizations_url": "https://api.github.com/users/zomysan/orgs", "repos_url": "https://api.github.com/users/zomysan/repos", "events_url": "https://api.github.com/users/zomysan/events{/privacy}", "received_events_url": "https://api.github.com/users/zomysan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 511299952, "node_id": "MDU6TGFiZWw1MTEyOTk5NTI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/v1.0-alpha", "name": "v1.0-alpha", "color": "0052cc", "default": false, "description": "This pertains to the rewrite version"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2019-03-04T23:02:41Z", "updated_at": "2019-03-28T08:57:51Z", "closed_at": "2019-03-06T10:45:23Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "When voice channel deleted, voice client keep tring to reconnect.\r\n`disconnect(force=True)` did not work.\r\n\r\nIt occurs when these conditions are met.\r\n- User removed voice channel that the bot connected in web browser UI.\r\n- When voice channel deleted, connected user is the bot only.\r\nIf Other user was in the channel, `disconnect(force=True)` worked.\r\n\r\n```\r\n03/05 07:57:58 [WARNING ] discord.voice_client( 252) : Could not connect to voice... Retrying...\r\n03/05 07:57:58 [ERROR   ] discord.voice_client( 244) : Disconnected from voice... Reconnecting in 0.79s.\r\nTraceback (most recent call last):\r\n  File \"/path/to/project/venv/lib/python3.6/site-packages/discord/gateway.py\", line 730, in poll_event\r\n    msg = await asyncio.wait_for(self.recv(), timeout=30.0, loop=self.loop)\r\n  File \"/usr/lib/python3.6/asyncio/tasks.py\", line 358, in wait_for\r\n    return fut.result()\r\n  File \"/path/to/project/venv/lib/python3.6/site-packages/websockets/protocol.py\", line 350, in recv\r\n    yield from self.ensure_open()\r\n  File \"/path/to/project/venv/lib/python3.6/site-packages/websockets/protocol.py\", line 501, in ensure_open\r\n    self.close_code, self.close_reason) from self.transfer_data_exc\r\nwebsockets.exceptions.ConnectionClosed: WebSocket connection is closed: code = 4014 (private use), reason = Disconnected.\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"/path/to/project/venv/lib/python3.6/site-packages/discord/voice_client.py\", line 232, in poll_voice_ws\r\n    await self.ws.poll_event()\r\n  File \"/path/to/project/venv/lib/python3.6/site-packages/discord/gateway.py\", line 733, in poll_event\r\n    raise ConnectionClosed(exc, shard_id=None) from exc\r\ndiscord.errors.ConnectionClosed: WebSocket connection is closed: code = 4014 (private use), reason = Disconnected.\r\n03/05 07:58:03 [WARNING ] discord.voice_client( 252) : Could not connect to voice... Retrying...\r\n03/05 07:58:03 [ERROR   ] discord.voice_client( 244) : Disconnected from voice... Reconnecting in 222.28s.\r\nTraceback (most recent call last):\r\n  File \"/path/to/project/venv/lib/python3.6/site-packages/discord/gateway.py\", line 730, in poll_event\r\n    msg = await asyncio.wait_for(self.recv(), timeout=30.0, loop=self.loop)\r\n  File \"/usr/lib/python3.6/asyncio/tasks.py\", line 358, in wait_for\r\n    return fut.result()\r\n  File \"/path/to/project/venv/lib/python3.6/site-packages/websockets/protocol.py\", line 350, in recv\r\n    yield from self.ensure_open()\r\n  File \"/path/to/project/venv/lib/python3.6/site-packages/websockets/protocol.py\", line 501, in ensure_open\r\n    self.close_code, self.close_reason) from self.transfer_data_exc\r\nwebsockets.exceptions.ConnectionClosed: WebSocket connection is closed: code = 4014 (private use), reason = Disconnected.\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"/path/to/project/venv/lib/python3.6/site-packages/discord/voice_client.py\", line 232, in poll_voice_ws\r\n    await self.ws.poll_event()\r\n  File \"/path/to/project/venv/lib/python3.6/site-packages/discord/gateway.py\", line 733, in poll_event\r\n    raise ConnectionClosed(exc, shard_id=None) from exc\r\ndiscord.errors.ConnectionClosed: WebSocket connection is closed: code = 4014 (private use), reason = Disconnected.\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1954/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1954/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1951", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1951/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1951/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1951/events", "html_url": "https://github.com/Rapptz/discord.py/issues/1951", "id": 416479875, "node_id": "MDU6SXNzdWU0MTY0Nzk4NzU=", "number": 1951, "title": "[rewrite] commands.Greedy incompatble with typing.Union", "user": {"login": "mikeshardmind", "id": 22035876, "node_id": "MDQ6VXNlcjIyMDM1ODc2", "avatar_url": "https://avatars.githubusercontent.com/u/22035876?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mikeshardmind", "html_url": "https://github.com/mikeshardmind", "followers_url": "https://api.github.com/users/mikeshardmind/followers", "following_url": "https://api.github.com/users/mikeshardmind/following{/other_user}", "gists_url": "https://api.github.com/users/mikeshardmind/gists{/gist_id}", "starred_url": "https://api.github.com/users/mikeshardmind/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mikeshardmind/subscriptions", "organizations_url": "https://api.github.com/users/mikeshardmind/orgs", "repos_url": "https://api.github.com/users/mikeshardmind/repos", "events_url": "https://api.github.com/users/mikeshardmind/events{/privacy}", "received_events_url": "https://api.github.com/users/mikeshardmind/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 511299952, "node_id": "MDU6TGFiZWw1MTEyOTk5NTI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/v1.0-alpha", "name": "v1.0-alpha", "color": "0052cc", "default": false, "description": "This pertains to the rewrite version"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5", "html_url": "https://github.com/Rapptz/discord.py/milestone/5", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5/labels", "id": 1941273, "node_id": "MDk6TWlsZXN0b25lMTk0MTI3Mw==", "number": 5, "title": "Rewrite", "description": "Things that will be taken care of before rewrite releases.", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 58, "state": "closed", "created_at": "2016-08-14T22:10:38Z", "updated_at": "2020-06-28T06:46:14Z", "due_on": null, "closed_at": "2019-04-10T01:57:54Z"}, "comments": 0, "created_at": "2019-03-03T05:58:44Z", "updated_at": "2019-03-03T11:43:41Z", "closed_at": "2019-03-03T11:43:31Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Mostly self explanatory,\r\n\r\nexample typehint where this fails:\r\n\r\n```py\r\nusers: commands.Greedy[Union[discord.Member, int]]\r\n```\r\n\r\nerror:\r\n```\r\nraise TypeError('Greedy[...] expects a type or a Converter instance.')\r\n```\r\n\r\n<details>\r\n  <summary>A trivial example of the failure</summary>\r\n\r\n```py\r\nimport io\r\nimport os\r\nimport contextlib\r\nfrom typing import Optional, Union\r\nimport discord\r\nfrom discord.ext import commands\r\nfrom discord.voice_client import VoiceClient\r\nVoiceClient.warn_nacl = False\r\n\r\nbot = commands.Bot(command_prefix=commands.when_mentioned, description=\"Union converter example\")\r\n\r\ndef snowflake(arg: str) -> int:\r\n    if arg.isdecimal() and 16 < len(arg) < 24:\r\n        return int(arg)\r\n    raise commands.BadArgument()\r\n\r\ndef days(arg: str) -> int:\r\n    with contextlib.suppress(Exception):\r\n        i = int(arg)\r\n        if 0 <= i <= 7:\r\n            return i\r\n    raise commands.BadArgument()\r\n\r\n@commands.bot_has_permissions(ban_members=True, attach_files=True, send_messages=True)\r\n@commands.guild_only()\r\n@bot.command()\r\nasync def ban(\r\n    ctx: commands.Context,\r\n    users: commands.Greedy[Union[discord.Member, snowflake]],\r\n    delete_days: Optional[days] = 0,\r\n    *,\r\n    reason: str = None,\r\n):\r\n    \"\"\"\r\n    Ban users\r\n    \"\"\"\r\n\r\n    bot = ctx.guild.me\r\n    author = ctx.author\r\n\r\n    results = []\r\n\r\n    reason = reason or f\"Ban issued by ({author.id}){author}\"\r\n\r\n    for u in users:\r\n        if isinstance(u, discord.Member):\r\n            if u == ctx.guild.owner:\r\n                results.append(f\"Did not attempt to ban {u}: Cannot ban guild owner.\")\r\n                continue\r\n            if bot.top_role <= u.top_role or author.top_role <= u.top_role:\r\n                results.append(f\"Did not attempt to ban {u}: Cannot ban due to hierarchy.\")\r\n                continue\r\n            user = u\r\n        else:\r\n            user = discord.Object(id=u)\r\n        try:\r\n            await ctx.guild.ban(user=user, delete_message_days=delete_days, reason=reason)\r\n        except discord.HTTPException as exc:\r\n            results.append(f\"Failed to ban {u}: {type(exc)}: {exc.status}\")\r\n        else:\r\n            results.append(f\"Banned user: {u!r}\")\r\n    \r\n    out = \"\\n\".join(results).encode('utf-8')\r\n    data = io.BytesIO(out)\r\n    data.seek(0)\r\n    f = discord.File(data, filename=f\"ban-results-{ctx.message.id}.log\")\r\n    await ctx.send(file=f)\r\n\r\ntry:\r\n    bot.run(os.environ.get(\"TOKEN\"))\r\nexcept KeyboardInterrupt:\r\n    print(\"Closing session...\")\r\nfinally:\r\n    bot.close()\r\n\r\n```\r\n</details>", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1951/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1951/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1939", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1939/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1939/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1939/events", "html_url": "https://github.com/Rapptz/discord.py/issues/1939", "id": 415256631, "node_id": "MDU6SXNzdWU0MTUyNTY2MzE=", "number": 1939, "title": "[ReWrite] commands.Greedy don't accept converters instance", "user": {"login": "paris-ci", "id": 3063324, "node_id": "MDQ6VXNlcjMwNjMzMjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3063324?v=4", "gravatar_id": "", "url": "https://api.github.com/users/paris-ci", "html_url": "https://github.com/paris-ci", "followers_url": "https://api.github.com/users/paris-ci/followers", "following_url": "https://api.github.com/users/paris-ci/following{/other_user}", "gists_url": "https://api.github.com/users/paris-ci/gists{/gist_id}", "starred_url": "https://api.github.com/users/paris-ci/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/paris-ci/subscriptions", "organizations_url": "https://api.github.com/users/paris-ci/orgs", "repos_url": "https://api.github.com/users/paris-ci/repos", "events_url": "https://api.github.com/users/paris-ci/events{/privacy}", "received_events_url": "https://api.github.com/users/paris-ci/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 511299952, "node_id": "MDU6TGFiZWw1MTEyOTk5NTI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/v1.0-alpha", "name": "v1.0-alpha", "color": "0052cc", "default": false, "description": "This pertains to the rewrite version"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5", "html_url": "https://github.com/Rapptz/discord.py/milestone/5", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5/labels", "id": 1941273, "node_id": "MDk6TWlsZXN0b25lMTk0MTI3Mw==", "number": 5, "title": "Rewrite", "description": "Things that will be taken care of before rewrite releases.", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 58, "state": "closed", "created_at": "2016-08-14T22:10:38Z", "updated_at": "2020-06-28T06:46:14Z", "due_on": null, "closed_at": "2019-04-10T01:57:54Z"}, "comments": 1, "created_at": "2019-02-27T18:06:11Z", "updated_at": "2019-02-28T02:50:52Z", "closed_at": "2019-02-28T02:50:52Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I have a converter that, like commends.clean_content, takes arguments. How can I pass it to commands.Greedy (with arguments of course)?\r\n\r\nNotice how I try to use `ForcedMember`, my custom converter, that accept the may_be_banned argument, to `commands.Greedy` below\r\n\r\n- `async def ban(self, ctx, users: commands.Greedy[ForcedMember](may_be_banned=False), *, reason: commands.clean_content(fix_channel_mentions=True, use_nicknames=False) = None):`\r\n\r\n**TypeError: '_Greedy' object is not callable**\r\n\r\n- `async def ban(self, ctx, users: commands.Greedy[ForcedMember(may_be_banned=False)], *, reason: commands.clean_content(fix_channel_mentions=True, use_nicknames=False) = None):`\r\n\r\n**TypeError: Greedy[...] expects a type.**\r\n\r\nIt's probably because `Greedy` only accept classes, given this: https://github.com/Rapptz/discord.py/blob/rewrite/discord/ext/commands/converter.py#L503", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1939/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1939/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1933", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1933/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1933/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1933/events", "html_url": "https://github.com/Rapptz/discord.py/issues/1933", "id": 414611538, "node_id": "MDU6SXNzdWU0MTQ2MTE1Mzg=", "number": 1933, "title": "Emoji is unhashable", "user": {"login": "nguuuquaaa", "id": 12592742, "node_id": "MDQ6VXNlcjEyNTkyNzQy", "avatar_url": "https://avatars.githubusercontent.com/u/12592742?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nguuuquaaa", "html_url": "https://github.com/nguuuquaaa", "followers_url": "https://api.github.com/users/nguuuquaaa/followers", "following_url": "https://api.github.com/users/nguuuquaaa/following{/other_user}", "gists_url": "https://api.github.com/users/nguuuquaaa/gists{/gist_id}", "starred_url": "https://api.github.com/users/nguuuquaaa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nguuuquaaa/subscriptions", "organizations_url": "https://api.github.com/users/nguuuquaaa/orgs", "repos_url": "https://api.github.com/users/nguuuquaaa/repos", "events_url": "https://api.github.com/users/nguuuquaaa/events{/privacy}", "received_events_url": "https://api.github.com/users/nguuuquaaa/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 511299952, "node_id": "MDU6TGFiZWw1MTEyOTk5NTI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/v1.0-alpha", "name": "v1.0-alpha", "color": "0052cc", "default": false, "description": "This pertains to the rewrite version"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-02-26T13:29:10Z", "updated_at": "2019-02-26T13:47:51Z", "closed_at": "2019-02-26T13:44:40Z", "author_association": "NONE", "active_lock_reason": null, "body": "Title. Even though Emoji is supposed to be inherited from `abc.Hashable`.\r\nAn eval `print(discord.Emoji.__hash__)` spits out `None` and `print(issubclass(discord.Emoji, discord.mixins.Hashable))` gives `True`.\r\nThis happens even before the cog update I think, and doesn't happen in commit b79a53c at least.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1933/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1933/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1927", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1927/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1927/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1927/events", "html_url": "https://github.com/Rapptz/discord.py/issues/1927", "id": 414183840, "node_id": "MDU6SXNzdWU0MTQxODM4NDA=", "number": 1927, "title": "Update __main__.py to match new cog changes. ", "user": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 511299952, "node_id": "MDU6TGFiZWw1MTEyOTk5NTI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/v1.0-alpha", "name": "v1.0-alpha", "color": "0052cc", "default": false, "description": "This pertains to the rewrite version"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5", "html_url": "https://github.com/Rapptz/discord.py/milestone/5", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5/labels", "id": 1941273, "node_id": "MDk6TWlsZXN0b25lMTk0MTI3Mw==", "number": 5, "title": "Rewrite", "description": "Things that will be taken care of before rewrite releases.", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 58, "state": "closed", "created_at": "2016-08-14T22:10:38Z", "updated_at": "2020-06-28T06:46:14Z", "due_on": null, "closed_at": "2019-04-10T01:57:54Z"}, "comments": 0, "created_at": "2019-02-25T16:13:02Z", "updated_at": "2019-02-26T14:19:33Z", "closed_at": "2019-02-26T14:19:33Z", "author_association": "OWNER", "active_lock_reason": null, "body": "During the cog update I forgot to update the entry point script that generates cogs and the like to have the new syntax and design.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1927/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1927/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1920", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1920/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1920/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1920/events", "html_url": "https://github.com/Rapptz/discord.py/issues/1920", "id": 413744771, "node_id": "MDU6SXNzdWU0MTM3NDQ3NzE=", "number": 1920, "title": "[Rewrite] Cog has no attribute '_perms_check'", "user": {"login": "CraftSpider", "id": 13342132, "node_id": "MDQ6VXNlcjEzMzQyMTMy", "avatar_url": "https://avatars.githubusercontent.com/u/13342132?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CraftSpider", "html_url": "https://github.com/CraftSpider", "followers_url": "https://api.github.com/users/CraftSpider/followers", "following_url": "https://api.github.com/users/CraftSpider/following{/other_user}", "gists_url": "https://api.github.com/users/CraftSpider/gists{/gist_id}", "starred_url": "https://api.github.com/users/CraftSpider/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CraftSpider/subscriptions", "organizations_url": "https://api.github.com/users/CraftSpider/orgs", "repos_url": "https://api.github.com/users/CraftSpider/repos", "events_url": "https://api.github.com/users/CraftSpider/events{/privacy}", "received_events_url": "https://api.github.com/users/CraftSpider/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 511299952, "node_id": "MDU6TGFiZWw1MTEyOTk5NTI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/v1.0-alpha", "name": "v1.0-alpha", "color": "0052cc", "default": false, "description": "This pertains to the rewrite version"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2019-02-23T21:47:37Z", "updated_at": "2019-02-24T05:24:43Z", "closed_at": "2019-02-24T05:24:43Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "When attempting to call a command from a cog that is defining `cog_check`, I'm getting this error. The relevant code to set `cog_check` is\r\n```py\r\nclass TalosCog(command.Cog):\r\n    ...\r\n    cog_check = _perms_check\r\n```\r\nAnd _perms_check is defined as\r\n```py\r\ndef _perms_check(self, ctx):\r\n    ...\r\n```", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1920/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1920/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1901", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1901/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1901/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1901/events", "html_url": "https://github.com/Rapptz/discord.py/issues/1901", "id": 410857490, "node_id": "MDU6SXNzdWU0MTA4NTc0OTA=", "number": 1901, "title": "[rewrite] Trailing whitespaces on bytestrings passed into _get_mime_type_for_image", "user": {"login": "MonoHearted", "id": 7800801, "node_id": "MDQ6VXNlcjc4MDA4MDE=", "avatar_url": "https://avatars.githubusercontent.com/u/7800801?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MonoHearted", "html_url": "https://github.com/MonoHearted", "followers_url": "https://api.github.com/users/MonoHearted/followers", "following_url": "https://api.github.com/users/MonoHearted/following{/other_user}", "gists_url": "https://api.github.com/users/MonoHearted/gists{/gist_id}", "starred_url": "https://api.github.com/users/MonoHearted/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MonoHearted/subscriptions", "organizations_url": "https://api.github.com/users/MonoHearted/orgs", "repos_url": "https://api.github.com/users/MonoHearted/repos", "events_url": "https://api.github.com/users/MonoHearted/events{/privacy}", "received_events_url": "https://api.github.com/users/MonoHearted/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 511299952, "node_id": "MDU6TGFiZWw1MTEyOTk5NTI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/v1.0-alpha", "name": "v1.0-alpha", "color": "0052cc", "default": false, "description": "This pertains to the rewrite version"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-02-15T16:54:11Z", "updated_at": "2019-02-23T15:25:42Z", "closed_at": "2019-02-23T15:25:42Z", "author_association": "NONE", "active_lock_reason": null, "body": "I recently ran into an issue regarding an \"invalid\" image when attempting set an avatar. It appears that the read image byte string ends with trailing whitespace (``b' '``). Appending an ``.rstrip(b' ')`` resolves the issue.\r\n\r\nI am unsure how common this issue is; but replacing the existing ``.rstrip(b'\\0')`` with ``.rstrip(b' \\0')`` on line 252 of utils.py would resolve this.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1901/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1901/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1898", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1898/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1898/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1898/events", "html_url": "https://github.com/Rapptz/discord.py/issues/1898", "id": 410006754, "node_id": "MDU6SXNzdWU0MTAwMDY3NTQ=", "number": 1898, "title": "wait=True has a new error", "user": {"login": "XuaTheGrate", "id": 17090652, "node_id": "MDQ6VXNlcjE3MDkwNjUy", "avatar_url": "https://avatars.githubusercontent.com/u/17090652?v=4", "gravatar_id": "", "url": "https://api.github.com/users/XuaTheGrate", "html_url": "https://github.com/XuaTheGrate", "followers_url": "https://api.github.com/users/XuaTheGrate/followers", "following_url": "https://api.github.com/users/XuaTheGrate/following{/other_user}", "gists_url": "https://api.github.com/users/XuaTheGrate/gists{/gist_id}", "starred_url": "https://api.github.com/users/XuaTheGrate/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/XuaTheGrate/subscriptions", "organizations_url": "https://api.github.com/users/XuaTheGrate/orgs", "repos_url": "https://api.github.com/users/XuaTheGrate/repos", "events_url": "https://api.github.com/users/XuaTheGrate/events{/privacy}", "received_events_url": "https://api.github.com/users/XuaTheGrate/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 511299952, "node_id": "MDU6TGFiZWw1MTEyOTk5NTI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/v1.0-alpha", "name": "v1.0-alpha", "color": "0052cc", "default": false, "description": "This pertains to the rewrite version"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5", "html_url": "https://github.com/Rapptz/discord.py/milestone/5", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5/labels", "id": 1941273, "node_id": "MDk6TWlsZXN0b25lMTk0MTI3Mw==", "number": 5, "title": "Rewrite", "description": "Things that will be taken care of before rewrite releases.", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 58, "state": "closed", "created_at": "2016-08-14T22:10:38Z", "updated_at": "2020-06-28T06:46:14Z", "due_on": null, "closed_at": "2019-04-10T01:57:54Z"}, "comments": 1, "created_at": "2019-02-13T21:17:43Z", "updated_at": "2019-03-02T11:15:18Z", "closed_at": "2019-03-02T11:15:18Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Similar to #1242, I get this error when constructing a new webhook like so: (via jishaku)\r\n```python\r\nwh = discord.Webhook.from_url(url, adapter=discord.AsyncWebhookAdapter(_bot.session))\r\nawait wh.send(\"test\", wait=True)\r\n```\r\nWhich now raises the following:\r\n```python\r\nTraceback (most recent call last):\r\n  File \"/home/xua/adventure/venv/lib/python3.6/site-packages/jishaku/cog.py\", line 314, in jsk_python\r\n    async for result in AsyncCodeExecutor(argument.content, scope, arg_dict=arg_dict):\r\n  File \"/home/xua/adventure/venv/lib/python3.6/site-packages/jishaku/repl/compilation.py\", line 160, in traverse\r\n    yield await func(*async_executor.args)\r\n  File \"<repl>\", line 2, in _repl_coroutine\r\n  File \"/home/xua/adventure/venv/lib/python3.6/site-packages/discord/webhook.py\", line 200, in handle_execution_response\r\n    return Message(data=data, state=self.webhook._state, channel=self.webhook.channel)\r\n  File \"/home/xua/adventure/venv/lib/python3.6/site-packages/discord/message.py\", line 216, in __init__\r\n    self._update(channel, data)\r\n  File \"/home/xua/adventure/venv/lib/python3.6/site-packages/discord/message.py\", line 281, in _update\r\n    getattr(self, '_handle_%s' % handler)(data[handler])\r\n  File \"/home/xua/adventure/venv/lib/python3.6/site-packages/discord/message.py\", line 294, in _handle_author\r\n    self.author = self._state.store_user(author)\r\nAttributeError: 'NoneType' object has no attribute 'store_user'\r\n```\r\nI know I am on the latest version (according to pkg_resources, `discord.py 1.0.0a1659+g700dbb5`)\r\nThis doesn't seem to error when fetching the webhook via `channel.webhooks`\r\nAccording to @crrapi, this commit broke it, and reverting it had fixed the problem 33dc3411acb56ddaf86cb16242016ba4918c0d23", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1898/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1898/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1862", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1862/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1862/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1862/events", "html_url": "https://github.com/Rapptz/discord.py/issues/1862", "id": 404979423, "node_id": "MDU6SXNzdWU0MDQ5Nzk0MjM=", "number": 1862, "title": "Unclosed Client Session... have yet to find this answer", "user": {"login": "auscoi", "id": 37675124, "node_id": "MDQ6VXNlcjM3Njc1MTI0", "avatar_url": "https://avatars.githubusercontent.com/u/37675124?v=4", "gravatar_id": "", "url": "https://api.github.com/users/auscoi", "html_url": "https://github.com/auscoi", "followers_url": "https://api.github.com/users/auscoi/followers", "following_url": "https://api.github.com/users/auscoi/following{/other_user}", "gists_url": "https://api.github.com/users/auscoi/gists{/gist_id}", "starred_url": "https://api.github.com/users/auscoi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/auscoi/subscriptions", "organizations_url": "https://api.github.com/users/auscoi/orgs", "repos_url": "https://api.github.com/users/auscoi/repos", "events_url": "https://api.github.com/users/auscoi/events{/privacy}", "received_events_url": "https://api.github.com/users/auscoi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 511299952, "node_id": "MDU6TGFiZWw1MTEyOTk5NTI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/v1.0-alpha", "name": "v1.0-alpha", "color": "0052cc", "default": false, "description": "This pertains to the rewrite version"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-01-30T21:48:32Z", "updated_at": "2019-03-09T22:00:53Z", "closed_at": "2019-03-09T22:00:53Z", "author_association": "NONE", "active_lock_reason": null, "body": "I know this has been asked about before... I've looked and looked and looked. So many people having this issue are simply bad at OOP but I've stripped it down to the bare essentials to see what is causing this issue and I just cannot figure it out. Some more experienced guidance would be HIGHLY appreciated!\r\n\r\nFile to run: **mybot.py**\r\n```python\r\nimport discord\r\nfrom discord.ext import commands\r\nfrom discord.ext.commands import Bot\r\nimport asyncio\r\n\r\nclient = commands.Bot(command_prefix=\"?\")\r\n\r\nclass MyBot():\r\n  def __init__(self, bot):\r\n    bot.load_extension(\"mycog\")\r\n    bot.run(TOKEN, bot=True, reconnect=True)\r\n\r\n  @client.event\r\n  async def on_ready():\r\n    print(\"Bot is listening...\")\r\n\r\n  @client.event\r\n  async def on_message(message):\r\n    await client.process_commands(message)\r\n\r\nif __name__ == \"__main__\": MyBot(client)\r\n```\r\n\r\nFile to load: **mycog.py**\r\n```python\r\nfrom discord.ext import commands\r\nimport asyncio\r\n\r\nclass MyCog:\r\n  def __init__(self, bot):\r\n    self.bot = bot\r\n\r\n  @commands.command()\r\n  async def shutdown(self, ctx):\r\n    await self.bot.close()\r\n    return None\r\n\r\ndef setup(client): client.add_cog(MyCog(client))\r\n```\r\nBot runs fine, I input command `?shutdown` and while it does shut down I get this error...\r\n```\r\nUnclosed client session\r\nclient_session: <aiohttp.client.ClientSession object at 0x000001BDA9A55EF0>\r\nUnclosed connector\r\nconnections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x000001BDA9BED1C8>, 181630.39)]']\r\nconnector: <aiohttp.connector.TCPConnector object at 0x000001BDA9A55F60>\r\n```\r\nBut why? I thought using client.close() or .logout() would properly shut everything down. Is there any way to have everything gracefully exit?", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1862/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1862/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1809", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1809/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1809/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1809/events", "html_url": "https://github.com/Rapptz/discord.py/issues/1809", "id": 394923635, "node_id": "MDU6SXNzdWUzOTQ5MjM2MzU=", "number": 1809, "title": "HTTP Retry fails for file objects", "user": {"login": "NotSoSuper", "id": 4484641, "node_id": "MDQ6VXNlcjQ0ODQ2NDE=", "avatar_url": "https://avatars.githubusercontent.com/u/4484641?v=4", "gravatar_id": "", "url": "https://api.github.com/users/NotSoSuper", "html_url": "https://github.com/NotSoSuper", "followers_url": "https://api.github.com/users/NotSoSuper/followers", "following_url": "https://api.github.com/users/NotSoSuper/following{/other_user}", "gists_url": "https://api.github.com/users/NotSoSuper/gists{/gist_id}", "starred_url": "https://api.github.com/users/NotSoSuper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/NotSoSuper/subscriptions", "organizations_url": "https://api.github.com/users/NotSoSuper/orgs", "repos_url": "https://api.github.com/users/NotSoSuper/repos", "events_url": "https://api.github.com/users/NotSoSuper/events{/privacy}", "received_events_url": "https://api.github.com/users/NotSoSuper/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 511299952, "node_id": "MDU6TGFiZWw1MTEyOTk5NTI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/v1.0-alpha", "name": "v1.0-alpha", "color": "0052cc", "default": false, "description": "This pertains to the rewrite version"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5", "html_url": "https://github.com/Rapptz/discord.py/milestone/5", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5/labels", "id": 1941273, "node_id": "MDk6TWlsZXN0b25lMTk0MTI3Mw==", "number": 5, "title": "Rewrite", "description": "Things that will be taken care of before rewrite releases.", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 58, "state": "closed", "created_at": "2016-08-14T22:10:38Z", "updated_at": "2020-06-28T06:46:14Z", "due_on": null, "closed_at": "2019-04-10T01:57:54Z"}, "comments": 0, "created_at": "2018-12-31T03:25:08Z", "updated_at": "2019-03-18T11:55:19Z", "closed_at": "2019-03-18T11:55:19Z", "author_association": "NONE", "active_lock_reason": null, "body": "During  a (global) ratelimit, when the client tries to retry the API call, aiohttp has already closed the file object.\r\n\r\nExample:\r\n```py\r\nimport asyncio\r\nimport aiohttp\r\nfrom io import BytesIO\r\n\r\nloop = asyncio.get_event_loop()\r\n\r\nsession = aiohttp.ClientSession()\r\nb = BytesIO(b\"test\")\r\n\r\nasync def test():\r\n\tfor _ in range(2):\r\n\t\tasync with session.post(\"http://example.org\", data=b) as r:\r\n\t\t\tprint(r.status)\r\n\r\nloop.run_until_complete(test())\r\n```\r\n\r\nError:\r\n```py\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/usr/local/lib/python3.7/asyncio/base_events.py\", line 573, in run_until_complete\r\n    return future.result()\r\n  File \"<stdin>\", line 3, in test\r\n  File \"/usr/local/lib/python3.7/site-packages/aiohttp/client.py\", line 855, in __aenter__\r\n    self._resp = await self._coro\r\n  File \"/usr/local/lib/python3.7/site-packages/aiohttp/client.py\", line 361, in _request\r\n    ssl=ssl, proxy_headers=proxy_headers, traces=traces)\r\n  File \"/usr/local/lib/python3.7/site-packages/aiohttp/client_reqrep.py\", line 233, in __init__\r\n    self.update_body_from_data(data)\r\n  File \"/usr/local/lib/python3.7/site-packages/aiohttp/client_reqrep.py\", line 417, in update_body_from_data\r\n    size = body.size\r\n  File \"/usr/local/lib/python3.7/site-packages/aiohttp/payload.py\", line 273, in size\r\n    position = self._value.tell()\r\nValueError: I/O operation on closed file.\r\n```\r\n\r\nExactly what happens with the HTTP client.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1809/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1809/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1770", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1770/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1770/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1770/events", "html_url": "https://github.com/Rapptz/discord.py/issues/1770", "id": 390405761, "node_id": "MDU6SXNzdWUzOTA0MDU3NjE=", "number": 1770, "title": "Cannot send local files via webhooks.", "user": {"login": "XuaTheGrate", "id": 17090652, "node_id": "MDQ6VXNlcjE3MDkwNjUy", "avatar_url": "https://avatars.githubusercontent.com/u/17090652?v=4", "gravatar_id": "", "url": "https://api.github.com/users/XuaTheGrate", "html_url": "https://github.com/XuaTheGrate", "followers_url": "https://api.github.com/users/XuaTheGrate/followers", "following_url": "https://api.github.com/users/XuaTheGrate/following{/other_user}", "gists_url": "https://api.github.com/users/XuaTheGrate/gists{/gist_id}", "starred_url": "https://api.github.com/users/XuaTheGrate/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/XuaTheGrate/subscriptions", "organizations_url": "https://api.github.com/users/XuaTheGrate/orgs", "repos_url": "https://api.github.com/users/XuaTheGrate/repos", "events_url": "https://api.github.com/users/XuaTheGrate/events{/privacy}", "received_events_url": "https://api.github.com/users/XuaTheGrate/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 511299952, "node_id": "MDU6TGFiZWw1MTEyOTk5NTI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/v1.0-alpha", "name": "v1.0-alpha", "color": "0052cc", "default": false, "description": "This pertains to the rewrite version"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5", "html_url": "https://github.com/Rapptz/discord.py/milestone/5", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5/labels", "id": 1941273, "node_id": "MDk6TWlsZXN0b25lMTk0MTI3Mw==", "number": 5, "title": "Rewrite", "description": "Things that will be taken care of before rewrite releases.", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 58, "state": "closed", "created_at": "2016-08-14T22:10:38Z", "updated_at": "2020-06-28T06:46:14Z", "due_on": null, "closed_at": "2019-04-10T01:57:54Z"}, "comments": 0, "created_at": "2018-12-12T20:57:35Z", "updated_at": "2019-03-02T11:15:09Z", "closed_at": "2019-03-02T11:15:09Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "As the name suggests, you cannot send files on your disk via webhooks.\r\nRunning the following code: (file.txt is a local file)\r\n```python\r\nawait webhook.send(file=discord.File(\"file.txt\"))\r\n```\r\nWill raise the following traceback:\r\n```python\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.7/site-packages/discord/ext/commands/core.py\", line 62, in wrapped\r\n    ret = await coro(*args, **kwargs)\r\n  File \"/home/fedora/Thanatos/modules/test.py\", line 9, in test\r\n    await webhook.send(file=discord.File(\"file.txt\"))\r\n  File \"/usr/local/lib/python3.7/site-packages/discord/webhook.py\", line 194, in handle_execution_response\r\n    data = await response\r\n  File \"/usr/local/lib/python3.7/site-packages/discord/webhook.py\", line 162, in request\r\n    async with self.session.request(verb, url, headers=headers, data=data) as r:\r\n  File \"/usr/local/lib64/python3.7/site-packages/aiohttp/client.py\", line 855, in __aenter__\r\n    self._resp = await self._coro\r\n  File \"/usr/local/lib64/python3.7/site-packages/aiohttp/client.py\", line 361, in _request\r\n    ssl=ssl, proxy_headers=proxy_headers, traces=traces)\r\n  File \"/usr/local/lib64/python3.7/site-packages/aiohttp/client_reqrep.py\", line 233, in __init__\r\n    self.update_body_from_data(data)\r\n  File \"/usr/local/lib64/python3.7/site-packages/aiohttp/client_reqrep.py\", line 405, in update_body_from_data\r\n    body = body()\r\n  File \"/usr/local/lib64/python3.7/site-packages/aiohttp/formdata.py\", line 141, in __call__\r\n    return self._gen_form_data()\r\n  File \"/usr/local/lib64/python3.7/site-packages/aiohttp/formdata.py\", line 135, in _gen_form_data\r\n    self._writer.append_payload(part)\r\n  File \"/usr/local/lib64/python3.7/site-packages/aiohttp/multipart.py\", line 745, in append_payload\r\n    size = payload.size\r\n  File \"/usr/local/lib64/python3.7/site-packages/aiohttp/payload.py\", line 284, in size\r\n    return os.fstat(self._value.fileno()).st_size - self._value.tell()\r\nValueError: I/O operation on closed file\r\n```\r\nThis issue does also occur when using the `files` kwarg as well.\r\nSide note that using io objects (BytesIO, StringIO, etc) do work normally.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1770/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1770/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1653", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1653/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1653/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1653/events", "html_url": "https://github.com/Rapptz/discord.py/issues/1653", "id": 368011426, "node_id": "MDU6SXNzdWUzNjgwMTE0MjY=", "number": 1653, "title": "Command.signature reports Greedy and Optional params as required", "user": {"login": "ioistired", "id": 538336, "node_id": "MDQ6VXNlcjUzODMzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/538336?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ioistired", "html_url": "https://github.com/ioistired", "followers_url": "https://api.github.com/users/ioistired/followers", "following_url": "https://api.github.com/users/ioistired/following{/other_user}", "gists_url": "https://api.github.com/users/ioistired/gists{/gist_id}", "starred_url": "https://api.github.com/users/ioistired/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ioistired/subscriptions", "organizations_url": "https://api.github.com/users/ioistired/orgs", "repos_url": "https://api.github.com/users/ioistired/repos", "events_url": "https://api.github.com/users/ioistired/events{/privacy}", "received_events_url": "https://api.github.com/users/ioistired/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 511299952, "node_id": "MDU6TGFiZWw1MTEyOTk5NTI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/v1.0-alpha", "name": "v1.0-alpha", "color": "0052cc", "default": false, "description": "This pertains to the rewrite version"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5", "html_url": "https://github.com/Rapptz/discord.py/milestone/5", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5/labels", "id": 1941273, "node_id": "MDk6TWlsZXN0b25lMTk0MTI3Mw==", "number": 5, "title": "Rewrite", "description": "Things that will be taken care of before rewrite releases.", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 58, "state": "closed", "created_at": "2016-08-14T22:10:38Z", "updated_at": "2020-06-28T06:46:14Z", "due_on": null, "closed_at": "2019-04-10T01:57:54Z"}, "comments": 5, "created_at": "2018-10-09T01:55:34Z", "updated_at": "2019-03-02T11:17:32Z", "closed_at": "2019-03-02T11:17:32Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "```py\r\n@commands.command()\r\nasync def foo(context, a: typing.Optional[discord.Member], b: commands.Greedy[discord.TextChannel], c):\r\n    pass\r\n```\r\n\r\nExpected `foo.signature`:\r\n`foo [a] [b...] <c>`\r\n\r\nActual `foo.signature`:\r\n`foo <a> <b> <c>`", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1653/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1653/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1638", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1638/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1638/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1638/events", "html_url": "https://github.com/Rapptz/discord.py/issues/1638", "id": 366536616, "node_id": "MDU6SXNzdWUzNjY1MzY2MTY=", "number": 1638, "title": "Member.joined_at is occasionally None", "user": {"login": "Tobotimus", "id": 7438501, "node_id": "MDQ6VXNlcjc0Mzg1MDE=", "avatar_url": "https://avatars.githubusercontent.com/u/7438501?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Tobotimus", "html_url": "https://github.com/Tobotimus", "followers_url": "https://api.github.com/users/Tobotimus/followers", "following_url": "https://api.github.com/users/Tobotimus/following{/other_user}", "gists_url": "https://api.github.com/users/Tobotimus/gists{/gist_id}", "starred_url": "https://api.github.com/users/Tobotimus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Tobotimus/subscriptions", "organizations_url": "https://api.github.com/users/Tobotimus/orgs", "repos_url": "https://api.github.com/users/Tobotimus/repos", "events_url": "https://api.github.com/users/Tobotimus/events{/privacy}", "received_events_url": "https://api.github.com/users/Tobotimus/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 1163940607, "node_id": "MDU6TGFiZWwxMTYzOTQwNjA3", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/docs%20needed", "name": "docs needed", "color": "48f286", "default": false, "description": "Documentation is needed for this change."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5", "html_url": "https://github.com/Rapptz/discord.py/milestone/5", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5/labels", "id": 1941273, "node_id": "MDk6TWlsZXN0b25lMTk0MTI3Mw==", "number": 5, "title": "Rewrite", "description": "Things that will be taken care of before rewrite releases.", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 58, "state": "closed", "created_at": "2016-08-14T22:10:38Z", "updated_at": "2020-06-28T06:46:14Z", "due_on": null, "closed_at": "2019-04-10T01:57:54Z"}, "comments": 2, "created_at": "2018-10-03T21:27:43Z", "updated_at": "2019-02-27T11:24:14Z", "closed_at": "2019-02-27T11:24:14Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Hi, I'm really sorry I am no longer able to reproduce this, but I can confirm this odd behaviour occurred on a bot of mine. The bot had been running for a few weeks, and one command which created a sorted list of `guild.members` by `Member.joined_at` failed. This screenshot of a [p]debug command (a poor man's version of [p]eval) shows an incomplete list of all users in a guild who had `joined_at` as None, which totalled to 572 users (out of ~3200 in the guild):\r\n![image](https://user-images.githubusercontent.com/7438501/46440270-2f7cb280-c7a6-11e8-8e59-a3767488bb6e.png)\r\n\r\nRestarting the bot fixed the issue, but I figure the fact that it occurred in the first place means that it ought to be tracked. I'm sorry I did not try to gather more info before restarting the bot.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1638/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1638/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1577", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1577/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1577/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1577/events", "html_url": "https://github.com/Rapptz/discord.py/issues/1577", "id": 359182923, "node_id": "MDU6SXNzdWUzNTkxODI5MjM=", "number": 1577, "title": "member.top_role seems unreliable", "user": {"login": "MattIPv4", "id": 12371363, "node_id": "MDQ6VXNlcjEyMzcxMzYz", "avatar_url": "https://avatars.githubusercontent.com/u/12371363?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MattIPv4", "html_url": "https://github.com/MattIPv4", "followers_url": "https://api.github.com/users/MattIPv4/followers", "following_url": "https://api.github.com/users/MattIPv4/following{/other_user}", "gists_url": "https://api.github.com/users/MattIPv4/gists{/gist_id}", "starred_url": "https://api.github.com/users/MattIPv4/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MattIPv4/subscriptions", "organizations_url": "https://api.github.com/users/MattIPv4/orgs", "repos_url": "https://api.github.com/users/MattIPv4/repos", "events_url": "https://api.github.com/users/MattIPv4/events{/privacy}", "received_events_url": "https://api.github.com/users/MattIPv4/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-09-11T19:11:23Z", "updated_at": "2018-09-25T11:06:16Z", "closed_at": "2018-09-25T11:06:15Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "In some situations (unfortunately I don't have definite reproduction conditions), top_role appears to ignore the bot's own managed role from where it was invited when calculating top role leading to it returning the incorrect role.\r\n\r\nI recently had this on one of my own bots and have had to deploy a custom top_role bodge fix which resolves this issue.\r\n\r\n#### D.py member.top_role\r\n![oof](https://i.dabbitpri.me/dih2ofx35q.png)\r\n\r\n#### Using sorted to get top role\r\n![oof2](https://i.dabbitpri.me/2el58o3067.png)", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1577/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1577/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1518", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1518/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1518/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1518/events", "html_url": "https://github.com/Rapptz/discord.py/issues/1518", "id": 351438000, "node_id": "MDU6SXNzdWUzNTE0MzgwMDA=", "number": 1518, "title": "Author.top_role not updating on role hierarchy changes", "user": {"login": "julien777z", "id": 22227890, "node_id": "MDQ6VXNlcjIyMjI3ODkw", "avatar_url": "https://avatars.githubusercontent.com/u/22227890?v=4", "gravatar_id": "", "url": "https://api.github.com/users/julien777z", "html_url": "https://github.com/julien777z", "followers_url": "https://api.github.com/users/julien777z/followers", "following_url": "https://api.github.com/users/julien777z/following{/other_user}", "gists_url": "https://api.github.com/users/julien777z/gists{/gist_id}", "starred_url": "https://api.github.com/users/julien777z/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/julien777z/subscriptions", "organizations_url": "https://api.github.com/users/julien777z/orgs", "repos_url": "https://api.github.com/users/julien777z/repos", "events_url": "https://api.github.com/users/julien777z/events{/privacy}", "received_events_url": "https://api.github.com/users/julien777z/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 511299952, "node_id": "MDU6TGFiZWw1MTEyOTk5NTI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/v1.0-alpha", "name": "v1.0-alpha", "color": "0052cc", "default": false, "description": "This pertains to the rewrite version"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-08-17T02:45:22Z", "updated_at": "2018-09-25T11:06:38Z", "closed_at": "2018-09-25T11:06:38Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hello. I've moved one role that I have to the top of the roles in my server, and when I print ``author.top_role``, it shows the old role.\r\n\r\nScreenshot 1: https://cdn.discordapp.com/attachments/305571047535673345/479841129341255681/unknown.png\r\n\r\nScreenshot 2:\r\nhttps://cdn.discordapp.com/attachments/305571047535673345/479841165114605568/unknown.png\r\n\r\nI added an ``on_guild_role_update`` event to track if the role positional update gets fired, and it does, so the members' roles aren't updated when ``on_guild_role_update`` fires.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1518/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1518/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1453", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1453/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1453/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1453/events", "html_url": "https://github.com/Rapptz/discord.py/issues/1453", "id": 343939082, "node_id": "MDU6SXNzdWUzNDM5MzkwODI=", "number": 1453, "title": "Malicious \"l\" in client.py", "user": {"login": "Supersebi3", "id": 31341365, "node_id": "MDQ6VXNlcjMxMzQxMzY1", "avatar_url": "https://avatars.githubusercontent.com/u/31341365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Supersebi3", "html_url": "https://github.com/Supersebi3", "followers_url": "https://api.github.com/users/Supersebi3/followers", "following_url": "https://api.github.com/users/Supersebi3/following{/other_user}", "gists_url": "https://api.github.com/users/Supersebi3/gists{/gist_id}", "starred_url": "https://api.github.com/users/Supersebi3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Supersebi3/subscriptions", "organizations_url": "https://api.github.com/users/Supersebi3/orgs", "repos_url": "https://api.github.com/users/Supersebi3/repos", "events_url": "https://api.github.com/users/Supersebi3/events{/privacy}", "received_events_url": "https://api.github.com/users/Supersebi3/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-07-24T08:39:39Z", "updated_at": "2018-07-24T08:49:14Z", "closed_at": "2018-07-24T08:49:14Z", "author_association": "NONE", "active_lock_reason": null, "body": "The client.py file of the rewrite branch contains an `l` in the first line since commit e15452e198740870733261c8cbcfa5d2e9b9698e, which makes the module unusable because it causes a NameError.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1453/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1453/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1427", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1427/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1427/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1427/events", "html_url": "https://github.com/Rapptz/discord.py/issues/1427", "id": 341445105, "node_id": "MDU6SXNzdWUzNDE0NDUxMDU=", "number": 1427, "title": "Inconsistencies in ready statements on rewrite", "user": {"login": "JakeMakesStuff", "id": 23243233, "node_id": "MDQ6VXNlcjIzMjQzMjMz", "avatar_url": "https://avatars.githubusercontent.com/u/23243233?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JakeMakesStuff", "html_url": "https://github.com/JakeMakesStuff", "followers_url": "https://api.github.com/users/JakeMakesStuff/followers", "following_url": "https://api.github.com/users/JakeMakesStuff/following{/other_user}", "gists_url": "https://api.github.com/users/JakeMakesStuff/gists{/gist_id}", "starred_url": "https://api.github.com/users/JakeMakesStuff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JakeMakesStuff/subscriptions", "organizations_url": "https://api.github.com/users/JakeMakesStuff/orgs", "repos_url": "https://api.github.com/users/JakeMakesStuff/repos", "events_url": "https://api.github.com/users/JakeMakesStuff/events{/privacy}", "received_events_url": "https://api.github.com/users/JakeMakesStuff/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-07-16T09:23:30Z", "updated_at": "2020-05-10T23:46:38Z", "closed_at": "2020-05-10T23:46:37Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi,\r\n\r\nThis is a bug I recently reported in the discord.py guild and was told by spoopy to write here too. `on_ready` and `on_shard_ready` seem to be very inconsistent. A good example would be this code here:\r\n\r\n```py\r\nimport discord\r\nimport logging\r\nimport os\r\n\r\nlogging.basicConfig(level=logging.INFO)\r\n\r\nclient = discord.AutoShardedClient(\r\n    shard_count=3\r\n)\r\n\r\n@client.event\r\nasync def on_ready():\r\n    print(\"on_ready works!\")\r\n\r\n@client.event\r\nasync def on_shard_ready(shard_id):\r\n    print(shard_id)\r\n\r\nclient.run(os.environ.get(\"TOKEN\"))\r\n```\r\n\r\nIn this code on my bot, `on_ready` gets called multiple times whereas `on_shard_ready` does not get called. However, I was later told by spoopy that is because it is in no large guilds (a test bot at the moment). `on_ready` also should not get called multiple times because it is the final event when all shards are ready from what I have been made aware.\r\n\r\n![powershell](https://i.imgur.com/EF2DTOK.png)\r\n\r\nLooking forward to a fix,\r\nJake (JakeMakesStuff#0001)\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1427/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1427/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1419", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1419/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1419/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1419/events", "html_url": "https://github.com/Rapptz/discord.py/issues/1419", "id": 341267483, "node_id": "MDU6SXNzdWUzNDEyNjc0ODM=", "number": 1419, "title": "Segmentation Fault with audio bots", "user": {"login": "JellyWX", "id": 5578434, "node_id": "MDQ6VXNlcjU1Nzg0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/5578434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JellyWX", "html_url": "https://github.com/JellyWX", "followers_url": "https://api.github.com/users/JellyWX/followers", "following_url": "https://api.github.com/users/JellyWX/following{/other_user}", "gists_url": "https://api.github.com/users/JellyWX/gists{/gist_id}", "starred_url": "https://api.github.com/users/JellyWX/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JellyWX/subscriptions", "organizations_url": "https://api.github.com/users/JellyWX/orgs", "repos_url": "https://api.github.com/users/JellyWX/repos", "events_url": "https://api.github.com/users/JellyWX/events{/privacy}", "received_events_url": "https://api.github.com/users/JellyWX/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 840896122, "node_id": "MDU6TGFiZWw4NDA4OTYxMjI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/stale", "name": "stale", "color": "a0c92e", "default": false, "description": "This issue is too old."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2018-07-14T20:59:19Z", "updated_at": "2019-03-01T04:26:29Z", "closed_at": "2019-03-01T04:26:29Z", "author_association": "NONE", "active_lock_reason": null, "body": "Linux seg fault with audio bots. GDB trace:\r\n\r\n```\r\n[mp3 @ 0x671400] Estimating duration from bitrate, this may be inaccurate\r\n[New Thread 0x7fffc5c47700 (LWP 3512)]\r\n\r\nThread 604 \"python3\" received signal SIGSEGV, Segmentation fault.\r\n[Switching to Thread 0x7fffc6c49700 (LWP 3510)]\r\n__memcpy_avx_unaligned ()\r\n    at ../sysdeps/x86_64/multiarch/memcpy-avx-unaligned.S:268\r\n268     ../sysdeps/x86_64/multiarch/memcpy-avx-unaligned.S: No such file or directory.\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1419/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1419/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1277", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1277/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1277/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1277/events", "html_url": "https://github.com/Rapptz/discord.py/issues/1277", "id": 321807693, "node_id": "MDU6SXNzdWUzMjE4MDc2OTM=", "number": 1277, "title": "'permissions_for' giving @everyone too much respect", "user": {"login": "CRASNY", "id": 25572223, "node_id": "MDQ6VXNlcjI1NTcyMjIz", "avatar_url": "https://avatars.githubusercontent.com/u/25572223?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CRASNY", "html_url": "https://github.com/CRASNY", "followers_url": "https://api.github.com/users/CRASNY/followers", "following_url": "https://api.github.com/users/CRASNY/following{/other_user}", "gists_url": "https://api.github.com/users/CRASNY/gists{/gist_id}", "starred_url": "https://api.github.com/users/CRASNY/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CRASNY/subscriptions", "organizations_url": "https://api.github.com/users/CRASNY/orgs", "repos_url": "https://api.github.com/users/CRASNY/repos", "events_url": "https://api.github.com/users/CRASNY/events{/privacy}", "received_events_url": "https://api.github.com/users/CRASNY/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 251130947, "node_id": "MDU6TGFiZWwyNTExMzA5NDc=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/wontfix", "name": "wontfix", "color": "ffffff", "default": true, "description": "This will not be worked on."}, {"id": 840896122, "node_id": "MDU6TGFiZWw4NDA4OTYxMjI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/stale", "name": "stale", "color": "a0c92e", "default": false, "description": "This issue is too old."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-05-10T04:43:19Z", "updated_at": "2018-12-06T18:03:14Z", "closed_at": "2018-05-19T00:23:38Z", "author_association": "NONE", "active_lock_reason": null, "body": "If you have a channel with `read_messages` set to allow/True for **@everyone**, and then another role (let's say **Verified**) with `read_messages` set to deny/False, a user with the **Verified** role won't be able to read the messages of this channel due to Discord respecting custom roles over **@everyone**. Non-**@everyone** roles always operate as deny overriding allow, but when tested against **@everyone** a custom role's deny can override its allow.\r\n\r\n`permissions_for` doesn't seem to understand this because it will return True for a user that can't read messages in a channel like the one described above (where they're denied access by a custom role, despite **@everyone** having `read_messages` set to True).", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1277/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1277/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1242", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1242/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1242/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1242/events", "html_url": "https://github.com/Rapptz/discord.py/issues/1242", "id": 318071481, "node_id": "MDU6SXNzdWUzMTgwNzE0ODE=", "number": 1242, "title": "Using wait=True in webhook.execute raises AttributeError", "user": {"login": "nguuuquaaa", "id": 12592742, "node_id": "MDQ6VXNlcjEyNTkyNzQy", "avatar_url": "https://avatars.githubusercontent.com/u/12592742?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nguuuquaaa", "html_url": "https://github.com/nguuuquaaa", "followers_url": "https://api.github.com/users/nguuuquaaa/followers", "following_url": "https://api.github.com/users/nguuuquaaa/following{/other_user}", "gists_url": "https://api.github.com/users/nguuuquaaa/gists{/gist_id}", "starred_url": "https://api.github.com/users/nguuuquaaa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nguuuquaaa/subscriptions", "organizations_url": "https://api.github.com/users/nguuuquaaa/orgs", "repos_url": "https://api.github.com/users/nguuuquaaa/repos", "events_url": "https://api.github.com/users/nguuuquaaa/events{/privacy}", "received_events_url": "https://api.github.com/users/nguuuquaaa/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 511299952, "node_id": "MDU6TGFiZWw1MTEyOTk5NTI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/v1.0-alpha", "name": "v1.0-alpha", "color": "0052cc", "default": false, "description": "This pertains to the rewrite version"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5", "html_url": "https://github.com/Rapptz/discord.py/milestone/5", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5/labels", "id": 1941273, "node_id": "MDk6TWlsZXN0b25lMTk0MTI3Mw==", "number": 5, "title": "Rewrite", "description": "Things that will be taken care of before rewrite releases.", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 58, "state": "closed", "created_at": "2016-08-14T22:10:38Z", "updated_at": "2020-06-28T06:46:14Z", "due_on": null, "closed_at": "2019-04-10T01:57:54Z"}, "comments": 1, "created_at": "2018-04-26T15:05:23Z", "updated_at": "2018-12-15T02:07:05Z", "closed_at": "2018-12-15T02:07:05Z", "author_association": "NONE", "active_lock_reason": null, "body": "Title.\r\n\r\nHere's the code (using eval command) and traceback in case.\r\n```py\r\nwebhook = (await ctx.channel.webhooks())[0]\r\nmsg = await webhook.execute(\"test\", wait=True)\r\n```\r\n```\r\nTraceback (most recent call last):\r\n  File \"/home/nguuuquaaa/bot/Belphegor/belphegor/admin.py\", line 131, in _eval\r\n    await func()\r\n  File \"<string>\", line 3, in func\r\n  File \"/usr/local/lib/python3.6/dist-packages/discord/webhook.py\", line 197, in handle_execution_response\r\n    return Message(data=data, state=self, channel=self.webhook.channel)\r\n  File \"/usr/local/lib/python3.6/dist-packages/discord/message.py\", line 213, in __init__\r\n    self._update(channel, data)\r\n  File \"/usr/local/lib/python3.6/dist-packages/discord/message.py\", line 278, in _update\r\n    getattr(self, '_handle_%s' % handler)(data[handler])\r\n  File \"/usr/local/lib/python3.6/dist-packages/discord/message.py\", line 291, in _handle_author\r\n    self.author = self._state.store_user(author)\r\nAttributeError: 'AsyncWebhookAdapter' object has no attribute 'store_user'\r\n```", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1242/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1242/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1150", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1150/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1150/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1150/events", "html_url": "https://github.com/Rapptz/discord.py/issues/1150", "id": 306147713, "node_id": "MDU6SXNzdWUzMDYxNDc3MTM=", "number": 1150, "title": "Multiple webhook issues", "user": {"login": "chayleaf", "id": 9590981, "node_id": "MDQ6VXNlcjk1OTA5ODE=", "avatar_url": "https://avatars.githubusercontent.com/u/9590981?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chayleaf", "html_url": "https://github.com/chayleaf", "followers_url": "https://api.github.com/users/chayleaf/followers", "following_url": "https://api.github.com/users/chayleaf/following{/other_user}", "gists_url": "https://api.github.com/users/chayleaf/gists{/gist_id}", "starred_url": "https://api.github.com/users/chayleaf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chayleaf/subscriptions", "organizations_url": "https://api.github.com/users/chayleaf/orgs", "repos_url": "https://api.github.com/users/chayleaf/repos", "events_url": "https://api.github.com/users/chayleaf/events{/privacy}", "received_events_url": "https://api.github.com/users/chayleaf/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 511299952, "node_id": "MDU6TGFiZWw1MTEyOTk5NTI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/v1.0-alpha", "name": "v1.0-alpha", "color": "0052cc", "default": false, "description": "This pertains to the rewrite version"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5", "html_url": "https://github.com/Rapptz/discord.py/milestone/5", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5/labels", "id": 1941273, "node_id": "MDk6TWlsZXN0b25lMTk0MTI3Mw==", "number": 5, "title": "Rewrite", "description": "Things that will be taken care of before rewrite releases.", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 58, "state": "closed", "created_at": "2016-08-14T22:10:38Z", "updated_at": "2020-06-28T06:46:14Z", "due_on": null, "closed_at": "2019-04-10T01:57:54Z"}, "comments": 5, "created_at": "2018-03-17T11:04:20Z", "updated_at": "2019-03-02T11:18:51Z", "closed_at": "2019-03-02T11:18:51Z", "author_association": "NONE", "active_lock_reason": null, "body": "1. `'AsyncWebhookAdapter' object has no attribute 'http'`  when sending pictures (haven't tested with other media types, message still sends so I justs ignore it)\r\n\r\n2. `BAD REQUEST (status code: 400): Cannot send an empty message` when sending a message (happens randomly, retrying helps)\r\n\r\nI use `wait=True`", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1150/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1150/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1148", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1148/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1148/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1148/events", "html_url": "https://github.com/Rapptz/discord.py/issues/1148", "id": 306069499, "node_id": "MDU6SXNzdWUzMDYwNjk0OTk=", "number": 1148, "title": "'ConnectionState' object has no attribute 'get_guild' when using wait=True with webhooks", "user": {"login": "chayleaf", "id": 9590981, "node_id": "MDQ6VXNlcjk1OTA5ODE=", "avatar_url": "https://avatars.githubusercontent.com/u/9590981?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chayleaf", "html_url": "https://github.com/chayleaf", "followers_url": "https://api.github.com/users/chayleaf/followers", "following_url": "https://api.github.com/users/chayleaf/following{/other_user}", "gists_url": "https://api.github.com/users/chayleaf/gists{/gist_id}", "starred_url": "https://api.github.com/users/chayleaf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chayleaf/subscriptions", "organizations_url": "https://api.github.com/users/chayleaf/orgs", "repos_url": "https://api.github.com/users/chayleaf/repos", "events_url": "https://api.github.com/users/chayleaf/events{/privacy}", "received_events_url": "https://api.github.com/users/chayleaf/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 511299952, "node_id": "MDU6TGFiZWw1MTEyOTk5NTI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/v1.0-alpha", "name": "v1.0-alpha", "color": "0052cc", "default": false, "description": "This pertains to the rewrite version"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-03-16T20:39:26Z", "updated_at": "2018-03-16T22:00:32Z", "closed_at": "2018-03-16T22:00:32Z", "author_association": "NONE", "active_lock_reason": null, "body": "code is:\r\n```python\r\nwebhook = await (self.get_channel(channelID)).create_webhook(name=...)\r\nmsg = await webhook.send(content=..., wait=True)\r\n```\r\nit throws:\r\n```cpp\r\n  File \"C:\\Python35\\lib\\site-packages\\discord\\webhook.py\", line 197, in handle_execution_response\r\n    return Message(data=data, state=self, channel=self.webhook.channel)\r\n  File \"C:\\Python35\\lib\\site-packages\\discord\\webhook.py\", line 440, in channel\r\n    guild = self.guild\r\n  File \"C:\\Python35\\lib\\site-packages\\discord\\webhook.py\", line 432, in guild\r\n    return self._state and self._state.get_guild(self.guild_id)\r\nAttributeError: 'ConnectionState' object has no attribute 'get_guild'\r\n```", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1148/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1148/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1104", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1104/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1104/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1104/events", "html_url": "https://github.com/Rapptz/discord.py/issues/1104", "id": 300264491, "node_id": "MDU6SXNzdWUzMDAyNjQ0OTE=", "number": 1104, "title": "Attachment download - HTTPClient.get_attachment - missing a decorator?", "user": {"login": "spectras", "id": 5879675, "node_id": "MDQ6VXNlcjU4Nzk2NzU=", "avatar_url": "https://avatars.githubusercontent.com/u/5879675?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spectras", "html_url": "https://github.com/spectras", "followers_url": "https://api.github.com/users/spectras/followers", "following_url": "https://api.github.com/users/spectras/following{/other_user}", "gists_url": "https://api.github.com/users/spectras/gists{/gist_id}", "starred_url": "https://api.github.com/users/spectras/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spectras/subscriptions", "organizations_url": "https://api.github.com/users/spectras/orgs", "repos_url": "https://api.github.com/users/spectras/repos", "events_url": "https://api.github.com/users/spectras/events{/privacy}", "received_events_url": "https://api.github.com/users/spectras/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 511299952, "node_id": "MDU6TGFiZWw1MTEyOTk5NTI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/v1.0-alpha", "name": "v1.0-alpha", "color": "0052cc", "default": false, "description": "This pertains to the rewrite version"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-02-26T14:43:39Z", "updated_at": "2018-02-26T23:55:37Z", "closed_at": "2018-02-26T23:55:37Z", "author_association": "NONE", "active_lock_reason": null, "body": "Attempting to download a message attachment with `rewrite` branch on python 3.5 yields the following exception:\r\n\r\n```\r\n[...]\r\nFile \"/usr/share/python3/baleine-bot/lib/python3.5/site-packages/baleine/apps/help/commands.py\", line 101, in execute\r\n  await attachment.save(data)\r\nFile \"/usr/share/python3/baleine-bot/lib/python3.5/site-packages/discord/message.py\", line 103, in save\r\n  data = yield from self._http.get_attachment(self.url)\r\nFile \"/usr/share/python3/baleine-bot/lib/python3.5/site-packages/discord/http.py\", line 227, in get_attachment\r\n  return (yield from resp.read())\r\nTypeError: cannot 'yield from' a coroutine object in a non-coroutine generator\r\n```\r\n\r\nFurther investigation lead me there: https://github.com/Rapptz/discord.py/blob/rewrite/discord/http.py#L223\r\nI am not very experienced with asyncio yet, but it seems this method should have a \u00a0`@asyncio.coroutine` decorator, shouldn't it?\r\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1104/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1104/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1101", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1101/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1101/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1101/events", "html_url": "https://github.com/Rapptz/discord.py/issues/1101", "id": 299971892, "node_id": "MDU6SXNzdWUyOTk5NzE4OTI=", "number": 1101, "title": "Webhook usernames don't update", "user": {"login": "Vexs", "id": 7316404, "node_id": "MDQ6VXNlcjczMTY0MDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/7316404?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Vexs", "html_url": "https://github.com/Vexs", "followers_url": "https://api.github.com/users/Vexs/followers", "following_url": "https://api.github.com/users/Vexs/following{/other_user}", "gists_url": "https://api.github.com/users/Vexs/gists{/gist_id}", "starred_url": "https://api.github.com/users/Vexs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Vexs/subscriptions", "organizations_url": "https://api.github.com/users/Vexs/orgs", "repos_url": "https://api.github.com/users/Vexs/repos", "events_url": "https://api.github.com/users/Vexs/events{/privacy}", "received_events_url": "https://api.github.com/users/Vexs/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 511299952, "node_id": "MDU6TGFiZWw1MTEyOTk5NTI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/v1.0-alpha", "name": "v1.0-alpha", "color": "0052cc", "default": false, "description": "This pertains to the rewrite version"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-02-24T20:53:01Z", "updated_at": "2018-02-24T22:38:35Z", "closed_at": "2018-02-24T22:38:35Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The library does not appear properly update the author for webhooks when one is received with a new username field- for example, if one is sent with the author \"potato\", and it is the first time it's seen by the bot, the username will be \"potato\". However, if the same webhook is sent a second time, with a different username, \"tomato\", the bot will register it as having the username \"potato\". \r\n\r\nShown below is a simple example where the bot is just a simple echo bot. \r\n![image](https://user-images.githubusercontent.com/7316404/36634945-4ea4f9fc-1972-11e8-8183-96ae001a5318.png)\r\n\r\nThis bug does not exist on the async branch. ", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/1101/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/1101/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/851", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/851/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/851/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/851/events", "html_url": "https://github.com/Rapptz/discord.py/issues/851", "id": 265451683, "node_id": "MDU6SXNzdWUyNjU0NTE2ODM=", "number": 851, "title": "JSON/Unicode Decode crashes with zlib streaming", "user": {"login": "IamTails", "id": 21271709, "node_id": "MDQ6VXNlcjIxMjcxNzA5", "avatar_url": "https://avatars.githubusercontent.com/u/21271709?v=4", "gravatar_id": "", "url": "https://api.github.com/users/IamTails", "html_url": "https://github.com/IamTails", "followers_url": "https://api.github.com/users/IamTails/followers", "following_url": "https://api.github.com/users/IamTails/following{/other_user}", "gists_url": "https://api.github.com/users/IamTails/gists{/gist_id}", "starred_url": "https://api.github.com/users/IamTails/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/IamTails/subscriptions", "organizations_url": "https://api.github.com/users/IamTails/orgs", "repos_url": "https://api.github.com/users/IamTails/repos", "events_url": "https://api.github.com/users/IamTails/events{/privacy}", "received_events_url": "https://api.github.com/users/IamTails/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-10-14T00:51:03Z", "updated_at": "2017-10-16T23:20:02Z", "closed_at": "2017-10-16T23:20:02Z", "author_association": "NONE", "active_lock_reason": null, "body": "http://feed-the-wump.us/futapigoki", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/851/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/851/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/822", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/822/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/822/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/822/events", "html_url": "https://github.com/Rapptz/discord.py/issues/822", "id": 261924168, "node_id": "MDU6SXNzdWUyNjE5MjQxNjg=", "number": 822, "title": "member.top_role not returning top role", "user": {"login": "tallypokemap", "id": 25806770, "node_id": "MDQ6VXNlcjI1ODA2Nzcw", "avatar_url": "https://avatars.githubusercontent.com/u/25806770?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tallypokemap", "html_url": "https://github.com/tallypokemap", "followers_url": "https://api.github.com/users/tallypokemap/followers", "following_url": "https://api.github.com/users/tallypokemap/following{/other_user}", "gists_url": "https://api.github.com/users/tallypokemap/gists{/gist_id}", "starred_url": "https://api.github.com/users/tallypokemap/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tallypokemap/subscriptions", "organizations_url": "https://api.github.com/users/tallypokemap/orgs", "repos_url": "https://api.github.com/users/tallypokemap/repos", "events_url": "https://api.github.com/users/tallypokemap/events{/privacy}", "received_events_url": "https://api.github.com/users/tallypokemap/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-10-01T15:30:29Z", "updated_at": "2017-10-01T19:13:23Z", "closed_at": "2017-10-01T19:13:23Z", "author_association": "NONE", "active_lock_reason": null, "body": "For 90% of the users in my server, member.top_role returns a role that is not their top role.  I heard this may have been fixed in the rewrite branch but I believe the async branch to still be bugged.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/822/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/822/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/811", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/811/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/811/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/811/events", "html_url": "https://github.com/Rapptz/discord.py/issues/811", "id": 260829406, "node_id": "MDU6SXNzdWUyNjA4Mjk0MDY=", "number": 811, "title": "system_channel doesn't work", "user": {"login": "ExpensiveDiamondProjects", "id": 25912702, "node_id": "MDQ6VXNlcjI1OTEyNzAy", "avatar_url": "https://avatars.githubusercontent.com/u/25912702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ExpensiveDiamondProjects", "html_url": "https://github.com/ExpensiveDiamondProjects", "followers_url": "https://api.github.com/users/ExpensiveDiamondProjects/followers", "following_url": "https://api.github.com/users/ExpensiveDiamondProjects/following{/other_user}", "gists_url": "https://api.github.com/users/ExpensiveDiamondProjects/gists{/gist_id}", "starred_url": "https://api.github.com/users/ExpensiveDiamondProjects/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ExpensiveDiamondProjects/subscriptions", "organizations_url": "https://api.github.com/users/ExpensiveDiamondProjects/orgs", "repos_url": "https://api.github.com/users/ExpensiveDiamondProjects/repos", "events_url": "https://api.github.com/users/ExpensiveDiamondProjects/events{/privacy}", "received_events_url": "https://api.github.com/users/ExpensiveDiamondProjects/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-09-27T02:44:56Z", "updated_at": "2017-09-27T02:57:29Z", "closed_at": "2017-09-27T02:57:19Z", "author_association": "NONE", "active_lock_reason": null, "body": "`guild.system_channel` always returns `None`, even when there is a system channel.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/811/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/811/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/741", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/741/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/741/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/741/events", "html_url": "https://github.com/Rapptz/discord.py/issues/741", "id": 253741737, "node_id": "MDU6SXNzdWUyNTM3NDE3Mzc=", "number": 741, "title": "@everyone is not always guaranteed to be first in the role list", "user": {"login": "awaken1ng", "id": 20689137, "node_id": "MDQ6VXNlcjIwNjg5MTM3", "avatar_url": "https://avatars.githubusercontent.com/u/20689137?v=4", "gravatar_id": "", "url": "https://api.github.com/users/awaken1ng", "html_url": "https://github.com/awaken1ng", "followers_url": "https://api.github.com/users/awaken1ng/followers", "following_url": "https://api.github.com/users/awaken1ng/following{/other_user}", "gists_url": "https://api.github.com/users/awaken1ng/gists{/gist_id}", "starred_url": "https://api.github.com/users/awaken1ng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/awaken1ng/subscriptions", "organizations_url": "https://api.github.com/users/awaken1ng/orgs", "repos_url": "https://api.github.com/users/awaken1ng/repos", "events_url": "https://api.github.com/users/awaken1ng/events{/privacy}", "received_events_url": "https://api.github.com/users/awaken1ng/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 511299952, "node_id": "MDU6TGFiZWw1MTEyOTk5NTI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/v1.0-alpha", "name": "v1.0-alpha", "color": "0052cc", "default": false, "description": "This pertains to the rewrite version"}], "state": "closed", "locked": false, "assignee": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5", "html_url": "https://github.com/Rapptz/discord.py/milestone/5", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5/labels", "id": 1941273, "node_id": "MDk6TWlsZXN0b25lMTk0MTI3Mw==", "number": 5, "title": "Rewrite", "description": "Things that will be taken care of before rewrite releases.", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 58, "state": "closed", "created_at": "2016-08-14T22:10:38Z", "updated_at": "2020-06-28T06:46:14Z", "due_on": null, "closed_at": "2019-04-10T01:57:54Z"}, "comments": 3, "created_at": "2017-08-29T17:21:16Z", "updated_at": "2020-12-03T23:21:19Z", "closed_at": "2017-08-29T20:24:53Z", "author_association": "NONE", "active_lock_reason": null, "body": "While bot testing on a test server, I noticed the `guild.me.colour` not returning the actual display colour of the bot on the said server\r\n```python\r\nresponse.colour = message.guild.me.colour\r\nawait message.channel.send(embed=response)\r\n```\r\n![](https://camo.githubusercontent.com/cc8823326f2291fd060fc86f2d254fa5de752aa2/68747470733a2f2f63646e2e646973636f72646170702e636f6d2f6174746163686d656e74732f3230373933393033373930393039303330342f3335323130373731393231313038393932332f756e6b6e6f776e2e706e67)\r\n\r\nUpon investigation, the reason for that was that the `@everyone` role is not on first position in the list on that server, 4 other servers properly had the role on first position however\r\n```python\r\nclass Member(discord.abc.Messageable, _BaseUser):\r\n  def colour(self):\r\n    default_colour = Colour.default()\r\n\r\n    print(self.roles)\r\n    # [<Role id=206815085019004928 name='Yueri'>, <Role id=214026475203067904 name='@everyone'>]\r\n    # [<Role id=206815085019004928 name='Yueri'>, <Role id=214026475203067904 name='@everyone'>, <Role id=214581426199330819 name='Adm'>]\r\n    roles = self.roles[1:] # remove @everyone\r\n    print(roles)\r\n    # [<Role id=214026475203067904 name='@everyone'>]\r\n    # [<Role id=214026475203067904 name='@everyone'>, <Role id=214581426199330819 name='Adm'>]\r\n```", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/741/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/741/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/630", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/630/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/630/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/630/events", "html_url": "https://github.com/Rapptz/discord.py/issues/630", "id": 241211311, "node_id": "MDU6SXNzdWUyNDEyMTEzMTE=", "number": 630, "title": "Channel Permission Overrides Out of Order", "user": {"login": "AXAz0r", "id": 4390753, "node_id": "MDQ6VXNlcjQzOTA3NTM=", "avatar_url": "https://avatars.githubusercontent.com/u/4390753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AXAz0r", "html_url": "https://github.com/AXAz0r", "followers_url": "https://api.github.com/users/AXAz0r/followers", "following_url": "https://api.github.com/users/AXAz0r/following{/other_user}", "gists_url": "https://api.github.com/users/AXAz0r/gists{/gist_id}", "starred_url": "https://api.github.com/users/AXAz0r/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AXAz0r/subscriptions", "organizations_url": "https://api.github.com/users/AXAz0r/orgs", "repos_url": "https://api.github.com/users/AXAz0r/repos", "events_url": "https://api.github.com/users/AXAz0r/events{/privacy}", "received_events_url": "https://api.github.com/users/AXAz0r/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-07-07T09:39:27Z", "updated_at": "2017-07-07T22:04:56Z", "closed_at": "2017-07-07T22:04:52Z", "author_association": "NONE", "active_lock_reason": null, "body": "As reported and discussed in #python_discord-py on Discord API July 7th 2017 at 09:10 UTC.\r\nExplicitly stating a permission is `True`, even when bellow one that overrides it as `False` will return `True` in the wrapper.\r\n\r\n```py\r\n[('@everyone', {\r\n  'send_messages': True,\r\n# Permissions with None redacted...\r\n}), ('Dev BOT', {\r\n  'send_messages': False,\r\n# Permissions with None redacted...\r\n})]\r\n```\r\n\r\nPermissions set to this will return `True` in the wrapper while being denied by Discord.\r\nReverting the permission of `@everyone` to `Default` instead of an explicit `True` returns the permission for the channel properly as `False`.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/630/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/630/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/589", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/589/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/589/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/589/events", "html_url": "https://github.com/Rapptz/discord.py/issues/589", "id": 233459116, "node_id": "MDU6SXNzdWUyMzM0NTkxMTY=", "number": 589, "title": "AuditLogDiff is not iterable", "user": {"login": "TheEnigmaBlade", "id": 79983, "node_id": "MDQ6VXNlcjc5OTgz", "avatar_url": "https://avatars.githubusercontent.com/u/79983?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TheEnigmaBlade", "html_url": "https://github.com/TheEnigmaBlade", "followers_url": "https://api.github.com/users/TheEnigmaBlade/followers", "following_url": "https://api.github.com/users/TheEnigmaBlade/following{/other_user}", "gists_url": "https://api.github.com/users/TheEnigmaBlade/gists{/gist_id}", "starred_url": "https://api.github.com/users/TheEnigmaBlade/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TheEnigmaBlade/subscriptions", "organizations_url": "https://api.github.com/users/TheEnigmaBlade/orgs", "repos_url": "https://api.github.com/users/TheEnigmaBlade/repos", "events_url": "https://api.github.com/users/TheEnigmaBlade/events{/privacy}", "received_events_url": "https://api.github.com/users/TheEnigmaBlade/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 511299952, "node_id": "MDU6TGFiZWw1MTEyOTk5NTI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/v1.0-alpha", "name": "v1.0-alpha", "color": "0052cc", "default": false, "description": "This pertains to the rewrite version"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-06-04T20:52:46Z", "updated_at": "2017-06-05T00:32:44Z", "closed_at": "2017-06-05T00:32:44Z", "author_association": "NONE", "active_lock_reason": null, "body": "For whatever reason, `AuditLogDiff.__iter__()` is not producing an iterable object. Any attempt to iterate it produces this error:\r\n\r\n> TypeError: iter() returned non-iterator of type 'dict_items'\r\n\r\nThe expected result of `iter()` should be of the type `dict_itemiterator`, which is strange. The type `dict_items` is the result of `items()`.\r\n\r\n```python\r\ntest = AuditLogDiff()\r\nsetattr(test, \"testkey\", \"testvalue\")\r\n\r\n# Fail\r\nfor key, value in test:\r\n    pass\r\n\r\n# Fail\r\ntest_iter = iter(test)\r\n```\r\n\r\nInterestingly, `AuditLogDiff.__iter__()` can be copy-pasted or called directly and the result is perfectly iterable.\r\n\r\n```python\r\n# Pass\r\nfor key, value in test.__dict__.items():\r\n    pass\r\n\r\n# Pass\r\nfor key, value in test.__iter__():\r\n    pass\r\n```\r\n\r\nThe result of `items()` is iterable *before* it's returned from `__iter__()`:\r\n\r\n```python\r\nclass AuditLogDiffFixed:\r\n    def __iter__(self):\r\n        return iter(self.__dict__.items())\r\n\r\ntest_fix = AuditLogDiffFixed()\r\nsetattr(test_fix, \"testkey\", \"testvalue\")\r\n\r\n# Pass\r\nfor key, value in test_fix:\r\n    pass\r\n```", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/589/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/589/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/532", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/532/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/532/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/532/events", "html_url": "https://github.com/Rapptz/discord.py/issues/532", "id": 220741804, "node_id": "MDU6SXNzdWUyMjA3NDE4MDQ=", "number": 532, "title": "Unset server.owner breaks permission check", "user": {"login": "hermit-crab", "id": 3883516, "node_id": "MDQ6VXNlcjM4ODM1MTY=", "avatar_url": "https://avatars.githubusercontent.com/u/3883516?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hermit-crab", "html_url": "https://github.com/hermit-crab", "followers_url": "https://api.github.com/users/hermit-crab/followers", "following_url": "https://api.github.com/users/hermit-crab/following{/other_user}", "gists_url": "https://api.github.com/users/hermit-crab/gists{/gist_id}", "starred_url": "https://api.github.com/users/hermit-crab/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hermit-crab/subscriptions", "organizations_url": "https://api.github.com/users/hermit-crab/orgs", "repos_url": "https://api.github.com/users/hermit-crab/repos", "events_url": "https://api.github.com/users/hermit-crab/events{/privacy}", "received_events_url": "https://api.github.com/users/hermit-crab/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5", "html_url": "https://github.com/Rapptz/discord.py/milestone/5", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5/labels", "id": 1941273, "node_id": "MDk6TWlsZXN0b25lMTk0MTI3Mw==", "number": 5, "title": "Rewrite", "description": "Things that will be taken care of before rewrite releases.", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 58, "state": "closed", "created_at": "2016-08-14T22:10:38Z", "updated_at": "2020-06-28T06:46:14Z", "due_on": null, "closed_at": "2019-04-10T01:57:54Z"}, "comments": 1, "created_at": "2017-04-10T19:12:45Z", "updated_at": "2017-05-20T17:18:53Z", "closed_at": "2017-05-20T17:18:53Z", "author_association": "NONE", "active_lock_reason": null, "body": "I am checking my permissions on a channel with `channel.permissions_for(server.me)` right after ready event. And it produces: \r\n```\r\nFile \"env/lib/python3.6/site-packages/discord/channel.py\", line 260, in permissions_for\r\n    if member.id == self.server.owner.id:\r\nAttributeError: 'NoneType' object has no attribute 'id'\r\n```\r\nRight now I have to do `client.request_offline_members()` (even for small ~30 members servers) and `asyncio.sleep(1)` after that to make sure all members are set. This is all on non bot account.\r\n\r\nRelated to https://github.com/Rapptz/discord.py/issues/431?", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/532/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/532/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/527", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/527/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/527/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/527/events", "html_url": "https://github.com/Rapptz/discord.py/issues/527", "id": 219722055, "node_id": "MDU6SXNzdWUyMTk3MjIwNTU=", "number": 527, "title": "logs_from returns every message 50 times", "user": {"login": "cozyGalvinism", "id": 1332113, "node_id": "MDQ6VXNlcjEzMzIxMTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1332113?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cozyGalvinism", "html_url": "https://github.com/cozyGalvinism", "followers_url": "https://api.github.com/users/cozyGalvinism/followers", "following_url": "https://api.github.com/users/cozyGalvinism/following{/other_user}", "gists_url": "https://api.github.com/users/cozyGalvinism/gists{/gist_id}", "starred_url": "https://api.github.com/users/cozyGalvinism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cozyGalvinism/subscriptions", "organizations_url": "https://api.github.com/users/cozyGalvinism/orgs", "repos_url": "https://api.github.com/users/cozyGalvinism/repos", "events_url": "https://api.github.com/users/cozyGalvinism/events{/privacy}", "received_events_url": "https://api.github.com/users/cozyGalvinism/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 251130942, "node_id": "MDU6TGFiZWwyNTExMzA5NDI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/duplicate", "name": "duplicate", "color": "cccccc", "default": true, "description": "This is a duplicate of another issue or PR."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-04-05T21:33:14Z", "updated_at": "2017-05-21T05:11:41Z", "closed_at": "2017-05-21T05:11:41Z", "author_association": "NONE", "active_lock_reason": null, "body": "If you try to use the logs_from generator, the generator contains every message 50 times.\r\n\r\nExample:\r\n```py\r\nts = message.timestamp\r\nd = datetime.timedelta(days=1)\r\nt = ts - d\r\nmessages = yield from client.logs_from(channel, limit=5000, before=ts, after=t) #after fetching, contains every message 50 times\r\nfor m in messages:\r\n    print(m)\r\n```\r\nreturns (if only 1 message had been sent in a span of 1 day)\r\n```\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\nMessage 1\r\n```", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/527/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/527/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/504", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/504/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/504/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/504/events", "html_url": "https://github.com/Rapptz/discord.py/issues/504", "id": 212354407, "node_id": "MDU6SXNzdWUyMTIzNTQ0MDc=", "number": 504, "title": "Voice seems to have problems with uvloop", "user": {"login": "khazhyk", "id": 1542025, "node_id": "MDQ6VXNlcjE1NDIwMjU=", "avatar_url": "https://avatars.githubusercontent.com/u/1542025?v=4", "gravatar_id": "", "url": "https://api.github.com/users/khazhyk", "html_url": "https://github.com/khazhyk", "followers_url": "https://api.github.com/users/khazhyk/followers", "following_url": "https://api.github.com/users/khazhyk/following{/other_user}", "gists_url": "https://api.github.com/users/khazhyk/gists{/gist_id}", "starred_url": "https://api.github.com/users/khazhyk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/khazhyk/subscriptions", "organizations_url": "https://api.github.com/users/khazhyk/orgs", "repos_url": "https://api.github.com/users/khazhyk/repos", "events_url": "https://api.github.com/users/khazhyk/events{/privacy}", "received_events_url": "https://api.github.com/users/khazhyk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-03-07T07:44:35Z", "updated_at": "2017-03-07T08:07:41Z", "closed_at": "2017-03-07T08:07:40Z", "author_association": "COLLABORATOR", "active_lock_reason": null, "body": "```\r\n[2017-03-07 02:40:48,698][asyncio][ERROR] Task exception was never retrieved\r\nfuture: <Task finished coro=<VoiceClient.poll_voice_ws() done, defined at /var/lib/spoobeta/venv/lib/python3.5/site-packages/discord/voice_client.py:265> exception=ConnectionClosed('WebSocket connection is closed: code = 1002, no reason.'\r\n,)>\r\nTraceback (most recent call last):\r\n  File \"/var/lib/spoobeta/venv/lib/python3.5/site-packages/discord/gateway.py\", line 627, in poll_event\r\n    msg = yield from asyncio.wait_for(self.recv(), timeout=30.0, loop=self.loop)\r\n  File \"/usr/lib/python3.5/asyncio/tasks.py\", line 392, in wait_for\r\n    return fut.result()\r\n  File \"uvloop/future.pyx\", line 146, in uvloop.loop.BaseFuture.result (uvloop/loop.c:108166)\r\n  File \"uvloop/future.pyx\", line 101, in uvloop.loop.BaseFuture._result_impl (uvloop/loop.c:107674)\r\n  File \"uvloop/future.pyx\", line 372, in uvloop.loop.BaseTask._fast_step (uvloop/loop.c:111405)\r\n  File \"/var/lib/spoobeta/venv/lib/python3.5/site-packages/websockets/protocol.py\", line 298, in recv\r\n    raise ConnectionClosed(self.close_code, self.close_reason)\r\nwebsockets.exceptions.ConnectionClosed: WebSocket connection is closed: code = 1002, no reason.\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"uvloop/future.pyx\", line 372, in uvloop.loop.BaseTask._fast_step (uvloop/loop.c:111405)\r\n  File \"/var/lib/spoobeta/venv/lib/python3.5/site-packages/discord/voice_client.py\", line 272, in poll_voice_ws\r\n    yield from self.ws.poll_event()\r\n  File \"/var/lib/spoobeta/venv/lib/python3.5/site-packages/discord/gateway.py\", line 630, in poll_event\r\n    raise ConnectionClosed(e) from e\r\ndiscord.errors.ConnectionClosed: WebSocket connection is closed: code = 1002, no reason.\r\n```\r\n\r\n\r\nwebsocket 1002 is \"protocol error\"", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/504/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/504/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/501", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/501/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/501/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/501/events", "html_url": "https://github.com/Rapptz/discord.py/issues/501", "id": 211940517, "node_id": "MDU6SXNzdWUyMTE5NDA1MTc=", "number": 501, "title": "KeepAliveHandler stopped.", "user": {"login": "khazhyk", "id": 1542025, "node_id": "MDQ6VXNlcjE1NDIwMjU=", "avatar_url": "https://avatars.githubusercontent.com/u/1542025?v=4", "gravatar_id": "", "url": "https://api.github.com/users/khazhyk", "html_url": "https://github.com/khazhyk", "followers_url": "https://api.github.com/users/khazhyk/followers", "following_url": "https://api.github.com/users/khazhyk/following{/other_user}", "gists_url": "https://api.github.com/users/khazhyk/gists{/gist_id}", "starred_url": "https://api.github.com/users/khazhyk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/khazhyk/subscriptions", "organizations_url": "https://api.github.com/users/khazhyk/orgs", "repos_url": "https://api.github.com/users/khazhyk/repos", "events_url": "https://api.github.com/users/khazhyk/events{/privacy}", "received_events_url": "https://api.github.com/users/khazhyk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2017-03-05T09:07:29Z", "updated_at": "2017-05-21T05:31:31Z", "closed_at": "2017-05-21T05:31:31Z", "author_association": "COLLABORATOR", "active_lock_reason": null, "body": "Bot hadn't received a message for 2 days, but hadn't reconnected. Noticed the KeepAliveHandler had been stopped.\r\n`bot.ws._keep_alive`\r\n<KeepAliveHandler(Thread-6, stopped daemon 140053601072896)>\r\n\r\nGateway stopped on Mar 3rd, and I do not see a corresponding \"We have stopped responding to the gateway.\" log, which would seem to mean the KeepAliveHandler was stopped for some reason other than the heartbeat failing to respond.\r\n\r\nI do see the warning logs in other cases, so it does seem to work as expected most of the time.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/501/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/501/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/494", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/494/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/494/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/494/events", "html_url": "https://github.com/Rapptz/discord.py/issues/494", "id": 210211017, "node_id": "MDU6SXNzdWUyMTAyMTEwMTc=", "number": 494, "title": "asyncio.wait doesn't raise TimeoutError", "user": {"login": "sgtlaggy", "id": 8661717, "node_id": "MDQ6VXNlcjg2NjE3MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/8661717?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sgtlaggy", "html_url": "https://github.com/sgtlaggy", "followers_url": "https://api.github.com/users/sgtlaggy/followers", "following_url": "https://api.github.com/users/sgtlaggy/following{/other_user}", "gists_url": "https://api.github.com/users/sgtlaggy/gists{/gist_id}", "starred_url": "https://api.github.com/users/sgtlaggy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sgtlaggy/subscriptions", "organizations_url": "https://api.github.com/users/sgtlaggy/orgs", "repos_url": "https://api.github.com/users/sgtlaggy/repos", "events_url": "https://api.github.com/users/sgtlaggy/events{/privacy}", "received_events_url": "https://api.github.com/users/sgtlaggy/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2017-02-25T04:57:14Z", "updated_at": "2017-02-25T05:05:48Z", "closed_at": "2017-02-25T05:05:34Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "See the note in the Python docs [here](https://docs.python.org/3/library/asyncio-task.html#asyncio.wait).\r\n\r\nIn `rewrite` `state.py` lines 219, 497, 776 it's used expecting TimeoutError to be raised, but used correctly in `shard.py` L223.\r\n\r\nIn `async` `state.py` lines 190, 494 it's used expecting TimeoutError to be raised.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/494/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/494/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/437", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/437/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/437/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/437/events", "html_url": "https://github.com/Rapptz/discord.py/issues/437", "id": 198592694, "node_id": "MDU6SXNzdWUxOTg1OTI2OTQ=", "number": 437, "title": "[rewrite] TextChannel doesn't have `is_private`, Messageable.typing doesn't have `__exit__` or `__aexit__`", "user": {"login": "sgtlaggy", "id": 8661717, "node_id": "MDQ6VXNlcjg2NjE3MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/8661717?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sgtlaggy", "html_url": "https://github.com/sgtlaggy", "followers_url": "https://api.github.com/users/sgtlaggy/followers", "following_url": "https://api.github.com/users/sgtlaggy/following{/other_user}", "gists_url": "https://api.github.com/users/sgtlaggy/gists{/gist_id}", "starred_url": "https://api.github.com/users/sgtlaggy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sgtlaggy/subscriptions", "organizations_url": "https://api.github.com/users/sgtlaggy/orgs", "repos_url": "https://api.github.com/users/sgtlaggy/repos", "events_url": "https://api.github.com/users/sgtlaggy/events{/privacy}", "received_events_url": "https://api.github.com/users/sgtlaggy/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 511299952, "node_id": "MDU6TGFiZWw1MTEyOTk5NTI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/v1.0-alpha", "name": "v1.0-alpha", "color": "0052cc", "default": false, "description": "This pertains to the rewrite version"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-01-03T23:08:52Z", "updated_at": "2017-01-04T02:00:07Z", "closed_at": "2017-01-04T01:59:07Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "```py\r\nTraceback (most recent call last):\r\n  File \".../env/lib/python3.5/site-packages/discord/ext/commands/core.py\", line 47, in wrapped\r\n    ret = yield from coro(*args, **kwargs)\r\n  File \".../env/lib/python3.5/site-packages/discord/ext/commands/bot.py\", line 88, in _default_help_command\r\n    pages = bot.formatter.format_help_for(ctx, bot)\r\n  File \".../env/lib/python3.5/site-packages/discord/ext/commands/formatter.py\", line 291, in format_help_for\r\n    return self.format()\r\n  File \".../env/lib/python3.5/site-packages/discord/ext/commands/formatter.py\", line 336, in format\r\n    data = sorted(self.filter_command_list(), key=category)\r\n  File \".../env/lib/python3.5/site-packages/discord/ext/commands/formatter.py\", line 255, in predicate\r\n    return cmd.can_run(self.context) and self.context.bot.can_run(self.context)\r\n  File \".../env/lib/python3.5/site-packages/discord/ext/commands/core.py\", line 430, in can_run\r\n    return all(predicate(context) for predicate in predicates)\r\n  File \".../env/lib/python3.5/site-packages/discord/ext/commands/core.py\", line 430, in <genexpr>\r\n    return all(predicate(context) for predicate in predicates)\r\n  File \".../env/lib/python3.5/site-packages/discord/ext/commands/core.py\", line 871, in predicate\r\n    me = ch.guild.me if not ch.is_private else ctx.bot.user\r\nAttributeError: 'TextChannel' object has no attribute 'is_private'\r\n```\r\nWhen calling the default help command.\r\n\r\nAlso when using (`async`) `with ctx.typing()` in a command, I get an AttributeError about it not having `__exit__` or `__aexit__`, respectively.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/437/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/437/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/431", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/431/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/431/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/431/events", "html_url": "https://github.com/Rapptz/discord.py/issues/431", "id": 198275612, "node_id": "MDU6SXNzdWUxOTgyNzU2MTI=", "number": 431, "title": "'ready' event does not wait for guild_sync to finish", "user": {"login": "Sir-Fancy", "id": 1977122, "node_id": "MDQ6VXNlcjE5NzcxMjI=", "avatar_url": "https://avatars.githubusercontent.com/u/1977122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Sir-Fancy", "html_url": "https://github.com/Sir-Fancy", "followers_url": "https://api.github.com/users/Sir-Fancy/followers", "following_url": "https://api.github.com/users/Sir-Fancy/following{/other_user}", "gists_url": "https://api.github.com/users/Sir-Fancy/gists{/gist_id}", "starred_url": "https://api.github.com/users/Sir-Fancy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Sir-Fancy/subscriptions", "organizations_url": "https://api.github.com/users/Sir-Fancy/orgs", "repos_url": "https://api.github.com/users/Sir-Fancy/repos", "events_url": "https://api.github.com/users/Sir-Fancy/events{/privacy}", "received_events_url": "https://api.github.com/users/Sir-Fancy/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 251130947, "node_id": "MDU6TGFiZWwyNTExMzA5NDc=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/wontfix", "name": "wontfix", "color": "ffffff", "default": true, "description": "This will not be worked on."}, {"id": 511299952, "node_id": "MDU6TGFiZWw1MTEyOTk5NTI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/v1.0-alpha", "name": "v1.0-alpha", "color": "0052cc", "default": false, "description": "This pertains to the rewrite version"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/3", "html_url": "https://github.com/Rapptz/discord.py/milestone/3", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/3/labels", "id": 1428573, "node_id": "MDk6TWlsZXN0b25lMTQyODU3Mw==", "number": 3, "title": "Soon\u2122", "description": "A future version of discord.py", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 19, "state": "open", "created_at": "2015-11-25T03:19:14Z", "updated_at": "2022-03-16T06:16:52Z", "due_on": null, "closed_at": null}, "comments": 8, "created_at": "2017-01-01T17:54:14Z", "updated_at": "2020-05-10T23:42:37Z", "closed_at": "2020-05-10T23:42:37Z", "author_association": "NONE", "active_lock_reason": null, "body": "The following script is _supposed to_ print all of the games currently being played by members of a server. For some reason, for a server of over 25,000 members, it only prints 12 of them. I talked to a few people in the discord-api server and they are stumped as well. I am on the latest async dev branch, and I tried on stable too.\r\nThe script:\r\n```#!/usr/local/bin/python3.5\r\nimport discord\r\nimport asyncio\r\nimport requests\r\nfrom discord.ext import commands\r\n\r\nbot = commands.Bot(command_prefix='[',self_bot=True)\r\ntoken = \"<token>\"\r\n\r\n@bot.event\r\nasync def on_ready():\r\n    print(\"----------\")\r\n    print(\"Logged in as:\")\r\n    print(\"    \"+str(bot.user.name))\r\n    print(\"    \"+str(bot.user.id))\r\n    print(\"----------\")\r\n    lf = bot.get_server(\"<server_id>\")\r\n    with open(\"mems.txt\", \"w\") as m:\r\n        print(len(lf.members))\r\n        for mem in lf.members:\r\n            if mem.game != None:\r\n                print(mem.game.name)\r\n                #m.write(\"{}\\n\".format(mem.game.name))\r\n    print(\"\\n\\nDone.\")\r\n    \r\nif __name__ == \"__main__\":\r\n    bot.run(token, bot=False)```", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/431/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/431/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/426", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/426/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/426/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/426/events", "html_url": "https://github.com/Rapptz/discord.py/issues/426", "id": 198235722, "node_id": "MDU6SXNzdWUxOTgyMzU3MjI=", "number": 426, "title": "Commands ext overwrites `instance` when adding a cog", "user": {"login": "Fuyukai", "id": 8783751, "node_id": "MDQ6VXNlcjg3ODM3NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/8783751?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Fuyukai", "html_url": "https://github.com/Fuyukai", "followers_url": "https://api.github.com/users/Fuyukai/followers", "following_url": "https://api.github.com/users/Fuyukai/following{/other_user}", "gists_url": "https://api.github.com/users/Fuyukai/gists{/gist_id}", "starred_url": "https://api.github.com/users/Fuyukai/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Fuyukai/subscriptions", "organizations_url": "https://api.github.com/users/Fuyukai/orgs", "repos_url": "https://api.github.com/users/Fuyukai/repos", "events_url": "https://api.github.com/users/Fuyukai/events{/privacy}", "received_events_url": "https://api.github.com/users/Fuyukai/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 511299952, "node_id": "MDU6TGFiZWw1MTEyOTk5NTI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/v1.0-alpha", "name": "v1.0-alpha", "color": "0052cc", "default": false, "description": "This pertains to the rewrite version"}], "state": "closed", "locked": false, "assignee": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5", "html_url": "https://github.com/Rapptz/discord.py/milestone/5", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5/labels", "id": 1941273, "node_id": "MDk6TWlsZXN0b25lMTk0MTI3Mw==", "number": 5, "title": "Rewrite", "description": "Things that will be taken care of before rewrite releases.", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 58, "state": "closed", "created_at": "2016-08-14T22:10:38Z", "updated_at": "2020-06-28T06:46:14Z", "due_on": null, "closed_at": "2019-04-10T01:57:54Z"}, "comments": 5, "created_at": "2016-12-31T15:15:06Z", "updated_at": "2019-02-23T09:37:15Z", "closed_at": "2019-02-23T09:37:15Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Opening because I don't know if this is fixed in rewrite.\r\n\r\nWhen having multiple bots running in the same process, the `instance` property of the cog object created is always set to the last bot that claims the cog, due to the Command instance staying between object creation, as they're members of the type.\r\n\r\nTake this example code:\r\n\r\n```py\r\nclass Example(object):\r\n     def __init__(self, bot, a: int):\r\n        self.bot = bot\r\n        self.a = a\r\n\r\n    @commands.command()\r\n    async def d():\r\n        await self.bot.say(self.a)\r\n\r\nbot1 = Bot(command_prefix=\"!\")\r\nbot1.add_cog(Example(bot1, 1))\r\n\r\nbot2 = Bot(command_prefix=\"?\")\r\nbot2.add_cog(Example(bot2, 2))\r\n```\r\n\r\nWhen `?d` is called, it will correctly respond with `2`. However, when `!d` is called, it will respond with `2` due to the second `add_cog` call overwriting `instance` on the Command object representing the `d` command.\r\n\r\nThis can also cause problems with multi-threaded bots where separate instances of loops running in threads return the wrong loop when `.say()` or similar is called, due to the loop being from another thread.\r\n\r\nA workaround is to use `ctx.bot`, but this causes problems when you need to access other self attributes specific to that cog.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/426/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/426/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/421", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/421/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/421/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/421/events", "html_url": "https://github.com/Rapptz/discord.py/issues/421", "id": 196654088, "node_id": "MDU6SXNzdWUxOTY2NTQwODg=", "number": 421, "title": "Silent crash (exception in background task)", "user": {"login": "Budovi", "id": 23473432, "node_id": "MDQ6VXNlcjIzNDczNDMy", "avatar_url": "https://avatars.githubusercontent.com/u/23473432?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Budovi", "html_url": "https://github.com/Budovi", "followers_url": "https://api.github.com/users/Budovi/followers", "following_url": "https://api.github.com/users/Budovi/following{/other_user}", "gists_url": "https://api.github.com/users/Budovi/gists{/gist_id}", "starred_url": "https://api.github.com/users/Budovi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Budovi/subscriptions", "organizations_url": "https://api.github.com/users/Budovi/orgs", "repos_url": "https://api.github.com/users/Budovi/repos", "events_url": "https://api.github.com/users/Budovi/events{/privacy}", "received_events_url": "https://api.github.com/users/Budovi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5", "html_url": "https://github.com/Rapptz/discord.py/milestone/5", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5/labels", "id": 1941273, "node_id": "MDk6TWlsZXN0b25lMTk0MTI3Mw==", "number": 5, "title": "Rewrite", "description": "Things that will be taken care of before rewrite releases.", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 58, "state": "closed", "created_at": "2016-08-14T22:10:38Z", "updated_at": "2020-06-28T06:46:14Z", "due_on": null, "closed_at": "2019-04-10T01:57:54Z"}, "comments": 1, "created_at": "2016-12-20T11:52:46Z", "updated_at": "2017-05-21T05:13:46Z", "closed_at": "2017-05-21T05:13:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "My bot has \"silently crashed\" today, i.e. the exception was not propagated to my code to be handled (according to the trace, not even library code). Even worse, the bot has become unresponsive to commands, and thus I was unable to restart it using a command.\r\n\r\nThe following trace was repeated on the output several (4) times:\r\n```python\r\nTask exception was never retrieved\r\nfuture: <Task finished coro=<VoiceClient.poll_voice_ws() done, defined at /usr/local/lib/python3.5/dist-packages/discord/voice_client.py:265> exception=ConnectionClosed('WebSocket connection is closed: code = 4015, reason = Voice server crashed..',)>\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.5/dist-packages/discord/gateway.py\", line 614, in poll_event\r\n    msg = yield from asyncio.wait_for(self.recv(), timeout=30.0, loop=self.loop)\r\n  File \"/usr/lib/python3.5/asyncio/tasks.py\", line 392, in wait_for\r\n    return fut.result()\r\n  File \"/usr/lib/python3.5/asyncio/futures.py\", line 274, in result\r\n    raise self._exception\r\n  File \"/usr/lib/python3.5/asyncio/tasks.py\", line 239, in _step\r\n    result = coro.send(None)\r\n  File \"/usr/local/lib/python3.5/dist-packages/websockets/protocol.py\", line 298, in recv\r\n    raise ConnectionClosed(self.close_code, self.close_reason)\r\nwebsockets.exceptions.ConnectionClosed: WebSocket connection is closed: code = 4015, reason = Voice server crashed..\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3.5/asyncio/tasks.py\", line 239, in _step\r\n    result = coro.send(None)\r\n  File \"/usr/local/lib/python3.5/dist-packages/discord/voice_client.py\", line 272, in poll_voice_ws\r\n    yield from self.ws.poll_event()\r\n  File \"/usr/local/lib/python3.5/dist-packages/discord/gateway.py\", line 617, in poll_event\r\n    raise ConnectionClosed(e) from e\r\ndiscord.errors.ConnectionClosed: WebSocket connection is closed: code = 4015, reason = Voice server crashed..\r\n```\r\n\r\n**The bot was still using a discord.py version 0.15.1 when this happened.** If this was fixed in the meantime, I'm sorry, I cannot trigger this error reliably to test with a new library version.\r\n\r\nIn any case, all exceptions should be retrieved and if not handled (e.g. retry inside a library) they should be passed to `on_error` event handler so that no silent crashes occurs. Bots can only recover from errors programmatically (not a big deal) if such exceptions can be detected.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/421/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/421/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/420", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/420/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/420/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/420/events", "html_url": "https://github.com/Rapptz/discord.py/issues/420", "id": 196650062, "node_id": "MDU6SXNzdWUxOTY2NTAwNjI=", "number": 420, "title": "Bot/Client does not run inside a given asyncio loop", "user": {"login": "Budovi", "id": 23473432, "node_id": "MDQ6VXNlcjIzNDczNDMy", "avatar_url": "https://avatars.githubusercontent.com/u/23473432?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Budovi", "html_url": "https://github.com/Budovi", "followers_url": "https://api.github.com/users/Budovi/followers", "following_url": "https://api.github.com/users/Budovi/following{/other_user}", "gists_url": "https://api.github.com/users/Budovi/gists{/gist_id}", "starred_url": "https://api.github.com/users/Budovi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Budovi/subscriptions", "organizations_url": "https://api.github.com/users/Budovi/orgs", "repos_url": "https://api.github.com/users/Budovi/repos", "events_url": "https://api.github.com/users/Budovi/events{/privacy}", "received_events_url": "https://api.github.com/users/Budovi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2016-12-20T11:30:58Z", "updated_at": "2016-12-21T08:53:55Z", "closed_at": "2016-12-21T05:03:33Z", "author_association": "NONE", "active_lock_reason": null, "body": "When creating a `discord.Client` or `discord.ext.commands.Bot`, you have an option to pass an event loop for the Client to use.\r\n\r\n> **loop** (*Optional[event loop].*) \u2013 The event loop to use for asynchronous operations. Defaults to `None`, in which case the default event loop is used via `asyncio.get_event_loop()`.\r\n\r\nA lot of calls in the library do not respect this choice, and a default event loop is used instead. You can find a lot of examples just by searching for `asyncio.sleep(` in the library code, where the loop needs to be passed as an argument.\r\n\r\nThis option does not make sense if broken, and thus\r\n* it should be either removed, or\r\n* it should be fixed so that the library only uses the loop provided, or\r\n* it should be clarified what operations is the given loop used for.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/420/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/420/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/416", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/416/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/416/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/416/events", "html_url": "https://github.com/Rapptz/discord.py/issues/416", "id": 195717960, "node_id": "MDU6SXNzdWUxOTU3MTc5NjA=", "number": 416, "title": "Chunking woes with listeners never returning.", "user": {"login": "khazhyk", "id": 1542025, "node_id": "MDQ6VXNlcjE1NDIwMjU=", "avatar_url": "https://avatars.githubusercontent.com/u/1542025?v=4", "gravatar_id": "", "url": "https://api.github.com/users/khazhyk", "html_url": "https://github.com/khazhyk", "followers_url": "https://api.github.com/users/khazhyk/followers", "following_url": "https://api.github.com/users/khazhyk/following{/other_user}", "gists_url": "https://api.github.com/users/khazhyk/gists{/gist_id}", "starred_url": "https://api.github.com/users/khazhyk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/khazhyk/subscriptions", "organizations_url": "https://api.github.com/users/khazhyk/orgs", "repos_url": "https://api.github.com/users/khazhyk/repos", "events_url": "https://api.github.com/users/khazhyk/events{/privacy}", "received_events_url": "https://api.github.com/users/khazhyk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2016-12-15T05:04:58Z", "updated_at": "2016-12-19T05:49:50Z", "closed_at": "2016-12-19T05:49:50Z", "author_association": "COLLABORATOR", "active_lock_reason": null, "body": "Chunking listeners sometimes never return (~ state.py:184 , asyncio.wait(chunks) ).\r\n\r\nThis results in\r\n - old references being held to members and servers resulting in potential memory leak.\r\n - (perhaps) some servers never properly chunking.\r\n\r\n\r\nI'm not sure why these listeners never return, but checking bot._listeners often is not empty even well after ready.", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/416/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/416/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/388", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/388/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/388/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/388/events", "html_url": "https://github.com/Rapptz/discord.py/issues/388", "id": 187928352, "node_id": "MDU6SXNzdWUxODc5MjgzNTI=", "number": 388, "title": "Check for heartbeat acknowledgements, timeout if they are absent.", "user": {"login": "khazhyk", "id": 1542025, "node_id": "MDQ6VXNlcjE1NDIwMjU=", "avatar_url": "https://avatars.githubusercontent.com/u/1542025?v=4", "gravatar_id": "", "url": "https://api.github.com/users/khazhyk", "html_url": "https://github.com/khazhyk", "followers_url": "https://api.github.com/users/khazhyk/followers", "following_url": "https://api.github.com/users/khazhyk/following{/other_user}", "gists_url": "https://api.github.com/users/khazhyk/gists{/gist_id}", "starred_url": "https://api.github.com/users/khazhyk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/khazhyk/subscriptions", "organizations_url": "https://api.github.com/users/khazhyk/orgs", "repos_url": "https://api.github.com/users/khazhyk/repos", "events_url": "https://api.github.com/users/khazhyk/events{/privacy}", "received_events_url": "https://api.github.com/users/khazhyk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5", "html_url": "https://github.com/Rapptz/discord.py/milestone/5", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5/labels", "id": 1941273, "node_id": "MDk6TWlsZXN0b25lMTk0MTI3Mw==", "number": 5, "title": "Rewrite", "description": "Things that will be taken care of before rewrite releases.", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 58, "state": "closed", "created_at": "2016-08-14T22:10:38Z", "updated_at": "2020-06-28T06:46:14Z", "due_on": null, "closed_at": "2019-04-10T01:57:54Z"}, "comments": 0, "created_at": "2016-11-08T08:19:44Z", "updated_at": "2017-02-15T04:19:54Z", "closed_at": "2017-02-15T04:19:54Z", "author_association": "COLLABORATOR", "active_lock_reason": null, "body": "It is possible (and unfortunately not uncommon) for websocket connections to close in such a way that the client never sees the websocket connection close, and \"successfully\" sends messages into the void, but never receives any responses. The client should check that heartbeats are being acknowledged in a timely fashion, and consider the connection dead if they are not (and attempt a reconnect).", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/388/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/388/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/360", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/360/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/360/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/360/events", "html_url": "https://github.com/Rapptz/discord.py/issues/360", "id": 182941165, "node_id": "MDU6SXNzdWUxODI5NDExNjU=", "number": 360, "title": "My bot has an issue with returning None for member.voice_channel", "user": {"login": "Alkovalic", "id": 22827572, "node_id": "MDQ6VXNlcjIyODI3NTcy", "avatar_url": "https://avatars.githubusercontent.com/u/22827572?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Alkovalic", "html_url": "https://github.com/Alkovalic", "followers_url": "https://api.github.com/users/Alkovalic/followers", "following_url": "https://api.github.com/users/Alkovalic/following{/other_user}", "gists_url": "https://api.github.com/users/Alkovalic/gists{/gist_id}", "starred_url": "https://api.github.com/users/Alkovalic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Alkovalic/subscriptions", "organizations_url": "https://api.github.com/users/Alkovalic/orgs", "repos_url": "https://api.github.com/users/Alkovalic/repos", "events_url": "https://api.github.com/users/Alkovalic/events{/privacy}", "received_events_url": "https://api.github.com/users/Alkovalic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}, {"id": 251130942, "node_id": "MDU6TGFiZWwyNTExMzA5NDI=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/duplicate", "name": "duplicate", "color": "cccccc", "default": true, "description": "This is a duplicate of another issue or PR."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2016-10-14T01:11:43Z", "updated_at": "2016-10-14T13:29:45Z", "closed_at": "2016-10-14T13:29:44Z", "author_association": "NONE", "active_lock_reason": null, "body": "My bot takes `message.author.voice_channel` upon a summon command, and joins that particular channel.\n(using the `message` obtained via `on_message`)\n\n`voice = await self.join_voice_channel(message.author.voice_channel)`\n\nHowever, `message.author.voice_channel` returns `None` unless the user switches voice channels before summoning it.\n\nThe exception is myself:  if I use the summon command, then the bot joins the channel without issue, without me changing voice channels beforehand.\n\nHow do I get `message.author.voice_channel` to return the voice channel the user is in without having them switch voice channels beforehand?\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/360/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/360/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/340", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/340/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/340/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/340/events", "html_url": "https://github.com/Rapptz/discord.py/issues/340", "id": 179213506, "node_id": "MDU6SXNzdWUxNzkyMTM1MDY=", "number": 340, "title": "Paginator creates pages longer than maxlen when lines longer than maxlen are added.", "user": {"login": "max-kamps", "id": 11182284, "node_id": "MDQ6VXNlcjExMTgyMjg0", "avatar_url": "https://avatars.githubusercontent.com/u/11182284?v=4", "gravatar_id": "", "url": "https://api.github.com/users/max-kamps", "html_url": "https://github.com/max-kamps", "followers_url": "https://api.github.com/users/max-kamps/followers", "following_url": "https://api.github.com/users/max-kamps/following{/other_user}", "gists_url": "https://api.github.com/users/max-kamps/gists{/gist_id}", "starred_url": "https://api.github.com/users/max-kamps/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/max-kamps/subscriptions", "organizations_url": "https://api.github.com/users/max-kamps/orgs", "repos_url": "https://api.github.com/users/max-kamps/repos", "events_url": "https://api.github.com/users/max-kamps/events{/privacy}", "received_events_url": "https://api.github.com/users/max-kamps/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2016-09-26T12:21:40Z", "updated_at": "2016-09-27T03:33:39Z", "closed_at": "2016-09-27T03:33:39Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "``````\n>>> from discord.ext import commands                               \n>>> pag = commands.Paginator()             \n>>> pag.add_line('x'*2000)                 \n>>> pag.pages                              \n['```\\n```', '```\\nxxxxx...xxxxxxx```']\n>>> len(pag.pages[1])                      \n2008                                                                                     \n``````\n\nPossible solutions:\n- Raise exception\n- Split lines that are too long\n- use `textwrap`\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/340/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/340/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/337", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/337/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/337/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/337/events", "html_url": "https://github.com/Rapptz/discord.py/issues/337", "id": 177684604, "node_id": "MDU6SXNzdWUxNzc2ODQ2MDQ=", "number": 337, "title": "voice_client.connect() can get stuck in an infinite loop", "user": {"login": "imayhaveborkedit", "id": 1907538, "node_id": "MDQ6VXNlcjE5MDc1Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1907538?v=4", "gravatar_id": "", "url": "https://api.github.com/users/imayhaveborkedit", "html_url": "https://github.com/imayhaveborkedit", "followers_url": "https://api.github.com/users/imayhaveborkedit/followers", "following_url": "https://api.github.com/users/imayhaveborkedit/following{/other_user}", "gists_url": "https://api.github.com/users/imayhaveborkedit/gists{/gist_id}", "starred_url": "https://api.github.com/users/imayhaveborkedit/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/imayhaveborkedit/subscriptions", "organizations_url": "https://api.github.com/users/imayhaveborkedit/orgs", "repos_url": "https://api.github.com/users/imayhaveborkedit/repos", "events_url": "https://api.github.com/users/imayhaveborkedit/events{/privacy}", "received_events_url": "https://api.github.com/users/imayhaveborkedit/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5", "html_url": "https://github.com/Rapptz/discord.py/milestone/5", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5/labels", "id": 1941273, "node_id": "MDk6TWlsZXN0b25lMTk0MTI3Mw==", "number": 5, "title": "Rewrite", "description": "Things that will be taken care of before rewrite releases.", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 58, "state": "closed", "created_at": "2016-08-14T22:10:38Z", "updated_at": "2020-06-28T06:46:14Z", "due_on": null, "closed_at": "2019-04-10T01:57:54Z"}, "comments": 5, "created_at": "2016-09-18T23:24:54Z", "updated_at": "2017-05-21T05:15:23Z", "closed_at": "2017-05-21T05:15:10Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "In a specific, unknown circumstance, voice_client.connect can get stuck in an infinite loop polling the ws for its secret key.  I'm not sure if this is because discord decided not to send it for whatever reason, or some other oversight.\n\n<!--\nTangentially related voice woes:\n- Discord just decides to not send the `voice_data_future` data until you reconnect and try again.\n-->\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/337/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/337/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/336", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/336/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/336/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/336/events", "html_url": "https://github.com/Rapptz/discord.py/issues/336", "id": 177669948, "node_id": "MDU6SXNzdWUxNzc2Njk5NDg=", "number": 336, "title": "Lib seems to fail parsing members if a guild is actually unavailable", "user": {"login": "Fuyukai", "id": 8783751, "node_id": "MDQ6VXNlcjg3ODM3NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/8783751?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Fuyukai", "html_url": "https://github.com/Fuyukai", "followers_url": "https://api.github.com/users/Fuyukai/followers", "following_url": "https://api.github.com/users/Fuyukai/following{/other_user}", "gists_url": "https://api.github.com/users/Fuyukai/gists{/gist_id}", "starred_url": "https://api.github.com/users/Fuyukai/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Fuyukai/subscriptions", "organizations_url": "https://api.github.com/users/Fuyukai/orgs", "repos_url": "https://api.github.com/users/Fuyukai/repos", "events_url": "https://api.github.com/users/Fuyukai/events{/privacy}", "received_events_url": "https://api.github.com/users/Fuyukai/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2016-09-18T19:11:02Z", "updated_at": "2017-05-31T01:48:49Z", "closed_at": "2016-12-17T02:58:17Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "If a server is unavailable due to an outage or something similar, the bot will fail to load due to an AttributeError on the server object.\n\n```\nTraceback (most recent call last):\n  File \"/usr/lib/python3.5/asyncio/tasks.py\", line 239, in _step\n    result = coro.send(None)\n  File \"discord/state.py\", line 179, in _delay_ready\n    chunks.extend(self.chunks_needed(server))\n  File \"discord/state.py\", line 162, in chunks_needed\n    for chunk in range(math.ceil(server._member_count / 1000)):\nAttributeError: _member_count\n```\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/336/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/336/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/329", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/329/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/329/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/329/events", "html_url": "https://github.com/Rapptz/discord.py/issues/329", "id": 176984192, "node_id": "MDU6SXNzdWUxNzY5ODQxOTI=", "number": 329, "title": "\"Unclosed client session\" error", "user": {"login": "mervynfoxe", "id": 183733, "node_id": "MDQ6VXNlcjE4MzczMw==", "avatar_url": "https://avatars.githubusercontent.com/u/183733?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mervynfoxe", "html_url": "https://github.com/mervynfoxe", "followers_url": "https://api.github.com/users/mervynfoxe/followers", "following_url": "https://api.github.com/users/mervynfoxe/following{/other_user}", "gists_url": "https://api.github.com/users/mervynfoxe/gists{/gist_id}", "starred_url": "https://api.github.com/users/mervynfoxe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mervynfoxe/subscriptions", "organizations_url": "https://api.github.com/users/mervynfoxe/orgs", "repos_url": "https://api.github.com/users/mervynfoxe/repos", "events_url": "https://api.github.com/users/mervynfoxe/events{/privacy}", "received_events_url": "https://api.github.com/users/mervynfoxe/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/4", "html_url": "https://github.com/Rapptz/discord.py/milestone/4", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/4/labels", "id": 1916994, "node_id": "MDk6TWlsZXN0b25lMTkxNjk5NA==", "number": 4, "title": "v0.12.0", "description": "Blocking issues for the next version of discord.py", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 3, "state": "closed", "created_at": "2016-08-01T22:46:05Z", "updated_at": "2019-03-06T07:37:32Z", "due_on": null, "closed_at": "2019-03-06T07:37:32Z"}, "comments": 11, "created_at": "2016-09-14T18:30:05Z", "updated_at": "2016-10-14T03:58:04Z", "closed_at": "2016-09-14T19:02:38Z", "author_association": "NONE", "active_lock_reason": null, "body": "I searched around a bit and saw some similar issues but the most definitive answer seemed to be \"there's an error in your bot's code.\" However I'm getting this error even trying to run the example programs provided in the repository (edit: looking at it now it seems to be due to the TypeError in gateway.py). Here's the traceback:\n\n```\nTraceback (most recent call last):\n  File \"./sample.py\", line 67, in <module>\n    bot.run(TOKEN)\n  File \"/home/alex/.local/lib/python3.5/site-packages/discord/client.py\", line 487, in run\n    self.loop.run_until_complete(self.start(*args, **kwargs))\n  File \"/usr/lib/python3.5/asyncio/base_events.py\", line 387, in run_until_complete\n    return future.result()\n  File \"/usr/lib/python3.5/asyncio/futures.py\", line 274, in result\n    raise self._exception\n  File \"/usr/lib/python3.5/asyncio/tasks.py\", line 239, in _step\n    result = coro.send(None)\n  File \"/home/alex/.local/lib/python3.5/site-packages/discord/client.py\", line 459, in start\n    yield from self.connect()\n  File \"/home/alex/.local/lib/python3.5/site-packages/discord/client.py\", line 412, in connect\n    self.ws = yield from DiscordWebSocket.from_client(self)\n  File \"/home/alex/.local/lib/python3.5/site-packages/discord/gateway.py\", line 174, in from_client\n    ws = yield from websockets.connect(gateway, loop=client.loop, klass=cls)\n  File \"/home/alex/.local/lib/python3.5/site-packages/websockets/py35/client.py\", line 19, in __await__\n    return (yield from self.client)\n  File \"/home/alex/.local/lib/python3.5/site-packages/websockets/client.py\", line 160, in connect\n    factory, wsuri.host, wsuri.port, **kwds)\n  File \"/usr/lib/python3.5/asyncio/base_events.py\", line 713, in create_connection\n    sock, protocol_factory, ssl, server_hostname)\n  File \"/usr/lib/python3.5/asyncio/base_events.py\", line 725, in _create_connection_transport\n    protocol = protocol_factory()\n  File \"/home/alex/.local/lib/python3.5/site-packages/websockets/client.py\", line 156, in <lambda>\n    loop=loop, legacy_recv=legacy_recv,\n  File \"/home/alex/.local/lib/python3.5/site-packages/discord/gateway.py\", line 158, in __init__\n    super().__init__(*args, max_size=None, **kwargs)\nTypeError: __init__() got multiple values for keyword argument 'max_size'\nUnclosed client session\nclient_session: <aiohttp.client.ClientSession object at 0x7fd109f74f98>\n```\n\nI'm not entirely sure what causes the \"**init**() got multiple values for keyword argument 'max_size'\" error but that seems to be breaking things.\nI can provide any other needed info but to answer the general questions: I'm running python 3.5, have all the listed requirements installed, and copy-pasted the \"basic_bot\" example verbatim, only adding in my token as a constant and passing that to `bot.run()` instead.\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/329/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/329/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/325", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/325/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/325/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/325/events", "html_url": "https://github.com/Rapptz/discord.py/issues/325", "id": 175723622, "node_id": "MDU6SXNzdWUxNzU3MjM2MjI=", "number": 325, "title": "[Commands] Cooldowns are being triggered for missing arguments.", "user": {"login": "Helehelehele", "id": 5507491, "node_id": "MDQ6VXNlcjU1MDc0OTE=", "avatar_url": "https://avatars.githubusercontent.com/u/5507491?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Helehelehele", "html_url": "https://github.com/Helehelehele", "followers_url": "https://api.github.com/users/Helehelehele/followers", "following_url": "https://api.github.com/users/Helehelehele/following{/other_user}", "gists_url": "https://api.github.com/users/Helehelehele/gists{/gist_id}", "starred_url": "https://api.github.com/users/Helehelehele/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Helehelehele/subscriptions", "organizations_url": "https://api.github.com/users/Helehelehele/orgs", "repos_url": "https://api.github.com/users/Helehelehele/repos", "events_url": "https://api.github.com/users/Helehelehele/events{/privacy}", "received_events_url": "https://api.github.com/users/Helehelehele/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2016-09-08T10:53:45Z", "updated_at": "2016-09-08T11:15:19Z", "closed_at": "2016-09-08T11:15:19Z", "author_association": "NONE", "active_lock_reason": null, "body": "@Twentysix26 brought this up in the API channel. \n\n> seems like the cooldown is triggered in any case, even when a command fails for missing required arguments. Is this intended?\n\nRight now, while invoking the command, `_verify_checks(ctx)` is called, which checks if command is on cooldown by calling `is_rate_limited`. Since `is_rate_limited` updates the attributes of cooldown, when we get errors such as `MissingRequiredArgument`, `BadArgument`, etc. we're putting the command on a cooldown, without being able to use it.\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/325/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/325/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/309", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/309/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/309/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/309/events", "html_url": "https://github.com/Rapptz/discord.py/issues/309", "id": 172322120, "node_id": "MDU6SXNzdWUxNzIzMjIxMjA=", "number": 309, "title": "KeepAliveHandler threads leak", "user": {"login": "Hornwitser", "id": 14362102, "node_id": "MDQ6VXNlcjE0MzYyMTAy", "avatar_url": "https://avatars.githubusercontent.com/u/14362102?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Hornwitser", "html_url": "https://github.com/Hornwitser", "followers_url": "https://api.github.com/users/Hornwitser/followers", "following_url": "https://api.github.com/users/Hornwitser/following{/other_user}", "gists_url": "https://api.github.com/users/Hornwitser/gists{/gist_id}", "starred_url": "https://api.github.com/users/Hornwitser/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Hornwitser/subscriptions", "organizations_url": "https://api.github.com/users/Hornwitser/orgs", "repos_url": "https://api.github.com/users/Hornwitser/repos", "events_url": "https://api.github.com/users/Hornwitser/events{/privacy}", "received_events_url": "https://api.github.com/users/Hornwitser/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2016-08-21T13:54:18Z", "updated_at": "2016-09-16T12:24:52Z", "closed_at": "2016-09-16T12:24:52Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "By adding the following debug code to KeepAliveHandler in gateway.py, (basically assigning a number to each instance of the keep alive handler started, and then printing it when it starts and stops).\n\n``` diff\ndiff --git a/discord/gateway.py b/discord/gateway.py\nindex 7ba78b0..36b01f3 100644\n--- a/discord/gateway.py\n+++ b/discord/gateway.py\n@@ -65,7 +65,12 @@ class KeepAliveHandler(threading.Thread):\n         self.msg = 'Keeping websocket alive with sequence {0[d]}'\n         self._stop_ev = threading.Event()\n\n+    count = 0\n     def run(self):\n+      try:\n+        count = KeepAliveHandler.count\n+        KeepAliveHandler.count += 1\n+        print(\"Keep alive\", count, \"started\")\n         while not self._stop_ev.wait(self.interval):\n             data = self.get_payload()\n             log.debug(self.msg.format(data))\n@@ -76,6 +81,8 @@ class KeepAliveHandler(threading.Thread):\n                 f.result()\n             except Exception:\n                 self.stop()\n+      finally:\n+        print(\"Keep alive\", count, \"stopped\")\n\n     def get_payload(self):\n         return {\n\n```\n\nI get the following printed out in the console when running my bot for a long time\n\n```\n[... snip ...]\nINFO:discord.gateway:sent the resume payload to create the websocket\nINFO:discord.gateway:Websocket closed with 1001 (), attempting a reconnect.\nINFO:discord.client:Got ResumeWebSocket\nINFO:discord.gateway:Created websocket connected to wss://gateway.discord.gg?enc\noding=json&v=5\nKeep alive 4 started\nINFO:discord.gateway:sent the resume payload to create the websocket\nINFO:discord.gateway:Websocket closed with 1001 (CloudFlare WebSocket proxy rest\narting), attempting a reconnect.\nINFO:discord.client:Got ResumeWebSocket\nINFO:discord.gateway:Created websocket connected to wss://gateway.discord.gg?enc\noding=json&v=5\nKeep alive 5 started\nINFO:discord.gateway:sent the resume payload to create the websocket\nINFO:discord.gateway:Created websocket connected to wss://gateway.discord.gg?enc\noding=json&v=5\nKeep alive 6 started\nINFO:discord.gateway:sent the identify payload to create the websocket\nKeep alive 5 stopped\nINFO:discord.gateway:Websocket closed with 1001 (), attempting a reconnect.\nINFO:discord.client:Got ResumeWebSocket\nINFO:discord.gateway:Created websocket connected to wss://gateway.discord.gg?enc\noding=json&v=5\nKeep alive 7 started\nINFO:discord.gateway:sent the resume payload to create the websocket\nINFO:websockets.protocol:Failing the WebSocket connection: 1006\nINFO:discord.gateway:Websocket closed with 1006 (), attempting a reconnect.\nINFO:discord.client:Got ResumeWebSocket\nINFO:discord.gateway:Created websocket connected to wss://gateway.discord.gg?enc\noding=json&v=5\nKeep alive 8 started\n\n[... snip ..]\n\nINFO:websockets.protocol:Failing the WebSocket connection: 1006\nINFO:discord.gateway:Websocket closed with 1006 (), attempting a reconnect.\nINFO:discord.client:Got ResumeWebSocket\nINFO:discord.gateway:Created websocket connected to wss://gateway.discord.gg?enc\noding=json&v=5\nKeep alive 13 started\nINFO:discord.gateway:sent the resume payload to create the websocket\nINFO:websockets.protocol:Failing the WebSocket connection: 1006\nINFO:discord.gateway:Websocket closed with 1006 (), attempting a reconnect.\nINFO:discord.client:Got ResumeWebSocket\nINFO:discord.gateway:Created websocket connected to wss://gateway.discord.gg?enc\noding=json&v=5\nKeep alive 14 started\nINFO:discord.gateway:sent the resume payload to create the websocket\nINFO:discord.gateway:Websocket closed with 1001 (), attempting a reconnect.\nINFO:discord.client:Got ResumeWebSocket\nINFO:discord.gateway:Created websocket connected to wss://gateway.discord.gg?enc\noding=json&v=5\nKeep alive 15 started\nINFO:discord.gateway:sent the resume payload to create the websocket\nINFO:discord.gateway:Websocket closed with 1001 (), attempting a reconnect.\nINFO:discord.client:Got ResumeWebSocket\nINFO:discord.gateway:Created websocket connected to wss://gateway.discord.gg?enc\noding=json&v=5\nINFO:discord.gateway:sent the resume payload to create the websocket\nKeep alive 16 started\n\n[... snip ...]\n\nINFO:discord.gateway:Websocket closed with 1001 (CloudFlare WebSocket proxy rest\narting), attempting a reconnect.\nINFO:discord.client:Got ResumeWebSocket\nINFO:discord.gateway:Created websocket connected to wss://gateway.discord.gg?enc\noding=json&v=5\nINFO:discord.gateway:sent the resume payload to create the websocket\nKeep alive 22 started\nshutdown\nKeep alive 22 stopped\n\n[... snip exception unrelated to this issue ...]\n```\n\nIndicating that these keep alive threads do not die.  Only two out of 23 threads spawned has the corresponding stopped message appear.  The bot ran on v0.10.0 of the library.\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/309/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/309/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/291", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/291/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/291/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/291/events", "html_url": "https://github.com/Rapptz/discord.py/issues/291", "id": 169539353, "node_id": "MDU6SXNzdWUxNjk1MzkzNTM=", "number": 291, "title": "create_ffmpeg_player stream randomly disconnects with \"OSError Network Unreachable\", does not pass this error to onerror, simply stops playing.", "user": {"login": "Dizzy611", "id": 301699, "node_id": "MDQ6VXNlcjMwMTY5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/301699?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dizzy611", "html_url": "https://github.com/Dizzy611", "followers_url": "https://api.github.com/users/Dizzy611/followers", "following_url": "https://api.github.com/users/Dizzy611/following{/other_user}", "gists_url": "https://api.github.com/users/Dizzy611/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dizzy611/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dizzy611/subscriptions", "organizations_url": "https://api.github.com/users/Dizzy611/orgs", "repos_url": "https://api.github.com/users/Dizzy611/repos", "events_url": "https://api.github.com/users/Dizzy611/events{/privacy}", "received_events_url": "https://api.github.com/users/Dizzy611/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/4", "html_url": "https://github.com/Rapptz/discord.py/milestone/4", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/4/labels", "id": 1916994, "node_id": "MDk6TWlsZXN0b25lMTkxNjk5NA==", "number": 4, "title": "v0.12.0", "description": "Blocking issues for the next version of discord.py", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 3, "state": "closed", "created_at": "2016-08-01T22:46:05Z", "updated_at": "2019-03-06T07:37:32Z", "due_on": null, "closed_at": "2019-03-06T07:37:32Z"}, "comments": 2, "created_at": "2016-08-05T06:38:00Z", "updated_at": "2016-09-25T09:44:16Z", "closed_at": "2016-09-25T09:44:16Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'm trying to write a bot to connect an icecast stream to a discord voice channel, and while it has mostly gone okay, occasionally the voice connection from the bot seems to disconnect with a random \"OSError Network Unreachable\". I have a command in my bot where I can interactively stop and then start the create_ffmpeg_player stream, and this fixes it, but since I can't find a way to \"catch\" this OSError exception (it doesn't trigger the on_error handler) I can't automatically deal with this situation.\n\n```\nThe traceback is below:\nException in thread Thread-6:\nTraceback (most recent call last):\n  File \"/usr/lib/python3.5/threading.py\", line 914, in _bootstrap_inner\n    self.run()\n  File \"/home/dmorrison/.local/lib/python3.5/site-packages/discord/voice_client.py\", line 150, in run\n    super().run()\n  File \"/home/dmorrison/.local/lib/python3.5/site-packages/discord/voice_client.py\", line 108, in run\n    self.player(data)\n  File \"/home/dmorrison/.local/lib/python3.5/site-packages/discord/voice_client.py\", line 655, in play_audio\n    sent = self.socket.sendto(packet, (self.endpoint_ip, self.voice_port))\nOSError: [Errno 101] Network is unreachable\n```\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/291/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/291/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/280", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/280/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/280/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/280/events", "html_url": "https://github.com/Rapptz/discord.py/issues/280", "id": 168515832, "node_id": "MDU6SXNzdWUxNjg1MTU4MzI=", "number": 280, "title": "logs_from gets logs from the last 100 messages multiple times when limit >100", "user": {"login": "tailoric", "id": 16943959, "node_id": "MDQ6VXNlcjE2OTQzOTU5", "avatar_url": "https://avatars.githubusercontent.com/u/16943959?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tailoric", "html_url": "https://github.com/tailoric", "followers_url": "https://api.github.com/users/tailoric/followers", "following_url": "https://api.github.com/users/tailoric/following{/other_user}", "gists_url": "https://api.github.com/users/tailoric/gists{/gist_id}", "starred_url": "https://api.github.com/users/tailoric/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tailoric/subscriptions", "organizations_url": "https://api.github.com/users/tailoric/orgs", "repos_url": "https://api.github.com/users/tailoric/repos", "events_url": "https://api.github.com/users/tailoric/events{/privacy}", "received_events_url": "https://api.github.com/users/tailoric/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5", "html_url": "https://github.com/Rapptz/discord.py/milestone/5", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/5/labels", "id": 1941273, "node_id": "MDk6TWlsZXN0b25lMTk0MTI3Mw==", "number": 5, "title": "Rewrite", "description": "Things that will be taken care of before rewrite releases.", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 58, "state": "closed", "created_at": "2016-08-14T22:10:38Z", "updated_at": "2020-06-28T06:46:14Z", "due_on": null, "closed_at": "2019-04-10T01:57:54Z"}, "comments": 4, "created_at": "2016-07-31T12:35:04Z", "updated_at": "2016-10-06T19:09:13Z", "closed_at": "2016-10-06T19:09:13Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "So I want to extract the next 200 messages after a certain timestamp. I use the following code:\n\n``` Python\nif message.content.startswith('!print'):\n        command, time = message.content.split()\n        utctime = convert_to_utc(time)\n        logs = yield from client.logs_from(message.channel, limit=200, after=utctime)\n        tmp = yield from client.send_message(message.channel, 'Collecting messages...')\n        msg_counter = 0\n        for msg in logs:\n            print(msg.content)\n        yield from client.edit_message(tmp, 'messages successfully collected')\n```\n\nI made for testing purposes a chatlog that counts up from 0 to 199\n\nlike this \n![image](https://cloud.githubusercontent.com/assets/16943959/17276466/cf13291c-572a-11e6-8921-d4d29c792cf2.png)\n\nBut after using `!print 13:31` to collect the 200 messages after 1:31 pm I get the following output:\n\n[output.txt](https://github.com/Rapptz/discord.py/files/392390/output.txt)\n\nWhich are only the next 100 messages after 1:31 pm just collected twice.\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/280/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/280/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/278", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/278/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/278/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/278/events", "html_url": "https://github.com/Rapptz/discord.py/issues/278", "id": 167734536, "node_id": "MDU6SXNzdWUxNjc3MzQ1MzY=", "number": 278, "title": "member.voice_channel only outputs none", "user": {"login": "wictorklo", "id": 11279270, "node_id": "MDQ6VXNlcjExMjc5Mjcw", "avatar_url": "https://avatars.githubusercontent.com/u/11279270?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wictorklo", "html_url": "https://github.com/wictorklo", "followers_url": "https://api.github.com/users/wictorklo/followers", "following_url": "https://api.github.com/users/wictorklo/following{/other_user}", "gists_url": "https://api.github.com/users/wictorklo/gists{/gist_id}", "starred_url": "https://api.github.com/users/wictorklo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wictorklo/subscriptions", "organizations_url": "https://api.github.com/users/wictorklo/orgs", "repos_url": "https://api.github.com/users/wictorklo/repos", "events_url": "https://api.github.com/users/wictorklo/events{/privacy}", "received_events_url": "https://api.github.com/users/wictorklo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2016-07-26T23:19:06Z", "updated_at": "2016-07-27T00:36:49Z", "closed_at": "2016-07-27T00:34:11Z", "author_association": "NONE", "active_lock_reason": null, "body": "I use member.voice_channel to get the voice channel of a member who i know is active, however it always says \"none\", indicating that they are not in a voice channel. I'm assuming i missed something here.\nIncluding pictures of code and results:\n![capture](https://cloud.githubusercontent.com/assets/11279270/17158590/b2ab2734-5397-11e6-8094-4f062cd9a817.PNG)\n![capture](https://cloud.githubusercontent.com/assets/11279270/17158606/d371db2a-5397-11e6-9982-deb06eb34890.PNG)\nI am in a voice channel while typing this. Making it select other users instead of the author yields the same result.\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/278/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/278/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/250", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/250/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/250/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/250/events", "html_url": "https://github.com/Rapptz/discord.py/issues/250", "id": 161656613, "node_id": "MDU6SXNzdWUxNjE2NTY2MTM=", "number": 250, "title": "client.remove_roles throws an error if roles are removed in wrong order", "user": {"login": "jonnyli1125", "id": 1221310, "node_id": "MDQ6VXNlcjEyMjEzMTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1221310?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonnyli1125", "html_url": "https://github.com/jonnyli1125", "followers_url": "https://api.github.com/users/jonnyli1125/followers", "following_url": "https://api.github.com/users/jonnyli1125/following{/other_user}", "gists_url": "https://api.github.com/users/jonnyli1125/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonnyli1125/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonnyli1125/subscriptions", "organizations_url": "https://api.github.com/users/jonnyli1125/orgs", "repos_url": "https://api.github.com/users/jonnyli1125/repos", "events_url": "https://api.github.com/users/jonnyli1125/events{/privacy}", "received_events_url": "https://api.github.com/users/jonnyli1125/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2016-06-22T11:24:40Z", "updated_at": "2016-07-04T12:10:39Z", "closed_at": "2016-07-04T12:10:39Z", "author_association": "NONE", "active_lock_reason": null, "body": "[8:16 PM] squaswin: \n\n``` python\nfor index in reversed(remove):\n    del new_roles[index]\n```\n\n if new_roles is only 4 long and remove is [3, 2]\n[8:17 PM] squaswin: then itll remove 2 first and explode upon trying to delete 3\n[8:17 PM] jonny: hm\n[8:17 PM] squaswin: so i think danny needs to do a sorted(remove)\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/250/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/250/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/94", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/94/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/94/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/94/events", "html_url": "https://github.com/Rapptz/discord.py/issues/94", "id": 128444606, "node_id": "MDU6SXNzdWUxMjg0NDQ2MDY=", "number": 94, "title": "Player.pause() creates a busy loop", "user": {"login": "imayhaveborkedit", "id": 1907538, "node_id": "MDQ6VXNlcjE5MDc1Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1907538?v=4", "gravatar_id": "", "url": "https://api.github.com/users/imayhaveborkedit", "html_url": "https://github.com/imayhaveborkedit", "followers_url": "https://api.github.com/users/imayhaveborkedit/followers", "following_url": "https://api.github.com/users/imayhaveborkedit/following{/other_user}", "gists_url": "https://api.github.com/users/imayhaveborkedit/gists{/gist_id}", "starred_url": "https://api.github.com/users/imayhaveborkedit/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/imayhaveborkedit/subscriptions", "organizations_url": "https://api.github.com/users/imayhaveborkedit/orgs", "repos_url": "https://api.github.com/users/imayhaveborkedit/repos", "events_url": "https://api.github.com/users/imayhaveborkedit/events{/privacy}", "received_events_url": "https://api.github.com/users/imayhaveborkedit/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/3", "html_url": "https://github.com/Rapptz/discord.py/milestone/3", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/3/labels", "id": 1428573, "node_id": "MDk6TWlsZXN0b25lMTQyODU3Mw==", "number": 3, "title": "Soon\u2122", "description": "A future version of discord.py", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 19, "state": "open", "created_at": "2015-11-25T03:19:14Z", "updated_at": "2022-03-16T06:16:52Z", "due_on": null, "closed_at": null}, "comments": 1, "created_at": "2016-01-25T02:13:04Z", "updated_at": "2016-01-27T03:36:35Z", "closed_at": "2016-01-27T03:36:35Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "https://github.com/Rapptz/discord.py/blob/async/discord/voice_client.py#L74\n\nHigh cpu usage etc bad for vps' etc\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/94/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/94/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/91", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/91/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/91/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/91/events", "html_url": "https://github.com/Rapptz/discord.py/issues/91", "id": 127514014, "node_id": "MDU6SXNzdWUxMjc1MTQwMTQ=", "number": 91, "title": "WebSocket ratelimiting cause the client to exit", "user": {"login": "Hornwitser", "id": 14362102, "node_id": "MDQ6VXNlcjE0MzYyMTAy", "avatar_url": "https://avatars.githubusercontent.com/u/14362102?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Hornwitser", "html_url": "https://github.com/Hornwitser", "followers_url": "https://api.github.com/users/Hornwitser/followers", "following_url": "https://api.github.com/users/Hornwitser/following{/other_user}", "gists_url": "https://api.github.com/users/Hornwitser/gists{/gist_id}", "starred_url": "https://api.github.com/users/Hornwitser/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Hornwitser/subscriptions", "organizations_url": "https://api.github.com/users/Hornwitser/orgs", "repos_url": "https://api.github.com/users/Hornwitser/repos", "events_url": "https://api.github.com/users/Hornwitser/events{/privacy}", "received_events_url": "https://api.github.com/users/Hornwitser/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/3", "html_url": "https://github.com/Rapptz/discord.py/milestone/3", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/3/labels", "id": 1428573, "node_id": "MDk6TWlsZXN0b25lMTQyODU3Mw==", "number": 3, "title": "Soon\u2122", "description": "A future version of discord.py", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 19, "state": "open", "created_at": "2015-11-25T03:19:14Z", "updated_at": "2022-03-16T06:16:52Z", "due_on": null, "closed_at": null}, "comments": 3, "created_at": "2016-01-19T18:58:08Z", "updated_at": "2016-02-01T20:03:03Z", "closed_at": "2016-02-01T20:03:03Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "If the client sends too many messages in a short amount of time on the WebSocet connection (for example by sending status updates too often), it will be terminated with the data \"rate limited\".  The current rate limit on the WebSocet is 60/60 according to the discord devs.\n\nThe debug logs shows the following appearing:\n\n```\nDEBUG:websockets.protocol:client << Frame(fin=True, opcode=8, data=b'\\x0f\\xa8rate limited')\nDEBUG:websockets.protocol:client >> Frame(fin=True, opcode=8, data=b'\\x0f\\xa8rate limited')\n```\n\nThe `Client.connect()` method then exits with no errors logged or exceptions raised, making it hard to track down what happened.\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/91/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/91/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/81", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/81/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/81/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/81/events", "html_url": "https://github.com/Rapptz/discord.py/issues/81", "id": 126101795, "node_id": "MDU6SXNzdWUxMjYxMDE3OTU=", "number": 81, "title": ".roles containing a string", "user": {"login": "Twentysix26", "id": 6267772, "node_id": "MDQ6VXNlcjYyNjc3NzI=", "avatar_url": "https://avatars.githubusercontent.com/u/6267772?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Twentysix26", "html_url": "https://github.com/Twentysix26", "followers_url": "https://api.github.com/users/Twentysix26/followers", "following_url": "https://api.github.com/users/Twentysix26/following{/other_user}", "gists_url": "https://api.github.com/users/Twentysix26/gists{/gist_id}", "starred_url": "https://api.github.com/users/Twentysix26/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Twentysix26/subscriptions", "organizations_url": "https://api.github.com/users/Twentysix26/orgs", "repos_url": "https://api.github.com/users/Twentysix26/repos", "events_url": "https://api.github.com/users/Twentysix26/events{/privacy}", "received_events_url": "https://api.github.com/users/Twentysix26/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/3", "html_url": "https://github.com/Rapptz/discord.py/milestone/3", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/3/labels", "id": 1428573, "node_id": "MDk6TWlsZXN0b25lMTQyODU3Mw==", "number": 3, "title": "Soon\u2122", "description": "A future version of discord.py", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 19, "state": "open", "created_at": "2015-11-25T03:19:14Z", "updated_at": "2022-03-16T06:16:52Z", "due_on": null, "closed_at": null}, "comments": 0, "created_at": "2016-01-12T05:27:36Z", "updated_at": "2016-02-01T23:42:29Z", "closed_at": "2016-02-01T23:42:29Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "```\nIgnoring exception in on_message\nTraceback (most recent call last):\n  File \"C:\\Program Files (x86)\\Python35-32\\lib\\site-packages\\discord\\client.py\", line 251, in _run_event\n    yield from getattr(self, event)(*args, **kwargs)\n  File \"red.py\", line 145, in on_message\n    if settings[\"FILTER\"] and not isMemberAdmin(message):\n  File \"red.py\", line 1475, in isMemberAdmin\n    if discord.utils.get(message.author.roles, name=settings[\"ADMINROLE\"]) != None:\n  File \"C:\\Program Files (x86)\\Python35-32\\lib\\site-packages\\discord\\utils.py\", line 137, in get\n    return find(predicate, iterable)\n  File \"C:\\Program Files (x86)\\Python35-32\\lib\\site-packages\\discord\\utils.py\", line 78, in find\n    if predicate(element):\n  File \"C:\\Program Files (x86)\\Python35-32\\lib\\site-packages\\discord\\utils.py\", line 131, in predicate\n    obj = getattr(obj, attribute)\nAttributeError: 'str' object has no attribute 'name'\n```\n\n```\ndiscord.utils.get(message.server.members, name=\"ThatGuysName\").roles\n['132984642558099456', <discord.role.Role object at 0x050942F0>]\n```\n\nThis isn't first time it happens. It seem to only ever happen to me on that particular server, which is the only twitch related one I have a bot on.\nThat guy was recently synced (been assigned to the \"[stream_name] Subscriber\" role after he linked his Twitch account) and I'm quite sure it's the reason it happens. That's also the only role he has.\nI'm using this commit, 5a1d7a2d942c75a2f374b4b0add6ad50fdd227d7, my apologies if it turns out to be already fixed.\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/81/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/81/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/51", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/51/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/51/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/51/events", "html_url": "https://github.com/Rapptz/discord.py/issues/51", "id": 119577044, "node_id": "MDU6SXNzdWUxMTk1NzcwNDQ=", "number": 51, "title": "Crash on duplicate CHANNEL_DELETE", "user": {"login": "khazhyk", "id": 1542025, "node_id": "MDQ6VXNlcjE1NDIwMjU=", "avatar_url": "https://avatars.githubusercontent.com/u/1542025?v=4", "gravatar_id": "", "url": "https://api.github.com/users/khazhyk", "html_url": "https://github.com/khazhyk", "followers_url": "https://api.github.com/users/khazhyk/followers", "following_url": "https://api.github.com/users/khazhyk/following{/other_user}", "gists_url": "https://api.github.com/users/khazhyk/gists{/gist_id}", "starred_url": "https://api.github.com/users/khazhyk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/khazhyk/subscriptions", "organizations_url": "https://api.github.com/users/khazhyk/orgs", "repos_url": "https://api.github.com/users/khazhyk/repos", "events_url": "https://api.github.com/users/khazhyk/events{/privacy}", "received_events_url": "https://api.github.com/users/khazhyk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/3", "html_url": "https://github.com/Rapptz/discord.py/milestone/3", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/3/labels", "id": 1428573, "node_id": "MDk6TWlsZXN0b25lMTQyODU3Mw==", "number": 3, "title": "Soon\u2122", "description": "A future version of discord.py", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 19, "state": "open", "created_at": "2015-11-25T03:19:14Z", "updated_at": "2022-03-16T06:16:52Z", "due_on": null, "closed_at": null}, "comments": 0, "created_at": "2015-11-30T20:43:19Z", "updated_at": "2015-11-30T22:52:43Z", "closed_at": "2015-11-30T22:52:43Z", "author_association": "COLLABORATOR", "active_lock_reason": null, "body": "Discord can apparently send duplicate CHANNEL_DELETEs.\n\nThis causes us to crash. : )\n\n```\nWebSocket Event: {'op': 0, 's': 1930069, 'd': {'last_message_id': '118018179669819392', 'position': 12, 'name': 'memeverse', 'permission_overwrites': [{'deny': 131072, 'id': '107053649628258304', 'allow': 0, 'type': 'role'}], 'id': '115560288178143238', 'topic': 'All the memes', 'is_private': False, 'guild_id': '107053649628258304', 'type': 'text'}, 't': 'CHANNEL_DELETE'}\nWebSocket Event: {'op': 0, 's': 1930070, 'd': {'last_message_id': '118018179669819392', 'position': 12, 'name': 'memeverse', 'permission_overwrites': [{'deny': 131072, 'id': '107053649628258304', 'allow': 0, 'type': 'role'}], 'id': '115560288178143238', 'topic': 'All the memes', 'is_private': False, 'guild_id': '107053649628258304', 'type': 'text'}, 't': 'CHANNEL_DELETE'}\n```\n\n```\n    self.dispatch('socket_update', event, data)\n  File \"/var/lib/spoo/venv/lib/python3.4/site-packages/discord/client.py\", line 550, in dispatch\n    getattr(self, handle_method, _null_event)(*args, **kwargs)\n  File \"/var/lib/spoo/venv/lib/python3.4/site-packages/discord/client.py\", line 558, in handle_socket_update\n    getattr(self.connection, method)(data)\n  File \"/var/lib/spoo/venv/lib/python3.4/site-packages/discord/client.py\", line 276, in handle_channel_delete\n    server.channels.remove(channel)\nValueError: list.remove(x): x not in list\n```\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/51/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/51/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/29", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/29/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/29/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/29/events", "html_url": "https://github.com/Rapptz/discord.py/issues/29", "id": 113156019, "node_id": "MDU6SXNzdWUxMTMxNTYwMTk=", "number": 29, "title": "ValueError on GUILD_MEMBER_REMOVE", "user": {"login": "Hornwitser", "id": 14362102, "node_id": "MDQ6VXNlcjE0MzYyMTAy", "avatar_url": "https://avatars.githubusercontent.com/u/14362102?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Hornwitser", "html_url": "https://github.com/Hornwitser", "followers_url": "https://api.github.com/users/Hornwitser/followers", "following_url": "https://api.github.com/users/Hornwitser/following{/other_user}", "gists_url": "https://api.github.com/users/Hornwitser/gists{/gist_id}", "starred_url": "https://api.github.com/users/Hornwitser/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Hornwitser/subscriptions", "organizations_url": "https://api.github.com/users/Hornwitser/orgs", "repos_url": "https://api.github.com/users/Hornwitser/repos", "events_url": "https://api.github.com/users/Hornwitser/events{/privacy}", "received_events_url": "https://api.github.com/users/Hornwitser/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/2", "html_url": "https://github.com/Rapptz/discord.py/milestone/2", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/2/labels", "id": 1367325, "node_id": "MDk6TWlsZXN0b25lMTM2NzMyNQ==", "number": 2, "title": "v0.9.0", "description": "The other major version of discord.py", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 5, "state": "closed", "created_at": "2015-10-20T22:50:29Z", "updated_at": "2016-01-30T23:17:34Z", "due_on": null, "closed_at": "2016-01-30T23:17:34Z"}, "comments": 1, "created_at": "2015-10-24T12:03:46Z", "updated_at": "2015-11-20T04:45:57Z", "closed_at": "2015-11-20T04:45:57Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "It's possible to receive a GUILD_MEMBER_REMOVE for a member that has not been present in the guilds.members array in the READY event and for which no GUILD_MEMBER_ADD has been received for.  Resulting in `ValueError` being raised with the following traceback.\n\n```\nTraceback (most recent call last):\n  File \"bot.py\", line 345, in <module>\n    bot.run()\n  File \"/home/julian/prog/record/logger/discord/client.py\", line 560, in run\n    self.ws.run()\n  File \"/usr/lib/python3.5/site-packages/ws4py/websocket.py\", line 427, in run\n    if not self.once():\n  File \"/usr/lib/python3.5/site-packages/ws4py/websocket.py\", line 305, in once\n    if not self.process(b):\n  File \"/usr/lib/python3.5/site-packages/ws4py/websocket.py\", line 377, in process\n    self.received_message(s.message)\n  File \"/home/julian/prog/record/logger/discord/client.py\", line 133, in received_message\n    self.dispatch('socket_update', event, data)\n  File \"/home/julian/prog/record/logger/discord/client.py\", line 537, in dispatch\n    getattr(self, handle_method, _null_event)(*args, **kwargs)\n  File \"/home/julian/prog/record/logger/discord/client.py\", line 545, in handle_socket_update\n    getattr(self.connection, method)(data)\n  File \"/home/julian/prog/record/logger/discord/client.py\", line 311, in handle_guild_member_remove\n    server.members.remove(member)\nValueError: list.remove(x): x not in list\n```\n\nThis was encountered on commit 5efddaf of the develop branch.\n\n[WebSocket context](http://hornwitser.no/discord/query?query=SELECT+*+FROM+message+WHERE+raw+LIKE+%27%2597778769732849664%25%27+AND+id+%3C+503679+ORDER+BY+id+DESC+LIMIT+20)\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/29/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/29/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/26", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/26/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/26/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/26/events", "html_url": "https://github.com/Rapptz/discord.py/issues/26", "id": 112905517, "node_id": "MDU6SXNzdWUxMTI5MDU1MTc=", "number": 26, "title": "requests 2.4.2 should be required", "user": {"login": "sersorrel", "id": 9433472, "node_id": "MDQ6VXNlcjk0MzM0NzI=", "avatar_url": "https://avatars.githubusercontent.com/u/9433472?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sersorrel", "html_url": "https://github.com/sersorrel", "followers_url": "https://api.github.com/users/sersorrel/followers", "following_url": "https://api.github.com/users/sersorrel/following{/other_user}", "gists_url": "https://api.github.com/users/sersorrel/gists{/gist_id}", "starred_url": "https://api.github.com/users/sersorrel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sersorrel/subscriptions", "organizations_url": "https://api.github.com/users/sersorrel/orgs", "repos_url": "https://api.github.com/users/sersorrel/repos", "events_url": "https://api.github.com/users/sersorrel/events{/privacy}", "received_events_url": "https://api.github.com/users/sersorrel/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/1", "html_url": "https://github.com/Rapptz/discord.py/milestone/1", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/1/labels", "id": 1352973, "node_id": "MDk6TWlsZXN0b25lMTM1Mjk3Mw==", "number": 1, "title": "v0.8.0", "description": "The next major version of discord.py", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 8, "state": "closed", "created_at": "2015-10-13T10:47:17Z", "updated_at": "2015-10-23T23:53:29Z", "due_on": null, "closed_at": "2015-10-23T23:53:29Z"}, "comments": 1, "created_at": "2015-10-22T22:35:42Z", "updated_at": "2015-10-22T22:57:34Z", "closed_at": "2015-10-22T22:50:38Z", "author_association": "NONE", "active_lock_reason": null, "body": "Spent a couple of minutes banging head against wall today; the `json` parameter for `requests.post()` was only added in requests 2.4.2 (see http://docs.python-requests.org/en/latest/user/quickstart/#more-complicated-post-requests), and yet when I installed discord.py requests 2.4.2+ was not installed (it took `sudo pip3 install --upgrade requests`). Therefore, interesting crash:\n\n```\nTraceback (most recent call last):\n  File \"./dissonance.py\", line 26, in <module>\n    client.login(email, password)\n  File \"/usr/local/lib/python3.4/dist-packages/discord/client.py\", line 654, in login\n    r = requests.post(endpoints.LOGIN, json=payload)\n  File \"/usr/lib/python3/dist-packages/requests/api.py\", line 88, in post\n    return request('post', url, data=data, **kwargs)\n  File \"/usr/lib/python3/dist-packages/requests/api.py\", line 44, in request\n    return session.request(method=method, url=url, **kwargs)\nTypeError: request() got an unexpected keyword argument 'json'\n```\n\nTo fix: depend on requests \u2265 2.4.2 (assuming that's possible with pip/pip3).\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/26/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/26/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/23", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/23/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/23/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/23/events", "html_url": "https://github.com/Rapptz/discord.py/issues/23", "id": 112306336, "node_id": "MDU6SXNzdWUxMTIzMDYzMzY=", "number": 23, "title": "Role.is_everyone() is broken", "user": {"login": "Hornwitser", "id": 14362102, "node_id": "MDQ6VXNlcjE0MzYyMTAy", "avatar_url": "https://avatars.githubusercontent.com/u/14362102?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Hornwitser", "html_url": "https://github.com/Hornwitser", "followers_url": "https://api.github.com/users/Hornwitser/followers", "following_url": "https://api.github.com/users/Hornwitser/following{/other_user}", "gists_url": "https://api.github.com/users/Hornwitser/gists{/gist_id}", "starred_url": "https://api.github.com/users/Hornwitser/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Hornwitser/subscriptions", "organizations_url": "https://api.github.com/users/Hornwitser/orgs", "repos_url": "https://api.github.com/users/Hornwitser/repos", "events_url": "https://api.github.com/users/Hornwitser/events{/privacy}", "received_events_url": "https://api.github.com/users/Hornwitser/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/1", "html_url": "https://github.com/Rapptz/discord.py/milestone/1", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/1/labels", "id": 1352973, "node_id": "MDk6TWlsZXN0b25lMTM1Mjk3Mw==", "number": 1, "title": "v0.8.0", "description": "The next major version of discord.py", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 8, "state": "closed", "created_at": "2015-10-13T10:47:17Z", "updated_at": "2015-10-23T23:53:29Z", "due_on": null, "closed_at": "2015-10-23T23:53:29Z"}, "comments": 1, "created_at": "2015-10-20T07:45:48Z", "updated_at": "2015-10-22T00:27:54Z", "closed_at": "2015-10-22T00:27:54Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Running the expression \n\n``` python\n'\\n'.join(['**Server** {}\\n{}'.format(s.name, '\\n'.join(\n    ['\"{}\"'.format(r.name) for r in s.roles if r.is_everyone()]\n)) for s in self.servers])\n```\n\nto list up all `@everyone` roles in all servers yielded\n\n```\nServer Technic\n\nServer Logger Test\n\"@everyone\"\nServer /r/Dota2\n\"@everyone\"\n\"cant post links\"\nServer Discord Developers\n\nServer Discord API\n\"@everyone\"\n```\n\nWhich is obviously not correct.  Replacing `r.is_everyone()` with `r.id == s.id` correctly listed up all `@everyone` roles.  I suggest changing the logic behind `Role.is_everyone()` to check if the role id is equal to the server id to fix this.\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/23/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/23/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/22", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/22/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/22/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/22/events", "html_url": "https://github.com/Rapptz/discord.py/issues/22", "id": 112298283, "node_id": "MDU6SXNzdWUxMTIyOTgyODM=", "number": 22, "title": "Handle unavailable servers in READY event", "user": {"login": "Hornwitser", "id": 14362102, "node_id": "MDQ6VXNlcjE0MzYyMTAy", "avatar_url": "https://avatars.githubusercontent.com/u/14362102?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Hornwitser", "html_url": "https://github.com/Hornwitser", "followers_url": "https://api.github.com/users/Hornwitser/followers", "following_url": "https://api.github.com/users/Hornwitser/following{/other_user}", "gists_url": "https://api.github.com/users/Hornwitser/gists{/gist_id}", "starred_url": "https://api.github.com/users/Hornwitser/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Hornwitser/subscriptions", "organizations_url": "https://api.github.com/users/Hornwitser/orgs", "repos_url": "https://api.github.com/users/Hornwitser/repos", "events_url": "https://api.github.com/users/Hornwitser/events{/privacy}", "received_events_url": "https://api.github.com/users/Hornwitser/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/2", "html_url": "https://github.com/Rapptz/discord.py/milestone/2", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/2/labels", "id": 1367325, "node_id": "MDk6TWlsZXN0b25lMTM2NzMyNQ==", "number": 2, "title": "v0.9.0", "description": "The other major version of discord.py", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 5, "state": "closed", "created_at": "2015-10-20T22:50:29Z", "updated_at": "2016-01-30T23:17:34Z", "due_on": null, "closed_at": "2016-01-30T23:17:34Z"}, "comments": 1, "created_at": "2015-10-20T06:42:47Z", "updated_at": "2015-11-20T04:47:24Z", "closed_at": "2015-11-20T04:47:24Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "When a guild is unavailable, it will contain\n\n```\n{\n    \"unavailable\": true,\n    \"id\": \"41771983423143937\"\n}\n```\n\nin the guilds array in the READY event.  This is not handled properly, and a KeyError is raised.\n\n```\nTraceback (most recent call last):\n  File \"bot.py\", line 345, in <module>\n    bot.run()\n  File \"/home/julian/prog/record/logger/discord/client.py\", line 530, in run\n    self.ws.run()\n  File \"/usr/lib/python3.5/site-packages/ws4py/websocket.py\", line 427, in run\n    if not self.once():\n  File \"/usr/lib/python3.5/site-packages/ws4py/websocket.py\", line 305, in once\n    if not self.process(b):\n  File \"/usr/lib/python3.5/site-packages/ws4py/websocket.py\", line 377, in process\n    self.received_message(s.message)\n  File \"/home/julian/prog/record/logger/discord/client.py\", line 130, in received_message\n    self.dispatch('socket_update', event, data)\n  File \"/home/julian/prog/record/logger/discord/client.py\", line 507, in dispatch\n    getattr(self, handle_method, _null_event)(*args, **kwargs)\n  File \"/home/julian/prog/record/logger/discord/client.py\", line 515, in handle_socket_update\n    getattr(self.connection, method)(data)\n  File \"/home/julian/prog/record/logger/discord/client.py\", line 202, in handle_ready\n    self._add_server(guild)\n  File \"/home/julian/prog/record/logger/discord/client.py\", line 161, in _add_server\n    guild['roles'] = [Role(**role) for role in guild['roles']]\nKeyError: 'roles'\n```\n\n[Relevant WebSocket message](http://hornwitser.no/discord/query?query=SELECT+*+FROM+message+WHERE+id+%3D+231098) (Warning: big).\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/22/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/22/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/21", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/21/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/21/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/21/events", "html_url": "https://github.com/Rapptz/discord.py/issues/21", "id": 112211743, "node_id": "MDU6SXNzdWUxMTIyMTE3NDM=", "number": 21, "title": "AssertionError on unordered CHANNEL_CREATE", "user": {"login": "Hornwitser", "id": 14362102, "node_id": "MDQ6VXNlcjE0MzYyMTAy", "avatar_url": "https://avatars.githubusercontent.com/u/14362102?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Hornwitser", "html_url": "https://github.com/Hornwitser", "followers_url": "https://api.github.com/users/Hornwitser/followers", "following_url": "https://api.github.com/users/Hornwitser/following{/other_user}", "gists_url": "https://api.github.com/users/Hornwitser/gists{/gist_id}", "starred_url": "https://api.github.com/users/Hornwitser/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Hornwitser/subscriptions", "organizations_url": "https://api.github.com/users/Hornwitser/orgs", "repos_url": "https://api.github.com/users/Hornwitser/repos", "events_url": "https://api.github.com/users/Hornwitser/events{/privacy}", "received_events_url": "https://api.github.com/users/Hornwitser/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/2", "html_url": "https://github.com/Rapptz/discord.py/milestone/2", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/2/labels", "id": 1367325, "node_id": "MDk6TWlsZXN0b25lMTM2NzMyNQ==", "number": 2, "title": "v0.9.0", "description": "The other major version of discord.py", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 5, "state": "closed", "created_at": "2015-10-20T22:50:29Z", "updated_at": "2016-01-30T23:17:34Z", "due_on": null, "closed_at": "2016-01-30T23:17:34Z"}, "comments": 1, "created_at": "2015-10-19T19:10:14Z", "updated_at": "2015-10-28T02:04:04Z", "closed_at": "2015-10-28T02:04:04Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "It's possible that messages are reordered such that a MESSAGE_CREATE event comes before the corresponding CHANNEL_CREATE for the private chat.  This causes the code to crash with an AssertionError.\n\n```\nFile \"bot.py\", line 316, in <module>\n    charset='utf8mb4',\n  File \"/home/julian/prog/record/logger/discord/client.py\", line 518, in run\n    self.ws.run()\n  File \"/usr/lib/python3.5/site-packages/ws4py/websocket.py\", line 427, in run\n    if not self.once():\n  File \"/usr/lib/python3.5/site-packages/ws4py/websocket.py\", line 305, in once\n    if not self.process(b):\n  File \"/usr/lib/python3.5/site-packages/ws4py/websocket.py\", line 377, in process\n    self.received_message(s.message)\n  File \"/home/julian/prog/record/logger/discord/client.py\", line 128, in received_message\n    self.dispatch('socket_update', event, data)\n  File \"/home/julian/prog/record/logger/discord/client.py\", line 505, in dispatch\n    getattr(self, handle_method, _null_event)(*args, **kwargs)\n  File \"/home/julian/prog/record/logger/discord/client.py\", line 513, in handle_socket_update\n    getattr(self.connection, method)(data)\n  File \"/home/julian/prog/record/logger/discord/client.py\", line 211, in handle_message_create\n    message = Message(channel=channel, **data)\n  File \"/home/julian/prog/record/logger/discord/message.py\", line 89, in __init__\n    self._upgrade_to_member()\n  File \"/home/julian/prog/record/logger/discord/message.py\", line 92, in _upgrade_to_member\n    assert self.channel is not None\nAssertionError\n```\n\n[WebSocket Context](http://hornwitser.no/discord/query?query=SELECT+*+FROM+message+WHERE+id+%3C+196826+ORDER+BY+id+DESC+LIMIT+20) (not much to see, it's just a message with an unknown channel id)\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/21/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/21/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/14", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/14/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/14/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/14/events", "html_url": "https://github.com/Rapptz/discord.py/issues/14", "id": 111481207, "node_id": "MDU6SXNzdWUxMTE0ODEyMDc=", "number": 14, "title": "AttributeError on GUILD_MEMBER_REMOVE", "user": {"login": "Hornwitser", "id": 14362102, "node_id": "MDQ6VXNlcjE0MzYyMTAy", "avatar_url": "https://avatars.githubusercontent.com/u/14362102?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Hornwitser", "html_url": "https://github.com/Hornwitser", "followers_url": "https://api.github.com/users/Hornwitser/followers", "following_url": "https://api.github.com/users/Hornwitser/following{/other_user}", "gists_url": "https://api.github.com/users/Hornwitser/gists{/gist_id}", "starred_url": "https://api.github.com/users/Hornwitser/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Hornwitser/subscriptions", "organizations_url": "https://api.github.com/users/Hornwitser/orgs", "repos_url": "https://api.github.com/users/Hornwitser/repos", "events_url": "https://api.github.com/users/Hornwitser/events{/privacy}", "received_events_url": "https://api.github.com/users/Hornwitser/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/Rapptz/discord.py/milestones/1", "html_url": "https://github.com/Rapptz/discord.py/milestone/1", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/milestones/1/labels", "id": 1352973, "node_id": "MDk6TWlsZXN0b25lMTM1Mjk3Mw==", "number": 1, "title": "v0.8.0", "description": "The next major version of discord.py", "creator": {"login": "Rapptz", "id": 1695103, "node_id": "MDQ6VXNlcjE2OTUxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1695103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Rapptz", "html_url": "https://github.com/Rapptz", "followers_url": "https://api.github.com/users/Rapptz/followers", "following_url": "https://api.github.com/users/Rapptz/following{/other_user}", "gists_url": "https://api.github.com/users/Rapptz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Rapptz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Rapptz/subscriptions", "organizations_url": "https://api.github.com/users/Rapptz/orgs", "repos_url": "https://api.github.com/users/Rapptz/repos", "events_url": "https://api.github.com/users/Rapptz/events{/privacy}", "received_events_url": "https://api.github.com/users/Rapptz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 8, "state": "closed", "created_at": "2015-10-13T10:47:17Z", "updated_at": "2015-10-23T23:53:29Z", "due_on": null, "closed_at": "2015-10-23T23:53:29Z"}, "comments": 1, "created_at": "2015-10-14T20:03:23Z", "updated_at": "2015-10-17T07:21:11Z", "closed_at": "2015-10-17T07:21:11Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "When you leave a server, a GUILD_DELETE message is sent on the WebSocket deleting the server.  But afterwards a GUILD_MEMBER_REMOVE may appear referencing yourself, and the just deleted guild. Causing the following traceback:\n\n```\nTraceback (most recent call last):\n  File \"bot.py\", line 66, in <module>\n    bot.run()\n  File \"/home/julian/prog/record/discord/client.py\", line 472, in run\n    self.ws.run()\n  File \"/usr/lib/python3.5/site-packages/ws4py/websocket.py\", line 427, in run\n    if not self.once():\n  File \"/usr/lib/python3.5/site-packages/ws4py/websocket.py\", line 305, in once\n    if not self.process(b):\n  File \"/usr/lib/python3.5/site-packages/ws4py/websocket.py\", line 377, in process\n    self.received_message(s.message)\n  File \"/home/julian/prog/record/discord/client.py\", line 122, in received_message\n    self.dispatch('socket_update', event, data)\n  File \"/home/julian/prog/record/discord/client.py\", line 459, in dispatch\n    getattr(self, handle_method, _null_event)(*args, **kwargs)\n  File \"/home/julian/prog/record/discord/client.py\", line 467, in handle_socket_update\n    getattr(self.connection, method)(data)\n  File \"/home/julian/prog/record/discord/client.py\", line 285, in handle_guild_member_remove\n    member = utils.find(lambda m: m.id == user_id, server.members)\nAttributeError: 'NoneType' object has no attribute 'members'\n```\n\nSee also the [WebSocket context](http://hornwitser.no/discord/query?query=SELECT+*+FROM+message+WHERE+id+%3C+7000+ORDER+BY+id+DESC+LIMIT+20).\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/14/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/14/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5", "repository_url": "https://api.github.com/repos/Rapptz/discord.py", "labels_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5/labels{/name}", "comments_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5/comments", "events_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5/events", "html_url": "https://github.com/Rapptz/discord.py/issues/5", "id": 109692022, "node_id": "MDU6SXNzdWUxMDk2OTIwMjI=", "number": 5, "title": "Hitting issues when trying to create a bot", "user": {"login": "johncoxon", "id": 1693743, "node_id": "MDQ6VXNlcjE2OTM3NDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1693743?v=4", "gravatar_id": "", "url": "https://api.github.com/users/johncoxon", "html_url": "https://github.com/johncoxon", "followers_url": "https://api.github.com/users/johncoxon/followers", "following_url": "https://api.github.com/users/johncoxon/following{/other_user}", "gists_url": "https://api.github.com/users/johncoxon/gists{/gist_id}", "starred_url": "https://api.github.com/users/johncoxon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/johncoxon/subscriptions", "organizations_url": "https://api.github.com/users/johncoxon/orgs", "repos_url": "https://api.github.com/users/johncoxon/repos", "events_url": "https://api.github.com/users/johncoxon/events{/privacy}", "received_events_url": "https://api.github.com/users/johncoxon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 251130941, "node_id": "MDU6TGFiZWwyNTExMzA5NDE=", "url": "https://api.github.com/repos/Rapptz/discord.py/labels/bug", "name": "bug", "color": "C62740", "default": true, "description": "This is a bug with the library."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2015-10-04T17:11:39Z", "updated_at": "2017-06-18T15:28:54Z", "closed_at": "2016-01-07T17:55:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'm trying to write a bot using this API which will let people play a game but I'm coming across some weird behaviours and I can't tell whether I'm doing something wrong or whether there's actually a problem.\n\nThe below code, upon `talk_to_discord()` being called, attempts to start a client and then listens for a message to tell it when to start the game (I'm going with !start). When it hears that message, it starts a Game object, passing both the Discord client (`self.client`) and the user who started the game (`self.owner`). The idea is that the Game object then messages the owner to ask who's playing (generating a list of usernames from the input string) and also what roles are available to players (generating a list of roles from the second input string).\n\nThe module is called `werewolf`. If I open Python and then type `import werewolf` and `werewolf.talk_to_discord()`, the client starts and I can message the relevant user on Discord. \n\nThe chat log in Discord between me and the user (also called 'werewolf') looks like this:\n\n**me**: !start \n**werewolf**: Let's start a game!\n**werewolf**: Who will be playing?\n**me**: Player 1, Player 2, Player 3, Player 4, Player 5\n_pause_\n**me**: !start\n**werewolf**: Let's start a game!\n**werewolf**: Who will be playing?\n**me**: Player 1, Player 2, Player 3, Player 4, Player 5\n**werewolf**: What roles will be in effect?\n**me**: Tanner, Werewolf, Werewolf, Hunter, Robber, Seer, Insomniac, Villager\n\nThe console output before _pause_ is:\n\n```\nSuccessfully logged in as werewolf with ID 100233992065814528.\nA game is starting!\nusers input\n[]\n```\n\nThe output after _pause_ is:\n\n```\nA game is starting!\nusers input\n[u'!start', u'Player 1, Player 2, Player 3, Player 4, Player 5']\nroles input\n[u'!start', u'Player 1, Player 2, Player 3, Player 4, Player 5']\ntest\n```\n\nThe code I've written is:\n\n```\nimport discord\n\ndef talk_to_discord():\n\n    client = discord.Client()\n    client.login('email', 'password')\n\n    @client.event\n    def on_message(message):\n        if message.content.startswith(\"!start\"):\n            client.send_message(message.channel, \"Let's start a game!\")\n            Game(client, message.author)\n\n    @client.event\n    def on_ready():\n        print('Successfully logged in as {0} with ID {1}.'.format(client.user.name, client.user.id))\n\n    client.run()\n\n# --------------------------------------------------------------------------------------------------\n\nclass Game(object):\n    \"\"\"Object for the entire game.\"\"\"\n\n    def __init__(self, client, owner):\n        import random\n        print('A game is starting!')\n\n        self.client = client\n        self.owner = owner\n\n        # Work out who's playing.\n        self.client.send_message(self.owner, 'Who will be playing?')\n        time.sleep(30)\n        print('users input')\n        received = [m.content for m in self.client.messages if m.author == self.owner]\n        print(received)\n        self.users = received[-1].split(', ')\n\n        self.client.send_message(self.owner, 'What roles will be in effect?')\n        time.sleep(30)\n        print('roles input')\n        received = [m.content for m in self.client.messages if m.author == self.owner]\n        print(received)\n        roles = received[-1].split(', ')\n        self.roles = random.sample([n.lower() for n in roles], len(roles))\n        print('test')\n\n        if len(self.users) + 3 != len(self.roles):\n            raise ValueError('The number of roles must be the number of players + 3.')\n\n        print('test2')\n```\n\nHere are my questions:\n1. Removing the if statement towards the end of the code causes `test2` to print to the console. Why does the if statement as written cause Python to just stop, rather than either raising a `ValueError` or moving onto the next line?\n2. Why is the bot unable to successfully fetch the most recent message from the client? It seems to be fetching the most recent message prior to hearing the word '!start' and I don't really understand why that's the case.\n3. Why, when I hit Ctrl-C to interrupt the client and then run `talk_to_discord()` again, does every message start appearing in duplicate (or triplicate, or more depending on how many times I've hit Ctrl-C and run the function again)?\n4. At the moment I'm waiting a set time and then trying to poll for the user's most recent input during that time. Is there a better way to do this? I feel like I should be able to do something like `while new_message_from_author(author) == False` with a much shorter time delay in it, and then have the rest of the code run once a new message from the owner has been received, rather than having a preset amount of time in which to provide the relevant inputs.\n\nI would be very grateful for any pointers on whether this is a problem with the API, or whether it's a problem with my trying to use the API.\n", "reactions": {"url": "https://api.github.com/repos/Rapptz/discord.py/issues/5/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rapptz/discord.py/issues/5/timeline", "performed_via_github_app": null, "state_reason": "completed"}]