[{"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4415", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4415/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4415/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4415/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/4415", "id": 1667101155, "node_id": "I_kwDOAT0rQs5jXfHj", "number": 4415, "title": "Attribute lists in admin UI can be too wide", "user": {"login": "ryanlovett", "id": 10248125, "node_id": "MDQ6VXNlcjEwMjQ4MTI1", "avatar_url": "https://avatars.githubusercontent.com/u/10248125?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ryanlovett", "html_url": "https://github.com/ryanlovett", "followers_url": "https://api.github.com/users/ryanlovett/followers", "following_url": "https://api.github.com/users/ryanlovett/following{/other_user}", "gists_url": "https://api.github.com/users/ryanlovett/gists{/gist_id}", "starred_url": "https://api.github.com/users/ryanlovett/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ryanlovett/subscriptions", "organizations_url": "https://api.github.com/users/ryanlovett/orgs", "repos_url": "https://api.github.com/users/ryanlovett/repos", "events_url": "https://api.github.com/users/ryanlovett/events{/privacy}", "received_events_url": "https://api.github.com/users/ryanlovett/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-04-13T20:44:05Z", "updated_at": "2023-04-20T07:11:23Z", "closed_at": "2023-04-20T07:11:23Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n\r\nIn /hub/admin, when you expand a user's attributes, if a user is a member of a lot of lists and/or if the group names are long, the user table runs off the page:\r\n<img width=\"1382\" alt=\"Screenshot 2023-04-13 at 1 31 34 PM\" src=\"https://user-images.githubusercontent.com/10248125/231876149-ff7f4f16-2458-4e45-88c0-e089a4452072.png\">\r\n\r\n\r\nThe admin must scroll off to the side and scan the string horizontally when looking for a specific group.\r\n\r\nIn [jsx/src/components/ServerDashboard/ServerDashboard.jsx](https://github.com/jupyterhub/jupyterhub/blob/main/jsx/src/components/ServerDashboard/ServerDashboard.jsx#L240) I see that attributes are assembled together in a comma-separated string.\r\n\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\n\r\n#### Expected behaviour\r\n\r\n<!-- Tell us what you thought would happen. -->\r\nI think it'd be better if the attribute list could be displayed as an unordered list. It would make it easier to quickly scan for values and preserves the semantics of \"a list of things\".\r\n\r\n#### Actual behaviour\r\n\r\nLong attribute lists are concatenated into a very long string.\r\n\r\n### How to reproduce\r\n\r\n1. Visit /hub/admin.\r\n2. Choose a user who is a member of either a lot of groups, groups with long names, or both.\r\n3. Click the drop-down arrow next to their username.\r\n\r\n### Your personal set up\r\n\r\n\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n\r\nz2jh, jupyterhub 4.0.0b2\r\n\r\n<details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\nPackage                          Version\r\n-------------------------------- ---------\r\naiohttp                          3.8.4\r\naiosignal                        1.3.1\r\nalembic                          1.10.2\r\nasync-generator                  1.10\r\nasync-timeout                    4.0.2\r\nattrs                            22.2.0\r\nbcrypt                           4.0.1\r\ncertifi                          2022.12.7\r\ncertipy                          0.1.3\r\ncffi                             1.15.1\r\ncharset-normalizer               3.1.0\r\ncryptography                     39.0.2\r\nescapism                         1.0.1\r\nfrozenlist                       1.3.3\r\ngreenlet                         2.0.2\r\nidna                             3.4\r\nJinja2                           3.1.2\r\njsonschema                       4.17.3\r\njupyter-telemetry                0.1.0\r\njupyterhub                       4.0.0b2\r\njupyterhub-canvasoauthenticator  0.1\r\njupyterhub-firstuseauthenticator 1.0.0\r\njupyterhub-hmacauthenticator     1.0\r\njupyterhub-idle-culler           1.2.1\r\njupyterhub-kubespawner           4.3.0\r\njupyterhub-ldapauthenticator     1.3.2\r\njupyterhub-ltiauthenticator      1.4.0\r\njupyterhub-nativeauthenticator   1.1.0\r\njupyterhub-tmpauthenticator      0.6\r\nkubernetes-asyncio               24.2.2\r\nldap3                            2.9.1\r\nMako                             1.2.4\r\nMarkupSafe                       2.1.2\r\nmultidict                        6.0.4\r\nmwoauth                          0.3.8\r\nnullauthenticator                1.0.0\r\noauthenticator                   15.1.0\r\noauthlib                         3.2.2\r\nonetimepass                      1.0.1\r\npackaging                        23.0\r\npamela                           1.0.0\r\npip                              22.3.1\r\nprometheus-client                0.16.0\r\npsycopg2                         2.9.5\r\npy-spy                           0.3.14\r\npyasn1                           0.4.8\r\npycparser                        2.21\r\npycurl                           7.45.2\r\nPyJWT                            2.6.0\r\nPyMySQL                          1.0.2\r\npyOpenSSL                        23.0.0\r\npyrsistent                       0.19.3\r\npython-dateutil                  2.8.2\r\npython-json-logger               2.0.7\r\npython-slugify                   8.0.1\r\nPyYAML                           6.0\r\nrequests                         2.28.2\r\nrequests-oauthlib                1.3.1\r\nruamel.yaml                      0.17.21\r\nsetuptools                       65.5.1\r\nsix                              1.16.0\r\nSQLAlchemy                       2.0.7\r\nsqlalchemy-cockroachdb           2.0.0\r\nstatsd                           4.0.1\r\ntext-unidecode                   1.3\r\ntornado                          6.2\r\ntraitlets                        5.9.0\r\ntyping_extensions                4.5.0\r\nurllib3                          1.26.15\r\nwheel                            0.40.0\r\nyarl                             1.8.2\r\n```\r\n</details>\r\n\r\n<details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\nOur deployment is at https://github.com/berkeley-dsep-infra/datahub.\r\n\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4415/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4415/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4407", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4407/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4407/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4407/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/4407", "id": 1654125751, "node_id": "I_kwDOAT0rQs5il_S3", "number": 4407, "title": "cannot build from dockerfile", "user": {"login": "cwseys", "id": 9353776, "node_id": "MDQ6VXNlcjkzNTM3NzY=", "avatar_url": "https://avatars.githubusercontent.com/u/9353776?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cwseys", "html_url": "https://github.com/cwseys", "followers_url": "https://api.github.com/users/cwseys/followers", "following_url": "https://api.github.com/users/cwseys/following{/other_user}", "gists_url": "https://api.github.com/users/cwseys/gists{/gist_id}", "starred_url": "https://api.github.com/users/cwseys/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cwseys/subscriptions", "organizations_url": "https://api.github.com/users/cwseys/orgs", "repos_url": "https://api.github.com/users/cwseys/repos", "events_url": "https://api.github.com/users/cwseys/events{/privacy}", "received_events_url": "https://api.github.com/users/cwseys/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-04-04T15:35:34Z", "updated_at": "2023-04-04T17:00:10Z", "closed_at": "2023-04-04T15:57:15Z", "author_association": "NONE", "active_lock_reason": null, "body": "Docker image cannot be built from supplied Dockerfile.\r\n\r\nTo reproduce, download Dockerfile from jupyterhub git repo.\r\nRun `podman build --tag jupyterhub-local -f /tmp/buld/jupyterhub.Dockerfile`\r\n\r\nError is:\r\n[1/2] STEP 13/14: RUN python3 -m build --wheel\r\nERROR Source /src/jupyterhub does not appear to be a Python project: no pyproject.toml or setup.py\r\nError: error building at STEP \"RUN python3 -m build --wheel\": error while running runtime: exit status 1\r\n\r\nLooks like the jupyterhub code is supplied in a local directory and therefore Dockerfile doesn't contain enough info.\r\n\r\nPossible fix: pip install jupyterhub from PyPi instead of copying jupyterhub code from local directory.\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4407/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4407/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4402", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4402/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4402/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4402/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4402", "id": 1647347448, "node_id": "PR_kwDOAT0rQs5NP1dI", "number": 4402, "title": "make sure named server URLs include trailing slash", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-03-30T10:31:48Z", "updated_at": "2023-03-31T07:17:35Z", "closed_at": "2023-03-30T19:07:58Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/4402", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4402", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/4402.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/4402.patch", "merged_at": "2023-03-30T19:07:58Z"}, "body": "identified in https://github.com/jupyterhub/traefik-proxy/issues/195\r\n\r\nit was a bug in the traefik proxy that it didn't handle `/user/name/named-server` the same as `/user/name/named-server/`, but we should still be consistent about computing URLs with the full routing prefix (we already use `/user/name/`, so this makes named servers consistent with the default server)", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4402/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4402/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4391", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4391/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4391/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4391/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/4391", "id": 1616330319, "node_id": "I_kwDOAT0rQs5gVz5P", "number": 4391, "title": "Hub service Scale failure ", "user": {"login": "huleiyu", "id": 41931027, "node_id": "MDQ6VXNlcjQxOTMxMDI3", "avatar_url": "https://avatars.githubusercontent.com/u/41931027?v=4", "gravatar_id": "", "url": "https://api.github.com/users/huleiyu", "html_url": "https://github.com/huleiyu", "followers_url": "https://api.github.com/users/huleiyu/followers", "following_url": "https://api.github.com/users/huleiyu/following{/other_user}", "gists_url": "https://api.github.com/users/huleiyu/gists{/gist_id}", "starred_url": "https://api.github.com/users/huleiyu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/huleiyu/subscriptions", "organizations_url": "https://api.github.com/users/huleiyu/orgs", "repos_url": "https://api.github.com/users/huleiyu/repos", "events_url": "https://api.github.com/users/huleiyu/events{/privacy}", "received_events_url": "https://api.github.com/users/huleiyu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-03-09T03:19:28Z", "updated_at": "2023-03-09T04:05:13Z", "closed_at": "2023-03-09T04:05:13Z", "author_association": "NONE", "active_lock_reason": null, "body": "It works well if the hub service has only one replicas, but when i tried to Expand to 2 replicas\uff0cSpawn failed \u3002\r\nServer requested\r\n2023-03-09T02:50:56.148450Z [Normal] Successfully assigned default/jupyter-student007-5f-5401 to cn-zhangjiakou.172.26.41.106\r\n2023-03-09T02:50:56Z [Normal] Container image \"jupyterhub/k8s-network-tools:2.0.0\" already present on machine\r\n2023-03-09T02:50:56Z [Normal] Created container block-cloud-metadata\r\n2023-03-09T02:50:56Z [Normal] Started container block-cloud-metadata\r\n2023-03-09T02:50:57Z [Normal] Container image \"registry.cn-zhangjiakou.aliyuncs.com/keyun/singleuser:V2.0.0-202303091000\" already present on machine\r\n2023-03-09T02:50:57Z [Normal] Created container notebook\r\n2023-03-09T02:50:57Z [Normal] Started container notebook\r\n2023-03-09T02:50:58.502795Z [Normal] Successfully assigned default/jupyter-student007-5f-5401 to cn-zhangjiakou.172.26.41.106\r\nSpawn failed: Server at http://10.5.1.106:8888/user/student007_T01/ didn't respond in 30 seconds", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4391/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4391/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4387", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4387/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4387/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4387/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4387", "id": 1612237813, "node_id": "PR_kwDOAT0rQs5LaXvF", "number": 4387, "title": "fix inclusion of singleuser/templates/page.html in wheel", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-03-06T21:32:45Z", "updated_at": "2023-03-07T15:20:58Z", "closed_at": "2023-03-07T15:20:32Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/4387", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4387", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/4387.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/4387.patch", "merged_at": "2023-03-07T15:20:32Z"}, "body": "- Closes #4384 ", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4387/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4387/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4383", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4383/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4383/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4383/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4383", "id": 1606772900, "node_id": "PR_kwDOAT0rQs5LIJpV", "number": 4383, "title": "exponential_backoff: preserve jitter when max_wait is reached", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-03-02T13:03:24Z", "updated_at": "2023-03-02T17:55:59Z", "closed_at": "2023-03-02T17:55:59Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/4383", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4383", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/4383.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/4383.patch", "merged_at": "2023-03-02T17:55:59Z"}, "body": "Previously, the sleep would be a random time on the range `[0, limit]` _until_ max_wait was reached, at which point it would always be exactly max_wait, stopping the jitter when the max scale was reached. This keeps the jitter applied to every sleep.\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4383/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4383/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4365", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4365/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4365/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4365/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4365", "id": 1593014845, "node_id": "PR_kwDOAT0rQs5KZ9WE", "number": 4365, "title": "admin panel: fix condition for start/stop buttons on user servers", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-02-21T08:07:49Z", "updated_at": "2023-02-24T14:59:31Z", "closed_at": "2023-02-24T14:59:29Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/4365", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4365", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/4365.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/4365.patch", "merged_at": "2023-02-24T14:59:29Z"}, "body": "`.ready` is the right switch for the links, not `.started` which can be defined even after they stop\r\n\r\ncloses #4361", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4365/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4365/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4361", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4361/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4361/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4361/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/4361", "id": 1590918171, "node_id": "I_kwDOAT0rQs5e03wb", "number": 4361, "title": "admin page shows stop/access links for stopped servers", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-02-20T00:07:29Z", "updated_at": "2023-02-24T14:59:31Z", "closed_at": "2023-02-24T14:59:31Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "It appears that JupyterHub has arrived to a faulty state about active servers in a jupyterhub 3.1.1 installation I manage (z2jh based, latest dev release of helm chart).\r\n\r\nThere may be a need to protect for this happening, and/or recovering from it happening. I hope this issue report can help as a clue to fixing a small bug that this is, as it doesn't seem to cause much issues.\r\n\r\nSince the metrics gets it right, and the /hub/admin gets it wrong, it seems reasonable that JupyterHub could figure that the state is incosistent by itself.\r\n\r\n### Logs from hub startup one day ago\r\n\r\n```\r\n[I 2023-02-19 22:52:56.478 JupyterHub app:2539] redacted-user-a still running\r\n[I 2023-02-19 22:52:56.478 JupyterHub app:2539] redacted-user-b still running\r\n[I 2023-02-19 22:52:56.479 JupyterHub app:2879] Initialized 2 spawners in 0.055 seconds\r\n```\r\n\r\n### Incorrect state reported\r\n\r\n![image](https://user-images.githubusercontent.com/3837114/219983065-b21faaca-9a09-4062-aa3e-8eec2d8ac95f.png)\r\n\r\n### Access server presents this\r\n\r\n![image](https://user-images.githubusercontent.com/3837114/219983309-6449fd49-4e92-44d5-886e-70f0be371f50.png)\r\n\r\n### Metrics of `jupyterhub_running_servers` is correct\r\n\r\n```\r\n# HELP jupyterhub_running_servers the number of user servers currently running\r\n# TYPE jupyterhub_running_servers gauge\r\njupyterhub_running_servers 2.0\r\n```\r\n\r\n### Starting server works\r\n\r\n![image](https://user-images.githubusercontent.com/3837114/219983503-9240ec3b-49fd-409b-a7ba-15a955251686.png)\r\n\r\n### Stopping started server works\r\n\r\n![image](https://user-images.githubusercontent.com/3837114/219983542-13ec0451-e770-4d66-8996-b9d9c220189f.png)\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4361/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4361/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4356", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4356/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4356/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4356/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4356", "id": 1587743174, "node_id": "PR_kwDOAT0rQs5KIixw", "number": 4356, "title": "avoid logging error when browsers send invalid cookies", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-02-16T14:07:58Z", "updated_at": "2023-02-16T15:06:23Z", "closed_at": "2023-02-16T15:06:23Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/4356", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4356", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/4356.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/4356.patch", "merged_at": "2023-02-16T15:06:23Z"}, "body": "closes #4330", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4356/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4356/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4351", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4351/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4351/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4351/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/4351", "id": 1582940461, "node_id": "I_kwDOAT0rQs5eWcEt", "number": 4351, "title": "Provided metrics for server_spawn_duration_seconds are incorrect, maxing out at 2 minutes", "user": {"login": "shaneknapp", "id": 1606572, "node_id": "MDQ6VXNlcjE2MDY1NzI=", "avatar_url": "https://avatars.githubusercontent.com/u/1606572?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shaneknapp", "html_url": "https://github.com/shaneknapp", "followers_url": "https://api.github.com/users/shaneknapp/followers", "following_url": "https://api.github.com/users/shaneknapp/following{/other_user}", "gists_url": "https://api.github.com/users/shaneknapp/gists{/gist_id}", "starred_url": "https://api.github.com/users/shaneknapp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shaneknapp/subscriptions", "organizations_url": "https://api.github.com/users/shaneknapp/orgs", "repos_url": "https://api.github.com/users/shaneknapp/repos", "events_url": "https://api.github.com/users/shaneknapp/events{/privacy}", "received_events_url": "https://api.github.com/users/shaneknapp/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2023-02-10T21:17:46Z", "updated_at": "2023-03-22T10:36:48Z", "closed_at": "2023-02-13T20:52:04Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n\r\nthe current grafana dashboard view for [server startup time](https://github.com/jupyterhub/grafana-dashboards/blob/main/dashboards/jupyterhub.jsonnet#L242) shows the max start up time to be 2m.\r\n\r\nthis is absolutely not true.  :)\r\n\r\nwe've had reports of start times of 4-5m, but looking at our graphs, again:  two minutes, max!\r\n\r\ni created a local issue w/some more context [here](https://github.com/berkeley-dsep-infra/datahub/issues/4237), and added a delay to server launch by hacking our `hub/values.yaml`.  that pr is here:  https://github.com/berkeley-dsep-infra/datahub/pull/4241\r\n\r\nfor my test, i set the delay to be 3m, pushed that config to one of our staging hubs and patiently waited.  after 3m, the server launched, but grafana (surprise surprise) showed that the 99th percentile of start time was only 2m!\r\n\r\n![image](https://user-images.githubusercontent.com/1606572/218195077-78e66640-9258-49e2-8939-0b0a0ec1e81b.png)\r\n\r\nthis hub had no other users logged on at the time.\r\n\r\n#### Expected behaviour\r\n\r\nif server launches take longer than 2m, then i would expect to see that on the grafana panel.\r\n\r\n#### Actual behaviour\r\n\r\nomg!  all servers show a max of 2m for launch *no matter what*!\r\n\r\n### How to reproduce\r\n\r\n1. hack your kubespawner method `async def start(self)` and add  `await asyncio.sleep(180)`\r\n2. launch a server on that hub\r\n3. wait 3 minutes\r\n4. check grafana\r\n\r\n### Your personal set up\r\n\r\nUC Berkeley datahub:  https://data.berkeley.edu/datahub\r\nrunning on GCP/GKE\r\nz2h installation\r\ngrafana dashboards from the jupyterhub repo\r\ngrafana v9.0.5\r\njupyterhub v3.1.0\r\n\r\npinging @yuvipanda as this was his baby, and i recently inherited it.  XD\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4351/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4351/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4345", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4345/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4345/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4345/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/4345", "id": 1579252661, "node_id": "I_kwDOAT0rQs5eIXu1", "number": 4345, "title": "Proxy failed to start with exit code -6", "user": {"login": "ggravlingen", "id": 21142447, "node_id": "MDQ6VXNlcjIxMTQyNDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/21142447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ggravlingen", "html_url": "https://github.com/ggravlingen", "followers_url": "https://api.github.com/users/ggravlingen/followers", "following_url": "https://api.github.com/users/ggravlingen/following{/other_user}", "gists_url": "https://api.github.com/users/ggravlingen/gists{/gist_id}", "starred_url": "https://api.github.com/users/ggravlingen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ggravlingen/subscriptions", "organizations_url": "https://api.github.com/users/ggravlingen/orgs", "repos_url": "https://api.github.com/users/ggravlingen/repos", "events_url": "https://api.github.com/users/ggravlingen/events{/privacy}", "received_events_url": "https://api.github.com/users/ggravlingen/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2023-02-10T08:35:10Z", "updated_at": "2023-02-10T14:14:01Z", "closed_at": "2023-02-10T12:38:32Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n\r\nI'm trying to upgrade to 3.1.1 from 2.3.0, but am meeting the errors from the log below. Can't really understand why this is happening and after searching through the issues here, I can't seem to find anyone else who's seen the same issues.\r\n\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\n\r\n#### Expected behaviour\r\n\r\n<!-- Tell us what you thought would happen. -->\r\n\r\nJupyterhub starts and I'm able to access the hub.\r\n\r\n#### Actual behaviour\r\n\r\nThe container crashes and I'm unable to access the hub.\r\n\r\n<!-- Tell us what actually happens. -->\r\n\r\n### How to reproduce\r\n\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\n1. Go to '...'\r\n2. Click on '....'\r\n3. Scroll down to '....'\r\n4. See error\r\n\r\n### Your personal set up\r\n\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n\r\n - OS: Running this in a Docker environment on Ubuntu 20.04.1.\r\n <!-- [e.g. ubuntu 20.04, macOS 11.0] -->\r\n - Version(s): `jupyterhub/jupyterhub:3.1.1`\r\n <!-- e.g. jupyterhub --version, python --version --->\r\n\r\n<details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\n# paste output of `pip freeze` or `conda list` here\r\n```\r\n</details>\r\n\r\n<details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```python\r\nimport os\r\nimport shutil\r\nfrom pathlib import Path\r\n\r\nfrom dockerspawner import DockerSpawner\r\nfrom oauthenticator.azuread import LocalAzureAdOAuthenticator\r\nfrom traitlets import default\r\n\r\nc = get_config()\r\n\r\n\r\n# Spawn a new docker for each user\r\nNOTEBOOK_DIR = \"/home/jovyan/work\"\r\nHOST_HOME_PATH = os.getenv(\"HOST_HOME_PATH\", \"/jupyter-notebook\")\r\nHOST_USER_PATH = HOST_HOME_PATH + \"/{username}\"\r\nHOST_NOTEBOOK_PATH = f\"{HOST_USER_PATH}/work/\"\r\n\r\n\r\ndef create_folder_if_not_exists(volume: str) -> None:\r\n    \"\"\"Util function to create a folder.\"\"\"\r\n    if not os.path.exists(volume):\r\n        path = Path(volume)\r\n        path.mkdir(parents=True, exist_ok=True)\r\n        os.chmod(path, 0o755)\r\n\r\n\r\nclass NewDockerSpawner(DockerSpawner):\r\n    # Users that may access analytical shared folder\r\n    team: list = [\r\n        \"ggravlingen\",\r\n    ]\r\n\r\n    # A folder that can be accessed by all users\r\n    shared_all = f\"{HOST_HOME_PATH}/shared-all\"\r\n\r\n    # Permission based folders\r\n    shared_team_folder = f\"{HOST_HOME_PATH}/shared-analytical\"\r\n\r\n    def start(self):\r\n        \"\"\"Handle shared volumes.\"\"\"\r\n        create_folder_if_not_exists(self.shared_team_folder)\r\n\r\n        # A folder that can be accessed by all users\r\n        self.volumes[self. shared_team_folder] = {\r\n            \"bind\": \"/home/jovyan/work/0-shared-all\",\r\n            \"mode\": \"rw\",\r\n        }\r\n        self.volumes[HOST_NOTEBOOK_PATH] = {\"bind\": NOTEBOOK_DIR, \"mode\": \"rw\"}\r\n\r\n        return super().start()\r\n\r\n\r\nclass AzureAdOAuthenticator(LocalAzureAdOAuthenticator):\r\n    \"\"\"Custom implementation that uses username instead of name as login.\"\"\"\r\n\r\n    @property\r\n    def oauth_callback_url(self) -> str:\r\n        \"\"\"Return callback url.\"\"\"\r\n        # For local debugging\r\n        return \"http://localhost/datalab/hub/oauth_callback\"\r\n\r\n    @default(\"username_claim\")\r\n    def _username_claim_default(self):\r\n        return \"unique_name\"\r\n\r\n    def normalize_username(self, username):\r\n        \"\"\"\r\n        Override normalize_username to avoid lowercasing usernames.\r\n        \"\"\"\r\n        return username.split(\"@\")[0]\r\n\r\n\r\ndef pre_spawn_hook(spawner):\r\n    \"\"\"\r\n    Pre-spawn hook.\r\n\r\n    These commands are run on the host.\r\n    \"\"\"\r\n    spawner.log.info(f\"----------- Running pre-spawn hook -------------------\")\r\n    username = spawner.user.name  # get the username\r\n    volume = f\"{HOST_HOME_PATH}/{username}/work\"\r\n\r\n    # path on the jupytherhub host, create a folder based on username if not exists\r\n    create_folder_if_not_exists(volume)\r\n    shutil.chown(volume, user=username, group=\"users\")\r\n\r\n\r\nc.Application.log_level = \"DEBUG\"\r\n# The date format used by logging formatters for %(asctime)s\r\nc.Application.log_datefmt = \"%Y-%m-%d %H:%M:%S\"\r\n\r\n\r\nc.JupyterHub.spawner_class = NewDockerSpawner\r\nnetwork_name = os.environ[\"DOCKER_NETWORK_NAME\"]\r\nc.DockerSpawner.use_internal_ip = True\r\nc.DockerSpawner.image = os.environ[\"DOCKER_JUPYTER_IMAGE\"]\r\nc.DockerSpawner.network_name = network_name\r\nc.DockerSpawner.notebook_dir = NOTEBOOK_DIR\r\nc.DockerSpawner.remove = True\r\nc.DockerSpawner.extra_create_kwargs = {\"user\": \"root\"}\r\nc.DockerSpawner.extra_host_config = {\"network_mode\": network_name}\r\nc.DockerSpawner.env_keep = [\r\n    \"DB_HOST\",\r\n]\r\n\r\nc.DockerSpawner.environment = {\r\n    \"CHOWN_HOME\": \"yes\",\r\n    \"CHOWN_EXTRA\": \"/home/jovyan\",\r\n    \"CHOWN_HOME_OPTS\": \"-R\",\r\n    \"NB_UID\": 1000,\r\n    \"NB_GID\": 1000,\r\n}\r\n\r\nc.Spawner.pre_spawn_hook = pre_spawn_hook\r\n\r\n# Test config\r\nc.Spawner.default_url = \"/lab\"\r\n\r\n# Don't stop clients when restarting the bub\r\nc.JupyterHub.cleanup_servers = False\r\n\r\nc.JupyterHub.services = [\r\n    {\r\n        \"name\": \"cull_idle\",\r\n        \"admin\": True,\r\n        \"command\": [\"python3\", \"/srv/jupyterhub/cull_idle_servers.py\", \"--timeout=600\"],\r\n    }\r\n]\r\n\r\n# Login using AAD\r\nc.JupyterHub.authenticator_class = AzureAdOAuthenticator\r\nc.AzureAdOAuthenticator.oauth_callback_url = \"http://localhost/hub/oauth_callback\"\r\n\r\nc.AzureAdOAuthenticator.tenant_id = os.environ.get(\"AAD_TENANT_ID\")\r\nc.AzureAdOAuthenticator.client_id = os.environ.get(\"OAUTH_CLIENT_ID\")\r\nc.AzureAdOAuthenticator.client_secret = os.environ.get(\"OAUTH_CLIENT_SECRET\")\r\n\r\n# specify users and admin\r\nc.Authenticator.admin_users = {\"sg06\"}\r\nc.AzureAdOAuthenticator.create_system_users = True\r\n\r\n# Proxy settings\r\nc.ConfigurableHTTPProxy.debug = False\r\nc.ConfigurableHTTPProxy.log_level = \"info\"\r\nc.ConfigurableHTTPProxy.pid_file = \"/run/jupyterhub-proxy.pid\"\r\n\r\n# Debug - disable proxy\r\n# start manually\r\n# configurable-http-proxy --ip '' --port 8000 --api-ip 127.0.0.1 --api-port 8001 -error-target http://hub:8081/datalab/hub/error --log-level \u2018info\u2019\r\n# c.ConfigurableHTTPProxy.should_start = False\r\n# c.ConfigurableHTTPProxy.auth_token = \"CONFIGPROXY_AUTH_TOKEN\" \r\n\r\n# IP configuration for the proxy\r\nc.JupyterHub.ip = \"\"\r\nc.JupyterHub.hub_connect_ip = \"hub\"\r\nc.JupyterHub.base_url = \"/datalab\"\r\n```\r\n</details>\r\n\r\n<details>\r\n\r\n```bash\r\n[I 2023-02-10 08:11:48.136 JupyterHub app:2879] Initialized 0 spawners in 0.004 seconds\r\n[I 2023-02-10 08:11:48.144 JupyterHub metrics:278] Found 0 active users in the last ActiveUserPeriods.twenty_four_hours\r\n[I 2023-02-10 08:11:48.145 JupyterHub metrics:278] Found 0 active users in the last ActiveUserPeriods.seven_days\r\n[I 2023-02-10 08:11:48.146 JupyterHub metrics:278] Found 0 active users in the last ActiveUserPeriods.thirty_days\r\n[W 2023-02-10 08:11:48.146 JupyterHub proxy:625] Found proxy pid file: /run/jupyterhub-proxy.pid\r\n[W 2023-02-10 08:11:48.147 JupyterHub proxy:637] Proxy no longer running at pid=9\r\n[D 2023-02-10 08:11:48.147 JupyterHub proxy:678] Removing proxy pid file /run/jupyterhub-proxy.pid\r\n[W 2023-02-10 08:11:48.147 JupyterHub proxy:746] Running JupyterHub without SSL.  I hope there is SSL termination happening somewhere else...\r\n[I 2023-02-10 08:11:48.147 JupyterHub proxy:750] Starting proxy @ http://0.0.0.0:8000/datalab/\r\n[D 2023-02-10 08:11:48.147 JupyterHub proxy:751] Proxy cmd: ['configurable-http-proxy', '--ip', '0.0.0.0', '--port', '8000', '--api-ip', '127.0.0.1', '--api-port', '8001', '--error-target', 'http://hub:8081/datalab/hub/error', '--log-level', 'info']\r\n[D 2023-02-10 08:11:48.148 JupyterHub proxy:670] Writing proxy pid file: /run/jupyterhub-proxy.pid\r\nnode[10]: ../src/node_platform.cc:61:std::unique_ptr<long unsigned int> node::WorkerThreadsTaskRunner::DelayedTaskScheduler::Start(): Assertion `(0) == (uv_thread_create(t.get(), start_thread, this))' failed.\r\n 1: 0x7f909adf03cc node::Abort() [/lib/x86_64-linux-gnu/libnode.so.72]\r\n 2: 0x7f909adf045b  [/lib/x86_64-linux-gnu/libnode.so.72]\r\n 3: 0x7f909ae72de2 node::WorkerThreadsTaskRunner::WorkerThreadsTaskRunner(int) [/lib/x86_64-linux-gnu/libnode.so.72]\r\n 4: 0x7f909ae72f16 node::NodePlatform::NodePlatform(int, v8::TracingController*) [/lib/x86_64-linux-gnu/libnode.so.72]\r\n 5: 0x7f909adbb2c8 node::InitializeOncePerProcess(int, char**) [/lib/x86_64-linux-gnu/libnode.so.72]\r\n 6: 0x7f909adbb4ac node::Start(int, char**) [/lib/x86_64-linux-gnu/libnode.so.72]\r\n 7: 0x7f909a329d90  [/lib/x86_64-linux-gnu/libc.so.6]\r\n 8: 0x7f909a329e40 __libc_start_main [/lib/x86_64-linux-gnu/libc.so.6]\r\n 9: 0x565176eb00f5 _start [node]\r\n[C 2023-02-10 08:11:49.217 JupyterHub app:3091] Failed to start proxy\r\n    Traceback (most recent call last):\r\n      File \"/usr/local/lib/python3.10/dist-packages/jupyterhub/app.py\", line 3089, in start\r\n        await self.proxy.start()\r\n      File \"/usr/local/lib/python3.10/dist-packages/jupyterhub/proxy.py\", line 778, in start\r\n        _check_process()\r\n      File \"/usr/local/lib/python3.10/dist-packages/jupyterhub/proxy.py\", line 774, in _check_process\r\n        raise e from None\r\n    RuntimeError: Proxy failed to start with exit code -6\r\n    \r\n[D 2023-02-10 08:11:49.219 JupyterHub application:1026] Exiting application: jupyterhub\r\n```\r\n\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4345/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4345/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4330", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4330/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4330/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4330/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/4330", "id": 1563152495, "node_id": "I_kwDOAT0rQs5dK9Bv", "number": 4330, "title": "CookieError Ilegal key %r, Jupyterhub not sanitizing header keys properly", "user": {"login": "atnjqt", "id": 44907911, "node_id": "MDQ6VXNlcjQ0OTA3OTEx", "avatar_url": "https://avatars.githubusercontent.com/u/44907911?v=4", "gravatar_id": "", "url": "https://api.github.com/users/atnjqt", "html_url": "https://github.com/atnjqt", "followers_url": "https://api.github.com/users/atnjqt/followers", "following_url": "https://api.github.com/users/atnjqt/following{/other_user}", "gists_url": "https://api.github.com/users/atnjqt/gists{/gist_id}", "starred_url": "https://api.github.com/users/atnjqt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/atnjqt/subscriptions", "organizations_url": "https://api.github.com/users/atnjqt/orgs", "repos_url": "https://api.github.com/users/atnjqt/repos", "events_url": "https://api.github.com/users/atnjqt/events{/privacy}", "received_events_url": "https://api.github.com/users/atnjqt/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2023-01-30T20:27:13Z", "updated_at": "2023-02-16T15:06:24Z", "closed_at": "2023-02-16T15:06:24Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\n\r\nEnd users occasionally are receiving timeouts on **Jupyterhub 3.1.0**. On review, the error log `/var/log/jupyterhub.log` contains many unexpected references to an Illegal Key in HTTPCookie.\r\n\r\n#### Expected behaviour\r\n\r\n<!-- Tell us what you thought would happen. -->\r\n\r\nEnd users running R kernel ipynbs should not get unexpected timeouts due to invalid key in HTTP Cookies when authenticating to the hub via GitHub OAuth.\r\n\r\n#### Actual behaviour\r\n\r\n<!-- Tell us what actually happens. -->\r\n\r\nEnd users occasionally get timeouts. Below is a reference of the actual error log, the first hit. Interestingly the error log has thousands of hits for that same illegal key value, which I believe is a Google Analytics tag & measurement ID.\r\n\r\n```python\r\n[E 2023-01-24 00:12:16.024 JupyterHub web:1798] Uncaught exception GET / (::ffff:xxx.xxx.xxx.xxx)\r\n    HTTPServerRequest(protocol='https', host='commjhub.asc.upenn.edu', method='GET', uri='/', version='HTTP/1.1', remote_ip='::ffff:xxx.xxx.xxx.xxx')\r\n    Traceback (most recent call last):\r\n      File \"/usr/local/anaconda3/lib/python3.8/site-packages/tornado/web.py\", line 1711, in _execute\r\n        result = method(*self.path_args, **self.path_kwargs)\r\n      File \"/usr/local/anaconda3/lib/python3.8/site-packages/jupyterhub/handlers/base.py\", line 1391, in get\r\n        self.redirect(url_path_join(self.hub.base_url, path), permanent=False)\r\n      File \"/usr/local/anaconda3/lib/python3.8/site-packages/tornado/web.py\", line 816, in redirect\r\n        self.finish()\r\n      File \"/usr/local/anaconda3/lib/python3.8/site-packages/jupyterhub/handlers/base.py\", line 184, in finish\r\n        super().finish(*args, **kwargs)\r\n      File \"/usr/local/anaconda3/lib/python3.8/site-packages/tornado/web.py\", line 1161, in finish\r\n        self._log()\r\n      File \"/usr/local/anaconda3/lib/python3.8/site-packages/tornado/web.py\", line 1746, in _log\r\n        self.application.log_request(self)\r\n      File \"/usr/local/anaconda3/lib/python3.8/site-packages/tornado/web.py\", line 2262, in log_request\r\n        self.settings[\"log_function\"](handler)\r\n      File \"/usr/local/anaconda3/lib/python3.8/site-packages/jupyterhub/log.py\", line 143, in log_request\r\n        headers = _scrub_headers(request.headers)\r\n      File \"/usr/local/anaconda3/lib/python3.8/site-packages/jupyterhub/log.py\", line 108, in _scrub_headers\r\n        c = SimpleCookie(headers['Cookie'])\r\n      File \"/usr/local/anaconda3/lib/python3.8/http/cookies.py\", line 480, in __init__\r\n        self.load(input)\r\n      File \"/usr/local/anaconda3/lib/python3.8/http/cookies.py\", line 529, in load\r\n        self.__parse_string(rawdata)\r\n      File \"/usr/local/anaconda3/lib/python3.8/http/cookies.py\", line 593, in __parse_string\r\n        self.__set(key, rval, cval)\r\n      File \"/usr/local/anaconda3/lib/python3.8/http/cookies.py\", line 485, in __set\r\n        M.set(key, real_value, coded_value)\r\n      File \"/usr/local/anaconda3/lib/python3.8/http/cookies.py\", line 352, in set\r\n        raise CookieError('Illegal key %r' % (key,))\r\n    http.cookies.CookieError: Illegal key '_ga_SR2P22QVQQ,G-0HYE8YG0M6'\r\n```\r\n\r\n### How to reproduce\r\n\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\nPass an invalid key for HTTP cookies. In my case, I think it's the comma value in the GA `http.cookies.CookieError: Illegal key '_ga_SR2P22QVQQ,G-0HYE8YG0M6'` based on information here:  https://docs.python.org/3/library/http.cookies.html#module-http.cookies\r\n> Note: On encountering an invalid cookie, CookieError is raised, so if your cookie data comes from a browser you should always prepare for invalid data and catch CookieError on parsing.\r\n\r\n### Your personal set up\r\n\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n\r\n - OS: Ubuntu 20.04.5 LTS\r\n <!-- [e.g. ubuntu 20.04, macOS 11.0] -->\r\n - Version(s): \r\n   - Jupyterhub 3.1.0\r\n   - Python 3.8.8 \r\n <!-- e.g. jupyterhub --version, python --version --->\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4330/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4330/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4317", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4317/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4317/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4317/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4317", "id": 1559537529, "node_id": "PR_kwDOAT0rQs5IqjoQ", "number": 4317, "title": "Backport PR #4303 on branch 3.x (make sure event-schemas are installed)", "user": {"login": "meeseeksmachine", "id": 39504233, "node_id": "MDQ6VXNlcjM5NTA0MjMz", "avatar_url": "https://avatars.githubusercontent.com/u/39504233?v=4", "gravatar_id": "", "url": "https://api.github.com/users/meeseeksmachine", "html_url": "https://github.com/meeseeksmachine", "followers_url": "https://api.github.com/users/meeseeksmachine/followers", "following_url": "https://api.github.com/users/meeseeksmachine/following{/other_user}", "gists_url": "https://api.github.com/users/meeseeksmachine/gists{/gist_id}", "starred_url": "https://api.github.com/users/meeseeksmachine/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/meeseeksmachine/subscriptions", "organizations_url": "https://api.github.com/users/meeseeksmachine/orgs", "repos_url": "https://api.github.com/users/meeseeksmachine/repos", "events_url": "https://api.github.com/users/meeseeksmachine/events{/privacy}", "received_events_url": "https://api.github.com/users/meeseeksmachine/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-01-27T10:42:42Z", "updated_at": "2023-01-27T10:53:32Z", "closed_at": "2023-01-27T10:53:32Z", "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/4317", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4317", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/4317.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/4317.patch", "merged_at": "2023-01-27T10:53:32Z"}, "body": "Backport PR #4303: make sure event-schemas are installed", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4317/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4317/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4315", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4315/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4315/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4315/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4315", "id": 1559483336, "node_id": "PR_kwDOAT0rQs5IqXz_", "number": 4315, "title": "Backport PR #4302: sqlalchemy 2 compatibility", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-01-27T10:03:55Z", "updated_at": "2023-01-27T10:31:17Z", "closed_at": "2023-01-27T10:31:16Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/4315", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4315", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/4315.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/4315.patch", "merged_at": "2023-01-27T10:31:16Z"}, "body": "backports #4302 onto 3.x\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4315/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4315/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4312", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4312/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4312/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4312/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/4312", "id": 1559031703, "node_id": "I_kwDOAT0rQs5c7O-X", "number": 4312, "title": "JupyterHub is not compatible with sqlalchemy 2", "user": {"login": "dclong", "id": 824507, "node_id": "MDQ6VXNlcjgyNDUwNw==", "avatar_url": "https://avatars.githubusercontent.com/u/824507?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dclong", "html_url": "https://github.com/dclong", "followers_url": "https://api.github.com/users/dclong/followers", "following_url": "https://api.github.com/users/dclong/following{/other_user}", "gists_url": "https://api.github.com/users/dclong/gists{/gist_id}", "starred_url": "https://api.github.com/users/dclong/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dclong/subscriptions", "organizations_url": "https://api.github.com/users/dclong/orgs", "repos_url": "https://api.github.com/users/dclong/repos", "events_url": "https://api.github.com/users/dclong/events{/privacy}", "received_events_url": "https://api.github.com/users/dclong/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-01-27T01:34:44Z", "updated_at": "2023-01-27T12:19:48Z", "closed_at": "2023-01-27T10:00:31Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\nJupyterHub installed using `pip3 install jupyterhub` fails to launch with the following error messages due to a breaking release of SqlAlchemy (2.0.0). \r\n```\r\n[I 2023-01-26 17:04:14.612 JupyterHub app:2810] Running JupyterHub version 3.1.0\r\n[I 2023-01-26 17:04:14.612 JupyterHub app:2840] Using Authenticator: jupyterhub.auth.PAMAuthenticator-3.1.0\r\n[I 2023-01-26 17:04:14.612 JupyterHub app:2840] Using Spawner: jupyterhub.spawner.LocalProcessSpawner-3.1.0\r\n[I 2023-01-26 17:04:14.612 JupyterHub app:2840] Using Proxy: jupyterhub.proxy.ConfigurableHTTPProxy-3.1.0\r\n[I 2023-01-26 17:04:14.613 JupyterHub app:1694] Writing cookie_secret to /root/jupyterhub_cookie_secret\r\n[E 2023-01-26 17:04:14.618 JupyterHub app:3334]\r\n    Traceback (most recent call last):\r\n      File \"/usr/local/lib/python3.10/dist-packages/jupyterhub/app.py\", line 3331, in launch_instance_async\r\n        await self.initialize(argv)\r\n      File \"/usr/local/lib/python3.10/dist-packages/jupyterhub/app.py\", line 2852, in initialize\r\n        self.init_db()\r\n      File \"/usr/local/lib/python3.10/dist-packages/jupyterhub/app.py\", line 1823, in init_db\r\n        self.session_factory = orm.new_session_factory(\r\n      File \"/usr/local/lib/python3.10/dist-packages/jupyterhub/orm.py\", line 1061, in new_session_factory\r\n        check_db_revision(engine)\r\n      File \"/usr/local/lib/python3.10/dist-packages/jupyterhub/orm.py\", line 953, in check_db_revision\r\n        current_table_names = set(inspect(engine).get_table_names())\r\n      File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/inspection.py\", line 111, in inspect\r\n        ret = reg(subject)\r\n      File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/engine/reflection.py\", line 304, in _engine_insp\r\n        return Inspector._construct(Inspector._init_engine, bind)\r\n      File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/engine/reflection.py\", line 237, in _construct\r\n        init(self, bind)\r\n      File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/engine/reflection.py\", line 248, in _init_engine\r\n        engine.connect().close()\r\n      File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/engine/base.py\", line 3245, in connect\r\n        return self._connection_cls(self)\r\n      File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/engine/base.py\", line 174, in __init__\r\n        self.dispatch.engine_connect(self)\r\n      File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/event/attr.py\", line 487, in __call__\r\n        fn(*args, **kw)\r\n      File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/event/legacy.py\", line 100, in wrap_leg\r\n        return fn(*conv(*args))\r\n      File \"/usr/local/lib/python3.10/dist-packages/jupyterhub/orm.py\", line 919, in ping_connection\r\n        connection.scalar(select([1]))\r\n      File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/sql/_selectable_constructors.py\", line 493, in select\r\n        return Select(*entities)\r\n      File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/sql/selectable.py\", line 5219, in __init__\r\n        self._raw_columns = [\r\n      File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/sql/selectable.py\", line 5220, in <listcomp>\r\n        coercions.expect(\r\n      File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/sql/coercions.py\", line 413, in expect\r\n        resolved = impl._literal_coercion(\r\n      File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/sql/coercions.py\", line 652, in _literal_coercion\r\n        self._raise_for_expected(element, argname)\r\n      File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/sql/coercions.py\", line 1143, in _raise_for_expected\r\n        return super()._raise_for_expected(\r\n      File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/sql/coercions.py\", line 711, in _raise_for_expected\r\n        super()._raise_for_expected(\r\n      File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/sql/coercions.py\", line 536, in _raise_for_expected\r\n        raise exc.ArgumentError(msg, code=code) from err\r\n    sqlalchemy.exc.ArgumentError: Column expression, FROM clause, or other columns clause element expected, got [1]. Did you mean to say select(1)?\r\n    \r\n```\r\n\r\n#### Expected behaviour\r\n\r\n<!-- Tell us what you thought would happen. -->\r\nJupyterHub installed by `pip3 install jupyterhub` should work out-of-the-box instead of requiring users to restrict its dependencies when installing it. \r\n\r\n#### Actual behaviour\r\n\r\n<!-- Tell us what actually happens. -->\r\nSee the bug description.\r\n\r\n### How to reproduce\r\n\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\n1. Install JupyterHub with `pip3 install jupyterlab jupyterhub`\r\n2. Launch JupyterHub \r\n4. See error\r\n\r\n### Your personal set up\r\n\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n\r\n - OS:\r\n <!-- [e.g. ubuntu 20.04, macOS 11.0] -->\r\n - Version(s):\r\n <!-- e.g. jupyterhub --version, python --version --->\r\n\r\n<details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\n# paste output of `pip freeze` or `conda list` here\r\n```\r\n</details>\r\n\r\n<details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```python\r\n# jupyterhub_config.py\r\n```\r\n</details>\r\n\r\n<details><summary>Logs</summary>\r\n<!--\r\nErrors are often logged by jupytehub. How you get logs depends on your deployment.\r\nWith kubernetes it might be:\r\n\r\n    kubectl get pod # hub pod name starts with hub...\r\n    kubectl logs hub-...\r\n    # or for a single-user server\r\n    kubectl logs jupyter-username\r\n\r\nOr the-littlest-jupyterhub:\r\n\r\n    journalctl -u jupyterhub\r\n    # or for a single-user server\r\n    journalctl -u jupyter-username\r\n-->\r\n\r\n```\r\n# paste relevant logs here, if any\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4312/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4312/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4303", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4303/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4303/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4303/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4303", "id": 1548751609, "node_id": "PR_kwDOAT0rQs5IGlGc", "number": 4303, "title": "make sure event-schemas are installed", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-01-19T09:00:12Z", "updated_at": "2023-01-27T10:42:34Z", "closed_at": "2023-01-19T09:16:46Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/4303", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4303", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/4303.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/4303.patch", "merged_at": "2023-01-19T09:16:46Z"}, "body": "when not installed, event publishing won't work because they will show as 'unregistered', since the schemas are unavailable.\r\n\r\nrevealed in #4302 because I switched it to testing against an install instead of the repo checkout", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4303/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4303/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4302", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4302/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4302/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4302/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4302", "id": 1537685588, "node_id": "PR_kwDOAT0rQs5Hm_Ln", "number": 4302, "title": "sqlalchemy 2 compatibility", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2023-01-18T09:39:10Z", "updated_at": "2023-01-27T10:39:12Z", "closed_at": "2023-01-27T10:00:30Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/4302", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4302", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/4302.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/4302.patch", "merged_at": "2023-01-27T10:00:30Z"}, "body": "- avoid backref warnings by adding objects to session explicitly before creating any relationships\r\n- remove unnecessary `[]` around scalar query\r\n- use `text()` wrapper on connection.execute\r\n- engine.execute is removed\r\n- update import of declarative_base\r\n- raise on any sqlalchemy 2 removal warnings during testing\r\n\r\nas sqlalchemy 2 is in release candidate, this probably warrants a backport to 3.1 at least, and maybe also 2.0?\r\n\r\ncloses #4312\r\ncloses #4313", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4302/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4302/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4299", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4299/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4299/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4299/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4299", "id": 1532303546, "node_id": "PR_kwDOAT0rQs5HVIvl", "number": 4299, "title": "test and fix deprecated load_groups list", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-01-13T13:24:49Z", "updated_at": "2023-02-03T11:39:05Z", "closed_at": "2023-01-13T14:58:47Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/4299", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4299", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/4299.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/4299.patch", "merged_at": "2023-01-13T14:58:47Z"}, "body": "This is a follow-up to #3651. I thought I had pushed this commit before landing that PR, but apparently not.\r\n\r\nThe preferred format of `load_groups`  is changed, but the old format is still allowed. This adds a test to ensure the old format still works.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4299/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4299/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4295", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4295/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4295/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4295/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4295", "id": 1529275140, "node_id": "PR_kwDOAT0rQs5HK2-x", "number": 4295, "title": "Fix formatting of load_groups help string", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-01-11T15:44:25Z", "updated_at": "2023-01-11T15:50:13Z", "closed_at": "2023-01-11T15:49:45Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/4295", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4295", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/4295.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/4295.patch", "merged_at": "2023-01-11T15:49:45Z"}, "body": "quickfix of #3651\r\n\r\nI thought the docs build failure was unrelated because it referenced some untouched code, but it was a case of the error message not actually pointing to where the problem is.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4295/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 1, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4295/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4290", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4290/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4290/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4290/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4290", "id": 1524716273, "node_id": "PR_kwDOAT0rQs5G7fbu", "number": 4290, "title": "Fix skipped heading level across pages", "user": {"login": "bl-aire", "id": 84882370, "node_id": "MDQ6VXNlcjg0ODgyMzcw", "avatar_url": "https://avatars.githubusercontent.com/u/84882370?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bl-aire", "html_url": "https://github.com/bl-aire", "followers_url": "https://api.github.com/users/bl-aire/followers", "following_url": "https://api.github.com/users/bl-aire/following{/other_user}", "gists_url": "https://api.github.com/users/bl-aire/gists{/gist_id}", "starred_url": "https://api.github.com/users/bl-aire/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bl-aire/subscriptions", "organizations_url": "https://api.github.com/users/bl-aire/orgs", "repos_url": "https://api.github.com/users/bl-aire/repos", "events_url": "https://api.github.com/users/bl-aire/events{/privacy}", "received_events_url": "https://api.github.com/users/bl-aire/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-01-08T22:53:40Z", "updated_at": "2023-02-27T09:04:23Z", "closed_at": "2023-01-09T10:45:36Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/4290", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4290", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/4290.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/4290.patch", "merged_at": "2023-01-09T10:45:36Z"}, "body": "This fixes the skipped heading level accessibility issue across JupyterHub pages. \r\n\r\nIt also adds `<th>` cells to the tables in the Token page so screen readers will interpret them as data tables(i.e., announcing column and row numbers) and not layout tables as stated in #4265\n\n@minrk ", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4290/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4290/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4275", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4275/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4275/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4275/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/4275", "id": 1500944910, "node_id": "I_kwDOAT0rQs5ZdpoO", "number": 4275, "title": "Shutdown servers missing from `GET /users/:username` endpoint", "user": {"login": "wudstrand", "id": 10553702, "node_id": "MDQ6VXNlcjEwNTUzNzAy", "avatar_url": "https://avatars.githubusercontent.com/u/10553702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wudstrand", "html_url": "https://github.com/wudstrand", "followers_url": "https://api.github.com/users/wudstrand/followers", "following_url": "https://api.github.com/users/wudstrand/following{/other_user}", "gists_url": "https://api.github.com/users/wudstrand/gists{/gist_id}", "starred_url": "https://api.github.com/users/wudstrand/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wudstrand/subscriptions", "organizations_url": "https://api.github.com/users/wudstrand/orgs", "repos_url": "https://api.github.com/users/wudstrand/repos", "events_url": "https://api.github.com/users/wudstrand/events{/privacy}", "received_events_url": "https://api.github.com/users/wudstrand/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-12-16T22:21:09Z", "updated_at": "2022-12-23T10:35:19Z", "closed_at": "2022-12-23T10:35:18Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\n\r\nI am using the jupyterhub backend to build a in browser coding environment, and I interface with the jupyterhub API through a custom hub service. In my jupyterhub configuration I have enabled named servers with a limit of three servers per user.  I have enabled the functionality to both shutdown and remove the servers through my custom service by using the hubs `DELETE /users/:name/servers/:server_name` endpoint (NOTE: removing the server adds `{'remove': true}` to the body of the request). I want to allow user to shutdown a server, and only remove it only when they reach their limit. I am running into an issue when trying to get a list of all the servers (i.e. running and shutdown) for a user. The only way I know to get the server for a user is through the `GET /users/:username` endpoint, but this only shows the running servers. Is there a way to get it to show the shutdown servers as well? Or is there another endpoint I can leverage? If not I would like to request an enhancement to the hub's API to handle this use case.\r\n\r\n\r\n#### Expected behaviour\r\n\r\nHere are a list of acceptable behaviors\r\n\r\n- An endpoint for getting all servers for a user (running and shutdown).\r\n- Enhancing the current user endpoint to include servers that are shutdown in the response.\r\n- Enhancing the current user endpoint to have a flag that would include servers that are shutdown in the response.\r\n\r\n#### Actual behaviour\r\n\r\nServers that are shutdown but not explicitly removed effect the number of named servers a user is allowed to create. Additionally there in no way via the jupyterhub API to get a list of all the servers (i.e. running and shutdown) for a user.\r\n\r\n### How to reproduce\r\n\r\n1. [Enable named servers](https://jupyterhub.readthedocs.io/en/stable/reference/config-user-env.html#named-servers).\r\n2. Limit the number of named servers for a single user to three.\r\n3. Create three servers for a single user via the API\r\n4. Delete one of the three server with the `DELETE /users/:name/servers/:server_name` endpoint and exclude `{'remove': true}` from the body of the request\r\n5. Try to create another server with a different name from the previous three.\r\n    - Notice the request errors out\r\n6. Make a request to the `GET /users/:username` endpoint and notice only the two servers running show up in the response.\r\n    - Desired: The name of the shutdown server shows up here, so you can programmatically get the name of the server to delete it.\r\n\r\n### Your personal set up\r\n \r\nI am running jupyterhub on k8s using the [ztjh](https://z2jh.jupyter.org/en/stable/#zero-to-jupyterhub-with-kubernetes)\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4275/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4275/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4274", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4274/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4274/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4274/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4274", "id": 1500316704, "node_id": "PR_kwDOAT0rQs5FpYaQ", "number": 4274, "title": "Fix reoccurring accessibility issues in JupyterHub's pages", "user": {"login": "bl-aire", "id": 84882370, "node_id": "MDQ6VXNlcjg0ODgyMzcw", "avatar_url": "https://avatars.githubusercontent.com/u/84882370?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bl-aire", "html_url": "https://github.com/bl-aire", "followers_url": "https://api.github.com/users/bl-aire/followers", "following_url": "https://api.github.com/users/bl-aire/following{/other_user}", "gists_url": "https://api.github.com/users/bl-aire/gists{/gist_id}", "starred_url": "https://api.github.com/users/bl-aire/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bl-aire/subscriptions", "organizations_url": "https://api.github.com/users/bl-aire/orgs", "repos_url": "https://api.github.com/users/bl-aire/repos", "events_url": "https://api.github.com/users/bl-aire/events{/privacy}", "received_events_url": "https://api.github.com/users/bl-aire/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2022-12-16T14:24:42Z", "updated_at": "2023-02-27T09:04:22Z", "closed_at": "2022-12-21T14:36:45Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/4274", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4274", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/4274.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/4274.patch", "merged_at": "2022-12-21T14:36:45Z"}, "body": "After reviewing the accessibility of some of JupyterHub's pages, a few accessibility issues have been reoccurring. They can be seen here:\r\n\r\n- Login page: #4260\r\n\r\n- Home page: #4262\r\n\r\n- Token page: #4265\r\n\r\n- 404 page: #4270\r\n\r\nWith this PR, solutions to a few of them like **Lang missing or invalid** and **Missing first level heading** which were discussed earlier in the issues are implemented. Also the logo's **Alt text** is renamed from _jupyterhub_ to _jupyterhub logo_ so it clearly states the purpose of the image to people who rely on screen readers.\r\n\r\n### Report: \r\n\r\nThe report below shows the Login page with the changes above implemented\r\n\r\n<img width=\"1266\" alt=\"Screenshot 2022-12-16 at 14 17 01\" src=\"https://user-images.githubusercontent.com/84882370/208118683-39607460-b993-4baf-b686-2dde21f6fa57.png\">\r\n\r\n@minrk \r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4274/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4274/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4258", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4258/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4258/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4258/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4258", "id": 1486287582, "node_id": "PR_kwDOAT0rQs5E4Wk_", "number": 4258, "title": "Remove remnants of unused jupyterhub-services cookie", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-12-09T08:13:26Z", "updated_at": "2023-02-03T11:39:08Z", "closed_at": "2022-12-21T11:52:01Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/4258", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4258", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/4258.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/4258.patch", "merged_at": "2022-12-21T11:52:01Z"}, "body": "We stopped being able to use it in 2.0, but we didn't stop setting it.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4258/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4258/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4231", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4231/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4231/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4231/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/4231", "id": 1469162044, "node_id": "I_kwDOAT0rQs5XkaI8", "number": 4231, "title": "Empty Admin panel on JupyterHub 3.0.0", "user": {"login": "jiayuasu", "id": 10948864, "node_id": "MDQ6VXNlcjEwOTQ4ODY0", "avatar_url": "https://avatars.githubusercontent.com/u/10948864?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jiayuasu", "html_url": "https://github.com/jiayuasu", "followers_url": "https://api.github.com/users/jiayuasu/followers", "following_url": "https://api.github.com/users/jiayuasu/following{/other_user}", "gists_url": "https://api.github.com/users/jiayuasu/gists{/gist_id}", "starred_url": "https://api.github.com/users/jiayuasu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jiayuasu/subscriptions", "organizations_url": "https://api.github.com/users/jiayuasu/orgs", "repos_url": "https://api.github.com/users/jiayuasu/repos", "events_url": "https://api.github.com/users/jiayuasu/events{/privacy}", "received_events_url": "https://api.github.com/users/jiayuasu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-11-30T07:19:08Z", "updated_at": "2022-11-30T13:11:25Z", "closed_at": "2022-11-30T13:11:25Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n\r\nJupyterHub 3.0.0 shows an empty Admin panel while JupyterHub 2.3.1 shows the correct panel with the same config.\r\n\r\n#### Expected behaviour\r\n\r\n<!-- Tell us what you thought would happen. -->\r\n\r\n![image](https://user-images.githubusercontent.com/10948864/204731081-5a35d29d-264a-411a-acac-f42b39f45eee.png)\r\n\r\n\r\n#### Actual behaviour\r\n\r\n![image](https://user-images.githubusercontent.com/10948864/204731210-f081af1e-a65d-4a55-898b-0dad12522c41.png)\r\n\r\n\r\n### How to reproduce\r\n\r\nOpen the admin panel on JupyterHub\r\n\r\n### Your personal set up\r\n\r\nContent in `Dockerfile`:\r\n\r\n```\r\nFROM jupyterhub/jupyterhub:3.0.0\r\n\r\nMAINTAINER Project Jupyter <ipython-dev@scipy.org>\r\n\r\nRUN python3 -m pip install jupyterlab\r\n\r\n# Add JupyterNotebook config\r\nWORKDIR /etc/jupyter/\r\nADD jupyter_notebook_config.py jupyter_notebook_config.py\r\n\r\n# Create oauthenticator directory and put necessary files in it\r\nRUN mkdir /etc/jupyterhub/\r\nWORKDIR /etc/jupyterhub/\r\nADD jupyterhub_config.py jupyterhub_config.py\r\n\r\n```\r\n\r\nContent in `jupyerhub_config.py`\r\n\r\n```\r\nimport os\r\nimport sys\r\n\r\nc = get_config()\r\n\r\nc.Spawner.args = ['--NotebookApp.tornado_settings={\"headers\":{\"Content-Security-Policy\": \"frame-ancestors * self \"}}']   \r\n\r\nc.JupyterHub.tornado_settings = {\r\n    'headers': {\r\n        'Content-Security-Policy': \"frame-ancestors * self \"\r\n  }\r\n}\r\n\r\nc.JupyterHub.log_level = 10\r\nc.JupyterHub.admin_access = True\r\nc.JupyterHub.shutdown_on_logout = True\r\n\r\nc.Authenticator.admin_users = {'XXX'}\r\nc.LocalAuthenticator.create_system_users = True\r\nc.LocalAuthenticator.add_user_cmd = ['adduser', '-q', '--gecos', '', '--disabled-password', '--force-badname']\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4231/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4231/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4230", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4230/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4230/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4230/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4230", "id": 1467697313, "node_id": "PR_kwDOAT0rQs5D3mSd", "number": 4230, "title": "make current_user available to handle_logout hook", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-11-29T09:04:42Z", "updated_at": "2023-02-03T11:39:06Z", "closed_at": "2022-11-30T23:19:02Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/4230", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4230", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/4230.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/4230.patch", "merged_at": "2022-11-30T23:19:02Z"}, "body": "Clear the user prior to rendering the logout page, rather than in clear_login_cookie. ensures current_user is accessible in `handle_logout` hook, so the hook can take the user into account.\r\n\r\ncloses #4202", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4230/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4230/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4212", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4212/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4212/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4212/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/4212", "id": 1449936939, "node_id": "I_kwDOAT0rQs5WbEgr", "number": 4212, "title": "gt", "user": {"login": "Aknc34", "id": 114412646, "node_id": "U_kgDOBtHMZg", "avatar_url": "https://avatars.githubusercontent.com/u/114412646?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aknc34", "html_url": "https://github.com/Aknc34", "followers_url": "https://api.github.com/users/Aknc34/followers", "following_url": "https://api.github.com/users/Aknc34/following{/other_user}", "gists_url": "https://api.github.com/users/Aknc34/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aknc34/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aknc34/subscriptions", "organizations_url": "https://api.github.com/users/Aknc34/orgs", "repos_url": "https://api.github.com/users/Aknc34/repos", "events_url": "https://api.github.com/users/Aknc34/events{/privacy}", "received_events_url": "https://api.github.com/users/Aknc34/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-11-15T15:06:40Z", "updated_at": "2022-11-15T16:14:25Z", "closed_at": "2022-11-15T16:14:25Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\n\r\n#### Expected behaviour\r\n\r\n<!-- Tell us what you thought would happen. -->\r\n\r\n#### Actual behaviour\r\n\r\n<!-- Tell us what actually happens. -->\r\n\r\n### How to reproduce\r\n\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\n1. Go to '...'\r\n2. Click on '....'\r\n3. Scroll down to '....'\r\n4. See error\r\n\r\n### Your personal set up\r\n\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n\r\n - OS:\r\n <!-- [e.g. ubuntu 20.04, macOS 11.0] -->\r\n - Version(s):\r\n <!-- e.g. jupyterhub --version, python --version --->\r\n\r\n<details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\n# paste output of `pip freeze` or `conda list` here\r\n```\r\n</details>\r\n\r\n<details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```python\r\n# jupyterhub_config.py\r\n```\r\n</details>\r\n\r\n<details><summary>Logs</summary>\r\n<!--\r\nErrors are often logged by jupytehub. How you get logs depends on your deployment.\r\nWith kubernetes it might be:\r\n\r\n    kubectl get pod # hub pod name starts with hub...\r\n    kubectl logs hub-...\r\n    # or for a single-user server\r\n    kubectl logs jupyter-username\r\n\r\nOr the-littlest-jupyterhub:\r\n\r\n    journalctl -u jupyterhub\r\n    # or for a single-user server\r\n    journalctl -u jupyter-username\r\n-->\r\n\r\n```\r\n# paste relevant logs here, if any\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4212/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4212/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4076", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4076/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4076/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4076/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4076", "id": 1403212468, "node_id": "PR_kwDOAT0rQs5Afx2Z", "number": 4076, "title": "Backport db rollback fixes to 1.x", "user": {"login": "mriedem", "id": 3237936, "node_id": "MDQ6VXNlcjMyMzc5MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/3237936?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mriedem", "html_url": "https://github.com/mriedem", "followers_url": "https://api.github.com/users/mriedem/followers", "following_url": "https://api.github.com/users/mriedem/following{/other_user}", "gists_url": "https://api.github.com/users/mriedem/gists{/gist_id}", "starred_url": "https://api.github.com/users/mriedem/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mriedem/subscriptions", "organizations_url": "https://api.github.com/users/mriedem/orgs", "repos_url": "https://api.github.com/users/mriedem/repos", "events_url": "https://api.github.com/users/mriedem/events{/privacy}", "received_events_url": "https://api.github.com/users/mriedem/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2022-10-10T13:49:14Z", "updated_at": "2023-02-27T09:04:20Z", "closed_at": "2022-10-12T10:37:23Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/4076", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4076", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/4076.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/4076.patch", "merged_at": "2022-10-12T10:37:23Z"}, "body": "This is a backport of PR #3566 to the 1.x branch in\r\norder to resolve the same issue seen in the 1.5.0 release.\r\n\r\nThere was a minor merge conflict in c29a5ca4c but the\r\nresolution was trivial.\r\n\r\nRelated #1626", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4076/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4076/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4063", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4063/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4063/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4063/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4063", "id": 1398628534, "node_id": "PR_kwDOAT0rQs5AQi4w", "number": 4063, "title": "Fully resolve requested scopes in oauth", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-10-06T01:58:20Z", "updated_at": "2022-10-10T07:25:00Z", "closed_at": "2022-10-10T07:24:43Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/4063", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4063", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/4063.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/4063.patch", "merged_at": "2022-10-10T07:24:43Z"}, "body": "Previously, when checking if an oauth client was allowed to request a scope or if a user was allowed to issue a token with a scope, the user must have the _exact_ scopes listed, or they would be excluded. This includes filters.\r\n\r\nWith this change, the full intersection is calculated. A critical example is e.g. read-only access to user servers, where a user might have the permissions:\r\n\r\n```\r\ncustom:execute!user\r\ncustom:read\r\n```\r\n(i.e. users can execute on their own servers, but read on anyone else's)\r\n\r\nand the server would issue tokens with:\r\n\r\n```\r\ncustom:read!server\r\ncustom:execute:!server\r\n```\r\n\r\nThe resulting token for the owner of this server should have the full permissions (!server intersects with !user for the owner), while a visitor will only get `custom:read!server` (read-only access to just this server because !server is a subset of all servers, and !server does _not_ intersect with !user for the visitor).\r\n\r\nThis is actually a _regression_ from 2.0, where we had special cased allowing issuing of tokens if the user had _some_ access to a particular scope, and we relied on request-time application of the filters.\r\n\r\nI think this finally delivers everything I was going for with the custom scopes.\r\n\r\nI also cleaned up some implicit scope behaviors that shouldn't have any practical consequences.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4063/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4063/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4062", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4062/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4062/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4062/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/4062", "id": 1396655065, "node_id": "I_kwDOAT0rQs5TP0PZ", "number": 4062, "title": "User Redirect Forces Simple View", "user": {"login": "angelahess", "id": 5648896, "node_id": "MDQ6VXNlcjU2NDg4OTY=", "avatar_url": "https://avatars.githubusercontent.com/u/5648896?v=4", "gravatar_id": "", "url": "https://api.github.com/users/angelahess", "html_url": "https://github.com/angelahess", "followers_url": "https://api.github.com/users/angelahess/followers", "following_url": "https://api.github.com/users/angelahess/following{/other_user}", "gists_url": "https://api.github.com/users/angelahess/gists{/gist_id}", "starred_url": "https://api.github.com/users/angelahess/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/angelahess/subscriptions", "organizations_url": "https://api.github.com/users/angelahess/orgs", "repos_url": "https://api.github.com/users/angelahess/repos", "events_url": "https://api.github.com/users/angelahess/events{/privacy}", "received_events_url": "https://api.github.com/users/angelahess/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-10-04T18:06:10Z", "updated_at": "2022-10-06T17:58:28Z", "closed_at": "2022-10-06T17:58:28Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\nWhen using a shareable link, the URL of format `<endpoint>/hub/user-redirect/lab/tree/<path>` is redirected to `<endpoint>/user/<userID>/doc/workspaces/auto-Z/tree/<path>`\r\n\r\nThis converts a /**lab**/tree link to a /**doc**/../tree link. Switching from lab -> doc defaults the user into simple mode, which is not ideal.\r\n\r\n#### Expected behaviour\r\n\r\nPersist the /lab/ or /doc/ from the original link, so `<endpoint>/hub/user-redirect/lab/tree/<path>` would redirect to `<endpoint>/user/<userID>/lab/workspaces/auto-Z/tree/<path>`\r\n\r\n#### Actual behaviour\r\n`<endpoint>/hub/user-redirect/lab/tree/<path>` redirects to `<endpoint>/user/<userID>/doc/workspaces/auto-Z/tree/<path>`\r\n\r\n\r\n### How to reproduce\r\n1. Open jupyterlab backed by jupyterhub\r\n2. Make sure Simple interface is off (under View > Simple Interface)\r\n3. Right click on file or folder in browser\r\n4. Click copy shareable link\r\n5. Open new browser tab & paste in link\r\n6. View link change & verify that file/folder is opened in \"simple\" view\r\n\r\n### Your personal set up\r\n\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n\r\n - OS:\r\n <!-- [e.g. ubuntu 20.04, macOS 11.0] -->\r\n - Version(s): Ubuntu 20.04.5 LTS\r\n <!-- e.g. jupyterhub --version, python --version --->\r\n- jupyterhub: 2.2.2\r\n- python: 3.9.10\r\n\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4062/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4062/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4059", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4059/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4059/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4059/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/4059", "id": 1393745838, "node_id": "I_kwDOAT0rQs5TEt-u", "number": 4059, "title": "`get_config()` not defined in `testing/jupyterhub_config.py`", "user": {"login": "Temidayo32", "id": 87539866, "node_id": "MDQ6VXNlcjg3NTM5ODY2", "avatar_url": "https://avatars.githubusercontent.com/u/87539866?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Temidayo32", "html_url": "https://github.com/Temidayo32", "followers_url": "https://api.github.com/users/Temidayo32/followers", "following_url": "https://api.github.com/users/Temidayo32/following{/other_user}", "gists_url": "https://api.github.com/users/Temidayo32/gists{/gist_id}", "starred_url": "https://api.github.com/users/Temidayo32/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Temidayo32/subscriptions", "organizations_url": "https://api.github.com/users/Temidayo32/orgs", "repos_url": "https://api.github.com/users/Temidayo32/repos", "events_url": "https://api.github.com/users/Temidayo32/events{/privacy}", "received_events_url": "https://api.github.com/users/Temidayo32/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-10-02T12:15:19Z", "updated_at": "2022-10-04T12:14:41Z", "closed_at": "2022-10-04T12:14:41Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "In the `testing/jupyterhub_config.py` , I noticed the `get_config()` function is  not defined.  \r\n\r\nI can't say exactly. Perhaps, it might have something to do with why my server fails to connect and returns a timeout.\r\n`asyncio.exceptions.TimeoutError: Server at http://127.0.0.1:53369/user/temicoder/ didn't respond in 30 seconds`", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4059/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4059/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4045", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4045/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4045/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4045/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4045", "id": 1375895609, "node_id": "PR_kwDOAT0rQs4_GNaO", "number": 4045, "title": "Fix crash when removing scopes attribute from an existing role", "user": {"login": "miwig", "id": 26932210, "node_id": "MDQ6VXNlcjI2OTMyMjEw", "avatar_url": "https://avatars.githubusercontent.com/u/26932210?v=4", "gravatar_id": "", "url": "https://api.github.com/users/miwig", "html_url": "https://github.com/miwig", "followers_url": "https://api.github.com/users/miwig/followers", "following_url": "https://api.github.com/users/miwig/following{/other_user}", "gists_url": "https://api.github.com/users/miwig/gists{/gist_id}", "starred_url": "https://api.github.com/users/miwig/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/miwig/subscriptions", "organizations_url": "https://api.github.com/users/miwig/orgs", "repos_url": "https://api.github.com/users/miwig/repos", "events_url": "https://api.github.com/users/miwig/events{/privacy}", "received_events_url": "https://api.github.com/users/miwig/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-09-16T12:41:37Z", "updated_at": "2022-11-24T09:46:20Z", "closed_at": "2022-09-22T13:08:28Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/4045", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4045", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/4045.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/4045.patch", "merged_at": "2022-09-22T13:08:28Z"}, "body": "JupyterHub currently crashes on startup with \r\n`KeyError: 'scopes'` at `if not set(role_spec['scopes']).issubset(old_role.scopes):`\r\nif the `scopes` attribute was removed from a previously defined role. Since the documentation [explicitly states](https://jupyterhub.readthedocs.io/en/stable/rbac/roles.html#defining-roles) that all fields except `name` are optional, this fixes the crash and makes removal actually work (instead of silently using the old value).", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4045/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4045/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4044", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4044/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4044/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4044/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/4044", "id": 1374742109, "node_id": "I_kwDOAT0rQs5R8OZd", "number": 4044, "title": "Can not start jupyterhub as service due to database after upgrade", "user": {"login": "guidocioni", "id": 12760310, "node_id": "MDQ6VXNlcjEyNzYwMzEw", "avatar_url": "https://avatars.githubusercontent.com/u/12760310?v=4", "gravatar_id": "", "url": "https://api.github.com/users/guidocioni", "html_url": "https://github.com/guidocioni", "followers_url": "https://api.github.com/users/guidocioni/followers", "following_url": "https://api.github.com/users/guidocioni/following{/other_user}", "gists_url": "https://api.github.com/users/guidocioni/gists{/gist_id}", "starred_url": "https://api.github.com/users/guidocioni/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/guidocioni/subscriptions", "organizations_url": "https://api.github.com/users/guidocioni/orgs", "repos_url": "https://api.github.com/users/guidocioni/repos", "events_url": "https://api.github.com/users/guidocioni/events{/privacy}", "received_events_url": "https://api.github.com/users/guidocioni/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2022-09-15T15:46:57Z", "updated_at": "2022-09-19T07:07:57Z", "closed_at": "2022-09-16T12:49:58Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\nEverything used to work fine until I made the update to jupyterhub 3.0.0.\r\n\r\nNow my service is failing with \r\n\r\n```\r\nSep 15 17:37:55 ekman jupyterhub[32027]: Found database schema version 833da8570507 != 651f5419b74d. Backup your database and run `jupyterhub upgrade-db` to upgrade to the latest schema.\r\nSep 15 17:37:55 ekman systemd[1]: jupyterhub.service: Main process exited, code=exited, status=1/FAILURE\r\nSep 15 17:37:55 ekman systemd[1]: jupyterhub.service: Failed with result 'exit-code'.\r\n```\r\nI logged in as sudo and tried to run EXACTLY the same command as in the service in the interactive shell\r\n\r\n```\r\n/home/ekman/miniconda3/bin/jupyterhub --url=http://:8889/jupyterhub --JupyterHub.default_url=/tree/\r\n```\r\nthis works fine.\r\n\r\nBut it fails in the service. \r\n\r\nI tried to perform `jupyterhub upgrade-db` multiple times as normal user or root but I still get this issue when starting as service. I think there is some leftover somewhere preventing the service from spawning up, but it's not clear why then it would work when it is started interactively from the shell.\r\n\r\n\r\n### Your personal set up\r\n\r\n\r\n - OS: ubuntu 20.04.5\r\n\r\n<details><summary>Full environment</summary>\r\n\r\n```\r\n# packages in environment at /home/ekman/miniconda3:\r\n#\r\n# Name                    Version                   Build  Channel\r\n_libgcc_mutex             0.1                 conda_forge    conda-forge\r\n_openmp_mutex             4.5                       2_gnu    conda-forge\r\nalembic                   1.8.1              pyhd8ed1ab_0    conda-forge\r\nanyio                     3.6.1              pyhd8ed1ab_1    conda-forge\r\nargon2-cffi               21.3.0             pyhd8ed1ab_0    conda-forge\r\nargon2-cffi-bindings      21.2.0           py38h0a891b7_2    conda-forge\r\nasttokens                 2.0.8              pyhd8ed1ab_0    conda-forge\r\nasync_generator           1.10                       py_0    conda-forge\r\nattrs                     22.1.0             pyh71513ae_1    conda-forge\r\nbabel                     2.10.3             pyhd8ed1ab_0    conda-forge\r\nbackcall                  0.2.0              pyh9f0ad1d_0    conda-forge\r\nbackports                 1.0                        py_2    conda-forge\r\nbackports.functools_lru_cache 1.6.4              pyhd8ed1ab_0    conda-forge\r\nbeautifulsoup4            4.11.1             pyha770c72_0    conda-forge\r\nbleach                    5.0.1              pyhd8ed1ab_0    conda-forge\r\nblinker                   1.4                        py_1    conda-forge\r\nbrotlipy                  0.7.0           py38h0a891b7_1004    conda-forge\r\nbzip2                     1.0.8                h7f98852_4    conda-forge\r\nc-ares                    1.18.1               h7f98852_0    conda-forge\r\nca-certificates           2022.6.15.1          ha878542_0    conda-forge\r\ncairo                     1.16.0            ha61ee94_1013    conda-forge\r\ncdo                       2.0.5                h15029e1_3    conda-forge\r\ncdsapi                    0.5.1              pyhd8ed1ab_0    conda-forge\r\ncertifi                   2022.6.15.1        pyhd8ed1ab_0    conda-forge\r\ncertipy                   0.1.3                      py_0    conda-forge\r\ncffi                      1.15.1           py38h4a40e3a_0    conda-forge\r\ncharset-normalizer        2.1.1              pyhd8ed1ab_0    conda-forge\r\ncolorama                  0.4.5              pyhd8ed1ab_0    conda-forge\r\nconda                     4.14.0           py38h578d9bd_0    conda-forge\r\nconda-package-handling    1.8.1            py38h0a891b7_1    conda-forge\r\nconfigurable-http-proxy   4.5.3           node16_h3b247e2_0    conda-forge\r\ncryptography              37.0.4           py38h2b5fc30_0    conda-forge\r\ncurl                      7.83.1               h7bff187_0    conda-forge\r\ndebugpy                   1.6.3            py38hfa26641_0    conda-forge\r\ndecorator                 5.1.1              pyhd8ed1ab_0    conda-forge\r\ndefusedxml                0.7.1              pyhd8ed1ab_0    conda-forge\r\neccodes                   2.27.0               h164a9dd_0    conda-forge\r\nentrypoints               0.4                pyhd8ed1ab_0    conda-forge\r\nesmf                      8.2.0           nompi_h1ee4d8d_2    conda-forge\r\nexecuting                 1.0.0              pyhd8ed1ab_0    conda-forge\r\nexpat                     2.4.8                h27087fc_0    conda-forge\r\nfftw                      3.3.10          nompi_hf0379b8_105    conda-forge\r\nflit-core                 3.7.1              pyhd8ed1ab_0    conda-forge\r\nfont-ttf-dejavu-sans-mono 2.37                 hab24e00_0    conda-forge\r\nfont-ttf-inconsolata      3.000                h77eed37_0    conda-forge\r\nfont-ttf-source-code-pro  2.038                h77eed37_0    conda-forge\r\nfont-ttf-ubuntu           0.83                 hab24e00_0    conda-forge\r\nfontconfig                2.14.0               hc2a2eb6_1    conda-forge\r\nfonts-conda-ecosystem     1                             0    conda-forge\r\nfonts-conda-forge         1                             0    conda-forge\r\nfreeglut                  3.2.2                h9c3ff4c_1    conda-forge\r\nfreetype                  2.12.1               hca18f0e_0    conda-forge\r\nfribidi                   1.0.10               h36c2ea0_0    conda-forge\r\ngettext                   0.19.8.1          h73d1719_1008    conda-forge\r\ngraphite2                 1.3.13            h58526e2_1001    conda-forge\r\ngreenlet                  1.1.3            py38hfa26641_0    conda-forge\r\ngsl                       2.7                  he838d99_0    conda-forge\r\nharfbuzz                  5.1.0                hf9f4e7c_0    conda-forge\r\nhdf4                      4.2.15               h9772cbc_4    conda-forge\r\nhdf5                      1.12.2          nompi_h2386368_100    conda-forge\r\nicu                       70.1                 h27087fc_0    conda-forge\r\nidna                      3.3                pyhd8ed1ab_0    conda-forge\r\nimportlib-metadata        4.11.4           py38h578d9bd_0    conda-forge\r\nimportlib_metadata        4.11.4               hd8ed1ab_0    conda-forge\r\nimportlib_resources       5.9.0              pyhd8ed1ab_0    conda-forge\r\nipykernel                 6.15.2             pyh210e3f2_0    conda-forge\r\nipython                   8.5.0              pyh41d4057_1    conda-forge\r\nipython_genutils          0.2.0                      py_1    conda-forge\r\njasper                    2.0.33               ha77e612_0    conda-forge\r\njedi                      0.18.1             pyhd8ed1ab_2    conda-forge\r\njinja2                    3.1.2              pyhd8ed1ab_1    conda-forge\r\njpeg                      9e                   h166bdaf_2    conda-forge\r\njson5                     0.9.5              pyh9f0ad1d_0    conda-forge\r\njsonschema                4.16.0             pyhd8ed1ab_0    conda-forge\r\njupyter_client            7.3.5              pyhd8ed1ab_0    conda-forge\r\njupyter_core              4.11.1           py38h578d9bd_0    conda-forge\r\njupyter_server            1.18.1             pyhd8ed1ab_0    conda-forge\r\njupyter_telemetry         0.1.0              pyhd8ed1ab_1    conda-forge\r\njupyterhub                3.0.0              pyhd8ed1ab_0    conda-forge\r\njupyterhub-base           3.0.0              pyhd8ed1ab_0    conda-forge\r\njupyterlab                3.4.6              pyhd8ed1ab_0    conda-forge\r\njupyterlab_pygments       0.2.2              pyhd8ed1ab_0    conda-forge\r\njupyterlab_server         2.15.1             pyhd8ed1ab_0    conda-forge\r\nkeyutils                  1.6.1                h166bdaf_0    conda-forge\r\nkrb5                      1.19.3               h3790be6_0    conda-forge\r\nld_impl_linux-64          2.36.1               hea4e1c9_2    conda-forge\r\nlerc                      4.0.0                h27087fc_0    conda-forge\r\nlibaec                    1.0.6                h9c3ff4c_0    conda-forge\r\nlibblas                   3.9.0           16_linux64_openblas    conda-forge\r\nlibcblas                  3.9.0           16_linux64_openblas    conda-forge\r\nlibcurl                   7.83.1               h7bff187_0    conda-forge\r\nlibdeflate                1.14                 h166bdaf_0    conda-forge\r\nlibedit                   3.1.20191231         he28a2e2_2    conda-forge\r\nlibev                     4.33                 h516909a_1    conda-forge\r\nlibffi                    3.4.2                h7f98852_5    conda-forge\r\nlibgcc-ng                 12.1.0              h8d9b700_16    conda-forge\r\nlibgfortran-ng            12.1.0              h69a702a_16    conda-forge\r\nlibgfortran5              12.1.0              hdcd56e2_16    conda-forge\r\nlibglib                   2.72.1               h2d90d5f_0    conda-forge\r\nlibglu                    9.0.0             he1b5a44_1001    conda-forge\r\nlibgomp                   12.1.0              h8d9b700_16    conda-forge\r\nlibiconv                  1.16                 h516909a_0    conda-forge\r\nliblapack                 3.9.0           16_linux64_openblas    conda-forge\r\nlibnetcdf                 4.8.1           nompi_h21705cb_104    conda-forge\r\nlibnghttp2                1.47.0               hdcd2b5c_1    conda-forge\r\nlibnsl                    2.0.0                h7f98852_0    conda-forge\r\nlibopenblas               0.3.21          pthreads_h78a6416_3    conda-forge\r\nlibpng                    1.6.37               h753d276_4    conda-forge\r\nlibsodium                 1.0.18               h36c2ea0_1    conda-forge\r\nlibsqlite                 3.39.3               h753d276_0    conda-forge\r\nlibssh2                   1.10.0               haa6b8db_3    conda-forge\r\nlibstdcxx-ng              12.1.0              ha89aaad_16    conda-forge\r\nlibtiff                   4.4.0                h55922b4_4    conda-forge\r\nlibuuid                   2.32.1            h7f98852_1000    conda-forge\r\nlibuv                     1.44.2               h166bdaf_0    conda-forge\r\nlibwebp-base              1.2.4                h166bdaf_0    conda-forge\r\nlibxcb                    1.13              h7f98852_1004    conda-forge\r\nlibxml2                   2.9.14               h22db469_4    conda-forge\r\nlibxslt                   1.1.35               h8affb1d_0    conda-forge\r\nlibzip                    1.9.2                hc869a4a_1    conda-forge\r\nlibzlib                   1.2.12               h166bdaf_3    conda-forge\r\nlxml                      4.9.1            py38h0a891b7_0    conda-forge\r\nmagics                    4.12.1               h6972fcc_1    conda-forge\r\nmagics-python             1.5.6              pyhd8ed1ab_0    conda-forge\r\nmako                      1.2.2              pyhd8ed1ab_0    conda-forge\r\nmarkupsafe                2.1.1            py38h0a891b7_1    conda-forge\r\nmatplotlib-inline         0.1.6              pyhd8ed1ab_0    conda-forge\r\nmistune                   2.0.4              pyhd8ed1ab_0    conda-forge\r\nnb_conda_kernels          2.3.1            py38h578d9bd_1    conda-forge\r\nnbclassic                 0.4.3              pyhd8ed1ab_0    conda-forge\r\nnbclient                  0.6.8              pyhd8ed1ab_0    conda-forge\r\nnbconvert                 7.0.0              pyhd8ed1ab_0    conda-forge\r\nnbconvert-core            7.0.0              pyhd8ed1ab_0    conda-forge\r\nnbconvert-pandoc          7.0.0              pyhd8ed1ab_0    conda-forge\r\nnbformat                  5.4.0              pyhd8ed1ab_0    conda-forge\r\nnco                       5.1.0                h81bb2a3_1    conda-forge\r\nncurses                   6.3                  h27087fc_1    conda-forge\r\nnest-asyncio              1.5.5              pyhd8ed1ab_0    conda-forge\r\nnetcdf-fortran            4.6.0           nompi_hc402ea5_100    conda-forge\r\nnodejs                    16.15.0              h96d913c_0    conda-forge\r\nnotebook                  6.4.12             pyha770c72_0    conda-forge\r\nnotebook-shim             0.1.0              pyhd8ed1ab_0    conda-forge\r\nnumpy                     1.23.3           py38h3a7f9d9_0    conda-forge\r\noauthlib                  3.2.1              pyhd8ed1ab_0    conda-forge\r\nopenssl                   1.1.1q               h166bdaf_0    conda-forge\r\nossuuid                   1.6.2             hf484d3e_1000    conda-forge\r\npackaging                 21.3               pyhd8ed1ab_0    conda-forge\r\npamela                    1.0.0                      py_0    conda-forge\r\npandoc                    2.19.2               ha770c72_0    conda-forge\r\npandocfilters             1.5.0              pyhd8ed1ab_0    conda-forge\r\npango                     1.50.9               hc4f8a73_0    conda-forge\r\nparso                     0.8.3              pyhd8ed1ab_0    conda-forge\r\npcre                      8.45                 h9c3ff4c_0    conda-forge\r\npexpect                   4.8.0              pyh9f0ad1d_2    conda-forge\r\npickleshare               0.7.5                   py_1003    conda-forge\r\npip                       22.2.2             pyhd8ed1ab_0    conda-forge\r\npixman                    0.40.0               h36c2ea0_0    conda-forge\r\npkgutil-resolve-name      1.3.10             pyhd8ed1ab_0    conda-forge\r\nproj                      9.1.0                h93bde94_0    conda-forge\r\nprometheus_client         0.14.1             pyhd8ed1ab_0    conda-forge\r\nprompt-toolkit            3.0.31             pyha770c72_0    conda-forge\r\npsutil                    5.9.2            py38h0a891b7_0    conda-forge\r\npthread-stubs             0.4               h36c2ea0_1001    conda-forge\r\nptyprocess                0.7.0              pyhd3deb0d_0    conda-forge\r\npure_eval                 0.2.2              pyhd8ed1ab_0    conda-forge\r\npycosat                   0.6.3           py38h0a891b7_1010    conda-forge\r\npycparser                 2.21               pyhd8ed1ab_0    conda-forge\r\npycurl                    7.45.1           py38h61f0cdf_2    conda-forge\r\npygments                  2.13.0             pyhd8ed1ab_0    conda-forge\r\npyjwt                     2.4.0              pyhd8ed1ab_0    conda-forge\r\npyopenssl                 22.0.0             pyhd8ed1ab_0    conda-forge\r\npyparsing                 3.0.9              pyhd8ed1ab_0    conda-forge\r\npyrsistent                0.18.1           py38h0a891b7_1    conda-forge\r\npysocks                   1.7.1              pyha2e5f31_6    conda-forge\r\npython                    3.8.13          h582c2e5_0_cpython    conda-forge\r\npython-dateutil           2.8.2              pyhd8ed1ab_0    conda-forge\r\npython-fastjsonschema     2.16.1             pyhd8ed1ab_0    conda-forge\r\npython-json-logger        2.0.1              pyh9f0ad1d_0    conda-forge\r\npython_abi                3.8                      2_cp38    conda-forge\r\npytz                      2022.2.1           pyhd8ed1ab_0    conda-forge\r\npyzmq                     23.2.1           py38hfc09fa9_0    conda-forge\r\nreadline                  8.1.2                h0f457ee_0    conda-forge\r\nrequests                  2.28.1             pyhd8ed1ab_1    conda-forge\r\nruamel.yaml               0.17.21          py38h0a891b7_1    conda-forge\r\nruamel.yaml.clib          0.2.6            py38h0a891b7_1    conda-forge\r\nruamel_yaml               0.15.80         py38h0a891b7_1007    conda-forge\r\nsend2trash                1.8.0              pyhd8ed1ab_0    conda-forge\r\nsetuptools                65.3.0             pyhd8ed1ab_1    conda-forge\r\nsimplejson                3.17.6           py38h0a891b7_1    conda-forge\r\nsix                       1.16.0             pyh6c4a22f_0    conda-forge\r\nsniffio                   1.3.0              pyhd8ed1ab_0    conda-forge\r\nsoupsieve                 2.3.2.post1        pyhd8ed1ab_0    conda-forge\r\nsqlalchemy                1.4.41           py38h0a891b7_0    conda-forge\r\nsqlite                    3.39.3               h4ff8645_0    conda-forge\r\nstack_data                0.5.0              pyhd8ed1ab_0    conda-forge\r\nsupervisor                4.2.4            py38h578d9bd_1    conda-forge\r\ntempest-remap             2.1.1                h75968e7_1    conda-forge\r\nterminado                 0.15.0           py38h578d9bd_0    conda-forge\r\ntinycss2                  1.1.1              pyhd8ed1ab_0    conda-forge\r\ntk                        8.6.12               h27826a3_0    conda-forge\r\ntoolz                     0.12.0             pyhd8ed1ab_0    conda-forge\r\ntornado                   6.2              py38h0a891b7_0    conda-forge\r\ntqdm                      4.64.1             pyhd8ed1ab_0    conda-forge\r\ntraitlets                 5.4.0              pyhd8ed1ab_0    conda-forge\r\ntyping_extensions         4.3.0              pyha770c72_0    conda-forge\r\nudunits2                  2.2.28               hc3e0081_0    conda-forge\r\nurllib3                   1.26.11            pyhd8ed1ab_0    conda-forge\r\nwcwidth                   0.2.5              pyh9f0ad1d_2    conda-forge\r\nwebencodings              0.5.1                      py_1    conda-forge\r\nwebsocket-client          1.4.1              pyhd8ed1ab_0    conda-forge\r\nwheel                     0.37.1             pyhd8ed1ab_0    conda-forge\r\nxorg-fixesproto           5.0               h7f98852_1002    conda-forge\r\nxorg-inputproto           2.3.2             h7f98852_1002    conda-forge\r\nxorg-kbproto              1.0.7             h7f98852_1002    conda-forge\r\nxorg-libice               1.0.10               h7f98852_0    conda-forge\r\nxorg-libsm                1.2.3             hd9c2040_1000    conda-forge\r\nxorg-libx11               1.7.2                h7f98852_0    conda-forge\r\nxorg-libxau               1.0.9                h7f98852_0    conda-forge\r\nxorg-libxdmcp             1.1.3                h7f98852_0    conda-forge\r\nxorg-libxext              1.3.4                h7f98852_1    conda-forge\r\nxorg-libxfixes            5.0.3             h7f98852_1004    conda-forge\r\nxorg-libxi                1.7.10               h7f98852_0    conda-forge\r\nxorg-libxrender           0.9.10            h7f98852_1003    conda-forge\r\nxorg-renderproto          0.11.1            h7f98852_1002    conda-forge\r\nxorg-xextproto            7.3.0             h7f98852_1002    conda-forge\r\nxorg-xproto               7.0.31            h7f98852_1007    conda-forge\r\nxz                        5.2.6                h166bdaf_0    conda-forge\r\nyaml                      0.2.5                h7f98852_2    conda-forge\r\nzeromq                    4.3.4                h9c3ff4c_1    conda-forge\r\nzipp                      3.8.1              pyhd8ed1ab_0    conda-forge\r\nzlib                      1.2.12               h166bdaf_3    conda-forge\r\nzstd                      1.5.2                h6239696_4    conda-forge\r\n```\r\n</details>\r\n\r\n<details><summary>Configuration</summary>\r\nNo special configuration, every parameter is set when starting the service\r\n\r\n```bash\r\n[Unit]\r\nDescription=JupyterHub\r\nAfter=syslog.target network.target\r\n\r\n[Service]\r\nUser=root\r\nEnvironment=\"PATH=/home/ekman/miniconda3/bin:/home/ekman/miniconda3/condabin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin\"\r\nExecStart=/home/ekman/miniconda3/bin/jupyterhub --url=http://:8889/jupyterhub --JupyterHub.default_url=/tree/\r\n\r\n[Install]\r\nWantedBy=multi-user.target\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4044/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4044/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4043", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4043/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4043/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4043/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/4043", "id": 1374271159, "node_id": "I_kwDOAT0rQs5R6ba3", "number": 4043, "title": "Spawner / ProgressAPI only flushing events once the server is ready", "user": {"login": "nibheis", "id": 52066010, "node_id": "MDQ6VXNlcjUyMDY2MDEw", "avatar_url": "https://avatars.githubusercontent.com/u/52066010?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nibheis", "html_url": "https://github.com/nibheis", "followers_url": "https://api.github.com/users/nibheis/followers", "following_url": "https://api.github.com/users/nibheis/following{/other_user}", "gists_url": "https://api.github.com/users/nibheis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nibheis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nibheis/subscriptions", "organizations_url": "https://api.github.com/users/nibheis/orgs", "repos_url": "https://api.github.com/users/nibheis/repos", "events_url": "https://api.github.com/users/nibheis/events{/privacy}", "received_events_url": "https://api.github.com/users/nibheis/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2022-09-15T10:05:40Z", "updated_at": "2022-09-22T14:36:49Z", "closed_at": "2022-09-22T14:36:49Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hello JupyterHub community,\r\n\r\nWe are running a custom spawner here at EPFL - a kind of mix between `systemd` and `ssh` spawner (our hub spawns jupyterlab containers as systemd units on remote servers). It's been running great for the last 3 years now.\r\n\r\nThis week, we made custom html/css templates for our Hub and I thought it was a good time to also pimp up the event log on the spawning page. Currently, the two events:\r\n- `Server requested`\r\n- `Server ready at ...`\r\n\r\nboth emitted by JupyterHub (our spawner did not implement the `progress()` method yet) arrive in one shot when the server is ready. The progress bar stays at 0 for ~10 seconds and then blinks to 100 and the user is redirected.\r\n\r\nI implemented a proper `progress()` method (by having a look at different spawner implementation), but still all events won't show until the very end. I added delays and traced from the hub side and from the browser's console side too. While the events are emitted asynchronously and periodically (respecting the delays) by the Spawner, on the browser side they all arrive in one shot when the server is ready.\r\n\r\nI also noticed that when the `progress()` method raises an exception, the events are flushed - and then `_generate_progress(self)` is called again (the `Server requested` event is sent again).\r\n\r\nThe only way I found to have SpawnProgressAPIHandler (from `jupyterhub/apihandlers/users.py`) actually flush the messages systematically has been to change the `send_event()` method from:\r\n```\r\n    async def send_event(self, event):\r\n        try:\r\n            self.write(f'data: {json.dumps(event)}\\n\\n')\r\n            await self.flush()\r\n        except StreamClosedError:\r\n            self.log.warning(\"Stream closed while handling %s\", self.request.uri)\r\n            # raise Finish to halt the handler\r\n            raise web.Finish()\r\n```\r\nto:\r\n```\r\n    async def send_event(self, event):\r\n        try:\r\n            self.write(f'data: {json.dumps(event)}\\n\\n')\r\n===>        raise web.Finish()\r\n            #await self.flush()\r\n        except StreamClosedError:\r\n            self.log.warning(\"Stream closed while handling %s\", self.request.uri)\r\n            # raise Finish to halt the handler\r\n            raise web.Finish()\r\n```\r\n\r\nBy raising `web.Finish()`, the handler is actually flushed. I know, this is certainly not the proper way of doing it - I'm just testing things.\r\nSo, what should I do now? JupyterHub (both 2.3.1 and 3.0.0) do not flush events until the server is ready.\r\nAm I overlooking some jupyterhub settings or something else?\r\n\r\nThanks for your help!", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4043/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4043/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4040", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4040/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4040/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4040/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/4040", "id": 1371260901, "node_id": "I_kwDOAT0rQs5Ru8fl", "number": 4040, "title": "Since jupyterhub3, We can no longer call app.main with arguments", "user": {"login": "djangoliv", "id": 13416971, "node_id": "MDQ6VXNlcjEzNDE2OTcx", "avatar_url": "https://avatars.githubusercontent.com/u/13416971?v=4", "gravatar_id": "", "url": "https://api.github.com/users/djangoliv", "html_url": "https://github.com/djangoliv", "followers_url": "https://api.github.com/users/djangoliv/followers", "following_url": "https://api.github.com/users/djangoliv/following{/other_user}", "gists_url": "https://api.github.com/users/djangoliv/gists{/gist_id}", "starred_url": "https://api.github.com/users/djangoliv/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/djangoliv/subscriptions", "organizations_url": "https://api.github.com/users/djangoliv/orgs", "repos_url": "https://api.github.com/users/djangoliv/repos", "events_url": "https://api.github.com/users/djangoliv/events{/privacy}", "received_events_url": "https://api.github.com/users/djangoliv/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-09-13T11:00:26Z", "updated_at": "2022-09-15T08:28:28Z", "closed_at": "2022-09-15T08:28:28Z", "author_association": "NONE", "active_lock_reason": null, "body": "I call jupyterhub programmatically like this\r\n\r\n```\r\nfrom jupyterhub.app import main\r\nmain(argv=[\"-f\", \"jupyterhub_config.py\"])\r\n```\r\nIt works fine in jupyterhub2, but not with jupyterhub3\r\n\r\nSince commit b0b7378e2, argv is passed in loop.run_sync. But loop.run_sync take `time out` for argument, not argv.\r\n\r\n`task = asyncio.ensure_future(self.launch_instance_async(argv))`\r\nbecame\r\n`loop.run_sync(self.launch_instance_async, argv)`\r\n\r\nMaybe, it should be something like this:\r\n\r\n`loop.run_sync(lambda: self.launch_instance_async(argv))`\r\n\r\nRegards,", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4040/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4040/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4039", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4039/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4039/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4039/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4039", "id": 1370648874, "node_id": "PR_kwDOAT0rQs4-0sRd", "number": 4039, "title": "Pass launch_instance args on correctly.", "user": {"login": "hjoliver", "id": 2362137, "node_id": "MDQ6VXNlcjIzNjIxMzc=", "avatar_url": "https://avatars.githubusercontent.com/u/2362137?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hjoliver", "html_url": "https://github.com/hjoliver", "followers_url": "https://api.github.com/users/hjoliver/followers", "following_url": "https://api.github.com/users/hjoliver/following{/other_user}", "gists_url": "https://api.github.com/users/hjoliver/gists{/gist_id}", "starred_url": "https://api.github.com/users/hjoliver/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hjoliver/subscriptions", "organizations_url": "https://api.github.com/users/hjoliver/orgs", "repos_url": "https://api.github.com/users/hjoliver/repos", "events_url": "https://api.github.com/users/hjoliver/events{/privacy}", "received_events_url": "https://api.github.com/users/hjoliver/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2022-09-12T23:30:06Z", "updated_at": "2022-11-24T09:48:55Z", "closed_at": "2022-09-13T15:05:11Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/4039", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4039", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/4039.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/4039.patch", "merged_at": "2022-09-13T15:05:11Z"}, "body": "Greetings JupyterHub experts. Thanks for your excellent software!\r\n\r\nTentative bug fix:\r\n\r\nI think the hub `launch_instance` class method should be passing its args on to `launch_instance_async`(?), but currently it is passing them to `loop.run_sync` which is expecting a timeout value there.\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4039/reactions", "total_count": 3, "+1": 3, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4039/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4034", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4034/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4034/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4034/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4034", "id": 1368592946, "node_id": "PR_kwDOAT0rQs4-t611", "number": 4034, "title": "Fix Dockerfile yarn JSX build", "user": {"login": "manics", "id": 1644105, "node_id": "MDQ6VXNlcjE2NDQxMDU=", "avatar_url": "https://avatars.githubusercontent.com/u/1644105?v=4", "gravatar_id": "", "url": "https://api.github.com/users/manics", "html_url": "https://github.com/manics", "followers_url": "https://api.github.com/users/manics/followers", "following_url": "https://api.github.com/users/manics/following{/other_user}", "gists_url": "https://api.github.com/users/manics/gists{/gist_id}", "starred_url": "https://api.github.com/users/manics/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/manics/subscriptions", "organizations_url": "https://api.github.com/users/manics/orgs", "repos_url": "https://api.github.com/users/manics/repos", "events_url": "https://api.github.com/users/manics/events{/privacy}", "received_events_url": "https://api.github.com/users/manics/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-09-10T11:26:01Z", "updated_at": "2022-10-10T13:01:14Z", "closed_at": "2022-09-10T14:42:04Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/4034", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4034", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/4034.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/4034.patch", "merged_at": "2022-09-10T14:42:04Z"}, "body": "Closes https://github.com/jupyterhub/jupyterhub/issues/4033", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4034/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4034/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4033", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4033/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4033/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4033/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/4033", "id": 1368579116, "node_id": "I_kwDOAT0rQs5Rktws", "number": 4033, "title": "admin-react.js not found in v3.0.0 docker image", "user": {"login": "takeshi-yashiro", "id": 22676527, "node_id": "MDQ6VXNlcjIyNjc2NTI3", "avatar_url": "https://avatars.githubusercontent.com/u/22676527?v=4", "gravatar_id": "", "url": "https://api.github.com/users/takeshi-yashiro", "html_url": "https://github.com/takeshi-yashiro", "followers_url": "https://api.github.com/users/takeshi-yashiro/followers", "following_url": "https://api.github.com/users/takeshi-yashiro/following{/other_user}", "gists_url": "https://api.github.com/users/takeshi-yashiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/takeshi-yashiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/takeshi-yashiro/subscriptions", "organizations_url": "https://api.github.com/users/takeshi-yashiro/orgs", "repos_url": "https://api.github.com/users/takeshi-yashiro/repos", "events_url": "https://api.github.com/users/takeshi-yashiro/events{/privacy}", "received_events_url": "https://api.github.com/users/takeshi-yashiro/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2022-09-10T10:26:42Z", "updated_at": "2022-12-06T14:43:48Z", "closed_at": "2022-09-10T14:42:05Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\n\r\nThe latest version of official docker image, `jupyterhub/jupyterhub:3.0.0` does not contain admin-react.js file, which results in blank hub admin page.\r\n\r\nThe lack of this file can be confirmed by entering the container and running the following command.\r\n\r\n```\r\nroot@d82a49a1c06f:/srv/jupyterhub# cd /usr/local/share/jupyterhub/static/js\r\nroot@d82a49a1c06f:/usr/local/share/jupyterhub/static/js# ls -al\r\ntotal 44\r\ndrwxr-xr-x 2 root root 4096 Sep  9 06:35 .\r\ndrwxr-xr-x 7 root root 4096 Sep  9 06:35 ..\r\n-rw-r--r-- 1 root root 8013 Sep  9 06:35 admin.js\r\n-rw-r--r-- 1 root root 3293 Sep  9 06:35 home.js\r\n-rw-r--r-- 1 root root 4446 Sep  9 06:35 jhapi.js\r\n-rw-r--r-- 1 root root  398 Sep  9 06:35 not_running.js\r\n-rw-r--r-- 1 root root 1463 Sep  9 06:35 token.js\r\n-rw-r--r-- 1 root root 4383 Sep  9 06:35 utils.js\r\n```\r\n\r\nI assume `yarn build` and `yarn place` need to be added in `Dockerfile`, as adding `admin-react.js` generated with these command like below solves this problem. \r\n\r\n```\r\nCOPY admin-react.js /usr/local/share/jupyterhub/static/js/admin-react.js\r\n```\r\n\r\n#### Expected behaviour\r\n\r\nAccess to  /hub/admin shows user management table, without any HTTP errors.\r\n\r\n#### Actual behaviour\r\n\r\nAccess to  /hub/admin results in a blank page, with 404 error for /hub/static/js/admin-react.js.\r\n\r\n### Your personal set up\r\n\r\n - OS: Docker Desktop v4.11.1 on macOS 12.5.1\r\n <!-- [e.g. ubuntu 20.04, macOS 11.0] -->\r\n - Version(s): `jupyterhub/jupyterhub:latest` and `jupyterhub/jupyterhub:3.0.0` images\r\n <!-- e.g. jupyterhub --version, python --version --->\r\n\r\n<details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\n# paste output of `pip freeze` or `conda list` here\r\n```\r\n</details>\r\n\r\n<details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```python\r\n# jupyterhub_config.py\r\n```\r\n</details>\r\n\r\n<details><summary>Logs</summary>\r\n<!--\r\nErrors are often logged by jupytehub. How you get logs depends on your deployment.\r\nWith kubernetes it might be:\r\n\r\n    kubectl get pod # hub pod name starts with hub...\r\n    kubectl logs hub-...\r\n    # or for a single-user server\r\n    kubectl logs jupyter-username\r\n\r\nOr the-littlest-jupyterhub:\r\n\r\n    journalctl -u jupyterhub\r\n    # or for a single-user server\r\n    journalctl -u jupyter-username\r\n-->\r\n\r\n```\r\n# paste relevant logs here, if any\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4033/reactions", "total_count": 3, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4033/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4022", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4022/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4022/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4022/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4022", "id": 1348622801, "node_id": "PR_kwDOAT0rQs49rW-f", "number": 4022, "title": "Use correct expiration labels in drop-down menu on token page.", "user": {"login": "possiblyMikeB", "id": 58000192, "node_id": "MDQ6VXNlcjU4MDAwMTky", "avatar_url": "https://avatars.githubusercontent.com/u/58000192?v=4", "gravatar_id": "", "url": "https://api.github.com/users/possiblyMikeB", "html_url": "https://github.com/possiblyMikeB", "followers_url": "https://api.github.com/users/possiblyMikeB/followers", "following_url": "https://api.github.com/users/possiblyMikeB/following{/other_user}", "gists_url": "https://api.github.com/users/possiblyMikeB/gists{/gist_id}", "starred_url": "https://api.github.com/users/possiblyMikeB/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/possiblyMikeB/subscriptions", "organizations_url": "https://api.github.com/users/possiblyMikeB/orgs", "repos_url": "https://api.github.com/users/possiblyMikeB/repos", "events_url": "https://api.github.com/users/possiblyMikeB/events{/privacy}", "received_events_url": "https://api.github.com/users/possiblyMikeB/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-08-23T22:42:21Z", "updated_at": "2022-08-24T18:01:46Z", "closed_at": "2022-08-24T18:01:21Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/4022", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4022", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/4022.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/4022.patch", "merged_at": "2022-08-24T18:01:20Z"}, "body": "According to the REST API documentation for the POST end-point `/users/{name}/token`, the expected units of the `expires_in` attribute are seconds.  As such, the titles for the options of the \"Token expires\" drop-down menu from the template `share/jupyterhub/templates/token.html` specify the wrong length of time. \r\n\r\nThis pull request corrects that by assuming the values for the options are correct, and updating each option's title. \r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4022/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4022/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4019", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4019/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4019/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4019/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4019", "id": 1344156953, "node_id": "PR_kwDOAT0rQs49coXC", "number": 4019, "title": "avoid database error on repeated group name in sync_groups", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-08-19T08:59:33Z", "updated_at": "2023-02-03T11:39:09Z", "closed_at": "2022-08-19T15:54:06Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/4019", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4019", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/4019.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/4019.patch", "merged_at": "2022-08-19T15:54:06Z"}, "body": "groups appearing twice would attempt to be added twice, leading to a possible failure to add it at all.\r\n\r\nmay close #4017 ", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4019/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4019/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4018", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4018/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4018/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4018/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4018", "id": 1344119698, "node_id": "PR_kwDOAT0rQs49cgd-", "number": 4018, "title": "reset offset to 0 on name filter change", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2022-08-19T08:26:02Z", "updated_at": "2022-09-06T10:40:10Z", "closed_at": "2022-09-05T16:46:08Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/4018", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4018", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/4018.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/4018.patch", "merged_at": "2022-09-05T16:46:08Z"}, "body": "move offset to redux state, rather than independent, since it can come from two places (user_page and pagination footer). Seems to keep things in sync better.\r\n\r\nAdds reducers for setting offset, name filter explicitly.\r\n\r\ncloses #3957", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4018/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4018/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4017", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4017/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4017/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4017/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/4017", "id": 1343631895, "node_id": "I_kwDOAT0rQs5QFjIX", "number": 4017, "title": "Database error when hub tries to add existing group", "user": {"login": "ryanlovett", "id": 10248125, "node_id": "MDQ6VXNlcjEwMjQ4MTI1", "avatar_url": "https://avatars.githubusercontent.com/u/10248125?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ryanlovett", "html_url": "https://github.com/ryanlovett", "followers_url": "https://api.github.com/users/ryanlovett/followers", "following_url": "https://api.github.com/users/ryanlovett/following{/other_user}", "gists_url": "https://api.github.com/users/ryanlovett/gists{/gist_id}", "starred_url": "https://api.github.com/users/ryanlovett/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ryanlovett/subscriptions", "organizations_url": "https://api.github.com/users/ryanlovett/orgs", "repos_url": "https://api.github.com/users/ryanlovett/repos", "events_url": "https://api.github.com/users/ryanlovett/events{/privacy}", "received_events_url": "https://api.github.com/users/ryanlovett/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2022-08-18T20:50:26Z", "updated_at": "2022-08-22T08:35:49Z", "closed_at": "2022-08-19T15:54:07Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "We enabled groups on a hub, and they seemed to be working fine for a little while, but users started to see 500 errors on logging in. One traceback indicated that the hub attempted to add an already existing group to the ORM database. The groups are based on course enrollments which we obtain from our Canvas LMS as users login. Unfortunately I don't have other tracebacks.\r\n\r\nHere is the traceback from one such instance:\r\nhttps://github.com/berkeley-dsep-infra/datahub/issues/3556#issuecomment-1212830090\r\n\r\nThe deployment is https://github.com/berkeley-dsep-infra/datahub and our authenticator is at https://github.com/berkeley-dsep-infra/datahub/tree/staging/images/hub/canvasauthenticator. Here is a condensed version of our `authenticate` method:\r\n```\r\n    async def authenticate(self, handler, data=None):\r\n        user = await super().authenticate(handler, data)\r\n        courses = await self.get_courses(user['auth_state']['access_token'])\r\n        user['groups'] = self.extract_course_groups(courses)\r\n        return user\r\n```\r\n\r\nWe've temporarily disabled the assignment to the `groups` key and that stopped the 500 errors.\r\n\r\nWe [had set](https://github.com/berkeley-dsep-infra/datahub/blob/5096d43940768a3f33dca48b9c87f2c5d7fcbf91/hub/values.yaml#L194) `Authenticator.managed_groups = True` but that is also temporarily disabled.\r\n\r\nOur hub is `jupyterhub/k8s-hub:1.1.3-n554.hfa81c67f` and is using a customized KubeSpawner.\r\n\r\nUnder /hub/admin we can see that 35 of the 37 groups were created during this time have only one user, while two groups have two. Our students tend to cluster in the same classes so I would normally expect higher group memberships. Some people were using the hub but hadn't yet been forced to reauthenticate due to the age of their login. I don't know how two groups managed to get two users added, given the behavior.\r\n\r\nThe error from the traceback:\r\n```\r\n    sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: groups.name\r\n    [SQL: INSERT INTO groups (name) VALUES (?)]\r\n    [parameters: ('canvas::1497305::student',)]\r\n```\r\noccurred with the group `canvas::1497305::student`, however I see no such existing group in the hub.\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4017/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4017/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4016", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4016/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4016/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4016/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4016", "id": 1340235626, "node_id": "PR_kwDOAT0rQs49PrbZ", "number": 4016, "title": "admin: avoid redundant client-side username validation in edit-user", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-08-16T11:51:36Z", "updated_at": "2022-08-17T08:06:40Z", "closed_at": "2022-08-16T12:13:49Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/4016", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4016", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/4016.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/4016.patch", "merged_at": "2022-08-16T12:13:49Z"}, "body": "username validation is the server-side's responsibility (same as #3936 but missed the occurrence in edit user)\r\n\r\ncloses #4015", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4016/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4016/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4011", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4011/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4011/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4011/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4011", "id": 1334160137, "node_id": "PR_kwDOAT0rQs487xq8", "number": 4011, "title": "restore trimming of username input", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-08-10T06:49:19Z", "updated_at": "2023-02-03T11:39:10Z", "closed_at": "2022-08-10T07:05:35Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/4011", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/4011", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/4011.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/4011.patch", "merged_at": "2022-08-10T07:05:35Z"}, "body": "continue to not trim password or custom fields (added in #1111)\r\n\r\ntrailing/leading space is also explicitly forbidden in validate_username. I expect this to only block typos, but since it's _technically_ backward compatible, let's get it in 3.0.\r\n\r\ncloses #4010 ", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4011/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/4011/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3993", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3993/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3993/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3993/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3993", "id": 1322237974, "node_id": "PR_kwDOAT0rQs48UXHo", "number": 3993, "title": "backport nbclassic fixes to 2.x", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-07-29T13:13:19Z", "updated_at": "2022-07-29T13:38:17Z", "closed_at": "2022-07-29T13:32:13Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3993", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3993", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3993.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3993.patch", "merged_at": "2022-07-29T13:32:13Z"}, "body": "backports nbclassic compatibility fixes and detection of the notebook app in a test\r\n\r\nbackports #3971 and #3977 which should get tests passing on 2.x again (#3984)", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3993/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3993/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3984", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3984/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3984/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3984/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3984", "id": 1308822640, "node_id": "PR_kwDOAT0rQs47nWSw", "number": 3984, "title": "Backport PR #3936 on branch 2.x (admin: Hub is responsible for username validation)", "user": {"login": "meeseeksmachine", "id": 39504233, "node_id": "MDQ6VXNlcjM5NTA0MjMz", "avatar_url": "https://avatars.githubusercontent.com/u/39504233?v=4", "gravatar_id": "", "url": "https://api.github.com/users/meeseeksmachine", "html_url": "https://github.com/meeseeksmachine", "followers_url": "https://api.github.com/users/meeseeksmachine/followers", "following_url": "https://api.github.com/users/meeseeksmachine/following{/other_user}", "gists_url": "https://api.github.com/users/meeseeksmachine/gists{/gist_id}", "starred_url": "https://api.github.com/users/meeseeksmachine/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/meeseeksmachine/subscriptions", "organizations_url": "https://api.github.com/users/meeseeksmachine/orgs", "repos_url": "https://api.github.com/users/meeseeksmachine/repos", "events_url": "https://api.github.com/users/meeseeksmachine/events{/privacy}", "received_events_url": "https://api.github.com/users/meeseeksmachine/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-07-19T00:13:55Z", "updated_at": "2022-07-29T17:43:29Z", "closed_at": "2022-07-29T17:43:29Z", "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3984", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3984", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3984.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3984.patch", "merged_at": "2022-07-29T17:43:29Z"}, "body": "Backport PR #3936: admin: Hub is responsible for username validation", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3984/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3984/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3983", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3983/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3983/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3983/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3983", "id": 1308800927, "node_id": "I_kwDOAT0rQs5OAref", "number": 3983, "title": "Can not add new users via the admin interface at all", "user": {"login": "yuvipanda", "id": 30430, "node_id": "MDQ6VXNlcjMwNDMw", "avatar_url": "https://avatars.githubusercontent.com/u/30430?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuvipanda", "html_url": "https://github.com/yuvipanda", "followers_url": "https://api.github.com/users/yuvipanda/followers", "following_url": "https://api.github.com/users/yuvipanda/following{/other_user}", "gists_url": "https://api.github.com/users/yuvipanda/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuvipanda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuvipanda/subscriptions", "organizations_url": "https://api.github.com/users/yuvipanda/orgs", "repos_url": "https://api.github.com/users/yuvipanda/repos", "events_url": "https://api.github.com/users/yuvipanda/events{/privacy}", "received_events_url": "https://api.github.com/users/yuvipanda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-07-18T23:32:35Z", "updated_at": "2022-07-19T00:09:54Z", "closed_at": "2022-07-19T00:09:54Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n\r\nWhen adding users via the admin interface, users get this error message:\r\n\r\n![image](https://user-images.githubusercontent.com/30430/179632889-9b1c1614-bdaf-4f3c-9322-686f1aebc6f3.png)\r\n(from https://github.com/2i2c-org/infrastructure/issues/1516#issuecomment-1188410929)\r\n\r\n(from https://github.com/2i2c-org/infrastructure/issues/1516#issuecomment-1188410929)\r\n\r\nLooking at the logs,  I see:\r\n\r\n```\r\n[W 2022-07-18 22:56:04.735 JupyterHub web:1787] 400 POST /hub/api/users (10.128.0.4): Must specify at least one user to create\r\n```\r\n\r\nAnd looking at the request in the network panel, I see:\r\n\r\n<img width=\"157\" alt=\"image\" src=\"https://user-images.githubusercontent.com/30430/179633517-b93c6aee-a9b9-4cc6-b2f5-5ab94e8f0c0e.png\">\r\n\r\nSo the textbox isn't actually being read! So user addition seems completely broken right now via the admin interface.\r\n\r\n### How to reproduce\r\n\r\n1. Open the admin panel\r\n2. Try to add a new user\r\n3. See error message\r\n\r\n### Your personal set up\r\n\r\nRunning on latest z2jh, with latest released jupyterhub.\r\n\r\n<details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\njovyan@hub-5c759b598c-979ms:/srv/jupyterhub$ pip list\r\nPackage                          Version\r\n-------------------------------- ---------\r\naiohttp                          3.8.1\r\naiosignal                        1.2.0\r\nalembic                          1.8.0\r\nasync-generator                  1.10\r\nasync-timeout                    4.0.2\r\nattrs                            21.4.0\r\nbcrypt                           3.2.2\r\ncertifi                          2022.6.15\r\ncertipy                          0.1.3\r\ncffi                             1.15.0\r\ncharset-normalizer               2.0.12\r\ncryptography                     37.0.2\r\ndeepmerge                        1.0.1\r\nentrypoints                      0.4\r\nescapism                         1.0.1\r\nfrozenlist                       1.3.0\r\ngreenlet                         1.1.2\r\nidna                             3.3\r\nJinja2                           3.1.2\r\njsonschema                       4.6.0\r\njupyter-telemetry                0.1.0\r\njupyterhub                       2.3.1\r\njupyterhub-configurator          1.0\r\njupyterhub-firstuseauthenticator 1.0.0\r\njupyterhub-hmacauthenticator     1.0\r\njupyterhub-idle-culler           1.2.1\r\njupyterhub-kubespawner           4.1.0\r\njupyterhub-ldapauthenticator     1.3.2\r\njupyterhub-ltiauthenticator      1.2.0\r\njupyterhub-nativeauthenticator   1.0.5\r\njupyterhub-tmpauthenticator      0.6\r\nkubernetes-asyncio               23.6.0\r\nldap3                            2.9.1\r\nMako                             1.2.0\r\nMarkupSafe                       2.1.1\r\nmultidict                        6.0.2\r\nmwoauth                          0.3.8\r\nnullauthenticator                1.0.0\r\noauthenticator                   15.0.1\r\noauthlib                         3.2.0\r\nonetimepass                      1.0.1\r\npackaging                        21.3\r\npamela                           1.0.0\r\npip                              22.0.4\r\nprometheus-client                0.14.1\r\npsycopg2-binary                  2.9.3\r\npy-spy                           0.3.12\r\npyasn1                           0.4.8\r\npycparser                        2.21\r\npycurl                           7.45.1\r\nPyJWT                            2.4.0\r\nPyMySQL                          1.0.2\r\npyOpenSSL                        22.0.0\r\npyparsing                        3.0.9\r\npyrsistent                       0.18.1\r\npython-dateutil                  2.8.2\r\npython-json-logger               2.0.2\r\npython-slugify                   6.1.2\r\nPyYAML                           6.0\r\nrequests                         2.28.0\r\nrequests-oauthlib                1.3.1\r\nruamel.yaml                      0.17.21\r\nruamel.yaml.clib                 0.2.6\r\nsetuptools                       58.1.0\r\nsix                              1.16.0\r\nSQLAlchemy                       1.4.37\r\nsqlalchemy-cockroachdb           1.4.3\r\nstatsd                           3.3.0\r\ntext-unidecode                   1.3\r\ntornado                          6.1\r\ntraitlets                        5.3.0\r\nurllib3                          1.26.9\r\nwheel                            0.37.1\r\nyarl                             1.7.2\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3983/reactions", "total_count": 2, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 2, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3983/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3971", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3971/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3971/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3971/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3971", "id": 1301491664, "node_id": "PR_kwDOAT0rQs47PBAF", "number": 3971, "title": "nbclassic extension name has been renamed", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-07-12T03:39:21Z", "updated_at": "2022-07-14T16:13:39Z", "closed_at": "2022-07-12T06:06:29Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3971", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3971", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3971.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3971.patch", "merged_at": "2022-07-12T06:06:29Z"}, "body": "ref: https://github.com/jupyter/nbclassic/pull/96/files#diff-baf53b9a1d8f038c7de824e4928d10356271b26bacf19ffccba98454e685438eL109-R110\r\n\r\nour patches to the jinja env need updating to find the new env. Until then, nbclassic 0.4.x will not get the template patches (the 'control panel' link)", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3971/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3971/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3969", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3969/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3969/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3969/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3969", "id": 1299880189, "node_id": "PR_kwDOAT0rQs47JrDa", "number": 3969, "title": "Fix disabling of individual page template announcements", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2022-07-10T10:06:42Z", "updated_at": "2022-07-30T16:38:48Z", "closed_at": "2022-07-30T16:38:47Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3969", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3969", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3969.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3969.patch", "merged_at": "2022-07-30T16:38:47Z"}, "body": "Closes #3965.\r\n\r\nThis could be written as `is not none` as well, but I figured there is no default value for `announcement_<page name>` in template_vars, this made sense as well, allowing people to declare a None value as well as a blank string, and not just a blank string, to disable an individual announcement.\r\n\r\n## Final behavior\r\n\r\nSetting template variables like:\r\n\r\n```python\r\nc.JupyterHub.template_vars = {\r\n    \"announcement\": \"something\",\r\n    \"announcement_spawn\": \"something else\",\r\n    \"announcement_login\": \"\",\r\n    # Setting a specific page's announcement variable to None doesn't do anything, but\r\n    # it can be useful if merging template_vars dictionaries to unset a value.\r\n    \"announcement_home\": None,\r\n}\r\n```\r\n\r\nwill cause the announcement `something` show up on all pages expect on the spawn page where it sais `something else` and on the login page where no announcement it shown.\r\n\r\n## Related unchanged logic\r\n\r\nhttps://github.com/jupyterhub/jupyterhub/blob/ab776e3989bffe9e1a9d0744c96c5f8e8d876988/share/jupyterhub/templates/page.html#L168-L174", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3969/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3969/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3967", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3967/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3967/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3967/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3967", "id": 1299242766, "node_id": "PR_kwDOAT0rQs47Hp1E", "number": 3967, "title": "validate proxy.extra_routes", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-07-08T16:45:19Z", "updated_at": "2022-07-14T16:01:28Z", "closed_at": "2022-07-14T16:01:12Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3967", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3967", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3967.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3967.patch", "merged_at": "2022-07-14T16:01:12Z"}, "body": "- add trailing slash if missing, and warn (as we do with url prefixes elsewhere), since this one is unambiguous\r\n- raise if leading slash is wrong (must not be present with host routing, must be present otherwise). Raises rather than fixing automatically like trailing slash because it is ambiguous whether the intention is host-based routing or prefix routing.\r\n- Lightweight check for probably-urls (don't need to be strict here, just catch likely errors, such as omitting host/protocol entirely)\r\n\r\nCame up in https://discourse.jupyter.org/t/oauth-flow-in-jupyterhub-on-z2jh/14779/8", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3967/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3967/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3960", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3960/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3960/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3960/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3960", "id": 1286935011, "node_id": "PR_kwDOAT0rQs46eZ_t", "number": 3960, "title": "Fix GET /api/proxy with pagination", "user": {"login": "cqzlxl", "id": 2704658, "node_id": "MDQ6VXNlcjI3MDQ2NTg=", "avatar_url": "https://avatars.githubusercontent.com/u/2704658?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cqzlxl", "html_url": "https://github.com/cqzlxl", "followers_url": "https://api.github.com/users/cqzlxl/followers", "following_url": "https://api.github.com/users/cqzlxl/following{/other_user}", "gists_url": "https://api.github.com/users/cqzlxl/gists{/gist_id}", "starred_url": "https://api.github.com/users/cqzlxl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cqzlxl/subscriptions", "organizations_url": "https://api.github.com/users/cqzlxl/orgs", "repos_url": "https://api.github.com/users/cqzlxl/repos", "events_url": "https://api.github.com/users/cqzlxl/events{/privacy}", "received_events_url": "https://api.github.com/users/cqzlxl/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-06-28T07:47:29Z", "updated_at": "2022-06-30T19:18:09Z", "closed_at": "2022-06-30T19:18:09Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3960", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3960", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3960.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3960.patch", "merged_at": "2022-06-30T19:18:09Z"}, "body": "It's an obvious bug.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3960/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3960/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3957", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3957/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3957/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3957/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3957", "id": 1283032083, "node_id": "I_kwDOAT0rQs5MeYQT", "number": 3957, "title": "A new search at /hub/admin should initialize page to 0", "user": {"login": "ryanlovett", "id": 10248125, "node_id": "MDQ6VXNlcjEwMjQ4MTI1", "avatar_url": "https://avatars.githubusercontent.com/u/10248125?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ryanlovett", "html_url": "https://github.com/ryanlovett", "followers_url": "https://api.github.com/users/ryanlovett/followers", "following_url": "https://api.github.com/users/ryanlovett/following{/other_user}", "gists_url": "https://api.github.com/users/ryanlovett/gists{/gist_id}", "starred_url": "https://api.github.com/users/ryanlovett/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ryanlovett/subscriptions", "organizations_url": "https://api.github.com/users/ryanlovett/orgs", "repos_url": "https://api.github.com/users/ryanlovett/repos", "events_url": "https://api.github.com/users/ryanlovett/events{/privacy}", "received_events_url": "https://api.github.com/users/ryanlovett/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-06-23T22:28:43Z", "updated_at": "2022-09-05T16:46:09Z", "closed_at": "2022-09-05T16:46:09Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n\r\nIf I navigate to the second page of users (`/hub/admin#/?page=1`), then use the search field to try to find someone, search returns empty results. If I navigate back to the first page then initiate a search, it returns results matching the search term.\r\n\r\nSearch will return _some_ results on page > 0 if I use a short search time like `a`. So if I start the search while viewing page X, then I see page X of the search results.\r\n\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\n\r\n#### Expected behaviour\r\n\r\nI expected that when I initiate at search, it should always start at page=0.\r\n\r\n#### Actual behaviour\r\n\r\nSearch returns no results, even if I know there to be a user matching the search term. It appears that search results are being paginated too and the initial page= offset is hiding results when the count of matching users is less than `limit`. For example if I search for \"a\" which matches more than 50 users on this particular hub, and if I'm starting out on the second page, then I do see some results. So search is working but the initial page offset was surprising and gives a false impression for non-pathological search terms.\r\n\r\n### How to reproduce\r\n\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\n1. Go to the first page of /hub/admin on a hub which has more than a page's worth of users (50 is the default?). Note the name of any user.\r\n2. Click on Next to go to the next page.\r\n3. Search for the user you noted in the first step. Alternatively search for any other user that you know to exist.\r\n4. Observe empty results.\r\n\r\n### Your personal set up\r\n\r\nhttps://github.com/berkeley-dsep-infra/datahub\r\n\r\nhelm chart 1.1.3-n554.hfa81c67f\r\njupyterhub 2.3.0\r\n\r\n<details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\nauthenticator==14.2.0\r\noauthlib==3.2.0\r\nonetimepass==1.0.1\r\npackaging==21.3\r\npamela==1.0.0\r\npem==21.2.0\r\nprometheus-client==0.14.1\r\npsycopg2-binary==2.9.3\r\npy-spy==0.3.12\r\npyasn1==0.4.8\r\npycparser==2.21\r\npycryptodome==3.14.1\r\npycryptodomex @ file:///tmp/pre-built-wheels/pycryptodomex-3.14.1-cp35-abi3-manylinux2010_x86_64.whl\r\npycurl @ file:///tmp/pre-built-wheels/pycurl-7.45.1-cp39-cp39-linux_x86_64.whl\r\npyjwkest==1.4.2\r\nPyJWT==1.7.1\r\nPyMySQL==1.0.2\r\npyOpenSSL==22.0.0\r\npyparsing==3.0.9\r\npyrsistent==0.18.1\r\npython-dateutil==2.8.2\r\npython-json-logger==2.0.2\r\npython-slugify==6.1.2\r\nPyYAML==6.0\r\nrequests==2.27.1\r\nrequests-oauthlib==1.3.1\r\nruamel.yaml==0.17.21\r\nruamel.yaml.clib @ file:///tmp/pre-built-wheels/ruamel.yaml.clib-0.2.6-cp39-cp39-manylinux1_x86_64.whl\r\nsix==1.16.0\r\nSQLAlchemy==1.4.36\r\nsqlalchemy-cockroachdb==1.4.3\r\nstatsd==3.3.0\r\ntext-unidecode==1.3\r\ntornado==6.1\r\ntraitlets==5.2.1.post0\r\nurllib3==1.26.9\r\nwrapt==1.14.1\r\nyarl==1.7.2```\r\n</details>\r\n\r\n<details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```\r\n\r\n[kubespawner](https://github.com/berkeley-dsep-infra/datahub/blob/staging/hub/values.yaml#L301)\r\n[canvasauthenticator](https://github.com/berkeley-dsep-infra/datahub/tree/staging/images/hub/canvasauthenticator)```\r\n\r\n</details>\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3957/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3957/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3956", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3956/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3956/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3956/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3956", "id": 1282712144, "node_id": "I_kwDOAT0rQs5MdKJQ", "number": 3956, "title": "Possible race condition with idle-culler", "user": {"login": "ryanlovett", "id": 10248125, "node_id": "MDQ6VXNlcjEwMjQ4MTI1", "avatar_url": "https://avatars.githubusercontent.com/u/10248125?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ryanlovett", "html_url": "https://github.com/ryanlovett", "followers_url": "https://api.github.com/users/ryanlovett/followers", "following_url": "https://api.github.com/users/ryanlovett/following{/other_user}", "gists_url": "https://api.github.com/users/ryanlovett/gists{/gist_id}", "starred_url": "https://api.github.com/users/ryanlovett/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ryanlovett/subscriptions", "organizations_url": "https://api.github.com/users/ryanlovett/orgs", "repos_url": "https://api.github.com/users/ryanlovett/repos", "events_url": "https://api.github.com/users/ryanlovett/events{/privacy}", "received_events_url": "https://api.github.com/users/ryanlovett/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2022-06-23T17:13:08Z", "updated_at": "2022-06-23T21:51:20Z", "closed_at": "2022-06-23T21:51:20Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n\r\nThe following has shown up in several of our hubs' logs when they get redeployed and start up:\r\n```\r\n[W 2022-06-22 17:43:26.841 JupyterHub log:189] 403 GET /hub/api/users?state=[secret] (jupyterhub-idle-culler@127.0.0.1) 5.25ms\r\n[E 220622 17:43:26 ioloop:761] Exception in callback functools.partial(<bound method IOLoop._discard_future_result of <tornado.platform.asyncio.AsyncIOMainLoop object at 0x7f4880030a30>>, <Task finished name='Task-1' coro=<cull_idle() done, defined at /usr/local/lib/python3.9/site-packages/jupyterhub_idle_culler/__init__.py:73> exception=HTTP 403: Forbidden>)\r\n    Traceback (most recent call last):\r\n      File \"/usr/local/lib/python3.9/site-packages/tornado/ioloop.py\", line 741, in _run_callback\r\n        ret = callback()\r\n      File \"/usr/local/lib/python3.9/site-packages/tornado/ioloop.py\", line 765, in _discard_future_result\r\n        future.result()\r\n      File \"/usr/local/lib/python3.9/site-packages/jupyterhub_idle_culler/__init__.py\", line 422, in cull_idle\r\n        async for user in fetch_paginated(req):\r\n      File \"/usr/local/lib/python3.9/site-packages/jupyterhub_idle_culler/__init__.py\", line 135, in fetch_paginated\r\n        response = await resp_future\r\n      File \"/usr/local/lib/python3.9/site-packages/jupyterhub_idle_culler/__init__.py\", line 117, in fetch\r\n        return await client.fetch(req)\r\n    tornado.httpclient.HTTPClientError: HTTP 403: Forbidden\r\n```\r\n\r\nThe idle culler is running and does appear to be working.\r\n#### Expected behaviour\r\n\r\nidle-culler would be able to access the api endpoint without error, or this async-y condition is accounted for and emits a message instead of an exception.\r\n\r\n### How to reproduce\r\n\r\nThis is on hub startup.\r\n\r\n### Your personal set up\r\n\r\nhttps://github.com/berkeley-dsep-infra/datahub\r\n\r\nhelm chart 1.1.3-n554.hfa81c67f\r\njupyterhub 2.3.0\r\njupyterhub-idle-culler 1.2.1\r\n\r\n<details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\nauthenticator==14.2.0\r\noauthlib==3.2.0\r\nonetimepass==1.0.1\r\npackaging==21.3\r\npamela==1.0.0\r\npem==21.2.0\r\nprometheus-client==0.14.1\r\npsycopg2-binary==2.9.3\r\npy-spy==0.3.12\r\npyasn1==0.4.8\r\npycparser==2.21\r\npycryptodome==3.14.1\r\npycryptodomex @ file:///tmp/pre-built-wheels/pycryptodomex-3.14.1-cp35-abi3-manylinux2010_x86_64.whl\r\npycurl @ file:///tmp/pre-built-wheels/pycurl-7.45.1-cp39-cp39-linux_x86_64.whl\r\npyjwkest==1.4.2\r\nPyJWT==1.7.1\r\nPyMySQL==1.0.2\r\npyOpenSSL==22.0.0\r\npyparsing==3.0.9\r\npyrsistent==0.18.1\r\npython-dateutil==2.8.2\r\npython-json-logger==2.0.2\r\npython-slugify==6.1.2\r\nPyYAML==6.0\r\nrequests==2.27.1\r\nrequests-oauthlib==1.3.1\r\nruamel.yaml==0.17.21\r\nruamel.yaml.clib @ file:///tmp/pre-built-wheels/ruamel.yaml.clib-0.2.6-cp39-cp39-manylinux1_x86_64.whl\r\nsix==1.16.0\r\nSQLAlchemy==1.4.36\r\nsqlalchemy-cockroachdb==1.4.3\r\nstatsd==3.3.0\r\ntext-unidecode==1.3\r\ntornado==6.1\r\ntraitlets==5.2.1.post0\r\nurllib3==1.26.9\r\nwrapt==1.14.1\r\nyarl==1.7.2\r\n```\r\n</details>\r\n\r\n<details><summary>Configuration</summary>\r\n\r\n[kubespawner](https://github.com/berkeley-dsep-infra/datahub/blob/staging/hub/values.yaml#L301)\r\n[canvasauthenticator](https://github.com/berkeley-dsep-infra/datahub/tree/staging/images/hub/canvasauthenticator) \r\n\r\n</details>", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3956/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3956/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3953", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3953/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3953/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3953/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3953", "id": 1272400118, "node_id": "PR_kwDOAT0rQs45t3Ug", "number": 3953, "title": "FreeBSD, missing -n for pw useradd", "user": {"login": "silenius", "id": 1225348, "node_id": "MDQ6VXNlcjEyMjUzNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1225348?v=4", "gravatar_id": "", "url": "https://api.github.com/users/silenius", "html_url": "https://github.com/silenius", "followers_url": "https://api.github.com/users/silenius/followers", "following_url": "https://api.github.com/users/silenius/following{/other_user}", "gists_url": "https://api.github.com/users/silenius/gists{/gist_id}", "starred_url": "https://api.github.com/users/silenius/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/silenius/subscriptions", "organizations_url": "https://api.github.com/users/silenius/orgs", "repos_url": "https://api.github.com/users/silenius/repos", "events_url": "https://api.github.com/users/silenius/events{/privacy}", "received_events_url": "https://api.github.com/users/silenius/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2022-06-15T15:25:02Z", "updated_at": "2022-07-14T16:13:46Z", "closed_at": "2022-06-16T09:33:06Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3953", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3953", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3953.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3953.patch", "merged_at": "2022-06-16T09:33:06Z"}, "body": "I was playing with jupyterhub for a workshop in a FreeBSD jail and noticed:\r\n\r\n```\r\n[I 2022-06-15 16:46:21.352 JupyterHub app:3156] JupyterHub is now running at http://:8000                                                     \r\n[I 2022-06-15 16:46:58.270 JupyterHub roles:366] Adding role user for User: foo                                                                                                                                                                                                             \r\n[I 2022-06-15 16:46:58.282 JupyterHub auth:945] Creating user: pw useradd -m foo                                                              \r\n[E 2022-06-15 16:46:58.288 JupyterHub users:223] Failed to create user: foo                                                                   \r\n    Traceback (most recent call last):                                                                                                        \r\n      File \"/usr/local/www/jupyterhub/jup/lib/python3.8/site-packages/jupyterhub/apihandlers/users.py\", line 221, in post                                                                                                                                                                   \r\n        await maybe_future(self.authenticator.add_user(user))                                                                                                                                                                                                                               \r\n      File \"/usr/local/www/jupyterhub/jup/lib/python3.8/site-packages/jupyterhub/auth.py\", line 884, in add_user                              \r\n        await maybe_future(self.add_system_user(user))                                                                                                                                                                                                                                      \r\n      File \"/usr/local/www/jupyterhub/jup/lib/python3.8/site-packages/jupyterhub/auth.py\", line 950, in add_system_user                                                                                                                                                                     \r\n        raise RuntimeError(f\"Failed to create system user {name}: {err}\")                                                                                                                                                                                                                   \r\n    RuntimeError: Failed to create system user foo: pw: user name or id required                                                                                                                                                                                                            \r\n                                                                                                                                                                                                                                                                                            \r\n                                                                                                                                                                                                                                                                                            \r\n[W 2022-06-15 16:46:58.316 JupyterHub web:1787] 400 POST /hub/api/users (10.209.1.43): Failed to create user foo: Failed to create system user foo: pw: user name or id required\r\n```\r\n\r\nthis is because a -n is missing when pw useradd is executed                                                                                                      ", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3953/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3953/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3938", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3938/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3938/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3938/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3938", "id": 1265577931, "node_id": "I_kwDOAT0rQs5Lby_L", "number": 3938, "title": "documentation page \"JupyterHub REST API\" is empty", "user": {"login": "suevii", "id": 20682164, "node_id": "MDQ6VXNlcjIwNjgyMTY0", "avatar_url": "https://avatars.githubusercontent.com/u/20682164?v=4", "gravatar_id": "", "url": "https://api.github.com/users/suevii", "html_url": "https://github.com/suevii", "followers_url": "https://api.github.com/users/suevii/followers", "following_url": "https://api.github.com/users/suevii/following{/other_user}", "gists_url": "https://api.github.com/users/suevii/gists{/gist_id}", "starred_url": "https://api.github.com/users/suevii/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/suevii/subscriptions", "organizations_url": "https://api.github.com/users/suevii/orgs", "repos_url": "https://api.github.com/users/suevii/repos", "events_url": "https://api.github.com/users/suevii/events{/privacy}", "received_events_url": "https://api.github.com/users/suevii/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-06-09T04:31:40Z", "updated_at": "2022-09-05T13:49:30Z", "closed_at": "2022-09-05T13:49:30Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n\r\nHi, when I was reading the doc I found this page empty:\r\nhttps://jupyterhub.readthedocs.io/en/latest/reference/rest-api.html#\r\n<img width=\"1177\" alt=\"image\" src=\"https://user-images.githubusercontent.com/20682164/172764130-701c3883-a25d-41ee-ba6a-b3a52f2c8c1d.png\">\r\nWant to know if it's deprecated or just forgot to fulfill.\r\n\r\n#### Expected behaviour\r\nThe page is removed if it's deprecated.\r\n\r\n#### Actual behaviour\r\nThis page is empty:\r\nhttps://jupyterhub.readthedocs.io/en/latest/reference/rest-api.html#\r\n<!-- Tell us what actually happens. -->\r\n\r\n### How to reproduce\r\n\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\n1. open https://jupyterhub.readthedocs.io/en/latest/reference/rest-api.html#\r\n\r\n### Your personal set up\r\n\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n\r\n - OS:\r\n macOS 10.15.7 (19H1824)\r\n - Version(s):\r\n Chrome Version 102.0.5005.61 (Official Build) (x86_64)\r\n <!-- e.g. jupyterhub --version, python --version --->\r\n\r\n<details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\n# paste output of `pip freeze` or `conda list` here\r\n```\r\n</details>\r\n\r\n<details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```python\r\n# jupyterhub_config.py\r\n```\r\n</details>\r\n\r\n<details><summary>Logs</summary>\r\n<!--\r\nErrors are often logged by jupytehub. How you get logs depends on your deployment.\r\nWith kubernetes it might be:\r\n\r\n    kubectl get pod # hub pod name starts with hub...\r\n    kubectl logs hub-...\r\n    # or for a single-user server\r\n    kubectl logs jupyter-username\r\n\r\nOr the-littlest-jupyterhub:\r\n\r\n    journalctl -u jupyterhub\r\n    # or for a single-user server\r\n    journalctl -u jupyter-username\r\n-->\r\n\r\n```\r\n# paste relevant logs here, if any\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3938/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3938/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3936", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3936/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3936/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3936/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3936", "id": 1264432717, "node_id": "PR_kwDOAT0rQs45TZdI", "number": 3936, "title": "admin: Hub is responsible for username validation", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-06-08T09:07:50Z", "updated_at": "2022-07-19T00:13:49Z", "closed_at": "2022-06-08T12:55:52Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3936", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3936", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3936.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3936.patch", "merged_at": "2022-06-08T12:55:52Z"}, "body": "Don't reimplement username validation in the UI, which may not be consistent with the Authenticator\r\n\r\ncloses #3933", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3936/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3936/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3935", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3935/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3935/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3935/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3935", "id": 1264409610, "node_id": "PR_kwDOAT0rQs45TUhu", "number": 3935, "title": "admin: Fix spawn page link for default server", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-06-08T08:48:42Z", "updated_at": "2022-07-15T03:29:18Z", "closed_at": "2022-06-08T12:51:26Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3935", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3935", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3935.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3935.patch", "merged_at": "2022-06-08T12:51:26Z"}, "body": "was using `undefined` instead of `\"\"` for default server url\r\n\r\nregression test added\r\n\r\ncloses #3900", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3935/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3935/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3933", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3933/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3933/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3933/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3933", "id": 1263971888, "node_id": "I_kwDOAT0rQs5LVq4w", "number": 3933, "title": "Unable to create users with certain characters in the admin control panel", "user": {"login": "dbricare", "id": 14186206, "node_id": "MDQ6VXNlcjE0MTg2MjA2", "avatar_url": "https://avatars.githubusercontent.com/u/14186206?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dbricare", "html_url": "https://github.com/dbricare", "followers_url": "https://api.github.com/users/dbricare/followers", "following_url": "https://api.github.com/users/dbricare/following{/other_user}", "gists_url": "https://api.github.com/users/dbricare/gists{/gist_id}", "starred_url": "https://api.github.com/users/dbricare/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dbricare/subscriptions", "organizations_url": "https://api.github.com/users/dbricare/orgs", "repos_url": "https://api.github.com/users/dbricare/repos", "events_url": "https://api.github.com/users/dbricare/events{/privacy}", "received_events_url": "https://api.github.com/users/dbricare/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-06-07T22:51:46Z", "updated_at": "2022-06-08T12:55:52Z", "closed_at": "2022-06-08T12:55:52Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\n\r\nFrom the admin control panel I'm unable to create new users if the username contains '.' or '@' as you might find in an email address.\r\n\r\nThere is no problem with usernames of this format if they are added from a userlist when the hub launches.\r\n\r\nCharacters '-' and '_' seem to be ok but I haven't tried every non-alphanumeric character.\r\n\r\n\r\n#### Expected behaviour\r\n\r\n<!-- Tell us what you thought would happen. -->\r\n\r\nI would expect to be able to create usernames of the format abc@def.com\r\n\r\n#### Actual behaviour\r\n\r\n<!-- Tell us what actually happens. -->\r\n\r\nThere is an error pop up with the text `Failed to create user.`\r\n\r\nIn the logs I see a message:\r\n\r\n`[W 2022-06-07 22:27:31.538 JupyterHub web:1787] 400 POST /jupyter/hub/api/users (#.#.#.#): Must specify at least one user to create`\r\n\r\nThis seems to be raised here:\r\nhttps://github.com/jupyterhub/jupyterhub/blob/main/jupyterhub/apihandlers/users.py#L181\r\n\r\n### How to reproduce\r\n\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\n1. Go to Admin control panel\r\n2. Click on 'Add Users'\r\n3. Enter name of user with '@' or '.'\r\n4. See error\r\n\r\n### Your personal set up\r\n\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\nJupyterhub is running on an AWS EKS cluster using a customized jupyterhub 2.3.0 docker image.\r\n\r\n - OS:\r\n <!-- [e.g. ubuntu 20.04, macOS 11.0] -->\r\nUbuntu 20.04\r\n - Version(s):\r\n <!-- e.g. jupyterhub --version, python --version --->\r\nJupyterhub 2.3.0\r\nPython 3.8.10\r\nKubernetes 1.21\r\n\r\n<details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\n# paste output of `pip freeze` or `conda list` here\r\n```\r\nalembic @ file:///tmp/wheelhouse/alembic-1.7.7-py3-none-any.whl\r\nargon2-cffi==21.3.0\r\nargon2-cffi-bindings==21.2.0\r\nasttokens==2.0.5\r\nasync-generator @ file:///tmp/wheelhouse/async_generator-1.10-py3-none-any.whl\r\nattrs @ file:///tmp/wheelhouse/attrs-21.4.0-py2.py3-none-any.whl\r\nbackcall==0.2.0\r\nbeautifulsoup4==4.11.1\r\nbleach==5.0.0\r\ncachetools==5.1.0\r\ncertifi @ file:///tmp/wheelhouse/certifi-2021.10.8-py2.py3-none-any.whl\r\ncertipy @ file:///tmp/wheelhouse/certipy-0.1.3-py3-none-any.whl\r\ncffi @ file:///tmp/wheelhouse/cffi-1.15.0-cp38-cp38-manylinux_2_12_x86_64.manylinux2010_x86_64.whl\r\ncharset-normalizer @ file:///tmp/wheelhouse/charset_normalizer-2.0.12-py3-none-any.whl\r\ncryptography @ file:///tmp/wheelhouse/cryptography-37.0.2-cp36-abi3-manylinux_2_24_x86_64.whl\r\ndebugpy==1.6.0\r\ndecorator==5.1.1\r\ndefusedxml==0.7.1\r\necdsa==0.17.0\r\nentrypoints @ file:///tmp/wheelhouse/entrypoints-0.4-py3-none-any.whl\r\nescapism==1.0.1\r\nexecuting==0.8.3\r\nfastjsonschema==2.15.3\r\ngoogle-auth==2.6.6\r\ngreenlet @ file:///tmp/wheelhouse/greenlet-1.1.2-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl\r\nidna @ file:///tmp/wheelhouse/idna-3.3-py3-none-any.whl\r\nimportlib-metadata @ file:///tmp/wheelhouse/importlib_metadata-4.11.3-py3-none-any.whl\r\nimportlib-resources @ file:///tmp/wheelhouse/importlib_resources-5.7.1-py3-none-any.whl\r\nipykernel==6.13.0\r\nipython==8.3.0\r\nipython-genutils==0.2.0\r\nipywidgets==7.7.0\r\njedi==0.18.1\r\nJinja2 @ file:///tmp/wheelhouse/Jinja2-3.1.2-py3-none-any.whl\r\njsonschema @ file:///tmp/wheelhouse/jsonschema-4.5.1-py3-none-any.whl\r\njupyter==1.0.0\r\njupyter-client==7.3.1\r\njupyter-console==6.4.3\r\njupyter-core==4.10.0\r\njupyter-telemetry @ file:///tmp/wheelhouse/jupyter_telemetry-0.1.0-py3-none-any.whl\r\njupyterhub @ file:///tmp/wheelhouse/jupyterhub-2.3.0-py3-none-any.whl\r\njupyterhub-brixauthenticator==0.0.dev0\r\njupyterhub-idle-culler==1.2.1\r\njupyterhub-kubespawner==0.16.1\r\njupyterlab-pygments==0.2.2\r\njupyterlab-widgets==1.1.0\r\nkubernetes==12.0.0\r\nMako @ file:///tmp/wheelhouse/Mako-1.2.0-py3-none-any.whl\r\nMarkupSafe @ file:///tmp/wheelhouse/MarkupSafe-2.1.1-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl\r\nmatplotlib-inline==0.1.3\r\nmistune==0.8.4\r\nnbclient==0.6.3\r\nnbconvert==6.5.0\r\nnbformat==5.4.0\r\nnest-asyncio==1.5.5\r\nnotebook==6.4.11\r\noauthlib @ file:///tmp/wheelhouse/oauthlib-3.2.0-py3-none-any.whl\r\npackaging @ file:///tmp/wheelhouse/packaging-21.3-py3-none-any.whl\r\npamela @ file:///tmp/wheelhouse/pamela-1.0.0-py2.py3-none-any.whl\r\npandocfilters==1.5.0\r\nparso==0.8.3\r\npexpect==4.8.0\r\npickleshare==0.7.5\r\nprometheus-client @ file:///tmp/wheelhouse/prometheus_client-0.14.1-py3-none-any.whl\r\nprompt-toolkit==3.0.29\r\npsutil==5.9.1\r\nptyprocess==0.7.0\r\npure-eval==0.2.2\r\npyasn1==0.4.8\r\npyasn1-modules==0.2.8\r\npycparser @ file:///tmp/wheelhouse/pycparser-2.21-py2.py3-none-any.whl\r\npycurl==7.45.1\r\nPygments==2.12.0\r\npyOpenSSL @ file:///tmp/wheelhouse/pyOpenSSL-22.0.0-py2.py3-none-any.whl\r\npyparsing @ file:///tmp/wheelhouse/pyparsing-3.0.8-py3-none-any.whl\r\npyrsistent @ file:///tmp/wheelhouse/pyrsistent-0.18.1-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl\r\npython-dateutil @ file:///tmp/wheelhouse/python_dateutil-2.8.2-py2.py3-none-any.whl\r\npython-jose==3.3.0\r\npython-json-logger @ file:///tmp/wheelhouse/python_json_logger-2.0.2-py3-none-any.whl\r\npython-slugify==6.1.2\r\nPyYAML==6.0\r\npyzmq==23.0.0\r\nqtconsole==5.3.0\r\nQtPy==2.1.0\r\nrequests @ file:///tmp/wheelhouse/requests-2.27.1-py2.py3-none-any.whl\r\nrequests-oauthlib==1.3.1\r\nrsa==4.8\r\nruamel.yaml @ file:///tmp/wheelhouse/ruamel.yaml-0.17.21-py3-none-any.whl\r\nruamel.yaml.clib @ file:///tmp/wheelhouse/ruamel.yaml.clib-0.2.6-cp38-cp38-manylinux1_x86_64.whl\r\nSend2Trash==1.8.0\r\nsix @ file:///tmp/wheelhouse/six-1.16.0-py2.py3-none-any.whl\r\nsoupsieve==2.3.2.post1\r\nSQLAlchemy @ file:///tmp/wheelhouse/SQLAlchemy-1.4.36-cp38-cp38-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl\r\nstack-data==0.2.0\r\nterminado==0.15.0\r\ntext-unidecode==1.3\r\ntinycss2==1.1.1\r\ntornado @ file:///tmp/wheelhouse/tornado-6.1-cp38-cp38-manylinux2010_x86_64.whl\r\ntraitlets @ file:///tmp/wheelhouse/traitlets-5.1.1-py3-none-any.whl\r\nurllib3 @ file:///tmp/wheelhouse/urllib3-1.26.9-py2.py3-none-any.whl\r\nwcwidth==0.2.5\r\nwebencodings==0.5.1\r\nwebsocket-client==1.3.2\r\nwidgetsnbextension==3.6.0\r\nzipp @ file:///tmp/wheelhouse/zipp-3.8.0-py3-none-any.whl\r\n</details>\r\n\r\n<details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```python\r\n# jupyterhub_config.py\r\n```\r\n</details>\r\n\r\n<details><summary>Logs</summary>\r\n<!--\r\nErrors are often logged by jupytehub. How you get logs depends on your deployment.\r\nWith kubernetes it might be:\r\n\r\n    kubectl get pod # hub pod name starts with hub...\r\n    kubectl logs hub-...\r\n    # or for a single-user server\r\n    kubectl logs jupyter-username\r\n\r\nOr the-littlest-jupyterhub:\r\n\r\n    journalctl -u jupyterhub\r\n    # or for a single-user server\r\n    journalctl -u jupyter-username\r\n-->\r\n\r\n```\r\n# paste relevant logs here, if any\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3933/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3933/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3928", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3928/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3928/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3928/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3928", "id": 1260065128, "node_id": "PR_kwDOAT0rQs45E9DU", "number": 3928, "title": "Auto backport of pr 3919 on 2.x", "user": {"login": "yuvipanda", "id": 30430, "node_id": "MDQ6VXNlcjMwNDMw", "avatar_url": "https://avatars.githubusercontent.com/u/30430?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuvipanda", "html_url": "https://github.com/yuvipanda", "followers_url": "https://api.github.com/users/yuvipanda/followers", "following_url": "https://api.github.com/users/yuvipanda/following{/other_user}", "gists_url": "https://api.github.com/users/yuvipanda/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuvipanda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuvipanda/subscriptions", "organizations_url": "https://api.github.com/users/yuvipanda/orgs", "repos_url": "https://api.github.com/users/yuvipanda/repos", "events_url": "https://api.github.com/users/yuvipanda/events{/privacy}", "received_events_url": "https://api.github.com/users/yuvipanda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-06-03T15:47:00Z", "updated_at": "2022-07-14T16:14:21Z", "closed_at": "2022-06-06T13:10:16Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3928", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3928", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3928.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3928.patch", "merged_at": "2022-06-06T13:10:16Z"}, "body": "Following instructions in https://github.com/jupyterhub/jupyterhub/pull/3919#issuecomment-1146067056", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3928/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3928/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3927", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3927/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3927/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3927/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3927", "id": 1260036205, "node_id": "PR_kwDOAT0rQs45E2zZ", "number": 3927, "title": "Backport PR #3918 on branch 2.x (set default_url via config)", "user": {"login": "meeseeksmachine", "id": 39504233, "node_id": "MDQ6VXNlcjM5NTA0MjMz", "avatar_url": "https://avatars.githubusercontent.com/u/39504233?v=4", "gravatar_id": "", "url": "https://api.github.com/users/meeseeksmachine", "html_url": "https://github.com/meeseeksmachine", "followers_url": "https://api.github.com/users/meeseeksmachine/followers", "following_url": "https://api.github.com/users/meeseeksmachine/following{/other_user}", "gists_url": "https://api.github.com/users/meeseeksmachine/gists{/gist_id}", "starred_url": "https://api.github.com/users/meeseeksmachine/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/meeseeksmachine/subscriptions", "organizations_url": "https://api.github.com/users/meeseeksmachine/orgs", "repos_url": "https://api.github.com/users/meeseeksmachine/repos", "events_url": "https://api.github.com/users/meeseeksmachine/events{/privacy}", "received_events_url": "https://api.github.com/users/meeseeksmachine/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-06-03T15:17:10Z", "updated_at": "2022-06-06T13:10:06Z", "closed_at": "2022-06-06T13:10:06Z", "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3927", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3927", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3927.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3927.patch", "merged_at": "2022-06-06T13:10:06Z"}, "body": "Backport PR #3918: set default_url via config", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3927/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3927/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3926", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3926/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3926/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3926/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3926", "id": 1260036094, "node_id": "PR_kwDOAT0rQs45E2x8", "number": 3926, "title": "Backport PR #3910 on branch 2.x (use equality to filter token prefixes)", "user": {"login": "meeseeksmachine", "id": 39504233, "node_id": "MDQ6VXNlcjM5NTA0MjMz", "avatar_url": "https://avatars.githubusercontent.com/u/39504233?v=4", "gravatar_id": "", "url": "https://api.github.com/users/meeseeksmachine", "html_url": "https://github.com/meeseeksmachine", "followers_url": "https://api.github.com/users/meeseeksmachine/followers", "following_url": "https://api.github.com/users/meeseeksmachine/following{/other_user}", "gists_url": "https://api.github.com/users/meeseeksmachine/gists{/gist_id}", "starred_url": "https://api.github.com/users/meeseeksmachine/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/meeseeksmachine/subscriptions", "organizations_url": "https://api.github.com/users/meeseeksmachine/orgs", "repos_url": "https://api.github.com/users/meeseeksmachine/repos", "events_url": "https://api.github.com/users/meeseeksmachine/events{/privacy}", "received_events_url": "https://api.github.com/users/meeseeksmachine/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-06-03T15:17:02Z", "updated_at": "2022-06-06T13:36:36Z", "closed_at": "2022-06-06T13:36:36Z", "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3926", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3926", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3926.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3926.patch", "merged_at": "2022-06-06T13:36:36Z"}, "body": "Backport PR #3910: use equality to filter token prefixes", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3926/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3926/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3925", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3925/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3925/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3925/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3925", "id": 1260035841, "node_id": "PR_kwDOAT0rQs45E2uZ", "number": 3925, "title": "Backport PR #3906 on branch 2.x (Force add existing certificates)", "user": {"login": "meeseeksmachine", "id": 39504233, "node_id": "MDQ6VXNlcjM5NTA0MjMz", "avatar_url": "https://avatars.githubusercontent.com/u/39504233?v=4", "gravatar_id": "", "url": "https://api.github.com/users/meeseeksmachine", "html_url": "https://github.com/meeseeksmachine", "followers_url": "https://api.github.com/users/meeseeksmachine/followers", "following_url": "https://api.github.com/users/meeseeksmachine/following{/other_user}", "gists_url": "https://api.github.com/users/meeseeksmachine/gists{/gist_id}", "starred_url": "https://api.github.com/users/meeseeksmachine/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/meeseeksmachine/subscriptions", "organizations_url": "https://api.github.com/users/meeseeksmachine/orgs", "repos_url": "https://api.github.com/users/meeseeksmachine/repos", "events_url": "https://api.github.com/users/meeseeksmachine/events{/privacy}", "received_events_url": "https://api.github.com/users/meeseeksmachine/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-06-03T15:16:47Z", "updated_at": "2022-06-06T13:09:24Z", "closed_at": "2022-06-06T13:09:24Z", "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3925", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3925", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3925.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3925.patch", "merged_at": "2022-06-06T13:09:24Z"}, "body": "Backport PR #3906: Force add existing certificates", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3925/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3925/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3924", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3924/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3924/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3924/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3924", "id": 1260035556, "node_id": "PR_kwDOAT0rQs45E2ql", "number": 3924, "title": "Backport PR #3889 on branch 2.x (admin: make user-info table selectable)", "user": {"login": "meeseeksmachine", "id": 39504233, "node_id": "MDQ6VXNlcjM5NTA0MjMz", "avatar_url": "https://avatars.githubusercontent.com/u/39504233?v=4", "gravatar_id": "", "url": "https://api.github.com/users/meeseeksmachine", "html_url": "https://github.com/meeseeksmachine", "followers_url": "https://api.github.com/users/meeseeksmachine/followers", "following_url": "https://api.github.com/users/meeseeksmachine/following{/other_user}", "gists_url": "https://api.github.com/users/meeseeksmachine/gists{/gist_id}", "starred_url": "https://api.github.com/users/meeseeksmachine/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/meeseeksmachine/subscriptions", "organizations_url": "https://api.github.com/users/meeseeksmachine/orgs", "repos_url": "https://api.github.com/users/meeseeksmachine/repos", "events_url": "https://api.github.com/users/meeseeksmachine/events{/privacy}", "received_events_url": "https://api.github.com/users/meeseeksmachine/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-06-03T15:16:30Z", "updated_at": "2022-06-06T13:09:13Z", "closed_at": "2022-06-06T13:09:12Z", "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3924", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3924", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3924.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3924.patch", "merged_at": "2022-06-06T13:09:12Z"}, "body": "Backport PR #3889: admin: make user-info table selectable", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3924/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3924/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3923", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3923/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3923/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3923/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3923", "id": 1260035390, "node_id": "PR_kwDOAT0rQs45E2oQ", "number": 3923, "title": "Backport PR #3837 on branch 2.x (ensure _import_error is set when JUPYTERHUB_SINGLEUSER_APP is unavailable)", "user": {"login": "meeseeksmachine", "id": 39504233, "node_id": "MDQ6VXNlcjM5NTA0MjMz", "avatar_url": "https://avatars.githubusercontent.com/u/39504233?v=4", "gravatar_id": "", "url": "https://api.github.com/users/meeseeksmachine", "html_url": "https://github.com/meeseeksmachine", "followers_url": "https://api.github.com/users/meeseeksmachine/followers", "following_url": "https://api.github.com/users/meeseeksmachine/following{/other_user}", "gists_url": "https://api.github.com/users/meeseeksmachine/gists{/gist_id}", "starred_url": "https://api.github.com/users/meeseeksmachine/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/meeseeksmachine/subscriptions", "organizations_url": "https://api.github.com/users/meeseeksmachine/orgs", "repos_url": "https://api.github.com/users/meeseeksmachine/repos", "events_url": "https://api.github.com/users/meeseeksmachine/events{/privacy}", "received_events_url": "https://api.github.com/users/meeseeksmachine/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-06-03T15:16:21Z", "updated_at": "2022-06-06T13:08:58Z", "closed_at": "2022-06-06T13:08:57Z", "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3923", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3923", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3923.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3923.patch", "merged_at": "2022-06-06T13:08:57Z"}, "body": "Backport PR #3837: ensure _import_error is set when JUPYTERHUB_SINGLEUSER_APP is unavailable", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3923/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3923/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3919", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3919/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3919/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3919/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3919", "id": 1256105840, "node_id": "PR_kwDOAT0rQs443O2p", "number": 3919, "title": "ensure custom template is loaded with jupyter-server notebook extension", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 4197235921, "node_id": "LA_kwDOAT0rQs76LLzR", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/Still%20Needs%20Manual%20Backport", "name": "Still Needs Manual Backport", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-06-01T14:10:10Z", "updated_at": "2022-06-03T15:17:17Z", "closed_at": "2022-06-01T17:29:33Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3919", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3919", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3919.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3919.patch", "merged_at": "2022-06-01T17:29:33Z"}, "body": "our patches to page.html didn't affect nbclassic run with jupyter-srver, which gets its own jinja environment, due to how extensions are set up.\r\n\r\nregression test included.\r\n\r\nWe could _only_ patch `notebook_jinja2_env` when we find it, instead of _also_ patching the base `jinja2_env`.\r\n\r\nHad to shift template-patch to later in initialize, because the extension jinja env doesn't exist until extensions are loaded, which is after init_webapp.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3919/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3919/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3918", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3918/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3918/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3918/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3918", "id": 1254006535, "node_id": "PR_kwDOAT0rQs44v8Tu", "number": 3918, "title": "set default_url via config", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-05-31T15:03:17Z", "updated_at": "2022-06-06T13:58:24Z", "closed_at": "2022-06-01T13:34:55Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3918", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3918", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3918.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3918.patch", "merged_at": "2022-06-01T13:34:55Z"}, "body": "avoids accidental overrides of `@default('default_url')` in subclasses, e.g. SingleUserLabApp by ensuring the env is loaded as _config_ rather than a _default_ in a base class.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3918/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3918/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3912", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3912/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3912/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3912/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3912", "id": 1250756135, "node_id": "I_kwDOAT0rQs5KjQYn", "number": 3912, "title": "Fresh installation on Ubuntu 22.04 doesn't open", "user": {"login": "Bbllaaddee", "id": 73665124, "node_id": "MDQ6VXNlcjczNjY1MTI0", "avatar_url": "https://avatars.githubusercontent.com/u/73665124?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Bbllaaddee", "html_url": "https://github.com/Bbllaaddee", "followers_url": "https://api.github.com/users/Bbllaaddee/followers", "following_url": "https://api.github.com/users/Bbllaaddee/following{/other_user}", "gists_url": "https://api.github.com/users/Bbllaaddee/gists{/gist_id}", "starred_url": "https://api.github.com/users/Bbllaaddee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Bbllaaddee/subscriptions", "organizations_url": "https://api.github.com/users/Bbllaaddee/orgs", "repos_url": "https://api.github.com/users/Bbllaaddee/repos", "events_url": "https://api.github.com/users/Bbllaaddee/events{/privacy}", "received_events_url": "https://api.github.com/users/Bbllaaddee/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-05-27T13:14:38Z", "updated_at": "2022-05-27T18:52:00Z", "closed_at": "2022-05-27T18:52:00Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\n\r\nFresh installation on Ubuntu 22.04 machine gives 404 error while trying to access the hub.\r\nThis happens both using ubuntu repos and pip (this will be the preferred method from now on).\r\nDoing exactly the same on an Arch linux machine gave me a working hub, which can signal a distro-specific error.\r\n\r\n#### Expected behaviour\r\nOpen at least some version of the hub (login page, for example).\r\n\r\n#### Actual behaviour\r\n'Not found' text in the browser. Console output is given in Logs section of the issue.\r\n\r\n### How to reproduce\r\n```shell\r\npython -m venv jupyterhub\r\ncd jupyterhub; source bin/activate\r\npip install wheel jupyterlab jupyterhub\r\njupyterhub\r\n```\r\n\r\n### Your personal set up\r\nInstallation with `pip` and `apt install jupyterhub` give the same result.\r\n\r\n - OS: Ubuntu MATE 22.04\r\n - Version(s): jupyterhub 2.3.0, python 3.10.4, node 16.15.0, npm 8.5.5, configurable-http-proxy 4.5.1\r\n\r\n<details><summary>Full environment</summary>\r\n\r\n```\r\nalembic==1.7.7\r\nanyio==3.5.0\r\nargon2-cffi==21.3.0\r\nargon2-cffi-bindings==21.2.0\r\nasttokens==2.0.5\r\nasync-generator==1.10\r\nattrs==21.4.0\r\nBabel==2.10.1\r\nbackcall==0.2.0\r\nbeautifulsoup4==4.11.1\r\nbleach==5.0.0\r\ncertifi==2021.10.8\r\ncertipy==0.1.3\r\ncffi==1.15.0\r\ncharset-normalizer==2.0.12\r\ncryptography==37.0.2\r\ndebugpy==1.6.0\r\ndecorator==5.1.1\r\ndefusedxml==0.7.1\r\nentrypoints==0.4\r\nexecuting==0.8.3\r\nfastjsonschema==2.15.3\r\ngreenlet==1.1.2\r\nidna==3.3\r\nipykernel==6.13.0\r\nipython==8.3.0\r\nipython-genutils==0.2.0\r\nipywidgets==7.7.0\r\njedi==0.18.1\r\nJinja2==3.1.2\r\njson5==0.9.8\r\njsonschema==4.5.1\r\njupyter==1.0.0\r\njupyter-client==7.3.1\r\njupyter-console==6.4.3\r\njupyter-core==4.10.0\r\njupyter-server==1.17.0\r\njupyter-telemetry==0.1.0\r\njupyterhub==2.3.0\r\njupyterlab==3.4.0\r\njupyterlab-pygments==0.2.2\r\njupyterlab-server==2.13.0\r\njupyterlab-widgets==1.1.0\r\nMako==1.2.0\r\nMarkupSafe==2.1.1\r\nmatplotlib-inline==0.1.3\r\nmistune==0.8.4\r\nnbclassic==0.3.7\r\nnbclient==0.6.3\r\nnbconvert==6.5.0\r\nnbformat==5.4.0\r\nnest-asyncio==1.5.5\r\nnotebook==6.4.11\r\nnotebook-shim==0.1.0\r\noauthlib==3.2.0\r\npackaging==21.3\r\npamela==1.0.0\r\npandocfilters==1.5.0\r\nparso==0.8.3\r\npexpect==4.8.0\r\npickleshare==0.7.5\r\nprometheus-client==0.14.1\r\nprompt-toolkit==3.0.29\r\npsutil==5.9.0\r\nptyprocess==0.7.0\r\npure-eval==0.2.2\r\npycparser==2.21\r\nPygments==2.12.0\r\npyOpenSSL==22.0.0\r\npyparsing==3.0.8\r\npyrsistent==0.18.1\r\npython-dateutil==2.8.2\r\npython-json-logger==2.0.2\r\npytz==2022.1\r\npyzmq==22.3.0\r\nqtconsole==5.3.0\r\nQtPy==2.1.0\r\nrequests==2.27.1\r\nruamel.yaml==0.17.21\r\nruamel.yaml.clib==0.2.6\r\nSend2Trash==1.8.0\r\nsix==1.16.0\r\nsniffio==1.2.0\r\nsoupsieve==2.3.2.post1\r\nSQLAlchemy==1.4.36\r\nstack-data==0.2.0\r\nterminado==0.13.3\r\ntinycss2==1.1.1\r\ntornado==6.1\r\ntraitlets==5.1.1\r\nurllib3==1.26.9\r\nwcwidth==0.2.5\r\nwebencodings==0.5.1\r\nwebsocket-client==1.3.2\r\nwidgetsnbextension==3.6.0\r\n```\r\n\r\n</details>\r\n\r\n<details><summary>Configuration</summary>\r\nDefault config file (works on Arch linux)\r\n</details>\r\n\r\n<details><summary>Logs</summary>\r\n\r\n```\r\nboris@bombrix in ~/tmp/jupyterhub via \ud83d\udc0d v3.10.4 (jupyterhub) \u279c jupyterhub --debug\r\n[D 2022-05-16 18:41:55.359 JupyterHub application:731] Looking for jupyterhub_config in /home/boris/tmp/jupyterhub\r\n[I 2022-05-16 18:41:55.359 JupyterHub app:2769] Running JupyterHub version 2.3.0\r\n[I 2022-05-16 18:41:55.360 JupyterHub app:2799] Using Authenticator: jupyterhub.auth.PAMAuthenticator-2.3.0\r\n[I 2022-05-16 18:41:55.360 JupyterHub app:2799] Using Spawner: jupyterhub.spawner.LocalProcessSpawner-2.3.0\r\n[I 2022-05-16 18:41:55.360 JupyterHub app:2799] Using Proxy: jupyterhub.proxy.ConfigurableHTTPProxy-2.3.0\r\n[D 2022-05-16 18:41:55.361 JupyterHub app:2730] Could not load pycurl: No module named 'pycurl'\r\n    pycurl is recommended if you have a large number of users.\r\n[I 2022-05-16 18:41:55.361 JupyterHub app:1606] Loading cookie_secret from /home/boris/tmp/jupyterhub/jupyterhub_cookie_secret\r\n[D 2022-05-16 18:41:55.362 JupyterHub app:1773] Connecting to db: sqlite:///jupyterhub.sqlite\r\n[D 2022-05-16 18:41:55.378 JupyterHub orm:955] database schema version found: 833da8570507\r\n[I 2022-05-16 18:41:55.426 JupyterHub proxy:496] Generating new CONFIGPROXY_AUTH_TOKEN\r\n[D 2022-05-16 18:41:55.427 JupyterHub app:2022] Loading roles into database\r\n[I 2022-05-16 18:41:55.436 JupyterHub app:1924] Not using allowed_users. Any authenticated user will be allowed.\r\n[D 2022-05-16 18:41:55.441 JupyterHub app:2281] Purging expired APITokens\r\n[D 2022-05-16 18:41:55.444 JupyterHub app:2281] Purging expired OAuthCodes\r\n[D 2022-05-16 18:41:55.446 JupyterHub app:2114] Loading role assignments from config\r\n[D 2022-05-16 18:41:55.456 JupyterHub app:2427] Initializing spawners\r\n[D 2022-05-16 18:41:55.460 JupyterHub app:2558] Loaded users:\r\n    \r\n[I 2022-05-16 18:41:55.460 JupyterHub app:2838] Initialized 0 spawners in 0.004 seconds\r\n[W 2022-05-16 18:41:55.461 JupyterHub proxy:565] Found proxy pid file: /home/boris/tmp/jupyterhub/jupyterhub-proxy.pid\r\n[W 2022-05-16 18:41:55.462 JupyterHub proxy:582] Proxy still running at pid=138817\r\n[W 2022-05-16 18:41:56.463 JupyterHub proxy:602] Stopped proxy at pid=138817\r\n[D 2022-05-16 18:41:56.463 JupyterHub proxy:618] Removing proxy pid file jupyterhub-proxy.pid\r\n[W 2022-05-16 18:41:56.465 JupyterHub proxy:687] Running JupyterHub without SSL.  I hope there is SSL termination happening somewhere else...\r\n[I 2022-05-16 18:41:56.465 JupyterHub proxy:691] Starting proxy @ http://:8000\r\n[D 2022-05-16 18:41:56.465 JupyterHub proxy:692] Proxy cmd: ['configurable-http-proxy', '--ip', '', '--port', '8000', '--api-ip', '127.0.0.1', '--api-port', '8001', '--error-target', 'http://127.0.0.1:8081/hub/error']\r\n[D 2022-05-16 18:41:56.467 JupyterHub proxy:610] Writing proxy pid file: jupyterhub-proxy.pid\r\n18:41:56.647 [ConfigProxy] info: Proxying http://*:8000 to (no default)\r\n18:41:56.649 [ConfigProxy] info: Proxy API at http://127.0.0.1:8001/api/routes\r\n18:42:16.003 [ConfigProxy] error: 404 GET / \r\n18:42:16.036 [ConfigProxy] error: Failed to get custom error page: Error: connect ECONNREFUSED 127.0.0.1:8081\r\n    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1187:16) {\r\n  errno: -111,\r\n  code: 'ECONNREFUSED',\r\n  syscall: 'connect',\r\n  address: '127.0.0.1',\r\n  port: 8081\r\n}\r\n18:42:16.198 [ConfigProxy] error: 404 GET /favicon.ico \r\n18:42:16.202 [ConfigProxy] error: Failed to get custom error page: Error: connect ECONNREFUSED 127.0.0.1:8081\r\n    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1187:16) {\r\n  errno: -111,\r\n  code: 'ECONNREFUSED',\r\n  syscall: 'connect',\r\n  address: '127.0.0.1',\r\n  port: 8081\r\n}\r\n```\r\n\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3912/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3912/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3910", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3910/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3910/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3910/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3910", "id": 1248145765, "node_id": "PR_kwDOAT0rQs44cr6T", "number": 3910, "title": "use equality to filter token prefixes", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-05-25T14:00:03Z", "updated_at": "2022-06-06T13:58:27Z", "closed_at": "2022-06-01T13:35:45Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3910", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3910", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3910.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3910.patch", "merged_at": "2022-06-01T13:35:45Z"}, "body": "otherwise, index isn't used (closes #3070)\r\n\r\nnote: this means changing the token prefix size requires revoking all tokens, where before only _increasing_ the token prefix size required doing that.\r\n\r\nI ran a test with `sqlite:///:memory:` showing clear performance consequences:\r\n\r\n![visualization](https://user-images.githubusercontent.com/151929/170279598-4dd8a0f3-0d44-4c7c-84f4-af0d76637439.png)\r\n\r\nwhere using the index, lookup stays around 150\u00b5s, it rapidly increased beyond 1ms per token lookup with the current scheme if you have at least ~10k tokens.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3910/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3910/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3908", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3908/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3908/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3908/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3908", "id": 1247828840, "node_id": "PR_kwDOAT0rQs44bnV7", "number": 3908, "title": "let errors raised in an auth_state_hook halt spawn", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-05-25T09:36:49Z", "updated_at": "2022-05-25T14:01:04Z", "closed_at": "2022-05-25T10:43:40Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3908", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3908", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3908.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3908.patch", "merged_at": "2022-05-25T10:43:40Z"}, "body": "hooks prior to start should raise and stop the whole thing\r\n\r\nonly hooks during cleanup need to be passed over\r\n\r\ncloses #3134", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3908/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3908/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3906", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3906/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3906/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3906/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3906", "id": 1247480658, "node_id": "PR_kwDOAT0rQs44aarI", "number": 3906, "title": "Force add existing certificates", "user": {"login": "fabianbaier", "id": 10104582, "node_id": "MDQ6VXNlcjEwMTA0NTgy", "avatar_url": "https://avatars.githubusercontent.com/u/10104582?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fabianbaier", "html_url": "https://github.com/fabianbaier", "followers_url": "https://api.github.com/users/fabianbaier/followers", "following_url": "https://api.github.com/users/fabianbaier/following{/other_user}", "gists_url": "https://api.github.com/users/fabianbaier/gists{/gist_id}", "starred_url": "https://api.github.com/users/fabianbaier/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fabianbaier/subscriptions", "organizations_url": "https://api.github.com/users/fabianbaier/orgs", "repos_url": "https://api.github.com/users/fabianbaier/repos", "events_url": "https://api.github.com/users/fabianbaier/events{/privacy}", "received_events_url": "https://api.github.com/users/fabianbaier/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2022-05-25T05:03:37Z", "updated_at": "2022-06-06T13:58:34Z", "closed_at": "2022-05-25T09:23:58Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3906", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3906", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3906.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3906.patch", "merged_at": "2022-05-25T09:23:58Z"}, "body": "When persisting certificates in e.g. a PV hub restarts throw a `certipy.certipy.CertExistsError` complaining the certificate exists already, instead of overwriting it and using the \"old\" one.\r\n\r\nI think related issues have been around for a while (see e.g. https://discourse.jupyter.org/t/unable-to-combine-recreate-internal-ssl-false-with-external-ssl-authorities/10897)\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3906/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3906/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3905", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3905/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3905/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3905/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3905", "id": 1246765686, "node_id": "I_kwDOAT0rQs5KUCJ2", "number": 3905, "title": "Bump moment.js (CVE-2022-24785 , not affecting hub).", "user": {"login": "Carreau", "id": 335567, "node_id": "MDQ6VXNlcjMzNTU2Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/335567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Carreau", "html_url": "https://github.com/Carreau", "followers_url": "https://api.github.com/users/Carreau/followers", "following_url": "https://api.github.com/users/Carreau/following{/other_user}", "gists_url": "https://api.github.com/users/Carreau/gists{/gist_id}", "starred_url": "https://api.github.com/users/Carreau/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Carreau/subscriptions", "organizations_url": "https://api.github.com/users/Carreau/orgs", "repos_url": "https://api.github.com/users/Carreau/repos", "events_url": "https://api.github.com/users/Carreau/events{/privacy}", "received_events_url": "https://api.github.com/users/Carreau/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-05-24T15:50:40Z", "updated_at": "2022-05-25T10:39:34Z", "closed_at": "2022-05-25T10:39:34Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "As seen on https://github.com/jupyter/security/issues/35 ([CVE-2022-24785](https://github.com/advisories/GHSA-8hfj-j24r-96c4), not affecting hub).\r\n\r\nIt might be unclear to teams deploying jupyterhub if moment.js is used client or server side, but it might still be a good idea to bump the minimum version just to make sure there is no false-positive flags. \r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3905/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3905/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3904", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3904/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3904/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3904/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3904", "id": 1244385500, "node_id": "PR_kwDOAT0rQs44QI6o", "number": 3904, "title": "Escape named server name", "user": {"login": "manics", "id": 1644105, "node_id": "MDQ6VXNlcjE2NDQxMDU=", "avatar_url": "https://avatars.githubusercontent.com/u/1644105?v=4", "gravatar_id": "", "url": "https://api.github.com/users/manics", "html_url": "https://github.com/manics", "followers_url": "https://api.github.com/users/manics/followers", "following_url": "https://api.github.com/users/manics/following{/other_user}", "gists_url": "https://api.github.com/users/manics/gists{/gist_id}", "starred_url": "https://api.github.com/users/manics/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/manics/subscriptions", "organizations_url": "https://api.github.com/users/manics/orgs", "repos_url": "https://api.github.com/users/manics/repos", "events_url": "https://api.github.com/users/manics/events{/privacy}", "received_events_url": "https://api.github.com/users/manics/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2022-05-22T22:31:59Z", "updated_at": "2022-06-09T13:33:51Z", "closed_at": "2022-06-03T15:09:58Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3904", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3904", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3904.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3904.patch", "merged_at": "2022-06-03T15:09:58Z"}, "body": "This escapes the server name when used in paths, but keeps the original server name in the database.\r\n\r\nCloses https://github.com/jupyterhub/jupyterhub/issues/3144\r\n\r\nAn alternative to this implementation is to require that server names are url-safe and error if they're not, i.e. the client UI would be responsible for converting the name submitted by a server to it's URL safe form before POSTing it to JupyterHub. However this leads to more complications since if the client encodes the name before submission (e.g. in javascript), then it'll be encoded a second time when it's sent in the URL request, and the JupyterHub database will always store an encoded name instead of the original.\r\n\r\n- [x] This works in manual testing, ~but needs an automated test~ I've added some tests, though I couldn't work out how to trigger the `'/' in server_name` error in a test. I can trigger it in the browser, but if I add to the existing test it's accepted- is there a Mock getting in the way somewhere?", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3904/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3904/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3901", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3901/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3901/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3901/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3901", "id": 1235550368, "node_id": "I_kwDOAT0rQs5JpQCg", "number": 3901, "title": "Admin page not displaying named servers when they are stopped", "user": {"login": "tmtabor", "id": 9056964, "node_id": "MDQ6VXNlcjkwNTY5NjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/9056964?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmtabor", "html_url": "https://github.com/tmtabor", "followers_url": "https://api.github.com/users/tmtabor/followers", "following_url": "https://api.github.com/users/tmtabor/following{/other_user}", "gists_url": "https://api.github.com/users/tmtabor/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmtabor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmtabor/subscriptions", "organizations_url": "https://api.github.com/users/tmtabor/orgs", "repos_url": "https://api.github.com/users/tmtabor/repos", "events_url": "https://api.github.com/users/tmtabor/events{/privacy}", "received_events_url": "https://api.github.com/users/tmtabor/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-05-13T18:26:03Z", "updated_at": "2022-08-02T12:31:15Z", "closed_at": "2022-08-02T12:31:15Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Bug description\r\n\r\nThe admin page only displays named servers that are actively running. Stopped servers are not displayed at all. This is a regression when compared to JupyterHub 1.x's functionality.\r\n\r\n#### Expected behaviour\r\n\r\nI would expect the admin page to list all servers on the hub, including named servers, regardless of whether they are stopped or running.\r\n\r\n#### Actual behaviour\r\n\r\nThe admin page displays each user's default server regardless of status (stopped or running), but only displays named servers if they are running.\r\n\r\n### How to reproduce\r\n\r\n1. Configure JupyterHub to use named servers.\r\n2. Create a named server and run it.\r\n3. Log in as a different (admin) account and navigate to the admin page. If the named server is still running, you'll see it listed,\r\n4. Shut down the named server. It will disappear once it is stopped.\r\n\r\n### Your personal set up\r\n\r\nI am running JupyterHub 2.3.0, installed from PIP. Using Python 3.9 (anaconda). The operating system is macOS 10.15.7.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3901/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3901/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3900", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3900/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3900/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3900/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3900", "id": 1235190830, "node_id": "I_kwDOAT0rQs5Jn4Qu", "number": 3900, "title": "\"Spawn Page\" on admin page does not work with default server", "user": {"login": "benz0li", "id": 20233085, "node_id": "MDQ6VXNlcjIwMjMzMDg1", "avatar_url": "https://avatars.githubusercontent.com/u/20233085?v=4", "gravatar_id": "", "url": "https://api.github.com/users/benz0li", "html_url": "https://github.com/benz0li", "followers_url": "https://api.github.com/users/benz0li/followers", "following_url": "https://api.github.com/users/benz0li/following{/other_user}", "gists_url": "https://api.github.com/users/benz0li/gists{/gist_id}", "starred_url": "https://api.github.com/users/benz0li/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/benz0li/subscriptions", "organizations_url": "https://api.github.com/users/benz0li/orgs", "repos_url": "https://api.github.com/users/benz0li/repos", "events_url": "https://api.github.com/users/benz0li/events{/privacy}", "received_events_url": "https://api.github.com/users/benz0li/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-05-13T12:38:50Z", "updated_at": "2022-06-08T12:51:26Z", "closed_at": "2022-06-08T12:51:26Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\n\r\nDefault server: Clicking \"Spawn Page\" at `/hub/admin#/` points to `/spawn/<user>undefined`.\r\n\r\n#### Expected behaviour\r\n\r\nDefault server: Clicking \"Spawn Page\" at `/hub/admin#/` points to `/spawn/<user>`.\r\n\r\n#### Actual behaviour\r\n\r\nSee bug description.\r\n\r\nWorks as expected for named server, i.e. link points to `/spawn/<user>/<server>`.\r\n\r\n### How to reproduce\r\n\r\n1. Go to `/hub/admin#/`\r\n1. Click on \"Spawn Page\"\r\n\r\n### Your personal set up\r\n\r\nDocker image [jupyterhub/jupyterhub:2.3](https://hub.docker.com/r/jupyterhub/jupyterhub)\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3900/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3900/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3897", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3897/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3897/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3897/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3897", "id": 1233241502, "node_id": "I_kwDOAT0rQs5JgcWe", "number": 3897, "title": "Setting JupyterHub.admin_access does not change anything", "user": {"login": "tlehmann7", "id": 32707823, "node_id": "MDQ6VXNlcjMyNzA3ODIz", "avatar_url": "https://avatars.githubusercontent.com/u/32707823?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tlehmann7", "html_url": "https://github.com/tlehmann7", "followers_url": "https://api.github.com/users/tlehmann7/followers", "following_url": "https://api.github.com/users/tlehmann7/following{/other_user}", "gists_url": "https://api.github.com/users/tlehmann7/gists{/gist_id}", "starred_url": "https://api.github.com/users/tlehmann7/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tlehmann7/subscriptions", "organizations_url": "https://api.github.com/users/tlehmann7/orgs", "repos_url": "https://api.github.com/users/tlehmann7/repos", "events_url": "https://api.github.com/users/tlehmann7/events{/privacy}", "received_events_url": "https://api.github.com/users/tlehmann7/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-05-11T22:25:26Z", "updated_at": "2022-05-13T09:53:58Z", "closed_at": "2022-05-13T09:53:58Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\nBy default, accessing other user Servers should be disabled. This is not the case. If I comment out the line in the config, so that it is set to False, its still possible to access user servers. Yes, I saved the config and restarted the Hub. Standard Installation without changes. \r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\n\r\n#### Expected behaviour\r\nAccess to other servers is denied\r\n<!-- Tell us what you thought would happen. -->\r\n\r\n#### Actual behaviour\r\nAccess is always possible if you are admin\r\n<!-- Tell us what actually happens. -->\r\n\r\n### How to reproduce\r\ntry to set the setting in the config\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\n1. Go to '...'\r\n2. Click on '....'\r\n3. Scroll down to '....'\r\n4. See error\r\n\r\n### Your personal set up\r\nStandard Installation using QuickStart. Ubuntu 20.04 LTS VM, 16 GB Ram, 8 vCPUs. Using default spawner and authenticator. Version 2.3.0. If you need more information, please ask.\r\n\r\n<details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\nalembic==1.7.7\r\nanyio==3.5.0\r\nargon2-cffi==21.3.0\r\nargon2-cffi-bindings==21.2.0\r\nasttokens==2.0.5\r\nasync-generator==1.10\r\nattrs==19.3.0\r\nAutomat==0.8.0\r\nBabel==2.10.1\r\nbackcall==0.2.0\r\nbeautifulsoup4==4.11.1\r\nbleach==5.0.0\r\nblinker==1.4\r\ncertifi==2019.11.28\r\ncertipy==0.1.3\r\ncffi==1.15.0\r\nchardet==3.0.4\r\nClick==7.0\r\ncloud-init==22.1\r\ncolorama==0.4.3\r\ncommand-not-found==0.3\r\nconfigobj==5.0.6\r\nconstantly==15.1.0\r\ncryptography==2.8\r\ndbus-python==1.2.16\r\ndebugpy==1.6.0\r\ndecorator==5.1.1\r\ndefusedxml==0.7.1\r\ndistro==1.4.0\r\ndistro-info===0.23ubuntu1\r\nentrypoints==0.3\r\nexecuting==0.8.3\r\nfastjsonschema==2.15.3\r\ngreenlet==1.1.2\r\nhttplib2==0.14.0\r\nhyperlink==19.0.0\r\nidna==2.8\r\nimportlib-metadata==4.11.3\r\nimportlib-resources==5.7.1\r\nincremental==16.10.1\r\nipykernel==6.13.0\r\nipython==8.3.0\r\nipython-genutils==0.2.0\r\njedi==0.18.1\r\nJinja2==3.1.2\r\njson5==0.9.8\r\njsonpatch==1.22\r\njsonpointer==2.0\r\njsonschema==3.2.0\r\njupyter-client==7.3.1\r\njupyter-core==4.10.0\r\njupyter-server==1.17.0\r\njupyter-telemetry==0.1.0\r\njupyterhub==2.3.0\r\njupyterlab==3.4.0\r\njupyterlab-pygments==0.2.2\r\njupyterlab-server==2.13.0\r\nkeyring==18.0.1\r\nlanguage-selector==0.1\r\nlaunchpadlib==1.10.13\r\nlazr.restfulclient==0.14.2\r\nlazr.uri==1.0.3\r\nMako==1.2.0\r\nMarkupSafe==2.1.1\r\nmatplotlib-inline==0.1.3\r\nmistune==0.8.4\r\nmore-itertools==4.2.0\r\nnbclassic==0.3.7\r\nnbclient==0.6.3\r\nnbconvert==6.5.0\r\nnbformat==5.4.0\r\nnest-asyncio==1.5.5\r\nnetifaces==0.10.4\r\nnotebook==6.4.11\r\nnotebook-shim==0.1.0\r\noauthlib==3.1.0\r\npackaging==21.3\r\npamela==1.0.0\r\npandocfilters==1.5.0\r\nparso==0.8.3\r\npexpect==4.6.0\r\npickleshare==0.7.5\r\nprometheus-client==0.14.1\r\nprompt-toolkit==3.0.29\r\npsutil==5.9.0\r\nptyprocess==0.7.0\r\npure-eval==0.2.2\r\npyasn1==0.4.2\r\npyasn1-modules==0.2.1\r\npycparser==2.21\r\nPygments==2.12.0\r\nPyGObject==3.36.0\r\nPyHamcrest==1.9.0\r\nPyJWT==1.7.1\r\npymacaroons==0.13.0\r\nPyNaCl==1.3.0\r\npyOpenSSL==19.0.0\r\npyparsing==3.0.9\r\npyrsistent==0.15.5\r\npyserial==3.4\r\npython-apt==2.0.0+ubuntu0.20.4.7\r\npython-dateutil==2.8.2\r\npython-debian===0.1.36ubuntu1\r\npython-json-logger==2.0.2\r\npytz==2022.1\r\nPyYAML==5.3.1\r\npyzmq==22.3.0\r\nrequests==2.22.0\r\nrequests-unixsocket==0.2.0\r\nruamel.yaml==0.17.21\r\nruamel.yaml.clib==0.2.6\r\nSecretStorage==2.3.1\r\nSend2Trash==1.8.0\r\nservice-identity==18.1.0\r\nsimplejson==3.16.0\r\nsix==1.14.0\r\nsniffio==1.2.0\r\nsos==4.3\r\nsoupsieve==2.3.2.post1\r\nSQLAlchemy==1.4.36\r\nssh-import-id==5.10\r\nstack-data==0.2.0\r\nsystemd-python==234\r\nterminado==0.13.3\r\ntinycss2==1.1.1\r\ntornado==6.1\r\ntraitlets==5.2.0\r\nTwisted==18.9.0\r\nubuntu-advantage-tools==27.7\r\nufw==0.36\r\nunattended-upgrades==0.1\r\nurllib3==1.25.8\r\nwadllib==1.3.3\r\nwcwidth==0.2.5\r\nwebencodings==0.5.1\r\nwebsocket-client==1.3.2\r\nzipp==3.8.0\r\nzope.interface==4.7.1\r\n```\r\n</details>\r\n\r\n<details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```python\r\n# c.LocalAuthenticator.create_system_users = True\r\nc.JupyterHub.admin_access = False\r\nc.Authenticator.admin_users = {'tim'}\r\n```\r\n</details>\r\n\r\n<details><summary>Logs</summary>\r\n<!--\r\nErrors are often logged by jupytehub. How you get logs depends on your deployment.\r\nWith kubernetes it might be:\r\n\r\n    kubectl get pod # hub pod name starts with hub...\r\n    kubectl logs hub-...\r\n    # or for a single-user server\r\n    kubectl logs jupyter-username\r\n\r\nOr the-littlest-jupyterhub:\r\n\r\n    journalctl -u jupyterhub\r\n    # or for a single-user server\r\n    journalctl -u jupyter-username\r\n-->\r\n\r\n```\r\n# paste relevant logs here, if any\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3897/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3897/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3889", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3889/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3889/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3889/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3889", "id": 1227272889, "node_id": "PR_kwDOAT0rQs43YpCK", "number": 3889, "title": "admin: make user-info table selectable", "user": {"login": "johnkpark", "id": 12725384, "node_id": "MDQ6VXNlcjEyNzI1Mzg0", "avatar_url": "https://avatars.githubusercontent.com/u/12725384?v=4", "gravatar_id": "", "url": "https://api.github.com/users/johnkpark", "html_url": "https://github.com/johnkpark", "followers_url": "https://api.github.com/users/johnkpark/followers", "following_url": "https://api.github.com/users/johnkpark/following{/other_user}", "gists_url": "https://api.github.com/users/johnkpark/gists{/gist_id}", "starred_url": "https://api.github.com/users/johnkpark/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/johnkpark/subscriptions", "organizations_url": "https://api.github.com/users/johnkpark/orgs", "repos_url": "https://api.github.com/users/johnkpark/repos", "events_url": "https://api.github.com/users/johnkpark/events{/privacy}", "received_events_url": "https://api.github.com/users/johnkpark/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2022-05-05T23:31:47Z", "updated_at": "2022-06-06T13:58:35Z", "closed_at": "2022-05-10T08:21:06Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3889", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3889", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3889.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3889.patch", "merged_at": "2022-05-10T08:21:06Z"}, "body": "<img width=\"1092\" alt=\"Screen Shot 2022-05-05 at 9 48 12 AM\" src=\"https://user-images.githubusercontent.com/12725384/167043226-9650ed29-0aad-4744-8599-0e9e38073234.png\">\r\n\r\n`admin-table-head` class sets `user-select` to `none`, which makes text inside the table un-selectable. This is inconvenient when you need to copy some properties while debugging.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3889/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3889/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3886", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3886/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3886/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3886/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3886", "id": 1226518375, "node_id": "PR_kwDOAT0rQs43WLRV", "number": 3886, "title": "Cleanup everything on API shutdown", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-05-05T10:56:13Z", "updated_at": "2022-05-06T13:54:33Z", "closed_at": "2022-05-05T19:16:44Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3886", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3886", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3886.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3886.patch", "merged_at": "2022-05-05T19:16:43Z"}, "body": "`app.stop` triggers full cleanup and stopping of the event loop\r\n\r\ncloses #3881", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3886/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3886/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3881", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3881/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3881/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3881/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3881", "id": 1221879347, "node_id": "I_kwDOAT0rQs5I1GYz", "number": 3881, "title": "API shutdown doesn't call cleanup", "user": {"login": "manics", "id": 1644105, "node_id": "MDQ6VXNlcjE2NDQxMDU=", "avatar_url": "https://avatars.githubusercontent.com/u/1644105?v=4", "gravatar_id": "", "url": "https://api.github.com/users/manics", "html_url": "https://github.com/manics", "followers_url": "https://api.github.com/users/manics/followers", "following_url": "https://api.github.com/users/manics/following{/other_user}", "gists_url": "https://api.github.com/users/manics/gists{/gist_id}", "starred_url": "https://api.github.com/users/manics/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/manics/subscriptions", "organizations_url": "https://api.github.com/users/manics/orgs", "repos_url": "https://api.github.com/users/manics/repos", "events_url": "https://api.github.com/users/manics/events{/privacy}", "received_events_url": "https://api.github.com/users/manics/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-04-30T17:20:25Z", "updated_at": "2022-05-05T19:16:43Z", "closed_at": "2022-05-05T19:16:43Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "### Bug description\r\n\r\nIf a POST is sent to the shutdown API endpoint http://localhost:8000/hub/api/shutdown, either through the shutdown button on the admin page, or by making a request to the API with curl, `cleanup()`:\r\nhttps://github.com/jupyterhub/jupyterhub/blob/107dc02fd0698eaff11125829a947863275f32ef/jupyterhub/app.py#L2871-L2872\r\nis not called\r\n\r\n#### Expected behaviour\r\n\r\nThe hub should shut down gracefully by calling `cleanup()`\r\n\r\n#### Actual behaviour\r\n\r\nIt seems to shutdown straightaway.\r\n\r\n### How to reproduce\r\n\r\nUsing the latest `main` Docker Hub image\r\n```sh\r\npodman pull jupyterhub/jupyterhub:main\r\npodman run -it --rm -p 8000:8000 jupyterhub/jupyterhub:main bash\r\n```\r\nIn the container run jupyterhub:\r\n```\r\nroot@4a418a63bfba:/srv/jupyterhub# jupyterhub --JupyterHub.authenticator_class=dummy --Authenticator.admin_users=demo --debug\r\n```\r\nGo to http://localhost:8000/hub/admin#/ , login as `demo`, click `Shutdown Hub`. Logs:\r\n```\r\n[D 2022-04-30 17:14:01.292 JupyterHub scopes:792] Checking access via scope shutdown\r\n[D 2022-04-30 17:14:01.292 JupyterHub scopes:606] Unrestricted access to /hub/api/shutdown via shutdown\r\n[I 2022-04-30 17:14:01.293 JupyterHub log:186] 202 POST /hub/api/shutdown (demo@::ffff:10.0.2.100) 6.24ms\r\nroot@4a418a63bfba:/srv/jupyterhub#\r\n```\r\n`configurable-http-proxy` is still running:\r\n```\r\nroot@4a418a63bfba:/srv/jupyterhub# ps auwx\r\nUSER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\r\nroot           1  0.0  0.0   7244  3640 pts/0    Ss   17:13   0:00 bash\r\nroot           8  1.4  0.2 585092 45988 ?        Ssl  17:13   0:00 node /usr/local/bin/configurable-http-proxy --ip  --port 8000 --api-ip 127.0.0.1 --api-port 8001 --error-target http://12\r\nroot          15  0.0  0.0   8884  3232 pts/0    R+   17:14   0:00 ps auwx\r\n```\r\nIn contrast if the hub is stopped with `<Ctrl-C>` in the terminal:\r\n```\r\n^C[C 2022-04-30 17:16:34.920 JupyterHub app:3239] Received signal SIGINT, initiating shutdown...\r\n[I 2022-04-30 17:16:34.921 JupyterHub app:2883] Cleaning up single-user servers...\r\n[D 2022-04-30 17:16:34.922 JupyterHub app:2895] Stopping proxy\r\n[I 2022-04-30 17:16:34.922 JupyterHub proxy:750] Cleaning up proxy[8]...\r\n[D 2022-04-30 17:16:34.923 JupyterHub proxy:607] Removing proxy pid file jupyterhub-proxy.pid\r\n17:16:34.924 [ConfigProxy] warn: Terminated\r\n[I 2022-04-30 17:16:34.925 JupyterHub app:2915] ...done\r\nroot@9f02d163f208:/srv/jupyterhub#\r\n```\r\n```\r\nroot@9f02d163f208:/srv/jupyterhub# ps auwx\r\nUSER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\r\nroot           1  0.0  0.0   7244  3788 pts/0    Ss   17:15   0:00 bash\r\nroot          15  0.0  0.0   8884  3212 pts/0    R+   17:16   0:00 ps auwx\r\n```\r\n\r\nThis is the backend part of the bug in https://github.com/jupyterhub/jupyterhub/issues/3880", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3881/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3881/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3876", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3876/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3876/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3876/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3876", "id": 1218598764, "node_id": "PR_kwDOAT0rQs428I3g", "number": 3876, "title": "don't confuse :// in next_url query params for a redirect hostname", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-04-28T11:37:18Z", "updated_at": "2022-04-29T11:17:43Z", "closed_at": "2022-04-29T10:13:22Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3876", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3876", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3876.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3876.patch", "merged_at": "2022-04-29T10:13:21Z"}, "body": "closes #3014\r\n\r\nThese query params should be url-encoded (https://github.com/jupyterhub/nbgitpuller/issues/118), but we still shouldn't be making the wrong assumptions about when a hostname is specified", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3876/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3876/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3870", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3870/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3870/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3870/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3870", "id": 1207601034, "node_id": "I_kwDOAT0rQs5H-oeK", "number": 3870, "title": "Version 2.2.0 redirect issue with proxy", "user": {"login": "keith6014", "id": 24735116, "node_id": "MDQ6VXNlcjI0NzM1MTE2", "avatar_url": "https://avatars.githubusercontent.com/u/24735116?v=4", "gravatar_id": "", "url": "https://api.github.com/users/keith6014", "html_url": "https://github.com/keith6014", "followers_url": "https://api.github.com/users/keith6014/followers", "following_url": "https://api.github.com/users/keith6014/following{/other_user}", "gists_url": "https://api.github.com/users/keith6014/gists{/gist_id}", "starred_url": "https://api.github.com/users/keith6014/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/keith6014/subscriptions", "organizations_url": "https://api.github.com/users/keith6014/orgs", "repos_url": "https://api.github.com/users/keith6014/repos", "events_url": "https://api.github.com/users/keith6014/events{/privacy}", "received_events_url": "https://api.github.com/users/keith6014/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-04-19T01:11:17Z", "updated_at": "2022-04-19T20:01:13Z", "closed_at": "2022-04-19T20:01:13Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n\r\nAble to authenticate fine with proxy (nginx). In the jupyterhub-logs I see\r\nAuthenticated with token <APIToken...>\r\n\r\nThen I see\r\n[SingleUserLabApp log:189] 302 GET /user/USER/oauth_callback?code=[secret]&state=[secret] -> /user/USER/lab? \r\n\r\nStarting from 2.2.0 release when using remote_user plugin (https://github.com/cwaldbieser/jhub_remote_user_authenticator) web browser is giving a redirect. Was able to confirm in 2.2.2 also. \r\nConfirmed with version 2.1.1, 2.1.0 this problem does not exist. \r\n\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\n\r\n\r\n#### Expected behaviour\r\nI expect to immediate login similar to version 2.1.1 and 2.1.0 \r\n#### Actual behaviour\r\nI get a Sigin prompt on browser (Chrome).", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3870/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3870/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3868", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3868/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3868/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3868/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3868", "id": 1205753894, "node_id": "I_kwDOAT0rQs5H3lgm", "number": 3868, "title": "Admin Interface \"Spawn Page\" and \"Access Server\" button do not include base_url", "user": {"login": "jbaksta", "id": 2792834, "node_id": "MDQ6VXNlcjI3OTI4MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2792834?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jbaksta", "html_url": "https://github.com/jbaksta", "followers_url": "https://api.github.com/users/jbaksta/followers", "following_url": "https://api.github.com/users/jbaksta/following{/other_user}", "gists_url": "https://api.github.com/users/jbaksta/gists{/gist_id}", "starred_url": "https://api.github.com/users/jbaksta/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jbaksta/subscriptions", "organizations_url": "https://api.github.com/users/jbaksta/orgs", "repos_url": "https://api.github.com/users/jbaksta/repos", "events_url": "https://api.github.com/users/jbaksta/events{/privacy}", "received_events_url": "https://api.github.com/users/jbaksta/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2022-04-15T17:39:55Z", "updated_at": "2022-05-05T11:25:04Z", "closed_at": "2022-05-05T11:25:04Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\nI've updated my dev instance of JupyterHub to the latest 'JupyterHub 2.2.2 20220414152639' that was in the conda-forge repos at the time, but noticed that the Spawn Page button doesn't render the link with base_url and therefore gives a 404 message (at least when behind nginx reverse proxy.\r\n\r\n#### Expected behaviour\r\nInclude the base_url in the rendering for the button.\r\n\r\n#### Actual behaviour\r\n\r\n404 page when clicking Spawn Page\r\n\r\n### How to reproduce\r\n\r\n1. Go to 'Admin' page\r\n2. Click on 'Spawn Page' for a user\r\n4. Get 404\r\n\r\n### Your personal set up\r\n\r\nConda installed (conda-forge) JupyterHub and no additional templating on the admin page.\r\n\r\n - OS:\r\n SLES12 SP4 (doesn't matter)\r\n - Version(s):\r\nPython 3.9.12\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3868/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3868/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3866", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3866/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3866/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3866/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3866", "id": 1202980892, "node_id": "I_kwDOAT0rQs5HtAgc", "number": 3866, "title": "Uncaught exception when JupyterHub tries to communicate with SingleUserLabApp on compute node", "user": {"login": "dithwick", "id": 46924962, "node_id": "MDQ6VXNlcjQ2OTI0OTYy", "avatar_url": "https://avatars.githubusercontent.com/u/46924962?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dithwick", "html_url": "https://github.com/dithwick", "followers_url": "https://api.github.com/users/dithwick/followers", "following_url": "https://api.github.com/users/dithwick/following{/other_user}", "gists_url": "https://api.github.com/users/dithwick/gists{/gist_id}", "starred_url": "https://api.github.com/users/dithwick/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dithwick/subscriptions", "organizations_url": "https://api.github.com/users/dithwick/orgs", "repos_url": "https://api.github.com/users/dithwick/repos", "events_url": "https://api.github.com/users/dithwick/events{/privacy}", "received_events_url": "https://api.github.com/users/dithwick/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2022-04-13T08:47:05Z", "updated_at": "2022-05-25T07:20:45Z", "closed_at": "2022-05-25T07:20:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n\r\nbatchspawner-singleuser starts correctly on the compute node and communicates back to the hub to indicate this. JupyterHub shows:\r\n\r\n`Server ready at [/user/username/]`\r\n\r\nand redirects to /user/username/lab?\r\n\r\nbut this then shows a \r\n\r\n```\r\n503 : Service Unavailable\r\nYour server appears to be down. Try restarting it [from the hub]\r\n```\r\n\r\nto the user.\r\n\r\nI originally posted this under the batchspawner (https://github.com/jupyterhub/batchspawner/issues/242) as that is what I'm using but it occurred to me that the bug (if there is one) is more likely to be further up. The networking is dual stack with some nuances (described below) that are likely related to this problem. I'm happy to accept it may also be a configuration issue but since I'm seeing an uncaught exception so I thought I should raise it as a bug.\r\n\r\n#### Expected behaviour\r\n\r\nThe user is presented the JupyterHub session from the compute node.\r\n\r\n#### Actual behaviour\r\n\r\nThe user is presented with a 503 error. The singleuser process on the compute node generates an uncaught exception traceback (see logs) but continues to run until the job is cancelled.\r\n\r\n### How to reproduce\r\n\r\n1. Login to JupyterHub.\r\n2. Select a job profile and click start.\r\n3. Job waits in queue, JupyterHub shows job status to user.\r\n4. Job starts, JupyterHub shows \"waiting to connect\"\r\n5. JupyterHub shows \"Server ready....\"\r\n6. Error shown\r\n\r\n### Your personal set up\r\n\r\n- JupyterHub has been manually installed on the server using miniconda with packages installed from condaforge and pypi.\r\n- Authentication to JupyterHub uses SAML Authenticator from https://github.com/ImperialCollegeLondon/jupyter_saml2authenticator.\r\n- Cluster is running PBSPro.\r\n- Networking is dual stack (ipv4/ipv6) with some complexities:\r\n  - User access to the Hub is over ipv4 and ipv6.\r\n  - Hub connectivity to PBSPro is over ipv4.\r\n  - Communication between the hub and the compute nodes needs to be over ipv6 as only this is routable between the JupyterHub server and compute nodes. However DNS has both ipv4 and ipv6 entries for the compute nodes and when JupyterHub was resolving the IP address of the compute nodes from exechosts regular expression match, it was resolving the ipv4 address. To work around this I wrote a wrapper script around `qstat ` to replace the hostname (in the output from qstat) with the ipv6 address; there is probably a better way of doing this but it seems to work up until I reach the problem being reported.\r\n\r\n - OS: JupyterHub is running on CentOS 7.9, the compute nodes are running RHEL 8.5\r\n - Versions:\r\n    - Python: python                    3.9.7\r\n    - JupyterHub: jupyterhub                2.2.2\r\n    - BatchSpawner: batchspawner              1.1.0\r\n    - wrapspawner               1.0.1\r\n    - jupyter-saml2authenticator 0.1.0.dev0\r\n\r\n<details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\n# packages in environment at /opt/jupyterhub/miniconda/2022-04-10:\r\n#\r\n# Name                    Version                   Build  Channel\r\n_libgcc_mutex             0.1                        main\r\n_openmp_mutex             4.5                       1_gnu\r\nalembic                   1.7.7              pyhd8ed1ab_0    conda-forge\r\nasync_generator           1.10                       py_0    conda-forge\r\nattrs                     21.4.0             pyhd8ed1ab_0    conda-forge\r\nbatchspawner              1.1.0                    pypi_0    pypi\r\nblinker                   1.4                        py_1    conda-forge\r\nbrotlipy                  0.7.0           py39h27cfd23_1003\r\nc-ares                    1.18.1               h7f8727e_0\r\nca-certificates           2021.10.8            ha878542_0    conda-forge\r\ncertifi                   2021.10.8        py39hf3d152e_2    conda-forge\r\ncertipy                   0.1.3                      py_0    conda-forge\r\ncffi                      1.15.0           py39hd667e15_1\r\ncharset-normalizer        2.0.4              pyhd3eb1b0_0\r\nconda                     4.12.0           py39hf3d152e_0    conda-forge\r\nconda-content-trust       0.1.1              pyhd3eb1b0_0\r\nconda-package-handling    1.7.3            py39h27cfd23_1\r\nconfigurable-http-proxy   4.0.1                  node14_0\r\ncryptography              36.0.0           py39h9ce1e76_0\r\ndefusedxml                0.7.1                    pypi_0    pypi\r\nelementpath               2.5.0                    pypi_0    pypi\r\nentrypoints               0.4                pyhd8ed1ab_0    conda-forge\r\nicu                       68.1                 h2531618_0\r\nidna                      3.3                pyhd3eb1b0_0\r\nimportlib-metadata        4.11.3           py39hf3d152e_1    conda-forge\r\nimportlib_resources       5.6.0              pyhd8ed1ab_0    conda-forge\r\njinja2                    3.1.1              pyhd8ed1ab_0    conda-forge\r\njsonschema                4.4.0              pyhd8ed1ab_0    conda-forge\r\njupyter-saml2authenticator 0.1.0.dev0               pypi_0    pypi\r\njupyter_telemetry         0.1.0              pyhd8ed1ab_1    conda-forge\r\njupyterhub                2.2.2              pyhd8ed1ab_1    conda-forge\r\njupyterhub-base           2.2.2              pyhd8ed1ab_1    conda-forge\r\nkrb5                      1.19.2               hac12032_0\r\nld_impl_linux-64          2.35.1               h7274673_9\r\nlibcurl                   7.80.0               h0b77cf5_0\r\nlibedit                   3.1.20210910         h7f8727e_0\r\nlibev                     4.33                 h516909a_1    conda-forge\r\nlibffi                    3.3                  he6710b0_2\r\nlibgcc-ng                 9.3.0               h5101ec6_17\r\nlibgomp                   9.3.0               h5101ec6_17\r\nlibnghttp2                1.46.0               hce63b2e_0\r\nlibssh2                   1.9.0                h1ba5d50_1\r\nlibstdcxx-ng              9.3.0               hd4cf53a_17\r\nlibuv                     1.40.0               h7b6447c_0\r\nmako                      1.2.0              pyhd8ed1ab_1    conda-forge\r\nmarkupsafe                2.0.1            py39h3811e60_0    conda-forge\r\nncurses                   6.3                  h7f8727e_2\r\nnodejs                    14.8.0               hda19d22_0\r\noauthlib                  3.2.0              pyhd8ed1ab_0    conda-forge\r\nopenssl                   1.1.1n               h7f8727e_0\r\npackaging                 21.3               pyhd8ed1ab_0    conda-forge\r\npamela                    1.0.0                      py_0    conda-forge\r\npip                       21.2.4           py39h06a4308_0\r\nprometheus_client         0.14.1             pyhd8ed1ab_0    conda-forge\r\npsutil                    5.8.0            py39h27cfd23_1\r\npycosat                   0.6.3            py39h27cfd23_0\r\npycparser                 2.21               pyhd3eb1b0_0\r\npycurl                    7.44.1           py39h8f2d780_1\r\npyjwt                     2.3.0              pyhd8ed1ab_1    conda-forge\r\npyopenssl                 21.0.0             pyhd3eb1b0_1\r\npyparsing                 3.0.7              pyhd8ed1ab_0    conda-forge\r\npyrsistent                0.18.0           py39heee7806_0\r\npysaml2                   7.1.2                    pypi_0    pypi\r\npysocks                   1.7.1            py39h06a4308_0\r\npython                    3.9.7                h12debd9_1\r\npython-dateutil           2.8.2              pyhd8ed1ab_0    conda-forge\r\npython-json-logger        2.0.1              pyh9f0ad1d_0    conda-forge\r\npython_abi                3.9                      2_cp39    conda-forge\r\npytz                      2022.1                   pypi_0    pypi\r\nreadline                  8.1.2                h7f8727e_1\r\nrequests                  2.27.1             pyhd3eb1b0_0\r\nruamel.yaml               0.16.12          py39h27cfd23_1\r\nruamel.yaml.clib          0.2.6            py39h7f8727e_0\r\nruamel_yaml               0.15.100         py39h27cfd23_0\r\nsetuptools                58.0.4           py39h06a4308_0\r\nsix                       1.16.0             pyhd3eb1b0_0\r\nsqlalchemy                1.3.23           py39h3811e60_0    conda-forge\r\nsqlite                    3.37.0               hc218d9a_0\r\ntk                        8.6.11               h1ccaba5_0\r\ntornado                   6.1              py39h3811e60_1    conda-forge\r\ntqdm                      4.62.3             pyhd3eb1b0_1\r\ntraitlets                 5.1.1              pyhd8ed1ab_0    conda-forge\r\ntzdata                    2021e                hda174b7_0\r\nurllib3                   1.26.7             pyhd3eb1b0_0\r\nwheel                     0.37.1             pyhd3eb1b0_0\r\nwrapspawner               1.0.1                    pypi_0    pypi\r\nxmlschema                 1.10.0                   pypi_0    pypi\r\nxz                        5.2.5                h7b6447c_0\r\nyaml                      0.2.5                h7b6447c_0\r\nzipp                      3.8.0              pyhd8ed1ab_0    conda-forge\r\nzlib                      1.2.11               h7f8727e_4\r\n```\r\n</details>\r\n\r\n<details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```python\r\nc.Application.log_level = 'DEBUG'\r\nc.JupyterHub.cookie_secret_file = '/var/jupyterhub/jupyterhub_cookie_secret'\r\nc.JupyterHub.data_files_path = '/opt/jupyterhub/miniconda/2022-04-10/share/jupyterhub'\r\nc.JupyterHub.db_url = 'sqlite:////var/jupyterhub/jupyterhub.sqlite'\r\nc.ConfigurableHTTPProxy.debug = True\r\nc.JupyterHub.hub_connect_ip = 'hub:ipv6:address'\r\nc.JupyterHub.hub_ip = 'hub:ipv6:address'\r\nc.JupyterHub.ip = ''\r\nc.JupyterHub.log_level = 'DEBUG'\r\nc.ConfigurableHTTPProxy.pid_file = '/var/jupyterhub/jupyterhub-proxy.pid'\r\nc.Spawner.debug = True\r\nc = get_config()\r\nc.JupyterHub.spawner_class = \"wrapspawner.ProfilesSpawner\"\r\nc.Spawner.http_timeout = 6000\r\nc.Spawner.start_timeout = 6000\r\nimport batchspawner\r\nimport batchspawner.api\r\nc.PBSSpawner.batch_script = ''' #!/bin/sh\r\n#PBS -l walltime={runtime}\r\n#PBS -l select=1:ncpus={nprocs}:mem={memory}:ngpus={ngpus}:mpiprocs=1:ompthreads={nprocs}\r\n#PBS -N jupyterhub\r\n#PBS -v {keepvars}\r\n#PBS -q {queue}\r\nexport RELEASE=2022-04-10\r\nexport PATH=/apps/jupyterhub/$RELEASE/bin:/bin:/usr/bin:/sbin:/usr/sbin:/opt/pbs/default/bin:/usr/local/bin\r\nprintenv\r\nset -x\r\necho \"{cmd}\" > $HOME/.jupyterhub-lab.stdout 2>&1\r\ncd $HOME\r\n{cmd} --ip=\"::\"\r\necho $?\r\n'''\r\nc.BatchSpawnerBase.req_nprocs = '4'\r\nc.BatchSpawnerBase.req_runtime = '25:0:0'\r\nc.BatchSpawnerBase.req_memory  = '4gb'\r\nc.BatchSpawnerBase.req_ngpus   = '0'\r\nc.BatchSpawnerBase.req_queue   = 'interactive'\r\nc.BatchSpawnerBase.batch_submit_cmd = '/opt/jupyterhub/pbs/bin/__qsub'\r\nc.BatchSpawnerBase.batch_cancel_cmd = '/opt/jupyterhub/pbs/bin/__qdel {job_id}'\r\nc.BatchSpawnerBase.batch_query_cmd  = '/opt/jupyterhub/pbs/bin/__qstat {job_id}'\r\nc.BatchSpawnerBase.state_exechost_re = 'exec_host = (.+)'\r\nc.BatchSpawnerBase.state_pending_re = 'job_state = [QH]'\r\nc.BatchSpawnerBase.state_running_re = 'job_state = R'\r\nc.ProfilesSpawner.profiles = [\r\n        ( \"1 cores 8GB 8 hours\", 'c1-1c-8g-8h', 'batchspawner.PBSSpawner',\r\n                { \"req_nprocs\" : \"1\", \"req_queue\":\"interactive\", \"req_runtime\":\"08:00:00\", \"req_memory\":\"8gb\", \"req_ngpus\":\"0\" } ),\r\n        ( \"4 cores, 32GB, 8 hours\", \"c1-4c-16g-8h\", \"batchspawner.PBSSpawner\",\r\n                { \"req_nprocs\" : \"4\", \"req_queue\":\"interactive\", \"req_runtime\":\"08:00:00\", \"req_memory\":\"32gb\", \"req_ngpus\":\"0\" } ),\r\n        ( \"8 cores, 64GB, 8 hours\", \"c1-8c-64g-8h\", \"batchspawner.PBSSpawner\",\r\n                { \"req_nprocs\" : \"8\", \"req_queue\":\"interactive\", \"req_runtime\":\"08:00:00\", \"req_memory\":\"64gb\", \"req_ngpus\":\"0\" } ),\r\n        ( \"2 cores, 16GB, 8 hours, 1 GPU\", \"c1-2c-16g-8h-1gpu\", \"batchspawner.PBSSpawner\",\r\n                { \"req_nprocs\" : \"2\", \"req_queue\":\"gpu\", \"req_runtime\":\"08:00:00\", \"req_memory\":\"16gb\", \"req_ngpus\":\"1\" } ),\r\n        ]\r\nfrom jupyter_saml2authenticator import Saml2Authenticator\r\nfrom traitlets import Bool\r\nclass CheckingSaml2Authenticator(Saml2Authenticator):\r\n    def validate_username(self, username):\r\n        if not super().validate_username(username):\r\n            return False\r\n        \"\"\"Check if the user exists on the system\"\"\"\r\n        import pwd\r\n        try:\r\n            pwd.getpwnam(username)\r\n        except KeyError:\r\n            return False\r\n        else:\r\n            return True\r\n    # For some reason this is not configurable in the parent class\r\n    delete_invalid_users = Bool(\r\n        default_value = True,\r\n        config = True,\r\n        help=\"Whether to delete users (from JupyterHub DB) who no longer validate\",\r\n    )\r\nc.JupyterHub.authenticator_class = CheckingSaml2Authenticator\r\nc.CheckingSaml2Authenticator.saml2_metadata_url = 'REDACTED'\r\nc.CheckingSaml2Authenticator.saml2_entity_id = 'REDACTED'\r\nc.CheckingSaml2Authenticator.saml2_attribute_username = 'name'\r\nc.CheckingSaml2Authenticator.delete_invalid_users = True\r\nc.CheckingSaml2Authenticator.login_service = 'ID'\r\n```\r\n</details>\r\n\r\n<details><summary>Logs</summary>\r\n\r\nFrom the hub logs (I've redacted some items - hopefully not so much it's impossible to work out what is going on)\r\n\r\n```\r\n[I 2022-04-10 14:01:45.365 JupyterHub log:189] 302 GET /hub/api/oauth2/authorize?client_id=jupyterhub-user-username&redirect_uri=%2Fuser%2Fusername%2Foauth_callback&response_type=code&state=[secret] -> /user/username/oauth_callback?code=[secret]&state=[secret] (username@::ffff:user.ipv4.address) 54.29ms\r\n14:01:45.938 [ConfigProxy] debug: PROXY WEB /user/username/oauth_callback?code=redacted to http://[compute:ipv6:address]:40713\r\n[D 2022-04-10 14:01:45.961 JupyterHub scopes:301] Authenticated with token <APIToken('REDACTED...', user='username', client_id='jupyterhub')>\r\n[D 2022-04-10 14:01:45.962 oauthlib.oauth2.rfc6749.endpoints.token token:112] Dispatching grant_type authorization_code request to <oauthlib.oauth2.rfc6749.grant_types.authorization_code.AuthorizationCodeGrant object at REDACTED>.\r\n[D 2022-04-10 14:01:45.962 JupyterHub provider:53] authenticate_client <oauthlib.Request SANITIZED>\r\n[D 2022-04-10 14:01:45.974 oauthlib.oauth2.rfc6749.grant_types.authorization_code authorization_code:534] Using provided redirect_uri /user/username/oauth_callback\r\n[D 2022-04-10 14:01:45.975 JupyterHub provider:112] confirm_redirect_uri: client_id=jupyterhub-user-username, redirect_uri=/user/username/oauth_callback\r\n[D 2022-04-10 14:01:45.975 oauthlib.oauth2.rfc6749.grant_types.authorization_code authorization_code:302] Token request validation ok for <oauthlib.Request SANITIZED>.\r\n[D 2022-04-10 14:01:45.975 JupyterHub provider:335] Saving bearer token {'access_token': 'REDACTED', 'expires_in': 1209600, 'token_type': 'Bearer', 'scope': '', 'refresh_token': 'REDACTED'}\r\n[D 2022-04-10 14:01:46.000 JupyterHub provider:195] Deleting oauth code 4Ef... for jupyterhub-user-username\r\n[I 2022-04-10 14:01:46.020 JupyterHub log:189] 200 POST /hub/api/oauth2/token (username@compute:ipv6:address) 64.17ms\r\n[D 2022-04-10 14:01:46.036 JupyterHub base:281] Recording first activity for <APIToken('OSFd...', user='username', client_id='jupyterhub-user-username')>\r\n[D 2022-04-10 14:01:46.055 JupyterHub scopes:301] Authenticated with token <APIToken('OSFd...', user='username', client_id='jupyterhub-user-username')>\r\n[I 2022-04-10 14:01:46.066 JupyterHub log:189] 200 GET /hub/api/user (username@compute:ipv6:address) 32.94ms\r\n14:01:46.637 [ConfigProxy] debug: PROXY WEB /user/username/lab? to http://[compute:ipv6:address]:40713\r\n14:01:46.850 [ConfigProxy] error: 503 GET /user/username/lab? socket hang up\r\n[D 2022-04-10 14:01:46.857 JupyterHub pages:586] No template for 503\r\n[I 2022-04-10 14:01:46.872 JupyterHub log:189] 200 GET /hub/error/503?url=%2Fuser%2Fusername%2Flab%3F (@hub:ipv6:address) 16.33ms\r\n```\r\nand from the compute node:\r\n\r\n```\r\n[D 2022-04-10 14:01:46.062 SingleUserLabApp auth:395] Received request from Hub user {'admin': True, 'groups': [], 'name': 'username', 'kind': 'user', 'session_id': 'redacted', 'scopes': ['access:servers!server=username/']}\r\n[I 2022-04-10 14:01:46.062 SingleUserLabApp auth:1132] Logged-in user {'admin': True, 'groups': [], 'name': 'username', 'kind': 'user', 'session_id': 'redacted', 'scopes': ['access:servers!server=username/']}\r\n[D 2022-04-10 14:01:46.062 SingleUserLabApp auth:841] Setting oauth cookie for ::ffff:user.ipv4.address: jupyterhub-user-username, {'path': '/user/username/', 'httponly': True, 'secure': True}\r\n[I 2022-04-10 14:01:46.063 SingleUserLabApp log:189] 302 GET /user/username/oauth_callback?code=[secret]&state=[secret] -> /user/username/lab? (@::ffff:user.ipv4.address) 119.27ms\r\n[E 2022-04-10 14:01:46.643 SingleUserLabApp http1connection:67] Uncaught exception\r\n    Traceback (most recent call last):\r\n      File \"/apps/jupyterhub/2022-04-10/lib/python3.9/site-packages/tornado/http1connection.py\", line 273, in _read_message\r\n        delegate.finish()\r\n      File \"/apps/jupyterhub/2022-04-10/lib/python3.9/site-packages/tornado/httpserver.py\", line 387, in finish\r\n        self.delegate.finish()\r\n      File \"/apps/jupyterhub/2022-04-10/lib/python3.9/site-packages/tornado/routing.py\", line 268, in finish\r\n        self.delegate.finish()\r\n      File \"/apps/jupyterhub/2022-04-10/lib/python3.9/site-packages/tornado/web.py\", line 2290, in finish\r\n        self.execute()\r\n      File \"/apps/jupyterhub/2022-04-10/lib/python3.9/site-packages/tornado/web.py\", line 2309, in execute\r\n        self.handler = self.handler_class(\r\n      File \"/apps/jupyterhub/2022-04-10/lib/python3.9/site-packages/tornado/web.py\", line 227, in __init__\r\n        self.clear()\r\n      File \"/apps/jupyterhub/2022-04-10/lib/python3.9/site-packages/tornado/web.py\", line 328, in clear\r\n        self.set_default_headers()\r\n      File \"/apps/jupyterhub/2022-04-10/lib/python3.9/site-packages/jupyter_server/base/handlers.py\", line 314, in set_default_headers\r\n        elif self.token_authenticated and \"Access-Control-Allow-Origin\" not in self.settings.get(\r\n      File \"/apps/jupyterhub/2022-04-10/lib/python3.9/site-packages/jupyter_server/base/handlers.py\", line 159, in token_authenticated\r\n        return self.login_handler.is_token_authenticated(self)\r\n      File \"/apps/jupyterhub/2022-04-10/lib/python3.9/site-packages/jupyterhub/singleuser/mixins.py\", line 105, in is_token_authenticated\r\n        handler.get_current_user()\r\n      File \"/apps/jupyterhub/2022-04-10/lib/python3.9/site-packages/jupyterhub/services/auth.py\", line 1051, in get_current_user\r\n        self._hub_auth_user_cache = self.check_hub_user(user_model)\r\n      File \"/apps/jupyterhub/2022-04-10/lib/python3.9/site-packages/jupyterhub/services/auth.py\", line 978, in check_hub_user\r\n        if self.allow_all:\r\n      File \"/apps/jupyterhub/2022-04-10/lib/python3.9/site-packages/jupyterhub/services/auth.py\", line 924, in allow_all\r\n        self.hub_scopes is None\r\n      File \"/apps/jupyterhub/2022-04-10/lib/python3.9/site-packages/jupyterhub/services/auth.py\", line 916, in hub_scopes\r\n        return self.hub_auth.oauth_scopes or None\r\n      File \"/apps/jupyterhub/2022-04-10/lib/python3.9/site-packages/traitlets/traitlets.py\", line 577, in __get__\r\n        return self.get(obj, cls)\r\n      File \"/apps/jupyterhub/2022-04-10/lib/python3.9/site-packages/traitlets/traitlets.py\", line 540, in get\r\n        default = obj.trait_defaults(self.name)\r\n      File \"/apps/jupyterhub/2022-04-10/lib/python3.9/site-packages/traitlets/traitlets.py\", line 1580, in trait_defaults\r\n        return self._get_trait_default_generator(names[0])(self)\r\n      File \"/apps/jupyterhub/2022-04-10/lib/python3.9/site-packages/traitlets/traitlets.py\", line 977, in __call__\r\n        return self.func(*args, **kwargs)\r\n      File \"/apps/jupyterhub/2022-04-10/lib/python3.9/site-packages/jupyterhub/services/auth.py\", line 357, in _default_scopes\r\n        return set(json.loads(env_scopes))\r\n      File \"/apps/jupyterhub/2022-04-10/lib/python3.9/json/__init__.py\", line 346, in loads\r\n        return _default_decoder.decode(s)\r\n      File \"/apps/jupyterhub/2022-04-10/lib/python3.9/json/decoder.py\", line 337, in decode\r\n        obj, end = self.raw_decode(s, idx=_w(s, 0).end())\r\n      File \"/apps/jupyterhub/2022-04-10/lib/python3.9/json/decoder.py\", line 355, in raw_decode\r\n        raise JSONDecodeError(\"Expecting value\", s, err.value) from None\r\n    json.decoder.JSONDecodeError: Expecting value: line 1 column 2 (char 1)\r\n```\r\n\r\n</details>", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3866/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3866/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3865", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3865/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3865/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3865/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3865", "id": 1202405721, "node_id": "I_kwDOAT0rQs5Hq0FZ", "number": 3865, "title": "Admin page doesn't load table", "user": {"login": "MrPlumbum82", "id": 11234396, "node_id": "MDQ6VXNlcjExMjM0Mzk2", "avatar_url": "https://avatars.githubusercontent.com/u/11234396?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MrPlumbum82", "html_url": "https://github.com/MrPlumbum82", "followers_url": "https://api.github.com/users/MrPlumbum82/followers", "following_url": "https://api.github.com/users/MrPlumbum82/following{/other_user}", "gists_url": "https://api.github.com/users/MrPlumbum82/gists{/gist_id}", "starred_url": "https://api.github.com/users/MrPlumbum82/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MrPlumbum82/subscriptions", "organizations_url": "https://api.github.com/users/MrPlumbum82/orgs", "repos_url": "https://api.github.com/users/MrPlumbum82/repos", "events_url": "https://api.github.com/users/MrPlumbum82/events{/privacy}", "received_events_url": "https://api.github.com/users/MrPlumbum82/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-04-12T21:23:23Z", "updated_at": "2022-05-11T22:10:19Z", "closed_at": "2022-05-11T22:10:19Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\nThe `Admin` page in the Jupyterhub `Control Panel` loads an empty page if a single user from a list of `n` users does not have a spawned playbook (server).\r\n\r\n#### Expected behaviour\r\nI would expect to see the complete table/list of users and their spawned playbook servers.\r\n<img width=\"1310\" alt=\"Screen Shot 2022-04-12 at 3 22 27 PM\" src=\"https://user-images.githubusercontent.com/11234396/163046088-08ed341e-3b4f-4f6c-ad49-090df50b1296.png\">\r\n\r\n\r\n#### Actual behaviour\r\nIf a single user from the list shown above would `stop` their server, the admin page breaks and the javascript seems to be accessing the `name` field of a `null` object.\r\n<img width=\"1311\" alt=\"Screen Shot 2022-04-12 at 3 27 21 PM\" src=\"https://user-images.githubusercontent.com/11234396/163046130-339632f5-b520-41c1-87a1-b884e6197763.png\">\r\n\r\n\r\n### How to reproduce\r\n1. Start-Up a new Juypterhub server\r\n2. Sign in with an `admin` user (automatically creating a playbook server for this user)\r\n3. Visit Admin page (loads fine)\r\n4. Click on the red `Stop Server` button\r\n5. Watch the table will disappear\r\n6. Open the console drawer and view the error message pop up: `cannot read property name of null`\r\n\r\n### Your personal set up\r\nMy set up consists of running a `jupyterhub/jupyterhub` docker container, with a `postgres` database and a custom `nginx` proxy. I am using the `dockerspawner.swarmspawner` to launch many `single user` playbooks via the following docker image `jupyterhub/singleuser`.\r\n\r\n - OS:\r\n   - ubuntu 20.04\r\n\r\n - Version(s):\r\n   - Python version: 3.8.10\r\n   - Jupyterhub version: 2.2.1\r\n   - oauthenticator.azuread.AzureAdOAuthenticator-14.2.0\r\n   - dockerspawner.swarmspawner.SwarmSpawner-12.1.0\r\n\r\n<details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\nalembic @ file:///tmp/wheelhouse/alembic-1.7.6-py3-none-any.whl\r\nasync-generator @ file:///tmp/wheelhouse/async_generator-1.10-py3-none-any.whl\r\nattrs @ file:///tmp/wheelhouse/attrs-21.4.0-py2.py3-none-any.whl\r\ncertifi @ file:///tmp/wheelhouse/certifi-2021.10.8-py2.py3-none-any.whl\r\ncertipy @ file:///tmp/wheelhouse/certipy-0.1.3-py3-none-any.whl\r\ncffi @ file:///tmp/wheelhouse/cffi-1.15.0-cp38-cp38-manylinux_2_12_x86_64.manylinux2010_x86_64.whl\r\ncharset-normalizer @ file:///tmp/wheelhouse/charset_normalizer-2.0.12-py3-none-any.whl\r\ncryptography @ file:///tmp/wheelhouse/cryptography-36.0.1-cp36-abi3-manylinux_2_24_x86_64.whl\r\ndocker==2.7.0\r\ndocker-pycreds==0.4.0\r\ndockerspawner==12.1.0\r\nentrypoints @ file:///tmp/wheelhouse/entrypoints-0.4-py3-none-any.whl\r\nescapism==1.0.1\r\ngreenlet @ file:///tmp/wheelhouse/greenlet-1.1.2-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl\r\nidna @ file:///tmp/wheelhouse/idna-3.3-py3-none-any.whl\r\nimportlib-metadata @ file:///tmp/wheelhouse/importlib_metadata-4.11.2-py3-none-any.whl\r\nimportlib-resources @ file:///tmp/wheelhouse/importlib_resources-5.4.0-py3-none-any.whl\r\nJinja2 @ file:///tmp/wheelhouse/Jinja2-3.0.3-py3-none-any.whl\r\njsonschema @ file:///tmp/wheelhouse/jsonschema-4.4.0-py3-none-any.whl\r\njupyter-telemetry @ file:///tmp/wheelhouse/jupyter_telemetry-0.1.0-py3-none-any.whl\r\njupyterhub @ file:///tmp/wheelhouse/jupyterhub-2.2.1-py3-none-any.whl\r\njupyterhub-ldapauthenticator==1.2.2\r\nldap3==2.9.1\r\nMako @ file:///tmp/wheelhouse/Mako-1.2.0-py3-none-any.whl\r\nMarkupSafe @ file:///tmp/wheelhouse/MarkupSafe-2.1.0-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl\r\noauthenticator==14.2.0\r\noauthlib @ file:///tmp/wheelhouse/oauthlib-3.2.0-py3-none-any.whl\r\npackaging @ file:///tmp/wheelhouse/packaging-21.3-py3-none-any.whl\r\npamela @ file:///tmp/wheelhouse/pamela-1.0.0-py2.py3-none-any.whl\r\nprometheus-client @ file:///tmp/wheelhouse/prometheus_client-0.13.1-py3-none-any.whl\r\npsycopg2-binary==2.9.3\r\npyasn1==0.4.8\r\npycparser @ file:///tmp/wheelhouse/pycparser-2.21-py2.py3-none-any.whl\r\npycurl==7.43.0.2\r\nPyJWT==2.3.0\r\npyOpenSSL @ file:///tmp/wheelhouse/pyOpenSSL-22.0.0-py2.py3-none-any.whl\r\npyparsing @ file:///tmp/wheelhouse/pyparsing-3.0.7-py3-none-any.whl\r\npyrsistent @ file:///tmp/wheelhouse/pyrsistent-0.18.1-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl\r\npython-dateutil @ file:///tmp/wheelhouse/python_dateutil-2.8.2-py2.py3-none-any.whl\r\npython-json-logger @ file:///tmp/wheelhouse/python_json_logger-2.0.2-py3-none-any.whl\r\nrequests @ file:///tmp/wheelhouse/requests-2.27.1-py2.py3-none-any.whl\r\nruamel.yaml @ file:///tmp/wheelhouse/ruamel.yaml-0.17.21-py3-none-any.whl\r\nruamel.yaml.clib @ file:///tmp/wheelhouse/ruamel.yaml.clib-0.2.6-cp38-cp38-manylinux1_x86_64.whl\r\nsix @ file:///tmp/wheelhouse/six-1.16.0-py2.py3-none-any.whl\r\nSQLAlchemy @ file:///tmp/wheelhouse/SQLAlchemy-1.4.32-cp38-cp38-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl\r\ntornado @ file:///tmp/wheelhouse/tornado-6.1-cp38-cp38-manylinux2010_x86_64.whl\r\ntraitlets @ file:///tmp/wheelhouse/traitlets-5.1.1-py3-none-any.whl\r\nurllib3 @ file:///tmp/wheelhouse/urllib3-1.26.8-py2.py3-none-any.whl\r\nwebsocket-client==1.3.2\r\nzipp @ file:///tmp/wheelhouse/zipp-3.7.0-py3-none-any.whl\r\n```\r\n</details>\r\n\r\n<details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```python\r\n# Configuration file for JupyterHub\r\nimport os\r\nfrom oauthenticator.azuread import AzureAdOAuthenticator\r\n\r\nc = get_config()\r\n\r\n# Help with developing this to get more informative errors\r\nc.Application.log_level = 'DEBUG'\r\n\r\n# Login with Azure AD\r\nc.JupyterHub.authenticator_class = AzureAdOAuthenticator\r\nc.AzureAdOAuthenticator.tenant_id = os.environ.get('AAD_TENANT_ID')\r\n# Need to make this dynamic\r\nc.AzureAdOAuthenticator.oauth_callback_url = [REDACTED-URL]\r\nc.AzureAdOAuthenticator.client_id = os.environ.get('AAD_CLIENT_ID')\r\nc.AzureAdOAuthenticator.client_secret = os.environ.get('AAD_CLIENT_SECRET')\r\n\r\n# Nginx proxy \r\n# Force the proxy to only listen to connections to 127.0.0.1 (on port 8000)\r\nc.JupyterHub.bind_url = 'https://0.0.0.0:8000'\r\n\r\n# Authentication for prometheus metrics\r\n#  Default: True\r\nc.JupyterHub.authenticate_prometheus = False\r\n\r\n# DB connection\r\nc.JupyterHub.db_url = 'postgresql://postgres:{password}@jupyterhub_postgres:5432/{db}'.format(\r\n    password=os.environ['POSTGRES_PASSWORD'],\r\n    db=os.environ['POSTGRES_DB'],\r\n)\r\n\r\n# Spawner config\r\nc.JupyterHub.spawner_class = 'dockerspawner.SwarmSpawner'\r\nnetwork_name = os.environ.get('DOCKER_NETWORK_NAME')\r\nc.SwarmSpawner.network_name = network_name\r\nc.SwarmSpawner.extra_host_config = {'network_mode': network_name}\r\n# Connect to the Hub's\r\nc.SwarmSpawner.hub_connect_url = [REDACTED-URL]\r\nc.SwarmSpawner.use_internal_ip = True\r\nc.SwarmSpawner.pull_policy = \"always\"\r\nc.SwarmSpawner.image = [REDACTED-URL]\r\n\r\nc.SwarmSpawner.name_template= \"{username}-{prefix}\"\r\n\r\n# Admins list if we can't use AzureAD\r\nc.Authenticator.admin_users = {'sadan mallhi'}\r\n\r\n```\r\n</details>\r\n\r\n<details><summary>Logs</summary>\r\n\r\n## Browser Console Error when navigating to Admin Page\r\n```\r\n\r\nTypeError: Cannot read properties of null (reading 'name')\r\n    at admin-react.js:2:31608\r\n    at Array.map (<anonymous>)\r\n    at Ye (admin-react.js:2:31533)\r\n    at nl (admin-react.js:2:125170)\r\n    at Fl (admin-react.js:2:134688)\r\n    at $i (admin-react.js:2:178033)\r\n    at ku (admin-react.js:2:164494)\r\n    at wu (admin-react.js:2:164422)\r\n    at bu (admin-react.js:2:164285)\r\n    at du (admin-react.js:2:161360)\r\nri @ admin-react.js:2\r\n\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3865/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3865/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3863", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3863/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3863/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3863/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3863", "id": 1197667136, "node_id": "PR_kwDOAT0rQs41479l", "number": 3863, "title": "[Bug Fix] Search bar disabled on admin dashboard", "user": {"login": "NarekA", "id": 737367, "node_id": "MDQ6VXNlcjczNzM2Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/737367?v=4", "gravatar_id": "", "url": "https://api.github.com/users/NarekA", "html_url": "https://github.com/NarekA", "followers_url": "https://api.github.com/users/NarekA/followers", "following_url": "https://api.github.com/users/NarekA/following{/other_user}", "gists_url": "https://api.github.com/users/NarekA/gists{/gist_id}", "starred_url": "https://api.github.com/users/NarekA/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/NarekA/subscriptions", "organizations_url": "https://api.github.com/users/NarekA/orgs", "repos_url": "https://api.github.com/users/NarekA/repos", "events_url": "https://api.github.com/users/NarekA/events{/privacy}", "received_events_url": "https://api.github.com/users/NarekA/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-04-08T18:32:18Z", "updated_at": "2022-05-05T11:05:45Z", "closed_at": "2022-04-11T09:15:06Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3863", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3863", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3863.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3863.patch", "merged_at": "2022-04-11T09:15:06Z"}, "body": "I originally had `defaultValue` here and I changed it not realizing this would break/disable the input.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3863/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3863/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3859", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3859/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3859/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3859/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3859", "id": 1195735013, "node_id": "PR_kwDOAT0rQs41yqsP", "number": 3859, "title": "Do not store Spawner.ip/port on spawner.server during get_env", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-04-07T08:58:45Z", "updated_at": "2022-04-08T17:50:46Z", "closed_at": "2022-04-07T21:03:15Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3859", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3859", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3859.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3859.patch", "merged_at": "2022-04-07T21:03:15Z"}, "body": "we shouldn't mutate db state when getting the environment.\r\n\r\nIIRC, this was part of an attempt to get the url via `self.server.bind_url` that didn't end up getting used in #3381. So this doesn't really have any positive effects, but it _can_ have negative effects if `get_env` is called in unusual circumstances (jupyterhub/batchspawner#236)\r\n\r\n\r\ncloses jupyterhub/batchspawner#236", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3859/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3859/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3853", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3853/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3853/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3853/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3853", "id": 1190299827, "node_id": "PR_kwDOAT0rQs41g-ze", "number": 3853, "title": "Fix xsrf_cookie_kwargs ValueError", "user": {"login": "jwclark", "id": 3037927, "node_id": "MDQ6VXNlcjMwMzc5Mjc=", "avatar_url": "https://avatars.githubusercontent.com/u/3037927?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwclark", "html_url": "https://github.com/jwclark", "followers_url": "https://api.github.com/users/jwclark/followers", "following_url": "https://api.github.com/users/jwclark/following{/other_user}", "gists_url": "https://api.github.com/users/jwclark/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwclark/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwclark/subscriptions", "organizations_url": "https://api.github.com/users/jwclark/orgs", "repos_url": "https://api.github.com/users/jwclark/repos", "events_url": "https://api.github.com/users/jwclark/events{/privacy}", "received_events_url": "https://api.github.com/users/jwclark/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-04-01T21:46:41Z", "updated_at": "2022-05-05T11:05:44Z", "closed_at": "2022-04-05T18:28:03Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3853", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3853", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3853.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3853.patch", "merged_at": "2022-04-05T18:28:03Z"}, "body": "Fixes \r\n\r\n`ValueError: too many values to unpack (expected 2)`\r\n\r\nRelated to code added as a fix for https://github.com/jupyterhub/jupyterhub/issues/3821", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3853/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3853/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3846", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3846/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3846/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3846/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3846", "id": 1182424602, "node_id": "I_kwDOAT0rQs5Gel4a", "number": 3846, "title": "Latest build v4.0.0b5 fails on import from Aesara?", "user": {"login": "chopley", "id": 2196916, "node_id": "MDQ6VXNlcjIxOTY5MTY=", "avatar_url": "https://avatars.githubusercontent.com/u/2196916?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chopley", "html_url": "https://github.com/chopley", "followers_url": "https://api.github.com/users/chopley/followers", "following_url": "https://api.github.com/users/chopley/following{/other_user}", "gists_url": "https://api.github.com/users/chopley/gists{/gist_id}", "starred_url": "https://api.github.com/users/chopley/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chopley/subscriptions", "organizations_url": "https://api.github.com/users/chopley/orgs", "repos_url": "https://api.github.com/users/chopley/repos", "events_url": "https://api.github.com/users/chopley/events{/privacy}", "received_events_url": "https://api.github.com/users/chopley/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-03-27T07:56:14Z", "updated_at": "2022-03-27T08:10:27Z", "closed_at": "2022-03-27T08:10:27Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\nAfter pulling latest master (`commit 9c2ba7afc829fef5799068a0215a53b0f69da7c0`) I am unable to load pymc4. \r\n\r\nFirst issue sees to be out of date `Aesara` library in `requirements.txt` (change from 2.5.1 to 2.5.3) but second issue is a `ImportError: cannot import name 'CType' from 'aesara.graph.type'`\r\n\r\n#### Expected behaviour\r\n`import pymc as pm` correctly loads\r\n\r\n#### Actual behaviour\r\n```\r\nimport pymc as pm\r\nImportError: cannot import name 'CType' from 'aesara.graph.type' (/home/charles/anaconda3/envs/pymc-dev-v4.0.0b5/lib/python3.9/site-packages/aesara/graph/type.py)\r\n```\r\n\r\n### How to reproduce\r\n1. Pull latest master branch (commit 9c2ba7afc829fef5799068a0215a53b0f69da7c0)\r\n2. `python -m pip install . `\r\n3. `import pymc as pm`\r\n\r\n### Your personal set up\r\n```\r\nPython --version - Python 3.9.10\r\naesara.__version__ 2.5.3\r\nPymc v4.0.0b5 (commit 9c2ba7afc829fef5799068a0215a53b0f69da7c0\r\nubuntu 20.04\r\n```\r\n\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\nconda list\r\n# packages in environment at /home/charles/anaconda3/envs/pymc-dev-v4.0.0b5:\r\n#\r\n# Name                    Version                   Build  Channel\r\n_libgcc_mutex             0.1                 conda_forge    conda-forge\r\n_openmp_mutex             4.5                      1_llvm    conda-forge\r\nabsl-py                   1.0.0              pyhd8ed1ab_0    conda-forge\r\naeppl                     0.0.17                   pypi_0    pypi\r\naesara                    2.5.3+12.gef256e526          pypi_0    pypi\r\nalabaster                 0.7.12                     py_0    conda-forge\r\nanyio                     3.5.0            py39hf3d152e_0    conda-forge\r\nargon2-cffi               21.3.0             pyhd8ed1ab_0    conda-forge\r\nargon2-cffi-bindings      21.2.0           py39h3811e60_1    conda-forge\r\narviz                     0.11.4             pyhd8ed1ab_0    conda-forge\r\nasteval                   0.9.26                   pypi_0    pypi\r\nasttokens                 2.0.5              pyhd8ed1ab_0    conda-forge\r\natk-1.0                   2.36.0               h3371d22_4    conda-forge\r\nattrs                     21.4.0             pyhd8ed1ab_0    conda-forge\r\nazure-common              1.1.28             pyhd8ed1ab_0    conda-forge\r\nazure-core                1.22.1             pyhd8ed1ab_0    conda-forge\r\nazure-identity            1.8.0              pyhd8ed1ab_0    conda-forge\r\nazure-keyvault-secrets    4.3.0              pyhd8ed1ab_0    conda-forge\r\nbabel                     2.9.1              pyh44b312d_0    conda-forge\r\nbackcall                  0.2.0              pyh9f0ad1d_0    conda-forge\r\nbackports                 1.1                pyhd3eb1b0_0  \r\nbackports.functools_lru_cache 1.6.4              pyhd8ed1ab_0    conda-forge\r\nbeautifulsoup4            4.10.0             pyha770c72_0    conda-forge\r\nbinutils                  2.36.1               hdd6e379_2    conda-forge\r\nbinutils_impl_linux-64    2.36.1               h193b22a_2    conda-forge\r\nbinutils_linux-64         2.36                 hf3e587d_5    conda-forge\r\nblack                     22.1.0             pyhd8ed1ab_0    conda-forge\r\nblas                      2.113                  openblas    conda-forge\r\nblas-devel                3.9.0           13_linux64_openblas    conda-forge\r\nbleach                    4.1.0              pyhd8ed1ab_0    conda-forge\r\nblinker                   1.4                        py_1    conda-forge\r\nbrotli                    1.0.9                h7f98852_6    conda-forge\r\nbrotli-bin                1.0.9                h7f98852_6    conda-forge\r\nbrotlipy                  0.7.0           py39h3811e60_1003    conda-forge\r\nbzip2                     1.0.8                h7f98852_4    conda-forge\r\nc-ares                    1.18.1               h7f98852_0    conda-forge\r\nc-compiler                1.3.0                h7f98852_0    conda-forge\r\nca-certificates           2022.2.1             h06a4308_0  \r\ncached-property           1.5.2                hd8ed1ab_1    conda-forge\r\ncached_property           1.5.2              pyha770c72_1    conda-forge\r\ncachetools                5.0.0              pyhd8ed1ab_0    conda-forge\r\ncairo                     1.16.0            ha00ac49_1009    conda-forge\r\ncertifi                   2021.10.8        py39hf3d152e_1    conda-forge\r\ncffi                      1.15.0           py39h4bc2ebd_0    conda-forge\r\ncfgv                      3.3.1              pyhd8ed1ab_0    conda-forge\r\ncftime                    1.5.2            py39hce5d2b2_0    conda-forge\r\ncharset-normalizer        2.0.12             pyhd8ed1ab_0    conda-forge\r\nclick                     8.0.3            py39hf3d152e_1    conda-forge\r\nclick-completion          0.5.2            py39hf3d152e_3    conda-forge\r\nclick-log                 0.3.2              pyh9f0ad1d_0    conda-forge\r\ncloudpickle               2.0.0              pyhd8ed1ab_0    conda-forge\r\ncmdstan                   2.29.0               h6405898_0    conda-forge\r\ncmdstanpy                 1.0.1              pyhd8ed1ab_0    conda-forge\r\ncolorama                  0.4.4              pyh9f0ad1d_0    conda-forge\r\ncons                      0.4.5              pyhd8ed1ab_0    conda-forge\r\ncoverage                  6.3.1            py39h3811e60_0    conda-forge\r\ncryptography              36.0.0           py39h9ce1e76_0  \r\ncurl                      7.81.0               h494985f_0    conda-forge\r\ncurveball                 0.2.16                   pypi_0    pypi\r\ncxx-compiler              1.3.0                h4bd325d_0    conda-forge\r\ncycler                    0.11.0             pyhd8ed1ab_0    conda-forge\r\ndataclasses               0.8                pyhc8e2a94_3    conda-forge\r\ndebugpy                   1.5.1            py39he80948d_0    conda-forge\r\ndecorator                 5.1.1              pyhd8ed1ab_0    conda-forge\r\ndefusedxml                0.7.1              pyhd8ed1ab_0    conda-forge\r\ndescartes                 1.1.0                      py_4    conda-forge\r\ndill                      0.3.4              pyhd8ed1ab_0    conda-forge\r\ndistlib                   0.3.4              pyhd8ed1ab_0    conda-forge\r\ndocutils                  0.17.1           py39hf3d152e_1    conda-forge\r\nentrypoints               0.4                pyhd8ed1ab_0    conda-forge\r\net_xmlfile                1.1.0            py39h06a4308_0  \r\netuples                   0.3.4              pyhd8ed1ab_0    conda-forge\r\nexecuting                 0.8.2              pyhd8ed1ab_0    conda-forge\r\nexpat                     2.4.4                h9c3ff4c_0    conda-forge\r\nfastprogress              1.0.2              pyhd8ed1ab_0    conda-forge\r\nfilelock                  3.6.0              pyhd8ed1ab_0    conda-forge\r\nflit-core                 3.6.0              pyhd8ed1ab_0    conda-forge\r\nfont-ttf-dejavu-sans-mono 2.37                 hab24e00_0    conda-forge\r\nfont-ttf-inconsolata      3.000                h77eed37_0    conda-forge\r\nfont-ttf-source-code-pro  2.038                h77eed37_0    conda-forge\r\nfont-ttf-ubuntu           0.83                 hab24e00_0    conda-forge\r\nfontconfig                2.13.96              ha180cfb_0    conda-forge\r\nfonts-conda-ecosystem     1                             0    conda-forge\r\nfonts-conda-forge         1                             0    conda-forge\r\nfonttools                 4.29.1           py39h3811e60_0    conda-forge\r\nformulae                  0.2.0              pyhd8ed1ab_0    conda-forge\r\nfreetype                  2.11.0               h70c0345_0  \r\nfribidi                   1.0.10               h516909a_0    conda-forge\r\nfuture                    0.18.2                   pypi_0    pypi\r\ngcc                       9.4.0                h192d537_5    conda-forge\r\ngcc_impl_linux-64         9.4.0               h03d3576_12    conda-forge\r\ngcc_linux-64              9.4.0                h391b98a_5    conda-forge\r\ngdk-pixbuf                2.42.6               h04a7f16_0    conda-forge\r\ngettext                   0.21.0               hf68c758_0  \r\ngiflib                    5.2.1                h516909a_2    conda-forge\r\ngitdb                     4.0.9              pyhd8ed1ab_0    conda-forge\r\ngitpython                 3.1.26             pyhd8ed1ab_0    conda-forge\r\ngraphite2                 1.3.14               h23475e2_0  \r\ngraphviz                  2.50.0               h8e749b2_2    conda-forge\r\ngreenlet                  1.1.2            py39he80948d_1    conda-forge\r\ngtk2                      2.24.33              h90689f9_2    conda-forge\r\ngts                       0.7.6                h64030ff_2    conda-forge\r\ngxx                       9.4.0                h192d537_5    conda-forge\r\ngxx_impl_linux-64         9.4.0               h03d3576_12    conda-forge\r\ngxx_linux-64              9.4.0                h0316aca_5    conda-forge\r\nh5py                      3.6.0           nompi_py39h7e08c79_100    conda-forge\r\nharfbuzz                  3.4.0                hb4a5f5f_0    conda-forge\r\nhdf4                      4.2.15               h10796ff_3    conda-forge\r\nhdf5                      1.12.1          nompi_h7f166f4_103    conda-forge\r\nicu                       69.1                 h9c3ff4c_0    conda-forge\r\nidentify                  2.4.10             pyhd8ed1ab_0    conda-forge\r\nidna                      3.3                pyhd8ed1ab_0    conda-forge\r\nimagesize                 1.3.0              pyhd8ed1ab_0    conda-forge\r\nimportlib-metadata        4.11.1           py39hf3d152e_0    conda-forge\r\nimportlib_metadata        4.11.1               hd8ed1ab_0    conda-forge\r\nimportlib_resources       5.4.0              pyhd8ed1ab_0    conda-forge\r\niniconfig                 1.1.1              pyh9f0ad1d_0    conda-forge\r\nipykernel                 6.9.1            py39hef51801_0    conda-forge\r\nipython                   8.0.1            py39hf3d152e_2    conda-forge\r\nipython_genutils          0.2.0                      py_1    conda-forge\r\nipywidgets                7.6.5              pyhd8ed1ab_0    conda-forge\r\nisodate                   0.6.1              pyhd8ed1ab_0    conda-forge\r\nisort                     5.10.1             pyhd8ed1ab_0    conda-forge\r\njax                       0.3.0              pyhd8ed1ab_0    conda-forge\r\njaxlib                    0.3.0                    pypi_0    pypi\r\njbig                      2.1               h7f98852_2003    conda-forge\r\njedi                      0.18.1           py39hf3d152e_0    conda-forge\r\njinja2                    3.0.3              pyhd8ed1ab_0    conda-forge\r\njoblib                    1.1.0              pyhd8ed1ab_0    conda-forge\r\njoypy                     0.2.6                    pypi_0    pypi\r\njpeg                      9e                   h7f98852_0    conda-forge\r\njson5                     0.9.6              pyhd3eb1b0_0  \r\njsonschema                4.4.0              pyhd8ed1ab_0    conda-forge\r\njupyter-cache             0.4.3              pyhd8ed1ab_0    conda-forge\r\njupyter-server-mathjax    0.2.4              pyhc268e32_0    conda-forge\r\njupyter-sphinx            0.3.2              pyhd8ed1ab_1    conda-forge\r\njupyter_client            7.1.2              pyhd8ed1ab_0    conda-forge\r\njupyter_contrib_core      0.3.3                      py_2    conda-forge\r\njupyter_contrib_nbextensions 0.5.1            py39hde42818_1    conda-forge\r\njupyter_core              4.9.2            py39hf3d152e_0    conda-forge\r\njupyter_highlight_selected_word 0.2.0           py39hf3d152e_1005    conda-forge\r\njupyter_latex_envs        1.4.6           py39hf3d152e_1001    conda-forge\r\njupyter_nbextensions_configurator 0.4.1            py39hf3d152e_2    conda-forge\r\njupyter_server            1.13.5             pyhd8ed1ab_1    conda-forge\r\njupyterlab                3.2.9              pyhd8ed1ab_0    conda-forge\r\njupyterlab_code_formatter 1.4.10             pyhd8ed1ab_1    conda-forge\r\njupyterlab_pygments       0.1.2              pyh9f0ad1d_0    conda-forge\r\njupyterlab_server         2.10.3             pyhd8ed1ab_0    conda-forge\r\njupyterlab_widgets        1.0.2              pyhd8ed1ab_0    conda-forge\r\nkernel-headers_linux-64   2.6.32              he073ed8_15    conda-forge\r\nkiwisolver                1.3.2            py39h1a9c180_1    conda-forge\r\nkrb5                      1.19.2               h48eae69_3    conda-forge\r\nlcms2                     2.12                 hddcbb42_0    conda-forge\r\nld_impl_linux-64          2.36.1               hea4e1c9_2    conda-forge\r\nlerc                      3.0                  h9c3ff4c_0    conda-forge\r\nlibblas                   3.9.0           13_linux64_openblas    conda-forge\r\nlibbrotlicommon           1.0.9                h7f98852_6    conda-forge\r\nlibbrotlidec              1.0.9                h7f98852_6    conda-forge\r\nlibbrotlienc              1.0.9                h7f98852_6    conda-forge\r\nlibcblas                  3.9.0           13_linux64_openblas    conda-forge\r\nlibcurl                   7.81.0               h494985f_0    conda-forge\r\nlibdeflate                1.10                 h7f98852_0    conda-forge\r\nlibedit                   3.1.20210910         h7f8727e_0  \r\nlibev                     4.33                 h516909a_1    conda-forge\r\nlibffi                    3.4.2                h7f98852_5    conda-forge\r\nlibgcc-devel_linux-64     9.4.0               hd854feb_12    conda-forge\r\nlibgcc-ng                 11.2.0              h1d223b6_12    conda-forge\r\nlibgd                     2.3.3                h3cfcdeb_1    conda-forge\r\nlibgfortran-ng            11.2.0              h69a702a_12    conda-forge\r\nlibgfortran5              11.2.0              h5c6108e_12    conda-forge\r\nlibglib                   2.70.2               h174f98d_4    conda-forge\r\nlibgomp                   11.2.0              h1d223b6_12    conda-forge\r\nlibgpuarray               0.7.6             h14c3975_1003    conda-forge\r\nlibiconv                  1.16                 h516909a_0    conda-forge\r\nlibimagequant             2.17.0               h7f98852_1    conda-forge\r\nliblapack                 3.9.0           13_linux64_openblas    conda-forge\r\nliblapacke                3.9.0           13_linux64_openblas    conda-forge\r\nlibnetcdf                 4.8.1           nompi_hb3fd0d9_101    conda-forge\r\nlibnghttp2                1.46.0               ha19adfc_0    conda-forge\r\nlibnsl                    2.0.0                h7f98852_0    conda-forge\r\nlibopenblas               0.3.18          pthreads_h8fe5266_0    conda-forge\r\nlibpng                    1.6.37               hed695b0_2    conda-forge\r\nlibrsvg                   2.52.5               h0a9e6e8_2    conda-forge\r\nlibsanitizer              9.4.0               h79bfe98_12    conda-forge\r\nlibsodium                 1.0.18               h516909a_1    conda-forge\r\nlibssh2                   1.10.0               ha35d2d1_2    conda-forge\r\nlibstdcxx-devel_linux-64  9.4.0               hd854feb_12    conda-forge\r\nlibstdcxx-ng              11.2.0              he4da1e4_12    conda-forge\r\nlibtiff                   4.3.0                h542a066_3    conda-forge\r\nlibtool                   2.4.6             h9c3ff4c_1008    conda-forge\r\nlibuuid                   2.32.1            h14c3975_1000    conda-forge\r\nlibwebp                   1.2.2                h3452ae3_0    conda-forge\r\nlibwebp-base              1.2.2                h7f98852_1    conda-forge\r\nlibxcb                    1.13              h7f98852_1004    conda-forge\r\nlibxml2                   2.9.12               h885dcf4_1    conda-forge\r\nlibxslt                   1.1.33               h0ef7038_3    conda-forge\r\nlibzip                    1.8.0                h1c5bbd1_1    conda-forge\r\nlibzlib                   1.2.11            h36c2ea0_1013    conda-forge\r\nllvm-openmp               13.0.1               hf817b99_0    conda-forge\r\nlmfit                     1.0.3                    pypi_0    pypi\r\nlogical-unification       0.4.5              pyhd8ed1ab_0    conda-forge\r\nlxml                      4.8.0            py39h107f48f_0    conda-forge\r\nlz4-c                     1.9.3                h9c3ff4c_1    conda-forge\r\nmake                      4.3                  hd18ef5c_1    conda-forge\r\nmako                      1.1.6              pyhd8ed1ab_0    conda-forge\r\nmarkdown-it-py            1.1.0              pyhd8ed1ab_0    conda-forge\r\nmarkupsafe                2.1.0            py39hb9d737c_0    conda-forge\r\nmatplotlib-base           3.5.1            py39h2fa2bec_0    conda-forge\r\nmatplotlib-inline         0.1.3              pyhd8ed1ab_0    conda-forge\r\nmdit-py-plugins           0.2.8              pyhd8ed1ab_0    conda-forge\r\nminikanren                1.0.3              pyhd8ed1ab_0    conda-forge\r\nmistune                   0.8.4           py39h3811e60_1005    conda-forge\r\nmizani                    0.7.3              pyhd8ed1ab_0    conda-forge\r\nmkl                       2022.0.1           h8d4b97c_803    conda-forge\r\nmkl-service               2.4.0            py39h404a4ab_0    conda-forge\r\nmpmath                    1.2.1                    pypi_0    pypi\r\nmsal                      1.17.0             pyhd8ed1ab_0    conda-forge\r\nmsal_extensions           0.3.1              pyhd8ed1ab_0    conda-forge\r\nmsrest                    0.6.21             pyh44b312d_0    conda-forge\r\nmultipledispatch          0.6.0                      py_0    conda-forge\r\nmunkres                   1.1.4              pyh9f0ad1d_0    conda-forge\r\nmypy_extensions           0.4.3            py39hf3d152e_4    conda-forge\r\nmyst-nb                   0.13.1             pyhd8ed1ab_0    conda-forge\r\nmyst-parser               0.15.2             pyhd8ed1ab_0    conda-forge\r\nnatsort                   8.1.0              pyhd8ed1ab_0    conda-forge\r\nnbclassic                 0.3.5              pyhd8ed1ab_0    conda-forge\r\nnbclient                  0.5.11             pyhd8ed1ab_0    conda-forge\r\nnbconvert                 6.4.2            py39hf3d152e_0    conda-forge\r\nnbdime                    3.1.1              pyhd8ed1ab_0    conda-forge\r\nnbformat                  5.1.3              pyhd8ed1ab_0    conda-forge\r\nncurses                   6.3                  h9c3ff4c_0    conda-forge\r\nnest-asyncio              1.5.4              pyhd8ed1ab_0    conda-forge\r\nnetcdf4                   1.5.8           nompi_py39h64b754b_101    conda-forge\r\nnodeenv                   1.6.0              pyhd8ed1ab_0    conda-forge\r\nnodejs                    10.13.0              he6710b0_0  \r\nnotebook                  6.4.8              pyha770c72_0    conda-forge\r\nnumpy                     1.21.5           py39haac66dc_0    conda-forge\r\nnumpydoc                  1.1.0                      py_1    conda-forge\r\nnumpyro                   0.9.0                    pypi_0    pypi\r\noauthlib                  3.2.0              pyhd8ed1ab_0    conda-forge\r\nopenblas                  0.3.18          pthreads_h4748800_0    conda-forge\r\nopenjpeg                  2.4.0                hb52868f_1    conda-forge\r\nopenpyxl                  3.0.9              pyhd8ed1ab_0    conda-forge\r\nopenssl                   3.0.0                h7f98852_2    conda-forge\r\nopt_einsum                3.3.0              pyhd8ed1ab_1    conda-forge\r\npackaging                 21.3               pyhd8ed1ab_0    conda-forge\r\npalettable                3.3.0                      py_0    conda-forge\r\npandas                    1.4.1            py39hde0f152_0    conda-forge\r\npandas-flavor             0.2.0                      py_0    conda-forge\r\npandoc                    2.17.1.1             ha770c72_0    conda-forge\r\npandocfilters             1.5.0              pyhd8ed1ab_0    conda-forge\r\npango                     1.50.3               h9967ed3_0    conda-forge\r\nparso                     0.8.3              pyhd8ed1ab_0    conda-forge\r\npathspec                  0.9.0              pyhd8ed1ab_0    conda-forge\r\npatsy                     0.5.2              pyhd8ed1ab_0    conda-forge\r\npcre                      8.45                 h9c3ff4c_0    conda-forge\r\npexpect                   4.8.0              pyh9f0ad1d_2    conda-forge\r\npickleshare               0.7.5           py39hde42818_1002    conda-forge\r\npillow                    9.0.1            py39he69867a_1    conda-forge\r\npip                       22.0.3             pyhd8ed1ab_0    conda-forge\r\npixman                    0.40.0               h36c2ea0_0    conda-forge\r\nplatformdirs              2.5.0              pyhd8ed1ab_0    conda-forge\r\nplotnine                  0.8.0              pyhd8ed1ab_0    conda-forge\r\npluggy                    1.0.0            py39hf3d152e_2    conda-forge\r\npolyagamma                1.3.2                    pypi_0    pypi\r\nportalocker               2.4.0            py39hf3d152e_0    conda-forge\r\npre-commit                2.17.0           py39hf3d152e_0    conda-forge\r\nprometheus_client         0.13.1             pyhd8ed1ab_0    conda-forge\r\nprompt-toolkit            3.0.27             pyha770c72_0    conda-forge\r\npthread-stubs             0.4               h36c2ea0_1001    conda-forge\r\nptyprocess                0.7.0              pyhd3deb0d_0    conda-forge\r\npure_eval                 0.2.2              pyhd8ed1ab_0    conda-forge\r\npy                        1.11.0             pyh6c4a22f_0    conda-forge\r\npycparser                 2.21               pyhd8ed1ab_0    conda-forge\r\npydata-sphinx-theme       0.8.0              pyhd8ed1ab_0    conda-forge\r\npygments                  2.11.2             pyhd8ed1ab_0    conda-forge\r\npygpu                     0.7.6           py39hce5d2b2_1003    conda-forge\r\npyjanitor                 0.22.0             pyhd8ed1ab_0    conda-forge\r\npyjwt                     2.3.0              pyhd8ed1ab_1    conda-forge\r\npymc                      4.0.0b5                  pypi_0    pypi\r\npyodbc                    4.0.32           py39h295c915_0  \r\npyopenssl                 22.0.0             pyhd8ed1ab_0    conda-forge\r\npyparsing                 3.0.7              pyhd8ed1ab_0    conda-forge\r\npyrsistent                0.18.1           py39h3811e60_0    conda-forge\r\npysocks                   1.7.1            py39hf3d152e_4    conda-forge\r\npytest                    7.0.1            py39hf3d152e_0    conda-forge\r\npytest-cov                3.0.0              pyhd8ed1ab_0    conda-forge\r\npython                    3.9.10          hc74c709_2_cpython    conda-forge\r\npython-dateutil           2.8.2              pyhd8ed1ab_0    conda-forge\r\npython-flatbuffers        2.0                pyhd8ed1ab_0    conda-forge\r\npython-graphviz           0.19.1             pyhaef67bd_0    conda-forge\r\npython_abi                3.9                      2_cp39    conda-forge\r\npytz                      2021.3             pyhd8ed1ab_0    conda-forge\r\npyyaml                    6.0              py39h3811e60_3    conda-forge\r\npyzmq                     22.3.0           py39h37b5a0c_1    conda-forge\r\nreadline                  8.1.2                h7f8727e_1  \r\nrequests                  2.27.1             pyhd8ed1ab_0    conda-forge\r\nrequests-oauthlib         1.3.1              pyhd8ed1ab_0    conda-forge\r\nscikit-learn              1.0.2            py39h4dfa638_0    conda-forge\r\nscipy                     1.7.3            py39hee8e79c_0    conda-forge\r\nseaborn                   0.11.2               hd8ed1ab_0    conda-forge\r\nseaborn-base              0.11.2             pyhd8ed1ab_0    conda-forge\r\nsemver                    2.13.0             pyh9f0ad1d_0    conda-forge\r\nsend2trash                1.8.0              pyhd8ed1ab_0    conda-forge\r\nsetuptools                60.9.3           py39hf3d152e_0    conda-forge\r\nshellingham               1.4.0              pyh44b312d_0    conda-forge\r\nsix                       1.16.0             pyh6c4a22f_0    conda-forge\r\nsmmap                     3.0.5              pyh44b312d_0    conda-forge\r\nsniffio                   1.2.0            py39hf3d152e_2    conda-forge\r\nsnowballstemmer           2.2.0              pyhd8ed1ab_0    conda-forge\r\nsoupsieve                 2.3.1              pyhd8ed1ab_0    conda-forge\r\nsphinx                    4.4.0              pyh6c4a22f_1    conda-forge\r\nsphinx-copybutton         0.5.0              pyhd8ed1ab_0    conda-forge\r\nsphinx-design             0.0.13                   pypi_0    pypi\r\nsphinx-notfound-page      0.8                pyhd8ed1ab_0    conda-forge\r\nsphinx-remove-toctrees    0.0.3                    pypi_0    pypi\r\nsphinx-togglebutton       0.2.3              pyhd3deb0d_0    conda-forge\r\nsphinxcontrib-applehelp   1.0.2                      py_0    conda-forge\r\nsphinxcontrib-devhelp     1.0.2                      py_0    conda-forge\r\nsphinxcontrib-htmlhelp    2.0.0              pyhd8ed1ab_0    conda-forge\r\nsphinxcontrib-jsmath      1.0.1                      py_0    conda-forge\r\nsphinxcontrib-qthelp      1.0.3                      py_0    conda-forge\r\nsphinxcontrib-serializinghtml 1.1.5              pyhd8ed1ab_1    conda-forge\r\nsqlalchemy                1.4.31           py39h3811e60_0    conda-forge\r\nsqlite                    3.37.2               hc218d9a_0  \r\nstack_data                0.2.0              pyhd8ed1ab_0    conda-forge\r\nstatsmodels               0.13.2           py39hce5d2b2_0    conda-forge\r\nsympy                     1.9                      pypi_0    pypi\r\nsysroot_linux-64          2.12                he073ed8_15    conda-forge\r\ntbb                       2021.5.0             h4bd325d_0    conda-forge\r\ntbb-devel                 2021.5.0             h4bd325d_0    conda-forge\r\nterminado                 0.13.1           py39hf3d152e_0    conda-forge\r\ntestpath                  0.5.0              pyhd8ed1ab_0    conda-forge\r\nthreadpoolctl             3.1.0              pyh8a188c0_0    conda-forge\r\ntk                        8.6.12               h27826a3_0    conda-forge\r\ntoml                      0.10.2             pyhd8ed1ab_0    conda-forge\r\ntomli                     2.0.1              pyhd8ed1ab_0    conda-forge\r\ntoolz                     0.11.2             pyhd8ed1ab_0    conda-forge\r\ntornado                   6.1              py39h3811e60_2    conda-forge\r\ntqdm                      4.62.3             pyhd8ed1ab_0    conda-forge\r\ntraitlets                 5.1.1              pyhd8ed1ab_0    conda-forge\r\ntyped-ast                 1.5.2            py39h3811e60_0    conda-forge\r\ntyping-extensions         3.10.0.2             hd8ed1ab_0    conda-forge\r\ntyping_extensions         3.10.0.2           pyha770c72_0    conda-forge\r\ntzdata                    2021e                he74cb21_0    conda-forge\r\nujson                     5.1.0            py39he80948d_0    conda-forge\r\nukkonen                   1.0.1            py39h1a9c180_1    conda-forge\r\nuncertainties             3.1.6                    pypi_0    pypi\r\nunicodedata2              14.0.0           py39h3811e60_0    conda-forge\r\nunixodbc                  2.3.9                h7b6447c_0  \r\nurllib3                   1.26.8             pyhd8ed1ab_1    conda-forge\r\nvirtualenv                20.13.1          py39hf3d152e_0    conda-forge\r\nwatermark                 2.3.0              pyhd8ed1ab_0    conda-forge\r\nwcwidth                   0.2.5              pyh9f0ad1d_2    conda-forge\r\nwebcolors                 1.11.1                   pypi_0    pypi\r\nwebencodings              0.5.1                      py_1    conda-forge\r\nwebsocket-client          1.2.3              pyhd8ed1ab_0    conda-forge\r\nwheel                     0.37.1             pyhd8ed1ab_0    conda-forge\r\nwidgetsnbextension        3.5.2            py39hf3d152e_1    conda-forge\r\nxarray                    0.21.1             pyhd8ed1ab_0    conda-forge\r\nxlrd                      1.0.0                    pypi_0    pypi\r\nxorg-kbproto              1.0.7             h14c3975_1002    conda-forge\r\nxorg-libice               1.0.10               h516909a_0    conda-forge\r\nxorg-libsm                1.2.3             hd9c2040_1000    conda-forge\r\nxorg-libx11               1.7.2                h7f98852_0    conda-forge\r\nxorg-libxau               1.0.9                h14c3975_0    conda-forge\r\nxorg-libxdmcp             1.1.3                h516909a_0    conda-forge\r\nxorg-libxext              1.3.4                h7f98852_1    conda-forge\r\nxorg-libxrender           0.9.10            h7f98852_1003    conda-forge\r\nxorg-renderproto          0.11.1            h14c3975_1002    conda-forge\r\nxorg-xextproto            7.3.0             h14c3975_1002    conda-forge\r\nxorg-xproto               7.0.31            h14c3975_1007    conda-forge\r\nxz                        5.2.5                h516909a_1    conda-forge\r\nyaml                      0.2.5                h7f98852_2    conda-forge\r\nzeromq                    4.3.4                h9c3ff4c_1    conda-forge\r\nzipp                      3.7.0              pyhd8ed1ab_1    conda-forge\r\nzlib                      1.2.11            h36c2ea0_1013    conda-forge\r\nzstd                      1.5.2                ha95c52a_0    conda-forge\r\n```\r\n</details>\r\n\r\nI am using this through Jupyterhub- but I doubt that the issue is a Jupyterhub configuration..\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3846/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3846/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3844", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3844/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3844/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3844/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3844", "id": 1181324470, "node_id": "I_kwDOAT0rQs5GaZS2", "number": 3844, "title": "Admin page still blank by updating from jupyterhub=2.0.0 to jupyterhub=2.2.2", "user": {"login": "muh-hassani", "id": 62968151, "node_id": "MDQ6VXNlcjYyOTY4MTUx", "avatar_url": "https://avatars.githubusercontent.com/u/62968151?v=4", "gravatar_id": "", "url": "https://api.github.com/users/muh-hassani", "html_url": "https://github.com/muh-hassani", "followers_url": "https://api.github.com/users/muh-hassani/followers", "following_url": "https://api.github.com/users/muh-hassani/following{/other_user}", "gists_url": "https://api.github.com/users/muh-hassani/gists{/gist_id}", "starred_url": "https://api.github.com/users/muh-hassani/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/muh-hassani/subscriptions", "organizations_url": "https://api.github.com/users/muh-hassani/orgs", "repos_url": "https://api.github.com/users/muh-hassani/repos", "events_url": "https://api.github.com/users/muh-hassani/events{/privacy}", "received_events_url": "https://api.github.com/users/muh-hassani/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-03-25T22:24:41Z", "updated_at": "2022-05-22T13:14:32Z", "closed_at": "2022-05-22T13:14:32Z", "author_association": "NONE", "active_lock_reason": null, "body": "When I upgraded to jupyterhub=2.0.0, I had a proper restart of the jupyterhub and changes to the database schema were applied. By jupyterhub=2.0.0, the admin panel is available, and showing the users' activity, but when I update jupyterhub to 2.2.2, the admin panel becomes almost blank. Strangely, after the update, the admin panel includes only a gray bar which states jupyterhub 2.0.0. \r\nThe jupyterhub uses sudospawner and no reverse proxy. I would be grateful if anyone could help me, so I can update jupyterhub and still have the admin panel working.  ", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3844/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3844/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3837", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3837/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3837/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3837/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3837", "id": 1173324391, "node_id": "PR_kwDOAT0rQs40pMA8", "number": 3837, "title": "ensure _import_error is set when JUPYTERHUB_SINGLEUSER_APP is unavailable", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-03-18T08:24:48Z", "updated_at": "2022-06-06T13:58:39Z", "closed_at": "2022-03-18T09:03:19Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3837", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3837", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3837.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3837.patch", "merged_at": "2022-03-18T09:03:19Z"}, "body": "closes #3832", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3837/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3837/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3832", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3832/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3832/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3832/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3832", "id": 1169376430, "node_id": "I_kwDOAT0rQs5Fs0Su", "number": 3832, "title": "Maybe a bug about module checking", "user": {"login": "tirear", "id": 16443105, "node_id": "MDQ6VXNlcjE2NDQzMTA1", "avatar_url": "https://avatars.githubusercontent.com/u/16443105?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tirear", "html_url": "https://github.com/tirear", "followers_url": "https://api.github.com/users/tirear/followers", "following_url": "https://api.github.com/users/tirear/following{/other_user}", "gists_url": "https://api.github.com/users/tirear/gists{/gist_id}", "starred_url": "https://api.github.com/users/tirear/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tirear/subscriptions", "organizations_url": "https://api.github.com/users/tirear/orgs", "repos_url": "https://api.github.com/users/tirear/repos", "events_url": "https://api.github.com/users/tirear/events{/privacy}", "received_events_url": "https://api.github.com/users/tirear/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-03-15T09:02:29Z", "updated_at": "2022-03-18T09:03:19Z", "closed_at": "2022-03-18T09:03:19Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\nIf I use conda to install only jupyterhub and python (conda install -c conda-forge python=3.9 jupyterhub), the following message showed as someone try to login:\r\n\r\n```\r\nFailed to set groups [Errno 1] Operation not permitted\r\nTraceback (most recent call last):\r\n  File \"/home/someone/bin/anaconda3/envs/py39jupyterhub222/bin/jupyterhub-singleuser\", line 7, in <module>\r\n    from jupyterhub.singleuser import main\r\n  File \"/home/someone/bin/anaconda3/envs/py39jupyterhub222/lib/python3.9/site-packages/jupyterhub/singleuser/__init__.py\", line 5, in <module>\r\n    from .app import main\r\n  File \"/home/someone/bin/anaconda3/envs/py39jupyterhub222/lib/python3.9/site-packages/jupyterhub/singleuser/app.py\", line 38, in <module>\r\n    raise _import_error\r\nTypeError: exceptions must derive from BaseException\r\n```\r\nI think the problem is the lines from 32 to 36 in jupyterhub/singleuser/app.py\r\n```\r\n        except ImportError as e:\r\n            continue\r\n            if _import_error is None:\r\n                _import_error = e\r\n        else:\r\n            break\r\n```\r\n\r\nI changed that with:\r\n```\r\n        except ImportError as e:\r\n            if _import_error is None:\r\n                 _import_error = e\r\n            else:\r\n                break\r\n            continue\r\n```\r\nthen the better message showed:\r\n```\r\nFailed to set groups [Errno 1] Operation not permitted\r\nTraceback (most recent call last):\r\n  File \"/home/someone/bin/anaconda3/envs/py39jupyterhub222/bin/jupyterhub-singleuser\", line 7, in <module>\r\n    from jupyterhub.singleuser import main\r\n  File \"/home/someone/bin/anaconda3/envs/py39jupyterhub222/lib/python3.9/site-packages/jupyterhub/singleuser/__init__.py\", line 5, in <module>\r\n    from .app import main\r\n  File \"/home/someone/bin/anaconda3/envs/py39jupyterhub222/lib/python3.9/site-packages/jupyterhub/singleuser/app.py\", line 38, in <module>\r\n    raise _import_error\r\n  File \"/home/someone/bin/anaconda3/envs/py39jupyterhub222/lib/python3.9/site-packages/jupyterhub/singleuser/app.py\", line 30, in <module>\r\n    App = import_item(JUPYTERHUB_SINGLEUSER_APP)\r\n  File \"/home/someone/bin/anaconda3/envs/py39jupyterhub222/lib/python3.9/site-packages/traitlets/utils/importstring.py\", line 30, in import_item\r\n    module = __import__(package, fromlist=[obj])\r\nModuleNotFoundError: No module named 'jupyter_server'\r\n```\r\nThe above message let me know that I have to install jupyter_server.\r\nThis issue can be closed anytime.\r\nAny suggestion is welcome.\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3832/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3832/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3825", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3825/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3825/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3825/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3825", "id": 1166664271, "node_id": "PR_kwDOAT0rQs40T-dm", "number": 3825, "title": "Fix failure to update admin-react.js by re-compiling from our source", "user": {"login": "NarekA", "id": 737367, "node_id": "MDQ6VXNlcjczNzM2Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/737367?v=4", "gravatar_id": "", "url": "https://api.github.com/users/NarekA", "html_url": "https://github.com/NarekA", "followers_url": "https://api.github.com/users/NarekA/followers", "following_url": "https://api.github.com/users/NarekA/following{/other_user}", "gists_url": "https://api.github.com/users/NarekA/gists{/gist_id}", "starred_url": "https://api.github.com/users/NarekA/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/NarekA/subscriptions", "organizations_url": "https://api.github.com/users/NarekA/orgs", "repos_url": "https://api.github.com/users/NarekA/repos", "events_url": "https://api.github.com/users/NarekA/events{/privacy}", "received_events_url": "https://api.github.com/users/NarekA/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2022-03-11T17:14:51Z", "updated_at": "2022-03-11T23:43:15Z", "closed_at": "2022-03-11T17:33:34Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3825", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3825", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3825.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3825.patch", "merged_at": "2022-03-11T17:33:34Z"}, "body": "Last admin PR someone fixed a CI error but did not update `admin-react.js` ", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3825/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3825/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3823", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3823/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3823/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3823/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3823", "id": 1166135884, "node_id": "PR_kwDOAT0rQs40SOab", "number": 3823, "title": "Fix clearing cookie with custom xsrf cookie options", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-03-11T08:25:15Z", "updated_at": "2022-03-11T13:16:49Z", "closed_at": "2022-03-11T08:53:44Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3823", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3823", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3823.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3823.patch", "merged_at": "2022-03-11T08:53:43Z"}, "body": "clear_cookie only accepts path, domain cookie args\r\n\r\ncloses #3821", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3823/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3823/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3822", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3822/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3822/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3822/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3822", "id": 1166058157, "node_id": "PR_kwDOAT0rQs40R-LS", "number": 3822, "title": "Fix admin dashboard table sorting", "user": {"login": "NarekA", "id": 737367, "node_id": "MDQ6VXNlcjczNzM2Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/737367?v=4", "gravatar_id": "", "url": "https://api.github.com/users/NarekA", "html_url": "https://github.com/NarekA", "followers_url": "https://api.github.com/users/NarekA/followers", "following_url": "https://api.github.com/users/NarekA/following{/other_user}", "gists_url": "https://api.github.com/users/NarekA/gists{/gist_id}", "starred_url": "https://api.github.com/users/NarekA/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/NarekA/subscriptions", "organizations_url": "https://api.github.com/users/NarekA/orgs", "repos_url": "https://api.github.com/users/NarekA/repos", "events_url": "https://api.github.com/users/NarekA/events{/privacy}", "received_events_url": "https://api.github.com/users/NarekA/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-03-11T06:37:43Z", "updated_at": "2022-03-11T15:42:58Z", "closed_at": "2022-03-11T14:48:45Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3822", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3822", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3822.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3822.patch", "merged_at": "2022-03-11T14:48:45Z"}, "body": "My previous changes to the admin dashboard seems to introduce errors when sorting the table.\r\n\r\nBefore:\r\n\r\nhttps://user-images.githubusercontent.com/737367/157815221-62f28df7-c3c1-4b1b-8d3e-d68561839fe1.mov\r\n\r\n\r\nAfter:\r\n\r\nhttps://user-images.githubusercontent.com/737367/157815293-df0b4286-db2d-44f1-a9bd-bc44d51aa402.mov\r\n\r\n ", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3822/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3822/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3821", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3821/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3821/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3821/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3821", "id": 1165708920, "node_id": "I_kwDOAT0rQs5Fe054", "number": 3821, "title": "Jupyterhub logout TypeError with xsrf_cookie_kwargs", "user": {"login": "jwclark", "id": 3037927, "node_id": "MDQ6VXNlcjMwMzc5Mjc=", "avatar_url": "https://avatars.githubusercontent.com/u/3037927?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwclark", "html_url": "https://github.com/jwclark", "followers_url": "https://api.github.com/users/jwclark/followers", "following_url": "https://api.github.com/users/jwclark/following{/other_user}", "gists_url": "https://api.github.com/users/jwclark/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwclark/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwclark/subscriptions", "organizations_url": "https://api.github.com/users/jwclark/orgs", "repos_url": "https://api.github.com/users/jwclark/repos", "events_url": "https://api.github.com/users/jwclark/events{/privacy}", "received_events_url": "https://api.github.com/users/jwclark/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-03-10T20:55:56Z", "updated_at": "2022-03-11T08:53:44Z", "closed_at": "2022-03-11T08:53:43Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Jupyterhub version 2.1.1\r\n\r\nIf xsrf_cookie_kwargs (example below) are configured on Jupyterhub tornado_settings, the request to clear_cookie() in base.py clear_login_cookie during logout can result in the following error:\r\n\r\nTypeError: clear_cookie() got an unexpected keyword argument 'Secure'\r\n\r\nExample configuration:\r\n\r\n```python\r\nc.JupyterHub.tornado_settings = {\r\n    'xsrf_cookie_kwargs': {\r\n        'Secure': True\r\n    }\r\n  }\r\n```\r\n\r\nIt appears appears that the logout handler attempts to pass in all kwargs to web.py clear_cookies() method for the _xsrf cookie, which accepts only name, path and domain as parameters.\r\n\r\nhttps://github.com/jupyterhub/jupyterhub/blob/c23cddeb515dbcc0bc59c063ddba32d191624dcb/jupyterhub/handlers/base.py#L532\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3821/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3821/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3810", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3810/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3810/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3810/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3810", "id": 1155174112, "node_id": "PR_kwDOAT0rQs4zuGXn", "number": 3810, "title": "Keep Spawner.server in sync with underlying orm_spawner.server", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-03-01T10:42:57Z", "updated_at": "2022-03-04T09:06:54Z", "closed_at": "2022-03-01T17:40:33Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3810", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3810", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3810.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3810.patch", "merged_at": "2022-03-01T17:40:33Z"}, "body": "Rather than one-time sets of a cached `._server` attribute, which could become out-of-sync with underlying orm_spawner.server in complex situations (wrapspawner).\r\n\r\nKept as a property instead of using traitlets, because this is mapping a _secondary_ attribute of an existing trait (orm_spawner.server), and we can't watch for changes of attributes on the underlying ORM object. Traitlets only allows actions on assignment or first access, not on every access like properties, which allows us to ensure it's in sync on every access.\r\n\r\nrelated to https://github.com/jupyterhub/wrapspawner/pull/50", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3810/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3810/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3802", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3802/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3802/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3802/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3802", "id": 1146699263, "node_id": "PR_kwDOAT0rQs4zRkli", "number": 3802, "title": "Replace failed spawners when starting new launch", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-02-22T10:03:53Z", "updated_at": "2022-03-07T13:25:05Z", "closed_at": "2022-03-07T13:23:23Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3802", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3802", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3802.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3802.patch", "merged_at": "2022-03-07T13:23:22Z"}, "body": "Avoids leaving stale state when re-using a spawner that failed the last time it started (closes #3592)\r\n\r\nwe keep failed spawners around to track their errors, but we don't want to re-use them when it comes time to start a new launch.\r\n\r\nadds `User.get_spawner(server_name, replace_failed=True)` to always get a non-failed Spawner.\r\n\r\nThe alternative approach  is to change how we 'keep' failures around, e.g. in a separate failed-launches dict, so that `user.spawners['name']` never returns failed spawners. I suspect that would be _more_ complicated, though, not less.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3802/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3802/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3789", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3789/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3789/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3789/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3789", "id": 1127979379, "node_id": "I_kwDOAT0rQs5DO5lz", "number": 3789, "title": "Unable to configure Spawner.options_from_form, \"missing 1 required positional argument\"", "user": {"login": "rcthomas", "id": 78920, "node_id": "MDQ6VXNlcjc4OTIw", "avatar_url": "https://avatars.githubusercontent.com/u/78920?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rcthomas", "html_url": "https://github.com/rcthomas", "followers_url": "https://api.github.com/users/rcthomas/followers", "following_url": "https://api.github.com/users/rcthomas/following{/other_user}", "gists_url": "https://api.github.com/users/rcthomas/gists{/gist_id}", "starred_url": "https://api.github.com/users/rcthomas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rcthomas/subscriptions", "organizations_url": "https://api.github.com/users/rcthomas/orgs", "repos_url": "https://api.github.com/users/rcthomas/repos", "events_url": "https://api.github.com/users/rcthomas/events{/privacy}", "received_events_url": "https://api.github.com/users/rcthomas/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2022-02-09T02:37:45Z", "updated_at": "2022-02-14T14:49:43Z", "closed_at": "2022-02-14T14:49:30Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Bug description\r\n\r\n#### Expected behaviour\r\n\r\nBack in #3225 `Spawner.options_from_form` was made configurable, so I expected to be able to do something like this in a config file:\r\n\r\n```\r\nasync def options_from_form(spawner, form_data):\r\n    ...\r\n    return user_options\r\n\r\nc.Spawner.options_from_form = options_from_form\r\n```\r\n\r\n#### Actual behaviour\r\n\r\nWhen processing the form though, you get the following error:\r\n\r\n```\r\n[E 2022-02-09 02:28:34.484 JupyterHub pages:264] Failed to spawn single-user server with form\r\n    Traceback (most recent call last):\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/handlers/pages.py\", line 258, in _post\r\n        options = await maybe_future(spawner.options_from_form(form_options))\r\n    TypeError: options_from_form() missing 1 required positional argument: 'form_data'\r\n```\r\n\r\nIt looks like I'm really supposed to declare `async def options_from_form(form_data)` in my configuration and not be able to pass the spawner?  I realize that the function isn't supposed to have side effects and maybe (?) the idea behind not letting a user pass `spawner` along was to discourage side-effects, but it's somewhat inconvenient.\r\n\r\nNote that if you create a new Spawner class and customize `options_from_form` you get access to the spawner/self.  That discrepancy makes me think this is actually a bug.\r\n\r\n### How to reproduce\r\n\r\nThis `jupyterhub_config.py` seems to reproduce the problem:\r\n\r\n```\r\nasync def options_form(spawner):\r\n    return \"hello\"\r\n\r\nasync def options_from_form(spawner, form_data):\r\n    return {}\r\n\r\nc.Spawner.options_form = options_form\r\nc.Spawner.options_from_form = options_from_form\r\n```\r\n\r\nThe reproducer was confirmed using the `jupyterhub/jupyterhub:2` Docker container.\r\n\r\nI find that I'm able to get the behavior I expect by creating a `run_options_from_form` wrapper in the Spawner class following the style of the `pre_spawn_hook` etc. but this breaks the situation where the default `options_from_form` is used, or (I think) where `options_from_form` is defined as part of a `Spawner` class, not as a configurable.\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3789/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3789/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3788", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3788/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3788/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3788/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3788", "id": 1127729684, "node_id": "I_kwDOAT0rQs5DN8oU", "number": 3788, "title": "Named servers aren't listed on admin page", "user": {"login": "manics", "id": 1644105, "node_id": "MDQ6VXNlcjE2NDQxMDU=", "avatar_url": "https://avatars.githubusercontent.com/u/1644105?v=4", "gravatar_id": "", "url": "https://api.github.com/users/manics", "html_url": "https://github.com/manics", "followers_url": "https://api.github.com/users/manics/followers", "following_url": "https://api.github.com/users/manics/following{/other_user}", "gists_url": "https://api.github.com/users/manics/gists{/gist_id}", "starred_url": "https://api.github.com/users/manics/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/manics/subscriptions", "organizations_url": "https://api.github.com/users/manics/orgs", "repos_url": "https://api.github.com/users/manics/repos", "events_url": "https://api.github.com/users/manics/events{/privacy}", "received_events_url": "https://api.github.com/users/manics/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2022-02-08T20:32:27Z", "updated_at": "2022-02-14T08:25:25Z", "closed_at": "2022-02-14T08:25:25Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "### Bug description\r\nReported at https://discourse.jupyter.org/t/named-servers-do-not-show-up-in-admin-console-after-2-0-upgrade/12928\r\n\r\nNamed servers aren't listed on the hub admin page\r\n\r\n#### Expected behaviour\r\nJupyterHub 1.5.0 shows servers `test` and `test/named` for user `test`:\r\n![image](https://user-images.githubusercontent.com/1644105/153070145-2c107946-64fa-4a82-9797-d60076ae330c.png)\r\n\r\n#### Actual behaviour\r\nJupyterHub 2.1.1 does not show server `test/named`:\r\n![image](https://user-images.githubusercontent.com/1644105/153070240-def26f7e-5138-4824-9650-43d84b74df13.png)\r\n\r\n### How to reproduce\r\nStart a named server as a non-admin:\r\n![image](https://user-images.githubusercontent.com/1644105/153070410-68845fed-e6f7-4a2e-a3f0-959c5786f41d.png)\r\nLog on separately as an admin and go to `/hub/admin`\r\n\r\n### Your personal set up\r\n`jupyterhub_config.py`:\r\n```py\r\nc = get_config()\r\nc.JupyterHub.spawner_class = \"simple\"\r\nc.JupyterHub.authenticator_class = \"dummy\"\r\nc.Authenticator.admin_users = {'demo'}\r\nc.JupyterHub.allow_named_servers = True\r\nc.JupyterHub.named_server_limit_per_user = 2\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3788/reactions", "total_count": 2, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3788/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3783", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3783/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3783/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3783/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3783", "id": 1119382088, "node_id": "I_kwDOAT0rQs5CuGpI", "number": 3783, "title": "Getting \"Failed to check authorization: invalid_client\"", "user": {"login": "suhasadhav", "id": 9277450, "node_id": "MDQ6VXNlcjkyNzc0NTA=", "avatar_url": "https://avatars.githubusercontent.com/u/9277450?v=4", "gravatar_id": "", "url": "https://api.github.com/users/suhasadhav", "html_url": "https://github.com/suhasadhav", "followers_url": "https://api.github.com/users/suhasadhav/followers", "following_url": "https://api.github.com/users/suhasadhav/following{/other_user}", "gists_url": "https://api.github.com/users/suhasadhav/gists{/gist_id}", "starred_url": "https://api.github.com/users/suhasadhav/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/suhasadhav/subscriptions", "organizations_url": "https://api.github.com/users/suhasadhav/orgs", "repos_url": "https://api.github.com/users/suhasadhav/repos", "events_url": "https://api.github.com/users/suhasadhav/events{/privacy}", "received_events_url": "https://api.github.com/users/suhasadhav/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-01-31T12:44:08Z", "updated_at": "2022-01-31T14:00:33Z", "closed_at": "2022-01-31T13:18:32Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\nI am launching SingleNotebook server with Jupyterhub on Kubernetes. After launching the user server while redirecting with oauth_callback am getting 500 error saying \"Failed to check authorization: invalid_client\"\r\n\r\n\r\n#### Expected behaviour\r\nAfter authentication it should load single user notebook server page.\r\n\r\n#### Actual behaviour\r\nGetting 500 error saying \"Failed to check authorization: invalid_client\"\r\n\r\n![image](https://user-images.githubusercontent.com/9277450/151792891-ba51129e-cd7a-4c8b-bbe1-9ef0c1e3ff7a.png)\r\n\r\n\r\n### Your personal set up\r\nEnv: Kubernetes, KubeSpawner\r\nAuthenticator: Dummy\r\n\r\nJupyterlab: Version 2.2.8\r\n\r\n- <details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\nbash-4.4$ pip3 freeze\r\nalembic==1.7.5\r\nargon2-cffi==21.1.0\r\nasync-generator==1.10\r\nattrs==21.2.0\r\nbackcall==0.2.0\r\nbleach==4.1.0\r\ncertifi==2021.10.8\r\ncertipy==0.1.3\r\ncffi==1.15.0\r\ncharset-normalizer==2.0.8\r\ncolorama==0.4.4\r\ncryptography==36.0.0\r\ndebugpy==1.5.1\r\ndecorator==5.1.0\r\ndefusedxml==0.7.1\r\nentrypoints==0.3\r\nfindspark==1.4.2\r\ngitdb==4.0.9\r\nGitPython==3.1.24\r\ngreenlet==1.1.2\r\nidna==3.3\r\nipykernel==6.5.1\r\nipython==7.30.0\r\nipython-genutils==0.2.0\r\nipywidgets==7.6.5\r\njedi==0.18.1\r\nJinja2==3.0.3\r\njson5==0.9.6\r\njsonschema==4.2.1\r\njupyter-client==7.1.0\r\njupyter-core==4.9.1\r\njupyter-telemetry==0.1.0\r\njupyterhub==1.2.1\r\njupyterlab==2.2.8\r\njupyterlab-git==0.22.2\r\njupyterlab-pygments==0.1.2\r\njupyterlab-server==1.2.0\r\njupyterlab-widgets==1.0.2\r\nMako==1.1.6\r\nMarkupSafe==2.0.1\r\nmatplotlib-inline==0.1.3\r\nmetakernel==0.28.1\r\nmistune==0.8.4\r\nnbclient==0.5.9\r\nnbconvert==6.3.0\r\nnbdime==2.1.1\r\nnbformat==5.1.3\r\nnest-asyncio==1.5.1\r\nnotebook==6.1.5\r\nnumpy==1.21.4\r\noauthlib==3.1.1\r\npackaging==21.3\r\npamela==1.0.0\r\npandas==1.3.4\r\npandocfilters==1.5.0\r\nparso==0.8.3\r\npexpect==4.8.0\r\npickleshare==0.7.5\r\nprometheus-client==0.12.0\r\nprompt-toolkit==3.0.23\r\nptyprocess==0.7.0\r\npy4j==0.10.9.2\r\npyarrow==6.0.1\r\npycparser==2.21\r\nPygments==2.10.0\r\npyOpenSSL==21.0.0\r\npyparsing==3.0.6\r\npyrsistent==0.18.0\r\npyspark==3.2.0\r\npython-dateutil==2.8.2\r\npython-json-logger==2.0.2\r\npytz==2021.3\r\nPyYAML==6.0\r\npyzmq==22.3.0\r\nrequests==2.26.0\r\nruamel.yaml==0.17.17\r\nruamel.yaml.clib==0.2.6\r\nSend2Trash==1.8.0\r\nsix==1.16.0\r\nsmmap==5.0.0\r\nspylon==0.3.0\r\nspylon-kernel==0.4.1\r\nSQLAlchemy==1.4.27\r\nterminado==0.12.1\r\ntestpath==0.5.0\r\ntornado==6.1\r\ntraitlets==5.1.1\r\ntyping-extensions==4.0.1\r\nurllib3==1.26.7\r\nwcwidth==0.2.5\r\nwebencodings==0.5.1\r\nwidgetsnbextension==3.5.2\r\n```\r\n</details>\r\n\r\n- <details><summary>Configuration</summary>\r\n\r\n\r\n```python\r\nc.ConfigurableHTTPProxy.should_start = False\r\nc.ConfigurableHTTPProxy.api_url = f\"http://jupyter-hub-proxy-api:8001\"\r\n\r\nc.JupyterHub.hub_bind_url = f'http://:8080'\r\nc.JupyterHub.hub_connect_url = f\"http://jupyter-hub:8080\"\r\n\r\nc.JupyterHub.spawner_class = 'kubespawner.KubeSpawner'\r\nc.KubeSpawner.cmd = [\"start.sh\", \"--SingleUserNotebookApp.default_url=/lab\"]\r\nc.Spawner.http_timeout = 1800\r\nc.Spawner.start_timeout = 1800\r\n\r\nc.KubeSpawner.storage_capacity = \"300M\"\r\nc.KubeSpawner.delete_pvc = False\r\nc.KubeSpawner.pvc_name_template = 'claim-{username}--{servername}'\r\nc.KubeSpawner.storage_pvc_ensure = True\r\nc.KubeSpawner.working_dir = \"/home/admin\"\r\nc.KubeSpawner.cpu_guarantee = 0.1\r\nc.KubeSpawner.mem_guarantee = \"0.5G\"\r\nc.KubeSpawner.cpu_limit = 2\r\nc.KubeSpawner.mem_limit = \"4G\"\r\nc.KubeSpawner.namespace = \"jupyterhub-qa\"\r\nc.KubeSpawner.image_pull_policy='Always'\r\n\r\nc.KubeSpawner.image = 'artifactorycn.suhas.com:17014/product/pyspark-jupyterhub_build:0.1-2'\r\n\r\nc.KubeSpawner.environment.update({\r\n        \"HADOOP_CONF_DIR\": \"/etc/hadoop/conf\",\r\n        \"SPARK_CONF_DIR\": \"/home/admin/conf\",\r\n        \"PYSPARK_PYTHON\": \"/usr/local/bin/python3.9\",\r\n        \"PYSPARK_DRIVER_PYTHON\": \"/usr/local/bin/python3.9\",\r\n        \"JUPYTERHUB_API_URL\": \"http://jupyter.jupyterhub-qa.datahub2-suhas.cloud/hub/api\",\r\n        \"JUPYTERHUB_ACTIVITY_URL\": \"http://jupyter.jupyterhub-qa.datahub2-suhas.cloud/hub/api/users/{username}/activity\"\r\n})\r\nc.KubeSpawner.volume_mounts = [{\r\n          \"name\": \"get-hadoop-conf\",\r\n          \"mountPath\": \"/scripts/get_hadoop_conf.sh\",\r\n          \"subPath\": \"get_hadoop_conf.sh\"\r\n},{\r\n          \"name\": \"clean-hive-config\",\r\n          \"mountPath\": \"/scripts/clean_hive_config.py\",\r\n          \"subPath\": \"clean_hive_config.py\"\r\n},{\r\n          \"name\": \"claim-{username}--{servername}\",\r\n          \"mountPath\": \"/home/admin\",\r\n          \"subPath\": \"value\"\r\n},{\r\n          \"name\": \"spark-conf\",\r\n          \"mountPath\": \"/tmp/spark-defaults.conf\",\r\n          \"subPath\": \"spark-defaults.conf\"\r\n},{\r\n          \"name\": \"pyspark-init-configmap\",\r\n          \"mountPath\": \"/scripts/pyspark-init.sh\",\r\n          \"subPath\": \"pyspark-init.sh\"\r\n}]\r\n\r\nc.KubeSpawner.volumes = [{\r\n        \"name\": \"claim-{username}--{servername}\",\r\n        \"persistentVolumeClaim\": {\r\n          \"claimName\": \"claim-{username}--{servername}\"\r\n        }\r\n        },{\r\n        \"name\": \"get-hadoop-conf\",\r\n        \"configMap\": {\r\n          \"name\": \"get-hadoop-conf\",\r\n          \"defaultMode\": 0o0777\r\n        }\r\n        },{\r\n        \"name\": \"clean-hive-config\",\r\n        \"configMap\": {\r\n          \"name\": \"clean-hive-config\",\r\n          \"defaultMode\": 0o0777\r\n        }\r\n        },{\r\n        \"name\": \"spark-conf\",\r\n        \"configMap\": {\r\n          \"name\": \"spark-conf\",\r\n          \"defaultMode\": 0o0777\r\n        }\r\n        },{\r\n        \"name\": \"pyspark-init-configmap\",\r\n        \"configMap\": {\r\n          \"name\": \"pyspark-init-configmap\",\r\n          \"defaultMode\": 0o0777\r\n        }\r\n        }\r\n]\r\nc.KubeSpawner.extra_labels = {\r\n\"username\": \"{username}\",\r\n\"spark\": \"{username}-driver\"\r\n}\r\nc.KubeSpawner.service_account = \"jupyter-hub\"\r\nc.JupyterHub.authenticator_class = \"jupyterhub.auth.DummyAuthenticator\"\r\nc.Authenticator.whitelist = ['user']\r\nc.DummyAuthenticator.password = \"useruser\"\r\nc.KubeSpawner.extra_container_config = {\r\n  \"ports\": [\r\n    {\r\n      \"name\": \"http\",\r\n      \"containerPort\": 8080,\r\n      \"protocol\": \"TCP\"\r\n    },\r\n    {\r\n      \"name\": \"blockmanager\",\r\n      \"containerPort\": 7777,\r\n      \"protocol\": \"TCP\"\r\n    },\r\n    {\r\n      \"name\": \"driver\",\r\n      \"containerPort\": 2222,\r\n      \"protocol\": \"TCP\"\r\n    }\r\n  ],\r\n  \"securityContext\": {\r\n    \"runAsUser\": 1000\r\n  }\r\n}\r\nc.KubeSpawner.lifecycle_hooks = {\r\n  \"postStart\": {\r\n    \"exec\": {\r\n        \"command\": [\"/bin/bash\", \"-c\", \"/scripts/pyspark-init.sh\"]\r\n    }\r\n  }\r\n}\r\nc.KubeSpawner.extra_pod_config = {\r\n  \"hostNetwork\": True\r\n}```\r\n</details>\r\n\r\n\r\n```\r\n# paste relevant logs here, if any\r\n**JupyterHub Logs:**\r\n[D 2022-01-31 12:27:00.762 JupyterHub application:730] Looking for /etc/jupyterhub/jupyterhub_config in /srv/jupyterhub\r\n[D 2022-01-31 12:27:00.763 JupyterHub application:752] Loaded config file: /etc/jupyterhub/jupyterhub_config.py\r\n[I 2022-01-31 12:27:01.085 JupyterHub app:2332] Running JupyterHub version 1.2.1\r\n[I 2022-01-31 12:27:01.086 JupyterHub app:2362] Using Authenticator: jupyterhub.auth.DummyAuthenticator-1.2.1\r\n[I 2022-01-31 12:27:01.086 JupyterHub app:2362] Using Spawner: kubespawner.spawner.KubeSpawner-0.14.1\r\n[I 2022-01-31 12:27:01.086 JupyterHub app:2362] Using Proxy: jupyterhub.proxy.ConfigurableHTTPProxy-1.2.1\r\n[D 2022-01-31 12:27:01.099 JupyterHub app:1452] Generating new cookie_secret\r\n[I 2022-01-31 12:27:01.100 JupyterHub app:1457] Writing cookie_secret to /srv/jupyterhub/jupyterhub_cookie_secret\r\n[D 2022-01-31 12:27:01.101 JupyterHub app:1579] Connecting to db: sqlite:///jupyterhub.sqlite\r\n[D 2022-01-31 12:27:01.119 JupyterHub orm:784] Stamping empty database with alembic revision 4dc2d5a8c53c\r\n[I 2022-01-31 12:27:01.125 alembic.runtime.migration migration:155] Context impl SQLiteImpl.\r\n[I 2022-01-31 12:27:01.125 alembic.runtime.migration migration:158] Will assume non-transactional DDL.\r\n[I 2022-01-31 12:27:01.140 alembic.runtime.migration migration:517] Running stamp_revision  -> 4dc2d5a8c53c\r\n[D 2022-01-31 12:27:01.141 alembic.runtime.migration migration:727] new branch insert 4dc2d5a8c53c\r\n[W 2022-01-31 12:27:01.297 JupyterHub auth:153] DummyAuthenticator.whitelist is deprecated in JupyterHub 1.2, use DummyAuthenticator.allowed_users instead\r\n[W 2022-01-31 12:27:01.297 JupyterHub app:1687] No admin users, admin interface will be unavailable.\r\n[W 2022-01-31 12:27:01.297 JupyterHub app:1688] Add any administrative users to `c.Authenticator.admin_users` in config.\r\n[D 2022-01-31 12:27:01.354 JupyterHub app:1869] Purging expired APITokens\r\n[D 2022-01-31 12:27:01.357 JupyterHub app:1869] Purging expired OAuthAccessTokens\r\n[D 2022-01-31 12:27:01.359 JupyterHub app:1869] Purging expired OAuthCodes\r\n[D 2022-01-31 12:27:01.367 JupyterHub app:1996] Initializing spawners\r\n[D 2022-01-31 12:27:01.369 JupyterHub app:2129] Loaded users:\r\n    \r\n[I 2022-01-31 12:27:01.369 JupyterHub app:2399] Initialized 0 spawners in 0.003 seconds\r\n[I 2022-01-31 12:27:01.371 JupyterHub app:2611] Not starting proxy\r\n[D 2022-01-31 12:27:01.372 JupyterHub proxy:766] Proxy: Fetching GET http://jupyter-hub-proxy-api:8001/api/routes\r\n[I 2022-01-31 12:27:01.379 JupyterHub app:2647] Hub API listening on http://:8080/hub/\r\n[I 2022-01-31 12:27:01.379 JupyterHub app:2649] Private Hub API connect url http://jupyter-hub:8080/hub/\r\n[D 2022-01-31 12:27:01.379 JupyterHub proxy:315] Fetching routes to check\r\n[D 2022-01-31 12:27:01.379 JupyterHub proxy:766] Proxy: Fetching GET http://jupyter-hub-proxy-api:8001/api/routes\r\n[I 2022-01-31 12:27:01.382 JupyterHub proxy:320] Checking routes\r\n[W 2022-01-31 12:27:01.382 JupyterHub proxy:391] Deleting stale route /user/nikolay/\r\n[D 2022-01-31 12:27:01.382 JupyterHub proxy:766] Proxy: Fetching DELETE http://jupyter-hub-proxy-api:8001/api/routes/user/nikolay\r\n[I 2022-01-31 12:27:01.384 JupyterHub app:2722] JupyterHub is now running at http://:8000\r\n[D 2022-01-31 12:27:01.385 JupyterHub app:2325] It took 0.628 seconds for the Hub to start\r\n[I 2022-01-31 12:27:38.227 JupyterHub log:181] 302 GET / -> /hub/ (@192.168.0.18) 1.26ms\r\n[W 2022-01-31 12:27:38.596 JupyterHub base:389] Invalid or expired cookie token\r\n[I 2022-01-31 12:27:38.597 JupyterHub log:181] 302 GET /hub/ -> /hub/login (@192.168.0.18) 1.70ms\r\n[I 2022-01-31 12:27:39.033 JupyterHub log:181] 200 GET /hub/login (@192.168.0.18) 34.19ms\r\n[D 2022-01-31 12:27:49.686 JupyterHub base:523] Setting cookie for nikolay: jupyterhub-hub-login\r\n[D 2022-01-31 12:27:49.686 JupyterHub base:519] Setting cookie jupyterhub-hub-login: {'httponly': True, 'path': '/hub/'}\r\n[I 2022-01-31 12:27:49.687 JupyterHub base:746] User logged in: nikolay\r\n[D 2022-01-31 12:27:49.687 JupyterHub user:289] Creating <class 'kubespawner.spawner.KubeSpawner'> for nikolay:\r\n[W 2022-01-31 12:27:49.690 JupyterHub configurable:190] Config option `delete_pvc` not recognized by `KubeSpawner`.\r\n[D 2022-01-31 12:27:49.690 JupyterHub spawner:172] Starting executor thread pool with 20 workers\r\n[I 2022-01-31 12:27:49.705 JupyterHub reflector:201] watching for pods with label selector='component=singleuser-server' in namespace jupyterhub-qa\r\n[D 2022-01-31 12:27:49.705 JupyterHub reflector:206] Connecting pods watcher\r\n[I 2022-01-31 12:27:49.724 JupyterHub reflector:201] watching for events with field selector='involvedObject.kind=Pod' in namespace jupyterhub-qa\r\n[D 2022-01-31 12:27:49.724 JupyterHub reflector:206] Connecting events watcher\r\n[I 2022-01-31 12:27:49.727 JupyterHub log:181] 302 POST /hub/login?next= -> /hub/spawn (nikolay@192.168.0.18) 60.87ms\r\n[D 2022-01-31 12:27:50.104 JupyterHub base:282] Recording first activity for <User(nikolay 0/1 running)>\r\n[D 2022-01-31 12:27:50.115 JupyterHub pages:213] Triggering spawn with default options for nikolay\r\n[D 2022-01-31 12:27:50.116 JupyterHub base:864] Initiating spawn for nikolay\r\n[D 2022-01-31 12:27:50.116 JupyterHub base:868] 0/100 concurrent spawns\r\n[D 2022-01-31 12:27:50.116 JupyterHub base:873] 0 active servers\r\n[D 2022-01-31 12:27:50.170 JupyterHub user:603] Calling Spawner.start for nikolay\r\n[I 2022-01-31 12:27:50.171 JupyterHub spawner:1840] Attempting to create pvc claim-nikolay, with timeout 3\r\n[I 2022-01-31 12:27:50.190 JupyterHub spawner:1852] PVC claim-nikolay already exists, so did not create new pvc.\r\n[W 2022-01-31 12:27:50.194 JupyterHub utils:70] 'notebook_container.ports' current value: '[{'container_port': 8888,\r\n     'host_ip': None,\r\n     'host_port': None,\r\n     'name': 'notebook-port',\r\n     'protocol': None}]' is overridden with '[{'name': 'http', 'containerPort': 8080, 'protocol': 'TCP'}, {'name': 'blockmanager', 'containerPort': 7777, 'protocol': 'TCP'}, {'name': 'driver', 'containerPort': 2222, 'protocol': 'TCP'}]', which is the value of 'extra_container_config.ports'.\r\n[W 2022-01-31 12:27:50.194 JupyterHub utils:70] 'notebook_container.security_context' current value: '{'allow_privilege_escalation': None,\r\n     'capabilities': None,\r\n     'privileged': None,\r\n     'proc_mount': None,\r\n     'read_only_root_filesystem': None,\r\n     'run_as_group': 0,\r\n     'run_as_non_root': None,\r\n     'run_as_user': 0,\r\n     'se_linux_options': None,\r\n     'windows_options': None}' is overridden with '{'runAsUser': 1000}', which is the value of 'extra_container_config.security_context'.\r\n[I 2022-01-31 12:27:50.195 JupyterHub spawner:1805] Attempting to create pod jupyter-nikolay, with timeout 3\r\n[I 2022-01-31 12:27:51.117 JupyterHub log:181] 302 GET /hub/spawn -> /hub/spawn-pending/nikolay (nikolay@192.168.0.18) 1014.96ms\r\n[I 2022-01-31 12:27:51.509 JupyterHub pages:398] nikolay is pending spawn\r\n[I 2022-01-31 12:27:51.514 JupyterHub log:181] 200 GET /hub/spawn-pending/nikolay (nikolay@192.168.0.18) 8.05ms\r\n[D 2022-01-31 12:27:54.795 JupyterHub spawner:1676] progress generator: jupyter-nikolay\r\n[D 2022-01-31 12:27:59.715 JupyterHub reflector:275] pods watcher timeout\r\n[D 2022-01-31 12:27:59.715 JupyterHub reflector:206] Connecting pods watcher\r\n[D 2022-01-31 12:27:59.734 JupyterHub reflector:275] events watcher timeout\r\n[D 2022-01-31 12:27:59.734 JupyterHub reflector:206] Connecting events watcher\r\n[W 2022-01-31 12:28:00.118 JupyterHub base:992] User nikolay is slow to start (timeout=10)\r\n[D 2022-01-31 12:28:09.723 JupyterHub reflector:275] pods watcher timeout\r\n[D 2022-01-31 12:28:09.723 JupyterHub reflector:206] Connecting pods watcher\r\n[D 2022-01-31 12:28:09.748 JupyterHub reflector:275] events watcher timeout\r\n[D 2022-01-31 12:28:09.748 JupyterHub reflector:206] Connecting events watcher\r\n[D 2022-01-31 12:28:10.796 JupyterHub spawner:1936] pod jupyter-nikolay events before launch: 2022-01-31T12:27:50.208424Z [Normal] Successfully assigned jupyterhub-qa/jupyter-nikolay to worker3-datahub-msk8s\r\n    2022-01-31T12:27:55Z [Normal] AttachVolume.Attach succeeded for volume \"pvc-cebd6c00-1e4b-4309-b4e2-ac80770377b7\" \r\n    2022-01-31T12:28:06Z [Normal] Pulling image \"artifactorycn.suhas.com:17014/product/pyspark-jupyterhub_build:0.1-2\"\r\n    2022-01-31T12:28:07Z [Normal] Successfully pulled image \"artifactorycn.suhas.com:17014/product/pyspark-jupyterhub_build:0.1-2\" in 283.848368ms\r\n    2022-01-31T12:28:07Z [Normal] Created container notebook\r\n    2022-01-31T12:28:07Z [Normal] Started container notebook\r\n[D 2022-01-31 12:28:10.806 JupyterHub spawner:1151] Polling subprocess every 30s\r\n[D 2022-01-31 12:28:10.822 JupyterHub utils:220] Server at http://192.168.0.19:8888/user/nikolay/ responded with 302\r\n[D 2022-01-31 12:28:10.823 JupyterHub _version:76] jupyterhub and jupyterhub-singleuser both on version 1.2.1\r\n[I 2022-01-31 12:28:10.823 JupyterHub base:893] User nikolay took 20.707 seconds to start\r\n[I 2022-01-31 12:28:10.823 JupyterHub proxy:258] Adding user nikolay to proxy /user/nikolay/ => http://192.168.0.19:8888\r\n[D 2022-01-31 12:28:10.823 JupyterHub proxy:766] Proxy: Fetching POST http://jupyter-hub-proxy-api:8001/api/routes/user/nikolay\r\n[I 2022-01-31 12:28:10.827 JupyterHub users:609] Server nikolay is ready\r\n[I 2022-01-31 12:28:10.828 JupyterHub log:181] 200 GET /hub/api/users/nikolay/server/progress (nikolay@192.168.0.18) 16037.70ms\r\n[I 2022-01-31 12:28:11.284 JupyterHub log:181] 302 GET /hub/spawn-pending/nikolay -> /user/nikolay/ (nikolay@192.168.0.18) 3.65ms\r\n[D 2022-01-31 12:28:12.438 JupyterHub provider:409] Validating client id jupyterhub-user-nikolay\r\n[D 2022-01-31 12:28:12.439 JupyterHub provider:484] validate_redirect_uri: client_id=jupyterhub-user-nikolay, redirect_uri=/user/nikolay/oauth_callback\r\n[D 2022-01-31 12:28:12.443 JupyterHub auth:244] Skipping oauth confirmation for <User(nikolay 1/1 running)> accessing Server at /user/nikolay/\r\n[D 2022-01-31 12:28:12.444 JupyterHub provider:409] Validating client id jupyterhub-user-nikolay\r\n[D 2022-01-31 12:28:12.445 JupyterHub provider:484] validate_redirect_uri: client_id=jupyterhub-user-nikolay, redirect_uri=/user/nikolay/oauth_callback\r\n[D 2022-01-31 12:28:12.447 JupyterHub provider:231] Saving authorization code jupyterhub-user-nikolay, NTr..., (), {}\r\n[I 2022-01-31 12:28:12.459 JupyterHub log:181] 302 GET /hub/api/oauth2/authorize?client_id=jupyterhub-user-nikolay&redirect_uri=%2Fuser%2Fnikolay%2Foauth_callback&response_type=code&state=[secret] -> /user/nikolay/oauth_callback?code=[secret]&state=[secret] (nikolay@192.168.0.18) 24.79ms\r\n\r\n\r\n\r\n**SingleNotebook Logs:**\r\n[W 2022-01-31 12:28:08.047 SingleUserNotebookApp configurable:193] Config option `open_browser` not recognized by `SingleUserNotebookApp`.  Did you mean `browser`?\r\n[D 2022-01-31 12:28:08.051 SingleUserNotebookApp config_manager:97] Paths used for configuration of jupyter_notebook_config: \r\n    \t/etc/jupyter/jupyter_notebook_config.json\r\n[D 2022-01-31 12:28:08.052 SingleUserNotebookApp config_manager:97] Paths used for configuration of jupyter_notebook_config: \r\n    \t/usr/local/etc/jupyter/jupyter_notebook_config.d/jupyterlab.json\r\n    \t/usr/local/etc/jupyter/jupyter_notebook_config.d/jupyterlab_git.json\r\n    \t/usr/local/etc/jupyter/jupyter_notebook_config.d/nbdime.json\r\n    \t/usr/local/etc/jupyter/jupyter_notebook_config.json\r\n[D 2022-01-31 12:28:08.053 SingleUserNotebookApp config_manager:97] Paths used for configuration of jupyter_notebook_config: \r\n    \t/usr/etc/jupyter/jupyter_notebook_config.json\r\n[D 2022-01-31 12:28:08.053 SingleUserNotebookApp config_manager:97] Paths used for configuration of jupyter_notebook_config: \r\n    \t/home/admin/.local/etc/jupyter/jupyter_notebook_config.json\r\n[D 2022-01-31 12:28:08.053 SingleUserNotebookApp config_manager:97] Paths used for configuration of jupyter_notebook_config: \r\n    \t/home/admin/.jupyter/jupyter_notebook_config.json\r\n[I 2022-01-31 12:28:08.852 SingleUserNotebookApp extension:162] JupyterLab extension loaded from /usr/local/lib/python3.9/site-packages/jupyterlab\r\n[I 2022-01-31 12:28:08.852 SingleUserNotebookApp extension:163] JupyterLab application directory is /usr/local/share/jupyter/lab\r\n[D 2022-01-31 12:28:08.945 SingleUserNotebookApp loader:499] Using default logger\r\n[D 2022-01-31 12:28:08.945 SingleUserNotebookApp loader:499] Using default logger\r\n[D 2022-01-31 12:28:08.946 SingleUserNotebookApp loader:499] Using default logger\r\n[D 2022-01-31 12:28:08.946 SingleUserNotebookApp loader:499] Using default logger\r\n[D 2022-01-31 12:28:08.946 SingleUserNotebookApp loader:499] Using default logger\r\n[D 2022-01-31 12:28:08.946 SingleUserNotebookApp loader:499] Using default logger\r\n[I 2022-01-31 12:28:08.948 SingleUserNotebookApp mixins:558] Starting jupyterhub-singleuser server version 1.2.1\r\n[I 2022-01-31 12:28:10.822 SingleUserNotebookApp log:181] 302 GET /user/nikolay/ -> /user/nikolay/lab? (@192.168.0.6) 1.41ms\r\n[I 2022-01-31 12:28:11.663 SingleUserNotebookApp log:181] 302 GET /user/nikolay/ -> /user/nikolay/lab? (@192.168.0.18) 1.19ms\r\n[D 2022-01-31 12:28:11.978 SingleUserNotebookApp _version:76] jupyterhub and jupyterhub-singleuser both on version 1.2.1\r\n[I 2022-01-31 12:28:11.979 SingleUserNotebookApp notebookapp:2209] Serving notebooks from local directory: /home/admin\r\n[I 2022-01-31 12:28:11.979 SingleUserNotebookApp notebookapp:2209] Jupyter Notebook 6.1.5 is running at:\r\n[I 2022-01-31 12:28:11.979 SingleUserNotebookApp notebookapp:2209] http://worker3-datahub-msk8s:8888/user/nikolay/\r\n[I 2022-01-31 12:28:11.979 SingleUserNotebookApp notebookapp:2210] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).\r\n[I 2022-01-31 12:28:11.984 SingleUserNotebookApp mixins:538] Updating Hub with activity every 300 seconds\r\n[D 2022-01-31 12:28:11.984 SingleUserNotebookApp mixins:500] Notifying Hub of activity 2022-01-31T12:28:08.064737Z\r\n[E 2022-01-31 12:28:12.003 SingleUserNotebookApp mixins:520] Error notifying Hub of activity\r\n    Traceback (most recent call last):\r\n      File \"/usr/local/lib/python3.9/site-packages/jupyterhub/singleuser/mixins.py\", line 518, in notify\r\n        await client.fetch(req)\r\n    tornado.httpclient.HTTPClientError: HTTP 403: Forbidden\r\n[D 2022-01-31 12:28:12.042 SingleUserNotebookApp auth:505] No user identified\r\n[D 2022-01-31 12:28:12.044 SingleUserNotebookApp auth:836] Redirecting to login url: /hub/api/oauth2/authorize?client_id=jupyterhub-user-nikolay&redirect_uri=%2Fuser%2Fnikolay%2Foauth_callback&response_type=code&state=eyJ1dWlkIjogImYxNWE3Y2VjNTUyNDQ0ZTJhMjc1ZDEwZGQ5M2VlZTIyIiwgIm5leHRfdXJsIjogIi91c2VyL25pa29sYXkvbGFiPyJ9\r\n**[I 2022-01-31 12:28:12.045 SingleUserNotebookApp log:181] 302 GET /user/nikolay/lab? -> /hub/api/oauth2/authorize?client_id=jupyterhub-user-nikolay&redirect_uri=%2Fuser%2Fnikolay%2Foauth_callback&response_type=code&state=[secret] (@192.168.0.18) 3.72ms\r\n[D 2022-01-31 12:28:12.838 SingleUserNotebookApp auth:505] No user identified\r\n[W 2022-01-31 12:28:12.863 SingleUserNotebookApp auth:369] Failed to check authorization: [401] Unauthorized\r\n[W 2022-01-31 12:28:12.863 SingleUserNotebookApp auth:372] {\"error\": \"invalid_client\"}\r\n[W 2022-01-31 12:28:12.863 SingleUserNotebookApp web:1787] 500 GET /user/nikolay/oauth_callback?code=NTreocWmFXzSk7ar24ZK7OzTjdaSfE&state=eyJ1dWlkIjogImYxNWE3Y2VjNTUyNDQ0ZTJhMjc1ZDEwZGQ5M2VlZTIyIiwgIm5leHRfdXJsIjogIi91c2VyL25pa29sYXkvbGFiPyJ9 (192.168.0.18): Failed to check authorization: invalid_client**\r\n[D 2022-01-31 12:28:12.864 SingleUserNotebookApp handlers:251] Using contents: services/contents\r\n[D 2022-01-31 12:28:12.865 SingleUserNotebookApp handlers:251] Using contents: services/contents\r\n```\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3783/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3783/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3781", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3781/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3781/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3781/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3781", "id": 1116191546, "node_id": "PR_kwDOAT0rQs4xrLdA", "number": 3781, "title": "Log proxy's public_url only when started by JupyterHub", "user": {"login": "cqzlxl", "id": 2704658, "node_id": "MDQ6VXNlcjI3MDQ2NTg=", "avatar_url": "https://avatars.githubusercontent.com/u/2704658?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cqzlxl", "html_url": "https://github.com/cqzlxl", "followers_url": "https://api.github.com/users/cqzlxl/followers", "following_url": "https://api.github.com/users/cqzlxl/following{/other_user}", "gists_url": "https://api.github.com/users/cqzlxl/gists{/gist_id}", "starred_url": "https://api.github.com/users/cqzlxl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cqzlxl/subscriptions", "organizations_url": "https://api.github.com/users/cqzlxl/orgs", "repos_url": "https://api.github.com/users/cqzlxl/repos", "events_url": "https://api.github.com/users/cqzlxl/events{/privacy}", "received_events_url": "https://api.github.com/users/cqzlxl/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-01-27T13:06:51Z", "updated_at": "2022-01-29T08:16:31Z", "closed_at": "2022-01-29T08:16:29Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3781", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3781", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3781.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3781.patch", "merged_at": "2022-01-29T08:16:29Z"}, "body": "When we run the proxy separately,  defaults of `hub.bind_url` may be different from proxy's public url. Actually, the hub has no ways to know about which address the proxy is serving at if we do not configure its `bind_url` explicitly.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3781/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3781/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3780", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3780/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3780/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3780/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3780", "id": 1114154335, "node_id": "I_kwDOAT0rQs5CaKVf", "number": 3780, "title": "Apache ReverseProxy not working with Hub 2.0.1 and later.", "user": {"login": "bviviano", "id": 29630477, "node_id": "MDQ6VXNlcjI5NjMwNDc3", "avatar_url": "https://avatars.githubusercontent.com/u/29630477?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bviviano", "html_url": "https://github.com/bviviano", "followers_url": "https://api.github.com/users/bviviano/followers", "following_url": "https://api.github.com/users/bviviano/following{/other_user}", "gists_url": "https://api.github.com/users/bviviano/gists{/gist_id}", "starred_url": "https://api.github.com/users/bviviano/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bviviano/subscriptions", "organizations_url": "https://api.github.com/users/bviviano/orgs", "repos_url": "https://api.github.com/users/bviviano/repos", "events_url": "https://api.github.com/users/bviviano/events{/privacy}", "received_events_url": "https://api.github.com/users/bviviano/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 17, "created_at": "2022-01-25T17:12:35Z", "updated_at": "2022-03-07T15:47:10Z", "closed_at": "2022-03-01T13:14:35Z", "author_association": "NONE", "active_lock_reason": null, "body": "I am using Apache as a reverse proxy to frontend JupyterHub to my HPC cluster with wrapspawner and batchspawner.  Everything has worked fine, until I attempted to update the version of Jupyter*.  After some testing, it seems that between the 2.0.0 and 2.0.1 release of Hub is where I have problems and start getting messages like\r\n\r\n```\r\n[W 2022-01-25 11:26:32.887 JupyterHub base:90] Blocking Cross Origin API request.  Referer: https://luna1.mysite.com/jupyter/hub/spawn-pending/bdk, Host: luna1.mysite.com, Host URL: http://luna1.mysite.com/jupyter/hub/\r\n[W 2022-01-25 11:26:32.887 JupyterHub scopes:498] Not authorizing access to /jupyter/hub/api/users/bdk/server/progress. Requires any of [read:servers], not derived from scopes []\r\n[W 2022-01-25 11:26:32.887 JupyterHub web:1787] 403 GET /jupyter/hub/api/users/bdk/server/progress (::ffff:127.0.0.1): Action is not authorized with current scopes; requires any of [read:servers]\r\n[W 2022-01-25 11:26:32.888 JupyterHub log:189] 403 GET /jupyter/hub/api/users/bdk/server/progress (@::ffff:127.0.0.1) 2.94ms\r\n\r\n```\r\nI'm using the following configuration file in Apache\r\n```\r\n<VirtualHost _default_:443>\r\n        ServerName luna1.mysite.com\r\n        ServerSignature Off\r\n        SSLEngine on\r\n        SSLProxyEngine on\r\n        SSLCertificateFile /etc/pki/tls/certs/server.crt\r\n        SSLCertificateKeyFile /etc/pki/tls/private/server.key\r\n        SSLCertificateChainFile /etc/pki/tls/certs/epa_server-chain.crt\r\n        SSLProtocol TLSv1.2\r\n        SSLCompression Off\r\n        SSLSessionTickets Off\r\n        SSLHonorCipherOrder on\r\n        SSLCipherSuite ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384\r\n\r\n        # Enable HSTS\r\n        Header always set Strict-Transport-Security \"max-age=63072000; includeSubDomains; preload\"\r\n\r\n        RewriteEngine On\r\n\tProxyPreserveHost on\r\n\r\n        RewriteCond %{HTTP:Upgrade} websocket [NC]\r\n        RewriteCond %{HTTP:Connection} Upgrade [NC]\r\n        RewriteRule /jupyter/(.*) ws://127.0.0.1:8000/jupyter/$1 [NE,P,L]\r\n        RewriteRule /jupyter/(.*) http://127.0.0.1:8000/jupyter/$1 [NE,P,L]\r\n\r\n        <Location /jupyter>\r\n                ProxyPass http://localhost:8000/jupyter\r\n                ProxyPassReverse http://localhost:8000/jupyter\r\n                Require all granted\r\n        </Location>\r\n\r\n</VirtualHost>\r\n```\r\nAnd the following is what I have setup for jupyterhub_config.py\r\n```\r\nc.JupyterHub.cleanup_servers = True\r\n\r\nc.JupyterHub.allow_named_servers = False\r\n\r\n# Max session cookie age\r\nc.JupyterHub.cookie_max_age_days = 1\r\n\r\n# Give up to 30 seconds for Slurm job to start before throwing an error\r\nc.JupyterHub.init_spawners_timeout = 30\r\n\r\n# Allow user to see all of /, but starting in /home/USERNAME\r\nc.Spawner.notebook_dir = '/'\r\n\r\nc.Spawner.default_url = '/lab'\r\nc.Spawner.cmd = ['jupyterhub-singleuser', '--ContentsManager.allow_hidden=True']\r\nc.JupyterHub.bind_url = 'http://:8000/jupyter'\r\nc.JupyterHub.hub_bind_url = 'http://luna1.local:8181/'\r\nc.Spawner.environment = {\r\n        'PATH': '/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/jupyterhub/bin',\r\n        'LD_LIBRARY_PATH': 'empty'\r\n}\r\n\r\n# Slurm\r\nimport batchspawner\r\n\r\nc.JupyterHub.spawner_class = 'wrapspawner.ProfilesSpawner'\r\nc.Spawner.http_timeout = 120\r\n\r\nc.ProfilesSpawner.profiles = [\r\n   ( \"Host process\", 'local', 'jupyterhub.spawner.LocalProcessSpawner', {'ip':'0.0.0.0'} ),\r\n   ('Compute Node - 24 hours - 1 core', 'compute1', 'batchspawner.SlurmSpawner',\r\n      dict(req_nprocs='1', req_partition='compute', req_runtime='24:00:00')),\r\n   ('Compute Node - 24 hours - 16 cores', 'compute2', 'batchspawner.SlurmSpawner',\r\n      dict(req_nprocs='16', req_partition='compute', req_runtime='24:00:00')),\r\n   ('Large Memory Node - 24 hours', 'lm1', 'batchspawner.SlurmSpawner',\r\n      dict(req_nprocs='1', req_partition='largemem', req_runtime='24:00:00')),\r\n   ('SinglePE Node - 24 hours', 'spe1', 'batchspawner.SlurmSpawner',\r\n      dict(req_nprocs='1', req_partition='singlepe', req_runtime='24:00:00'))\r\n   ]\r\nc.ProfilesSpawner.ip = '0.0.0.0'\r\n```\r\nI am deploying Hub on a RHEL 7.9 system using the following commands to install it into /usr/local/jupyterhub:\r\n```\r\nJUPYTERHUB=/usr/local/jupyterhub\r\n/bin/python3 -m venv ${JUPYTERHUB}\r\n${JUPYTERHUB}/bin/pip install --upgrade pip\r\n${JUPYTERHUB}/bin/pip install wheel jupyterhub==2.0.0 jupyterlab batchspawner wrapspawner\r\n${JUPYTERHUB}/bin/jupyter lab build\r\n/bin/mkdir -p ${JUPYTERHUB}/etc/jupyterhub\r\n/bin/mkdir -p ${JUPYTERHUB}/state\r\n```\r\nI then install my jupyterhub_config.py file into /usr/local/jupyterhub/etc/jupyterhub and start hub (for testing)\r\n```\r\ncd ${JUPYTERHUB}/state\r\nPATH=/bin:/usr/sbin:/usr/bin ${JUPYTERHUB}/bin/jupyterhub -f ${JUPYTERHUB}/etc/jupyterhub/jupyterhub_config.py\r\n```\r\n\r\nI've tested 1.4.0, 1.5.0 and 2.0.0, all work without a problem for both LocalProcessSpawner and batchspawner.SlurmSpawner, when I upgrade Hub to 2.0.1, 2.0.2, 2.1.0 or 2.1.1, I get the **Blocking Cross Origin API request** messages and Hub never refreshes the web page.\r\n\r\nHud does start the service (Both LocalProcessSpawner and batchspawner.SlurmSpawner) and if I go back to \"Home\" and then \"My Server\" I can see Lab, but if I go back to Hub Control, it can't stop that service correctly (403 API error message).\r\n\r\nIf I open the firewall and connect directory to port 8000 (Hub listening port), I have no issues with any version of Hub.\r\n\r\nSo, I'm assuming/hoping something is just out of wack with my Apache configuration related to 2.0.1+ and someone can point it out to me what I am doing wrong.\r\n\r\nThanks.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3780/reactions", "total_count": 2, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 1}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3780/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3778", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3778/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3778/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3778/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3778", "id": 1112615165, "node_id": "PR_kwDOAT0rQs4xfn0i", "number": 3778, "title": "add missing read:metrics scope to admin role", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-01-24T12:58:42Z", "updated_at": "2022-03-11T08:42:57Z", "closed_at": "2022-01-24T15:12:10Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3778", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3778", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3778.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3778.patch", "merged_at": "2022-01-24T15:12:09Z"}, "body": "<del>\r\nadds missing `read:metrics` scope, and ensures we don't introduce similar bugs in the future by ensuring admins get all scopes, whatever they are, rather than needing a duplicate record.\r\n</del>\r\n\r\nMinimal patch to add the scope to the role, will try another PR with the lazily-defined admin since something seems off there.\r\n\r\nI'll do a quick 2.1.1 with this fixed.\r\n\r\nReported on gitter by @katringoogoo", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3778/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3778/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3773", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3773/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3773/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3773/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3773", "id": 1108492686, "node_id": "PR_kwDOAT0rQs4xSKQ-", "number": 3773, "title": "Fix loading Spawner.user_options from db", "user": {"login": "IgorBerman", "id": 3739735, "node_id": "MDQ6VXNlcjM3Mzk3MzU=", "avatar_url": "https://avatars.githubusercontent.com/u/3739735?v=4", "gravatar_id": "", "url": "https://api.github.com/users/IgorBerman", "html_url": "https://github.com/IgorBerman", "followers_url": "https://api.github.com/users/IgorBerman/followers", "following_url": "https://api.github.com/users/IgorBerman/following{/other_user}", "gists_url": "https://api.github.com/users/IgorBerman/gists{/gist_id}", "starred_url": "https://api.github.com/users/IgorBerman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/IgorBerman/subscriptions", "organizations_url": "https://api.github.com/users/IgorBerman/orgs", "repos_url": "https://api.github.com/users/IgorBerman/repos", "events_url": "https://api.github.com/users/IgorBerman/events{/privacy}", "received_events_url": "https://api.github.com/users/IgorBerman/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2022-01-19T19:48:16Z", "updated_at": "2022-01-21T14:01:58Z", "closed_at": "2022-01-21T08:38:38Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3773", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3773", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3773.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3773.patch", "merged_at": "2022-01-21T08:38:38Z"}, "body": "closes #3772", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3773/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3773/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3772", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3772/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3772/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3772/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3772", "id": 1108487229, "node_id": "I_kwDOAT0rQs5CEiw9", "number": 3772, "title": "user_options returning empty at users rest api after jupyterhub restart", "user": {"login": "IgorBerman", "id": 3739735, "node_id": "MDQ6VXNlcjM3Mzk3MzU=", "avatar_url": "https://avatars.githubusercontent.com/u/3739735?v=4", "gravatar_id": "", "url": "https://api.github.com/users/IgorBerman", "html_url": "https://github.com/IgorBerman", "followers_url": "https://api.github.com/users/IgorBerman/followers", "following_url": "https://api.github.com/users/IgorBerman/following{/other_user}", "gists_url": "https://api.github.com/users/IgorBerman/gists{/gist_id}", "starred_url": "https://api.github.com/users/IgorBerman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/IgorBerman/subscriptions", "organizations_url": "https://api.github.com/users/IgorBerman/orgs", "repos_url": "https://api.github.com/users/IgorBerman/repos", "events_url": "https://api.github.com/users/IgorBerman/events{/privacy}", "received_events_url": "https://api.github.com/users/IgorBerman/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-01-19T19:41:22Z", "updated_at": "2022-01-21T08:38:38Z", "closed_at": "2022-01-21T08:38:38Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "\r\n### Bug description\r\nI\u2019ve noticed that after jupyterhub is restarted the user_options are empty i.e. {}\r\nwhen submitting /hub/api/users request\r\n(before restart I\u2019m getting user_options which are persisted in db due implemented in persist user_options (https://github.com/jupyterhub/jupyterhub/pull/2446)\r\n\r\nfrom looking at code it might be connected to the fact that in apihandler\u2019s [server_model takes user_options from spawner and not spawner.orm_spawner] (https://github.com/jupyterhub/jupyterhub/blob/f5bb0a2622be51b02a64eaa23b10b5f66461ba2b/jupyterhub/apihandlers/base.py#L204)\r\n\r\nI've patched as suggested above our private jupyterhub, then tested manually that it indeed solves the problem\r\n\r\n#### Expected behaviour\r\nmy expectation that user_options will be properly returned after jupyter hub restart\r\n\r\n#### Actual behaviour\r\nuser_options are empty {}\r\n\r\n### How to reproduce\r\n1. create pod with user_options\r\n2. make sure it's up\r\n3. access jupyterhub api of users\r\n4. make sure user_options are returned as part of response with custom values inside\r\n4. restart jupyter hub\r\n4. access jupyterhub api of users\r\n5. make sure user_options are returned but empty {}\r\n\r\n### Your personal set up\r\nzero-to-jupyterhub", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3772/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3772/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3770", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3770/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3770/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3770/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3770", "id": 1106930819, "node_id": "PR_kwDOAT0rQs4xNEFt", "number": 3770, "title": "Add missing `read:metrics` scope for authenticated metrics endpoint", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 2907708759, "node_id": "MDU6TGFiZWwyOTA3NzA4NzU5", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/new", "name": "new", "color": "96CC96", "default": false, "description": "new features"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-01-18T13:48:12Z", "updated_at": "2022-08-09T16:16:55Z", "closed_at": "2022-01-18T16:51:51Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3770", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3770", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3770.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3770.patch", "merged_at": "2022-01-18T16:51:51Z"}, "body": "and ensure token auth is accepted (missed this handler in #3686).\r\n\r\ncloses #3769 \r\n\r\nI'm reticent to release this PR as 2.0.3 because it defines a new scope. However, authenticated prometheus simply doesn't work right now (#3769), so one could argue that the 2.0.x bug is that the _scope_ for authenticated metrics was missing.\r\n\r\nwe could also backport just the one-line `_accept_token_auth = True` to 2.0.x, to allow any authenticated token to access metrics, as was the pre-2.0 behavior, but then 2.1 will be adding the new scope. Arguably doing so would break _more_ things, because there would be a version that actually works without the scope.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3770/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3770/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3769", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3769/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3769/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3769/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3769", "id": 1106916614, "node_id": "I_kwDOAT0rQs5B-jUG", "number": 3769, "title": "Metrics endpoint doesn't accept token request anymore", "user": {"login": "katringoogoo", "id": 6476057, "node_id": "MDQ6VXNlcjY0NzYwNTc=", "avatar_url": "https://avatars.githubusercontent.com/u/6476057?v=4", "gravatar_id": "", "url": "https://api.github.com/users/katringoogoo", "html_url": "https://github.com/katringoogoo", "followers_url": "https://api.github.com/users/katringoogoo/followers", "following_url": "https://api.github.com/users/katringoogoo/following{/other_user}", "gists_url": "https://api.github.com/users/katringoogoo/gists{/gist_id}", "starred_url": "https://api.github.com/users/katringoogoo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/katringoogoo/subscriptions", "organizations_url": "https://api.github.com/users/katringoogoo/orgs", "repos_url": "https://api.github.com/users/katringoogoo/repos", "events_url": "https://api.github.com/users/katringoogoo/events{/privacy}", "received_events_url": "https://api.github.com/users/katringoogoo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-01-18T13:34:04Z", "updated_at": "2022-01-18T16:51:51Z", "closed_at": "2022-01-18T16:51:51Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\nPrior to version 2 the hub/metrics endpoint could be accessed via token and this was used e.g. to scrape the metrics of a protected jupyterhub instance via prometheus. \r\nSince the latest update the metrics endpoint does not allow token based access anymore (see https://github.com/jupyterhub/jupyterhub/pull/3686)\r\n\r\nThanks to @minrk for pointing this out. \r\n\r\nSuggestion: Mention at e.g. the metrics configuration that its a known problem and a workaround is available:\r\n\r\n```\r\nfrom jupyterhub.handlers.metrics import MetricsHandler\r\nMetricsHandler._accept_token_auth = True\r\n```\r\n\r\n#### Expected behaviour\r\nToken auth works\r\n\r\n#### Actual behaviour\r\nJupyterhub returns 403 forbidden\r\n\r\n### How to reproduce\r\n\r\nRequest the hub/metrics endpoint with token authorization\r\n\r\n### Your personal set up\r\n\r\n - OS: CentOS Stream 9\r\n - Version(s): jupyterhub 2.0.2\r\n\r\n</details>\r\n\r\n- <details><summary>Configuration</summary>\r\n\r\nNot relevant - PR that introduced the problem was mentioned previously.\r\n\r\n</details>\r\n\r\n- <details><summary>Logs</summary>\r\n\r\n```\r\nWARNING:JupyterHub:403 GET /jupyterhub-dev/hub/metrics (@10.11.193.72) 1.86ms\r\n[D 2022-01-18 13:18:12.616 JupyterHub base:1322] No template for 403\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3769/reactions", "total_count": 2, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 2, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3769/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3763", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3763/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3763/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3763/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3763", "id": 1100308887, "node_id": "PR_kwDOAT0rQs4w2zmt", "number": 3763, "title": "apply scope checks to some admin-or-self situations", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-01-12T12:56:30Z", "updated_at": "2022-03-11T08:42:59Z", "closed_at": "2022-01-20T15:21:51Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3763", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3763", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3763.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3763.patch", "merged_at": "2022-01-20T15:21:51Z"}, "body": "Some non-api spawn and redirect checks still had `self or admin`, when they should have checked directly for the appropriate permissions. Explicit permissions checks added for each. The most direct bug here is that non-admin users with permission to launch servers of other users could only do so via the API, but not via the UI. This is now fixed (not a security issue because it was only users who should have permissions being denied, not users without permissions being allowed).\r\n\r\nThis removes the long-deprecated redirect from `/user/other` -> `/user/self` with the elaborate condition: `if the user is different and the other user's server is not running _and_ the user is not admin`. The result is a more consistent behavior whether the requested server is running or not, and whether the user has _access_ to the running server or not. This behavior has been problematic for a very long time and deprecated since the addition of `user-redirect` in 0.7, but it really makes no sense now that we have access scopes.\r\n\r\nThe new behavior is much simpler: attempt to access a not-running server is allowed if you have access to that server, and it is not if you do not. There is no longer an implicit redirect back to your own server, which was always just a guess, and has only ever worked when the requested server was not running.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3763/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 1, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3763/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3758", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3758/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3758/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3758/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3758", "id": 1097325602, "node_id": "I_kwDOAT0rQs5BZ9wi", "number": 3758, "title": "GitHub CI tests are failing", "user": {"login": "manics", "id": 1644105, "node_id": "MDQ6VXNlcjE2NDQxMDU=", "avatar_url": "https://avatars.githubusercontent.com/u/1644105?v=4", "gravatar_id": "", "url": "https://api.github.com/users/manics", "html_url": "https://github.com/manics", "followers_url": "https://api.github.com/users/manics/followers", "following_url": "https://api.github.com/users/manics/following{/other_user}", "gists_url": "https://api.github.com/users/manics/gists{/gist_id}", "starred_url": "https://api.github.com/users/manics/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/manics/subscriptions", "organizations_url": "https://api.github.com/users/manics/orgs", "repos_url": "https://api.github.com/users/manics/repos", "events_url": "https://api.github.com/users/manics/events{/privacy}", "received_events_url": "https://api.github.com/users/manics/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2022-01-09T23:04:15Z", "updated_at": "2022-01-10T08:49:12Z", "closed_at": "2022-01-10T08:41:19Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "### Bug description\r\nGitHub CI tests are failing:\r\nhttps://github.com/jupyterhub/jupyterhub/actions/runs/1675063992\r\n\r\nThis is unrelated to the [most recently merged PR](https://github.com/jupyterhub/jupyterhub/pull/3757), I've pushed the 2.0.1 tag to a temporary branch and it's also failing:\r\nhttps://github.com/manics/jupyterhub/runs/4755478141?check_suite_focus=true\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3758/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3758/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3757", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3757/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3757/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3757/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3757", "id": 1096311379, "node_id": "PR_kwDOAT0rQs4wqMo9", "number": 3757, "title": "use outermost proxied entry when looking up browser protocol", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-01-07T13:19:56Z", "updated_at": "2022-03-16T15:38:05Z", "closed_at": "2022-01-09T22:44:07Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3757", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3757", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3757.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3757.patch", "merged_at": "2022-01-09T22:44:07Z"}, "body": "In some cases (e.g. CORS and setting cookies) we care about what the _browser_ sees, so trust the outermost entry instead of the innermost, which is the most strictly trustworthy value used by tornado (see https://github.com/tornadoweb/tornado/pull/2162).\r\n\r\nUsing the outermost entry is not secure _in general_, in that these values can be spoofed by additional proxies we don't control, but for CORS and cookie purposes, we only care about what the browser sees, however many hops there may be, whoever they may be controlled by.\r\n\r\nA malicious proxy in the chain here setting fake host/proto fields isn't a concern for these cases because what matters is the immediate hop from the _browser_, not the immediate hop from the _server_. It would not be appropriate, for instance, to trust the outermost _ip_ field for logging/abuse purposes. A bad proxy can _break_ stuff with invalid fields, but not compromise things in the way it's used here (e.g. for header comparison, they can just as easily change _both_ headers being compared).\r\n\r\nThis adds the failing case noted in #3746 which works now. It failed because CHP adds its own X-Forwarded-Proto, so the value was `https, http` - exactly the two-hop failure mentioned in #3737 that is handled as intended now.\r\n\r\nI believe this closes #3737\r\n\r\nxref [this comment on tornado](https://github.com/tornadoweb/tornado/pull/2162#discussion_r150203117) where I said I'd do this in 2017.\r\n\r\nrelated issues: #1477, https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1700\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3757/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3757/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3745", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3745/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3745/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3745/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3745", "id": 1091906845, "node_id": "I_kwDOAT0rQs5BFS0d", "number": 3745, "title": "No links to access the users notebooks from the Admin menu", "user": {"login": "ykazakov", "id": 2140361, "node_id": "MDQ6VXNlcjIxNDAzNjE=", "avatar_url": "https://avatars.githubusercontent.com/u/2140361?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ykazakov", "html_url": "https://github.com/ykazakov", "followers_url": "https://api.github.com/users/ykazakov/followers", "following_url": "https://api.github.com/users/ykazakov/following{/other_user}", "gists_url": "https://api.github.com/users/ykazakov/gists{/gist_id}", "starred_url": "https://api.github.com/users/ykazakov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ykazakov/subscriptions", "organizations_url": "https://api.github.com/users/ykazakov/orgs", "repos_url": "https://api.github.com/users/ykazakov/repos", "events_url": "https://api.github.com/users/ykazakov/events{/privacy}", "received_events_url": "https://api.github.com/users/ykazakov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2022-01-01T22:37:17Z", "updated_at": "2022-02-15T10:09:32Z", "closed_at": "2022-02-14T08:25:25Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\n\r\nHappy New Year!\r\n\r\nI am trying to [enable admin access to user notebooks](https://jupyterhub.readthedocs.io/en/2.0.1/getting-started/authenticators-users-basics.html#give-admin-access-to-other-users-notebook-servers-admin-access):\r\n\r\n```\r\nJupyterHub.admin_access = True\r\n```\r\n\r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\n\r\nAs of Jupyterhub 1.5.0, I could access the users notebooks from the Admin menu:\r\n\r\n<img width=\"610\" alt=\"Screenshot 2022-01-01 at 23 04 24\" src=\"https://user-images.githubusercontent.com/2140361/147861563-a4ecd2fe-558e-4021-b339-e3429b34fd87.png\">\r\n\r\n\r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\n\r\nAs of Jupyterhub 2.0.1, there is no link for accessing the users notebooks any longer:\r\n\r\n<img width=\"689\" alt=\"Screenshot 2022-01-01 at 23 05 54\" src=\"https://user-images.githubusercontent.com/2140361/147861261-9b09a787-17b3-4328-89ae-9a7101b2eb84.png\">\r\n\r\nHowever, I could still access the user notebook by entering the url manually: `127.0.0.1:8000/user/zoe/`\r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\n1. Create the files with the following contents:\r\n  - `Dockerfile`:\r\n```\r\nFROM jupyterhub/jupyterhub:2.0.1\r\n\r\nRUN pip install jupyter jupyterlab --no-cache-dir \\\r\n    && useradd -m mal \\\r\n    && useradd -m zoe\r\n\r\nCOPY jupyterhub_config.py /etc/jupyterhub/\r\n\r\nCMD jupyterhub -f /etc/jupyterhub/jupyterhub_config.py --debug\r\n```\r\n  - `jupyterhub_config.py`:\r\n```\r\nc.Authenticator.allowed_users = {'mal', 'zoe'}\r\nc.Authenticator.admin_users = {'mal'}\r\nc.JupyterHub.admin_access = True\r\n\r\nc.JupyterHub.authenticator_class = 'dummy'\r\nc.JupyterHub.spawner_class = 'simple'\r\nc.Spawner.args = [\"--allow-root\"]\r\n```\r\n2. Create and run the docker container:\r\n```\r\ndocker build -t jupyterhub-adminaccess . \r\ndocker run -it -p 8000:8000 jupyterhub-adminaccess\r\n```\r\n3. Open the url: `http://127.0.0.1:8000/admin`\r\n4. Enter Username: `mal` and press \"Sign in\"\r\n5. Press \"Start Server\" next to `zoe`\r\n\r\n### Your personal set up\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n\r\n- OS: MacOS 12.1\r\n - Version(s):\r\n```\r\n% docker --version    \r\nDocker version 20.10.11, build dea9396\r\n```\r\n\r\n<details><summary>Logs</summary>\r\n\r\n```\r\n% docker run -it -p 8000:8000 jupyterhub-adminaccess\r\n[D 2022-01-01 22:28:32.152 JupyterHub application:731] Looking for /etc/jupyterhub/jupyterhub_config in /srv/jupyterhub\r\n[D 2022-01-01 22:28:32.153 JupyterHub application:753] Loaded config file: /etc/jupyterhub/jupyterhub_config.py\r\n[I 2022-01-01 22:28:32.208 JupyterHub app:2766] Running JupyterHub version 2.0.1\r\n[I 2022-01-01 22:28:32.208 JupyterHub app:2796] Using Authenticator: jupyterhub.auth.DummyAuthenticator-2.0.1\r\n[I 2022-01-01 22:28:32.209 JupyterHub app:2796] Using Spawner: jupyterhub.spawner.SimpleLocalProcessSpawner-2.0.1\r\n[I 2022-01-01 22:28:32.210 JupyterHub app:2796] Using Proxy: jupyterhub.proxy.ConfigurableHTTPProxy-2.0.1\r\n[D 2022-01-01 22:28:32.229 JupyterHub app:1646] Generating new cookie_secret\r\n[I 2022-01-01 22:28:32.231 JupyterHub app:1651] Writing cookie_secret to /srv/jupyterhub/jupyterhub_cookie_secret\r\n[D 2022-01-01 22:28:32.232 JupyterHub app:1773] Connecting to db: sqlite:///jupyterhub.sqlite\r\n[D 2022-01-01 22:28:32.284 JupyterHub orm:924] Stamping empty database with alembic revision 833da8570507\r\n[I 2022-01-01 22:28:32.293 alembic.runtime.migration migration:201] Context impl SQLiteImpl.\r\n[I 2022-01-01 22:28:32.293 alembic.runtime.migration migration:204] Will assume non-transactional DDL.\r\n[I 2022-01-01 22:28:32.330 alembic.runtime.migration migration:615] Running stamp_revision  -> 833da8570507\r\n[D 2022-01-01 22:28:32.332 alembic.runtime.migration migration:815] new branch insert 833da8570507\r\n[I 2022-01-01 22:28:32.566 JupyterHub proxy:496] Generating new CONFIGPROXY_AUTH_TOKEN\r\n[D 2022-01-01 22:28:32.567 JupyterHub app:2019] Loading roles into database\r\n[D 2022-01-01 22:28:32.628 JupyterHub roles:449] Assigning default role to User mal\r\n[I 2022-01-01 22:28:32.643 JupyterHub roles:365] Adding role admin for User: mal\r\n[I 2022-01-01 22:28:32.661 JupyterHub roles:365] Adding role user for User: mal\r\n[D 2022-01-01 22:28:32.686 JupyterHub app:2278] Purging expired APITokens\r\n[D 2022-01-01 22:28:32.699 JupyterHub app:2278] Purging expired OAuthCodes\r\n[D 2022-01-01 22:28:32.708 JupyterHub app:2111] Loading role assignments from config\r\n[D 2022-01-01 22:28:32.712 JupyterHub app:2182] Assigning 2 allowed_users to the user role\r\n[I 2022-01-01 22:28:32.741 JupyterHub roles:365] Adding role user for User: zoe\r\n[D 2022-01-01 22:28:32.770 JupyterHub app:2424] Initializing spawners\r\n[D 2022-01-01 22:28:32.779 JupyterHub app:2555] Loaded users:\r\n    \r\n[I 2022-01-01 22:28:32.780 JupyterHub app:2835] Initialized 0 spawners in 0.011 seconds\r\n[W 2022-01-01 22:28:32.789 JupyterHub proxy:687] Running JupyterHub without SSL.  I hope there is SSL termination happening somewhere else...\r\n[I 2022-01-01 22:28:32.789 JupyterHub proxy:691] Starting proxy @ http://:8000\r\n[D 2022-01-01 22:28:32.790 JupyterHub proxy:692] Proxy cmd: ['configurable-http-proxy', '--ip', '', '--port', '8000', '--api-ip', '127.0.0.1', '--api-port', '8001', '--error-target', 'http://127.0.0.1:8081/hub/error']\r\n[D 2022-01-01 22:28:32.804 JupyterHub proxy:610] Writing proxy pid file: jupyterhub-proxy.pid\r\n22:28:33.573 [ConfigProxy] info: Proxying http://*:8000 to (no default)\r\n22:28:33.580 [ConfigProxy] info: Proxy API at http://127.0.0.1:8001/api/routes\r\n[D 2022-01-01 22:28:33.682 JupyterHub proxy:728] Proxy started and appears to be up\r\n[D 2022-01-01 22:28:33.685 JupyterHub proxy:821] Proxy: Fetching GET http://127.0.0.1:8001/api/routes\r\n22:28:33.719 [ConfigProxy] info: 200 GET /api/routes \r\n[I 2022-01-01 22:28:33.719 JupyterHub app:3084] Hub API listening on http://127.0.0.1:8081/hub/\r\n[D 2022-01-01 22:28:33.721 JupyterHub proxy:343] Fetching routes to check\r\n[D 2022-01-01 22:28:33.721 JupyterHub proxy:821] Proxy: Fetching GET http://127.0.0.1:8001/api/routes\r\n22:28:33.725 [ConfigProxy] info: 200 GET /api/routes \r\n[D 2022-01-01 22:28:33.728 JupyterHub proxy:346] Checking routes\r\n[I 2022-01-01 22:28:33.728 JupyterHub proxy:431] Adding route for Hub: / => http://127.0.0.1:8081\r\n[D 2022-01-01 22:28:33.730 JupyterHub proxy:821] Proxy: Fetching POST http://127.0.0.1:8001/api/routes/\r\n22:28:33.741 [ConfigProxy] info: Adding route / -> http://127.0.0.1:8081\r\n22:28:33.743 [ConfigProxy] info: Route added / -> http://127.0.0.1:8081\r\n22:28:33.744 [ConfigProxy] info: 201 POST /api/routes/ \r\n[I 2022-01-01 22:28:33.748 JupyterHub app:3150] JupyterHub is now running at http://:8000\r\n[D 2022-01-01 22:28:33.750 JupyterHub app:2759] It took 1.606 seconds for the Hub to start\r\n[I 2022-01-01 22:28:38.340 JupyterHub log:189] 302 GET /admin -> /hub/admin (@::ffff:172.17.0.1) 5.45ms\r\n[W 2022-01-01 22:28:38.394 JupyterHub base:391] Invalid or expired cookie token\r\n[I 2022-01-01 22:28:38.398 JupyterHub log:189] 302 GET /hub/admin -> /hub/login?next=%2Fhub%2Fadmin (@::ffff:172.17.0.1) 4.44ms\r\n[I 2022-01-01 22:28:38.516 JupyterHub log:189] 200 GET /hub/login?next=%2Fhub%2Fadmin (@::ffff:172.17.0.1) 64.76ms\r\n[D 2022-01-01 22:28:38.799 JupyterHub log:189] 304 GET /hub/static/css/style.min.css.map (@::ffff:172.17.0.1) 10.51ms\r\n[D 2022-01-01 22:28:46.584 JupyterHub roles:449] Assigning default role to User mal\r\n[D 2022-01-01 22:28:46.603 JupyterHub base:561] Setting cookie for mal: jupyterhub-hub-login\r\n[D 2022-01-01 22:28:46.605 JupyterHub base:557] Setting cookie jupyterhub-hub-login: {'httponly': True, 'path': '/hub/'}\r\n[I 2022-01-01 22:28:46.606 JupyterHub base:797] User logged in: mal\r\n[I 2022-01-01 22:28:46.616 JupyterHub log:189] 302 POST /hub/login?next=%2Fhub%2Fadmin -> /hub/admin (mal@::ffff:172.17.0.1) 62.05ms\r\n[D 2022-01-01 22:28:46.679 JupyterHub base:279] Recording first activity for <User(mal 0/1 running)>\r\n[D 2022-01-01 22:28:46.716 JupyterHub scopes:488] Checking access via scope admin:users\r\n[D 2022-01-01 22:28:46.717 JupyterHub scopes:386] Unrestricted access to /hub/admin via admin:users\r\n[D 2022-01-01 22:28:46.718 JupyterHub scopes:488] Checking access via scope admin:servers\r\n[D 2022-01-01 22:28:46.718 JupyterHub scopes:386] Unrestricted access to /hub/admin via admin:servers\r\n[D 2022-01-01 22:28:46.753 JupyterHub user:347] Creating <class 'jupyterhub.spawner.SimpleLocalProcessSpawner'> for mal:\r\n[I 2022-01-01 22:28:46.762 JupyterHub log:189] 200 GET /hub/admin (mal@::ffff:172.17.0.1) 92.87ms\r\n[I 2022-01-01 22:28:46.935 JupyterHub log:189] 302 GET /logo -> /hub/logo (@::ffff:172.17.0.1) 7.08ms\r\n[D 2022-01-01 22:28:46.982 JupyterHub log:189] 304 GET /hub/static/js/admin-react.js (@::ffff:172.17.0.1) 12.71ms\r\n[D 2022-01-01 22:28:47.021 JupyterHub log:189] 304 GET /hub/static/css/style.min.css.map (@::ffff:172.17.0.1) 41.23ms\r\n[D 2022-01-01 22:28:47.151 JupyterHub log:189] 200 GET /hub/logo (@::ffff:172.17.0.1) 30.32ms\r\n[D 2022-01-01 22:28:47.206 JupyterHub log:189] 200 GET /hub/static/js/admin.js?v=20220101222832 (@::ffff:172.17.0.1) 1.83ms\r\n[D 2022-01-01 22:28:47.278 JupyterHub scopes:488] Checking access via scope list:groups\r\n[D 2022-01-01 22:28:47.279 JupyterHub scopes:386] Unrestricted access to /hub/api/groups via list:groups\r\n[D 2022-01-01 22:28:47.333 JupyterHub log:189] 304 GET /hub/api/groups?offset=0&limit=50 (mal@::ffff:172.17.0.1) 77.69ms\r\n[D 2022-01-01 22:28:47.347 JupyterHub scopes:488] Checking access via scope list:users\r\n[D 2022-01-01 22:28:47.348 JupyterHub scopes:386] Unrestricted access to /hub/api/users via list:users\r\n[I 2022-01-01 22:28:47.385 JupyterHub log:189] 200 GET /hub/api/users?offset=0&limit=50 (mal@::ffff:172.17.0.1) 118.39ms\r\n[D 2022-01-01 22:28:47.400 JupyterHub log:189] 200 GET /hub/static/js/jhapi.js?v=20220101222832 (@::ffff:172.17.0.1) 9.85ms\r\n[D 2022-01-01 22:28:47.408 JupyterHub log:189] 200 GET /hub/static/js/utils.js?v=20220101222832 (@::ffff:172.17.0.1) 15.91ms\r\n[D 2022-01-01 22:28:47.413 JupyterHub log:189] 200 GET /hub/static/components/moment/moment.js?v=20220101222832 (@::ffff:172.17.0.1) 18.98ms\r\n[D 2022-01-01 22:28:50.014 JupyterHub scopes:488] Checking access via scope servers\r\n[D 2022-01-01 22:28:50.014 JupyterHub scopes:386] Unrestricted access to /hub/api/users/zoe/server via servers\r\n[D 2022-01-01 22:28:50.024 JupyterHub user:347] Creating <class 'jupyterhub.spawner.SimpleLocalProcessSpawner'> for zoe:\r\n[D 2022-01-01 22:28:50.031 JupyterHub base:915] Initiating spawn for zoe\r\n[D 2022-01-01 22:28:50.032 JupyterHub base:919] 0/100 concurrent spawns\r\n[D 2022-01-01 22:28:50.033 JupyterHub base:924] 0 active servers\r\n[D 2022-01-01 22:28:50.056 JupyterHub roles:472] Checking token permissions against requested role server\r\n[I 2022-01-01 22:28:50.072 JupyterHub roles:477] Adding role server to token: <APIToken('aaa0...', user='zoe', client_id='jupyterhub')>\r\n[I 2022-01-01 22:28:50.112 JupyterHub provider:607] Creating oauth client jupyterhub-user-zoe\r\n[D 2022-01-01 22:28:50.155 JupyterHub user:675] Calling Spawner.start for zoe\r\n[I 2022-01-01 22:28:50.164 JupyterHub spawner:1526] Spawning jupyterhub-singleuser --allow-root\r\n[D 2022-01-01 22:28:50.221 JupyterHub spawner:1221] Polling subprocess every 30s\r\n[I 2022-01-01 22:28:52.329 SingleUserLabApp mixins:615] Starting jupyterhub single-user server version 2.0.1\r\n[I 2022-01-01 22:28:52.330 SingleUserLabApp mixins:629] Extending jupyterlab.labhubapp.SingleUserLabApp from jupyterlab 3.2.5\r\n[I 2022-01-01 22:28:52.330 SingleUserLabApp mixins:629] Extending jupyter_server.serverapp.ServerApp from jupyter_server 1.13.1\r\n[I 2022-01-01 22:28:52.390 SingleUserLabApp manager:345] jupyterlab | extension was successfully linked.\r\n[I 2022-01-01 22:28:52.783 SingleUserLabApp manager:345] nbclassic | extension was successfully linked.\r\n[I 2022-01-01 22:28:52.837 SingleUserLabApp manager:367] nbclassic | extension was successfully loaded.\r\n[I 2022-01-01 22:28:52.840 LabApp] JupyterLab extension loaded from /usr/local/lib/python3.8/dist-packages/jupyterlab\r\n[I 2022-01-01 22:28:52.840 LabApp] JupyterLab application directory is /usr/local/share/jupyter/lab\r\n[I 2022-01-01 22:28:52.851 SingleUserLabApp manager:367] jupyterlab | extension was successfully loaded.\r\n[I 2022-01-01 22:28:52.853 SingleUserLabApp mixins:641] Starting jupyterhub-singleuser server version 2.0.1\r\n[I 2022-01-01 22:28:52.867 JupyterHub log:189] 200 GET /hub/api (@127.0.0.1) 1.74ms\r\n[I 2022-01-01 22:28:52.870 SingleUserLabApp serverapp:2582] Serving notebooks from local directory: /tmp/zoe\r\n[I 2022-01-01 22:28:52.870 SingleUserLabApp serverapp:2582] Jupyter Server 1.13.1 is running at:\r\n[I 2022-01-01 22:28:52.871 SingleUserLabApp serverapp:2582] http://127.0.0.1:39161/user/zoe/lab\r\n[I 2022-01-01 22:28:52.871 SingleUserLabApp serverapp:2582]  or http://127.0.0.1:39161/user/zoe/lab\r\n[I 2022-01-01 22:28:52.872 SingleUserLabApp serverapp:2583] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).\r\n[I 2022-01-01 22:28:52.887 SingleUserLabApp mixins:597] Updating Hub with activity every 300 seconds\r\n[D 2022-01-01 22:28:52.906 JupyterHub base:279] Recording first activity for <APIToken('aaa0...', user='zoe', client_id='jupyterhub')>\r\n[D 2022-01-01 22:28:52.928 JupyterHub base:324] Refreshing auth for zoe\r\n[D 2022-01-01 22:28:52.929 JupyterHub scopes:298] Authenticated with token <APIToken('aaa0...', user='zoe', client_id='jupyterhub')>\r\n[D 2022-01-01 22:28:52.948 JupyterHub scopes:488] Checking access via scope users:activity\r\n[D 2022-01-01 22:28:52.948 JupyterHub scopes:399] Argument-based access to /hub/api/users/zoe/activity via users:activity\r\n[D 2022-01-01 22:28:52.958 JupyterHub users:845] Activity for user zoe: 2022-01-01T22:28:52.813981Z\r\n[D 2022-01-01 22:28:52.960 JupyterHub users:863] Activity on server zoe/: 2022-01-01T22:28:52.813981Z\r\n[I 2022-01-01 22:28:52.996 JupyterHub log:189] 200 POST /hub/api/users/zoe/activity (zoe@127.0.0.1) 98.97ms\r\n[I 2022-01-01 22:28:54.128 SingleUserLabApp log:189] 302 GET /user/zoe/ -> /user/zoe/lab? (@127.0.0.1) 2.04ms\r\n[D 2022-01-01 22:28:54.130 JupyterHub utils:230] Server at http://127.0.0.1:39161/user/zoe/ responded with 302\r\n[D 2022-01-01 22:28:54.130 JupyterHub _version:74] jupyterhub and jupyterhub-singleuser both on version 2.0.1\r\n[I 2022-01-01 22:28:54.131 JupyterHub base:944] User zoe took 4.100 seconds to start\r\n[I 2022-01-01 22:28:54.132 JupyterHub proxy:286] Adding user zoe to proxy /user/zoe/ => http://127.0.0.1:39161\r\n[D 2022-01-01 22:28:54.132 JupyterHub proxy:821] Proxy: Fetching POST http://127.0.0.1:8001/api/routes/user/zoe\r\n22:28:54.137 [ConfigProxy] info: Adding route /user/zoe -> http://127.0.0.1:39161\r\n22:28:54.138 [ConfigProxy] info: Route added /user/zoe -> http://127.0.0.1:39161\r\n22:28:54.141 [ConfigProxy] info: 201 POST /api/routes/user/zoe \r\n[I 2022-01-01 22:28:54.146 JupyterHub log:189] 201 POST /hub/api/users/zoe/server (mal@::ffff:172.17.0.1) 4135.73ms\r\n[D 2022-01-01 22:28:54.186 JupyterHub scopes:488] Checking access via scope list:users\r\n[D 2022-01-01 22:28:54.187 JupyterHub scopes:386] Unrestricted access to /hub/api/users via list:users\r\n[I 2022-01-01 22:28:54.194 JupyterHub log:189] 200 GET /hub/api/users?offset=0&limit=50 (mal@::ffff:172.17.0.1) 12.21ms\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3745/reactions", "total_count": 4, "+1": 4, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3745/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3737", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3737/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3737/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3737/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3737", "id": 1088573732, "node_id": "I_kwDOAT0rQs5A4lEk", "number": 3737, "title": "Empty Admin page when the hub is behind nginx proxy", "user": {"login": "ykazakov", "id": 2140361, "node_id": "MDQ6VXNlcjIxNDAzNjE=", "avatar_url": "https://avatars.githubusercontent.com/u/2140361?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ykazakov", "html_url": "https://github.com/ykazakov", "followers_url": "https://api.github.com/users/ykazakov/followers", "following_url": "https://api.github.com/users/ykazakov/following{/other_user}", "gists_url": "https://api.github.com/users/ykazakov/gists{/gist_id}", "starred_url": "https://api.github.com/users/ykazakov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ykazakov/subscriptions", "organizations_url": "https://api.github.com/users/ykazakov/orgs", "repos_url": "https://api.github.com/users/ykazakov/repos", "events_url": "https://api.github.com/users/ykazakov/events{/privacy}", "received_events_url": "https://api.github.com/users/ykazakov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 20, "created_at": "2021-12-25T09:15:53Z", "updated_at": "2022-03-16T09:58:25Z", "closed_at": "2022-01-09T22:44:07Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\n\r\nMerry Christmas!\r\n\r\nThe Admin settings of jupyterhub v. 2.0.1 are not shown if the hub is behind a reverse nginx proxy.\r\nThe symptoms appear to be similar to #3711 except that they are now not caused by `base_url`.\r\n\r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\n\r\nAdmin page when the hub is accessed directly:\r\n\r\n<img width=\"684\" alt=\"Screenshot 2021-12-25 at 09 32 58\" src=\"https://user-images.githubusercontent.com/2140361/147381008-67c6e49d-a583-47d0-aab2-bc1246976b1e.png\">\r\n\r\n\r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\n\r\nAdmin page when the hub is accessed through a proxy:\r\n\r\n<img width=\"683\" alt=\"Screenshot 2021-12-25 at 09 34 48\" src=\"https://user-images.githubusercontent.com/2140361/147381033-be241b38-db3f-410c-a439-2d4eb3f71f33.png\">\r\n\r\nThis message looks suspicious (see the full log below):\r\n```\r\njupyterhub_1  | [W 2021-12-25 08:58:25.156 JupyterHub base:89] Blocking Cross Origin API request.  Referer: http://127.0.0.1:8080/hub/admin, Host: 127.0.0.1, Host URL: http://127.0.0.1/hub/\r\n```\r\n\r\nThere is no problem with `jupyterhub/jupyterhub:1.5.0`\r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\n1. Ensure the following directory structure:\r\n```\r\n.\r\n\u251c\u2500\u2500 docker-compose.yml\r\n\u251c\u2500\u2500 jupyterhub\r\n\u2502   \u251c\u2500\u2500 Dockerfile\r\n\u2502   \u2514\u2500\u2500 jupyterhub_config.py\r\n\u2514\u2500\u2500 nginx\r\n    \u251c\u2500\u2500 Dockerfile\r\n    \u2514\u2500\u2500 nginx.conf\r\n```\r\n2. Ensure the following file contents:\r\n  - `docker-compose.yml`:\r\n```\r\nversion: '3'\r\nservices:\r\n  nginx: \r\n    image: nginx\r\n    build: nginx\r\n    ports:\r\n      - 8080:80\r\n      \r\n  jupyterhub:\r\n    image: jupyterhub\r\n    build: jupyterhub\r\n    expose:\r\n      - \"8000\"\r\n```\r\n  - `jupyterhub/Dockerfile`:\r\n```\r\nFROM jupyterhub/jupyterhub:2.0.1\r\n\r\nCOPY jupyterhub_config.py /etc/jupyterhub/\r\n\r\nCMD jupyterhub -f /etc/jupyterhub/jupyterhub_config.py --debug\r\n```\r\n- `jupyterhub/jupyterhub_config.py`:\r\n```\r\nc.Authenticator.admin_users = {'user'}\r\nc.JupyterHub.authenticator_class = 'dummy'\r\n```\r\n- `nginx/Dockerfile`:\r\n```\r\nFROM nginx:1.21.4\r\n\r\nCOPY nginx.conf /etc/nginx/\r\n```\r\n- `nginx/nginx.conf` ([as documented](https://jupyterhub.readthedocs.io/en/stable/reference/config-proxy.html#nginx) but without ssl):\r\n```\r\nevents {}\r\nhttp {\r\n  server {\r\n    listen 0.0.0.0:80;\r\n    server_name localhost;\r\n\r\n    location / {\r\n      proxy_pass http://jupyterhub:8000/;\r\n      proxy_set_header X-Real-IP $remote_addr;\r\n      proxy_set_header Host $host;\r\n      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\r\n\r\n      # websocket headers\r\n      proxy_http_version 1.1;\r\n      proxy_set_header Upgrade $http_upgrade;\r\n      proxy_set_header Connection upgrade;\r\n      proxy_set_header X-Scheme $scheme;\r\n\r\n      proxy_buffering off;\r\n    }\r\n\r\n    real_ip_header proxy_protocol;\r\n    set_real_ip_from 127.0.0.1;\r\n\r\n  }\r\n\r\n}\r\n```\r\n3. Build containers: \r\n`docker-compose build`\r\n4. Start the containers:\r\n`docker-compose up`\r\n5. Visit the page: http://127.0.0.1:8080/hub/admin\r\n6. Enter the user name `user`\r\n\r\n### Your personal set up\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n\r\n - OS: MacOS 12.1\r\n - Version(s):\r\n```\r\n% docker --version    \r\nDocker version 20.10.11, build dea9396\r\n% docker-compose --version\r\nDocker Compose version v2.2.1\r\n```\r\n\r\n<details><summary>Logs</summary>\r\n\r\n- docker-compose:\r\n```\r\n% docker-compose up\r\n[+] Running 2/0\r\n \u283f Container jupyterhub-test1_jupyterhub_1  Created                                                                                 0.0s\r\n \u283f Container jupyterhub-test1_nginx_1       Created                                                                                 0.0s\r\nAttaching to jupyterhub_1, nginx_1\r\nnginx_1       | /docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration\r\nnginx_1       | /docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/\r\nnginx_1       | /docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh\r\nnginx_1       | 10-listen-on-ipv6-by-default.sh: info: IPv6 listen already enabled\r\nnginx_1       | /docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh\r\nnginx_1       | /docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh\r\nnginx_1       | /docker-entrypoint.sh: Configuration complete; ready for start up\r\njupyterhub_1  | [D 2021-12-25 08:58:14.902 JupyterHub application:731] Looking for /etc/jupyterhub/jupyterhub_config in /srv/jupyterhub\r\njupyterhub_1  | [D 2021-12-25 08:58:14.902 JupyterHub application:753] Loaded config file: /etc/jupyterhub/jupyterhub_config.py\r\njupyterhub_1  | [I 2021-12-25 08:58:14.912 JupyterHub app:2766] Running JupyterHub version 2.0.1\r\njupyterhub_1  | [I 2021-12-25 08:58:14.912 JupyterHub app:2796] Using Authenticator: jupyterhub.auth.DummyAuthenticator-2.0.1\r\njupyterhub_1  | [I 2021-12-25 08:58:14.912 JupyterHub app:2796] Using Spawner: jupyterhub.spawner.LocalProcessSpawner-2.0.1\r\njupyterhub_1  | [I 2021-12-25 08:58:14.912 JupyterHub app:2796] Using Proxy: jupyterhub.proxy.ConfigurableHTTPProxy-2.0.1\r\njupyterhub_1  | [I 2021-12-25 08:58:14.924 JupyterHub app:1606] Loading cookie_secret from /srv/jupyterhub/jupyterhub_cookie_secret\r\njupyterhub_1  | [D 2021-12-25 08:58:14.930 JupyterHub app:1773] Connecting to db: sqlite:///jupyterhub.sqlite\r\njupyterhub_1  | [D 2021-12-25 08:58:14.959 JupyterHub orm:955] database schema version found: 833da8570507\r\njupyterhub_1  | [I 2021-12-25 08:58:15.017 JupyterHub proxy:496] Generating new CONFIGPROXY_AUTH_TOKEN\r\njupyterhub_1  | [D 2021-12-25 08:58:15.017 JupyterHub app:2019] Loading roles into database\r\njupyterhub_1  | [I 2021-12-25 08:58:15.035 JupyterHub app:1924] Not using allowed_users. Any authenticated user will be allowed.\r\njupyterhub_1  | [D 2021-12-25 08:58:15.042 JupyterHub app:2278] Purging expired APITokens\r\njupyterhub_1  | [D 2021-12-25 08:58:15.047 JupyterHub app:2278] Purging expired OAuthCodes\r\njupyterhub_1  | [D 2021-12-25 08:58:15.053 JupyterHub app:2111] Loading role assignments from config\r\njupyterhub_1  | [D 2021-12-25 08:58:15.076 JupyterHub app:2424] Initializing spawners\r\njupyterhub_1  | [D 2021-12-25 08:58:15.080 JupyterHub app:2555] Loaded users:\r\njupyterhub_1  |     \r\njupyterhub_1  | [I 2021-12-25 08:58:15.081 JupyterHub app:2835] Initialized 0 spawners in 0.006 seconds\r\njupyterhub_1  | [W 2021-12-25 08:58:15.087 JupyterHub proxy:565] Found proxy pid file: /srv/jupyterhub/jupyterhub-proxy.pid\r\njupyterhub_1  | [W 2021-12-25 08:58:15.088 JupyterHub proxy:577] Proxy no longer running at pid=12\r\njupyterhub_1  | [D 2021-12-25 08:58:15.088 JupyterHub proxy:618] Removing proxy pid file jupyterhub-proxy.pid\r\njupyterhub_1  | [W 2021-12-25 08:58:15.090 JupyterHub proxy:687] Running JupyterHub without SSL.  I hope there is SSL termination happening somewhere else...\r\njupyterhub_1  | [I 2021-12-25 08:58:15.090 JupyterHub proxy:691] Starting proxy @ http://:8000\r\njupyterhub_1  | [D 2021-12-25 08:58:15.090 JupyterHub proxy:692] Proxy cmd: ['configurable-http-proxy', '--ip', '', '--port', '8000', '--api-ip', '127.0.0.1', '--api-port', '8001', '--error-target', 'http://127.0.0.1:8081/hub/error']\r\njupyterhub_1  | [D 2021-12-25 08:58:15.098 JupyterHub proxy:610] Writing proxy pid file: jupyterhub-proxy.pid\r\njupyterhub_1  | 08:58:16.203 [ConfigProxy] info: Proxying http://*:8000 to (no default)\r\njupyterhub_1  | 08:58:16.210 [ConfigProxy] info: Proxy API at http://127.0.0.1:8001/api/routes\r\njupyterhub_1  | [D 2021-12-25 08:58:16.219 JupyterHub proxy:728] Proxy started and appears to be up\r\njupyterhub_1  | [D 2021-12-25 08:58:16.221 JupyterHub proxy:821] Proxy: Fetching GET http://127.0.0.1:8001/api/routes\r\njupyterhub_1  | 08:58:16.244 [ConfigProxy] info: 200 GET /api/routes \r\njupyterhub_1  | [I 2021-12-25 08:58:16.251 JupyterHub app:3084] Hub API listening on http://127.0.0.1:8081/hub/\r\njupyterhub_1  | [D 2021-12-25 08:58:16.252 JupyterHub proxy:343] Fetching routes to check\r\njupyterhub_1  | [D 2021-12-25 08:58:16.252 JupyterHub proxy:821] Proxy: Fetching GET http://127.0.0.1:8001/api/routes\r\njupyterhub_1  | 08:58:16.265 [ConfigProxy] info: 200 GET /api/routes \r\njupyterhub_1  | [D 2021-12-25 08:58:16.271 JupyterHub proxy:346] Checking routes\r\njupyterhub_1  | [I 2021-12-25 08:58:16.273 JupyterHub proxy:431] Adding route for Hub: / => http://127.0.0.1:8081\r\njupyterhub_1  | [D 2021-12-25 08:58:16.276 JupyterHub proxy:821] Proxy: Fetching POST http://127.0.0.1:8001/api/routes/\r\njupyterhub_1  | 08:58:16.282 [ConfigProxy] info: Adding route / -> http://127.0.0.1:8081\r\njupyterhub_1  | 08:58:16.287 [ConfigProxy] info: Route added / -> http://127.0.0.1:8081\r\njupyterhub_1  | 08:58:16.290 [ConfigProxy] info: 201 POST /api/routes/ \r\njupyterhub_1  | [I 2021-12-25 08:58:16.293 JupyterHub app:3150] JupyterHub is now running at http://:8000\r\njupyterhub_1  | [D 2021-12-25 08:58:16.296 JupyterHub app:2759] It took 1.401 seconds for the Hub to start\r\njupyterhub_1  | [I 2021-12-25 08:58:17.444 JupyterHub log:189] 302 GET /hub/admin -> /hub/login?next=%2Fhub%2Fadmin (@172.20.0.1) 1.23ms\r\nnginx_1       | 172.20.0.1 - - [25/Dec/2021:08:58:17 +0000] \"GET /hub/admin HTTP/1.1\" 302 0 \"-\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.2 Safari/605.1.15\"\r\njupyterhub_1  | [I 2021-12-25 08:58:17.534 JupyterHub log:189] 200 GET /hub/login?next=%2Fhub%2Fadmin (@172.20.0.1) 43.03ms\r\nnginx_1       | 172.20.0.1 - - [25/Dec/2021:08:58:17 +0000] \"GET /hub/login?next=%2Fhub%2Fadmin HTTP/1.1\" 200 5473 \"-\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.2 Safari/605.1.15\"\r\njupyterhub_1  | [D 2021-12-25 08:58:17.563 JupyterHub log:189] 304 GET /hub/static/js/admin-react.js (@172.20.0.1) 1.67ms\r\nnginx_1       | 172.20.0.1 - - [25/Dec/2021:08:58:17 +0000] \"GET /hub/static/js/admin-react.js HTTP/1.1\" 304 0 \"http://127.0.0.1:8080/hub/admin\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.2 Safari/605.1.15\"\r\njupyterhub_1  | [D 2021-12-25 08:58:24.862 JupyterHub roles:449] Assigning default role to User user\r\njupyterhub_1  | [D 2021-12-25 08:58:24.875 JupyterHub base:557] Setting cookie jupyterhub-session-id: {'httponly': True, 'path': '/'}\r\njupyterhub_1  | [D 2021-12-25 08:58:24.876 JupyterHub base:561] Setting cookie for user: jupyterhub-hub-login\r\njupyterhub_1  | [D 2021-12-25 08:58:24.877 JupyterHub base:557] Setting cookie jupyterhub-hub-login: {'httponly': True, 'path': '/hub/'}\r\njupyterhub_1  | [I 2021-12-25 08:58:24.878 JupyterHub base:797] User logged in: user\r\njupyterhub_1  | [I 2021-12-25 08:58:24.884 JupyterHub log:189] 302 POST /hub/login?next=%2Fhub%2Fadmin -> /hub/admin (user@172.20.0.1) 30.40ms\r\nnginx_1       | 172.20.0.1 - - [25/Dec/2021:08:58:24 +0000] \"POST /hub/login?next=%2Fhub%2Fadmin HTTP/1.1\" 302 0 \"http://127.0.0.1:8080/hub/login?next=%2Fhub%2Fadmin\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.2 Safari/605.1.15\"\r\njupyterhub_1  | [D 2021-12-25 08:58:24.937 JupyterHub scopes:488] Checking access via scope admin:users\r\njupyterhub_1  | [D 2021-12-25 08:58:24.937 JupyterHub scopes:386] Unrestricted access to /hub/admin via admin:users\r\njupyterhub_1  | [D 2021-12-25 08:58:24.937 JupyterHub scopes:488] Checking access via scope admin:servers\r\njupyterhub_1  | [D 2021-12-25 08:58:24.938 JupyterHub scopes:386] Unrestricted access to /hub/admin via admin:servers\r\njupyterhub_1  | [D 2021-12-25 08:58:24.954 JupyterHub user:347] Creating <class 'jupyterhub.spawner.LocalProcessSpawner'> for user:\r\njupyterhub_1  | [I 2021-12-25 08:58:24.963 JupyterHub log:189] 200 GET /hub/admin (user@172.20.0.1) 48.74ms\r\nnginx_1       | 172.20.0.1 - - [25/Dec/2021:08:58:24 +0000] \"GET /hub/admin HTTP/1.1\" 200 5162 \"http://127.0.0.1:8080/hub/login?next=%2Fhub%2Fadmin\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.2 Safari/605.1.15\"\r\nnginx_1       | 172.20.0.1 - - [25/Dec/2021:08:58:25 +0000] \"GET /logo HTTP/1.1\" 302 0 \"http://127.0.0.1:8080/hub/admin\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.2 Safari/605.1.15\"\r\njupyterhub_1  | [I 2021-12-25 08:58:25.021 JupyterHub log:189] 302 GET /logo -> /hub/logo (@172.20.0.1) 3.75ms\r\nnginx_1       | 172.20.0.1 - - [25/Dec/2021:08:58:25 +0000] \"GET /hub/static/js/admin-react.js HTTP/1.1\" 304 0 \"http://127.0.0.1:8080/hub/admin\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.2 Safari/605.1.15\"\r\njupyterhub_1  | [D 2021-12-25 08:58:25.062 JupyterHub log:189] 304 GET /hub/static/js/admin-react.js (@172.20.0.1) 2.92ms\r\njupyterhub_1  | [D 2021-12-25 08:58:25.079 JupyterHub log:189] 200 GET /hub/logo (@172.20.0.1) 3.64ms\r\nnginx_1       | 172.20.0.1 - - [25/Dec/2021:08:58:25 +0000] \"GET /hub/logo HTTP/1.1\" 200 11453 \"http://127.0.0.1:8080/hub/admin\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.2 Safari/605.1.15\"\r\njupyterhub_1  | [D 2021-12-25 08:58:25.142 JupyterHub log:189] 200 GET /hub/static/js/admin.js?v=20211225085815 (@172.20.0.1) 4.37ms\r\nnginx_1       | 172.20.0.1 - - [25/Dec/2021:08:58:25 +0000] \"GET /hub/static/js/admin.js?v=20211225085815 HTTP/1.1\" 200 8013 \"http://127.0.0.1:8080/hub/admin\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.2 Safari/605.1.15\"\r\njupyterhub_1  | [W 2021-12-25 08:58:25.156 JupyterHub base:89] Blocking Cross Origin API request.  Referer: http://127.0.0.1:8080/hub/admin, Host: 127.0.0.1, Host URL: http://127.0.0.1/hub/\r\njupyterhub_1  | [D 2021-12-25 08:58:25.165 JupyterHub scopes:488] Checking access via scope list:groups\r\njupyterhub_1  | [D 2021-12-25 08:58:25.168 JupyterHub scopes:383] No access to /hub/api/groups via list:groups\r\njupyterhub_1  | [W 2021-12-25 08:58:25.169 JupyterHub scopes:496] Not authorizing access to /hub/api/groups. Requires any of [list:groups], not derived from scopes []\r\njupyterhub_1  | [W 2021-12-25 08:58:25.177 JupyterHub web:1787] 403 GET /hub/api/groups?offset=0&limit=50 (172.20.0.1): Action is not authorized with current scopes; requires any of [list:groups]\r\njupyterhub_1  | [W 2021-12-25 08:58:25.184 JupyterHub log:189] 403 GET /hub/api/groups?offset=0&limit=50 (@172.20.0.1) 40.88ms\r\njupyterhub_1  | [W 2021-12-25 08:58:25.190 JupyterHub base:89] Blocking Cross Origin API request.  Referer: http://127.0.0.1:8080/hub/admin, Host: 127.0.0.1, Host URL: http://127.0.0.1/hub/\r\njupyterhub_1  | [D 2021-12-25 08:58:25.190 JupyterHub scopes:488] Checking access via scope list:users\r\njupyterhub_1  | [D 2021-12-25 08:58:25.190 JupyterHub scopes:383] No access to /hub/api/users via list:users\r\njupyterhub_1  | [W 2021-12-25 08:58:25.191 JupyterHub scopes:496] Not authorizing access to /hub/api/users. Requires any of [list:users], not derived from scopes []\r\njupyterhub_1  | [W 2021-12-25 08:58:25.191 JupyterHub web:1787] 403 GET /hub/api/users?offset=0&limit=50 (172.20.0.1): Action is not authorized with current scopes; requires any of [list:users]\r\njupyterhub_1  | [W 2021-12-25 08:58:25.192 JupyterHub log:189] 403 GET /hub/api/users?offset=0&limit=50 (@172.20.0.1) 43.34ms\r\nnginx_1       | 172.20.0.1 - - [25/Dec/2021:08:58:25 +0000] \"GET /hub/api/groups?offset=0&limit=50 HTTP/1.1\" 403 105 \"http://127.0.0.1:8080/hub/admin\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.2 Safari/605.1.15\"\r\nnginx_1       | 172.20.0.1 - - [25/Dec/2021:08:58:25 +0000] \"GET /hub/api/users?offset=0&limit=50 HTTP/1.1\" 403 104 \"http://127.0.0.1:8080/hub/admin\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.2 Safari/605.1.15\"\r\njupyterhub_1  | [D 2021-12-25 08:58:25.227 JupyterHub log:189] 200 GET /hub/static/js/jhapi.js?v=20211225085815 (@172.20.0.1) 2.09ms\r\nnginx_1       | 172.20.0.1 - - [25/Dec/2021:08:58:25 +0000] \"GET /hub/static/js/jhapi.js?v=20211225085815 HTTP/1.1\" 200 4446 \"http://127.0.0.1:8080/hub/admin\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.2 Safari/605.1.15\"\r\njupyterhub_1  | [D 2021-12-25 08:58:25.236 JupyterHub log:189] 200 GET /hub/static/components/moment/moment.js?v=20211225085815 (@172.20.0.1) 10.13ms\r\njupyterhub_1  | [D 2021-12-25 08:58:25.243 JupyterHub log:189] 200 GET /hub/static/js/utils.js?v=20211225085815 (@172.20.0.1) 17.01ms\r\nnginx_1       | 172.20.0.1 - - [25/Dec/2021:08:58:25 +0000] \"GET /hub/static/components/moment/moment.js?v=20211225085815 HTTP/1.1\" 200 173902 \"http://127.0.0.1:8080/hub/admin\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.2 Safari/605.1.15\"\r\nnginx_1       | 172.20.0.1 - - [25/Dec/2021:08:58:25 +0000] \"GET /hub/static/js/utils.js?v=20211225085815 HTTP/1.1\" 200 4383 \"http://127.0.0.1:8080/hub/admin\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.2 Safari/605.1.15\"\r\n```\r\n\r\n- Errors in the browser console (Safari 15.2):\r\n```\r\n[Error] Failed to load resource: the server responded with a status of 403 (Forbidden) (users, line 0)\r\n[Error] Failed to load resource: the server responded with a status of 403 (Forbidden) (groups, line 0)\r\n[Error] TypeError: undefined is not a function (near '...u.map...') \u2014 admin-react.js:2:28870\r\n\tri (admin-react.js:2:146088)\r\n\t(anonymous function) (admin-react.js:2:148187)\r\n\tco (admin-react.js:2:112238)\r\n\tsi (admin-react.js:2:149923)\r\n\tCu (admin-react.js:2:166325)\r\n\tCu\r\n\t(anonymous function) (admin-react.js:2:194357)\r\n\txu (admin-react.js:2:163064)\r\n\tdu (admin-react.js:2:159263)\r\n\tdu\r\n\t(anonymous function) (admin-react.js:2:108745)\r\n\t(anonymous function) (admin-react.js:2:194357)\r\n\tVa (admin-react.js:2:108691)\r\n\tHa (admin-react.js:2:108626)\r\n\tpu (admin-react.js:2:159359)\r\n\tnotify (admin-react.js:2:919)\r\n\t(anonymous function) (admin-react.js:2:494)\r\n\t(anonymous function) (admin-react.js:2:569)\r\n\t(anonymous function)\r\n\tp (admin-react.js:2:52697)\r\n\tpromiseReactionJob\r\n```\r\n</details>\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3737/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3737/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3735", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3735/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3735/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3735/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3735", "id": 1086609509, "node_id": "PR_kwDOAT0rQs4wLFD2", "number": 3735, "title": "initialize new admin users with default roles", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-12-22T09:08:26Z", "updated_at": "2021-12-22T09:39:41Z", "closed_at": "2021-12-22T09:28:21Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3735", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3735", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3735.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3735.patch", "merged_at": "2021-12-22T09:28:20Z"}, "body": "#3720 updated the expected roles of admins to include 'user', but the tests were passing without being updated because it was only after concurrent PR #3714 or #3708 that the default admin user in the test setup actually got this role assigned.\r\n\r\nit was also still possible for a user in `admin_users` to not get the `user` role if they were not present in the db.\r\n\r\ncloses #3734 \r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3735/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3735/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3734", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3734/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3734/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3734/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3734", "id": 1086315938, "node_id": "I_kwDOAT0rQs5Av92i", "number": 3734, "title": "Tests are failing on main branch", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-12-21T23:48:41Z", "updated_at": "2021-12-22T09:28:20Z", "closed_at": "2021-12-22T09:28:20Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "I've run the tests on the main branch and conclude they are currently failing. See https://github.com/jupyterhub/jupyterhub/actions/runs/1609109514.\r\n\r\nIt seems that while #3722 was merged with succeeded tests, the PRs listed below had been merged in between #3722 was tested and #3722 was merged - and consistent test failures followed.\r\n\r\n- #3720\r\n- #3705\r\n- #3708\r\n- #3727\r\n\r\n### Failure\r\n\r\n```\r\n________________________________ test_get_users ________________________________\r\n\r\napp = <jupyterhub.tests.mocking.MockHub object at 0x7f9a3c845f60>\r\n\r\n    @mark.user\r\n    @mark.role\r\n    async def test_get_users(app):\r\n        db = app.db\r\n    \r\n        r = await api_request(app, 'users', headers=auth_header(db, 'admin'))\r\n        assert r.status_code == 200\r\n    \r\n        users = sorted(r.json(), key=lambda d: d['name'])\r\n        users = [normalize_user(u) for u in users]\r\n        user_model = {\r\n            'name': 'user',\r\n            'admin': False,\r\n            'roles': ['user'],\r\n            'auth_state': None,\r\n        }\r\n>       assert users == [\r\n            fill_user(\r\n                {'name': 'admin', 'admin': True, 'roles': ['admin'], 'auth_state': None}\r\n            ),\r\n            fill_user(user_model),\r\n        ]\r\nE       AssertionError: assert [{'admin': Tr...ps': [], ...}] == [{'admin': Tr...ps': [], ...}]\r\nE         At index 0 diff: {'server': None, 'admin': True, 'created': '0000-00-00T00:00:00Z', 'groups': [], 'auth_state': None, 'roles': ['admin', 'user'], 'last_activity': '0000-00-00T00:00:00Z', 'pending': None, 'kind': 'user', 'name': 'admin', 'servers': {}} != {'name': 'admin', 'admin': True, 'roles': ['admin'], 'auth_state': None, 'server': None, 'kind': 'user', 'groups': [], 'pending': None, 'created': '0000-00-00T00:00:00Z', 'last_activity': '0000-00-00T00:00:00Z', 'servers': {}}\r\nE         Full diff:\r\nE           [\r\nE            {'admin': True,\r\nE             'auth_state': None,\r\nE             'created': '0000-00-00T00:00:00Z',\r\nE             'groups': [],\r\nE             'kind': 'user',\r\nE             'last_activity': '0000-00-00T00:00:00Z',\r\nE             'name': 'admin',\r\nE             'pending': None,\r\nE         -   'roles': ['admin'],\r\nE         +   'roles': ['admin', 'user'],\r\nE         ?                    ++++++++\r\nE             'server': None,\r\nE             'servers': {}},\r\nE            {'admin': False,\r\nE             'auth_state': None,\r\nE             'created': '0000-00-00T00:00:00Z',\r\nE             'groups': [],\r\nE             'kind': 'user',\r\nE             'last_activity': '0000-00-00T00:00:00Z',\r\nE             'name': 'user',\r\nE             'pending': None,\r\nE             'roles': ['user'],\r\nE             'server': None,\r\nE             'servers': {}},\r\nE           ]\r\n\r\njupyterhub/tests/test_api.py:241: AssertionError\r\n```", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3734/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3734/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3733", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3733/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3733/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3733/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3733", "id": 1086308261, "node_id": "PR_kwDOAT0rQs4wKGZ_", "number": 3733, "title": "Fix missing f-string modifier", "user": {"login": "manics", "id": 1644105, "node_id": "MDQ6VXNlcjE2NDQxMDU=", "avatar_url": "https://avatars.githubusercontent.com/u/1644105?v=4", "gravatar_id": "", "url": "https://api.github.com/users/manics", "html_url": "https://github.com/manics", "followers_url": "https://api.github.com/users/manics/followers", "following_url": "https://api.github.com/users/manics/following{/other_user}", "gists_url": "https://api.github.com/users/manics/gists{/gist_id}", "starred_url": "https://api.github.com/users/manics/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/manics/subscriptions", "organizations_url": "https://api.github.com/users/manics/orgs", "repos_url": "https://api.github.com/users/manics/repos", "events_url": "https://api.github.com/users/manics/events{/privacy}", "received_events_url": "https://api.github.com/users/manics/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-12-21T23:28:37Z", "updated_at": "2021-12-21T23:38:52Z", "closed_at": "2021-12-21T23:37:37Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3733", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3733", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3733.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3733.patch", "merged_at": "2021-12-21T23:37:37Z"}, "body": "Noticed whilst trying to debug an admin page problem.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3733/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3733/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3731", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3731/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3731/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3731/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3731", "id": 1084744573, "node_id": "PR_kwDOAT0rQs4wE8Ls", "number": 3731, "title": "accept token auth on `/hub/user/...`", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-12-20T12:38:22Z", "updated_at": "2022-01-18T13:18:28Z", "closed_at": "2021-12-20T16:42:42Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3731", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3731", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3731.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3731.patch", "merged_at": "2021-12-20T16:42:41Z"}, "body": " which are probably requests to non-running servers\r\n\r\notherwise, requests get redirected to `/hub/login` instead of failing with informative 404/503\r\n\r\ncloses #3730 ", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3731/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3731/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3730", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3730/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3730/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3730/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3730", "id": 1084726631, "node_id": "I_kwDOAT0rQs5Ap51n", "number": 3730, "title": "302 on token-authenticated API request to not-running server", "user": {"login": "vladimirlagunov", "id": 479184, "node_id": "MDQ6VXNlcjQ3OTE4NA==", "avatar_url": "https://avatars.githubusercontent.com/u/479184?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vladimirlagunov", "html_url": "https://github.com/vladimirlagunov", "followers_url": "https://api.github.com/users/vladimirlagunov/followers", "following_url": "https://api.github.com/users/vladimirlagunov/following{/other_user}", "gists_url": "https://api.github.com/users/vladimirlagunov/gists{/gist_id}", "starred_url": "https://api.github.com/users/vladimirlagunov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vladimirlagunov/subscriptions", "organizations_url": "https://api.github.com/users/vladimirlagunov/orgs", "repos_url": "https://api.github.com/users/vladimirlagunov/repos", "events_url": "https://api.github.com/users/vladimirlagunov/events{/privacy}", "received_events_url": "https://api.github.com/users/vladimirlagunov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2021-12-20T12:20:20Z", "updated_at": "2021-12-20T16:42:41Z", "closed_at": "2021-12-20T16:42:41Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\nWe at DataSpell faced the problem with JupyterHub 2.0. The IDE can't access Jupyter's Contents API any more. \r\n\r\nTake a look at the events happening when a user tries to register a JupyterHub 2.0 server in DataSpell:\r\n* The user presses the button that adds a Jupyter connection, then they provide a valid URL to the server\r\n* The IDE makes a request to the server, reaches out \"jupyterhub\" in the response headers, and proposes obtaining an API token\r\n* The user successfully gets the token at /hub/api/token in a web browser, and provides the token to the IDE\r\n* The IDE sends a GET request to /user/username/api/contents/ with a header `Authorization: Token ...`\r\n* `PrefixRedirectHandler` responds with HTTP 302, suggesting to go to `/hub/user/username/api/contents/ `\r\n* The IDE follows the redirect, and `UserUrlHandler` redirects to `/hub/login`, even though the Authorization header is provided.\r\n\r\nThat behaviour was introduced in edfdf672d829dd9dc2d7f285bc5b2a5693291425. Although the commit message states that it was to avoid surprises, I have to admit that it actually was a surprise for us.\r\n\r\n### How to reproduce\r\nSo, to simplify things, here are steps how to reproduce without DataSpell:\r\n* Start a JupyterHub 2.0.0, spawn a notebook server, obtain an API token\r\n* Execute `curl -vL http://server/user/username/api/contents/ -H 'Authorization: Token ...'`\r\n\r\n#### Expected behaviour\r\nThe response of the server on a Contents API request is a valid JSON, like it used to be with JupyterHub 1.4.*\r\n\r\n#### Actual behaviour\r\nJupyterHub disallows to access Contents API without a cookie which can be obtained only through passing a login form, and it redirects to a login page.\r\n\r\n### Your personal set up\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n\r\n - OS:\r\n   Actually, it doesn't matter, but let it be macOS.\r\n - Version(s):\r\n   `jupyterhub --version` writes `2.0.0`\r\n    Python 3.10.1 (and also Python 3.9.5, and I bet any other version too).\r\n\r\n- <details><summary>Full environment</summary>\r\n\r\n    ```\r\n    alembic==1.7.5\r\n    anyio==3.4.0\r\n    appnope==0.1.2\r\n    argon2-cffi==21.3.0\r\n    argon2-cffi-bindings==21.2.0\r\n    async-generator==1.10\r\n    attrs==21.2.0\r\n    Babel==2.9.1\r\n    backcall==0.2.0\r\n    bleach==4.1.0\r\n    certifi==2021.10.8\r\n    certipy==0.1.3\r\n    cffi==1.15.0\r\n    charset-normalizer==2.0.9\r\n    cryptography==36.0.0\r\n    debugpy==1.5.1\r\n    decorator==5.1.0\r\n    defusedxml==0.7.1\r\n    entrypoints==0.3\r\n    greenlet==1.1.2\r\n    idna==3.3\r\n    ipykernel==6.6.0\r\n    ipython==7.30.1\r\n    ipython-genutils==0.2.0\r\n    ipywidgets==7.6.5\r\n    jedi==0.18.1\r\n    Jinja2==3.0.3\r\n    json5==0.9.6\r\n    jsonschema==4.2.1\r\n    jupyter==1.0.0\r\n    jupyter-client==7.1.0\r\n    jupyter-console==6.4.0\r\n    jupyter-core==4.9.1\r\n    jupyter-server==1.13.1\r\n    jupyter-telemetry==0.1.0\r\n    jupyterhub==2.0.0\r\n    jupyterlab==3.2.5\r\n    jupyterlab-pygments==0.1.2\r\n    jupyterlab-server==2.9.0\r\n    jupyterlab-widgets==1.0.2\r\n    Mako==1.1.6\r\n    MarkupSafe==2.0.1\r\n    matplotlib-inline==0.1.3\r\n    mistune==0.8.4\r\n    nbclassic==0.3.4\r\n    nbclient==0.5.9\r\n    nbconvert==6.3.0\r\n    nbformat==5.1.3\r\n    nest-asyncio==1.5.4\r\n    notebook==6.4.6\r\n    numpy==1.21.4\r\n    oauthlib==3.1.1\r\n    packaging==21.3\r\n    pamela==1.0.0\r\n    pandas==1.3.5\r\n    pandocfilters==1.5.0\r\n    parso==0.8.3\r\n    pexpect==4.8.0\r\n    pickleshare==0.7.5\r\n    prometheus-client==0.12.0\r\n    prompt-toolkit==3.0.24\r\n    ptyprocess==0.7.0\r\n    pycparser==2.21\r\n    Pygments==2.10.0\r\n    pyOpenSSL==21.0.0\r\n    pyparsing==3.0.6\r\n    pyrsistent==0.18.0\r\n    python-dateutil==2.8.2\r\n    python-json-logger==2.0.2\r\n    pytz==2021.3\r\n    pyzmq==22.3.0\r\n    qtconsole==5.2.2\r\n    QtPy==1.11.3\r\n    requests==2.26.0\r\n    ruamel.yaml==0.17.17\r\n    Send2Trash==1.8.0\r\n    six==1.16.0\r\n    sniffio==1.2.0\r\n    SQLAlchemy==1.4.28\r\n    terminado==0.12.1\r\n    testpath==0.5.0\r\n    tornado==6.1\r\n    traitlets==5.1.1\r\n    urllib3==1.26.7\r\n    wcwidth==0.2.5\r\n    webencodings==0.5.1\r\n    websocket-client==1.2.3\r\n    widgetsnbextension==3.5.2\r\n    ```\r\n</details>\r\n\r\n- <details><summary>Configuration</summary>\r\n    No custom configuration files at all.\r\n    \r\n    ```python\r\n    # jupyterhub_config.py\r\n    ```\r\n    </details>\r\n\r\n- <details><summary>Logs</summary>\r\n    The log is mixed up with some debugging prints I added, but believe me I didn't change anything in the logic.\r\n\r\n    ```\r\n    /Users/lagunov/src/jetbrains/idea/main/python/jupyter/setup-jupyter-env/build/pythons/py310_jupyter_hub_2/lib/python3.10/site-packages/traitlets/traitlets.py:2562: FutureWarning: --Spawner.args=['--Application.log_level=DEBUG'] for containers is deprecated in traitlets 5.0. You can pass `--Spawner.args item` ... multiple times to add items to a list.\r\n      warn(\r\n    /Users/lagunov/src/jetbrains/idea/main/python/jupyter/setup-jupyter-env/build/pythons/py310_jupyter_hub_2/lib/python3.10/site-packages/traitlets/traitlets.py:2562: FutureWarning: --Spawner.cmd=['jupyterhub-singleuser', '--allow-root'] for containers is deprecated in traitlets 5.0. You can pass `--Spawner.cmd item` ... multiple times to add items to a list.\r\n      warn(\r\n    /Users/lagunov/src/jetbrains/idea/main/python/jupyter/setup-jupyter-env/build/pythons/py310_jupyter_hub_2/lib/python3.10/site-packages/traitlets/traitlets.py:2562: FutureWarning: --Authenticator.admin_users={'lagunov'} for containers is deprecated in traitlets 5.0. You can pass `--Authenticator.admin_users item` ... multiple times to add items to a list.\r\n      warn(\r\n    [W 2021-12-20 19:05:00.383 JupyterHub app:786] JupyterHub.proxy_api_port is deprecated in JupyterHub 0.8, use ConfigurableHTTPProxy.api_url\r\n    [D 2021-12-20 19:05:00.384 JupyterHub application:731] Looking for jupyterhub_config in /private/tmp/hub\r\n    [I 2021-12-20 19:05:00.385 JupyterHub app:2717] Running JupyterHub version 2.0.0\r\n    [I 2021-12-20 19:05:00.385 JupyterHub app:2747] Using Authenticator: jupyterhub.auth.PAMAuthenticator-2.0.0\r\n    [I 2021-12-20 19:05:00.385 JupyterHub app:2747] Using Spawner: jupyterhub.spawner.LocalProcessSpawner-2.0.0\r\n    [I 2021-12-20 19:05:00.385 JupyterHub app:2747] Using Proxy: jupyterhub.proxy.ConfigurableHTTPProxy-2.0.0\r\n    [D 2021-12-20 19:05:00.387 JupyterHub app:2678] Could not load pycurl: No module named 'pycurl'\r\n        pycurl is recommended if you have a large number of users.\r\n    [I 2021-12-20 19:05:00.387 JupyterHub app:1596] Loading cookie_secret from /private/tmp/hub/jupyterhub_cookie_secret\r\n    [D 2021-12-20 19:05:00.388 JupyterHub app:1763] Connecting to db: sqlite:///jupyterhub.sqlite\r\n    [D 2021-12-20 19:05:00.417 JupyterHub orm:955] database schema version found: 833da8570507\r\n    [I 2021-12-20 19:05:00.482 JupyterHub proxy:496] Generating new CONFIGPROXY_AUTH_TOKEN\r\n    [D 2021-12-20 19:05:00.482 JupyterHub app:2007] Loading default roles to database\r\n    [I 2021-12-20 19:05:00.497 JupyterHub app:1913] Not using allowed_users. Any authenticated user will be allowed.\r\n    [D 2021-12-20 19:05:00.503 JupyterHub app:2229] Purging expired APITokens\r\n    [D 2021-12-20 19:05:00.507 JupyterHub app:2229] Purging expired OAuthCodes\r\n    [D 2021-12-20 19:05:00.509 JupyterHub app:2080] Loading predefined roles from config file to database\r\n    [D 2021-12-20 19:05:00.524 JupyterHub app:2375] Initializing spawners\r\n    [D 2021-12-20 19:05:00.527 JupyterHub app:2506] Loaded users:\r\n        \r\n    [I 2021-12-20 19:05:00.527 JupyterHub app:2786] Initialized 0 spawners in 0.004 seconds\r\n    [W 2021-12-20 19:05:00.529 JupyterHub proxy:565] Found proxy pid file: /private/tmp/hub/jupyterhub-proxy.pid\r\n    [W 2021-12-20 19:05:00.530 JupyterHub proxy:577] Proxy no longer running at pid=5806\r\n    [D 2021-12-20 19:05:00.530 JupyterHub proxy:618] Removing proxy pid file jupyterhub-proxy.pid\r\n    [W 2021-12-20 19:05:00.531 JupyterHub proxy:687] Running JupyterHub without SSL.  I hope there is SSL termination happening somewhere else...\r\n    [I 2021-12-20 19:05:00.531 JupyterHub proxy:691] Starting proxy @ http://127.0.0.1:8000/\r\n    [D 2021-12-20 19:05:00.531 JupyterHub proxy:692] Proxy cmd: ['configurable-http-proxy', '--ip', '127.0.0.1', '--port', '8000', '--api-ip', '127.0.0.1', '--api-port', '56323', '--error-target', 'http://127.0.0.1:56322/hub/error']\r\n    [D 2021-12-20 19:05:00.535 JupyterHub proxy:610] Writing proxy pid file: jupyterhub-proxy.pid\r\n    19:05:00.739 [ConfigProxy] \u001b[32minfo\u001b[39m: Proxying http://127.0.0.1:8000 to (no default)\r\n    19:05:00.741 [ConfigProxy] \u001b[32minfo\u001b[39m: Proxy API at http://127.0.0.1:56323/api/routes\r\n    [D 2021-12-20 19:05:00.799 JupyterHub proxy:728] Proxy started and appears to be up\r\n    [D 2021-12-20 19:05:00.805 JupyterHub proxy:821] Proxy: Fetching GET http://127.0.0.1:56323/api/routes\r\n    19:05:00.819 [ConfigProxy] \u001b[32minfo\u001b[39m: 200 GET /api/routes \r\n    [I 2021-12-20 19:05:00.820 JupyterHub app:3035] Hub API listening on http://127.0.0.1:56322/hub/\r\n    [D 2021-12-20 19:05:00.820 JupyterHub proxy:343] Fetching routes to check\r\n    [D 2021-12-20 19:05:00.821 JupyterHub proxy:821] Proxy: Fetching GET http://127.0.0.1:56323/api/routes\r\n    19:05:00.823 [ConfigProxy] \u001b[32minfo\u001b[39m: 200 GET /api/routes \r\n    [D 2021-12-20 19:05:00.823 JupyterHub proxy:346] Checking routes\r\n    [I 2021-12-20 19:05:00.823 JupyterHub proxy:431] Adding route for Hub: / => http://127.0.0.1:56322\r\n    [D 2021-12-20 19:05:00.824 JupyterHub proxy:821] Proxy: Fetching POST http://127.0.0.1:56323/api/routes/\r\n    19:05:00.826 [ConfigProxy] \u001b[32minfo\u001b[39m: Adding route / -> http://127.0.0.1:56322\r\n    19:05:00.827 [ConfigProxy] \u001b[32minfo\u001b[39m: Route added / -> http://127.0.0.1:56322\r\n    19:05:00.827 [ConfigProxy] \u001b[32minfo\u001b[39m: 201 POST /api/routes/ \r\n    [I 2021-12-20 19:05:00.829 JupyterHub app:3101] JupyterHub is now running at http://127.0.0.1:8000/\r\n    [D 2021-12-20 19:05:00.830 JupyterHub app:2710] It took 0.454 seconds for the Hub to start\r\n    [I 2021-12-20 19:05:24.069 JupyterHub web:2175] *** LAGUNOV DBG: GET / is handled by $<class 'jupyterhub.handlers.base.PrefixRedirectHandler'>\r\n    [I 2021-12-20 19:05:24.077 JupyterHub base:422] LAGUNOV DBG get_current_user self._accept_token_auth=False self._accept_cookie_auth=True\r\n    [I 2021-12-20 19:05:24.078 JupyterHub web:812] LAGUNOV DBG redirect 302 /hub/\r\n    [I 2021-12-20 19:05:24.078 JupyterHub log:189] 302 GET / -> /hub/ (@127.0.0.1) 9.74ms\r\n    [I 2021-12-20 19:05:24.082 JupyterHub web:2175] *** LAGUNOV DBG: GET /hub/ is handled by $<class 'jupyterhub.handlers.pages.RootHandler'>\r\n    [I 2021-12-20 19:05:24.083 JupyterHub base:422] LAGUNOV DBG get_current_user self._accept_token_auth=False self._accept_cookie_auth=True\r\n    [I 2021-12-20 19:05:24.084 JupyterHub web:812] LAGUNOV DBG redirect 302 /hub/login?next=%2Fhub%2F\r\n    [I 2021-12-20 19:05:24.085 JupyterHub log:189] 302 GET /hub/ -> /hub/login?next=%2Fhub%2F (@127.0.0.1) 2.56ms\r\n    [I 2021-12-20 19:05:24.088 JupyterHub web:2175] *** LAGUNOV DBG: GET /hub/login?next=%2Fhub%2F is handled by $<class 'jupyterhub.handlers.login.LoginHandler'>\r\n    [I 2021-12-20 19:05:24.089 JupyterHub base:422] LAGUNOV DBG get_current_user self._accept_token_auth=False self._accept_cookie_auth=True\r\n    [I 2021-12-20 19:05:24.125 JupyterHub log:189] 200 GET /hub/login?next=%2Fhub%2F (@127.0.0.1) 37.64ms\r\n    [I 2021-12-20 19:05:26.166 JupyterHub web:2175] *** LAGUNOV DBG: GET /hub/token is handled by $<class 'jupyterhub.handlers.pages.TokenPageHandler'>\r\n    [I 2021-12-20 19:05:26.167 JupyterHub base:422] LAGUNOV DBG get_current_user self._accept_token_auth=False self._accept_cookie_auth=True\r\n    [W 2021-12-20 19:05:26.167 JupyterHub base:393] Invalid or expired cookie token\r\n    [I 2021-12-20 19:05:26.168 JupyterHub web:812] LAGUNOV DBG redirect 302 /hub/login?next=%2Fhub%2Ftoken\r\n    [I 2021-12-20 19:05:26.169 JupyterHub log:189] 302 GET /hub/token -> /hub/login?next=%2Fhub%2Ftoken (@127.0.0.1) 3.05ms\r\n    [I 2021-12-20 19:05:26.177 JupyterHub web:2175] *** LAGUNOV DBG: GET /hub/login?next=%2Fhub%2Ftoken is handled by $<class 'jupyterhub.handlers.login.LoginHandler'>\r\n    [I 2021-12-20 19:05:26.178 JupyterHub base:422] LAGUNOV DBG get_current_user self._accept_token_auth=False self._accept_cookie_auth=True\r\n    [I 2021-12-20 19:05:26.180 JupyterHub log:189] 200 GET /hub/login?next=%2Fhub%2Ftoken (@127.0.0.1) 2.77ms\r\n    [I 2021-12-20 19:05:26.194 JupyterHub web:2175] *** LAGUNOV DBG: GET /hub/logo is handled by $<class 'jupyterhub.handlers.static.LogoHandler'>\r\n    [D 2021-12-20 19:05:26.203 JupyterHub log:189] 304 GET /hub/logo (@127.0.0.1) 8.04ms\r\n    [I 2021-12-20 19:05:32.714 JupyterHub web:2175] *** LAGUNOV DBG: POST /hub/login?next=%2Fhub%2Ftoken is handled by $<class 'jupyterhub.handlers.login.LoginHandler'>\r\n    [I 2021-12-20 19:05:32.714 JupyterHub base:422] LAGUNOV DBG get_current_user self._accept_token_auth=False self._accept_cookie_auth=True\r\n    [D 2021-12-20 19:05:32.966 JupyterHub base:568] Setting cookie for lagunov: jupyterhub-hub-login\r\n    [D 2021-12-20 19:05:32.966 JupyterHub base:564] Setting cookie jupyterhub-hub-login: {'httponly': True, 'path': '/hub/'}\r\n    [I 2021-12-20 19:05:32.966 JupyterHub base:803] User logged in: lagunov\r\n    [I 2021-12-20 19:05:32.967 JupyterHub web:812] LAGUNOV DBG redirect 302 /hub/token\r\n    [I 2021-12-20 19:05:32.967 JupyterHub log:189] 302 POST /hub/login?next=%2Fhub%2Ftoken -> /hub/token (lagunov@127.0.0.1) 253.34ms\r\n    [I 2021-12-20 19:05:32.974 JupyterHub web:2175] *** LAGUNOV DBG: GET /hub/token is handled by $<class 'jupyterhub.handlers.pages.TokenPageHandler'>\r\n    [I 2021-12-20 19:05:32.975 JupyterHub base:422] LAGUNOV DBG get_current_user self._accept_token_auth=False self._accept_cookie_auth=True\r\n    [D 2021-12-20 19:05:32.996 JupyterHub user:347] Creating <class 'jupyterhub.spawner.LocalProcessSpawner'> for lagunov:\r\n    [I 2021-12-20 19:05:32.998 JupyterHub log:189] 200 GET /hub/token (lagunov@127.0.0.1) 23.94ms\r\n    [I 2021-12-20 19:05:33.050 JupyterHub web:2175] *** LAGUNOV DBG: GET /hub/static/js/token.js?v=20211220190500 is handled by $<class 'jupyterhub.handlers.static.CacheControlStaticFilesHandler'>\r\n    [D 2021-12-20 19:05:33.051 JupyterHub log:189] 200 GET /hub/static/js/token.js?v=20211220190500 (@127.0.0.1) 1.61ms\r\n    [I 2021-12-20 19:05:33.065 JupyterHub web:2175] *** LAGUNOV DBG: GET /hub/static/js/jhapi.js?v=20211220190500 is handled by $<class 'jupyterhub.handlers.static.CacheControlStaticFilesHandler'>\r\n    [D 2021-12-20 19:05:33.066 JupyterHub log:189] 200 GET /hub/static/js/jhapi.js?v=20211220190500 (@127.0.0.1) 1.24ms\r\n    [I 2021-12-20 19:05:33.066 JupyterHub web:2175] *** LAGUNOV DBG: GET /hub/static/components/moment/moment.js?v=20211220190500 is handled by $<class 'jupyterhub.handlers.static.CacheControlStaticFilesHandler'>\r\n    [D 2021-12-20 19:05:33.071 JupyterHub log:189] 200 GET /hub/static/components/moment/moment.js?v=20211220190500 (@127.0.0.1) 4.06ms\r\n    [I 2021-12-20 19:05:33.077 JupyterHub web:2175] *** LAGUNOV DBG: GET /hub/static/js/utils.js?v=20211220190500 is handled by $<class 'jupyterhub.handlers.static.CacheControlStaticFilesHandler'>\r\n    [D 2021-12-20 19:05:33.079 JupyterHub log:189] 200 GET /hub/static/js/utils.js?v=20211220190500 (@127.0.0.1) 2.08ms\r\n    [I 2021-12-20 19:05:34.380 JupyterHub web:2175] *** LAGUNOV DBG: POST /hub/api/users/lagunov/tokens is handled by $<class 'jupyterhub.apihandlers.users.UserTokenListAPIHandler'>\r\n    [I 2021-12-20 19:05:34.381 JupyterHub base:422] LAGUNOV DBG get_current_user self._accept_token_auth=True self._accept_cookie_auth=True\r\n    [D 2021-12-20 19:05:34.389 JupyterHub roles:450] Assigning default role to token\r\n    [I 2021-12-20 19:05:34.394 JupyterHub roles:454] Added role token to token <APIToken('c931...', user='lagunov', client_id='jupyterhub')>\r\n    [I 2021-12-20 19:05:34.397 JupyterHub users:429] User lagunov requested new API token\r\n    [I 2021-12-20 19:05:34.402 JupyterHub log:189] 201 POST /hub/api/users/lagunov/tokens (lagunov@127.0.0.1) 21.45ms\r\n    [I 2021-12-20 19:05:39.676 JupyterHub web:2175] *** LAGUNOV DBG: GET /user/lagunov/api/contents/ is handled by $<class 'jupyterhub.handlers.base.PrefixRedirectHandler'>\r\n    [I 2021-12-20 19:05:39.677 JupyterHub base:422] LAGUNOV DBG get_current_user self._accept_token_auth=False self._accept_cookie_auth=True\r\n    [I 2021-12-20 19:05:39.677 JupyterHub web:812] LAGUNOV DBG redirect 302 /hub/user/lagunov/api/contents/\r\n    [I 2021-12-20 19:05:39.678 JupyterHub log:189] 302 GET /user/lagunov/api/contents/ -> /hub/user/lagunov/api/contents/ (@127.0.0.1) 1.95ms\r\n    [I 2021-12-20 19:05:39.682 JupyterHub web:2175] *** LAGUNOV DBG: GET /hub/user/lagunov/api/contents/ is handled by $<class 'jupyterhub.handlers.base.UserUrlHandler'>\r\n    [I 2021-12-20 19:05:39.683 JupyterHub base:422] LAGUNOV DBG get_current_user self._accept_token_auth=False self._accept_cookie_auth=True\r\n    [I 2021-12-20 19:05:39.683 JupyterHub web:812] LAGUNOV DBG redirect 302 /hub/login?next=%2Fhub%2Fuser%2Flagunov%2Fapi%2Fcontents%2F\r\n    [I 2021-12-20 19:05:39.684 JupyterHub log:189] 302 GET /hub/user/lagunov/api/contents/ -> /hub/login?next=%2Fhub%2Fuser%2Flagunov%2Fapi%2Fcontents%2F (@127.0.0.1) 1.70ms\r\n    ```\r\n    </details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3730/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3730/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3729", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3729/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3729/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3729/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3729", "id": 1084690585, "node_id": "I_kwDOAT0rQs5ApxCZ", "number": 3729, "title": "JupyterHub Admin page as React app does not respect bind_url", "user": {"login": "amoshche", "id": 6159242, "node_id": "MDQ6VXNlcjYxNTkyNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/6159242?v=4", "gravatar_id": "", "url": "https://api.github.com/users/amoshche", "html_url": "https://github.com/amoshche", "followers_url": "https://api.github.com/users/amoshche/followers", "following_url": "https://api.github.com/users/amoshche/following{/other_user}", "gists_url": "https://api.github.com/users/amoshche/gists{/gist_id}", "starred_url": "https://api.github.com/users/amoshche/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/amoshche/subscriptions", "organizations_url": "https://api.github.com/users/amoshche/orgs", "repos_url": "https://api.github.com/users/amoshche/repos", "events_url": "https://api.github.com/users/amoshche/events{/privacy}", "received_events_url": "https://api.github.com/users/amoshche/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-12-20T11:41:52Z", "updated_at": "2021-12-20T18:53:57Z", "closed_at": "2021-12-20T18:53:57Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\nWhen hub runs binded not at the root but at some additional path for example /jupyter Admin UI is not working\r\n\r\n#### Expected behaviour\r\nAdmin UI works\r\n#### Actual behaviour\r\nNo UI rendered\r\n\r\nIn devtools in browser it is seen that admin-react.js /hub/api/users and /hub/api/users instead of /jupyter/hub/api/users /jupyter/hub/api/groups\r\n\r\n### How to reproduce\r\nset c.JupyterHub.bind_url to http://localhost:8000/jupyter\r\nstart JupyterHub\r\ngoto http://localhost:8000/jupyter/hub/admin\r\n\r\n### Details\r\n - OS:\r\nirrelevant\r\n - Version(s):\r\nJupyterHub 2.0.0 20211217173434", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3729/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3729/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3720", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3720/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3720/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3720/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3720", "id": 1081919484, "node_id": "PR_kwDOAT0rQs4v7z2e", "number": 3720, "title": "simplify default role assignment", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-12-16T08:44:16Z", "updated_at": "2021-12-20T09:30:04Z", "closed_at": "2021-12-20T09:30:02Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3720", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3720", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3720.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3720.patch", "merged_at": "2021-12-20T09:30:02Z"}, "body": "Related to #3714 \r\n\r\n- always assign 'user' role, not just when no other roles are assigned\r\n- 'admin' role is in addition to `user`, not instead of\r\n\r\nPermissions are unchanged, because `admin` is always a superset, but this simplifies things. \r\n\r\nThe main difference: when this is called, it always grants the `user` role, not just if there are no roles already present.\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3720/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3720/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3717", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3717/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3717/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3717/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3717", "id": 1079529233, "node_id": "PR_kwDOAT0rQs4vz7Ry", "number": 3717, "title": "fix Spawner.oauth_roles config", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-12-14T09:42:36Z", "updated_at": "2022-03-11T08:42:49Z", "closed_at": "2021-12-14T15:46:08Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3717", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3717", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3717.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3717.patch", "merged_at": "2021-12-14T15:46:08Z"}, "body": "missing cast to orm.Role from config when populating oauth client\r\n\r\nencountered while testing #3713 \r\n\r\ntest included", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3717/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3717/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3716", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3716/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3716/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3716/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3716", "id": 1079527161, "node_id": "PR_kwDOAT0rQs4vz61u", "number": 3716, "title": "Fix error message about Authenticator.pre_spawn_start", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-12-14T09:40:26Z", "updated_at": "2022-03-11T08:43:00Z", "closed_at": "2021-12-15T14:00:19Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3716", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3716", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3716.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3716.patch", "merged_at": "2021-12-15T14:00:19Z"}, "body": "This isn't the only or even main thing likely to raise here, so don't blame it, which is confusing, especially in a message shown to users.\r\n\r\nHas come up during spawn failures, e.g. #3703\r\n\r\nLog the full exception, and show a more opaque message to the user to avoid confusion.\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3716/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3716/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3715", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3715/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3715/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3715/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3715", "id": 1079214589, "node_id": "PR_kwDOAT0rQs4vy50U", "number": 3715, "title": "admin: Pass Base Url", "user": {"login": "naatebarber", "id": 58739360, "node_id": "MDQ6VXNlcjU4NzM5MzYw", "avatar_url": "https://avatars.githubusercontent.com/u/58739360?v=4", "gravatar_id": "", "url": "https://api.github.com/users/naatebarber", "html_url": "https://github.com/naatebarber", "followers_url": "https://api.github.com/users/naatebarber/followers", "following_url": "https://api.github.com/users/naatebarber/following{/other_user}", "gists_url": "https://api.github.com/users/naatebarber/gists{/gist_id}", "starred_url": "https://api.github.com/users/naatebarber/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/naatebarber/subscriptions", "organizations_url": "https://api.github.com/users/naatebarber/orgs", "repos_url": "https://api.github.com/users/naatebarber/repos", "events_url": "https://api.github.com/users/naatebarber/events{/privacy}", "received_events_url": "https://api.github.com/users/naatebarber/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-12-14T01:45:57Z", "updated_at": "2021-12-20T10:54:05Z", "closed_at": "2021-12-14T09:43:40Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3715", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3715", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3715.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3715.patch", "merged_at": "2021-12-14T09:43:40Z"}, "body": "Closes #3711 \r\n\r\n - Pass the `base_url` setting from the admin handler to front-end with Jinja.\r\n - Correct bug where UI warnings appear when a request is successful.\r\n\r\n@minrk ", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3715/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3715/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3714", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3714/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3714/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3714/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3714", "id": 1078504733, "node_id": "PR_kwDOAT0rQs4vwgze", "number": 3714, "title": "Grant role after user creation during config load", "user": {"login": "a3626a", "id": 4434752, "node_id": "MDQ6VXNlcjQ0MzQ3NTI=", "avatar_url": "https://avatars.githubusercontent.com/u/4434752?v=4", "gravatar_id": "", "url": "https://api.github.com/users/a3626a", "html_url": "https://github.com/a3626a", "followers_url": "https://api.github.com/users/a3626a/followers", "following_url": "https://api.github.com/users/a3626a/following{/other_user}", "gists_url": "https://api.github.com/users/a3626a/gists{/gist_id}", "starred_url": "https://api.github.com/users/a3626a/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/a3626a/subscriptions", "organizations_url": "https://api.github.com/users/a3626a/orgs", "repos_url": "https://api.github.com/users/a3626a/repos", "events_url": "https://api.github.com/users/a3626a/events{/privacy}", "received_events_url": "https://api.github.com/users/a3626a/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2021-12-13T13:02:24Z", "updated_at": "2021-12-15T11:36:55Z", "closed_at": "2021-12-15T11:36:53Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3714", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3714", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3714.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3714.patch", "merged_at": "2021-12-15T11:36:53Z"}, "body": "I faced role related issue for my jupyterhub deployment:\r\n- Using Zero To JupyterHub with Kubernetes\r\n- Using GenericOAuthenticator\r\n  - ```python\r\n      from oauthenticator.generic import GenericOAuthenticator\r\n      c.JupyterHub.authenticator_class = GenericOAuthenticator\r\n      c.GenericOAuthenticator.oauth_callback_url = \"http://<my-jupyter-hub-domain>/hub/oauth_callback\"\r\n      c.GenericOAuthenticator.client_id = \"<client-id>\"\r\n      c.GenericOAuthenticator.client_secret = \"<client-secret>\"\r\n      c.GenericOAuthenticator.login_service = \"<my-service>\"\r\n      c.GenericOAuthenticator.authorize_url = \"http://<my-oauth-provider-domain>/oauth/authorize\"\r\n      c.GenericOAuthenticator.userdata_url = \"http://<my-oauth-provider-domain>/api/v1/me\"\r\n      c.GenericOAuthenticator.token_url = \"http://<my-oauth-provider-domain>/oauth/token\"\r\n      c.GenericOAuthenticator.username_key = \"email\"\r\n    ```\r\n - Loading Roles Like\r\n   - ```\r\n      c.JupyterHub.load_roles = [\r\n        {\r\n          \"name\": \"role-for-rtc\",\r\n          \"scopes\": [\"servers\", \"read:users\", \"access:servers\"],\r\n          \"users\": [\"<rtc-privileged-user>@<my-domain>\"]\r\n        }\r\n      ]\r\n     ```\r\nUnder this condition:\r\n  - User `<rtc-privileged-user>@<my-domain>` is not yet been created (signed in)\r\n\r\n-> User `<rtc-privileged-user>@<my-domain>` cannot access to its own server.\r\n- ```\r\n  [W 2021-12-13 02:44:18.992 JupyterHub roles:436] Token requesting role server with scopes not held by owner <rtc-privileged-user>@<my-domain>: {<List of scopes which change depending on the scopes listed in load_roles>'}\r\n  ```\r\n- (I removed some part for my security)\r\n![image](https://user-images.githubusercontent.com/4434752/145815166-c3594a12-1e64-4668-8726-eebd3024d346.png)\r\n\r\nUnder the other condition:\r\n  - User `<rtc-privileged-user>@<my-domain>` is already created.\r\n    - To reset everything, I deleted the user first.\r\n    - I deleted my `load_roles` lines, too.\r\n    - Then, I created the user by logging in.\r\n    - Finally, I added my `load_roles` in my config, and restarted the hub.\r\n\r\n-> Everything works fine.\r\n\r\n\r\nIn conclusion, I suggest these changes to fix this issue.\r\n  - At app.py#L2131, `orm_obj` is always created as an new user. So it's fine to grant default role here.\r\n  - In the cases mentioned above, this user is not granted for their default `user` role.\r\n  - Without `roles.grant_role(db, orm_obj, 'user')`, default user role is not granted to the user, because it is not listed in `self.authenticator.allowed_users`", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3714/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3714/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3711", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3711/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3711/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3711/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3711", "id": 1077045226, "node_id": "I_kwDOAT0rQs5AMmfq", "number": 3711, "title": "Empty Admin page when base_url is set", "user": {"login": "ykazakov", "id": 2140361, "node_id": "MDQ6VXNlcjIxNDAzNjE=", "avatar_url": "https://avatars.githubusercontent.com/u/2140361?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ykazakov", "html_url": "https://github.com/ykazakov", "followers_url": "https://api.github.com/users/ykazakov/followers", "following_url": "https://api.github.com/users/ykazakov/following{/other_user}", "gists_url": "https://api.github.com/users/ykazakov/gists{/gist_id}", "starred_url": "https://api.github.com/users/ykazakov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ykazakov/subscriptions", "organizations_url": "https://api.github.com/users/ykazakov/orgs", "repos_url": "https://api.github.com/users/ykazakov/repos", "events_url": "https://api.github.com/users/ykazakov/events{/privacy}", "received_events_url": "https://api.github.com/users/ykazakov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-12-10T16:55:25Z", "updated_at": "2021-12-14T09:43:40Z", "closed_at": "2021-12-14T09:43:40Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\n\r\nIf `JupyterHub.base_url` is set in `jupyterhub_config.py`, visitig the Admin tab on jupyterhub v.2.0.0 shows the empty page. \r\n\r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\n\r\nWithout setting  `JupyterHub.base_url` the Admin page displays the list of users:\r\n\r\n<img width=\"857\" alt=\"Screenshot 2021-12-10 at 17 41 29\" src=\"https://user-images.githubusercontent.com/2140361/145609729-d5ee0c2c-bdb4-4e77-a730-ccb2ddbbc07a.png\">\r\n\r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\n\r\nThe page shows only the version number:\r\n\r\n<img width=\"767\" alt=\"Screenshot 2021-12-10 at 17 29 16\" src=\"https://user-images.githubusercontent.com/2140361/145608037-34be2e43-e02d-40a6-b643-79c4628d8915.png\">\r\n\r\nI see some errors in the log:\r\n\r\n```\r\nI 2021-12-10 16:25:47.787 JupyterHub log:189] 200 GET /test/hub/admin (user@::ffff:172.17.0.1) 42.95ms\r\n16:25:48.067 [ConfigProxy] error: 404 GET /hub/api/users \r\n16:25:48.076 [ConfigProxy] error: 404 GET /hub/api/groups \r\n```\r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\n1. Create `Dockerfile` with the following content:\r\n```\r\nFROM jupyterhub/jupyterhub:2.0.0\r\n\r\nCOPY jupyterhub_config.py /etc/jupyterhub/\r\n\r\nCMD jupyterhub -f /etc/jupyterhub/jupyterhub_config.py\r\n```\r\n\r\n2. In the same directory create `jupyterhub_config.py`:\r\n```\r\nc.JupyterHub.base_url = '/test/'\r\n\r\nc.Authenticator.allowed_users = {'user'}\r\nc.Authenticator.admin_users = {'user'}\r\n\r\nc.JupyterHub.authenticator_class = 'dummy'\r\nc.JupyterHub.spawner_class = 'simple'\r\n```\r\n3. Compile docker image:\r\n```\r\ndocker build -t jupyterhub-test .\r\n```\r\n4. Start the container:\r\n```\r\ndocker run -it -p 8000:8000 jupyterhub-test\r\n```\r\n5. Open the page: http://127.0.0.1:8000/test/hub/admin\r\n6. Enter the user name `user`\r\n\r\n\r\n### Your personal set up\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n\r\n - OS: MacOS 12.0.1\r\n - Version(s):\r\n```\r\n% docker --version\r\nDocker version 20.10.11, build dea9396\r\n```\r\n\r\n<details><summary>Logs</summary>\r\n\r\n```\r\n% docker run -it -p 8000:8000 jupyterhub-test\r\n[I 2021-12-10 16:49:35.000 JupyterHub app:2717] Running JupyterHub version 2.0.0\r\n[I 2021-12-10 16:49:35.001 JupyterHub app:2747] Using Authenticator: jupyterhub.auth.DummyAuthenticator-2.0.0\r\n[I 2021-12-10 16:49:35.003 JupyterHub app:2747] Using Spawner: jupyterhub.spawner.SimpleLocalProcessSpawner-2.0.0\r\n[I 2021-12-10 16:49:35.004 JupyterHub app:2747] Using Proxy: jupyterhub.proxy.ConfigurableHTTPProxy-2.0.0\r\n[I 2021-12-10 16:49:35.023 JupyterHub app:1641] Writing cookie_secret to /srv/jupyterhub/jupyterhub_cookie_secret\r\n[I 2021-12-10 16:49:35.101 alembic.runtime.migration migration:201] Context impl SQLiteImpl.\r\n[I 2021-12-10 16:49:35.101 alembic.runtime.migration migration:204] Will assume non-transactional DDL.\r\n[I 2021-12-10 16:49:35.152 alembic.runtime.migration migration:615] Running stamp_revision  -> 833da8570507\r\n[I 2021-12-10 16:49:35.485 JupyterHub proxy:496] Generating new CONFIGPROXY_AUTH_TOKEN\r\n[I 2021-12-10 16:49:35.629 JupyterHub roles:358] Adding role user for User: user\r\n[I 2021-12-10 16:49:35.650 JupyterHub roles:358] Adding role admin for User: user\r\n[W 2021-12-10 16:49:35.656 JupyterHub app:2152] No admin role found; assuming hub upgrade. Initializing default roles for all entities\r\n[I 2021-12-10 16:49:35.727 JupyterHub app:2786] Initialized 0 spawners in 0.008 seconds\r\n[W 2021-12-10 16:49:35.739 JupyterHub proxy:687] Running JupyterHub without SSL.  I hope there is SSL termination happening somewhere else...\r\n[I 2021-12-10 16:49:35.739 JupyterHub proxy:691] Starting proxy @ http://:8000/test/\r\n16:49:36.527 [ConfigProxy] info: Proxying http://*:8000 to (no default)\r\n16:49:36.536 [ConfigProxy] info: Proxy API at http://127.0.0.1:8001/api/routes\r\n16:49:36.846 [ConfigProxy] info: 200 GET /api/routes \r\n[I 2021-12-10 16:49:36.847 JupyterHub app:3035] Hub API listening on http://127.0.0.1:8081/test/hub/\r\n16:49:36.852 [ConfigProxy] info: 200 GET /api/routes \r\n[I 2021-12-10 16:49:36.857 JupyterHub proxy:431] Adding route for Hub: /test/ => http://127.0.0.1:8081\r\n16:49:36.870 [ConfigProxy] info: Adding route /test -> http://127.0.0.1:8081\r\n16:49:36.874 [ConfigProxy] info: Route added /test -> http://127.0.0.1:8081\r\n16:49:36.875 [ConfigProxy] info: 201 POST /api/routes/test \r\n[I 2021-12-10 16:49:36.878 JupyterHub app:3101] JupyterHub is now running at http://:8000/test/\r\n[W 2021-12-10 16:49:56.934 JupyterHub base:391] Invalid or expired cookie token\r\n[I 2021-12-10 16:49:56.944 JupyterHub log:189] 302 GET /test/hub/admin -> /test/hub/login?next=%2Ftest%2Fhub%2Fadmin (@::ffff:172.17.0.1) 12.91ms\r\n[I 2021-12-10 16:49:57.036 JupyterHub log:189] 200 GET /test/hub/login?next=%2Ftest%2Fhub%2Fadmin (@::ffff:172.17.0.1) 63.43ms\r\n[I 2021-12-10 16:50:01.674 JupyterHub base:796] User logged in: user\r\n[I 2021-12-10 16:50:01.677 JupyterHub log:189] 302 POST /test/hub/login?next=%2Ftest%2Fhub%2Fadmin -> /test/hub/admin (user@::ffff:172.17.0.1) 59.37ms\r\n[I 2021-12-10 16:50:01.741 JupyterHub log:189] 200 GET /test/hub/admin (user@::ffff:172.17.0.1) 45.71ms\r\n16:50:01.985 [ConfigProxy] error: 404 GET /hub/api/groups \r\n16:50:02.004 [ConfigProxy] error: 404 GET /hub/api/users \r\n[I 2021-12-10 16:50:02.043 JupyterHub log:189] 200 GET /test/hub/error/404?url=%2Fhub%2Fapi%2Fusers%3Foffset%3D0%26limit%3D50 (@127.0.0.1) 22.30ms\r\n[I 2021-12-10 16:50:02.061 JupyterHub log:189] 200 GET /test/hub/error/404?url=%2Fhub%2Fapi%2Fgroups%3Foffset%3D0%26limit%3D50 (@127.0.0.1) 14.26ms\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3711/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3711/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3709", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3709/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3709/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3709/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3709", "id": 1074634541, "node_id": "I_kwDOAT0rQs5ADZ8t", "number": 3709, "title": "Spawner failed to start [status=1]; ERROR:asyncio:Task exception was never retrieved", "user": {"login": "smeylan", "id": 779916, "node_id": "MDQ6VXNlcjc3OTkxNg==", "avatar_url": "https://avatars.githubusercontent.com/u/779916?v=4", "gravatar_id": "", "url": "https://api.github.com/users/smeylan", "html_url": "https://github.com/smeylan", "followers_url": "https://api.github.com/users/smeylan/followers", "following_url": "https://api.github.com/users/smeylan/following{/other_user}", "gists_url": "https://api.github.com/users/smeylan/gists{/gist_id}", "starred_url": "https://api.github.com/users/smeylan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/smeylan/subscriptions", "organizations_url": "https://api.github.com/users/smeylan/orgs", "repos_url": "https://api.github.com/users/smeylan/repos", "events_url": "https://api.github.com/users/smeylan/events{/privacy}", "received_events_url": "https://api.github.com/users/smeylan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-12-08T17:10:16Z", "updated_at": "2022-10-21T11:36:58Z", "closed_at": "2021-12-08T22:49:04Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\nI am trying to get multi-user JupyterHub running again on an Ubutuntu 20.04 system after upgrading from 16.04. I uninstalled and reinstalled all Jupyter-related packages (following [this link](https://jupyterhub.readthedocs.io/en/stable/installation-guide.html)), and deleted `.jupyter` and `.ipython` directories for my user because I'd see issues in such a big jump. When I launch with `sudo jupyterhub` I can log in and launch a server with my ubuntu user credentials, but it fails to spawn. I can't make sense of the resulting error messages in the logs, which seem generic. My understanding is that the single-user logs will also appear in the same place as the Hub logs with the default installation, so my logs below should include everything.\r\n\r\nI suspect `ERROR:asyncio:Task exception was never retrieved` is hiding the errors.\r\n\r\nI also subsequently tried installing through TLJH but ran into 404 errors after trying to get it use existing home directories / not make new users. \r\n\r\n#### Expected behavior\r\nJupyterHub should spawn a server for my user, or I should see some interpretable logs saying what's wrong.\r\n\r\n#### Actual behaviour\r\nIn the frontend I see `Spawn failed: Server at http://127.0.0.1:38140/user/stephan/ didn't respond in 30 seconds`. Logs are below.\r\n\r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\nFresh install of Jupyterhub of 20.04 through pip following these [instructions](https://jupyterhub.readthedocs.io/en/stable/installation-guide.html)\r\n\r\n### Your personal set up\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n\r\n - OS: Ubuntu 20.04\r\n - Version(s): jupyterhub 2.0.0, Python 3.8.10>\r\n\r\n- <details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\nalembic==1.7.5\r\nanyio==3.4.0\r\napparmor==2.13.3\r\nappdirs==1.4.3\r\napt-xapian-index==0.49\r\napturl==0.5.2\r\nargon2-cffi==21.1.0\r\nasync-generator==1.10\r\nattrs==21.2.0\r\nAutomat==0.8.0\r\nBabel==2.9.1\r\nbackcall==0.2.0\r\nbcrypt==3.1.7\r\nbleach==4.1.0\r\nblinker==1.4\r\nBrlapi==0.7.0\r\ncertifi==2021.10.8\r\ncertipy==0.1.3\r\ncffi==1.15.0                                                                                                                                         \r\nchardet==3.0.4\r\ncharset-normalizer==2.0.9\r\nClick==7.0\r\ncolorama==0.4.3\r\ncommand-not-found==0.3\r\nconfigobj==5.0.6\r\nconstantly==15.1.0\r\ncryptography==36.0.0\r\ncupshelpers==1.0\r\ndbus-python==1.2.16\r\ndebugpy==1.5.1\r\ndecorator==5.1.0\r\ndefer==1.0.6\r\ndefusedxml==0.7.1\r\ndistlib==0.3.0\r\ndistro==1.4.0\r\ndistro-info===0.23ubuntu1\r\ndnspython==1.16.0\r\nduplicity==0.8.12.0\r\nentrypoints==0.3\r\nfasteners==0.14.1\r\nfilelock==3.0.12\r\nfuture==0.18.2\r\ngpg===1.13.1-unknown\r\ngreenlet==1.1.2\r\nhttplib2==0.14.0\r\nhyperlink==19.0.0\r\nidna==3.3\r\nimportlib-metadata==4.8.2\r\nimportlib-resources==5.4.0\r\nincremental==16.10.1\r\niotop==0.6\r\nipykernel==6.6.0\r\nipython==7.30.1\r\nipython-genutils==0.2.0\r\nipywidgets==7.6.5\r\njedi==0.18.1\r\nJinja2==3.0.3\r\njson5==0.9.6\r\njsonschema==4.2.1\r\njupyter==1.0.0\r\njupyter-client==7.1.0\r\njupyter-console==6.4.0\r\njupyter-contrib-core==0.3.3\r\njupyter-core==4.9.1\r\njupyter-nbextensions-configurator==0.4.1\r\njupyter-server==1.13.0\r\njupyter-telemetry==0.1.0\r\njupyterhub==2.0.0\r\njupyterlab==3.2.4\r\njupyterlab-pygments==0.1.2\r\njupyterlab-server==2.8.2\r\njupyterlab-widgets==1.0.2\r\nkeyring==18.0.1                                                                                                                                               \r\nkeyrings.alt==3.4.0\r\nlanguage-selector==0.1\r\nlaunchpadlib==1.10.13\r\nlazr.restfulclient==0.14.2\r\nlazr.uri==1.0.3\r\nLibAppArmor==2.13.3\r\nlockfile==0.12.2\r\nlouis==3.12.0\r\nmacaroonbakery==1.3.1\r\nMako==1.1.6\r\nMarkdown==3.1.1\r\nMarkupSafe==2.0.1\r\nmatplotlib-inline==0.1.3\r\nmistune==0.8.4\r\nmonotonic==1.5\r\nmore-itertools==4.2.0\r\nnbclassic==0.3.4\r\nnbclient==0.5.9\r\nnbconvert==6.3.0\r\nnbformat==5.1.3\r\nnest-asyncio==1.5.4\r\nnetifaces==0.10.4\r\nnotebook==6.4.6\r\noauthlib==3.1.1\r\nonboard==1.4.1\r\noneconf==0.3.9\r\npackaging==21.3\r\npamela==1.0.0\r\npandocfilters==1.5.0\r\nparamiko==2.6.0\r\nparso==0.8.3\r\npexpect==4.8.0\r\npickleshare==0.7.5\r\nPillow==7.0.0\r\npip-autoremove==0.10.0\r\npiston-mini-client==0.7.5\r\nprogressbar==2.5\r\nprometheus-client==0.12.0\r\nprompt-toolkit==3.0.23\r\nprotobuf==3.6.1\r\nptyprocess==0.7.0\r\npyasn1==0.4.2\r\npyasn1-modules==0.2.1\r\npycairo==1.16.2\r\npycparser==2.21\r\npycrypto==2.6.1\r\npycups==1.9.73\r\npycurl==7.43.0.2\r\nPygments==2.10.0\r\nPyGObject==3.36.0\r\nPyHamcrest==1.9.0\r\nPyJWT==1.7.1\r\npymacaroons==0.13.0\r\nPyNaCl==1.3.0\r\npyOpenSSL==21.0.0\r\npyparsing==3.0.6\r\npyRFC3339==1.1\r\npyrsistent==0.18.0\r\npyserial==3.4\r\npython-apt==2.0.0+ubuntu0.20.4.6\r\npython-dateutil==2.8.2\r\npython-debian===0.1.36ubuntu1\r\npython-json-logger==2.0.2\r\npytz==2021.3\r\npyxdg==0.26\r\nPyYAML==5.3.1\r\npyzmq==22.3.0\r\nqtconsole==5.2.1\r\nQtPy==1.11.3\r\nreportlab==3.5.34\r\nrequests==2.26.0\r\nrequests-unixsocket==0.2.0\r\nruamel.yaml==0.17.17\r\nruamel.yaml.clib==0.2.6\r\nscreen-resolution-extra==0.0.0\r\nSecretStorage==2.3.1\r\nSend2Trash==1.8.0\r\nservice-identity==18.1.0\r\nsimplejson==3.16.0\r\nsix==1.16.0\r\nsniffio==1.2.0\r\nsoftware-center-aptd-plugins==0.0.0\r\nSQLAlchemy==1.4.27\r\nssh-import-id==5.10\r\nsupervisor==4.1.0\r\nsystem-service==0.3\r\nsystemd-python==234\r\nterminado==0.12.1\r\ntestpath==0.5.0\r\ntornado==6.1\r\ntraitlets==5.1.1\r\nTwisted==18.9.0\r\nubuntu-advantage-tools==27.4\r\nubuntu-drivers-common==0.0.0\r\nufw==0.36\r\nunattended-upgrades==0.1\r\nurllib3==1.26.7\r\nusb-creator==0.3.7\r\nvirtualenv==20.0.17\r\nwadllib==1.3.3\r\nwcwidth==0.2.5\r\nwebencodings==0.5.1\r\nwebsocket-client==1.2.3\r\nwidgetsnbextension==3.5.2\r\nxdiagnose==3.8.9\r\nxkit==0.0.0\r\nzipp==3.6.0\r\nzope.interface==4.7.1\r\n```\r\n</details>\r\n\r\n- <details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```python\r\n# Everything left at defaults\r\n```\r\n</details>\r\n\r\n- <details><summary>Logs</summary>\r\n\r\n```\r\n[I 2021-12-08 07:20:25.382 JupyterHub spawner:1526] Spawning jupyterhub-singleuser\r\n[I 2021-12-08 07:20:25.702 JupyterHub log:189] 302 GET /hub/spawn/stephan -> /hub/spawn-pending/stephan (stephan@::1) 1004.97ms\r\n[I 2021-12-08 07:20:25.717 JupyterHub pages:397] stephan is pending spawn\r\n[I 2021-12-08 07:20:25.724 JupyterHub log:189] 200 GET /hub/spawn-pending/stephan (stephan@::1) 12.19ms\r\n[I 2021-12-08 07:20:26.377 SingleUserLabApp mixins:615] Starting jupyterhub single-user server version 2.0.0\r\n[I 2021-12-08 07:20:26.377 SingleUserLabApp mixins:629] Extending jupyterlab.labhubapp.SingleUserLabApp from jupyterlab 3.2.4\r\n[I 2021-12-08 07:20:26.377 SingleUserLabApp mixins:629] Extending jupyter_server.serverapp.ServerApp from jupyter_server 1.13.0\r\n[I 2021-12-08 07:20:26.407 SingleUserLabApp manager:345] jupyterlab | extension was successfully linked.\r\n[C 2021-12-08 07:20:26.410 NotebookApp] Bad config encountered during initialization: Trait, server_extensions, not found.\r\nERROR:asyncio:Task exception was never retrieved\r\nfuture: <Task finished name='Task-20' coro=<BaseHandler.spawn_single_user() done, defined at /usr/local/lib/python3.8/dist-packages/jupyterhub/handlers/base.py:830> exception=HTTPError()>\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/handlers/base.py\", line 1031, in spawn_single_user\r\n    await gen.with_timeout(\r\ntornado.util.TimeoutError: Timeout\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/handlers/base.py\", line 1065, in spawn_single_user\r\n    raise web.HTTPError(\r\ntornado.web.HTTPError: HTTP 500: Internal Server Error (Spawner failed to start [status=1]. The logs for stephan may contain details.)\r\n[W 2021-12-08 07:20:53.462 JupyterHub user:798] stephan's server never showed up at http://127.0.0.1:38140/user/stephan/ after 30 seconds. Giving up.\r\n\r\n    Common causes of this timeout, and debugging tips:\r\n\r\n    1. The server didn't finish starting,\r\n       or it crashed due to a configuration issue.\r\n       Check the single-user server's logs for hints at what needs fixing.\r\n    2. The server started, but is not accessible at the specified URL.\r\n       This may be a configuration issue specific to your chosen Spawner.\r\n       Check the single-user server logs and resource to make sure the URL\r\n       is correct and accessible from the Hub.\r\n    3. (unlikely) Everything is working, but the server took too long to respond.\r\n       To fix: increase `Spawner.http_timeout` configuration\r\n       to a number of seconds that is enough for servers to become responsive.\r\n\r\n[E 2021-12-08 07:20:53.502 JupyterHub gen:623] Exception in Future <Task finished name='Task-21' coro=<BaseHandler.spawn_single_user.<locals>.finish_user_spawn() done, defined at /usr/local/lib/python3.8/dist-packages/jupyterhub/handlers/base.py:934> exception=TimeoutError(\"Server at http://127.0.0.1:38140/user/stephan/ didn't respond in 30 seconds\")> after timeout\r\n    Traceback (most recent call last):\r\n      File \"/usr/local/lib/python3.8/dist-packages/tornado/gen.py\", line 618, in error_callback\r\n        future.result()\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/handlers/base.py\", line 941, in finish_user_spawn\r\n        await spawn_future\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/user.py\", line 779, in spawn\r\n        await self._wait_up(spawner)\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/user.py\", line 823, in _wait_up\r\n        raise e\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/user.py\", line 793, in _wait_up\r\n        resp = await server.wait_up(\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/utils.py\", line 241, in wait_for_http_server\r\n        re = await exponential_backoff(\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/utils.py\", line 189, in exponential_backoff\r\n        raise asyncio.TimeoutError(fail_message)\r\n    asyncio.exceptions.TimeoutError: Server at http://127.0.0.1:38140/user/stephan/ didn't respond in 30 seconds\r\n\r\n[I 2021-12-08 07:20:53.505 JupyterHub log:189] 200 GET /hub/api/users/stephan/server/progress (stephan@::1) 27756.51ms\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3709/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3709/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3708", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3708/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3708/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3708/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3708", "id": 1073452682, "node_id": "PR_kwDOAT0rQs4vgXUc", "number": 3708, "title": "Avoid clearing user role membership when defining custom user scopes", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-12-07T14:58:56Z", "updated_at": "2021-12-20T09:48:07Z", "closed_at": "2021-12-20T09:48:04Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3708", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3708", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3708.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3708.patch", "merged_at": "2021-12-20T09:48:04Z"}, "body": "If the user role was defined but did not specify a user membership list, users granted access by the Authenticator would lose their status on hub startup.\r\n\r\nInstead, do nothing on an undefined user membership list, leaving any users with their existing default role assignment\r\n\r\ncloses #3703", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3708/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3708/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3703", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3703/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3703/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3703/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3703", "id": 1071329247, "node_id": "I_kwDOAT0rQs4_2y_f", "number": 3703, "title": "Problems overriding the default roles", "user": {"login": "akhmerov", "id": 2069677, "node_id": "MDQ6VXNlcjIwNjk2Nzc=", "avatar_url": "https://avatars.githubusercontent.com/u/2069677?v=4", "gravatar_id": "", "url": "https://api.github.com/users/akhmerov", "html_url": "https://github.com/akhmerov", "followers_url": "https://api.github.com/users/akhmerov/followers", "following_url": "https://api.github.com/users/akhmerov/following{/other_user}", "gists_url": "https://api.github.com/users/akhmerov/gists{/gist_id}", "starred_url": "https://api.github.com/users/akhmerov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/akhmerov/subscriptions", "organizations_url": "https://api.github.com/users/akhmerov/orgs", "repos_url": "https://api.github.com/users/akhmerov/repos", "events_url": "https://api.github.com/users/akhmerov/events{/privacy}", "received_events_url": "https://api.github.com/users/akhmerov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2021-12-04T23:29:35Z", "updated_at": "2021-12-20T09:48:04Z", "closed_at": "2021-12-20T09:48:04Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\nIt seems that overriding the role `user` is not functioning correctly. Specifically, on jh 2.0.0 if I set up the following role config (see [here](https://discourse.jupyter.org/t/plans-on-bringing-rtc-to-jupyterhub/9813/11?u=anton_akhmerov) for motivation)\r\n\r\n```python\r\nc.JupyterHub.load_roles = [\r\n    {\r\n        \"name\": \"user\",\r\n        \"description\": \"Allow users to access the shared server in addition to default perms\",\r\n        \"scopes\": [\"self\", \"access:servers!user=shared\"],\r\n    }\r\n]\r\n```\r\n\r\nNow after starting the hub, any non-admin user that existed on the hub before the start is unable to launch their server and sees a 500 error:\r\n\r\n![image](https://user-images.githubusercontent.com/2069677/144727721-6f6b5578-41f6-4704-9ffa-11c08428f7fc.png)\r\n\r\nAfter deleting and recreating the user from the hub admin panel, everything seems to function normally.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3703/reactions", "total_count": 3, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 3, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3703/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3702", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3702/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3702/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3702/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3702", "id": 1070457647, "node_id": "I_kwDOAT0rQs4_zeMv", "number": 3702, "title": "Error 500 when accessing admin page", "user": {"login": "melnur", "id": 94445331, "node_id": "U_kgDOBaEfEw", "avatar_url": "https://avatars.githubusercontent.com/u/94445331?v=4", "gravatar_id": "", "url": "https://api.github.com/users/melnur", "html_url": "https://github.com/melnur", "followers_url": "https://api.github.com/users/melnur/followers", "following_url": "https://api.github.com/users/melnur/following{/other_user}", "gists_url": "https://api.github.com/users/melnur/gists{/gist_id}", "starred_url": "https://api.github.com/users/melnur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/melnur/subscriptions", "organizations_url": "https://api.github.com/users/melnur/orgs", "repos_url": "https://api.github.com/users/melnur/repos", "events_url": "https://api.github.com/users/melnur/events{/privacy}", "received_events_url": "https://api.github.com/users/melnur/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-12-03T10:46:24Z", "updated_at": "2021-12-06T15:28:14Z", "closed_at": "2021-12-06T15:28:13Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi, \r\nI get \"500 : Internal Server Error\" when I try to access admin page. I'm admin and I can login and run notebooks as a user. However, accessing to admin page is giving error now. It used to be working fine. I shutdown the hub and restarted it with Helm and now admin page is not accessible. I haven't changed anything in Helm config. \r\nI have searched for similar issues and couldn't find any solution. Could someone point me to right direction please? Thanks\r\n\r\n```\r\n[E 2021-12-03 09:56:08.694 JupyterHub web:1792] Uncaught exception GET /hub/admin (redacted)\r\n    HTTPServerRequest(protocol='http', redacted', method='GET', uri='/hub/admin', version='HTTP/1.1', remote_ip='redacted')\r\n    Traceback (most recent call last):\r\n      File \"/usr/local/lib/python3.6/dist-packages/tornado/web.py\", line 1703, in _execute\r\n        result = await result\r\n      File \"/home/jovyan/.local/lib/python3.6/site-packages/jupyterhub/handlers/pages.py\", line 467, in get\r\n        api_page_limit=self.settings[\"api_page_default_limit\"],\r\n      File \"/usr/local/lib/python3.6/dist-packages/jinja2/asyncsupport.py\", line 65, in render_async\r\n        return self.environment.handle_exception()\r\n      File \"/usr/local/lib/python3.6/dist-packages/jinja2/environment.py\", line 832, in handle_exception\r\n        reraise(*rewrite_traceback_stack(source=source))\r\n      File \"/usr/local/lib/python3.6/dist-packages/jinja2/_compat.py\", line 28, in reraise\r\n        raise value.with_traceback(tb)\r\n      File \"/usr/local/lib/python3.6/dist-packages/jinja2/asyncsupport.py\", line 25, in concat_async\r\n        await collect()\r\n      File \"/usr/local/lib/python3.6/dist-packages/jinja2/asyncsupport.py\", line 22, in collect\r\n        async for event in async_gen:\r\n      File \"/etc/jupyterhub/templates/admin.html\", line 7, in top-level template code\r\n        fa-sort-asc\r\n      File \"/etc/jupyterhub/templates/page.html\", line 173, in top-level template code\r\n        {% block main %}\r\n      File \"/etc/jupyterhub/templates/admin.html\", line 21, in block \"main\"\r\n        <table class=\"table table-striped\">\r\n      File \"/etc/jupyterhub/templates/admin.html\", line 22, in block \"thead\"\r\n        <thead>\r\n      File \"/usr/local/lib/python3.6/dist-packages/jinja2/asyncsupport.py\", line 174, in auto_await\r\n        return await value\r\n      File \"/etc/jupyterhub/templates/admin.html\", line 6, in template\r\n        <a href=\"#\"><i class=\"fa {% if sort.get(key) == 'asc' -%}\r\n      File \"/usr/local/lib/python3.6/dist-packages/jinja2/environment.py\", line 471, in getattr\r\n        return getattr(obj, attribute)\r\n    jinja2.exceptions.UndefinedError: 'sort' is undefined\r\n\r\n[E 2021-12-03 09:56:08.696 JupyterHub log:181] {\r\n      \"X-Real-Ip\": \"10.1.4.110\",\r\n      \"X-Forwarded-Server\": \"traefik-b67579bb8-97lpr\",\r\n      \"X-Forwarded-Proto\": \"http,http\",\r\n      \"X-Forwarded-Port\": \"80,80\",\r\n      \"X-Forwarded-Host\": \"redacted\",\r\n      \"X-Forwarded-For\": \"redacted\",\r\n      \"Upgrade-Insecure-Requests\": \"1\",\r\n      \"Sec-Fetch-User\": \"?1\",\r\n      \"Sec-Fetch-Site\": \"same-origin\",\r\n      \"Sec-Fetch-Mode\": \"navigate\",\r\n      \"Sec-Fetch-Dest\": \"document\",\r\n      \"Sec-Ch-Ua-Platform\": \"\\\"Windows\\\"\",\r\n      \"Sec-Ch-Ua-Mobile\": \"?0\",\r\n      \"Sec-Ch-Ua\": \"\\\" Not A;Brand\\\";v=\\\"99\\\", \\\"Chromium\\\";v=\\\"96\\\", \\\"Google Chrome\\\";v=\\\"96\\\"\",\r\n      \"Referer\": \"redacted/hub/home\",\r\n      \"Cookie\": \"jupyterhub-hub-login=[secret]; oauthenticator-state=[secret]; cognito-refresh-token=[secret]; jupyterhub-session-id=[secret]; _xsrf=[secret]\",\r\n      \"Accept-Language\": \"en-US,en;q=0.9\",\r\n      \"Accept-Encoding\": \"gzip, deflate, br\",\r\n      \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\",\r\n      \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36\",\r\n      \"Host\": \"redacted\",\r\n      \"Connection\": \"close\"\r\n    }\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3702/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3702/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3701", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3701/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3701/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3701/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3701", "id": 1069354094, "node_id": "PR_kwDOAT0rQs4vTD7b", "number": 3701, "title": "cors: handle mismatched implicit/explicit ports in host header", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2021-12-02T10:03:13Z", "updated_at": "2022-01-23T07:13:02Z", "closed_at": "2021-12-02T11:46:26Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3701", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3701", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3701.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3701.patch", "merged_at": "2021-12-02T11:46:26Z"}, "body": "http://host:80 should match http://host\r\n\r\nparse URLs to make it easier to do correct comparisons.\r\n\r\ncors tests are parametrized to make it easier to add more cases\r\n\r\ncloses #3027", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3701/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3701/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3686", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3686/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3686/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3686/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3686", "id": 1057080750, "node_id": "PR_kwDOAT0rQs4us1Lr", "number": 3686, "title": "Hub: only accept tokens in API requests", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-11-18T08:37:34Z", "updated_at": "2022-01-18T13:17:20Z", "closed_at": "2021-11-18T12:27:41Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3686", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3686", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3686.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3686.patch", "merged_at": "2021-11-18T12:27:41Z"}, "body": "do not allow token-based access to pages\r\n\r\nTokens are only accepted via Authorization header (not in the url via `?token=...` like the single-user server), which doesn't make sense to pass to pages, so disallow it explicitly to avoid surprises.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3686/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3686/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3680", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3680/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3680/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3680/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3680", "id": 1046112204, "node_id": "I_kwDOAT0rQs4-WmfM", "number": 3680, "title": "Conda forge package for 1.5.0", "user": {"login": "gramakri", "id": 82041, "node_id": "MDQ6VXNlcjgyMDQx", "avatar_url": "https://avatars.githubusercontent.com/u/82041?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gramakri", "html_url": "https://github.com/gramakri", "followers_url": "https://api.github.com/users/gramakri/followers", "following_url": "https://api.github.com/users/gramakri/following{/other_user}", "gists_url": "https://api.github.com/users/gramakri/gists{/gist_id}", "starred_url": "https://api.github.com/users/gramakri/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gramakri/subscriptions", "organizations_url": "https://api.github.com/users/gramakri/orgs", "repos_url": "https://api.github.com/users/gramakri/repos", "events_url": "https://api.github.com/users/gramakri/events{/privacy}", "received_events_url": "https://api.github.com/users/gramakri/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2021-11-05T18:10:25Z", "updated_at": "2021-12-03T21:22:12Z", "closed_at": "2021-11-09T00:19:48Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\nJupyterHub 1.5.0 was tagged but I don't see a release in https://anaconda.org/conda-forge/jupyterhub\r\n\r\n#### Expected behaviour\r\nExpecing 1.5.0 release to be available.\r\n\r\n#### Actual behaviour\r\n\r\n```\r\nPackagesNotFoundError: The following packages are not available from current channels:\r\n\r\n  - jupyterhub=1.5.0\r\n\r\nCurrent channels:\r\n\r\n  - https://conda.anaconda.org/conda-forge/linux-64\r\n  - https://conda.anaconda.org/conda-forge/noarch\r\n  - https://repo.anaconda.com/pkgs/main/linux-64\r\n  - https://repo.anaconda.com/pkgs/main/noarch\r\n  - https://repo.anaconda.com/pkgs/r/linux-64\r\n  - https://repo.anaconda.com/pkgs/r/noarch\r\n\r\nTo search for alternate channels that may provide the conda package you're\r\nlooking for, navigate to\r\n\r\n    https://anaconda.org\r\n\r\nand use the search bar at the top of the page.\r\n\r\n```\r\n\r\n### How to reproduce\r\n\r\n`conda install --yes -c conda-forge jupyterhub=1.5.0`\r\n\r\n### Your personal set up\r\n\r\nI am the maintainer of the Cloudron package - https://git.cloudron.io/cloudron/jupyterhub-app/ , so I am unable to update it to the latest release.\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3680/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3680/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3679", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3679/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3679/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3679/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3679", "id": 1044799487, "node_id": "PR_kwDOAT0rQs4uGFjj", "number": 3679, "title": "Forward-port fixes from 1.5.0 security release", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 2398309292, "node_id": "MDU6TGFiZWwyMzk4MzA5Mjky", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/maintenance", "name": "maintenance", "color": "776ccc", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-11-04T14:05:44Z", "updated_at": "2022-02-23T22:13:01Z", "closed_at": "2021-11-04T14:30:04Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3679", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3679", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3679.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3679.patch", "merged_at": "2021-11-04T14:30:04Z"}, "body": "includes changelog for 1.5", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3679/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3679/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3668", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3668/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3668/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3668/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3668", "id": 1039483517, "node_id": "I_kwDOAT0rQs499UJ9", "number": 3668, "title": "Jupyterhub issue when connecting to local server instance 404 Not Found: You are requesting a page that does not exist!", "user": {"login": "MohammadAliAmir", "id": 37347364, "node_id": "MDQ6VXNlcjM3MzQ3MzY0", "avatar_url": "https://avatars.githubusercontent.com/u/37347364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MohammadAliAmir", "html_url": "https://github.com/MohammadAliAmir", "followers_url": "https://api.github.com/users/MohammadAliAmir/followers", "following_url": "https://api.github.com/users/MohammadAliAmir/following{/other_user}", "gists_url": "https://api.github.com/users/MohammadAliAmir/gists{/gist_id}", "starred_url": "https://api.github.com/users/MohammadAliAmir/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MohammadAliAmir/subscriptions", "organizations_url": "https://api.github.com/users/MohammadAliAmir/orgs", "repos_url": "https://api.github.com/users/MohammadAliAmir/repos", "events_url": "https://api.github.com/users/MohammadAliAmir/events{/privacy}", "received_events_url": "https://api.github.com/users/MohammadAliAmir/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-10-29T11:50:47Z", "updated_at": "2021-10-29T11:54:55Z", "closed_at": "2021-10-29T11:54:55Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi everyone,\r\n\r\nI have installed Jupyterhub along with Jupyterlab \r\nJupyterhub version 1.4.2\r\nJupyterlab version 3.0.16\r\n\r\nWhen i run the service it seems to be working. When i create a new local instance and go to that instance i should be redirected to a jupyterhub session.\r\n![image](https://user-images.githubusercontent.com/37347364/139412878-0c2dbd93-8f06-4342-b5a4-dbeab86e6296.png)\r\n\r\nInstead i get this error:\r\n![image](https://user-images.githubusercontent.com/37347364/139412370-b7711551-0a03-4482-9de9-cc281522dc97.png)\r\n\r\n\r\nSome info of the setup i am using\r\nOS: CentOS 7\r\nJupyterhub version 1.4.2\r\nJupyterlab version 3.0.16\r\nPython 3.6.10\r\n\r\nHere is my jupyterhub_config.py\r\n\r\nc.ConfigurableHTTPProxy.auth_token = '****'\r\nc.Spawner.notebook_dir = '/gpfs/gssgpfs1/biogrid/workspace/{username}/'\r\nc.Authenticator.admin_users = {'********'}\r\nc.PAMAuthenticator.service = 'jupyterhub'\r\nc.PAMAuthenticator.open_sessions = False\r\nc.JupyterHub.ssl_cert = '/etc/pki/tls/managed/wildcard/wildcard.pem'\r\nc.JupyterHub.ssl_key = '/etc/pki/tls/managed/wildcard/privkey.pem'\r\nc.ConfigurableHTTPProxy.debug = True\r\nc.Spawner.debug = True\r\nc.LocalProcessSpawner.debug = True\r\nc.ConfigurableHTTPProxy.should_start = False\r\nc.JupyterHub.data_files_path = '/tools/eb/software/JupyterHub/1.4.2-GCCcore-10.2.0/share/jupyterhub'\r\nc.JupyterHub.cleanup_proxy = True\r\nc.Spawner.default_url = '/lab'\r\nc.Spawner.cmd = ['jupyter-labhub']\r\nc.JupyterHub.port = 8443\r\nc.JupyterHub.template_paths = ['/etc/jupyterhub/templates/']\r\nc.JupyterHub.redirect_to_server = False\r\n\r\n\r\n\r\nimport batchspawner\r\nc.BatchSpawnerBase.req_host = '*******'\r\nc.JupyterHub.spawner_class = 'wrapspawner.ProfilesSpawner'\r\nc.BatchSpawnerBase.req_runtime = '12:00:00'\r\nc.Spawner.http_timeout = 120\r\n\r\nc.ProfilesSpawner.profiles = [\r\n   ( \"Local server\", 'local', 'jupyterhub.spawner.LocalProcessSpawner', {'ip':'0.0.0.0'} ),\r\n('BioGrid2 - 2 cores, 4 GB, 8 hours','biogrid2c4g8h', 'batchspawner.GridengineSpawner',\r\n   dict(req_nprocs='2', req_queue='main.regular', req_runtime='8:00:00', req_memory='4G', req_memoryhrss='8G')),\r\n('BioGrid2 - 6 cores, 64 GB, 4 hours','biogrid6c64g4h', 'batchspawner.GridengineSpawner',\r\n   dict(req_nprocs='6', req_queue='main.largemem', req_runtime='4:00:00', req_memory='64G', req_memoryhrss='74G')),\r\n('BioGrid2 - 2 cores, 4 GB, 24 hours','biogrid2c4g24h', 'batchspawner.GridengineSpawner',\r\n   dict(req_nprocs='2', req_queue='main.regular', req_runtime='24:00:00', req_memory='4G', req_memoryhrss='8G')),\r\n\r\n]\r\n\r\n\r\nc.GridengineSpawner.batch_script =  \"\"\"#!/bin/bash\r\n#$ -N spawner-jupyterhub\r\n#$ -pe make {nprocs}\r\n#$ -l vf={memory},h_rss={memoryhrss},h_rt={runtime}\r\n#$ -wd /home/{username}/\r\n#$ -hard\r\n#$ -q {queue}\r\n#$ -o {homedir}/workspace/grid-jobs/logs/jupyterhub.sge.out\r\n#$ -e {homedir}/workspace/grid-jobs/logs/jupyterhub.sge.err\r\n#$ -v {keepvars}\r\n\r\n. /tools/general/etc/profile.d/bioim_general.sh\r\n. /tools/general/etc/profile.d/bioim_general_local.sh\r\n. /tools/bioinfo/etc/profile.d/bioim_bioinfo.sh\r\n. /tools/bioinfo/etc/profile.d/bioim_bioinfo_local.sh\r\nmodule load Python/3.8.6-GCCcore-10.2.0  jupyterlab/3.0.16-foss-2020b JupyterHub/1.4.2-GCCcore-10.2.0 Pandoc/2.13 batchspawner/1.1.1-GCCcore-10.2.0 wrapspawner/1.0.0-GCCcore-10.2.0\r\n\r\n{cmd}\r\n\r\nAny idea what might be the problem? ", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3668/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3668/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3666", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3666/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3666/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3666/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3666", "id": 1038751978, "node_id": "I_kwDOAT0rQs496hjq", "number": 3666, "title": "Expired certificates in the docker image", "user": {"login": "akhmerov", "id": 2069677, "node_id": "MDQ6VXNlcjIwNjk2Nzc=", "avatar_url": "https://avatars.githubusercontent.com/u/2069677?v=4", "gravatar_id": "", "url": "https://api.github.com/users/akhmerov", "html_url": "https://github.com/akhmerov", "followers_url": "https://api.github.com/users/akhmerov/followers", "following_url": "https://api.github.com/users/akhmerov/following{/other_user}", "gists_url": "https://api.github.com/users/akhmerov/gists{/gist_id}", "starred_url": "https://api.github.com/users/akhmerov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/akhmerov/subscriptions", "organizations_url": "https://api.github.com/users/akhmerov/orgs", "repos_url": "https://api.github.com/users/akhmerov/repos", "events_url": "https://api.github.com/users/akhmerov/events{/privacy}", "received_events_url": "https://api.github.com/users/akhmerov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2021-10-28T17:17:38Z", "updated_at": "2021-10-29T13:02:57Z", "closed_at": "2021-10-29T13:02:51Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n\r\nThe docker image at https://hub.docker.com/r/jupyterhub/jupyterhub was last updated 3 months ago. After that the root certificate of letsencrypt expired and was reissued, however the image doesn't contain a sufficiently recent `ca-certificates` version.\r\n\r\nThis has also been reported via discourse: https://discourse.jupyter.org/t/letsencrypt-certificate-verification-failed-after-09-30-2021/11058\r\n\r\nI believe that rerunning and reuploading the image would fix the problem.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3666/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3666/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3653", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3653/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3653/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3653/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3653", "id": 1027404272, "node_id": "PR_kwDOAT0rQs4tQA71", "number": 3653, "title": "raise 404 on admin attempt to spawn nonexistent user", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2021-10-15T12:42:36Z", "updated_at": "2021-10-15T13:25:49Z", "closed_at": "2021-10-15T13:23:18Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3653", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3653", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3653.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3653.patch", "merged_at": "2021-10-15T13:23:18Z"}, "body": "in adding scope permission checks, this (and possibly other?) attempts by admins to do things on behalf of users may have lost the checks for nonexistent target entities, and instead raise 500.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3653/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3653/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3646", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3646/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3646/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3646/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3646", "id": 1020499502, "node_id": "PR_kwDOAT0rQs4s6n6X", "number": 3646, "title": "new user token returns 200 instead of 201", "user": {"login": "joegasewicz", "id": 28711247, "node_id": "MDQ6VXNlcjI4NzExMjQ3", "avatar_url": "https://avatars.githubusercontent.com/u/28711247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joegasewicz", "html_url": "https://github.com/joegasewicz", "followers_url": "https://api.github.com/users/joegasewicz/followers", "following_url": "https://api.github.com/users/joegasewicz/following{/other_user}", "gists_url": "https://api.github.com/users/joegasewicz/gists{/gist_id}", "starred_url": "https://api.github.com/users/joegasewicz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joegasewicz/subscriptions", "organizations_url": "https://api.github.com/users/joegasewicz/orgs", "repos_url": "https://api.github.com/users/joegasewicz/repos", "events_url": "https://api.github.com/users/joegasewicz/events{/privacy}", "received_events_url": "https://api.github.com/users/joegasewicz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-10-07T22:03:08Z", "updated_at": "2022-01-24T14:55:35Z", "closed_at": "2021-10-13T07:24:30Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3646", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3646", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3646.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3646.patch", "merged_at": "2021-10-13T07:24:30Z"}, "body": "Fixes #3642\r\nThis is a new PR to address @consideRatio comments (calls to write before setting status as below):\r\nClosed PR is [https://github.com/jupyterhub/jupyterhub/pull/3643](https://github.com/jupyterhub/jupyterhub/pull/3643)\r\n\r\n**Quote from @consideRatio in the previous closed PR:**\r\nHmmm, this makes a lot of sense, but I note that in a handler above the following is written out.\r\n```\r\n        self.write(json.dumps(self.user_model(user)))\r\n        self.set_status(201)\r\n```\r\nDoes it matter if set_status is before or after the self.write call? I would guess it should before the write function call like you have made it here.\r\n\r\n@minrk got ideas about that?", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3646/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3646/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3645", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3645/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3645/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3645/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3645", "id": 1020198315, "node_id": "I_kwDOAT0rQs48zv2r", "number": 3645, "title": "Server can't start for some users, ImportError: The Jupyter Server requires tornado >=6.1.0", "user": {"login": "limotkl", "id": 8778177, "node_id": "MDQ6VXNlcjg3NzgxNzc=", "avatar_url": "https://avatars.githubusercontent.com/u/8778177?v=4", "gravatar_id": "", "url": "https://api.github.com/users/limotkl", "html_url": "https://github.com/limotkl", "followers_url": "https://api.github.com/users/limotkl/followers", "following_url": "https://api.github.com/users/limotkl/following{/other_user}", "gists_url": "https://api.github.com/users/limotkl/gists{/gist_id}", "starred_url": "https://api.github.com/users/limotkl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/limotkl/subscriptions", "organizations_url": "https://api.github.com/users/limotkl/orgs", "repos_url": "https://api.github.com/users/limotkl/repos", "events_url": "https://api.github.com/users/limotkl/events{/privacy}", "received_events_url": "https://api.github.com/users/limotkl/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2021-10-07T15:48:09Z", "updated_at": "2021-10-07T16:31:44Z", "closed_at": "2021-10-07T16:26:25Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\n\r\nOnly one user can't start notebook server, the pod keep crashloopbackoff, and finally get timeout in jhublab. Works fine for other users. Jhub use LDAP for user Auth, is there any place that I need to change the setting for that specific user? \r\n```\r\nError message from log:\r\n\r\nTraceback (most recent call last):\r\n  File \"/opt/conda/lib/python3.8/site-packages/jupyter_server/serverapp.py\", line 50, in <module>\r\n    assert tornado.version_info >= MIN_TORNADO\r\nAssertionError\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"/opt/conda/bin/jupyter-labhub\", line 6, in <module>\r\n    from jupyterlab.labhubapp import main\r\n  File \"/opt/conda/lib/python3.8/site-packages/jupyterlab/__init__.py\", line 7, in <module>\r\n    from .labapp import LabApp\r\n  File \"/opt/conda/lib/python3.8/site-packages/jupyterlab/labapp.py\", line 15, in <module>\r\n    from jupyterlab_server import slugify, WORKSPACE_EXTENSION\r\n  File \"/opt/conda/lib/python3.8/site-packages/jupyterlab_server/__init__.py\", line 4, in <module>\r\n    from .app import LabServerApp\r\n  File \"/opt/conda/lib/python3.8/site-packages/jupyterlab_server/app.py\", line 7, in <module>\r\n    from jupyter_server.extension.application import ExtensionApp, ExtensionAppJinjaMixin\r\n  File \"/opt/conda/lib/python3.8/site-packages/jupyter_server/extension/application.py\", line 20, in <module>\r\n    from jupyter_server.serverapp import ServerApp\r\n  File \"/opt/conda/lib/python3.8/site-packages/jupyter_server/serverapp.py\", line 52, in <module>\r\n    raise ImportError(_i18n(\"The Jupyter Server requires tornado >=%s.%s.%s\") % MIN_TORNADO) from e\r\nImportError: The Jupyter Server requires tornado >=6.1.0 \r\n```\r\n\r\n#### Expected behaviour\r\nit should start a new server for user\r\n\r\n#### Actual behaviour\r\nPod keep crashloopbackoff and get timeout error in jhublab\r\n\r\n### How to reproduce\r\n\r\n1. Log in to jhub\r\n2. Select one profile \r\n3. Start new server\r\n\r\n\r\n### Your personal set up\r\nMy personal set up should be fine cause in our project this issue happens for only one user, works fine for others. \r\n\r\n\r\n - Version(s):\r\nappVersion: 1.3.0 helmVersion: 0.11.1", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3645/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3645/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3643", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3643/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3643/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3643/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3643", "id": 1020186132, "node_id": "PR_kwDOAT0rQs4s5o3Z", "number": 3643, "title": "Update users.py", "user": {"login": "joegasewicz", "id": 28711247, "node_id": "MDQ6VXNlcjI4NzExMjQ3", "avatar_url": "https://avatars.githubusercontent.com/u/28711247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joegasewicz", "html_url": "https://github.com/joegasewicz", "followers_url": "https://api.github.com/users/joegasewicz/followers", "following_url": "https://api.github.com/users/joegasewicz/following{/other_user}", "gists_url": "https://api.github.com/users/joegasewicz/gists{/gist_id}", "starred_url": "https://api.github.com/users/joegasewicz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joegasewicz/subscriptions", "organizations_url": "https://api.github.com/users/joegasewicz/orgs", "repos_url": "https://api.github.com/users/joegasewicz/repos", "events_url": "https://api.github.com/users/joegasewicz/events{/privacy}", "received_events_url": "https://api.github.com/users/joegasewicz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-10-07T15:36:02Z", "updated_at": "2021-10-07T22:03:51Z", "closed_at": "2021-10-07T22:03:50Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3643", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3643", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3643.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3643.patch", "merged_at": null}, "body": "New user token returns 200 instead of 201 Fixes #3642", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3643/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3643/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3642", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3642/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3642/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3642/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3642", "id": 1020157995, "node_id": "I_kwDOAT0rQs48zmAr", "number": 3642, "title": "New user token returns `200` instead of `201`", "user": {"login": "joegasewicz", "id": 28711247, "node_id": "MDQ6VXNlcjI4NzExMjQ3", "avatar_url": "https://avatars.githubusercontent.com/u/28711247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joegasewicz", "html_url": "https://github.com/joegasewicz", "followers_url": "https://api.github.com/users/joegasewicz/followers", "following_url": "https://api.github.com/users/joegasewicz/following{/other_user}", "gists_url": "https://api.github.com/users/joegasewicz/gists{/gist_id}", "starred_url": "https://api.github.com/users/joegasewicz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joegasewicz/subscriptions", "organizations_url": "https://api.github.com/users/joegasewicz/orgs", "repos_url": "https://api.github.com/users/joegasewicz/repos", "events_url": "https://api.github.com/users/joegasewicz/events{/privacy}", "received_events_url": "https://api.github.com/users/joegasewicz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-10-07T15:09:50Z", "updated_at": "2021-10-13T07:24:30Z", "closed_at": "2021-10-13T07:24:30Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Bug description\r\nThe api docs for stable & latest list the following response status:\r\n```\r\n201 Created\r\nThe newly created token\r\n```\r\nBut currently returns a status of `200`\r\n\r\n#### Expected behaviour\r\nShould return a response status of `201`\r\n#### Actual behaviour\r\nCurrently returns a response status of `200`\r\n\r\n### How to reproduce\r\nMake a request to `POST /users/{name}/tokens`\r\nSee (https://jupyterhub.readthedocs.io/en/latest/_static/rest-api/index.html#path--users--name--tokens)\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3642/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3642/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3630", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3630/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3630/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3630/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3630", "id": 1010229093, "node_id": "I_kwDOAT0rQs48Nt9l", "number": 3630, "title": "Cannot list users with 'all' scope", "user": {"login": "ktaletsk", "id": 8834829, "node_id": "MDQ6VXNlcjg4MzQ4Mjk=", "avatar_url": "https://avatars.githubusercontent.com/u/8834829?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ktaletsk", "html_url": "https://github.com/ktaletsk", "followers_url": "https://api.github.com/users/ktaletsk/followers", "following_url": "https://api.github.com/users/ktaletsk/following{/other_user}", "gists_url": "https://api.github.com/users/ktaletsk/gists{/gist_id}", "starred_url": "https://api.github.com/users/ktaletsk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ktaletsk/subscriptions", "organizations_url": "https://api.github.com/users/ktaletsk/orgs", "repos_url": "https://api.github.com/users/ktaletsk/repos", "events_url": "https://api.github.com/users/ktaletsk/events{/privacy}", "received_events_url": "https://api.github.com/users/ktaletsk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2021-09-28T21:30:37Z", "updated_at": "2021-10-18T20:24:41Z", "closed_at": "2021-10-18T20:24:41Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Bug description\r\n\r\nI am overriding the default server role to enable JupyterHub API access with KEY as described in https://jupyterhub.readthedocs.io/en/latest/rbac/roles.html#overriding-default-roles. However, after recent commit (somewhere between 7533cb76021f0ceda5102f9316746fa326a30246 and fb1e81212fa967eef36332090b7818a4ec97c3be, probably 8603723dbbabef8a50182ec4d6d4ddd522a46b44) I cannot list users with that token, as it requires to have `list:users` scope. Currently, tokens with `all` scope does not contain `list:users` scope.\r\n\r\n#### Expected behaviour\r\nMy understanding is that `all` scope should include `list:users` scope, as it is now required to list users.\r\n\r\n#### Actual behaviour\r\n`all` scope does not contain `list:users` scope\r\n\r\n### How to reproduce\r\n1a. Override the default role with `all` scope \r\n```py\r\nc.JupyterHub.load_roles = [\r\n  {\r\n    \"name\": \"server\",\r\n    \"scopes\": [\"all\"],\r\n  }\r\n]\r\n```\r\n\r\n*or*\r\n\r\n1b. create a role for service token with `all` scope:\r\n```py\r\nc.JupyterHub.services = [\r\n  {\r\n    \"name\": \"test-token\",\r\n    \"api_token\": \"<token>\",\r\n  }\r\n]\r\n\r\nc.JupyterHub.load_roles = [\r\n  {\r\n    \"name\": \"test-role\",\r\n    \"scopes\": [\"all\"],\r\n    \"services\": [\"test-token\"]\r\n  }\r\n]\r\n```\r\n\r\n2. Start JupyterHub\r\n3. Make an API request to `/hub/api/users` from (1a) user server or (1b) from outside JupyterHub using the predefined service token.\r\n4. Observe error in request\r\n```\r\n{\"status\": 403, \"message\": \"Action is not authorized with current scopes; requires any of [list:users]\"} \r\n```\r\n\r\n### Possible fixes\r\n\r\nI attempted to circumvent the issue by appending `list:users` to the list of scopes in 1a and 1b.\r\n\r\n1a.\r\n```py\r\nc.JupyterHub.load_roles = [\r\n  {\r\n    \"name\": \"server\",\r\n    \"scopes\": [\"all\", \"list:users\"],\r\n  }\r\n]\r\n```\r\n\r\nHowever, this leads to an error while spawning the notebook server\r\n```\r\n[D 2021-09-28 14:19:07.643 JupyterHub roles:470] Checking token permissions against requested role server\r\n[W 2021-09-28 14:19:07.643 JupyterHub roles:434] Token requesting scopes exceeding owner ktaletsk: {'list:users'}\r\n[W 2021-09-28 14:19:07.655 JupyterHub web:1787] 500 GET /hub/spawn/ktaletsk (::ffff:172.18.208.1): Error in Authenticator.pre_spawn_start: ValueError Requested token role server of <APIToken('3b13...', user='ktaletsk', client_id='jupyterhub')> has more permissions than the token owner\r\n```\r\n\r\n1b. \r\n```py\r\nc.JupyterHub.load_roles = [\r\n  {\r\n    \"name\": \"test-role\",\r\n    \"scopes\": [\"all\", \"list:users\"],\r\n    \"services\": [\"test-token\"]\r\n  }\r\n]\r\n```\r\nWorks in this case\r\n\r\n\r\n### Your personal set up\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n\r\n - OS: ubuntu 20.04 in WSL2\r\n - Version(s): 2.0.0b1, [this commit]\r\n- Conda environment\r\n```\r\nname: jupyterhub-rtc\r\nchannels:\r\n  - conda-forge\r\ndependencies:\r\n  - alembic\r\n  - async_generator\r\n  - certipy\r\n  - configurable-http-proxy=4\r\n  - entrypoints\r\n  - jinja2\r\n  - jupyter_telemetry\r\n  - jupyterlab=3.1\r\n  - nodejs=14\r\n  - oauthlib\r\n  - pamela\r\n  - pip\r\n  - prometheus_client\r\n  - psutil\r\n  - pycurl\r\n  - python=3.9\r\n  - python-dateutil\r\n  - requests\r\n  - sqlalchemy\r\n  - tornado=6\r\n  - traitlets=5\r\n  - pip:\r\n    - git+https://github.com/jupyterhub/jupyterhub.git@fb1e81212fa967eef36332090b7818a4ec97c3be#egg=jupyterhub\r\n    - escapism\r\n    - jupyterlab-rtc-hub-settings==0.1.1\r\n    - jupyterlab-link-share==0.2.0\r\n```", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3630/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3630/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3629", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3629/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3629/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3629/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3629", "id": 1010095247, "node_id": "I_kwDOAT0rQs48NNSP", "number": 3629, "title": "JupyterHub\u2019s API tokens does not grant access to other users\u2019 notebook servers", "user": {"login": "dlcrista", "id": 26131587, "node_id": "MDQ6VXNlcjI2MTMxNTg3", "avatar_url": "https://avatars.githubusercontent.com/u/26131587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dlcrista", "html_url": "https://github.com/dlcrista", "followers_url": "https://api.github.com/users/dlcrista/followers", "following_url": "https://api.github.com/users/dlcrista/following{/other_user}", "gists_url": "https://api.github.com/users/dlcrista/gists{/gist_id}", "starred_url": "https://api.github.com/users/dlcrista/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dlcrista/subscriptions", "organizations_url": "https://api.github.com/users/dlcrista/orgs", "repos_url": "https://api.github.com/users/dlcrista/repos", "events_url": "https://api.github.com/users/dlcrista/events{/privacy}", "received_events_url": "https://api.github.com/users/dlcrista/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-09-28T18:53:07Z", "updated_at": "2021-10-05T20:29:05Z", "closed_at": "2021-10-05T20:29:05Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\n\r\nJupyterHub\u2019s admin API tokens does not grant API access to other non-admin user's notebook servers. Admin API tokens are described in detail here: https://jupyterhub.readthedocs.io/en/stable/reference/rest.html\r\n\r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\n Setting `JupyterHub.admin_access` to `True` should grant an admin API access to other user's notebook servers. \r\n\r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\n\r\nUpon setting `JupyterHub.admin_access=True`, and making the following request:\r\n\r\n`\r\ncurl --location --request 'https://myhostname.com/user/nonadminuser/api/contents/somefile?content=1' \\\r\n--header 'Authorization: Bearer admin_api_token'\r\n`\r\nI should be able to see the user's file contents. However, what I actually get as a response is an oauth2 page. The raw html is provided below:\r\n\r\n![image](https://user-images.githubusercontent.com/26131587/135146531-ab91dc4d-27b5-467c-835a-3134292628dd.png)\r\n\r\n\r\nIf I don't pass in the admin API token as a header, then the response in curl is some html asking me to login. It appears that passing in the admin api token makes jupyterhub want to trigger an authorization_code oauth2 flow. I never set up oauth2, so it's strange to me that this is happening. \r\n**Does this mean that I need to have an oauth2 bearer token (and therefore an oauth2 provider as well) in order to view a non-admin user\u2019s files through the rest API?** \r\nIf so, is it possible to use the client_credential grant type flow instead? Because it seems like authorization_code flow is the only one supported right now (which is not ideal since it requires user interaction)\r\n\r\nWhat permissions does the API token allow an \u201cadmin\u201d user to perform? Is it simply the rest calls documented here https://jupyterhub.readthedocs.io/en/stable/_static/rest-api/index.html \r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\n1. set `JupyterHub.admin_access=True`\r\n2. copy and paste the curl above\r\n\r\n### Your personal set up\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n\r\n- JupyterHub helm chart 0.11.1 (https://jupyterhub.github.io/helm-chart/)\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3629/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3629/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3625", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3625/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3625/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3625/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3625", "id": 1007486266, "node_id": "PR_kwDOAT0rQs4sSFPE", "number": 3625, "title": "Added base_url to path for jupyterhub-session-id cookie", "user": {"login": "albertmichaelj", "id": 5385923, "node_id": "MDQ6VXNlcjUzODU5MjM=", "avatar_url": "https://avatars.githubusercontent.com/u/5385923?v=4", "gravatar_id": "", "url": "https://api.github.com/users/albertmichaelj", "html_url": "https://github.com/albertmichaelj", "followers_url": "https://api.github.com/users/albertmichaelj/followers", "following_url": "https://api.github.com/users/albertmichaelj/following{/other_user}", "gists_url": "https://api.github.com/users/albertmichaelj/gists{/gist_id}", "starred_url": "https://api.github.com/users/albertmichaelj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/albertmichaelj/subscriptions", "organizations_url": "https://api.github.com/users/albertmichaelj/orgs", "repos_url": "https://api.github.com/users/albertmichaelj/repos", "events_url": "https://api.github.com/users/albertmichaelj/events{/privacy}", "received_events_url": "https://api.github.com/users/albertmichaelj/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-09-26T19:54:35Z", "updated_at": "2021-10-27T14:05:21Z", "closed_at": "2021-09-27T10:27:15Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3625", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3625", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3625.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3625.patch", "merged_at": "2021-09-27T10:27:15Z"}, "body": "This pull request fixes the `jupyterhub-session-id` cookie path issue as described in issue #3624. It does not fix the problem with the `_xsrf` cookie, so it does not completely close that issue. I'm happy for any feedback as to more elegant fixes. This seemed to be the fix with the minimum delta.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3625/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3625/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3624", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3624/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3624/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3624/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3624", "id": 1007485830, "node_id": "I_kwDOAT0rQs48DQOG", "number": 3624, "title": "_xsrf cookie for singleuser server not scoped to the base_url", "user": {"login": "albertmichaelj", "id": 5385923, "node_id": "MDQ6VXNlcjUzODU5MjM=", "avatar_url": "https://avatars.githubusercontent.com/u/5385923?v=4", "gravatar_id": "", "url": "https://api.github.com/users/albertmichaelj", "html_url": "https://github.com/albertmichaelj", "followers_url": "https://api.github.com/users/albertmichaelj/followers", "following_url": "https://api.github.com/users/albertmichaelj/following{/other_user}", "gists_url": "https://api.github.com/users/albertmichaelj/gists{/gist_id}", "starred_url": "https://api.github.com/users/albertmichaelj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/albertmichaelj/subscriptions", "organizations_url": "https://api.github.com/users/albertmichaelj/orgs", "repos_url": "https://api.github.com/users/albertmichaelj/repos", "events_url": "https://api.github.com/users/albertmichaelj/events{/privacy}", "received_events_url": "https://api.github.com/users/albertmichaelj/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2021-09-26T19:52:30Z", "updated_at": "2021-11-18T16:47:21Z", "closed_at": "2021-11-18T16:47:21Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\nEDIT: The issue with the `jupyterhub-session-id` cookie has been fixed with pull request #3625, which has been merged in master. The issue with the `_xsrf` cookie remains, though there are configuration changes that can be made to fix it.\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\nJupyterHub has the ability to be accessed at a subpath of a domain (such as `www.whatever.com/jupyterhub`) using the configurable `c.JupyterHub.base_url=\"/jupyterhub\"`. When this is done, most of the cookies that JupyterHub uses are effectively scoped to the path \"/jupyterhub/\" (or a further sub-path). However, the cookies `jupyterhub-session-id` and `_xsrf` are scoped to the path `/`. This is maybe a problem, but I actually haven't figured out if it actually causes bugs. The potential issue is that if you run two instances of JupyterHub at two different subpaths of the same domain (i.e. `www.whatever.com/jupyterhub1` and `www.whatever.com/jupyterhub2`) the `jupyterhub-session-id` and `_xsrf` cookies are effectively shared between the two instances if you are logged into both instances at the same time. Whichever server wrote the cookie first gets to dictate the cookie value. Moreover, if you log out of one of the servers, it will delete the `jupyterhub-session-id` and `_xsrf` cookies even if you are still logged into the other server.\r\n\r\nI actually do run multiple instances of Jupyterhub on sub-paths of a single domain, and that is how I noticed the cookie issue. However, I have been unable to determine if anything breaks because of this. As far as I can tell, even though `jupyterhub-session-id` and `_xsrf` occasionally gets mistakenly deleted due to above issue, the other server keeps working fine. However, this is likely unintended behavior, so I wanted to bring it up.\r\n\r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\nI expect all cookies to be scoped to the subpath indicated by `base_url`.\r\n\r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\nThis doesn't happen for the cookies `jupyterhub-session-id` and `_xsrf`\r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\nRun a jupyterhub server with the following command:\r\n\r\n```\r\njupyterhub --JupyterHub.base_url=\"/jupyterhub\"\r\n```\r\n\r\nLog in at `http://localhost:8000/jupyterhub`. Then look at the cookies and the paths for the cookies (browser dependent as to how to do this).\r\n\r\n### Proposed Solution\r\nI have already forked JupyterHub and implemented a two line fix for `jupyterhub-session-id`. I will create a separate pull request and link it back to this issue after submitting. Fixing `jupyterhub-session-id` seems very straightforward and, I think, uncontroversial.\r\n\r\nHowever, the `_xsrf` cookie is trickier. This is because the cookie is actually set by the notebook server. The path issue can be fixed by changing both the config file for JupyterHub and for the notebook server as follows:\r\n\r\n```python\r\nc.JupyterHub.tornado_settings = dict(xsrf_cookie_kwargs=dict(path=\"/jupyterhub/\"))\r\n```\r\n\r\nand\r\n\r\n```python\r\nc.ServerApp.tornado_settings = dict(xsrf_cookie_kwargs=dict(path=\"/jupyterhub/\"))\r\n```\r\n\r\nNote: Replace `ServerApp` with `NotebookApp` if not using `jupyter_server`.\r\n\r\nHowever, it's not enough to change this configuration in one instance because the notebook server sets the cookie and therefore sets the path, but JupyterHub deletes the cookie, and must know the path in order to delete the cookie. Without some communication between the notebook server and JuptyerHub, I'm not sure how to resolve this. Nor am I sure the best way to perform that communication.\r\n\r\nI'm happy to try to work on a solution for that cookie if someone who understand the project a bit better would suggest a potential way to communicate the necessary configuration (`xsrf_cookie_kwargs`) between the two servers.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3624/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3624/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3620", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3620/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3620/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3620/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3620", "id": 1007120379, "node_id": "I_kwDOAT0rQs48B2_7", "number": 3620, "title": "JupyterHub OpenAPI spec contains errors", "user": {"login": "manics", "id": 1644105, "node_id": "MDQ6VXNlcjE2NDQxMDU=", "avatar_url": "https://avatars.githubusercontent.com/u/1644105?v=4", "gravatar_id": "", "url": "https://api.github.com/users/manics", "html_url": "https://github.com/manics", "followers_url": "https://api.github.com/users/manics/followers", "following_url": "https://api.github.com/users/manics/following{/other_user}", "gists_url": "https://api.github.com/users/manics/gists{/gist_id}", "starred_url": "https://api.github.com/users/manics/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/manics/subscriptions", "organizations_url": "https://api.github.com/users/manics/orgs", "repos_url": "https://api.github.com/users/manics/repos", "events_url": "https://api.github.com/users/manics/events{/privacy}", "received_events_url": "https://api.github.com/users/manics/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-09-25T15:47:52Z", "updated_at": "2021-10-29T14:05:05Z", "closed_at": "2021-10-29T14:05:05Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "### Bug description\r\n\r\nThe Swagger validator reports errors in the current JupyterHub OpenAPI spec:\r\n[![](https://validator.swagger.io/validator/?url=https%3A%2F%2Fraw.githubusercontent.com%2Fjupyterhub%2Fjupyterhub%2FHEAD%2Fdocs%2Frest-api.yml)](https://validator.swagger.io/validator/?url=https%3A%2F%2Fraw.githubusercontent.com%2Fjupyterhub%2Fjupyterhub%2FHEAD%2Fdocs%2Frest-api.yml)\r\nhttps://validator.swagger.io/validator/debug?url=https%3A%2F%2Fraw.githubusercontent.com%2Fjupyterhub%2Fjupyterhub%2Fmain%2Fdocs%2Frest-api.yml\r\n\r\nIn addition the API version should be bumped to `2.0.0`, currently it still says `1.4.0`:\r\nhttps://github.com/jupyterhub/jupyterhub/blob/4f6ef54b50ea577bb67f2726bc98a5ce909ebc92/docs/rest-api.yml#L4-L6\r\n\r\n\r\n#### Expected behaviour\r\n\r\nSchema should validate without errors\r\n\r\n#### Actual behaviour\r\n\r\n```json\r\n{\r\n  \"messages\": [\r\n    \"attribute paths.'/users'(get).[limit].requred is unexpected\",\r\n    \"attribute paths.'/proxy'(get).[limit].requred is unexpected\"\r\n  ],\r\n  \"schemaValidationMessages\": [\r\n    {\r\n      \"level\": \"error\",\r\n      \"domain\": \"validation\",\r\n      \"keyword\": \"oneOf\",\r\n      \"message\": \"instance failed to match exactly one schema (matched 0 out of 2)\",\r\n      \"schema\": {\r\n        \"loadingURI\": \"http://swagger.io/v2/schema.json#\",\r\n        \"pointer\": \"/definitions/parametersList/items\"\r\n      },\r\n      \"instance\": {\r\n        \"pointer\": \"/paths/~1proxy/get/parameters/1\"\r\n      }\r\n    }\r\n  ]\r\n}\r\n```\r\nNote there are no errors in 1.4.0:\r\n[![](https://validator.swagger.io/validator/?url=https%3A%2F%2Fraw.githubusercontent.com%2Fjupyterhub%2Fjupyterhub%2F1.4.0%2Fdocs%2Frest-api.yml)](https://validator.swagger.io/validator/?url=https%3A%2F%2Fraw.githubusercontent.com%2Fjupyterhub%2Fjupyterhub%2F1.4.0%2Fdocs%2Frest-api.yml)", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3620/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3620/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3618", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3618/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3618/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3618/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3618", "id": 1005508289, "node_id": "I_kwDOAT0rQs477tbB", "number": 3618, "title": "tornado.curl_httpclient.CurlError: 599 Empty Reply from Server - with Oauth on some users", "user": {"login": "Yayg", "id": 4986194, "node_id": "MDQ6VXNlcjQ5ODYxOTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4986194?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Yayg", "html_url": "https://github.com/Yayg", "followers_url": "https://api.github.com/users/Yayg/followers", "following_url": "https://api.github.com/users/Yayg/following{/other_user}", "gists_url": "https://api.github.com/users/Yayg/gists{/gist_id}", "starred_url": "https://api.github.com/users/Yayg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Yayg/subscriptions", "organizations_url": "https://api.github.com/users/Yayg/orgs", "repos_url": "https://api.github.com/users/Yayg/repos", "events_url": "https://api.github.com/users/Yayg/events{/privacy}", "received_events_url": "https://api.github.com/users/Yayg/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-09-23T14:32:12Z", "updated_at": "2021-09-23T16:45:56Z", "closed_at": "2021-09-23T16:45:56Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\nHi everyone and thanks for developping such an amazing tool,\r\nI'm using JupyterHub on Kubernetes with helm and Keycloak for OIDC.\r\nJupyterhub version: 1.1.3\r\nChart version: 1.1.3\r\nKeycloak version: 12.0.4 (also helmed with codecentric/keycloak)\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\nWhen loging in with Keycloak some users get \"500 Internal Server Error\", then when refreshing \"400 OAuth state missing from cookies\" and jupyterhub shows the following error:\r\n```\r\nI 2021-09-23 13:33:14.850 JupyterHub log:189] 302 GET / -> /hub/ (@10.172.142.121) 1.78ms\r\n[I 2021-09-23 13:33:15.147 JupyterHub log:189] 302 GET /hub/ -> /hub/login?next=%2Fhub%2F (@10.172.142.121) 1.75ms\r\n[I 2021-09-23 13:33:15.183 JupyterHub log:189] 200 GET /hub/login?next=%2Fhub%2F (@10.172.142.121) 4.77ms\r\n[I 2021-09-23 13:33:17.979 JupyterHub oauth2:111] OAuth redirect: 'https://jhub-dev.eds.aphp.fr/hub/oauth_callback'\r\n[I 2021-09-23 13:33:17.982 JupyterHub log:189] 302 GET /hub/oauth_login?next=%2Fhub%2F -> https://auth.eds.aphp.fr/auth/realms/master/protocol/openid-connect/auth?response_type=code&redirect_uri=https%3A%2F%2Fjhub-dev.eds.aphp.fr%2Fhub%2Foauth_callback&client_id=jupyterhub&state=[secret]&scope=ldap-groups (@10.172.142.121) 3.07ms\r\n[E 2021-09-23 13:33:18.161 JupyterHub oauth2:389] Error fetching user data 599 GET https://auth.eds.aphp.fr/auth/realms/master/protocol/openid-connect/userinfo: HTTP 599: Empty reply from server\r\n[E 2021-09-23 13:33:18.162 JupyterHub web:1789] Uncaught exception GET /hub/oauth_callback?code=e5a40fe1-02bb-4b81-94a4-b488ebd02bca.09a2f2a1-f45a-473b-93ed-581466b325d2.feae45a6-94c2-45f8-83c6-80dc56b6c4e3&state=eyJzdGF0ZV9pZCI6ICI1MTUzOWU1Y2U1MTA0OGZjYjMwN2E2NDYyYzViODZmYSIsICJuZXh0X3VybCI6ICIvaHViLyJ9 (10.172.142.121)\r\n    HTTPServerRequest(protocol='https', host='jhub-dev.eds.aphp.fr', method='GET', uri='/hub/oauth_callback?code=e5a40fe1-02bb-4b81-94a4-b488ebd02bca.09a2f2a1-f45a-473b-93ed-581466b325d2.feae45a6-94c2-45f8-83c6-80dc56b6c4e3&state=eyJzdGF0ZV9pZCI6ICI1MTUzOWU1Y2U1MTA0OGZjYjMwN2E2NDYyYzViODZmYSIsICJuZXh0X3VybCI6ICIvaHViLyJ9', version='HTTP/1.1', remote_ip='10.172.142.121')\r\n    Traceback (most recent call last):\r\n      File \"/usr/local/lib/python3.8/dist-packages/tornado/web.py\", line 1704, in _execute\r\n        result = await result\r\n      File \"/usr/local/lib/python3.8/dist-packages/oauthenticator/oauth2.py\", line 231, in get\r\n        user = await self.login_user()\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/handlers/base.py\", line 754, in login_user\r\n        authenticated = await self.authenticate(data)\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/auth.py\", line 469, in get_authenticated_user\r\n        authenticated = await maybe_future(self.authenticate(handler, data))\r\n      File \"/usr/local/lib/python3.8/dist-packages/oauthenticator/generic.py\", line 171, in authenticate\r\n        user_data_resp_json = await self._get_user_data(token_resp_json)\r\n      File \"/usr/local/lib/python3.8/dist-packages/oauthenticator/oauth2.py\", line 390, in fetch\r\n        raise e\r\n      File \"/usr/local/lib/python3.8/dist-packages/oauthenticator/oauth2.py\", line 369, in fetch\r\n        resp = await self.http_client.fetch(req, **kwargs)\r\n    tornado.curl_httpclient.CurlError: HTTP 599: Empty reply from server\r\n    \r\n[E 2021-09-23 13:33:18.187 JupyterHub log:181] {\r\n      \"Cookie\": \"oauthenticator-state=[secret]\",\r\n      \"Accept-Language\": \"en\",\r\n      \"Accept-Encoding\": \"gzip, deflate, br\",\r\n      \"Sec-Fetch-Dest\": \"document\",\r\n      \"Sec-Fetch-User\": \"?1\",\r\n      \"Sec-Fetch-Mode\": \"navigate\",\r\n      \"Sec-Fetch-Site\": \"same-site\",\r\n      \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\",\r\n      \"User-Agent\": \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.66 Safari/537.36\",\r\n      \"Upgrade-Insecure-Requests\": \"1\",\r\n      \"X-Original-Forwarded-For\": \"10.200.207.155, 127.0.0.1\",\r\n      \"X-Scheme\": \"https\",\r\n      \"X-Forwarded-Proto\": \"https,http\",\r\n      \"X-Forwarded-Port\": \"443,80\",\r\n      \"X-Forwarded-Host\": \"jhub.kubernetes\",\r\n      \"X-Forwarded-For\": \"10.172.142.121,::ffff:192.168.64.1\",\r\n      \"X-Real-Ip\": \"10.172.142.121\",\r\n      \"X-Request-Id\": \"4a63923bea89a856f64688eeb5cd705a\",\r\n      \"Host\": \"jhub-dev.eds.aphp.fr\",\r\n      \"Connection\": \"close\"\r\n    }\r\n[E 2021-09-23 13:33:18.187 JupyterHub log:189] 500 GET /hub/oauth_callback?code=[secret]&state=[secret] (@10.172.142.121) 114.56ms\r\n```\r\nThe error seems to be because the userinfo on my keycloak server is broken but it actually works for some users and the error is still there for other versions of keycloak (14.0.0 and 15.0.2) so I guess the problem comes from Jupyterhub\r\n\r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\nThe user should be able to login normally\r\n\r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\nSome users cannot login (and nothing seems to differentiate the users from one another on the Keycloak side)\r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\n1. Deploy keycloak 12.0.4 and setup a client\r\n2. Deploy jupyterhub 1.1.3 and use the following oidc config:\r\n```\r\n    GenericOAuthenticator:\r\n      client_id: jupyterhub\r\n      client_secret: 008e4bba-9ecd-4553-8263-0e9351d9e2b7\r\n      oauth_callback_url: https://jhub-dev.eds.aphp.fr/hub/oauth_callback\r\n      authorize_url: https://auth.eds.aphp.fr/auth/realms/master/protocol/openid-connect/auth\r\n      token_url: https://auth.eds.aphp.fr/auth/realms/master/protocol/openid-connect/token\r\n      userdata_url: https://auth.eds.aphp.fr/auth/realms/master/protocol/openid-connect/userinfo\r\n      login_service: keycloak\r\n      userdata_params:\r\n        state: state\r\n#     scope:\r\n#       - openid\r\n#       - profile\r\n#       - email\r\n#       - ldap-groups\r\n#       - web-origins\r\n      username_key: fullname\r\n    JupyterHub:\r\n      admin_access: true\r\n      authenticator_class: generic-oauth\r\n```\r\n### Your personal set up\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n\r\n - OS:\r\nKubernetes over Centos7\r\n - Version(s):\r\n1..1.3\r\n\r\n- <details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\njovyan@hub-776cfc4d77-9xpjh:/srv/jupyterhub$ pip freeze\r\nalembic==1.6.5\r\nappdirs==1.4.3\r\nasync-generator==1.10\r\nattrs==21.2.0\r\nbcrypt==3.2.0\r\ncachetools==4.2.2\r\ncertifi==2021.5.30\r\ncertipy==0.1.3\r\ncffi==1.14.5\r\nchardet==4.0.0\r\ncryptography==3.4.7\r\ndistlib==0.3.0\r\nentrypoints==0.3\r\nescapism==1.0.1\r\nfilelock==3.0.12\r\ngoogle-auth==1.31.0\r\ngreenlet==1.1.0\r\nidna==2.10\r\nimportlib-metadata==1.5.0\r\nipython-genutils==0.2.0\r\nJinja2==3.0.1\r\njsonschema==3.2.0\r\njupyter-telemetry==0.1.0\r\njupyterhub==1.4.2\r\njupyterhub-firstuseauthenticator==0.14.1\r\njupyterhub-hmacauthenticator==1.0\r\njupyterhub-idle-culler==1.1\r\njupyterhub-kubespawner==1.1.0\r\njupyterhub-ldapauthenticator==1.3.2\r\njupyterhub-ltiauthenticator==1.0.0\r\njupyterhub-nativeauthenticator==0.0.7\r\njupyterhub-tmpauthenticator==0.6\r\nkubernetes==17.17.0\r\nldap3==2.9\r\nMako==1.1.4\r\nMarkupSafe==2.0.1\r\nmore-itertools==4.2.0\r\nmwoauth==0.3.7\r\nnullauthenticator==1.0.0\r\noauthenticator==14.2.0\r\noauthlib==3.1.1\r\nonetimepass==1.0.1\r\npackaging==20.3\r\npamela==1.0.0\r\npluggy==0.13.0\r\nprometheus-client==0.11.0\r\npsycopg2-binary==2.9.1\r\npy==1.8.1\r\npy-spy==0.3.8\r\npyasn1==0.4.8\r\npyasn1-modules==0.2.8\r\npycparser==2.20\r\npycurl==7.44.1\r\nPyJWT==1.7.1\r\nPyMySQL==1.0.2\r\npyOpenSSL==20.0.1\r\npyparsing==2.4.6\r\npyrsistent==0.17.3\r\npython-dateutil==2.8.1\r\npython-editor==1.0.4\r\npython-json-logger==2.0.1\r\npython-ldap==3.3.1\r\npython-slugify==5.0.2\r\nPyYAML==5.4.1\r\nrequests==2.25.1\r\nrequests-oauthlib==1.3.0\r\nrsa==4.7.2\r\nruamel.yaml==0.17.9\r\nruamel.yaml.clib==0.2.2\r\nsix==1.16.0\r\nSQLAlchemy==1.4.18\r\nsqlalchemy-cockroachdb==1.4.0\r\nstatsd==3.3.0\r\ntext-unidecode==1.3\r\ntoml==0.10.0\r\ntornado==6.1\r\ntox==3.13.2\r\ntraitlets==5.0.5\r\nurllib3==1.26.5\r\nvirtualenv==20.0.17\r\nwebsocket-client==1.1.0\r\nzipp==1.0.0\r\n```\r\n\r\n- <details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```python\r\n# jupyterhub_config.py\r\n```\r\n</details>\r\n\r\n- <details><summary>Logs</summary>\r\n<!--\r\nErrors are often logged by jupytehub. How you get logs depends on your deployment.\r\nWith kubernetes it might be:\r\n\r\n    kubectl get pod # hub pod name starts with hub...\r\n    kubectl logs hub-...\r\n    # or for a single-user server\r\n    kubectl logs jupyter-username\r\n\r\nOr the-littlest-jupyterhub:\r\n\r\n    journalctl -u jupyterhub\r\n    # or for a single-user server\r\n    journalctl -u jupyter-username\r\n-->\r\n\r\n```\r\n# paste relevant logs here, if any\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3618/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3618/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3599", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3599/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3599/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3599/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3599", "id": 991724457, "node_id": "MDU6SXNzdWU5OTE3MjQ0NTc=", "number": 3599, "title": "NameError: name 'sys' is not defined", "user": {"login": "shaw1111", "id": 3040140, "node_id": "MDQ6VXNlcjMwNDAxNDA=", "avatar_url": "https://avatars.githubusercontent.com/u/3040140?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shaw1111", "html_url": "https://github.com/shaw1111", "followers_url": "https://api.github.com/users/shaw1111/followers", "following_url": "https://api.github.com/users/shaw1111/following{/other_user}", "gists_url": "https://api.github.com/users/shaw1111/gists{/gist_id}", "starred_url": "https://api.github.com/users/shaw1111/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shaw1111/subscriptions", "organizations_url": "https://api.github.com/users/shaw1111/orgs", "repos_url": "https://api.github.com/users/shaw1111/repos", "events_url": "https://api.github.com/users/shaw1111/events{/privacy}", "received_events_url": "https://api.github.com/users/shaw1111/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-09-09T03:44:44Z", "updated_at": "2021-09-09T05:41:46Z", "closed_at": "2021-09-09T05:41:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "after adding idle configuration , jupyterhub start failed\r\n`c.JupyterHub.services = [\r\n    {\r\n        'name': 'idle-culler',\r\n        'admin': True,\r\n        'command': [\r\n            sys.executable,\r\n           '-m', 'jupyterhub_idle_culler',\r\n            '--timeout=60'\r\n        ],\r\n    }\r\n]`\r\n\r\n\r\n> [root@VM-12-7-centos home]# jupyterhub -f /home/jupyterhub_config.py \r\n[E 2021-09-09 11:41:38.499 JupyterHub app:2969]\r\n    Traceback (most recent call last):\r\n      File \"/usr/local/lib/python3.6/site-packages/jupyterhub/app.py\", line 2966, in launch_instance_async\r\n        await self.initialize(argv)\r\n      File \"/usr/local/lib/python3.6/site-packages/jupyterhub/app.py\", line 2457, in initialize\r\n        self.load_config_file(self.config_file)\r\n      File \"/usr/local/lib/python3.6/site-packages/decorator.py\", line 232, in fun\r\n        return caller(func, *(extras + args), **kw)\r\n      File \"/usr/local/lib/python3.6/site-packages/traitlets/config/application.py\", line 87, in catch_config_error\r\n        return method(app, *args, **kwargs)\r\n      File \"/usr/local/lib/python3.6/site-packages/traitlets/config/application.py\"      File \"/usr/local/lib/python3.6/site-packages/decorator.py\", line 232, in fun\r\n        return caller(func, *(extras + args), **kw)\r\n      File \"/usr/local/lib/python3.6/site-packages/traitlets/config/application.py\", line 87, in catch_config_error\r\n        return method(app, *args, **kwargs)\r\n      File \"/usr/local/lib/python3.6/site-packages/traitlets/config/application.py\", line 602, in load_config_file\r\n        raise_config_file_errors=self.raise_config_file_errors,\r\n      File \"/usr/local/lib/python3.6/site-packages/traitlets/config/application.py\", line 563, in _load_config_files\r\n        config = loader.load_config()\r\n      File \"/usr/local/lib/python3.6/site-packages/traitlets/config/loader.py\", line 457, in load_config\r\n        self._read_file_as_dict()\r\n      File \"/usr/local/lib/python3.6/site-packages/traitlets/config/loader.py\", line 489, in _read_file_as_dict\r\n        py3compat.execfile(conf_filename, namespace)\r\n      File \"/usr/local/lib/python3.6/site-packages/ipython_genutils/py3compat.py\", line 198, in execfile\r\n        exec(compiler(f.read(), fname, 'exec'), glob, loc)\r\n      File \"/home/jupyterhub_config.py\", line 27, in <module>\r\n        sys.executable,\r\n    NameError: name 'sys' is not defined\r\n\r\n\r\n`", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3599/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3599/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3592", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3592/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3592/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3592/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3592", "id": 986141550, "node_id": "MDU6SXNzdWU5ODYxNDE1NTA=", "number": 3592, "title": "Spawner instance reused after a failed start", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2021-09-02T05:05:38Z", "updated_at": "2022-03-07T13:23:23Z", "closed_at": "2022-03-07T13:23:23Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "If I'm not mistaken, each server starting should get a fresh Spawner instance for each spawn attempt.\r\n\r\nI made a spawn attempt that failed because start_timeout triggered after in this case, KubeSpawner, had failed to schedule a k8s pod on a k8s node. After this attempt, I tried to start another server with a different configuration via KubeSpawner's profile_list, but I ended up with a mixed configuration where one setting came from the first spawn attempt and the other came from the new spawn attempt. This to me indicated that the Spawner instance had been re-used.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3592/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3592/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3570", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3570/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3570/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3570/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3570", "id": 965123919, "node_id": "MDU6SXNzdWU5NjUxMjM5MTk=", "number": 3570, "title": "Upload large files on JupyterHub", "user": {"login": "oharach1", "id": 69559876, "node_id": "MDQ6VXNlcjY5NTU5ODc2", "avatar_url": "https://avatars.githubusercontent.com/u/69559876?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oharach1", "html_url": "https://github.com/oharach1", "followers_url": "https://api.github.com/users/oharach1/followers", "following_url": "https://api.github.com/users/oharach1/following{/other_user}", "gists_url": "https://api.github.com/users/oharach1/gists{/gist_id}", "starred_url": "https://api.github.com/users/oharach1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oharach1/subscriptions", "organizations_url": "https://api.github.com/users/oharach1/orgs", "repos_url": "https://api.github.com/users/oharach1/repos", "events_url": "https://api.github.com/users/oharach1/events{/privacy}", "received_events_url": "https://api.github.com/users/oharach1/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 106589224, "node_id": "MDU6TGFiZWwxMDY1ODkyMjQ=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/duplicate", "name": "duplicate", "color": "cccccc", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-08-10T16:38:29Z", "updated_at": "2021-08-10T17:09:46Z", "closed_at": "2021-08-10T17:09:38Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi, we are facing an issue to upload large files on JupyterHub, seems in some point the connection is reset while trying to upload files >9MB.\r\n\r\nUsing the Webconsole we are getting API request failed (0):error and also PUT https://jupyterhub-our-instance/user/userID/api/contest/filetest430MB.zip net::ERR_CONNECTION_RESET\r\n\r\nWe are not using a reverse proxy such as NGINX, our setup is using configurable-http-proxy to manage all the internal traffic between the hub and individual pods.\r\n\r\nIs very curious we we are facing this issue on classic notebook view and not by using the lab view.\r\n\r\nthere is a constrain about timeout or proxy-timeout for configurable-http-proxy? based on technical pages for configurable-http-proxy there are some parameters for this CHP but I am note sure how I should set these parameters.\r\n\r\nI will appreciated any insight for this issue.\r\n\r\nThanks,", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3570/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3570/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3569", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3569/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3569/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3569/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3569", "id": 964787929, "node_id": "MDExOlB1bGxSZXF1ZXN0NzA3MTkwOTk3", "number": 3569, "title": "Fix wrong name of auth_state_hook in the exception log", "user": {"login": "dolfinus", "id": 4661021, "node_id": "MDQ6VXNlcjQ2NjEwMjE=", "avatar_url": "https://avatars.githubusercontent.com/u/4661021?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dolfinus", "html_url": "https://github.com/dolfinus", "followers_url": "https://api.github.com/users/dolfinus/followers", "following_url": "https://api.github.com/users/dolfinus/following{/other_user}", "gists_url": "https://api.github.com/users/dolfinus/gists{/gist_id}", "starred_url": "https://api.github.com/users/dolfinus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dolfinus/subscriptions", "organizations_url": "https://api.github.com/users/dolfinus/orgs", "repos_url": "https://api.github.com/users/dolfinus/repos", "events_url": "https://api.github.com/users/dolfinus/events{/privacy}", "received_events_url": "https://api.github.com/users/dolfinus/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-08-10T09:39:32Z", "updated_at": "2021-08-10T10:23:55Z", "closed_at": "2021-08-10T10:00:34Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3569", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3569", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3569.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3569.patch", "merged_at": "2021-08-10T10:00:34Z"}, "body": "Hi.\r\n\r\nI found a small issue with handling an exception raised by `Spawner.auth_state_hook` - in the log message it is called `auth_stop_hook`.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3569/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3569/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3568", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3568/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3568/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3568/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3568", "id": 964398701, "node_id": "MDExOlB1bGxSZXF1ZXN0NzA2ODY0MTcw", "number": 3568, "title": "Stop injecting statsd parameters into the configurable HTTP proxy", "user": {"login": "paccorsi", "id": 13418502, "node_id": "MDQ6VXNlcjEzNDE4NTAy", "avatar_url": "https://avatars.githubusercontent.com/u/13418502?v=4", "gravatar_id": "", "url": "https://api.github.com/users/paccorsi", "html_url": "https://github.com/paccorsi", "followers_url": "https://api.github.com/users/paccorsi/followers", "following_url": "https://api.github.com/users/paccorsi/following{/other_user}", "gists_url": "https://api.github.com/users/paccorsi/gists{/gist_id}", "starred_url": "https://api.github.com/users/paccorsi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/paccorsi/subscriptions", "organizations_url": "https://api.github.com/users/paccorsi/orgs", "repos_url": "https://api.github.com/users/paccorsi/repos", "events_url": "https://api.github.com/users/paccorsi/events{/privacy}", "received_events_url": "https://api.github.com/users/paccorsi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-08-09T21:20:42Z", "updated_at": "2021-08-10T12:36:21Z", "closed_at": "2021-08-10T12:35:45Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3568", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3568", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3568.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3568.patch", "merged_at": "2021-08-10T12:35:45Z"}, "body": "Addresses https://github.com/jupyterhub/jupyterhub/issues/3567\r\nA more detailed explanation can be found in the body of the issue.\r\n\r\nThe latest release of the configurable HTTP proxy removed support for statsd. However if the statsd host and port are defined in the Jupyterhub config, they will be added to the command line arguments of the configurable HTTP proxy. Since these arguments are not recognized by the proxy, it fails to start with the following error message:\r\n```\r\nerror: unknown option '--statsd-host'\r\n```\r\n\r\nThis pull request removes the piece of code responsible for adding the statsd command line arguments (host, port and prefix) to the configurable HTTP proxy.\r\nWith this change users will be able to define the parameters for their statsd clients in the Jupyterhub config and the configurable HTTP proxy will run normally without failing at the start.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3568/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3568/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3567", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3567/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3567/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3567/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3567", "id": 964075548, "node_id": "MDU6SXNzdWU5NjQwNzU1NDg=", "number": 3567, "title": "Jupyterhub crashes when statsd metrics are defined", "user": {"login": "paccorsi", "id": 13418502, "node_id": "MDQ6VXNlcjEzNDE4NTAy", "avatar_url": "https://avatars.githubusercontent.com/u/13418502?v=4", "gravatar_id": "", "url": "https://api.github.com/users/paccorsi", "html_url": "https://github.com/paccorsi", "followers_url": "https://api.github.com/users/paccorsi/followers", "following_url": "https://api.github.com/users/paccorsi/following{/other_user}", "gists_url": "https://api.github.com/users/paccorsi/gists{/gist_id}", "starred_url": "https://api.github.com/users/paccorsi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/paccorsi/subscriptions", "organizations_url": "https://api.github.com/users/paccorsi/orgs", "repos_url": "https://api.github.com/users/paccorsi/repos", "events_url": "https://api.github.com/users/paccorsi/events{/privacy}", "received_events_url": "https://api.github.com/users/paccorsi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-08-09T14:48:56Z", "updated_at": "2021-08-10T14:11:40Z", "closed_at": "2021-08-10T14:11:40Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\nReleases 4.4 and above of the configurable HTTP proxy\r\n(https://github.com/jupyterhub/configurable-http-proxy/blob/main/CHANGELOG.md) removed support for statsd.\r\nHowever if Jupyterhub is configured with a statsd client, the statsd host and port will be injected into\r\nthe proxy command, thus failing the application at startup:\r\nhttps://github.com/jupyterhub/jupyterhub/blob/6be3160d7487bb362df7095f24454ef2814951fc/jupyterhub/proxy.py#L686-L696\r\n\r\n#### Expected behaviour\r\nJupyterhub should not inject the statsd host and port to the configurable HTTP proxy command.\r\n\r\n#### Actual behaviour\r\nSince support for statsd in the proxy was removed, the command line argument are not acceptable and the proxy fails at startup with the following error:\r\n\r\n```\r\n[I 2021-08-09 14:26:39.541 JupyterHub app:2526] Initialized 0 spawners in 0.003 seconds\r\n[W 2021-08-09 14:26:39.544 JupyterHub proxy:699] Running JupyterHub without SSL.  I hope there is SSL termination happening somewhere else...\r\n[I 2021-08-09 14:26:39.544 JupyterHub proxy:703] Starting proxy @ http://0.0.0.0:8000/\r\n[D 2021-08-09 14:26:39.545 JupyterHub proxy:704] Proxy cmd: ['configurable-http-proxy', '--ip', '0.0.0.0', '--port', '8000', '--api-ip', '127.0.0.1', '--api-port', '8001', '--error-target', 'http://localhost:10/hub/error', '--log-level', 'debug', '--statsd-host', 'localhost', '--statsd-port', '8125', '--statsd-prefix', 'jupyterhub.chp']\r\n[D 2021-08-09 14:26:39.550 JupyterHub proxy:611] Writing proxy pid file: jupyterhub-proxy.pid\r\nerror: unknown option '--statsd-host'\r\n[C 2021-08-09 14:26:40.505 JupyterHub app:2735] Failed to start proxy\r\n    Traceback (most recent call last):\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/app.py\", line 2733, in start\r\n        await self.proxy.start()\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/proxy.py\", line 730, in start\r\n        _check_process()\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/proxy.py\", line 726, in _check_process\r\n        raise e from None\r\n    RuntimeError: Proxy failed to start with exit code 1\r\n\r\n```\r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\n1. Define `c.JupyterHub.statsd_host` and `c.JupyterHub.statsd_port`in the `jupyterhub_config.py`\r\n2. Build a container with the latest release of Jupyterhub\r\n3. Run the Jupyterhub container\r\n\r\n### Your personal set up\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n\r\n - OS:\r\nubuntu:focal-20200729\r\n - Version(s):\r\n Jupyterhub 1.4.2\r\nPython 3.8.10\r\n\r\n- <details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\nPackage                Version\r\n---------------------- ---------\r\nalembic                1.6.5\r\nasync-generator        1.10\r\nattrs                  21.2.0\r\ncachetools             4.2.2\r\ncertifi                2021.5.30\r\ncertipy                0.1.3\r\ncffi                   1.14.6\r\nchardet                4.0.0\r\ncharset-normalizer     2.0.2\r\ncryptography           3.4.7\r\ndatadog                0.42.0\r\nentrypoints            0.3\r\nescapism               1.0.1\r\ngoogle-auth            1.30.1\r\ngreenlet               1.1.0\r\nidna                   3.2\r\nipython-genutils       0.2.0\r\nJinja2                 3.0.1\r\njsonschema             3.2.0\r\njupyter-telemetry      0.1.0\r\njupyterhub             1.4.2\r\njupyterhub-idle-culler 1.1\r\njupyterhub-kubespawner 1.1.0\r\nkubernetes             17.17.0\r\nMako                   1.1.4\r\nMarkupSafe             2.0.1\r\noauthlib               3.1.1\r\npamela                 1.0.0\r\npip                    21.1.3\r\nprometheus-client      0.11.0\r\npyasn1                 0.4.8\r\npyasn1-modules         0.2.8\r\npycparser              2.20\r\npycurl                 7.43.0.6\r\nPyMySQL                1.0.2\r\npyOpenSSL              20.0.1\r\npyrsistent             0.18.0\r\npython-dateutil        2.8.2\r\npython-editor          1.0.4\r\npython-json-logger     2.0.1\r\npython-slugify         5.0.2\r\nPyYAML                 5.4.1\r\nrequests               2.26.0\r\nrequests-oauthlib      1.3.0\r\nrsa                    4.7.2\r\nruamel.yaml            0.17.10\r\nruamel.yaml.clib       0.2.6\r\nsetuptools             57.4.0\r\nsix                    1.16.0\r\nSQLAlchemy             1.4.21\r\nstatsd                 3.3.0\r\ntext-unidecode         1.3\r\ntornado                6.1\r\ntraitlets              5.0.5\r\nurllib3                1.26.6\r\nwebsocket-client       1.0.1\r\nwheel                  0.34.2\r\n```\r\n</details>\r\n\r\n- <details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```python\r\n# jupyterhub_config.py\r\nc.JupyterHub.statsd_host = 'localhost'\r\nc.JupyterHub.statsd_port = '8125'\r\n```\r\n</details>\r\n\r\n- <details><summary>Logs</summary>\r\n<!--\r\nErrors are often logged by jupytehub. How you get logs depends on your deployment.\r\nWith kubernetes it might be:\r\n\r\n    kubectl get pod # hub pod name starts with hub...\r\n    kubectl logs hub-...\r\n    # or for a single-user server\r\n    kubectl logs jupyter-username\r\n\r\nOr the-littlest-jupyterhub:\r\n\r\n    journalctl -u jupyterhub\r\n    # or for a single-user server\r\n    journalctl -u jupyter-username\r\n-->\r\n\r\n```\r\n[I 2021-08-09 14:26:39.544 JupyterHub proxy:703] Starting proxy @ http://0.0.0.0:8000/\r\n[D 2021-08-09 14:26:39.545 JupyterHub proxy:704] Proxy cmd: ['configurable-http-proxy', '--ip', '0.0.0.0', '--port', '8000', '--api-ip', '127.0.0.1', '--api-port', '8001', '--error-target', 'http://localhost:10/hub/error', '--log-level', 'debug', '--statsd-host', 'localhost', '--statsd-port', '8125', '--statsd-prefix', 'jupyterhub.chp']\r\n[D 2021-08-09 14:26:39.550 JupyterHub proxy:611] Writing proxy pid file: jupyterhub-proxy.pid\r\nerror: unknown option '--statsd-host'\r\n[C 2021-08-09 14:26:40.505 JupyterHub app:2735] Failed to start proxy\r\n    Traceback (most recent call last):\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/app.py\", line 2733, in start\r\n        await self.proxy.start()\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/proxy.py\", line 730, in start\r\n        _check_process()\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/proxy.py\", line 726, in _check_process\r\n        raise e from None\r\n    RuntimeError: Proxy failed to start with exit code 1\r\n\r\n[D 2021-08-09 14:26:40.508 JupyterHub application:834] Exiting application: jupyterhub\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3567/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3567/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3566", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3566/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3566/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3566/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3566", "id": 959552649, "node_id": "MDExOlB1bGxSZXF1ZXN0NzAyNjU1OTI2", "number": 3566, "title": "explicit DB rollback for 500 errors", "user": {"login": "nsshah1288", "id": 61845317, "node_id": "MDQ6VXNlcjYxODQ1MzE3", "avatar_url": "https://avatars.githubusercontent.com/u/61845317?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nsshah1288", "html_url": "https://github.com/nsshah1288", "followers_url": "https://api.github.com/users/nsshah1288/followers", "following_url": "https://api.github.com/users/nsshah1288/following{/other_user}", "gists_url": "https://api.github.com/users/nsshah1288/gists{/gist_id}", "starred_url": "https://api.github.com/users/nsshah1288/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nsshah1288/subscriptions", "organizations_url": "https://api.github.com/users/nsshah1288/orgs", "repos_url": "https://api.github.com/users/nsshah1288/repos", "events_url": "https://api.github.com/users/nsshah1288/events{/privacy}", "received_events_url": "https://api.github.com/users/nsshah1288/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2021-08-03T21:59:30Z", "updated_at": "2022-10-10T13:03:54Z", "closed_at": "2021-08-10T13:36:19Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3566", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3566", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3566.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3566.patch", "merged_at": "2021-08-10T13:36:19Z"}, "body": "This PR adds explicit `try`, `except`, and `db.rollback()` when JupyterHub DB is in a bad state. We made these changes in a 'brute force' approach, by searching our logs and adding an explicit `db.rollback()` wherever the error first occurred. It has worked well (no manual restarts required) in our production JupyterHub over the last month, where we are hosted on EKS, using Amazon Aurora PostgreSQL Serverless and JupyterHub version 1.2.1.\r\n\r\nPosts related to this issue:\r\n- https://discourse.jupyter.org/t/jupyterhub-500-error-ssl-connection-has-been-closed-unexpectedly-tornado-ioloop/9106/5\r\n- https://github.com/jupyterhub/jupyterhub/issues/1626\r\n\r\nPlease let us know if there is a better or more standardized approach that we should follow for this. Thanks!", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3566/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3566/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3564", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3564/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3564/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3564/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3564", "id": 959390774, "node_id": "MDExOlB1bGxSZXF1ZXN0NzAyNTEyMjE0", "number": 3564, "title": "don't omit server model if it's empty", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-08-03T18:45:33Z", "updated_at": "2021-10-27T14:08:41Z", "closed_at": "2021-08-18T08:36:02Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3564", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3564", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3564.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3564.patch", "merged_at": "2021-08-18T08:36:02Z"}, "body": "if request has access to read servers, leave it present and empty\r\n\r\nonly omit it if there's no access to read server models.\r\n\r\nThe `servers` field was meant to be omitted when a request is made that doesn't have access to this field. However, we were removing it any time it's empty, which is true for users not running any servers, even if the request has access to read the field.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3564/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3564/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3563", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3563/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3563/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3563/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3563", "id": 959375739, "node_id": "MDExOlB1bGxSZXF1ZXN0NzAyNDk5MzU4", "number": 3563, "title": "ensure admin requests for missing users 404", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-08-03T18:23:28Z", "updated_at": "2021-11-18T13:46:36Z", "closed_at": "2021-08-04T08:55:07Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3563", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3563", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3563.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3563.patch", "merged_at": "2021-08-04T08:55:07Z"}, "body": "we were calling `user_model(None)` which doesn't work.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3563/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3563/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3549", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3549/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3549/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3549/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3549", "id": 951670223, "node_id": "MDU6SXNzdWU5NTE2NzAyMjM=", "number": 3549, "title": "cull timeout settings in config does not work", "user": {"login": "sameergithub5", "id": 21688051, "node_id": "MDQ6VXNlcjIxNjg4MDUx", "avatar_url": "https://avatars.githubusercontent.com/u/21688051?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sameergithub5", "html_url": "https://github.com/sameergithub5", "followers_url": "https://api.github.com/users/sameergithub5/followers", "following_url": "https://api.github.com/users/sameergithub5/following{/other_user}", "gists_url": "https://api.github.com/users/sameergithub5/gists{/gist_id}", "starred_url": "https://api.github.com/users/sameergithub5/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sameergithub5/subscriptions", "organizations_url": "https://api.github.com/users/sameergithub5/orgs", "repos_url": "https://api.github.com/users/sameergithub5/repos", "events_url": "https://api.github.com/users/sameergithub5/events{/privacy}", "received_events_url": "https://api.github.com/users/sameergithub5/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 1280242352, "node_id": "MDU6TGFiZWwxMjgwMjQyMzUy", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/support", "name": "support", "color": "Cfaef7", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2021-07-23T15:16:01Z", "updated_at": "2021-07-23T16:42:49Z", "closed_at": "2021-07-23T16:21:42Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\nThe issue is even after following official jupyterhub doc cull time out setting and implementing them still  idle spark session or opened notebook session are not getting killed \r\n\r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\nThey should be killed if are found idle in 20 mins\r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\nAll mentioned settings have been implemented but does not work at all.\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\nI am attaching the config file snap, you can start jupyterhub with this config and reproduce the issue\r\n### Your personal set up\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\nWe have jupyterhub  installed using python 3.6.10 pip . jupyterhub version is 1.1.0 , jupyterhub-idle-culler version 1.1\r\n - OS:\r\n <!-- [e.g. ubuntu 20.04, macOS 11.0] -->\r\nRHEL 7\r\n - Version(s):\r\n <!-- e.g. jupyterhub --version, python --version --->\r\njupyterhub version is 1.1.0 , jupyterhub-idle-culler version 1.1\r\n\r\n- <details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\n# paste output of `pip freeze` or `conda list` here\r\n```\r\n</details>\r\n\r\n- <details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```python\r\n# jupyterhub_config.py\r\n```\r\n</details>\r\n\r\n- <details><summary>Logs</summary>\r\n<!--\r\nErrors are often logged by jupytehub. How you get logs depends on your deployment.\r\nWith kubernetes it might be:\r\n\r\n    kubectl get pod # hub pod name starts with hub...\r\n    kubectl logs hub-...\r\n    # or for a single-user server\r\n    kubectl logs jupyter-username\r\n\r\nOr the-littlest-jupyterhub:\r\n\r\n    journalctl -u jupyterhub\r\n    # or for a single-user server\r\n    journalctl -u jupyter-username\r\n-->\r\n\r\n```\r\n# paste relevant logs here, if any\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3549/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3549/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3543", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3543/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3543/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3543/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3543", "id": 948068520, "node_id": "MDExOlB1bGxSZXF1ZXN0NjkyOTU5NzE2", "number": 3543, "title": "Avoid zombie processes in case of using LocalProcessSpawner", "user": {"login": "dolfinus", "id": 4661021, "node_id": "MDQ6VXNlcjQ2NjEwMjE=", "avatar_url": "https://avatars.githubusercontent.com/u/4661021?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dolfinus", "html_url": "https://github.com/dolfinus", "followers_url": "https://api.github.com/users/dolfinus/followers", "following_url": "https://api.github.com/users/dolfinus/following{/other_user}", "gists_url": "https://api.github.com/users/dolfinus/gists{/gist_id}", "starred_url": "https://api.github.com/users/dolfinus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dolfinus/subscriptions", "organizations_url": "https://api.github.com/users/dolfinus/orgs", "repos_url": "https://api.github.com/users/dolfinus/repos", "events_url": "https://api.github.com/users/dolfinus/events{/privacy}", "received_events_url": "https://api.github.com/users/dolfinus/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2021-07-19T22:12:51Z", "updated_at": "2021-10-27T14:09:39Z", "closed_at": "2021-08-23T09:06:26Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3543", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3543", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3543.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3543.patch", "merged_at": "2021-08-23T09:06:26Z"}, "body": "Hi.\r\n\r\nI've faced with an issue using custom spawner class based on LocalSpawner - after child process has been stopped it become zombie:\r\n```\r\ndolfinus 32746  0.0  0.0      0     0 ?        Z    Jul16   0:00 [ssh] <defunct>\r\n```\r\n\r\nThis is because child is sending SIGCHILD to the parent process, but it is necessary to call `proc.wait()` method to handle it properly. Otherwise it will become a zombie which cannot be killed.\r\n\r\nSo I've wrapped the `.poll()` method call using `with` block. In Python 3+ Popen class does have `__exit__` method which is calling `.wait()` along with other useful cleanup stages, like closing `stdout` and `stderr` file descriptors.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3543/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3543/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3540", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3540/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3540/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3540/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3540", "id": 946343522, "node_id": "MDU6SXNzdWU5NDYzNDM1MjI=", "number": 3540, "title": "admin shutdown panel does not shutdown proxy/servers", "user": {"login": "rvalieris", "id": 6310472, "node_id": "MDQ6VXNlcjYzMTA0NzI=", "avatar_url": "https://avatars.githubusercontent.com/u/6310472?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rvalieris", "html_url": "https://github.com/rvalieris", "followers_url": "https://api.github.com/users/rvalieris/followers", "following_url": "https://api.github.com/users/rvalieris/following{/other_user}", "gists_url": "https://api.github.com/users/rvalieris/gists{/gist_id}", "starred_url": "https://api.github.com/users/rvalieris/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rvalieris/subscriptions", "organizations_url": "https://api.github.com/users/rvalieris/orgs", "repos_url": "https://api.github.com/users/rvalieris/repos", "events_url": "https://api.github.com/users/rvalieris/events{/privacy}", "received_events_url": "https://api.github.com/users/rvalieris/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-07-16T14:25:58Z", "updated_at": "2022-05-22T15:12:02Z", "closed_at": "2022-05-22T15:12:01Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\njupyterhub does not shutdown the proxy/servers as requested from the admin panel. \r\nthis might be related to https://github.com/jupyterhub/jupyterhub/issues/3297\r\n\r\n#### Expected behaviour\r\nproxy and servers are killed with jupyterhub\r\n\r\n#### Actual behaviour\r\nonly jupyterhub stops, the proxy and servers keep running.\r\n\r\nlog:\r\n```\r\nERROR:asyncio:Task was destroyed but it is pending!\r\ntask: <Task pending name='Task-30' coro=<HTTP1ServerConnection._server_request_loop() running at /home/fox/conda/envs/jupyter/lib/python3.9/site-packages/tornado/http1connection.py:840> cb=[IOLoop.add_future.<locals>.<lambda>() at /home/fox/conda/envs/jupyter/lib/python3.9/site-packages/tornado/ioloop.py:688]>\r\n```\r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\nfrom the admin panel -> Shutdown Hub -> check proxy and servers -> shutdown\r\nverify that the proxy and jupyter servers are still running\r\n\r\n### Your personal set up\r\n\r\njupyterhub 1.4.1\r\npython 3.9\r\nlinux\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3540/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3540/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3533", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3533/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3533/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3533/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3533", "id": 933441026, "node_id": "MDU6SXNzdWU5MzM0NDEwMjY=", "number": 3533, "title": "After updating JupyterHub 0.8.1 to 1.3.0.Not able to spawn docker images with network name as \"host\" in jupyterhub_config.py.", "user": {"login": "GowthamGoud", "id": 22973190, "node_id": "MDQ6VXNlcjIyOTczMTkw", "avatar_url": "https://avatars.githubusercontent.com/u/22973190?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GowthamGoud", "html_url": "https://github.com/GowthamGoud", "followers_url": "https://api.github.com/users/GowthamGoud/followers", "following_url": "https://api.github.com/users/GowthamGoud/following{/other_user}", "gists_url": "https://api.github.com/users/GowthamGoud/gists{/gist_id}", "starred_url": "https://api.github.com/users/GowthamGoud/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GowthamGoud/subscriptions", "organizations_url": "https://api.github.com/users/GowthamGoud/orgs", "repos_url": "https://api.github.com/users/GowthamGoud/repos", "events_url": "https://api.github.com/users/GowthamGoud/events{/privacy}", "received_events_url": "https://api.github.com/users/GowthamGoud/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-06-30T08:30:20Z", "updated_at": "2021-06-30T09:08:53Z", "closed_at": "2021-06-30T08:36:22Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly nd concisely describe the bug. -->\r\nWe were installing jupyterhub 0.8.1 with network type in jupyter_config.py file as \"host\". With this we are able to spawn docker images properly .But when I update the jupyterhub version to 1.3.0 with network type as \"host\" in jupyterhub_config.py. We are not able to spawn docker images.   \r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\nDocker images created should spawn without issues with network type as \"host\" with jupyterhub version :1.3.0.\r\nLet us know if any configuration needs to corrected to make docker images spawn properly in jupyterhub.\r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\nDocker images created failing to spawn with network type as \"host\" with jupyterhub version :1.3.0.\r\n**Exception faced when network type used is \"host\": ** The 'ip' trait of a Server instance expected a unicode string, not the NoneType None.\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\nInstall jupyterhub version 1.3.0 with network type as \"host\" and docker image with notebook kernel.\r\nStart jupyter notebook\r\nTry to spawn the image.\r\nGetting below error:\r\nError: HTTP 500: Internal Server Error (Error in Authenticator.pre_spawn_start: TraitError The 'ip' trait of a Server instance expected a unicode string, not the NoneType None.)\r\n\r\n![image](https://user-images.githubusercontent.com/22973190/123926200-47121580-d9a9-11eb-8e04-ca8d6630c7d5.png)\r\n\r\n\r\nbut when I change network type as \"bridge\" in jupyterhub_config.py then i am able to successfully spawn images But we need the network type as \"host\" as we having dependency on host network type for creating spark session in docker images. \r\n\r\n1. Go to '...'\r\n2. Click on '....'\r\n3. Scroll down to '....'\r\n4. See error\r\n\r\n### Your personal set up\r\nAttaching jupyterhub_config.py file:\r\n\r\n\r\n\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n\r\n - OS:\r\n <!-- [e.g. ubuntu 20.04, macOS 11.0] -->\r\n - Version(s):\r\n <!-- e.g. jupyterhub --version, python --version --->\r\n\r\n- <details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\n# paste output of `pip freeze` or `conda list` here\r\n```\r\n</details>\r\n\r\n- <details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```python\r\n# jupyterhub_config.py \r\n\r\n\r\n\r\n\r\nimport os\r\nimport socket\r\n\r\nc.PAMAuthenticator.open_sessions = False\r\n# Configuration file for jupyterhub.\r\nc.JupyterHub.pid_file = '/OpenText/miniconda3/envs/jupyterhub/etc/jupyterhub.pid'\r\nc.JupyterHub.logo_file = '/OpenText/miniconda3/envs/jupyterhub/share/jupyter/hub/static/images/magellan_logo.png'\r\nos.environ['OTDS_URL'] = 'http://inhyd-mag211-otds-launchpad.otxlab.net:8080'\r\nc.Juyterhub.base_url = '/'\r\nc.LocalOTDSOAuthenticator.login_service = 'OpenText Directory Service'\r\nc.JupyterHub.cookie_secret_file = '/OpenText/miniconda3/envs/jupyterhub/etc/jupyterhub_cookie_secret'\r\nc.JupyterHub.db_url = '/OpenText/miniconda3/envs/jupyterhub/etc/jupyterhub.sqlite'\r\n# In order to activate OTDS integration, uncomment the below line\r\nc.JupyterHub.authenticator_class = 'oauthenticator.LocalOTDSOAuthenticator'\r\n# To enable kerberos authentication in jupyterhub uncomment below line\r\nc.LocalOTDSOAuthenticator.client_id = 'notebook_175' \r\nc.LocalOTDSOAuthenticator.client_secret = 'vomSAHty68e98Y6FO2iOqVVz33t8odY7'\r\nc.LocalOTDSOAuthenticator.username_key = 'name'\r\nc.LocalOTDSOAuthenticator.callback_logout_url = 'http://10.96.94.175:8000/hub/login'\r\nc.LocalOTDSOAuthenticator.oauth_callback_url = 'http://10.96.94.175:8000/hub/oauth_callback'\r\nc.LocalOTDSOAuthenticator.resource_id = \"231ecd3a-40b6-4d8d-a5f0-c8d85b5f2993\"\r\nc.LocalOTDSOAuthenticator.resource_name = \"m4_demo_notebook\"\r\nc.Authenticator.admin_users = {\"magellan\"}\r\nc.JupyterHub.proxy_api_ip = '0.0.0.0'\r\nc.JupyterHub.hub_port = 8090\r\nnotebook_dir = '/home/jupyter/work'\r\nc.DockerSpawner.notebook_dir = notebook_dir\r\n\r\nc.JupyterHub.log_level = 'DEBUG'\r\n\r\n# Enable debug-logging of the single-user server\r\nc.Spawner.debug = True\r\n\r\n# Enable debug-logging of the single-user server\r\nc.LocalProcessSpawner.debug = False\r\n\r\n# pass the maprticket file name here\r\nMAPR_TICKET_FILE_PATH = ''\r\nmaprticket = \"NO FILE FOUND\"\r\nif os.path.isfile(MAPR_TICKET_FILE_PATH) and os.access(MAPR_TICKET_FILE_PATH, os.R_OK):\r\n  f = open(MAPR_TICKET_FILE_PATH, \"r\")\r\n  maprticket = f.read()\r\nelse:\r\n  print (\"Either the file is missing or not readable\")\r\n\r\n# in prod environment bda and spark master url are set in Ambari service\r\nc.JupyterHub.spawner_class = 'dockerspawner.DockerSpawner'\r\nc.DockerSpawner.environment = {'ELECTRON_URL':'http://10.96.209.56:8110/',\r\n                              'PUBLISH_MODEL':'https://10.96.94.175:8081/publish/modelPublish',\r\n                              'CLIENT_ID': 'notebook_client_175',\r\n                              'CLIENT_SECRET':'vomSAHty68e98Y6FO2iOqVVz33t8odY7',\r\n                              'SPARK_HOST':'10.96.94.156',\r\n                              'RESOURCE_MANAGER_ADDRESS':'10.96.94.156:8032',\r\n                              'HISTORY_LOG_DIRECTORY':'hdfs://clouderamaster631.lab.opentext.com:8020/user/spark/applicationHistory',\r\n                              'HISTORY_SERVER_ADDRESS':'10.96.94.156:18088',\r\n                              'PYSPARK_PYTHON':'/opt/miniconda2/envs/python3/bin/python',\r\n                              'DRIVER_MEMORY' :'4g',\r\n                              'MAPR_TICKET_FILE':maprticket,\r\n                              'RESOURCE_MANAGER_HOST':'{10.96.94.156}',\r\n                              'GIT_USER_REPO':notebook_dir,\r\n                              'DOMAIN_NAME':'opentext.com',\r\n                              'LIVY_SERVER':'http://10.96.94.89:8998/',\r\n                              'SPARKMAGIC_IGNORE_SSL_ERRORS':'false',\r\n                              'PUBLISH_TO_RESTAPI':'true',\r\n                              'EXTRA_SPARK_ARGS':'--num-executors 40 --executor-cores 2 --executor-memory 2GB --conf spark.dynamicAllocation.minExecutors=1 --conf spark.dynamicAllocation.maxExecutors=40 --conf spark.dynamicAllocation.enabled=true --conf spark.shuffle.service.enabled=true --conf spark.executor.instances=2' #Include here any custom spark required parameter e.g. --conf spark.executor.instances=4\r\n                              }\r\n\r\nc.DockerSpawner.volumes = {'/OpenText/notebooks/{username}': notebook_dir, }\r\n\r\nc.DockerSpawner.remove_containers = True\r\n\r\nc.DockerSpawner.extra_host_config = {'network_mode': 'host'}\r\nc.DockerSpawner.use_internal_ip = True\r\nc.DockerSpawner.network_name = 'host'\r\n\r\nDISTRIBUTION='DISTRIBUTION_NAME'\r\nif DISTRIBUTION == 'mapr':\r\n    c.newDockerSpawner .images = {'images':[{'name':'magellan-notebook-base', 'description':'Python 3'},\r\n                                           {'name':'magellan-notebook', 'description':'Spark kernels (Pyspark, Scala, SparkSQL)'},\r\n                                           {'name':'magellan-notebook-tensorflow', 'description':'TensorFlow 2.5.0'},\r\n                                           {'name':'magellan-notebook-pytorch', 'description':'PyTorch 1.5'}\r\n                                           ]}\r\nelse:\r\n    c.newDockerSpawner .images = {'images':[{'name':'magellan-notebook-base', 'description':'Python 3'},\r\n                                           {'name':'magellan-notebook', 'description':'Spark kernels (Pyspark, Scala, SparkSQL)'},\r\n                                           {'name':'magellan-notebook-tensorflow', 'description':'TensorFlow 2.5.0'},\r\n                                           {'name':'magellan-notebook-pytorch', 'description':'PyTorch 1.5'},\r\n                                           {'name':'magellan-notebook-sparkmagic', 'description':'Spark Magic'}\r\n                                           ]}\r\n\r\nc.newDockerSpawner .memoryLimit = \"4G\"\r\nc.newDockerSpawner .cpuLimit = \"2\"\r\n\r\nc.JupyterHub.spawner_class = 'dockerspawner.newDockerSpawner '\r\n\r\nimport netifaces\r\ndocker0 = netifaces.ifaddresses('docker0')\r\ndocker0_ipv4 = docker0[netifaces.AF_INET][0]\r\nc.JupyterHub.hub_ip = docker0_ipv4['addr']\r\n\r\nfrom jupyterhub.utils import random_port\r\nimport subprocess\r\nimport os\r\nNOTEBOOK_SERVICE_UID = 1000\r\ndef create_dir_hook(spawner):\r\n    spawner.environment['NB_USER'] = 'jupyter' # get system user\r\n    spawned_user = spawner.user.name # get the spawned user\r\n    spawner.environment['ACCESS_TOKEN'] = os.getenv(spawned_user+\"_accesstoken\")\r\n    spawner.environment['REFRESH_TOKEN'] = os.getenv(spawned_user+\"_refreshtoken\")\r\n    spawner.environment['OTDS_URL'] = os.getenv(\"OTDS_URL\")\r\n    submit_job_as_single_user='True'\r\n    if(submit_job_as_single_user.lower() == 'false'):\r\n      if(spawner.image=='magellan-notebook' or spawner.image=='magellan-notebook-sparkmagic' ):\r\n        spawner.environment['NB_USER'] = spawned_user # get the spawned user\r\n    volume_path = os.path.join('/OpenText/notebooks', spawned_user)\r\n    uid = NOTEBOOK_SERVICE_UID\r\n    spawner.port = random_port()\r\n    if not os.path.exists(volume_path):\r\n        # create a directory with umask 0755 \r\n        # hub and container user must have the same UID to be writeable\r\n        # still readable by other users on the system\r\n        os.makedirs(volume_path, 0o755)\r\n        #subprocess.Popen (\"git init\" , shell=True , cwd=volume_path).communicate()\r\n        pass\r\n    # the user folder should be owner by the user configured in the docker container\r\n    # if not, the end user will be not able to create any notebook\r\n    os.chown(volume_path, uid, uid)\r\n\r\n\r\n# attach the hook function to the spawner\r\nc.Spawner.pre_spawn_hook = create_dir_hook\r\nc.DockerSpawner.debug = True\r\n\r\n\r\n\r\n```\r\n</details>\r\n\r\n- <details><summary>Logs</summary>\r\n<!--\r\nErrors are often logged by jupytehub. How you get logs depends on your deployment.\r\nWith kubernetes it might be:\r\n\r\n    kubectl get pod # hub pod name starts with hub...\r\n    kubectl logs hub-...\r\n    # or for a single-user server\r\n    kubectl logs jupyter-username\r\n\r\nOr the-littlest-jupyterhub:\r\n\r\n    journalctl -u jupyterhub\r\n    # or for a single-user server\r\n    journalctl -u jupyter-username\r\n-->\r\n\r\n```\r\n# paste relevant logs here, if any\r\n\r\nUnhandled error starting mnbuser's server: The 'ip' trait of a Server instance expected a unicode string, not the NoneType None.\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3533/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3533/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3531", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3531/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3531/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3531/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3531", "id": 933017881, "node_id": "MDExOlB1bGxSZXF1ZXN0NjgwMjg5NzU2", "number": 3531, "title": "Fix regression where external services api_token became required", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-06-29T18:58:26Z", "updated_at": "2021-07-02T10:27:16Z", "closed_at": "2021-07-02T06:31:56Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3531", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3531", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3531.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3531.patch", "merged_at": "2021-07-02T06:31:56Z"}, "body": "### Issue background\r\n\r\nRegistering an external service means it won't be run as a process by JupyterHub or similar as I understand it, and such external services may be registered only to get a /services/<service_name> route registered with JupyterHub's configured proxy rather than to actually use an api_token and speak with JupyterHub.\r\n\r\nIn the past, it was okay for a external service without an api_token to be registered, but not it isn't. This PR fixes that.\r\n\r\nThe situation when I run into this is when I register grafana as an external service like this (but in reality via a z2jh config with slightly different syntax).\r\n\r\n```python\r\nc.JupyterHub.services = [\r\n    {\r\n        \"name\": \"grafana\",\r\n        \"url\": \"http://grafana\",\r\n    }\r\n]\r\n```\r\n\r\nJupyterHub has a [documentation about Services](https://jupyterhub.readthedocs.io/en/stable/reference/services.html#properties-of-a-service), where one can see that the default value of api_token is None.\r\n\r\n### Issue details\r\n\r\nThis is an error me and @GeorgianaElena have run into using JupyterHub 1.4.1, but I'm not sure at what point the regression was introduced besides it was around in 1.4.1.\r\n\r\nI wrote some notes tracking this issue down. This is the summary I wrote.\r\n\r\n```\r\n    This test was made to reproduce an error like this:\r\n\r\n        ValueError: Tokens must be at least 8 characters, got ''\r\n\r\n    The error had the following stack trace in 1.4.1:\r\n\r\n        jupyterhub/app.py:2213: in init_api_tokens\r\n            await self._add_tokens(self.service_tokens, kind='service')\r\n        jupyterhub/app.py:2182: in _add_tokens\r\n            obj.new_api_token(\r\n        jupyterhub/orm.py:424: in new_api_token\r\n            return APIToken.new(token=token, service=self, **kwargs)\r\n        jupyterhub/orm.py:699: in new\r\n            cls.check_token(db, token)\r\n\r\n    This test also make _add_tokens receive a token_dict that is buggy:\r\n\r\n        {\"\": \"external_2\"}\r\n\r\n    It turned out that whatever passes token_dict to _add_tokens failed to\r\n    ignore service's api_tokens that were None, and instead passes them as blank\r\n    strings.\r\n\r\n    It turned out that init_api_tokens was passing self.service_tokens, and that\r\n    self.service_tokens had been populated with blank string tokens for external\r\n    services registered with JupyterHub.\r\n```", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3531/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3531/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3526", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3526/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3526/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3526/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3526", "id": 928551945, "node_id": "MDExOlB1bGxSZXF1ZXN0Njc2NTQwMDE0", "number": 3526, "title": "Fix allow_all check when only allow_admin is set", "user": {"login": "dolfinus", "id": 4661021, "node_id": "MDQ6VXNlcjQ2NjEwMjE=", "avatar_url": "https://avatars.githubusercontent.com/u/4661021?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dolfinus", "html_url": "https://github.com/dolfinus", "followers_url": "https://api.github.com/users/dolfinus/followers", "following_url": "https://api.github.com/users/dolfinus/following{/other_user}", "gists_url": "https://api.github.com/users/dolfinus/gists{/gist_id}", "starred_url": "https://api.github.com/users/dolfinus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dolfinus/subscriptions", "organizations_url": "https://api.github.com/users/dolfinus/orgs", "repos_url": "https://api.github.com/users/dolfinus/repos", "events_url": "https://api.github.com/users/dolfinus/events{/privacy}", "received_events_url": "https://api.github.com/users/dolfinus/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-06-23T18:58:27Z", "updated_at": "2021-10-27T14:09:51Z", "closed_at": "2021-08-03T09:01:43Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3526", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3526", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3526.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3526.patch", "merged_at": "2021-08-03T09:01:43Z"}, "body": "Hello.\r\n\r\nI've found quite a strange behavior of `HubAuthenticated` mixin.\r\n\r\nFor example, I need a service which could be accessed by admin users only. I've changed `allow_admin=True`, but just nothing happened - non-admin users still have an access but they should not.\r\n\r\nBut it works well if you've changed some variable from a list below:\r\n* `hub_users`\r\n* `hub_groups`\r\n* `hub_services`\r\n\r\nI've added `allow_admin` field to `allow_all` check to fix that behavior.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3526/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3526/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3503", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3503/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3503/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3503/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3503", "id": 917540152, "node_id": "MDU6SXNzdWU5MTc1NDAxNTI=", "number": 3503, "title": "{username} does not expand for service_account", "user": {"login": "reganmcdonald", "id": 79462844, "node_id": "MDQ6VXNlcjc5NDYyODQ0", "avatar_url": "https://avatars.githubusercontent.com/u/79462844?v=4", "gravatar_id": "", "url": "https://api.github.com/users/reganmcdonald", "html_url": "https://github.com/reganmcdonald", "followers_url": "https://api.github.com/users/reganmcdonald/followers", "following_url": "https://api.github.com/users/reganmcdonald/following{/other_user}", "gists_url": "https://api.github.com/users/reganmcdonald/gists{/gist_id}", "starred_url": "https://api.github.com/users/reganmcdonald/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/reganmcdonald/subscriptions", "organizations_url": "https://api.github.com/users/reganmcdonald/orgs", "repos_url": "https://api.github.com/users/reganmcdonald/repos", "events_url": "https://api.github.com/users/reganmcdonald/events{/privacy}", "received_events_url": "https://api.github.com/users/reganmcdonald/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-06-10T16:19:42Z", "updated_at": "2021-06-10T16:55:27Z", "closed_at": "2021-06-10T16:55:27Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\nI am attempting to dynamically assign services accounts to singleuser pods based on the username.\r\n\r\n#### Expected behaviour\r\nc.KubeSpawner.service_account('user-{username}') results in c.KubeSpawner.service_account('user-myusername')\r\n\r\n#### Actual behaviour\r\nserviceaccount \\\"user-{username}\\\" not found\"\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3503/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3503/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3484", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3484/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3484/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3484/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3484", "id": 906493654, "node_id": "MDExOlB1bGxSZXF1ZXN0NjU3NDg0ODY0", "number": 3484, "title": "Bug: save_bearer_token (provider.py) passes a float value to the expires_at field (int)", "user": {"login": "weisdd", "id": 46579601, "node_id": "MDQ6VXNlcjQ2NTc5NjAx", "avatar_url": "https://avatars.githubusercontent.com/u/46579601?v=4", "gravatar_id": "", "url": "https://api.github.com/users/weisdd", "html_url": "https://github.com/weisdd", "followers_url": "https://api.github.com/users/weisdd/followers", "following_url": "https://api.github.com/users/weisdd/following{/other_user}", "gists_url": "https://api.github.com/users/weisdd/gists{/gist_id}", "starred_url": "https://api.github.com/users/weisdd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/weisdd/subscriptions", "organizations_url": "https://api.github.com/users/weisdd/orgs", "repos_url": "https://api.github.com/users/weisdd/repos", "events_url": "https://api.github.com/users/weisdd/events{/privacy}", "received_events_url": "https://api.github.com/users/weisdd/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2021-05-29T15:12:00Z", "updated_at": "2021-07-15T08:08:11Z", "closed_at": "2021-06-02T07:01:45Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3484", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3484", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3484.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3484.patch", "merged_at": "2021-06-02T07:01:45Z"}, "body": "**Environment**\r\n\r\n* image: k8s-hub (`jupyterhub/k8s-hub:0.11.1`);\r\n* `authenticator_class: dummy`;\r\n* db: cocroachdb (`sqlalchemy-cocroachdb`).\r\n\r\n**Description:**\r\n\r\n`save_bearer_token` method (`provider.py`) passes a float value to the `expires_at` field (int).\r\n\r\nA user can create a notebook, it gets successfully scheduled, and then, once the pod is up and ready, the user is unable to enter the notebook, because jupyterhub cannot save a token. In logs, we can see the following:\r\n\r\n```\r\n[I 2021-05-29 14:45:04.302 JupyterHub log:181] 302 GET /hub/api/oauth2/authorize?client_id=jupyterhub-user-user2&redirect_uri=%2Fuser%2Fuser2%2Foauth_callback&response_type=code&state=[secret] -> /user/user2/oauth_callback?code=[secret]&state=[secret] (user2@40.113.125.116) 73.98ms\r\n[E 2021-05-29 14:45:04.424 JupyterHub web:1789] Uncaught exception POST /hub/api/oauth2/token (10.42.80.10)\r\n    HTTPServerRequest(protocol='http', host='hub:8081', method='POST', uri='/hub/api/oauth2/token', version='HTTP/1.1', remote_ip='10.42.80.10')\r\n    Traceback (most recent call last):\r\n      File \"/usr/local/lib/python3.8/dist-packages/tornado/web.py\", line 1702, in _execute\r\n        result = method(*self.path_args, **self.path_kwargs)\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/apihandlers/auth.py\", line 324, in post\r\n        headers, body, status = self.oauth_provider.create_token_response(\r\n      File \"/usr/local/lib/python3.8/dist-packages/oauthlib/oauth2/rfc6749/endpoints/base.py\", line 116, in wrapper\r\n        return f(endpoint, uri, *args, **kwargs)\r\n      File \"/usr/local/lib/python3.8/dist-packages/oauthlib/oauth2/rfc6749/endpoints/token.py\", line 118, in create_token_response\r\n        return grant_type_handler.create_token_response(\r\n      File \"/usr/local/lib/python3.8/dist-packages/oauthlib/oauth2/rfc6749/grant_types/authorization_code.py\", line 313, in create_token_response\r\n        self.request_validator.save_token(token, request)\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/oauth/provider.py\", line 281, in save_token\r\n        return self.save_bearer_token(token, request, *args, **kwargs)\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/oauth/provider.py\", line 354, in save_bearer_token\r\n        self.db.commit()\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/orm/session.py\", line 1042, in commit\r\n        self.transaction.commit()\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/orm/session.py\", line 504, in commit\r\n        self._prepare_impl()\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/orm/session.py\", line 483, in _prepare_impl\r\n        self.session.flush()\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/orm/session.py\", line 2536, in flush\r\n        self._flush(objects)\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/orm/session.py\", line 2678, in _flush\r\n        transaction.rollback(_capture_exception=True)\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/util/langhelpers.py\", line 68, in __exit__\r\n        compat.raise_(\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/util/compat.py\", line 182, in raise_\r\n        raise exception\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/orm/session.py\", line 2638, in _flush\r\n        flush_context.execute()\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/orm/unitofwork.py\", line 422, in execute\r\n        rec.execute(self)\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/orm/unitofwork.py\", line 586, in execute\r\n        persistence.save_obj(\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/orm/persistence.py\", line 239, in save_obj\r\n        _emit_insert_statements(\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/orm/persistence.py\", line 1135, in _emit_insert_statements\r\n        result = cached_connections[connection].execute(\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/engine/base.py\", line 1011, in execute\r\n        return meth(self, multiparams, params)\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/sql/elements.py\", line 298, in _execute_on_connection\r\n        return connection._execute_clauseelement(self, multiparams, params)\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/engine/base.py\", line 1124, in _execute_clauseelement\r\n        ret = self._execute_context(\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/engine/base.py\", line 1316, in _execute_context\r\n        self._handle_dbapi_exception(\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/engine/base.py\", line 1510, in _handle_dbapi_exception\r\n        util.raise_(\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/util/compat.py\", line 182, in raise_\r\n        raise exception\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/engine/base.py\", line 1276, in _execute_context\r\n        self.dialect.do_execute(\r\n      File \"/usr/local/lib/python3.8/dist-packages/sqlalchemy/engine/default.py\", line 593, in do_execute\r\n        cursor.execute(statement, parameters)\r\n    sqlalchemy.exc.ProgrammingError: (psycopg2.errors.DatatypeMismatch) value type decimal doesn't match type int of column \"expires_at\"\r\n    HINT:  you will need to rewrite or cast the expression\r\n    \r\n    [SQL: INSERT INTO oauth_access_tokens (client_id, grant_type, expires_at, refresh_token, refresh_expires_at, user_id, session_id, hashed, prefix, created, last_activity) VALUES (%(client_id)s, %(grant_type)s, %(expires_at)s, %(refresh_token)s, %(refresh_expires_at)s, %(user_id)s, %(session_id)s, %(hashed)s, %(prefix)s, %(created)s, %(last_activity)s) RETURNING oauth_access_tokens.id]\r\n    [parameters: {'client_id': 'jupyterhub-user-user2', 'grant_type': 'authorization_code', 'expires_at': 1622303104.418992, 'refresh_token': 'FVJ8S4is0367LlEMnxIiEIoTOeoxhf', 'refresh_expires_at': None, 'user_id': 662636890939424770, 'session_id': '4e041a2bfcb34a34a00033a281bc1236', 'hashed': 'sha512:1:3b18deae37fbf50a:03df035736960af14e19196e1d13fd74f55c21f17405119f80e75817ff37c7567fab089a3d40b97a57f94b54065ee56f7260895352516b9facb989d656f05be8', 'prefix': 't11z', 'created': datetime.datetime(2021, 5, 29, 14, 45, 4, 421305), 'last_activity': None}]\r\n    (Background on this error at: http://sqlalche.me/e/13/f405)\r\n    \r\n[W 2021-05-29 14:45:04.430 JupyterHub base:110] Rolling back session due to database error (psycopg2.errors.DatatypeMismatch) value type decimal doesn't match type int of column \"expires_at\"\r\n    HINT:  you will need to rewrite or cast the expression\r\n    \r\n    [SQL: INSERT INTO oauth_access_tokens (client_id, grant_type, expires_at, refresh_token, refresh_expires_at, user_id, session_id, hashed, prefix, created, last_activity) VALUES (%(client_id)s, %(grant_type)s, %(expires_at)s, %(refresh_token)s, %(refresh_expires_at)s, %(user_id)s, %(session_id)s, %(hashed)s, %(prefix)s, %(created)s, %(last_activity)s) RETURNING oauth_access_tokens.id]\r\n    [parameters: {'client_id': 'jupyterhub-user-user2', 'grant_type': 'authorization_code', 'expires_at': 1622303104.418992, 'refresh_token': 'FVJ8S4is0367LlEMnxIiEIoTOeoxhf', 'refresh_expires_at': None, 'user_id': 662636890939424770, 'session_id': '4e041a2bfcb34a34a00033a281bc1236', 'hashed': 'sha512:1:3b18deae37fbf50a:03df035736960af14e19196e1d13fd74f55c21f17405119f80e75817ff37c7567fab089a3d40b97a57f94b54065ee56f7260895352516b9facb989d656f05be8', 'prefix': 't11z', 'created': datetime.datetime(2021, 5, 29, 14, 45, 4, 421305), 'last_activity': None}]\r\n    (Background on this error at: http://sqlalche.me/e/13/f405)\r\n[E 2021-05-29 14:45:04.443 JupyterHub log:173] {\r\n      \"Host\": \"hub:8081\",\r\n      \"User-Agent\": \"python-requests/2.25.1\",\r\n      \"Accept-Encoding\": \"gzip, deflate\",\r\n      \"Accept\": \"*/*\",\r\n      \"Connection\": \"keep-alive\",\r\n      \"Content-Type\": \"application/x-www-form-urlencoded\",\r\n      \"Authorization\": \"token [secret]\",\r\n      \"Content-Length\": \"190\"\r\n    }\r\n[E 2021-05-29 14:45:04.444 JupyterHub log:181] 500 POST /hub/api/oauth2/token (user2@10.42.80.10) 63.28ms\r\n```\r\n\r\nEverything went well, when I changed:\r\n`expires_at=orm.OAuthAccessToken.now() + token['expires_in'],`\r\nto:\r\n`expires_at=int(orm.OAuthAccessToken.now() + token['expires_in']),`\r\nThat's what this PR is about.\r\n\r\nAs a sidenote, `black` formatter adjusted the `orm_client = orm.OAuthClient(identifier=client_id,)` line, but I guess it should be fine. Please, feel free to revert this change if needed.\r\n\r\n(Upd): added the missing `int` conversion.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3484/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3484/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3472", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3472/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3472/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3472/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3472", "id": 895642044, "node_id": "MDU6SXNzdWU4OTU2NDIwNDQ=", "number": 3472, "title": "[rbac] Group roles in user model role list", "user": {"login": "IvanaH8", "id": 12073028, "node_id": "MDQ6VXNlcjEyMDczMDI4", "avatar_url": "https://avatars.githubusercontent.com/u/12073028?v=4", "gravatar_id": "", "url": "https://api.github.com/users/IvanaH8", "html_url": "https://github.com/IvanaH8", "followers_url": "https://api.github.com/users/IvanaH8/followers", "following_url": "https://api.github.com/users/IvanaH8/following{/other_user}", "gists_url": "https://api.github.com/users/IvanaH8/gists{/gist_id}", "starred_url": "https://api.github.com/users/IvanaH8/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/IvanaH8/subscriptions", "organizations_url": "https://api.github.com/users/IvanaH8/orgs", "repos_url": "https://api.github.com/users/IvanaH8/repos", "events_url": "https://api.github.com/users/IvanaH8/events{/privacy}", "received_events_url": "https://api.github.com/users/IvanaH8/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "0mar", "id": 8081279, "node_id": "MDQ6VXNlcjgwODEyNzk=", "avatar_url": "https://avatars.githubusercontent.com/u/8081279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/0mar", "html_url": "https://github.com/0mar", "followers_url": "https://api.github.com/users/0mar/followers", "following_url": "https://api.github.com/users/0mar/following{/other_user}", "gists_url": "https://api.github.com/users/0mar/gists{/gist_id}", "starred_url": "https://api.github.com/users/0mar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/0mar/subscriptions", "organizations_url": "https://api.github.com/users/0mar/orgs", "repos_url": "https://api.github.com/users/0mar/repos", "events_url": "https://api.github.com/users/0mar/events{/privacy}", "received_events_url": "https://api.github.com/users/0mar/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "0mar", "id": 8081279, "node_id": "MDQ6VXNlcjgwODEyNzk=", "avatar_url": "https://avatars.githubusercontent.com/u/8081279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/0mar", "html_url": "https://github.com/0mar", "followers_url": "https://api.github.com/users/0mar/followers", "following_url": "https://api.github.com/users/0mar/following{/other_user}", "gists_url": "https://api.github.com/users/0mar/gists{/gist_id}", "starred_url": "https://api.github.com/users/0mar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/0mar/subscriptions", "organizations_url": "https://api.github.com/users/0mar/orgs", "repos_url": "https://api.github.com/users/0mar/repos", "events_url": "https://api.github.com/users/0mar/events{/privacy}", "received_events_url": "https://api.github.com/users/0mar/received_events", "type": "User", "site_admin": false}, {"login": "IvanaH8", "id": 12073028, "node_id": "MDQ6VXNlcjEyMDczMDI4", "avatar_url": "https://avatars.githubusercontent.com/u/12073028?v=4", "gravatar_id": "", "url": "https://api.github.com/users/IvanaH8", "html_url": "https://github.com/IvanaH8", "followers_url": "https://api.github.com/users/IvanaH8/followers", "following_url": "https://api.github.com/users/IvanaH8/following{/other_user}", "gists_url": "https://api.github.com/users/IvanaH8/gists{/gist_id}", "starred_url": "https://api.github.com/users/IvanaH8/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/IvanaH8/subscriptions", "organizations_url": "https://api.github.com/users/IvanaH8/orgs", "repos_url": "https://api.github.com/users/IvanaH8/repos", "events_url": "https://api.github.com/users/IvanaH8/events{/privacy}", "received_events_url": "https://api.github.com/users/IvanaH8/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 9, "created_at": "2021-05-19T16:20:48Z", "updated_at": "2021-05-25T11:35:26Z", "closed_at": "2021-05-25T11:35:26Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\nOccurs when a user is a member of a group which has a role. The group role is added to the user's role list (and multiplies) every time the user makes an API request, i.e., after 3 requests the user's model will show the group role in the user's role list 3 times. \r\n\r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\nThe user's own roles should not include any group roles. These are only used to extend the user's privileges during API requests but the users themselves are not bearers of their group roles.  \r\n \r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\nAs mentioned above, a user's group role is added to the user's roles every time they make a request.  \r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n1. Create a user (either with or without specific roles)\r\n2. Create a group and assign it some role\r\n3. Add the user to the group\r\n4. Issue an API token for the user\r\n5. Make few API requests using the user's token\r\n6. Check the user's model which will show the group's role in the user's role list as many times as performed API requests \r\n\r\n### Your personal set up\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\nDevelopment install\r\n - OS:\r\n <!-- [e.g. ubuntu 20.04, macOS 11.0] -->\r\n ubuntu 20.04\r\n - Version(s):\r\n <!-- e.g. jupyterhub --version, python --version --->\r\njupyterhub 2.0.0.dev, python 3.8.5\r\n- <details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\n# Name                    Version                   Build  Channel\r\n_libgcc_mutex             0.1                        main  \r\nalabaster                 0.7.12                   pypi_0    pypi\r\nalabaster-jupyterhub      0.1.8                    pypi_0    pypi\r\nalembic                   1.4.3                    pypi_0    pypi\r\nappdirs                   1.4.4                    pypi_0    pypi\r\nargon2-cffi               20.1.0                   pypi_0    pypi\r\nasync-generator           1.10                     pypi_0    pypi\r\nattrs                     20.3.0                   pypi_0    pypi\r\nautodoc-traits            0.1.0.dev0               pypi_0    pypi\r\nbabel                     2.9.0                    pypi_0    pypi\r\nbackcall                  0.2.0                    pypi_0    pypi\r\nbeautifulsoup4            4.9.3                    pypi_0    pypi\r\nbleach                    3.2.1                    pypi_0    pypi\r\nbrotlipy                  0.7.0           py38h27cfd23_1003  \r\nca-certificates           2021.4.13            h06a4308_1  \r\ncertifi                   2020.12.5        py38h06a4308_0  \r\ncertipy                   0.1.3                    pypi_0    pypi\r\ncffi                      1.14.5           py38h261ae71_0  \r\ncfgv                      3.2.0                    pypi_0    pypi\r\nchardet                   4.0.0           py38h06a4308_1003  \r\ncodecov                   2.1.10                   pypi_0    pypi\r\ncommonmark                0.9.1                    pypi_0    pypi\r\nconda                     4.10.0           py38h06a4308_0  \r\nconda-package-handling    1.7.3            py38h27cfd23_1  \r\ncoverage                  5.3                      pypi_0    pypi\r\ncryptography              3.4.7            py38hd23ed53_0  \r\ndataproperty              0.50.0                   pypi_0    pypi\r\ndecorator                 4.4.2                    pypi_0    pypi\r\ndefusedxml                0.6.0                    pypi_0    pypi\r\ndistlib                   0.3.1                    pypi_0    pypi\r\ndocutils                  0.16                     pypi_0    pypi\r\nentrypoints               0.3                      pypi_0    pypi\r\nfilelock                  3.0.12                   pypi_0    pypi\r\nhtml5lib                  1.1                      pypi_0    pypi\r\nidentify                  1.5.10                   pypi_0    pypi\r\nidna                      2.10               pyhd3eb1b0_0  \r\nimagesize                 1.2.0                    pypi_0    pypi\r\niniconfig                 1.1.1                    pypi_0    pypi\r\nipykernel                 5.4.2                    pypi_0    pypi\r\nipython                   7.19.0                   pypi_0    pypi\r\nipython-genutils          0.2.0                    pypi_0    pypi\r\njedi                      0.17.2                   pypi_0    pypi\r\njinja2                    2.11.2                   pypi_0    pypi\r\njsonpointer               2.0                      pypi_0    pypi\r\njsonschema                3.2.0                    pypi_0    pypi\r\njupyter-client            6.1.7                    pypi_0    pypi\r\njupyter-core              4.7.0                    pypi_0    pypi\r\njupyter-telemetry         0.1.0                    pypi_0    pypi\r\njupyterhub                1.4.0.dev0                dev_0    <develop>\r\njupyterlab-pygments       0.1.2                    pypi_0    pypi\r\nld_impl_linux-64          2.33.1               h53a641e_7  \r\nlibffi                    3.3                  he6710b0_2  \r\nlibgcc-ng                 9.1.0                hdf63c60_0  \r\nlibstdcxx-ng              9.1.0                hdf63c60_0  \r\nmako                      1.1.3                    pypi_0    pypi\r\nmarkdown-it-py            0.6.2                    pypi_0    pypi\r\nmarkupsafe                1.1.1                    pypi_0    pypi\r\nmbstrdecoder              1.0.1                    pypi_0    pypi\r\nmdit-py-plugins           0.2.6                    pypi_0    pypi\r\nmistune                   0.8.4                    pypi_0    pypi\r\nmock                      4.0.3                    pypi_0    pypi\r\nmsgfy                     0.1.0                    pypi_0    pypi\r\nmyst-parser               0.13.5                   pypi_0    pypi\r\nnbclient                  0.5.1                    pypi_0    pypi\r\nnbconvert                 6.0.7                    pypi_0    pypi\r\nnbformat                  5.0.8                    pypi_0    pypi\r\nncurses                   6.2                  he6710b0_1  \r\nnest-asyncio              1.4.3                    pypi_0    pypi\r\nnodeenv                   1.5.0                    pypi_0    pypi\r\nnodejs                    10.13.0              he6710b0_0  \r\nnotebook                  6.1.5                    pypi_0    pypi\r\noauthlib                  3.1.0                    pypi_0    pypi\r\nopenssl                   1.1.1k               h27cfd23_0  \r\npackaging                 20.8                     pypi_0    pypi\r\npamela                    1.0.0                    pypi_0    pypi\r\npandocfilters             1.4.3                    pypi_0    pypi\r\nparso                     0.7.1                    pypi_0    pypi\r\npathvalidate              2.3.2                    pypi_0    pypi\r\npexpect                   4.8.0                    pypi_0    pypi\r\npickleshare               0.7.5                    pypi_0    pypi\r\npip                       21.0.1           py38h06a4308_0  \r\npluggy                    0.13.1                   pypi_0    pypi\r\npre-commit                2.9.3                    pypi_0    pypi\r\nprometheus-client         0.9.0                    pypi_0    pypi\r\nprompt-toolkit            3.0.8                    pypi_0    pypi\r\nptyprocess                0.6.0                    pypi_0    pypi\r\npy                        1.10.0                   pypi_0    pypi\r\npycosat                   0.6.3            py38h7b6447c_1  \r\npycparser                 2.20                       py_2  \r\npydata-sphinx-theme       0.4.1                    pypi_0    pypi\r\npygments                  2.7.3                    pypi_0    pypi\r\npyopenssl                 20.0.1             pyhd3eb1b0_1  \r\npyparsing                 2.4.7                    pypi_0    pypi\r\npyrsistent                0.17.3                   pypi_0    pypi\r\npysocks                   1.7.1            py38h06a4308_0  \r\npytablewriter             0.58.0                   pypi_0    pypi\r\npytest                    6.2.0                    pypi_0    pypi\r\npytest-asyncio            0.14.0                   pypi_0    pypi\r\npytest-cov                2.10.1                   pypi_0    pypi\r\npython                    3.8.5                h7579374_1  \r\npython-dateutil           2.8.1                    pypi_0    pypi\r\npython-editor             1.0.4                    pypi_0    pypi\r\npython-json-logger        2.0.1                    pypi_0    pypi\r\npytz                      2020.5                   pypi_0    pypi\r\npyyaml                    5.3.1                    pypi_0    pypi\r\npyzmq                     20.0.0                   pypi_0    pypi\r\nreadline                  8.1                  h27cfd23_0  \r\nrecommonmark              0.7.1                    pypi_0    pypi\r\nrequests                  2.25.1             pyhd3eb1b0_0  \r\nrequests-mock             1.8.0                    pypi_0    pypi\r\nruamel.yaml               0.16.12          py38h7b6447c_1  \r\nruamel.yaml.clib          0.2.2            py38h7b6447c_0  \r\nruamel_yaml               0.15.100         py38h27cfd23_0  \r\nsend2trash                1.5.0                    pypi_0    pypi\r\nsetuptools                52.0.0           py38h06a4308_0  \r\nsix                       1.15.0           py38h06a4308_0  \r\nsnowballstemmer           2.0.0                    pypi_0    pypi\r\nsoupsieve                 2.1                      pypi_0    pypi\r\nsphinx                    3.4.3                    pypi_0    pypi\r\nsphinx-copybutton         0.3.1                    pypi_0    pypi\r\nsphinx-jsonschema         1.16.7                   pypi_0    pypi\r\nsphinxcontrib-applehelp   1.0.2                    pypi_0    pypi\r\nsphinxcontrib-devhelp     1.0.2                    pypi_0    pypi\r\nsphinxcontrib-htmlhelp    1.0.3                    pypi_0    pypi\r\nsphinxcontrib-jsmath      1.0.1                    pypi_0    pypi\r\nsphinxcontrib-qthelp      1.0.3                    pypi_0    pypi\r\nsphinxcontrib-serializinghtml 1.1.4                    pypi_0    pypi\r\nsqlalchemy                1.3.20                   pypi_0    pypi\r\nsqlite                    3.35.4               hdfb4753_0  \r\ntabledata                 1.1.3                    pypi_0    pypi\r\ntcolorpy                  0.0.8                    pypi_0    pypi\r\nterminado                 0.9.1                    pypi_0    pypi\r\ntestpath                  0.4.4                    pypi_0    pypi\r\ntk                        8.6.10               hbc83047_0  \r\ntoml                      0.10.2                   pypi_0    pypi\r\ntornado                   6.1                      pypi_0    pypi\r\ntqdm                      4.59.0             pyhd3eb1b0_1  \r\ntraitlets                 5.0.5                    pypi_0    pypi\r\ntypepy                    1.1.2                    pypi_0    pypi\r\nurllib3                   1.26.4             pyhd3eb1b0_0  \r\nvirtualenv                20.2.2                   pypi_0    pypi\r\nwcwidth                   0.2.5                    pypi_0    pypi\r\nwebencodings              0.5.1                    pypi_0    pypi\r\nwheel                     0.36.2             pyhd3eb1b0_0  \r\nxz                        5.2.5                h7b6447c_0  \r\nyaml                      0.2.5                h7b6447c_0  \r\nzlib                      1.2.11               h7b6447c_3\r\n```\r\n</details>\r\n\r\n- <details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\nTesting:\r\n```python\r\nasync def test_user_model_roles(app, create_temp_role):\r\n    user = add_user(app.db, app, name='jack')\r\n    another_user = add_user(app.db, app, name='jill')\r\n    \r\n    group = orm.Group.find(app.db, name='A')\r\n    if not group:\r\n        group = orm.Group(name='A')\r\n        app.db.add(group)\r\n        app.db.commit()\r\n\r\n    if user not in group.users:\r\n        group.users.append(user)\r\n        app.db.commit()\r\n\r\n    if another_user not in group.users:\r\n        group.users.append(another_user)\r\n        app.db.commit()\r\n\r\n    group_role = orm.Role.find(app.db, 'student-a')\r\n    if not group_role: \r\n        create_temp_role(['read:groups!group=A'], 'student-a')\r\n        roles.grant_role(app.db, group, rolename='student-a')\r\n        group_role = orm.Role.find(app.db, 'student-a')\r\n    \r\n    # jack's API token\r\n    token = user.new_api_token()\r\n    \r\n    headers = {'Authorization': 'token %s' % token}\r\n    r = await api_request(app, 'users', method='get', headers=headers)\r\n    assert r.status_code == 200\r\n    r.raise_for_status()\r\n    reply = r.json()\r\n\r\n    print(reply)\r\n    \r\n    # right now this fails as it has the group role once in jack's roles (first use of the API token)\r\n    #assert len(reply) == 1\r\n    #assert reply[0]['name'] == 'jack'\r\n    #assert group_role not in reply[0]['roles']\r\n\r\n    headers = {'Authorization': 'token %s' % token}\r\n    r = await api_request(app, 'groups', method='get', headers=headers)\r\n    assert r.status_code == 200\r\n    r.raise_for_status()\r\n    reply = r.json()\r\n\r\n    print(reply)\r\n    \r\n\r\n    headers = {'Authorization': 'token %s' % token}\r\n    r = await api_request(app, 'users', method='get', headers=headers)\r\n    assert r.status_code == 200\r\n    r.raise_for_status()\r\n    reply = r.json()\r\n\r\n    print(reply)\r\n    \r\n    # this also fails as it has the group role 3 times (!) in jack's roles (3rd use of the API token)\r\n    #assert len(reply) == 1\r\n    #assert reply[0]['name'] == 'jack'\r\n    # make it fail to get print statements\r\n    assert group_role not in reply[0]['roles']\r\n```\r\n\r\n</details>\r\n\r\n- <details><summary>Logs</summary>\r\n<!--\r\nErrors are often logged by jupytehub. How you get logs depends on your deployment.\r\nWith kubernetes it might be:\r\n\r\n    kubectl get pod # hub pod name starts with hub...\r\n    kubectl logs hub-...\r\n    # or for a single-user server\r\n    kubectl logs jupyter-username\r\n\r\nOr the-littlest-jupyterhub:\r\n\r\n    journalctl -u jupyterhub\r\n    # or for a single-user server\r\n    journalctl -u jupyter-username\r\n-->\r\n```python\r\n[D 09:22.476 MockHub roles:450] Assigning default roles to User\r\n[I 09:22.482 MockHub roles:353] Adding role user for User: jack\r\n[D 09:22.497 MockHub roles:450] Assigning default roles to User\r\n[I 09:22.501 MockHub roles:353] Adding role user for User: jill\r\n[I 09:22.525 MockHub roles:353] Adding role student-a for Group: A\r\n[D 09:22.530 MockHub roles:442] Assigning default roles to tokens\r\n[I 09:22.532 MockHub roles:445] Added role token to token <APIToken('e7e2...', user='jack', client_id='jupyterhub')>\r\n[D 09:22.551 MockHub base:266] Recording first activity for <APIToken('e7e2...', user='jack', client_id='jupyterhub')>\r\n[D 09:22.551 MockHub base:266] Recording first activity for <User(jack 0/1 running)>\r\n[D 09:22.556 MockHub base:311] Refreshing auth for jack\r\n[D 09:22.556 MockHub base:421] Loading and parsing scopes\r\n[W 09:22.557 MockHub scopes:89] Authenticated with token <APIToken('e7e2...', user='jack', client_id='jupyterhub')>\r\n[W 09:22.559 MockHub scopes:56] [!user=, !group=] or [!user=, !server=] combinations of filters present, intersection between not considered. May result in lower than intended permissions.\r\n[D 09:22.559 MockHub base:429] Found scopes [read:users:tokens!user=jack,read:groups!group=A,users:tokens!user=jack,users:servers!user=jack,users:name!user=jack,read:users:servers!user=jack,read:users:name!user=jack,users:activity!user=jack,users:groups!user=jack,read:users:activity!user=jack,users!user=jack,read:users!user=jack,read:users:groups!user=jack]\r\n[D 09:22.559 MockHub scopes:232] Checking access via scope read:users\r\n[D 09:22.559 MockHub scopes:154] Client has restricted access to /@/space%20word/hub/api/users via read:users. Internal filtering may apply\r\n[D 09:22.566 MockHub base:254] Asking for user model of admin with scopes [read:users:tokens!user=jack, read:groups!group=A, users:tokens!user=jack, users:servers!user=jack, users:name!user=jack, read:users:servers!user=jack, read:users:name!user=jack, users:activity!user=jack, users:groups!user=jack, read:users:activity!user=jack, users!user=jack, read:users!user=jack, read:users:groups!user=jack]\r\n[D 09:22.571 MockHub base:254] Asking for user model of user with scopes [read:users:tokens!user=jack, read:groups!group=A, users:tokens!user=jack, users:servers!user=jack, users:name!user=jack, read:users:servers!user=jack, read:users:name!user=jack, users:activity!user=jack, users:groups!user=jack, read:users:activity!user=jack, users!user=jack, read:users!user=jack, read:users:groups!user=jack]\r\n[D 09:22.571 MockHub base:254] Asking for user model of jack with scopes [read:users:tokens!user=jack, read:groups!group=A, users:tokens!user=jack, users:servers!user=jack, users:name!user=jack, read:users:servers!user=jack, read:users:name!user=jack, users:activity!user=jack, users:groups!user=jack, read:users:activity!user=jack, users!user=jack, read:users!user=jack, read:users:groups!user=jack]\r\n[D 09:22.571 MockHub base:254] Asking for user model of jill with scopes [read:users:tokens!user=jack, read:groups!group=A, users:tokens!user=jack, users:servers!user=jack, users:name!user=jack, read:users:servers!user=jack, read:users:name!user=jack, users:activity!user=jack, users:groups!user=jack, read:users:activity!user=jack, users!user=jack, read:users!user=jack, read:users:groups!user=jack]\r\n[I 09:22.574 MockHub log:189] 200 GET /@/space%20word/hub/api/users (jack@127.0.0.1) 25.29ms\r\n[D 09:22.586 MockHub base:421] Loading and parsing scopes\r\n[W 09:22.587 MockHub scopes:89] Authenticated with token <APIToken('e7e2...', user='jack', client_id='jupyterhub')>\r\n[W 09:22.587 MockHub scopes:56] [!user=, !group=] or [!user=, !server=] combinations of filters present, intersection between not considered. May result in lower than intended permissions.\r\n[D 09:22.587 MockHub base:429] Found scopes [read:users:tokens!user=jack,read:groups!group=A,users:tokens!user=jack,users:servers!user=jack,users:name!user=jack,read:users:servers!user=jack,read:users:name!user=jack,users:activity!user=jack,users:groups!user=jack,read:users:activity!user=jack,users!user=jack,read:users!user=jack,read:users:groups!user=jack]\r\n[D 09:22.587 MockHub scopes:232] Checking access via scope read:groups\r\n[D 09:22.587 MockHub scopes:154] Client has restricted access to /@/space%20word/hub/api/groups via read:groups. Internal filtering may apply\r\n[I 09:22.590 MockHub log:189] 200 GET /@/space%20word/hub/api/groups (jack@127.0.0.1) 6.41ms\r\n[D 09:22.604 MockHub base:421] Loading and parsing scopes\r\n[W 09:22.605 MockHub scopes:89] Authenticated with token <APIToken('e7e2...', user='jack', client_id='jupyterhub')>\r\n[W 09:22.605 MockHub scopes:56] [!user=, !group=] or [!user=, !server=] combinations of filters present, intersection between not considered. May result in lower than intended permissions.\r\n[D 09:22.605 MockHub base:429] Found scopes [read:users:tokens!user=jack,read:groups!group=A,users:tokens!user=jack,users:servers!user=jack,users:name!user=jack,read:users:servers!user=jack,read:users:name!user=jack,users:activity!user=jack,users:groups!user=jack,read:users:activity!user=jack,users!user=jack,read:users!user=jack,read:users:groups!user=jack]\r\n[D 09:22.605 MockHub scopes:232] Checking access via scope read:users\r\n[D 09:22.605 MockHub scopes:154] Client has restricted access to /@/space%20word/hub/api/users via read:users. Internal filtering may apply\r\n[D 09:22.607 MockHub base:254] Asking for user model of admin with scopes [read:users:tokens!user=jack, read:groups!group=A, users:tokens!user=jack, users:servers!user=jack, users:name!user=jack, read:users:servers!user=jack, read:users:name!user=jack, users:activity!user=jack, users:groups!user=jack, read:users:activity!user=jack, users!user=jack, read:users!user=jack, read:users:groups!user=jack]\r\n[D 09:22.607 MockHub base:254] Asking for user model of user with scopes [read:users:tokens!user=jack, read:groups!group=A, users:tokens!user=jack, users:servers!user=jack, users:name!user=jack, read:users:servers!user=jack, read:users:name!user=jack, users:activity!user=jack, users:groups!user=jack, read:users:activity!user=jack, users!user=jack, read:users!user=jack, read:users:groups!user=jack]\r\n[D 09:22.607 MockHub base:254] Asking for user model of jack with scopes [read:users:tokens!user=jack, read:groups!group=A, users:tokens!user=jack, users:servers!user=jack, users:name!user=jack, read:users:servers!user=jack, read:users:name!user=jack, users:activity!user=jack, users:groups!user=jack, read:users:activity!user=jack, users!user=jack, read:users!user=jack, read:users:groups!user=jack]\r\n[D 09:22.607 MockHub base:254] Asking for user model of jill with scopes [read:users:tokens!user=jack, read:groups!group=A, users:tokens!user=jack, users:servers!user=jack, users:name!user=jack, read:users:servers!user=jack, read:users:name!user=jack, users:activity!user=jack, users:groups!user=jack, read:users:activity!user=jack, users!user=jack, read:users!user=jack, read:users:groups!user=jack]\r\n[I 09:22.608 MockHub log:189] 200 GET /@/space%20word/hub/api/users (jack@127.0.0.1) 6.87ms\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3472/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3472/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3454", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3454/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3454/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3454/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3454", "id": 876281466, "node_id": "MDExOlB1bGxSZXF1ZXN0NjMwNDU4ODgz", "number": 3454, "title": "define Spawner.delete_forever on base Spawner", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-05-05T10:00:01Z", "updated_at": "2021-05-05T19:38:07Z", "closed_at": "2021-05-05T18:26:38Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3454", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3454", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3454.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3454.patch", "merged_at": "2021-05-05T18:26:37Z"}, "body": "...where I thought it already was! Instead of on the test class.\r\n\r\nand fix the logic for when it is called a bit:\r\n\r\n- call on *all* Spawners, not just the default\r\n- call on named server deletion when remove=True\r\n\r\ncloses #3451, finishes #3337", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3454/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3454/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3441", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3441/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3441/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3441/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3441", "id": 866027483, "node_id": "MDU6SXNzdWU4NjYwMjc0ODM=", "number": 3441, "title": "[rbac] separate role creation from assignment", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "0mar", "id": 8081279, "node_id": "MDQ6VXNlcjgwODEyNzk=", "avatar_url": "https://avatars.githubusercontent.com/u/8081279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/0mar", "html_url": "https://github.com/0mar", "followers_url": "https://api.github.com/users/0mar/followers", "following_url": "https://api.github.com/users/0mar/following{/other_user}", "gists_url": "https://api.github.com/users/0mar/gists{/gist_id}", "starred_url": "https://api.github.com/users/0mar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/0mar/subscriptions", "organizations_url": "https://api.github.com/users/0mar/orgs", "repos_url": "https://api.github.com/users/0mar/repos", "events_url": "https://api.github.com/users/0mar/events{/privacy}", "received_events_url": "https://api.github.com/users/0mar/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "0mar", "id": 8081279, "node_id": "MDQ6VXNlcjgwODEyNzk=", "avatar_url": "https://avatars.githubusercontent.com/u/8081279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/0mar", "html_url": "https://github.com/0mar", "followers_url": "https://api.github.com/users/0mar/followers", "following_url": "https://api.github.com/users/0mar/following{/other_user}", "gists_url": "https://api.github.com/users/0mar/gists{/gist_id}", "starred_url": "https://api.github.com/users/0mar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/0mar/subscriptions", "organizations_url": "https://api.github.com/users/0mar/orgs", "repos_url": "https://api.github.com/users/0mar/repos", "events_url": "https://api.github.com/users/0mar/events{/privacy}", "received_events_url": "https://api.github.com/users/0mar/received_events", "type": "User", "site_admin": false}, {"login": "IvanaH8", "id": 12073028, "node_id": "MDQ6VXNlcjEyMDczMDI4", "avatar_url": "https://avatars.githubusercontent.com/u/12073028?v=4", "gravatar_id": "", "url": "https://api.github.com/users/IvanaH8", "html_url": "https://github.com/IvanaH8", "followers_url": "https://api.github.com/users/IvanaH8/followers", "following_url": "https://api.github.com/users/IvanaH8/following{/other_user}", "gists_url": "https://api.github.com/users/IvanaH8/gists{/gist_id}", "starred_url": "https://api.github.com/users/IvanaH8/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/IvanaH8/subscriptions", "organizations_url": "https://api.github.com/users/IvanaH8/orgs", "repos_url": "https://api.github.com/users/IvanaH8/repos", "events_url": "https://api.github.com/users/IvanaH8/events{/privacy}", "received_events_url": "https://api.github.com/users/IvanaH8/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2021-04-23T11:35:47Z", "updated_at": "2021-06-17T09:30:00Z", "closed_at": "2021-06-17T09:30:00Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Right now, `init_roles` does two things:\r\n\r\n1. define the roles, and\r\n2. assign users, services, groups, tokens to those roles\r\n\r\nThe second part has to run after users and services exist, while the first part has to run before e.g. services with `admin: true` are created.\r\n\r\nI just encountered this because jupyterhub with an admin service will fail to start because the admin role doesn't exist yet because `init_roles()` is called after `init_services()`.\r\n\r\nI think we should rearrange this a bit to:\r\n\r\n1. create roles before init_users or other entities\r\n2. have a separate `init_role_assignments` stage that assigns entities to roles\r\n\r\nAnd also probably *remove* support for assigning roles directly to tokens. Looking at it, I think that's maybe more complicated and niche than we need. Let's keep role assignment from config only to the other encapsulating entities.\r\n\r\nQuestion: **Do we still have a single `load_roles` config with both role definitions and assignments, or two separate `load_roles` and `assign_roles` config inputs for the two stages?**\r\n\r\nWe should also make it *very* clear what happens between two jupyterhub starts with:\r\n\r\n1. launch with load_roles with `{name: \"myrole\", users: ['alice', 'bob']}`\r\n2. launch with load_roles with `{name: \"myrole\", users: ['alice'] }`\r\n\r\nDoes bob still have role `myrole` or not? If he does, how should I update bob's role assignment to remove `myrole`?", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3441/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3441/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3440", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3440/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3440/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3440/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3440", "id": 865839091, "node_id": "MDU6SXNzdWU4NjU4MzkwOTE=", "number": 3440, "title": "'Not Found' for all action on jupyterhub tree", "user": {"login": "UncleSamulus", "id": 34413256, "node_id": "MDQ6VXNlcjM0NDEzMjU2", "avatar_url": "https://avatars.githubusercontent.com/u/34413256?v=4", "gravatar_id": "", "url": "https://api.github.com/users/UncleSamulus", "html_url": "https://github.com/UncleSamulus", "followers_url": "https://api.github.com/users/UncleSamulus/followers", "following_url": "https://api.github.com/users/UncleSamulus/following{/other_user}", "gists_url": "https://api.github.com/users/UncleSamulus/gists{/gist_id}", "starred_url": "https://api.github.com/users/UncleSamulus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/UncleSamulus/subscriptions", "organizations_url": "https://api.github.com/users/UncleSamulus/orgs", "repos_url": "https://api.github.com/users/UncleSamulus/repos", "events_url": "https://api.github.com/users/UncleSamulus/events{/privacy}", "received_events_url": "https://api.github.com/users/UncleSamulus/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2021-04-23T07:38:37Z", "updated_at": "2021-04-26T13:39:39Z", "closed_at": "2021-04-26T13:39:39Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\nAll action on jupyterhub tree (new notebook, new terminal, new file...) don't execute and return error 'Not Found'.\r\n\r\n### Your personal set up\r\n - OS: Debian 10 x86_64\r\n <!-- [e.g. ubuntu 20.04, macOS 11.0] -->\r\n - Version(s):\r\n - Jupyter hub  : 1.4.0\r\n - Python : 3.8.5\r\n <!-- e.g. jupyterhub --version, python --version --->\r\n\r\n- <details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\n# packages in environment at /opt/anaconda3:\r\n#\r\n# Name                    Version                   Build  Channel\r\n_ipyw_jlab_nb_ext_conf    0.1.0                    py38_0  \r\n_libgcc_mutex             0.1                        main  \r\nalabaster                 0.7.12                     py_0  \r\nalembic                   1.5.8              pyhd8ed1ab_0    conda-forge\r\nanaconda                  2020.11                  py38_0  \r\nanaconda-client           1.7.2                    py38_0  \r\nanaconda-navigator        1.10.0                   py38_0  \r\nanaconda-project          0.8.4                      py_0  \r\nargh                      0.26.2                   py38_0  \r\nargon2-cffi               20.1.0           py38h7b6447c_1  \r\nasn1crypto                1.4.0                      py_0  \r\nastroid                   2.4.2                    py38_0  \r\nastropy                   4.0.2            py38h7b6447c_0  \r\nasync_generator           1.10                       py_0  \r\natomicwrites              1.4.0                      py_0  \r\nattrs                     20.3.0             pyhd3eb1b0_0  \r\nautopep8                  1.5.4                      py_0  \r\nbabel                     2.8.1              pyhd3eb1b0_0  \r\nbackcall                  0.2.0                      py_0  \r\nbackports                 1.0                        py_2  \r\nbackports.functools_lru_cache 1.6.1                      py_0  \r\nbackports.shutil_get_terminal_size 1.0.0                    py38_2  \r\nbackports.tempfile        1.0                        py_1  \r\nbackports.weakref         1.0.post1                  py_1  \r\nbeautifulsoup4            4.9.3              pyhb0f4dca_0  \r\nbitarray                  1.6.1            py38h27cfd23_0  \r\nbkcharts                  0.2                      py38_0  \r\nblas                      1.0                         mkl  \r\nbleach                    3.2.1                      py_0  \r\nblinker                   1.4                        py_1    conda-forge\r\nblosc                     1.20.1               hd408876_0  \r\nbokeh                     2.2.3                    py38_0  \r\nboto                      2.49.0                   py38_0  \r\nbottleneck                1.3.2            py38heb32a55_1  \r\nbrotlipy                  0.7.0           py38h7b6447c_1000  \r\nbzip2                     1.0.8                h7b6447c_0  \r\nca-certificates           2020.10.14                    0  \r\ncairo                     1.14.12              h8948797_3  \r\ncertifi                   2020.6.20          pyhd3eb1b0_3  \r\ncertipy                   0.1.3                      py_0    conda-forge\r\ncffi                      1.14.3           py38he30daa8_0  \r\nchardet                   3.0.4                 py38_1003  \r\nclick                     7.1.2                      py_0  \r\ncloudpickle               1.6.0                      py_0  \r\nclyent                    1.2.2                    py38_1  \r\ncolorama                  0.4.4                      py_0  \r\nconda                     4.10.1           py38h06a4308_1  \r\nconda-build               3.20.5                   py38_1  \r\nconda-env                 2.6.0                         1  \r\nconda-package-handling    1.7.2            py38h03888b9_0  \r\nconda-verify              3.4.2                      py_1  \r\nconfigurable-http-proxy   4.2.3           node12_hac6e442_0    conda-forge\r\ncontextlib2               0.6.0.post1                py_0  \r\ncryptography              3.1.1            py38h1ba5d50_0  \r\ncurl                      7.71.1               hbc83047_1  \r\ncycler                    0.10.0                   py38_0  \r\ncython                    0.29.21          py38he6710b0_0  \r\ncytoolz                   0.11.0           py38h7b6447c_0  \r\ndask                      2.30.0                     py_0  \r\ndask-core                 2.30.0                     py_0  \r\ndbus                      1.13.18              hb2f20db_0  \r\ndecorator                 4.4.2                      py_0  \r\ndefusedxml                0.6.0                      py_0  \r\ndiff-match-patch          20200713                   py_0  \r\ndistributed               2.30.1           py38h06a4308_0  \r\ndocutils                  0.16                     py38_1  \r\nentrypoints               0.3                      py38_0  \r\net_xmlfile                1.0.1                   py_1001  \r\nexpat                     2.2.10               he6710b0_2  \r\nfastcache                 1.1.0            py38h7b6447c_0  \r\nfilelock                  3.0.12                     py_0  \r\nflake8                    3.8.4                      py_0  \r\nflask                     1.1.2                      py_0  \r\nfontconfig                2.13.0               h9420a91_0  \r\nfreetype                  2.10.4               h5ab3b9f_0  \r\nfribidi                   1.0.10               h7b6447c_0  \r\nfsspec                    0.8.3                      py_0  \r\nfuture                    0.18.2                   py38_1  \r\nget_terminal_size         1.0.0                haa9412d_0  \r\ngevent                    20.9.0           py38h7b6447c_0  \r\nglib                      2.66.1               h92f7085_0  \r\nglob2                     0.7                        py_0  \r\ngmp                       6.1.2                h6c8ec71_1  \r\ngmpy2                     2.0.8            py38hd5f6e3b_3  \r\ngraphite2                 1.3.14               h23475e2_0  \r\ngreenlet                  0.4.17           py38h7b6447c_0  \r\ngst-plugins-base          1.14.0               hbbd80ab_1  \r\ngstreamer                 1.14.0               hb31296c_0  \r\nh5py                      2.10.0           py38h7918eee_0  \r\nharfbuzz                  2.4.0                hca77d97_1  \r\nhdf5                      1.10.4               hb1b8bf9_0  \r\nheapdict                  1.0.1                      py_0  \r\nhtml5lib                  1.1                        py_0  \r\nicu                       58.2                 he6710b0_3  \r\nidna                      2.10                       py_0  \r\nimageio                   2.9.0                      py_0  \r\nimagesize                 1.2.0                      py_0  \r\nimportlib-metadata        2.0.0                      py_1  \r\nimportlib_metadata        2.0.0                         1  \r\niniconfig                 1.1.1                      py_0  \r\nintel-openmp              2020.2                      254  \r\nintervaltree              3.1.0                      py_0  \r\nipykernel                 5.3.4            py38h5ca1d4c_0  \r\nipython                   7.19.0           py38hb070fc8_0  \r\nipython_genutils          0.2.0                    py38_0  \r\nipywidgets                7.5.1                      py_1  \r\nisort                     5.6.4                      py_0  \r\nitsdangerous              1.1.0                      py_0  \r\njbig                      2.1                  hdba287a_0  \r\njdcal                     1.4.1                      py_0  \r\njedi                      0.17.1                   py38_0  \r\njeepney                   0.5.0              pyhd3eb1b0_0  \r\njinja2                    2.11.2                     py_0  \r\njoblib                    0.17.0                     py_0  \r\njpeg                      9b                   h024ee3a_2  \r\njson5                     0.9.5                      py_0  \r\njsonschema                3.2.0                      py_2  \r\njupyter                   1.0.0                    py38_7  \r\njupyter_client            6.1.7                      py_0  \r\njupyter_console           6.2.0                      py_0  \r\njupyter_core              4.6.3                    py38_0  \r\njupyter_telemetry         0.1.0              pyhd8ed1ab_1    conda-forge\r\njupyterhub                1.4.0            py38h578d9bd_0    conda-forge\r\njupyterhub-base           1.4.0            py38h578d9bd_0    conda-forge\r\njupyterlab                2.2.6                      py_0  \r\njupyterlab_pygments       0.1.2                      py_0  \r\njupyterlab_server         1.2.0                      py_0  \r\nkeyring                   21.4.0                   py38_1  \r\nkiwisolver                1.3.0            py38h2531618_0  \r\nkrb5                      1.18.2               h173b8e3_0  \r\nlazy-object-proxy         1.4.3            py38h7b6447c_0  \r\nlcms2                     2.11                 h396b838_0  \r\nld_impl_linux-64          2.33.1               h53a641e_7  \r\nlibarchive                3.4.2                h62408e4_0  \r\nlibcurl                   7.71.1               h20c2e04_1  \r\nlibedit                   3.1.20191231         h14c3975_1  \r\nlibffi                    3.3                  he6710b0_2  \r\nlibgcc-ng                 9.1.0                hdf63c60_0  \r\nlibgfortran-ng            7.3.0                hdf63c60_0  \r\nliblief                   0.10.1               he6710b0_0  \r\nlibllvm10                 10.0.1               hbcb73fb_5  \r\nlibpng                    1.6.37               hbc83047_0  \r\nlibsodium                 1.0.18               h7b6447c_0  \r\nlibspatialindex           1.9.3                he6710b0_0  \r\nlibssh2                   1.9.0                h1ba5d50_1  \r\nlibstdcxx-ng              9.1.0                hdf63c60_0  \r\nlibtiff                   4.1.0                h2733197_1  \r\nlibtool                   2.4.6             h7b6447c_1005  \r\nlibuuid                   1.0.3                h1bed415_2  \r\nlibxcb                    1.14                 h7b6447c_0  \r\nlibxml2                   2.9.10               hb55368b_3  \r\nlibxslt                   1.1.34               hc22bd24_0  \r\nllvmlite                  0.34.0           py38h269e1b5_4  \r\nlocket                    0.2.0                    py38_1  \r\nlxml                      4.6.1            py38hefd8a0e_0  \r\nlz4-c                     1.9.2                heb0550a_3  \r\nlzo                       2.10                 h7b6447c_2  \r\nmako                      1.1.4              pyh44b312d_0    conda-forge\r\nmarkupsafe                1.1.1            py38h7b6447c_0  \r\nmatplotlib                3.3.2                         0  \r\nmatplotlib-base           3.3.2            py38h817c723_0  \r\nmccabe                    0.6.1                    py38_1  \r\nmistune                   0.8.4           py38h7b6447c_1000  \r\nmkl                       2020.2                      256  \r\nmkl-service               2.3.0            py38he904b0f_0  \r\nmkl_fft                   1.2.0            py38h23d657b_0  \r\nmkl_random                1.1.1            py38h0573a6f_0  \r\nmock                      4.0.2                      py_0  \r\nmore-itertools            8.6.0              pyhd3eb1b0_0  \r\nmpc                       1.1.0                h10f8cd9_1  \r\nmpfr                      4.0.2                hb69a4c5_1  \r\nmpmath                    1.1.0                    py38_0  \r\nmsgpack-python            1.0.0            py38hfd86e86_1  \r\nmultipledispatch          0.6.0                    py38_0  \r\nnavigator-updater         0.2.1                    py38_0  \r\nnbclient                  0.5.1                      py_0  \r\nnbconvert                 6.0.7                    py38_0  \r\nnbformat                  5.0.8                      py_0  \r\nncurses                   6.2                  he6710b0_1  \r\nnest-asyncio              1.4.2              pyhd3eb1b0_0  \r\nnetworkx                  2.5                        py_0  \r\nnltk                      3.5                        py_0  \r\nnodejs                    12.4.0               he1b5a44_0    conda-forge\r\nnose                      1.3.7                    py38_2  \r\nnotebook                  6.1.4                    py38_0  \r\nnumba                     0.51.2           py38h0573a6f_1  \r\nnumexpr                   2.7.1            py38h423224d_0  \r\nnumpy                     1.19.2           py38h54aff64_0  \r\nnumpy-base                1.19.2           py38hfa32c7d_0  \r\nnumpydoc                  1.1.0              pyhd3eb1b0_1  \r\noauthlib                  3.0.1                      py_0    conda-forge\r\nolefile                   0.46                       py_0  \r\nopenpyxl                  3.0.5                      py_0  \r\nopenssl                   1.1.1h               h7b6447c_0  \r\npackaging                 20.4                       py_0  \r\npamela                    1.0.0                      py_0    conda-forge\r\npandas                    1.1.3            py38he6710b0_0  \r\npandoc                    2.11                 hb0f4dca_0  \r\npandocfilters             1.4.3            py38h06a4308_1  \r\npango                     1.45.3               hd140c19_0  \r\nparso                     0.7.0                      py_0  \r\npartd                     1.1.0                      py_0  \r\npatchelf                  0.12                 he6710b0_0  \r\npath                      15.0.0                   py38_0  \r\npath.py                   12.5.0                        0  \r\npathlib2                  2.3.5                    py38_0  \r\npathtools                 0.1.2                      py_1  \r\npatsy                     0.5.1                    py38_0  \r\npcre                      8.44                 he6710b0_0  \r\npep8                      1.7.1                    py38_0  \r\npexpect                   4.8.0                    py38_0  \r\npickleshare               0.7.5                 py38_1000  \r\npillow                    8.0.1            py38he98fc37_0  \r\npip                       20.2.4           py38h06a4308_0  \r\npixman                    0.40.0               h7b6447c_0  \r\npkginfo                   1.6.1            py38h06a4308_0  \r\npluggy                    0.13.1                   py38_0  \r\nply                       3.11                     py38_0  \r\nprometheus_client         0.8.0                      py_0  \r\nprompt-toolkit            3.0.8                      py_0  \r\nprompt_toolkit            3.0.8                         0  \r\npsutil                    5.7.2            py38h7b6447c_0  \r\nptyprocess                0.6.0                    py38_0  \r\npy                        1.9.0                      py_0  \r\npy-lief                   0.10.1           py38h403a769_0  \r\npycodestyle               2.6.0                      py_0  \r\npycosat                   0.6.3            py38h7b6447c_1  \r\npycparser                 2.20                       py_2  \r\npycurl                    7.43.0.6         py38h1ba5d50_0  \r\npydocstyle                5.1.1                      py_0  \r\npyflakes                  2.2.0                      py_0  \r\npygments                  2.7.2              pyhd3eb1b0_0  \r\npyjwt                     2.0.1              pyhd8ed1ab_0    conda-forge\r\npylint                    2.6.0                    py38_0  \r\npyodbc                    4.0.30           py38he6710b0_0  \r\npyopenssl                 19.1.0                     py_1  \r\npyparsing                 2.4.7                      py_0  \r\npyqt                      5.9.2            py38h05f1152_4  \r\npyrsistent                0.17.3           py38h7b6447c_0  \r\npysocks                   1.7.1                    py38_0  \r\npytables                  3.6.1            py38h9fd0a39_0  \r\npytest                    6.1.1                    py38_0  \r\npython                    3.8.5                h7579374_1  \r\npython-dateutil           2.8.1                      py_0  \r\npython-editor             1.0.4                      py_0    conda-forge\r\npython-json-logger        2.0.1              pyh9f0ad1d_0    conda-forge\r\npython-jsonrpc-server     0.4.0                      py_0  \r\npython-language-server    0.35.1                     py_0  \r\npython-libarchive-c       2.9                        py_0  \r\npython_abi                3.8                      1_cp38    conda-forge\r\npytz                      2020.1                     py_0  \r\npywavelets                1.1.1            py38h7b6447c_2  \r\npyxdg                     0.27               pyhd3eb1b0_0  \r\npyyaml                    5.3.1            py38h7b6447c_1  \r\npyzmq                     19.0.2           py38he6710b0_1  \r\nqdarkstyle                2.8.1                      py_0  \r\nqt                        5.9.7                h5867ecd_1  \r\nqtawesome                 1.0.1                      py_0  \r\nqtconsole                 4.7.7                      py_0  \r\nqtpy                      1.9.0                      py_0  \r\nreadline                  8.0                  h7b6447c_0  \r\nregex                     2020.10.15       py38h7b6447c_0  \r\nrequests                  2.24.0                     py_0  \r\nripgrep                   12.1.1                        0  \r\nrope                      0.18.0                     py_0  \r\nrtree                     0.9.4                    py38_1  \r\nruamel.yaml               0.16.12          py38h25fe258_1    conda-forge\r\nruamel.yaml.clib          0.2.2            py38h25fe258_1    conda-forge\r\nruamel_yaml               0.15.87          py38h7b6447c_1  \r\nscikit-image              0.17.2           py38hdf5156a_0  \r\nscikit-learn              0.23.2           py38h0573a6f_0  \r\nscipy                     1.5.2            py38h0b6359f_0  \r\nseaborn                   0.11.0                     py_0  \r\nsecretstorage             3.1.2                    py38_0  \r\nsend2trash                1.5.0                    py38_0  \r\nsetuptools                50.3.1           py38h06a4308_1  \r\nsimplegeneric             0.8.1                    py38_2  \r\nsingledispatch            3.4.0.3                 py_1001  \r\nsip                       4.19.13          py38he6710b0_0  \r\nsix                       1.15.0           py38h06a4308_0  \r\nsnowballstemmer           2.0.0                      py_0  \r\nsortedcollections         1.2.1                      py_0  \r\nsortedcontainers          2.2.2                      py_0  \r\nsoupsieve                 2.0.1                      py_0  \r\nsphinx                    3.2.1                      py_0  \r\nsphinxcontrib             1.0                      py38_1  \r\nsphinxcontrib-applehelp   1.0.2                      py_0  \r\nsphinxcontrib-devhelp     1.0.2                      py_0  \r\nsphinxcontrib-htmlhelp    1.0.3                      py_0  \r\nsphinxcontrib-jsmath      1.0.1                      py_0  \r\nsphinxcontrib-qthelp      1.0.3                      py_0  \r\nsphinxcontrib-serializinghtml 1.1.4                      py_0  \r\nsphinxcontrib-websupport  1.2.4                      py_0  \r\nspyder                    4.1.5                    py38_0  \r\nspyder-kernels            1.9.4                    py38_0  \r\nsqlalchemy                1.3.20           py38h7b6447c_0  \r\nsqlite                    3.33.0               h62c20be_0  \r\nstatsmodels               0.12.0           py38h7b6447c_0  \r\nsympy                     1.6.2            py38h06a4308_1  \r\ntbb                       2020.3               hfd86e86_0  \r\ntblib                     1.7.0                      py_0  \r\nterminado                 0.9.1                    py38_0  \r\ntestpath                  0.4.4                      py_0  \r\nthreadpoolctl             2.1.0              pyh5ca1d4c_0  \r\ntifffile                  2020.10.1        py38hdd07704_2  \r\ntk                        8.6.10               hbc83047_0  \r\ntoml                      0.10.1                     py_0  \r\ntoolz                     0.11.1                     py_0  \r\ntornado                   6.0.4            py38h7b6447c_1  \r\ntqdm                      4.50.2                     py_0  \r\ntraitlets                 5.0.5                      py_0  \r\ntyping_extensions         3.7.4.3                    py_0  \r\nujson                     4.0.1            py38he6710b0_0  \r\nunicodecsv                0.14.1                   py38_0  \r\nunixodbc                  2.3.9                h7b6447c_0  \r\nurllib3                   1.25.11                    py_0  \r\nwatchdog                  0.10.3                   py38_0  \r\nwcwidth                   0.2.5                      py_0  \r\nwebencodings              0.5.1                    py38_1  \r\nwerkzeug                  1.0.1                      py_0  \r\nwheel                     0.35.1                     py_0  \r\nwidgetsnbextension        3.5.1                    py38_0  \r\nwrapt                     1.11.2           py38h7b6447c_0  \r\nwurlitzer                 2.0.1                    py38_0  \r\nxlrd                      1.2.0                      py_0  \r\nxlsxwriter                1.3.7                      py_0  \r\nxlwt                      1.3.0                    py38_0  \r\nxmltodict                 0.12.0                     py_0  \r\nxz                        5.2.5                h7b6447c_0  \r\nyaml                      0.2.5                h7b6447c_0  \r\nyapf                      0.30.0                     py_0  \r\nzeromq                    4.3.3                he6710b0_3  \r\nzict                      2.0.0                      py_0  \r\nzipp                      3.4.0              pyhd3eb1b0_0  \r\nzlib                      1.2.11               h7b6447c_3  \r\nzope                      1.0                      py38_1  \r\nzope.event                4.5.0                    py38_0  \r\nzope.interface            5.1.2            py38h7b6447c_0  \r\nzstd                      1.4.5                h9ceee32_0  \r\n```\r\n</details>\r\n\r\n- <details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```python\r\n# Configuration file for jupyterhub.\r\n\r\n#------------------------------------------------------------------------------\r\n# Application(SingletonConfigurable) configuration\r\n#------------------------------------------------------------------------------\r\n## This is an application.\r\n\r\n## The date format used by logging formatters for %(asctime)s\r\n#  Default: '%Y-%m-%d %H:%M:%S'\r\n# c.Application.log_datefmt = '%Y-%m-%d %H:%M:%S'\r\n\r\n## The Logging format template\r\n#  Default: '[%(name)s]%(highlevel)s %(message)s'\r\n# c.Application.log_format = '[%(name)s]%(highlevel)s %(message)s'\r\n\r\n## Set the log level by value or name.\r\n#  Choices: any of [0, 10, 20, 30, 40, 50, 'DEBUG', 'INFO', 'WARN', 'ERROR', 'CRITICAL']\r\n#  Default: 30\r\n# c.Application.log_level = 30\r\n\r\n## Instead of starting the Application, dump configuration to stdout\r\n#  Default: False\r\n# c.Application.show_config = False\r\n\r\n## Instead of starting the Application, dump configuration to stdout (as JSON)\r\n#  Default: False\r\n# c.Application.show_config_json = False\r\n\r\n#------------------------------------------------------------------------------\r\n# JupyterHub(Application) configuration\r\n#------------------------------------------------------------------------------\r\n## An Application for starting a Multi-User Jupyter Notebook server.\r\n\r\n## Maximum number of concurrent servers that can be active at a time.\r\n#  \r\n#  Setting this can limit the total resources your users can consume.\r\n#  \r\n#  An active server is any server that's not fully stopped. It is considered\r\n#  active from the time it has been requested until the time that it has\r\n#  completely stopped.\r\n#  \r\n#  If this many user servers are active, users will not be able to launch new\r\n#  servers until a server is shutdown. Spawn requests will be rejected with a 429\r\n#  error asking them to try again.\r\n#  \r\n#  If set to 0, no limit is enforced.\r\n#  Default: 0\r\n# c.JupyterHub.active_server_limit = 0\r\n\r\n## Duration (in seconds) to determine the number of active users.\r\n#  Default: 1800\r\n# c.JupyterHub.active_user_window = 1800\r\n\r\n## Resolution (in seconds) for updating activity\r\n#  \r\n#  If activity is registered that is less than activity_resolution seconds more\r\n#  recent than the current value, the new value will be ignored.\r\n#  \r\n#  This avoids too many writes to the Hub database.\r\n#  Default: 30\r\n# c.JupyterHub.activity_resolution = 30\r\n\r\n## Grant admin users permission to access single-user servers.\r\n#  \r\n#  Users should be properly informed if this is enabled.\r\n#  Default: False\r\n# c.JupyterHub.admin_access = False\r\n\r\n## DEPRECATED since version 0.7.2, use Authenticator.admin_users instead.\r\n#  Default: set()\r\nc.JupyterHub.admin_users = set('ortion')\r\n\r\n## Allow named single-user servers per user\r\n#  Default: False\r\n# c.JupyterHub.allow_named_servers = False\r\n\r\n## Answer yes to any questions (e.g. confirm overwrite)\r\n#  Default: False\r\n# c.JupyterHub.answer_yes = False\r\n\r\n## PENDING DEPRECATION: consider using services\r\n#  \r\n#  Dict of token:username to be loaded into the database.\r\n#  \r\n#  Allows ahead-of-time generation of API tokens for use by externally managed\r\n#  services, which authenticate as JupyterHub users.\r\n#  \r\n#  Consider using services for general services that talk to the JupyterHub API.\r\n#  Default: {}\r\n# c.JupyterHub.api_tokens = {}\r\n\r\n## Authentication for prometheus metrics\r\n#  Default: True\r\n# c.JupyterHub.authenticate_prometheus = True\r\n\r\n## Class for authenticating users.\r\n#  \r\n#          This should be a subclass of :class:`jupyterhub.auth.Authenticator`\r\n#  \r\n#          with an :meth:`authenticate` method that:\r\n#  \r\n#          - is a coroutine (asyncio or tornado)\r\n#          - returns username on success, None on failure\r\n#          - takes two arguments: (handler, data),\r\n#            where `handler` is the calling web.RequestHandler,\r\n#            and `data` is the POST form data from the login page.\r\n#  \r\n#          .. versionchanged:: 1.0\r\n#              authenticators may be registered via entry points,\r\n#              e.g. `c.JupyterHub.authenticator_class = 'pam'`\r\n#  \r\n#  Currently installed: \r\n#    - default: jupyterhub.auth.PAMAuthenticator\r\n#    - dummy: jupyterhub.auth.DummyAuthenticator\r\n#    - pam: jupyterhub.auth.PAMAuthenticator\r\n#  Default: 'jupyterhub.auth.PAMAuthenticator'\r\n# c.JupyterHub.authenticator_class = 'jupyterhub.auth.PAMAuthenticator'\r\n\r\n## The base URL of the entire application.\r\n#  \r\n#  Add this to the beginning of all JupyterHub URLs. Use base_url to run\r\n#  JupyterHub within an existing website.\r\n#  \r\n#  .. deprecated: 0.9\r\n#      Use JupyterHub.bind_url\r\n#  Default: '/'\r\n# c.JupyterHub.base_url = '/'\r\n\r\n## The public facing URL of the whole JupyterHub application.\r\n#  \r\n#  This is the address on which the proxy will bind. Sets protocol, ip, base_url\r\n#  Default: 'http://:8000'\r\n# c.JupyterHub.bind_url = 'http://:8000'\r\n\r\n## Whether to shutdown the proxy when the Hub shuts down.\r\n#  \r\n#  Disable if you want to be able to teardown the Hub while leaving the proxy\r\n#  running.\r\n#  \r\n#  Only valid if the proxy was starting by the Hub process.\r\n#  \r\n#  If both this and cleanup_servers are False, sending SIGINT to the Hub will\r\n#  only shutdown the Hub, leaving everything else running.\r\n#  \r\n#  The Hub should be able to resume from database state.\r\n#  Default: True\r\n# c.JupyterHub.cleanup_proxy = True\r\n\r\n## Whether to shutdown single-user servers when the Hub shuts down.\r\n#  \r\n#  Disable if you want to be able to teardown the Hub while leaving the single-\r\n#  user servers running.\r\n#  \r\n#  If both this and cleanup_proxy are False, sending SIGINT to the Hub will only\r\n#  shutdown the Hub, leaving everything else running.\r\n#  \r\n#  The Hub should be able to resume from database state.\r\n#  Default: True\r\n# c.JupyterHub.cleanup_servers = True\r\n\r\n## Maximum number of concurrent users that can be spawning at a time.\r\n#  \r\n#  Spawning lots of servers at the same time can cause performance problems for\r\n#  the Hub or the underlying spawning system. Set this limit to prevent bursts of\r\n#  logins from attempting to spawn too many servers at the same time.\r\n#  \r\n#  This does not limit the number of total running servers. See\r\n#  active_server_limit for that.\r\n#  \r\n#  If more than this many users attempt to spawn at a time, their requests will\r\n#  be rejected with a 429 error asking them to try again. Users will have to wait\r\n#  for some of the spawning services to finish starting before they can start\r\n#  their own.\r\n#  \r\n#  If set to 0, no limit is enforced.\r\n#  Default: 100\r\n# c.JupyterHub.concurrent_spawn_limit = 100\r\n\r\n## The config file to load\r\n#  Default: 'jupyterhub_config.py'\r\n# c.JupyterHub.config_file = 'jupyterhub_config.py'\r\n\r\n## DEPRECATED: does nothing\r\n#  Default: False\r\n# c.JupyterHub.confirm_no_ssl = False\r\n\r\n## Number of days for a login cookie to be valid. Default is two weeks.\r\n#  Default: 14\r\n# c.JupyterHub.cookie_max_age_days = 14\r\n\r\n## The cookie secret to use to encrypt cookies.\r\n#  \r\n#  Loaded from the JPY_COOKIE_SECRET env variable by default.\r\n#  \r\n#  Should be exactly 256 bits (32 bytes).\r\n#  Default: b''\r\n# c.JupyterHub.cookie_secret = b''\r\n\r\n## File in which to store the cookie secret.\r\n#  Default: 'jupyterhub_cookie_secret'\r\n# c.JupyterHub.cookie_secret_file = 'jupyterhub_cookie_secret'\r\n\r\n## The location of jupyterhub data files (e.g. /usr/local/share/jupyterhub)\r\n#  Default: '/root/anaconda3/share/jupyterhub'\r\n# c.JupyterHub.data_files_path = '/root/anaconda3/share/jupyterhub'\r\n\r\n## Include any kwargs to pass to the database connection. See\r\n#  sqlalchemy.create_engine for details.\r\n#  Default: {}\r\n# c.JupyterHub.db_kwargs = {}\r\n\r\n## url for the database. e.g. `sqlite:///jupyterhub.sqlite`\r\n#  Default: 'sqlite:///jupyterhub.sqlite'\r\n# c.JupyterHub.db_url = 'sqlite:///jupyterhub.sqlite'\r\n\r\n## log all database transactions. This has A LOT of output\r\n#  Default: False\r\n# c.JupyterHub.debug_db = False\r\n\r\n## DEPRECATED since version 0.8: Use ConfigurableHTTPProxy.debug\r\n#  Default: False\r\n# c.JupyterHub.debug_proxy = False\r\n\r\n## If named servers are enabled, default name of server to spawn or open, e.g. by\r\n#  user-redirect.\r\n#  Default: ''\r\n# c.JupyterHub.default_server_name = ''\r\n\r\n## The default URL for users when they arrive (e.g. when user directs to \"/\")\r\n#  \r\n#  By default, redirects users to their own server.\r\n#  \r\n#  Can be a Unicode string (e.g. '/hub/home') or a callable based on the handler\r\n#  object:\r\n#  \r\n#  ::\r\n#  \r\n#      def default_url_fn(handler):\r\n#          user = handler.current_user\r\n#          if user and user.admin:\r\n#              return '/hub/admin'\r\n#          return '/hub/home'\r\n#  \r\n#      c.JupyterHub.default_url = default_url_fn\r\n#  Default: traitlets.Undefined\r\n# c.JupyterHub.default_url = traitlets.Undefined\r\n\r\n## Dict authority:dict(files). Specify the key, cert, and/or ca file for an\r\n#  authority. This is useful for externally managed proxies that wish to use\r\n#  internal_ssl.\r\n#  \r\n#  The files dict has this format (you must specify at least a cert)::\r\n#  \r\n#      {\r\n#          'key': '/path/to/key.key',\r\n#          'cert': '/path/to/cert.crt',\r\n#          'ca': '/path/to/ca.crt'\r\n#      }\r\n#  \r\n#  The authorities you can override: 'hub-ca', 'notebooks-ca', 'proxy-api-ca',\r\n#  'proxy-client-ca', and 'services-ca'.\r\n#  \r\n#  Use with internal_ssl\r\n#  Default: {}\r\n# c.JupyterHub.external_ssl_authorities = {}\r\n\r\n## Register extra tornado Handlers for jupyterhub.\r\n#  \r\n#  Should be of the form ``(\"<regex>\", Handler)``\r\n#  \r\n#  The Hub prefix will be added, so `/my-page` will be served at `/hub/my-page`.\r\n#  Default: []\r\n# c.JupyterHub.extra_handlers = []\r\n\r\n## DEPRECATED: use output redirection instead, e.g.\r\n#  \r\n#  jupyterhub &>> /var/log/jupyterhub.log\r\n#  Default: ''\r\n# c.JupyterHub.extra_log_file = ''\r\n\r\n## Extra log handlers to set on JupyterHub logger\r\n#  Default: []\r\n# c.JupyterHub.extra_log_handlers = []\r\n\r\n## Generate certs used for internal ssl\r\n#  Default: False\r\n# c.JupyterHub.generate_certs = False\r\n\r\n## Generate default config file\r\n#  Default: False\r\n# c.JupyterHub.generate_config = False\r\n\r\n## The URL on which the Hub will listen. This is a private URL for internal\r\n#  communication. Typically set in combination with hub_connect_url. If a unix\r\n#  socket, hub_connect_url **must** also be set.\r\n#  \r\n#  For example:\r\n#  \r\n#      \"http://127.0.0.1:8081\"\r\n#      \"unix+http://%2Fsrv%2Fjupyterhub%2Fjupyterhub.sock\"\r\n#  \r\n#  .. versionadded:: 0.9\r\n#  Default: ''\r\n# c.JupyterHub.hub_bind_url = ''\r\n\r\n## The ip or hostname for proxies and spawners to use for connecting to the Hub.\r\n#  \r\n#  Use when the bind address (`hub_ip`) is 0.0.0.0, :: or otherwise different\r\n#  from the connect address.\r\n#  \r\n#  Default: when `hub_ip` is 0.0.0.0 or ::, use `socket.gethostname()`, otherwise\r\n#  use `hub_ip`.\r\n#  \r\n#  Note: Some spawners or proxy implementations might not support hostnames.\r\n#  Check your spawner or proxy documentation to see if they have extra\r\n#  requirements.\r\n#  \r\n#  .. versionadded:: 0.8\r\n#  Default: ''\r\n# c.JupyterHub.hub_connect_ip = ''\r\n\r\n## DEPRECATED\r\n#  \r\n#  Use hub_connect_url\r\n#  \r\n#  .. versionadded:: 0.8\r\n#  \r\n#  .. deprecated:: 0.9\r\n#      Use hub_connect_url\r\n#  Default: 0\r\n# c.JupyterHub.hub_connect_port = 0\r\n\r\n## The URL for connecting to the Hub. Spawners, services, and the proxy will use\r\n#  this URL to talk to the Hub.\r\n#  \r\n#  Only needs to be specified if the default hub URL is not connectable (e.g.\r\n#  using a unix+http:// bind url).\r\n#  \r\n#  .. seealso::\r\n#      JupyterHub.hub_connect_ip\r\n#      JupyterHub.hub_bind_url\r\n#  \r\n#  .. versionadded:: 0.9\r\n#  Default: ''\r\n# c.JupyterHub.hub_connect_url = ''\r\n\r\n## The ip address for the Hub process to *bind* to.\r\n#  \r\n#  By default, the hub listens on localhost only. This address must be accessible\r\n#  from the proxy and user servers. You may need to set this to a public ip or ''\r\n#  for all interfaces if the proxy or user servers are in containers or on a\r\n#  different host.\r\n#  \r\n#  See `hub_connect_ip` for cases where the bind and connect address should\r\n#  differ, or `hub_bind_url` for setting the full bind URL.\r\n#  Default: '127.0.0.1'\r\n# c.JupyterHub.hub_ip = '127.0.0.1'\r\n\r\n## The internal port for the Hub process.\r\n#  \r\n#  This is the internal port of the hub itself. It should never be accessed\r\n#  directly. See JupyterHub.port for the public port to use when accessing\r\n#  jupyterhub. It is rare that this port should be set except in cases of port\r\n#  conflict.\r\n#  \r\n#  See also `hub_ip` for the ip and `hub_bind_url` for setting the full bind URL.\r\n#  Default: 8081\r\n# c.JupyterHub.hub_port = 8081\r\n\r\n## Trigger implicit spawns after this many seconds.\r\n#  \r\n#  When a user visits a URL for a server that's not running, they are shown a\r\n#  page indicating that the requested server is not running with a button to\r\n#  spawn the server.\r\n#  \r\n#  Setting this to a positive value will redirect the user after this many\r\n#  seconds, effectively clicking this button automatically for the users,\r\n#  automatically beginning the spawn process.\r\n#  \r\n#  Warning: this can result in errors and surprising behavior when sharing access\r\n#  URLs to actual servers, since the wrong server is likely to be started.\r\n#  Default: 0\r\n# c.JupyterHub.implicit_spawn_seconds = 0\r\n\r\n## Timeout (in seconds) to wait for spawners to initialize\r\n#  \r\n#  Checking if spawners are healthy can take a long time if many spawners are\r\n#  active at hub start time.\r\n#  \r\n#  If it takes longer than this timeout to check, init_spawner will be left to\r\n#  complete in the background and the http server is allowed to start.\r\n#  \r\n#  A timeout of -1 means wait forever, which can mean a slow startup of the Hub\r\n#  but ensures that the Hub is fully consistent by the time it starts responding\r\n#  to requests. This matches the behavior of jupyterhub 1.0.\r\n#  \r\n#  .. versionadded: 1.1.0\r\n#  Default: 10\r\n# c.JupyterHub.init_spawners_timeout = 10\r\n\r\n## The location to store certificates automatically created by JupyterHub.\r\n#  \r\n#  Use with internal_ssl\r\n#  Default: 'internal-ssl'\r\n# c.JupyterHub.internal_certs_location = 'internal-ssl'\r\n\r\n## Enable SSL for all internal communication\r\n#  \r\n#  This enables end-to-end encryption between all JupyterHub components.\r\n#  JupyterHub will automatically create the necessary certificate authority and\r\n#  sign notebook certificates as they're created.\r\n#  Default: False\r\n# c.JupyterHub.internal_ssl = False\r\n\r\n## The public facing ip of the whole JupyterHub application (specifically\r\n#  referred to as the proxy).\r\n#  \r\n#  This is the address on which the proxy will listen. The default is to listen\r\n#  on all interfaces. This is the only address through which JupyterHub should be\r\n#  accessed by users.\r\n#  \r\n#  .. deprecated: 0.9\r\n#      Use JupyterHub.bind_url\r\n#  Default: ''\r\n# c.JupyterHub.ip = ''\r\n\r\n## Supply extra arguments that will be passed to Jinja environment.\r\n#  Default: {}\r\n# c.JupyterHub.jinja_environment_options = {}\r\n\r\n## Interval (in seconds) at which to update last-activity timestamps.\r\n#  Default: 300\r\n# c.JupyterHub.last_activity_interval = 300\r\n\r\n## Dict of 'group': ['usernames'] to load at startup.\r\n#  \r\n#  This strictly *adds* groups and users to groups.\r\n#  \r\n#  Loading one set of groups, then starting JupyterHub again with a different set\r\n#  will not remove users or groups from previous launches. That must be done\r\n#  through the API.\r\n#  Default: {}\r\n# c.JupyterHub.load_groups = {}\r\n\r\n## The date format used by logging formatters for %(asctime)s\r\n#  See also: Application.log_datefmt\r\n# c.JupyterHub.log_datefmt = '%Y-%m-%d %H:%M:%S'\r\n\r\n## The Logging format template\r\n#  See also: Application.log_format\r\n# c.JupyterHub.log_format = '[%(name)s]%(highlevel)s %(message)s'\r\n\r\n## Set the log level by value or name.\r\n#  See also: Application.log_level\r\n# c.JupyterHub.log_level = 30\r\n\r\n## Specify path to a logo image to override the Jupyter logo in the banner.\r\n#  Default: ''\r\n# c.JupyterHub.logo_file = ''\r\n\r\n## Maximum number of concurrent named servers that can be created by a user at a\r\n#  time.\r\n#  \r\n#  Setting this can limit the total resources a user can consume.\r\n#  \r\n#  If set to 0, no limit is enforced.\r\n#  Default: 0\r\n# c.JupyterHub.named_server_limit_per_user = 0\r\n\r\n## File to write PID Useful for daemonizing JupyterHub.\r\n#  Default: ''\r\n# c.JupyterHub.pid_file = ''\r\n\r\n## The public facing port of the proxy.\r\n#  \r\n#  This is the port on which the proxy will listen. This is the only port through\r\n#  which JupyterHub should be accessed by users.\r\n#  \r\n#  .. deprecated: 0.9\r\n#      Use JupyterHub.bind_url\r\n#  Default: 8000\r\n# c.JupyterHub.port = 8000\r\n\r\n## DEPRECATED since version 0.8 : Use ConfigurableHTTPProxy.api_url\r\n#  Default: ''\r\n# c.JupyterHub.proxy_api_ip = ''\r\n\r\n## DEPRECATED since version 0.8 : Use ConfigurableHTTPProxy.api_url\r\n#  Default: 0\r\n# c.JupyterHub.proxy_api_port = 0\r\n\r\n## DEPRECATED since version 0.8: Use ConfigurableHTTPProxy.auth_token\r\n#  Default: ''\r\n# c.JupyterHub.proxy_auth_token = ''\r\n\r\n## Interval (in seconds) at which to check if the proxy is running.\r\n#  Default: 30\r\n# c.JupyterHub.proxy_check_interval = 30\r\n\r\n## The class to use for configuring the JupyterHub proxy.\r\n#  \r\n#          Should be a subclass of :class:`jupyterhub.proxy.Proxy`.\r\n#  \r\n#          .. versionchanged:: 1.0\r\n#              proxies may be registered via entry points,\r\n#              e.g. `c.JupyterHub.proxy_class = 'traefik'`\r\n#  \r\n#  Currently installed: \r\n#    - configurable-http-proxy: jupyterhub.proxy.ConfigurableHTTPProxy\r\n#    - default: jupyterhub.proxy.ConfigurableHTTPProxy\r\n#  Default: 'jupyterhub.proxy.ConfigurableHTTPProxy'\r\n# c.JupyterHub.proxy_class = 'jupyterhub.proxy.ConfigurableHTTPProxy'\r\n\r\n## DEPRECATED since version 0.8. Use ConfigurableHTTPProxy.command\r\n#  Default: []\r\n# c.JupyterHub.proxy_cmd = []\r\n\r\n## Recreate all certificates used within JupyterHub on restart.\r\n#  \r\n#  Note: enabling this feature requires restarting all notebook servers.\r\n#  \r\n#  Use with internal_ssl\r\n#  Default: False\r\n# c.JupyterHub.recreate_internal_certs = False\r\n\r\n## Redirect user to server (if running), instead of control panel.\r\n#  Default: True\r\n# c.JupyterHub.redirect_to_server = True\r\n\r\n## Purge and reset the database.\r\n#  Default: False\r\n# c.JupyterHub.reset_db = False\r\n\r\n## Interval (in seconds) at which to check connectivity of services with web\r\n#  endpoints.\r\n#  Default: 60\r\n# c.JupyterHub.service_check_interval = 60\r\n\r\n## Dict of token:servicename to be loaded into the database.\r\n#  \r\n#  Allows ahead-of-time generation of API tokens for use by externally managed\r\n#  services.\r\n#  Default: {}\r\n# c.JupyterHub.service_tokens = {}\r\n\r\n## List of service specification dictionaries.\r\n#  \r\n#  A service\r\n#  \r\n#  For instance::\r\n#  \r\n#      services = [\r\n#          {\r\n#              'name': 'cull_idle',\r\n#              'command': ['/path/to/cull_idle_servers.py'],\r\n#          },\r\n#          {\r\n#              'name': 'formgrader',\r\n#              'url': 'http://127.0.0.1:1234',\r\n#              'api_token': 'super-secret',\r\n#              'environment':\r\n#          }\r\n#      ]\r\n#  Default: []\r\n# c.JupyterHub.services = []\r\n\r\n## Instead of starting the Application, dump configuration to stdout\r\n#  See also: Application.show_config\r\n# c.JupyterHub.show_config = False\r\n\r\n## Instead of starting the Application, dump configuration to stdout (as JSON)\r\n#  See also: Application.show_config_json\r\n# c.JupyterHub.show_config_json = False\r\n\r\n## Shuts down all user servers on logout\r\n#  Default: False\r\n# c.JupyterHub.shutdown_on_logout = False\r\n\r\n## The class to use for spawning single-user servers.\r\n#  \r\n#          Should be a subclass of :class:`jupyterhub.spawner.Spawner`.\r\n#  \r\n#          .. versionchanged:: 1.0\r\n#              spawners may be registered via entry points,\r\n#              e.g. `c.JupyterHub.spawner_class = 'localprocess'`\r\n#  \r\n#  Currently installed: \r\n#    - default: jupyterhub.spawner.LocalProcessSpawner\r\n#    - localprocess: jupyterhub.spawner.LocalProcessSpawner\r\n#    - simple: jupyterhub.spawner.SimpleLocalProcessSpawner\r\n#  Default: 'jupyterhub.spawner.LocalProcessSpawner'\r\n# c.JupyterHub.spawner_class = 'jupyterhub.spawner.LocalProcessSpawner'\r\n\r\n## Path to SSL certificate file for the public facing interface of the proxy\r\n#  \r\n#  When setting this, you should also set ssl_key\r\n#  Default: ''\r\n# c.JupyterHub.ssl_cert = ''\r\n\r\n## Path to SSL key file for the public facing interface of the proxy\r\n#  \r\n#  When setting this, you should also set ssl_cert\r\n#  Default: ''\r\n# c.JupyterHub.ssl_key = ''\r\n\r\n## Host to send statsd metrics to. An empty string (the default) disables sending\r\n#  metrics.\r\n#  Default: ''\r\n# c.JupyterHub.statsd_host = ''\r\n\r\n## Port on which to send statsd metrics about the hub\r\n#  Default: 8125\r\n# c.JupyterHub.statsd_port = 8125\r\n\r\n## Prefix to use for all metrics sent by jupyterhub to statsd\r\n#  Default: 'jupyterhub'\r\n# c.JupyterHub.statsd_prefix = 'jupyterhub'\r\n\r\n## Run single-user servers on subdomains of this host.\r\n#  \r\n#  This should be the full `https://hub.domain.tld[:port]`.\r\n#  \r\n#  Provides additional cross-site protections for javascript served by single-\r\n#  user servers.\r\n#  \r\n#  Requires `<username>.hub.domain.tld` to resolve to the same host as\r\n#  `hub.domain.tld`.\r\n#  \r\n#  In general, this is most easily achieved with wildcard DNS.\r\n#  \r\n#  When using SSL (i.e. always) this also requires a wildcard SSL certificate.\r\n#  Default: ''\r\n# c.JupyterHub.subdomain_host = ''\r\n\r\n## Paths to search for jinja templates, before using the default templates.\r\n#  Default: []\r\n# c.JupyterHub.template_paths = []\r\n\r\n## Extra variables to be passed into jinja templates\r\n#  Default: {}\r\n# c.JupyterHub.template_vars = {}\r\n\r\n## Extra settings overrides to pass to the tornado application.\r\n#  Default: {}\r\n# c.JupyterHub.tornado_settings = {}\r\n\r\n## Trust user-provided tokens (via JupyterHub.service_tokens) to have good\r\n#  entropy.\r\n#  \r\n#  If you are not inserting additional tokens via configuration file, this flag\r\n#  has no effect.\r\n#  \r\n#  In JupyterHub 0.8, internally generated tokens do not pass through additional\r\n#  hashing because the hashing is costly and does not increase the entropy of\r\n#  already-good UUIDs.\r\n#  \r\n#  User-provided tokens, on the other hand, are not trusted to have good entropy\r\n#  by default, and are passed through many rounds of hashing to stretch the\r\n#  entropy of the key (i.e. user-provided tokens are treated as passwords instead\r\n#  of random keys). These keys are more costly to check.\r\n#  \r\n#  If your inserted tokens are generated by a good-quality mechanism, e.g.\r\n#  `openssl rand -hex 32`, then you can set this flag to True to reduce the cost\r\n#  of checking authentication tokens.\r\n#  Default: False\r\n# c.JupyterHub.trust_user_provided_tokens = False\r\n\r\n## Names to include in the subject alternative name.\r\n#  \r\n#  These names will be used for server name verification. This is useful if\r\n#  JupyterHub is being run behind a reverse proxy or services using ssl are on\r\n#  different hosts.\r\n#  \r\n#  Use with internal_ssl\r\n#  Default: []\r\n# c.JupyterHub.trusted_alt_names = []\r\n\r\n## Downstream proxy IP addresses to trust.\r\n#  \r\n#  This sets the list of IP addresses that are trusted and skipped when\r\n#  processing the `X-Forwarded-For` header. For example, if an external proxy is\r\n#  used for TLS termination, its IP address should be added to this list to\r\n#  ensure the correct client IP addresses are recorded in the logs instead of the\r\n#  proxy server's IP address.\r\n#  Default: []\r\n# c.JupyterHub.trusted_downstream_ips = []\r\n\r\n## Upgrade the database automatically on start.\r\n#  \r\n#  Only safe if database is regularly backed up. Only SQLite databases will be\r\n#  backed up to a local file automatically.\r\n#  Default: False\r\n# c.JupyterHub.upgrade_db = False\r\n\r\n## Callable to affect behavior of /user-redirect/\r\n#  \r\n#  Receives 4 parameters: 1. path - URL path that was provided after /user-\r\n#  redirect/ 2. request - A Tornado HTTPServerRequest representing the current\r\n#  request. 3. user - The currently authenticated user. 4. base_url - The\r\n#  base_url of the current hub, for relative redirects\r\n#  \r\n#  It should return the new URL to redirect to, or None to preserve current\r\n#  behavior.\r\n#  Default: None\r\n# c.JupyterHub.user_redirect_hook = None\r\n\r\n#------------------------------------------------------------------------------\r\n# Spawner(LoggingConfigurable) configuration\r\n#------------------------------------------------------------------------------\r\n## Base class for spawning single-user notebook servers.\r\n#  \r\n#  Subclass this, and override the following methods:\r\n#  \r\n#  - load_state - get_state - start - stop - poll\r\n#  \r\n#  As JupyterHub supports multiple users, an instance of the Spawner subclass is\r\n#  created for each user. If there are 20 JupyterHub users, there will be 20\r\n#  instances of the subclass.\r\n\r\n## Extra arguments to be passed to the single-user server.\r\n#  \r\n#  Some spawners allow shell-style expansion here, allowing you to use\r\n#  environment variables here. Most, including the default, do not. Consult the\r\n#  documentation for your spawner to verify!\r\n#  Default: []\r\n# c.Spawner.args = []\r\n\r\n## An optional hook function that you can implement to pass `auth_state` to the\r\n#  spawner after it has been initialized but before it starts. The `auth_state`\r\n#  dictionary may be set by the `.authenticate()` method of the authenticator.\r\n#  This hook enables you to pass some or all of that information to your spawner.\r\n#  \r\n#  Example::\r\n#  \r\n#      def userdata_hook(spawner, auth_state):\r\n#          spawner.userdata = auth_state[\"userdata\"]\r\n#  \r\n#      c.Spawner.auth_state_hook = userdata_hook\r\n#  Default: None\r\n# c.Spawner.auth_state_hook = None\r\n\r\n## The command used for starting the single-user server.\r\n#  \r\n#  Provide either a string or a list containing the path to the startup script\r\n#  command. Extra arguments, other than this path, should be provided via `args`.\r\n#  \r\n#  This is usually set if you want to start the single-user server in a different\r\n#  python environment (with virtualenv/conda) than JupyterHub itself.\r\n#  \r\n#  Some spawners allow shell-style expansion here, allowing you to use\r\n#  environment variables. Most, including the default, do not. Consult the\r\n#  documentation for your spawner to verify!\r\n#  Default: ['jupyterhub-singleuser']\r\nc.Spawner.cmd = ['/opt/anaconda3/bin/jupyterhub-singleuser']\r\n\r\n## Maximum number of consecutive failures to allow before shutting down\r\n#  JupyterHub.\r\n#  \r\n#  This helps JupyterHub recover from a certain class of problem preventing\r\n#  launch in contexts where the Hub is automatically restarted (e.g. systemd,\r\n#  docker, kubernetes).\r\n#  \r\n#  A limit of 0 means no limit and consecutive failures will not be tracked.\r\n#  Default: 0\r\n# c.Spawner.consecutive_failure_limit = 0\r\n\r\n## Minimum number of cpu-cores a single-user notebook server is guaranteed to\r\n#  have available.\r\n#  \r\n#  If this value is set to 0.5, allows use of 50% of one CPU. If this value is\r\n#  set to 2, allows use of up to 2 CPUs.\r\n#  \r\n#  **This is a configuration setting. Your spawner must implement support for the\r\n#  limit to work.** The default spawner, `LocalProcessSpawner`, does **not**\r\n#  implement this support. A custom spawner **must** add support for this setting\r\n#  for it to be enforced.\r\n#  Default: None\r\n# c.Spawner.cpu_guarantee = None\r\n\r\n## Maximum number of cpu-cores a single-user notebook server is allowed to use.\r\n#  \r\n#  If this value is set to 0.5, allows use of 50% of one CPU. If this value is\r\n#  set to 2, allows use of up to 2 CPUs.\r\n#  \r\n#  The single-user notebook server will never be scheduled by the kernel to use\r\n#  more cpu-cores than this. There is no guarantee that it can access this many\r\n#  cpu-cores.\r\n#  \r\n#  **This is a configuration setting. Your spawner must implement support for the\r\n#  limit to work.** The default spawner, `LocalProcessSpawner`, does **not**\r\n#  implement this support. A custom spawner **must** add support for this setting\r\n#  for it to be enforced.\r\n#  Default: None\r\n# c.Spawner.cpu_limit = None\r\n\r\n## Enable debug-logging of the single-user server\r\n#  Default: False\r\n# c.Spawner.debug = False\r\n\r\n## The URL the single-user server should start in.\r\n#  \r\n#  `{username}` will be expanded to the user's username\r\n#  \r\n#  Example uses:\r\n#  \r\n#  - You can set `notebook_dir` to `/` and `default_url` to `/tree/home/{username}` to allow people to\r\n#    navigate the whole filesystem from their notebook server, but still start in their home directory.\r\n#  - Start with `/notebooks` instead of `/tree` if `default_url` points to a notebook instead of a directory.\r\n#  - You can set this to `/lab` to have JupyterLab start by default, rather than Jupyter Notebook.\r\n#  Default: ''\r\n# c.Spawner.default_url = ''\r\n\r\n## Disable per-user configuration of single-user servers.\r\n#  \r\n#  When starting the user's single-user server, any config file found in the\r\n#  user's $HOME directory will be ignored.\r\n#  \r\n#  Note: a user could circumvent this if the user modifies their Python\r\n#  environment, such as when they have their own conda environments / virtualenvs\r\n#  / containers.\r\n#  Default: False\r\n# c.Spawner.disable_user_config = False\r\n\r\n## List of environment variables for the single-user server to inherit from the\r\n#  JupyterHub process.\r\n#  \r\n#  This list is used to ensure that sensitive information in the JupyterHub\r\n#  process's environment (such as `CONFIGPROXY_AUTH_TOKEN`) is not passed to the\r\n#  single-user server's process.\r\n#  Default: ['PATH', 'PYTHONPATH', 'CONDA_ROOT', 'CONDA_DEFAULT_ENV', 'VIRTUAL_ENV', 'LANG', 'LC_ALL', 'JUPYTERHUB_SIN\r\nGLEUSER_APP']\r\n# c.Spawner.env_keep = ['PATH', 'PYTHONPATH', 'CONDA_ROOT', 'CONDA_DEFAULT_ENV', 'VIRTUAL_ENV', 'LANG', 'LC_ALL', 'JUP\r\nYTERHUB_SINGLEUSER_APP']\r\n\r\n## Extra environment variables to set for the single-user server's process.\r\n#  \r\n#  Environment variables that end up in the single-user server's process come from 3 sources:\r\n#    - This `environment` configurable\r\n#    - The JupyterHub process' environment variables that are listed in `env_keep`\r\n#    - Variables to establish contact between the single-user notebook and the hub (such as JUPYTERHUB_API_TOKEN)\r\n#  \r\n#  The `environment` configurable should be set by JupyterHub administrators to\r\n#  add installation specific environment variables. It is a dict where the key is\r\n#  the name of the environment variable, and the value can be a string or a\r\n#  callable. If it is a callable, it will be called with one parameter (the\r\n#  spawner instance), and should return a string fairly quickly (no blocking\r\n#  operations please!).\r\n#  \r\n#  Note that the spawner class' interface is not guaranteed to be exactly same\r\n#  across upgrades, so if you are using the callable take care to verify it\r\n#  continues to work after upgrades!\r\n#  \r\n#  .. versionchanged:: 1.2\r\n#      environment from this configuration has highest priority,\r\n#      allowing override of 'default' env variables,\r\n#      such as JUPYTERHUB_API_URL.\r\n#  Default: {}\r\n# c.Spawner.environment = {}\r\n\r\n## Timeout (in seconds) before giving up on a spawned HTTP server\r\n#  \r\n#  Once a server has successfully been spawned, this is the amount of time we\r\n#  wait before assuming that the server is unable to accept connections.\r\n#  Default: 30\r\n# c.Spawner.http_timeout = 30\r\n\r\n## The IP address (or hostname) the single-user server should listen on.\r\n#  \r\n#  The JupyterHub proxy implementation should be able to send packets to this\r\n#  interface.\r\n#  Default: ''\r\n# c.Spawner.ip = ''\r\n\r\n## Minimum number of bytes a single-user notebook server is guaranteed to have\r\n#  available.\r\n#  \r\n#  Allows the following suffixes:\r\n#    - K -> Kilobytes\r\n#    - M -> Megabytes\r\n#    - G -> Gigabytes\r\n#    - T -> Terabytes\r\n#  \r\n#  **This is a configuration setting. Your spawner must implement support for the\r\n#  limit to work.** The default spawner, `LocalProcessSpawner`, does **not**\r\n#  implement this support. A custom spawner **must** add support for this setting\r\n#  for it to be enforced.\r\n#  Default: None\r\n# c.Spawner.mem_guarantee = None\r\n\r\n## Maximum number of bytes a single-user notebook server is allowed to use.\r\n#  \r\n#  Allows the following suffixes:\r\n#    - K -> Kilobytes\r\n#    - M -> Megabytes\r\n#    - G -> Gigabytes\r\n#    - T -> Terabytes\r\n#  \r\n#  If the single user server tries to allocate more memory than this, it will\r\n#  fail. There is no guarantee that the single-user notebook server will be able\r\n#  to allocate this much memory - only that it can not allocate more than this.\r\n#  \r\n#  **This is a configuration setting. Your spawner must implement support for the\r\n#  limit to work.** The default spawner, `LocalProcessSpawner`, does **not**\r\n#  implement this support. A custom spawner **must** add support for this setting\r\n#  for it to be enforced.\r\n#  Default: None\r\n# c.Spawner.mem_limit = None\r\n\r\n## Path to the notebook directory for the single-user server.\r\n#  \r\n#  The user sees a file listing of this directory when the notebook interface is\r\n#  started. The current interface does not easily allow browsing beyond the\r\n#  subdirectories in this directory's tree.\r\n#  \r\n#  `~` will be expanded to the home directory of the user, and {username} will be\r\n#  replaced with the name of the user.\r\n#  \r\n#  Note that this does *not* prevent users from accessing files outside of this\r\n#  path! They can do so with many other means.\r\n#  Default: ''\r\n# c.Spawner.notebook_dir = ''\r\n\r\n## An HTML form for options a user can specify on launching their server.\r\n#  \r\n#  The surrounding `<form>` element and the submit button are already provided.\r\n#  \r\n#  For example:\r\n#  \r\n#  .. code:: html\r\n#  \r\n#      Set your key:\r\n#      <input name=\"key\" val=\"default_key\"></input>\r\n#      <br>\r\n#      Choose a letter:\r\n#      <select name=\"letter\" multiple=\"true\">\r\n#        <option value=\"A\">The letter A</option>\r\n#        <option value=\"B\">The letter B</option>\r\n#      </select>\r\n#  \r\n#  The data from this form submission will be passed on to your spawner in\r\n#  `self.user_options`\r\n#  \r\n#  Instead of a form snippet string, this could also be a callable that takes as\r\n#  one parameter the current spawner instance and returns a string. The callable\r\n#  will be called asynchronously if it returns a future, rather than a str. Note\r\n#  that the interface of the spawner class is not deemed stable across versions,\r\n#  so using this functionality might cause your JupyterHub upgrades to break.\r\n#  Default: traitlets.Undefined\r\n# c.Spawner.options_form = traitlets.Undefined\r\n\r\n## Interpret HTTP form data\r\n#  \r\n#  Form data will always arrive as a dict of lists of strings. Override this\r\n#  function to understand single-values, numbers, etc.\r\n#  \r\n#  This should coerce form data into the structure expected by self.user_options,\r\n#  which must be a dict, and should be JSON-serializeable, though it can contain\r\n#  bytes in addition to standard JSON data types.\r\n#  \r\n#  This method should not have any side effects. Any handling of `user_options`\r\n#  should be done in `.start()` to ensure consistent behavior across servers\r\n#  spawned via the API and form submission page.\r\n#  \r\n#  Instances will receive this data on self.user_options, after passing through\r\n#  this function, prior to `Spawner.start`.\r\n#  \r\n#  .. versionchanged:: 1.0\r\n#      user_options are persisted in the JupyterHub database to be reused\r\n#      on subsequent spawns if no options are given.\r\n#      user_options is serialized to JSON as part of this persistence\r\n#      (with additional support for bytes in case of uploaded file data),\r\n#      and any non-bytes non-jsonable values will be replaced with None\r\n#      if the user_options are re-used.\r\n#  Default: traitlets.Undefined\r\n# c.Spawner.options_from_form = traitlets.Undefined\r\n\r\n## Interval (in seconds) on which to poll the spawner for single-user server's\r\n#  status.\r\n#  \r\n#  At every poll interval, each spawner's `.poll` method is called, which checks\r\n#  if the single-user server is still running. If it isn't running, then\r\n#  JupyterHub modifies its own state accordingly and removes appropriate routes\r\n#  from the configurable proxy.\r\n#  Default: 30\r\n# c.Spawner.poll_interval = 30\r\n\r\n## The port for single-user servers to listen on.\r\n#  \r\n#  Defaults to `0`, which uses a randomly allocated port number each time.\r\n#  \r\n#  If set to a non-zero value, all Spawners will use the same port, which only\r\n#  makes sense if each server is on a different address, e.g. in containers.\r\n#  \r\n#  New in version 0.7.\r\n#  Default: 0\r\n# c.Spawner.port = 0\r\n\r\n## An optional hook function that you can implement to do work after the spawner\r\n#  stops.\r\n#  \r\n#  This can be set independent of any concrete spawner implementation.\r\n#  Default: None\r\n# c.Spawner.post_stop_hook = None\r\n\r\n## An optional hook function that you can implement to do some bootstrapping work\r\n#  before the spawner starts. For example, create a directory for your user or\r\n#  load initial content.\r\n#  \r\n#  This can be set independent of any concrete spawner implementation.\r\n#  \r\n#  This maybe a coroutine.\r\n#  \r\n#  Example::\r\n#  \r\n#      from subprocess import check_call\r\n#      def my_hook(spawner):\r\n#          username = spawner.user.name\r\n#          check_call(['./examples/bootstrap-script/bootstrap.sh', username])\r\n#  \r\n#      c.Spawner.pre_spawn_hook = my_hook\r\n#  Default: None\r\n# c.Spawner.pre_spawn_hook = None\r\n\r\n## List of SSL alt names\r\n#  \r\n#  May be set in config if all spawners should have the same value(s), or set at\r\n#  runtime by Spawner that know their names.\r\n#  Default: []\r\n# c.Spawner.ssl_alt_names = []\r\n\r\n## Whether to include DNS:localhost, IP:127.0.0.1 in alt names\r\n#  Default: True\r\n# c.Spawner.ssl_alt_names_include_local = True\r\n\r\n## Timeout (in seconds) before giving up on starting of single-user server.\r\n#  \r\n#  This is the timeout for start to return, not the timeout for the server to\r\n#  respond. Callers of spawner.start will assume that startup has failed if it\r\n#  takes longer than this. start should return when the server process is started\r\n#  and its location is known.\r\n#  Default: 60\r\n# c.Spawner.start_timeout = 60\r\n\r\n#------------------------------------------------------------------------------\r\n# Authenticator(LoggingConfigurable) configuration\r\n#------------------------------------------------------------------------------\r\n## Base class for implementing an authentication provider for JupyterHub\r\n\r\n## Set of users that will have admin rights on this JupyterHub.\r\n#  \r\n#  Admin users have extra privileges:\r\n#   - Use the admin panel to see list of users logged in\r\n#   - Add / remove users in some authenticators\r\n#   - Restart / halt the hub\r\n#   - Start / stop users' single-user servers\r\n#   - Can access each individual users' single-user server (if configured)\r\n#  \r\n#  Admin access should be treated the same way root access is.\r\n#  \r\n#  Defaults to an empty set, in which case no user has admin access.\r\n#  Default: set()\r\n# c.Authenticator.admin_users = set()\r\n\r\n## Set of usernames that are allowed to log in.\r\n#  \r\n#  Use this with supported authenticators to restrict which users can log in.\r\n#  This is an additional list that further restricts users, beyond whatever\r\n#  restrictions the authenticator has in place.\r\n#  \r\n#  If empty, does not perform any additional restriction.\r\n#  \r\n#  .. versionchanged:: 1.2\r\n#      `Authenticator.whitelist` renamed to `allowed_users`\r\n#  Default: set()\r\n# c.Authenticator.allowed_users = set()\r\n\r\n## The max age (in seconds) of authentication info before forcing a refresh of\r\n#  user auth info.\r\n#  \r\n#  Refreshing auth info allows, e.g. requesting/re-validating auth tokens.\r\n#  \r\n#  See :meth:`.refresh_user` for what happens when user auth info is refreshed\r\n#  (nothing by default).\r\n#  Default: 300\r\n# c.Authenticator.auth_refresh_age = 300\r\n\r\n## Automatically begin the login process\r\n#  \r\n#  rather than starting with a \"Login with...\" link at `/hub/login`\r\n#  \r\n#  To work, `.login_url()` must give a URL other than the default `/hub/login`,\r\n#  such as an oauth handler or another automatic login handler, registered with\r\n#  `.get_handlers()`.\r\n#  \r\n#  .. versionadded:: 0.8\r\n#  Default: False\r\n# c.Authenticator.auto_login = False\r\n\r\n## Set of usernames that are not allowed to log in.\r\n#  \r\n#  Use this with supported authenticators to restrict which users can not log in.\r\n#  This is an additional block list that further restricts users, beyond whatever\r\n#  restrictions the authenticator has in place.\r\n#  \r\n#  If empty, does not perform any additional restriction.\r\n#  \r\n#  .. versionadded: 0.9\r\n#  \r\n#  .. versionchanged:: 1.2\r\n#      `Authenticator.blacklist` renamed to `blocked_users`\r\n#  Default: set()\r\n# c.Authenticator.blocked_users = set()\r\n\r\n## Delete any users from the database that do not pass validation\r\n#  \r\n#  When JupyterHub starts, `.add_user` will be called on each user in the\r\n#  database to verify that all users are still valid.\r\n#  \r\n#  If `delete_invalid_users` is True, any users that do not pass validation will\r\n#  be deleted from the database. Use this if users might be deleted from an\r\n#  external system, such as local user accounts.\r\n#  \r\n#  If False (default), invalid users remain in the Hub's database and a warning\r\n#  will be issued. This is the default to avoid data loss due to config changes.\r\n#  Default: False\r\n# c.Authenticator.delete_invalid_users = False\r\n\r\n## Enable persisting auth_state (if available).\r\n#  \r\n#  auth_state will be encrypted and stored in the Hub's database. This can\r\n#  include things like authentication tokens, etc. to be passed to Spawners as\r\n#  environment variables.\r\n#  \r\n#  Encrypting auth_state requires the cryptography package.\r\n#  \r\n#  Additionally, the JUPYTERHUB_CRYPT_KEY environment variable must contain one\r\n#  (or more, separated by ;) 32B encryption keys. These can be either base64 or\r\n#  hex-encoded.\r\n#  \r\n#  If encryption is unavailable, auth_state cannot be persisted.\r\n#  \r\n#  New in JupyterHub 0.8\r\n#  Default: False\r\n# c.Authenticator.enable_auth_state = False\r\n\r\n## An optional hook function that you can implement to do some bootstrapping work\r\n#  during authentication. For example, loading user account details from an\r\n#  external system.\r\n#  \r\n#  This function is called after the user has passed all authentication checks\r\n#  and is ready to successfully authenticate. This function must return the\r\n#  authentication dict reguardless of changes to it.\r\n#  \r\n#  This maybe a coroutine.\r\n#  \r\n#  .. versionadded: 1.0\r\n#  \r\n#  Example::\r\n#  \r\n#      import os, pwd\r\n#      def my_hook(authenticator, handler, authentication):\r\n#          user_data = pwd.getpwnam(authentication['name'])\r\n#          spawn_data = {\r\n#              'pw_data': user_data\r\n#              'gid_list': os.getgrouplist(authentication['name'], user_data.pw_gid)\r\n#          }\r\n#  \r\n#          if authentication['auth_state'] is None:\r\n#              authentication['auth_state'] = {}\r\n#          authentication['auth_state']['spawn_data'] = spawn_data\r\n#  \r\n#          return authentication\r\n#  \r\n#      c.Authenticator.post_auth_hook = my_hook\r\n#  Default: None\r\n# c.Authenticator.post_auth_hook = None\r\n\r\n## Force refresh of auth prior to spawn.\r\n#  \r\n#  This forces :meth:`.refresh_user` to be called prior to launching a server, to\r\n#  ensure that auth state is up-to-date.\r\n#  \r\n#  This can be important when e.g. auth tokens that may have expired are passed\r\n#  to the spawner via environment variables from auth_state.\r\n#  \r\n#  If refresh_user cannot refresh the user auth data, launch will fail until the\r\n#  user logs in again.\r\n#  Default: False\r\n# c.Authenticator.refresh_pre_spawn = False\r\n\r\n## Dictionary mapping authenticator usernames to JupyterHub users.\r\n#  \r\n#  Primarily used to normalize OAuth user names to local users.\r\n#  Default: {}\r\n# c.Authenticator.username_map = {}\r\n\r\n## Regular expression pattern that all valid usernames must match.\r\n#  \r\n#  If a username does not match the pattern specified here, authentication will\r\n#  not be attempted.\r\n#  \r\n#  If not set, allow any username.\r\n#  Default: ''\r\n# c.Authenticator.username_pattern = ''\r\n\r\n## Deprecated, use `Authenticator.allowed_users`\r\n#  Default: set()\r\n# c.Authenticator.whitelist = set()\r\n\r\n#------------------------------------------------------------------------------\r\n# CryptKeeper(SingletonConfigurable) configuration\r\n#------------------------------------------------------------------------------\r\n## Encapsulate encryption configuration\r\n#  \r\n#  Use via the encryption_config singleton below.\r\n\r\n#  Default: []\r\n# c.CryptKeeper.keys = []\r\n\r\n## The number of threads to allocate for encryption\r\n#  Default: 4\r\n# c.CryptKeeper.n_threads = 4\r\n\r\n#------------------------------------------------------------------------------\r\n# Pagination(Configurable) configuration\r\n#------------------------------------------------------------------------------\r\n## Default number of entries per page for paginated results.\r\n#  Default: 100\r\n# c.Pagination.default_per_page = 100\r\n\r\n## Maximum number of entries per page for paginated results.\r\n#  Default: 250\r\n# c.Pagination.max_per_page = 250\r\nc.ConfigurableHTTPProxy.command = '/opt/anaconda3/bin/configurable-http-proxy'\r\nc.PAMAuthenticator.open_sessions = False\r\nc = get_config()\r\nc.JupyterHub.bind_url = 'http://localhost:8000'\r\nc.JupyterHub.hub_ip='localhost'\r\n\r\n```\r\n</details>\r\n\r\n- <details><summary>Logs</summary>\r\n<!--\r\nErrors are often logged by jupytehub. How you get logs depends on your deployment.\r\nWith kubernetes it might be:\r\n\r\n    kubectl get pod # hub pod name starts with hub...\r\n    kubectl logs hub-...\r\n    # or for a single-user server\r\n    kubectl logs jupyter-username\r\n\r\nOr the-littlest-jupyterhub:\r\n\r\n    journalctl -u jupyterhub\r\n    # or for a single-user server\r\n    journalctl -u jupyter-username\r\n-->\r\n\r\n```\r\n# paste relevant logs here, if any\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3440/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3440/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3426", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3426/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3426/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3426/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3426", "id": 858704102, "node_id": "MDExOlB1bGxSZXF1ZXN0NjE1OTAwNTM2", "number": 3426, "title": "[rbac] Fix log message for modifying existing roles", "user": {"login": "IvanaH8", "id": 12073028, "node_id": "MDQ6VXNlcjEyMDczMDI4", "avatar_url": "https://avatars.githubusercontent.com/u/12073028?v=4", "gravatar_id": "", "url": "https://api.github.com/users/IvanaH8", "html_url": "https://github.com/IvanaH8", "followers_url": "https://api.github.com/users/IvanaH8/followers", "following_url": "https://api.github.com/users/IvanaH8/following{/other_user}", "gists_url": "https://api.github.com/users/IvanaH8/gists{/gist_id}", "starred_url": "https://api.github.com/users/IvanaH8/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/IvanaH8/subscriptions", "organizations_url": "https://api.github.com/users/IvanaH8/orgs", "repos_url": "https://api.github.com/users/IvanaH8/repos", "events_url": "https://api.github.com/users/IvanaH8/events{/privacy}", "received_events_url": "https://api.github.com/users/IvanaH8/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-04-15T09:47:19Z", "updated_at": "2021-04-19T09:47:53Z", "closed_at": "2021-04-15T12:26:07Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3426", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3426", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3426.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3426.patch", "merged_at": "2021-04-15T12:26:06Z"}, "body": "- Fixes the log message about modifying existing role (in `_overwrite_role()`) appearing on next startup even if the role definition in config file not modified.\r\n- Adds the possibility to tests in `create_roles()` and simplifies the test.\r\n- Removes duplicate `scopes` assignment in `expand_roles_to_scopes()`.\r\n\r\n@0mar, @minrk could you have a quick look? \r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3426/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3426/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3402", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3402/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3402/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3402/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3402", "id": 851855357, "node_id": "MDU6SXNzdWU4NTE4NTUzNTc=", "number": 3402, "title": "Spawn failed: Server didn't respond in 30 seconds (dockerSpawner). How to increase the timeout value?", "user": {"login": "nmvega", "id": 4001382, "node_id": "MDQ6VXNlcjQwMDEzODI=", "avatar_url": "https://avatars.githubusercontent.com/u/4001382?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nmvega", "html_url": "https://github.com/nmvega", "followers_url": "https://api.github.com/users/nmvega/followers", "following_url": "https://api.github.com/users/nmvega/following{/other_user}", "gists_url": "https://api.github.com/users/nmvega/gists{/gist_id}", "starred_url": "https://api.github.com/users/nmvega/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nmvega/subscriptions", "organizations_url": "https://api.github.com/users/nmvega/orgs", "repos_url": "https://api.github.com/users/nmvega/repos", "events_url": "https://api.github.com/users/nmvega/events{/privacy}", "received_events_url": "https://api.github.com/users/nmvega/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-04-06T22:29:12Z", "updated_at": "2021-04-06T23:04:41Z", "closed_at": "2021-04-06T22:48:04Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hello Friends:\r\n\r\nHow do I increase the timeout when spawning a `dockerSpawned` notebook server? At launch-time inside the container, I'm running a `script` within the `/usr/local/bin/before-notebook.d/` directory (`hook`), and need more time for it to complete.\r\n\r\nI thought I saw a way to tweak this timeout (a few months ago), but cannot seem to find it.\r\n\r\nThank you in advance!", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3402/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3402/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3399", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3399/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3399/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3399/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3399", "id": 851231061, "node_id": "MDU6SXNzdWU4NTEyMzEwNjE=", "number": 3399, "title": "@-sign in username causes missing fonts for ipywidgets, the @-sign in the font URLs is replaced by %40", "user": {"login": "mariobuikhuizen", "id": 46192475, "node_id": "MDQ6VXNlcjQ2MTkyNDc1", "avatar_url": "https://avatars.githubusercontent.com/u/46192475?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mariobuikhuizen", "html_url": "https://github.com/mariobuikhuizen", "followers_url": "https://api.github.com/users/mariobuikhuizen/followers", "following_url": "https://api.github.com/users/mariobuikhuizen/following{/other_user}", "gists_url": "https://api.github.com/users/mariobuikhuizen/gists{/gist_id}", "starred_url": "https://api.github.com/users/mariobuikhuizen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mariobuikhuizen/subscriptions", "organizations_url": "https://api.github.com/users/mariobuikhuizen/orgs", "repos_url": "https://api.github.com/users/mariobuikhuizen/repos", "events_url": "https://api.github.com/users/mariobuikhuizen/events{/privacy}", "received_events_url": "https://api.github.com/users/mariobuikhuizen/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2021-04-06T09:21:07Z", "updated_at": "2021-04-08T11:35:22Z", "closed_at": "2021-04-08T11:35:22Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\n@-sign in username causes missing fonts for ipywidgets, the @-sign in the font URLs is replaced by `%40`\r\n\r\nFor font files the @-sign is replaced by `%40`: http://localhost:8000/user/test%40test/nbextensions/jupyter-vuetify/d0066537ab6a4c6f8285a5aeb3ba5f09.woff2\r\n\r\nFor .js files the URL is correct: http://localhost:8000/user/test@test/nbextensions/jupyter-vuetify/index.js?v=20210406084436\r\n\r\nAlso, replacing `%40` with `@` of a font URL in the address bar of the browser downloads the font\r\n\r\n### How to reproduce\r\nDockerfile:\r\n```\r\nFROM jupyterhub/jupyterhub\r\n\r\nRUN pip install jupyter ipyvuetify\r\n\r\nRUN useradd -m test@test -p \"$(openssl passwd -1 test)\"\r\n\r\nRUN echo '\\\r\n{\\n\\\r\n \"cells\": [\\n\\\r\n  {\\n\\\r\n   \"cell_type\": \"code\",\\n\\\r\n   \"execution_count\": null,\\n\\\r\n   \"id\": \"20861218\",\\n\\\r\n   \"metadata\": {},\\n\\\r\n   \"outputs\": [],\\n\\\r\n   \"source\": [\\n\\\r\n     \"import ipyvuetify as v\\\\n\",\\n\\\r\n     \"\\\\n\",\\n\\\r\n     \"v.Icon(children=[\\\\\"mdi-thumb-up\\\\\"])\"\\n\\\r\n   ]\\n\\\r\n  }\\n\\\r\n ],\\n\\\r\n \"metadata\": {\\n\\\r\n  \"kernelspec\": {\\n\\\r\n   \"display_name\": \"Python 3\",\\n\\\r\n   \"language\": \"python\",\\n\\\r\n   \"name\": \"python3\"\\n\\\r\n  },\\n\\\r\n  \"language_info\": {\\n\\\r\n   \"codemirror_mode\": {\\n\\\r\n    \"name\": \"ipython\",\\n\\\r\n    \"version\": 3\\n\\\r\n   },\\n\\\r\n   \"file_extension\": \".py\",\\n\\\r\n   \"mimetype\": \"text/x-python\",\\n\\\r\n   \"name\": \"python\",\\n\\\r\n   \"nbconvert_exporter\": \"python\",\\n\\\r\n   \"pygments_lexer\": \"ipython3\",\\n\\\r\n   \"version\": \"3.8.2\"\\n\\\r\n  }\\n\\\r\n },\\n\\\r\n \"nbformat\": 4,\\n\\\r\n \"nbformat_minor\": 5\\n\\\r\n}' > /home/test@test/fonts.ipynb &&\\\r\n chown test@test /home/test@test/fonts.ipynb\r\n```\r\n1. `docker build -t atsign .`\r\n2. `docker run -ti --rm -p 8000:8000 --name jupyterhub atsign jupyterhub`\r\n3. Go to http://localhost:8000 in the browser\r\n4. Login with `test@test` password: `test`\r\n5. Open notebook fonts.ipynb\r\n6. Open network tab in dev-tools in the browser\r\n7. Reload page\r\n8. Execute notebook\r\n9. Find 404 status on the fonts being loaded  .woff2, .woff and ttf)\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3399/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3399/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3388", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3388/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3388/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3388/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3388", "id": 837657760, "node_id": "MDExOlB1bGxSZXF1ZXN0NTk3OTYxMTQ0", "number": 3388, "title": "[rbac] ensure /authorizations/token can read the owner model of the token itself", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-03-22T12:13:21Z", "updated_at": "2021-04-12T14:39:23Z", "closed_at": "2021-03-23T13:39:54Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3388", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3388", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3388.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3388.patch", "merged_at": "2021-03-23T13:39:54Z"}, "body": "This fixes the failing rbac test\n\nThe case was when one user attempts to access the other user's server, an API request is made to:\n\n`/api/authorizations/token/:visitor-token` with the server owner's token in the Authorization header.\n\nThis meant there were really two tokens involved in the same request, and if the server didn't have permission to read the visitor's user model, the return would be an empty dict instead of the visitor's name, etc.\n\nEnsuring that the token owner's read scope is added prior to resolving the model fixes this,\nbut we should really deprecate this strategy in favor of user `/api/user` 'self' handler to resolve token owners.\nThat would be much more like other OAuth providers. We can also take this big refactor opportunity to remove the old 'shared cookie' auth that has been deprecated for a long time. I will take a stab at that.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3388/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3388/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3377", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3377/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3377/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3377/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3377", "id": 825563767, "node_id": "MDExOlB1bGxSZXF1ZXN0NTg3NjQ1Nzgx", "number": 3377, "title": "always start redirect count at 1 when redirecting /hub/user/:name -> /user/:name", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-03-09T08:58:47Z", "updated_at": "2021-03-10T07:01:36Z", "closed_at": "2021-03-09T13:04:16Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3377", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3377", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3377.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3377.patch", "merged_at": "2021-03-09T13:04:16Z"}, "body": "`/hub/user/:name` is now only reasonably visited as a result of redirect from `/user/:name`\r\n\r\nThe multi-redirect spawn-pending behavior means that the referer check was unreliable, so the exponential backoff counter would sometimes not start.\r\n\r\ncloses #3378", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3377/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3377/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3370", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3370/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3370/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3370/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3370", "id": 820024577, "node_id": "MDExOlB1bGxSZXF1ZXN0NTgzMDM3MTg4", "number": 3370, "title": "Always raise on failed token creation", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-03-02T13:35:02Z", "updated_at": "2021-04-12T14:39:58Z", "closed_at": "2021-03-05T10:02:04Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3370", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3370", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3370.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3370.patch", "merged_at": "2021-03-05T10:02:03Z"}, "body": "the logic was there but at the wrong indentation level causing it to only raise sometimes, when it should always raise.\r\n\r\ncloses #3367, which creates a token that fails [check_token](https://github.com/jupyterhub/jupyterhub/blob/1.3.0/jupyterhub/orm.py#L394).", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3370/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3370/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3368", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3368/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3368/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3368/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3368", "id": 813355039, "node_id": "MDU6SXNzdWU4MTMzNTUwMzk=", "number": 3368, "title": "Constantly reconnect to kernels", "user": {"login": "372046933", "id": 1251167, "node_id": "MDQ6VXNlcjEyNTExNjc=", "avatar_url": "https://avatars.githubusercontent.com/u/1251167?v=4", "gravatar_id": "", "url": "https://api.github.com/users/372046933", "html_url": "https://github.com/372046933", "followers_url": "https://api.github.com/users/372046933/followers", "following_url": "https://api.github.com/users/372046933/following{/other_user}", "gists_url": "https://api.github.com/users/372046933/gists{/gist_id}", "starred_url": "https://api.github.com/users/372046933/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/372046933/subscriptions", "organizations_url": "https://api.github.com/users/372046933/orgs", "repos_url": "https://api.github.com/users/372046933/repos", "events_url": "https://api.github.com/users/372046933/events{/privacy}", "received_events_url": "https://api.github.com/users/372046933/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 1280242352, "node_id": "MDU6TGFiZWwxMjgwMjQyMzUy", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/support", "name": "support", "color": "Cfaef7", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2021-02-22T10:17:09Z", "updated_at": "2021-02-23T02:43:47Z", "closed_at": "2021-02-22T10:48:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\nBrowser websocket constantly reconnecting to kernel. Got the following logs in browser's console log.\r\n\r\n```\r\nStarting WebSockets: ws://example.domain/user/taoxu/api/kernels/8eb032df-4ad3-4f4c-97df-a0849b92a949\r\nkernel.js:106 Kernel: kernel_connected (8eb032df-4ad3-4f4c-97df-a0849b92a949)\r\nkernel.js:106 Kernel: kernel_ready (8eb032df-4ad3-4f4c-97df-a0849b92a949)\r\nkernel.js:474 WebSocket closed early CloseEvent\u00a0{isTrusted: true, wasClean: false, code: 1006, reason: \"\", type: \"close\",\u00a0\u2026}bubbles: falsecancelBubble: falsecancelable: falsecode: 1006composed: falsecurrentTarget: WebSocket\u00a0{url: \"ws://example.domain/user/taoxu/api/kernels\u2026nnels?session_id=a5c692b26e6a418c8dd6a10042a5ffb1\", readyState: 3, bufferedAmount: 0, onopen: \u0192, onerror: \u0192,\u00a0\u2026}defaultPrevented: falseeventPhase: 0isTrusted: truepath: []reason: \"\"returnValue: truesrcElement: WebSocket\u00a0{url: \"ws://example.domain/user/taoxu/api/kernels\u2026nnels?session_id=a5c692b26e6a418c8dd6a10042a5ffb1\", readyState: 3, bufferedAmount: 0, onopen: \u0192, onerror: \u0192,\u00a0\u2026}target: WebSocket\u00a0{url: \"ws://example.domain/user/taoxu/api/kernels\u2026nnels?session_id=a5c692b26e6a418c8dd6a10042a5ffb1\", readyState: 3, bufferedAmount: 0, onopen: \u0192, onerror: \u0192,\u00a0\u2026}timeStamp: 6077.57500000298type: \"close\"wasClean: false__proto__: CloseEvent\r\nkernel.js:106 Kernel: kernel_disconnected (8eb032df-4ad3-4f4c-97df-a0849b92a949)\r\nkernel.js:564 Connection lost, reconnecting in 1 seconds.\r\nkernel.js:106 Kernel: kernel_reconnecting (8eb032df-4ad3-4f4c-97df-a0849b92a949)\r\nkernel.js:463 Starting WebSockets: ws://example.domain/user/taoxu/api/kernels/8eb032df-4ad3-4f4c-97df-a0849b92a949\r\nkernel.js:106 Kernel: kernel_connected (8eb032df-4ad3-4f4c-97df-a0849b92a949)\r\nkernel.js:106 Kernel: kernel_ready (8eb032df-4ad3-4f4c-97df-a0849b92a949)\r\nkernel.js:474 \r\n```\r\nThe browsers continues sending `api/kernels/KERNEL_ID` and `api/kernels/KERNEL_ID/channels` websocket requests.\r\n\r\n`api/kernels/KERNEL_ID` returns \r\n```json\r\n{\"id\": \"8eb032df-4ad3-4f4c-97df-a0849b92a949\", \r\n\"name\": \"python3\", \r\n\"last_activity\": \"2021-02-22T10:01:57.304252Z\", \r\n\"execution_state\": \"idle\", \r\n\"connections\": 0\r\n}\r\n```\r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\nWebsocket connection to kernel should be ok\r\n\r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\nSee bug description\r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\n1. Spawn a server\r\n2. Open a notebook server\r\n3. Open console in browser's develop tools\r\n4. See error\r\n\r\n### Your personal set up\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n\r\n - OS: Ubuntu 20.04\r\n <!-- [e.g. ubuntu 20.04, macOS 11.0] -->\r\n - Version(s): jupyterhub 1.3.0, python 3.8.5\r\n <!-- e.g. jupyterhub --version, python --version --->\r\n\r\n- <details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\nbsl-py==0.11.0\r\nalembic==1.5.5\r\nargon2-cffi==20.1.0\r\nasync-generator==1.10\r\nattrs==20.3.0\r\nbackcall==0.2.0\r\nbleach==3.3.0\r\ncertifi==2020.12.5\r\ncertipy==0.1.3\r\ncffi==1.14.5\r\nchardet==4.0.0\r\ncryptography==3.4.6\r\ndecorator==4.4.2\r\ndefusedxml==0.6.0\r\nentrypoints==0.3\r\nfuture==0.18.2\r\nidna==2.10\r\nipykernel==5.5.0\r\nipython==7.20.0\r\nipython-genutils==0.2.0\r\njedi==0.18.0\r\nJinja2==2.11.3\r\njsonschema==3.2.0\r\njupyter-client==6.1.11\r\njupyter-core==4.7.1\r\njupyter-telemetry==0.1.0\r\n# Editable install with no version control (jupyterhub==1.3.0)\r\n-e /data/app/jupyter\r\njupyterlab-pygments==0.1.2\r\nMako==1.1.4\r\nMarkupSafe==1.1.1\r\nmistune==0.8.4\r\nmysqlclient==1.4.4\r\nnbclient==0.5.2\r\nnbconvert==6.0.7\r\nnbformat==5.1.2\r\nnest-asyncio==1.5.1\r\nnotebook==6.2.0\r\noauthlib==3.1.0\r\npackaging==20.9\r\npamela==1.0.0\r\npandocfilters==1.4.3\r\nparso==0.8.1\r\npexpect==4.8.0\r\npickleshare==0.7.5\r\nprometheus-client==0.9.0\r\nprompt-toolkit==3.0.16\r\nptyprocess==0.7.0\r\npycparser==2.20\r\npycurl==7.43.0.2\r\nPygments==2.8.0\r\npyOpenSSL==20.0.1\r\npyparsing==2.4.7\r\npyrsistent==0.17.3\r\npython-dateutil==2.8.1\r\npython-discovery-client==0.5\r\npython-editor==1.0.4\r\npython-json-logger==2.0.1\r\npyzmq==22.0.3\r\nrequests==2.25.1\r\nruamel.yaml==0.16.12\r\nruamel.yaml.clib==0.2.2\r\nSend2Trash==1.5.0\r\nsix==1.15.0\r\nSQLAlchemy==1.3.23\r\nterminado==0.9.2\r\ntestpath==0.4.4\r\ntornado==6.1\r\ntraitlets==5.0.5\r\nurllib3==1.26.3\r\nwcwidth==0.2.5\r\nwebencodings==0.5.1\r\n```\r\n</details>\r\n\r\n- <details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```python\r\n# jupyterhub_config.py\r\nimport os\r\nimport shlex\r\nimport socket\r\nfrom jupyterhub.auth import DummyAuthenticator\r\n\r\nfrom jupyterhub.spawner import SimpleLocalProcessSpawner\r\n\r\n\r\nsock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\r\nsock.connect(('8.8.8.8', 53))\r\nLOCAL_IP = sock.getsockname()[0]\r\nsock.close()\r\n\r\nc = get_config() # type: ignore\r\n\r\n\r\nc.JupyterHub.spawner_class = SimpleLocalProcessSpawner\r\nc.JupyterHub.hub_ip = '0.0.0.0'\r\nc.JupyterHub.hub_connect_ip = LOCAL_IP\r\n\r\nc.JupyterHub.authenticator_class = DummyAuthenticator\r\n\r\n# Proxy\r\nc.JupyterHub.cleanup_servers = False\r\nc.ConfigurableHTTPProxy.should_start = False\r\nc.ConfigurableHTTPProxy.auth_token = \"xxx\"\r\nc.ConfigurableHTTPProxy.api_url = 'http://10.70.26.117:8001'\r\n\r\n# shutdown the server after no activity for 20 minutes\r\nc.NotebookApp.shutdown_no_activity_timeout = 20 * 60\r\n# shutdown kernels after no activity for 10 minutes\r\nc.MappingKernelManager.cull_idle_timeout = 10 * 60\r\n# cull connected (e.g. Browser tab open)\r\nc.MappingKernelManager.cull_connected=True\r\n\r\n\r\n```\r\n</details>\r\n\r\n- <details><summary>Logs</summary>\r\n<!--\r\nErrors are often logged by jupytehub. How you get logs depends on your deployment.\r\nWith kubernetes it might be:\r\n\r\n    kubectl get pod # hub pod name starts with hub...\r\n    kubectl logs hub-...\r\n    # or for a single-user server\r\n    kubectl logs jupyter-username\r\n\r\nOr the-littlest-jupyterhub:\r\n\r\n    journalctl -u jupyterhub\r\n    # or for a single-user server\r\n    journalctl -u jupyter-username\r\n-->\r\n\r\n```\r\nI 2021-02-22 18:14:47.228 SingleUserNotebookApp log:181] 200 GET /user/taoxu/api/kernels/8eb032df-4ad3-4f4c-97df-a0849b92a949?_=1613986889864 (taoxu@172.22.21.11) 1.12ms\r\n[I 2021-02-22 18:14:48.287 SingleUserNotebookApp log:181] 101 GET /user/taoxu/api/kernels/8eb032df-4ad3-4f4c-97df-a0849b92a949/channels?session_id=a5c692b26e6a418c8dd6a10042a5ffb1 (taoxu@172.22.21.11) 2.23ms\r\n[I 2021-02-22 18:14:48.287 SingleUserNotebookApp handlers:378] Restoring connection for 8eb032df-4ad3-4f4c-97df-a0849b92a949:a5c692b26e6a418c8dd6a10042a5ffb1\r\n[I 2021-02-22 18:14:49.085 SingleUserNotebookApp kernelmanager:222] Starting buffering for 8eb032df-4ad3-4f4c-97df-a0849b92a949:a5c692b26e6a418c8dd6a10042a5ffb1\r\n[I 2021-02-22 18:14:49.171 SingleUserNotebookApp log:181] 200 GET /user/taoxu/api/kernels/8eb032df-4ad3-4f4c-97df-a0849b92a949?_=1613986889865 (taoxu@172.22.21.3) 1.16ms\r\n[I 2021-02-22 18:14:50.243 SingleUserNotebookApp log:181] 101 GET /user/taoxu/api/kernels/8eb032df-4ad3-4f4c-97df-a0849b92a949/channels?session_id=a5c692b26e6a418c8dd6a10042a5ffb1 (taoxu@172.22.21.103) 2.10ms\r\n[I 2021-02-22 18:14:50.243 SingleUserNotebookApp handlers:378] Restoring connection for 8eb032df-4ad3-4f4c-97df-a0849b92a949:a5c692b26e6a418c8dd6a10042a5ffb1\r\n[I 2021-02-22 18:14:50.337 JupyterHub log:181] 302 GET /metrics -> /hub/metrics (@172.23.20.99) 0.70ms\r\n[I 2021-02-22 18:14:50.350 JupyterHub log:181] 200 GET /hub/metrics (@172.23.20.99) 6.84ms\r\n[I 2021-02-22 18:14:51.039 SingleUserNotebookApp kernelmanager:222] Starting buffering for 8eb032df-4ad3-4f4c-97df-a0849b92a949:a5c692b26e6a418c8dd6a10042a5ffb1\r\n[I 2021-02-22 18:14:51.130 SingleUserNotebookApp log:181] 200 GET /user/taoxu/api/kernels/8eb032df-4ad3-4f4c-97df-a0849b92a949?_=1613986889866 (taoxu@172.22.21.12) 1.25ms\r\n[I 2021-02-22 18:14:52.489 SingleUserNotebookApp log:181] 101 GET /user/taoxu/api/kernels/8eb032df-4ad3-4f4c-97df-a0849b92a949/channels?session_id=a5c692b26e6a418c8dd6a10042a5ffb1 (taoxu@172.22.21.28) 2.03ms\r\n[I 2021-02-22 18:14:52.489 SingleUserNotebookApp handlers:378] Restoring connection for 8eb032df-4ad3-4f4c-97df-a0849b92a949:a5c692b26e6a418c8dd6a10042a5ffb1\r\n[I 2021-02-22 18:14:53.174 JupyterHub log:181] 200 GET /hub/api (@10.70.26.25) 0.82ms\r\n[I 2021-02-22 18:14:53.286 SingleUserNotebookApp kernelmanager:222] Starting buffering for 8eb032df-4ad3-4f4c-97df-a0849b92a949:a5c692b26e6a418c8dd6a10042a5ffb1\r\n[I 2021-02-22 18:14:53.312 JupyterHub log:181] 200 GET /hub/api (@10.70.26.25) 0.66ms\r\n[I 2021-02-22 18:14:53.321 SingleUserNotebookApp log:181] 200 GET /user/taoxu/api/kernels/8eb032df-4ad3-4f4c-97df-a0849b92a949?_=1613986889867 (taoxu@172.22.21.3) 1.04ms\r\n[I 2021-02-22 18:14:54.514 SingleUserNotebookApp log:181] 101 GET /user/taoxu/api/kernels/8eb032df-4ad3-4f4c-97df-a0849b92a949/channels?session_id=a5c692b26e6a418c8dd6a10042a5ffb1 (taoxu@172.22.21.12) 2.17ms\r\n[I 2021-02-22 18:14:54.515 SingleUserNotebookApp handlers:378] Restoring connection for 8eb032df-4ad3-4f4c-97df-a0849b92a949:a5c692b26e6a418c8dd6a10042a5ffb1\r\n[I 2021-02-22 18:14:55.312 SingleUserNotebookApp kernelmanager:222] Starting buffering for 8eb032df-4ad3-4f4c-97df-a0849b92a949:a5c692b26e6a418c8dd6a10042a5ffb1\r\n[I 2021-02-22 18:14:55.424 SingleUserNotebookApp log:181] 200 GET /user/taoxu/api/kernels/8eb032df-4ad3-4f4c-97df-a0849b92a949?_=1613986889868 (taoxu@172.22.21.12) 1.14ms\r\n[I 2021-02-22 18:14:56.551 SingleUserNotebookApp log:181] 101 GET /user/taoxu/api/kernels/8eb032df-4ad3-4f4c-97df-a0849b92a949/channels?session_id=a5c692b26e6a418c8dd6a10042a5ffb1 (taoxu@172.22.21.12) 2.34ms\r\n[I 2021-02-22 18:14:56.551 SingleUserNotebookApp handlers:378] Restoring connection for 8eb032df-4ad3-4f4c-97df-a0849b92a949:a5c692b26e6a418c8dd6a10042a5ffb1\r\n[I 2021-02-22 18:14:57.346 SingleUserNotebookApp kernelmanager:222] Starting buffering for 8eb032df-4ad3-4f4c-97df-a0849b92a949:a5c692b26e6a418c8dd6a10042a5ffb1\r\n[I 2021-02-22 18:14:57.465 SingleUserNotebookApp log:181] 200 GET /user/taoxu/api/kernels/8eb032df-4ad3-4f4c-97df-a0849b92a949?_=1613986889869 (taoxu@172.22.21.28) 1.23ms\r\n[I 2021-02-22 18:14:58.550 SingleUserNotebookApp log:181] 101 GET /user/taoxu/api/kernels/8eb032df-4ad3-4f4c-97df-a0849b92a949/channels?session_id=a5c692b26e6a418c8dd6a10042a5ffb1 (taoxu@172.22.21.3) 2.24ms\r\n[I 2021-02-22 18:14:58.550 SingleUserNotebookApp handlers:378] Restoring connection for 8eb032df-4ad3-4f4c-97df-a0849b92a949:a5c692b26e6a418c8dd6a10042a5ffb1\r\n[I 2021-02-22 18:14:59.347 SingleUserNotebookApp kernelmanager:222] Starting buffering for 8eb032df-4ad3-4f4c-97df-a0849b92a949:a5c692b26e6a418c8dd6a10042a5ffb1\r\n[I 2021-02-22 18:14:59.704 SingleUserNotebookApp log:181] 200 GET /user/taoxu/api/kernels/8eb032df-4ad3-4f4c-97df-a0849b92a949?_=1613986889870 (taoxu@172.22.21.28) 1.09ms\r\n[I 2021-02-22 18:15:01.428 SingleUserNotebookApp log:181] 101 GET /user/taoxu/api/kernels/8eb032df-4ad3-4f4c-97df-a0849b92a949/channels?session_id=a5c692b26e6a418c8dd6a10042a5ffb1 (taoxu@172.22.21.12) 2.46ms\r\n[I 2021-02-22 18:15:01.428 SingleUserNotebookApp handlers:378] Restoring connection for 8eb032df-4ad3-4f4c-97df-a0849b92a949:a5c692b26e6a418c8dd6a10042a5ffb1\r\n[I 2021-02-22 18:15:02.223 SingleUserNotebookApp kernelmanager:222] Starting buffering for 8eb032df-4ad3-4f4c-97df-a0849b92a949:a5c692b26e6a418c8dd6a10042a5ffb1\r\n[I 2021-02-22 18:15:02.255 SingleUserNotebookApp log:181] 200 GET /user/taoxu/api/kernels/8eb032df-4ad3-4f4c-97df-a0849b92a949?_=1613986889871 (taoxu@172.22.21.3) 1.19ms\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3368/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3368/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3367", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3367/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3367/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3367/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3367", "id": 812821083, "node_id": "MDU6SXNzdWU4MTI4MjEwODM=", "number": 3367, "title": "c.JupyterHub.services.*.api_token has a minimum length required?", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-02-21T10:19:48Z", "updated_at": "2021-03-05T10:02:03Z", "closed_at": "2021-03-05T10:02:03Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "### Bug description\r\n\r\nWhen configuring a JupyterHub service with an api_token that is 7 characters (ddd4444) instead of 8 characters (dddd4444) or more, the JupyterHub responds with 403 when it otherwise don't.\r\n\r\nI expected to get some warning or early error if it had a minimum length, rather than a runtime failure 403 response to REST API requests.\r\n\r\n### How to reproduce\r\n\r\nThis was discovered in the JupyterHub Helm chart's CI system where making the dev-config.yaml specify `hub.services.test.apiToken=ddd4444` led to 403 errors accessing the REST api while it would work fine if set to an eight characters long token.\r\n\r\nThe JupyterHub configuration to reproduce without z2jh may be...\r\n\r\n```python\r\nc.JupyterHub.services = [\r\n    {\r\n        \"name\": test,\r\n        \"admin\": true,\r\n        \"api_token\": \"ddd4444\",\r\n    }\r\n]\r\n```\r\n\r\nAnd then sending a Rest API request with the oken.\r\n\r\n### Setup\r\n\r\nJupyterHub 1.3.0 was used in z2jh at this point in time.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3367/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3367/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3365", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3365/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3365/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3365/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3365", "id": 811662993, "node_id": "MDU6SXNzdWU4MTE2NjI5OTM=", "number": 3365, "title": "Listing running servers doesn't work in JupyterHub with JupyterLab 3", "user": {"login": "dclong", "id": 824507, "node_id": "MDQ6VXNlcjgyNDUwNw==", "avatar_url": "https://avatars.githubusercontent.com/u/824507?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dclong", "html_url": "https://github.com/dclong", "followers_url": "https://api.github.com/users/dclong/followers", "following_url": "https://api.github.com/users/dclong/following{/other_user}", "gists_url": "https://api.github.com/users/dclong/gists{/gist_id}", "starred_url": "https://api.github.com/users/dclong/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dclong/subscriptions", "organizations_url": "https://api.github.com/users/dclong/orgs", "repos_url": "https://api.github.com/users/dclong/repos", "events_url": "https://api.github.com/users/dclong/events{/privacy}", "received_events_url": "https://api.github.com/users/dclong/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-02-19T03:59:08Z", "updated_at": "2021-02-19T17:17:10Z", "closed_at": "2021-02-19T17:17:10Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\nThe following code is able to list running servers in JupyterLab 3. \r\n```\r\nimport json\r\nfrom jupyter_server import serverapp\r\nservers = list(serverapp.list_running_servers())\r\nprint(json.dumps(servers, indent=4))\r\n```\r\nHowerver, it doesn't work in JupyterHub with JupyterLab 3. \r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\nThe above should be able to list information of running servers. \r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\nThe code prints an empty list. \r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\n1. Install JupyterLab 3.\r\n2. Install JupyterHub. \r\n3. Start a JupyterHub server. \r\n4. Open a Python terminal and run the above code. \r\n\r\n### Your personal set up\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\n\r\n - OS: Ubuntu 20.04\r\n <!-- [e.g. ubuntu 20.04, macOS 11.0] -->\r\n - Version(s): JupyterHub 1.3; JupyterLab 3.06; Python 3.8\r\n <!-- e.g. jupyterhub --version, python --version --->\r\n\r\n- <details><summary>Full environment</summary>\r\n<!-- For reproduction, it's useful to have the full environment. For example, the output of `pip freeze` or `conda list` --->\r\n\r\n```\r\ndclong@jupyterhub:~$ pip3 freeze\r\nalembic==1.5.4\r\nanyio==2.1.0\r\nargon2-cffi==20.1.0\r\nastroid==2.4.2\r\nasync-generator==1.10\r\nattrs==20.3.0\r\nautopep8==1.5.5\r\nBabel==2.9.0\r\nbackcall==0.2.0\r\nbleach==3.3.0\r\ncertifi==2019.11.28\r\ncertipy==0.1.3\r\ncffi==1.14.5\r\nchardet==3.0.4\r\ncryptography==3.4.6\r\ndbus-python==1.2.16\r\ndecorator==4.4.2\r\ndefusedxml==0.6.0\r\ndistro==1.5.0\r\nentrypoints==0.3\r\nfindspark==1.4.2\r\nflake8==3.8.4\r\ngitdb==4.0.5\r\nGitPython==3.1.13\r\nidna==2.8\r\nimportlab==0.6.1\r\niniconfig==1.1.1\r\nipykernel==5.4.3\r\nipython==7.20.0\r\nipython-genutils==0.2.0\r\nisort==5.7.0\r\njedi==0.17.2\r\nJinja2==2.11.3\r\njson5==0.9.5\r\njsonschema==3.2.0\r\njupyter-client==6.1.11\r\njupyter-core==4.7.1\r\njupyter-lsp==1.1.3\r\njupyter-server==1.4.0\r\njupyter-telemetry==0.1.0\r\njupyterhub==1.3.0\r\njupyterlab==3.0.8\r\njupyterlab-lsp==3.4.1\r\njupyterlab-server==2.2.1\r\nlazy-object-proxy==1.4.3\r\nMako==1.1.4\r\nMarkupSafe==1.1.1\r\nmccabe==0.6.1\r\nmistune==0.8.4\r\nnbclassic==0.2.6\r\nnbconvert==5.6.1\r\nnbformat==5.1.2\r\nnetworkx==2.5\r\nninja==1.10.0.post2\r\nnotebook==6.2.0\r\noauthlib==3.1.0\r\npackaging==20.9\r\npamela==1.0.0\r\npandocfilters==1.4.3\r\nparso==0.7.1\r\npexpect==4.8.0\r\npickleshare==0.7.5\r\npluggy==0.13.1\r\nprometheus-client==0.9.0\r\nprompt-toolkit==3.0.16\r\nptyprocess==0.7.0\r\npy==1.10.0\r\npycodestyle==2.6.0\r\npycparser==2.20\r\npydocstyle==5.1.1\r\npyflakes==2.2.0\r\nPygments==2.8.0\r\nPyGObject==3.36.0\r\npylint==2.6.2\r\npyOpenSSL==20.0.1\r\npyparsing==2.4.7\r\npyrsistent==0.17.3\r\npytest==6.2.2\r\npython-apt==2.0.0+ubuntu0.20.4.4\r\npython-dateutil==2.8.1\r\npython-editor==1.0.4\r\npython-json-logger==2.0.1\r\npython-jsonrpc-server==0.4.0\r\npython-language-server==0.36.2\r\npython-Levenshtein==0.12.2\r\npytype==2021.2.9\r\npytz==2021.1\r\nPyYAML==5.4.1\r\npyzmq==22.0.3\r\nrapidfuzz==1.0.1\r\nrequests==2.25.1\r\nrequests-unixsocket==0.2.0\r\nrope==0.18.0\r\nruamel.yaml==0.16.12\r\nruamel.yaml.clib==0.2.2\r\nSend2Trash==1.5.0\r\nsix==1.14.0\r\nsmmap==3.0.5\r\nsniffio==1.2.0\r\nsnowballstemmer==2.1.0\r\nSQLAlchemy==1.3.23\r\nterminado==0.9.2\r\ntestpath==0.4.4\r\ntoml==0.10.2\r\ntornado==6.1\r\ntqdm==4.57.0\r\ntraitlets==5.0.5\r\ntyped-ast==1.4.2\r\nujson==4.0.2\r\nurllib3==1.25.8\r\nwajig==3.2.22\r\nwcwidth==0.2.5\r\nwebencodings==0.5.1\r\nwrapt==1.12.1\r\nxinstall==0.33.2\r\nyapf==0.30.0```\r\n</details>\r\n\r\n- <details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\n```python\r\n# Configuration file for jupyterhub.\r\n\r\n#------------------------------------------------------------------------------\r\n# Application(SingletonConfigurable) configuration\r\n#------------------------------------------------------------------------------\r\n\r\n## This is an application.\r\n\r\n## The date format used by logging formatters for %(asctime)s\r\n#c.Application.log_datefmt = '%Y-%m-%d %H:%M:%S'\r\n\r\n## The Logging format template\r\n#c.Application.log_format = '[%(name)s]%(highlevel)s %(message)s'\r\n\r\n## Set the log level by value or name.\r\n#c.Application.log_level = 30\r\n\r\n#------------------------------------------------------------------------------\r\n# JupyterHub(Application) configuration\r\n#------------------------------------------------------------------------------\r\n\r\n## An Application for starting a Multi-User Jupyter Notebook server.\r\n\r\n## Maximum number of concurrent servers that can be active at a time.\r\n#  \r\n#  Setting this can limit the total resources your users can consume.\r\n#  \r\n#  An active server is any server that's not fully stopped. It is considered\r\n#  active from the time it has been requested until the time that it has\r\n#  completely stopped.\r\n#  \r\n#  If this many user servers are active, users will not be able to launch new\r\n#  servers until a server is shutdown. Spawn requests will be rejected with a 429\r\n#  error asking them to try again.\r\n#  \r\n#  If set to 0, no limit is enforced.\r\n#c.JupyterHub.active_server_limit = 0\r\n\r\n## Grant admin users permission to access single-user servers.\r\n#  \r\n#  Users should be properly informed if this is enabled.\r\nc.JupyterHub.admin_access = True\r\n\r\n## Allow named single-user servers per user\r\n#c.JupyterHub.allow_named_servers = False\r\n\r\n## Answer yes to any questions (e.g. confirm overwrite)\r\n#c.JupyterHub.answer_yes = False\r\n\r\n## PENDING DEPRECATION: consider using service_tokens\r\n#  \r\n#  Dict of token:username to be loaded into the database.\r\n#  \r\n#  Allows ahead-of-time generation of API tokens for use by externally managed\r\n#  services, which authenticate as JupyterHub users.\r\n#  \r\n#  Consider using service_tokens for general services that talk to the JupyterHub\r\n#  API.\r\n#c.JupyterHub.api_tokens = {}\r\n\r\n## Class for authenticating users.\r\n#  \r\n#  This should be a class with the following form:\r\n#  \r\n#  - constructor takes one kwarg: `config`, the IPython config object.\r\n#  \r\n#  - is a tornado.gen.coroutine\r\n#  - returns username on success, None on failure\r\n#  - takes two arguments: (handler, data),\r\n#    where `handler` is the calling web.RequestHandler,\r\n#    and `data` is the POST form data from the login page.\r\nc.JupyterHub.authenticator_class = 'jupyterhub.auth.PAMAuthenticator'\r\n\r\n## The base URL of the entire application\r\n#c.JupyterHub.base_url = '/'\r\n\r\n## Whether to shutdown the proxy when the Hub shuts down.\r\n#  \r\n#  Disable if you want to be able to teardown the Hub while leaving the proxy\r\n#  running.\r\n#  \r\n#  Only valid if the proxy was starting by the Hub process.\r\n#  \r\n#  If both this and cleanup_servers are False, sending SIGINT to the Hub will\r\n#  only shutdown the Hub, leaving everything else running.\r\n#  \r\n#  The Hub should be able to resume from database state.\r\n#c.JupyterHub.cleanup_proxy = True\r\n\r\n## Whether to shutdown single-user servers when the Hub shuts down.\r\n#  \r\n#  Disable if you want to be able to teardown the Hub while leaving the single-\r\n#  user servers running.\r\n#  \r\n#  If both this and cleanup_proxy are False, sending SIGINT to the Hub will only\r\n#  shutdown the Hub, leaving everything else running.\r\n#  \r\n#  The Hub should be able to resume from database state.\r\n#c.JupyterHub.cleanup_servers = True\r\n\r\n## Maximum number of concurrent users that can be spawning at a time.\r\n#  \r\n#  Spawning lots of servers at the same time can cause performance problems for\r\n#  the Hub or the underlying spawning system. Set this limit to prevent bursts of\r\n#  logins from attempting to spawn too many servers at the same time.\r\n#  \r\n#  This does not limit the number of total running servers. See\r\n#  active_server_limit for that.\r\n#  \r\n#  If more than this many users attempt to spawn at a time, their requests will\r\n#  be rejected with a 429 error asking them to try again. Users will have to wait\r\n#  for some of the spawning services to finish starting before they can start\r\n#  their own.\r\n#  \r\n#  If set to 0, no limit is enforced.\r\n#c.JupyterHub.concurrent_spawn_limit = 100\r\n\r\n## The config file to load\r\n#c.JupyterHub.config_file = 'jupyterhub_config.py'\r\n\r\n## DEPRECATED: does nothing\r\n#c.JupyterHub.confirm_no_ssl = False\r\n\r\n## Number of days for a login cookie to be valid. Default is two weeks.\r\n#c.JupyterHub.cookie_max_age_days = 14\r\n\r\n## The cookie secret to use to encrypt cookies.\r\n#  \r\n#  Loaded from the JPY_COOKIE_SECRET env variable by default.\r\n#  \r\n#  Should be exactly 256 bits (32 bytes).\r\n#c.JupyterHub.cookie_secret = b''\r\n\r\n## File in which to store the cookie secret.\r\n#c.JupyterHub.cookie_secret_file = 'jupyterhub_cookie_secret'\r\n\r\n## The location of jupyterhub data files (e.g. /usr/local/share/jupyter/hub)\r\n#c.JupyterHub.data_files_path = '/usr/local/share/jupyter/hub'\r\n\r\n## Include any kwargs to pass to the database connection. See\r\n#  sqlalchemy.create_engine for details.\r\n#c.JupyterHub.db_kwargs = {}\r\n\r\n## url for the database. e.g. `sqlite:///jupyterhub.sqlite`\r\n#c.JupyterHub.db_url = 'sqlite:///jupyterhub.sqlite'\r\n\r\n## log all database transactions. This has A LOT of output\r\n#c.JupyterHub.debug_db = False\r\n\r\n## DEPRECATED since version 0.8: Use ConfigurableHTTPProxy.debug\r\n#c.JupyterHub.debug_proxy = False\r\n\r\n## Send JupyterHub's logs to this file.\r\n#  \r\n#  This will *only* include the logs of the Hub itself, not the logs of the proxy\r\n#  or any single-user servers.\r\n#c.JupyterHub.extra_log_file = ''\r\n\r\n## Extra log handlers to set on JupyterHub logger\r\n#c.JupyterHub.extra_log_handlers = []\r\n\r\n## Generate default config file\r\n#c.JupyterHub.generate_config = False\r\n\r\n## The ip or hostname for proxies and spawners to use for connecting to the Hub.\r\n#  \r\n#  Use when the bind address (`hub_ip`) is 0.0.0.0 or otherwise different from\r\n#  the connect address.\r\n#  \r\n#  Default: when `hub_ip` is 0.0.0.0, use `socket.gethostname()`, otherwise use\r\n#  `hub_ip`.\r\n#  \r\n#  .. versionadded:: 0.8\r\n#c.JupyterHub.hub_connect_ip = ''\r\n\r\n## The port for proxies & spawners to connect to the hub on.\r\n#  \r\n#  Used alongside `hub_connect_ip`\r\n#  \r\n#  .. versionadded:: 0.8\r\n#c.JupyterHub.hub_connect_port = 0\r\n\r\n## The ip address for the Hub process to *bind* to.\r\n#  \r\n#  See `hub_connect_ip` for cases where the bind and connect address should\r\n#  differ.\r\n#c.JupyterHub.hub_ip = '127.0.0.1'\r\n\r\n## The port for the Hub process\r\n#c.JupyterHub.hub_port = 8081\r\n\r\n## The public facing ip of the whole application (the proxy)\r\nc.JupyterHub.ip = '0.0.0.0'\r\n\r\n## Supply extra arguments that will be passed to Jinja environment.\r\n#c.JupyterHub.jinja_environment_options = {}\r\n\r\n## Interval (in seconds) at which to update last-activity timestamps.\r\n#c.JupyterHub.last_activity_interval = 300\r\n\r\n## Dict of 'group': ['usernames'] to load at startup.\r\n#  \r\n#  This strictly *adds* groups and users to groups.\r\n#  \r\n#  Loading one set of groups, then starting JupyterHub again with a different set\r\n#  will not remove users or groups from previous launches. That must be done\r\n#  through the API.\r\n#c.JupyterHub.load_groups = {}\r\n\r\n## Specify path to a logo image to override the Jupyter logo in the banner.\r\n#c.JupyterHub.logo_file = ''\r\n\r\n## File to write PID Useful for daemonizing jupyterhub.\r\n#c.JupyterHub.pid_file = ''\r\n\r\n## The public facing port of the proxy\r\nc.JupyterHub.port = 8000\r\n\r\n## DEPRECATED since version 0.8 : Use ConfigurableHTTPProxy.api_url\r\n#c.JupyterHub.proxy_api_ip = ''\r\n\r\n## DEPRECATED since version 0.8 : Use ConfigurableHTTPProxy.api_url\r\n#c.JupyterHub.proxy_api_port = 0\r\n\r\n## DEPRECATED since version 0.8: Use ConfigurableHTTPProxy.auth_token\r\n#c.JupyterHub.proxy_auth_token = ''\r\n\r\n## Interval (in seconds) at which to check if the proxy is running.\r\n#c.JupyterHub.proxy_check_interval = 30\r\n\r\n## Select the Proxy API implementation.\r\n#c.JupyterHub.proxy_class = 'jupyterhub.proxy.ConfigurableHTTPProxy'\r\n\r\n## DEPRECATED since version 0.8. Use ConfigurableHTTPProxy.command\r\n#c.JupyterHub.proxy_cmd = []\r\n\r\n## Purge and reset the database.\r\n#c.JupyterHub.reset_db = False\r\n\r\n## Interval (in seconds) at which to check connectivity of services with web\r\n#  endpoints.\r\n#c.JupyterHub.service_check_interval = 60\r\n\r\n## Dict of token:servicename to be loaded into the database.\r\n#  \r\n#  Allows ahead-of-time generation of API tokens for use by externally managed\r\n#  services.\r\n#c.JupyterHub.service_tokens = {}\r\n\r\n## List of service specification dictionaries.\r\n#  \r\n#  A service\r\n#  \r\n#  For instance::\r\n#  \r\n#      services = [\r\n#          {\r\n#              'name': 'cull_idle',\r\n#              'command': ['/path/to/cull_idle_servers.py'],\r\n#          },\r\n#          {\r\n#              'name': 'formgrader',\r\n#              'url': 'http://127.0.0.1:1234',\r\n#              'api_token': 'super-secret',\r\n#              'environment':\r\n#          }\r\n#      ]\r\n#c.JupyterHub.services = []\r\n\r\n## The class to use for spawning single-user servers.\r\n#  \r\n#  Should be a subclass of Spawner.\r\n# c.JupyterHub.spawner_class = 'systemdspawner.SystemdSpawner'\r\n\r\n## Path to SSL certificate file for the public facing interface of the proxy\r\n#  \r\n#  When setting this, you should also set ssl_key\r\n#c.JupyterHub.ssl_cert = ''\r\n\r\n## Path to SSL key file for the public facing interface of the proxy\r\n#  \r\n#  When setting this, you should also set ssl_cert\r\n#c.JupyterHub.ssl_key = ''\r\n\r\n## Host to send statsd metrics to\r\n#c.JupyterHub.statsd_host = ''\r\n\r\n## Port on which to send statsd metrics about the hub\r\n#c.JupyterHub.statsd_port = 8125\r\n\r\n## Prefix to use for all metrics sent by jupyterhub to statsd\r\n#c.JupyterHub.statsd_prefix = 'jupyterhub'\r\n\r\n## Run single-user servers on subdomains of this host.\r\n#  \r\n#  This should be the full `https://hub.domain.tld[:port]`.\r\n#  \r\n#  Provides additional cross-site protections for javascript served by single-\r\n#  user servers.\r\n#  \r\n#  Requires `<username>.hub.domain.tld` to resolve to the same host as\r\n#  `hub.domain.tld`.\r\n#  \r\n#  In general, this is most easily achieved with wildcard DNS.\r\n#  \r\n#  When using SSL (i.e. always) this also requires a wildcard SSL certificate.\r\n#c.JupyterHub.subdomain_host = ''\r\n\r\n## Paths to search for jinja templates.\r\n#c.JupyterHub.template_paths = []\r\n\r\n## Extra settings overrides to pass to the tornado application.\r\n#c.JupyterHub.tornado_settings = {}\r\n\r\n## Trust user-provided tokens (via JupyterHub.service_tokens) to have good\r\n#  entropy.\r\n#  \r\n#  If you are not inserting additional tokens via configuration file, this flag\r\n#  has no effect.\r\n#  \r\n#  In JupyterHub 0.8, internally generated tokens do not pass through additional\r\n#  hashing because the hashing is costly and does not increase the entropy of\r\n#  already-good UUIDs.\r\n#  \r\n#  User-provided tokens, on the other hand, are not trusted to have good entropy\r\n#  by default, and are passed through many rounds of hashing to stretch the\r\n#  entropy of the key (i.e. user-provided tokens are treated as passwords instead\r\n#  of random keys). These keys are more costly to check.\r\n#  \r\n#  If your inserted tokens are generated by a good-quality mechanism, e.g.\r\n#  `openssl rand -hex 32`, then you can set this flag to True to reduce the cost\r\n#  of checking authentication tokens.\r\n#c.JupyterHub.trust_user_provided_tokens = False\r\n\r\n#------------------------------------------------------------------------------\r\n# Spawner(LoggingConfigurable) configuration\r\n#------------------------------------------------------------------------------\r\n\r\n## Base class for spawning single-user notebook servers.\r\n#  \r\n#  Subclass this, and override the following methods:\r\n#  \r\n#  - load_state - get_state - start - stop - poll\r\n#  \r\n#  As JupyterHub supports multiple users, an instance of the Spawner subclass is\r\n#  created for each user. If there are 20 JupyterHub users, there will be 20\r\n#  instances of the subclass.\r\n\r\n## Extra arguments to be passed to the single-user server.\r\n#  \r\n#  Some spawners allow shell-style expansion here, allowing you to use\r\n#  environment variables here. Most, including the default, do not. Consult the\r\n#  documentation for your spawner to verify!\r\n#c.Spawner.args = []\r\n\r\n## The command used for starting the single-user server.\r\n#  \r\n#  Provide either a string or a list containing the path to the startup script\r\n#  command. Extra arguments, other than this path, should be provided via `args`.\r\n#  \r\n#  This is usually set if you want to start the single-user server in a different\r\n#  python environment (with virtualenv/conda) than JupyterHub itself.\r\n#  \r\n#  Some spawners allow shell-style expansion here, allowing you to use\r\n#  environment variables. Most, including the default, do not. Consult the\r\n#  documentation for your spawner to verify!\r\n#c.Spawner.cmd = ['jupyterhub-singleuser']\r\n\r\n## Minimum number of cpu-cores a single-user notebook server is guaranteed to\r\n#  have available.\r\n#  \r\n#  If this value is set to 0.5, allows use of 50% of one CPU. If this value is\r\n#  set to 2, allows use of up to 2 CPUs.\r\n#  \r\n#  Note that this needs to be supported by your spawner for it to work.\r\n#c.Spawner.cpu_guarantee = None\r\n\r\n## Maximum number of cpu-cores a single-user notebook server is allowed to use.\r\n#  \r\n#  If this value is set to 0.5, allows use of 50% of one CPU. If this value is\r\n#  set to 2, allows use of up to 2 CPUs.\r\n#  \r\n#  The single-user notebook server will never be scheduled by the kernel to use\r\n#  more cpu-cores than this. There is no guarantee that it can access this many\r\n#  cpu-cores.\r\n#  \r\n#  This needs to be supported by your spawner for it to work.\r\n#c.Spawner.cpu_limit = None\r\n\r\n## Enable debug-logging of the single-user server\r\n#c.Spawner.debug = False\r\n\r\n## The URL the single-user server should start in.\r\n#  \r\n#  `{username}` will be expanded to the user's username\r\n#  \r\n#  Example uses:\r\n#  \r\n#  - You can set `notebook_dir` to `/` and `default_url` to `/tree/home/{username}` to allow people to\r\n#    navigate the whole filesystem from their notebook server, but still start in their home directory.\r\n#  - Start with `/notebooks` instead of `/tree` if `default_url` points to a notebook instead of a directory.\r\n#  - You can set this to `/lab` to have JupyterLab start by default, rather than Jupyter Notebook.\r\nc.Spawner.default_url = '/lab'\r\n\r\n## Disable per-user configuration of single-user servers.\r\n#  \r\n#  When starting the user's single-user server, any config file found in the\r\n#  user's $HOME directory will be ignored.\r\n#  \r\n#  Note: a user could circumvent this if the user modifies their Python\r\n#  environment, such as when they have their own conda environments / virtualenvs\r\n#  / containers.\r\n#c.Spawner.disable_user_config = False\r\n\r\n## Whitelist of environment variables for the single-user server to inherit from\r\n#  the JupyterHub process.\r\n#  \r\n#  This whitelist is used to ensure that sensitive information in the JupyterHub\r\n#  process's environment (such as `CONFIGPROXY_AUTH_TOKEN`) is not passed to the\r\n#  single-user server's process.\r\nc.Spawner.env_keep = [\r\n    'PATH', \r\n    'PYTHONPATH', \r\n    'CONDA_ROOT', \r\n    'CONDA_DEFAULT_ENV', \r\n    'VIRTUAL_ENV', \r\n    'LANG', \r\n    'LC_ALL',\r\n    'JAVA_HOME',\r\n    'M2_HOME',\r\n]\r\n\r\n## Extra environment variables to set for the single-user server's process.\r\n#  \r\n#  Environment variables that end up in the single-user server's process come from 3 sources:\r\n#    - This `environment` configurable\r\n#    - The JupyterHub process' environment variables that are whitelisted in `env_keep`\r\n#    - Variables to establish contact between the single-user notebook and the hub (such as JUPYTERHUB_API_TOKEN)\r\n#  \r\n#  The `enviornment` configurable should be set by JupyterHub administrators to\r\n#  add installation specific environment variables. It is a dict where the key is\r\n#  the name of the environment variable, and the value can be a string or a\r\n#  callable. If it is a callable, it will be called with one parameter (the\r\n#  spawner instance), and should return a string fairly quickly (no blocking\r\n#  operations please!).\r\n#  \r\n#  Note that the spawner class' interface is not guaranteed to be exactly same\r\n#  across upgrades, so if you are using the callable take care to verify it\r\n#  continues to work after upgrades!\r\n#c.Spawner.environment = {}\r\n\r\n## Timeout (in seconds) before giving up on a spawned HTTP server\r\n#  \r\n#  Once a server has successfully been spawned, this is the amount of time we\r\n#  wait before assuming that the server is unable to accept connections.\r\n#c.Spawner.http_timeout = 30\r\n\r\n## The IP address (or hostname) the single-user server should listen on.\r\n#  \r\n#  The JupyterHub proxy implementation should be able to send packets to this\r\n#  interface.\r\n#c.Spawner.ip = ''\r\n\r\n## Minimum number of bytes a single-user notebook server is guaranteed to have\r\n#  available.\r\n#  \r\n#  Allows the following suffixes:\r\n#    - K -> Kilobytes\r\n#    - M -> Megabytes\r\n#    - G -> Gigabytes\r\n#    - T -> Terabytes\r\n#  \r\n#  This needs to be supported by your spawner for it to work.\r\n#c.Spawner.mem_guarantee = None\r\n\r\n## Maximum number of bytes a single-user notebook server is allowed to use.\r\n#  \r\n#  Allows the following suffixes:\r\n#    - K -> Kilobytes\r\n#    - M -> Megabytes\r\n#    - G -> Gigabytes\r\n#    - T -> Terabytes\r\n#  \r\n#  If the single user server tries to allocate more memory than this, it will\r\n#  fail. There is no guarantee that the single-user notebook server will be able\r\n#  to allocate this much memory - only that it can not allocate more than this.\r\n#  \r\n#  This needs to be supported by your spawner for it to work.\r\n# c.Spawner.mem_limit = '6G'\r\n# c.SystemdSpawner.mem_limit = '6G'\r\n# c.SystemdSpawner.mem_limit = '4G'\r\n\r\n## Path to the notebook directory for the single-user server.\r\n#  \r\n#  The user sees a file listing of this directory when the notebook interface is\r\n#  started. The current interface does not easily allow browsing beyond the\r\n#  subdirectories in this directory's tree.\r\n#  \r\n#  `~` will be expanded to the home directory of the user, and {username} will be\r\n#  replaced with the name of the user.\r\n#  \r\n#  Note that this does *not* prevent users from accessing files outside of this\r\n#  path! They can do so with many other means.\r\nc.Spawner.notebook_dir = '/workdir'\r\n\r\n## An HTML form for options a user can specify on launching their server.\r\n#  \r\n#  The surrounding `<form>` element and the submit button are already provided.\r\n#  \r\n#  For example:\r\n#  \r\n#  .. code:: html\r\n#  \r\n#      Set your key:\r\n#      <input name=\"key\" val=\"default_key\"></input>\r\n#      <br>\r\n#      Choose a letter:\r\n#      <select name=\"letter\" multiple=\"true\">\r\n#        <option value=\"A\">The letter A</option>\r\n#        <option value=\"B\">The letter B</option>\r\n#      </select>\r\n#  \r\n#  The data from this form submission will be passed on to your spawner in\r\n#  `self.user_options`\r\n#c.Spawner.options_form = ''\r\n\r\n## Interval (in seconds) on which to poll the spawner for single-user server's\r\n#  status.\r\n#  \r\n#  At every poll interval, each spawner's `.poll` method is called, which checks\r\n#  if the single-user server is still running. If it isn't running, then\r\n#  JupyterHub modifies its own state accordingly and removes appropriate routes\r\n#  from the configurable proxy.\r\n#c.Spawner.poll_interval = 30\r\n\r\n## The port for single-user servers to listen on.\r\n#  \r\n#  Defaults to `0`, which uses a randomly allocated port number each time.\r\n#  \r\n#  If set to a non-zero value, all Spawners will use the same port, which only\r\n#  makes sense if each server is on a different address, e.g. in containers.\r\n#  \r\n#  New in version 0.7.\r\n#c.Spawner.port = 0\r\n\r\n## An optional hook function that you can implement to do some bootstrapping work\r\n#  before the spawner starts. For example, create a directory for your user or\r\n#  load initial content.\r\n#  \r\n#  This can be set independent of any concrete spawner implementation.\r\n#  \r\n#  Example::\r\n#  \r\n#      from subprocess import check_call\r\n#      def my_hook(spawner):\r\n#          username = spawner.user.name\r\n#          check_call(['./examples/bootstrap-script/bootstrap.sh', username])\r\n#  \r\n#      c.Spawner.pre_spawn_hook = my_hook\r\n#c.Spawner.pre_spawn_hook = None\r\n\r\n## Timeout (in seconds) before giving up on starting of single-user server.\r\n#  \r\n#  This is the timeout for start to return, not the timeout for the server to\r\n#  respond. Callers of spawner.start will assume that startup has failed if it\r\n#  takes longer than this. start should return when the server process is started\r\n#  and its location is known.\r\n#c.Spawner.start_timeout = 60\r\n\r\n#------------------------------------------------------------------------------\r\n# LocalProcessSpawner(Spawner) configuration\r\n#------------------------------------------------------------------------------\r\n\r\n## A Spawner that uses `subprocess.Popen` to start single-user servers as local\r\n#  processes.\r\n#  \r\n#  Requires local UNIX users matching the authenticated users to exist. Does not\r\n#  work on Windows.\r\n#  \r\n#  This is the default spawner for JupyterHub.\r\n\r\n## Seconds to wait for single-user server process to halt after SIGINT.\r\n#  \r\n#  If the process has not exited cleanly after this many seconds, a SIGTERM is\r\n#  sent.\r\n#c.LocalProcessSpawner.interrupt_timeout = 10\r\n\r\n## Seconds to wait for process to halt after SIGKILL before giving up.\r\n#  \r\n#  If the process does not exit cleanly after this many seconds of SIGKILL, it\r\n#  becomes a zombie process. The hub process will log a warning and then give up.\r\n#c.LocalProcessSpawner.kill_timeout = 5\r\n\r\n## Extra keyword arguments to pass to Popen\r\n#  \r\n#  when spawning single-user servers.\r\n#  \r\n#  For example::\r\n#  \r\n#      popen_kwargs = dict(shell=True)\r\n#c.LocalProcessSpawner.popen_kwargs = {}\r\n\r\n## Seconds to wait for single-user server process to halt after SIGTERM.\r\n#  \r\n#  If the process does not exit cleanly after this many seconds of SIGTERM, a\r\n#  SIGKILL is sent.\r\n#c.LocalProcessSpawner.term_timeout = 5\r\n\r\n#------------------------------------------------------------------------------\r\n# Authenticator(LoggingConfigurable) configuration\r\n#------------------------------------------------------------------------------\r\n\r\n## Base class for implementing an authentication provider for JupyterHub\r\n\r\n## Set of users that will have admin rights on this JupyterHub.\r\n#  \r\n#  Admin users have extra privileges:\r\n#   - Use the admin panel to see list of users logged in\r\n#   - Add / remove users in some authenticators\r\n#   - Restart / halt the hub\r\n#   - Start / stop users' single-user servers\r\n#   - Can access each individual users' single-user server (if configured)\r\n#  \r\n#  Admin access should be treated the same way root access is.\r\n#  \r\n#  Defaults to an empty set, in which case no user has admin access.\r\nc.Authenticator.admin_users = set(['dclong'])\r\n\r\n## Automatically begin the login process\r\n#  \r\n#  rather than starting with a \"Login with...\" link at `/hub/login`\r\n#  \r\n#  To work, `.login_url()` must give a URL other than the default `/hub/login`,\r\n#  such as an oauth handler or another automatic login handler, registered with\r\n#  `.get_handlers()`.\r\n#  \r\n#  .. versionadded:: 0.8\r\n#c.Authenticator.auto_login = False\r\n\r\n## Enable persisting auth_state (if available).\r\n#  \r\n#  auth_state will be encrypted and stored in the Hub's database. This can\r\n#  include things like authentication tokens, etc. to be passed to Spawners as\r\n#  environment variables.\r\n#  \r\n#  Encrypting auth_state requires the cryptography package.\r\n#  \r\n#  Additionally, the JUPYTERHUB_CRYPTO_KEY envirionment variable must contain one\r\n#  (or more, separated by ;) 32B encryption keys. These can be either base64 or\r\n#  hex-encoded.\r\n#  \r\n#  If encryption is unavailable, auth_state cannot be persisted.\r\n#  \r\n#  New in JupyterHub 0.8\r\n#c.Authenticator.enable_auth_state = False\r\n\r\n## Dictionary mapping authenticator usernames to JupyterHub users.\r\n#  \r\n#  Primarily used to normalize OAuth user names to local users.\r\n#c.Authenticator.username_map = {}\r\n\r\n## Regular expression pattern that all valid usernames must match.\r\n#  \r\n#  If a username does not match the pattern specified here, authentication will\r\n#  not be attempted.\r\n#  \r\n#  If not set, allow any username.\r\n#c.Authenticator.username_pattern = ''\r\n\r\n## Whitelist of usernames that are allowed to log in.\r\n#  \r\n#  Use this with supported authenticators to restrict which users can log in.\r\n#  This is an additional whitelist that further restricts users, beyond whatever\r\n#  restrictions the authenticator has in place.\r\n#  \r\n#  If empty, does not perform any additional restriction.\r\n#c.Authenticator.whitelist = set()\r\n\r\n#------------------------------------------------------------------------------\r\n# LocalAuthenticator(Authenticator) configuration\r\n#------------------------------------------------------------------------------\r\n\r\n## Base class for Authenticators that work with local Linux/UNIX users\r\n#  \r\n#  Checks for local users, and can attempt to create them if they exist.\r\n\r\n## The command to use for creating users as a list of strings\r\n#  \r\n#  For each element in the list, the string USERNAME will be replaced with the\r\n#  user's username. The username will also be appended as the final argument.\r\n#  \r\n#  For Linux, the default value is:\r\n#  \r\n#      ['adduser', '-q', '--gecos', '\"\"', '--disabled-password']\r\n#  \r\n#  To specify a custom home directory, set this to:\r\n#  \r\n#      ['adduser', '-q', '--gecos', '\"\"', '--home', '/customhome/USERNAME', '--\r\n#  disabled-password']\r\n#  \r\n#  This will run the command:\r\n#  \r\n#      adduser -q --gecos \"\" --home /customhome/river --disabled-password river\r\n#  \r\n#  when the user 'river' is created.\r\n#c.LocalAuthenticator.add_user_cmd = []\r\n\r\n## If set to True, will attempt to create local system users if they do not exist\r\n#  already.\r\n#  \r\n#  Supports Linux and BSD variants only.\r\n# c.LocalAuthenticator.create_system_users = False\r\n\r\n## Whitelist all users from this UNIX group.\r\n#  \r\n#  This makes the username whitelist ineffective.\r\n#c.LocalAuthenticator.group_whitelist = set()\r\n\r\n#------------------------------------------------------------------------------\r\n# PAMAuthenticator(LocalAuthenticator) configuration\r\n#------------------------------------------------------------------------------\r\n\r\n## Authenticate local UNIX users with PAM\r\n\r\n## The text encoding to use when communicating with PAM\r\n#c.PAMAuthenticator.encoding = 'utf8'\r\n\r\n## Whether to open a new PAM session when spawners are started.\r\n#  \r\n#  This may trigger things like mounting shared filsystems, loading credentials,\r\n#  etc. depending on system configuration, but it does not always work.\r\n#  \r\n#  If any errors are encountered when opening/closing PAM sessions, this is\r\n#  automatically set to False.\r\n#c.PAMAuthenticator.open_sessions = True\r\n\r\n## The name of the PAM service to use for authentication\r\n#c.PAMAuthenticator.service = 'login'\r\n\r\n#------------------------------------------------------------------------------\r\n# CryptKeeper(SingletonConfigurable) configuration\r\n#------------------------------------------------------------------------------\r\n\r\n## Encapsulate encryption configuration\r\n#  \r\n#  Use via the encryption_config singleton below.\r\n\r\n## \r\n#c.CryptKeeper.keys = []\r\n\r\n## The number of threads to allocate for encryption\r\n#c.CryptKeeper.n_threads = 8\r\n\r\n```\r\n</details>\r\n\r\n- <details><summary>Logs</summary>\r\n<!--\r\nErrors are often logged by jupytehub. How you get logs depends on your deployment.\r\nWith kubernetes it might be:\r\n\r\n    kubectl get pod # hub pod name starts with hub...\r\n    kubectl logs hub-...\r\n    # or for a single-user server\r\n    kubectl logs jupyter-username\r\n\r\nOr the-littlest-jupyterhub:\r\n\r\n    journalctl -u jupyterhub\r\n    # or for a single-user server\r\n    journalctl -u jupyter-username\r\n-->\r\n\r\n```\r\n# paste relevant logs here, if any\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3365/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3365/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3347", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3347/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3347/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3347/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3347", "id": 795916521, "node_id": "MDExOlB1bGxSZXF1ZXN0NTYzMTgzMzg0", "number": 3347, "title": "make_singleuser_app: patch-in HubAuthenticatedHandler at lower priority", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-01-28T11:23:20Z", "updated_at": "2021-04-12T14:41:17Z", "closed_at": "2021-02-04T13:41:40Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3347", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3347", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3347.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3347.patch", "merged_at": "2021-02-04T13:41:39Z"}, "body": "apply patch directly to BaseHandler instead of each handler instance so that overrides can still take effect (i.e. APIHandler raising 403 instead of redirecting)\n\ncloses #3328", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3347/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3347/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3335", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3335/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3335/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3335/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3335", "id": 787140066, "node_id": "MDExOlB1bGxSZXF1ZXN0NTU1OTAyODIx", "number": 3335, "title": "Fix pagination with named servers", "user": {"login": "rcthomas", "id": 78920, "node_id": "MDQ6VXNlcjc4OTIw", "avatar_url": "https://avatars.githubusercontent.com/u/78920?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rcthomas", "html_url": "https://github.com/rcthomas", "followers_url": "https://api.github.com/users/rcthomas/followers", "following_url": "https://api.github.com/users/rcthomas/following{/other_user}", "gists_url": "https://api.github.com/users/rcthomas/gists{/gist_id}", "starred_url": "https://api.github.com/users/rcthomas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rcthomas/subscriptions", "organizations_url": "https://api.github.com/users/rcthomas/orgs", "repos_url": "https://api.github.com/users/rcthomas/repos", "events_url": "https://api.github.com/users/rcthomas/events{/privacy}", "received_events_url": "https://api.github.com/users/rcthomas/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2021-01-15T19:25:28Z", "updated_at": "2021-04-12T14:43:31Z", "closed_at": "2021-01-20T08:29:45Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3335", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3335", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3335.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3335.patch", "merged_at": "2021-01-20T08:29:45Z"}, "body": "Just need to consider distinct users for pagination to work right with named servers.  I am not a sqlalchemy expert (sqlalchemist?) so I am not sure if the \"optimization\" I did actually does what I think it should or if it actually makes 3 queries happen under the hood.\r\n\r\n* Add distinct user id clause\r\n* Separate join and distinct into one query\r\n* Apply limit and offset to the result\r\n* Apply count to the result for pagination total", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3335/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3335/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3334", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3334/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3334/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3334/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3334", "id": 787085682, "node_id": "MDU6SXNzdWU3ODcwODU2ODI=", "number": 3334, "title": "Admin pagination issues with named servers", "user": {"login": "rcthomas", "id": 78920, "node_id": "MDQ6VXNlcjc4OTIw", "avatar_url": "https://avatars.githubusercontent.com/u/78920?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rcthomas", "html_url": "https://github.com/rcthomas", "followers_url": "https://api.github.com/users/rcthomas/followers", "following_url": "https://api.github.com/users/rcthomas/following{/other_user}", "gists_url": "https://api.github.com/users/rcthomas/gists{/gist_id}", "starred_url": "https://api.github.com/users/rcthomas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rcthomas/subscriptions", "organizations_url": "https://api.github.com/users/rcthomas/orgs", "repos_url": "https://api.github.com/users/rcthomas/repos", "events_url": "https://api.github.com/users/rcthomas/events{/privacy}", "received_events_url": "https://api.github.com/users/rcthomas/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-01-15T18:03:47Z", "updated_at": "2021-01-27T18:22:01Z", "closed_at": "2021-01-27T18:22:01Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Bug description\r\n\r\nPagination's great, but I think it gets confused by named servers.  After named servers are registered they count as \"users\" (entries?) when being rendered, but the `pagination.total` is only counting users. \r\n\r\n#### Expected behaviour\r\n\r\nIf you have named servers going on, maybe the admin page should set the total to be from the total number of `Spawner` entries or take that into account.  The behavior for no named servers could be just left alone.  The admin page could say it was listing spawners in the bottom too.\r\n\r\n#### Actual behaviour\r\n\r\nAssuming default settings, you might have 789 users, but if they have some named servers you won't be able to see them all listed unless you override the `page` argument. If each one has a named server, you'll only see like half. Interestingly though you'll see at least the number of default entries per page (like if a user has 105 named servers you'll see their user row and 105 named server rows, but no other users).\r\n\r\n### How to reproduce\r\n\r\n1. Set up a hub with an admin and test users, say 12 of them\r\n2. For `jupyterhub_config.py`:\r\n\r\n```\r\nc.JupyterHub.admin_users = set([\"admin\"])\r\nc.JupyterHub.allow_named_servers = True\r\nc.JupyterHub.default_url = \"/hub/home\"\r\nc.Authenticator.allowed_users = set([\r\n    \"user01\", \"user02\", \"user03\",\r\n    \"user04\", \"user05\", \"user06\",\r\n    \"user07\", \"user08\", \"user09\",\r\n    \"user10\", \"user11\", \"user12\",\r\n    \"admin\"\r\n])\r\nc.Pagination.default_per_page = 3\r\n```\r\n\r\n3. Login as the `admin` user and go to the admin page. You should see 3 users listed and pages for 5 pages worth of users which seems right.\r\n4. Go to the home page and add say 4 servers for yourself.\r\n5. When you're done, go back to the admin page.  What you see is the admin user, and then the 4 servers you created.  The pagination info still says it's showing a subset of users for 13 total users and there are 5 pages worth\r\n6. Move to the last page; some of the higher-numbered users will be missing.\r\n7. They are still there but you have to set `?page=` off the end of the list of expected pages.\r\n\r\n### Work\r\n\r\nI'm going to see about whether the proposed solution works and submit a PR but I'm a little confused how the template knows to stop showing users past the per_page setting.  If anyone has a hint let me know but I'll probably eventually track it down.\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3334/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3334/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3328", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3328/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3328/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3328/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3328", "id": 783734475, "node_id": "MDU6SXNzdWU3ODM3MzQ0NzU=", "number": 3328, "title": "Auth expiration problems with JupyterLab 3.x", "user": {"login": "quentinmit", "id": 115761, "node_id": "MDQ6VXNlcjExNTc2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/115761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/quentinmit", "html_url": "https://github.com/quentinmit", "followers_url": "https://api.github.com/users/quentinmit/followers", "following_url": "https://api.github.com/users/quentinmit/following{/other_user}", "gists_url": "https://api.github.com/users/quentinmit/gists{/gist_id}", "starred_url": "https://api.github.com/users/quentinmit/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/quentinmit/subscriptions", "organizations_url": "https://api.github.com/users/quentinmit/orgs", "repos_url": "https://api.github.com/users/quentinmit/repos", "events_url": "https://api.github.com/users/quentinmit/events{/privacy}", "received_events_url": "https://api.github.com/users/quentinmit/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2021-01-11T21:57:31Z", "updated_at": "2021-02-04T13:44:01Z", "closed_at": "2021-02-04T13:41:39Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\nAfter upgrading to JupyterLab 3.0, everything works fine until the auth token expires. Then, the UI fails to refresh the auth token due to CORS, and as a side effect it continues setting more and more cookies until its requests start getting 400 Bad Request because of the large Cookie header.\r\n\r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\nJupyterLab continues working as long as the tab is open\r\n\r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\nA popup appears:\r\n```\r\nServer Connection Error\r\nA connection to the Jupyter server could not be established. JupyterLab will continue trying to reconnect. Check your network connection or Jupyter server configuration.\r\n```\r\nIn Chrome's Console, you can see that it's failing due to CORS:\r\n\r\n```\r\nlab:1 Access to fetch at 'https://jupyter.mit.edu/hub/api/oauth2/authorize?client_id=jupyterhub-user-quentin&redirect_uri=https%3A%2F%2Fquentin.jupyter.mit.edu%2Fuser%2Fquentin%2Foauth_callback&response_type=code&state=REMOVED' (redirected from 'https://quentin.jupyter.mit.edu/user/quentin/api/contents/REMOVED?content=1&1610401550583') from origin 'https://quentin.jupyter.mit.edu' has been blocked by CORS policy: Response to preflight request doesn't pass access control check: No 'Access-Control-Allow-Origin' header is present on the requested resource. If an opaque response serves your needs, set the request's mode to 'no-cors' to fetch the resource with CORS disabled.\r\nserverconnection.js:207 GET https://jupyter.mit.edu/hub/api/oauth2/authorize?client_id=jupyterhub-user-quentin&redirect_uri=https%3A%2F%2Fquentin.jupyter.mit.edu%2Fuser%2Fquentin%2Foauth_callback&response_type=code&state=REMOVED net::ERR_FAILED\r\n```\r\n\r\nIt looks like JupyterLab is trying to fetch /user/$user/api/contents, the auth is expired so it's redirected from $user.jupyter/user to jupyter/hub for auth, then after N cycles of that,\r\n\r\n```\r\nserverconnection.js:207 GET https://quentin.jupyter.mit.edu/user/quentin/api/contents/REMOVED?content=1&1610401672210 400 (Bad Request)\r\n```\r\n\r\nand looking at my cookies I now have cookies named `jupyterhub-user-quentin-oauth-state-FycHkGir` (for 15 different random strings, as well as one with no random suffix). Deleting those cookies and refreshing the page loads JupyterLab correctly.\r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\n1. Install the latest JupyterHub and JupyterLab\r\n2. (Probably) configure JupyterHub to use subdomains\r\n3. Open JupyterLab and leave the tab open.\r\n\r\n### Your personal set up\r\n<!--\r\nTell us a little about the system you're using.\r\nPlease include information about how you installed,\r\ne.g. are you using a distribution such as zero-to-jupyterhub or the-littlest-jupyterhub.\r\n -->\r\nJupyterHub and JupyterLab are installed directly from PIP in a VirtualEnv. All the config files are available at: https://github.com/sipb/jupyter/tree/master/ansible/roles/jupyter-jupyter/files, including the JupyterHub config file itself.\r\n - OS:\r\n <!-- [e.g. ubuntu 20.04, macOS 11.0] -->\r\nUbuntu 20.04\r\n - Version(s):\r\n <!-- e.g. jupyterhub --version, python --version --->\r\n```\r\n$ jupyterhub --version\r\n1.3.0\r\n$ python --version\r\nPython 3.8.5\r\n$ jupyter lab --version\r\n3.0.3\r\n```\r\n\r\n<details><summary>Full environment</summary>\r\n\r\n```\r\nAccessControl==5.0\r\nacme==1.1.0\r\nAcquisition==4.7\r\naggdraw==1.3.12\r\naiosqlite==0.16.0\r\nalabaster==0.7.8\r\nalembic==1.4.3\r\nansible==2.9.6\r\nanyio==2.0.2\r\napache-libcloud==2.8.0\r\nappdirs==1.4.3\r\nargcomplete==1.8.1\r\nargh==0.26.2\r\nargon2-cffi==20.1.0\r\nasn1crypto==1.4.0\r\nastroid==2.4.2\r\nastroplan==0.7\r\nastropy==4.2\r\nastrowidgets==0.1.1\r\nasync-generator==1.10\r\nasyncpg==0.21.0\r\natomicwrites==1.4.0\r\nattrs==20.3.0\r\nAuthEncoding==4.2\r\nAuthlib==0.15.2\r\nAutomat==0.8.0\r\nautopep8==1.5.4\r\nBabel==2.9.0\r\nbackcall==0.2.0\r\nbeautifulsoup4==4.9.3\r\nbiopython==1.78\r\nbitarray==1.6.1\r\nbkcharts==0.2\r\nbleach==3.2.1\r\nblinker==1.4\r\nblosc==1.10.1\r\nbokeh==2.2.3\r\nboto==2.49.0\r\nboto3==1.9.253\r\nbotocore==1.16.19\r\nBottleneck==1.3.2\r\nbrotlipy==0.7.0\r\nBTrees==4.7.2\r\nCacheControl==0.12.6\r\nCartopy==0.18.0\r\ncertbot==0.40.0\r\ncertbot-apache==0.39.0\r\ncertbot-dns-route53==0.35.1\r\ncertifi==2019.11.28\r\ncertipy==0.1.3\r\ncffi==1.14.4\r\ncftime==1.2.1\r\nChameleon==3.8.1\r\nchardet==4.0.0\r\nclick==7.1.2\r\nclingkernel==0.0.2\r\ncloud-init==20.2\r\ncloudpickle==1.6.0\r\nclyent==1.2.1\r\ncolorama==0.4.4\r\ncommand-not-found==0.3\r\nConfigArgParse==0.13.0\r\nconfigobj==5.0.6\r\nconstantly==15.1.0\r\ncontextlib2==0.6.0.post1\r\ncryptography==3.3.1\r\ncycler==0.10.0\r\ncypari==2.4.0\r\nCython==0.29.21\r\ncytoolz==0.11.0\r\ndask==2020.12.0\r\ndatabases==0.3.2\r\nDateTime==4.3\r\ndblatex===0.3.11py3\r\ndbus-python==1.2.16\r\ndecorator==4.4.2\r\ndefusedxml==0.6.0\r\ndevscripts===2.20.2ubuntu2\r\ndiff-match-patch==20200713\r\ndistlib==0.3.0\r\ndistro==1.4.0\r\ndistro-info===0.23ubuntu1\r\ndnspython==1.16.0\r\nDocumentTemplate==4.0\r\ndocutils==0.16\r\nec2-hibinit-agent==1.0.0\r\nentrypoints==0.3\r\net-xmlfile==1.0.1\r\nExtensionClass==4.5.0\r\nfastapi==0.61.2\r\nfastcache==1.1.0\r\nfilelock==3.0.12\r\nflake8==3.8.4\r\nFlask==1.1.2\r\nfsspec==0.8.5\r\nfuture==0.18.2\r\nFXrays==1.3.3\r\ngbp==0.9.19\r\nGDAL==3.0.4\r\ngeomag-algorithms==1.3.5\r\ngevent==20.12.1\r\nginga==3.1.0\r\ngitdb==4.0.5\r\nGitPython==3.1.11\r\nglob2==0.7\r\ngmpy2==2.1.0b3\r\ngpg===1.13.1-unknown\r\ngreenlet==0.4.17\r\ngssapi==1.6.12\r\ngunicorn==20.0.4\r\nh11==0.9.0\r\nh2==3.2.0\r\nh5py==3.1.0\r\nhdmedians==0.14.1\r\nHeapDict==1.0.1\r\nhibagent==1.0.1\r\nhpack==3.0.0\r\nhstspreload==2020.10.20\r\nhtml5lib==1.1\r\nhttplib2==0.14.0\r\nhttptools==0.1.1\r\nhttpx==0.11.1\r\nhyperframe==5.2.0\r\nhyperlink==19.0.0\r\nicu==0.0.1\r\nidna==3.1\r\nimageio==2.9.0\r\nimagesize==1.2.0\r\nimportlib-metadata==3.4.0\r\nincremental==16.10.1\r\niniconfig==1.1.1\r\nintel-openmp==2021.1.2\r\nintervaltree==3.1.0\r\nipaddr==2.2.0\r\nipyevents==0.8.1\r\nipykernel==5.3.4\r\nipympl==0.6.2\r\nipython==7.19.0\r\nipython-genutils==0.2.0\r\nipywidgets==7.6.3\r\nisort==5.7.0\r\nitsdangerous==1.1.0\r\njdcal==1.4.1\r\njedi==0.17.2\r\njeepney==0.5.0\r\nJinja2==2.11.2\r\njmespath==0.9.4\r\njoblib==1.0.0\r\njosepy==1.2.0\r\njson5==0.9.5\r\njsonpatch==1.22\r\njsonpointer==2.0\r\njsonschema==3.2.0\r\njupyter-archive==3.0.0\r\njupyter-c-kernel==1.2.2\r\njupyter-client==6.1.7\r\njupyter-core==4.6.3\r\njupyter-lsp==1.0.0\r\njupyter-server==1.2.1\r\njupyter-telemetry==0.1.0\r\njupyterhub==1.3.0\r\njupyterhub-systemdspawner==0.15.0\r\njupyterlab==3.0.3\r\njupyterlab-apod==0.1.0\r\njupyterlab-git==0.23.3\r\njupyterlab-hdf==0.5.1\r\njupyterlab-kernelspy==3.0.1\r\njupyterlab-latex==2.0.0\r\njupyterlab-lsp==3.0.0\r\njupyterlab-pygments==0.1.2\r\njupyterlab-python-file==0.5.2\r\njupyterlab-quickopen==1.0.0\r\njupyterlab-server==2.1.1\r\njupyterlab-widgets==1.0.0\r\nkeyring==21.8.0\r\nkiwisolver==1.3.1\r\nlanguage-selector==0.1\r\nlaunchpadlib==1.10.13\r\nlazr.restfulclient==0.14.2\r\nlazr.uri==1.0.3\r\nlazy-object-proxy==1.5.2\r\nlibarchive-c==2.9\r\nlief==0.10.1\r\nllvmlite==0.35.0\r\nlocket==0.2.0\r\nlockfile==0.12.2\r\nlxml==4.6.2\r\nlz4==3.1.1\r\nMako==1.1.3\r\nMarkupSafe==1.1.1\r\nmatplotlib==3.3.3\r\nmccabe==0.6.1\r\nmetakernel==0.27.5\r\nmistune==0.8.4\r\nmkl==2021.1.1\r\nmock==4.0.3\r\nmore-itertools==8.6.0\r\nmpmath==1.1.0\r\nmprofile==0.0.10\r\nmsgpack==1.0.2\r\nMultiMapping==4.1\r\nmultipledispatch==0.6.0\r\nnatsort==7.0.1\r\nnbclassic==0.2.6\r\nnbclient==0.5.1\r\nnbconvert==6.0.7\r\nnbdime==2.1.0\r\nnbformat==5.0.8\r\nnest-asyncio==1.4.3\r\nnetaddr==0.7.19\r\nnetCDF4==1.5.4\r\nnetifaces==0.10.4\r\nnetworkx==2.5\r\nnltk==3.5\r\nnose==1.3.7\r\nnotebook==6.1.6\r\nntlm-auth==1.1.0\r\nnumba==0.52.0\r\nnumexpr==2.7.2\r\nnumpy==1.19.5\r\noauthenticator==0.12.3\r\noauthlib==3.1.0\r\nobspy==1.2.2\r\noctave-kernel==0.32.0\r\nolefile==0.46\r\nopenpyxl==3.0.5\r\npackaging==20.8\r\npamela==1.0.0\r\npandas==1.2.0\r\npandoc==1.0.2\r\npandocfilters==1.4.3\r\npari-jupyter==1.3.2\r\nparsedatetime==2.4\r\nparso==0.7.1\r\npartd==1.1.0\r\nPasteDeploy==2.1.1\r\npath==15.0.1\r\npathlib2==2.3.5\r\npathtools==0.1.2\r\npatsy==0.5.1\r\npbr==5.4.5\r\npep517==0.8.2\r\npep8==1.7.1\r\nPersistence==3.0\r\npersistent==4.6.4\r\npexpect==4.8.0\r\npickleshare==0.7.5\r\nPillow==8.1.0\r\npkginfo==1.6.1\r\nplink==2.3.1\r\npluggy==0.13.1\r\nply==3.11\r\nprogress==1.5\r\nprometheus-client==0.9.0\r\nprompt-toolkit==3.0.10\r\nprotobuf==3.6.1\r\npsutil==5.8.0\r\npsycopg2-binary==2.8.6\r\nptyprocess==0.7.0\r\npy==1.10.0\r\nPyAFS==0.2.3\r\npyasn1==0.4.2\r\npyasn1-modules==0.2.1\r\npycodestyle==2.6.0\r\npycosat==0.6.3\r\npycparser==2.20\r\npycrypto==2.6.1\r\npycurl==7.43.0.6\r\npydantic==1.7.2\r\npydocstyle==5.1.1\r\npyerfa==1.7.1.1\r\npyflakes==2.2.0\r\nPygments==2.7.3\r\nPyGObject==3.36.0\r\nPyHamcrest==1.9.0\r\nPyHesiod==0.2.13\r\nPyICU==2.4.2\r\nPyJWT==1.7.1\r\npykerberos==1.1.14\r\npylint==2.6.0\r\npymacaroons==0.13.0\r\nPyNaCl==1.3.0\r\npyodbc==4.0.30\r\npyOpenSSL==20.0.1\r\npyparsing==2.4.7\r\npypng==0.0.20\r\npypprof==0.0.1\r\npyproj==3.0.0.post1\r\npyRFC3339==1.1\r\npyrsistent==0.17.3\r\npyserial==3.4\r\npyshp==2.1.2\r\nPySocks==1.7.1\r\npytest==6.2.1\r\npython-apt==2.0.0+ubuntu0.20.4.1\r\npython-augeas==0.5.0\r\npython-dateutil==2.8.1\r\npython-debian===0.1.36ubuntu1\r\npython-dotenv==0.15.0\r\npython-editor==1.0.4\r\npython-gettext==4.0\r\npython-json-logger==2.0.1\r\npython-jsonrpc-server==0.4.0\r\npython-language-server==0.36.2\r\npython-magic==0.4.16\r\npytoml==0.1.21\r\npytz==2020.5\r\nPyWavelets==1.1.1\r\npywinrm==0.3.0\r\npyxdg==0.27\r\nPyYAML==5.3.1\r\npyzmq==20.0.0\r\nQtPy==1.9.0\r\nregex==2020.11.13\r\nrequests==2.25.1\r\nrequests-kerberos==0.12.0\r\nrequests-ntlm==1.1.0\r\nrequests-toolbelt==0.8.0\r\nrequests-unixsocket==0.2.0\r\nRestrictedPython==5.1\r\nretrying==1.3.3\r\nrfc3986==1.4.0\r\nroman==2.0.0\r\nrope==0.18.0\r\nruamel.yaml==0.16.12\r\nruamel.yaml.clib==0.2.2\r\ns3transfer==0.3.3\r\nscikit-bio==0.5.6\r\nscikit-dataaccess==1.9.17.post2\r\nscikit-image==0.18.1\r\nscikit-learn==0.24.0\r\nscikit-rf==0.15.5\r\nscipy==1.6.0\r\nseaborn==0.11.1\r\nSecretStorage==3.3.0\r\nselinux==3.0\r\nSend2Trash==1.5.0\r\nservice-identity==18.1.0\r\nShapely==1.7.1\r\nsimplegeneric==0.8.1\r\nsimplejson==3.16.0\r\nsingledispatch==3.4.0.3\r\nsip==6.0.0\r\nsipb-jupyter==1.0\r\nsix==1.15.0\r\nsmmap==3.0.4\r\nsnappy==2.8\r\nsnappy-manifolds==1.1.2\r\nsniffio==1.2.0\r\nsnowballstemmer==2.0.0\r\nsortedcollections==1.2.3\r\nsortedcontainers==2.3.0\r\nsoupsieve==2.1\r\nspherogram==1.8.3\r\nSphinx==1.8.5\r\nsphinx-rtd-theme==0.4.3\r\nSQLAlchemy==1.3.22\r\nSQLAlchemy-Utc==0.11.0\r\nssh-import-id==5.10\r\nstarlette==0.13.6\r\nstatsmodels==0.12.1\r\nsympy==1.7.1\r\nsystemd-python==234\r\ntables==3.6.1\r\ntbb==2021.1.1\r\ntblib==1.7.0\r\nterminado==0.9.2\r\ntestpath==0.4.4\r\nthreadpoolctl==2.1.0\r\ntifffile==2020.10.1\r\ntoml==0.10.2\r\ntoolz==0.11.1\r\ntornado==6.1\r\ntqdm==4.56.0\r\ntraitlets==5.0.5\r\ntransaction==3.0.0\r\nTwisted==18.9.0\r\ntyping==3.7.4.3\r\ntyping-extensions==3.7.4.3\r\nubuntu-advantage-tools==20.3\r\nufw==0.36\r\nujson==4.0.1\r\nunattended-upgrades==0.1\r\nunicodecsv==0.14.1\r\nunidiff==0.5.5\r\nurllib3==1.26.2\r\nuvicorn==0.12.2\r\nuvloop==0.14.0\r\nvarlink==30.3.1\r\nvirtualenv==20.0.17\r\nwadllib==1.3.3\r\nwaitress==1.4.4\r\nwatchdog==1.0.2\r\nwatchgod==0.6\r\nwcwidth==0.2.5\r\nwebencodings==0.5.1\r\nWebOb==1.8.6\r\nwebsockets==8.1\r\nWebTest==2.0.35\r\nWerkzeug==1.0.1\r\nwidgetsnbextension==3.5.1\r\nwrapt==1.12.1\r\nWSGIProxy2==0.4.6\r\nwurlitzer==2.0.1\r\nxarray==0.16.1\r\nxlrd==2.0.1\r\nXlsxWriter==1.3.7\r\nxlwt==1.3.0\r\nxmltodict==0.12.0\r\nyapf==0.30.0\r\nz3c.pt==3.3.0\r\nzc.lockfile==2.0\r\nZConfig==3.5.0\r\nzExceptions==4.1\r\nzict==2.0.0\r\nzipp==3.4.0\r\nZODB==5.6.0\r\nzodbpickle==2.0.0\r\nZope==5.1\r\nzope.annotation==4.7.0\r\nzope.browser==2.3\r\nzope.browsermenu==4.4\r\nzope.browserpage==4.4.0\r\nzope.browserresource==4.4\r\nzope.cachedescriptors==4.3.1\r\nzope.component==4.3.0\r\nzope.configuration==4.4.0\r\nzope.container==4.4.0\r\nzope.contentprovider==4.2.1\r\nzope.contenttype==4.5.0\r\nzope.deferredimport==4.3.1\r\nzope.deprecation==4.4.0\r\nzope.dottedname==4.3\r\nzope.event==4.5.0\r\nzope.exceptions==4.4\r\nzope.filerepresentation==5.0.0\r\nzope.globalrequest==1.5\r\nzope.hookable==5.0.0\r\nzope.i18n==4.7.0\r\nzope.i18nmessageid==5.0.1\r\nzope.interface==5.2.0\r\nzope.lifecycleevent==4.3\r\nzope.location==4.2\r\nzope.pagetemplate==4.5.0\r\nzope.processlifetime==2.3.0\r\nzope.proxy==4.3.5\r\nzope.ptresource==4.2.0\r\nzope.publisher==5.2.1\r\nzope.schema==6.0.0\r\nzope.security==5.1.1\r\nzope.sequencesort==4.1.2\r\nzope.site==4.4.0\r\nzope.size==4.3\r\nzope.structuredtext==4.3\r\nzope.tal==4.4\r\nzope.tales==5.1\r\nzope.testbrowser==5.5.1\r\nzope.testing==4.7\r\nzope.traversing==4.4.1\r\nzope.viewlet==4.2.1\r\nzprofile==1.0.11\r\nzstd==1.4.8.1\r\n```\r\n</details>\r\n\r\n<details><summary>Configuration</summary>\r\n<!--\r\nFor JupyterHub, especially include information such as what Spawner and Authenticator are being used.\r\nBe careful not to share any sensitive information.\r\nYou can paste jupyterhub_config.py below.\r\nTo exclude lots of comments and empty lines from auto-generated jupyterhub_config.py, you can do:\r\n    grep -v '\\(^#\\|^[[:space:]]*$\\)' jupyterhub_config.py\r\n-->\r\n\r\nVisible at https://github.com/sipb/jupyter/blob/master/ansible/roles/jupyter-jupyter/files/jupyterhub_config.py\r\n</details>\r\n\r\n<details><summary>Logs</summary>\r\n\r\n\r\n```\r\nJan 11 21:46:09 jupyter.mit.edu bash[452754]: [W 2021-01-11 21:46:09.421 SingleUserNotebookApp auth:551] Token stored in cookie may have expired\r\nJan 11 21:46:09 jupyter.mit.edu bash[452754]: [D 2021-01-11 21:46:09.421 SingleUserNotebookApp auth:504] No user identified\r\nJan 11 21:46:09 jupyter.mit.edu bash[452754]: [W 2021-01-11 21:46:09.421 SingleUserNotebookApp auth:682] Detected unused OAuth state cookies\r\nJan 11 21:46:09 jupyter.mit.edu bash[452754]: [D 2021-01-11 21:46:09.421 SingleUserNotebookApp auth:835] Redirecting to login url: https://jupyter.mit.edu/hub/api/oauth2/authorize?client_id=jupyterhub-user-quentin&redirect_uri=https%3A%2F%2Fquentin.jupyter.mit.edu%2Fuser%2FquentinREMOVED\r\nJan 11 21:46:09 jupyter.mit.edu bash[452754]: [I 2021-01-11 21:46:09.422 SingleUserNotebookApp log:181] 302 GET /user/quentin/api/terminals?1610401569386 -> https://jupyter.mit.edu/hub/api/oauth2/authorize?client_id=jupyterhub-user-quentin&redirect_uri=https%3A%2F%2Fquentin.jupyter.mit.eduREMOVED\r\n```\r\n```\r\nJan 11 21:46:00 jupyter.mit.edu jupyterhub[448805]: [W 2021-01-11 21:46:00.731 JupyterHub log:181] 405 OPTIONS /hub/api/oauth2/authorize?client_id=jupyterhub-user-quentin&redirect_uri=https%3A%2F%2Fquentin.jupyter.mit.edu%2Fuser%2Fquentin%2Foauth_callback&response_type=code&state=[secret] >\r\nJan 11 21:46:09 jupyter.mit.edu jupyterhub[448805]: [W 2021-01-11 21:46:09.477 JupyterHub log:181] 405 OPTIONS /hub/api/oauth2/authorize?client_id=jupyterhub-user-quentin&redirect_uri=https%3A%2F%2Fquentin.jupyter.mit.edu%2Fuser%2Fquentin%2Foauth_callback&response_type=code&state=[secret] >\r\nJan 11 21:46:10 jupyter.mit.edu jupyterhub[448805]: [W 2021-01-11 21:46:10.801 JupyterHub log:181] 405 OPTIONS /hub/api/oauth2/authorize?client_id=jupyterhub-user-quentin&redirect_uri=https%3A%2F%2Fquentin.jupyter.mit.edu%2Fuser%2Fquentin%2Foauth_callback&response_type=code&state=[secret] >\r\nJan 11 21:46:18 jupyter.mit.edu jupyterhub[448805]: [W 2021-01-11 21:46:18.826 JupyterHub log:181] 405 OPTIONS /hub/api/oauth2/authorize?client_id=jupyterhub-user-quentin&redirect_uri=https%3A%2F%2Fquentin.jupyter.mit.edu%2Fuser%2Fquentin%2Foauth_callback&response_type=code&state=[secret] >\r\n```\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3328/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3328/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3308", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3308/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3308/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3308/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3308", "id": 768840506, "node_id": "MDExOlB1bGxSZXF1ZXN0NTQxMTQ4NDc0", "number": 3308, "title": "[rbac] fixed default roles for mocked services", "user": {"login": "IvanaH8", "id": 12073028, "node_id": "MDQ6VXNlcjEyMDczMDI4", "avatar_url": "https://avatars.githubusercontent.com/u/12073028?v=4", "gravatar_id": "", "url": "https://api.github.com/users/IvanaH8", "html_url": "https://github.com/IvanaH8", "followers_url": "https://api.github.com/users/IvanaH8/followers", "following_url": "https://api.github.com/users/IvanaH8/following{/other_user}", "gists_url": "https://api.github.com/users/IvanaH8/gists{/gist_id}", "starred_url": "https://api.github.com/users/IvanaH8/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/IvanaH8/subscriptions", "organizations_url": "https://api.github.com/users/IvanaH8/orgs", "repos_url": "https://api.github.com/users/IvanaH8/repos", "events_url": "https://api.github.com/users/IvanaH8/events{/privacy}", "received_events_url": "https://api.github.com/users/IvanaH8/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-12-16T12:59:53Z", "updated_at": "2021-04-12T14:46:38Z", "closed_at": "2020-12-17T07:44:24Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3308", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3308", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3308.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3308.patch", "merged_at": "2020-12-17T07:44:24Z"}, "body": "Ref.: User roles (RBAC) #2245 \r\n\r\nFixes default role assignment for mocked services used in tests.\r\n\r\nAs @0mar pointed out (thank you!), the mocked services in API tests were not being assigned default roles. \r\n\r\nThis is now fixed with calling `mock_roles` function (added to roles.py) in conftest.py, which assigns a default role to the mocked service.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3308/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3308/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3306", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3306/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3306/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3306/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3306", "id": 766720469, "node_id": "MDU6SXNzdWU3NjY3MjA0Njk=", "number": 3306, "title": "onload event in JupyterLab %%javascript or %%html cells does not work with JupyterHub", "user": {"login": "stefaneidelloth", "id": 12675339, "node_id": "MDQ6VXNlcjEyNjc1MzM5", "avatar_url": "https://avatars.githubusercontent.com/u/12675339?v=4", "gravatar_id": "", "url": "https://api.github.com/users/stefaneidelloth", "html_url": "https://github.com/stefaneidelloth", "followers_url": "https://api.github.com/users/stefaneidelloth/followers", "following_url": "https://api.github.com/users/stefaneidelloth/following{/other_user}", "gists_url": "https://api.github.com/users/stefaneidelloth/gists{/gist_id}", "starred_url": "https://api.github.com/users/stefaneidelloth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/stefaneidelloth/subscriptions", "organizations_url": "https://api.github.com/users/stefaneidelloth/orgs", "repos_url": "https://api.github.com/users/stefaneidelloth/repos", "events_url": "https://api.github.com/users/stefaneidelloth/events{/privacy}", "received_events_url": "https://api.github.com/users/stefaneidelloth/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-12-14T17:00:16Z", "updated_at": "2020-12-14T17:34:30Z", "closed_at": "2020-12-14T17:34:29Z", "author_association": "NONE", "active_lock_reason": null, "body": "See\r\nhttps://github.com/jupyterlab/jupyterlab/issues/9466\r\n\r\n(I don't know if this is a JupyerLab or JupyterHub issue.)", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3306/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3306/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3304", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3304/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3304/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3304/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3304", "id": 761789976, "node_id": "MDU6SXNzdWU3NjE3ODk5NzY=", "number": 3304, "title": "Anti-CSRF token is not working in Admin panel", "user": {"login": "jhespeter", "id": 5623182, "node_id": "MDQ6VXNlcjU2MjMxODI=", "avatar_url": "https://avatars.githubusercontent.com/u/5623182?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhespeter", "html_url": "https://github.com/jhespeter", "followers_url": "https://api.github.com/users/jhespeter/followers", "following_url": "https://api.github.com/users/jhespeter/following{/other_user}", "gists_url": "https://api.github.com/users/jhespeter/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhespeter/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhespeter/subscriptions", "organizations_url": "https://api.github.com/users/jhespeter/orgs", "repos_url": "https://api.github.com/users/jhespeter/repos", "events_url": "https://api.github.com/users/jhespeter/events{/privacy}", "received_events_url": "https://api.github.com/users/jhespeter/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-12-11T02:02:14Z", "updated_at": "2022-09-09T07:25:04Z", "closed_at": "2022-09-09T07:25:04Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\nIn JupyterHub's Admin panel, the _xsrf token is not working for add/delete user features.\r\nCurrent mechanism to protect add/delete user features against CSRF attack is solely rely on checking the Referer header value. \r\nAlthough current referer header examination seems to be strict enough, it could still be bypassed if user is fooled to install malicious browser plugin or there exists any escape techniques.\r\n\r\n#### Expected behaviour\r\nImplement anti-CSRF techniques like Double Submit Cookie, so that JupyterHub could prevent CSRF attack.\r\n\r\n#### Actual behaviour\r\nEven if the _xsrf token is removed the add/delete user requests could still be accepted & processed by server. \r\nThat could lead to a possible CSRF attack.\r\n\r\nScreen Capture of successfully adding user without _xsrf token\r\n![AddUser](https://user-images.githubusercontent.com/5623182/101851928-78ef9600-3b97-11eb-9481-a33819dfaba3.jpg)\r\n\r\nScreen Capture of successfully deleting user without _xsrf token\r\n![DelUser](https://user-images.githubusercontent.com/5623182/101852030-b5bb8d00-3b97-11eb-8fb4-d54cd26c816b.jpg)\r\n\r\n### How to reproduce\r\n1. Log in JupyterHub console with admin privilege\r\n2. Click Control Panel button\r\n3. Click Admin tab\r\n4. Click Add User button / Delete User button\r\n5. Use proxy technique to intercept the packet sent\r\n6. Modify the packet by removing the _xsrf token\r\n7. Send the request & see the request is accepted\r\n\r\n### Your personal set up\r\n - OS:\r\nKubernetes 1.12 + , Helm charts 3.0 + , ubi 7.8+\r\n\r\n - Version(s):\r\nJupyterHub 1.1.0, Python 3.8\r\n\r\n### Reference\r\nOWASP - Cross-Site Request Forgery Prevention Cheat Sheet\r\nhttps://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html#double-submit-cookie", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3304/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3304/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3298", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3298/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3298/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3298/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3298", "id": 755501403, "node_id": "MDExOlB1bGxSZXF1ZXN0NTMxMTk5OTgx", "number": 3298, "title": "Fix asyncio deprecation asyncio.Task.all_tasks", "user": {"login": "coffeebenzene", "id": 12532669, "node_id": "MDQ6VXNlcjEyNTMyNjY5", "avatar_url": "https://avatars.githubusercontent.com/u/12532669?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coffeebenzene", "html_url": "https://github.com/coffeebenzene", "followers_url": "https://api.github.com/users/coffeebenzene/followers", "following_url": "https://api.github.com/users/coffeebenzene/following{/other_user}", "gists_url": "https://api.github.com/users/coffeebenzene/gists{/gist_id}", "starred_url": "https://api.github.com/users/coffeebenzene/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coffeebenzene/subscriptions", "organizations_url": "https://api.github.com/users/coffeebenzene/orgs", "repos_url": "https://api.github.com/users/coffeebenzene/repos", "events_url": "https://api.github.com/users/coffeebenzene/events{/privacy}", "received_events_url": "https://api.github.com/users/coffeebenzene/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-12-02T18:15:45Z", "updated_at": "2021-04-12T14:47:18Z", "closed_at": "2020-12-03T10:16:46Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3298", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3298", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3298.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3298.patch", "merged_at": "2020-12-03T10:16:46Z"}, "body": "This is to fix #3297 ", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3298/reactions", "total_count": 3, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 3, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3298/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3297", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3297/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3297/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3297/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3297", "id": 755500545, "node_id": "MDU6SXNzdWU3NTU1MDA1NDU=", "number": 3297, "title": "Cannot shutdown on python 3.9 due to asyncio deprecation", "user": {"login": "coffeebenzene", "id": 12532669, "node_id": "MDQ6VXNlcjEyNTMyNjY5", "avatar_url": "https://avatars.githubusercontent.com/u/12532669?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coffeebenzene", "html_url": "https://github.com/coffeebenzene", "followers_url": "https://api.github.com/users/coffeebenzene/followers", "following_url": "https://api.github.com/users/coffeebenzene/following{/other_user}", "gists_url": "https://api.github.com/users/coffeebenzene/gists{/gist_id}", "starred_url": "https://api.github.com/users/coffeebenzene/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coffeebenzene/subscriptions", "organizations_url": "https://api.github.com/users/coffeebenzene/orgs", "repos_url": "https://api.github.com/users/coffeebenzene/repos", "events_url": "https://api.github.com/users/coffeebenzene/events{/privacy}", "received_events_url": "https://api.github.com/users/coffeebenzene/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-12-02T18:14:25Z", "updated_at": "2020-12-03T10:16:46Z", "closed_at": "2020-12-03T10:16:46Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Bug description\r\nWhen using jupyterhub with python3.9, you will not be able to shutdown (e.g. via ctrl+c). When attempting to stop asyncio tasks, you will get `type object '_asyncio.Task' has no attribute 'all_tasks'` error. `asyncio.Task.all_tasks()` and `current_task()` have been deprecated since python 3.7 and is fully removed in 3.9.  So all references to `asyncio.Task.all_tasks()` should change to `asyncio.all_tasks()`.\r\n\r\nI have a fix that will accommodate python3.6 and later. It's quite a simple fix. I hope it fits the conventions that this project uses. btw, if support for python3.6 can be dropped, then the change is even simpler and without any clutter.\r\n\r\n#### Expected behaviour\r\njupyterhub should terminate gracefully like:\r\n```\r\n^C[C 2020-12-02 17:50:48.625 JupyterHub app:2826] Received signal SIGINT, initiating shutdown...\r\n[I 2020-12-02 17:50:48.626 JupyterHub app:2467] Cleaning up single-user servers...\r\n[I 2020-12-02 17:50:48.627 JupyterHub proxy:735] Cleaning up proxy[9371]...\r\n17:50:48.633 [ConfigProxy] warn: Terminated\r\n[I 2020-12-02 17:50:48.638 JupyterHub app:2499] ...done\r\n```\r\n\r\n#### Actual behaviour\r\n```\r\n^C[C 2020-12-02 16:16:45.801 JupyterHub app:2810] Received signal SIGINT, initiating shutdown...\r\nERROR:asyncio:Task exception was never retrieved\r\nfuture: <Task finished name='Task-8' coro=<JupyterHub.shutdown_cancel_tasks() done, defined at /opt/miniconda3/envs/jupyterhub/lib/python3.9/site-packages/jupyterhub/app.py:2808> exception=AttributeError(\"type object '_asyncio.Task' has no attribute 'all_tasks'\")>\r\nTraceback (most recent call last):\r\n  File \"/opt/miniconda3/envs/jupyterhub/lib/python3.9/site-packages/jupyterhub/app.py\", line 2812, in shutdown_cancel_tasks\r\n    t for t in asyncio.Task.all_tasks() if t is not asyncio.Task.current_task()\r\nAttributeError: type object '_asyncio.Task' has no attribute 'all_tasks'\r\n```\r\n\r\n### How to reproduce\r\nI'm using conda to install python and jupyterhub\r\n```\r\nconda create -n jupyterhub python=3.9 jupyterhub\r\njupyterhub\r\nctrl-c\r\n```\r\n\r\n### Your personal set up\r\n - OS:\r\nUbuntu  20.04.1\r\n - Version:\r\njupyterhub 1.2.2\r\n - Configuration:\r\nusing conda, as shown above.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3297/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3297/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3294", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3294/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3294/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3294/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3294", "id": 755207478, "node_id": "MDExOlB1bGxSZXF1ZXN0NTMwOTYzNjg1", "number": 3294, "title": "fix increasing pagination limits", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-12-02T11:53:42Z", "updated_at": "2020-12-08T09:03:55Z", "closed_at": "2020-12-08T09:03:52Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3294", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3294", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3294.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3294.patch", "merged_at": "2020-12-08T09:03:52Z"}, "body": "setting per_page in constructor resolves before max_per_page limit is updated from config, preventing max_per_page from being increased beyond the default limit.\r\n\r\nwe already loaded these values anyway in the first Pagination instance, so remove the redundant Pagination object and the values work out.\r\n\r\ncloses #3229", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3294/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3294/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3289", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3289/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3289/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3289/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3289", "id": 753439673, "node_id": "MDExOlB1bGxSZXF1ZXN0NTI5NTE4MzUz", "number": 3289, "title": "fix and test TOTAL_USERS count", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-11-30T12:31:06Z", "updated_at": "2020-12-02T12:01:03Z", "closed_at": "2020-11-30T14:21:49Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3289", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3289", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3289.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3289.patch", "merged_at": "2020-11-30T14:21:48Z"}, "body": "Don't assume UserDict contains all users\n\nwhich assumption led to double-counting when a user in the db was loaded into the dict cache\n\ncloses #3280", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3289/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3289/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3280", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3280/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3280/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3280/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3280", "id": 750409934, "node_id": "MDU6SXNzdWU3NTA0MDk5MzQ=", "number": 3280, "title": "/hub/metrics total_users double the actual value", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 106589226, "node_id": "MDU6TGFiZWwxMDY1ODkyMjY=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/help%20wanted", "name": "help wanted", "color": "0e8a16", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-11-25T04:30:42Z", "updated_at": "2020-11-30T14:21:48Z", "closed_at": "2020-11-30T14:21:48Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "As @ianabc reported in https://github.com/jupyterhub/jupyterhub/issues/2685#issuecomment-732310172, there is a discrepancy for the `total_users` metric reported in `/hub/metrics` with the total users reported in `/hub/admin`.\r\n\r\nI'm using a JupyterHub 1.2.1. I would guess that total_users is incremented twice per user by mistake.\r\n\r\n## /hub/metrics\r\n\r\n```\r\n# HELP total_users total number of users\r\n# TYPE total_users gauge\r\ntotal_users 960.0\r\n```\r\n\r\n## /hub/admin\r\n\r\n![image](https://user-images.githubusercontent.com/3837114/100183363-074cf200-2edf-11eb-8e6c-888fda72a917.png)\r\n\r\n\r\n![image](https://user-images.githubusercontent.com/3837114/100183225-ade4c300-2ede-11eb-8245-6274cfe59d8b.png)\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3280/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3280/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3277", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3277/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3277/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3277/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3277", "id": 747903736, "node_id": "MDU6SXNzdWU3NDc5MDM3MzY=", "number": 3277, "title": "options_form bypassed when /hub/spawn receives query params in 1.2.1", "user": {"login": "dirkcgrunwald", "id": 989516, "node_id": "MDQ6VXNlcjk4OTUxNg==", "avatar_url": "https://avatars.githubusercontent.com/u/989516?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dirkcgrunwald", "html_url": "https://github.com/dirkcgrunwald", "followers_url": "https://api.github.com/users/dirkcgrunwald/followers", "following_url": "https://api.github.com/users/dirkcgrunwald/following{/other_user}", "gists_url": "https://api.github.com/users/dirkcgrunwald/gists{/gist_id}", "starred_url": "https://api.github.com/users/dirkcgrunwald/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dirkcgrunwald/subscriptions", "organizations_url": "https://api.github.com/users/dirkcgrunwald/orgs", "repos_url": "https://api.github.com/users/dirkcgrunwald/repos", "events_url": "https://api.github.com/users/dirkcgrunwald/events{/privacy}", "received_events_url": "https://api.github.com/users/dirkcgrunwald/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2020-11-21T02:20:13Z", "updated_at": "2020-11-24T06:07:11Z", "closed_at": "2020-11-24T06:07:11Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\nIn a test setup of z2jh 0.10.3 using microk8s (see https://github.com/dirkcgrunwald/zero-to-jupyterhub-microk8s/tree/master/fancypants ) I use a list of profiles for students to select containers appropriate for their class. Normally when students log in, they are presented with a profile list with those options.\r\n\r\nWhen I use Google Oauth and 0.10.3 the user isn't given a chance to select appropriate profile when they initially log in. If they go to the \"Hub control panel\", kill the server and start a new server the profile is shown.\r\n\r\nThe repo mentioned above uses CSS/js to make the display fancy but deleting that and using the plain vanilla profile list has the same behavior -- the \"default\" profile is used.\r\n\r\n#### Expected behaviour\r\nI would expect to be able to select a profile when I first authenticate using Google Oauth.\r\n\r\n#### Actual behaviour\r\nProfile list is not shown but is available when using the \"Hub control panel\" login.\r\n\r\n### How to reproduce\r\nThe git repo above is a cookbook for deploying using microk8s. If one adds in Google oauth into the specified \"fancy\" configuration that has multiple profiles, it occurs. If you remove google oauth the profile list is shown on login.\r\n\r\n### Your personal set up\r\nDocumented in the github repo above.\r\n\r\n - OS: Ubuntu 20.04\r\n - Version: 0.10.3\r\n - Configuration: https://github.com/dirkcgrunwald/zero-to-jupyterhub-microk8s/blob/master/fancypants/z2jh-config-fancy.yaml\r\n\r\nwith google oauth added in (not shown, but the same as I use in 0.9 in other setups)", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3277/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3277/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3265", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3265/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3265/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3265/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3265", "id": 745691219, "node_id": "MDExOlB1bGxSZXF1ZXN0NTIzMjEwODIx", "number": 3265, "title": "Fix RootHandler when default_url is a callable", "user": {"login": "danlester", "id": 786238, "node_id": "MDQ6VXNlcjc4NjIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/786238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/danlester", "html_url": "https://github.com/danlester", "followers_url": "https://api.github.com/users/danlester/followers", "following_url": "https://api.github.com/users/danlester/following{/other_user}", "gists_url": "https://api.github.com/users/danlester/gists{/gist_id}", "starred_url": "https://api.github.com/users/danlester/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/danlester/subscriptions", "organizations_url": "https://api.github.com/users/danlester/orgs", "repos_url": "https://api.github.com/users/danlester/repos", "events_url": "https://api.github.com/users/danlester/events{/privacy}", "received_events_url": "https://api.github.com/users/danlester/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-11-18T14:07:26Z", "updated_at": "2020-11-27T08:48:57Z", "closed_at": "2020-11-20T08:14:47Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3265", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3265", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3265.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3265.patch", "merged_at": "2020-11-20T08:14:47Z"}, "body": "default_url can now be a callable, and this fixes a possible internal server error if the user is already logged in.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3265/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3265/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3261", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3261/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3261/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3261/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3261", "id": 744611044, "node_id": "MDExOlB1bGxSZXF1ZXN0NTIyMzA0NTkz", "number": 3261, "title": "Only preserve params when ?next= is unspecified", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-11-17T10:31:30Z", "updated_at": "2020-11-20T08:47:56Z", "closed_at": "2020-11-20T08:47:22Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3261", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3261", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3261.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3261.patch", "merged_at": "2020-11-20T08:47:21Z"}, "body": "Adding params for the current request when `?next=...` has been specified can result in extra parameters being added that should not be.\n\nAdditionally, fix the case where parameters on the root `/` handler were not preserved for initial, unauthenticated requests, resulting in different destinations based on initial authenticated state\n\nI believe this fixes #3247\n\ncloses #3254", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3261/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3261/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3247", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3247/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3247/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3247/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3247", "id": 739015850, "node_id": "MDU6SXNzdWU3MzkwMTU4NTA=", "number": 3247, "title": "Jupyter skips spawn form after authentication", "user": {"login": "vpavlin", "id": 4759808, "node_id": "MDQ6VXNlcjQ3NTk4MDg=", "avatar_url": "https://avatars.githubusercontent.com/u/4759808?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vpavlin", "html_url": "https://github.com/vpavlin", "followers_url": "https://api.github.com/users/vpavlin/followers", "following_url": "https://api.github.com/users/vpavlin/following{/other_user}", "gists_url": "https://api.github.com/users/vpavlin/gists{/gist_id}", "starred_url": "https://api.github.com/users/vpavlin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vpavlin/subscriptions", "organizations_url": "https://api.github.com/users/vpavlin/orgs", "repos_url": "https://api.github.com/users/vpavlin/repos", "events_url": "https://api.github.com/users/vpavlin/events{/privacy}", "received_events_url": "https://api.github.com/users/vpavlin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2020-11-09T13:10:34Z", "updated_at": "2020-11-18T07:10:45Z", "closed_at": "2020-11-18T07:10:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML commments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\nWe have just noticed a change in behaviour, probably coming from https://github.com/jupyterhub/jupyterhub/commit/6f2e409fb9bb4959310f26f2316bc4d4d228acc0\r\n\r\nJupyterHub skips spawner now directly after authentication as it seems some params are passed along from auth and callback:\r\n\r\n```\r\n302 GET /hub/oauth_callback?code=[secret]&state=[secret] -> /hub/spawn?code=[secret]&state=[secret] (@::ffff:10.128.2.1) 261.56ms\r\n302 GET /hub/spawn?code=[secret]&state=[secret] -> /hub/spawn-pending/vpavlin?code=[secret]&state=[secret] \r\n```\r\n\r\nThe `code` seems to trigger the code in the commit linked above.\r\n\r\nThis is our oauth config: https://github.com/opendatahub-io/jupyterhub-odh/blob/master/.jupyter/jupyterhub_config.py#L86-L143\r\n\r\nIs it possible that it is a misconfiguration on our side? Could it be an issue with authenticator?\r\n\r\n#### Expected behaviour\r\nSpawner is shown\r\n\r\n#### Actual behaviour\r\nSpawner is skipped\r\n\r\n### How to reproduce\r\nI don't have a simple reproducer at the moment, but I can try to get one if this turns out to me more complicated\r\n\r\n### Your personal set up\r\n\r\n - OpenShift 4.5\r\n- Kubepawner, oauthenticator/openshift\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3247/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3247/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3239", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3239/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3239/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3239/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3239", "id": 734688542, "node_id": "MDU6SXNzdWU3MzQ2ODg1NDI=", "number": 3239, "title": "Docs for event logging and telemetry have two errors", "user": {"login": "nathancarter", "id": 1316622, "node_id": "MDQ6VXNlcjEzMTY2MjI=", "avatar_url": "https://avatars.githubusercontent.com/u/1316622?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nathancarter", "html_url": "https://github.com/nathancarter", "followers_url": "https://api.github.com/users/nathancarter/followers", "following_url": "https://api.github.com/users/nathancarter/following{/other_user}", "gists_url": "https://api.github.com/users/nathancarter/gists{/gist_id}", "starred_url": "https://api.github.com/users/nathancarter/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nathancarter/subscriptions", "organizations_url": "https://api.github.com/users/nathancarter/orgs", "repos_url": "https://api.github.com/users/nathancarter/repos", "events_url": "https://api.github.com/users/nathancarter/events{/privacy}", "received_events_url": "https://api.github.com/users/nathancarter/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-11-02T17:25:55Z", "updated_at": "2021-01-14T11:01:25Z", "closed_at": "2021-01-14T11:01:25Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\nThe docs about event logging and telemetry have two errors.\r\n\r\n### How to reproduce error 1\r\n1. Go to the docs' [raw source](https://raw.githubusercontent.com/jupyterhub/jupyterhub/ca00c0eab065c18284d0da3ca7b57de14041d3df/docs/source/events/index.rst).\r\n2. Notice that the third paragraph seems to be extraneous, or accidentally left in place when it shouldn't have been.\r\n\r\n### How to reproduce error 1\r\n1. Notice in that same raw source that there is a code block about 60% of the way down the page...\r\n2. Go to the docs [online](https://jupyterhub.readthedocs.io/en/stable/events/index.html).\r\n3. Notice that the code block simply doesn't appear, making the sentence \"Here is a basic example:\" quite confusing, because it is not actually followed by the promised basic example.\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3239/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3239/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3238", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3238/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3238/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3238/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3238", "id": 734403147, "node_id": "MDU6SXNzdWU3MzQ0MDMxNDc=", "number": 3238, "title": "Memory Leak problem", "user": {"login": "PaleNeutron", "id": 8296331, "node_id": "MDQ6VXNlcjgyOTYzMzE=", "avatar_url": "https://avatars.githubusercontent.com/u/8296331?v=4", "gravatar_id": "", "url": "https://api.github.com/users/PaleNeutron", "html_url": "https://github.com/PaleNeutron", "followers_url": "https://api.github.com/users/PaleNeutron/followers", "following_url": "https://api.github.com/users/PaleNeutron/following{/other_user}", "gists_url": "https://api.github.com/users/PaleNeutron/gists{/gist_id}", "starred_url": "https://api.github.com/users/PaleNeutron/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/PaleNeutron/subscriptions", "organizations_url": "https://api.github.com/users/PaleNeutron/orgs", "repos_url": "https://api.github.com/users/PaleNeutron/repos", "events_url": "https://api.github.com/users/PaleNeutron/events{/privacy}", "received_events_url": "https://api.github.com/users/PaleNeutron/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2020-11-02T10:53:22Z", "updated_at": "2021-02-18T03:38:07Z", "closed_at": "2021-02-18T03:38:07Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML commments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\nJupyterhub consumes more and more memory after I open/close notebooks.\r\n\r\nhere is my htop:\r\n\r\n```\r\n21858 root       20   0 28.4G 66244 12032 S  0.0  0.1  0:53.03 \u251c\u2500 /opt/jupyterhub/bin/python3 /opt/jupyterhub/bin/jupyterhub -f /opt/jupyterhub/etc/jupyterhub/jupyterhub_config.p\r\n21942 john       20   0 28.9G 81148 15288 S  0.0  0.1  1:58.82 \u2502  \u251c\u2500 /opt/jupyterhub/bin/python3 /opt/jupyterhub/bin/jupyterhub-singleuser --port=57413 --NotebookApp.default_url=\r\n50412 john       20   0  627M 78088 14360 S  0.0  0.1  0:01.88 \u2502  \u2502  \u251c\u2500 /usr/bin/python3.8 -m ipykernel_launcher -f /home/john/.local/share/jupyter/runtime/kernel-98b2370a-6d76-4\r\n45846 john       20   0  541M 48480 14524 S  0.0  0.1  0:07.57 \u2502  \u2502  \u251c\u2500 /opt/anaconda3/bin/python -m ipykernel_launcher -f /home/john/.local/share/jupyter/runtime/kernel-18c47e41\r\n44049 john       20   0 1779M  293M  155M S  0.0  0.5  0:10.66 \u2502  \u2502  \u251c\u2500 /opt/conda/envs/ml_dev/bin/python -m ipykernel_launcher -f /home/john/.local/share/jupyter/runtime/kernel-\r\n35409 john       20   0  541M 48568 14660 S  0.0  0.1  0:09.22 \u2502  \u2502  \u251c\u2500 /opt/conda/envs/ml_dev/bin/python -m ipykernel_launcher -f /home/john/.local/share/jupyter/runtime/kernel-\r\n22234 john       20   0  598M 47912 13776 S  0.0  0.1  0:12.27 \u2502  \u2502  \u2514\u2500 /usr/bin/python3.8 -m ipykernel_launcher -f /home/john/.local/share/jupyter/runtime/kernel-30266527-046b-4\r\n21871 root       20   0  568M 52256 27164 S  0.0  0.1  0:10.10 \u2502  \u2514\u2500 node /usr/bin/configurable-http-proxy --ip  --port 8000 --api-ip 127.0.0.1 --api-port 8001 --error-target htt\r\n```\r\n\r\nIn fact if I look at all threads, I will find thousands of jupyterhub thread:\r\n\r\n![image](https://user-images.githubusercontent.com/8296331/97860702-8f573600-1d3d-11eb-82c9-3222eebb4566.png)\r\n\r\nthat's not all\r\n\r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\nmemory keep in low level.\r\n\r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\nmemory continue increasing.\r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\njust open and close the same notebook.\r\n\r\n### Your personal set up\r\n<!-- Tell us a little about the system you're using. -->\r\n\r\n - OS:\r\n Ubuntu 18.04\r\n - Version:\r\n1.1.0\r\n <!-- e.g. jupyterhub --version. --->\r\n - Configuration:\r\n <!-- Be careful not to share any sensitive information. --->\r\n\r\n<details>\r\n<summary>config file</summary>\r\n\r\n```python\r\n# Configuration file for jupyterhub.\r\n\r\n#------------------------------------------------------------------------------\r\n# Application(SingletonConfigurable) configuration\r\n#------------------------------------------------------------------------------\r\n\r\n## This is an application.\r\n\r\n## The date format used by logging formatters for %(asctime)s\r\n#c.Application.log_datefmt = '%Y-%m-%d %H:%M:%S'\r\n\r\n## The Logging format template\r\n#c.Application.log_format = '[%(name)s]%(highlevel)s %(message)s'\r\n\r\n## Set the log level by value or name.\r\n#c.Application.log_level = 30\r\n\r\n#------------------------------------------------------------------------------\r\n# JupyterHub(Application) configuration\r\n#------------------------------------------------------------------------------\r\n\r\n## An Application for starting a Multi-User Jupyter Notebook server.\r\n\r\n## Maximum number of concurrent servers that can be active at a time.\r\n#\r\n#  Setting this can limit the total resources your users can consume.\r\n#\r\n#  An active server is any server that's not fully stopped. It is considered\r\n#  active from the time it has been requested until the time that it has\r\n#  completely stopped.\r\n#\r\n#  If this many user servers are active, users will not be able to launch new\r\n#  servers until a server is shutdown. Spawn requests will be rejected with a 429\r\n#  error asking them to try again.\r\n#\r\n#  If set to 0, no limit is enforced.\r\n#c.JupyterHub.active_server_limit = 0\r\n\r\n## Duration (in seconds) to determine the number of active users.\r\n#c.JupyterHub.active_user_window = 1800\r\n\r\n## Resolution (in seconds) for updating activity\r\n#\r\n#  If activity is registered that is less than activity_resolution seconds more\r\n#  recent than the current value, the new value will be ignored.\r\n#\r\n#  This avoids too many writes to the Hub database.\r\n#c.JupyterHub.activity_resolution = 30\r\n\r\n## Grant admin users permission to access single-user servers.\r\n#\r\n#  Users should be properly informed if this is enabled.\r\n#c.JupyterHub.admin_access = False\r\n\r\n## DEPRECATED since version 0.7.2, use Authenticator.admin_users instead.\r\n#c.JupyterHub.admin_users = set()\r\n\r\n## Allow named single-user servers per user\r\n#c.JupyterHub.allow_named_servers = False\r\n\r\n## Answer yes to any questions (e.g. confirm overwrite)\r\n#c.JupyterHub.answer_yes = False\r\n\r\n## PENDING DEPRECATION: consider using services\r\n#\r\n#  Dict of token:username to be loaded into the database.\r\n#\r\n#  Allows ahead-of-time generation of API tokens for use by externally managed\r\n#  services, which authenticate as JupyterHub users.\r\n#\r\n#  Consider using services for general services that talk to the JupyterHub API.\r\n#c.JupyterHub.api_tokens = {}\r\n\r\n## Authentication for prometheus metrics\r\n#c.JupyterHub.authenticate_prometheus = True\r\n\r\n## Class for authenticating users.\r\n#\r\n#          This should be a subclass of :class:`jupyterhub.auth.Authenticator`\r\n#\r\n#          with an :meth:`authenticate` method that:\r\n#\r\n#          - is a coroutine (asyncio or tornado)\r\n#          - returns username on success, None on failure\r\n#          - takes two arguments: (handler, data),\r\n#            where `handler` is the calling web.RequestHandler,\r\n#            and `data` is the POST form data from the login page.\r\n#\r\n#          .. versionchanged:: 1.0\r\n#              authenticators may be registered via entry points,\r\n#              e.g. `c.JupyterHub.authenticator_class = 'pam'`\r\n#\r\n#  Currently installed:\r\n#    - default: jupyterhub.auth.PAMAuthenticator\r\n#    - dummy: jupyterhub.auth.DummyAuthenticator\r\n#    - pam: jupyterhub.auth.PAMAuthenticator\r\n#c.JupyterHub.authenticator_class = 'jupyterhub.auth.PAMAuthenticator'\r\n\r\n## The base URL of the entire application.\r\n#\r\n#  Add this to the beginning of all JupyterHub URLs. Use base_url to run\r\n#  JupyterHub within an existing website.\r\n#\r\n#  .. deprecated: 0.9\r\n#      Use JupyterHub.bind_url\r\n#c.JupyterHub.base_url = '/'\r\n\r\n## The public facing URL of the whole JupyterHub application.\r\n#\r\n#  This is the address on which the proxy will bind. Sets protocol, ip, base_url\r\n#c.JupyterHub.bind_url = 'http://:8000'\r\n\r\n## Whether to shutdown the proxy when the Hub shuts down.\r\n#\r\n#  Disable if you want to be able to teardown the Hub while leaving the proxy\r\n#  running.\r\n#\r\n#  Only valid if the proxy was starting by the Hub process.\r\n#\r\n#  If both this and cleanup_servers are False, sending SIGINT to the Hub will\r\n#  only shutdown the Hub, leaving everything else running.\r\n#\r\n#  The Hub should be able to resume from database state.\r\n#c.JupyterHub.cleanup_proxy = True\r\n\r\n## Whether to shutdown single-user servers when the Hub shuts down.\r\n#\r\n#  Disable if you want to be able to teardown the Hub while leaving the single-\r\n#  user servers running.\r\n#\r\n#  If both this and cleanup_proxy are False, sending SIGINT to the Hub will only\r\n#  shutdown the Hub, leaving everything else running.\r\n#\r\n#  The Hub should be able to resume from database state.\r\n#c.JupyterHub.cleanup_servers = True\r\n\r\n## Maximum number of concurrent users that can be spawning at a time.\r\n#\r\n#  Spawning lots of servers at the same time can cause performance problems for\r\n#  the Hub or the underlying spawning system. Set this limit to prevent bursts of\r\n#  logins from attempting to spawn too many servers at the same time.\r\n#\r\n#  This does not limit the number of total running servers. See\r\n#  active_server_limit for that.\r\n#\r\n#  If more than this many users attempt to spawn at a time, their requests will\r\n#  be rejected with a 429 error asking them to try again. Users will have to wait\r\n#  for some of the spawning services to finish starting before they can start\r\n#  their own.\r\n#\r\n#  If set to 0, no limit is enforced.\r\n#c.JupyterHub.concurrent_spawn_limit = 100\r\n\r\n## The config file to load\r\n#c.JupyterHub.config_file = 'jupyterhub_config.py'\r\n\r\n## DEPRECATED: does nothing\r\n#c.JupyterHub.confirm_no_ssl = False\r\n\r\n## Number of days for a login cookie to be valid. Default is two weeks.\r\n#c.JupyterHub.cookie_max_age_days = 14\r\n\r\n## The cookie secret to use to encrypt cookies.\r\n#\r\n#  Loaded from the JPY_COOKIE_SECRET env variable by default.\r\n#\r\n#  Should be exactly 256 bits (32 bytes).\r\n#c.JupyterHub.cookie_secret = b''\r\n\r\n## File in which to store the cookie secret.\r\n#c.JupyterHub.cookie_secret_file = 'jupyterhub_cookie_secret'\r\n\r\n## The location of jupyterhub data files (e.g. /usr/local/share/jupyterhub)\r\n#c.JupyterHub.data_files_path = '/opt/jupyterhub/share/jupyterhub'\r\n\r\n## Include any kwargs to pass to the database connection. See\r\n#  sqlalchemy.create_engine for details.\r\n#c.JupyterHub.db_kwargs = {}\r\n\r\n## url for the database. e.g. `sqlite:///jupyterhub.sqlite`\r\n#c.JupyterHub.db_url = 'sqlite:///jupyterhub.sqlite'\r\n\r\n## log all database transactions. This has A LOT of output\r\n#c.JupyterHub.debug_db = False\r\n\r\n## DEPRECATED since version 0.8: Use ConfigurableHTTPProxy.debug\r\n#c.JupyterHub.debug_proxy = False\r\n\r\n## If named servers are enabled, default name of server to spawn or open, e.g. by\r\n#  user-redirect.\r\n#c.JupyterHub.default_server_name = ''\r\n\r\n## The default URL for users when they arrive (e.g. when user directs to \"/\")\r\n#\r\n#  By default, redirects users to their own server.\r\n#c.JupyterHub.default_url = ''\r\n\r\n## Dict authority:dict(files). Specify the key, cert, and/or ca file for an\r\n#  authority. This is useful for externally managed proxies that wish to use\r\n#  internal_ssl.\r\n#\r\n#  The files dict has this format (you must specify at least a cert)::\r\n#\r\n#      {\r\n#          'key': '/path/to/key.key',\r\n#          'cert': '/path/to/cert.crt',\r\n#          'ca': '/path/to/ca.crt'\r\n#      }\r\n#\r\n#  The authorities you can override: 'hub-ca', 'notebooks-ca', 'proxy-api-ca',\r\n#  'proxy-client-ca', and 'services-ca'.\r\n#\r\n#  Use with internal_ssl\r\n#c.JupyterHub.external_ssl_authorities = {}\r\n\r\n## Register extra tornado Handlers for jupyterhub.\r\n#\r\n#  Should be of the form ``(\"<regex>\", Handler)``\r\n#\r\n#  The Hub prefix will be added, so `/my-page` will be served at `/hub/my-page`.\r\n#c.JupyterHub.extra_handlers = []\r\n\r\n## DEPRECATED: use output redirection instead, e.g.\r\n#\r\n#  jupyterhub &>> /var/log/jupyterhub.log\r\n#c.JupyterHub.extra_log_file = ''\r\n\r\n## Extra log handlers to set on JupyterHub logger\r\n#c.JupyterHub.extra_log_handlers = []\r\n\r\n## Generate certs used for internal ssl\r\n#c.JupyterHub.generate_certs = False\r\n\r\n## Generate default config file\r\n#c.JupyterHub.generate_config = False\r\n\r\n## The URL on which the Hub will listen. This is a private URL for internal\r\n#  communication. Typically set in combination with hub_connect_url. If a unix\r\n#  socket, hub_connect_url **must** also be set.\r\n#\r\n#  For example:\r\n#\r\n#      \"http://127.0.0.1:8081\"\r\n#      \"unix+http://%2Fsrv%2Fjupyterhub%2Fjupyterhub.sock\"\r\n#\r\n#  .. versionadded:: 0.9\r\n#c.JupyterHub.hub_bind_url = ''\r\n\r\n## The ip or hostname for proxies and spawners to use for connecting to the Hub.\r\n#\r\n#  Use when the bind address (`hub_ip`) is 0.0.0.0 or otherwise different from\r\n#  the connect address.\r\n#\r\n#  Default: when `hub_ip` is 0.0.0.0, use `socket.gethostname()`, otherwise use\r\n#  `hub_ip`.\r\n#\r\n#  Note: Some spawners or proxy implementations might not support hostnames.\r\n#  Check your spawner or proxy documentation to see if they have extra\r\n#  requirements.\r\n#\r\n#  .. versionadded:: 0.8\r\n#c.JupyterHub.hub_connect_ip = ''\r\n\r\n## DEPRECATED\r\n#\r\n#  Use hub_connect_url\r\n#\r\n#  .. versionadded:: 0.8\r\n#\r\n#  .. deprecated:: 0.9\r\n#      Use hub_connect_url\r\n#c.JupyterHub.hub_connect_port = 0\r\n\r\n## The URL for connecting to the Hub. Spawners, services, and the proxy will use\r\n#  this URL to talk to the Hub.\r\n#\r\n#  Only needs to be specified if the default hub URL is not connectable (e.g.\r\n#  using a unix+http:// bind url).\r\n#\r\n#  .. seealso::\r\n#      JupyterHub.hub_connect_ip\r\n#      JupyterHub.hub_bind_url\r\n#\r\n#  .. versionadded:: 0.9\r\n#c.JupyterHub.hub_connect_url = ''\r\n\r\n## The ip address for the Hub process to *bind* to.\r\n#\r\n#  By default, the hub listens on localhost only. This address must be accessible\r\n#  from the proxy and user servers. You may need to set this to a public ip or ''\r\n#  for all interfaces if the proxy or user servers are in containers or on a\r\n#  different host.\r\n#\r\n#  See `hub_connect_ip` for cases where the bind and connect address should\r\n#  differ, or `hub_bind_url` for setting the full bind URL.\r\n#c.JupyterHub.hub_ip = '127.0.0.1'\r\n\r\n## The internal port for the Hub process.\r\n#\r\n#  This is the internal port of the hub itself. It should never be accessed\r\n#  directly. See JupyterHub.port for the public port to use when accessing\r\n#  jupyterhub. It is rare that this port should be set except in cases of port\r\n#  conflict.\r\n#\r\n#  See also `hub_ip` for the ip and `hub_bind_url` for setting the full bind URL.\r\n#c.JupyterHub.hub_port = 8081\r\n\r\n## Timeout (in seconds) to wait for spawners to initialize\r\n#\r\n#  Checking if spawners are healthy can take a long time if many spawners are\r\n#  active at hub start time.\r\n#\r\n#  If it takes longer than this timeout to check, init_spawner will be left to\r\n#  complete in the background and the http server is allowed to start.\r\n#\r\n#  A timeout of -1 means wait forever, which can mean a slow startup of the Hub\r\n#  but ensures that the Hub is fully consistent by the time it starts responding\r\n#  to requests. This matches the behavior of jupyterhub 1.0.\r\n#\r\n#  .. versionadded: 1.1.0\r\n#c.JupyterHub.init_spawners_timeout = 10\r\n\r\n## The location to store certificates automatically created by JupyterHub.\r\n#\r\n#  Use with internal_ssl\r\n#c.JupyterHub.internal_certs_location = 'internal-ssl'\r\n\r\n## Enable SSL for all internal communication\r\n#\r\n#  This enables end-to-end encryption between all JupyterHub components.\r\n#  JupyterHub will automatically create the necessary certificate authority and\r\n#  sign notebook certificates as they're created.\r\n#c.JupyterHub.internal_ssl = False\r\n\r\n## The public facing ip of the whole JupyterHub application (specifically\r\n#  referred to as the proxy).\r\n#\r\n#  This is the address on which the proxy will listen. The default is to listen\r\n#  on all interfaces. This is the only address through which JupyterHub should be\r\n#  accessed by users.\r\n#\r\n#  .. deprecated: 0.9\r\n#      Use JupyterHub.bind_url\r\n#c.JupyterHub.ip = ''\r\n\r\n## Supply extra arguments that will be passed to Jinja environment.\r\n#c.JupyterHub.jinja_environment_options = {}\r\n\r\n## Interval (in seconds) at which to update last-activity timestamps.\r\n#c.JupyterHub.last_activity_interval = 300\r\n\r\n## Dict of 'group': ['usernames'] to load at startup.\r\n#\r\n#  This strictly *adds* groups and users to groups.\r\n#\r\n#  Loading one set of groups, then starting JupyterHub again with a different set\r\n#  will not remove users or groups from previous launches. That must be done\r\n#  through the API.\r\n#c.JupyterHub.load_groups = {}\r\n\r\n## Specify path to a logo image to override the Jupyter logo in the banner.\r\n#c.JupyterHub.logo_file = ''\r\n\r\n## Maximum number of concurrent named servers that can be created by a user at a\r\n#  time.\r\n#\r\n#  Setting this can limit the total resources a user can consume.\r\n#\r\n#  If set to 0, no limit is enforced.\r\n#c.JupyterHub.named_server_limit_per_user = 0\r\n\r\n## File to write PID Useful for daemonizing JupyterHub.\r\n#c.JupyterHub.pid_file = ''\r\n\r\n## The public facing port of the proxy.\r\n#\r\n#  This is the port on which the proxy will listen. This is the only port through\r\n#  which JupyterHub should be accessed by users.\r\n#\r\n#  .. deprecated: 0.9\r\n#      Use JupyterHub.bind_url\r\n#c.JupyterHub.port = 8000\r\n\r\n## DEPRECATED since version 0.8 : Use ConfigurableHTTPProxy.api_url\r\n#c.JupyterHub.proxy_api_ip = ''\r\n\r\n## DEPRECATED since version 0.8 : Use ConfigurableHTTPProxy.api_url\r\n#c.JupyterHub.proxy_api_port = 0\r\n\r\n## DEPRECATED since version 0.8: Use ConfigurableHTTPProxy.auth_token\r\n#c.JupyterHub.proxy_auth_token = ''\r\n\r\n## Interval (in seconds) at which to check if the proxy is running.\r\n#c.JupyterHub.proxy_check_interval = 30\r\n\r\n## The class to use for configuring the JupyterHub proxy.\r\n#\r\n#          Should be a subclass of :class:`jupyterhub.proxy.Proxy`.\r\n#\r\n#          .. versionchanged:: 1.0\r\n#              proxies may be registered via entry points,\r\n#              e.g. `c.JupyterHub.proxy_class = 'traefik'`\r\n#\r\n#  Currently installed:\r\n#    - configurable-http-proxy: jupyterhub.proxy.ConfigurableHTTPProxy\r\n#    - default: jupyterhub.proxy.ConfigurableHTTPProxy\r\n#c.JupyterHub.proxy_class = 'jupyterhub.proxy.ConfigurableHTTPProxy'\r\n\r\n## DEPRECATED since version 0.8. Use ConfigurableHTTPProxy.command\r\n#c.JupyterHub.proxy_cmd = []\r\n\r\n## Recreate all certificates used within JupyterHub on restart.\r\n#\r\n#  Note: enabling this feature requires restarting all notebook servers.\r\n#\r\n#  Use with internal_ssl\r\n#c.JupyterHub.recreate_internal_certs = False\r\n\r\n## Redirect user to server (if running), instead of control panel.\r\n#c.JupyterHub.redirect_to_server = True\r\n\r\n## Purge and reset the database.\r\n#c.JupyterHub.reset_db = False\r\n\r\n## Interval (in seconds) at which to check connectivity of services with web\r\n#  endpoints.\r\n#c.JupyterHub.service_check_interval = 60\r\n\r\n## Dict of token:servicename to be loaded into the database.\r\n#\r\n#  Allows ahead-of-time generation of API tokens for use by externally managed\r\n#  services.\r\n#c.JupyterHub.service_tokens = {}\r\n\r\n## List of service specification dictionaries.\r\n#\r\n#  A service\r\n#\r\n#  For instance::\r\n#\r\n#      services = [\r\n#          {\r\n#              'name': 'cull_idle',\r\n#              'command': ['/path/to/cull_idle_servers.py'],\r\n#          },\r\n#          {\r\n#              'name': 'formgrader',\r\n#              'url': 'http://127.0.0.1:1234',\r\n#              'api_token': 'super-secret',\r\n#              'environment':\r\n#          }\r\n#      ]\r\n#c.JupyterHub.services = []\r\n\r\n## Shuts down all user servers on logout\r\n#c.JupyterHub.shutdown_on_logout = False\r\n\r\n## The class to use for spawning single-user servers.\r\n#\r\n#          Should be a subclass of :class:`jupyterhub.spawner.Spawner`.\r\n#\r\n#          .. versionchanged:: 1.0\r\n#              spawners may be registered via entry points,\r\n#              e.g. `c.JupyterHub.spawner_class = 'localprocess'`\r\n#\r\n#  Currently installed:\r\n#    - default: jupyterhub.spawner.LocalProcessSpawner\r\n#    - localprocess: jupyterhub.spawner.LocalProcessSpawner\r\n#    - simple: jupyterhub.spawner.SimpleLocalProcessSpawner\r\n#c.JupyterHub.spawner_class = 'jupyterhub.spawner.LocalProcessSpawner'\r\n\r\n## Path to SSL certificate file for the public facing interface of the proxy\r\n#\r\n#  When setting this, you should also set ssl_key\r\n#c.JupyterHub.ssl_cert = ''\r\n\r\n## Path to SSL key file for the public facing interface of the proxy\r\n#\r\n#  When setting this, you should also set ssl_cert\r\n#c.JupyterHub.ssl_key = ''\r\n\r\n## Host to send statsd metrics to. An empty string (the default) disables sending\r\n#  metrics.\r\n#c.JupyterHub.statsd_host = ''\r\n\r\n## Port on which to send statsd metrics about the hub\r\n#c.JupyterHub.statsd_port = 8125\r\n\r\n## Prefix to use for all metrics sent by jupyterhub to statsd\r\n#c.JupyterHub.statsd_prefix = 'jupyterhub'\r\n\r\n## Run single-user servers on subdomains of this host.\r\n#\r\n#  This should be the full `https://hub.domain.tld[:port]`.\r\n#\r\n#  Provides additional cross-site protections for javascript served by single-\r\n#  user servers.\r\n#\r\n#  Requires `<username>.hub.domain.tld` to resolve to the same host as\r\n#  `hub.domain.tld`.\r\n#\r\n#  In general, this is most easily achieved with wildcard DNS.\r\n#\r\n#  When using SSL (i.e. always) this also requires a wildcard SSL certificate.\r\n#c.JupyterHub.subdomain_host = ''\r\n\r\n## Paths to search for jinja templates, before using the default templates.\r\n#c.JupyterHub.template_paths = []\r\n\r\n## Extra variables to be passed into jinja templates\r\n#c.JupyterHub.template_vars = {}\r\n\r\n## Extra settings overrides to pass to the tornado application.\r\n#c.JupyterHub.tornado_settings = {}\r\n\r\n## Trust user-provided tokens (via JupyterHub.service_tokens) to have good\r\n#  entropy.\r\n#\r\n#  If you are not inserting additional tokens via configuration file, this flag\r\n#  has no effect.\r\n#\r\n#  In JupyterHub 0.8, internally generated tokens do not pass through additional\r\n#  hashing because the hashing is costly and does not increase the entropy of\r\n#  already-good UUIDs.\r\n#\r\n#  User-provided tokens, on the other hand, are not trusted to have good entropy\r\n#  by default, and are passed through many rounds of hashing to stretch the\r\n#  entropy of the key (i.e. user-provided tokens are treated as passwords instead\r\n#  of random keys). These keys are more costly to check.\r\n#\r\n#  If your inserted tokens are generated by a good-quality mechanism, e.g.\r\n#  `openssl rand -hex 32`, then you can set this flag to True to reduce the cost\r\n#  of checking authentication tokens.\r\n#c.JupyterHub.trust_user_provided_tokens = False\r\n\r\n## Names to include in the subject alternative name.\r\n#\r\n#  These names will be used for server name verification. This is useful if\r\n#  JupyterHub is being run behind a reverse proxy or services using ssl are on\r\n#  different hosts.\r\n#\r\n#  Use with internal_ssl\r\n#c.JupyterHub.trusted_alt_names = []\r\n\r\n## Downstream proxy IP addresses to trust.\r\n#\r\n#  This sets the list of IP addresses that are trusted and skipped when\r\n#  processing the `X-Forwarded-For` header. For example, if an external proxy is\r\n#  used for TLS termination, its IP address should be added to this list to\r\n#  ensure the correct client IP addresses are recorded in the logs instead of the\r\n#  proxy server's IP address.\r\n#c.JupyterHub.trusted_downstream_ips = []\r\n\r\n## Upgrade the database automatically on start.\r\n#\r\n#  Only safe if database is regularly backed up. Only SQLite databases will be\r\n#  backed up to a local file automatically.\r\n#c.JupyterHub.upgrade_db = False\r\n\r\n## Callable to affect behavior of /user-redirect/\r\n#\r\n#  Receives 4 parameters: 1. path - URL path that was provided after /user-\r\n#  redirect/ 2. request - A Tornado HTTPServerRequest representing the current\r\n#  request. 3. user - The currently authenticated user. 4. base_url - The\r\n#  base_url of the current hub, for relative redirects\r\n#\r\n#  It should return the new URL to redirect to, or None to preserve current\r\n#  behavior.\r\n#c.JupyterHub.user_redirect_hook = None\r\n\r\n#------------------------------------------------------------------------------\r\n# Spawner(LoggingConfigurable) configuration\r\n#------------------------------------------------------------------------------\r\n\r\n## Base class for spawning single-user notebook servers.\r\n#\r\n#  Subclass this, and override the following methods:\r\n#\r\n#  - load_state - get_state - start - stop - poll\r\n#\r\n#  As JupyterHub supports multiple users, an instance of the Spawner subclass is\r\n#  created for each user. If there are 20 JupyterHub users, there will be 20\r\n#  instances of the subclass.\r\n\r\n## Extra arguments to be passed to the single-user server.\r\n#\r\n#  Some spawners allow shell-style expansion here, allowing you to use\r\n#  environment variables here. Most, including the default, do not. Consult the\r\n#  documentation for your spawner to verify!\r\n#c.Spawner.args = []\r\n\r\n## An optional hook function that you can implement to pass `auth_state` to the\r\n#  spawner after it has been initialized but before it starts. The `auth_state`\r\n#  dictionary may be set by the `.authenticate()` method of the authenticator.\r\n#  This hook enables you to pass some or all of that information to your spawner.\r\n#\r\n#  Example::\r\n#\r\n#      def userdata_hook(spawner, auth_state):\r\n#          spawner.userdata = auth_state[\"userdata\"]\r\n#\r\n#      c.Spawner.auth_state_hook = userdata_hook\r\n#c.Spawner.auth_state_hook = None\r\n\r\n## The command used for starting the single-user server.\r\n#\r\n#  Provide either a string or a list containing the path to the startup script\r\n#  command. Extra arguments, other than this path, should be provided via `args`.\r\n#\r\n#  This is usually set if you want to start the single-user server in a different\r\n#  python environment (with virtualenv/conda) than JupyterHub itself.\r\n#\r\n#  Some spawners allow shell-style expansion here, allowing you to use\r\n#  environment variables. Most, including the default, do not. Consult the\r\n#  documentation for your spawner to verify!\r\n#c.Spawner.cmd = ['jupyterhub-singleuser']\r\n\r\n## Maximum number of consecutive failures to allow before shutting down\r\n#  JupyterHub.\r\n#\r\n#  This helps JupyterHub recover from a certain class of problem preventing\r\n#  launch in contexts where the Hub is automatically restarted (e.g. systemd,\r\n#  docker, kubernetes).\r\n#\r\n#  A limit of 0 means no limit and consecutive failures will not be tracked.\r\n#c.Spawner.consecutive_failure_limit = 0\r\n\r\n## Minimum number of cpu-cores a single-user notebook server is guaranteed to\r\n#  have available.\r\n#\r\n#  If this value is set to 0.5, allows use of 50% of one CPU. If this value is\r\n#  set to 2, allows use of up to 2 CPUs.\r\n#\r\n#  **This is a configuration setting. Your spawner must implement support for the\r\n#  limit to work.** The default spawner, `LocalProcessSpawner`, does **not**\r\n#  implement this support. A custom spawner **must** add support for this setting\r\n#  for it to be enforced.\r\n#c.Spawner.cpu_guarantee = None\r\n\r\n## Maximum number of cpu-cores a single-user notebook server is allowed to use.\r\n#\r\n#  If this value is set to 0.5, allows use of 50% of one CPU. If this value is\r\n#  set to 2, allows use of up to 2 CPUs.\r\n#\r\n#  The single-user notebook server will never be scheduled by the kernel to use\r\n#  more cpu-cores than this. There is no guarantee that it can access this many\r\n#  cpu-cores.\r\n#\r\n#  **This is a configuration setting. Your spawner must implement support for the\r\n#  limit to work.** The default spawner, `LocalProcessSpawner`, does **not**\r\n#  implement this support. A custom spawner **must** add support for this setting\r\n#  for it to be enforced.\r\n#c.Spawner.cpu_limit = None\r\n\r\n## Enable debug-logging of the single-user server\r\n#c.Spawner.debug = False\r\n\r\n## The URL the single-user server should start in.\r\n#\r\n#  `{username}` will be expanded to the user's username\r\n#\r\n#  Example uses:\r\n#\r\n#  - You can set `notebook_dir` to `/` and `default_url` to `/tree/home/{username}` to allow people to\r\n#    navigate the whole filesystem from their notebook server, but still start in their home directory.\r\n#  - Start with `/notebooks` instead of `/tree` if `default_url` points to a notebook instead of a directory.\r\n#  - You can set this to `/lab` to have JupyterLab start by default, rather than Jupyter Notebook.\r\n#c.Spawner.default_url = ''\r\n\r\n## Disable per-user configuration of single-user servers.\r\n#\r\n#  When starting the user's single-user server, any config file found in the\r\n#  user's $HOME directory will be ignored.\r\n#\r\n#  Note: a user could circumvent this if the user modifies their Python\r\n#  environment, such as when they have their own conda environments / virtualenvs\r\n#  / containers.\r\n#c.Spawner.disable_user_config = False\r\n\r\n## Whitelist of environment variables for the single-user server to inherit from\r\n#  the JupyterHub process.\r\n#\r\n#  This whitelist is used to ensure that sensitive information in the JupyterHub\r\n#  process's environment (such as `CONFIGPROXY_AUTH_TOKEN`) is not passed to the\r\n#  single-user server's process.\r\n#c.Spawner.env_keep = ['PATH', 'PYTHONPATH', 'CONDA_ROOT', 'CONDA_DEFAULT_ENV', 'VIRTUAL_ENV', 'LANG', 'LC_ALL']\r\n\r\n## Extra environment variables to set for the single-user server's process.\r\n#\r\n#  Environment variables that end up in the single-user server's process come from 3 sources:\r\n#    - This `environment` configurable\r\n#    - The JupyterHub process' environment variables that are whitelisted in `env_keep`\r\n#    - Variables to establish contact between the single-user notebook and the hub (such as JUPYTERHUB_API_TOKEN)\r\n#\r\n#  The `environment` configurable should be set by JupyterHub administrators to\r\n#  add installation specific environment variables. It is a dict where the key is\r\n#  the name of the environment variable, and the value can be a string or a\r\n#  callable. If it is a callable, it will be called with one parameter (the\r\n#  spawner instance), and should return a string fairly quickly (no blocking\r\n#  operations please!).\r\n#\r\n#  Note that the spawner class' interface is not guaranteed to be exactly same\r\n#  across upgrades, so if you are using the callable take care to verify it\r\n#  continues to work after upgrades!\r\n#c.Spawner.environment = {}\r\n\r\n## Timeout (in seconds) before giving up on a spawned HTTP server\r\n#\r\n#  Once a server has successfully been spawned, this is the amount of time we\r\n#  wait before assuming that the server is unable to accept connections.\r\n#c.Spawner.http_timeout = 30\r\n\r\n## The IP address (or hostname) the single-user server should listen on.\r\n#\r\n#  The JupyterHub proxy implementation should be able to send packets to this\r\n#  interface.\r\n#c.Spawner.ip = ''\r\n\r\n## Minimum number of bytes a single-user notebook server is guaranteed to have\r\n#  available.\r\n#\r\n#  Allows the following suffixes:\r\n#    - K -> Kilobytes\r\n#    - M -> Megabytes\r\n#    - G -> Gigabytes\r\n#    - T -> Terabytes\r\n#\r\n#  **This is a configuration setting. Your spawner must implement support for the\r\n#  limit to work.** The default spawner, `LocalProcessSpawner`, does **not**\r\n#  implement this support. A custom spawner **must** add support for this setting\r\n#  for it to be enforced.\r\n#c.Spawner.mem_guarantee = None\r\n\r\n## Maximum number of bytes a single-user notebook server is allowed to use.\r\n#\r\n#  Allows the following suffixes:\r\n#    - K -> Kilobytes\r\n#    - M -> Megabytes\r\n#    - G -> Gigabytes\r\n#    - T -> Terabytes\r\n#\r\n#  If the single user server tries to allocate more memory than this, it will\r\n#  fail. There is no guarantee that the single-user notebook server will be able\r\n#  to allocate this much memory - only that it can not allocate more than this.\r\n#\r\n#  **This is a configuration setting. Your spawner must implement support for the\r\n#  limit to work.** The default spawner, `LocalProcessSpawner`, does **not**\r\n#  implement this support. A custom spawner **must** add support for this setting\r\n#  for it to be enforced.\r\n#c.Spawner.mem_limit = None\r\n\r\n## Path to the notebook directory for the single-user server.\r\n#\r\n#  The user sees a file listing of this directory when the notebook interface is\r\n#  started. The current interface does not easily allow browsing beyond the\r\n#  subdirectories in this directory's tree.\r\n#\r\n#  `~` will be expanded to the home directory of the user, and {username} will be\r\n#  replaced with the name of the user.\r\n#\r\n#  Note that this does *not* prevent users from accessing files outside of this\r\n#  path! They can do so with many other means.\r\n#c.Spawner.notebook_dir = ''\r\n\r\n## An HTML form for options a user can specify on launching their server.\r\n#\r\n#  The surrounding `<form>` element and the submit button are already provided.\r\n#\r\n#  For example:\r\n#\r\n#  .. code:: html\r\n#\r\n#      Set your key:\r\n#      <input name=\"key\" val=\"default_key\"></input>\r\n#      <br>\r\n#      Choose a letter:\r\n#      <select name=\"letter\" multiple=\"true\">\r\n#        <option value=\"A\">The letter A</option>\r\n#        <option value=\"B\">The letter B</option>\r\n#      </select>\r\n#\r\n#  The data from this form submission will be passed on to your spawner in\r\n#  `self.user_options`\r\n#\r\n#  Instead of a form snippet string, this could also be a callable that takes as\r\n#  one parameter the current spawner instance and returns a string. The callable\r\n#  will be called asynchronously if it returns a future, rather than a str. Note\r\n#  that the interface of the spawner class is not deemed stable across versions,\r\n#  so using this functionality might cause your JupyterHub upgrades to break.\r\n#c.Spawner.options_form = traitlets.Undefined\r\n\r\n## Interval (in seconds) on which to poll the spawner for single-user server's\r\n#  status.\r\n#\r\n#  At every poll interval, each spawner's `.poll` method is called, which checks\r\n#  if the single-user server is still running. If it isn't running, then\r\n#  JupyterHub modifies its own state accordingly and removes appropriate routes\r\n#  from the configurable proxy.\r\n#c.Spawner.poll_interval = 30\r\n\r\n## The port for single-user servers to listen on.\r\n#\r\n#  Defaults to `0`, which uses a randomly allocated port number each time.\r\n#\r\n#  If set to a non-zero value, all Spawners will use the same port, which only\r\n#  makes sense if each server is on a different address, e.g. in containers.\r\n#\r\n#  New in version 0.7.\r\n#c.Spawner.port = 0\r\n\r\n## An optional hook function that you can implement to do work after the spawner\r\n#  stops.\r\n#\r\n#  This can be set independent of any concrete spawner implementation.\r\n#c.Spawner.post_stop_hook = None\r\n\r\n## An optional hook function that you can implement to do some bootstrapping work\r\n#  before the spawner starts. For example, create a directory for your user or\r\n#  load initial content.\r\n#\r\n#  This can be set independent of any concrete spawner implementation.\r\n#\r\n#  This maybe a coroutine.\r\n#\r\n#  Example::\r\n#\r\n#      from subprocess import check_call\r\n#      def my_hook(spawner):\r\n#          username = spawner.user.name\r\n#          check_call(['./examples/bootstrap-script/bootstrap.sh', username])\r\n#\r\n#      c.Spawner.pre_spawn_hook = my_hook\r\n#c.Spawner.pre_spawn_hook = None\r\n\r\n## List of SSL alt names\r\n#\r\n#  May be set in config if all spawners should have the same value(s), or set at\r\n#  runtime by Spawner that know their names.\r\n#c.Spawner.ssl_alt_names = []\r\n\r\n## Whether to include DNS:localhost, IP:127.0.0.1 in alt names\r\n#c.Spawner.ssl_alt_names_include_local = True\r\n\r\n## Timeout (in seconds) before giving up on starting of single-user server.\r\n#\r\n#  This is the timeout for start to return, not the timeout for the server to\r\n#  respond. Callers of spawner.start will assume that startup has failed if it\r\n#  takes longer than this. start should return when the server process is started\r\n#  and its location is known.\r\n#c.Spawner.start_timeout = 60\r\n\r\n#------------------------------------------------------------------------------\r\n# Authenticator(LoggingConfigurable) configuration\r\n#------------------------------------------------------------------------------\r\n\r\n## Base class for implementing an authentication provider for JupyterHub\r\n\r\n## Set of users that will have admin rights on this JupyterHub.\r\n#\r\n#  Admin users have extra privileges:\r\n#   - Use the admin panel to see list of users logged in\r\n#   - Add / remove users in some authenticators\r\n#   - Restart / halt the hub\r\n#   - Start / stop users' single-user servers\r\n#   - Can access each individual users' single-user server (if configured)\r\n#\r\n#  Admin access should be treated the same way root access is.\r\n#\r\n#  Defaults to an empty set, in which case no user has admin access.\r\nc.Authenticator.admin_users = set([\"john\", \"yzj\"])\r\n\r\n## The max age (in seconds) of authentication info before forcing a refresh of\r\n#  user auth info.\r\n#\r\n#  Refreshing auth info allows, e.g. requesting/re-validating auth tokens.\r\n#\r\n#  See :meth:`.refresh_user` for what happens when user auth info is refreshed\r\n#  (nothing by default).\r\n#c.Authenticator.auth_refresh_age = 300\r\n\r\n## Automatically begin the login process\r\n#\r\n#  rather than starting with a \"Login with...\" link at `/hub/login`\r\n#\r\n#  To work, `.login_url()` must give a URL other than the default `/hub/login`,\r\n#  such as an oauth handler or another automatic login handler, registered with\r\n#  `.get_handlers()`.\r\n#\r\n#  .. versionadded:: 0.8\r\n#c.Authenticator.auto_login = False\r\n\r\n## Blacklist of usernames that are not allowed to log in.\r\n#\r\n#  Use this with supported authenticators to restrict which users can not log in.\r\n#  This is an additional blacklist that further restricts users, beyond whatever\r\n#  restrictions the authenticator has in place.\r\n#\r\n#  If empty, does not perform any additional restriction.\r\n#\r\n#  .. versionadded: 0.9\r\n#c.Authenticator.blacklist = set()\r\n\r\n## Enable persisting auth_state (if available).\r\n#\r\n#  auth_state will be encrypted and stored in the Hub's database. This can\r\n#  include things like authentication tokens, etc. to be passed to Spawners as\r\n#  environment variables.\r\n#\r\n#  Encrypting auth_state requires the cryptography package.\r\n#\r\n#  Additionally, the JUPYTERHUB_CRYPT_KEY environment variable must contain one\r\n#  (or more, separated by ;) 32B encryption keys. These can be either base64 or\r\n#  hex-encoded.\r\n#\r\n#  If encryption is unavailable, auth_state cannot be persisted.\r\n#\r\n#  New in JupyterHub 0.8\r\n#c.Authenticator.enable_auth_state = False\r\n\r\n## An optional hook function that you can implement to do some bootstrapping work\r\n#  during authentication. For example, loading user account details from an\r\n#  external system.\r\n#\r\n#  This function is called after the user has passed all authentication checks\r\n#  and is ready to successfully authenticate. This function must return the\r\n#  authentication dict reguardless of changes to it.\r\n#\r\n#  This maybe a coroutine.\r\n#\r\n#  .. versionadded: 1.0\r\n#\r\n#  Example::\r\n#\r\n#      import os, pwd\r\n#      def my_hook(authenticator, handler, authentication):\r\n#          user_data = pwd.getpwnam(authentication['name'])\r\n#          spawn_data = {\r\n#              'pw_data': user_data\r\n#              'gid_list': os.getgrouplist(authentication['name'], user_data.pw_gid)\r\n#          }\r\n#\r\n#          if authentication['auth_state'] is None:\r\n#              authentication['auth_state'] = {}\r\n#          authentication['auth_state']['spawn_data'] = spawn_data\r\n#\r\n#          return authentication\r\n#\r\n#      c.Authenticator.post_auth_hook = my_hook\r\n#c.Authenticator.post_auth_hook = None\r\n\r\n## Force refresh of auth prior to spawn.\r\n#\r\n#  This forces :meth:`.refresh_user` to be called prior to launching a server, to\r\n#  ensure that auth state is up-to-date.\r\n#\r\n#  This can be important when e.g. auth tokens that may have expired are passed\r\n#  to the spawner via environment variables from auth_state.\r\n#\r\n#  If refresh_user cannot refresh the user auth data, launch will fail until the\r\n#  user logs in again.\r\n#c.Authenticator.refresh_pre_spawn = False\r\n\r\n## Dictionary mapping authenticator usernames to JupyterHub users.\r\n#\r\n#  Primarily used to normalize OAuth user names to local users.\r\n#c.Authenticator.username_map = {}\r\n\r\n## Regular expression pattern that all valid usernames must match.\r\n#\r\n#  If a username does not match the pattern specified here, authentication will\r\n#  not be attempted.\r\n#\r\n#  If not set, allow any username.\r\n#c.Authenticator.username_pattern = ''\r\n\r\n## Whitelist of usernames that are allowed to log in.\r\n#\r\n#  Use this with supported authenticators to restrict which users can log in.\r\n#  This is an additional whitelist that further restricts users, beyond whatever\r\n#  restrictions the authenticator has in place.\r\n#\r\n#  If empty, does not perform any additional restriction.\r\n#c.Authenticator.whitelist = set()\r\n\r\n#------------------------------------------------------------------------------\r\n# CryptKeeper(SingletonConfigurable) configuration\r\n#------------------------------------------------------------------------------\r\n\r\n## Encapsulate encryption configuration\r\n#\r\n#  Use via the encryption_config singleton below.\r\n\r\n##\r\n#c.CryptKeeper.keys = []\r\n\r\n## The number of threads to allocate for encryption\r\n#c.CryptKeeper.n_threads = 80\r\nc.Spawner.default_url = '/lab'\r\nc.JupyterHub.bind_url = 'http://:8000/'\r\n# c.PAMAuthenticator.open_sessions = False\r\n\\```\r\n\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3238/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3238/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3237", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3237/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3237/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3237/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3237", "id": 733369351, "node_id": "MDExOlB1bGxSZXF1ZXN0NTEzMTYwMTU2", "number": 3237, "title": "[Windows] Improve robustness when detecting and closing existing proxy processes", "user": {"login": "alexweav", "id": 8410871, "node_id": "MDQ6VXNlcjg0MTA4NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/8410871?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexweav", "html_url": "https://github.com/alexweav", "followers_url": "https://api.github.com/users/alexweav/followers", "following_url": "https://api.github.com/users/alexweav/following{/other_user}", "gists_url": "https://api.github.com/users/alexweav/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexweav/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexweav/subscriptions", "organizations_url": "https://api.github.com/users/alexweav/orgs", "repos_url": "https://api.github.com/users/alexweav/repos", "events_url": "https://api.github.com/users/alexweav/events{/privacy}", "received_events_url": "https://api.github.com/users/alexweav/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-10-30T17:26:01Z", "updated_at": "2020-11-20T09:17:17Z", "closed_at": "2020-11-20T08:45:55Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3237", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3237", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3237.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3237.patch", "merged_at": "2020-11-20T08:45:54Z"}, "body": "Fixes #2886.\r\n\r\nRelying on the pid alone to identify the proxy in between launches of the hub is not robust enough. Another unrelated process may have assumed the proxy's pid, resulting in either a permission error when the hub launches, or in some cases, the hub will kill some unrelated process.\r\n\r\nThis is especially prevalent on Windows, which seems to reuse pids much more frequently. We launch the hub along with several other processes on Windows, and we had a case where a pid conflict would happen many times, repeatedly. It is less common on Linux, but still an issue that we should guard against.\r\n\r\nThis PR also improves the proxy termination logic on Windows to match [the psutil docs](https://psutil.readthedocs.io/en/latest/#psutil.wait_procs), in order to ensure that the proxy is shutdown more cleanly. This change is optional, I can remove it if we think it doesn't belong in this PR.\r\n\r\nA couple alternate approaches may include:\r\n- Also checking the process's user to see if it matches the hub's user.\r\n- Storing the cmd (plus possibly the user?) in addition to the pid in jupyterhub-proxy.pid to increase robustness if the hub config changes across restarts.\r\n\r\nLet me know if we think any of the alternatives listed above would be useful, I'd be happy to extend this accordingly.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3237/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3237/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3236", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3236/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3236/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3236/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3236", "id": 733280789, "node_id": "MDU6SXNzdWU3MzMyODA3ODk=", "number": 3236, "title": "Error when attempting to shut down", "user": {"login": "pmarcellino", "id": 46568443, "node_id": "MDQ6VXNlcjQ2NTY4NDQz", "avatar_url": "https://avatars.githubusercontent.com/u/46568443?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmarcellino", "html_url": "https://github.com/pmarcellino", "followers_url": "https://api.github.com/users/pmarcellino/followers", "following_url": "https://api.github.com/users/pmarcellino/following{/other_user}", "gists_url": "https://api.github.com/users/pmarcellino/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmarcellino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmarcellino/subscriptions", "organizations_url": "https://api.github.com/users/pmarcellino/orgs", "repos_url": "https://api.github.com/users/pmarcellino/repos", "events_url": "https://api.github.com/users/pmarcellino/events{/privacy}", "received_events_url": "https://api.github.com/users/pmarcellino/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-10-30T15:31:17Z", "updated_at": "2020-12-03T10:16:28Z", "closed_at": "2020-12-03T10:16:28Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML commments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\nWhen I go to the admin pannel and click \"Shutdown Hub\" I get an error \"API request failed (500): Internal Server Error\r\n![image](https://user-images.githubusercontent.com/46568443/97724533-08832e80-1a9b-11eb-89d5-60f8ce70a681.png)\r\n\r\n#### Expected behaviour\r\nI thought it would shut down\r\n\r\n#### Actual behaviour\r\nI get an error and it does not shut down\r\n\r\n### How to reproduce\r\nClick the \"Shutdown Hub\" button\r\n### Your personal set up\r\nLitlistHub distribution on a linux box\r\n\r\n - OS:\r\nlinux\r\n - Version:\r\n1.0.0", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3236/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3236/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3234", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3234/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3234/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3234/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3234", "id": 733015889, "node_id": "MDExOlB1bGxSZXF1ZXN0NTEyODY0OTE1", "number": 3234, "title": "JupyterHub services' oauth_no_confirm configuration regression in 1.2.0", "user": {"login": "bitnik", "id": 6059799, "node_id": "MDQ6VXNlcjYwNTk3OTk=", "avatar_url": "https://avatars.githubusercontent.com/u/6059799?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bitnik", "html_url": "https://github.com/bitnik", "followers_url": "https://api.github.com/users/bitnik/followers", "following_url": "https://api.github.com/users/bitnik/following{/other_user}", "gists_url": "https://api.github.com/users/bitnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/bitnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bitnik/subscriptions", "organizations_url": "https://api.github.com/users/bitnik/orgs", "repos_url": "https://api.github.com/users/bitnik/repos", "events_url": "https://api.github.com/users/bitnik/events{/privacy}", "received_events_url": "https://api.github.com/users/bitnik/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-10-30T09:21:58Z", "updated_at": "2020-10-30T12:18:42Z", "closed_at": "2020-10-30T12:07:40Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3234", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3234", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3234.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3234.patch", "merged_at": "2020-10-30T12:07:40Z"}, "body": "fixup for regression introduced in https://github.com/jupyterhub/jupyterhub/pull/3090\r\n\r\nThis was the typo causing the regression, the equivalent variable for oauth_no_confirm_whitelist was oauth_no_confirm_list rather than oauth_no_confirm which is a boolean.\r\n\r\n```diff\r\n-            # or it's in the global whitelist\r\n-            or oauth_client.identifier\r\n-            in self.settings.get('oauth_no_confirm_whitelist', set())\r\n+            # or it's in the global no-confirm list\r\n+            or oauth_client.identifier in self.settings.get('oauth_no_confirm', set())\r\n```", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3234/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3234/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3221", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3221/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3221/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3221/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3221", "id": 727006422, "node_id": "MDU6SXNzdWU3MjcwMDY0MjI=", "number": 3221, "title": "Use root to log in jupyterHub\uff0coccur \u201c503 : Service Unavailable Your server appears to be down. Try restarting it from the hub\u201d ", "user": {"login": "zaneChou1", "id": 26590988, "node_id": "MDQ6VXNlcjI2NTkwOTg4", "avatar_url": "https://avatars.githubusercontent.com/u/26590988?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zaneChou1", "html_url": "https://github.com/zaneChou1", "followers_url": "https://api.github.com/users/zaneChou1/followers", "following_url": "https://api.github.com/users/zaneChou1/following{/other_user}", "gists_url": "https://api.github.com/users/zaneChou1/gists{/gist_id}", "starred_url": "https://api.github.com/users/zaneChou1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zaneChou1/subscriptions", "organizations_url": "https://api.github.com/users/zaneChou1/orgs", "repos_url": "https://api.github.com/users/zaneChou1/repos", "events_url": "https://api.github.com/users/zaneChou1/events{/privacy}", "received_events_url": "https://api.github.com/users/zaneChou1/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-10-22T03:07:38Z", "updated_at": "2020-10-29T12:00:11Z", "closed_at": "2020-10-29T12:00:11Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML commments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\nRefer to [jupyterhub-quickstart-docker](https://jupyterhub.readthedocs.io/en/stable/quickstart-docker.html#starting-jupyterhub-with-docker), use docker to start jupyterHub service.\r\nwhen I use created system user to log in jupyterHub\uff0cservice is normal.\r\nBut when I use root to log in jupyterHub\uff0coccur \"503 : Service Unavailable Your server appears to be down. Try restarting it from the hub\"\r\n\r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\nBut when I use root to log in jupyterHub\uff0cservice is normal and display system management page\r\n\r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\nUse root to log in jupyterHub, \"503 : Service Unavailable Your server appears to be down. Try restarting it from the hub\"\r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\nRefer to [jupyterhub-quickstart-docker](https://jupyterhub.readthedocs.io/en/stable/quickstart-docker.html#starting-jupyterhub-with-docker)\r\n\r\n### Your personal set up\r\n<!-- Tell us a little about the system you're using. -->\r\n\r\n - OS:\r\n <!-- [e.g. linux, OSX] -->\r\nLinux ubuntu 20.04.1 \r\n - Version:\r\n <!-- e.g. jupyterhub --version. --->\r\n\r\n        ipywidgets          7.5.1\r\n        Jinja2              2.11.2\r\n        jupyter             1.0.0\r\n        jupyter-client      6.1.7\r\n        jupyter-console     6.2.0\r\n        jupyter-core        4.6.3\r\n        jupyter-telemetry   0.1.0\r\n        jupyterhub          1.2.0.dev0\r\n        jupyterlab          2.2.8\r\n        jupyterlab-pygments 0.1.2\r\n        jupyterlab-server   1.2.0\r\n        notebook            6.1.4\r\n\r\n - Configuration:\r\n <!-- Be careful not to share any sensitive information. --->\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3221/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3221/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3222", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3222/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3222/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3222/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3222", "id": 727795217, "node_id": "MDU6SXNzdWU3Mjc3OTUyMTc=", "number": 3222, "title": "Unreliable attempt to add a route for a new user to an external CHP proxy - HTTP 599 Broken pipe (JupyterHub 1.2.0b1 issue)", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 106589226, "node_id": "MDU6TGFiZWwxMDY1ODkyMjY=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/help%20wanted", "name": "help wanted", "color": "0e8a16", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-10-21T11:47:56Z", "updated_at": "2020-10-29T00:23:34Z", "closed_at": "2020-10-28T14:21:23Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "## Issue background\r\nThis issue is migrated from Z2JH where the CI system started having intermittent failures to spawn user pods all the way. The failure wasn't the creation of pods, but when the `hub` pod was speaking with the externally running `proxy` pod (CHP server) and getting `tornado.curlhttpclient.CurlError: HTTP 599: Send failure: Broken pipe` as part of its POST request to add a route for the newly spawned user.\r\n\r\n## Logs inspection\r\nThe hub errors when speaking with the external CHP proxy pod after the a user pod has successfully been spawned.\r\n\r\n```\r\n[I 2020-10-20 16:48:25.540 JupyterHub base:893] User testuser-aa6aa5ea-64bb-4719-93c7-04557f25c3d5 took 2.179 seconds to start\r\n[I 2020-10-20 16:48:25.540 JupyterHub proxy:257] Adding user testuser-aa6aa5ea-64bb-4719-93c7-04557f25c3d5 to proxy /user/testuser-aa6aa5ea-64bb-4719-93c7-04557f25c3d5/ => http://192.168.79.75:8888\r\n[D 2020-10-20 16:48:25.540 JupyterHub proxy:765] Proxy: Fetching POST http://proxy-api:8001/api/routes/user/testuser-aa6aa5ea-64bb-4719-93c7-04557f25c3d5\r\n[I 2020-10-20 16:48:25.541 JupyterHub log:181] 200 GET /hub/api (@10.20.0.120) 1.70ms\r\n[E 2020-10-20 16:48:25.542 JupyterHub base:915] Failed to add testuser-aa6aa5ea-64bb-4719-93c7-04557f25c3d5 to proxy!\r\n    Traceback (most recent call last):\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/handlers/base.py\", line 908, in finish_user_spawn\r\n        await self.proxy.add_user(user, server_name)\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/proxy.py\", line 270, in add_user\r\n        await self.add_route(\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/proxy.py\", line 781, in add_route\r\n        await self.api_request(path, method='POST', body=body)\r\n      File \"/usr/local/lib/python3.8/dist-packages/jupyterhub/proxy.py\", line 773, in api_request\r\n        result = await client.fetch(req)\r\n    tornado.curl_httpclient.CurlError: HTTP 599: Send failure: Broken pipe\r\n```\r\n\r\nIf everything were as it should, the proxy should add a network route towards the newly added pod - it is a configurable proxy that JupyterHub controls after all. This is the kind of entry we should see twice because we have two tests adding a pod.\r\n\r\n```\r\n16:48:18.515 [ConfigProxy] info: Adding route /user/testuser-c2521e10-e843-40c3-8cb6-dac422b1433a -> http://192.168.79.74:8888\r\n```\r\n\r\nIt seems like this never happens, and that the proxy pod / CHP doesn't notice any incoming request to add a route, because it doesn't log any incoming POST request either.\r\n\r\n## Reference\r\n\r\n#### Build failures\r\n[Build failure with logs of hub and proxy pod](https://travis-ci.org/github/jupyterhub/zero-to-jupyterhub-k8s/jobs/737443531) but not for the autohttps pod.\r\n[Build failure with logs of the hub, proxy, and autohttps pod](https://travis-ci.org/github/jupyterhub/zero-to-jupyterhub-k8s/jobs/738037421), this is one of two failures from [the same travis build](https://travis-ci.org/github/jupyterhub/zero-to-jupyterhub-k8s/builds/738037416)!\r\n\r\n#### Code that fail to reach return statement\r\nhttps://github.com/jupyterhub/zero-to-jupyterhub-k8s/blob/2f7135cfeed631553eb3452f6b3f47f27e47c9f9/tests/test_spawn.py#L217-L224\r\n\r\nExample user_model data in code linked above\r\n```python\r\n# example user_model that is seen during failures\r\nuser_model = {'kind': 'user', 'name': 'testuser-f8ff861a-538a-4c93-a864-ae3345cea907', 'admin': False, 'groups': [], 'server': None, 'pending': None, 'created': '2020-10-20T14:28:03.524748Z', 'last_activity': '2020-10-20T14:28:11.990951Z', 'servers': {}, 'auth_state': None}\r\n```", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3222/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3222/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3217", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3217/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3217/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3217/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3217", "id": 725893215, "node_id": "MDU6SXNzdWU3MjU4OTMyMTU=", "number": 3217, "title": "AttributeError: 'Service' object has no attribute 'groups'", "user": {"login": "m-mayran", "id": 16502114, "node_id": "MDQ6VXNlcjE2NTAyMTE0", "avatar_url": "https://avatars.githubusercontent.com/u/16502114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m-mayran", "html_url": "https://github.com/m-mayran", "followers_url": "https://api.github.com/users/m-mayran/followers", "following_url": "https://api.github.com/users/m-mayran/following{/other_user}", "gists_url": "https://api.github.com/users/m-mayran/gists{/gist_id}", "starred_url": "https://api.github.com/users/m-mayran/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m-mayran/subscriptions", "organizations_url": "https://api.github.com/users/m-mayran/orgs", "repos_url": "https://api.github.com/users/m-mayran/repos", "events_url": "https://api.github.com/users/m-mayran/events{/privacy}", "received_events_url": "https://api.github.com/users/m-mayran/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-10-20T19:47:08Z", "updated_at": "2020-12-09T12:25:47Z", "closed_at": "2020-12-09T12:25:47Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi,\r\n[Running 1.2.0b1]\r\n\r\nI am running the following code in a service to get information about my user:\r\n\r\n```py\r\nimport requests\r\napi_url = os.environ['JUPYTERHUB_API_URL']\r\napi_token = os.environ['JUPYTERHUB_API_TOKEN']\r\nr = requests.get(api_url + '/user', headers={'Authorization': 'token %s' % api_token,})\r\n```\r\n\r\nThe request seems to authenticate ok (I would get a 403 if I put /users for example) but it returns the following:\r\n\r\n```py\r\nUncaught exception GET /hub/api/user (172.17.0.2)\r\n    HTTPServerRequest(protocol='http', host='172.17.0.2:8081', method='GET', uri='/hub/api/user', version='HTTP/1.1', remote_ip='172.17.0.2')\r\n    Traceback (most recent call last):\r\n      File \"/usr/local/lib/python3.6/dist-packages/tornado/web.py\", line 1703, in _execute\r\n        result = await result\r\n      File \"/usr/local/lib/python3.6/dist-packages/jupyterhub/apihandlers/users.py\", line 38, in get\r\n        self.write(json.dumps(self.user_model(user)))\r\n      File \"/usr/local/lib/python3.6/dist-packages/jupyterhub/apihandlers/base.py\", line 193, in user_model\r\n        'groups': [g.name for g in user.groups],\r\n    AttributeError: 'Service' object has no attribute 'groups'\r\n```", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3217/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3217/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3208", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3208/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3208/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3208/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3208", "id": 722170291, "node_id": "MDExOlB1bGxSZXF1ZXN0NTAzOTY1NzU3", "number": 3208, "title": "avoid specifying default_value=None in Command traits", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-10-15T09:38:40Z", "updated_at": "2022-03-11T08:43:07Z", "closed_at": "2020-10-15T12:47:37Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3208", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3208", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3208.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3208.patch", "merged_at": "2020-10-15T12:47:37Z"}, "body": "causes issues with traitlets dev where 'unspecified' should be Undefined, not specified-None\r\n\r\nBest to leave it out if it's really unspecified\r\n\r\nthis is causing the test failures with traitlets master, caused by ipython/traitlets#630\r\n\r\nalso closes #3191 so all tests are passing again", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3208/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3208/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3204", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3204/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3204/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3204/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3204", "id": 719469571, "node_id": "MDExOlB1bGxSZXF1ZXN0NTAxNjUxOTE1", "number": 3204, "title": "Prevent OverflowErrors in exponential_backoff()", "user": {"login": "kreuzert", "id": 28051928, "node_id": "MDQ6VXNlcjI4MDUxOTI4", "avatar_url": "https://avatars.githubusercontent.com/u/28051928?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kreuzert", "html_url": "https://github.com/kreuzert", "followers_url": "https://api.github.com/users/kreuzert/followers", "following_url": "https://api.github.com/users/kreuzert/following{/other_user}", "gists_url": "https://api.github.com/users/kreuzert/gists{/gist_id}", "starred_url": "https://api.github.com/users/kreuzert/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kreuzert/subscriptions", "organizations_url": "https://api.github.com/users/kreuzert/orgs", "repos_url": "https://api.github.com/users/kreuzert/repos", "events_url": "https://api.github.com/users/kreuzert/events{/privacy}", "received_events_url": "https://api.github.com/users/kreuzert/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-10-12T15:29:18Z", "updated_at": "2020-10-15T12:51:13Z", "closed_at": "2020-10-15T08:39:29Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3204", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3204", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3204.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3204.patch", "merged_at": "2020-10-15T08:39:29Z"}, "body": "We start JupyterLabs on a slurm based batch system. Therefore, JupyterLabs may take a while to start. This lead to OverflowErrors in exponential_backoff(). \r\n\r\nThis small patch will prevent crashes while waiting for JupyterLabs.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3204/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3204/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3201", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3201/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3201/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3201/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3201", "id": 718421878, "node_id": "MDU6SXNzdWU3MTg0MjE4Nzg=", "number": 3201, "title": "Environment variables passed to lab changed betwen 0.9.6 and 1.1.0", "user": {"login": "mj-harvey", "id": 7896589, "node_id": "MDQ6VXNlcjc4OTY1ODk=", "avatar_url": "https://avatars.githubusercontent.com/u/7896589?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mj-harvey", "html_url": "https://github.com/mj-harvey", "followers_url": "https://api.github.com/users/mj-harvey/followers", "following_url": "https://api.github.com/users/mj-harvey/following{/other_user}", "gists_url": "https://api.github.com/users/mj-harvey/gists{/gist_id}", "starred_url": "https://api.github.com/users/mj-harvey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mj-harvey/subscriptions", "organizations_url": "https://api.github.com/users/mj-harvey/orgs", "repos_url": "https://api.github.com/users/mj-harvey/repos", "events_url": "https://api.github.com/users/mj-harvey/events{/privacy}", "received_events_url": "https://api.github.com/users/mj-harvey/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2020-10-09T21:04:47Z", "updated_at": "2021-08-24T18:54:46Z", "closed_at": "2021-02-17T17:48:04Z", "author_association": "NONE", "active_lock_reason": null, "body": "The 0.9.6 Hub passes the following environment variables to the spawned single-user hub\r\n```\r\nJPY_API_TOKEN=XXXX\r\nJUPYTERHUB_BASE_URL=/\r\nJUPYTERHUB_HOST=\r\nJUPYTERHUB_OAUTH_CALLBACK_URL=/user/mjharvey/oauth_callback\r\nJUPYTERHUB_CLIENT_ID=jupyterhub-user-mjharvey\r\nJUPYTERHUB_SERVICE_PREFIX=/user/mjharvey/\r\nJUPYTERHUB_API_URL=http://192.168.97.33:9081/hub/api\r\nJUPYTERHUB_USER=mjharvey\r\nJUPYTERHUB_API_TOKEN=XXXX\r\n```\r\n\r\nWhereas 1.1.0 passes\r\n\r\n```\r\nJPY_API_TOKEN=XXXX\r\nJUPYTERHUB_ACTIVITY_URL=http://[XXXX]:9081/hub/api/users/mjharvey/activity\r\nJUPYTERHUB_SERVER_NAME=\r\nJUPYTERHUB_OAUTH_CALLBACK_URL=/user/mjharvey/oauth_callback\r\nJUPYTERHUB_CLIENT_ID=jupyterhub-user-mjharvey\r\nJUPYTERHUB_BASE_URL=/,\r\nJUPYTERHUB_API_URL=http://[XXXX]:9081/hub/api\r\nJUPYTERHUB_HOST=\r\nJUPYTERHUB_USER=mjharvey\r\nJUPYTERHUB_API_TOKEN=XXXX\r\n```\r\n\r\nIn particular `JUPYTERHUB_SERVICE_PREFIX` is prefix is missing.  This was causiing an authentication failure (see issue #3200 ). If I explicitly define that in the jobscript that Batchspawner submits the session starts correctly.\r\n\r\nIs this an expected change?\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3201/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3201/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3200", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3200/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3200/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3200/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3200", "id": 718295587, "node_id": "MDU6SXNzdWU3MTgyOTU1ODc=", "number": 3200, "title": "auth broken after 0.9.6 -> 1.1.0 upgrade", "user": {"login": "mj-harvey", "id": 7896589, "node_id": "MDQ6VXNlcjc4OTY1ODk=", "avatar_url": "https://avatars.githubusercontent.com/u/7896589?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mj-harvey", "html_url": "https://github.com/mj-harvey", "followers_url": "https://api.github.com/users/mj-harvey/followers", "following_url": "https://api.github.com/users/mj-harvey/following{/other_user}", "gists_url": "https://api.github.com/users/mj-harvey/gists{/gist_id}", "starred_url": "https://api.github.com/users/mj-harvey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mj-harvey/subscriptions", "organizations_url": "https://api.github.com/users/mj-harvey/orgs", "repos_url": "https://api.github.com/users/mj-harvey/repos", "events_url": "https://api.github.com/users/mj-harvey/events{/privacy}", "received_events_url": "https://api.github.com/users/mj-harvey/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2020-10-09T17:00:22Z", "updated_at": "2020-10-09T20:36:24Z", "closed_at": "2020-10-09T20:35:48Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML commments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n\r\nHi,\r\n\r\nI'm registering this here becasue I think the issue lies in jupyterhub.services.\r\n\r\nI have a working Jupyterhub 0.9.6 + jupyter lab installation, installed from anaconda. It uses batchspawner (with PBS Pro) and a custom SAML authenticator.\r\n\r\nAfter upgrading to 1.1.0 (from conda-forge), the Hub still launches a lab session, but then gives a 404. In the debug logs of the labhub, I see a change in behaviour wrt auth redirection.  From the working 0.9.6:\r\n\r\n```\r\n[I 2020-10-08 09:52:54.244 SingleUserLabApp singleuser:406] Starting jupyterhub-singleuser server version 0.9.6\r\n[D 2020-10-08 09:52:54.253 SingleUserLabApp _version:53] jupyterhub and jupyterhub-singleuser both on version 0.9.6\r\n[I 2020-10-08 09:52:54.253 SingleUserLabApp notebookapp:1774] Serving notebooks from local directory: /rds/general/user/mjharvey/home\r\n[I 2020-10-08 09:52:54.253 SingleUserLabApp notebookapp:1774] The Jupyter Notebook is running at:\r\n[I 2020-10-08 09:52:54.253 SingleUserLabApp notebookapp:1774] http://(login-6 or 127.0.0.1):55874/user/mjharvey/?token=ab04206c826f4f39a623b98681fc423a\r\n[I 2020-10-08 09:52:54.253 SingleUserLabApp notebookapp:1775] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).\r\n[C 2020-10-08 09:52:54.281 SingleUserLabApp notebookapp:1796]\r\n\r\n    To access the notebook, open this file in a browser:\r\n        file:///rds/general/user/mjharvey/home/.local/share/jupyter/runtime/nbserver-31082-open.html\r\n    Or copy and paste one of these URLs:\r\n        http://(login-6 or 127.0.0.1):55874/user/mjharvey/?token=ab04206c826f4f39a623b98681fc423a\r\n[I 2020-10-08 09:52:55.745 SingleUserLabApp log:158] 302 GET /user/mjharvey/ -> /user/mjharvey/lab? (@192.168.97.33) 1.01ms\r\n[D 2020-10-08 09:53:00.081 SingleUserLabApp auth:421] No user identified\r\n[D 2020-10-08 09:53:00.083 SingleUserLabApp auth:741] Redirecting to login url: /hub/api/oauth2/authorize?client_id=jupyterhub-user-mjharvey&redirect_uri=%2Fuser%2Fmjharvey%2\r\nFoauth_callback&response_type=code&state=eyJ1dWlkIjogImjharveyMjNiNTBjZjdiYzQ3YThiMDc2MDcxMWE4YTYzZDc1IiwgIm5leHRfdXJsIjogIi91c2VyL2pjMS9sYWI_cmVkaXJlY3RzPTMifQ\r\n[I 2020-10-08 09:53:00.084 SingleUserLabApp log:158] 302 GET /user/mjharvey/lab?redirects=3 -> /hub/api/oauth2/authorize?client_id=jupyterhub-user-mjharvey&redirect_uri=%2Fus\r\ner%2Fmjharvey%2Foauth_callback&response_type=code&state=[secret] (@2a0c:5bc0:88:100:a:0:d73f:d545) 3.57ms\r\n[D 2020-10-08 09:53:00.273 SingleUserLabApp auth:421] No user identified\r\n[D 2020-10-08 09:53:00.485 SingleUserLabApp auth:263] Cache miss: token:79905553545f47848849ee434e2ed62e:ec38d7f5-f76c-4191-bc9e-e930fb01dd8c\r\n[D 2020-10-08 09:53:00.685 SingleUserLabApp auth:269] Received request from Hub user {'kind': 'user', 'name': 'mjharvey', 'admin': False, 'groups': [], 'server': '/user/\r\nmjharvey/', 'pending': None, 'created': '2020-10-05T13:55:39.523996Z', 'last_activity': '2020-10-08T08:53:00.625006Z', 'servers': None}\r\n[I 2020-10-08 09:53:00.685 SingleUserLabApp auth:875] Logged-in user {'kind': 'user', 'name': 'mjharvey', 'admin': False, 'groups': [], 'server': '/user/mjharvey/', 'pending'\r\n: None, 'created': '2020-10-05T13:55:39.523996Z', 'last_activity': '2020-10-08T08:53:00.625006Z', 'servers': None}\r\n[D 2020-10-08 09:53:00.685 SingleUserLabApp auth:656] Setting oauth cookie for 2a0c:5bc0:88:100:a:0:d73f:d545: jupyterhub-user-mjharvey, {'path': '/user/mjharvey/', 'httponly\r\n': True, 'secure': True}\r\n[I 2020-10-08 09:53:00.686 SingleUserLabApp log:158] 302 GET /user/mjharvey/oauth_callback?code=[secret]&state=[secret] -> /user/mjharvey/lab?redirects=3 (@2a0c:5bc0:88:100:a\r\n:0:d73f:d545) 412.82ms\r\n[D 2020-10-08 09:53:00.715 SingleUserLabApp auth:778] Allowing whitelisted Hub user mjharvey\r\n[D 2020-10-08 09:53:00.717 SingleUserLabApp handlers:260] Using contents: services/contents\r\n```\r\n\r\nand from 1.1.0:\r\n\r\n```\r\n[I 2020-10-09 17:11:01.888 SingleUserLabApp singleuser:561] Starting jupyterhub-singleuser server version 1.1.0\r\n[D 2020-10-09 17:11:01.900 SingleUserLabApp _version:59] jupyterhub and jupyterhub-singleuser both on version 1.1.0\r\n[I 2020-10-09 17:11:01.901 SingleUserLabApp notebookapp:2209] Serving notebooks from local directory: /rds/general/user/mjharvey/home\r\n[I 2020-10-09 17:11:01.901 SingleUserLabApp notebookapp:2209] Jupyter Notebook 6.1.4 is running at:\r\n[I 2020-10-09 17:11:01.901 SingleUserLabApp notebookapp:2209] http://:::36997/\r\n[I 2020-10-09 17:11:01.901 SingleUserLabApp notebookapp:2210] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).\r\n[I 2020-10-09 17:11:02.322 SingleUserLabApp singleuser:541] Updating Hub with activity every 300 seconds\r\n[D 2020-10-09 17:11:02.322 SingleUserLabApp singleuser:503] Notifying Hub of activity 2020-10-09T16:10:03.932056Z\r\n[I 2020-10-09 17:11:02.676 SingleUserLabApp log:174] 302 GET /user/mjharvey/ -> /user/mjharvey (@2a0c:5bc0:88:101:250:56ff:fea1:4d95) 1.23ms\r\n[I 2020-10-09 17:11:03.900 SingleUserLabApp log:174] 302 GET /user/mjharvey/ -> /user/mjharvey (@2a0c:5bc0:40:2ffe::252:43) 1.10ms\r\n[D 2020-10-09 17:11:04.533 SingleUserLabApp auth:501] No user identified\r\n```\r\n\r\nIt seems that the 1.1.0 does not issue the redirection to login.\r\n\r\nIf I manually wget  \"/\" from the labhub, I see it issue a redirect as expected:\r\n\r\n```\r\n[I 2020-10-09 17:57:17.781 SingleUserLabApp log:174] 302 GET / -> /lab? (@::1) 51.64ms\r\n[D 2020-10-09 17:57:17.783 SingleUserLabApp auth:501] No user identified\r\n[D 2020-10-09 17:57:18.190 SingleUserLabApp auth:832] Redirecting to login url: /hub/api/oauth2/authorize?client_id=jupyterhub-user-mjharvey&redirect_uri=%2Fuser%2F\r\nmjharvey%2Foauth_callback&response_type=code&state=eyJ1dWlkIjogIjU5OTgxNjRhOWEzYTQ5NzU5ZTc3Yjk1Yjk2ZTEzNzJkIiwgIm5leHRfdXJsIjogIi9sYWI_In0\r\n[I 2020-10-09 17:57:18.191 SingleUserLabApp log:174] 302 GET /lab? -> /hub/api/oauth2/authorize?client_id=jupyterhub-user-mjharvey&redirect_uri=%2Fuser%2Fmjharvey%2\r\nFoauth_callback&response_type=code&state=[secret] (@::1) 408.89ms\r\n[D 2020-10-09 17:57:18.193 SingleUserLabApp auth:501] No user identified\r\n[D 2020-10-09 17:57:18.193 SingleUserLabApp handlers:251] Using contents: services/contents\r\n```\r\n\r\nI suspect the answer to this is obvious, and possibly lies in the fact this is an upgrade, so some configuration option/default has changed. \r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3200/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3200/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3199", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3199/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3199/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3199/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3199", "id": 718072063, "node_id": "MDU6SXNzdWU3MTgwNzIwNjM=", "number": 3199, "title": "single-user session URL incorrectly determined if its host is an IPv6 literal", "user": {"login": "mj-harvey", "id": 7896589, "node_id": "MDQ6VXNlcjc4OTY1ODk=", "avatar_url": "https://avatars.githubusercontent.com/u/7896589?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mj-harvey", "html_url": "https://github.com/mj-harvey", "followers_url": "https://api.github.com/users/mj-harvey/followers", "following_url": "https://api.github.com/users/mj-harvey/following{/other_user}", "gists_url": "https://api.github.com/users/mj-harvey/gists{/gist_id}", "starred_url": "https://api.github.com/users/mj-harvey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mj-harvey/subscriptions", "organizations_url": "https://api.github.com/users/mj-harvey/orgs", "repos_url": "https://api.github.com/users/mj-harvey/repos", "events_url": "https://api.github.com/users/mj-harvey/events{/privacy}", "received_events_url": "https://api.github.com/users/mj-harvey/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-10-09T11:30:14Z", "updated_at": "2020-10-09T18:32:17Z", "closed_at": "2020-10-09T18:32:16Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\n\r\nHello,\r\n\r\nWe have a Jupyterhub 1.0.0 environment that uses batch spawner to start single-user sessions in a cluster environment. Jupyterhub is taken from anaconda. For implementation reasons the connection betweenthe Hub and the single user session must be made using an IPv6 literal. Batch -spawner passes the IPv6 address within \"[]\", appropriate for URL-encoding (eg https://[aa:bb:cc::]/lab ). However, the Hub erroneously uses the address stripped of its square brackets. (eg https://aa:bb:cc::/lab). \r\n\r\nThis happens due to the logic circa line 555 in jupyterhub/spawn.py that passes the correct batchspawner-provided URL through urlparse:\r\n```\r\n    url = '%s://%s:%i' % ((proto,) + url)   # url is string from batchspawner containing IPv6 in the form '[aa:bb:cc::]'\r\n    urlinfo = urlparse(url)\r\n    server.proto = urlinfo.scheme\r\n    server.ip = urlinfo.hostname\r\n```\r\n\r\nI don't have a general fix for this, we've patched it with\r\n```\r\nserver.ip = \"[%s]\" % (urlinfo.hostname,)\r\n```\r\n\r\nwhich is appropriate only for our environment.\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3199/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3199/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3196", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3196/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3196/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3196/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3196", "id": 715742318, "node_id": "MDU6SXNzdWU3MTU3NDIzMTg=", "number": 3196, "title": "Jupyterhub crashes when connecting to jupyter notebook login", "user": {"login": "GabrielPeters", "id": 72454712, "node_id": "MDQ6VXNlcjcyNDU0NzEy", "avatar_url": "https://avatars.githubusercontent.com/u/72454712?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GabrielPeters", "html_url": "https://github.com/GabrielPeters", "followers_url": "https://api.github.com/users/GabrielPeters/followers", "following_url": "https://api.github.com/users/GabrielPeters/following{/other_user}", "gists_url": "https://api.github.com/users/GabrielPeters/gists{/gist_id}", "starred_url": "https://api.github.com/users/GabrielPeters/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GabrielPeters/subscriptions", "organizations_url": "https://api.github.com/users/GabrielPeters/orgs", "repos_url": "https://api.github.com/users/GabrielPeters/repos", "events_url": "https://api.github.com/users/GabrielPeters/events{/privacy}", "received_events_url": "https://api.github.com/users/GabrielPeters/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 1280242352, "node_id": "MDU6TGFiZWwxMjgwMjQyMzUy", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/support", "name": "support", "color": "Cfaef7", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-10-06T14:40:44Z", "updated_at": "2020-10-06T14:46:54Z", "closed_at": "2020-10-06T14:46:54Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hey everyone,\r\ni am trying to make jupyterhub with CondorSpawner and LDAPauthentiator work, and I am struggeling with the following problem:\r\n\r\nI have spawned a jupyter botebook via `jupyter notebook --port=53762` via htcondor and the spawner returns the correct ip and port number. After Jupyterhub starts to connect `http://localhost:53762/tree/user/u52383/vjfjfj/` to  but when the server redirects to the spawned notebook, it always crashes with the following 404 error (last 2 lines):\r\n\r\n    16:13:41.229 [ConfigProxy] info: Adding route /tree/user/gabriel/vjfjfj -> http://127.0.0.1:53762\r\n    16:13:41.229 [ConfigProxy] info: Route added /tree/user/gabriel/vjfjfj -> http://127.0.0.1:53762\r\n    16:13:41.230 [ConfigProxy] info: 201 POST /api/routes/tree/user/gabriel/vjfjfj\r\n    [I 2020-10-06 16:13:41.232 JupyterHub users:609] Server gabriel:vjfjfj is ready\r\n    [I 2020-10-06 16:13:41.232 JupyterHub log:174] 200 GET /tree/hub/api/users/gabriel/servers/vjfjfj/progress (u52383@::ffff:127.0.0.1) 10363.56ms\r\n    [I 2020-10-06 16:13:41.244 JupyterHub log:174] 302 GET /tree/hub/spawn-pending/gabriel/vjfjfj -> /tree/user/gabriel/vjfjfj (u52383@::ffff:127.0.0.1) 0.00ms\r\n    16:13:41.258 [ConfigProxy] error: 404 GET /login?next=%2Ftree%2Fuser%2Fgabriel%2Fvjfjfj\r\n    [I 2020-10-06 16:13:41.264 JupyterHub log:174] 200 GET /tree/hub/error/404?url=%2Flogin%3Fnext%3D%252Ftree%252Fuser%252Fgabriel%252Fvjfjfj (@127.0.0.1) 0.00ms\r\n\r\nIt looks like there is some error according to the jupyter notebook since it has been requested at that time\r\n\r\n`[I 16:13:41.254 NotebookApp] 302 GET /tree/user/u52383/vjfjfj (127.0.0.1) 0.00ms`\r\n\r\nand the error itself sounds like an login error `/login?next=%2Ftree%2Fuser%2Fgabriel%2Fvjfjfj`\r\n\r\nDoes anybody know what causes this crash? Or is there an error with spawning the notebook this way?\r\n\r\nThanks in advance \r\n\r\nGabriel", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3196/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3196/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3191", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3191/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3191/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3191/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3191", "id": 712653673, "node_id": "MDU6SXNzdWU3MTI2NTM2NzM=", "number": 3191, "title": "CI: jupyter-server build fails since late september", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-10-01T09:11:34Z", "updated_at": "2020-10-15T12:47:37Z", "closed_at": "2020-10-15T12:47:37Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "The `test_singleuser_auth` step fails with the following error ([example failure](https://travis-ci.org/github/jupyterhub/jupyterhub/jobs/729518444))\r\n\r\n```\r\n404 Client Error: Not Found for url: http://127.0.0.1:59471/@/space%20word/user/nandy/api/spec.yaml?redirects=2\r\n```\r\n\r\nHas something change with regards to `@` symbols or spaces in words like `space word`? Yes it has, in `jupyter-server` it seems, because there have been releases in this time span.\r\n\r\n![image](https://user-images.githubusercontent.com/3837114/94790428-9275a400-03d6-11eb-807f-1a174e1b3721.png)\r\n\r\n## References\r\n- [jupyter-server changelog](https://github.com/jupyter/jupyter_server/blob/master/CHANGELOG.md)\r\n- [The only PR that I saw in the changelog with clear potential to cause our CI error](https://github.com/jupyter/jupyter_server/pull/304)\r\n- [A seemingly related PR by, @minrk](https://github.com/jupyterhub/jupyterhub/pull/3168)\r\n- [Another seemingly related PR, by @danlester](https://github.com/jupyterhub/jupyterhub/pull/3167)", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3191/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3191/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3188", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3188/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3188/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3188/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3188", "id": 709852665, "node_id": "MDU6SXNzdWU3MDk4NTI2NjU=", "number": 3188, "title": "GUI get stuck after HUB restart", "user": {"login": "vincent-pli", "id": 8669744, "node_id": "MDQ6VXNlcjg2Njk3NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/8669744?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vincent-pli", "html_url": "https://github.com/vincent-pli", "followers_url": "https://api.github.com/users/vincent-pli/followers", "following_url": "https://api.github.com/users/vincent-pli/following{/other_user}", "gists_url": "https://api.github.com/users/vincent-pli/gists{/gist_id}", "starred_url": "https://api.github.com/users/vincent-pli/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vincent-pli/subscriptions", "organizations_url": "https://api.github.com/users/vincent-pli/orgs", "repos_url": "https://api.github.com/users/vincent-pli/repos", "events_url": "https://api.github.com/users/vincent-pli/events{/privacy}", "received_events_url": "https://api.github.com/users/vincent-pli/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-09-28T00:35:52Z", "updated_at": "2020-10-03T03:21:50Z", "closed_at": "2020-10-03T03:21:50Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML commments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\n\r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\nThe GUI could work as normal, open/close file.\r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\nGet stuck\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\nActually, the bug come from our produce with integrated `jupyterhub` version 1.1.0.\r\n### Your personal set up\r\nI'm new in `jupyterhub`, I checked the behavior, seems:\r\n1. When received request to start user server, `hub` will start up a `pod` to handle this, and then add a new `route` to `configurable-http-proxy`\r\n2. The request with prefix `/user/xxx` will be redirect to user server, not `hub`\r\n3. When kill `hub`, I saw there is log: `debug: [ConfigProxy] DELETE /user/admin`, I guess the new add route is deleted by something.\r\n4. Then request with prefix `/user/xxx` will be redirect to `hub`, seems `hub` do not handle it.\r\n5. GUI get stuck.\r\n\r\n\r\nThat's steps are just my guess, could someone clarify it, many thanks.\r\nI want to make sure if the root cause is the new added `route` removed when `hub` restart, and who did it, thanks.\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3188/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3188/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3178", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3178/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3178/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3178/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3178", "id": 703501358, "node_id": "MDU6SXNzdWU3MDM1MDEzNTg=", "number": 3178, "title": "Broken docs on server-actions", "user": {"login": "qTipTip", "id": 11932512, "node_id": "MDQ6VXNlcjExOTMyNTEy", "avatar_url": "https://avatars.githubusercontent.com/u/11932512?v=4", "gravatar_id": "", "url": "https://api.github.com/users/qTipTip", "html_url": "https://github.com/qTipTip", "followers_url": "https://api.github.com/users/qTipTip/followers", "following_url": "https://api.github.com/users/qTipTip/following{/other_user}", "gists_url": "https://api.github.com/users/qTipTip/gists{/gist_id}", "starred_url": "https://api.github.com/users/qTipTip/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/qTipTip/subscriptions", "organizations_url": "https://api.github.com/users/qTipTip/orgs", "repos_url": "https://api.github.com/users/qTipTip/repos", "events_url": "https://api.github.com/users/qTipTip/events{/privacy}", "received_events_url": "https://api.github.com/users/qTipTip/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-09-17T11:26:11Z", "updated_at": "2021-02-17T17:52:05Z", "closed_at": "2021-02-17T17:52:05Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML commments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\nHi! :) \r\n\r\nTrying to figure out some telemetry, and noticed a broken doc-page.\r\n\r\n### Bug description\r\n\r\nThe page https://jupyterhub.readthedocs.io/en/stable/events/server-actions.html looks broken. Probably something in the yaml file here: https://github.com/jupyterhub/jupyterhub/tree/master/jupyterhub/event-schemas/server-actions", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3178/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3178/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3172", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3172/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3172/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3172/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3172", "id": 700690189, "node_id": "MDU6SXNzdWU3MDA2OTAxODk=", "number": 3172, "title": "404 errors on static files, missing jquery-ui, jquery-typeahead and other packages. ", "user": {"login": "ishita9", "id": 36771676, "node_id": "MDQ6VXNlcjM2NzcxNjc2", "avatar_url": "https://avatars.githubusercontent.com/u/36771676?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ishita9", "html_url": "https://github.com/ishita9", "followers_url": "https://api.github.com/users/ishita9/followers", "following_url": "https://api.github.com/users/ishita9/following{/other_user}", "gists_url": "https://api.github.com/users/ishita9/gists{/gist_id}", "starred_url": "https://api.github.com/users/ishita9/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ishita9/subscriptions", "organizations_url": "https://api.github.com/users/ishita9/orgs", "repos_url": "https://api.github.com/users/ishita9/repos", "events_url": "https://api.github.com/users/ishita9/events{/privacy}", "received_events_url": "https://api.github.com/users/ishita9/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2020-09-14T01:09:22Z", "updated_at": "2021-03-10T04:10:20Z", "closed_at": "2021-02-17T18:01:41Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n#### Bug description\r\nI am using Jupyterhub to deploy some Jupyter notebook based trainings on AWS Fargate. I used FargateSpawner to spawn notebook servers. Following is the jupyterhub_config.py:\r\n\r\n```\r\nc.JupyterHub.ip = '0.0.0.0'\r\nfrom fargatespawner import FargateSpawner\r\nc.ConfigurableHTTPProxy.debug = True\r\nc.JupyterHub.spawner_class = FargateSpawner\r\nc.FargateSpawner.aws_region = 'us-east-2'\r\nc.FargateSpawner.aws_ecs_host = 'ecs.us-east-2.amazonaws.com'\r\nc.FargateSpawner.notebook_port = 8888\r\nc.FargateSpawner.notebook_scheme = 'http'\r\nc.FargateSpawner.get_run_task_args = lambda spawner: {\r\n    'cluster': 'wrfhydro-training-cluster',\r\n    'taskDefinition': 'wrf_hydro_training_task:3',\r\n    'overrides': {\r\n        'taskRoleArn': 'arn:aws:iam::246100504914:role/wrfhydro_training_ECS_task_execution',\r\n        'containerOverrides': [\r\n            {\r\n                'command': spawner.cmd + [f'--port={spawner.notebook_port}', '--config=/home/docker/.jupyter/jupyter_notebook_config.py'],\r\n                'environment': [\r\n                    {'name': name, 'value': value}\r\n                    for name, value in spawner.get_env().items()\r\n                ],\r\n                'name': 'wrf_hydro_training',\r\n            }\r\n        ],\r\n    },\r\n    'count': 1,\r\n    'launchType': 'FARGATE',\r\n    'networkConfiguration': {\r\n        'awsvpcConfiguration': {\r\n            'assignPublicIp': 'DISABLED',\r\n            'securityGroups': ['sg-00b58f5b50e4f5223'],\r\n            'subnets': ['subnet-02641bd52c60bf707'],\r\n        }\r\n    },\r\n}\r\n\r\nfrom fargatespawner import FargateSpawnerECSRoleAuthentication\r\n\r\nc.FargateSpawner.authentication_class = FargateSpawnerECSRoleAuthentication\r\nc.Spawner.http_timeout = 180\r\nc.Spawner.start_timeout = 180\r\nc.JupyterHub.authenticator_class = 'nativeauthenticator.NativeAuthenticator'\r\nc.Authenticator.admin_users = {'ishitas'}\r\nc.NativeAuthenticator.open_signup = True\r\nc.NativeAuthenticator.minimum_password_length = 10\r\nc.NativeAuthenticator.check_common_password = True\r\nc.NativeAuthenticator.allowed_failed_logins = 3\r\nc.NativeAuthenticator.seconds_before_next_try = 1200\r\n\r\nimport os\r\nimport shutil\r\n\r\ndef create_dir_hook(spawner):\r\n    \"\"\" Create directory \"\"\"\r\n    username = spawner.user.name  # get the username\r\n    print(username)\r\n\r\ndef clean_dir_hook(spawner):\r\n    \"\"\" Delete directory \"\"\"\r\n    username = spawner.user.name  # get the username\r\n    print(username)\r\n\r\nc.Spawner.pre_spawn_hook = create_dir_hook\r\nc.Spawner.post_stop_hook = clean_dir_hook\r\n```\r\n\r\nI am able to access the login page, sign up the user and start the spawning process. At the end, I see the Server Created message for the user. I also see the single-user notebook container spawned by the hub running on my AWS console. However, soon after the server is created I get the following 404 errors:\r\n\r\n\r\n```                                                                                                                                                     |\r\n| 1600039189958 | 23:19:49.958 [ConfigProxy] \u001b[34mdebug\u001b[39m: PROXY WEB /user/ishitas/ to http://10.20.1.185:8888                                                                                                                                                                                               |\r\n| 1600039190052 | 23:19:50.052 [ConfigProxy] \u001b[34mdebug\u001b[39m: PROXY WEB /user/ishitas to http://10.20.1.185:8888                                                                                                                                                                                                |\r\n| 1600039190206 | 23:19:50.206 [ConfigProxy] \u001b[34mdebug\u001b[39m: PROXY WEB /static/components/jquery-ui/themes/smoothness/jquery-ui.min.css?v=3c2a865c832a1322285c55c6ed99abb2 to http://127.0.0.1:8081                                                                                                            |\r\n| 1600039190208 | 23:19:50.207 [ConfigProxy] \u001b[34mdebug\u001b[39m: PROXY WEB /static/components/jquery-typeahead/dist/jquery.typeahead.min.css?v=7afb461de36accb1aa133a1710f5bc56 to http://127.0.0.1:8081                                                                                                           |\r\n| 1600039190211 | [I 2020-09-13 23:19:50.210 JupyterHub log:181] 302 GET /static/components/jquery-ui/themes/smoothness/jquery-ui.min.css?v=3c2a865c832a1322285c55c6ed99abb2 -> /hub/static/components/jquery-ui/themes/smoothness/jquery-ui.min.css?v=3c2a865c832a1322285c55c6ed99abb2 (@10.20.2.101) 1.48ms   |\r\n| 1600039190212 | [I 2020-09-13 23:19:50.211 JupyterHub log:181] 302 GET /static/components/jquery-typeahead/dist/jquery.typeahead.min.css?v=7afb461de36accb1aa133a1710f5bc56 -> /hub/static/components/jquery-typeahead/dist/jquery.typeahead.min.css?v=7afb461de36accb1aa133a1710f5bc56 (@10.20.2.101) 2.06ms |\r\n| 1600039190285 | 23:19:50.285 [ConfigProxy] \u001b[34mdebug\u001b[39m: PROXY WEB /static/style/style.min.css?v=56cad67b8b1ff3ed9b48850e9efcffb3 to http://127.0.0.1:8081                                                                                                                                                 |\r\n| 1600039190288 | [I 2020-09-13 23:19:50.287 JupyterHub log:181] 302 GET /static/style/style.min.css?v=56cad67b8b1ff3ed9b48850e9efcffb3 -> /hub/static/style/style.min.css?v=56cad67b8b1ff3ed9b48850e9efcffb3 (@10.20.2.101) 0.90ms                                                                             |\r\n| 1600039190300 | 23:19:50.300 [ConfigProxy] \u001b[34mdebug\u001b[39m: PROXY WEB /hub/static/components/jquery-typeahead/dist/jquery.typeahead.min.css?v=7afb461de36accb1aa133a1710f5bc56 to http://127.0.0.1:8081                                                                                                       |\r\n| 1600039190301 | 23:19:50.301 [ConfigProxy] \u001b[34mdebug\u001b[39m: PROXY WEB /hub/static/components/jquery-ui/themes/smoothness/jquery-ui.min.css?v=3c2a865c832a1322285c55c6ed99abb2 to http://127.0.0.1:8081                                                                                                        |\r\n| 1600039190304 | [W 2020-09-13 23:19:50.303 JupyterHub log:181] 404 GET /hub/static/components/jquery-typeahead/dist/jquery.typeahead.min.css?v=7afb461de36accb1aa133a1710f5bc56 (@10.20.2.101) 1.16ms                                                                                                         |\r\n| 1600039190305 | [W 2020-09-13 23:19:50.304 JupyterHub log:181] 404 GET /hub/static/components/jquery-ui/themes/smoothness/jquery-ui.min.css?v=3c2a865c832a1322285c55c6ed99abb2 (@10.20.2.101) 1.95ms                                                                                                          |\r\n| 1600039190376 | 23:19:50.376 [ConfigProxy] \u001b[34mdebug\u001b[39m: PROXY WEB /hub/static/style/style.min.css?v=56cad67b8b1ff3ed9b48850e9efcffb3 to http://127.0.0.1:8081                                                                                                                                             |\r\n| 1600039190379 | [W 2020-09-13 23:19:50.379 JupyterHub log:181] 404 GET /hub/static/style/style.min.css?v=56cad67b8b1ff3ed9b48850e9efcffb3 (@10.20.2.101) 1.16ms                                                                                                                                               |\r\n| 1600039190394 | 23:19:50.394 [ConfigProxy] \u001b[34mdebug\u001b[39m: PROXY WEB /custom/custom.css to http://127.0.0.1:8081                                                                                                                                                                                             |\r\n| 1600039190397 | [I 2020-09-13 23:19:50.397 JupyterHub log:181] 302 GET /custom/custom.css -> /hub/custom/custom.css (@10.20.2.101) 1.04ms                                                                                                                                                                     |\r\n| 1600039190400 | 23:19:50.400 [ConfigProxy] \u001b[34mdebug\u001b[39m: PROXY WEB /static/components/es6-promise/promise.min.js?v=f004a16cb856e0ff11781d01ec5ca8fe to http://127.0.0.1:8081                                                                                                                               |\r\n| 1600039190402 | [I 2020-09-13 23:19:50.402 JupyterHub log:181] 302 GET /static/components/es6-promise/promise.min.js?v=f004a16cb856e0ff11781d01ec5ca8fe -> /hub/static/components/es6-promise/promise.min.js?v=f004a16cb856e0ff11781d01ec5ca8fe (@10.20.2.101) 0.87ms                                         |\r\n| 1600039190469 | 23:19:50.469 [ConfigProxy] \u001b[34mdebug\u001b[39m: PROXY WEB /static/components/preact/index.js?v=00a2fac73c670ce39ac53d26640eb542 to http://127.0.0.1:8081                                                                                                                                          |\r\n| 1600039190472 | [I 2020-09-13 23:19:50.471 JupyterHub log:181] 302 GET /static/components/preact/index.js?v=00a2fac73c670ce39ac53d26640eb542 -> /hub/static/components/preact/index.js?v=00a2fac73c670ce39ac53d26640eb542 (@10.20.2.101) 1.10ms                                                               |\r\n| 1600039190485 | 23:19:50.485 [ConfigProxy] \u001b[34mdebug\u001b[39m: PROXY WEB /hub/custom/custom.css to http://127.0.0.1:8081                                                                                                                                                                                         |\r\n| 1600039190492 | 23:19:50.491 [ConfigProxy] \u001b[34mdebug\u001b[39m: PROXY WEB /hub/static/components/es6-promise/promise.min.js?v=f004a16cb856e0ff11781d01ec5ca8fe to http://127.0.0.1:8081                                                                                                                           |\r\n| 1600039190498 | [W 2020-09-13 23:19:50.497 JupyterHub log:181] 404 GET /hub/custom/custom.css (ishitas@10.20.2.101) 11.36ms                                                                                                                                                                                   |\r\n| 1600039190500 | [W 2020-09-13 23:19:50.499 JupyterHub log:181] 404 GET /hub/static/components/es6-promise/promise.min.js?v=f004a16cb856e0ff11781d01ec5ca8fe (@10.20.2.101) 0.87ms                                                                                                                             |\r\n| 1600039190567 | 23:19:50.567 [ConfigProxy] \u001b[34mdebug\u001b[39m: PROXY WEB /hub/static/components/preact/index.js?v=00a2fac73c670ce39ac53d26640eb542 to http://127.0.0.1:8081                                                                                                                                      |\r\n| 1600039190569 | [W 2020-09-13 23:19:50.569 JupyterHub log:181] 404 GET /hub/static/components/preact/index.js?v=00a2fac73c670ce39ac53d26640eb542 (@10.20.2.101) 0.96ms                                                                                                                                        |\r\n| 1600039190591 | 23:19:50.591 [ConfigProxy] \u001b[34mdebug\u001b[39m: PROXY WEB /static/components/proptypes/index.js?v=c40890eb04df9811fcc4d47e53a29604 to http://127.0.0.1:8081                                                                                                                                       |\r\n| 1600039190592 | 23:19:50.592 [ConfigProxy] \u001b[34mdebug\u001b[39m: PROXY WEB /static/components/preact-compat/index.js?v=aea8f6660e54b18ace8d84a9b9654c1c to http://127.0.0.1:8081                                                                                                                                   |\r\n| 1600039190595 | [I 2020-09-13 23:19:50.595 JupyterHub log:181] 302 GET /static/components/proptypes/index.js?v=c40890eb04df9811fcc4d47e53a29604 -> /hub/static/components/proptypes/index.js?v=c40890eb04df9811fcc4d47e53a29604 (@10.20.2.101) 1.35ms                                                         |\r\n| 1600039190596 | [I 2020-09-13 23:19:50.596 JupyterHub log:181] 302 GET /static/components/preact-compat/index.js?v=aea8f6660e54b18ace8d84a9b9654c1c -> /hub/static/components/preact-compat/index.js?v=aea8f6660e54b18ace8d84a9b9654c1c (@10.20.2.101) 1.86ms                                                 |\r\n| 1600039190657 | 23:19:50.657 [ConfigProxy] \u001b[34mdebug\u001b[39m: PROXY WEB /static/components/requirejs/require.js?v=951f856e81496aaeec2e71a1c2c0d51f to http://127.0.0.1:8081                                                                                                                                     |\r\n| 1600039190660 | [I 2020-09-13 23:19:50.660 JupyterHub log:181] 302 GET /static/components/requirejs/require.js?v=951f856e81496aaeec2e71a1c2c0d51f -> /hub/static/components/requirejs/require.js?v=951f856e81496aaeec2e71a1c2c0d51f (@10.20.2.101) 1.10ms                                                     |\r\n| 1600039190689 | 23:19:50.689 [ConfigProxy] \u001b[34mdebug\u001b[39m: PROXY WEB /hub/static/components/preact-compat/index.js?v=aea8f6660e54b18ace8d84a9b9654c1c to http://127.0.0.1:8081                                                                                                                               |\r\n| 1600039190690 | 23:19:50.690 [ConfigProxy] \u001b[34mdebug\u001b[39m: PROXY WEB /hub/static/components/proptypes/index.js?v=c40890eb04df9811fcc4d47e53a29604 to http://127.0.0.1:8081                                                                                                                                   |\r\n| 1600039190693 | [W 2020-09-13 23:19:50.693 JupyterHub log:181] 404 GET /hub/static/components/preact-compat/index.js?v=aea8f6660e54b18ace8d84a9b9654c1c (@10.20.2.101) 1.27ms                                                                                                                                 |\r\n| 1600039190694 | [W 2020-09-13 23:19:50.694 JupyterHub log:181] 404 GET /hub/static/components/proptypes/index.js?v=c40890eb04df9811fcc4d47e53a29604 (@10.20.2.101) 1.89ms                                                                                                                                     |\r\n| 1600039190789 | 23:19:50.789 [ConfigProxy] \u001b[34mdebug\u001b[39m: PROXY WEB /static/components/preact-compat/index.js?v=aea8f6660e54b18ace8d84a9b9654c1c to http://127.0.0.1:8081                                                                                                                                   |\r\n| 1600039190791 | 23:19:50.790 [ConfigProxy] \u001b[34mdebug\u001b[39m: PROXY WEB /static/base/images/logo.png?v=641991992878ee24c6f3826e81054a0f to http://127.0.0.1:8081                                                                                                                                                |\r\n| 1600039190794 | [I 2020-09-13 23:19:50.793 JupyterHub log:181] 302 GET /static/components/preact-compat/index.js?v=aea8f6660e54b18ace8d84a9b9654c1c -> /hub/static/components/preact-compat/index.js?v=aea8f6660e54b18ace8d84a9b9654c1c (@10.20.2.101) 1.39ms                                                 |\r\n| 1600039190794 | [I 2020-09-13 23:19:50.794 JupyterHub log:181] 302 GET /static/base/images/logo.png?v=641991992878ee24c6f3826e81054a0f -> /hub/static/base/images/logo.png?v=641991992878ee24c6f3826e81054a0f (@10.20.2.101) 2.00ms                                                                           |\r\n| 1600039190887 | 23:19:50.886 [ConfigProxy] \u001b[34mdebug\u001b[39m: PROXY WEB /hub/static/components/preact-compat/index.js?v=aea8f6660e54b18ace8d84a9b9654c1c to http://127.0.0.1:8081                                                                                                                               |\r\n| 1600039190888 | 23:19:50.888 [ConfigProxy] \u001b[34mdebug\u001b[39m: PROXY WEB /hub/static/base/images/logo.png?v=641991992878ee24c6f3826e81054a0f to http://127.0.0.1:8081                                                                                                                                            |\r\n| 1600039190898 | [W 2020-09-13 23:19:50.894 JupyterHub log:181] 404 GET /hub/static/base/images/logo.png?v=641991992878ee24c6f3826e81054a0f (@10.20.2.101) 1.28ms                                                                                                                                              |\r\n| 1600039190898 | [W 2020-09-13 23:19:50.895 JupyterHub log:181] 404 GET /hub/static/components/preact-compat/index.js?v=aea8f6660e54b18ace8d84a9b9654c1c (@10.20.2.101) 0.98ms                                                                                                                                 |\r\n| 1600039191053 | 23:19:51.053 [ConfigProxy] \u001b[34mdebug\u001b[39m: PROXY WEB /static/components/jquery/jquery.min.js?v=20200913231945 to http://127.0.0.1:8081                                                                                                                                                       |\r\n| 1600039191056 | [I 2020-09-13 23:19:51.056 JupyterHub log:181] 302 GET /static/components/jquery/jquery.min.js?v=20200913231945 -> /hub/static/components/jquery/jquery.min.js?v=20200913231945 (@10.20.2.101) 1.10ms                                                                                         |\r\n| 1600039191143 | 23:19:51.143 [ConfigProxy] \u001b[34mdebug\u001b[39m: PROXY WEB /hub/static/components/jquery/jquery.min.js?v=20200913231945 to http://127.0.0.1:8081                                                                                                                                                   |\r\n| 1600039191146 | [W 2020-09-13 23:19:51.146 JupyterHub log:181] 404 GET /hub/static/components/jquery/jquery.min.js?v=20200913231945 (@10.20.2.101) 1.04ms   \r\n```\r\nOn debugging, I found out that the docker images with the latest 1.1.0 version, 1.2.0 dev version, previous versions like 1.0.0 are all missing these static components under /usr/local/share/jupyterhub. Not sure why are these being requested or why are they not present in the /usr/local/share/ dir?\r\n\r\nPlease let me know how I should proceed further and troubleshoot this. Thanks.                                                                                                                                           \r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\n\r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\nAfter the jupyterhub server starts, and a new user is created, it should render the notebook directory inside thedf single-user container spawned by the hub.\r\n\r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\nBunch of 404 errors.\r\n\r\n#### Error Snapshot\r\n![image](https://user-images.githubusercontent.com/36771676/93033570-00a72200-f5f4-11ea-99ef-fb99915cd571.png)\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3172/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3172/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3170", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3170/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3170/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3170/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3170", "id": 700418495, "node_id": "MDU6SXNzdWU3MDA0MTg0OTU=", "number": 3170, "title": "Issue with named servers and traitlets > 5", "user": {"login": "rcthomas", "id": 78920, "node_id": "MDQ6VXNlcjc4OTIw", "avatar_url": "https://avatars.githubusercontent.com/u/78920?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rcthomas", "html_url": "https://github.com/rcthomas", "followers_url": "https://api.github.com/users/rcthomas/followers", "following_url": "https://api.github.com/users/rcthomas/following{/other_user}", "gists_url": "https://api.github.com/users/rcthomas/gists{/gist_id}", "starred_url": "https://api.github.com/users/rcthomas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rcthomas/subscriptions", "organizations_url": "https://api.github.com/users/rcthomas/orgs", "repos_url": "https://api.github.com/users/rcthomas/repos", "events_url": "https://api.github.com/users/rcthomas/events{/privacy}", "received_events_url": "https://api.github.com/users/rcthomas/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2020-09-12T23:40:58Z", "updated_at": "2022-05-22T15:03:35Z", "closed_at": "2022-05-22T15:03:35Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Right now `requirements.txt` says `traitlets>=4.3.2`.  I just ran into an issue with traitlets 5.0.4 and JupyterHub 1.1.0 that manifested with named servers.  From my logs and a lot of debugging it started off looking like JupyterHub \"forgot\" that I wanted a named server and not empty string one.  Further, it couldn't configure the notebook server port and the spawn would just seem to hang.  Forcing the port to be set in the JupyterHub config would result in a 404.\r\n\r\nI tracked it down to `Spawner.server` not getting set when new traitlets was installed.  I haven't pushed further to figure out why that would be happening, but upon comparing the dependencies I'd picked up I noticed the major version of traitlets had changed from 4 to 5 in my container build.  Reverting it made things OK.\r\n\r\nFor now I've pinned to the older traitlets, but thought I'd file an issue at least in case anyone else bumped into it.\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3170/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3170/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3167", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3167/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3167/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3167/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3167", "id": 697925374, "node_id": "MDExOlB1bGxSZXF1ZXN0NDgzODE5ODU1", "number": 3167, "title": "[WIP] Remove @ from list of safe chars when escaping username", "user": {"login": "danlester", "id": 786238, "node_id": "MDQ6VXNlcjc4NjIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/786238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/danlester", "html_url": "https://github.com/danlester", "followers_url": "https://api.github.com/users/danlester/followers", "following_url": "https://api.github.com/users/danlester/following{/other_user}", "gists_url": "https://api.github.com/users/danlester/gists{/gist_id}", "starred_url": "https://api.github.com/users/danlester/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/danlester/subscriptions", "organizations_url": "https://api.github.com/users/danlester/orgs", "repos_url": "https://api.github.com/users/danlester/repos", "events_url": "https://api.github.com/users/danlester/events{/privacy}", "received_events_url": "https://api.github.com/users/danlester/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 12, "created_at": "2020-09-10T12:59:54Z", "updated_at": "2021-05-12T09:00:12Z", "closed_at": "2021-05-12T09:00:12Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3167", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3167", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3167.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3167.patch", "merged_at": null}, "body": "Reading up a little bit on URLs I think JupyterHub should not allow @ in the server's URL - it should be URL encoding it I believe. See [here](https://perishablepress.com/stop-using-unsafe-characters-in-urls/).\r\n\r\nWhile @ is technically valid in URLs, it's not really valid in the path and should be URL encoded there.\r\n\r\nIMO we shouldn't be seeing URLs like https://myjupyterhub.net/user/dan@test.com/\r\nThey should be https://myjupyterhub.net/user/dan%40test.com/\r\nwhich admittedly doesn't look so nice!\r\n\r\nPlease note I haven't tested my code change - other aspects might need amending too - but wanted to see if anyone had any important opinions on this first.\r\n\r\nThis issue has caused confusion [here](https://github.com/ideonate/jhsingle-native-proxy/pull/6). (Although there is also arguably another fix needed in the component in question...)", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3167/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3167/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3166", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3166/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3166/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3166/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3166", "id": 697567543, "node_id": "MDU6SXNzdWU2OTc1Njc1NDM=", "number": 3166, "title": "\"Edit this page\" URLs for stable docs broken", "user": {"login": "nguyenvulong", "id": 1311412, "node_id": "MDQ6VXNlcjEzMTE0MTI=", "avatar_url": "https://avatars.githubusercontent.com/u/1311412?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nguyenvulong", "html_url": "https://github.com/nguyenvulong", "followers_url": "https://api.github.com/users/nguyenvulong/followers", "following_url": "https://api.github.com/users/nguyenvulong/following{/other_user}", "gists_url": "https://api.github.com/users/nguyenvulong/gists{/gist_id}", "starred_url": "https://api.github.com/users/nguyenvulong/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nguyenvulong/subscriptions", "organizations_url": "https://api.github.com/users/nguyenvulong/orgs", "repos_url": "https://api.github.com/users/nguyenvulong/repos", "events_url": "https://api.github.com/users/nguyenvulong/events{/privacy}", "received_events_url": "https://api.github.com/users/nguyenvulong/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-09-10T07:47:18Z", "updated_at": "2021-02-17T17:56:42Z", "closed_at": "2021-02-17T17:56:42Z", "author_association": "NONE", "active_lock_reason": null, "body": "When I want to fix the docs, I would click on \"Edit this page\" (top right corner)\r\nFor example: https://jupyterhub.readthedocs.io/en/stable/installation-guide-hard.html\r\n\r\nIt would take me to the broken link as follows:\r\n\r\n![image](https://user-images.githubusercontent.com/1311412/92696706-3a262600-f385-11ea-9aa8-db51cfa6fa25.png)\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3166/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3166/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3162", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3162/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3162/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3162/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3162", "id": 691469421, "node_id": "MDU6SXNzdWU2OTE0Njk0MjE=", "number": 3162, "title": "cross-site requests issue with jupyterhub on chrome", "user": {"login": "SonakshiGrover", "id": 16288623, "node_id": "MDQ6VXNlcjE2Mjg4NjIz", "avatar_url": "https://avatars.githubusercontent.com/u/16288623?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SonakshiGrover", "html_url": "https://github.com/SonakshiGrover", "followers_url": "https://api.github.com/users/SonakshiGrover/followers", "following_url": "https://api.github.com/users/SonakshiGrover/following{/other_user}", "gists_url": "https://api.github.com/users/SonakshiGrover/gists{/gist_id}", "starred_url": "https://api.github.com/users/SonakshiGrover/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SonakshiGrover/subscriptions", "organizations_url": "https://api.github.com/users/SonakshiGrover/orgs", "repos_url": "https://api.github.com/users/SonakshiGrover/repos", "events_url": "https://api.github.com/users/SonakshiGrover/events{/privacy}", "received_events_url": "https://api.github.com/users/SonakshiGrover/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2020-09-02T22:12:05Z", "updated_at": "2022-09-15T19:50:47Z", "closed_at": "2020-09-14T04:47:50Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML commments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n\r\nI am running jupyterhub with jupyterlab on an ec2 instance. I also have a website running at another machine wherein I am embedding my instance's url in an iframe. \r\n\r\nThe issue is that when I try to access Jupyterhub's directly from its url, it works on the Chrome and Firefox. But when I try to access Jupterhub via my website, it gives me the below 2 console messages on Chrome. \r\n\r\n**A cookie associated with a cross-site resource at url [of ec2 instance where jupyterhub is running] was set without the `SameSite` attribute. It has been blocked, as Chrome now only delivers cookies with cross-site requests if they are set with `SameSite=None` and `Secure`. You can review cookies in developer tools under Application>Storage>Cookies and see more details at [https://www.chromestatus.com/feature/5088147346030592](https://www.chromestatus.com/feature/5088147346030592) and [https://www.chromestatus.com/feature/5633521622188032](https://www.chromestatus.com/feature/5633521622188032)**\r\n\r\n**Blocked autofocusing on a form control in a cross-origin subframe [login:140]**\r\n\r\nOn Firefox it runs fine. \r\n\r\n### Options I tried but didn't work:_ \r\nLooked at some similar issues - [3117](https://github.com/jupyterhub/jupyterhub/issues/3117) and [1087](https://github.com/jupyterhub/jupyterhub/issues/1087)\r\n\r\nTried c.Spawner.args = ['--NotebookApp.allow_origin=*'], didn't work for me.\r\nAlso tried setting the 'samesite' attribute in jupyterhub_config.py but that somehow I am not able to use the correct python veriosn for it. I have both 3.6.11 and 3.8 installed on my system, but how do I make sure jupyterhub runs using the 3.8 python version? Can I somehow specify the /usr/bin/python3.8 while running `jupyterhub --config 'path' command`? \r\n### Versions \r\n\r\n- installed on the ec2 instance that's running jupyterhub\r\n\r\nPython - 3.6.11 \r\nJupyterhub - 2.2.2\r\n\r\n- browser\r\n\r\nChrome - 84\r\nFirefox - 80\r\n\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3162/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3162/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3158", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3158/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3158/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3158/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3158", "id": 686710414, "node_id": "MDU6SXNzdWU2ODY3MTA0MTQ=", "number": 3158, "title": "Missing documentation for endpoint  \u200b/users\u200b/{name}\u200b/servers\u200b/{server_name}.", "user": {"login": "synchronizing", "id": 2829082, "node_id": "MDQ6VXNlcjI4MjkwODI=", "avatar_url": "https://avatars.githubusercontent.com/u/2829082?v=4", "gravatar_id": "", "url": "https://api.github.com/users/synchronizing", "html_url": "https://github.com/synchronizing", "followers_url": "https://api.github.com/users/synchronizing/followers", "following_url": "https://api.github.com/users/synchronizing/following{/other_user}", "gists_url": "https://api.github.com/users/synchronizing/gists{/gist_id}", "starred_url": "https://api.github.com/users/synchronizing/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/synchronizing/subscriptions", "organizations_url": "https://api.github.com/users/synchronizing/orgs", "repos_url": "https://api.github.com/users/synchronizing/repos", "events_url": "https://api.github.com/users/synchronizing/events{/privacy}", "received_events_url": "https://api.github.com/users/synchronizing/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-08-26T22:39:31Z", "updated_at": "2020-08-26T23:09:08Z", "closed_at": "2020-08-26T23:09:08Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Bug description\r\nJupyterHub will not spawn a named-server if a certain number of characters is used for `{server_name}`. \r\n\r\n#### Expected behaviour\r\nEither proper documentation on the REST API, or a fix to allow any sized name for `{server_name}`. [Documentation reference](https://petstore.swagger.io/?url=https://raw.githubusercontent.com/jupyterhub/jupyterhub/master/docs/rest-api.yml#/default/post_users__name__servers__server_name_).\r\n\r\n#### Actual behaviour\r\n\r\n![Screen Shot 2020-08-26 at 6 34 35 PM](https://user-images.githubusercontent.com/2829082/91363534-d3244100-e7ca-11ea-9584-8a169f9f6850.png)\r\n\r\n### How to reproduce\r\n\r\nThe following code will not work:\r\n\r\n```python\r\nimport random\r\nimport hashlib\r\nimport requests\r\n\r\ndef random_md5_hash():\r\n    random_number = str(random.getrandbits(128)).encode()\r\n    return hashlib.md5(random_number).hexdigest()\r\n\r\nurl = \"\"\r\nuri = f\"http://{url}/hub/api\"\r\nheaders = {\"Authorization\": \"token <token>\"}\r\nname = random_md5_hash() # Variation of e607762dcff6494821cadcd6cce08eb3 (md5 hash). \r\nproject = random_md5_hash() \r\n\r\n# Queries user. If it does not exist, creates it.\r\nuser = requests.get(f\"{uri}/users/{name}\", headers=headers).json()\r\nif \"status\" in user and user[\"status\"] == 404:\r\n    user = requests.post(f\"{uri}/users/{name}\", headers=headers).json()\r\n\r\n# Creates notebook for the user to use.\r\nserver = requests.post(f\"{uri}/users/{name}/servers/{project}\", headers=headers).text\r\n\r\n# Prints the notebook URL.\r\nprint(f\"http://{url}/user/{name}/{project}/lab\")\r\n```\r\n\r\nHowever, the moment this line:\r\n\r\n```python\r\nproject = random_md5_hash() \r\n```\r\n\r\nis changed to:\r\n\r\n```python\r\nproject = \"1\"\r\n```\r\n\r\nWorks, and I am able to access the new user's named-server at the printed out URL (after logging in with bogus login).\r\n\r\n### Your personal set up\r\n\r\nJupyterHub + Kubernetes running on gCloud. Latest version according to Zero-to-JupyterHub tutorial (`0.9.0`). `config.yaml` looks like so:\r\n\r\n```yaml\r\n\r\n# JupyterHub specific configuration.\r\nhub:\r\n\r\n  # Key to sign cookies.\r\n  cookieSecret: 9ce41e753c9fd45aebeb5331c5264efb71143a3e5e9e04045a1bc4bdc48a6004\r\n\r\n  # Services that have access to JupyterHub API.\r\n  # Admin in the context of utilizing the JupyterHub RESTFul API.\r\n  services:\r\n    <service_name>:\r\n      admin: true\r\n      apiToken: <api_token>\r\n\r\n  # Extra configuration for JupyterHub.\r\n  extraConfig:\r\n    binder: |\r\n\r\n      # Disable webpage based login. Users are created via API only.\r\n      # c.JupyterHub.authenticator_class = 'nullauthenticator.NullAuthenticator'\r\n\r\n      # Allows users to have multiple notebooks.\r\n      c.JupyterHub.allow_named_servers = True\r\n\r\n# Authentication configuration for JupyterHub specifically.\r\n# Admin in the context of logging into the frontend portal.\r\nauth:\r\n  admin:\r\n    users:\r\n      - admin\r\n\r\n# Spawned Jupyter Notebook configuration.\r\nsingleuser:\r\n  defaultUrl: \"/lab\"\r\n\r\n# Kubernetes-JupyterHub integration configuration.\r\nproxy:\r\n  secretToken: <proxy_secret>\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3158/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3158/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3150", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3150/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3150/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3150/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3150", "id": 681509351, "node_id": "MDExOlB1bGxSZXF1ZXN0NDY5ODkxMDkx", "number": 3150, "title": "update prometheus metrics for server spawn when it fails with exception", "user": {"login": "yhal-nesi", "id": 52471469, "node_id": "MDQ6VXNlcjUyNDcxNDY5", "avatar_url": "https://avatars.githubusercontent.com/u/52471469?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yhal-nesi", "html_url": "https://github.com/yhal-nesi", "followers_url": "https://api.github.com/users/yhal-nesi/followers", "following_url": "https://api.github.com/users/yhal-nesi/following{/other_user}", "gists_url": "https://api.github.com/users/yhal-nesi/gists{/gist_id}", "starred_url": "https://api.github.com/users/yhal-nesi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yhal-nesi/subscriptions", "organizations_url": "https://api.github.com/users/yhal-nesi/orgs", "repos_url": "https://api.github.com/users/yhal-nesi/repos", "events_url": "https://api.github.com/users/yhal-nesi/events{/privacy}", "received_events_url": "https://api.github.com/users/yhal-nesi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-08-19T03:01:54Z", "updated_at": "2020-10-04T04:59:23Z", "closed_at": "2020-08-21T21:01:54Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3150", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3150", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3150.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3150.patch", "merged_at": "2020-08-21T21:01:54Z"}, "body": "When the spawner start() fails with exception, server_spawn_duration_seconds_bucket should be updated. ", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3150/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3150/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3148", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3148/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3148/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3148/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3148", "id": 680294361, "node_id": "MDU6SXNzdWU2ODAyOTQzNjE=", "number": 3148, "title": "Vulnerability report - directed to security@ipython.org", "user": {"login": "dchirikov", "id": 6017800, "node_id": "MDQ6VXNlcjYwMTc4MDA=", "avatar_url": "https://avatars.githubusercontent.com/u/6017800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dchirikov", "html_url": "https://github.com/dchirikov", "followers_url": "https://api.github.com/users/dchirikov/followers", "following_url": "https://api.github.com/users/dchirikov/following{/other_user}", "gists_url": "https://api.github.com/users/dchirikov/gists{/gist_id}", "starred_url": "https://api.github.com/users/dchirikov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dchirikov/subscriptions", "organizations_url": "https://api.github.com/users/dchirikov/orgs", "repos_url": "https://api.github.com/users/dchirikov/repos", "events_url": "https://api.github.com/users/dchirikov/events{/privacy}", "received_events_url": "https://api.github.com/users/dchirikov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-08-17T14:48:51Z", "updated_at": "2020-08-20T10:37:41Z", "closed_at": "2020-08-19T14:53:31Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Original post deleted\r\nThank you @dchirikov for reporting this vulnerability! Since it is a vulnerability report, I've deleted this public report of it. Do you want to submit it yourself like [described here](https://jupyterhub.readthedocs.io/en/stable/reference/websecurity.html#vulnerability-reporting) or would you like me to do it? I have saved a copy of your text etc. / @consideRatio", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3148/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3148/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3146", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3146/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3146/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3146/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3146", "id": 679895265, "node_id": "MDU6SXNzdWU2Nzk4OTUyNjU=", "number": 3146, "title": "500 error does not output error description", "user": {"login": "jgwerner", "id": 920170, "node_id": "MDQ6VXNlcjkyMDE3MA==", "avatar_url": "https://avatars.githubusercontent.com/u/920170?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jgwerner", "html_url": "https://github.com/jgwerner", "followers_url": "https://api.github.com/users/jgwerner/followers", "following_url": "https://api.github.com/users/jgwerner/following{/other_user}", "gists_url": "https://api.github.com/users/jgwerner/gists{/gist_id}", "starred_url": "https://api.github.com/users/jgwerner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jgwerner/subscriptions", "organizations_url": "https://api.github.com/users/jgwerner/orgs", "repos_url": "https://api.github.com/users/jgwerner/repos", "events_url": "https://api.github.com/users/jgwerner/events{/privacy}", "received_events_url": "https://api.github.com/users/jgwerner/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-08-17T02:50:55Z", "updated_at": "2020-09-07T14:18:22Z", "closed_at": "2020-09-07T14:18:22Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Bug description\r\n\r\nLaunching a single user notebook leads to a 500 error (as expected) if the user's server fails to authenticate with the JupyterHub. However, the error's description is not displayed due to an invalid key.\r\n\r\n#### Expected behavior\r\n\r\nDisplay the user error in the 500 error template page.\r\n\r\n<img width=\"857\" alt=\"500_error_with_message\" src=\"https://user-images.githubusercontent.com/920170/90351983-e8051580-e00f-11ea-8ece-90c4cacd1e97.png\">\r\n\r\n\r\n#### Actual behaviour\r\n\r\nGeneric 500 error.\r\n\r\n<img width=\"814\" alt=\"500_error_without_message\" src=\"https://user-images.githubusercontent.com/920170/90352007-fb17e580-e00f-11ea-8ed8-40a348194e6c.png\">\r\n\r\nAdditionally, the logs display `TypeError: can only concatenate str (not \"NoneType\") to str` since the key/value does not exist (None).\r\n\r\n### How to reproduce\r\n\r\nLaunch a single user notebook that has an unrecognized (invalid) client or token to get a `401` error.\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3146/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3146/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3144", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3144/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3144/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3144/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3144", "id": 679302303, "node_id": "MDU6SXNzdWU2NzkzMDIzMDM=", "number": 3144, "title": "Named Server names are not URL escaped", "user": {"login": "linhbngo", "id": 1529398, "node_id": "MDQ6VXNlcjE1MjkzOTg=", "avatar_url": "https://avatars.githubusercontent.com/u/1529398?v=4", "gravatar_id": "", "url": "https://api.github.com/users/linhbngo", "html_url": "https://github.com/linhbngo", "followers_url": "https://api.github.com/users/linhbngo/followers", "following_url": "https://api.github.com/users/linhbngo/following{/other_user}", "gists_url": "https://api.github.com/users/linhbngo/gists{/gist_id}", "starred_url": "https://api.github.com/users/linhbngo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/linhbngo/subscriptions", "organizations_url": "https://api.github.com/users/linhbngo/orgs", "repos_url": "https://api.github.com/users/linhbngo/repos", "events_url": "https://api.github.com/users/linhbngo/events{/privacy}", "received_events_url": "https://api.github.com/users/linhbngo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-08-14T17:36:10Z", "updated_at": "2022-06-03T15:09:58Z", "closed_at": "2022-06-03T15:09:58Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\nA user created a named server with a name that contains a whitespace, this caused a malformed URL and subsequently crashed jupyterhub when it runs add_route()\r\n\r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\nJupyterHub is able to communicated with all spawned JupyterServer\r\n\r\n\r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\nAlready started Jupyter servers remain running, but JupyterHub failed to restart. \r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\n1. Launch a Jupyter server as normal. \r\n2. Launch an additional named server with white space in name. \r\n\r\n### Your personal set up\r\n<!-- Tell us a little about the system you're using. -->\r\n\r\n - OS: CentOS 8.2\r\n <!-- [e.g. linux, OSX] -->\r\n - Version:\r\n <!-- e.g. jupyterhub --version. --->\r\n - Configuration:\r\n <!-- Be careful not to share any sensitive information. --->\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3144/reactions", "total_count": 3, "+1": 3, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3144/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3140", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3140/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3140/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3140/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3140", "id": 676277262, "node_id": "MDExOlB1bGxSZXF1ZXN0NDY1NjE3MDUx", "number": 3140, "title": "jupyterhub/utils: Load system default CA certificates in make_ssl_context", "user": {"login": "chancez", "id": 1400401, "node_id": "MDQ6VXNlcjE0MDA0MDE=", "avatar_url": "https://avatars.githubusercontent.com/u/1400401?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chancez", "html_url": "https://github.com/chancez", "followers_url": "https://api.github.com/users/chancez/followers", "following_url": "https://api.github.com/users/chancez/following{/other_user}", "gists_url": "https://api.github.com/users/chancez/gists{/gist_id}", "starred_url": "https://api.github.com/users/chancez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chancez/subscriptions", "organizations_url": "https://api.github.com/users/chancez/orgs", "repos_url": "https://api.github.com/users/chancez/repos", "events_url": "https://api.github.com/users/chancez/events{/privacy}", "received_events_url": "https://api.github.com/users/chancez/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-08-10T16:52:54Z", "updated_at": "2020-10-04T04:58:22Z", "closed_at": "2020-08-26T12:05:30Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3140", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3140", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3140.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3140.patch", "merged_at": "2020-08-26T12:05:30Z"}, "body": "Fixes issues with OAuth flows when internal_ssl is enabled.\r\nWhen internal_ssl was enabled requests to non-internal endpoints failed\r\nbecause the system CAs were not being loaded.\r\n\r\nThis caused failures with public OAuth providers with public CAs since\r\nthey would fail to validate.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3140/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3140/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3137", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3137/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3137/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3137/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3137", "id": 675358320, "node_id": "MDExOlB1bGxSZXF1ZXN0NDY0ODkxODU5", "number": 3137, "title": "admin page sorts on spawner last_activity instead of user last_activity", "user": {"login": "lydian", "id": 678485, "node_id": "MDQ6VXNlcjY3ODQ4NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/678485?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lydian", "html_url": "https://github.com/lydian", "followers_url": "https://api.github.com/users/lydian/followers", "following_url": "https://api.github.com/users/lydian/following{/other_user}", "gists_url": "https://api.github.com/users/lydian/gists{/gist_id}", "starred_url": "https://api.github.com/users/lydian/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lydian/subscriptions", "organizations_url": "https://api.github.com/users/lydian/orgs", "repos_url": "https://api.github.com/users/lydian/repos", "events_url": "https://api.github.com/users/lydian/events{/privacy}", "received_events_url": "https://api.github.com/users/lydian/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-08-07T23:56:31Z", "updated_at": "2020-10-04T04:57:52Z", "closed_at": "2020-09-07T14:14:12Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3137", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3137", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3137.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3137.patch", "merged_at": "2020-09-07T14:14:12Z"}, "body": "Currently the admin page last_activity is sorted on User's last activity, which makes it work odd because the column is actually showing the last_activity spawners.   This PR changed the sort column to be spawner's last activity. \r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3137/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3137/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3134", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3134/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3134/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3134/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3134", "id": 673795071, "node_id": "MDU6SXNzdWU2NzM3OTUwNzE=", "number": 3134, "title": "Spawner should stop on failed auth_state_hook", "user": {"login": "albertmichaelj", "id": 5385923, "node_id": "MDQ6VXNlcjUzODU5MjM=", "avatar_url": "https://avatars.githubusercontent.com/u/5385923?v=4", "gravatar_id": "", "url": "https://api.github.com/users/albertmichaelj", "html_url": "https://github.com/albertmichaelj", "followers_url": "https://api.github.com/users/albertmichaelj/followers", "following_url": "https://api.github.com/users/albertmichaelj/following{/other_user}", "gists_url": "https://api.github.com/users/albertmichaelj/gists{/gist_id}", "starred_url": "https://api.github.com/users/albertmichaelj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/albertmichaelj/subscriptions", "organizations_url": "https://api.github.com/users/albertmichaelj/orgs", "repos_url": "https://api.github.com/users/albertmichaelj/repos", "events_url": "https://api.github.com/users/albertmichaelj/events{/privacy}", "received_events_url": "https://api.github.com/users/albertmichaelj/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-08-05T19:32:40Z", "updated_at": "2022-05-25T10:43:40Z", "closed_at": "2022-05-25T10:43:40Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML commments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\nWhen a custom `auth_state_hook` is implemented for a spawner, and when the hook is executed, if an exception is raised, then spawning should stop. Currently if an exception is raised, it is logged, ignored, and the spawning continues. It seems to be due to [this part of the code](https://github.com/jupyterhub/jupyterhub/blob/b11c02c6e01531702e99d60317d5691999a0a4a6/jupyterhub/spawner.py#L1021)\r\n\r\n#### Expected behaviour\r\nSpawning should stop if the `auth_state_hook` raises an exception.\r\n\r\n#### Actual behaviour\r\nThe spawning continues.\r\n\r\n### How to reproduce\r\n``` python\r\ndef my_auth_state_hook(spawner, auth_state):\r\n    raise Exception()\r\n```\r\nThen in config set:\r\n``` python\r\nspawner.auth_state_hook = my_auth_state_hook\r\n```\r\n\r\n### Your personal set up\r\n\r\n - OS:\r\nLinux\r\n - Version:\r\n1.1.0\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3134/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3134/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3132", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3132/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3132/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3132/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3132", "id": 673239046, "node_id": "MDExOlB1bGxSZXF1ZXN0NDYzMTMzMDk3", "number": 3132, "title": "Fix the services dropdown on the admin page", "user": {"login": "pabepadu", "id": 45884742, "node_id": "MDQ6VXNlcjQ1ODg0NzQy", "avatar_url": "https://avatars.githubusercontent.com/u/45884742?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pabepadu", "html_url": "https://github.com/pabepadu", "followers_url": "https://api.github.com/users/pabepadu/followers", "following_url": "https://api.github.com/users/pabepadu/following{/other_user}", "gists_url": "https://api.github.com/users/pabepadu/gists{/gist_id}", "starred_url": "https://api.github.com/users/pabepadu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pabepadu/subscriptions", "organizations_url": "https://api.github.com/users/pabepadu/orgs", "repos_url": "https://api.github.com/users/pabepadu/repos", "events_url": "https://api.github.com/users/pabepadu/events{/privacy}", "received_events_url": "https://api.github.com/users/pabepadu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-08-05T04:13:43Z", "updated_at": "2020-10-04T04:57:16Z", "closed_at": "2020-08-06T21:13:37Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3132", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3132", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3132.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3132.patch", "merged_at": "2020-08-06T21:13:37Z"}, "body": "Fixes #3003 opened by @jtpio \r\nRemove the unused bootstrap variable which canceled the dropdown events.\r\nI tested the admin actions with different browsers, everything works fine.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3132/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3132/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3127", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3127/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3127/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3127/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3127", "id": 664769576, "node_id": "MDExOlB1bGxSZXF1ZXN0NDU1OTU1Mzky", "number": 3127, "title": "Don't log a warning when slow_spawn_timeout is disabled", "user": {"login": "mriedem", "id": 3237936, "node_id": "MDQ6VXNlcjMyMzc5MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/3237936?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mriedem", "html_url": "https://github.com/mriedem", "followers_url": "https://api.github.com/users/mriedem/followers", "following_url": "https://api.github.com/users/mriedem/following{/other_user}", "gists_url": "https://api.github.com/users/mriedem/gists{/gist_id}", "starred_url": "https://api.github.com/users/mriedem/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mriedem/subscriptions", "organizations_url": "https://api.github.com/users/mriedem/orgs", "repos_url": "https://api.github.com/users/mriedem/repos", "events_url": "https://api.github.com/users/mriedem/events{/privacy}", "received_events_url": "https://api.github.com/users/mriedem/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-07-23T21:14:05Z", "updated_at": "2020-10-04T04:56:03Z", "closed_at": "2020-07-31T10:07:39Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3127", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3127", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3127.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3127.patch", "merged_at": "2020-07-31T10:07:39Z"}, "body": "When using the `KubeSpawner` it is typical to disable the\r\n`slow_spawn_timeout` by setting it to 0. `zero-to-jupyterhub-k8s`\r\ndoes this by default [1]. However, this causes an immediate `TimeoutError`\r\nwhich gets logged as a warning like this:\r\n\r\n>User hub-stress-test-123 is slow to start (timeout=0)\r\n\r\nThis avoids the warning by checking the value and if disabled simply\r\nreturns without logging the warning.\r\n\r\n[1] https://github.com/jupyterhub/zero-to-jupyterhub-k8s/commit/b4738edc5\r\n\r\nCloses #3126", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3127/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3127/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3124", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3124/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3124/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3124/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3124", "id": 664238707, "node_id": "MDU6SXNzdWU2NjQyMzg3MDc=", "number": 3124, "title": "login -> do git commit from notebook -> logout -> login -> it gives 500 internal server error with LDAP authentication", "user": {"login": "madhusudhannr", "id": 59432587, "node_id": "MDQ6VXNlcjU5NDMyNTg3", "avatar_url": "https://avatars.githubusercontent.com/u/59432587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/madhusudhannr", "html_url": "https://github.com/madhusudhannr", "followers_url": "https://api.github.com/users/madhusudhannr/followers", "following_url": "https://api.github.com/users/madhusudhannr/following{/other_user}", "gists_url": "https://api.github.com/users/madhusudhannr/gists{/gist_id}", "starred_url": "https://api.github.com/users/madhusudhannr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/madhusudhannr/subscriptions", "organizations_url": "https://api.github.com/users/madhusudhannr/orgs", "repos_url": "https://api.github.com/users/madhusudhannr/repos", "events_url": "https://api.github.com/users/madhusudhannr/events{/privacy}", "received_events_url": "https://api.github.com/users/madhusudhannr/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-07-23T06:42:34Z", "updated_at": "2021-02-17T22:04:32Z", "closed_at": "2021-02-17T22:04:32Z", "author_association": "NONE", "active_lock_reason": null, "body": "Jul 22 05:57:23 testdata-80.bdlocal jupyterhub[1265]: [I 2020-07-22 05:57:23.402 JupyterHub login:43] User logged out: dev1\r\nJul 22 05:57:23 testdata-80.bdlocal jupyterhub[1265]: [I 2020-07-22 05:57:23.407 JupyterHub log:174] 302 GET /hub/logout -> /hub/login (@::ffff:172.18.0.6) 7.52ms\r\nJul 22 05:57:23 testdata-80.bdlocal jupyterhub[1265]: [I 2020-07-22 05:57:23.624 JupyterHub log:174] 200 GET /hub/login (@::ffff:172.18.0.6) 1.43ms\r\nJul 22 05:57:31 testdata-80.bdlocal jupyterhub[1265]: [I 2020-07-22 05:57:31.144 JupyterHub base:707] User logged in: dev1\r\nJul 22 05:57:31 testdata-80.bdlocal jupyterhub[1265]: [I 2020-07-22 05:57:31.145 JupyterHub log:174] 302 POST /hub/login?next= -> /user/dev1/ (dev1@::ffff:172.18.0.6) 195.44ms\r\nJul 22 05:57:31 testdata-80.bdlocal jupyterhub[1265]: [I 2020-07-22 05:57:31.366 SingleUserNotebookApp log:174] 302 GET /user/dev1/ -> /user/dev1/tree? (@::ffff:172.18.0.6) 0.69ms\r\nJul 22 05:57:31 testdata-80.bdlocal jupyterhub[1265]: [D 2020-07-22 05:57:31.586 SingleUserNotebookApp auth:501] No user identified\r\nJul 22 05:57:31 testdata-80.bdlocal jupyterhub[1265]: [D 2020-07-22 05:57:31.586 SingleUserNotebookApp auth:832] Redirecting to login url: /hub/api/oauth2/authorize?client_id=jupyterhub-user-dev1&redirect_uri=%2Fuser%2Fdev1%2Foauth_callback&response_type=code&state=eyJ1dWlkIjogImQ1NjExYWIyZTBlYjQ1MjU4MDExZTgyZjE5YWFiNGUyIiwgIm5leHRfdXJsIjogIi91c2VyL2RldjEvdHJlZT8ifQ\r\nJul 22 05:57:31 testdata-80.bdlocal jupyterhub[1265]: [I 2020-07-22 05:57:31.587 SingleUserNotebookApp log:174] 302 GET /user/dev1/tree? -> /hub/api/oauth2/authorize?client_id=jupyterhub-user-dev1&redirect_uri=%2Fuser%2Fdev1%2Foauth_callback&response_type=code&state=[secret] (@::ffff:172.18.0.6) 1.28ms\r\nJul 22 05:57:31 testdata-80.bdlocal jupyterhub[1265]: [I 2020-07-22 05:57:31.810 JupyterHub log:174] 302 GET /hub/api/oauth2/authorize?client_id=jupyterhub-user-dev1&redirect_uri=%2Fuser%2Fdev1%2Foauth_callback&response_type=code&state=[secret] -> /user/dev1/oauth_callback?code=[secret]&state=[secret] (dev1@::ffff:172.18.0.6) 9.10ms\r\nJul 22 05:57:32 testdata-80.bdlocal jupyterhub[1265]: [D 2020-07-22 05:57:32.024 SingleUserNotebookApp auth:501] No user identified\r\nJul 22 05:57:32 testdata-80.bdlocal jupyterhub[1265]: [E 2020-07-22 05:57:32.027 SingleUserNotebookApp auth:334] Error connecting to http://testdata-80.bdlocal:8081/hub/api: HTTPConnectionPool(host='\"http', port=80): Max retries exceeded with url: http://testdata-80.bdlocal:8081/hub/api/oauth2/token (Caused by ProxyError('Cannot connect to proxy.', NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f712b520290>: Failed to establish a new connection: [Errno -2] Name or service not known')))\r\nJul 22 05:57:32 testdata-80.bdlocal jupyterhub[1265]: [W 2020-07-22 05:57:32.027 SingleUserNotebookApp web:1786] 500 GET /user/dev1/oauth_callback?code=5NqRLtdgTH2u4WFu2xKrxbUdPL0R6x&state=eyJ1dWlkIjogImQ1NjExYWIyZTBlYjQ1MjU4MDExZTgyZjE5YWFiNGUyIiwgIm5leHRfdXJsIjogIi91c2VyL2RldjEvdHJlZT8ifQ (::ffff:172.18.0.6): Failed to connect to Hub API at 'http://testdata-80.bdlocal:8081/hub/api'.  Is the Hub accessible at this URL (from host: testdata-80.bdlocal)?\r\n\r\nSingleUserNotebookApp auth:334] Error connecting to /hub/api: HTTPConnectionPool(host='\"http', port=80): Max retries exceeded with url: /hub/api/oauth2/token  Failed to establish a new connection: [Errno -2] Name or service not known')))", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3124/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3124/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3123", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3123/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3123/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3123/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3123", "id": 664034446, "node_id": "MDExOlB1bGxSZXF1ZXN0NDU1MzQyNDM2", "number": 3123, "title": "app.py: Work around incompatibility between Tornado 6 and asyncio proactor event loop in python 3.8 on Windows", "user": {"login": "alexweav", "id": 8410871, "node_id": "MDQ6VXNlcjg0MTA4NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/8410871?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexweav", "html_url": "https://github.com/alexweav", "followers_url": "https://api.github.com/users/alexweav/followers", "following_url": "https://api.github.com/users/alexweav/following{/other_user}", "gists_url": "https://api.github.com/users/alexweav/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexweav/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexweav/subscriptions", "organizations_url": "https://api.github.com/users/alexweav/orgs", "repos_url": "https://api.github.com/users/alexweav/repos", "events_url": "https://api.github.com/users/alexweav/events{/privacy}", "received_events_url": "https://api.github.com/users/alexweav/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-07-22T20:37:24Z", "updated_at": "2020-10-04T04:55:36Z", "closed_at": "2020-08-10T07:18:25Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3123", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3123", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3123.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3123.patch", "merged_at": "2020-08-10T07:18:24Z"}, "body": "In py38, asyncio made the `WindowsProactorEventLoopPolicy` the default setting for event loops on Windows. However, this is incompatible with Tornado. The result is that the Hub does not start on Windows on Python 3.8, with a `NotImplementedError`. See tornadoweb/tornado#2608 for additional context. \r\n\r\nThe workaround suggested by Tornado is to use the older `WindowsSelectorEventLoopPolicy`, which is the default in py37 and before. This is done via:\r\n```\r\nasyncio.set_event_loop_policy(asyncio.WindowsSelectorEventLoopPolicy())\r\n```\r\n\r\nThis workaround has already been applied in the single-user server: jupyter/notebook#5047. The content of this PR is almost identical to the single-user one, save for some formatting differences. We only alter the default setting if we're running in an environment where this issue might occur (Windows, py38, and a sufficiently advanced asyncio API).", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3123/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3123/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3121", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3121/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3121/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3121/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3121", "id": 663561216, "node_id": "MDExOlB1bGxSZXF1ZXN0NDU0OTUxNTQz", "number": 3121, "title": "jupyterhub/user: clear spawner state after post_stop_hook", "user": {"login": "rkdarst", "id": 6877977, "node_id": "MDQ6VXNlcjY4Nzc5Nzc=", "avatar_url": "https://avatars.githubusercontent.com/u/6877977?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rkdarst", "html_url": "https://github.com/rkdarst", "followers_url": "https://api.github.com/users/rkdarst/followers", "following_url": "https://api.github.com/users/rkdarst/following{/other_user}", "gists_url": "https://api.github.com/users/rkdarst/gists{/gist_id}", "starred_url": "https://api.github.com/users/rkdarst/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rkdarst/subscriptions", "organizations_url": "https://api.github.com/users/rkdarst/orgs", "repos_url": "https://api.github.com/users/rkdarst/repos", "events_url": "https://api.github.com/users/rkdarst/events{/privacy}", "received_events_url": "https://api.github.com/users/rkdarst/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-07-22T08:04:33Z", "updated_at": "2020-10-04T04:55:03Z", "closed_at": "2020-09-08T14:38:19Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3121", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3121", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3121.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3121.patch", "merged_at": "2020-09-08T14:38:18Z"}, "body": "I'm submitting this more for discussion than I think it's a good idea, because it's easier to have something concrete to talk about than discussing abstractly.\r\n\r\n- Related issue: #3120.  Closes: #3120.\r\n\r\n- I realized that spawner.clear_state() is called before\r\n  spawner.post_stop_hook().  This caused was a bit surprising to me,\r\n  and caused some issues.\r\n\r\n- I tried the naive strategy of moving clear_state to later and\r\n  setting the orm_state to `{}` at the point where it used to be\r\n  clear.\r\n\r\n- This tries to maintain the exception behavior of clear_state and\r\n  post_stop_hook, but is exactly identical.\r\n\r\n- To review:\r\n\r\n  - Is this even a good idea!\r\n\r\n  - Carefully consider the implications of this.  I am not at all sure\r\n    about unintended side-effects or what intended semantics are.\r\n    Should the statements be re-ordered some other way?", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3121/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3121/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3120", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3120/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3120/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3120/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3120", "id": 663108710, "node_id": "MDU6SXNzdWU2NjMxMDg3MTA=", "number": 3120, "title": "Spawner state cleared before post_stop_hook", "user": {"login": "rkdarst", "id": 6877977, "node_id": "MDQ6VXNlcjY4Nzc5Nzc=", "avatar_url": "https://avatars.githubusercontent.com/u/6877977?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rkdarst", "html_url": "https://github.com/rkdarst", "followers_url": "https://api.github.com/users/rkdarst/followers", "following_url": "https://api.github.com/users/rkdarst/following{/other_user}", "gists_url": "https://api.github.com/users/rkdarst/gists{/gist_id}", "starred_url": "https://api.github.com/users/rkdarst/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rkdarst/subscriptions", "organizations_url": "https://api.github.com/users/rkdarst/orgs", "repos_url": "https://api.github.com/users/rkdarst/repos", "events_url": "https://api.github.com/users/rkdarst/events{/privacy}", "received_events_url": "https://api.github.com/users/rkdarst/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-07-21T15:31:10Z", "updated_at": "2020-09-08T14:38:18Z", "closed_at": "2020-09-08T14:38:18Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Bug description\r\nI have a complex `post_stop_hook` that is preserved via the spawner state.  Currently, spawner state is cleared, and then `post_stop_hook` gets invoked.  This was a bit of a surprise to me, and required me to do some debugging to figure out why this is.  Luckily the relevant code is easy to understand:\r\n\r\nhttps://github.com/jupyterhub/jupyterhub/blob/f3c3225124f1c5d9acb2503ec4d9c35a140f6a78/jupyterhub/user.py#L798-L829\r\n\r\n#### Expected behaviour\r\nI'd like to have that spawner state available at post_stop_hook time.  I guess for now I can hack around it in the hooks, but given how spawner objects are reused (I think that was the outcome of the last discussion...), not being able to rely on state or clean attributes make that harder.\r\n\r\n### Your personal set up\r\nLatest master on k8s.\r\n\r\n### Questions\r\nI know enough to be cautious when messing with state...\r\n* I can think of one solution is to set `spawner.orm_spawner.state = {}` and move the clear state to after post_stop_hook.  But, post_stop_hook isn't in the try/except block, so that changes the behavior when `.clear_state()` raises an exception.\r\n  * Currently this is `spawner.clear_state(); spawner.orm_spawner.state = spawner.get_state()` - but I wouldn't be surprised if someone relies on existing behavior!  \r\n  * This also assumes that `.clear_state()` sets state to `{}`!  I don't know what kinds of things that would mess up...\r\n\r\nI'd appreciate some expert advice before I go digging too deep into this... whatever my solution may be!\r\n\r\ncc @murhum1 @Gehock (our post_stop_hook can't get course_slug, so doesn't delete our tokens...)", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3120/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3120/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3119", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3119/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3119/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3119/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3119", "id": 663087694, "node_id": "MDU6SXNzdWU2NjMwODc2OTQ=", "number": 3119, "title": "docs: `jupyter troubleshooting` does not exist", "user": {"login": "mriedem", "id": 3237936, "node_id": "MDQ6VXNlcjMyMzc5MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/3237936?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mriedem", "html_url": "https://github.com/mriedem", "followers_url": "https://api.github.com/users/mriedem/followers", "following_url": "https://api.github.com/users/mriedem/following{/other_user}", "gists_url": "https://api.github.com/users/mriedem/gists{/gist_id}", "starred_url": "https://api.github.com/users/mriedem/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mriedem/subscriptions", "organizations_url": "https://api.github.com/users/mriedem/orgs", "repos_url": "https://api.github.com/users/mriedem/repos", "events_url": "https://api.github.com/users/mriedem/events{/privacy}", "received_events_url": "https://api.github.com/users/mriedem/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-07-21T15:03:29Z", "updated_at": "2022-05-25T09:18:35Z", "closed_at": "2022-05-25T09:18:35Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "\r\n### Bug description\r\nThis page [1] says you can run the `jupyter troubleshooting` command to get information about the deployment. However, that command does not exist. But `jupyterhub troubleshooting` does:\r\n\r\n```\r\njovyan@hub-7bbcd57db8-t2cr6:/$ which jupyter\r\njovyan@hub-7bbcd57db8-t2cr6:/$ which jupyterhub\r\n/usr/local/bin/jupyterhub\r\njovyan@hub-7bbcd57db8-t2cr6:/$ jupyterhub troubleshooting\r\n[I 2020-07-21 14:50:23.652 JupyterHub app:2295] Running JupyterHub version 1.2.0dev\r\n[I 2020-07-21 14:50:23.653 JupyterHub app:2326] Using Authenticator: jupyterhub.auth.PAMAuthenticator-1.2.0dev\r\n[I 2020-07-21 14:50:23.654 JupyterHub app:2326] Using Spawner: jupyterhub.spawner.LocalProcessSpawner-1.2.0dev\r\n[I 2020-07-21 14:50:23.654 JupyterHub app:2326] Using Proxy: jupyterhub.proxy.ConfigurableHTTPProxy-1.2.0dev\r\n[I 2020-07-21 14:50:23.665 JupyterHub app:1384] Loading cookie_secret from env[JPY_COOKIE_SECRET]\r\n[E 2020-07-21 14:50:23.672 JupyterHub app:1565] Failed to connect to db: sqlite:///jupyterhub.sqlite\r\n[E 2020-07-21 14:50:23.674 JupyterHub app:1369] jovyan cannot create files in /\r\n[C 2020-07-21 14:50:23.674 JupyterHub app:1574] If you recently upgraded JupyterHub, try running\r\n        jupyterhub upgrade-db\r\n    to upgrade your JupyterHub database schema\r\n```\r\n\r\nI'm not sure if that `jupyter troubleshooting` is a typo or if it used to exist, but it doesn't seem to work with jupyterhub at 8a3790b01ff944c453ffcc0486149e2a58ffabea.\r\n\r\nI'm trying to figure out a command to dump the effective application settings when our hub is running to make sure that changes to the config are reflected properly in the application since I don't see any config option to dump the settings on hub startup. I figured maybe the `troubleshooting` sub-command could help do that (I'm also having a hard time figuring out where that sub-command is even defined within the jupyterhub code, but that's a different issue).\r\n\r\n[1] https://jupyterhub.readthedocs.io/en/latest/troubleshooting.html#troubleshooting-commands\r\n\r\n#### Expected behaviour\r\nThe docs should be accurate.\r\n\r\n#### Actual behaviour\r\nThe docs are inaccurate, as far as I can tell anyway.\r\n\r\n### How to reproduce\r\nRun `jupyter troubleshooting` against your hub pod and you get an error:\r\n\r\n```\r\njovyan@hub-7bbcd57db8-t2cr6:/$ jupyter troubleshooting\r\nbash: jupyter: command not found\r\n```\r\n\r\n### Your personal set up\r\nUsing z2jh to deploy the hub and our hub image is using commit 8a3790b01ff944c453ffcc0486149e2a58ffabea.\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3119/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3119/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3112", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3112/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3112/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3112/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3112", "id": 654972761, "node_id": "MDU6SXNzdWU2NTQ5NzI3NjE=", "number": 3112, "title": "Documentation: Setting up users\u2019 own conda environments", "user": {"login": "viniciusferrao", "id": 2031761, "node_id": "MDQ6VXNlcjIwMzE3NjE=", "avatar_url": "https://avatars.githubusercontent.com/u/2031761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/viniciusferrao", "html_url": "https://github.com/viniciusferrao", "followers_url": "https://api.github.com/users/viniciusferrao/followers", "following_url": "https://api.github.com/users/viniciusferrao/following{/other_user}", "gists_url": "https://api.github.com/users/viniciusferrao/gists{/gist_id}", "starred_url": "https://api.github.com/users/viniciusferrao/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/viniciusferrao/subscriptions", "organizations_url": "https://api.github.com/users/viniciusferrao/orgs", "repos_url": "https://api.github.com/users/viniciusferrao/repos", "events_url": "https://api.github.com/users/viniciusferrao/events{/privacy}", "received_events_url": "https://api.github.com/users/viniciusferrao/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-07-10T18:50:45Z", "updated_at": "2022-05-22T14:20:36Z", "closed_at": "2022-05-22T14:20:36Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML commments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\nThe documentation about installation per user is a little bit hard to understand for those who aren't familiar with the software and the Python environments scheme.\r\n\r\nSpecifically the multi-user support with Conda: https://jupyterhub.readthedocs.io/en/stable/installation-guide-hard.html#part-2-conda-environments\r\n\r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\nWould be able to follow up the installation procedures and everything works at the end.\r\n\r\n#### Actual behaviour\r\n<!-- Tell us what actually happens. -->\r\nThe instructions are misleading so the expected results are missing, probably due to changes that aren't mapped. In my case the system is defaulting to /usr/local even without specifying it. For example:\r\n\r\n(base)$ /opt/jupyterhub/bin/python -m ipykernel install --name 'meu-paitom' --display-name \"Meu Paitom\"\r\n[Errno 13] Permission denied: '/usr/local/share/jupyter/kernels/meu-paitom'\r\n\r\nThis is following strictly the guidelines on the installation instructions.\r\n\r\n(base)$ /opt/jupyterhub/bin/python -m ipykernel install --name 'meu-paitom' --display-name \"Meu Paitom\" --sys-prefix\r\n[Errno 13] Permission denied: '/opt/jupyterhub/share/jupyter/kernels/meu-paitom'\r\n\r\nHere I've tried to change it a little but is doesn't behave as expected.\r\n\r\nI understood that it should create the environment on my home folder and not on /opt or /usr/local. So it's missing some information here, and I was unable to proceed.\r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\nJust follow the instructions on: https://jupyterhub.readthedocs.io/en/stable/installation-guide-hard.html#part-2-conda-environments\r\n\r\n### Your personal set up\r\n<!-- Tell us a little about the system you're using. -->\r\n\r\n - OS:\r\nCentOS Linux 8.2\r\n - Version:\r\n[root@jupyter kernels]# source /opt/jupyterhub/bin/activate\r\n(jupyterhub) [root@jupyter kernels]# pip list\r\nPackage            Version  \r\n------------------ ---------\r\nalembic            1.4.2    \r\nasync-generator    1.10     \r\nattrs              19.3.0   \r\nbackcall           0.2.0    \r\nbleach             3.1.5    \r\ncertifi            2020.6.20\r\ncertipy            0.1.3    \r\ncffi               1.14.0   \r\nchardet            3.0.4    \r\ncryptography       2.9.2    \r\ndecorator          4.4.2    \r\ndefusedxml         0.6.0    \r\nentrypoints        0.3      \r\nidna               2.10     \r\nipykernel          5.3.0    \r\nipython            7.16.1   \r\nipython-genutils   0.2.0    \r\nipywidgets         7.5.1    \r\njedi               0.17.1   \r\nJinja2             2.11.2   \r\njson5              0.9.5    \r\njsonschema         3.2.0    \r\njupyter-client     6.1.5    \r\njupyter-core       4.6.3    \r\njupyter-telemetry  0.1.0    \r\njupyterhub         1.1.0    \r\njupyterlab         2.1.5    \r\njupyterlab-server  1.1.5    \r\nMako               1.1.3    \r\nMarkupSafe         1.1.1    \r\nmistune            0.8.4    \r\nnbconvert          5.6.1    \r\nnbformat           5.0.7    \r\nnotebook           6.0.3    \r\noauthlib           3.1.0    \r\npackaging          20.4     \r\npamela             1.0.0    \r\npandocfilters      1.4.2    \r\nparso              0.7.0    \r\npexpect            4.8.0    \r\npickleshare        0.7.5    \r\npip                19.2.3   \r\nprometheus-client  0.8.0    \r\nprompt-toolkit     3.0.5    \r\nptyprocess         0.6.0    \r\npycparser          2.20     \r\nPygments           2.6.1    \r\npyOpenSSL          19.1.0   \r\npyparsing          2.4.7    \r\npyrsistent         0.16.0   \r\npython-dateutil    2.8.1    \r\npython-editor      1.0.4    \r\npython-json-logger 0.1.11   \r\npyzmq              19.0.1   \r\nrequests           2.24.0   \r\nruamel.yaml        0.16.10  \r\nruamel.yaml.clib   0.2.0    \r\nSend2Trash         1.5.0    \r\nsetuptools         41.6.0   \r\nsix                1.15.0   \r\nSQLAlchemy         1.3.18   \r\nterminado          0.8.3    \r\ntestpath           0.4.4    \r\ntornado            6.0.4    \r\ntraitlets          4.3.3    \r\nurllib3            1.25.9   \r\nwcwidth            0.2.5    \r\nwebencodings       0.5.1    \r\nwheel              0.34.2   \r\nwidgetsnbextension 3.5.1    \r\nWARNING: You are using pip version 19.2.3, however version 20.1.1 is available.\r\nYou should consider upgrading via the 'pip install --upgrade pip' command.\r\n\r\n - Configuration:\r\nPretty default, nothing changed from the guide.\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3112/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3112/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3109", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3109/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3109/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3109/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3109", "id": 651782380, "node_id": "MDExOlB1bGxSZXF1ZXN0NDQ0OTcxNzQ1", "number": 3109, "title": "fix for stopping named server deleting default server and tests", "user": {"login": "kxiao-fn", "id": 66144817, "node_id": "MDQ6VXNlcjY2MTQ0ODE3", "avatar_url": "https://avatars.githubusercontent.com/u/66144817?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kxiao-fn", "html_url": "https://github.com/kxiao-fn", "followers_url": "https://api.github.com/users/kxiao-fn/followers", "following_url": "https://api.github.com/users/kxiao-fn/following{/other_user}", "gists_url": "https://api.github.com/users/kxiao-fn/gists{/gist_id}", "starred_url": "https://api.github.com/users/kxiao-fn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kxiao-fn/subscriptions", "organizations_url": "https://api.github.com/users/kxiao-fn/orgs", "repos_url": "https://api.github.com/users/kxiao-fn/repos", "events_url": "https://api.github.com/users/kxiao-fn/events{/privacy}", "received_events_url": "https://api.github.com/users/kxiao-fn/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-07-06T19:55:04Z", "updated_at": "2020-10-04T04:53:30Z", "closed_at": "2020-07-07T12:41:43Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3109", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3109", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3109.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3109.patch", "merged_at": "2020-07-07T12:41:43Z"}, "body": "Fix for #3060 \r\nEdited the offending line as suggested by @jeevb and added the corresponding test in `test_named_servers.py`", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3109/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3109/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3106", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3106/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3106/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3106/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3106", "id": 650608135, "node_id": "MDU6SXNzdWU2NTA2MDgxMzU=", "number": 3106, "title": "PAM Auth using SSSD not creating home directories upon login for new users", "user": {"login": "whositwhatnow", "id": 22056604, "node_id": "MDQ6VXNlcjIyMDU2NjA0", "avatar_url": "https://avatars.githubusercontent.com/u/22056604?v=4", "gravatar_id": "", "url": "https://api.github.com/users/whositwhatnow", "html_url": "https://github.com/whositwhatnow", "followers_url": "https://api.github.com/users/whositwhatnow/followers", "following_url": "https://api.github.com/users/whositwhatnow/following{/other_user}", "gists_url": "https://api.github.com/users/whositwhatnow/gists{/gist_id}", "starred_url": "https://api.github.com/users/whositwhatnow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/whositwhatnow/subscriptions", "organizations_url": "https://api.github.com/users/whositwhatnow/orgs", "repos_url": "https://api.github.com/users/whositwhatnow/repos", "events_url": "https://api.github.com/users/whositwhatnow/events{/privacy}", "received_events_url": "https://api.github.com/users/whositwhatnow/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-07-03T13:46:17Z", "updated_at": "2020-07-15T13:47:40Z", "closed_at": "2020-07-15T13:47:40Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\nNew users home directories are not being created on user login\r\n\r\n#### Expected behaviour\r\nNew users login and home directories get automatically created once the spawning occurs\r\n\r\n#### Actual behaviour\r\nUsers authentication works but home directories are not created.  Get error below.  If the home directory is created prior to login then it works.\r\n\r\nJul  3 09:37:22 jupyterhub jupyterhub: [I 2020-07-03 09:37:22.647 JupyterHub base:707] User logged in: newuser\r\nJul  3 09:37:22 jupyterhub jupyterhub: [I 2020-07-03 09:37:22.652 JupyterHub log:174] 302 POST /hub/login?next= -> /hub/spawn (newuser@1.1.1.1) 363.10ms\r\nJul  3 09:37:22 jupyterhub jupyterhub: [I 2020-07-03 09:37:22.734 JupyterHub systemdspawner:217] user:newuser Unit jupyter-newuser-singleuser in a failed state. Resetting state.\r\nJul  3 09:37:22 jupyterhub jupyterhub: Running as unit jupyter-newuser-singleuser.service.\r\nJul  3 09:37:22 jupyterhub systemd: Started /bin/bash -c cd /home/newuser && exec jupyterhub-singleuser --port=42734.\r\nJul  3 09:37:22 jupyterhub bash: /bin/bash: line 0: cd: /home/newuser: No such file or directory\r\nJul  3 09:37:22 jupyterhub systemd: jupyter-newuser-singleuser.service: main process exited, code=exited, status=1/FAILURE\r\nJul  3 09:37:22 jupyterhub systemd: Unit jupyter-newuser-singleuser.service entered failed state.\r\nJul  3 09:37:22 jupyterhub systemd: jupyter-newuser-singleuser.service failed.\r\n\r\n- OS: CentOS Linux release 7.8.2003 (Core)\r\n- Jupyterhub Version: 1.1.0\r\n- SystemdSpawner\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3106/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3106/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3105", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3105/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3105/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3105/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3105", "id": 649308066, "node_id": "MDU6SXNzdWU2NDkzMDgwNjY=", "number": 3105, "title": "TLJH: reload command loops forever, caused by a Python 'hook' script in .../jupyterhub_config.d/", "user": {"login": "nmvega", "id": 4001382, "node_id": "MDQ6VXNlcjQwMDEzODI=", "avatar_url": "https://avatars.githubusercontent.com/u/4001382?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nmvega", "html_url": "https://github.com/nmvega", "followers_url": "https://api.github.com/users/nmvega/followers", "following_url": "https://api.github.com/users/nmvega/following{/other_user}", "gists_url": "https://api.github.com/users/nmvega/gists{/gist_id}", "starred_url": "https://api.github.com/users/nmvega/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nmvega/subscriptions", "organizations_url": "https://api.github.com/users/nmvega/orgs", "repos_url": "https://api.github.com/users/nmvega/repos", "events_url": "https://api.github.com/users/nmvega/events{/privacy}", "received_events_url": "https://api.github.com/users/nmvega/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-07-01T20:44:44Z", "updated_at": "2020-07-01T21:05:59Z", "closed_at": "2020-07-01T21:05:59Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hello Friends:\r\n\r\nThis `tljh-config reload` command loops forever, caused by the `Python` script `02-preSpawn-hook.py` pasted further below (which is a `hook` script).\r\n\r\n```\r\nroot@rndbox# /opt/tljh/hub/bin/tljh-config reload\r\n  active\r\n  /opt/tljh/hub/lib/python3.6/site-packages/urllib3/connectionpool.py:986:\r\n  InsecureRequestWarning: Unverified HTTPS request is being made to host '127.0.0.1'.\r\n  Adding certificate verification is strongly advised.\r\n  See: https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings\r\n  InsecureRequestWarning,\r\n[ ... the above repeats forever ... ]\r\n```\r\n\r\nHere is the setup:\r\n\r\n```\r\nroot@rndbox# pwd\r\n/opt/tljh/config\r\n\r\nroot@rndbox# ls -la\r\ntotal 24\r\ndrwx------ 5 root root 4096 Jul  1 19:52 .\r\ndrwxr-xr-x 6 root root 4096 Jun 27 04:18 ..\r\n-r-------- 1 root root  878 Jun 27 04:18 config.yaml\r\ndrwx------ 3 root root 4096 Jul  1 20:18 jupyterhub_config.d/ <--- Hooks directory.\r\ndrwx------ 2 root root 4096 Jun 27 04:00 ssl.d/\r\ndrwx------ 2 root root 4096 Jun 27 04:21 traefik_config.d/\r\n\r\nroot@rndbox# ls -la ./jupyterhub_config.d/\r\ntotal 32\r\ndrwx------ 3 root root 4096 Jul  1 20:18 .\r\ndrwx------ 5 root root 4096 Jul  1 19:52 ..\r\n-r-x------ 1 root root  135 Jun 27 04:00 00-set-JupyterHub-defaults.py\r\n-r-x------ 1 root root  532 Jun 27 04:00 01-set-GitLab-env.py\r\n-r-x------ 1 root root 3059 Jul  1 20:18 02-preSpawn-hook.py  <-- When removed, reload succeeds.\r\n```\r\n\r\nAnd the offending script (below), which when removed allows `reload` to succeed. When I comment out `c.Spawner.pre_spawn_hook = preSpawn_hook` to test the script manually, it works perfectly (after which I remove the comment, of course).\r\n\r\nSo some check that `reload` performs doesn't accept this script:\r\n\r\n```\r\nimport yaml, os, shutil, uuid\r\n\r\ndef start_vsCode(unix_username):\r\n    \"\"\" Creates ~/.config/code-server/config.yaml file for unix_username. \"\"\"\r\n    # ==================================================================\r\n    # Search /etc/passwd for UNIX user in sys.argv[1]. If user doesn't\r\n    # exist, a VScode-IDE daemon won't launch, but a JupyterHub-IDE\r\n    # session will still launch normally.\r\n    # ==================================================================\r\n    (user, x, uid, gid, gecos, homedir, shell) = (None,)*7\r\n    with open('/etc/passwd', 'r') as f:\r\n        for line in f:\r\n            if not line.startswith(unix_username + ':'): continue\r\n            (user, x, uid, gid, gecos, homedir, shell) = line.split(':')\r\n            break\r\n        if not user:\r\n            print('WARN: VScode daemon not started. Unix user does not exist: %s' % unix_username)\r\n            return\r\n    # ==================================================================\r\n\r\n    # ==================================================================\r\n    # If `~/.config/code-server/config.yaml` doesn't exist; -OR- it\r\n    # exists has a key(s) missing; or has a value(s) of None (null);\r\n    # the create a fully working file ...\r\n    # ==================================================================\r\n    skel_config_file = '/etc/skel/.config/code-server/config.yaml'\r\n    config_file_dir = homedir + '/.config/code-server/'\r\n    config_file = config_file_dir + '/config.yaml'\r\n    #\r\n    if not os.path.exists(config_file): # No file. Seed w/ 'skel'.\r\n        shutil.copy2(skel_config_file, config_file_dir)\r\n        os.chown(config_file, int(uid), int(gid))\r\n        os.chmod(config_file, 0o640)\r\n\r\n    with open(skel_config_file, 'r') as f: # Get expected keys from 'skel'.\r\n        skel_keys = yaml.load(f, Loader=yaml.FullLoader).keys() # dict_keys([])\r\n        skel_keys = set(skel_keys)\r\n\r\n    with open(config_file, 'r') as f: # File existed or now has 'skel' version.\r\n        doc = yaml.load(f, Loader=yaml.FullLoader) # A dict()\r\n        doc_keys = set(doc.keys())\r\n        doc_values = doc.values()\r\n\r\n    if skel_keys.difference(doc_keys) or None in doc_values:\r\n        doc['password'] = str(uuid.uuid4()).replace('-','')\r\n        doc['bind-addr'] = '0.0.0.0:' + str(uid)\r\n        doc['proxy-domain'] = str(uid) + '.vscode.rndbox.io'\r\n        with open(config_file, 'w') as f:\r\n            yaml.dump(doc, f, sort_keys=True)\r\n    return\r\n# ===============================================================\r\n\r\n\r\n# ===============================================================\r\n# SEE: https://github.com/jupyterhub/systemdspawner\r\n# ===============================================================\r\ndef preSpawn_hook(spawner):\r\n    username = spawner.user.name           # JupyterHub username.\r\n    unix_username = 'jupyter-' + username  # UNIX username created by JupyterHub systemdSpawner.\r\n    start_vsCode(unix_username)\r\n# ===============================================================\r\nc.Spawner.pre_spawn_hook = preSpawn_hook\r\n# ===============================================================\r\n```\r\n\r\nAny ideas?\r\n\r\nThank you in advance! =:)", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3105/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3105/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3103", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3103/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3103/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3103/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3103", "id": 644329928, "node_id": "MDExOlB1bGxSZXF1ZXN0NDM4OTcwODY0", "number": 3103, "title": "Hide hamburger button menu in mobile/responsive mode and fix other minor issues", "user": {"login": "kinow", "id": 304786, "node_id": "MDQ6VXNlcjMwNDc4Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/304786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kinow", "html_url": "https://github.com/kinow", "followers_url": "https://api.github.com/users/kinow/followers", "following_url": "https://api.github.com/users/kinow/following{/other_user}", "gists_url": "https://api.github.com/users/kinow/gists{/gist_id}", "starred_url": "https://api.github.com/users/kinow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kinow/subscriptions", "organizations_url": "https://api.github.com/users/kinow/orgs", "repos_url": "https://api.github.com/users/kinow/repos", "events_url": "https://api.github.com/users/kinow/events{/privacy}", "received_events_url": "https://api.github.com/users/kinow/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 106589225, "node_id": "MDU6TGFiZWwxMDY1ODkyMjU=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/enhancement", "name": "enhancement", "color": "84b6eb", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-06-24T05:29:14Z", "updated_at": "2020-10-04T04:52:37Z", "closed_at": "2020-08-27T09:15:51Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3103", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3103", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3103.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3103.patch", "merged_at": "2020-08-27T09:15:51Z"}, "body": "Closes #2182 \r\n\r\nI think for #2182 we can simply hide the hamburger menu when there's no `user` variable set? The menu that goes under that hamburger menu [appears to be filled only when there is a `user` set](https://github.com/jupyterhub/jupyterhub/blob/dbc6998375dd8251d196863425b26adc814624cd/share/jupyterhub/templates/page.html#L118), so that would match it I think.\r\n\r\nSo the login page would look like this on mobile:\r\n\r\n![image](https://user-images.githubusercontent.com/304786/85503975-16cdc380-b63f-11ea-95f9-4f2ab5f739c0.png)\r\n\r\n---\r\n\r\nAnother issue that I noticed is that the JupyterHub icon doesn't have a left margin, as the hamburger button menu has on its right hand-side.\r\n\r\n![image](https://user-images.githubusercontent.com/304786/85503999-2a792a00-b63f-11ea-8ebd-db8d7326a83b.png)\r\n\r\nAdded a commit that adds the same margin, using a Bootstrap variable, but only when in mobile mode. That's because the `container-fluid` class appears to be doing the trick when not in mobile, so simply adding it would add the margin twice.\r\n\r\n![image](https://user-images.githubusercontent.com/304786/85504087-5694ab00-b63f-11ea-861c-0b7bbb806dd9.png)\r\n\r\n![GIFrecord_2020-06-24_155738](https://user-images.githubusercontent.com/304786/85504204-a1aebe00-b63f-11ea-8b61-4e3c7081d783.gif)\r\n\r\n---\r\n\r\nAnd clicking on the hamburger menu when logged in, displays the user name and the logout button without left padding/margin.\r\n\r\n![image](https://user-images.githubusercontent.com/304786/85504345-f2beb200-b63f-11ea-812b-c39be7289c1a.png)\r\n\r\n\r\nThat's because Bootstrap adds it to `.nav > li > a`, but for the user name and button, we have both under `.nav > li > span`. Added the same values as Bootstrap for `.nav > li > a`, but again only in responsive mode, as in desktop mode it displays everything in horizontal/inline mode.\r\n\r\nFinal version with the changes in this PR:\r\n\r\n![GIFrecord_2020-06-24_171210](https://user-images.githubusercontent.com/304786/85504209-a4a9ae80-b63f-11ea-95a1-492b84dde65a.gif)\r\n\r\nTo review, it's possible to check out this branch/PR, then run `python setup.py css` to re-compile the less styles, then run `jupyterhub`.\r\n\r\nCheers\r\nBruno", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3103/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3103/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3095", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3095/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3095/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3095/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3095", "id": 640932379, "node_id": "MDU6SXNzdWU2NDA5MzIzNzk=", "number": 3095, "title": "node_selector ignored after failed spawn", "user": {"login": "romanzac", "id": 28704247, "node_id": "MDQ6VXNlcjI4NzA0MjQ3", "avatar_url": "https://avatars.githubusercontent.com/u/28704247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/romanzac", "html_url": "https://github.com/romanzac", "followers_url": "https://api.github.com/users/romanzac/followers", "following_url": "https://api.github.com/users/romanzac/following{/other_user}", "gists_url": "https://api.github.com/users/romanzac/gists{/gist_id}", "starred_url": "https://api.github.com/users/romanzac/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/romanzac/subscriptions", "organizations_url": "https://api.github.com/users/romanzac/orgs", "repos_url": "https://api.github.com/users/romanzac/repos", "events_url": "https://api.github.com/users/romanzac/events{/privacy}", "received_events_url": "https://api.github.com/users/romanzac/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-06-18T05:59:13Z", "updated_at": "2020-06-18T19:14:46Z", "closed_at": "2020-06-18T19:14:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Bug description\r\nHello, I have a problem with behavior related to node_selector. \r\n\r\n1) When I first request a server with GPU and GPU resource is not available, spawn process will timeout/fail. This is expected.\r\n2) When I try again to select profile without GPU requirement, my spawn process fails again even thou there are servers with resources available. \r\n\r\n-----\r\nYour server is starting up.\r\n\r\nYou will be redirected automatically when it's ready for you.\r\n\r\n100% Complete\r\nSpawn failed: pod/jupyter-arc did not start in 30 seconds!\r\n\r\nEvent log\r\nServer requested\r\n2020-06-18 05:43:14+00:00 [Warning] 0/9 nodes are available: 4 Insufficient nvidia.com/gpu, 5 node(s) didn't match node selector.\r\nSpawn failed: pod/jupyter-arc did not start in 30 seconds!\r\n----\r\n\r\n \r\n#### Expected behaviour\r\n<!-- Tell us what you thought would happen. -->\r\nI wish user who cannot spawn server due to resource constraints could still spawn another server (to do something else) and wait till resource would be released.\r\n\r\n\r\n### Your personal set up\r\nKubernetes: 1.16.6\r\ndeployed\tjupyterhub-0.9.0  version          \t1.1.0\r\n\r\n - Configuration:\r\nprofileList:\r\n    - display_name: \"Bioinformatics Environment\"\r\n      description: \"Sample Jupyter notebooks and necessary tools for bioinformatics.\"\r\n      default: true\r\n      kubespawner_override:\r\n        image: registry:8443/bioinf-jupyter-k8s:1.0.17\r\n        node_selector:\r\n          podGroup: \"cpu-compute\"\r\n            \r\n    - display_name: \"Bioinformatics Environment 1x GPU\"\r\n      description: \"Sample Jupyter notebooks and necessary tools for bioinformatics - GPU support.\"\r\n      kubespawner_override:\r\n        image: registry:8443/bioinf-jupyter-k8s-gpu:1.0.1\r\n        node_selector:\r\n          qpodGroup: \"gpu-compute\"\r\n        extra_resource_limits:\r\n          nvidia.com/gpu: \"1\"\r\n \r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3095/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3095/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3094", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3094/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3094/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3094/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3094", "id": 640924959, "node_id": "MDU6SXNzdWU2NDA5MjQ5NTk=", "number": 3094, "title": "Jupyterhub spawn fails - tornado.web.HTTPError: HTTP 500: Internal Server Error", "user": {"login": "mvignesh1990", "id": 13062624, "node_id": "MDQ6VXNlcjEzMDYyNjI0", "avatar_url": "https://avatars.githubusercontent.com/u/13062624?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mvignesh1990", "html_url": "https://github.com/mvignesh1990", "followers_url": "https://api.github.com/users/mvignesh1990/followers", "following_url": "https://api.github.com/users/mvignesh1990/following{/other_user}", "gists_url": "https://api.github.com/users/mvignesh1990/gists{/gist_id}", "starred_url": "https://api.github.com/users/mvignesh1990/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mvignesh1990/subscriptions", "organizations_url": "https://api.github.com/users/mvignesh1990/orgs", "repos_url": "https://api.github.com/users/mvignesh1990/repos", "events_url": "https://api.github.com/users/mvignesh1990/events{/privacy}", "received_events_url": "https://api.github.com/users/mvignesh1990/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-06-18T05:42:58Z", "updated_at": "2020-06-18T19:15:59Z", "closed_at": "2020-06-18T19:15:59Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML commments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\n<!-- Use this section to clearly and concisely describe the bug. -->\r\nI have installed jupyter hub development install using the following documentation:\r\nhttps://jupyterhub.readthedocs.io/en/stable/contributing/setup.html\r\n\r\nThe python3 installed is a python alt install and not a virtual env via conda. When I start the hub in a conda environment, i am able to login, do a notebook server spawn and perform python operations.\r\nIn the python3 alt install env, when i start the hub, the spawn fails with the following error:\r\nERROR:asyncio:Task exception was never retrieved\r\nfuture: <Task finished coro=<BaseHandler.spawn_single_user() done, defined at /home/myuser/jupyterhub/jupyterhub/handlers/base.py:741> exception=HTTPError()>\r\nTraceback (most recent call last):\r\n  File \"/home/myuser/jupyterhub/jupyterhub/handlers/base.py\", line 939, in spawn_single_user\r\n    timedelta(seconds=self.slow_spawn_timeout), finish_spawn_future\r\ntornado.util.TimeoutError: Timeout\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/myuser/jupyterhub/jupyterhub/handlers/base.py\", line 972, in spawn_single_user\r\n    % (status, spawner._log_name),\r\ntornado.web.HTTPError: HTTP 500: Internal Server Error (Spawner failed to start [status=1]. The logs for admin may contain details.)\r\n^C[C 2020-06-17 19:12:32.290 JupyterHub app:2739] Received signal SIGINT, initiating shutdown...\r\n[E 2020-06-17 19:12:32.292 JupyterHub user:706] Unhandled error waiting for admin's server to show up at http://127.0.0.1:60014/user/admin/:\r\n[E 2020-06-17 19:12:32.330 JupyterHub web:1792] Uncaught exception GET /hub/api/users/admin/server/progress (10.61.51.140)\r\n    HTTPServerRequest(protocol='http', host='10.64.17.14:8080', method='GET', uri='/hub/api/users/admin/server/progress', version='HTTP/1.1', remote_ip='10.61.51.140')\r\n    Traceback (most recent call last):\r\n      File \"/home/myuser/.local/lib/python3.6/site-packages/tornado/web.py\", line 1703, in _execute\r\n        result = await result\r\n      File \"/home/myuser/jupyterhub/jupyterhub/apihandlers/users.py\", line 604, in get\r\n        await asyncio.wait([spawn_future])\r\n      File \"/usr/lib64/python3.6/asyncio/tasks.py\", line 313, in wait\r\n        return (yield from _wait(fs, timeout, return_when, loop))\r\n      File \"/usr/lib64/python3.6/asyncio/tasks.py\", line 396, in _wait\r\n        yield from waiter\r\n    concurrent.futures._base.CancelledError\r\n\r\n\r\n#### Expected behaviour\r\nJupyterhub should be able to spawn the single-user servers.\r\n\r\n#### Actual behaviour\r\nSpawn fails with the above error.\r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\nInstall jupyterhub on python3 alt install env.\r\nStart jupyterhub as: jupyterhub --ip <ip> --port <port> -f jupyterhub_config.py\r\nLogin using a dummy user and start the server.\r\n\r\n### Your personal set up\r\n<!-- Tell us a little about the system you're using. -->\r\n\r\n - OS: RHEL\r\n - Version: 1.2.0dev\r\n - Configuration: 8 core, 64gb\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3094/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3094/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3090", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3090/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3090/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3090/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3090", "id": 638824532, "node_id": "MDExOlB1bGxSZXF1ZXN0NDM0NTE2NTM2", "number": 3090, "title": "Rename Authenticator.white/blacklist to allowed/blocked", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-06-15T12:45:08Z", "updated_at": "2020-10-04T04:51:30Z", "closed_at": "2020-07-03T10:27:09Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3090", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3090", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3090.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3090.patch", "merged_at": "2020-07-03T10:27:09Z"}, "body": "cf https://github.com/jupyterhub/team-compass/issues/299\r\n\r\ntodo:\r\n\r\n- [x] Authenticator.whitelist -> Authenticator.allowed_users\r\n- [x] Authenticator.blacklist -> Authenticator.blocked_users\r\n- [x] group_whitelist -> allowed_groups\r\n- [x] Authenticator.check_whitelist -> Authenticator.check_allowed (this is the top-level method that checks *all* sources of allow\u2014users, groups, etc.)\r\n- [x] LocalAuthenticator.check_group_whitelist -> LocalAuthenticator.check_allowed_groups\r\n- [x] deprecate traits, config\r\n- [x] test deprecated names still work\r\n- [x] test various combinations of deprecated config for proper priority resolution\r\n- [x] subclass resolution in deprecated method names (subclass overriding check_whitelist should take priority over base class check_allowed, but warn about deprecation *unless* check_allowed is also defined on the subclass)\r\n- [x] update docs", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3090/reactions", "total_count": 2, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 2, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3090/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3089", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3089/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3089/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3089/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3089", "id": 638725460, "node_id": "MDExOlB1bGxSZXF1ZXN0NDM0NDM0NDA1", "number": 3089, "title": "Include the query string parameters when redirecting to a new URL", "user": {"login": "kinow", "id": 304786, "node_id": "MDQ6VXNlcjMwNDc4Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/304786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kinow", "html_url": "https://github.com/kinow", "followers_url": "https://api.github.com/users/kinow/followers", "following_url": "https://api.github.com/users/kinow/following{/other_user}", "gists_url": "https://api.github.com/users/kinow/gists{/gist_id}", "starred_url": "https://api.github.com/users/kinow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kinow/subscriptions", "organizations_url": "https://api.github.com/users/kinow/orgs", "repos_url": "https://api.github.com/users/kinow/repos", "events_url": "https://api.github.com/users/kinow/events{/privacy}", "received_events_url": "https://api.github.com/users/kinow/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2020-06-15T10:12:34Z", "updated_at": "2020-10-04T04:51:17Z", "closed_at": "2020-06-25T09:08:18Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3089", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3089", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3089.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3089.patch", "merged_at": "2020-06-25T09:08:17Z"}, "body": "Closes #3061\r\n\r\nTentative for #3061, will re-read the issue and my own changes, and then prepare tests if it's looking good.\r\n\r\nI changed recently some code in another PR that was handling parameters in URL redirect, but with JavaScript. When I read the issue #3061, I thought I could have caused a regression, and decided to investigate it.\r\n\r\n#3061 is not related to my change. But I thought the bug reported made sense, and keeping the parameters when redirecting could be useful (e.g. when passing some token/sessionId/flag/etc down to a spawner).\r\n\r\nCheers\r\nBruno", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3089/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3089/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3087", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3087/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3087/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3087/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3087", "id": 638167401, "node_id": "MDExOlB1bGxSZXF1ZXN0NDM0MDEwMTk2", "number": 3087, "title": "Make `delete_invalid_users` configurable", "user": {"login": "fcollonval", "id": 8435071, "node_id": "MDQ6VXNlcjg0MzUwNzE=", "avatar_url": "https://avatars.githubusercontent.com/u/8435071?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fcollonval", "html_url": "https://github.com/fcollonval", "followers_url": "https://api.github.com/users/fcollonval/followers", "following_url": "https://api.github.com/users/fcollonval/following{/other_user}", "gists_url": "https://api.github.com/users/fcollonval/gists{/gist_id}", "starred_url": "https://api.github.com/users/fcollonval/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fcollonval/subscriptions", "organizations_url": "https://api.github.com/users/fcollonval/orgs", "repos_url": "https://api.github.com/users/fcollonval/repos", "events_url": "https://api.github.com/users/fcollonval/events{/privacy}", "received_events_url": "https://api.github.com/users/fcollonval/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-06-13T14:02:18Z", "updated_at": "2020-10-04T04:50:59Z", "closed_at": "2020-06-23T08:02:35Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3087", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3087", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3087.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3087.patch", "merged_at": "2020-06-23T08:02:35Z"}, "body": "The following warning may happen:\r\n\r\nhttps://github.com/jupyterhub/jupyterhub/blob/b7f277147bad0855104e4b725254cefba784a9ed/jupyterhub/app.py#L1738-L1743\r\n\r\nBut the corresponding setting is not configurable.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3087/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3087/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3082", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3082/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3082/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3082/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3082", "id": 637301086, "node_id": "MDExOlB1bGxSZXF1ZXN0NDMzMzE2NDY5", "number": 3082, "title": "Ensure client dependencies build before wheel", "user": {"login": "diurnalist", "id": 796413, "node_id": "MDQ6VXNlcjc5NjQxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/796413?v=4", "gravatar_id": "", "url": "https://api.github.com/users/diurnalist", "html_url": "https://github.com/diurnalist", "followers_url": "https://api.github.com/users/diurnalist/followers", "following_url": "https://api.github.com/users/diurnalist/following{/other_user}", "gists_url": "https://api.github.com/users/diurnalist/gists{/gist_id}", "starred_url": "https://api.github.com/users/diurnalist/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/diurnalist/subscriptions", "organizations_url": "https://api.github.com/users/diurnalist/orgs", "repos_url": "https://api.github.com/users/diurnalist/repos", "events_url": "https://api.github.com/users/diurnalist/events{/privacy}", "received_events_url": "https://api.github.com/users/diurnalist/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-06-11T20:29:15Z", "updated_at": "2020-10-04T04:48:28Z", "closed_at": "2020-06-12T15:19:36Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3082", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3082", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3082.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3082.patch", "merged_at": "2020-06-12T15:19:36Z"}, "body": "Bug #2852 describes an issue where templates cannot be found by\r\nJupyterHub when using the Docker images built out of this repo. The\r\nissue turned out to be due to missing node_modules at the time of build.\r\n\r\nThere is a hook in the `package.json` that causes node_modules to be\r\ncopied to the static/components directory post-install. If this is not\r\nrun, those components are not in the static directory and thus are not\r\nincluded in the wheel when it is built.\r\n\r\nFix #2905 fixed one problem--the `bower-lite` hook script wasn't copied\r\nto the Docker image, and so the hook couldn't run, but the other issue\r\nis that the client dependencies are never explicitly built. They must be\r\nbuilt prior to the wheel build, and the hook script must have run so\r\nthey are copied to the ./static folder, which is included in the wheel\r\nbuild thanks to [MANIFEST.in][1]\r\n\r\n.. note::\r\n\r\n   This removes the verbose flag from the wheel build command. The\r\n   reason is that it generates a lot of writes to stdout. It seems that\r\n   wheel can (or always) is switching to non-blocking mode, which can cause\r\n   EAGAIN to be raised, which leads to fun errors like:\r\n\r\n     BlockingIOError(.., 'write could not complete without blocking', ..)\r\n\r\n   The wheels fail to build if this error is raised. Removing the verbosity\r\n   flag is a quick solution (it drastically reduces writes to STDOUT), but\r\n   comes at the cost of more trouble debugging a failed wheel build. Adding\r\n   the \"-v\" back in the Dockerfile when debugging a build failure is still\r\n   possible. [Credit: @vbraun][2]\r\n\r\n.. note::\r\n\r\n   This commit also removes some extraneous COPY operations during the\r\n   Docker build, in particular the /src/jupyterhub/share directory is\r\n   not used unless users have explicitly override their\r\n   jupyterhub_config.py to include it somehow. If the default\r\n   data_files_path behavior is used, JupyterHub should find the proper\r\n   static directory when the application loads.\r\n\r\nFixes: #2852\r\n\r\n[1]: https://packaging.python.org/guides/using-manifest-in/\r\n[2]:\r\nhttps://github.com/travis-ci/travis-ci/issues/4704#issuecomment-348435959", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3082/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3082/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3081", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3081/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3081/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3081/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3081", "id": 636798434, "node_id": "MDExOlB1bGxSZXF1ZXN0NDMyOTAwOTEx", "number": 3081, "title": "make Spawner.environment config highest priority", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-06-11T07:48:07Z", "updated_at": "2020-10-04T04:48:03Z", "closed_at": "2020-06-11T12:53:38Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3081", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3081", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3081.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3081.patch", "merged_at": "2020-06-11T12:53:38Z"}, "body": "so that it can override 'default' env variables like JUPYTERHUB_API_URL\r\n\r\nuse with caution, since this allows setting non-working values for required URLs, but is still a useful escape hatch when e.g. hub_connect_url might want to have different values across spawners\r\n\r\n\r\ncf https://github.com/jupyterhub/dockerspawner/pull/361", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3081/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3081/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3070", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3070/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3070/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3070/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3070", "id": 630479818, "node_id": "MDU6SXNzdWU2MzA0Nzk4MTg=", "number": 3070, "title": "performance issue about auth", "user": {"login": "qindisky", "id": 3345514, "node_id": "MDQ6VXNlcjMzNDU1MTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3345514?v=4", "gravatar_id": "", "url": "https://api.github.com/users/qindisky", "html_url": "https://github.com/qindisky", "followers_url": "https://api.github.com/users/qindisky/followers", "following_url": "https://api.github.com/users/qindisky/following{/other_user}", "gists_url": "https://api.github.com/users/qindisky/gists{/gist_id}", "starred_url": "https://api.github.com/users/qindisky/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/qindisky/subscriptions", "organizations_url": "https://api.github.com/users/qindisky/orgs", "repos_url": "https://api.github.com/users/qindisky/repos", "events_url": "https://api.github.com/users/qindisky/events{/privacy}", "received_events_url": "https://api.github.com/users/qindisky/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-06-04T03:20:17Z", "updated_at": "2022-06-01T13:35:45Z", "closed_at": "2022-06-01T13:35:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML commments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\nThere may be performance issue when auth.\r\nin the method of get_current_user_token(), I find some code like \r\n`db.query(cls).filter(bindparam('prefix', prefix).startswith(cls.prefix))`\r\ncorresponding sql as follow \r\n`select ... FROM api_tokens WHERE ('0ee2' LIKE concat(api_tokens.prefix, '%'))`\r\nexplain this sql,\r\n```\r\nselect_type: SIMPLE\r\ntype:ALL\r\n```\r\nit doesn't use the index api_tokens.ix_api_tokens_prefix.\r\nSo when this table has ten thousands of rows, it costs about 1000+ms. it may have performance issue.\r\n\r\n#### Expected behaviour\r\nthis sql should use the index of api_tokens.ix_api_tokens_prefix.\r\n\r\n#### Actual behaviour\r\nCan we change it as follow\r\n`select ... FROM api_tokens WHERE ('0ee2' = api_tokens.prefix)`\r\n\r\n### How to reproduce\r\napi_tokens has ten thousands of rows. All requests to jupyterhub always costs N * 1000ms, handred times than beginning.\r\n\r\n### Your personal set up\r\njupyterhub 1.1.0", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3070/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3070/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3061", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3061/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3061/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3061/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3061", "id": 627019733, "node_id": "MDU6SXNzdWU2MjcwMTk3MzM=", "number": 3061, "title": "query parameters dropped when redirecting from hub to login page", "user": {"login": "scivm", "id": 5593597, "node_id": "MDQ6VXNlcjU1OTM1OTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5593597?v=4", "gravatar_id": "", "url": "https://api.github.com/users/scivm", "html_url": "https://github.com/scivm", "followers_url": "https://api.github.com/users/scivm/followers", "following_url": "https://api.github.com/users/scivm/following{/other_user}", "gists_url": "https://api.github.com/users/scivm/gists{/gist_id}", "starred_url": "https://api.github.com/users/scivm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/scivm/subscriptions", "organizations_url": "https://api.github.com/users/scivm/orgs", "repos_url": "https://api.github.com/users/scivm/repos", "events_url": "https://api.github.com/users/scivm/events{/privacy}", "received_events_url": "https://api.github.com/users/scivm/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-05-29T05:59:37Z", "updated_at": "2020-06-25T09:08:18Z", "closed_at": "2020-06-25T09:08:18Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML commments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\nquery parameters are dropped when redirecting from hub to login page.   Documentation which I list below says query parameters should be preserved.\r\n\r\nFrom hub log you can see the parameters are dropped on redirect:\r\n[I 2020-05-29 05:55:28.094 JupyterHub log:174] 302 GET /hub/?frog=water -> /hub/login (@10.0.1.5) 1.01ms\r\n[I 2020-05-29 05:55:28.147 JupyterHub log:174] 302 GET /hub/login -> /hub/oauth_login (@10.0.1.5) 0.91ms\r\n\r\nDocumentation states:\r\nhttps://jupyterhub.readthedocs.io/en/stable/reference/urls.html\r\nAll authenticated handlers redirect to /hub/login to login users prior to being redirected back to the originating page. The returned request should preserve all query parameters.\r\n\r\n\r\n#### Expected behaviour\r\nquery parameters would be preserved on redirects\r\n\r\n#### Actual behaviour\r\nquery parameters are dropped\r\n\r\n### How to reproduce\r\n<!-- Use this section to describe the steps that a user would take to experience this bug. -->\r\n\r\n1. Go to /hub?x=y\r\n2. It will redirect to /login and your url parameters will be gone\r\n\r\n### Your personal set up\r\n<!-- Tell us a little about the system you're using. -->\r\n\r\n - OS:\r\nlinux\r\n - Version:\r\nJupyterHub version 1.1.0\r\n - Configuration:\r\n <!-- Be careful not to share any sensitive information. --->\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3061/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3061/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3060", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3060/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3060/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3060/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3060", "id": 626915616, "node_id": "MDU6SXNzdWU2MjY5MTU2MTY=", "number": 3060, "title": "User's default server is deleted when any named server cannot be added to the proxy.", "user": {"login": "jeevb", "id": 10869815, "node_id": "MDQ6VXNlcjEwODY5ODE1", "avatar_url": "https://avatars.githubusercontent.com/u/10869815?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jeevb", "html_url": "https://github.com/jeevb", "followers_url": "https://api.github.com/users/jeevb/followers", "following_url": "https://api.github.com/users/jeevb/following{/other_user}", "gists_url": "https://api.github.com/users/jeevb/gists{/gist_id}", "starred_url": "https://api.github.com/users/jeevb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jeevb/subscriptions", "organizations_url": "https://api.github.com/users/jeevb/orgs", "repos_url": "https://api.github.com/users/jeevb/repos", "events_url": "https://api.github.com/users/jeevb/events{/privacy}", "received_events_url": "https://api.github.com/users/jeevb/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-05-29T00:26:10Z", "updated_at": "2020-07-07T12:43:10Z", "closed_at": "2020-07-07T12:43:10Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thank you for contributing. These HTML commments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n### Bug description\r\nWe noticed a problem where failure to add a named server to the proxy wrongly caused the default server to be deleted instead. In the following example, `doublegpu7` failed to be added to the proxy, but instead of deleting `doublegpu7`, the default server `jupyter-michaeldzamba` was deleted instead.\r\n```\r\n[E 2020-05-28 22:02:11.206 JupyterHub base:876] Failed to add michaeldzamba:doublegpu7 to proxy!\r\n    Traceback (most recent call last):\r\n      File \"/fn/lib/python3.7/site-packages/jupyterhub/handlers/base.py\", line 869, in finish_user_spawn\r\n        await self.proxy.add_user(user, server_name)\r\n      File \"/fn/lib/python3.7/site-packages/jupyterhub/proxy.py\", line 274, in add_user\r\n        {'user': user.name, 'server_name': server_name},\r\n      File \"/fn/lib/python3.7/site-packages/jupyterhub_traefik_proxy/kv_proxy.py\", line 289, in add_route\r\n        await self._wait_for_route(routespec, provider=self.kv_name)\r\n      File \"/fn/lib/python3.7/site-packages/jupyterhub_traefik_proxy/proxy.py\", line 147, in _wait_for_route\r\n        timeout=self.check_route_timeout,\r\n      File \"/fn/lib/python3.7/site-packages/jupyterhub/utils.py\", line 177, in exponential_backoff\r\n        raise TimeoutError(fail_message)\r\n    TimeoutError: Traefik route for /user/michaeldzamba/doublegpu7/ configuration not available\r\n[E 2020-05-28 22:02:11.207 JupyterHub base:878] Stopping michaeldzamba:doublegpu7 to avoid inconsistent state\r\n[I 2020-05-28 22:02:11.208 JupyterHub spawner:1866] Deleting pod jupyter-michaeldzamba\r\n```\r\n\r\n#### Expected behaviour\r\nWhen a named or default server cannot be added to a proxy, that named or default server should be deleted.\r\n\r\n#### Actual behaviour\r\nWhen a named or default server cannot be added to a proxy, the user's default server is deleted.\r\n\r\n### Your personal set up\r\nWe are currently running Jupyterhub with the traefik proxy and Kubespawner on Debian buster (versions below):\r\n```\r\njupyterhub-kubespawner==0.11.1 \\\r\n    --hash=sha256:ba3efd98db31f157c8db6371d88d86260025a253ab826d7fa404af9764a482e1 \\\r\n    --hash=sha256:d33c771a058ec3c5931b5793813498502601a9fe6e7f315750e6e5df518af0e1 \\\r\njupyterhub-traefik-proxy==0.1.4 \\\r\n    --hash=sha256:4e3b3190988e8e79aba96992ca52b9e1adca60f3addb8b85f2fc60e2f7934660 \\\r\n    --hash=sha256:f1d677e297c1c5912df4ffab9733c934c610398df4ac397990c476962cdfaac7 \\\r\njupyterhub==1.1.0 \\\r\n    --hash=sha256:852a70225a03abd631b36a207f3ffdf69326a0db4cef539825fde39ec1b713d7 \\\r\n    --hash=sha256:a515a22fe1e66e1a08d2e4ecb9b5fe47ed024cddfbc657ad15f448ac3bf409ca \\\r\n```", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3060/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3060/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3042", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3042/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3042/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3042/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3042", "id": 614845608, "node_id": "MDExOlB1bGxSZXF1ZXN0NDE1MzE3NjYy", "number": 3042, "title": "Changing start my server button link to spawn url once server is stopped", "user": {"login": "rabsr", "id": 8984978, "node_id": "MDQ6VXNlcjg5ODQ5Nzg=", "avatar_url": "https://avatars.githubusercontent.com/u/8984978?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rabsr", "html_url": "https://github.com/rabsr", "followers_url": "https://api.github.com/users/rabsr/followers", "following_url": "https://api.github.com/users/rabsr/following{/other_user}", "gists_url": "https://api.github.com/users/rabsr/gists{/gist_id}", "starred_url": "https://api.github.com/users/rabsr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rabsr/subscriptions", "organizations_url": "https://api.github.com/users/rabsr/orgs", "repos_url": "https://api.github.com/users/rabsr/repos", "events_url": "https://api.github.com/users/rabsr/events{/privacy}", "received_events_url": "https://api.github.com/users/rabsr/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-05-08T16:26:19Z", "updated_at": "2020-10-04T04:41:54Z", "closed_at": "2020-05-19T12:57:45Z", "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3042", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3042", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3042.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3042.patch", "merged_at": "2020-05-19T12:57:45Z"}, "body": "When single user server is stopped from hub/home, the text for the button \"My server\" is changed to \"Start My server\" but it does not change the url link to the button. It remains referenced to \"/user/<username\". So, on clicking \"Start My server\", it tries to redirect to the single user server. \r\nAs, server is already stopped, so it redirects user to server not running page. Changing the url to spawn up the single user sever.\r\n#2925 ", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3042/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3042/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3035", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3035/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3035/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3035/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3035", "id": 611067489, "node_id": "MDExOlB1bGxSZXF1ZXN0NDEyMzY5OTMz", "number": 3035, "title": "Fix CSS on admin page version listing", "user": {"login": "vilhelmen", "id": 5308250, "node_id": "MDQ6VXNlcjUzMDgyNTA=", "avatar_url": "https://avatars.githubusercontent.com/u/5308250?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vilhelmen", "html_url": "https://github.com/vilhelmen", "followers_url": "https://api.github.com/users/vilhelmen/followers", "following_url": "https://api.github.com/users/vilhelmen/following{/other_user}", "gists_url": "https://api.github.com/users/vilhelmen/gists{/gist_id}", "starred_url": "https://api.github.com/users/vilhelmen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vilhelmen/subscriptions", "organizations_url": "https://api.github.com/users/vilhelmen/orgs", "repos_url": "https://api.github.com/users/vilhelmen/repos", "events_url": "https://api.github.com/users/vilhelmen/events{/privacy}", "received_events_url": "https://api.github.com/users/vilhelmen/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-05-02T00:15:04Z", "updated_at": "2020-10-04T04:40:02Z", "closed_at": "2020-05-05T08:00:28Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3035", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3035", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3035.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3035.patch", "merged_at": "2020-05-05T08:00:28Z"}, "body": "Removes fixed position for `version_footer`. Footer overlaps the last user in the list when sufficiently long, obscuring half of the entry.  My bad :(", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3035/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3035/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3027", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3027/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3027/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3027/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3027", "id": 602662838, "node_id": "MDExOlB1bGxSZXF1ZXN0NDA1NjI5NDU0", "number": 3027, "title": "Cross site scripting false positive", "user": {"login": "scivm", "id": 5593597, "node_id": "MDQ6VXNlcjU1OTM1OTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5593597?v=4", "gravatar_id": "", "url": "https://api.github.com/users/scivm", "html_url": "https://github.com/scivm", "followers_url": "https://api.github.com/users/scivm/followers", "following_url": "https://api.github.com/users/scivm/following{/other_user}", "gists_url": "https://api.github.com/users/scivm/gists{/gist_id}", "starred_url": "https://api.github.com/users/scivm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/scivm/subscriptions", "organizations_url": "https://api.github.com/users/scivm/orgs", "repos_url": "https://api.github.com/users/scivm/repos", "events_url": "https://api.github.com/users/scivm/events{/privacy}", "received_events_url": "https://api.github.com/users/scivm/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2020-04-19T09:04:08Z", "updated_at": "2021-12-02T11:46:26Z", "closed_at": "2021-12-02T11:46:26Z", "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3027", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3027", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3027.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3027.patch", "merged_at": null}, "body": "A load balancer in front of my jupyterhub service is adding a :443 into the host header.   This is undesired but valid according to the http spec and causes a false positive when performing the cross site scripting check.  This pull request modifies the value read from the host header to strip the :443 or :80 if a load balancer has added it.   In our case it is an azure load balancer and we cant control it.\r\n\r\nhttps://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.23\r\n\r\nHost = \"Host\" \":\" host [ \":\" **port** ] ; Section 3.2.2\r\n\r\nError seen in logs during false positive:\r\n\r\n[W 2020-04-17 11:51:29.470 JupyterHub base:60] Blocking Cross Origin API request.  Referer: https://jupyter.myurl.fi/hub/spawn-pending/user, Host: **jupyter.myurl.fi:443**/hub/\r\n[W 2020-04-17 11:51:29.471 JupyterHub log:174] 403 GET /hub/api/users/xxx/server/progress (@myip) 6.40ms", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3027/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3027/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3015", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3015/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3015/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3015/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3015", "id": 596663909, "node_id": "MDExOlB1bGxSZXF1ZXN0NDAwOTE4NjU1", "number": 3015, "title": "Fix user_row endblock in admin template", "user": {"login": "jtpio", "id": 591645, "node_id": "MDQ6VXNlcjU5MTY0NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/591645?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jtpio", "html_url": "https://github.com/jtpio", "followers_url": "https://api.github.com/users/jtpio/followers", "following_url": "https://api.github.com/users/jtpio/following{/other_user}", "gists_url": "https://api.github.com/users/jtpio/gists{/gist_id}", "starred_url": "https://api.github.com/users/jtpio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jtpio/subscriptions", "organizations_url": "https://api.github.com/users/jtpio/orgs", "repos_url": "https://api.github.com/users/jtpio/repos", "events_url": "https://api.github.com/users/jtpio/events{/privacy}", "received_events_url": "https://api.github.com/users/jtpio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2020-04-08T15:26:00Z", "updated_at": "2020-10-04T04:37:59Z", "closed_at": "2020-04-18T17:01:40Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/3015", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/3015", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/3015.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/3015.patch", "merged_at": "2020-04-18T17:01:39Z"}, "body": "It looks like the `user_row` block was ended right after the `</tr>` element, while it is defined right after the corresponding `<tr>` element above:\r\n\r\nhttps://github.com/jupyterhub/jupyterhub/blob/1f515464fe2edf5d9d8a7617c22ebe67002e0ba0/share/jupyterhub/templates/admin.html#L43-L46\r\n\r\nThis came up when trying to extend the admin template to add extra information to the user row.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3015/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3015/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3003", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3003/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3003/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3003/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/3003", "id": 589087253, "node_id": "MDU6SXNzdWU1ODkwODcyNTM=", "number": 3003, "title": "No services dropdown on the admin page", "user": {"login": "jtpio", "id": 591645, "node_id": "MDQ6VXNlcjU5MTY0NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/591645?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jtpio", "html_url": "https://github.com/jtpio", "followers_url": "https://api.github.com/users/jtpio/followers", "following_url": "https://api.github.com/users/jtpio/following{/other_user}", "gists_url": "https://api.github.com/users/jtpio/gists{/gist_id}", "starred_url": "https://api.github.com/users/jtpio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jtpio/subscriptions", "organizations_url": "https://api.github.com/users/jtpio/orgs", "repos_url": "https://api.github.com/users/jtpio/repos", "events_url": "https://api.github.com/users/jtpio/events{/privacy}", "received_events_url": "https://api.github.com/users/jtpio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-03-27T12:04:58Z", "updated_at": "2020-08-06T21:13:37Z", "closed_at": "2020-08-06T21:13:37Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Bug description\r\n\r\n#### Expected behaviour\r\n\r\nOn the admin page, clicking on `Services` in the nav bar should show the list of services.\r\n\r\n#### Actual behaviour\r\n\r\n![services-admin-page](https://user-images.githubusercontent.com/591645/77754009-d0120280-702a-11ea-958d-59fb399ae651.gif)\r\n\r\nIt might be because the click event on the `Services` item in the navigation bar is being intercepted.\r\n\r\n### How to reproduce\r\n\r\n- Have one JupyterHub managed service running\r\n- Go to the `Admin` page\r\n- Click on `Services`\r\n\r\n### Your personal set up\r\n\r\n- OS: Ubuntu 19.10\r\n- Version: JupyterHub 1.1.0\r\n- Browser: Latest Firefox and Chromium \r\n- Configuration: Hub running with one managed service locally", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3003/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/3003/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2993", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2993/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2993/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2993/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/2993", "id": 585755841, "node_id": "MDU6SXNzdWU1ODU3NTU4NDE=", "number": 2993, "title": "Failed build of docs in CI", "user": {"login": "willingc", "id": 2680980, "node_id": "MDQ6VXNlcjI2ODA5ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/2680980?v=4", "gravatar_id": "", "url": "https://api.github.com/users/willingc", "html_url": "https://github.com/willingc", "followers_url": "https://api.github.com/users/willingc/followers", "following_url": "https://api.github.com/users/willingc/following{/other_user}", "gists_url": "https://api.github.com/users/willingc/gists{/gist_id}", "starred_url": "https://api.github.com/users/willingc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/willingc/subscriptions", "organizations_url": "https://api.github.com/users/willingc/orgs", "repos_url": "https://api.github.com/users/willingc/repos", "events_url": "https://api.github.com/users/willingc/events{/privacy}", "received_events_url": "https://api.github.com/users/willingc/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 356551766, "node_id": "MDU6TGFiZWwzNTY1NTE3NjY=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/documentation", "name": "documentation", "color": "fef2c0", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-03-22T16:22:13Z", "updated_at": "2020-03-23T15:49:26Z", "closed_at": "2020-03-23T15:49:26Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "```\r\n#!/bin/bash -eo pipefail\r\ncd docs\r\nmake html\r\nnpm install && touch node_modules\r\nnpm WARN deprecated request@2.88.2: request has been deprecated, see https://github.com/request/request/issues/3142\r\nnpm notice created a lockfile as package-lock.json. You should commit this file.\r\nnpm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@~2.1.2 (node_modules/chokidar/node_modules/fsevents):\r\nnpm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform for fsevents@2.1.2: wanted {\"os\":\"darwin\",\"arch\":\"any\"} (current: {\"os\":\"linux\",\"arch\":\"x64\"})\r\nnpm WARN jupyterhub-docs-build@0.8.0 No repository field.\r\n\r\nadded 216 packages from 514 contributors and audited 325 packages in 4.188s\r\n\r\n14 packages are looking for funding\r\n  run `npm fund` for details\r\n\r\nfound 2 low severity vulnerabilities\r\n  run `npm audit fix` to fix them, or `npm audit` for details\r\nnpm run rest-api\r\n\r\n> jupyterhub-docs-build@0.8.0 rest-api /home/circleci/project/docs\r\n> bootprint openapi ./rest-api.yml source/_static/rest-api\r\n\r\n[\r\n  'source/_static/rest-api/index.html',\r\n  'source/_static/rest-api/main.css',\r\n  'source/_static/rest-api/main.css.map'\r\n]\r\nsphinx-build -b html -d build/doctrees  \"-W\" source build/html\r\nRunning Sphinx v2.4.4\r\nAdding copy buttons to code blocks...\r\nmaking output directory... done\r\n/home/circleci/.local/lib/python3.6/site-packages/sphinx/util/compat.py:32: RemovedInSphinx30Warning: The config variable \"source_parsers\" is deprecated. Please update your extension for the parser and remove the setting.\r\n  RemovedInSphinx30Warning)\r\n/home/circleci/.local/lib/python3.6/site-packages/sphinx/util/compat.py:36: RemovedInSphinx30Warning: app.add_source_parser() does not support suffix argument. Use app.add_source_suffix() instead.\r\n  app.add_source_parser(suffix, parser)\r\n\r\nTheme error:\r\nno theme named 'pandas_sphinx_theme' found (missing theme.conf?)\r\nMakefile:64: recipe for target 'html' failed\r\nmake: *** [html] Error 2\r\n```\r\n\r\nFYI @choldgraf @betatim", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2993/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2993/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2907", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2907/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2907/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2907/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/2907", "id": 553703845, "node_id": "MDExOlB1bGxSZXF1ZXN0MzY1OTg5NDE4", "number": 2907, "title": "Fix --generate-config bug when specifying a filename", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-01-22T18:01:29Z", "updated_at": "2020-10-04T04:18:10Z", "closed_at": "2020-01-23T06:19:12Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/2907", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/2907", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/2907.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/2907.patch", "merged_at": "2020-01-23T06:19:12Z"}, "body": "This commit fixes #2906 that was introduced due to #2824. See analysis\r\nof issue in https://github.com/jupyterhub/jupyterhub/issues/2906#issuecomment-577303510.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2907/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2907/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2906", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2906/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2906/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2906/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/2906", "id": 553462044, "node_id": "MDU6SXNzdWU1NTM0NjIwNDQ=", "number": 2906, "title": "--generate-config fails since 1.1.0", "user": {"login": "iptizer", "id": 24313052, "node_id": "MDQ6VXNlcjI0MzEzMDUy", "avatar_url": "https://avatars.githubusercontent.com/u/24313052?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iptizer", "html_url": "https://github.com/iptizer", "followers_url": "https://api.github.com/users/iptizer/followers", "following_url": "https://api.github.com/users/iptizer/following{/other_user}", "gists_url": "https://api.github.com/users/iptizer/gists{/gist_id}", "starred_url": "https://api.github.com/users/iptizer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iptizer/subscriptions", "organizations_url": "https://api.github.com/users/iptizer/orgs", "repos_url": "https://api.github.com/users/iptizer/repos", "events_url": "https://api.github.com/users/iptizer/events{/privacy}", "received_events_url": "https://api.github.com/users/iptizer/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-01-22T10:54:59Z", "updated_at": "2020-01-23T11:28:43Z", "closed_at": "2020-01-23T06:19:12Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\n\r\nThe function `--generate-config` doesn't work as expected with the release of 1.1.0. Jupyterhub complains about the missing config file, which should be generated. We execute the steps in a Packer build process, which worked until the upgrade of jupyterhub from 1.0.0 to 1.1.0.\r\n\r\nThe executed command is even listed in the -h explanation, so I'm pretty confident it should work:\r\n\r\n```sh\r\n[user@ip-1-1-1-1 ~]$ /opt/anaconda3/bin/jupyterhub -h\r\nStart a multi-user Jupyter Notebook server\r\n[..]\r\n\r\nExamples\r\n--------\r\n\r\n    generate default config file:\r\n    \r\n        jupyterhub --generate-config -f /etc/jupyterhub/jupyterhub_config.py\r\n    \r\n[...]\r\n```\r\n\r\nPlease don't hit me if conda or amazon linux may introduce this error, but I personally don't think so.\r\n\r\n**To Reproduce**\r\n\r\nJust execute jupyterhub with *--generate-config*. Installation has been done via conda. Execute the following commands on a clean linux/centos/amazonLinux1.\r\n\r\n```sh\r\n$ wget https://repo.continuum.io/archive/Anaconda3-2019.10-Linux-x86_64.sh -O /tmp/Anaconda3-Linux-x86_64.sh\r\n$ sudo sh /tmp/Anaconda3-Linux-x86_64.sh -b -p /opt/anaconda3\r\n$ sudo /opt/anaconda3/bin/conda config --add channels 'conda-forge'\r\n$ sudo /opt/anaconda3/bin/conda install -y -c conda-forge jupyterhub\",\r\n$ sudo /opt/anaconda3/bin/jupyterhub --generate-config -f /etc/jupyterhub/jupyterhub_config.py\r\nERROR: Failed to find specified config file: /etc/jupyterhub/jupyterhub_config.py\r\n```\r\n\r\n**Expected behavior**\r\n\r\nThe config file should be generated. Failing with \"Failed to find specified config file\" doesn't make sense.\r\n\r\n**Compute Information**\r\n\r\n - Installation is usually performed within a packer build, but problem can be reproduced manually.\r\n\r\n```sh\r\n[user@ip-1-1-1-1 ~]$ cat /etc/issue\r\nAmazon Linux AMI release 2018.03\r\n[user@ip-1-1-1-1 ~]$ sudo /opt/anaconda3/bin/jupyterhub --version\r\n1.1.0\r\n```\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2906/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2906/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2886", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2886/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2886/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2886/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/2886", "id": 549012783, "node_id": "MDU6SXNzdWU1NDkwMTI3ODM=", "number": 2886, "title": "JupyterHub fails on startup, when there is a pid file, but the actual pid is an unrelated process", "user": {"login": "n-a-sz", "id": 6606870, "node_id": "MDQ6VXNlcjY2MDY4NzA=", "avatar_url": "https://avatars.githubusercontent.com/u/6606870?v=4", "gravatar_id": "", "url": "https://api.github.com/users/n-a-sz", "html_url": "https://github.com/n-a-sz", "followers_url": "https://api.github.com/users/n-a-sz/followers", "following_url": "https://api.github.com/users/n-a-sz/following{/other_user}", "gists_url": "https://api.github.com/users/n-a-sz/gists{/gist_id}", "starred_url": "https://api.github.com/users/n-a-sz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/n-a-sz/subscriptions", "organizations_url": "https://api.github.com/users/n-a-sz/orgs", "repos_url": "https://api.github.com/users/n-a-sz/repos", "events_url": "https://api.github.com/users/n-a-sz/events{/privacy}", "received_events_url": "https://api.github.com/users/n-a-sz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-01-13T15:41:21Z", "updated_at": "2020-11-20T08:45:54Z", "closed_at": "2020-11-20T08:45:54Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\n\r\nGiven: a Linux server running JupyterHub among other things. Proxy is running with pid 1234\r\nWhen: the server is restarted, without properly shutting down JH. A process comes up before JH with pid 1234. Then JH is started.\r\nThen: as the pid file is there, it will try to stop the process with pid 1234, either successfully (which can cause unpredictable result) or unsuccessfully (e.g. permission denied to kill that process).\r\n\r\n**Expected behavior**\r\n\r\nIt should check the user and the command of the running service with pid \"1234\". If the user is the same and the command is something related to JupyterHub then is it is okay to try to kill that process. If not then it should remove the pid file and start up.\r\n\r\n**Compute Information**\r\n\r\n - JupyterHub Version 1.0.0\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2886/reactions", "total_count": 3, "+1": 3, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2886/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2773", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2773/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2773/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2773/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/2773", "id": 506107783, "node_id": "MDExOlB1bGxSZXF1ZXN0MzI3NDA4MTU5", "number": 2773, "title": "Handle the protocol when ssl is enabled and log the right URL", "user": {"login": "kinow", "id": 304786, "node_id": "MDQ6VXNlcjMwNDc4Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/304786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kinow", "html_url": "https://github.com/kinow", "followers_url": "https://api.github.com/users/kinow/followers", "following_url": "https://api.github.com/users/kinow/following{/other_user}", "gists_url": "https://api.github.com/users/kinow/gists{/gist_id}", "starred_url": "https://api.github.com/users/kinow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kinow/subscriptions", "organizations_url": "https://api.github.com/users/kinow/orgs", "repos_url": "https://api.github.com/users/kinow/repos", "events_url": "https://api.github.com/users/kinow/events{/privacy}", "received_events_url": "https://api.github.com/users/kinow/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2019-10-12T00:48:42Z", "updated_at": "2020-10-04T04:16:00Z", "closed_at": "2020-02-25T12:35:33Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/2773", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/2773", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/2773.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/2773.patch", "merged_at": "2020-02-25T12:35:33Z"}, "body": "Uses traitlets `@validate` and `@default` (thanks @minrk !) to define the `.bind_url` of a JupyterHub application, also handling when SSL is enabled - in which case, we want the `bind_url` to have `https`, not `http`.\r\n\r\n(updated the description of this PR to reflect the latest comments, so some of the discussion below is out of sync)\r\n\r\n<!--\r\nTentative fix for #2621\r\n\r\nSimply adds a new `@property` that handles the protocol. \r\nOutput of `jupyterhub --debug`:\r\n\r\n```bash\r\n$ jupyterhub --debug\r\n[D 2019-10-12 12:34:12.386 JupyterHub application:555] Looking for jupyterhub_config in /home/kinow/Development/python/workspace/jupyterhub\r\n[D 2019-10-12 12:34:12.386 JupyterHub application:577] Loaded config file: /home/kinow/Development/python/workspace/jupyterhub/jupyterhub_config.py\r\n[I 2019-10-12 12:34:12.387 JupyterHub app:2187] Running JupyterHub version 1.0.1dev\r\n[I 2019-10-12 12:34:12.387 JupyterHub app:2218] Using Authenticator: jupyterhub.auth.PAMAuthenticator-1.0.1dev\r\n[I 2019-10-12 12:34:12.387 JupyterHub app:2218] Using Spawner: jupyterhub.spawner.LocalProcessSpawner-1.0.1dev\r\n[D 2019-10-12 12:34:12.391 JupyterHub app:2159] Could not load pycurl: No module named 'pycurl'\r\n    pycurl is recommended if you have a large number of users.\r\n[I 2019-10-12 12:34:12.392 JupyterHub app:1316] Loading cookie_secret from /home/kinow/Development/python/workspace/jupyterhub/jupyterhub_cookie_secret\r\n[D 2019-10-12 12:34:12.392 JupyterHub app:1483] Connecting to db: sqlite:///jupyterhub.sqlite\r\n[D 2019-10-12 12:34:12.404 JupyterHub orm:749] database schema version found: 4dc2d5a8c53c\r\n[I 2019-10-12 12:34:12.408 JupyterHub proxy:468] Generating new CONFIGPROXY_AUTH_TOKEN\r\n[W 2019-10-12 12:34:12.409 JupyterHub app:1591] No admin users, admin interface will be unavailable.\r\n[W 2019-10-12 12:34:12.409 JupyterHub app:1593] Add any administrative users to `c.Authenticator.admin_users` in config.\r\n[I 2019-10-12 12:34:12.409 JupyterHub app:1622] Not using whitelist. Any authenticated user will be allowed.\r\n10\r\n[D 2019-10-12 12:34:12.438 JupyterHub app:1881] Initializing spawners\r\n[D 2019-10-12 12:34:12.438 JupyterHub app:2005] Loaded users:\r\n    \r\n[I 2019-10-12 12:34:12.439 JupyterHub app:2255] Initialized 0 spawners in 0.001 seconds\r\n[I 2019-10-12 12:34:12.441 JupyterHub proxy:653] Starting proxy @ https://:8000\r\n[D 2019-10-12 12:34:12.441 JupyterHub proxy:654] Proxy cmd: ['configurable-http-proxy', '--ip', '', '--port', '8000', '--api-ip', '127.0.0.1', '--api-port', '8001', '--error-target', 'http://127.0.0.1:8081/hub/error', '--ssl-key', './internal-ssl/hub-ca/hub-ca.key', '--ssl-cert', './internal-ssl/hub-ca/hub-ca.crt']\r\n[D 2019-10-12 12:34:12.444 JupyterHub proxy:569] Writing proxy pid file: jupyterhub-proxy.pid\r\n12:34:12.562 [ConfigProxy] info: Proxying https://*:8000 to (no default)\r\n12:34:12.565 [ConfigProxy] info: Proxy API at http://127.0.0.1:8001/api/routes\r\n[D 2019-10-12 12:34:12.612 JupyterHub proxy:689] Proxy started and appears to be up\r\n[D 2019-10-12 12:34:12.617 JupyterHub proxy:773] Proxy: Fetching GET http://127.0.0.1:8001/api/routes\r\n12:34:12.632 [ConfigProxy] info: 200 GET /api/routes \r\n[I 2019-10-12 12:34:12.633 JupyterHub app:2500] Hub API listening on http://127.0.0.1:8081/hub/\r\n[D 2019-10-12 12:34:12.633 JupyterHub proxy:322] Fetching routes to check\r\n[D 2019-10-12 12:34:12.633 JupyterHub proxy:773] Proxy: Fetching GET http://127.0.0.1:8001/api/routes\r\n12:34:12.635 [ConfigProxy] info: 200 GET /api/routes \r\n[I 2019-10-12 12:34:12.636 JupyterHub proxy:327] Checking routes\r\n[I 2019-10-12 12:34:12.636 JupyterHub proxy:407] Adding default route for Hub: / => http://127.0.0.1:8081\r\n[D 2019-10-12 12:34:12.636 JupyterHub proxy:773] Proxy: Fetching POST http://127.0.0.1:8001/api/routes/\r\n12:34:12.638 [ConfigProxy] info: Adding route / -> http://127.0.0.1:8081\r\n12:34:12.639 [ConfigProxy] info: 201 POST /api/routes/ \r\n[I 2019-10-12 12:34:12.639 JupyterHub app:2575] JupyterHub is now running at https://:8000\r\n```\r\n\r\nThese are the two lines that changed:\r\n\r\n```\r\n[I 2019-10-12 12:34:12.441 JupyterHub proxy:653] Starting proxy @ https://:8000\r\n[I 2019-10-12 12:34:12.639 JupyterHub app:2575] JupyterHub is now running at https://:8000\r\n```\r\n\r\nTested this and the other URL's in the browser and it apparently worked with no issues. Tried writing a unit test for this by using the `ssl_enabled` module flag for the `app` fixture, but that appears to be for the hub/internal use, and does not set the `ssl_key` and `ssl_crt`.\r\n\r\nWhen `internal_ssl = True`, the value will have `https` so the property won't alter it. So everything should still work as before.\r\n\r\nWorks if `bind_url` is specified for something like `http://:4000` too, fixing the protocol without change to the port.\r\n-->\r\n\r\nCloses #2621 ", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2773/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2773/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2758", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2758/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2758/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2758/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/2758", "id": 501745850, "node_id": "MDU6SXNzdWU1MDE3NDU4NTA=", "number": 2758, "title": "named_server_limit_per_user not working?", "user": {"login": "vilhelmen", "id": 5308250, "node_id": "MDQ6VXNlcjUzMDgyNTA=", "avatar_url": "https://avatars.githubusercontent.com/u/5308250?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vilhelmen", "html_url": "https://github.com/vilhelmen", "followers_url": "https://api.github.com/users/vilhelmen/followers", "following_url": "https://api.github.com/users/vilhelmen/following{/other_user}", "gists_url": "https://api.github.com/users/vilhelmen/gists{/gist_id}", "starred_url": "https://api.github.com/users/vilhelmen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vilhelmen/subscriptions", "organizations_url": "https://api.github.com/users/vilhelmen/orgs", "repos_url": "https://api.github.com/users/vilhelmen/repos", "events_url": "https://api.github.com/users/vilhelmen/events{/privacy}", "received_events_url": "https://api.github.com/users/vilhelmen/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-10-02T21:52:09Z", "updated_at": "2020-06-15T10:02:52Z", "closed_at": "2020-06-15T10:02:52Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I don't seem to be able to get named server limits working on our 1.0.0 test server. I've tried the recently introduced Z2JH `hub.namedServerLimitPerUser` as well as raw configuration via `c.JupyterHub.named_server_limit_per_user` and neither seem to be working. I don't have any concurrent spawn limits enabled, as that seemed like a site-wide thing. I'm able to keep creating servers without any restriction both as admin and as a regular user.\r\n\r\nI tried waiting for the container to fully start before creating more in case it was a race condition, but that didn't seem to fix it either.\r\n\r\nNo warnings/errors in the logs, but it does seem to be tracking totals correctly:\r\n```\r\n[D 2019-10-02 21:47:00.809 JupyterHub base:787] 0/64 concurrent spawns\r\n[D 2019-10-02 21:47:00.809 JupyterHub base:792] 4 active servers\r\n```\r\n\r\nConfig dump, but there's not much of interest in there:\r\n```\r\nhub:\r\n  image:\r\n    name: 'XXXX/jupyter/zero-to-jupyterhub-k8s/dev/hub'\r\n    tag: 'latest'\r\n  imagePullPolicy: Always\r\n  imagePullSecret:\r\n    XXXX\r\n  nodeSelector:\r\n    workset: cpu\r\n  allowNamedServers: True\r\n  namedServerLimitPerUser: 3\r\n  extraConfig:\r\n    1: |\r\n       c.KubeSpawner.profile_list.append({'display_name': 'Debug Image', 'kubespawner_override': {'image': 'XXXX/jupyter/docker-stacks/dev/singleuser-dev:latest-shim'}})\r\n    2: |\r\n       c.JupyterHub.named_server_limit_per_user = 3\r\n\r\nsingleuser:\r\n  cmd: null\r\n  extraEnv:\r\n    DEVDEBUG: \"yespls\"\r\n  image:\r\n    name: 'XXXX/jupyter/docker-stacks/dev/singleuser-minimal'\r\n    tag: 'latest-shim'\r\n  imagePullPolicy: Always\r\n  imagePullSecret:\r\n    XXXX\r\n\r\n  profileList:\r\n   -  display_name: 'Minimal'\r\n      default: False\r\n      kubespawner_override:\r\n        image: 'XXXXX/jupyter/docker-stacks/dev/singleuser-minimal:latest-shim'\r\n        cpu_guarantee: 0.5\r\n        cpu_limit: 2\r\n        mem_limit: '4G'\r\n        node_selector:\r\n          workset: cpu\r\n  XXXX\r\n\r\nprePuller:\r\n  hook:\r\n    enabled: false\r\n  continuous:\r\n    enabled: false\r\n\r\ndebug:\r\n  enabled: true\r\n\r\nauth:\r\n  type: 'ldap'\r\n  XXX\r\n\r\nproxy:\r\n  secretToken: 'XXX'\r\n  service:\r\n    loadBalancerIP: XXX\r\n  nodeSelector:\r\n    workset: cpu\r\n  https:\r\n    enabled: true\r\n    type: manual\r\n    hosts:\r\n      - XXX\r\n    manual:\r\n      XXX\r\n```", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2758/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2758/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2685", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2685/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2685/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2685/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/2685", "id": 481093787, "node_id": "MDU6SXNzdWU0ODEwOTM3ODc=", "number": 2685, "title": "Reliability of RUNNING_SERVERS metric", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 16, "created_at": "2019-08-15T10:38:11Z", "updated_at": "2020-11-25T04:31:08Z", "closed_at": "2020-11-25T04:31:07Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "# UPDATE\r\n\r\nThis issue started out with me confused about RUNNING_SERVERS showing the wrong number, but that related to my use of JupyterHub 1.0.0 where [a bugfix](https://github.com/jupyterhub/jupyterhub/pull/2629) had not been implemented yet. Now this issue tracks if the metric is reliable enough.\r\n\r\n@GeorgianaElena wrote:\r\n> I'm still not very convinced that RUNNING_SERVERS works properly in the cases where an error occurs while adding the server to the proxy thinking.\r\n\r\n---\r\n\r\nI found that running_servers reported by the /hub/metrics endpoint were incorrect. My value was in reality 7 but the endpoint reported 3. So, I looked into this by [searching for `RUNNING_SERVERS`](https://github.com/jupyterhub/jupyterhub/search?q=running_servers&unscoped_q=running_servers) in the jupyterhub code base and tried to learn more about this.\r\n\r\n## What I learned\r\n\r\nI learned that the RUNNING_SERVER metric is defined here...\r\n\r\nhttps://github.com/jupyterhub/jupyterhub/blob/2320d59bd13af1298ac7bf68471e1e6d11ab691f/jupyterhub/metrics.py#L38-L40\r\n\r\n... and is initially configured from init_spawners() ...\r\n\r\nhttps://github.com/jupyterhub/jupyterhub/blob/9e0bb5cc71649e5fb19d07e4c72a967a72819219/jupyterhub/app.py#L1944-L1946\r\n\r\n... and that it is set and then increased within a spawn_single_user() ...\r\n\r\nhttps://github.com/jupyterhub/jupyterhub/blob/24c08292899492bb0bd5e2b7fdbf7e09cf1a4057/jupyterhub/handlers/base.py#L753-L762\r\n\r\n... that in turns will invoke a local finish_user_spawn() function ...\r\n\r\nhttps://github.com/jupyterhub/jupyterhub/blob/24c08292899492bb0bd5e2b7fdbf7e09cf1a4057/jupyterhub/handlers/base.py#L851-L870\r\n\r\n... and it is decremented after a successful stop() without errors ...\r\n\r\nhttps://github.com/jupyterhub/jupyterhub/blob/60f5ce0ff831dd3e5f5eade9eacd8b3812525bd6/jupyterhub/user.py#L763\r\n\r\n## Conclusions\r\nI'd like to verify if the initial value set in init_spawners() is correct. If it is, we can assume the logic of incrementing / decrementing this initially set value has an issue and focus on that. So, I did this and concluded that the metric reported by /hub/metrics were 0 after a hub restart, and that there was actually 4 servers running at that point, and that the /hub/admin listed these to be actually running. So whatever issue there is, the /hub/admin's list of running servers is out of sync with whatever is set during init_spawners() for me. I verified that I was able to go to -1 in running_servers by shutting down a currently running one.\r\n\r\nI think we can get a faulty count in RUNNING_SERVERS by incrementing / decrementing it conditionally on start / stop, and this is kind of what we indirectly is doing by doing it within `try` blocks instead of finally blocks. Perhaps we can improve something here?\r\n\r\n## Related\r\nhttps://github.com/jupyterhub/jupyterhub/pull/2629", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2685/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2685/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2683", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2683/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2683/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2683/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/2683", "id": 479950192, "node_id": "MDU6SXNzdWU0Nzk5NTAxOTI=", "number": 2683, "title": "pre_spawn_start exceptions may lead to redirect loop", "user": {"login": "clkao", "id": 69736, "node_id": "MDQ6VXNlcjY5NzM2", "avatar_url": "https://avatars.githubusercontent.com/u/69736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/clkao", "html_url": "https://github.com/clkao", "followers_url": "https://api.github.com/users/clkao/followers", "following_url": "https://api.github.com/users/clkao/following{/other_user}", "gists_url": "https://api.github.com/users/clkao/gists{/gist_id}", "starred_url": "https://api.github.com/users/clkao/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/clkao/subscriptions", "organizations_url": "https://api.github.com/users/clkao/orgs", "repos_url": "https://api.github.com/users/clkao/repos", "events_url": "https://api.github.com/users/clkao/events{/privacy}", "received_events_url": "https://api.github.com/users/clkao/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-08-13T04:12:17Z", "updated_at": "2019-09-19T13:53:09Z", "closed_at": "2019-09-19T13:53:09Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**Describe the bug**\r\n\r\nif we override authenticator `pre_spawn_start` with a coroutine and throw exceptions from it, it could lead to the redirect loop issue with an eventual 500 error, instead of showing the exception.  however, exceptions `options_from_form` are rendered properly as error message.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. override authenticator pre_spawn_start and throw exception from it\r\n2. try to launch user server from hub\r\n3. gets infinite redirect\r\n4. reload and see 500 error\r\n\r\n**Expected behavior**\r\n\r\nerrors are displayed in the spawner page\r\n\r\n\r\ncc/@aar0nTw \r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2683/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2683/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2667", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2667/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2667/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2667/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/2667", "id": 475426938, "node_id": "MDU6SXNzdWU0NzU0MjY5Mzg=", "number": 2667, "title": "/hub/admin should redirect to login", "user": {"login": "clkao", "id": 69736, "node_id": "MDQ6VXNlcjY5NzM2", "avatar_url": "https://avatars.githubusercontent.com/u/69736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/clkao", "html_url": "https://github.com/clkao", "followers_url": "https://api.github.com/users/clkao/followers", "following_url": "https://api.github.com/users/clkao/following{/other_user}", "gists_url": "https://api.github.com/users/clkao/gists{/gist_id}", "starred_url": "https://api.github.com/users/clkao/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/clkao/subscriptions", "organizations_url": "https://api.github.com/users/clkao/orgs", "repos_url": "https://api.github.com/users/clkao/repos", "events_url": "https://api.github.com/users/clkao/events{/privacy}", "received_events_url": "https://api.github.com/users/clkao/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-08-01T01:33:50Z", "updated_at": "2019-08-05T20:03:39Z", "closed_at": "2019-08-05T20:03:39Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**Describe the bug**\r\n\r\nWhen a user is not logged in, visiting /hub/admin page simply shows 403. we should redirect to the login page, and show 403 only if the user is indeed not admin.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to /hub/admin without login\r\n4. See error 403\r\n\r\n**Expected behavior**\r\n1. Go to /hub/admin without login\r\n2. See login page\r\n3. Upon login: if the user is admin, show the /hub/admin page, otherwise show 403", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2667/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2667/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2660", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2660/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2660/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2660/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/2660", "id": 472961332, "node_id": "MDU6SXNzdWU0NzI5NjEzMzI=", "number": 2660, "title": "Documentation theme is outdated on `stable`", "user": {"login": "choldgraf", "id": 1839645, "node_id": "MDQ6VXNlcjE4Mzk2NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/1839645?v=4", "gravatar_id": "", "url": "https://api.github.com/users/choldgraf", "html_url": "https://github.com/choldgraf", "followers_url": "https://api.github.com/users/choldgraf/followers", "following_url": "https://api.github.com/users/choldgraf/following{/other_user}", "gists_url": "https://api.github.com/users/choldgraf/gists{/gist_id}", "starred_url": "https://api.github.com/users/choldgraf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/choldgraf/subscriptions", "organizations_url": "https://api.github.com/users/choldgraf/orgs", "repos_url": "https://api.github.com/users/choldgraf/repos", "events_url": "https://api.github.com/users/choldgraf/events{/privacy}", "received_events_url": "https://api.github.com/users/choldgraf/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 356551766, "node_id": "MDU6TGFiZWwzNTY1NTE3NjY=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/documentation", "name": "documentation", "color": "fef2c0", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-07-25T16:30:53Z", "updated_at": "2020-06-15T10:14:39Z", "closed_at": "2020-06-15T10:14:39Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Hey all - I noticed that the JupyterHub documentation theme is buggy on the \"stable\" branch of readthedocs (which is also the default):\r\n\r\nhttps://jupyterhub.readthedocs.io/en/stable/index.html\r\n\r\nThe theme includes forward/next buttons, but they're also hard-coded in the theme, so they become doubled-up:\r\n\r\n![image](https://user-images.githubusercontent.com/1839645/61891536-b712e980-aebe-11e9-93a4-b03dbaefaf08.png)\r\n\r\n\"latest\" does not have this problem:\r\n\r\nhttps://jupyterhub.readthedocs.io/en/latest/installation-guide.html\r\n\r\nhowever, it is not the default in readthedocs. I think we could fix this by either:\r\n\r\n1. Backporting the documentation fix to the stable branch, which I guess would require updating the tag to the new commit? (I'm not actually sure how that works)\r\n2. Making a minor release of JupyterHub so that \"latest\" becomes \"stable\" and the documentation is then updated.\r\n\r\nWhat do y'all think?", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2660/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2660/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2623", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2623/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2623/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2623/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/2623", "id": 461699279, "node_id": "MDU6SXNzdWU0NjE2OTkyNzk=", "number": 2623, "title": "Jupyetrhub logs in without login prompt when user is logged out of authenticating app", "user": {"login": "lakshaykc", "id": 29871062, "node_id": "MDQ6VXNlcjI5ODcxMDYy", "avatar_url": "https://avatars.githubusercontent.com/u/29871062?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lakshaykc", "html_url": "https://github.com/lakshaykc", "followers_url": "https://api.github.com/users/lakshaykc/followers", "following_url": "https://api.github.com/users/lakshaykc/following{/other_user}", "gists_url": "https://api.github.com/users/lakshaykc/gists{/gist_id}", "starred_url": "https://api.github.com/users/lakshaykc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lakshaykc/subscriptions", "organizations_url": "https://api.github.com/users/lakshaykc/orgs", "repos_url": "https://api.github.com/users/lakshaykc/repos", "events_url": "https://api.github.com/users/lakshaykc/events{/privacy}", "received_events_url": "https://api.github.com/users/lakshaykc/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 958034846, "node_id": "MDU6TGFiZWw5NTgwMzQ4NDY=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/authenticators", "name": "authenticators", "color": "c5def5", "default": false, "description": ""}, {"id": 1280242352, "node_id": "MDU6TGFiZWwxMjgwMjQyMzUy", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/support", "name": "support", "color": "Cfaef7", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-06-27T19:02:37Z", "updated_at": "2022-05-22T14:10:46Z", "closed_at": "2022-05-22T14:10:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nOnce the user is authenticated using GenericOAuthenticator, jupyterhub remains logged in even if the user logs out of the authenticating app. The correct behavior as pointed out in [this comment](https://github.com/jupyterhub/jupyterhub/issues/1805#issuecomment-383117923) should be that the user is asked to login in again to the authenticating application.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Setup OAuth with GenericOAuthenticator\r\n2. Login to the authenticating app\r\n3. Login to jupyterhub (Sign in using GenericOAuth2). Since you're already logged in the authenticating app, jupyterhub should directly open the notebook server\r\n4. Log out of the authenticating app\r\n5. Log out of jupyterhub\r\n6. Login to jupyterhub without first logging to the authenticating app\r\n7. Jupyterhub logs in without asking for credentials. So you're able to login to jupyterhub even though you're logged out of the authenticating app\r\n\r\n**Expected behavior**\r\nIf you're logged out of the authenticating app, jupyterhub login should redirect to sign in to the authenticating app instead of directly logging in. \r\n\r\n**Desktop (please complete the following information):**\r\n - OS: jupyterhub on Linux (google cloud kubernetes engine)\r\n - Browser: chrome on windows\r\n - Version: 0.8.2\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2623/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2623/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2448", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2448/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2448/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2448/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/2448", "id": 416403046, "node_id": "MDU6SXNzdWU0MTY0MDMwNDY=", "number": 2448, "title": "Tornado 6.0 and JupyterHub issue", "user": {"login": "huseinzol05", "id": 19810909, "node_id": "MDQ6VXNlcjE5ODEwOTA5", "avatar_url": "https://avatars.githubusercontent.com/u/19810909?v=4", "gravatar_id": "", "url": "https://api.github.com/users/huseinzol05", "html_url": "https://github.com/huseinzol05", "followers_url": "https://api.github.com/users/huseinzol05/followers", "following_url": "https://api.github.com/users/huseinzol05/following{/other_user}", "gists_url": "https://api.github.com/users/huseinzol05/gists{/gist_id}", "starred_url": "https://api.github.com/users/huseinzol05/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/huseinzol05/subscriptions", "organizations_url": "https://api.github.com/users/huseinzol05/orgs", "repos_url": "https://api.github.com/users/huseinzol05/repos", "events_url": "https://api.github.com/users/huseinzol05/events{/privacy}", "received_events_url": "https://api.github.com/users/huseinzol05/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2019-03-02T14:35:08Z", "updated_at": "2020-03-12T11:52:03Z", "closed_at": "2019-07-30T19:22:23Z", "author_association": "NONE", "active_lock_reason": null, "body": "I want to deploy Github authentication behind Nginx,\r\n\r\nThis is my jupyterhub config,\r\n```python\r\nfrom oauthenticator.github import GitHubOAuthenticator\r\n\r\nc.JupyterHub.allow_named_servers = True\r\nc.JupyterHub.authenticator_class = GitHubOAuthenticator\r\nc.GitHubOAuthenticator.oauth_callback_url = (\r\n    'https://jupyterhub.dev.bitcurate.com/hub/oauth_callback'\r\n)\r\nc.GitHubOAuthenticator.client_id = '354163794ed454598dd2'\r\nc.GitHubOAuthenticator.client_secret = (\r\n    '6351525872a75567a6c6ed45356b254a7802edbd'\r\n)\r\nc.LocalAuthenticator.create_system_users = True\r\n```\r\n\r\nAnd this is my nginx conf,\r\n```text\r\nserver {\r\n\tserver_name jupyterhub.example.com;\r\n\r\n  location / {\r\n\t\tproxy_pass http://jupyterhub:8000;\r\n\t\tproxy_set_header X-Real-IP $remote_addr;\r\n            proxy_set_header Host $host;\r\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\r\n\t}\r\n\tlocation ~* /(user/[^/]*)/(api/kernels/[^/]+/channels|terminals/websocket)/? {\r\n            proxy_pass http://jupyterhub:8000;\r\n\r\n            proxy_set_header X-Real-IP $remote_addr;\r\n            proxy_set_header Host $host;\r\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\r\n\r\n            proxy_set_header X-NginX-Proxy true;\r\n\r\n            # WebSocket support\r\n            proxy_http_version 1.1;\r\n            proxy_set_header Upgrade $http_upgrade;\r\n            proxy_set_header Connection \"upgrade\";\r\n            proxy_read_timeout 86400;\r\n\r\n        }\r\n\r\n    ssl_stapling on;\r\n    ssl_stapling_verify on;\r\n    add_header Strict-Transport-Security max-age=15768000;\r\n\r\n    listen 443 ssl; # managed by Certbot\r\n    ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem; # managed by Certbot\r\n    ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem; # managed by Certbot\r\n    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot\r\n    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot\r\n\r\n\r\n}\r\n\r\nserver {\r\n    if ($host = jupyterhub.example.com) {\r\n        return 301 https://$host$request_uri;\r\n    } # managed by Certbot\r\n\r\n\r\n    \tlisten 80;\r\n    \tserver_name jupyterhub.example.com;\r\n    return 404; # managed by Certbot\r\n\r\n\r\n}\r\n```\r\n\r\nWhen I authenticated my github account,\r\n```text\r\n[E 2019-03-02 14:17:41.714 JupyterHub web:1788] Uncaught exception GET /hub/oauth_callback?code=98fb6895817a1078ebd6&state=eyJzdGF0ZV9pZCI6ICJlM2Y1OWQ1YTI3Yjg0ODFhYTZkNDI2MzBmZTQ3Yjg0ZSIsICJuZXh0X3VybCI6ICIifQ%3D%3D (42.191.185.51)\r\n\r\n    HTTPServerRequest(protocol='http', host='jupyterhub.dev.bitcurate.com', method='GET', uri='/hub/oauth_callback?code=98fb6895817a1078ebd6&state=eyJzdGF0ZV9pZCI6ICJlM2Y1OWQ1YTI3Yjg0ODFhYTZkNDI2MzBmZTQ3Yjg0ZSIsICJuZXh0X3VybCI6ICIifQ%3D%3D', version='HTTP/1.1', remote_ip='42.191.185.51')\r\n\r\n    Traceback (most recent call last):\r\n      File \"/usr/local/lib/python3.6/dist-packages/tornado/web.py\", line 1699, in _execute\r\n        result = await result\r\n      File \"/usr/local/lib/python3.6/dist-packages/oauthenticator/oauth2.py\", line 191, in get\r\n        user = yield self.login_user()\r\n      File \"/usr/local/lib/python3.6/dist-packages/jupyterhub/handlers/base.py\", line 473, in login_user\r\n        authenticated = await self.authenticate(data)\r\n      File \"/usr/local/lib/python3.6/dist-packages/jupyterhub/auth.py\", line 257, in get_authenticated_user\r\n        authenticated = await maybe_future(self.authenticate(handler, data))\r\n      File \"/usr/local/lib/python3.6/dist-packages/oauthenticator/github.py\", line 116, in authenticate\r\n        resp = yield http_client.fetch(req)\r\n    tornado.simple_httpclient.HTTPStreamClosedError: Stream closed\r\n\r\n[E 2019-03-02 14:17:41.716 JupyterHub log:150] {\r\n      \"X-Forwarded-Host\": \"jupyterhub.example.com\",\r\n      \"X-Forwarded-Proto\": \"http\",\r\n      \"X-Forwarded-Port\": \"80\",\r\n      \"Cookie\": \"_ga=GA1.2.1046683617.1549628873; _gid=GA1.2.1632910557.1551529980; _gat=1; oauthenticator-state=\\\"2|1:0|10:1551536260|20:oauthenticator-state|120:ZXlKemRHRjBaVjlwWkNJNklDSmxNMlkxT1dRMVlUSTNZamcwT0RGaFlUWmtOREkyTXpCbVpUUTNZamcwWlNJc0lDSnVaWGgwWDNWeWJDSTZJQ0lpZlE9PQ==|49068ce687962d0354ae793824f49e843d4e826c2911fd6580c2288fd55e23e5\\\"\",\r\n      \"Accept-Language\": \"en-MY,en;q=0.9,en-US;q=0.8,ms;q=0.7\",\r\n      \"Accept-Encoding\": \"gzip, deflate, br\",\r\n      \"Referer\": \"https://jupyterhub.example.com/hub/login\",\r\n      \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\",\r\n      \"User-Agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.119 Safari/537.36\",\r\n      \"Upgrade-Insecure-Requests\": \"1\",\r\n      \"Connection\": \"close\",\r\n      \"X-Forwarded-For\": \"42.191.185.51,::ffff:172.18.0.4\",\r\n      \"Host\": \"jupyterhub.example.com\",\r\n      \"X-Real-Ip\": \"42.191.185.51\"\r\n    }\r\n\r\n\r\n[E 2019-03-02 14:17:41.716 JupyterHub log:158] 500 GET /hub/oauth_callback?code=[secret]&state=[secret] (@42.191.185.51) 325.77ms\r\n14:18:52.369 [ConfigProxy] info: 200 GET /api/routes \r\n[I 2019-03-02 14:18:52.369 JupyterHub proxy:301] Checking routes\r\n```\r\n\r\nAnyone can help me sort this out?", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2448/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2448/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2366", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2366/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2366/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2366/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/2366", "id": 393541471, "node_id": "MDU6SXNzdWUzOTM1NDE0NzE=", "number": 2366, "title": "Failed spawns are still added to the proxy", "user": {"login": "hhuuggoo", "id": 249407, "node_id": "MDQ6VXNlcjI0OTQwNw==", "avatar_url": "https://avatars.githubusercontent.com/u/249407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hhuuggoo", "html_url": "https://github.com/hhuuggoo", "followers_url": "https://api.github.com/users/hhuuggoo/followers", "following_url": "https://api.github.com/users/hhuuggoo/following{/other_user}", "gists_url": "https://api.github.com/users/hhuuggoo/gists{/gist_id}", "starred_url": "https://api.github.com/users/hhuuggoo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hhuuggoo/subscriptions", "organizations_url": "https://api.github.com/users/hhuuggoo/orgs", "repos_url": "https://api.github.com/users/hhuuggoo/repos", "events_url": "https://api.github.com/users/hhuuggoo/events{/privacy}", "received_events_url": "https://api.github.com/users/hhuuggoo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-12-21T17:52:19Z", "updated_at": "2020-10-29T00:22:23Z", "closed_at": "2020-10-29T00:22:23Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\n\r\nIf a spawn fails for a named server (for example, due to a timeout), The dead server will still be added to proxy and considered `ready` \r\n\r\nI believe the issue is that the notion of `ready` inside jupyterhub is based on:\r\nhttps://github.com/jupyterhub/jupyterhub/blob/master/jupyterhub/spawner.py#L87\r\nwhich defines it as not being `pending` and having a `server`.  but jupyterhub assigns servers before we even start spawning.\r\nhttps://github.com/jupyterhub/jupyterhub/blob/master/jupyterhub/user.py#L410\r\nAnd if the spawn fails, it's no longer \"pending\" therefore it becomes ready as soon as it has failed.  Then we go through looking for missing routes and we add them based on this ready flag, periodically.\r\nhttps://github.com/jupyterhub/jupyterhub/blob/master/jupyterhub/proxy.py#L322\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n- Start jupyterhub (I'm using the kubespawner jupyterhub_config)\r\n- set the spawner timeout to be 1 second \r\n- create a named server\r\n- the server will be added to the page, but that server will not work.\r\n\r\n**Expected behavior**\r\n-  failed spawns should not show up and be represented as valiid server\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: [e.g. iOS]\r\n - Browser [e.g. chrome, safari]\r\n - Version [e.g. 22]\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2366/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2366/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2321", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2321/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2321/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2321/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/2321", "id": 382889980, "node_id": "MDExOlB1bGxSZXF1ZXN0MjMyNDkxNjMw", "number": 2321, "title": "[WIP] Moved PAM session creations to a preexec_fn", "user": {"login": "cmaves", "id": 11412214, "node_id": "MDQ6VXNlcjExNDEyMjE0", "avatar_url": "https://avatars.githubusercontent.com/u/11412214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cmaves", "html_url": "https://github.com/cmaves", "followers_url": "https://api.github.com/users/cmaves/followers", "following_url": "https://api.github.com/users/cmaves/following{/other_user}", "gists_url": "https://api.github.com/users/cmaves/gists{/gist_id}", "starred_url": "https://api.github.com/users/cmaves/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cmaves/subscriptions", "organizations_url": "https://api.github.com/users/cmaves/orgs", "repos_url": "https://api.github.com/users/cmaves/repos", "events_url": "https://api.github.com/users/cmaves/events{/privacy}", "received_events_url": "https://api.github.com/users/cmaves/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-11-20T23:25:58Z", "updated_at": "2020-10-15T18:50:34Z", "closed_at": "2020-10-15T18:50:34Z", "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/2321", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/2321", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/2321.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/2321.patch", "merged_at": null}, "body": "PAM sessions are intended to be created within the spawned child\r\nprocess, not in the parent process. This can create issues with\r\ncertain PAM session modules (i.e. pam-systemd.so)\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2321/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2321/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2202", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2202/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2202/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2202/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/2202", "id": 364716031, "node_id": "MDU6SXNzdWUzNjQ3MTYwMzE=", "number": 2202, "title": "Example #3 - Run a shell script  has a bug", "user": {"login": "mdivk", "id": 10734547, "node_id": "MDQ6VXNlcjEwNzM0NTQ3", "avatar_url": "https://avatars.githubusercontent.com/u/10734547?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mdivk", "html_url": "https://github.com/mdivk", "followers_url": "https://api.github.com/users/mdivk/followers", "following_url": "https://api.github.com/users/mdivk/following{/other_user}", "gists_url": "https://api.github.com/users/mdivk/gists{/gist_id}", "starred_url": "https://api.github.com/users/mdivk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mdivk/subscriptions", "organizations_url": "https://api.github.com/users/mdivk/orgs", "repos_url": "https://api.github.com/users/mdivk/repos", "events_url": "https://api.github.com/users/mdivk/events{/privacy}", "received_events_url": "https://api.github.com/users/mdivk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 106589226, "node_id": "MDU6TGFiZWwxMDY1ODkyMjY=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/help%20wanted", "name": "help wanted", "color": "0e8a16", "default": true, "description": null}, {"id": 718757389, "node_id": "MDU6TGFiZWw3MTg3NTczODk=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/hacktoberfest", "name": "hacktoberfest", "color": "f9d0c4", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-09-28T02:15:49Z", "updated_at": "2018-10-12T09:10:11Z", "closed_at": "2018-10-12T09:10:11Z", "author_association": "NONE", "active_lock_reason": null, "body": "In the script in Example #3:\r\n\r\n> USER=$1\r\n> if [\"$USER\" == \"\"]; then\r\n>     exit 1\r\n> fi\r\n\r\nThere should be space inside the if condition. A few lines later another if condition is correct:\r\n\r\n> if [ -d \"$USER_DIRECTORY\" ]; then", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2202/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2202/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2182", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2182/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2182/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2182/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/2182", "id": 363163755, "node_id": "MDU6SXNzdWUzNjMxNjM3NTU=", "number": 2182, "title": "hub/login - breadcrumb with no content", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 373221162, "node_id": "MDU6TGFiZWwzNzMyMjExNjI=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/user%20experience", "name": "user experience", "color": "ff9933", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-09-24T14:10:34Z", "updated_at": "2020-08-27T09:15:51Z", "closed_at": "2020-08-27T09:15:51Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "On mobile, while visiting the login page, the breadcrumb can be seen at the top right corner. When clicked, it shows no content.\r\n\r\n![breadcrumb](https://user-images.githubusercontent.com/3837114/45957014-4851cf00-c014-11e8-8fa4-984fdb04895b.gif)\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2182/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2182/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2146", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2146/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2146/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2146/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/2146", "id": 359780703, "node_id": "MDU6SXNzdWUzNTk3ODA3MDM=", "number": 2146, "title": "API handlers are returning text/html responses", "user": {"login": "cristofersanz", "id": 1121177, "node_id": "MDQ6VXNlcjExMjExNzc=", "avatar_url": "https://avatars.githubusercontent.com/u/1121177?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cristofersanz", "html_url": "https://github.com/cristofersanz", "followers_url": "https://api.github.com/users/cristofersanz/followers", "following_url": "https://api.github.com/users/cristofersanz/following{/other_user}", "gists_url": "https://api.github.com/users/cristofersanz/gists{/gist_id}", "starred_url": "https://api.github.com/users/cristofersanz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cristofersanz/subscriptions", "organizations_url": "https://api.github.com/users/cristofersanz/orgs", "repos_url": "https://api.github.com/users/cristofersanz/repos", "events_url": "https://api.github.com/users/cristofersanz/events{/privacy}", "received_events_url": "https://api.github.com/users/cristofersanz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 543988001, "node_id": "MDU6TGFiZWw1NDM5ODgwMDE=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/needs:%20upstream%20action", "name": "needs: upstream action", "color": "c2e0c6", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2018-09-13T07:48:35Z", "updated_at": "2018-09-24T09:03:19Z", "closed_at": "2018-09-24T09:03:19Z", "author_association": "NONE", "active_lock_reason": null, "body": "I've recently upgrade to v0.9.3 from v0.8.0. When I try to make a request to any of the API endpoints (`/hub/api/info` - for instance) I'm getting back the header Content-Type set to text/html instead of application/json as it used to be prior the upgrade.\r\n\r\nShould I use some configuration parameter, maybe related to tornado?\r\n\r\nThanks!", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2146/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2146/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2043", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2043/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2043/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2043/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/2043", "id": 341656383, "node_id": "MDU6SXNzdWUzNDE2NTYzODM=", "number": 2043, "title": "Hub out of sync with k8s cluster", "user": {"login": "ryanlovett", "id": 10248125, "node_id": "MDQ6VXNlcjEwMjQ4MTI1", "avatar_url": "https://avatars.githubusercontent.com/u/10248125?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ryanlovett", "html_url": "https://github.com/ryanlovett", "followers_url": "https://api.github.com/users/ryanlovett/followers", "following_url": "https://api.github.com/users/ryanlovett/following{/other_user}", "gists_url": "https://api.github.com/users/ryanlovett/gists{/gist_id}", "starred_url": "https://api.github.com/users/ryanlovett/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ryanlovett/subscriptions", "organizations_url": "https://api.github.com/users/ryanlovett/orgs", "repos_url": "https://api.github.com/users/ryanlovett/repos", "events_url": "https://api.github.com/users/ryanlovett/events{/privacy}", "received_events_url": "https://api.github.com/users/ryanlovett/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 1012983489, "node_id": "MDU6TGFiZWwxMDEyOTgzNDg5", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/priority:%20high", "name": "priority: high", "color": "9e142d", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 17, "created_at": "2018-07-16T19:57:02Z", "updated_at": "2020-10-06T21:59:31Z", "closed_at": "2020-10-06T21:59:30Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "[**Temporary fix**](https://github.com/jupyterhub/jupyterhub/issues/2043#issuecomment-410069870)\r\n\r\n---\r\n\r\nOn chart 0.6. Our hub has been periodically having problems where it won't permit current or new user servers to start. Users see 503 errors when visiting /user-redirect/git-sync (their primary entry point).  When this happens, the hub's view of users servers at /hub/admin is out of sync with the cluster's view of them via `get pods`. Killing the hub pod gets users past this problem, though there are lingering issues. For example one user's pod was still up but the hub thought the server wasn't running.\r\n\r\nI realize this isn't much to go on. I've asked the instructors to preserve the hub logs the next time this problem comes up.\r\n\r\n```\r\nServer Version: version.Info{Major:\"1\", Minor:\"10+\", GitVersion:\"v1.10.2-gke.3\", GitCommit:\"d2c7a2bd41036f9474287579a725dc54c904e92d\", GitTreeState:\"clean\", BuildDate:\"2018-05-23T00:19:39Z\", GoVersion:\"go1.9.3b4\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n```", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2043/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2043/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2005", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2005/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2005/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2005/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/2005", "id": 334475864, "node_id": "MDU6SXNzdWUzMzQ0NzU4NjQ=", "number": 2005, "title": "Redirect to login page broken when using baseUrl", "user": {"login": "betatim", "id": 1448859, "node_id": "MDQ6VXNlcjE0NDg4NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1448859?v=4", "gravatar_id": "", "url": "https://api.github.com/users/betatim", "html_url": "https://github.com/betatim", "followers_url": "https://api.github.com/users/betatim/followers", "following_url": "https://api.github.com/users/betatim/following{/other_user}", "gists_url": "https://api.github.com/users/betatim/gists{/gist_id}", "starred_url": "https://api.github.com/users/betatim/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/betatim/subscriptions", "organizations_url": "https://api.github.com/users/betatim/orgs", "repos_url": "https://api.github.com/users/betatim/repos", "events_url": "https://api.github.com/users/betatim/events{/privacy}", "received_events_url": "https://api.github.com/users/betatim/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-06-21T12:42:29Z", "updated_at": "2018-08-01T08:17:59Z", "closed_at": "2018-08-01T08:17:59Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Freshly deployed vanilla hub using the zero2jupyterhub chart (v0.7-8b9cb79) on google cloud. None standard parts are that this uses an nginx-ingress to route traffic to the hub which is at example.com/foobar.\r\n\r\nhttp://example.com/foobar redirects to http://example.com/foobar/hub/foobar but http://example.com/foobar/ redirects to http://example.com/foobar/hub/login.\r\n\r\nVia @minrk and @chicocvenancio\r\n\r\n> Yeah, I'm guessing it's not redirecting correctly without the trailing slash. I think there's a check for if not startswith(prefix) and it probably incorrectly returns False on the edge case where the trailing slash is missing\r\n> I think it's PrefixRedirectHandler \r\n>\r\n> `base_url` is defined as having the trailing slash https://github.com/jupyterhub/jupyterhub/blob/master/jupyterhub/handlers/base.py#L63", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2005/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/2005/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1982", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1982/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1982/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1982/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/1982", "id": 332518990, "node_id": "MDU6SXNzdWUzMzI1MTg5OTA=", "number": 1982, "title": "User with a tilde in the name is being left as active without user activity", "user": {"login": "chicocvenancio", "id": 188585, "node_id": "MDQ6VXNlcjE4ODU4NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/188585?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chicocvenancio", "html_url": "https://github.com/chicocvenancio", "followers_url": "https://api.github.com/users/chicocvenancio/followers", "following_url": "https://api.github.com/users/chicocvenancio/following{/other_user}", "gists_url": "https://api.github.com/users/chicocvenancio/gists{/gist_id}", "starred_url": "https://api.github.com/users/chicocvenancio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chicocvenancio/subscriptions", "organizations_url": "https://api.github.com/users/chicocvenancio/orgs", "repos_url": "https://api.github.com/users/chicocvenancio/repos", "events_url": "https://api.github.com/users/chicocvenancio/events{/privacy}", "received_events_url": "https://api.github.com/users/chicocvenancio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-06-14T18:41:54Z", "updated_at": "2018-06-15T12:38:40Z", "closed_at": "2018-06-15T12:38:40Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "\r\n**Describe the bug**\r\nUser with a tilde in the name is being left as active without user activity, preventing culling.\r\n\r\n**To Reproduce**\r\n1. Login with an user with a tilde \r\n2. Start a server, \r\n3. Close browser \r\n4. Start cull_idle_servers.py with debug logging\r\n5. See user's server not being culled due to \"being active\"\r\n**Expected behavior**\r\nUser to become inactive once browser is closed\r\n\r\n**Additional context**\r\nThis seems related to the continous add and removal of the route to the user server by the proxy. Log excerpt:\r\n\r\n> [I 2018-06-14 18:32:31.720 JupyterHub proxy:240] Adding user ~TestJH to proxy /paws/user/~TestJH/ => http://[REDACTED]:8888\r\n> [I 2018-06-14 18:33:31.755 JupyterHub proxy:299] Checking routes\r\n> [W 2018-06-14 18:33:31.755 JupyterHub proxy:322] Adding missing route for /paws/user/~TestJH/ (<jupyterhub.objects.Server object at 0x7f8d89d0a240>)\r\n> [W 2018-06-14 18:33:31.756 JupyterHub proxy:361] Deleting stale route /paws/user/%7ETestJH/\r\n> [I 2018-06-14 18:33:31.756 JupyterHub proxy:240] Adding user ~TestJH to proxy /paws/user/~TestJH/ => http://[REDACTED]:8888\r\n> [I 2018-06-14 18:34:31.713 JupyterHub proxy:299] Checking routes\r\n> [W 2018-06-14 18:34:31.714 JupyterHub proxy:322] Adding missing route for /paws/user/~TestJH/ (<jupyterhub.objects.Server object at 0x7f8d89d0a240>)\r\n> [I 2018-06-14 18:34:31.714 JupyterHub proxy:240] Adding user ~TestJH to proxy /paws/user/~TestJH/ => http://[REDACTED]:8888\r\n> [I 2018-06-14 18:35:31.770 JupyterHub proxy:299] Checking routes\r\n> [W 2018-06-14 18:35:31.771 JupyterHub proxy:322] Adding missing route for /paws/user/~TestJH/ (<jupyterhub.objects.Server object at 0x7f8d89d0a240>)\r\n> [W 2018-06-14 18:35:31.771 JupyterHub proxy:361] Deleting stale route /paws/user/%7ETestJH/\r\n> [I 2018-06-14 18:35:31.771 JupyterHub proxy:240] Adding user ~TestJH to proxy /paws/user/~TestJH/ => http://[REDACTED]:8888\r\n> [I 2018-06-14 18:36:31.718 JupyterHub proxy:299] Checking routes\r\n> [W 2018-06-14 18:36:31.719 JupyterHub proxy:322] Adding missing route for /paws/user/~TestJH/ (<jupyterhub.objects.Server object at 0x7f8d89d0a240>)\r\n> [I 2018-06-14 18:36:31.720 JupyterHub proxy:240] Adding user ~TestJH to proxy /paws/user/~TestJH/ => http://[REDACTED]:8888\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1982/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1982/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1886", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1886/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1886/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1886/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/1886", "id": 322618792, "node_id": "MDU6SXNzdWUzMjI2MTg3OTI=", "number": 1886, "title": "Base url not respected in 0.9.0b1", "user": {"login": "chicocvenancio", "id": 188585, "node_id": "MDQ6VXNlcjE4ODU4NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/188585?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chicocvenancio", "html_url": "https://github.com/chicocvenancio", "followers_url": "https://api.github.com/users/chicocvenancio/followers", "following_url": "https://api.github.com/users/chicocvenancio/following{/other_user}", "gists_url": "https://api.github.com/users/chicocvenancio/gists{/gist_id}", "starred_url": "https://api.github.com/users/chicocvenancio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chicocvenancio/subscriptions", "organizations_url": "https://api.github.com/users/chicocvenancio/orgs", "repos_url": "https://api.github.com/users/chicocvenancio/repos", "events_url": "https://api.github.com/users/chicocvenancio/events{/privacy}", "received_events_url": "https://api.github.com/users/chicocvenancio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 356551766, "node_id": "MDU6TGFiZWwzNTY1NTE3NjY=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/documentation", "name": "documentation", "color": "fef2c0", "default": true, "description": null}, {"id": 388386197, "node_id": "MDU6TGFiZWwzODgzODYxOTc=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/needs:%20testing", "name": "needs: testing", "color": "c2e0c6", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/milestones/9", "html_url": "https://github.com/jupyterhub/jupyterhub/milestone/9", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/milestones/9/labels", "id": 2254898, "node_id": "MDk6TWlsZXN0b25lMjI1NDg5OA==", "number": 9, "title": "0.9", "description": "", "creator": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 25, "state": "closed", "created_at": "2017-01-16T14:39:09Z", "updated_at": "2018-06-15T13:39:51Z", "due_on": null, "closed_at": "2018-06-15T13:39:51Z"}, "comments": 5, "created_at": "2018-05-13T19:04:55Z", "updated_at": "2018-05-15T11:21:20Z", "closed_at": "2018-05-15T11:07:45Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Hi! Thanks for using JupyterHub.\r\n\r\nIf you are reporting an issue with JupyterHub:\r\n\r\n- Please use the [GitHub issue](https://github.com/jupyterhub/jupyterhub/issues)\r\n  search feature to check if your issue has been asked already. If it has,\r\n  please add your comments to the existing issue.\r\n\r\n- Where applicable, please fill out the details below to help us troubleshoot\r\n  the issue that you are facing. Please be as thorough as you are able to\r\n  provide details on the issue.\r\n\r\n**How to reproduce the issue**\r\nUpdate to 0.9.0b1 with a `JupyterHub.bind_url` set and attempt to reach the hub at https://hostname/base_url/hub\r\n\r\n**What you expected to happen**\r\nAccess hub home page\r\n**What actually happens**\r\nRedirected to https://hostname/hub/base_url/hub were an understandable 404 is given.\r\n\r\n**Share what version of JupyterHub you are using**\r\n0.9.0b1\r\n\r\n\r\nIt is also notable that https://hostname/hub/ does lead to the hub home page.\r\n\r\nSeeing the introduction of `JupyterHub.bind_url`, this may be only a documentation issue, is `JupyterHub.base_url` deprecated?", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1886/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1886/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1879", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1879/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1879/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1879/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/1879", "id": 321687397, "node_id": "MDU6SXNzdWUzMjE2ODczOTc=", "number": 1879, "title": "Default post_stop_hook logs an exception during shutdown ", "user": {"login": "paccorsi", "id": 13418502, "node_id": "MDQ6VXNlcjEzNDE4NTAy", "avatar_url": "https://avatars.githubusercontent.com/u/13418502?v=4", "gravatar_id": "", "url": "https://api.github.com/users/paccorsi", "html_url": "https://github.com/paccorsi", "followers_url": "https://api.github.com/users/paccorsi/followers", "following_url": "https://api.github.com/users/paccorsi/following{/other_user}", "gists_url": "https://api.github.com/users/paccorsi/gists{/gist_id}", "starred_url": "https://api.github.com/users/paccorsi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/paccorsi/subscriptions", "organizations_url": "https://api.github.com/users/paccorsi/orgs", "repos_url": "https://api.github.com/users/paccorsi/repos", "events_url": "https://api.github.com/users/paccorsi/events{/privacy}", "received_events_url": "https://api.github.com/users/paccorsi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/milestones/9", "html_url": "https://github.com/jupyterhub/jupyterhub/milestone/9", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/milestones/9/labels", "id": 2254898, "node_id": "MDk6TWlsZXN0b25lMjI1NDg5OA==", "number": 9, "title": "0.9", "description": "", "creator": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 25, "state": "closed", "created_at": "2017-01-16T14:39:09Z", "updated_at": "2018-06-15T13:39:51Z", "due_on": null, "closed_at": "2018-06-15T13:39:51Z"}, "comments": 1, "created_at": "2018-05-09T18:59:17Z", "updated_at": "2018-05-14T12:31:40Z", "closed_at": "2018-05-14T12:31:40Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**How to reproduce the issue**\r\nRun Jupyterhub without implementing a `post_stop_hook` in the config.\r\n\r\n**What you expected to happen**\r\nA `post_stop_hook` with a value `None` (the default value) should not be called.\r\n\r\n**What actually happens**\r\nThe default value of `post_stop_hook` is None. When it is called as a function, during shutdown, it logically raises an exception:\r\n```\r\npost_stop_hook failed with exception: object at 0x7fdf90804ef0>\r\n    1   \u2502 Traceback (most recent call last):\r\n    2   \u2502 \u2502 File \"/opt/conda/lib/python3.6/site-packages/jupyterhub/spawner.py\", line 707, in run_post_stop_hook\r\n    3   \u2502 \u2502 \u2502 return self.post_stop_hook(self)\r\n    4   \u2502 TypeError: 'NoneType' object is not callable\r\n```\r\nThis exception is then caught by the try/catch block and logged.\r\n\r\n**Share what version of JupyterHub you are using**\r\nJupyterhub 0.9.0b1\r\n\r\nI believe an easy fix would be to check the value of `post_stop_hook`, like it was done with `pre_spawn_hook`: https://github.com/jupyterhub/jupyterhub/blob/master/jupyterhub/spawner.py#L701", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1879/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1879/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1804", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1804/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1804/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1804/events", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/1804", "id": 314381329, "node_id": "MDExOlB1bGxSZXF1ZXN0MTgxNjc4MjIx", "number": 1804, "title": "/user/someone-else redirection retain query strings", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-04-15T03:10:40Z", "updated_at": "2018-04-16T08:11:13Z", "closed_at": "2018-04-16T08:11:12Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/pulls/1804", "html_url": "https://github.com/jupyterhub/jupyterhub/pull/1804", "diff_url": "https://github.com/jupyterhub/jupyterhub/pull/1804.diff", "patch_url": "https://github.com/jupyterhub/jupyterhub/pull/1804.patch", "merged_at": "2018-04-16T08:11:12Z"}, "body": "Closes #1769 - A redirect from `/user/someone-else-user-account` to `/user/my-user-account` now retain query strings on redirection.\r\n\r\nI simply copy-pasted the \"retain query string\"-logic from this redirection that functioned properly already.\r\nhttps://github.com/jupyterhub/jupyterhub/blob/58069d015be486085351c98c14fd2181a58528c1/jupyterhub/handlers/base.py#L1011-L1017", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1804/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1804/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1785", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1785/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1785/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1785/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/1785", "id": 312576543, "node_id": "MDU6SXNzdWUzMTI1NzY1NDM=", "number": 1785, "title": "Recover from 504 bad gateway with busy singleuser server", "user": {"login": "clkao", "id": 69736, "node_id": "MDQ6VXNlcjY5NzM2", "avatar_url": "https://avatars.githubusercontent.com/u/69736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/clkao", "html_url": "https://github.com/clkao", "followers_url": "https://api.github.com/users/clkao/followers", "following_url": "https://api.github.com/users/clkao/following{/other_user}", "gists_url": "https://api.github.com/users/clkao/gists{/gist_id}", "starred_url": "https://api.github.com/users/clkao/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/clkao/subscriptions", "organizations_url": "https://api.github.com/users/clkao/orgs", "repos_url": "https://api.github.com/users/clkao/repos", "events_url": "https://api.github.com/users/clkao/events{/privacy}", "received_events_url": "https://api.github.com/users/clkao/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2018-04-09T15:25:35Z", "updated_at": "2021-02-17T19:55:40Z", "closed_at": "2021-02-17T19:55:40Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**How to reproduce the issue**\r\n\r\nMake the single user server very busy so it stops to respond to port 8888. for example moving lots of files over nfs.\r\n\r\n**What you expected to happen**\r\n\r\nUser can still access the singleuser server, or be prompted about server stopped responding and options to manually restart it.\r\n\r\n**What actually happens**\r\n\r\nProxy ended up with 504 bad gateway.\r\n\r\n**Share what version of JupyterHub you are using**\r\n\r\n0.9-dev & kubespawner\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1785/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1785/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1769", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1769/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1769/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1769/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/1769", "id": 310343071, "node_id": "MDU6SXNzdWUzMTAzNDMwNzE=", "number": 1769, "title": "Query strings are lost in between /user/redirect/ and /user/my-username/", "user": {"login": "consideRatio", "id": 3837114, "node_id": "MDQ6VXNlcjM4MzcxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3837114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/consideRatio", "html_url": "https://github.com/consideRatio", "followers_url": "https://api.github.com/users/consideRatio/followers", "following_url": "https://api.github.com/users/consideRatio/following{/other_user}", "gists_url": "https://api.github.com/users/consideRatio/gists{/gist_id}", "starred_url": "https://api.github.com/users/consideRatio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/consideRatio/subscriptions", "organizations_url": "https://api.github.com/users/consideRatio/orgs", "repos_url": "https://api.github.com/users/consideRatio/repos", "events_url": "https://api.github.com/users/consideRatio/events{/privacy}", "received_events_url": "https://api.github.com/users/consideRatio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 14, "created_at": "2018-04-01T18:20:12Z", "updated_at": "2018-04-16T08:11:12Z", "closed_at": "2018-04-16T08:11:12Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "I hoped to use [nbgitpuller](https://github.com/data-8/nbgitpuller) in order to be able to write something like `https://my-z2jh-deployment.com/user/redirect/git-pull?repo=my-repo-url` in order to first have the user login, and then do something specific, such as triggering nbgitpuller.\r\n\r\nThis would had worked fine if I wanted to do something that didn't require a query string in the url, like: `https://my-z2jh-deployment.com/user/redirect/terminals/1`.\r\n\r\nBut... Query strings are lost in between the redirection from `/user/redirect/` to `/user/my-username/` :'(\r\n\r\n![query-truncated](https://user-images.githubusercontent.com/3837114/38176144-e88abbd6-35e9-11e8-93bf-014a0f0da261.gif)\r\n\r\n### Update 1\r\nI think of this as a bug, because I guess this is not the indented behavior.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1769/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1769/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1765", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1765/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1765/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1765/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/1765", "id": 309915204, "node_id": "MDU6SXNzdWUzMDk5MTUyMDQ=", "number": 1765, "title": "Login/Logout button does not update its label after logout", "user": {"login": "willingc", "id": 2680980, "node_id": "MDQ6VXNlcjI2ODA5ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/2680980?v=4", "gravatar_id": "", "url": "https://api.github.com/users/willingc", "html_url": "https://github.com/willingc", "followers_url": "https://api.github.com/users/willingc/followers", "following_url": "https://api.github.com/users/willingc/following{/other_user}", "gists_url": "https://api.github.com/users/willingc/gists{/gist_id}", "starred_url": "https://api.github.com/users/willingc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/willingc/subscriptions", "organizations_url": "https://api.github.com/users/willingc/orgs", "repos_url": "https://api.github.com/users/willingc/repos", "events_url": "https://api.github.com/users/willingc/events{/privacy}", "received_events_url": "https://api.github.com/users/willingc/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 373221162, "node_id": "MDU6TGFiZWwzNzMyMjExNjI=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/user%20experience", "name": "user experience", "color": "ff9933", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-03-29T21:50:34Z", "updated_at": "2019-09-19T13:51:55Z", "closed_at": "2019-09-19T13:51:55Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "To reproduce from a running notebook:\r\n\r\n1. Click on Logout button.\r\n2. UI changes and displays the \"Successfully logged out\" message.\r\n\r\nThe righthand button does not update to \"Login\".\r\n\r\n<img width=\"1206\" alt=\"screenshot 2018-03-29 17 44 02\" src=\"https://user-images.githubusercontent.com/2680980/38115182-28a72740-3379-11e8-9040-21d99a25cb7f.png\">\r\n\r\n3. Clicking on the button will cause it to update the label to \"Login\".\r\n\r\n<img width=\"1216\" alt=\"screenshot 2018-03-29 17 50 08\" src=\"https://user-images.githubusercontent.com/2680980/38115357-acc0475a-3379-11e8-94fe-4a7420e519ce.png\">\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1765/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1765/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1717", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1717/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1717/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1717/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/1717", "id": 304530928, "node_id": "MDU6SXNzdWUzMDQ1MzA5Mjg=", "number": 1717, "title": "Users with some special characters can't connect to their servers with Chrome", "user": {"login": "chicocvenancio", "id": 188585, "node_id": "MDQ6VXNlcjE4ODU4NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/188585?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chicocvenancio", "html_url": "https://github.com/chicocvenancio", "followers_url": "https://api.github.com/users/chicocvenancio/followers", "following_url": "https://api.github.com/users/chicocvenancio/following{/other_user}", "gists_url": "https://api.github.com/users/chicocvenancio/gists{/gist_id}", "starred_url": "https://api.github.com/users/chicocvenancio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chicocvenancio/subscriptions", "organizations_url": "https://api.github.com/users/chicocvenancio/orgs", "repos_url": "https://api.github.com/users/chicocvenancio/repos", "events_url": "https://api.github.com/users/chicocvenancio/events{/privacy}", "received_events_url": "https://api.github.com/users/chicocvenancio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/milestones/9", "html_url": "https://github.com/jupyterhub/jupyterhub/milestone/9", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/milestones/9/labels", "id": 2254898, "node_id": "MDk6TWlsZXN0b25lMjI1NDg5OA==", "number": 9, "title": "0.9", "description": "", "creator": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 25, "state": "closed", "created_at": "2017-01-16T14:39:09Z", "updated_at": "2018-06-15T13:39:51Z", "due_on": null, "closed_at": "2018-06-15T13:39:51Z"}, "comments": 3, "created_at": "2018-03-12T20:38:05Z", "updated_at": "2018-05-30T12:48:36Z", "closed_at": "2018-05-30T12:48:36Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Chrome is substituting a few url encoded characters for the literal characters in URLs. The tilde is such a character, so it will substitute `%7E` for `~` in the request. This will make the notebook respond with a 404 to the request. Using another browser (eg Firefox), does not run into the same issue.\r\n\r\n**How to reproduce the issue**\r\nCreate an user with a tilde in it and attempt to access your server in a jupyterhub deployment with Google Chrome.\r\n\r\n**What you expected to happen**\r\nGet a 200 response with the notebook server interface.\r\n**What actually happens**\r\nGet a 404 response.\r\n**Share what version of JupyterHub you are using**\r\nz2jh@0.6 so `jupyterhub==0.8.1`\r\n\r\nSee https://phabricator.wikimedia.org/T189525", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1717/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1717/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1686", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1686/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1686/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1686/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/1686", "id": 300707616, "node_id": "MDU6SXNzdWUzMDA3MDc2MTY=", "number": 1686, "title": "External OAuth Client unable to access API", "user": {"login": "brospars", "id": 5736114, "node_id": "MDQ6VXNlcjU3MzYxMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/5736114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brospars", "html_url": "https://github.com/brospars", "followers_url": "https://api.github.com/users/brospars/followers", "following_url": "https://api.github.com/users/brospars/following{/other_user}", "gists_url": "https://api.github.com/users/brospars/gists{/gist_id}", "starred_url": "https://api.github.com/users/brospars/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brospars/subscriptions", "organizations_url": "https://api.github.com/users/brospars/orgs", "repos_url": "https://api.github.com/users/brospars/repos", "events_url": "https://api.github.com/users/brospars/events{/privacy}", "received_events_url": "https://api.github.com/users/brospars/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-02-27T16:46:10Z", "updated_at": "2018-03-13T15:11:28Z", "closed_at": "2018-03-13T15:11:28Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi,\r\nSo I'm testing the recently merged \"enable external oauth client\" but unfortunately my oauth client is unable to access the API after retrieving the token and is being redirected to the login page (see logs below).\r\n\r\n**How to reproduce the issue**\r\nI am using my self hosted Gitlab as an external oauth client\r\n\r\n**What you expected to happen**\r\nThe API request to  `/jupyterhub/hub/api/user` with oauth token should be able to retrieve the user info.\r\n\r\n**What actually happens**\r\nThe request is being redirected to the login page\r\n\r\n**Share what version of JupyterHub you are using** : latest\r\n\r\nJupyterhub logs\r\n\r\n```\r\njupyterhub | [I 2018-02-27 16:18:07.927 JupyterHub log:124] 302 GET /jupyterhub/hub/api/oauth2/authorize?client_id=gitlab-oauth&redirect_uri=http%3A%2F%2Fhost.domain%2Fgitlab%2Fusers%2Fauth%2FJupyterhub%2Fcallback&response_type=code&state=[state] -> http://host.domain/gitlab/users/auth/Jupyterhub/callback?code=[code]&state=[state] ([user]@194.199.19.22) 14.87ms\r\njupyterhub | [I 2018-02-27 16:18:08.108 JupyterHub log:124] 200 POST /jupyterhub/hub/api/oauth2/token (@172.18.0.1) 40.60ms\r\njupyterhub | [I 2018-02-27 16:18:08.134 JupyterHub log:124] 302 GET /jupyterhub/hub/api/user -> /jupyterhub/hub/login?next=%2Fjupyterhub%2Fhub%2Fapi%2Fuser (@172.18.0.1) 4.79ms\r\njupyterhub | [I 2018-02-27 16:18:08.143 JupyterHub log:124] 302 GET /jupyterhub/hub/login?next=%2Fjupyterhub%2Fhub%2Fapi%2Fuser -> /jupyterhub/hub/lti/launch?next=%2Fjupyterhub%2Fhub%2Fapi%2Fuser (@172.18.0.1) 2.19ms\r\njupyterhub | [W 2018-02-27 16:18:08.205 JupyterHub log:124] 405 GET /jupyterhub/hub/lti/launch?next=%2Fjupyterhub%2Fhub%2Fapi%2Fuser (@172.18.0.1) 53.75ms\r\n```\r\n\r\nAm I missing something ?\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1686/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1686/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1626", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1626/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1626/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1626/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/1626", "id": 289957936, "node_id": "MDU6SXNzdWUyODk5NTc5MzY=", "number": 1626, "title": "Jupyterhub is not resilient with external MySQL database", "user": {"login": "ckbhatt", "id": 17678899, "node_id": "MDQ6VXNlcjE3Njc4ODk5", "avatar_url": "https://avatars.githubusercontent.com/u/17678899?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ckbhatt", "html_url": "https://github.com/ckbhatt", "followers_url": "https://api.github.com/users/ckbhatt/followers", "following_url": "https://api.github.com/users/ckbhatt/following{/other_user}", "gists_url": "https://api.github.com/users/ckbhatt/gists{/gist_id}", "starred_url": "https://api.github.com/users/ckbhatt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ckbhatt/subscriptions", "organizations_url": "https://api.github.com/users/ckbhatt/orgs", "repos_url": "https://api.github.com/users/ckbhatt/repos", "events_url": "https://api.github.com/users/ckbhatt/events{/privacy}", "received_events_url": "https://api.github.com/users/ckbhatt/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 106589225, "node_id": "MDU6TGFiZWwxMDY1ODkyMjU=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/enhancement", "name": "enhancement", "color": "84b6eb", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 29, "created_at": "2018-01-19T12:19:48Z", "updated_at": "2021-03-29T20:14:02Z", "closed_at": "2018-05-23T14:09:52Z", "author_association": "NONE", "active_lock_reason": null, "body": "We are using Jupyterhub with an external mariadb(open source fork of mysql) database. In the event of a temporary network failure, Jupyterhub gets stuck and do not recover.\r\n\r\n**How to reproduce the issue on mac**\r\n\r\n1. Install Mariadb locally\r\n`brew install mariadb`\r\n2. Remove from launchctl for ease of stop and start\r\n`launchctl unload -w ~/Library/LaunchAgents/homebrew.mxcl.mariadb.plist`\r\n3. Start mariadb\r\n`brew services start mariadb`\r\n4. Create a database named jh_test\r\n5. Create a user test/test in mac.\r\n6. Run jupyter hub locally with following config file.\r\n```\r\nc = get_config()\r\nc.Authenticator.whitelist = {'test'}\r\nc.Authenticator.admin_users = {'test'}\r\nc.JupyterHub.db_url = 'mysql+mysqlconnector://{}:{}@{}/{}{}'.format(\"root\",\"\",\"localhost\",\"jh_test\",\"\")\r\n```\r\n7. Login using test/test and start jupyter server.\r\n8. Stop mysql\r\n`brew services stop mariadb`\r\n9. Go to browser and click on Control Panel button. You'll get following exception:\r\n```\r\n[E 2018-01-19 04:14:19.920 JupyterHub web:1518] Exception in exception handler\r\n    Traceback (most recent call last):\r\n      File \"/Users/bhatt/anaconda3/lib/python3.6/site-packages/tornado/web.py\", line 1516, in _execute\r\n        self._handle_request_exception(e)\r\n      File \"/Users/bhatt/anaconda3/lib/python3.6/site-packages/tornado/web.py\", line 1570, in _handle_request_exception\r\n        self.send_error(500, exc_info=sys.exc_info())\r\n      File \"/Users/bhatt/anaconda3/lib/python3.6/site-packages/tornado/web.py\", line 1040, in send_error\r\n        self.finish()\r\n      File \"/Users/bhatt/anaconda3/lib/python3.6/site-packages/jupyterhub/handlers/base.py\", line 105, in finish\r\n        super().finish(*args, **kwargs)\r\n      File \"/Users/bhatt/anaconda3/lib/python3.6/site-packages/tornado/web.py\", line 993, in finish\r\n        self._log()\r\n      File \"/Users/bhatt/anaconda3/lib/python3.6/site-packages/tornado/web.py\", line 1540, in _log\r\n        self.application.log_request(self)\r\n      File \"/Users/bhatt/anaconda3/lib/python3.6/site-packages/tornado/web.py\", line 2053, in log_request\r\n        self.settings[\"log_function\"](handler)\r\n      File \"/Users/bhatt/anaconda3/lib/python3.6/site-packages/jupyterhub/log.py\", line 90, in log_request\r\n        user = handler.get_current_user()\r\n      File \"/Users/bhatt/anaconda3/lib/python3.6/site-packages/jupyterhub/handlers/base.py\", line 229, in get_current_user\r\n        return self.get_current_user_cookie()\r\n      File \"/Users/bhatt/anaconda3/lib/python3.6/site-packages/jupyterhub/handlers/base.py\", line 222, in get_current_user_cookie\r\n        return self._user_for_cookie(self.hub.cookie_name)\r\n      File \"/Users/bhatt/anaconda3/lib/python3.6/site-packages/jupyterhub/handlers/base.py\", line 206, in _user_for_cookie\r\n        u = self.db.query(orm.User).filter(orm.User.cookie_id==cookie_id).first()\r\n      File \"/Users/bhatt/anaconda3/lib/python3.6/site-packages/sqlalchemy/orm/query.py\", line 2755, in first\r\n        ret = list(self[0:1])\r\n      File \"/Users/bhatt/anaconda3/lib/python3.6/site-packages/sqlalchemy/orm/query.py\", line 2547, in __getitem__\r\n        return list(res)\r\n      File \"/Users/bhatt/anaconda3/lib/python3.6/site-packages/sqlalchemy/orm/query.py\", line 2855, in __iter__\r\n        return self._execute_and_instances(context)\r\n      File \"/Users/bhatt/anaconda3/lib/python3.6/site-packages/sqlalchemy/orm/query.py\", line 2878, in _execute_and_instances\r\n        result = conn.execute(querycontext.statement, self._params)\r\n      File \"/Users/bhatt/anaconda3/lib/python3.6/site-packages/sqlalchemy/engine/base.py\", line 945, in execute\r\n        return meth(self, multiparams, params)\r\n      File \"/Users/bhatt/anaconda3/lib/python3.6/site-packages/sqlalchemy/sql/elements.py\", line 263, in _execute_on_connection\r\n        return connection._execute_clauseelement(self, multiparams, params)\r\n      File \"/Users/bhatt/anaconda3/lib/python3.6/site-packages/sqlalchemy/engine/base.py\", line 1053, in _execute_clauseelement\r\n        compiled_sql, distilled_params\r\n      File \"/Users/bhatt/anaconda3/lib/python3.6/site-packages/sqlalchemy/engine/base.py\", line 1121, in _execute_context\r\n        None, None)\r\n      File \"/Users/bhatt/anaconda3/lib/python3.6/site-packages/sqlalchemy/engine/base.py\", line 1402, in _handle_dbapi_exception\r\n        exc_info\r\n      File \"/Users/bhatt/anaconda3/lib/python3.6/site-packages/sqlalchemy/util/compat.py\", line 203, in raise_from_cause\r\n        reraise(type(exception), exception, tb=exc_tb, cause=cause)\r\n      File \"/Users/bhatt/anaconda3/lib/python3.6/site-packages/sqlalchemy/util/compat.py\", line 186, in reraise\r\n        raise value.with_traceback(tb)\r\n      File \"/Users/bhatt/anaconda3/lib/python3.6/site-packages/sqlalchemy/engine/base.py\", line 1114, in _execute_context\r\n        conn = self._revalidate_connection()\r\n      File \"/Users/bhatt/anaconda3/lib/python3.6/site-packages/sqlalchemy/engine/base.py\", line 424, in _revalidate_connection\r\n        \"Can't reconnect until invalid \"\r\n    sqlalchemy.exc.StatementError: (sqlalchemy.exc.InvalidRequestError) Can't reconnect until invalid transaction is rolled back [SQL: 'SELECT users.id AS users_id, users.name AS users_name, users.`admin` AS users_admin, users.last_activity AS users_last_activity, users.cookie_id AS users_cookie_id, users.state AS users_state, users.encrypted_auth_state AS users_encrypted_auth_state \\nFROM users \\nWHERE users.cookie_id = %(cookie_id_1)s \\n LIMIT %(param_1)s'] [parameters: [{}]]\r\n```\r\n10. Start mariadb again\r\n`brew services start mariadb`\r\n11. Refresh Jupyterhub page.\r\n**What you expected to happen**\r\nJupyterhub should reconnect with DB and work normally as network interruptions are common scenarios. In above case DB was shutdown to mimic network interruption. Results are same with a remote DB and actual n/w interruption.\r\n**What actually happens**\r\nJupyter hub keeps giving above exception and we need to restart hub for bringing it back to normal state.\r\n**Share what version of JupyterHub you are using**\r\n0.8.1\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1626/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1626/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1611", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1611/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1611/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1611/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/1611", "id": 286660022, "node_id": "MDU6SXNzdWUyODY2NjAwMjI=", "number": 1611, "title": "Trouble running single user server as a service", "user": {"login": "ellisonbg", "id": 27600, "node_id": "MDQ6VXNlcjI3NjAw", "avatar_url": "https://avatars.githubusercontent.com/u/27600?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ellisonbg", "html_url": "https://github.com/ellisonbg", "followers_url": "https://api.github.com/users/ellisonbg/followers", "following_url": "https://api.github.com/users/ellisonbg/following{/other_user}", "gists_url": "https://api.github.com/users/ellisonbg/gists{/gist_id}", "starred_url": "https://api.github.com/users/ellisonbg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ellisonbg/subscriptions", "organizations_url": "https://api.github.com/users/ellisonbg/orgs", "repos_url": "https://api.github.com/users/ellisonbg/repos", "events_url": "https://api.github.com/users/ellisonbg/events{/privacy}", "received_events_url": "https://api.github.com/users/ellisonbg/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 388386197, "node_id": "MDU6TGFiZWwzODgzODYxOTc=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/needs:%20testing", "name": "needs: testing", "color": "c2e0c6", "default": false, "description": null}, {"id": 542035446, "node_id": "MDU6TGFiZWw1NDIwMzU0NDY=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/configuration", "name": "configuration", "color": "c5def5", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2018-01-08T06:45:26Z", "updated_at": "2021-05-19T09:49:41Z", "closed_at": "2021-02-17T19:38:42Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Hi! Thanks for using JupyterHub.\r\n\r\nIf you are reporting an issue with JupyterHub:\r\n\r\n**How to reproduce the issue**\r\n\r\nI am running a single user notebook service for nbgrader. Here is the service definition in my config file:\r\n\r\n```\r\nc.JupyterHub.services = [\r\n    {\r\n        'name': 'data301',\r\n        'url': 'http://127.0.0.1:9999',\r\n        'command': [\r\n            '/usr/local/bin/start-jupyter-labhub.sh',\r\n            '--group=data301',\r\n            '--debug',\r\n        ],\r\n        'user': 'data301-master',\r\n        'cwd': '/home/data301-master'\r\n    }\r\n]\r\n```\r\n\r\nThe user `data301-master` exits on the system and my user `ellisonbg` is part of the `data301` group in my config file.\r\n\r\n**What you expected to happen**\r\n\r\nOpen `/services/data301/tree` or `/services/data301/lab` when logged in as `ellisonbg` who is in the `data301` group.\r\n\r\n**What actually happens**\r\n\r\nThe initial access works, but then all the api calls fail (for both classic and lab):\r\n\r\n```\r\n[D 2018-01-08 06:38:20.191 SingleUserLabApp auth:733] Allowing Hub user ellisonbg in group(s) data301\r\n[D 2018-01-08 06:38:20.191 SingleUserLabApp log:122] 200 GET /services/data301/static/components/MathJax/config/Safe.js?rev=2.6.0 (ellisonbg@66.215.49.133) 1.39ms\r\n[D 2018-01-08 06:38:20.333 SingleUserLabApp auth:235] Received request from Hub user {'kind': 'service', 'name': 'data301', 'admin': False}\r\n[I 2018-01-08 06:38:20.333 JupyterHub log:122] 200 GET /hub/api/authorizations/token/[secret] (data301@127.0.0.1) 2.42ms\r\n[W 2018-01-08 06:38:20.334 SingleUserLabApp auth:724] Not allowing Hub service data301\r\n[W 2018-01-08 06:38:20.335 SingleUserLabApp web:1587] 403 GET /services/data301/api/kernelspecs?1515393500311 (66.215.49.133): service data301 is not allowed.\r\n[W 2018-01-08 06:38:20.335 SingleUserLabApp handlers:479] service data301 is not allowed.\r\n[W 2018-01-08 06:38:20.335 SingleUserLabApp log:122] 403 GET /services/data301/api/kernelspecs?1515393500311 (@66.215.49.133) 7.99ms\r\n[W 2018-01-08 06:38:20.338 SingleUserLabApp auth:724] Not allowing Hub service data301\r\n[W 2018-01-08 06:38:20.338 SingleUserLabApp web:1587] 403 GET /services/data301/api/terminals?1515393500311 (66.215.49.133): service data301 is not allowed.\r\n[W 2018-01-08 06:38:20.339 SingleUserLabApp handlers:479] service data301 is not allowed.\r\n[W 2018-01-08 06:38:20.339 SingleUserLabApp log:122] 403 GET /services/data301/api/terminals?1515393500311 (@66.215.49.133) 1.48ms\r\n[W 2018-01-08 06:38:20.383 SingleUserLabApp auth:724] Not allowing Hub service data301\r\n[W 2018-01-08 06:38:20.383 SingleUserLabApp web:1587] 403 GET /services/data301/lab/api/settings/@jupyterlab/shortcuts-extension:plugin?1515393500356 (66.215.49.133): service data301 is not allowed.\r\n[W 2018-01-08 06:38:20.384 SingleUserLabApp handlers:479] service data301 is not allowed.\r\n[W 2018-01-08 06:38:20.384 SingleUserLabApp log:122] 403 GET /services/data301/lab/api/settings/@jupyterlab/shortcuts-extension:plugin?1515393500356 (@66.215.49.133) 1.72ms\r\n[W 2018-01-08 06:38:20.386 SingleUserLabApp auth:724] Not allowing Hub service data301\r\n[W 2018-01-08 06:38:20.386 SingleUserLabApp web:1587] 403 GET /services/data301/lab/api/settings/@jupyterlab/apputils-extension:themes?1515393500357 (66.215.49.133): service data301 is not allowed.\r\n[W 2018-01-08 06:38:20.387 SingleUserLabApp handlers:479] service data301 is not allowed.\r\n[W 2018-01-08 06:38:20.387 SingleUserLabApp log:122] 403 GET /services/data301/lab/api/settings/@jupyterlab/apputils-extension:themes?1515393500357 (@66.215.49.133) 1.73ms\r\n[W 2018-01-08 06:38:20.389 SingleUserLabApp auth:724] Not allowing Hub service data301\r\n[W 2018-01-08 06:38:20.389 SingleUserLabApp web:1587] 403 GET /services/data301/lab/api/build?1515393500364 (66.215.49.133): service data301 is not allowed.\r\n[W 2018-01-08 06:38:20.389 SingleUserLabApp handlers:479] service data301 is not allowed.\r\n[W 2018-01-08 06:38:20.390 SingleUserLabApp log:122] 403 GET /services/data301/lab/api/build?1515393500364 (@66.215.49.133) 1.41ms\r\n[W 2018-01-08 06:38:20.392 SingleUserLabApp auth:724] Not allowing Hub service data301\r\n[W 2018-01-08 06:38:20.393 SingleUserLabApp web:1587] 403 GET /services/data301/api/contents/?content=1&1515393500369 (66.215.49.133): service data301 is not allowed.\r\n[W 2018-01-08 06:38:20.393 SingleUserLabApp handlers:479] service data301 is not allowed.\r\n[W 2018-01-08 06:38:20.393 SingleUserLabApp log:122] 403 GET /services/data301/api/contents/?content=1&1515393500369 (@66.215.49.133) 1.46ms\r\n[W 2018-01-08 06:38:20.398 SingleUserLabApp auth:724] Not allowing Hub service data301\r\n[W 2018-01-08 06:38:20.399 SingleUserLabApp web:1587] 403 GET /services/data301/lab/api/settings/@jupyterlab/fileeditor-extension:plugin?1515393500374 (66.215.49.133): service data301 is not allowed.\r\n[W 2018-01-08 06:38:20.399 SingleUserLabApp handlers:479] service data301 is not allowed.\r\n[W 2018-01-08 06:38:20.400 SingleUserLabApp log:122] 403 GET /services/data301/lab/api/settings/@jupyterlab/fileeditor-extension:plugin?1515393500374 (@66.215.49.133) 1.42ms\r\n[W 2018-01-08 06:38:20.403 SingleUserLabApp auth:724] Not allowing Hub service data301\r\n[W 2018-01-08 06:38:20.403 SingleUserLabApp web:1587] 403 GET /services/data301/lab/api/settings/@jupyterlab/codemirror-extension:commands?1515393500380 (66.215.49.133): service data301 is not allowed.\r\n[W 2018-01-08 06:38:20.403 SingleUserLabApp handlers:479] service data301 is not allowed.\r\n[W 2018-01-08 06:38:20.404 SingleUserLabApp log:122] 403 GET /services/data301/lab/api/settings/@jupyterlab/codemirror-extension:commands?1515393500380 (@66.215.49.133) 1.36ms\r\n[W 2018-01-08 06:38:30.346 SingleUserLabApp auth:724] Not allowing Hub service data301\r\n[W 2018-01-08 06:38:30.347 SingleUserLabApp web:1587] 403 GET /services/data301/api/sessions?1515393510317 (66.215.49.133): service data301 is not allowed.\r\n[W 2018-01-08 06:38:30.347 SingleUserLabApp handlers:479] service data301 is not allowed.\r\n[W 2018-01-08 06:38:30.348 SingleUserLabApp log:122] 403 GET /services/data301/api/sessions?1515393510317 (@66.215.49.133) 1.85ms\r\n[W 2018-01-08 06:38:30.390 SingleUserLabApp auth:724] Not allowing Hub service data301\r\n[W 2018-01-08 06:38:30.390 SingleUserLabApp web:1587] 403 GET /services/data301/api/contents/?content=1&1515393510371 (66.215.49.133): service data301 is not allowed.\r\n[W 2018-01-08 06:38:30.391 SingleUserLabApp handlers:479] service data301 is not allowed.\r\n[W 2018-01-08 06:38:30.391 SingleUserLabApp log:122] 403 GET /services/data301/api/contents/?content=1&1515393510371 (@66.215.49.133) 1.70ms\r\n[W 2018-01-08 06:38:30.550 SingleUserLabApp auth:724] Not allowing Hub service data301\r\n[W 2018-01-08 06:38:30.550 SingleUserLabApp web:1587] 403 GET /services/data301/api/terminals?1515393510318 (66.215.49.133): service data301 is not allowed.\r\n[W 2018-01-08 06:38:30.551 SingleUserLabApp handlers:479] service data301 is not allowed.\r\n[W 2018-01-08 06:38:30.551 SingleUserLabApp log:122] 403 GET /services/data301/api/terminals?1515393510318 (@66.215.49.133) 1.64ms\r\n[W 2018-01-08 06:38:40.346 SingleUserLabApp auth:724] Not allowing Hub service data301\r\n[W 2018-01-08 06:38:40.346 SingleUserLabApp web:1587] 403 GET /services/data301/api/terminals?1515393520318 (66.215.49.133): service data301 is not allowed.\r\n[W 2018-01-08 06:38:40.347 SingleUserLabApp handlers:479] service data301 is not allowed.\r\n[W 2018-01-08 06:38:40.347 SingleUserLabApp log:122] 403 GET /services/data301/api/terminals?1515393520318 (@66.215.49.133) 1.67ms\r\n[W 2018-01-08 06:38:40.348 SingleUserLabApp auth:724] Not allowing Hub service data301\r\n[W 2018-01-08 06:38:40.349 SingleUserLabApp web:1587] 403 GET /services/data301/api/sessions?1515393520317 (66.215.49.133): service data301 is not allowed.\r\n[W 2018-01-08 06:38:40.349 SingleUserLabApp handlers:479] service data301 is not allowed.\r\n[W 2018-01-08 06:38:40.350 SingleUserLabApp log:122] 403 GET /services/data301/api/sessions?1515393520317 (@66.215.49.133) 1.48ms\r\n[W 2018-01-08 06:38:41.393 SingleUserLabApp auth:724] Not allowing Hub service data301\r\n[W 2018-01-08 06:38:41.393 SingleUserLabApp web:1587] 403 GET /services/data301/api/contents/?content=1&1515393521374 (66.215.49.133): service data301 is not allowed.\r\n[W 2018-01-08 06:38:41.394 SingleUserLabApp handlers:479] service data301 is not allowed.\r\n[W 2018-01-08 06:38:41.394 SingleUserLabApp log:122] 403 GET /services/data301/api/contents/?content=1&1515393521374 (@66.215.49.133) 1.60ms\r\n```\r\n\r\n**Share what version of JupyterHub you are using**\r\n\r\nJupyterHub latest stable (0.8.1).\r\n\r\nRunning `jupyter troubleshoot` from the command line, if possible, and posting\r\nits output would also be helpful.\r\n\r\n```\r\ncan follow up with this if needed\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1611/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1611/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1610", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1610/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1610/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1610/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/1610", "id": 286531552, "node_id": "MDU6SXNzdWUyODY1MzE1NTI=", "number": 1610, "title": "API docs list duplicate attributes", "user": {"login": "ellisonbg", "id": 27600, "node_id": "MDQ6VXNlcjI3NjAw", "avatar_url": "https://avatars.githubusercontent.com/u/27600?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ellisonbg", "html_url": "https://github.com/ellisonbg", "followers_url": "https://api.github.com/users/ellisonbg/followers", "following_url": "https://api.github.com/users/ellisonbg/following{/other_user}", "gists_url": "https://api.github.com/users/ellisonbg/gists{/gist_id}", "starred_url": "https://api.github.com/users/ellisonbg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ellisonbg/subscriptions", "organizations_url": "https://api.github.com/users/ellisonbg/orgs", "repos_url": "https://api.github.com/users/ellisonbg/repos", "events_url": "https://api.github.com/users/ellisonbg/events{/privacy}", "received_events_url": "https://api.github.com/users/ellisonbg/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 356551766, "node_id": "MDU6TGFiZWwzNTY1NTE3NjY=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/documentation", "name": "documentation", "color": "fef2c0", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-01-07T00:21:02Z", "updated_at": "2018-05-04T08:27:45Z", "closed_at": "2018-05-04T08:27:45Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Looks like all the attributes in the API docs are listed twice:\r\n\r\nhttps://jupyterhub.readthedocs.io/en/latest/api/proxy.html#module-jupyterhub.proxy\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1610/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1610/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1576", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1576/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1576/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1576/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/1576", "id": 280103120, "node_id": "MDU6SXNzdWUyODAxMDMxMjA=", "number": 1576, "title": "anchor links on markdown docs pages are unreliable", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 356551766, "node_id": "MDU6TGFiZWwzNTY1NTE3NjY=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/documentation", "name": "documentation", "color": "fef2c0", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "willingc", "id": 2680980, "node_id": "MDQ6VXNlcjI2ODA5ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/2680980?v=4", "gravatar_id": "", "url": "https://api.github.com/users/willingc", "html_url": "https://github.com/willingc", "followers_url": "https://api.github.com/users/willingc/followers", "following_url": "https://api.github.com/users/willingc/following{/other_user}", "gists_url": "https://api.github.com/users/willingc/gists{/gist_id}", "starred_url": "https://api.github.com/users/willingc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/willingc/subscriptions", "organizations_url": "https://api.github.com/users/willingc/orgs", "repos_url": "https://api.github.com/users/willingc/repos", "events_url": "https://api.github.com/users/willingc/events{/privacy}", "received_events_url": "https://api.github.com/users/willingc/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "willingc", "id": 2680980, "node_id": "MDQ6VXNlcjI2ODA5ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/2680980?v=4", "gravatar_id": "", "url": "https://api.github.com/users/willingc", "html_url": "https://github.com/willingc", "followers_url": "https://api.github.com/users/willingc/followers", "following_url": "https://api.github.com/users/willingc/following{/other_user}", "gists_url": "https://api.github.com/users/willingc/gists{/gist_id}", "starred_url": "https://api.github.com/users/willingc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/willingc/subscriptions", "organizations_url": "https://api.github.com/users/willingc/orgs", "repos_url": "https://api.github.com/users/willingc/repos", "events_url": "https://api.github.com/users/willingc/events{/privacy}", "received_events_url": "https://api.github.com/users/willingc/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2017-12-07T11:56:07Z", "updated_at": "2021-02-24T23:47:37Z", "closed_at": "2021-02-24T23:47:37Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Some of the pages generated from markdown sources have either missing or inconsistent anchors. For instance, on [the changelog](http://jupyterhub.readthedocs.io/en/latest/changelog.html), version headings do not get any ID and repeated headings (e.g. `added` in each release) all get the same ID. This could be a bug in recommonmark, or something else.\r\n\r\n@willingc as resident sphinx expert, can you investigate?", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1576/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1576/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1568", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1568/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1568/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1568/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/1568", "id": 278628510, "node_id": "MDU6SXNzdWUyNzg2Mjg1MTA=", "number": 1568, "title": "JupyterHub restarts proxy during cleanup if SIGTERM received", "user": {"login": "rwedge", "id": 5392142, "node_id": "MDQ6VXNlcjUzOTIxNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/5392142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rwedge", "html_url": "https://github.com/rwedge", "followers_url": "https://api.github.com/users/rwedge/followers", "following_url": "https://api.github.com/users/rwedge/following{/other_user}", "gists_url": "https://api.github.com/users/rwedge/gists{/gist_id}", "starred_url": "https://api.github.com/users/rwedge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rwedge/subscriptions", "organizations_url": "https://api.github.com/users/rwedge/orgs", "repos_url": "https://api.github.com/users/rwedge/repos", "events_url": "https://api.github.com/users/rwedge/events{/privacy}", "received_events_url": "https://api.github.com/users/rwedge/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-12-01T23:37:47Z", "updated_at": "2017-12-05T00:43:10Z", "closed_at": "2017-12-05T00:43:10Z", "author_association": "NONE", "active_lock_reason": null, "body": "Originally encountered this issue when running jupyterhub as a supervisor program and stopping the program via ``supervisorctl stop jupyterhub``.  Configuration file:\r\n```\r\n[program:jupyterhub]\r\ncommand = /usr/local/bin/jupyterhub_start\r\nuser = root\r\nstdout_logfile = /var/log/jupyterhub.log\r\nredirect_stderr = true\r\nstartretries=1\r\nexitcodes=0,2\r\nstopsignal=TERM\r\nstdout_logfile_maxbytes=1MB\r\nstdout_logfile_backups=10\r\nstdout_capture_maxbytes=1MB\r\n```\r\nWas able to reproduce it running jupyterhub from shell and using kill on the jupyterhub process from another shell after looking up the jupyterhub process id using ``ps aux | grep jupyterhub``.  Sending SIGINT or using Ctl+C caused JupyterHub to shut down the proxy normally.\r\n\r\nUsing Python 3.5, Configurable-HTTP-Proxy 3.1.0, Jupyterhub 0.8.1, nodejs 8.9.1  \r\n\r\n**How to reproduce the issue**\r\n\r\nSend a termination signal to the jupyterhub process. \r\n\r\n**What you expected to happen**\r\n\r\nJupyterhub to stop the configurable-http-proxy\r\n\r\n**What actually happens**\r\n\r\nJupyterhub tries to clean up the proxy, starts the proxy again, and stops.\r\n\r\n```\r\n[I 2017-12-01 22:27:02.115 JupyterHub proxy:458] Starting proxy @ http://*:8000/\r\n22:27:02.217 - info: [ConfigProxy] Proxying http://*:8000 to (no default)\r\n22:27:02.219 - info: [ConfigProxy] Proxy API at http://127.0.0.1:8001/api/routes\r\n[W 2017-12-01 22:27:02.319 JupyterHub proxy:304] Adding missing default route\r\n[I 2017-12-01 22:27:02.320 JupyterHub proxy:370] Adding default route for Hub: / => http://127.0.0.1:8081\r\n22:27:02.325 - info: [ConfigProxy] 200 GET /api/routes \r\n22:27:02.328 - info: [ConfigProxy] Adding route / -> http://127.0.0.1:8081\r\n22:27:02.329 - info: [ConfigProxy] 201 POST /api/routes/ \r\n[I 2017-12-01 22:27:02.330 JupyterHub app:1581] JupyterHub is now running at http://:8000/\r\n[C 2017-12-01 22:27:30.316 JupyterHub app:1590] Received SIGTERM, shutting down\r\n[I 2017-12-01 22:27:30.320 JupyterHub app:1399] Cleaning up single-user servers...\r\n[I 2017-12-01 22:27:30.323 JupyterHub proxy:496] Cleaning up proxy[4204]...\r\n[I 2017-12-01 22:27:30.339 JupyterHub app:1431] ...done\r\n[E 2017-12-01 22:27:32.289 JupyterHub proxy:509] Proxy stopped with exit code -15\r\n[W 2017-12-01 22:27:32.303 JupyterHub proxy:456] Running JupyterHub without SSL.  I hope there is SSL termination happening somewhere else...\r\n[I 2017-12-01 22:27:32.305 JupyterHub proxy:458] Starting proxy @ http://*:8000/\r\n```", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1568/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1568/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1549", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1549/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1549/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1549/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/1549", "id": 275752055, "node_id": "MDU6SXNzdWUyNzU3NTIwNTU=", "number": 1549, "title": "Doc Requirements are Incomplete", "user": {"login": "jzf2101", "id": 1373035, "node_id": "MDQ6VXNlcjEzNzMwMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/1373035?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jzf2101", "html_url": "https://github.com/jzf2101", "followers_url": "https://api.github.com/users/jzf2101/followers", "following_url": "https://api.github.com/users/jzf2101/following{/other_user}", "gists_url": "https://api.github.com/users/jzf2101/gists{/gist_id}", "starred_url": "https://api.github.com/users/jzf2101/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jzf2101/subscriptions", "organizations_url": "https://api.github.com/users/jzf2101/orgs", "repos_url": "https://api.github.com/users/jzf2101/repos", "events_url": "https://api.github.com/users/jzf2101/events{/privacy}", "received_events_url": "https://api.github.com/users/jzf2101/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 356551766, "node_id": "MDU6TGFiZWwzNTY1NTE3NjY=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/documentation", "name": "documentation", "color": "fef2c0", "default": true, "description": null}, {"id": 388374916, "node_id": "MDU6TGFiZWwzODgzNzQ5MTY=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/reference", "name": "reference", "color": "FEEDA7", "default": false, "description": null}, {"id": 542035446, "node_id": "MDU6TGFiZWw1NDIwMzU0NDY=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/configuration", "name": "configuration", "color": "c5def5", "default": false, "description": null}, {"id": 748209730, "node_id": "MDU6TGFiZWw3NDgyMDk3MzA=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/good%20first%20issue", "name": "good first issue", "color": "5319e7", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2017-11-21T15:25:20Z", "updated_at": "2017-11-21T15:57:40Z", "closed_at": "2017-11-21T15:57:40Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "@syutbai also noticed this bug as well", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1549/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1549/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1491", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1491/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1491/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1491/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/1491", "id": 266671962, "node_id": "MDU6SXNzdWUyNjY2NzE5NjI=", "number": 1491, "title": "User logout does not invalidate cookies for services", "user": {"login": "jhamrick", "id": 83444, "node_id": "MDQ6VXNlcjgzNDQ0", "avatar_url": "https://avatars.githubusercontent.com/u/83444?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhamrick", "html_url": "https://github.com/jhamrick", "followers_url": "https://api.github.com/users/jhamrick/followers", "following_url": "https://api.github.com/users/jhamrick/following{/other_user}", "gists_url": "https://api.github.com/users/jhamrick/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhamrick/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhamrick/subscriptions", "organizations_url": "https://api.github.com/users/jhamrick/orgs", "repos_url": "https://api.github.com/users/jhamrick/repos", "events_url": "https://api.github.com/users/jhamrick/events{/privacy}", "received_events_url": "https://api.github.com/users/jhamrick/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2017-10-18T23:14:35Z", "updated_at": "2019-06-24T19:37:15Z", "closed_at": "2017-12-19T14:18:03Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "It seems that if you log in as a user that has access to the server, and then logout, this does not invalidate the cookie or token for that service and so you can still gain access to it. This is an annoyance with testing, and potentially a security issue (if a user was using JupyterHub on a public machine).\r\n\r\n**How to reproduce the issue**\r\n\r\n1. Create a `jupyterhub_config.py` with a service, e.g.\r\n\r\n```\r\nc = get_config()\r\n\r\nc.Authenticator.whitelist = [\r\n    'instructor1'\r\n]\r\n\r\nc.JupyterHub.load_groups = {\r\n    'formgrader-course101': [\r\n        'instructor1'\r\n    ]\r\n}\r\n\r\nc.JupyterHub.services = [\r\n    {\r\n        'name': 'course101',\r\n        'url': 'http://127.0.0.1:9999',\r\n        'command': [\r\n            'jupyterhub-singleuser',\r\n            '--group=formgrader-course101',\r\n            '--debug',\r\n        ],\r\n        'user': 'grader-course101',\r\n        'cwd': '/home/grader-course101'\r\n    }\r\n]\r\n```\r\n\r\n2. Go to the service url, e.g. `/services/course101`. Observe that you get redirected to the login page (good!).\r\n\r\n3. Now log in as the user, and go to the service url. Observe you can access it.\r\n\r\n4. Go back to the user's server, and click \"log out\". Go back to the service url and observe that you can still access it.\r\n\r\n**What you expected to happen**\r\n\r\nAfter the user logs out, they should no longer have access to the service.\r\n\r\n**What actually happens**\r\n\r\nAfter the user logs out, they still have access to the service.\r\n\r\n**Share what version of JupyterHub you are using**\r\n\r\n0.8.0", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1491/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1491/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1456", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1456/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1456/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1456/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/1456", "id": 261088974, "node_id": "MDU6SXNzdWUyNjEwODg5NzQ=", "number": 1456, "title": "can not start cull_idle_servers", "user": {"login": "ktong", "id": 4332577, "node_id": "MDQ6VXNlcjQzMzI1Nzc=", "avatar_url": "https://avatars.githubusercontent.com/u/4332577?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ktong", "html_url": "https://github.com/ktong", "followers_url": "https://api.github.com/users/ktong/followers", "following_url": "https://api.github.com/users/ktong/following{/other_user}", "gists_url": "https://api.github.com/users/ktong/gists{/gist_id}", "starred_url": "https://api.github.com/users/ktong/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ktong/subscriptions", "organizations_url": "https://api.github.com/users/ktong/orgs", "repos_url": "https://api.github.com/users/ktong/repos", "events_url": "https://api.github.com/users/ktong/events{/privacy}", "received_events_url": "https://api.github.com/users/ktong/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2017-09-27T19:21:50Z", "updated_at": "2020-04-18T19:02:35Z", "closed_at": "2020-04-18T19:02:35Z", "author_association": "NONE", "active_lock_reason": null, "body": "**How to reproduce the issue**\r\n\r\nconfigure cull_idea_servers as below then start jupyterhub:\r\n```\r\n    c.JupyterHub.services = [\r\n        {\r\n            'name': 'cull-idle',\r\n            'admin': True,\r\n            'command': 'python cull_idle_servers.py --timeout=3600'.split(),\r\n        }\r\n    ]\r\n```\r\n\r\n**What you expected to happen**\r\ncull_idea_servers runs.\r\n\r\n**What actually happens**\r\ncull_idea-servers quit with exception.\r\n```\r\n[I 2017-09-27 18:57:49.984 JupyterHub service:266] Starting service 'cull-idle': ['python3', 'cull_idle_servers.py', '--timeout=86400', '--cull_every=600']\r\n\r\nTraceback (most recent call last):\r\n  File \"cull_idle_servers.py\", line 89, in <module>\r\n    loop.run_sync(cull)\r\n  File \"/usr/local/lib/python3.5/dist-packages/tornado/ioloop.py\", line 458, in run_sync\r\n    return future_cell[0].result()\r\n  File \"/usr/local/lib/python3.5/dist-packages/tornado/concurrent.py\", line 238, in result\r\n    raise_exc_info(self._exc_info)\r\n  File \"<string>\", line 4, in raise_exc_info\r\n  File \"/usr/local/lib/python3.5/dist-packages/tornado/gen.py\", line 1063, in run\r\n    yielded = self.gen.throw(*exc_info)\r\n  File \"cull_idle_servers.py\", line 55, in cull_idle\r\n    resp = yield client.fetch(req)\r\n  File \"/usr/local/lib/python3.5/dist-packages/tornado/gen.py\", line 1055, in run\r\n    value = future.result()\r\n  File \"/usr/local/lib/python3.5/dist-packages/tornado/concurrent.py\", line 238, in result\r\n    raise_exc_info(self._exc_info)\r\n  File \"<string>\", line 4, in raise_exc_info\r\n  File \"/usr/local/lib/python3.5/dist-packages/tornado/stack_context.py\", line 316, in wrapped\r\n    ret = fn(*args, **kwargs)\r\n  File \"/usr/local/lib/python3.5/dist-packages/tornado/simple_httpclient.py\", line 307, in _on_timeout\r\n    raise HTTPError(599, error_message)\r\ntornado.httpclient.HTTPError: HTTP 599: Timeout while connecting\r\n```\r\n\r\n**Share what version of JupyterHub you are using**\r\nJupyterhub 0.8.0rc2\r\n\r\nRunning `jupyter troubleshoot` from the command line, if possible, and posting\r\nits output would also be helpful.\r\n\r\n```\r\n$PATH:\r\n\t/usr/local/bin\r\n\t/usr/local/sbin\r\n\t/usr/local/bin\r\n\t/usr/sbin\r\n\t/usr/bin\r\n\t/sbin\r\n\t/bin\r\n\r\nsys.path:\r\n\t/usr/local/bin\r\n\t/srv/jupyterhub\r\n\t/usr/lib/python35.zip\r\n\t/usr/lib/python3.5\r\n\t/usr/lib/python3.5/plat-x86_64-linux-gnu\r\n\t/usr/lib/python3.5/lib-dynload\r\n\t/usr/local/lib/python3.5/dist-packages\r\n\t/usr/lib/python3/dist-packages\r\n\r\nsys.executable:\r\n\t/usr/bin/python3\r\n\r\nsys.version:\r\n\t3.5.3 (default, Jan 19 2017, 14:11:04)\r\n\t[GCC 6.3.0 20170118]\r\n\r\nplatform.platform():\r\n\tLinux-4.4.52+-x86_64-with-Ubuntu-17.04-zesty\r\n\r\nwhich -a jupyter:\r\n\t/usr/local/bin/jupyter\r\n\t/usr/local/bin/jupyter\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1456/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1456/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1420", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1420/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1420/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1420/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/1420", "id": 257883499, "node_id": "MDU6SXNzdWUyNTc4ODM0OTk=", "number": 1420, "title": "User can never start if stop takes forever, stuck at 'user is pending stop'", "user": {"login": "yuvipanda", "id": 30430, "node_id": "MDQ6VXNlcjMwNDMw", "avatar_url": "https://avatars.githubusercontent.com/u/30430?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuvipanda", "html_url": "https://github.com/yuvipanda", "followers_url": "https://api.github.com/users/yuvipanda/followers", "following_url": "https://api.github.com/users/yuvipanda/following{/other_user}", "gists_url": "https://api.github.com/users/yuvipanda/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuvipanda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuvipanda/subscriptions", "organizations_url": "https://api.github.com/users/yuvipanda/orgs", "repos_url": "https://api.github.com/users/yuvipanda/repos", "events_url": "https://api.github.com/users/yuvipanda/events{/privacy}", "received_events_url": "https://api.github.com/users/yuvipanda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 543988001, "node_id": "MDU6TGFiZWw1NDM5ODgwMDE=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/needs:%20upstream%20action", "name": "needs: upstream action", "color": "c2e0c6", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-09-14T23:17:05Z", "updated_at": "2017-10-03T15:29:12Z", "closed_at": "2017-10-02T17:07:23Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": " I think @ryanlovett stopped their server and tried to start it again, but it seems to be stuck forever stopping. Here are the logs:\r\n\r\n```\r\ndatahub@k8s-master-19522833-0:~$ grep rylo rylo-stop \r\n[I 2017-09-14 22:28:14.804 JupyterHub log:122] 200 GET /hub/admin (rylo@10.240.0.10) 278.52ms\r\n[I 2017-09-14 22:28:22.934 JupyterHub log:122] 200 GET /hub/admin?sort=last_activity&order=desc& (rylo@10.240.0.10) 196.23ms\r\n[I 2017-09-14 22:29:08.615 JupyterHub log:122] 302 GET /hub/user/niemeyer/git-sync?repo=https://github.com/data-8/materials-fa17&subPath=materials/fa17/lab/lab04/lab04.ipynb \\u2192 /user/rylo/git-sync (rylo@10.240.0.10) 4.10ms\r\n[I 2017-09-14 22:29:08.674 JupyterHub log:122] 302 GET /user/rylo/git-sync \\u2192 /hub/user/rylo/git-sync (@10.240.0.10) 0.43ms\r\n[I 2017-09-14 22:29:10.760 JupyterHub base:448] User rylo took 2.047 seconds to start\r\n[I 2017-09-14 22:29:10.765 JupyterHub proxy:231] Adding user rylo to proxy /user/rylo/ => http://10.244.21.25:8888\r\n[I 2017-09-14 22:29:10.774 JupyterHub log:122] 302 GET /hub/user/rylo/git-sync \\u2192 /user/rylo/git-sync?redirects=1 (rylo@10.240.0.10) 2068.36ms\r\n[I 2017-09-14 22:29:35.230 JupyterHub log:122] 302 GET /hub/api/oauth2/authorize?client_id=user-rylo&redirect_uri=%2Fuser%2Frylo%2Foauth_callback&response_type=code&state=<state> \\u2192 /user/rylo/oauth_callback?code=<code>&state=<state> (rylo@10.240.0.10) 38.34ms\r\n[I 2017-09-14 22:29:35.342 JupyterHub log:122] 200 POST /hub/api/oauth2/token (rylo@10.244.21.25) 62.76ms\r\n[I 2017-09-14 22:29:35.363 JupyterHub log:122] 200 GET /hub/api/authorizations/token/[secret] (rylo@10.244.21.25) 17.80ms\r\n[I 2017-09-14 22:29:35.416 JupyterHub log:122] 200 GET /hub/api/authorizations/token/[secret] (rylo@10.244.21.25) 14.48ms\r\n[I 2017-09-14 22:29:40.493 JupyterHub log:122] 200 GET /hub/home (rylo@10.240.0.15) 7.94ms\r\n[I 2017-09-14 22:29:41.800 JupyterHub proxy:254] Removing user rylo from proxy (/user/rylo/)\r\n[W 2017-09-14 22:29:51.801 JupyterHub base:556] User rylo: server is slow to stop\r\n[I 2017-09-14 22:29:51.805 JupyterHub log:122] 202 DELETE /hub/api/users/rylo/server (rylo@10.240.0.15) 10009.36ms\r\n[I 2017-09-14 22:30:09.628 JupyterHub log:122] 302 GET /hub/user-redirect/git-sync?repo=https://github.com/data-8/materials-fa17&subPath=materials/fa17/lab/lab04/lab04.ipynb \\u2192 /user/rylo/git-sync?repo=https://github.com/data-8/materials-fa17&subPath=materials/fa17/lab/lab04/lab04.ipynb (rylo@10.240.0.15) 6.56ms\r\n[I 2017-09-14 22:30:09.661 JupyterHub log:122] 302 GET /user/rylo/git-sync?repo=https://github.com/data-8/materials-fa17&subPath=materials/fa17/lab/lab04/lab04.ipynb \\u2192 /hub/user/rylo/git-sync?repo=https://github.com/data-8/materials-fa17&subPath=materials/fa17/lab/lab04/lab04.ipynb (@10.240.0.15) 0.58ms\r\n[I 2017-09-14 22:30:09.698 JupyterHub base:725] rylo is pending stop\r\n[I 2017-09-14 22:30:09.702 JupyterHub log:122] 200 GET /hub/user/rylo/git-sync?repo=https://github.com/data-8/materials-fa17&subPath=materials/fa17/lab/lab04/lab04.ipynb (rylo@10.240.0.15) 7.36ms\r\n[I 2017-09-14 22:30:14.888 JupyterHub base:725] rylo is pending stop\r\n[I 2017-09-14 22:30:20.021 JupyterHub base:725] rylo is pending stop\r\n```\r\n\r\nThe user is then pending stop forever, and can not start pod again", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1420/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1420/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1414", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1414/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1414/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1414/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/1414", "id": 257231451, "node_id": "MDU6SXNzdWUyNTcyMzE0NTE=", "number": 1414, "title": "JupyterHub crashing with invalid database state", "user": {"login": "yuvipanda", "id": 30430, "node_id": "MDQ6VXNlcjMwNDMw", "avatar_url": "https://avatars.githubusercontent.com/u/30430?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuvipanda", "html_url": "https://github.com/yuvipanda", "followers_url": "https://api.github.com/users/yuvipanda/followers", "following_url": "https://api.github.com/users/yuvipanda/following{/other_user}", "gists_url": "https://api.github.com/users/yuvipanda/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuvipanda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuvipanda/subscriptions", "organizations_url": "https://api.github.com/users/yuvipanda/orgs", "repos_url": "https://api.github.com/users/yuvipanda/repos", "events_url": "https://api.github.com/users/yuvipanda/events{/privacy}", "received_events_url": "https://api.github.com/users/yuvipanda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2017-09-13T01:35:07Z", "updated_at": "2017-09-14T19:54:38Z", "closed_at": "2017-09-14T19:54:38Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "It looks like JupyterHub can go into a state where the state of the db is wrong / order of deletion is not right. This causes the hub to never start.\r\n\r\n```\r\nsingleuser.cmd jupyterhub-singleuser\r\n    Traceback (most recent call last):\r\n      File \"/usr/local/lib/python3.5/dist-packages/jupyterhub/app.py\", line 1623, in launch_instance_async\r\n        yield self.initialize(argv)\r\n      File \"/usr/lib/python3.5/types.py\", line 179, in throw\r\n        return self.__wrapped.throw(tp, *rest)\r\n      File \"/usr/local/lib/python3.5/dist-packages/jupyterhub/app.py\", line 1385, in initialize\r\n        yield self.init_spawners()\r\n      File \"/usr/local/lib/python3.5/dist-packages/jupyterhub/app.py\", line 1240, in init_spawners\r\n        db.commit()\r\n      File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/orm/session.py\", line 906, in commit\r\n        self.transaction.commit()\r\n      File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/orm/session.py\", line 461, in commit\r\n        self._prepare_impl()\r\n      File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/orm/session.py\", line 441, in _prepare_impl\r\n        self.session.flush()\r\n      File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/orm/session.py\", line 2171, in flush\r\n        self._flush(objects)\r\n      File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/orm/session.py\", line 2291, in _flush\r\n        transaction.rollback(_capture_exception=True)\r\n      File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/util/langhelpers.py\", line 66, in __exit__\r\n        compat.reraise(exc_type, exc_value, exc_tb)\r\n      File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/util/compat.py\", line 187, in reraise\r\n        raise value\r\n      File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/orm/session.py\", line 2255, in _flush\r\n        flush_context.execute()\r\n      File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/orm/unitofwork.py\", line 389, in execute\r\n        rec.execute(self)\r\n      File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/orm/unitofwork.py\", line 577, in execute\r\n        uow\r\n      File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/orm/persistence.py\", line 258, in delete_obj\r\n        cached_connections, mapper, table, delete)\r\n      File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/orm/persistence.py\", line 931, in _emit_delete_statements\r\n        c = connection.execute(statement, del_objects)\r\n      File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/engine/base.py\", line 945, in execute\r\n        return meth(self, multiparams, params)\r\n      File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/sql/elements.py\", line 263, in _execute_on_connection\r\n        return connection._execute_clauseelement(self, multiparams, params)\r\n      File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/engine/base.py\", line 1053, in _execute_clauseelement\r\n        compiled_sql, distilled_params\r\n      File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/engine/base.py\", line 1189, in _execute_context\r\n        context)\r\n      File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/engine/base.py\", line 1402, in _handle_dbapi_exception\r\n        exc_info\r\n      File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/util/compat.py\", line 203, in raise_from_cause\r\n        reraise(type(exception), exception, tb=exc_tb, cause=cause)\r\n      File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/util/compat.py\", line 186, in reraise\r\n        raise value.with_traceback(tb)\r\n      File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/engine/base.py\", line 1182, in _execute_context\r\n        context)\r\n      File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/engine/default.py\", line 470, in do_execute\r\n        cursor.execute(statement, parameters)\r\n    sqlalchemy.exc.IntegrityError: (psycopg2.IntegrityError) update or delete on table \"servers\" violates foreign key constraint \"spawners_server_id_fkey\" on table \"spawners\"\r\n    DETAIL:  Key (id)=(24433) is still referenced from table \"spawners\".\r\n     [SQL: 'DELETE FROM servers WHERE servers.id = %(id)s'] [parameters: {'id': 24433}]\r\n```", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1414/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1414/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1373", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1373/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1373/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1373/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/1373", "id": 253361627, "node_id": "MDU6SXNzdWUyNTMzNjE2Mjc=", "number": 1373, "title": "Strange temporary 403s when doing admin actions", "user": {"login": "yuvipanda", "id": 30430, "node_id": "MDQ6VXNlcjMwNDMw", "avatar_url": "https://avatars.githubusercontent.com/u/30430?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuvipanda", "html_url": "https://github.com/yuvipanda", "followers_url": "https://api.github.com/users/yuvipanda/followers", "following_url": "https://api.github.com/users/yuvipanda/following{/other_user}", "gists_url": "https://api.github.com/users/yuvipanda/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuvipanda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuvipanda/subscriptions", "organizations_url": "https://api.github.com/users/yuvipanda/orgs", "repos_url": "https://api.github.com/users/yuvipanda/repos", "events_url": "https://api.github.com/users/yuvipanda/events{/privacy}", "received_events_url": "https://api.github.com/users/yuvipanda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 388386197, "node_id": "MDU6TGFiZWwzODgzODYxOTc=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/needs:%20testing", "name": "needs: testing", "color": "c2e0c6", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-08-28T15:14:05Z", "updated_at": "2018-09-20T03:56:47Z", "closed_at": "2018-09-20T01:36:33Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "We see this now and then:\r\n\r\n```\r\n[W 2017-08-28 14:59:06.884 JupyterHub base:47] Blocking Cross Origin API request.  Referer: http://datahub.berkeley.edu/, Host: datahub.berkeley.edu/hub/\r\n```\r\n\r\nClears up after a while. No proxy in front of CHP.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1373/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1373/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1313", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1313/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1313/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1313/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/1313", "id": 248197710, "node_id": "MDU6SXNzdWUyNDgxOTc3MTA=", "number": 1313, "title": "JupyterHub master not reliably checking if user servers are running on startup", "user": {"login": "yuvipanda", "id": 30430, "node_id": "MDQ6VXNlcjMwNDMw", "avatar_url": "https://avatars.githubusercontent.com/u/30430?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuvipanda", "html_url": "https://github.com/yuvipanda", "followers_url": "https://api.github.com/users/yuvipanda/followers", "following_url": "https://api.github.com/users/yuvipanda/following{/other_user}", "gists_url": "https://api.github.com/users/yuvipanda/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuvipanda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuvipanda/subscriptions", "organizations_url": "https://api.github.com/users/yuvipanda/orgs", "repos_url": "https://api.github.com/users/yuvipanda/repos", "events_url": "https://api.github.com/users/yuvipanda/events{/privacy}", "received_events_url": "https://api.github.com/users/yuvipanda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2017-08-05T17:31:40Z", "updated_at": "2017-08-28T17:41:42Z", "closed_at": "2017-08-28T17:41:42Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": " How to reproduce:\r\n\r\n1. Start JupyterHub (with KubeSpawner)\r\n2. Spawn a user\r\n3. Stop JupyterHub\r\n4. Start JupyterHub again\r\n\r\nExpected:\r\n\r\n1. On startup, JupyterHub looks at all users to see if they are still running, and updates its own state\r\n\r\nWhat happens:\r\n\r\n```\r\n[D 2017-08-05 10:29:30.533 JupyterHub app:1215] test not running, status is 0.\r\n```\r\n\r\ndespite the fact that the pod is running.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1313/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1313/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1309", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1309/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1309/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1309/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/1309", "id": 248142089, "node_id": "MDU6SXNzdWUyNDgxNDIwODk=", "number": 1309, "title": "OAuthAccessToken hasn't kept up with auth.py", "user": {"login": "athornton", "id": 2453165, "node_id": "MDQ6VXNlcjI0NTMxNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/2453165?v=4", "gravatar_id": "", "url": "https://api.github.com/users/athornton", "html_url": "https://github.com/athornton", "followers_url": "https://api.github.com/users/athornton/followers", "following_url": "https://api.github.com/users/athornton/following{/other_user}", "gists_url": "https://api.github.com/users/athornton/gists{/gist_id}", "starred_url": "https://api.github.com/users/athornton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/athornton/subscriptions", "organizations_url": "https://api.github.com/users/athornton/orgs", "repos_url": "https://api.github.com/users/athornton/repos", "events_url": "https://api.github.com/users/athornton/events{/privacy}", "received_events_url": "https://api.github.com/users/athornton/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-08-04T23:54:49Z", "updated_at": "2017-08-08T12:18:51Z", "closed_at": "2017-08-08T12:18:51Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Hi! Thanks for using JupyterHub.\r\n\r\nIf you are reporting an issue with JupyterHub:\r\n\r\n- Please use the [GitHub issue](https://github.com/jupyterhub/jupyterhub/issues)\r\n  search feature to check if your issue has been asked already. If it has,\r\n  please add your comments to the existing issue.\r\n\r\n- Where applicable, please fill out the details below to help us troubleshoot\r\n  the issue that you are facing. Please be as thorough as you are able to\r\n  provide details on the issue.\r\n\r\n**How to reproduce the issue**\r\n\r\nAttempt to spawn an OAuth2-authenticated Lab session (with KubeSpawner).  OAuth2 is master commit 0927a19a2a3ddcf58a6938aa4297cd2df3ba474f plus my new auth_state logic, but nowhere in there does it touch the ORM stuff.\r\n\r\n**What you expected to happen**\r\n\r\nA container to spawn.\r\n\r\n**What actually happens**\r\n```\r\n  Traceback (most recent call last):\r\n      File \"/usr/lib64/python3.4/site-packages/tornado/web.py\", line 1509, in _execute\r\n        result = method(*self.path_args, **self.path_kwargs)\r\n      File \"/usr/lib/python3.4/site-packages/jupyterhub/utils.py\", line 193, in decorated\r\n        return method(self, *args, **kwargs)\r\n      File \"/usr/lib/python3.4/site-packages/jupyterhub/apihandlers/auth.py\", line 27, in get\r\n        elif orm_token.service:\r\n    AttributeError: 'OAuthAccessToken' object has no attribute 'service'\r\n```\r\n**Share what version of JupyterHub you are using**\r\n\r\nMaster, commit 0b34e13dd48bc73c8696eb63cde11b318b8f05a5\r\n\r\nRunning `jupyter troubleshoot` from the command line, if possible, and posting\r\nits output would also be helpful.\r\n\r\n```\r\nDEPRECATION: The default format will switch to columns in the future. You can use --format=(legacy|columns) (or define a format=(legacy|columns) in your pip.conf under the [list] section) to disable this warning.\r\n$PATH:\r\n\t/usr/bin\r\n\t/usr/local/sbin\r\n\t/usr/local/bin\r\n\t/usr/sbin\r\n\t/usr/bin\r\n\t/sbin\r\n\t/bin\r\n\r\nsys.path:\r\n\t/usr/bin\r\n\t/usr/lib64/python34.zip\r\n\t/usr/lib64/python3.4\r\n\t/usr/lib64/python3.4/plat-linux\r\n\t/usr/lib64/python3.4/lib-dynload\r\n\t/usr/lib64/python3.4/site-packages\r\n\t/usr/lib/python3.4/site-packages\r\n\r\nsys.executable:\r\n\t/usr/bin/python3.4\r\n\r\nsys.version:\r\n\t3.4.5 (default, May 29 2017, 15:17:55)\r\n\t[GCC 4.8.5 20150623 (Red Hat 4.8.5-11)]\r\n\r\nplatform.platform():\r\n\tLinux-4.4.52+-x86_64-with-centos-7.3.1611-Core\r\n\r\npip list:\r\n\talembic (0.9.3)\r\n\tasn1crypto (0.22.0)\r\n\tbackports-abc (0.5)\r\n\tbleach (2.0.0)\r\n\tcertifi (2017.7.27.1)\r\n\tcffi (1.10.0)\r\n\tchardet (3.0.4)\r\n\tcryptography (2.0.2)\r\n\tdecorator (4.1.2)\r\n\tentrypoints (0.2.3)\r\n\tescapism (0.0.1)\r\n\thtml5lib (0.999999999)\r\n\thttplib2 (0.10.3)\r\n\tidna (2.5)\r\n\tipaddress (1.0.18)\r\n\tipykernel (4.6.1)\r\n\tipython (6.1.0)\r\n\tipython-genutils (0.2.0)\r\n\tjedi (0.10.2)\r\n\tJinja2 (2.9.6)\r\n\tjsonschema (2.6.0)\r\n\tjupyter-client (5.1.0)\r\n\tjupyter-core (4.3.0)\r\n\tjupyterhub (0.8.0.dev0)\r\n\tjupyterhub-kubespawner (0.5.1)\r\n\tjupyterlab (0.26.4)\r\n\tjupyterlab-launcher (0.3.1)\r\n\tkubernetes (2.0.0)\r\n\tMako (1.0.7)\r\n\tMarkupSafe (1.0)\r\n\tmistune (0.7.4)\r\n\tnbconvert (5.2.1)\r\n\tnbformat (4.3.0)\r\n\tnotebook (5.0.0)\r\n\toauth2client (4.1.2)\r\n\toauthenticator (0.7.0.dev0)\r\n\tpamela (0.3.0)\r\n\tpandocfilters (1.4.1)\r\n\tpexpect (4.2.1)\r\n\tpickleshare (0.7.4)\r\n\tpip (9.0.1)\r\n\tprompt-toolkit (1.0.15)\r\n\tptyprocess (0.5.2)\r\n\tpyasn1 (0.3.2)\r\n\tpyasn1-modules (0.0.11)\r\n\tpycparser (2.18)\r\n\tpycurl (7.43.0)\r\n\tPygments (2.2.0)\r\n\tpython-dateutil (2.6.1)\r\n\tpython-editor (1.0.3)\r\n\tpython-oauth2 (1.0.1)\r\n\tPyYAML (3.12)\r\n\tpyzmq (16.0.2)\r\n\trequests (2.18.2)\r\n\trsa (3.4.2)\r\n\tsetuptools (36.2.5)\r\n\tsimplegeneric (0.8.1)\r\n\tsix (1.10.0)\r\n\tSQLAlchemy (1.1.12)\r\n\tterminado (0.6)\r\n\ttestpath (0.3.1)\r\n\ttornado (4.5.1)\r\n\ttraitlets (4.3.2)\r\n\ttyping (3.6.1)\r\n\turllib3 (1.22)\r\n\twcwidth (0.1.7)\r\n\twebencodings (0.5.1)\r\n\twebsocket-client (0.44.0)\r\n\twheel (0.29.0)\r\n```\r\n\r\n*** Workaround ***\r\n\r\nPatch jupyterhub/apihandlers/auth.py with\r\n\r\n```\r\ndiff -u a/auth.py b/auth.py\r\n--- a/auth.py\t2017-08-04 16:21:55.000000000 -0700\r\n+++ b/auth.py\t2017-08-04 16:25:36.000000000 -0700\r\n@@ -24,7 +24,7 @@\r\n             raise web.HTTPError(404)\r\n         if orm_token.user:\r\n             model = self.user_model(self.users[orm_token.user])\r\n-        elif orm_token.service:\r\n+        elif \"service\" in orm_token and orm_token.service:\r\n             model = self.service_model(orm_token.service)\r\n         self.write(json.dumps(model))\r\n```", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1309/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1309/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1260", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1260/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1260/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1260/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/1260", "id": 245131595, "node_id": "MDU6SXNzdWUyNDUxMzE1OTU=", "number": 1260, "title": "PrefixRedirectUrl redirect `/hub` to `/hub/hub`", "user": {"login": "Carreau", "id": 335567, "node_id": "MDQ6VXNlcjMzNTU2Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/335567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Carreau", "html_url": "https://github.com/Carreau", "followers_url": "https://api.github.com/users/Carreau/followers", "following_url": "https://api.github.com/users/Carreau/following{/other_user}", "gists_url": "https://api.github.com/users/Carreau/gists{/gist_id}", "starred_url": "https://api.github.com/users/Carreau/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Carreau/subscriptions", "organizations_url": "https://api.github.com/users/Carreau/orgs", "repos_url": "https://api.github.com/users/Carreau/repos", "events_url": "https://api.github.com/users/Carreau/events{/privacy}", "received_events_url": "https://api.github.com/users/Carreau/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2017-07-24T16:11:18Z", "updated_at": "2017-08-08T16:07:56Z", "closed_at": "2017-08-08T16:07:56Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "It might be an edge case, which is not really important, \r\nbut I expected `/hub` -> `/hub/` and not `/hub/hub`. This is to to `uri.startswith(self.base_url)`, and `base_url` is guarantied to end with a `/`. Now of course we can't just strip the trailing slash from `base_url` or things like `/hubot` will not be redirected to `/hub/hubot`, and doing nothing may be the right answer. ", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1260/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1260/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1244", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1244/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1244/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1244/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/1244", "id": 244489632, "node_id": "MDU6SXNzdWUyNDQ0ODk2MzI=", "number": 1244, "title": "[ConfigProxy] Proxy error:  Error: socket hang up", "user": {"login": "tritemio", "id": 4156237, "node_id": "MDQ6VXNlcjQxNTYyMzc=", "avatar_url": "https://avatars.githubusercontent.com/u/4156237?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tritemio", "html_url": "https://github.com/tritemio", "followers_url": "https://api.github.com/users/tritemio/followers", "following_url": "https://api.github.com/users/tritemio/following{/other_user}", "gists_url": "https://api.github.com/users/tritemio/gists{/gist_id}", "starred_url": "https://api.github.com/users/tritemio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tritemio/subscriptions", "organizations_url": "https://api.github.com/users/tritemio/orgs", "repos_url": "https://api.github.com/users/tritemio/repos", "events_url": "https://api.github.com/users/tritemio/events{/privacy}", "received_events_url": "https://api.github.com/users/tritemio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 542035446, "node_id": "MDU6TGFiZWw1NDIwMzU0NDY=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/configuration", "name": "configuration", "color": "c5def5", "default": false, "description": null}, {"id": 1280242352, "node_id": "MDU6TGFiZWwxMjgwMjQyMzUy", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/support", "name": "support", "color": "Cfaef7", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 21, "created_at": "2017-07-20T20:38:04Z", "updated_at": "2020-04-18T19:06:37Z", "closed_at": "2020-04-18T19:06:37Z", "author_association": "NONE", "active_lock_reason": null, "body": "I have jupyterhub installation on a linux machine, installed in a dedicated conda environment without any custom configuration. I connect to this server from other computers in the same local network using linux user authentication and I was really pleased to see jupyterhub working out of the box when I installed the system 2-3 months ago.\r\n\r\nToday however I started having some issues :-)\r\n\r\nAfter user login a server is started but the dashboard does not shows the files. After some seconds I get an error in the terminal I started jupyterhub from:\r\n\r\n```\r\n[I 2017-07-20 13:24:26.238 JupyterHub log:100] 200 GET /hub/error/503?url=%2Fuser%2Fanto%2Fstatic%2Fcomponents%2Fjquery-ui%2Fui%2Fminified%2Fjquery-ui.min.js%3Fv%3D20170720132224 (@127.0.0.1) 1.88ms\r\n13:24:29.807 - error: [ConfigProxy] Proxy error:  Error: socket hang up\r\n    at createHangUpError (_http_client.js:252:15)\r\n    at Socket.socketCloseListener (_http_client.js:284:23)\r\n    at emitOne (events.js:101:20)\r\n    at Socket.emit (events.js:188:7)\r\n    at TCP._handle.close [as _onclose] (net.js:493:12)\r\n13:24:29.808 - error: [ConfigProxy] 503 GET /user/anto/tree\r\n13:24:29.810 - error: [ConfigProxy] Proxy error:  Error: socket hang up\r\n    at createHangUpError (_http_client.js:252:15)\r\n    at Socket.socketCloseListener (_http_client.js:284:23)\r\n    at emitOne (events.js:101:20)\r\n    at Socket.emit (events.js:188:7)\r\n    at TCP._handle.close [as _onclose] (net.js:493:12)\r\n13:24:29.810 - error: [ConfigProxy] 503 GET /user/anto/api/contents?type=directory&_=1500582142476\r\n13:24:29.814 - error: [ConfigProxy] Proxy error:  Error: socket hang up\r\n    at createHangUpError (_http_client.js:252:15)\r\n    at Socket.socketCloseListener (_http_client.js:284:23)\r\n    at emitOne (events.js:101:20)\r\n    at Socket.emit (events.js:188:7)\r\n    at TCP._handle.close [as _onclose] (net.js:493:12)\r\n13:24:29.814 - error: [ConfigProxy] 503 GET /user/anto/static/components/jquery-ui/ui/minified/jquery-ui.min.js?v=20170720132224\r\n13:24:29.815 - error: [ConfigProxy] Proxy error:  Error: socket hang up\r\n    at createHangUpError (_http_client.js:252:15)\r\n    at Socket.socketCloseListener (_http_client.js:284:23)\r\n    at emitOne (events.js:101:20)\r\n    at Socket.emit (events.js:188:7)\r\n    at TCP._handle.close [as _onclose] (net.js:493:12)\r\n13:24:29.816 - error: [ConfigProxy] 503 GET /user/anto/nbextensions/nbextensions_configurator/main.js?v=20170720132224\r\n[I 2017-07-20 13:24:29.817 JupyterHub log:100] 200 GET /hub/error/503?url=%2Fuser%2Fanto%2Ftree (@127.0.0.1) 2.86ms\r\n13:24:29.820 - error: [ConfigProxy] Proxy error:  Error: socket hang up\r\n    at createHangUpError (_http_client.js:252:15)\r\n    at Socket.socketCloseListener (_http_client.js:284:23)\r\n    at emitOne (events.js:101:20)\r\n    at Socket.emit (events.js:188:7)\r\n    at TCP._handle.close [as _onclose] (net.js:493:12)\r\n13:24:29.821 - error: [ConfigProxy] 503 GET /user/anto/nbextensions/nbextensions_configurator/render/render.js?v=20170720132224\r\n```\r\n\r\nNothing changed to the configuration, nor I update conda packages.\r\n\r\nAny help is appreciated.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1244/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1244/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1162", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1162/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1162/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1162/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/1162", "id": 233283086, "node_id": "MDU6SXNzdWUyMzMyODMwODY=", "number": 1162, "title": "Issues using upgrade-db on a fresh database", "user": {"login": "jhamrick", "id": 83444, "node_id": "MDQ6VXNlcjgzNDQ0", "avatar_url": "https://avatars.githubusercontent.com/u/83444?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhamrick", "html_url": "https://github.com/jhamrick", "followers_url": "https://api.github.com/users/jhamrick/followers", "following_url": "https://api.github.com/users/jhamrick/following{/other_user}", "gists_url": "https://api.github.com/users/jhamrick/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhamrick/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhamrick/subscriptions", "organizations_url": "https://api.github.com/users/jhamrick/orgs", "repos_url": "https://api.github.com/users/jhamrick/repos", "events_url": "https://api.github.com/users/jhamrick/events{/privacy}", "received_events_url": "https://api.github.com/users/jhamrick/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/milestones/5", "html_url": "https://github.com/jupyterhub/jupyterhub/milestone/5", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/milestones/5/labels", "id": 2131170, "node_id": "MDk6TWlsZXN0b25lMjEzMTE3MA==", "number": 5, "title": "0.8", "description": "", "creator": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 193, "state": "closed", "created_at": "2016-11-12T18:34:21Z", "updated_at": "2017-10-05T19:30:31Z", "due_on": null, "closed_at": "2017-10-05T19:30:31Z"}, "comments": 2, "created_at": "2017-06-02T19:56:10Z", "updated_at": "2017-08-02T09:14:45Z", "closed_at": "2017-08-02T09:14:45Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Database migration works only if you start on an old version of the database. But, consider the case where I create a JupyterHub database today, and then a future release updates the database. Running `jupyterhub upgrade-db` then would fail, because the database existing today doesn't have the `alembic_version` table specifying what the current version is. So, alembic will assume the version is the old version, and try to insert columns that already exist:\r\n\r\n```\r\n$ jupyterhub\r\n...\r\n$ jupyterhub upgrade-db\r\nINFO  [alembic.runtime.migration] Context impl SQLiteImpl.\r\nINFO  [alembic.runtime.migration] Will assume non-transactional DDL.\r\nINFO  [alembic.runtime.migration] Running upgrade  -> 19c0846f6344, base revision for 0.5\r\nINFO  [alembic.runtime.migration] Running upgrade 19c0846f6344 -> eeb276e51423, auth_state\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/engine/base.py\", line 1182, in _execute_context\r\n    context)\r\n  File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/engine/default.py\", line 470, in do_execute\r\n    cursor.execute(statement, parameters)\r\nsqlite3.OperationalError: duplicate column name: auth_state\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"/usr/local/bin/alembic\", line 11, in <module>\r\n    sys.exit(main())\r\n  File \"/usr/local/lib/python3.5/dist-packages/alembic/config.py\", line 479, in main\r\n    CommandLine(prog=prog).main(argv=argv)\r\n  File \"/usr/local/lib/python3.5/dist-packages/alembic/config.py\", line 473, in main\r\n    self.run_cmd(cfg, options)\r\n  File \"/usr/local/lib/python3.5/dist-packages/alembic/config.py\", line 456, in run_cmd\r\n    **dict((k, getattr(options, k, None)) for k in kwarg)\r\n  File \"/usr/local/lib/python3.5/dist-packages/alembic/command.py\", line 254, in upgrade\r\n    script.run_env()\r\n  File \"/usr/local/lib/python3.5/dist-packages/alembic/script/base.py\", line 416, in run_env\r\n    util.load_python_file(self.dir, 'env.py')\r\n  File \"/usr/local/lib/python3.5/dist-packages/alembic/util/pyfiles.py\", line 93, in load_python_file\r\n    module = load_module_py(module_id, path)\r\n  File \"/usr/local/lib/python3.5/dist-packages/alembic/util/compat.py\", line 64, in load_module_py\r\n    module_id, path).load_module(module_id)\r\n  File \"<frozen importlib._bootstrap_external>\", line 388, in _check_name_wrapper\r\n  File \"<frozen importlib._bootstrap_external>\", line 809, in load_module\r\n  File \"<frozen importlib._bootstrap_external>\", line 668, in load_module\r\n  File \"<frozen importlib._bootstrap>\", line 268, in _load_module_shim\r\n  File \"<frozen importlib._bootstrap>\", line 693, in _load\r\n  File \"<frozen importlib._bootstrap>\", line 673, in _load_unlocked\r\n  File \"<frozen importlib._bootstrap_external>\", line 665, in exec_module\r\n  File \"<frozen importlib._bootstrap>\", line 222, in _call_with_frames_removed\r\n  File \"/usr/local/lib/python3.5/dist-packages/jupyterhub/alembic/env.py\", line 70, in <module>\r\n    run_migrations_online()\r\n  File \"/usr/local/lib/python3.5/dist-packages/jupyterhub/alembic/env.py\", line 65, in run_migrations_online\r\n    context.run_migrations()\r\n  File \"<string>\", line 8, in run_migrations\r\n  File \"/usr/local/lib/python3.5/dist-packages/alembic/runtime/environment.py\", line 817, in run_migrations\r\n    self.get_context().run_migrations(**kw)\r\n  File \"/usr/local/lib/python3.5/dist-packages/alembic/runtime/migration.py\", line 323, in run_migrations\r\n    step.migration_fn(**kw)\r\n  File \"/usr/local/lib/python3.5/dist-packages/jupyterhub/alembic/versions/eeb276e51423_auth_state.py\", line 21, in upgrade\r\n    op.add_column('users', sa.Column('auth_state', JSONDict))\r\n  File \"<string>\", line 8, in add_column\r\n  File \"<string>\", line 3, in add_column\r\n  File \"/usr/local/lib/python3.5/dist-packages/alembic/operations/ops.py\", line 1551, in add_column\r\n    return operations.invoke(op)\r\n  File \"/usr/local/lib/python3.5/dist-packages/alembic/operations/base.py\", line 318, in invoke\r\n    return fn(self, operation)\r\n  File \"/usr/local/lib/python3.5/dist-packages/alembic/operations/toimpl.py\", line 123, in add_column\r\n    schema=schema\r\n  File \"/usr/local/lib/python3.5/dist-packages/alembic/ddl/impl.py\", line 172, in add_column\r\n    self._exec(base.AddColumn(table_name, column, schema=schema))\r\n  File \"/usr/local/lib/python3.5/dist-packages/alembic/ddl/impl.py\", line 118, in _exec\r\n    return conn.execute(construct, *multiparams, **params)\r\n  File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/engine/base.py\", line 945, in execute\r\n    return meth(self, multiparams, params)\r\n  File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/sql/ddl.py\", line 68, in _execute_on_connection\r\n    return connection._execute_ddl(self, multiparams, params)\r\n  File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/engine/base.py\", line 1002, in _execute_ddl\r\n    compiled\r\n  File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/engine/base.py\", line 1189, in _execute_context\r\n    context)\r\n  File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/engine/base.py\", line 1402, in _handle_dbapi_exception\r\n    exc_info\r\n  File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/util/compat.py\", line 203, in raise_from_cause\r\n    reraise(type(exception), exception, tb=exc_tb, cause=cause)\r\n  File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/util/compat.py\", line 186, in reraise\r\n    raise value.with_traceback(tb)\r\n  File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/engine/base.py\", line 1182, in _execute_context\r\n    context)\r\n  File \"/usr/local/lib/python3.5/dist-packages/sqlalchemy/engine/default.py\", line 470, in do_execute\r\n    cursor.execute(statement, parameters)\r\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) duplicate column name: auth_state [SQL: 'ALTER TABLE users ADD COLUMN auth_state TEXT']\r\n[E 2017-06-02 19:55:16.017 JupyterHub app:1527]\r\n    Traceback (most recent call last):\r\n      File \"/usr/local/lib/python3.5/dist-packages/jupyterhub/app.py\", line 1525, in launch_instance_async\r\n        yield self.start()\r\n      File \"/usr/local/lib/python3.5/dist-packages/jupyterhub/app.py\", line 1436, in start\r\n        self.subapp.start()\r\n      File \"/usr/local/lib/python3.5/dist-packages/jupyterhub/app.py\", line 185, in start\r\n        dbutil.upgrade(hub.db_url)\r\n      File \"/usr/local/lib/python3.5/dist-packages/jupyterhub/dbutil.py\", line 80, in upgrade\r\n        ['alembic', '-c', alembic_ini, 'upgrade', revision]\r\n      File \"/usr/lib/python3.5/subprocess.py\", line 581, in check_call\r\n        raise CalledProcessError(retcode, cmd)\r\n    subprocess.CalledProcessError: Command '['alembic', '-c', '/tmp/tmpkqvnuq0a/alembic.ini', 'upgrade', 'head']' returned non-zero exit status 1\r\n```\r\n\r\nI got around this in nbgrader by creating the `alembic_version` table the first time the database is initialized:\r\n\r\nhttps://github.com/jupyter/nbgrader/blob/master/nbgrader/api.py#L1045", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1162/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1162/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1105", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1105/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1105/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1105/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/1105", "id": 224380286, "node_id": "MDU6SXNzdWUyMjQzODAyODY=", "number": 1105, "title": "Passwords beginning or ending with a whitespace are not supported", "user": {"login": "bneijt", "id": 61703, "node_id": "MDQ6VXNlcjYxNzAz", "avatar_url": "https://avatars.githubusercontent.com/u/61703?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bneijt", "html_url": "https://github.com/bneijt", "followers_url": "https://api.github.com/users/bneijt/followers", "following_url": "https://api.github.com/users/bneijt/following{/other_user}", "gists_url": "https://api.github.com/users/bneijt/gists{/gist_id}", "starred_url": "https://api.github.com/users/bneijt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bneijt/subscriptions", "organizations_url": "https://api.github.com/users/bneijt/orgs", "repos_url": "https://api.github.com/users/bneijt/repos", "events_url": "https://api.github.com/users/bneijt/events{/privacy}", "received_events_url": "https://api.github.com/users/bneijt/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/milestones/5", "html_url": "https://github.com/jupyterhub/jupyterhub/milestone/5", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/milestones/5/labels", "id": 2131170, "node_id": "MDk6TWlsZXN0b25lMjEzMTE3MA==", "number": 5, "title": "0.8", "description": "", "creator": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 193, "state": "closed", "created_at": "2016-11-12T18:34:21Z", "updated_at": "2017-10-05T19:30:31Z", "due_on": null, "closed_at": "2017-10-05T19:30:31Z"}, "comments": 1, "created_at": "2017-04-26T08:11:46Z", "updated_at": "2017-04-28T14:41:16Z", "closed_at": "2017-04-28T14:41:16Z", "author_association": "NONE", "active_lock_reason": null, "body": "Due to POST argument stripping, passwords with a beginning or ending whitespace are not allowed.\r\n\r\n**How to reproduce the issue**\r\nSet up a user password with an ending or beginning whitespace.\r\n\r\n**What you expected to happen**\r\nThe user should be allowed to login with the password, given that the password should be any complicated sequence of characters the user can reproduce.\r\n\r\n**What actually happens**\r\nThe user is denied access, because the LoginHandler will strip all posted values before considering the password for authentication (line 81, get_argument has a default \"strip=True\")\r\n\r\n**Share what version of JupyterHub you are using**\r\nHEAD (006488fc749923851df97d47d8850bdf5fd157cf)\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1105/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1105/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1089", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1089/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1089/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1089/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/1089", "id": 222308978, "node_id": "MDU6SXNzdWUyMjIzMDg5Nzg=", "number": 1089, "title": "Fractional memory / CPU limits / guarantees fail", "user": {"login": "yuvipanda", "id": 30430, "node_id": "MDQ6VXNlcjMwNDMw", "avatar_url": "https://avatars.githubusercontent.com/u/30430?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuvipanda", "html_url": "https://github.com/yuvipanda", "followers_url": "https://api.github.com/users/yuvipanda/followers", "following_url": "https://api.github.com/users/yuvipanda/following{/other_user}", "gists_url": "https://api.github.com/users/yuvipanda/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuvipanda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuvipanda/subscriptions", "organizations_url": "https://api.github.com/users/yuvipanda/orgs", "repos_url": "https://api.github.com/users/yuvipanda/repos", "events_url": "https://api.github.com/users/yuvipanda/events{/privacy}", "received_events_url": "https://api.github.com/users/yuvipanda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "yuvipanda", "id": 30430, "node_id": "MDQ6VXNlcjMwNDMw", "avatar_url": "https://avatars.githubusercontent.com/u/30430?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuvipanda", "html_url": "https://github.com/yuvipanda", "followers_url": "https://api.github.com/users/yuvipanda/followers", "following_url": "https://api.github.com/users/yuvipanda/following{/other_user}", "gists_url": "https://api.github.com/users/yuvipanda/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuvipanda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuvipanda/subscriptions", "organizations_url": "https://api.github.com/users/yuvipanda/orgs", "repos_url": "https://api.github.com/users/yuvipanda/repos", "events_url": "https://api.github.com/users/yuvipanda/events{/privacy}", "received_events_url": "https://api.github.com/users/yuvipanda/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "yuvipanda", "id": 30430, "node_id": "MDQ6VXNlcjMwNDMw", "avatar_url": "https://avatars.githubusercontent.com/u/30430?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuvipanda", "html_url": "https://github.com/yuvipanda", "followers_url": "https://api.github.com/users/yuvipanda/followers", "following_url": "https://api.github.com/users/yuvipanda/following{/other_user}", "gists_url": "https://api.github.com/users/yuvipanda/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuvipanda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuvipanda/subscriptions", "organizations_url": "https://api.github.com/users/yuvipanda/orgs", "repos_url": "https://api.github.com/users/yuvipanda/repos", "events_url": "https://api.github.com/users/yuvipanda/events{/privacy}", "received_events_url": "https://api.github.com/users/yuvipanda/received_events", "type": "User", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/milestones/5", "html_url": "https://github.com/jupyterhub/jupyterhub/milestone/5", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/milestones/5/labels", "id": 2131170, "node_id": "MDk6TWlsZXN0b25lMjEzMTE3MA==", "number": 5, "title": "0.8", "description": "", "creator": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 193, "state": "closed", "created_at": "2016-11-12T18:34:21Z", "updated_at": "2017-10-05T19:30:31Z", "due_on": null, "closed_at": "2017-10-05T19:30:31Z"}, "comments": 3, "created_at": "2017-04-18T05:48:05Z", "updated_at": "2017-09-18T08:50:57Z", "closed_at": "2017-09-18T08:50:57Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**How to reproduce the issue**\r\n\r\nSet memory limit (or guarantee, or cpu limit / guarantee) to a non-integral spec:\r\n\r\n```python\r\nc.Spawner.mem_limit = \"1.5G\"\r\n```\r\n\r\n**What you expected to happen**\r\n\r\n(In supported spawners) memory limit is set to 1.5 gigabytes of RAM\r\n\r\n**What actually happens**\r\n\r\nJupyterHub refuses to start, with:\r\n\r\n```\r\n[E 2017-04-18 05:39:02.270 JupyterHub app:1527]\r\n    Traceback (most recent call last):\r\n      File \"/usr/local/lib/python3.4/dist-packages/jupyterhub/app.py\", line 1524, in launch_instance_async\r\n        yield self.initialize(argv)\r\n      File \"/usr/local/lib/python3.4/dist-packages/jupyterhub/app.py\", line 1315, in initialize\r\n        yield self.init_spawners()\r\n      File \"/usr/local/lib/python3.4/dist-packages/jupyterhub/app.py\", line 1084, in init_spawners\r\n        self.users[orm_user.id] = user = User(orm_user, self.tornado_settings)\r\n      File \"/usr/local/lib/python3.4/dist-packages/jupyterhub/user.py\", line 128, in __init__\r\n        config=self.settings.get('config'),\r\n      File \"/usr/local/lib/python3.4/dist-packages/kubespawner/spawner.py\", line 29, in __init__\r\n        super().__init__(*args, **kwargs)\r\n      File \"/usr/local/lib/python3.4/dist-packages/jupyterhub/spawner.py\", line 345, in __init__\r\n        super(Spawner, self).__init__(**kwargs)\r\n      File \"/usr/local/lib/python3.4/dist-packages/traitlets/config/configurable.py\", line 84, in __init__\r\n        self.config = config\r\n      File \"/usr/local/lib/python3.4/dist-packages/traitlets/traitlets.py\", line 585, in __set__\r\n        self.set(obj, value)\r\n      File \"/usr/local/lib/python3.4/dist-packages/traitlets/traitlets.py\", line 574, in set\r\n        obj._notify_trait(self.name, old_value, new_value)\r\n      File \"/usr/local/lib/python3.4/dist-packages/traitlets/traitlets.py\", line 1139, in _notify_trait\r\n        type='change',\r\n      File \"/usr/local/lib/python3.4/dist-packages/traitlets/traitlets.py\", line 1176, in notify_change\r\n        c(change)\r\n      File \"/usr/local/lib/python3.4/dist-packages/traitlets/traitlets.py\", line 819, in compatible_observer\r\n        return func(self, change)\r\n      File \"/usr/local/lib/python3.4/dist-packages/traitlets/config/configurable.py\", line 186, in _config_changed\r\n        self._load_config(change.new, traits=traits, section_names=section_names)\r\n      File \"/usr/local/lib/python3.4/dist-packages/traitlets/config/configurable.py\", line 153, in _load_config\r\n        setattr(self, name, deepcopy(config_value))\r\n      File \"/usr/local/lib/python3.4/dist-packages/traitlets/traitlets.py\", line 585, in __set__\r\n        self.set(obj, value)\r\n      File \"/usr/local/lib/python3.4/dist-packages/traitlets/traitlets.py\", line 559, in set\r\n        new_value = self._validate(obj, value)\r\n      File \"/usr/local/lib/python3.4/dist-packages/traitlets/traitlets.py\", line 591, in _validate\r\n        value = self.validate(obj, value)\r\n      File \"/usr/local/lib/python3.4/dist-packages/jupyterhub/traitlets.py\", line 71, in validate\r\n        return int(num) * ByteSpecification.UNIT_SUFFIXES[suffix]\r\n    ValueError: invalid literal for int() with base 10: '1.5'\r\n```\r\n\r\n**Share what version of JupyterHub you are using**\r\n\r\n0.72.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1089/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1089/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1088", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1088/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1088/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1088/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/1088", "id": 222261027, "node_id": "MDU6SXNzdWUyMjIyNjEwMjc=", "number": 1088, "title": "Jupyterhub 0.7.2 does not work with a MySQL backend", "user": {"login": "yuvipanda", "id": 30430, "node_id": "MDQ6VXNlcjMwNDMw", "avatar_url": "https://avatars.githubusercontent.com/u/30430?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuvipanda", "html_url": "https://github.com/yuvipanda", "followers_url": "https://api.github.com/users/yuvipanda/followers", "following_url": "https://api.github.com/users/yuvipanda/following{/other_user}", "gists_url": "https://api.github.com/users/yuvipanda/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuvipanda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuvipanda/subscriptions", "organizations_url": "https://api.github.com/users/yuvipanda/orgs", "repos_url": "https://api.github.com/users/yuvipanda/repos", "events_url": "https://api.github.com/users/yuvipanda/events{/privacy}", "received_events_url": "https://api.github.com/users/yuvipanda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 542035446, "node_id": "MDU6TGFiZWw1NDIwMzU0NDY=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/configuration", "name": "configuration", "color": "c5def5", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-04-17T23:39:37Z", "updated_at": "2017-08-26T13:01:00Z", "closed_at": "2017-08-26T13:01:00Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**How to reproduce the issue**\r\n\r\n1. Setup a JupyterHub with mysql database backend, pointing to an empty database\r\n\r\n**What you expected to happen**\r\n\r\n2. JupyterHub creates the required tables in the database on start\r\n\r\n**What actually happens**\r\n\r\nIt fails to start, with:\r\n\r\n```\r\n    sqlalchemy.exc.InternalError: (pymysql.err.InternalError) (1071, 'Specified key was too long; max key length is 767 bytes') [SQL: '\\nCREATE TABLE groups (\\n\\tid INTEGER NOT NULL AUTO_INCREMENT, \\n\\tname VARCHAR(1023), \\n\\tPRIMARY KEY (id), \\n\\tUNIQUE (name)\\n)\\n\\n']\r\n```\r\n\r\nI think the group name needs to be smaller.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1088/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1088/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1049", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1049/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1049/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1049/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/1049", "id": 218228482, "node_id": "MDU6SXNzdWUyMTgyMjg0ODI=", "number": 1049, "title": "Raise 403 on authenticated user without access to single-user server", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-03-30T15:04:44Z", "updated_at": "2017-08-07T09:24:08Z", "closed_at": "2017-08-07T09:24:08Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Right now, when a user is logged-in and visits another user's server, they start the login redirect process. This can result in a redirect loop if the user shouldn't have access to the server.\r\n\r\nInstead, if a user is identified and doesn't have access, the user should get a 403 instead of redirecting back to login.\r\n\r\nThe tricky bit is that 'authenticated' is generally determined by `if get_current_user()` returns anything, and we should return None for not authenticated. Just raising 403 doesn't work because `get_current_user` may be called again when rendering the error page, for instance, preventing the page from rendering.\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1049/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1049/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1011", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1011/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1011/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1011/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/1011", "id": 212502686, "node_id": "MDU6SXNzdWUyMTI1MDI2ODY=", "number": 1011, "title": "Master throws exception due to incorrect cookie change handler.", "user": {"login": "stefanoborini", "id": 132967, "node_id": "MDQ6VXNlcjEzMjk2Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/132967?v=4", "gravatar_id": "", "url": "https://api.github.com/users/stefanoborini", "html_url": "https://github.com/stefanoborini", "followers_url": "https://api.github.com/users/stefanoborini/followers", "following_url": "https://api.github.com/users/stefanoborini/following{/other_user}", "gists_url": "https://api.github.com/users/stefanoborini/gists{/gist_id}", "starred_url": "https://api.github.com/users/stefanoborini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/stefanoborini/subscriptions", "organizations_url": "https://api.github.com/users/stefanoborini/orgs", "repos_url": "https://api.github.com/users/stefanoborini/repos", "events_url": "https://api.github.com/users/stefanoborini/events{/privacy}", "received_events_url": "https://api.github.com/users/stefanoborini/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 106589228, "node_id": "MDU6TGFiZWwxMDY1ODkyMjg=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/question", "name": "question", "color": "Cfaef7", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-03-07T17:26:47Z", "updated_at": "2017-03-10T12:55:09Z", "closed_at": "2017-03-10T12:55:09Z", "author_association": "NONE", "active_lock_reason": null, "body": "**How to reproduce the issue**\r\n\r\nJust start the service\r\n\r\n**What you expected to happen**\r\n\r\njupyterhub to start\r\n\r\n**What actually happens**\r\n\r\n```\r\n[I 2017-03-07 18:15:36.804 JupyterHub app:750] Loading cookie_secret from /home/stefano/simphony-remote/jupyterhub/jupyterhub_cookie_secret\r\n[E 2017-03-07 18:15:36.805 JupyterHub app:1614]\r\n    Traceback (most recent call last):\r\n      File \"/home/stefano/simphony-remote/venv/lib/python3.5/site-packages/jupyterhub/app.py\", line 1611, in launch_instance_async\r\n        yield self.initialize(argv)\r\n      File \"/usr/lib/python3.5/types.py\", line 199, in __next__\r\n        return next(self.__wrapped)\r\n      File \"/home/stefano/simphony-remote/venv/lib/python3.5/site-packages/jupyterhub/app.py\", line 1369, in initialize\r\n        self.init_secrets()\r\n      File \"/home/stefano/simphony-remote/venv/lib/python3.5/site-packages/jupyterhub/app.py\", line 797, in init_secrets\r\n        self.cookie_secret = secret\r\n      File \"/home/stefano/simphony-remote/venv/lib/python3.5/site-packages/traitlets/traitlets.py\", line 558, in __set__\r\n        self.set(obj, value)\r\n      File \"/home/stefano/simphony-remote/venv/lib/python3.5/site-packages/traitlets/traitlets.py\", line 547, in set\r\n        obj._notify_trait(self.name, old_value, new_value)\r\n      File \"/home/stefano/simphony-remote/venv/lib/python3.5/site-packages/traitlets/traitlets.py\", line 1049, in _notify_trait\r\n        'type': 'change',\r\n      File \"/home/stefano/simphony-remote/venv/lib/python3.5/site-packages/traitlets/traitlets.py\", line 1083, in notify_change\r\n        c(change)\r\n      File \"/home/stefano/simphony-remote/venv/lib/python3.5/site-packages/jupyterhub/app.py\", line 425, in _cookie_secret_check\r\n        secret = change.new\r\n    AttributeError: 'dict' object has no attribute 'new'\r\n```\r\n\r\nshould be change[\"new\"].\r\n\r\n**Share what version of JupyterHub you are using**\r\n\r\nmaster\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1011/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/1011/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/997", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/997/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/997/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/997/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/997", "id": 209578072, "node_id": "MDU6SXNzdWUyMDk1NzgwNzI=", "number": 997, "title": "JUPYTERHUB_SERVICE_PREFIX problem", "user": {"login": "whitead", "id": 908389, "node_id": "MDQ6VXNlcjkwODM4OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/908389?v=4", "gravatar_id": "", "url": "https://api.github.com/users/whitead", "html_url": "https://github.com/whitead", "followers_url": "https://api.github.com/users/whitead/followers", "following_url": "https://api.github.com/users/whitead/following{/other_user}", "gists_url": "https://api.github.com/users/whitead/gists{/gist_id}", "starred_url": "https://api.github.com/users/whitead/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/whitead/subscriptions", "organizations_url": "https://api.github.com/users/whitead/orgs", "repos_url": "https://api.github.com/users/whitead/repos", "events_url": "https://api.github.com/users/whitead/events{/privacy}", "received_events_url": "https://api.github.com/users/whitead/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/milestones/5", "html_url": "https://github.com/jupyterhub/jupyterhub/milestone/5", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/milestones/5/labels", "id": 2131170, "node_id": "MDk6TWlsZXN0b25lMjEzMTE3MA==", "number": 5, "title": "0.8", "description": "", "creator": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 193, "state": "closed", "created_at": "2016-11-12T18:34:21Z", "updated_at": "2017-10-05T19:30:31Z", "due_on": null, "closed_at": "2017-10-05T19:30:31Z"}, "comments": 5, "created_at": "2017-02-22T20:55:22Z", "updated_at": "2017-02-28T00:59:33Z", "closed_at": "2017-02-28T00:59:33Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**How to reproduce the issue**\r\n\r\nAdd the [shared notebook as a service managed configuration example](https://github.com/jupyterhub/jupyterhub/tree/master/examples/service-notebook) to your jupyter configuration with the service name as `formgrader-class101`. Visit https://hub-url/services/formgrader-class101 and you'll see that `custom.css` and `custom.js` give 404s.\r\n\r\n**What you expected to happen**\r\n\r\nTo not get 404s.\r\n\r\n**What actually happens**\r\n\r\nYou get 404s\r\n\r\n**Share what version of JupyterHub you are using**\r\n\r\nmaster\r\n\r\nRunning `jupyter troubleshoot` from the command line, if possible, and posting\r\nits output would also be helpful.\r\n\r\n```\r\n\r\n$PATH:\r\n\t/home/awhite38/.local/bin\r\n\t/home/awhite38/bin\r\n\t/home/awhite38/.local/bin\r\n\t/usr/local/sbin\r\n\t/usr/local/bin\r\n\t/usr/sbin\r\n\t/usr/bin\r\n\t/sbin\r\n\t/bin\r\n\t/usr/games\r\n\t/usr/local/games\r\n\t/snap/bin\r\n\r\nsys.path:\r\n\t/home/awhite38/.local/bin\r\n\t/home/awhite38/dockerspawner\r\n\t/usr/lib/python35.zip\r\n\t/usr/lib/python3.5\r\n\t/usr/lib/python3.5/plat-x86_64-linux-gnu\r\n\t/usr/lib/python3.5/lib-dynload\r\n\t/home/awhite38/.local/lib/python3.5/site-packages\r\n\t/usr/local/lib/python3.5/dist-packages\r\n\t/usr/lib/python3/dist-packages\r\n\r\nsys.executable:\r\n\t/usr/bin/python3\r\n\r\nsys.version:\r\n\t3.5.2 (default, Nov 17 2016, 17:05:23) \r\n\t[GCC 5.4.0 20160609]\r\n\r\nplatform.platform():\r\n\tLinux-4.4.0-62-generic-x86_64-with-Ubuntu-16.04-xenial\r\n\r\nwhich -a jupyter:\r\n\t/home/awhite38/.local/bin/jupyter\r\n\t/home/awhite38/.local/bin/jupyter\r\n\t/usr/local/bin/jupyter\r\n\r\n```\r\n\r\n\r\n**Workaround**\r\n\r\nThe issue is that the urls for `custom.js` and `custom.css`  are `https://hub-url/services/formgrader-class101custom/custom.css` and are missing a forward slash. The following change fixes this:\r\n\r\n```diff\r\n@@ -178,7 +178,8 @@ class SingleUserNotebookApp(NotebookApp):\r\n     # defaults for some configurables that may come from service env variables:\r\n     @default('base_url')\r\n     def _base_url_default(self):\r\n-        return os.environ.get('JUPYTERHUB_SERVICE_PREFIX') or '/'\r\n+        base_url = os.environ.get('JUPYTERHUB_SERVICE_PREFIX') or ''\r\n+        return base_url + '/'\r\n \r\n     @default('cookie_name')\r\n     def _cookie_name_default(self):\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/997/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/997/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/986", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/986/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/986/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/986/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/986", "id": 207280552, "node_id": "MDU6SXNzdWUyMDcyODA1NTI=", "number": 986, "title": "Full value of cookie_secret not used as cookie_secret", "user": {"login": "yuvipanda", "id": 30430, "node_id": "MDQ6VXNlcjMwNDMw", "avatar_url": "https://avatars.githubusercontent.com/u/30430?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuvipanda", "html_url": "https://github.com/yuvipanda", "followers_url": "https://api.github.com/users/yuvipanda/followers", "following_url": "https://api.github.com/users/yuvipanda/following{/other_user}", "gists_url": "https://api.github.com/users/yuvipanda/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuvipanda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuvipanda/subscriptions", "organizations_url": "https://api.github.com/users/yuvipanda/orgs", "repos_url": "https://api.github.com/users/yuvipanda/repos", "events_url": "https://api.github.com/users/yuvipanda/events{/privacy}", "received_events_url": "https://api.github.com/users/yuvipanda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 388386197, "node_id": "MDU6TGFiZWwzODgzODYxOTc=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/needs:%20testing", "name": "needs: testing", "color": "c2e0c6", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/milestones/5", "html_url": "https://github.com/jupyterhub/jupyterhub/milestone/5", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/milestones/5/labels", "id": 2131170, "node_id": "MDk6TWlsZXN0b25lMjEzMTE3MA==", "number": 5, "title": "0.8", "description": "", "creator": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 193, "state": "closed", "created_at": "2016-11-12T18:34:21Z", "updated_at": "2017-10-05T19:30:31Z", "due_on": null, "closed_at": "2017-10-05T19:30:31Z"}, "comments": 2, "created_at": "2017-02-13T17:10:13Z", "updated_at": "2017-02-17T19:38:10Z", "closed_at": "2017-02-17T19:38:10Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**How to reproduce the issue**\r\n\r\nChanging the cookie_secret and restarting the hub process should log all users out (when their single-user servers are not running). So changing a random character towards the end of the cookie_secret should help.\r\n\r\n**What you expected to happen**\r\n\r\nUsers are logged out.\r\n\r\n**What actually happens**\r\n\r\nNo users are logged out, and everyone seems to continue to be logged in! Changing a character towards the beginning of the cookie_secret seems to do the trick, however.\r\n\r\n\r\n**Share what version of JupyterHub you are using**\r\n\r\n0.7.2\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/986/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/986/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/985", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/985/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/985/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/985/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/985", "id": 207275854, "node_id": "MDU6SXNzdWUyMDcyNzU4NTQ=", "number": 985, "title": "cookie_id column in users table should be NOT NULL and UNIQUE", "user": {"login": "yuvipanda", "id": 30430, "node_id": "MDQ6VXNlcjMwNDMw", "avatar_url": "https://avatars.githubusercontent.com/u/30430?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuvipanda", "html_url": "https://github.com/yuvipanda", "followers_url": "https://api.github.com/users/yuvipanda/followers", "following_url": "https://api.github.com/users/yuvipanda/following{/other_user}", "gists_url": "https://api.github.com/users/yuvipanda/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuvipanda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuvipanda/subscriptions", "organizations_url": "https://api.github.com/users/yuvipanda/orgs", "repos_url": "https://api.github.com/users/yuvipanda/repos", "events_url": "https://api.github.com/users/yuvipanda/events{/privacy}", "received_events_url": "https://api.github.com/users/yuvipanda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/milestones/5", "html_url": "https://github.com/jupyterhub/jupyterhub/milestone/5", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/milestones/5/labels", "id": 2131170, "node_id": "MDk6TWlsZXN0b25lMjEzMTE3MA==", "number": 5, "title": "0.8", "description": "", "creator": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 193, "state": "closed", "created_at": "2016-11-12T18:34:21Z", "updated_at": "2017-10-05T19:30:31Z", "due_on": null, "closed_at": "2017-10-05T19:30:31Z"}, "comments": 0, "created_at": "2017-02-13T16:54:10Z", "updated_at": "2017-02-14T13:49:18Z", "closed_at": "2017-02-14T12:02:46Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**How to reproduce the issue**\r\n\r\nAccidentally delete the jupyterhub database, and when recreating it from logs make cookie_id for more than one user be empty or the same dummy value.\r\n\r\n**What you expected to happen**\r\n\r\nThe db schema complains, telling me 'nuh-uh'.\r\n\r\n**What actually happens**\r\n\r\nAll users who have the same cookie_id value are redirected to the notebook of the user with the lowest id among the users with same cookie_id, leaking private contents of notebook to others.\r\n\r\n**Share what version of JupyterHub you are using**\r\n\r\n0.7.2\r\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/985/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/985/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/878", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/878/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/878/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/878/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/878", "id": 190802235, "node_id": "MDU6SXNzdWUxOTA4MDIyMzU=", "number": 878, "title": "notebooks_dir ~ expands incorrectly", "user": {"login": "parente", "id": 153745, "node_id": "MDQ6VXNlcjE1Mzc0NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/153745?v=4", "gravatar_id": "", "url": "https://api.github.com/users/parente", "html_url": "https://github.com/parente", "followers_url": "https://api.github.com/users/parente/followers", "following_url": "https://api.github.com/users/parente/following{/other_user}", "gists_url": "https://api.github.com/users/parente/gists{/gist_id}", "starred_url": "https://api.github.com/users/parente/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/parente/subscriptions", "organizations_url": "https://api.github.com/users/parente/orgs", "repos_url": "https://api.github.com/users/parente/repos", "events_url": "https://api.github.com/users/parente/events{/privacy}", "received_events_url": "https://api.github.com/users/parente/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2016-11-21T18:43:47Z", "updated_at": "2016-12-02T03:53:24Z", "closed_at": "2016-12-02T03:53:24Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**How to reproduce the issue**\r\n\r\nConfigure jupyterhub 0.7.0b1 with:\r\n\r\n```\r\nc.SudoSpawner.sudospawner_path = \"/some/where/bin/sudospawner\"\r\nc.SudoSpawner.sudo_args = ['-nH']\r\nc.Spawner.notebook_dir = '~/notebooks'\r\n```\r\n\r\nTry to login. Notebook server startup logs:\r\n\r\n```\r\n[C 2016-11-21 12:32:15.936 SingleUserNotebookApp application:91] No such notebook dir: '/home/pparente/~/notebooks'\r\n```\r\n\r\n**What you expected to happen**\r\n\r\nPath should be expanded properly.\r\n\r\n**What actually happens**\r\n\r\nPath is expanded but also gets the ~ part tacked back on.\r\n\r\n**Share what version of JupyterHub you are using**\r\n\r\n0.7.0b1\r\n\r\nI put a print in the jupyterhub-singleuser script and confirmed that it is receiving `--notebook-dir=\"~/notebooks\"` as in `sys.argv`. So it appears the incorrect expansion is happening somewhere after that.", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/878/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/878/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/834", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/834/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/834/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/834/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/834", "id": 185469981, "node_id": "MDU6SXNzdWUxODU0Njk5ODE=", "number": 834, "title": "Remove or edit unreachable code block", "user": {"login": "willingc", "id": 2680980, "node_id": "MDQ6VXNlcjI2ODA5ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/2680980?v=4", "gravatar_id": "", "url": "https://api.github.com/users/willingc", "html_url": "https://github.com/willingc", "followers_url": "https://api.github.com/users/willingc/followers", "following_url": "https://api.github.com/users/willingc/following{/other_user}", "gists_url": "https://api.github.com/users/willingc/gists{/gist_id}", "starred_url": "https://api.github.com/users/willingc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/willingc/subscriptions", "organizations_url": "https://api.github.com/users/willingc/orgs", "repos_url": "https://api.github.com/users/willingc/repos", "events_url": "https://api.github.com/users/willingc/events{/privacy}", "received_events_url": "https://api.github.com/users/willingc/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/milestones/2", "html_url": "https://github.com/jupyterhub/jupyterhub/milestone/2", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/milestones/2/labels", "id": 1802170, "node_id": "MDk6TWlsZXN0b25lMTgwMjE3MA==", "number": 2, "title": "0.7", "description": "", "creator": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 162, "state": "closed", "created_at": "2016-06-01T12:18:52Z", "updated_at": "2017-01-11T14:44:09Z", "due_on": null, "closed_at": "2016-12-02T17:16:53Z"}, "comments": 0, "created_at": "2016-10-26T18:15:58Z", "updated_at": "2016-11-11T18:40:22Z", "closed_at": "2016-10-26T21:25:24Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "@minrk It looks like `_check_user_model` has a few code lines that don't seem to be reachable. Should we remove the lines after the return statement? https://github.com/jupyterhub/jupyterhub/blob/master/jupyterhub/apihandlers/base.py#L144\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/834/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/834/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/765", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/765/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/765/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/765/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/765", "id": 177952426, "node_id": "MDU6SXNzdWUxNzc5NTI0MjY=", "number": 765, "title": "Cull_Idle Instructions", "user": {"login": "whitead", "id": 908389, "node_id": "MDQ6VXNlcjkwODM4OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/908389?v=4", "gravatar_id": "", "url": "https://api.github.com/users/whitead", "html_url": "https://github.com/whitead", "followers_url": "https://api.github.com/users/whitead/followers", "following_url": "https://api.github.com/users/whitead/following{/other_user}", "gists_url": "https://api.github.com/users/whitead/gists{/gist_id}", "starred_url": "https://api.github.com/users/whitead/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/whitead/subscriptions", "organizations_url": "https://api.github.com/users/whitead/orgs", "repos_url": "https://api.github.com/users/whitead/repos", "events_url": "https://api.github.com/users/whitead/events{/privacy}", "received_events_url": "https://api.github.com/users/whitead/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/milestones/2", "html_url": "https://github.com/jupyterhub/jupyterhub/milestone/2", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/milestones/2/labels", "id": 1802170, "node_id": "MDk6TWlsZXN0b25lMTgwMjE3MA==", "number": 2, "title": "0.7", "description": "", "creator": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 162, "state": "closed", "created_at": "2016-06-01T12:18:52Z", "updated_at": "2017-01-11T14:44:09Z", "due_on": null, "closed_at": "2016-12-02T17:16:53Z"}, "comments": 12, "created_at": "2016-09-20T03:10:27Z", "updated_at": "2016-11-11T19:51:09Z", "closed_at": "2016-09-22T09:57:44Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I'm having trouble using the [cull_idle example](https://github.com/jupyterhub/jupyterhub/tree/master/examples/cull-idle#configure-cull-idle-to-run-as-a-hub-managed-service) as a managed service. I added the [example config section](https://github.com/jupyterhub/jupyterhub/blob/master/examples/cull-idle/jupyterhub_config.py) to the bottom of my existing `jupyterhub_config.py` file:\n\n``` python\nc = get_config()\ndocker_ip = '172.17.0.1' \nhub_name='127.0.0.1'\n\nc.JupyterHub.ip = hub_name\nc.JupyterHub.hub_ip = docker_ip\nc.JupyterHub.debug_proxy = True\nc.JupyterHub.port = 8000\n\nc.JupyterHub.cleanup_servers = False\nc.JupyterHub.cleanup_proxy = True\nc.JupyterHub.ssl_key = '/etc/jupyterhub/ssl/jhub.key'\nc.JupyterHub.ssl_cert = '/etc/jupyterhub/ssl/jhub.crt'\n\n\nc.JupyterHub.spawner_class = 'dockerspawner.DockerSpawner'\nc.DockerSpawner.hub_ip_connect = docker_ip\nc.DockerSpawner.container_ip = docker_ip \n\n\nc.JupyterHub.cookie_secret_file = '/srv/jupyterhub/jupyterhub_cookie_secret'\nc.JupyterHub.log_level = 'DEBUG'\n\n#CULL_IDLE SECTION\nc.JupyterHub.services = [{\n    'name': 'cull-idle',\n    'admin': True,\n    'command': 'python cull_idle_servers.py --timeout=3600'.split()}]\n```\n\nI see the resulting error:\n\n```\n[C 2016-09-20 02:28:37.026 JupyterHub app:1444] Failed to start service cull-idle\n    Traceback (most recent call last):\n      File \"/usr/local/lib/python3.5/dist-packages/jupyterhub/app.py\", line 1442, in start\n        yield service.start()\n      File \"/usr/local/lib/python3.5/dist-packages/jupyterhub/services/service.py\", line 228, in start\n        env['JUPYTERHUB_SERVICE_PREFIX'] = self.server.base_url\n    AttributeError: 'NoneType' object has no attribute 'base_url'\n```\n\nAny ideas of what could be causing this? Thank you!\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/765/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/765/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/580", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/580/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/580/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/580/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/580", "id": 155747190, "node_id": "MDU6SXNzdWUxNTU3NDcxOTA=", "number": 580, "title": "Logs http url even when https is used", "user": {"login": "minrk", "id": 151929, "node_id": "MDQ6VXNlcjE1MTkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/151929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/minrk", "html_url": "https://github.com/minrk", "followers_url": "https://api.github.com/users/minrk/followers", "following_url": "https://api.github.com/users/minrk/following{/other_user}", "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/minrk/subscriptions", "organizations_url": "https://api.github.com/users/minrk/orgs", "repos_url": "https://api.github.com/users/minrk/repos", "events_url": "https://api.github.com/users/minrk/events{/privacy}", "received_events_url": "https://api.github.com/users/minrk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 106589226, "node_id": "MDU6TGFiZWwxMDY1ODkyMjY=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/help%20wanted", "name": "help wanted", "color": "0e8a16", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2016-05-19T14:14:22Z", "updated_at": "2017-06-19T04:16:51Z", "closed_at": "2017-06-19T04:16:50Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "When JupyterHub starts up, it logs something like:\n\n```\nJupyterHub is now running at http://127.0.0.1:8000\n```\n\neven if https is used, so attempts to copy/paste will fail to connect.\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/580/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/580/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/471", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/471/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/471/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/471/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/471", "id": 139391002, "node_id": "MDU6SXNzdWUxMzkzOTEwMDI=", "number": 471, "title": "Fail to open PAM session", "user": {"login": "gracehllee", "id": 9956970, "node_id": "MDQ6VXNlcjk5NTY5NzA=", "avatar_url": "https://avatars.githubusercontent.com/u/9956970?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gracehllee", "html_url": "https://github.com/gracehllee", "followers_url": "https://api.github.com/users/gracehllee/followers", "following_url": "https://api.github.com/users/gracehllee/following{/other_user}", "gists_url": "https://api.github.com/users/gracehllee/gists{/gist_id}", "starred_url": "https://api.github.com/users/gracehllee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gracehllee/subscriptions", "organizations_url": "https://api.github.com/users/gracehllee/orgs", "repos_url": "https://api.github.com/users/gracehllee/repos", "events_url": "https://api.github.com/users/gracehllee/events{/privacy}", "received_events_url": "https://api.github.com/users/gracehllee/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}, {"id": 106589225, "node_id": "MDU6TGFiZWwxMDY1ODkyMjU=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/enhancement", "name": "enhancement", "color": "84b6eb", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2016-03-08T20:56:38Z", "updated_at": "2021-02-17T19:05:05Z", "closed_at": "2021-02-17T19:05:05Z", "author_association": "NONE", "active_lock_reason": null, "body": "I can't find any solution, \nI login in jupyterhub web GUI using username in system, it show errors:\n![screen shot 2016-03-08 at 2 54 02 pm](https://cloud.githubusercontent.com/assets/9956970/13616075/f17d2c32-e53d-11e5-8263-af384b1f5176.png)\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/471/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/471/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/437", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/437/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/437/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/437/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/437", "id": 135585948, "node_id": "MDU6SXNzdWUxMzU1ODU5NDg=", "number": 437, "title": "Redirect when idle session is logged out", "user": {"login": "ryanlovett", "id": 10248125, "node_id": "MDQ6VXNlcjEwMjQ4MTI1", "avatar_url": "https://avatars.githubusercontent.com/u/10248125?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ryanlovett", "html_url": "https://github.com/ryanlovett", "followers_url": "https://api.github.com/users/ryanlovett/followers", "following_url": "https://api.github.com/users/ryanlovett/following{/other_user}", "gists_url": "https://api.github.com/users/ryanlovett/gists{/gist_id}", "starred_url": "https://api.github.com/users/ryanlovett/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ryanlovett/subscriptions", "organizations_url": "https://api.github.com/users/ryanlovett/orgs", "repos_url": "https://api.github.com/users/ryanlovett/repos", "events_url": "https://api.github.com/users/ryanlovett/events{/privacy}", "received_events_url": "https://api.github.com/users/ryanlovett/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2016-02-23T00:13:58Z", "updated_at": "2016-10-10T17:51:07Z", "closed_at": "2016-10-10T17:51:07Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "We are seeing the hub log errors approximately every two minutes:\n\n```\n22:44:16.377 - error: [ConfigProxy] 503 GET /user/user1/api/contents/subdir1/untitled.ipynb?content=0&_=1455920914722\n22:44:16.426 - error: [ConfigProxy] 503 PUT /user/user1/api/contents/subdir1/untitled.ipynb\n22:46:16.243 - error: [ConfigProxy] 503 GET /user/user1/api/contents/subdir1/untitled.ipynb?content=0&_=1455920914723\n22:46:16.314 - error: [ConfigProxy] 503 PUT /user/user1/api/contents/subdir1/untitled.ipynb\n22:48:16.241 - error: [ConfigProxy] 503 GET /user/user1/api/contents/subdir1/untitled.ipynb?content=0&_=1455920914724\n22:48:16.320 - error: [ConfigProxy] 503 PUT /user/user1/api/contents/subdir1/untitled.ipynb\n22:50:16.285 - error: [ConfigProxy] 503 GET /user/user1/api/contents/subdir1/untitled.ipynb?content=0&_=1455920914725\n22:50:16.328 - error: [ConfigProxy] 503 PUT /user/user1/api/contents/subdir1/untitled.ipynb\n22:52:16.233 - error: [ConfigProxy] 503 GET /user/user1/api/contents/subdir1/untitled.ipynb?content=0&_=1455920914726\n22:52:16.296 - error: [ConfigProxy] 503 PUT /user/user1/api/contents/subdir1/untitled.ipynb\n22:54:16.249 - error: [ConfigProxy] 503 GET /user/user1/api/contents/subdir1/untitled.ipynb?content=0&_=1455920914727\n22:54:16.317 - error: [ConfigProxy] 503 PUT /user/user1/api/contents/subdir1/untitled.ipynb\n22:56:16.231 - error: [ConfigProxy] 503 GET /user/user1/api/contents/subdir1/untitled.ipynb?content=0&_=1455920914728\n22:56:16.276 - error: [ConfigProxy] 503 PUT /user/user1/api/contents/subdir1/untitled.ipynb\n22:58:16.221 - error: [ConfigProxy] 503 GET /user/user1/api/contents/subdir1/untitled.ipynb?content=0&_=1455920914729\n22:58:16.283 - error: [ConfigProxy] 503 PUT /user/user1/api/contents/subdir1/untitled.ipynb\n23:00:16.225 - error: [ConfigProxy] 503 GET /user/user1/api/contents/subdir1/untitled.ipynb?content=0&_=1455920914730\n23:00:16.298 - error: [ConfigProxy] 503 PUT /user/user1/api/contents/subdir1/untitled.ipynb\n23:08:21.843 - error: [ConfigProxy] 503 GET /user/user1/api/contents/subdir1/untitled.ipynb?content=0&_=1455920914732\n23:08:21.911 - error: [ConfigProxy] 503 PUT /user/user1/api/contents/subdir1/untitled.ipynb\n23:10:21.812 - error: [ConfigProxy] 503 GET /user/user1/api/contents/subdir1/untitled.ipynb?content=0&_=1455920914733\n23:10:21.883 - error: [ConfigProxy] 503 PUT /user/user1/api/contents/subdir1/untitled.ipynb\n23:12:22.179 - error: [ConfigProxy] 503 GET /user/user1/api/contents/subdir1/untitled.ipynb?content=0&_=1455920914734\n23:12:22.228 - error: [ConfigProxy] 503 PUT /user/user1/api/contents/subdir1/untitled.ipynb\n23:14:21.860 - error: [ConfigProxy] 503 GET /user/user1/api/contents/subdir1/untitled.ipynb?content=0&_=1455920914735\n23:14:21.928 - error: [ConfigProxy] 503 PUT /user/user1/api/contents/subdir1/untitled.ipynb\n```\n\nShe has a container_id in her state but no server, and her container is not running.\n\n```\n>>> for user in db.query(User).filter(User.name == 'user1'):\n...     print(user, user.server, user._server_id, user.state)\n...\n<User(user1 [unconfigured])> None None {'user_id': 1213, 'container_id': 'b7643974e8517da6f2b276b65d34cb5d562d9243cac52775ee9e30ee197644f2'}\n```\n\nI suspect that she has an idle browser somewhere and that it is trying to access her notebook even though her server was stopped a while ago. Would it be appropriate to have the hub redirect to a \"you have no active server\" page under such conditions?\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/437/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/437/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/362", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/362/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/362/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/362/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/362", "id": 124393167, "node_id": "MDU6SXNzdWUxMjQzOTMxNjc=", "number": 362, "title": "404 on single user notebook server anytime I restart jupyterhub", "user": {"login": "ellisonbg", "id": 27600, "node_id": "MDQ6VXNlcjI3NjAw", "avatar_url": "https://avatars.githubusercontent.com/u/27600?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ellisonbg", "html_url": "https://github.com/ellisonbg", "followers_url": "https://api.github.com/users/ellisonbg/followers", "following_url": "https://api.github.com/users/ellisonbg/following{/other_user}", "gists_url": "https://api.github.com/users/ellisonbg/gists{/gist_id}", "starred_url": "https://api.github.com/users/ellisonbg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ellisonbg/subscriptions", "organizations_url": "https://api.github.com/users/ellisonbg/orgs", "repos_url": "https://api.github.com/users/ellisonbg/repos", "events_url": "https://api.github.com/users/ellisonbg/events{/privacy}", "received_events_url": "https://api.github.com/users/ellisonbg/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2015-12-30T19:59:02Z", "updated_at": "2015-12-31T16:30:56Z", "closed_at": "2015-12-31T16:30:56Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I just deployed jupyterhub from scratch using my ansible scripts this morning. The script are unchanged from 2-3 weeks ago when I did it previously and it was all working. I am running from latest master of jupyterhub.\n\nAnytime I restart jupyterhub (hub+proxy) I see the following behavior:\n- I can log in (using GitHub OAuth)\n- Trying to start my server gives me a 404 on `/hub/users/ellisonbg`. I can tell from the server log that the single user server isn't being started.\n- I can go to the Admin page and start my server from there.\n- But then, I get a redirect loop when I try to go to my single user server.\n- If I clear all my cookies while my single user server (started through the Admin page) is still running, it starts to work as expected. I can start and stop the single user server on the control panel page just fine.\n- If a restart jupyterhub, the problems start all over again.\n\nI am using a fixed proxy_auth_token and cookie secret.\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/362/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/362/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/262", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/262/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/262/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/262/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/262", "id": 90567690, "node_id": "MDU6SXNzdWU5MDU2NzY5MA==", "number": 262, "title": "Single user server launch is broken", "user": {"login": "jhamrick", "id": 83444, "node_id": "MDQ6VXNlcjgzNDQ0", "avatar_url": "https://avatars.githubusercontent.com/u/83444?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhamrick", "html_url": "https://github.com/jhamrick", "followers_url": "https://api.github.com/users/jhamrick/followers", "following_url": "https://api.github.com/users/jhamrick/following{/other_user}", "gists_url": "https://api.github.com/users/jhamrick/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhamrick/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhamrick/subscriptions", "organizations_url": "https://api.github.com/users/jhamrick/orgs", "repos_url": "https://api.github.com/users/jhamrick/repos", "events_url": "https://api.github.com/users/jhamrick/events{/privacy}", "received_events_url": "https://api.github.com/users/jhamrick/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2015-06-24T05:15:45Z", "updated_at": "2015-06-24T19:53:25Z", "closed_at": "2015-06-24T19:53:25Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I think that #261 broke the launching of the single user server. I am seeing the following errors in the nbgrader tests:\n\n```\nTraceback (most recent call last):\n  File \"/Users/jhamrick/.virtualenvs/nbgrader/bin/jupyterhub-singleuser\", line 6, in <module>\n    exec(compile(open(__file__).read(), __file__, 'exec'))\n  File \"/Users/jhamrick/project/tools/jupyterhub/scripts/jupyterhub-singleuser\", line 4, in <module>\n    main()\n  File \"/Users/jhamrick/project/tools/jupyterhub/jupyterhub/singleuser.py\", line 221, in main\n    return SingleUserNotebookApp.launch_instance()\n  File \"/Users/jhamrick/.virtualenvs/nbgrader/lib/python3.4/site-packages/IPython/config/application.py\", line 573, in launch_instance\n    app.initialize(argv)\n  File \"<string>\", line 2, in initialize\n  File \"/Users/jhamrick/.virtualenvs/nbgrader/lib/python3.4/site-packages/IPython/config/application.py\", line 75, in catch_config_error\n    return method(app, *args, **kwargs)\n  File \"/Users/jhamrick/.virtualenvs/nbgrader/lib/python3.4/site-packages/IPython/html/notebookapp.py\", line 1015, in initialize\n    self.init_webapp()\n  File \"/Users/jhamrick/project/tools/jupyterhub/jupyterhub/singleuser.py\", line 191, in init_webapp\n    s['user'] = self.user\n  File \"/Users/jhamrick/.virtualenvs/nbgrader/lib/python3.4/site-packages/traitlets/traitlets.py\", line 438, in __get__\n    % (self.name, obj))\ntraitlets.traitlets.TraitError: No default value found for None trait of <jupyterhub.singleuser.SingleUserNotebookApp object at 0x102953b00>\n```\n\nIf I revert to the version of jupyterhub prior to that PR, this error does not occur. @epifanio reported on gitter seeing the same thing as well, so I don't think it's isolated to nbgrader.\n\nGiven the error message, I suspect this has to do with ipython/traitlets#39 and/or ipython/traitlets#40 though I haven't actually tested it. I tried giving the `user` trait a default value but it did not seem to fix the error. I will try to do a bit more debugging, but I fear I don't really understand the internals of traitlets well enough to know exactly what's going on here.\n\nPing @takluyver and @minrk ?\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/262/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/262/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/218", "repository_url": "https://api.github.com/repos/jupyterhub/jupyterhub", "labels_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/218/labels{/name}", "comments_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/218/comments", "events_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/218/events", "html_url": "https://github.com/jupyterhub/jupyterhub/issues/218", "id": 66778333, "node_id": "MDU6SXNzdWU2Njc3ODMzMw==", "number": 218, "title": "Auth problems with `@` in the username", "user": {"login": "ellisonbg", "id": 27600, "node_id": "MDQ6VXNlcjI3NjAw", "avatar_url": "https://avatars.githubusercontent.com/u/27600?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ellisonbg", "html_url": "https://github.com/ellisonbg", "followers_url": "https://api.github.com/users/ellisonbg/followers", "following_url": "https://api.github.com/users/ellisonbg/following{/other_user}", "gists_url": "https://api.github.com/users/ellisonbg/gists{/gist_id}", "starred_url": "https://api.github.com/users/ellisonbg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ellisonbg/subscriptions", "organizations_url": "https://api.github.com/users/ellisonbg/orgs", "repos_url": "https://api.github.com/users/ellisonbg/repos", "events_url": "https://api.github.com/users/ellisonbg/events{/privacy}", "received_events_url": "https://api.github.com/users/ellisonbg/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 106589223, "node_id": "MDU6TGFiZWwxMDY1ODkyMjM=", "url": "https://api.github.com/repos/jupyterhub/jupyterhub/labels/bug", "name": "bug", "color": "ff9999", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2015-04-07T05:22:45Z", "updated_at": "2015-04-30T19:07:33Z", "closed_at": "2015-04-30T19:07:33Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I have students who keep putting their email address into the username. When they do this, there is an odd state that happens - the auth looks like it may be passing (using PAM), and I can see a single user server start, but the user sees a 500 page after auth. I am guessing that the PAM auth is raising a weird exception that we are not handling properly.\n", "reactions": {"url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/218/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/jupyterhub/jupyterhub/issues/218/timeline", "performed_via_github_app": null, "state_reason": "completed"}]