[{"url": "https://api.github.com/repos/pallets/werkzeug/issues/2364", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/2364/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/2364/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/2364/events", "html_url": "https://github.com/pallets/werkzeug/issues/2364", "id": 1186146448, "node_id": "I_kwDOAA832s5GsyiQ", "number": 2364, "title": "`ResponseCacheControl.s_maxage` raises error when set to an int", "user": {"login": "allanlei", "id": 391251, "node_id": "MDQ6VXNlcjM5MTI1MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/391251?v=4", "gravatar_id": "", "url": "https://api.github.com/users/allanlei", "html_url": "https://github.com/allanlei", "followers_url": "https://api.github.com/users/allanlei/followers", "following_url": "https://api.github.com/users/allanlei/following{/other_user}", "gists_url": "https://api.github.com/users/allanlei/gists{/gist_id}", "starred_url": "https://api.github.com/users/allanlei/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/allanlei/subscriptions", "organizations_url": "https://api.github.com/users/allanlei/orgs", "repos_url": "https://api.github.com/users/allanlei/repos", "events_url": "https://api.github.com/users/allanlei/events{/privacy}", "received_events_url": "https://api.github.com/users/allanlei/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/19", "html_url": "https://github.com/pallets/werkzeug/milestone/19", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/19/labels", "id": 7812820, "node_id": "MI_kwDOAA832s4AdzbU", "number": 19, "title": "2.1.1", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 3, "state": "closed", "created_at": "2022-03-28T20:52:18Z", "updated_at": "2022-04-01T19:12:00Z", "due_on": null, "closed_at": "2022-04-01T19:12:00Z"}, "comments": 4, "created_at": "2022-03-30T09:18:56Z", "updated_at": "2022-04-16T00:20:13Z", "closed_at": "2022-04-01T15:33:27Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "`Response().cache_control.s_maxage` errors with `None` is not callable\r\n\r\n```\r\nfrom werkzeug.datastructures import ResponseCacheControl\r\n\r\ncc = ResponseCacheControl()\r\ncc.s_maxage = 1\r\n\r\n---------------------------------------------------------------------------\r\nTypeError                                 Traceback (most recent call last)\r\nInput In [13], in <cell line: 1>()\r\n----> 1 cc.s_maxage = 1\r\n\r\nFile /usr/local/lib/python3.10/site-packages/werkzeug/datastructures.py:1958, in cache_control_property.<locals>.<lambda>(x, v)\r\n   1949 def cache_control_property(key, empty, type):\r\n   1950     \"\"\"Return a new property object for a cache header. Useful if you\r\n   1951     want to add support for a cache extension in a subclass.\r\n   1952 \r\n   1953     .. versionchanged:: 2.0\r\n   1954         Renamed from ``cache_property``.\r\n   1955     \"\"\"\r\n   1956     return property(\r\n   1957         lambda x: x._get_cache_value(key, empty, type),\r\n-> 1958         lambda x, v: x._set_cache_value(key, v, type),\r\n   1959         lambda x: x._del_cache_value(key),\r\n   1960         f\"accessor for {key!r}\",\r\n   1961     )\r\n\r\nFile /usr/local/lib/python3.10/site-packages/werkzeug/datastructures.py:2039, in _CacheControl._set_cache_value(self, key, value, type)\r\n   2037     self[key] = None\r\n   2038 else:\r\n-> 2039     self[key] = type(value)\r\n\r\nTypeError: 'NoneType' object is not callable\r\n```\r\n\r\n2.0.3 is OK\r\n\r\n\r\nFlask use case\r\n```\r\nfrom flask import Response\r\n\r\nresponse = Response()\r\nresponse.cache_control.s_maxage = 1\r\n```\r\n\r\nEnvironment:\r\n\r\n- Python version: 3.10.4\r\n- Werkzeug version: 2.1.0\r\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/2364/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/2364/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/2263", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/2263/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/2263/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/2263/events", "html_url": "https://github.com/pallets/werkzeug/pull/2263", "id": 1029562803, "node_id": "PR_kwDOAA832s4tWWFU", "number": 2263, "title": "Handle IPv6 Addreess in X-Forwarded-For Proxy Fix", "user": {"login": "hjensas", "id": 4933552, "node_id": "MDQ6VXNlcjQ5MzM1NTI=", "avatar_url": "https://avatars.githubusercontent.com/u/4933552?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hjensas", "html_url": "https://github.com/hjensas", "followers_url": "https://api.github.com/users/hjensas/followers", "following_url": "https://api.github.com/users/hjensas/following{/other_user}", "gists_url": "https://api.github.com/users/hjensas/gists{/gist_id}", "starred_url": "https://api.github.com/users/hjensas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hjensas/subscriptions", "organizations_url": "https://api.github.com/users/hjensas/orgs", "repos_url": "https://api.github.com/users/hjensas/repos", "events_url": "https://api.github.com/users/hjensas/events{/privacy}", "received_events_url": "https://api.github.com/users/hjensas/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/18", "html_url": "https://github.com/pallets/werkzeug/milestone/18", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/18/labels", "id": 7401598, "node_id": "MI_kwDOAA832s4AcPB-", "number": 18, "title": "2.0.3", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 13, "state": "closed", "created_at": "2021-11-16T21:51:46Z", "updated_at": "2022-02-14T19:47:20Z", "due_on": null, "closed_at": "2022-02-14T19:47:20Z"}, "comments": 1, "created_at": "2021-10-18T20:25:01Z", "updated_at": "2021-12-01T00:14:03Z", "closed_at": "2021-11-16T21:52:17Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/pallets/werkzeug/pulls/2263", "html_url": "https://github.com/pallets/werkzeug/pull/2263", "diff_url": "https://github.com/pallets/werkzeug/pull/2263.diff", "patch_url": "https://github.com/pallets/werkzeug/pull/2263.patch", "merged_at": "2021-11-16T21:52:17Z"}, "body": "Use rsplit() to split host/port, this will work for both\r\nIPv4, IPV6 and hostnames. Only rsplit() if ':' in string\r\nand the string does not end with closing bracket.\r\n\r\nFixes: #2262\r\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/2263/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/2263/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/2262", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/2262/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/2262/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/2262/events", "html_url": "https://github.com/pallets/werkzeug/issues/2262", "id": 1029469577, "node_id": "I_kwDOAA832s49XHWJ", "number": 2262, "title": "X-Forwarded-For Proxy Fix - does not work with IPv6 Addresses", "user": {"login": "hjensas", "id": 4933552, "node_id": "MDQ6VXNlcjQ5MzM1NTI=", "avatar_url": "https://avatars.githubusercontent.com/u/4933552?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hjensas", "html_url": "https://github.com/hjensas", "followers_url": "https://api.github.com/users/hjensas/followers", "following_url": "https://api.github.com/users/hjensas/following{/other_user}", "gists_url": "https://api.github.com/users/hjensas/gists{/gist_id}", "starred_url": "https://api.github.com/users/hjensas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hjensas/subscriptions", "organizations_url": "https://api.github.com/users/hjensas/orgs", "repos_url": "https://api.github.com/users/hjensas/repos", "events_url": "https://api.github.com/users/hjensas/events{/privacy}", "received_events_url": "https://api.github.com/users/hjensas/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/18", "html_url": "https://github.com/pallets/werkzeug/milestone/18", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/18/labels", "id": 7401598, "node_id": "MI_kwDOAA832s4AcPB-", "number": 18, "title": "2.0.3", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 13, "state": "closed", "created_at": "2021-11-16T21:51:46Z", "updated_at": "2022-02-14T19:47:20Z", "due_on": null, "closed_at": "2022-02-14T19:47:20Z"}, "comments": 4, "created_at": "2021-10-18T18:44:34Z", "updated_at": "2021-12-01T00:14:02Z", "closed_at": "2021-11-16T21:52:39Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "X-Forwarded-For Proxy Fix does a ```host.split(\":\", 1)```[1]. This does not work with IPv6 addresses using ```:``` separator.\r\nFor example splitting ```[fd00', 'fd00:fd00:0000::2]:13050/``` would result in: ```['[fd00', 'fd00:fd00:0000::2]:13050/']``` and ```host``` is incorrectly set to ```[fd00'``` i.e only the first hextet of the IPv6 address.\r\n\r\n[1] https://github.com/pallets/werkzeug/blob/main/src/werkzeug/middleware/proxy_fix.py#L176\r\n\r\nEnvironment:\r\n\r\n- Python version: Python 3.6.8\r\n- Werkzeug version: python3-werkzeug-2.0.1-2.el8.noarch\r\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/2262/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/2262/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/2021", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/2021/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/2021/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/2021/events", "html_url": "https://github.com/pallets/werkzeug/issues/2021", "id": 795206791, "node_id": "MDU6SXNzdWU3OTUyMDY3OTE=", "number": 2021, "title": "werkzeug.serving.DechunkedInput.read returns more than what was asked for", "user": {"login": "ghost", "id": 10137, "node_id": "MDQ6VXNlcjEwMTM3", "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghost", "html_url": "https://github.com/ghost", "followers_url": "https://api.github.com/users/ghost/followers", "following_url": "https://api.github.com/users/ghost/following{/other_user}", "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghost/subscriptions", "organizations_url": "https://api.github.com/users/ghost/orgs", "repos_url": "https://api.github.com/users/ghost/repos", "events_url": "https://api.github.com/users/ghost/events{/privacy}", "received_events_url": "https://api.github.com/users/ghost/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": {"login": "Saif807380", "id": 50794619, "node_id": "MDQ6VXNlcjUwNzk0NjE5", "avatar_url": "https://avatars.githubusercontent.com/u/50794619?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Saif807380", "html_url": "https://github.com/Saif807380", "followers_url": "https://api.github.com/users/Saif807380/followers", "following_url": "https://api.github.com/users/Saif807380/following{/other_user}", "gists_url": "https://api.github.com/users/Saif807380/gists{/gist_id}", "starred_url": "https://api.github.com/users/Saif807380/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Saif807380/subscriptions", "organizations_url": "https://api.github.com/users/Saif807380/orgs", "repos_url": "https://api.github.com/users/Saif807380/repos", "events_url": "https://api.github.com/users/Saif807380/events{/privacy}", "received_events_url": "https://api.github.com/users/Saif807380/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "Saif807380", "id": 50794619, "node_id": "MDQ6VXNlcjUwNzk0NjE5", "avatar_url": "https://avatars.githubusercontent.com/u/50794619?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Saif807380", "html_url": "https://github.com/Saif807380", "followers_url": "https://api.github.com/users/Saif807380/followers", "following_url": "https://api.github.com/users/Saif807380/following{/other_user}", "gists_url": "https://api.github.com/users/Saif807380/gists{/gist_id}", "starred_url": "https://api.github.com/users/Saif807380/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Saif807380/subscriptions", "organizations_url": "https://api.github.com/users/Saif807380/orgs", "repos_url": "https://api.github.com/users/Saif807380/repos", "events_url": "https://api.github.com/users/Saif807380/events{/privacy}", "received_events_url": "https://api.github.com/users/Saif807380/received_events", "type": "User", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/14", "html_url": "https://github.com/pallets/werkzeug/milestone/14", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/14/labels", "id": 5085882, "node_id": "MDk6TWlsZXN0b25lNTA4NTg4Mg==", "number": 14, "title": "2.0.0", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 132, "state": "closed", "created_at": "2020-02-09T21:53:29Z", "updated_at": "2021-05-11T20:31:10Z", "due_on": null, "closed_at": "2021-05-11T20:31:10Z"}, "comments": 10, "created_at": "2021-01-27T15:34:33Z", "updated_at": "2021-04-14T00:20:03Z", "closed_at": "2021-03-30T19:37:46Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "I believe this is a bug in werkzeug 1.0.1 and not Flask because the error is produced by `request.stream.read()`, which is a `werkzeug.serving.DechunkedInput` instance. Please let me know if this actually belongs to Flask, and I will report it there instead. Note that I have used Flask in these examples for simplicity and because this is where I first found the issue.\r\n\r\nWith Python 3.9 on Windows 10, given the following Flask app (`pip install flask==1.1.2`) as `server.py`:\r\n\r\n```python\r\nfrom flask import Flask, request\r\n\r\nSIZE = 320000\r\napp = Flask('bug')\r\n\r\n@app.route('/bug', methods=['POST'])\r\ndef bug():\r\n    chunk = request.stream.read(SIZE)\r\n    if len(chunk) > SIZE:\r\n        raise ValueError(f'bug in {type(request.stream)}; read({SIZE}) returned {len(chunk)} bytes')\r\n\r\n    return 'ok'\r\n\r\nif __name__ == \"__main__\":\r\n    app.run()\r\n```\r\n\r\nAnd the following `client.py` file (`pip install aiohttp==3.7.3`):\r\n\r\n```python\r\nimport asyncio\r\nimport aiohttp\r\n\r\nURL = 'http://localhost:5000/bug'\r\nEXTRA = 44\r\nCHUNK = 4000\r\nDELAY = 0.125\r\n\r\nasync def req():\r\n    yield bytes(EXTRA)\r\n    while True:\r\n        yield bytes(CHUNK)\r\n        await asyncio.sleep(DELAY)\r\n\r\nasync def main():\r\n    async with aiohttp.ClientSession() as session:\r\n        async with session.post(URL, data=req()) as resp:\r\n            async for line in resp.content:\r\n                print(line)\r\n\r\nasyncio.run(main())\r\n```\r\n\r\nRunning `python server.py` followed by `python client.py` in another terminal will eventually lead to the following error:\r\n\r\n```\r\n[2021-01-27 16:20:20,419] ERROR in app: Exception on /bug [POST]\r\nTraceback (most recent call last):\r\n  File \"C:\\Python39\\lib\\site-packages\\flask\\app.py\", line 2447, in wsgi_app\r\n    response = self.full_dispatch_request()\r\n  File \"C:\\Python39\\lib\\site-packages\\flask\\app.py\", line 1952, in full_dispatch_request\r\n    rv = self.handle_user_exception(e)\r\n  File \"C:\\Python39\\lib\\site-packages\\flask\\app.py\", line 1821, in handle_user_exception\r\n    reraise(exc_type, exc_value, tb)\r\n  File \"C:\\Python39\\lib\\site-packages\\flask\\_compat.py\", line 39, in reraise\r\n    raise value\r\n  File \"C:\\Python39\\lib\\site-packages\\flask\\app.py\", line 1950, in full_dispatch_request\r\n    rv = self.dispatch_request()\r\n  File \"C:\\Python39\\lib\\site-packages\\flask\\app.py\", line 1936, in dispatch_request\r\n    return self.view_functions[rule.endpoint](**req.view_args)\r\n  File \"C:\\server.py\", line 10, in bug\r\n    raise ValueError(f'bug in {type(request.stream)}; read({SIZE}) returned {len(chunk)} bytes')\r\nValueError: bug in <class 'werkzeug.serving.DechunkedInput'>; read(320000) returned 320044 bytes\r\n```\r\n\r\nI expected `read` to never return more than `size`, but it did. According to [PEP 3333 - Input and Error Streams](https://www.python.org/dev/peps/pep-3333/#input-and-error-streams), `read` is defined on the `input` stream with as follows (strong emphasis mine):\r\n\r\n> **The semantics of each method are as documented in the Python Library Reference**, except for these notes as listed in the table above:\r\n>\r\n> 1. The server is not required to read past the client's specified `Content-Length`, and *should* simulate an end-of-file condition if the application attempts to read past that point. The application *should not* attempt to read more data than is specified by the `CONTENT_LENGTH` variable.\r\n\r\nAnd the Python Library Reference for [`io.RawIOBase.read`](https://docs.python.org/3/library/io.html#io.RawIOBase.read) reads:\r\n\r\n> **Read up to *size* bytes from the object and return them**. As a convenience, if *size* is unspecified or -1, all bytes until EOF are returned. Otherwise, only one system call is ever made. Fewer than *size* bytes may be returned if the operating system call returns fewer than *size* bytes.\r\n> \r\n> If 0 bytes are returned, and size was not 0, this indicates end of file. If the object is in non-blocking mode and no bytes are available, `None` is returned.\r\n> \r\n> The default implementation defers to `readall()` and `readinto()`.\r\n\r\nNote that it says \"Read **up to** size\", and not \"Read **at least** size\". Werkzeug behaviours seem to not behave as the documentation says it should, which I think is a bug.\r\n\r\nBecause the default `read` implementation delegates to `readinto`, the buggy implementation is likely here, although I have not investigated further:\r\n\r\nhttps://github.com/pallets/werkzeug/blob/68b7cbda036ae4f299f777180b7fd7a00e6b128b/src/werkzeug/serving.py#L105", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/2021/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/2021/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1992", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1992/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1992/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1992/events", "html_url": "https://github.com/pallets/werkzeug/issues/1992", "id": 780703373, "node_id": "MDU6SXNzdWU3ODA3MDMzNzM=", "number": 1992, "title": "url_for appends ? if called with empty query argument", "user": {"login": "lucaswerkmeister", "id": 2346599, "node_id": "MDQ6VXNlcjIzNDY1OTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2346599?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lucaswerkmeister", "html_url": "https://github.com/lucaswerkmeister", "followers_url": "https://api.github.com/users/lucaswerkmeister/followers", "following_url": "https://api.github.com/users/lucaswerkmeister/following{/other_user}", "gists_url": "https://api.github.com/users/lucaswerkmeister/gists{/gist_id}", "starred_url": "https://api.github.com/users/lucaswerkmeister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lucaswerkmeister/subscriptions", "organizations_url": "https://api.github.com/users/lucaswerkmeister/orgs", "repos_url": "https://api.github.com/users/lucaswerkmeister/repos", "events_url": "https://api.github.com/users/lucaswerkmeister/events{/privacy}", "received_events_url": "https://api.github.com/users/lucaswerkmeister/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/14", "html_url": "https://github.com/pallets/werkzeug/milestone/14", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/14/labels", "id": 5085882, "node_id": "MDk6TWlsZXN0b25lNTA4NTg4Mg==", "number": 14, "title": "2.0.0", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 132, "state": "closed", "created_at": "2020-02-09T21:53:29Z", "updated_at": "2021-05-11T20:31:10Z", "due_on": null, "closed_at": "2021-05-11T20:31:10Z"}, "comments": 2, "created_at": "2021-01-06T16:34:41Z", "updated_at": "2021-01-30T01:01:26Z", "closed_at": "2021-01-16T00:55:09Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "### Expected Behavior\r\nIf `url_for` is called with a query argument that is an empty list (and no other query arguments), the URL should have no query part at all, including no trailing question mark. (When called with a nonempty list, it adds several query arguments with the same name, which is what I expect; when called with `None`, it omits the question mark already.)\r\n\r\n```python\r\n@app.route('/')\r\ndef index():\r\n    return flask.url_for('index', extra_param=[])\r\n```\r\nFull example: https://github.com/lucaswerkmeister/repro-flask-url_for-empty\r\n\r\n### Actual Behavior\r\nThe URL has a question mark at the end (in the above example: `/?`).\r\n\r\n### Environment\r\n\r\n* Python version: 3.9.1\r\n* Flask version: 1.1.2\r\n* Werkzeug version: 1.0.1\r\n\r\n### Workaround\r\n\r\nReplace the empty list with `None` by appending `or None` to the argument. (This also works in Jinja2 templates.)", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1992/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1992/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1971", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1971/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1971/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1971/events", "html_url": "https://github.com/pallets/werkzeug/issues/1971", "id": 747188411, "node_id": "MDU6SXNzdWU3NDcxODg0MTE=", "number": 1971, "title": "User agents not being detected", "user": {"login": "JavaScriptDude", "id": 4992230, "node_id": "MDQ6VXNlcjQ5OTIyMzA=", "avatar_url": "https://avatars.githubusercontent.com/u/4992230?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JavaScriptDude", "html_url": "https://github.com/JavaScriptDude", "followers_url": "https://api.github.com/users/JavaScriptDude/followers", "following_url": "https://api.github.com/users/JavaScriptDude/following{/other_user}", "gists_url": "https://api.github.com/users/JavaScriptDude/gists{/gist_id}", "starred_url": "https://api.github.com/users/JavaScriptDude/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JavaScriptDude/subscriptions", "organizations_url": "https://api.github.com/users/JavaScriptDude/orgs", "repos_url": "https://api.github.com/users/JavaScriptDude/repos", "events_url": "https://api.github.com/users/JavaScriptDude/events{/privacy}", "received_events_url": "https://api.github.com/users/JavaScriptDude/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}, {"id": 123873888, "node_id": "MDU6TGFiZWwxMjM4NzM4ODg=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/good%20first%20issue", "name": "good first issue", "color": "fbca04", "default": true, "description": ""}, {"id": 1385074318, "node_id": "MDU6TGFiZWwxMzg1MDc0MzE4", "url": "https://api.github.com/repos/pallets/werkzeug/labels/user-agent", "name": "user-agent", "color": "80ccd6", "default": false, "description": ""}], "state": "closed", "locked": true, "assignee": {"login": "Saif807380", "id": 50794619, "node_id": "MDQ6VXNlcjUwNzk0NjE5", "avatar_url": "https://avatars.githubusercontent.com/u/50794619?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Saif807380", "html_url": "https://github.com/Saif807380", "followers_url": "https://api.github.com/users/Saif807380/followers", "following_url": "https://api.github.com/users/Saif807380/following{/other_user}", "gists_url": "https://api.github.com/users/Saif807380/gists{/gist_id}", "starred_url": "https://api.github.com/users/Saif807380/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Saif807380/subscriptions", "organizations_url": "https://api.github.com/users/Saif807380/orgs", "repos_url": "https://api.github.com/users/Saif807380/repos", "events_url": "https://api.github.com/users/Saif807380/events{/privacy}", "received_events_url": "https://api.github.com/users/Saif807380/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "Saif807380", "id": 50794619, "node_id": "MDQ6VXNlcjUwNzk0NjE5", "avatar_url": "https://avatars.githubusercontent.com/u/50794619?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Saif807380", "html_url": "https://github.com/Saif807380", "followers_url": "https://api.github.com/users/Saif807380/followers", "following_url": "https://api.github.com/users/Saif807380/following{/other_user}", "gists_url": "https://api.github.com/users/Saif807380/gists{/gist_id}", "starred_url": "https://api.github.com/users/Saif807380/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Saif807380/subscriptions", "organizations_url": "https://api.github.com/users/Saif807380/orgs", "repos_url": "https://api.github.com/users/Saif807380/repos", "events_url": "https://api.github.com/users/Saif807380/events{/privacy}", "received_events_url": "https://api.github.com/users/Saif807380/received_events", "type": "User", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/14", "html_url": "https://github.com/pallets/werkzeug/milestone/14", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/14/labels", "id": 5085882, "node_id": "MDk6TWlsZXN0b25lNTA4NTg4Mg==", "number": 14, "title": "2.0.0", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 132, "state": "closed", "created_at": "2020-02-09T21:53:29Z", "updated_at": "2021-05-11T20:31:10Z", "due_on": null, "closed_at": "2021-05-11T20:31:10Z"}, "comments": 3, "created_at": "2020-11-20T05:55:54Z", "updated_at": "2021-04-09T00:21:14Z", "closed_at": "2021-03-25T16:53:11Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "While using your utility to parse user agents for calls to my site, I have a few that don't get parsed correctly:\r\n\r\nVersion not getting parsed on the following user agents:\r\n\r\n* `Mozilla/5.0 (Linux; Android 10; motorola edge) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.101 Mobile Safari/537.36`\r\n* `Mozilla/5.0 (Linux; Android 10; motorola edge) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.81 Mobile Safari/537.36`\r\n* `Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Trident/4.0; .NET CLR 1.1.4322)`\r\n\r\nDetected as 'mozilla' but is actually msie v11:\r\n\r\n* `Mozilla/5.0 (Windows NT 6.3; WOW64; Trident/7.0; rv:11.0) like Gecko`", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1971/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1971/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1937", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1937/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1937/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1937/events", "html_url": "https://github.com/pallets/werkzeug/issues/1937", "id": 719249505, "node_id": "MDU6SXNzdWU3MTkyNDk1MDU=", "number": 1937, "title": "range request on empty file should return 200 instead of 416", "user": {"login": "sourtin", "id": 3945901, "node_id": "MDQ6VXNlcjM5NDU5MDE=", "avatar_url": "https://avatars.githubusercontent.com/u/3945901?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sourtin", "html_url": "https://github.com/sourtin", "followers_url": "https://api.github.com/users/sourtin/followers", "following_url": "https://api.github.com/users/sourtin/following{/other_user}", "gists_url": "https://api.github.com/users/sourtin/gists{/gist_id}", "starred_url": "https://api.github.com/users/sourtin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sourtin/subscriptions", "organizations_url": "https://api.github.com/users/sourtin/orgs", "repos_url": "https://api.github.com/users/sourtin/repos", "events_url": "https://api.github.com/users/sourtin/events{/privacy}", "received_events_url": "https://api.github.com/users/sourtin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/14", "html_url": "https://github.com/pallets/werkzeug/milestone/14", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/14/labels", "id": 5085882, "node_id": "MDk6TWlsZXN0b25lNTA4NTg4Mg==", "number": 14, "title": "2.0.0", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 132, "state": "closed", "created_at": "2020-02-09T21:53:29Z", "updated_at": "2021-05-11T20:31:10Z", "due_on": null, "closed_at": "2021-05-11T20:31:10Z"}, "comments": 4, "created_at": "2020-10-12T10:05:34Z", "updated_at": "2021-02-05T00:51:16Z", "closed_at": "2021-01-21T03:13:12Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "When attempting to access any range on an empty file, Werkzeug returns a `416 Requested Range Not Satisfiable` error. Whilst this is perhaps reasonable, it is inconsistent with behaviour for non-empty files. For example, the range `bytes=0-999999` on a small file, say 10 bytes in length, will succeed with a `Content-Range: bytes 0-9/10` response header.\r\n\r\nThe issue is that `Content-Range` is inclusive, and so ostensibly the only way to succeed for an empty file would be to return the (invalid) response header `Content-Range: bytes 0--1/0`. As such, Werkzeug's behaviour is technically correct with respect to the specification, but I would argue it is undesirable/unexpected.\r\n\r\nTwo potential alternative approaches are:\r\n\r\n1. Respond with `Content-Range: bytes */0` to indicate an unknown range.\r\n2. 'Ignore' the range request in this case and return `200 OK`.\r\n\r\nUsing `curl -ir 0-0` against an empty file shows that different servers take different approaches. For `sourtin.github.io/empty.txt`, it gives a `416` error but responds with `bytes */0`, whereas for `Apache/2.4.18` it gives `200 OK` and ignores the range (i.e. approach 2).\r\n\r\nAdding a special case is in its own way undesirable, but if either approach is acceptable I'm happy to submit an appropriate PR. I'd lean towards approach 2, personally.", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1937/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1937/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1923", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1923/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1923/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1923/events", "html_url": "https://github.com/pallets/werkzeug/issues/1923", "id": 691585602, "node_id": "MDU6SXNzdWU2OTE1ODU2MDI=", "number": 1923, "title": "Werkzeug useragent parsing is off for Motorola One Macro Android phone", "user": {"login": "mhelmetag", "id": 8609429, "node_id": "MDQ6VXNlcjg2MDk0Mjk=", "avatar_url": "https://avatars.githubusercontent.com/u/8609429?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mhelmetag", "html_url": "https://github.com/mhelmetag", "followers_url": "https://api.github.com/users/mhelmetag/followers", "following_url": "https://api.github.com/users/mhelmetag/following{/other_user}", "gists_url": "https://api.github.com/users/mhelmetag/gists{/gist_id}", "starred_url": "https://api.github.com/users/mhelmetag/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mhelmetag/subscriptions", "organizations_url": "https://api.github.com/users/mhelmetag/orgs", "repos_url": "https://api.github.com/users/mhelmetag/repos", "events_url": "https://api.github.com/users/mhelmetag/events{/privacy}", "received_events_url": "https://api.github.com/users/mhelmetag/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}, {"id": 1385074318, "node_id": "MDU6TGFiZWwxMzg1MDc0MzE4", "url": "https://api.github.com/repos/pallets/werkzeug/labels/user-agent", "name": "user-agent", "color": "80ccd6", "default": false, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/14", "html_url": "https://github.com/pallets/werkzeug/milestone/14", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/14/labels", "id": 5085882, "node_id": "MDk6TWlsZXN0b25lNTA4NTg4Mg==", "number": 14, "title": "2.0.0", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 132, "state": "closed", "created_at": "2020-02-09T21:53:29Z", "updated_at": "2021-05-11T20:31:10Z", "due_on": null, "closed_at": "2021-05-11T20:31:10Z"}, "comments": 8, "created_at": "2020-09-03T02:44:41Z", "updated_at": "2021-01-25T01:40:18Z", "closed_at": "2021-01-10T18:48:04Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "I noticed this in a flask app but that uses werkzeug to parse useragent info and saw the same behavior in both the flask request object and standalone werkzeug useragent parser.\r\n\r\nIt looks like the presence of the substring \"mac\" in \"macro\" (the device model) is throwing it off. However, I feel like that should be overridden by the clear \"Linux\" and/or \"Android 9\".\r\n\r\n```\r\n>>> from werkzeug.useragents import UserAgent\r\n>>> UserAgent(\"Mozilla/5.0 (Linux; Android 9; motorola one macro) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.111 Mobile Safari/537.36\").platform\r\n'macos'\r\n```\r\n\r\nI would expect the `platform` for this useragent string to be \"android\".\r\n\r\nEnvironment: Linux\r\n\r\n- Python version: 3.7.3\r\n- Werkzeug version: 1.01\r\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1923/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1923/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1915", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1915/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1915/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1915/events", "html_url": "https://github.com/pallets/werkzeug/pull/1915", "id": 679818264, "node_id": "MDExOlB1bGxSZXF1ZXN0NDY4NDkwNDI4", "number": 1915, "title": "prevent crash if stdin is None.", "user": {"login": "Carreau", "id": 335567, "node_id": "MDQ6VXNlcjMzNTU2Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/335567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Carreau", "html_url": "https://github.com/Carreau", "followers_url": "https://api.github.com/users/Carreau/followers", "following_url": "https://api.github.com/users/Carreau/following{/other_user}", "gists_url": "https://api.github.com/users/Carreau/gists{/gist_id}", "starred_url": "https://api.github.com/users/Carreau/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Carreau/subscriptions", "organizations_url": "https://api.github.com/users/Carreau/orgs", "repos_url": "https://api.github.com/users/Carreau/repos", "events_url": "https://api.github.com/users/Carreau/events{/privacy}", "received_events_url": "https://api.github.com/users/Carreau/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/14", "html_url": "https://github.com/pallets/werkzeug/milestone/14", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/14/labels", "id": 5085882, "node_id": "MDk6TWlsZXN0b25lNTA4NTg4Mg==", "number": 14, "title": "2.0.0", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 132, "state": "closed", "created_at": "2020-02-09T21:53:29Z", "updated_at": "2021-05-11T20:31:10Z", "due_on": null, "closed_at": "2021-05-11T20:31:10Z"}, "comments": 2, "created_at": "2020-08-16T20:12:24Z", "updated_at": "2020-11-13T14:47:05Z", "closed_at": "2020-10-14T17:38:43Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/pallets/werkzeug/pulls/1915", "html_url": "https://github.com/pallets/werkzeug/pull/1915", "diff_url": "https://github.com/pallets/werkzeug/pull/1915.diff", "patch_url": "https://github.com/pallets/werkzeug/pull/1915.patch", "merged_at": "2020-10-14T17:38:43Z"}, "body": "This can happen if you use external tools like `entr` to reload the server, then `sys.stdin` can be `None`, and one uses `run(debug=True)`.", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1915/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1915/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1797", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1797/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1797/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1797/events", "html_url": "https://github.com/pallets/werkzeug/issues/1797", "id": 611761497, "node_id": "MDU6SXNzdWU2MTE3NjE0OTc=", "number": 1797, "title": "New Microsoft Edge User Agent", "user": {"login": "ragazenta", "id": 3535194, "node_id": "MDQ6VXNlcjM1MzUxOTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3535194?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ragazenta", "html_url": "https://github.com/ragazenta", "followers_url": "https://api.github.com/users/ragazenta/followers", "following_url": "https://api.github.com/users/ragazenta/following{/other_user}", "gists_url": "https://api.github.com/users/ragazenta/gists{/gist_id}", "starred_url": "https://api.github.com/users/ragazenta/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ragazenta/subscriptions", "organizations_url": "https://api.github.com/users/ragazenta/orgs", "repos_url": "https://api.github.com/users/ragazenta/repos", "events_url": "https://api.github.com/users/ragazenta/events{/privacy}", "received_events_url": "https://api.github.com/users/ragazenta/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}, {"id": 1385074318, "node_id": "MDU6TGFiZWwxMzg1MDc0MzE4", "url": "https://api.github.com/repos/pallets/werkzeug/labels/user-agent", "name": "user-agent", "color": "80ccd6", "default": false, "description": ""}], "state": "closed", "locked": true, "assignee": {"login": "aenglander", "id": 328648, "node_id": "MDQ6VXNlcjMyODY0OA==", "avatar_url": "https://avatars.githubusercontent.com/u/328648?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aenglander", "html_url": "https://github.com/aenglander", "followers_url": "https://api.github.com/users/aenglander/followers", "following_url": "https://api.github.com/users/aenglander/following{/other_user}", "gists_url": "https://api.github.com/users/aenglander/gists{/gist_id}", "starred_url": "https://api.github.com/users/aenglander/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aenglander/subscriptions", "organizations_url": "https://api.github.com/users/aenglander/orgs", "repos_url": "https://api.github.com/users/aenglander/repos", "events_url": "https://api.github.com/users/aenglander/events{/privacy}", "received_events_url": "https://api.github.com/users/aenglander/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "aenglander", "id": 328648, "node_id": "MDQ6VXNlcjMyODY0OA==", "avatar_url": "https://avatars.githubusercontent.com/u/328648?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aenglander", "html_url": "https://github.com/aenglander", "followers_url": "https://api.github.com/users/aenglander/followers", "following_url": "https://api.github.com/users/aenglander/following{/other_user}", "gists_url": "https://api.github.com/users/aenglander/gists{/gist_id}", "starred_url": "https://api.github.com/users/aenglander/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aenglander/subscriptions", "organizations_url": "https://api.github.com/users/aenglander/orgs", "repos_url": "https://api.github.com/users/aenglander/repos", "events_url": "https://api.github.com/users/aenglander/events{/privacy}", "received_events_url": "https://api.github.com/users/aenglander/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2020-05-04T10:18:29Z", "updated_at": "2020-11-13T14:46:53Z", "closed_at": "2020-05-16T09:49:32Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Background\r\nMicrosoft Edge now based on Chromium and the user agent string is updated.\r\n`Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36 Edg/81.0.416.68`\r\n\r\n## Simple Code\r\n```python\r\n@app.route('/browser')\r\ndef browser():\r\n    from flask import request\r\n    ua = request.user_agent\r\n    return jsonify({\r\n        'browser': ua.browser,\r\n        'platform': ua.platform,\r\n        'user_agent': ua.string,\r\n        'version': ua.version,\r\n    })\r\n```\r\n\r\n## Expected Result\r\n```json\r\n{\r\n  \"browser\": \"edge\", \r\n  \"platform\": \"windows\", \r\n  \"user_agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36 Edg/81.0.416.68\", \r\n  \"version\": \"81.0.416.68\"\r\n}\r\n```\r\n\r\n| Key | Value |\r\n| --- | --- |\r\n| browser | **edge** |\r\n| platform | windows |\r\n| user_agent | Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36 Edg/81.0.416.68 |\r\n| version | **81.0.416.68** |\r\n\r\n\r\n## Actual Result\r\n```json\r\n{\r\n  \"browser\": \"chrome\", \r\n  \"platform\": \"windows\", \r\n  \"user_agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36 Edg/81.0.416.68\", \r\n  \"version\": \"81.0.4044.129\"\r\n}\r\n```\r\n\r\n| Key | Value |\r\n| --- | --- |\r\n| browser | **chrome** |\r\n| platform | windows |\r\n| user_agent | Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36 Edg/81.0.416.68 |\r\n| version | **81.0.4044.129** |\r\n\r\n## Environment\r\n- Windows 10 Pro 1909\r\n- Python 3.6.6\r\n- Werkzeug 0.16.1\r\n- Flask 1.1.1\r\n\r\n### Related Issues\r\n#818, #1556", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1797/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1797/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1832", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1832/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1832/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1832/events", "html_url": "https://github.com/pallets/werkzeug/issues/1832", "id": 636327355, "node_id": "MDU6SXNzdWU2MzYzMjczNTU=", "number": 1832, "title": "Fails to color Windows console", "user": {"login": "mrx23dot", "id": 4163396, "node_id": "MDQ6VXNlcjQxNjMzOTY=", "avatar_url": "https://avatars.githubusercontent.com/u/4163396?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrx23dot", "html_url": "https://github.com/mrx23dot", "followers_url": "https://api.github.com/users/mrx23dot/followers", "following_url": "https://api.github.com/users/mrx23dot/following{/other_user}", "gists_url": "https://api.github.com/users/mrx23dot/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrx23dot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrx23dot/subscriptions", "organizations_url": "https://api.github.com/users/mrx23dot/orgs", "repos_url": "https://api.github.com/users/mrx23dot/repos", "events_url": "https://api.github.com/users/mrx23dot/events{/privacy}", "received_events_url": "https://api.github.com/users/mrx23dot/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/14", "html_url": "https://github.com/pallets/werkzeug/milestone/14", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/14/labels", "id": 5085882, "node_id": "MDk6TWlsZXN0b25lNTA4NTg4Mg==", "number": 14, "title": "2.0.0", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 132, "state": "closed", "created_at": "2020-02-09T21:53:29Z", "updated_at": "2021-05-11T20:31:10Z", "due_on": null, "closed_at": "2021-05-11T20:31:10Z"}, "comments": 7, "created_at": "2020-05-03T13:17:42Z", "updated_at": "2021-02-03T00:54:32Z", "closed_at": "2021-01-19T03:09:14Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "On windows the new Flask prints weird characters on console, instead of coloring the line as on linux. eg: \"\u2190[37m\r\n\r\nI would rather go black/white (like in previous version) if coloring doesnt work.\r\n\r\n2020-05-03 14:05:47,398 - INFO - 127.0.0.1 - - [03/May/2020 14:05:47] \"\u2190[37mGET /result HTTP/1.1\u2190[0m\" 200 -\r\n2020-05-03 14:06:42,922 - INFO - 127.0.0.1 - - [03/May/2020 14:06:42] \"\u2190[37mGET /result HTTP/1.1\u2190[0m\" 200 -\r\n2020-05-03 14:07:24,007 - INFO - 127.0.0.1 - - [03/May/2020 14:07:24] \"\u2190[37mGET /result HTTP/1.1\u2190[0m\" 200 -\r\n2020-05-03 14:07:24,210 - INFO - 127.0.0.1 - - [03/May/2020 14:07:24] \"\u2190[37mGET /static/images/favicon.ico HTT\r\n2020-05-03 14:08:19,539 - INFO - 127.0.0.1 - - [03/May/2020 14:08:19] \"\u2190[37mGET /result HTTP/1.1\u2190[0m\" 200 -\r\n2020-05-03 14:09:15,065 - INFO - 127.0.0.1 - - [03/May/2020 14:09:15] \"\u2190[37mGET /result HTTP/1.1\u2190[0m\" 200 -\r\n2020-05-03 14:10:10,579 - INFO - 127.0.0.1 - - [03/May/2020 14:10:10] \"\u2190[37mGET /result HTTP/1.1\u2190[0m\" 200 -\r\n\r\nEnv:\r\nFlask==1.1.2\r\nWin7 x64\r\nPython 3.6.7 x64\r\nWerkzeug==1.0.1\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1832/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1832/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1733", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1733/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1733/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1733/events", "html_url": "https://github.com/pallets/werkzeug/issues/1733", "id": 565629909, "node_id": "MDU6SXNzdWU1NjU2Mjk5MDk=", "number": 1733, "title": "Change in 1.0.0 to add pathlib support for `.save()` breaks usage of `io.BytesIO`", "user": {"login": "acaos", "id": 295044, "node_id": "MDQ6VXNlcjI5NTA0NA==", "avatar_url": "https://avatars.githubusercontent.com/u/295044?v=4", "gravatar_id": "", "url": "https://api.github.com/users/acaos", "html_url": "https://github.com/acaos", "followers_url": "https://api.github.com/users/acaos/followers", "following_url": "https://api.github.com/users/acaos/following{/other_user}", "gists_url": "https://api.github.com/users/acaos/gists{/gist_id}", "starred_url": "https://api.github.com/users/acaos/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/acaos/subscriptions", "organizations_url": "https://api.github.com/users/acaos/orgs", "repos_url": "https://api.github.com/users/acaos/repos", "events_url": "https://api.github.com/users/acaos/events{/privacy}", "received_events_url": "https://api.github.com/users/acaos/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/13", "html_url": "https://github.com/pallets/werkzeug/milestone/13", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/13/labels", "id": 5085721, "node_id": "MDk6TWlsZXN0b25lNTA4NTcyMQ==", "number": 13, "title": "1.0.1", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 11, "state": "closed", "created_at": "2020-02-09T18:49:17Z", "updated_at": "2020-03-31T18:05:15Z", "due_on": null, "closed_at": "2020-03-31T18:05:15Z"}, "comments": 3, "created_at": "2020-02-15T00:42:20Z", "updated_at": "2020-11-13T14:55:00Z", "closed_at": "2020-03-17T19:51:32Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "## Versions\r\n\r\n* Python 3.7\r\n* Werkzeug 1.0.0 (from PyPI)\r\n\r\n## Report\r\n\r\nThe addition of pathlib support to `.save()` from #1654 breaks the the ability to pass `io.BytesIO` objects to `.save()`.\r\n\r\nPrevious behavior: Saving to an `io.BytesIO` object worked as expected.\r\nBehavior in 1.0.0: An exception is thrown in `fspath()`.\r\n\r\n```\r\n  File \"/app/main.py\", line 310, in extract_metadata\r\n    files['metadata'].save(metadata_io)\r\n  File \"/app/.venv/lib/python3.7/site-packages/werkzeug/datastructures.py\", line 3061, in save\r\n    dst = fspath(dst)\r\nTypeError: expected str, bytes or os.PathLike object, not _io.BytesIO\r\n```", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1733/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1733/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1659", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1659/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1659/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1659/events", "html_url": "https://github.com/pallets/werkzeug/issues/1659", "id": 519302668, "node_id": "MDU6SXNzdWU1MTkzMDI2Njg=", "number": 1659, "title": "While running a SSL server, responding an empty bytes causes an SSLEOFError.", "user": {"login": "relent95", "id": 13058392, "node_id": "MDQ6VXNlcjEzMDU4Mzky", "avatar_url": "https://avatars.githubusercontent.com/u/13058392?v=4", "gravatar_id": "", "url": "https://api.github.com/users/relent95", "html_url": "https://github.com/relent95", "followers_url": "https://api.github.com/users/relent95/followers", "following_url": "https://api.github.com/users/relent95/following{/other_user}", "gists_url": "https://api.github.com/users/relent95/gists{/gist_id}", "starred_url": "https://api.github.com/users/relent95/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/relent95/subscriptions", "organizations_url": "https://api.github.com/users/relent95/orgs", "repos_url": "https://api.github.com/users/relent95/repos", "events_url": "https://api.github.com/users/relent95/events{/privacy}", "received_events_url": "https://api.github.com/users/relent95/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}, {"id": 796989910, "node_id": "MDU6TGFiZWw3OTY5ODk5MTA=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/server", "name": "server", "color": "5319e7", "default": false, "description": ""}], "state": "closed", "locked": true, "assignee": {"login": "aenglander", "id": 328648, "node_id": "MDQ6VXNlcjMyODY0OA==", "avatar_url": "https://avatars.githubusercontent.com/u/328648?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aenglander", "html_url": "https://github.com/aenglander", "followers_url": "https://api.github.com/users/aenglander/followers", "following_url": "https://api.github.com/users/aenglander/following{/other_user}", "gists_url": "https://api.github.com/users/aenglander/gists{/gist_id}", "starred_url": "https://api.github.com/users/aenglander/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aenglander/subscriptions", "organizations_url": "https://api.github.com/users/aenglander/orgs", "repos_url": "https://api.github.com/users/aenglander/repos", "events_url": "https://api.github.com/users/aenglander/events{/privacy}", "received_events_url": "https://api.github.com/users/aenglander/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "aenglander", "id": 328648, "node_id": "MDQ6VXNlcjMyODY0OA==", "avatar_url": "https://avatars.githubusercontent.com/u/328648?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aenglander", "html_url": "https://github.com/aenglander", "followers_url": "https://api.github.com/users/aenglander/followers", "following_url": "https://api.github.com/users/aenglander/following{/other_user}", "gists_url": "https://api.github.com/users/aenglander/gists{/gist_id}", "starred_url": "https://api.github.com/users/aenglander/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aenglander/subscriptions", "organizations_url": "https://api.github.com/users/aenglander/orgs", "repos_url": "https://api.github.com/users/aenglander/repos", "events_url": "https://api.github.com/users/aenglander/events{/privacy}", "received_events_url": "https://api.github.com/users/aenglander/received_events", "type": "User", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/12", "html_url": "https://github.com/pallets/werkzeug/milestone/12", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/12/labels", "id": 4973120, "node_id": "MDk6TWlsZXN0b25lNDk3MzEyMA==", "number": 12, "title": "0.16.1", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 7, "state": "closed", "created_at": "2020-01-04T20:37:27Z", "updated_at": "2020-01-27T04:19:12Z", "due_on": null, "closed_at": "2020-01-27T04:19:12Z"}, "comments": 3, "created_at": "2019-10-22T08:15:14Z", "updated_at": "2020-11-13T15:12:37Z", "closed_at": "2020-01-04T21:16:42Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "<!-- **This issue tracker is a tool to address bugs in Flask itself.\r\nPlease use the #pocoo IRC channel on freenode or Stack Overflow for general\r\nquestions about using Flask or issues not related to Flask.** -->\r\n\r\n<!-- If you'd like to report a bug in Flask, fill out the template below. Provide\r\nany extra information that may be useful / related to your problem.\r\nIdeally, create an [MCVE](https://stackoverflow.com/help/mcve), which helps us\r\nunderstand the problem and helps check that it is not caused by something in\r\nyour code. -->\r\n\r\n\r\n\r\n### Expected Behavior\r\n<!-- Tell us what should happen. -->\r\nIn a request handler(endpoint), responding an empty bytes should be OK as in the following example.\r\n```python\r\n@app.route('/test', methods = ['PUT'])\r\ndef test():\r\n  return b'', 204 # HTTP_NO_CONTENT\r\n\r\n```\r\n\r\n### Actual Behavior\r\n<!-- Tell us what happens instead. -->\r\nBut currently, this causes an SSLEOFError exception.\r\n```pytb\r\nError on request:\r\nTraceback (most recent call last):\r\n  File \"/home/relent95/.local/lib/python3.5/site-packages/werkzeug/serving.py\", line 303, in run_wsgi\r\n    execute(self.server.app)\r\n  File \"/home/relent95/.local/lib/python3.5/site-packages/werkzeug/serving.py\", line 294, in execute\r\n    write(data)\r\n  File \"/home/relent95/.local/lib/python3.5/site-packages/werkzeug/serving.py\", line 275, in write\r\n    self.wfile.write(data)\r\n  File \"/usr/lib/python3.5/socket.py\", line 593, in write\r\n    return self._sock.send(b)\r\n  File \"/usr/lib/python3.5/ssl.py\", line 861, in send\r\n    return self._sslobj.write(data)\r\n  File \"/usr/lib/python3.5/ssl.py\", line 586, in write\r\n    return self._sslobj.write(data)\r\nssl.SSLEOFError: EOF occurred in violation of protocol (_ssl.c:1848)\r\n\r\n```\r\n\r\n### Environment\r\n\r\n* Python version: 3.5.2\r\n* Flask version: 1.1.1\r\n* Werkzeug version: 0.15.5\r\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1659/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1659/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1607", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1607/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1607/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1607/events", "html_url": "https://github.com/pallets/werkzeug/issues/1607", "id": 466393606, "node_id": "MDU6SXNzdWU0NjYzOTM2MDY=", "number": 1607, "title": "Reloader picks wrong module when Flask is run with the pydev debugger", "user": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}, {"id": 127559587, "node_id": "MDU6TGFiZWwxMjc1NTk1ODc=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/reloader", "name": "reloader", "color": "5319e7", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/9", "html_url": "https://github.com/pallets/werkzeug/milestone/9", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/9/labels", "id": 4315833, "node_id": "MDk6TWlsZXN0b25lNDMxNTgzMw==", "number": 9, "title": "0.15.5", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 19, "state": "closed", "created_at": "2019-05-15T01:50:28Z", "updated_at": "2019-07-17T15:41:07Z", "due_on": null, "closed_at": "2019-07-17T15:41:07Z"}, "comments": 0, "created_at": "2019-07-10T16:01:55Z", "updated_at": "2020-11-13T15:13:07Z", "closed_at": "2019-07-10T20:59:38Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "body": "This is a weird situation where the pallets/werkzeug#1416 fix to make `python -m` reloading more correct actually exposed an issue with PyDev. It rewrites `python -m flask` to `python flask` (which is clearly not correct), while Python itself rewrites it to `python /path/to/flask_entry_point.py`. Werkzeug still correctly detects that we were run as a module, but since `sys.argv[0]` is no longer a path but the module name, it incorrectly decides that there is a module named `flask.flask` in the current directory.\r\n\r\n_Originally posted by @davidism in https://github.com/pallets/flask/issues/3297#issuecomment-510120836_", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1607/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1607/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1584", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1584/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1584/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1584/events", "html_url": "https://github.com/pallets/werkzeug/pull/1584", "id": 454371959, "node_id": "MDExOlB1bGxSZXF1ZXN0Mjg2ODM2Njkz", "number": 1584, "title": "match server names with default scheme and port", "user": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}, {"id": 141452452, "node_id": "MDU6TGFiZWwxNDE0NTI0NTI=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/routing", "name": "routing", "color": "5319e7", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/1", "html_url": "https://github.com/pallets/werkzeug/milestone/1", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/1/labels", "id": 764000, "node_id": "MDk6TWlsZXN0b25lNzY0MDAw", "number": 1, "title": "1.0.0", "description": "", "creator": {"login": "untitaker", "id": 837573, "node_id": "MDQ6VXNlcjgzNzU3Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/837573?v=4", "gravatar_id": "", "url": "https://api.github.com/users/untitaker", "html_url": "https://github.com/untitaker", "followers_url": "https://api.github.com/users/untitaker/followers", "following_url": "https://api.github.com/users/untitaker/following{/other_user}", "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}", "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions", "organizations_url": "https://api.github.com/users/untitaker/orgs", "repos_url": "https://api.github.com/users/untitaker/repos", "events_url": "https://api.github.com/users/untitaker/events{/privacy}", "received_events_url": "https://api.github.com/users/untitaker/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 78, "state": "closed", "created_at": "2014-08-24T22:39:25Z", "updated_at": "2020-02-09T18:49:49Z", "due_on": null, "closed_at": "2020-02-09T18:49:49Z"}, "comments": 0, "created_at": "2019-06-10T21:03:05Z", "updated_at": "2020-11-13T15:35:53Z", "closed_at": "2019-06-11T15:45:33Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/pallets/werkzeug/pulls/1584", "html_url": "https://github.com/pallets/werkzeug/pull/1584", "diff_url": "https://github.com/pallets/werkzeug/pull/1584.diff", "patch_url": "https://github.com/pallets/werkzeug/pull/1584.patch", "merged_at": "2019-06-11T15:45:33Z"}, "body": "If the configured server name has a port that matches the scheme of the incoming WSGI server name, it will match successfully. Previously, specifying `localhost:443` wouldn't match `https://localhost`.\r\n\r\nDiscovered while fixing some warnings generated in the Flask test suite after #1577.", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1584/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1584/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1553", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1553/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1553/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1553/events", "html_url": "https://github.com/pallets/werkzeug/issues/1553", "id": 446024573, "node_id": "MDU6SXNzdWU0NDYwMjQ1NzM=", "number": 1553, "title": "AssertionError on python 2.7.9 in Werkzeug>=0.15.3", "user": {"login": "DOlearczyk", "id": 8964459, "node_id": "MDQ6VXNlcjg5NjQ0NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/8964459?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DOlearczyk", "html_url": "https://github.com/DOlearczyk", "followers_url": "https://api.github.com/users/DOlearczyk/followers", "following_url": "https://api.github.com/users/DOlearczyk/following{/other_user}", "gists_url": "https://api.github.com/users/DOlearczyk/gists{/gist_id}", "starred_url": "https://api.github.com/users/DOlearczyk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DOlearczyk/subscriptions", "organizations_url": "https://api.github.com/users/DOlearczyk/orgs", "repos_url": "https://api.github.com/users/DOlearczyk/repos", "events_url": "https://api.github.com/users/DOlearczyk/events{/privacy}", "received_events_url": "https://api.github.com/users/DOlearczyk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/9", "html_url": "https://github.com/pallets/werkzeug/milestone/9", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/9/labels", "id": 4315833, "node_id": "MDk6TWlsZXN0b25lNDMxNTgzMw==", "number": 9, "title": "0.15.5", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 19, "state": "closed", "created_at": "2019-05-15T01:50:28Z", "updated_at": "2019-07-17T15:41:07Z", "due_on": null, "closed_at": "2019-07-17T15:41:07Z"}, "comments": 4, "created_at": "2019-05-20T09:53:31Z", "updated_at": "2020-11-13T15:25:53Z", "closed_at": "2019-05-21T20:44:06Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "When trying to create new flask object, I get following error:\r\n```\r\n>>> from flask import Flask\r\n>>> flask_app = Flask(__name__)\r\npython: /mnt/builds/jenkins-builds/workspace/pulsar-8/RC/icedge-apl-4/build-intel-apollolake/tmp/work/core2-64-wrs-linux/python/2.7.9-r1/Python-2.7.9/Python/symtable.c:1319: symtable_visit_params: Assertion `arg->v.Name.ctx == Param || (arg->v.Name.ctx == Store && !toplevel)' failed.\r\nAborted (core dumped)\r\n```\r\nThis assertion error only shows up with Werkzeug version 0.15.3 and 0.15.4. It doesn't appear with version 0.15.2.\r\n\r\nOS: Pulsar Linux 8.0.0.14\r\nPython: 2.7.9\r\nFlask: 1.0.2\r\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1553/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1553/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1551", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1551/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1551/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1551/events", "html_url": "https://github.com/pallets/werkzeug/issues/1551", "id": 445785912, "node_id": "MDU6SXNzdWU0NDU3ODU5MTI=", "number": 1551, "title": "ast.Module signature change in Python 3.8.0a3 causes TypeError", "user": {"login": "paihu", "id": 13479783, "node_id": "MDQ6VXNlcjEzNDc5Nzgz", "avatar_url": "https://avatars.githubusercontent.com/u/13479783?v=4", "gravatar_id": "", "url": "https://api.github.com/users/paihu", "html_url": "https://github.com/paihu", "followers_url": "https://api.github.com/users/paihu/followers", "following_url": "https://api.github.com/users/paihu/following{/other_user}", "gists_url": "https://api.github.com/users/paihu/gists{/gist_id}", "starred_url": "https://api.github.com/users/paihu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/paihu/subscriptions", "organizations_url": "https://api.github.com/users/paihu/orgs", "repos_url": "https://api.github.com/users/paihu/repos", "events_url": "https://api.github.com/users/paihu/events{/privacy}", "received_events_url": "https://api.github.com/users/paihu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/9", "html_url": "https://github.com/pallets/werkzeug/milestone/9", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/9/labels", "id": 4315833, "node_id": "MDk6TWlsZXN0b25lNDMxNTgzMw==", "number": 9, "title": "0.15.5", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 19, "state": "closed", "created_at": "2019-05-15T01:50:28Z", "updated_at": "2019-07-17T15:41:07Z", "due_on": null, "closed_at": "2019-07-17T15:41:07Z"}, "comments": 7, "created_at": "2019-05-19T06:31:47Z", "updated_at": "2020-11-13T14:46:45Z", "closed_at": "2019-05-21T20:13:48Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "With Python 3.8.0a3 and Werkzeug 0.15.4, compiling the rule builders causes `TypeError: required field \"type_ignores\" missing from Module`. It sounds like `ast.Module` has a new required argument.\r\n\r\nI think this is the same problem as https://github.com/beetbox/beets/issues/3201#issuecomment-478341869\r\n\r\n```\r\nflask run\r\n * Serving Flask app \"flask_test.py\"\r\n * Environment: production\r\n   WARNING: This is a development server. Do not use it in a production deployment.\r\n   Use a production WSGI server instead.\r\n * Debug mode: off\r\nTraceback (most recent call last):\r\n  File \"d:\\tool\\python\\38\\lib\\runpy.py\", line 192, in _run_module_as_main\r\n    return _run_code(code, main_globals, None,\r\n  File \"d:\\tool\\python\\38\\lib\\runpy.py\", line 85, in _run_code\r\n    exec(code, run_globals)\r\n  File \"d:\\tool\\python\\38\\Scripts\\flask.exe\\__main__.py\", line 9, in <module>\r\n  File \"d:\\tool\\python\\38\\lib\\site-packages\\flask\\cli.py\", line 906, in main\r\n    cli.main(args=args, prog_name=name)\r\n  File \"d:\\tool\\python\\38\\lib\\site-packages\\flask\\cli.py\", line 569, in main\r\n    return super(FlaskGroup, self).main(*args, **kwargs)\r\n  File \"d:\\tool\\python\\38\\lib\\site-packages\\click\\core.py\", line 717, in main\r\n    rv = self.invoke(ctx)\r\n  File \"d:\\tool\\python\\38\\lib\\site-packages\\click\\core.py\", line 1137, in invoke\r\n    return _process_result(sub_ctx.command.invoke(sub_ctx))\r\n  File \"d:\\tool\\python\\38\\lib\\site-packages\\click\\core.py\", line 956, in invoke\r\n    return ctx.invoke(self.callback, **ctx.params)\r\n  File \"d:\\tool\\python\\38\\lib\\site-packages\\click\\core.py\", line 555, in invoke\r\n    return callback(*args, **kwargs)\r\n  File \"d:\\tool\\python\\38\\lib\\site-packages\\click\\decorators.py\", line 64, in new_func\r\n    return ctx.invoke(f, obj, *args, **kwargs)\r\n  File \"d:\\tool\\python\\38\\lib\\site-packages\\click\\core.py\", line 555, in invoke\r\n    return callback(*args, **kwargs)\r\n  File \"d:\\tool\\python\\38\\lib\\site-packages\\flask\\cli.py\", line 779, in run_command\r\n    app = DispatchingApp(info.load_app, use_eager_loading=eager_loading)\r\n  File \"d:\\tool\\python\\38\\lib\\site-packages\\flask\\cli.py\", line 300, in __init__\r\n    self._load_unlocked()\r\n  File \"d:\\tool\\python\\38\\lib\\site-packages\\flask\\cli.py\", line 324, in _load_unlocked\r\n    self._app = rv = self.loader()\r\n  File \"d:\\tool\\python\\38\\lib\\site-packages\\flask\\cli.py\", line 381, in load_app\r\n    app = locate_app(self, import_name, name)\r\n  File \"d:\\tool\\python\\38\\lib\\site-packages\\flask\\cli.py\", line 236, in locate_app\r\n    __import__(module_name)\r\n  File \"D:\\flask_test.py\", line 3, in <module>\r\n    app = Flask(__name__)\r\n  File \"d:\\tool\\python\\38\\lib\\site-packages\\flask\\app.py\", line 559, in __init__\r\n    self.add_url_rule(\r\n  File \"d:\\tool\\python\\38\\lib\\site-packages\\flask\\app.py\", line 67, in wrapper_func\r\n    return f(self, *args, **kwargs)\r\n  File \"d:\\tool\\python\\38\\lib\\site-packages\\flask\\app.py\", line 1217, in add_url_rule\r\n    self.url_map.add(rule)\r\n  File \"d:\\tool\\python\\38\\lib\\site-packages\\werkzeug\\routing.py\", line 1388, in add\r\n    rule.bind(self)\r\n  File \"d:\\tool\\python\\38\\lib\\site-packages\\werkzeug\\routing.py\", line 730, in bind\r\n    self.compile()\r\n  File \"d:\\tool\\python\\38\\lib\\site-packages\\werkzeug\\routing.py\", line 794, in compile\r\n    self._build = self._compile_builder(False).__get__(self, None)\r\n  File \"d:\\tool\\python\\38\\lib\\site-packages\\werkzeug\\routing.py\", line 951, in _compile_builder\r\n    code = compile(module, \"<werkzeug routing>\", \"exec\")\r\nTypeError: required field \"type_ignores\" missing from Module\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1551/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1551/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1545", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1545/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1545/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1545/events", "html_url": "https://github.com/pallets/werkzeug/pull/1545", "id": 444193571, "node_id": "MDExOlB1bGxSZXF1ZXN0Mjc4OTA0NTAy", "number": 1545, "title": "Fix SyntaxError on python 2.7.5", "user": {"login": "asottile", "id": 1810591, "node_id": "MDQ6VXNlcjE4MTA1OTE=", "avatar_url": "https://avatars.githubusercontent.com/u/1810591?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asottile", "html_url": "https://github.com/asottile", "followers_url": "https://api.github.com/users/asottile/followers", "following_url": "https://api.github.com/users/asottile/following{/other_user}", "gists_url": "https://api.github.com/users/asottile/gists{/gist_id}", "starred_url": "https://api.github.com/users/asottile/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asottile/subscriptions", "organizations_url": "https://api.github.com/users/asottile/orgs", "repos_url": "https://api.github.com/users/asottile/repos", "events_url": "https://api.github.com/users/asottile/events{/privacy}", "received_events_url": "https://api.github.com/users/asottile/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}, {"id": 141452452, "node_id": "MDU6TGFiZWwxNDE0NTI0NTI=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/routing", "name": "routing", "color": "5319e7", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/8", "html_url": "https://github.com/pallets/werkzeug/milestone/8", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/8/labels", "id": 4315309, "node_id": "MDk6TWlsZXN0b25lNDMxNTMwOQ==", "number": 8, "title": "0.15.4", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 2, "state": "closed", "created_at": "2019-05-14T21:14:36Z", "updated_at": "2019-05-15T01:50:19Z", "due_on": null, "closed_at": "2019-05-15T01:50:19Z"}, "comments": 7, "created_at": "2019-05-15T01:23:08Z", "updated_at": "2020-11-13T15:36:02Z", "closed_at": "2019-05-15T01:39:26Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/pallets/werkzeug/pulls/1545", "html_url": "https://github.com/pallets/werkzeug/pull/1545", "diff_url": "https://github.com/pallets/werkzeug/pull/1545.diff", "patch_url": "https://github.com/pallets/werkzeug/pull/1545.patch", "merged_at": "2019-05-15T01:39:26Z"}, "body": "Resolves #1544\r\n\r\nHere's the test plan I used, since we can't install 2.7.5 in CI this'll have to do:\r\n\r\n```console\r\n$ docker run --rm -ti -v \"$PWD:/code:ro\" centos:7\r\n...\r\n[root@9b75ddb7a51a code]# python -m compileall src/werkzeug/routing.py \r\nCompiling src/werkzeug/routing.py ...\r\nSyntaxError: unqualified exec is not allowed in function '_compile_builder' it contains a nested function with free variables (routing.py, line 948)\r\n\r\n    # outside of docker, I did `git apply patch` to get to the code you see in this PR\r\n\r\n[root@9b75ddb7a51a code]# python -m compileall src/werkzeug/routing.py \r\nCompiling src/werkzeug/routing.py ...\r\nSorry [Errno 30] Read-only file system: 'src/werkzeug/routing.pyc'\r\n```", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1545/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1545/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1544", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1544/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1544/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1544/events", "html_url": "https://github.com/pallets/werkzeug/issues/1544", "id": 444169613, "node_id": "MDU6SXNzdWU0NDQxNjk2MTM=", "number": 1544, "title": "SyntaxError on python2.7.5 in 0.15.3", "user": {"login": "golf-player", "id": 35775018, "node_id": "MDQ6VXNlcjM1Nzc1MDE4", "avatar_url": "https://avatars.githubusercontent.com/u/35775018?v=4", "gravatar_id": "", "url": "https://api.github.com/users/golf-player", "html_url": "https://github.com/golf-player", "followers_url": "https://api.github.com/users/golf-player/followers", "following_url": "https://api.github.com/users/golf-player/following{/other_user}", "gists_url": "https://api.github.com/users/golf-player/gists{/gist_id}", "starred_url": "https://api.github.com/users/golf-player/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/golf-player/subscriptions", "organizations_url": "https://api.github.com/users/golf-player/orgs", "repos_url": "https://api.github.com/users/golf-player/repos", "events_url": "https://api.github.com/users/golf-player/events{/privacy}", "received_events_url": "https://api.github.com/users/golf-player/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}, {"id": 141452452, "node_id": "MDU6TGFiZWwxNDE0NTI0NTI=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/routing", "name": "routing", "color": "5319e7", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/8", "html_url": "https://github.com/pallets/werkzeug/milestone/8", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/8/labels", "id": 4315309, "node_id": "MDk6TWlsZXN0b25lNDMxNTMwOQ==", "number": 8, "title": "0.15.4", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 2, "state": "closed", "created_at": "2019-05-14T21:14:36Z", "updated_at": "2019-05-15T01:50:19Z", "due_on": null, "closed_at": "2019-05-15T01:50:19Z"}, "comments": 10, "created_at": "2019-05-14T23:28:44Z", "updated_at": "2020-11-13T15:25:55Z", "closed_at": "2019-05-15T01:40:09Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "Traceback:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/usr/lib64/python2.7/site-packages/werkzeug/routing.py\", line 948\r\n    exec(code, globs, locs)\r\nSyntaxError: unqualified exec is not allowed in function '_compile_builder' it contains a nested function with free variables\r\n```\r\n\r\nI haven't dug too deep into this, but I suspect it's the comprehensions which, in python2.7.5, are treated as subfunctions https://stackoverflow.com/a/52498591/8826764\r\n\r\npython2.7.5 is important to support as it's the default python version shipped with centos7, and we're not at EOL quite yet.\r\n\r\nI'll have time on the weekend to make an MR for this if that's OK with y'all.\r\n\r\nIf not, please change the setup python_requires to require a higher version of python. ", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1544/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1544/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1536", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1536/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1536/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1536/events", "html_url": "https://github.com/pallets/werkzeug/issues/1536", "id": 441201681, "node_id": "MDU6SXNzdWU0NDEyMDE2ODE=", "number": 1536, "title": "werkzeug times out when exception is raised", "user": {"login": "RazerM", "id": 1337586, "node_id": "MDQ6VXNlcjEzMzc1ODY=", "avatar_url": "https://avatars.githubusercontent.com/u/1337586?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RazerM", "html_url": "https://github.com/RazerM", "followers_url": "https://api.github.com/users/RazerM/followers", "following_url": "https://api.github.com/users/RazerM/following{/other_user}", "gists_url": "https://api.github.com/users/RazerM/gists{/gist_id}", "starred_url": "https://api.github.com/users/RazerM/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RazerM/subscriptions", "organizations_url": "https://api.github.com/users/RazerM/orgs", "repos_url": "https://api.github.com/users/RazerM/repos", "events_url": "https://api.github.com/users/RazerM/events{/privacy}", "received_events_url": "https://api.github.com/users/RazerM/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}, {"id": 1201001982, "node_id": "MDU6TGFiZWwxMjAxMDAxOTgy", "url": "https://api.github.com/repos/pallets/werkzeug/labels/debugger", "name": "debugger", "color": "5319e7", "default": false, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/7", "html_url": "https://github.com/pallets/werkzeug/milestone/7", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/7/labels", "id": 4293382, "node_id": "MDk6TWlsZXN0b25lNDI5MzM4Mg==", "number": 7, "title": "0.15.3", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 16, "state": "closed", "created_at": "2019-05-07T18:05:52Z", "updated_at": "2019-05-14T21:14:28Z", "due_on": null, "closed_at": "2019-05-14T21:14:28Z"}, "comments": 2, "created_at": "2019-05-07T12:20:06Z", "updated_at": "2020-11-13T15:25:57Z", "closed_at": "2019-05-12T14:56:20Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "I found this within a large Flask application but I managed to reproduce it.\r\n\r\nSQLAlchemy's exceptions contain an `.orig` attribute with the original DBAPI exception. I only raised it to see it in the werkzeug debugger, and found that the debugger page never loads.\r\n\r\n```python\r\nfrom werkzeug.wrappers import Request, Response\r\nfrom sqlalchemy import create_engine, text\r\nfrom sqlalchemy.exc import DatabaseError\r\n\r\nengine = create_engine('sqlite://')\r\n\r\n\r\n@Request.application\r\ndef application(request):\r\n    try:\r\n        engine.execute(text('SELECT undefined_function()'))\r\n    except DatabaseError as exc:\r\n        # if we just re-raise, it works fine\r\n        # raise\r\n\r\n        # exc.orig is definitely an exception\r\n        assert isinstance(exc.orig, Exception)\r\n\r\n        # werkzeug doesn't return a response when this is raised\r\n        raise exc.orig\r\n    return Response('This is unreachable')\r\n\r\n\r\nif __name__ == '__main__':\r\n    from werkzeug.serving import run_simple\r\n    run_simple('localhost', 4000, application, use_debugger=True)\r\n```\r\n\r\nThe same happens for a PostgreSQL (psycopg2) connection.", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1536/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1536/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1522", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1522/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1522/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1522/events", "html_url": "https://github.com/pallets/werkzeug/pull/1522", "id": 436765374, "node_id": "MDExOlB1bGxSZXF1ZXN0MjczMTg1ODIx", "number": 1522, "title": "routing: don't convert bytes arguments to str", "user": {"login": "edk0", "id": 1224325, "node_id": "MDQ6VXNlcjEyMjQzMjU=", "avatar_url": "https://avatars.githubusercontent.com/u/1224325?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edk0", "html_url": "https://github.com/edk0", "followers_url": "https://api.github.com/users/edk0/followers", "following_url": "https://api.github.com/users/edk0/following{/other_user}", "gists_url": "https://api.github.com/users/edk0/gists{/gist_id}", "starred_url": "https://api.github.com/users/edk0/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edk0/subscriptions", "organizations_url": "https://api.github.com/users/edk0/orgs", "repos_url": "https://api.github.com/users/edk0/repos", "events_url": "https://api.github.com/users/edk0/events{/privacy}", "received_events_url": "https://api.github.com/users/edk0/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}, {"id": 141452452, "node_id": "MDU6TGFiZWwxNDE0NTI0NTI=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/routing", "name": "routing", "color": "5319e7", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/7", "html_url": "https://github.com/pallets/werkzeug/milestone/7", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/7/labels", "id": 4293382, "node_id": "MDk6TWlsZXN0b25lNDI5MzM4Mg==", "number": 7, "title": "0.15.3", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 16, "state": "closed", "created_at": "2019-05-07T18:05:52Z", "updated_at": "2019-05-14T21:14:28Z", "due_on": null, "closed_at": "2019-05-14T21:14:28Z"}, "comments": 0, "created_at": "2019-04-24T15:32:10Z", "updated_at": "2020-11-13T15:43:43Z", "closed_at": "2019-05-08T18:45:50Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/pallets/werkzeug/pulls/1522", "html_url": "https://github.com/pallets/werkzeug/pull/1522", "diff_url": "https://github.com/pallets/werkzeug/pull/1522.diff", "patch_url": "https://github.com/pallets/werkzeug/pull/1522.patch", "merged_at": "2019-05-08T18:45:50Z"}, "body": "closes #1502 ", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1522/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1522/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1520", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1520/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1520/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1520/events", "html_url": "https://github.com/pallets/werkzeug/issues/1520", "id": 436336369, "node_id": "MDU6SXNzdWU0MzYzMzYzNjk=", "number": 1520, "title": "runaway memory usage on 0.15.x", "user": {"login": "asottile", "id": 1810591, "node_id": "MDQ6VXNlcjE4MTA1OTE=", "avatar_url": "https://avatars.githubusercontent.com/u/1810591?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asottile", "html_url": "https://github.com/asottile", "followers_url": "https://api.github.com/users/asottile/followers", "following_url": "https://api.github.com/users/asottile/following{/other_user}", "gists_url": "https://api.github.com/users/asottile/gists{/gist_id}", "starred_url": "https://api.github.com/users/asottile/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asottile/subscriptions", "organizations_url": "https://api.github.com/users/asottile/orgs", "repos_url": "https://api.github.com/users/asottile/repos", "events_url": "https://api.github.com/users/asottile/events{/privacy}", "received_events_url": "https://api.github.com/users/asottile/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}, {"id": 141452452, "node_id": "MDU6TGFiZWwxNDE0NTI0NTI=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/routing", "name": "routing", "color": "5319e7", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/7", "html_url": "https://github.com/pallets/werkzeug/milestone/7", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/7/labels", "id": 4293382, "node_id": "MDk6TWlsZXN0b25lNDI5MzM4Mg==", "number": 7, "title": "0.15.3", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 16, "state": "closed", "created_at": "2019-05-07T18:05:52Z", "updated_at": "2019-05-14T21:14:28Z", "due_on": null, "closed_at": "2019-05-14T21:14:28Z"}, "comments": 11, "created_at": "2019-04-23T18:47:38Z", "updated_at": "2020-11-13T15:25:59Z", "closed_at": "2019-05-08T19:48:12Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "I've narrowed it down to this little script, haven't dug into it yet but the smoking gun is the new function compilation stuff\r\n\r\n```python\r\nfrom werkzeug.routing import Map, Rule\r\n\r\n\r\ndef main():\r\n    while True:\r\n        Map([Rule('/a/<string:b>')])\r\n\r\n\r\nif __name__ == '__main__':\r\n    exit(main())\r\n```", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1520/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1520/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1499", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1499/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1499/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1499/events", "html_url": "https://github.com/pallets/werkzeug/pull/1499", "id": 427982330, "node_id": "MDExOlB1bGxSZXF1ZXN0MjY2NDU2NTA0", "number": 1499, "title": "test client copies environ passed to app", "user": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/6", "html_url": "https://github.com/pallets/werkzeug/milestone/6", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/6/labels", "id": 4164013, "node_id": "MDk6TWlsZXN0b25lNDE2NDAxMw==", "number": 6, "title": "0.15.2", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 9, "state": "closed", "created_at": "2019-03-22T14:27:41Z", "updated_at": "2019-04-02T17:20:50Z", "due_on": null, "closed_at": "2019-04-02T17:20:50Z"}, "comments": 0, "created_at": "2019-04-02T01:33:52Z", "updated_at": "2020-11-13T15:43:46Z", "closed_at": "2019-04-02T03:59:36Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/pallets/werkzeug/pulls/1499", "html_url": "https://github.com/pallets/werkzeug/pull/1499", "diff_url": "https://github.com/pallets/werkzeug/pull/1499.diff", "patch_url": "https://github.com/pallets/werkzeug/pull/1499.patch", "merged_at": "2019-04-02T03:59:36Z"}, "body": "This calls `environ.copy()`, isolating any changes the app makes to the environ from the client's original environ.\r\n\r\ncloses #1498 ", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1499/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1499/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1498", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1498/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1498/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1498/events", "html_url": "https://github.com/pallets/werkzeug/issues/1498", "id": 427681613, "node_id": "MDU6SXNzdWU0Mjc2ODE2MTM=", "number": 1498, "title": "Test client redirect resets path info in 0.15", "user": {"login": "sekrause", "id": 595780, "node_id": "MDQ6VXNlcjU5NTc4MA==", "avatar_url": "https://avatars.githubusercontent.com/u/595780?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sekrause", "html_url": "https://github.com/sekrause", "followers_url": "https://api.github.com/users/sekrause/followers", "following_url": "https://api.github.com/users/sekrause/following{/other_user}", "gists_url": "https://api.github.com/users/sekrause/gists{/gist_id}", "starred_url": "https://api.github.com/users/sekrause/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sekrause/subscriptions", "organizations_url": "https://api.github.com/users/sekrause/orgs", "repos_url": "https://api.github.com/users/sekrause/repos", "events_url": "https://api.github.com/users/sekrause/events{/privacy}", "received_events_url": "https://api.github.com/users/sekrause/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/6", "html_url": "https://github.com/pallets/werkzeug/milestone/6", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/6/labels", "id": 4164013, "node_id": "MDk6TWlsZXN0b25lNDE2NDAxMw==", "number": 6, "title": "0.15.2", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 9, "state": "closed", "created_at": "2019-03-22T14:27:41Z", "updated_at": "2019-04-02T17:20:50Z", "due_on": null, "closed_at": "2019-04-02T17:20:50Z"}, "comments": 3, "created_at": "2019-04-01T12:38:45Z", "updated_at": "2020-11-13T14:46:46Z", "closed_at": "2019-04-02T03:59:47Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "Pull request #1402 changes the redirect handling in werkzeug.test.Client and seems to reuse the `environ` from the first request to follow the redirect. This leads to problems when the application modifies the `environ` in-place.\r\n\r\nI have a multi-tenant application which resolves the tenant from the first path element in a middleware with `werkzeug.wsgi.pop_path_info()` before passing the request to a Flask application. This behavior is recommended by the Flask documentation: http://flask.pocoo.org/docs/0.12/patterns/appdispatch/#dispatch-by-path\r\n\r\nHowever, combining `pop_path_info()` and redirects will breaks tests with Werkzeug >= 0.15 because when Werkzeug makes the second request following the redirct, it will reuse an `environ` where the first path element is already gone.\r\n\r\nHere is a test application which demonstrates this problem:\r\n\r\n```python\r\nfrom flask import Flask, redirect, url_for\r\nfrom werkzeug.test import Client\r\nfrom werkzeug.wrappers import BaseResponse\r\nfrom werkzeug.wsgi import pop_path_info\r\n\r\napp = Flask(__name__)\r\n\r\n@app.route(\"/first\")\r\ndef first():\r\n    return redirect(url_for('.second'))\r\n\r\n@app.route(\"/second\")\r\ndef second():\r\n    return b'hello'\r\n\r\nclient = Client(app, BaseResponse)\r\nr = client.get('/first', follow_redirects=True)\r\nassert r.data == b'hello'\r\n\r\ndef middleware(environ, start_response):\r\n    print('Before pop_path_info(): %s' % environ['PATH_INFO'])\r\n    pop_path_info(environ)\r\n    print('After pop_path_info(): %s' % environ['PATH_INFO'])\r\n    return app(environ, start_response)\r\n\r\nclient = Client(middleware, BaseResponse)\r\nr = client.get('/tenant/first', follow_redirects=True)\r\nassert r.data == b'hello'\r\n```", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1498/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1498/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1496", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1496/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1496/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1496/events", "html_url": "https://github.com/pallets/werkzeug/pull/1496", "id": 427058198, "node_id": "MDExOlB1bGxSZXF1ZXN0MjY1NzcyNjIy", "number": 1496, "title": "Don't ignore Set-Cookie directives when parsing Cookie header", "user": {"login": "forrestchang", "id": 7857126, "node_id": "MDQ6VXNlcjc4NTcxMjY=", "avatar_url": "https://avatars.githubusercontent.com/u/7857126?v=4", "gravatar_id": "", "url": "https://api.github.com/users/forrestchang", "html_url": "https://github.com/forrestchang", "followers_url": "https://api.github.com/users/forrestchang/followers", "following_url": "https://api.github.com/users/forrestchang/following{/other_user}", "gists_url": "https://api.github.com/users/forrestchang/gists{/gist_id}", "starred_url": "https://api.github.com/users/forrestchang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/forrestchang/subscriptions", "organizations_url": "https://api.github.com/users/forrestchang/orgs", "repos_url": "https://api.github.com/users/forrestchang/repos", "events_url": "https://api.github.com/users/forrestchang/events{/privacy}", "received_events_url": "https://api.github.com/users/forrestchang/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/1", "html_url": "https://github.com/pallets/werkzeug/milestone/1", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/1/labels", "id": 764000, "node_id": "MDk6TWlsZXN0b25lNzY0MDAw", "number": 1, "title": "1.0.0", "description": "", "creator": {"login": "untitaker", "id": 837573, "node_id": "MDQ6VXNlcjgzNzU3Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/837573?v=4", "gravatar_id": "", "url": "https://api.github.com/users/untitaker", "html_url": "https://github.com/untitaker", "followers_url": "https://api.github.com/users/untitaker/followers", "following_url": "https://api.github.com/users/untitaker/following{/other_user}", "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}", "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions", "organizations_url": "https://api.github.com/users/untitaker/orgs", "repos_url": "https://api.github.com/users/untitaker/repos", "events_url": "https://api.github.com/users/untitaker/events{/privacy}", "received_events_url": "https://api.github.com/users/untitaker/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 78, "state": "closed", "created_at": "2014-08-24T22:39:25Z", "updated_at": "2020-02-09T18:49:49Z", "due_on": null, "closed_at": "2020-02-09T18:49:49Z"}, "comments": 0, "created_at": "2019-03-29T15:57:21Z", "updated_at": "2020-11-13T15:43:48Z", "closed_at": "2019-03-30T13:10:48Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/pallets/werkzeug/pulls/1496", "html_url": "https://github.com/pallets/werkzeug/pull/1496", "diff_url": "https://github.com/pallets/werkzeug/pull/1496.diff", "patch_url": "https://github.com/pallets/werkzeug/pull/1496.patch", "merged_at": "2019-03-30T13:10:47Z"}, "body": "fix #1495", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1496/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1496/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1495", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1495/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1495/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1495/events", "html_url": "https://github.com/pallets/werkzeug/issues/1495", "id": 426911033, "node_id": "MDU6SXNzdWU0MjY5MTEwMzM=", "number": 1495, "title": "Cookies with certain keys are ignored", "user": {"login": "forrestchang", "id": 7857126, "node_id": "MDQ6VXNlcjc4NTcxMjY=", "avatar_url": "https://avatars.githubusercontent.com/u/7857126?v=4", "gravatar_id": "", "url": "https://api.github.com/users/forrestchang", "html_url": "https://github.com/forrestchang", "followers_url": "https://api.github.com/users/forrestchang/followers", "following_url": "https://api.github.com/users/forrestchang/following{/other_user}", "gists_url": "https://api.github.com/users/forrestchang/gists{/gist_id}", "starred_url": "https://api.github.com/users/forrestchang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/forrestchang/subscriptions", "organizations_url": "https://api.github.com/users/forrestchang/orgs", "repos_url": "https://api.github.com/users/forrestchang/repos", "events_url": "https://api.github.com/users/forrestchang/events{/privacy}", "received_events_url": "https://api.github.com/users/forrestchang/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/1", "html_url": "https://github.com/pallets/werkzeug/milestone/1", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/1/labels", "id": 764000, "node_id": "MDk6TWlsZXN0b25lNzY0MDAw", "number": 1, "title": "1.0.0", "description": "", "creator": {"login": "untitaker", "id": 837573, "node_id": "MDQ6VXNlcjgzNzU3Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/837573?v=4", "gravatar_id": "", "url": "https://api.github.com/users/untitaker", "html_url": "https://github.com/untitaker", "followers_url": "https://api.github.com/users/untitaker/followers", "following_url": "https://api.github.com/users/untitaker/following{/other_user}", "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}", "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions", "organizations_url": "https://api.github.com/users/untitaker/orgs", "repos_url": "https://api.github.com/users/untitaker/repos", "events_url": "https://api.github.com/users/untitaker/events{/privacy}", "received_events_url": "https://api.github.com/users/untitaker/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 78, "state": "closed", "created_at": "2014-08-24T22:39:25Z", "updated_at": "2020-02-09T18:49:49Z", "due_on": null, "closed_at": "2020-02-09T18:49:49Z"}, "comments": 6, "created_at": "2019-03-29T10:09:56Z", "updated_at": "2020-11-13T15:26:04Z", "closed_at": "2019-03-30T13:10:48Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "I have a cookie called `version=xxx` in Headers, but it ignored by flask, using `request.cookies.get('version')` can't get the cookie.\r\n\r\nI check the code then found these:\r\n\r\n```python\r\n# _internal.py\r\n\r\n_cookie_params = {\r\n    b\"expires\",\r\n    b\"path\",\r\n    b\"comment\",\r\n    b\"max-age\",\r\n    b\"secure\",\r\n    b\"httponly\",\r\n    b\"version\",\r\n}\r\n\r\n# Ignore parameters.  We have no interest in them.\r\nif key.lower() not in _cookie_params:\r\n    yield _cookie_unquote(key), _cookie_unquote(value)\r\n```\r\n\r\nI don't know the comment *\"We have no interest in them\"* mean. Is there anyone can explain that for me?  I will be appreciate for that.", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1495/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1495/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1494", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1494/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1494/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1494/events", "html_url": "https://github.com/pallets/werkzeug/pull/1494", "id": 426593590, "node_id": "MDExOlB1bGxSZXF1ZXN0MjY1NDEyMTcy", "number": 1494, "title": "test client removes cookie header when cookie jar is empty", "user": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/6", "html_url": "https://github.com/pallets/werkzeug/milestone/6", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/6/labels", "id": 4164013, "node_id": "MDk6TWlsZXN0b25lNDE2NDAxMw==", "number": 6, "title": "0.15.2", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 9, "state": "closed", "created_at": "2019-03-22T14:27:41Z", "updated_at": "2019-04-02T17:20:50Z", "due_on": null, "closed_at": "2019-04-02T17:20:50Z"}, "comments": 2, "created_at": "2019-03-28T16:34:20Z", "updated_at": "2020-11-13T15:43:48Z", "closed_at": "2019-03-28T18:28:30Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/pallets/werkzeug/pulls/1494", "html_url": "https://github.com/pallets/werkzeug/pull/1494", "diff_url": "https://github.com/pallets/werkzeug/pull/1494.diff", "patch_url": "https://github.com/pallets/werkzeug/pull/1494.patch", "merged_at": "2019-03-28T18:28:30Z"}, "body": "closes #1491 \r\n\r\nIn #1402, the test client was changed to copy the original request for redirects, to preserve headers and other request information like browsers do. This had the side effect of also preserving the original cookie header, rather than whatever was in the client's jar after the response. Now, if the client's jar is empty, the environ's cookie header is removed.\r\n\r\nThe only downside of this is that if someone was passing the cookie manually with `client.get(\"/\", headers={\"COOKIE\": \"key=value;\"})`, this will no longer work because the client doesn't know about that cookie. Instead, they should have used the client's `set_cookie` method before making the request: `client.set_cookie(\"localhost\", \"key\", \"value\"); client.get(\"/\")`.", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1494/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1494/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1491", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1491/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1491/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1491/events", "html_url": "https://github.com/pallets/werkzeug/issues/1491", "id": 425838779, "node_id": "MDU6SXNzdWU0MjU4Mzg3Nzk=", "number": 1491, "title": "Cookie changes are not persisted when test client follows redirects", "user": {"login": "javivdm", "id": 31928386, "node_id": "MDQ6VXNlcjMxOTI4Mzg2", "avatar_url": "https://avatars.githubusercontent.com/u/31928386?v=4", "gravatar_id": "", "url": "https://api.github.com/users/javivdm", "html_url": "https://github.com/javivdm", "followers_url": "https://api.github.com/users/javivdm/followers", "following_url": "https://api.github.com/users/javivdm/following{/other_user}", "gists_url": "https://api.github.com/users/javivdm/gists{/gist_id}", "starred_url": "https://api.github.com/users/javivdm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/javivdm/subscriptions", "organizations_url": "https://api.github.com/users/javivdm/orgs", "repos_url": "https://api.github.com/users/javivdm/repos", "events_url": "https://api.github.com/users/javivdm/events{/privacy}", "received_events_url": "https://api.github.com/users/javivdm/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/6", "html_url": "https://github.com/pallets/werkzeug/milestone/6", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/6/labels", "id": 4164013, "node_id": "MDk6TWlsZXN0b25lNDE2NDAxMw==", "number": 6, "title": "0.15.2", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 9, "state": "closed", "created_at": "2019-03-22T14:27:41Z", "updated_at": "2019-04-02T17:20:50Z", "due_on": null, "closed_at": "2019-04-02T17:20:50Z"}, "comments": 3, "created_at": "2019-03-27T09:06:58Z", "updated_at": "2020-11-13T15:26:05Z", "closed_at": "2019-03-28T18:28:52Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "I have a pytest test from a flask application that looks like:\r\n```\r\ndef test_logout_redirect(client, login, credentials_admin):\r\n    with client as c:\r\n        login(c, credentials_admin)\r\n        r = c.get(url_for('main.logout'), follow_redirects=True)\r\n        assert r.status_code == 200\r\n        assert request.path == url_for('main.login')\r\n        assert b'Log In' in r.data\r\n```\r\n\r\nWhen the user logs out, the session is cleared and it redirects them to the login page. The log in route checks if the session has a user id, and if so it redirects them to the homepage.\r\n\r\nTherefore the test is trying to assert that the session is cleared after logging out and the user is redirected to the login page. This test was passing in 0.14.1.\r\n\r\nHowever after upgrading the test fails. It seems like the user ID is back in the session after it has been cleared and therefore the user ends up in the homepage.\r\n\r\nI am encountering this behaviour only when using the test client, which I am invoking with flask's app.test_client().", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1491/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1491/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1177", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1177/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1177/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1177/events", "html_url": "https://github.com/pallets/werkzeug/issues/1177", "id": 259414091, "node_id": "MDU6SXNzdWUyNTk0MTQwOTE=", "number": 1177, "title": "Parsing request bodies containing file uploads with a filename containing two single quotes fails", "user": {"login": "ThiefMaster", "id": 179599, "node_id": "MDQ6VXNlcjE3OTU5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/179599?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ThiefMaster", "html_url": "https://github.com/ThiefMaster", "followers_url": "https://api.github.com/users/ThiefMaster/followers", "following_url": "https://api.github.com/users/ThiefMaster/following{/other_user}", "gists_url": "https://api.github.com/users/ThiefMaster/gists{/gist_id}", "starred_url": "https://api.github.com/users/ThiefMaster/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ThiefMaster/subscriptions", "organizations_url": "https://api.github.com/users/ThiefMaster/orgs", "repos_url": "https://api.github.com/users/ThiefMaster/repos", "events_url": "https://api.github.com/users/ThiefMaster/events{/privacy}", "received_events_url": "https://api.github.com/users/ThiefMaster/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-09-21T08:22:56Z", "updated_at": "2020-11-13T16:38:42Z", "closed_at": "2017-12-05T15:54:01Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "body": "I can reproduce this in Flask but I'm pretty sure this is a bug in Werkzeug.\r\n\r\n\r\n```\r\nIn [6]: app = Flask(__name__)\r\n   ...: @app.route('/upload', methods=('POST',))\r\n   ...: def upload():\r\n   ...:     print request.form\r\n   ...:     print request.files\r\n   ...:     return 'blah'\r\n   ...: app.run(port=31337)\r\n```\r\n\r\n    http -f post http://127.0.0.1:31337/upload \"file@/tmp/t'es't.txt\"\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/home/adrian/dev/indico/env/lib/python2.7/site-packages/flask/app.py\", line 1982, in wsgi_app\r\n    response = self.full_dispatch_request()\r\n  File \"/home/adrian/dev/indico/env/lib/python2.7/site-packages/flask/app.py\", line 1614, in full_dispatch_request\r\n    rv = self.handle_user_exception(e)\r\n  File \"/home/adrian/dev/indico/env/lib/python2.7/site-packages/flask/app.py\", line 1517, in handle_user_exception\r\n    reraise(exc_type, exc_value, tb)\r\n  File \"/home/adrian/dev/indico/env/lib/python2.7/site-packages/flask/app.py\", line 1612, in full_dispatch_request\r\n    rv = self.dispatch_request()\r\n  File \"/home/adrian/dev/indico/env/lib/python2.7/site-packages/flask/app.py\", line 1598, in dispatch_request\r\n    return self.view_functions[rule.endpoint](**req.view_args)\r\n  File \"<ipython-input-6-c04743f50a59>\", line 4, in upload\r\n    print request.form\r\n  File \"/home/adrian/dev/indico/env/lib/python2.7/site-packages/werkzeug/local.py\", line 347, in __getattr__\r\n    return getattr(self._get_current_object(), name)\r\n  File \"/home/adrian/dev/indico/env/lib/python2.7/site-packages/werkzeug/utils.py\", line 73, in __get__\r\n    value = self.func(obj)\r\n  File \"/home/adrian/dev/indico/env/lib/python2.7/site-packages/werkzeug/wrappers.py\", line 523, in form\r\n    self._load_form_data()\r\n  File \"/home/adrian/dev/indico/env/lib/python2.7/site-packages/flask/wrappers.py\", line 185, in _load_form_data\r\n    RequestBase._load_form_data(self)\r\n  File \"/home/adrian/dev/indico/env/lib/python2.7/site-packages/werkzeug/wrappers.py\", line 371, in _load_form_data\r\n    mimetype, content_length, options)\r\n  File \"/home/adrian/dev/indico/env/lib/python2.7/site-packages/werkzeug/formparser.py\", line 195, in parse\r\n    content_length, options)\r\n  File \"/home/adrian/dev/indico/env/lib/python2.7/site-packages/werkzeug/formparser.py\", line 100, in wrapper\r\n    return f(self, stream, *args, **kwargs)\r\n  File \"/home/adrian/dev/indico/env/lib/python2.7/site-packages/werkzeug/formparser.py\", line 212, in _parse_multipart\r\n    form, files = parser.parse(stream, boundary, content_length)\r\n  File \"/home/adrian/dev/indico/env/lib/python2.7/site-packages/werkzeug/formparser.py\", line 519, in parse\r\n    return self.cls(form), self.cls(files)\r\n  File \"/home/adrian/dev/indico/env/lib/python2.7/site-packages/werkzeug/datastructures.py\", line 406, in __init__\r\n    for key, value in mapping or ():\r\n  File \"/home/adrian/dev/indico/env/lib/python2.7/site-packages/werkzeug/formparser.py\", line 517, in <genexpr>\r\n    form = (p[1] for p in formstream if p[0] == 'form')\r\n  File \"/home/adrian/dev/indico/env/lib/python2.7/site-packages/werkzeug/formparser.py\", line 476, in parse_parts\r\n    for ellt, ell in self.parse_lines(file, boundary, content_length):\r\n  File \"/home/adrian/dev/indico/env/lib/python2.7/site-packages/werkzeug/formparser.py\", line 403, in parse_lines\r\n    disposition, extra = parse_options_header(disposition)\r\n  File \"/home/adrian/dev/indico/env/lib/python2.7/site-packages/werkzeug/http.py\", line 368, in parse_options_header\r\n    option_value = _unquote(option_value).decode(encoding)\r\nLookupError: unknown encoding: \"t\r\n```\r\n\r\nInstalled versions: Flask==0.12.2, Werkzeug==0.12.2", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1177/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1177/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1149", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1149/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1149/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1149/events", "html_url": "https://github.com/pallets/werkzeug/issues/1149", "id": 243267738, "node_id": "MDU6SXNzdWUyNDMyNjc3Mzg=", "number": 1149, "title": "Chunked requests still don't really work", "user": {"login": "sorenisanerd", "id": 160090, "node_id": "MDQ6VXNlcjE2MDA5MA==", "avatar_url": "https://avatars.githubusercontent.com/u/160090?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sorenisanerd", "html_url": "https://github.com/sorenisanerd", "followers_url": "https://api.github.com/users/sorenisanerd/followers", "following_url": "https://api.github.com/users/sorenisanerd/following{/other_user}", "gists_url": "https://api.github.com/users/sorenisanerd/gists{/gist_id}", "starred_url": "https://api.github.com/users/sorenisanerd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sorenisanerd/subscriptions", "organizations_url": "https://api.github.com/users/sorenisanerd/orgs", "repos_url": "https://api.github.com/users/sorenisanerd/repos", "events_url": "https://api.github.com/users/sorenisanerd/events{/privacy}", "received_events_url": "https://api.github.com/users/sorenisanerd/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2017-07-16T21:29:42Z", "updated_at": "2020-11-13T16:38:42Z", "closed_at": "2017-11-28T23:41:34Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "(Updated, because I realised I had been attempting to fix this, so got confused by the original issue and the issue that made me give up)\r\n\r\nI'm making a chunked request to an app that uses Werkzeug (current git master). get_input_stream ends up calling `LimitedStream(wsgi.input, min(content_length, max_content_length))`. `min(content_length, max_content_length)` will always be None if using chunked encoding.\r\n\r\nIn an attempt to make progress I tried using `LimitedStream(stream, content_length or max_content_length)`, but then I end up getting a `ClientDisconnected` exception, because we can't tell the difference between a client disconnecting and the chunked request simply being done, as `wsgi.input.read()` just returns a 0-length string in both cases.", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1149/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1149/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1140", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1140/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1140/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1140/events", "html_url": "https://github.com/pallets/werkzeug/issues/1140", "id": 238282321, "node_id": "MDU6SXNzdWUyMzgyODIzMjE=", "number": 1140, "title": "Werkzeug fails silently when it does not have permission to SSL cert/key files", "user": {"login": "pilliq", "id": 484926, "node_id": "MDQ6VXNlcjQ4NDkyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/484926?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pilliq", "html_url": "https://github.com/pilliq", "followers_url": "https://api.github.com/users/pilliq/followers", "following_url": "https://api.github.com/users/pilliq/following{/other_user}", "gists_url": "https://api.github.com/users/pilliq/gists{/gist_id}", "starred_url": "https://api.github.com/users/pilliq/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pilliq/subscriptions", "organizations_url": "https://api.github.com/users/pilliq/orgs", "repos_url": "https://api.github.com/users/pilliq/repos", "events_url": "https://api.github.com/users/pilliq/events{/privacy}", "received_events_url": "https://api.github.com/users/pilliq/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2017-06-24T00:44:45Z", "updated_at": "2020-11-13T15:43:25Z", "closed_at": "2018-11-12T19:10:24Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "Running Flask with an SSL context that uses cert files which the process does not have permission to results in a silent fail on the server.\r\n\r\nAllowing the process to have access to the files fixes this problem.\r\n\r\nServer code used:\r\n```python\r\nfrom flask import Flask\r\n\r\napp = Flask(__name__)\r\n\r\n@app.route('/')\r\ndef hello:\r\n    return 'hi'\r\n\r\nif __name__ == '__main__':\r\n    context = ('/path/to/cert.pem','/path/to/key.pem')\r\n    app.run(debug=True, ssl_context=context)\r\n```\r\n\r\n### Expected Behavior\r\nA stack saying the process cannot access the cert files. Ideally this trace would appear during startup before the first request is made.\r\n\r\nFor example, when using pyopenssl with the same files, the following trace is thrown on startup:\r\n\r\n```pytb\r\nTraceback (most recent call last):\r\n  File \"server.py\", line 20, in <module>\r\n    context.use_privatekey_file('/path/to/private/key.pem')\r\n  File \"/home/user/.virtualenvs/dev/local/lib/python2.7/site-packages/OpenSSL/SSL.py\", line 798, in use_privatekey_file\r\n    self._raise_passphrase_exception()\r\n  File \"/home/user/.virtualenvs/dev/local/lib/python2.7/site-packages/OpenSSL/SSL.py\", line 777, in _raise_passphrase_exception\r\n    _raise_current_error()\r\n  File \"/home/user/.virtualenvs/dev/local/lib/python2.7/site-packages/OpenSSL/_util.py\", line 54, in exception_from_error_queue\r\n    raise exception_type(errors)\r\nOpenSSL.SSL.Error: [('system library', 'fopen', 'Permission denied'), ('BIO routines', 'FILE_CTRL', 'system lib'), ('SSL routines', 'SSL_CTX_use_PrivateKey_file', 'system lib')]\r\n```\r\n\r\n### Actual Behavior\r\n\r\nAfter a request, the server returns a 200 response and disconnects the socket:\r\n\r\n- `curl` clients receive a 200 and then throw errno 35 (Unknown SSL protocol error in connection to [secure site]:443).\r\n\r\n- `nc` clients return a 200 and immediately disconnect.\r\n\r\n- Web browsers report the following error:\r\n<img width=\"645\" alt=\"screenshot 2017-06-24 09 53 44\" src=\"https://user-images.githubusercontent.com/484926/27503820-94e6307c-58c3-11e7-8532-ebf58700fce1.png\">\r\n\r\n\r\nWhat makes this problem worse is that Flask does not acknowledge that an attempted connection was made. Throughout all three of the above requests this is all that Flask printed in debug mode:\r\n\r\n```\r\n * Running on https://0.0.0.0:5000/ (Press CTRL+C to quit)\r\n * Restarting with stat\r\n * Debugger is active!\r\n * Debugger pin code: 000-000-000\r\n```\r\n\r\n### Environment\r\n\r\n* Python version: 2.7.6\r\n* Flask version: 0.12.2 (also tested on 0.10.1)\r\n* Werkzeug version: 0.12.2 (also tested on 0.11.5)\r\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1140/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1140/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1127", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1127/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1127/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1127/events", "html_url": "https://github.com/pallets/werkzeug/issues/1127", "id": 232087917, "node_id": "MDU6SXNzdWUyMzIwODc5MTc=", "number": 1127, "title": "When WSGIRequestHandler catches socket.error it silences all other OSErrors in Python 3", "user": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/4", "html_url": "https://github.com/pallets/werkzeug/milestone/4", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/4/labels", "id": 3010850, "node_id": "MDk6TWlsZXN0b25lMzAxMDg1MA==", "number": 4, "title": "0.15", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 125, "state": "closed", "created_at": "2018-01-03T17:06:24Z", "updated_at": "2019-03-19T15:15:44Z", "due_on": null, "closed_at": "2019-03-19T15:15:44Z"}, "comments": 11, "created_at": "2017-05-29T19:49:07Z", "updated_at": "2020-11-13T15:43:26Z", "closed_at": "2018-12-10T01:06:19Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "body": "Reported at pallets/flask#1995. `WSGIRequestHander.run_wsgi` catches `socket.error` to silence client disconnects. In Python 2 this was fine, because `socket.error` was unique. In Python 3, `socket.error is OSError`, so any `OSError` or subclass (`IOError`, etc.) is also silenced.\r\n\r\nPossible solution is to check if `e.errno` is a disconnect-related error and bubble the error up otherwise. Or catch a more specific error such as [`ConnectionError`](https://docs.python.org/3/library/exceptions.html#ConnectionError) in Python 3.\r\n\r\nThis only affects Werkzeug's dev server, other WSGI servers like Gunicorn do not exhibit this behavior.", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1127/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1127/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1080", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1080/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1080/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1080/events", "html_url": "https://github.com/pallets/werkzeug/issues/1080", "id": 213440354, "node_id": "MDU6SXNzdWUyMTM0NDAzNTQ=", "number": 1080, "title": "Werkzeug incorrectly handles multiline headers", "user": {"login": "ngaya-ll", "id": 11203134, "node_id": "MDQ6VXNlcjExMjAzMTM0", "avatar_url": "https://avatars.githubusercontent.com/u/11203134?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ngaya-ll", "html_url": "https://github.com/ngaya-ll", "followers_url": "https://api.github.com/users/ngaya-ll/followers", "following_url": "https://api.github.com/users/ngaya-ll/following{/other_user}", "gists_url": "https://api.github.com/users/ngaya-ll/gists{/gist_id}", "starred_url": "https://api.github.com/users/ngaya-ll/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ngaya-ll/subscriptions", "organizations_url": "https://api.github.com/users/ngaya-ll/orgs", "repos_url": "https://api.github.com/users/ngaya-ll/repos", "events_url": "https://api.github.com/users/ngaya-ll/events{/privacy}", "received_events_url": "https://api.github.com/users/ngaya-ll/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}, {"id": 796989910, "node_id": "MDU6TGFiZWw3OTY5ODk5MTA=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/server", "name": "server", "color": "5319e7", "default": false, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2017-03-10T20:11:48Z", "updated_at": "2020-11-13T15:13:08Z", "closed_at": "2019-05-07T11:44:01Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "According to [RFC 2616](https://www.w3.org/Protocols/rfc2616/rfc2616-sec2.html):\r\n\r\n> HTTP/1.1 header field values can be folded onto multiple lines if the continuation line begins with a space or horizontal tab. All linear white space, including folding, has the same semantics as SP. A recipient MAY replace any linear white space with a single SP before interpreting the field value or forwarding the message downstream.\r\n\r\nHowever, werkzeug does not accept header values with newlines, even if they abide by this convention.\r\n\r\n```\r\n>>> import werkzeug\r\n>>> werkzeug.Headers().add('foo', 'bar\\n baz')\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \".../venv/local/lib/python2.7/site-packages/werkzeug/datastructures.py\", line 1136, in add\r\n    self._validate_value(_value)\r\n  File \".../venv/local/lib/python2.7/site-packages/werkzeug/datastructures.py\", line 1143, in _validate_value\r\n    raise ValueError('Detected newline in header value.  This is '\r\nValueError: Detected newline in header value.  This is a potential security problem\r\n```\r\n\r\nAlso, this restriction is applied inconsistently.\r\n```\r\n>>> werkzeug.Headers([('foo', 'bar\\n baz')])\r\nHeaders([('foo', 'bar\\n baz')])\r\n```\r\n\r\nI ran into this issue when trying to write test cases relating to nginx forwarding of client certificates via headers, so there is a real use case for supporting this properly.", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1080/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1080/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1031", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1031/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1031/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1031/events", "html_url": "https://github.com/pallets/werkzeug/issues/1031", "id": 187641703, "node_id": "MDU6SXNzdWUxODc2NDE3MDM=", "number": 1031, "title": "HTML text can vanish in the Werkzeug interactive debugger", "user": {"login": "alexwlchan", "id": 301220, "node_id": "MDQ6VXNlcjMwMTIyMA==", "avatar_url": "https://avatars.githubusercontent.com/u/301220?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexwlchan", "html_url": "https://github.com/alexwlchan", "followers_url": "https://api.github.com/users/alexwlchan/followers", "following_url": "https://api.github.com/users/alexwlchan/following{/other_user}", "gists_url": "https://api.github.com/users/alexwlchan/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexwlchan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexwlchan/subscriptions", "organizations_url": "https://api.github.com/users/alexwlchan/orgs", "repos_url": "https://api.github.com/users/alexwlchan/repos", "events_url": "https://api.github.com/users/alexwlchan/events{/privacy}", "received_events_url": "https://api.github.com/users/alexwlchan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2016-11-07T07:23:07Z", "updated_at": "2020-11-13T16:46:44Z", "closed_at": "2016-11-11T13:52:57Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "(I feel like I might have raised this bug before, but I can\u2019t find it if I have.)\r\n\r\nIf you\u2019re using the interactive debugger and you type a command includes something that looks like an HTML tag, it gets treated as literal HTML text. This causes it to disappear once you\u2019ve finished the command, which makes for an inconsistent history.\r\n\r\nHere\u2019s a simple repro:\r\n\r\n![screen shot 2016-11-07 at 07 25 38](https://cloud.githubusercontent.com/assets/301220/20049525/6b86fc32-a4bb-11e6-984b-c713b4796d08.png)\r\n\r\nThe HTML tag should continue to be visible after executing your command.\r\n\r\nPython/Werkzeug versions, although I know I\u2019ve seen this on older versions too:\r\n\r\n```console\r\n$ python --version\r\nPython 3.5.0\r\n\r\n$ pip freeze | grep Werkzeug\r\nWerkzeug==0.11.10\r\n```", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1031/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1031/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1012", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1012/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1012/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1012/events", "html_url": "https://github.com/pallets/werkzeug/issues/1012", "id": 180064535, "node_id": "MDU6SXNzdWUxODAwNjQ1MzU=", "number": 1012, "title": "IPython 5.0: DeprecationWarning for 'global_ns' keyword argument", "user": {"login": "sansculotte", "id": 1516240, "node_id": "MDQ6VXNlcjE1MTYyNDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1516240?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sansculotte", "html_url": "https://github.com/sansculotte", "followers_url": "https://api.github.com/users/sansculotte/followers", "following_url": "https://api.github.com/users/sansculotte/following{/other_user}", "gists_url": "https://api.github.com/users/sansculotte/gists{/gist_id}", "starred_url": "https://api.github.com/users/sansculotte/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sansculotte/subscriptions", "organizations_url": "https://api.github.com/users/sansculotte/orgs", "repos_url": "https://api.github.com/users/sansculotte/repos", "events_url": "https://api.github.com/users/sansculotte/events{/privacy}", "received_events_url": "https://api.github.com/users/sansculotte/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2016-09-29T14:27:01Z", "updated_at": "2020-11-13T16:46:43Z", "closed_at": "2016-11-15T10:51:00Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "Says it's a Warning but it's actually fatal, with the shell not starting at all.\n\nDeprecationWarning: 'global_ns' keyword argument is deprecated, and has been removed in IPython 5.0 use `module` keyword argument instead.\n\n```\nvenv/local/lib/python2.7/site-packages/werkzeug/script.pyc in action(ipython)\n    275                 pass\n    276             else:\n--> 277                 sh(global_ns={}, local_ns=namespace)\n    278                 return\n    279         from code import interact\n\nvenv/local/lib/python2.7/site-packages/IPython/terminal/embed.pyc in __call__(self, header, local_ns, module, dummy, stack_depth, global_ns, compile_flags)\n    159         # our call and get the original caller's namespaces.\n    160         self.mainloop(local_ns, module, stack_depth=stack_depth,\n--> 161                       global_ns=global_ns, compile_flags=compile_flags)\n    162 \n    163         self.banner2 = self.old_banner2\n\n```\n\n```\n$ ipython --version\n5.1.0\n```\n\n```\n$ pip show werkzeug  # irrelevant output reducted\n\n---\n...\nVersion: 0.11.11\n...\n```\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1012/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1012/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1001", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/1001/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/1001/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/1001/events", "html_url": "https://github.com/pallets/werkzeug/pull/1001", "id": 174217651, "node_id": "MDExOlB1bGxSZXF1ZXN0ODM0MTE0NzY=", "number": 1001, "title": "Fix XSS in debugger", "user": {"login": "neargle", "id": 7868679, "node_id": "MDQ6VXNlcjc4Njg2Nzk=", "avatar_url": "https://avatars.githubusercontent.com/u/7868679?v=4", "gravatar_id": "", "url": "https://api.github.com/users/neargle", "html_url": "https://github.com/neargle", "followers_url": "https://api.github.com/users/neargle/followers", "following_url": "https://api.github.com/users/neargle/following{/other_user}", "gists_url": "https://api.github.com/users/neargle/gists{/gist_id}", "starred_url": "https://api.github.com/users/neargle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/neargle/subscriptions", "organizations_url": "https://api.github.com/users/neargle/orgs", "repos_url": "https://api.github.com/users/neargle/repos", "events_url": "https://api.github.com/users/neargle/events{/privacy}", "received_events_url": "https://api.github.com/users/neargle/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": {"login": "untitaker", "id": 837573, "node_id": "MDQ6VXNlcjgzNzU3Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/837573?v=4", "gravatar_id": "", "url": "https://api.github.com/users/untitaker", "html_url": "https://github.com/untitaker", "followers_url": "https://api.github.com/users/untitaker/followers", "following_url": "https://api.github.com/users/untitaker/following{/other_user}", "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}", "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions", "organizations_url": "https://api.github.com/users/untitaker/orgs", "repos_url": "https://api.github.com/users/untitaker/repos", "events_url": "https://api.github.com/users/untitaker/events{/privacy}", "received_events_url": "https://api.github.com/users/untitaker/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "untitaker", "id": 837573, "node_id": "MDQ6VXNlcjgzNzU3Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/837573?v=4", "gravatar_id": "", "url": "https://api.github.com/users/untitaker", "html_url": "https://github.com/untitaker", "followers_url": "https://api.github.com/users/untitaker/followers", "following_url": "https://api.github.com/users/untitaker/following{/other_user}", "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}", "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions", "organizations_url": "https://api.github.com/users/untitaker/orgs", "repos_url": "https://api.github.com/users/untitaker/repos", "events_url": "https://api.github.com/users/untitaker/events{/privacy}", "received_events_url": "https://api.github.com/users/untitaker/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2016-08-31T08:47:30Z", "updated_at": "2020-11-13T17:34:20Z", "closed_at": "2016-08-31T13:12:12Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/pallets/werkzeug/pulls/1001", "html_url": "https://github.com/pallets/werkzeug/pull/1001", "diff_url": "https://github.com/pallets/werkzeug/pull/1001.diff", "patch_url": "https://github.com/pallets/werkzeug/pull/1001.patch", "merged_at": null}, "body": "The `exc` and `plaintext_cs` variable, XSS has been the defense. But the `plaintext` didn't do that.\n\n``` python\ndef render_full(self, evalex=False, secret=None,\n                    evalex_trusted=True):\n        \"\"\"Render the Full HTML page with the traceback info.\"\"\"\n        exc = escape(self.exception) # the exception info use the escape method\n        return PAGE_HTML % {\n            'evalex':           evalex and 'true' or 'false',\n            'evalex_trusted':   evalex_trusted and 'true' or 'false',\n            'console':          'false',\n            'title':            exc,\n            'exception':        exc,\n            'exception_type':   escape(self.exception_type),\n            'summary':          self.render_summary(include_title=False),\n            'plaintext':        self.plaintext, # the plaintext did not use the escape method\n            'plaintext_cs':     re.sub('-{2,}', '-', self.plaintext),\n            'traceback_id':     self.id,\n            'secret':           secret\n        }\n```\n\nit make the debug page can be XSS.\n\nFor example:\n\n![](http://ww4.sinaimg.cn/large/005y7Ba5jw1f7d0wibpdsj30ur0b6diu.jpg)\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/1001/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/1001/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/979", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/979/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/979/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/979/events", "html_url": "https://github.com/pallets/werkzeug/issues/979", "id": 169729614, "node_id": "MDU6SXNzdWUxNjk3Mjk2MTQ=", "number": 979, "title": "Raise BadRequestKeyError in MultiDict.__getitem__ when internal list is empty", "user": {"login": "alexpantyukhin", "id": 6513121, "node_id": "MDQ6VXNlcjY1MTMxMjE=", "avatar_url": "https://avatars.githubusercontent.com/u/6513121?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexpantyukhin", "html_url": "https://github.com/alexpantyukhin", "followers_url": "https://api.github.com/users/alexpantyukhin/followers", "following_url": "https://api.github.com/users/alexpantyukhin/following{/other_user}", "gists_url": "https://api.github.com/users/alexpantyukhin/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexpantyukhin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexpantyukhin/subscriptions", "organizations_url": "https://api.github.com/users/alexpantyukhin/orgs", "repos_url": "https://api.github.com/users/alexpantyukhin/repos", "events_url": "https://api.github.com/users/alexpantyukhin/events{/privacy}", "received_events_url": "https://api.github.com/users/alexpantyukhin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2016-08-06T04:58:25Z", "updated_at": "2020-11-13T16:46:47Z", "closed_at": "2016-08-28T21:54:29Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "I think that it would be logically to raise BadRequestKeyError there https://github.com/pallets/werkzeug/blob/master/werkzeug/datastructures.py#L402 when the list of values is empty.\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/979/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/979/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/965", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/965/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/965/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/965/events", "html_url": "https://github.com/pallets/werkzeug/issues/965", "id": 167700967, "node_id": "MDU6SXNzdWUxNjc3MDA5Njc=", "number": 965, "title": "Travis doesn't test memcached cache backend", "user": {"login": "untitaker", "id": 837573, "node_id": "MDQ6VXNlcjgzNzU3Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/837573?v=4", "gravatar_id": "", "url": "https://api.github.com/users/untitaker", "html_url": "https://github.com/untitaker", "followers_url": "https://api.github.com/users/untitaker/followers", "following_url": "https://api.github.com/users/untitaker/following{/other_user}", "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}", "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions", "organizations_url": "https://api.github.com/users/untitaker/orgs", "repos_url": "https://api.github.com/users/untitaker/repos", "events_url": "https://api.github.com/users/untitaker/events{/privacy}", "received_events_url": "https://api.github.com/users/untitaker/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}, {"id": 123868812, "node_id": "MDU6TGFiZWwxMjM4Njg4MTI=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/infrastructure", "name": "infrastructure", "color": "006b75", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2016-07-26T20:16:07Z", "updated_at": "2020-11-13T16:46:50Z", "closed_at": "2016-07-26T21:18:14Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "body": "Because we use `py-normal` as toxenv variable, the version specific dependencies are not picked up. It should be `py33-normal` etc.\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/965/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/965/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/963", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/963/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/963/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/963/events", "html_url": "https://github.com/pallets/werkzeug/issues/963", "id": 167257339, "node_id": "MDU6SXNzdWUxNjcyNTczMzk=", "number": 963, "title": "Mindless action in MultiPartParser constructor", "user": {"login": "vit1251", "id": 110534, "node_id": "MDQ6VXNlcjExMDUzNA==", "avatar_url": "https://avatars.githubusercontent.com/u/110534?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vit1251", "html_url": "https://github.com/vit1251", "followers_url": "https://api.github.com/users/vit1251/followers", "following_url": "https://api.github.com/users/vit1251/following{/other_user}", "gists_url": "https://api.github.com/users/vit1251/gists{/gist_id}", "starred_url": "https://api.github.com/users/vit1251/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vit1251/subscriptions", "organizations_url": "https://api.github.com/users/vit1251/orgs", "repos_url": "https://api.github.com/users/vit1251/repos", "events_url": "https://api.github.com/users/vit1251/events{/privacy}", "received_events_url": "https://api.github.com/users/vit1251/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}, {"id": 123873888, "node_id": "MDU6TGFiZWwxMjM4NzM4ODg=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/good%20first%20issue", "name": "good first issue", "color": "fbca04", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2016-07-24T22:11:57Z", "updated_at": "2020-11-13T16:46:49Z", "closed_at": "2016-08-12T19:17:21Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "``` python\nclass MultiPartParser(object):\n    def __init__(self, ...):\n        self.stream_factory = stream_factory\n        ...\n        if stream_factory is None:\n            stream_factory = default_stream_factory\n```\n\nMost likely it occurred after refactoring.\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/963/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/963/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/953", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/953/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/953/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/953/events", "html_url": "https://github.com/pallets/werkzeug/issues/953", "id": 160961546, "node_id": "MDU6SXNzdWUxNjA5NjE1NDY=", "number": 953, "title": "SecureCookie with 'serialization_method = json' throws an exception on Python 3.4", "user": {"login": "tonyo", "id": 1120468, "node_id": "MDQ6VXNlcjExMjA0Njg=", "avatar_url": "https://avatars.githubusercontent.com/u/1120468?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tonyo", "html_url": "https://github.com/tonyo", "followers_url": "https://api.github.com/users/tonyo/followers", "following_url": "https://api.github.com/users/tonyo/following{/other_user}", "gists_url": "https://api.github.com/users/tonyo/gists{/gist_id}", "starred_url": "https://api.github.com/users/tonyo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tonyo/subscriptions", "organizations_url": "https://api.github.com/users/tonyo/orgs", "repos_url": "https://api.github.com/users/tonyo/repos", "events_url": "https://api.github.com/users/tonyo/events{/privacy}", "received_events_url": "https://api.github.com/users/tonyo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/4", "html_url": "https://github.com/pallets/werkzeug/milestone/4", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/4/labels", "id": 3010850, "node_id": "MDk6TWlsZXN0b25lMzAxMDg1MA==", "number": 4, "title": "0.15", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 125, "state": "closed", "created_at": "2018-01-03T17:06:24Z", "updated_at": "2019-03-19T15:15:44Z", "due_on": null, "closed_at": "2019-03-19T15:15:44Z"}, "comments": 6, "created_at": "2016-06-17T19:45:34Z", "updated_at": "2020-11-13T15:43:29Z", "closed_at": "2018-12-04T18:27:29Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "Python version: 3.4.3\nWerkzeug version: 0.11.10\n\nSimple snippet, taken from the example page (http://werkzeug.pocoo.org/docs/0.11/contrib/securecookie/#security):\n\n```\n#!/usr/bin/env python\n\nimport json\nfrom werkzeug.contrib.securecookie import SecureCookie\n\nclass JSONSecureCookie(SecureCookie):\n        serialization_method = json\n\nc = JSONSecureCookie({1: 2}, b\"key\")\nprint(c.serialize())\n```\n\n...returns an error:\n\n```\nTraceback (most recent call last):\n  File \"test_secure_cookie.py\", line 10, in <module>\n    print(c.serialize())\n  File \"/home/tonyo/reps/github/werkzeug/werkzeug/contrib/securecookie.py\", line 224, in serialize\n    self.quote(value).decode('ascii')\n  File \"/home/tonyo/reps/github/werkzeug/werkzeug/contrib/securecookie.py\", line 183, in quote\n    value = b''.join(base64.b64encode(value).splitlines()).strip()\n  File \"/home/tonyo/reps/github/werkzeug/env3/lib/python3.4/base64.py\", line 62, in b64encode\n    encoded = binascii.b2a_base64(s)[:-1]\nTypeError: 'str' does not support the buffer interface\n\n```\n\nLooking at `SecureCookie.quote()` (https://github.com/pallets/werkzeug/blob/5a2bf35441006d832ab1ed5a31963cbc366c99ac/werkzeug/contrib/securecookie.py#L174) we see, that json.dumps() returns a string object, while base64.b64encode() accepts a byte sequence.\n\nWhile this issue with encoding in `SecureCookie.quote()` is fixable by some variation of `value = value.encode('utf-8')`, the real problem in my opinion is unserializing (unquoting, to be more precise). In `SecureCookie.unquote()` `value` is first decoded via `value = base64.b64decode(value)`, and then passed to `cls.serialization_method.loads(value)` which in case of 'json' accepts string, not bytes. Therefore, we'll get something similar to:\n\n```\n>>> json.loads(b'')                                              \nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\n  File \"/usr/lib/python3.4/json/__init__.py\", line 312, in loads\n    s.__class__.__name__))\nTypeError: the JSON object must be str, not 'bytes'\n```\n\nAs a solution, if one wants to use 'json' as a serialization method, 'quote' and 'unquote' can be fully overridden:\n\n```\nclass JSONSecureCookie(SecureCookie):\n    serialization_method = json\n\n    @classmethod\n    def quote(cls, value):\n        if cls.serialization_method is not None:\n            value = cls.serialization_method.dumps(value)\n            ### Added line\n            value = value.encode('utf-8')\n        if cls.quote_base64:\n            value = b''.join(base64.b64encode(value).splitlines()).strip()\n        return value\n\n    @classmethod\n    def unquote(cls, value):\n        try:\n            if cls.quote_base64:\n                value = base64.b64decode(value)\n        ### Added line \n            value = str(value, 'utf-8')\n            if cls.serialization_method is not None:\n                value = cls.serialization_method.loads(value)\n            return value\n        except Exception:\n            raise UnquoteError()\n\n```\n\nHowever, this looks a bit ugly. \n\nIs there a way to fix this, so SecureCookie can simply work with 'json' as a serializer?\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/953/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/953/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/942", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/942/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/942/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/942/events", "html_url": "https://github.com/pallets/werkzeug/issues/942", "id": 157355927, "node_id": "MDU6SXNzdWUxNTczNTU5Mjc=", "number": 942, "title": "MultiDict.viewitems() is inconsistent with MultiDict.items()", "user": {"login": "JonathanRRogers", "id": 1103019, "node_id": "MDQ6VXNlcjExMDMwMTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1103019?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JonathanRRogers", "html_url": "https://github.com/JonathanRRogers", "followers_url": "https://api.github.com/users/JonathanRRogers/followers", "following_url": "https://api.github.com/users/JonathanRRogers/following{/other_user}", "gists_url": "https://api.github.com/users/JonathanRRogers/gists{/gist_id}", "starred_url": "https://api.github.com/users/JonathanRRogers/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JonathanRRogers/subscriptions", "organizations_url": "https://api.github.com/users/JonathanRRogers/orgs", "repos_url": "https://api.github.com/users/JonathanRRogers/repos", "events_url": "https://api.github.com/users/JonathanRRogers/events{/privacy}", "received_events_url": "https://api.github.com/users/JonathanRRogers/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2016-05-28T20:36:50Z", "updated_at": "2020-11-13T16:46:49Z", "closed_at": "2016-08-12T13:45:25Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "I'm using Python 2.7 and werkzeug 0.11.3.\n\nMultiDict.items() only returns the first value for each key by default. MultiDict.viewitems() always returns a list of the values for each key. It appears that there is no custom implementation of viewitems() so we're simply getting dict's implementation.\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/942/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/942/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/899", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/899/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/899/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/899/events", "html_url": "https://github.com/pallets/werkzeug/issues/899", "id": 148524664, "node_id": "MDU6SXNzdWUxNDg1MjQ2NjQ=", "number": 899, "title": "TypeError with werkzeug.debug.get_pin_and_cookie_name", "user": {"login": "jscholes", "id": 6454755, "node_id": "MDQ6VXNlcjY0NTQ3NTU=", "avatar_url": "https://avatars.githubusercontent.com/u/6454755?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jscholes", "html_url": "https://github.com/jscholes", "followers_url": "https://api.github.com/users/jscholes/followers", "following_url": "https://api.github.com/users/jscholes/following{/other_user}", "gists_url": "https://api.github.com/users/jscholes/gists{/gist_id}", "starred_url": "https://api.github.com/users/jscholes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jscholes/subscriptions", "organizations_url": "https://api.github.com/users/jscholes/orgs", "repos_url": "https://api.github.com/users/jscholes/repos", "events_url": "https://api.github.com/users/jscholes/events{/privacy}", "received_events_url": "https://api.github.com/users/jscholes/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2016-04-15T01:00:05Z", "updated_at": "2020-11-13T16:54:32Z", "closed_at": "2016-04-15T01:02:31Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "Python 3.4.3 (v3.4.3:9b73f1c3e601, Feb 24 2015, 22:43:06) [MSC v.1600 32 bit (Intel)] on win32/Windows 7\n\nWhen running the most basic of Flask apps with app.debug set to True, I see the following traceback and the app exits:\n\n```\nTraceback (most recent call last):\n  File \"test.py\", line 11, in <module>\n    app.run(debug=True)\n  File \"C:\\Users\\jscholes\\dev\\fileserve\\env\\lib\\site-packages\\flask\\app.py\", line 772, in run\n    run_simple(host, port, self, **options)\n  File \"C:\\Users\\jscholes\\dev\\fileserve\\env\\lib\\site-packages\\werkzeug-0.12.dev0-py3.4.egg\\werkzeug\\serving.py\", line 634, in run_simple\n    application = DebuggedApplication(application, use_evalex)\n  File \"C:\\Users\\jscholes\\dev\\fileserve\\env\\lib\\site-packages\\werkzeug-0.12.dev0-py3.4.egg\\werkzeug\\debug\\__init__.py\", line 249, in __init__\n    if self.pin is None:\n  File \"C:\\Users\\jscholes\\dev\\fileserve\\env\\lib\\site-packages\\werkzeug-0.12.dev0-py3.4.egg\\werkzeug\\debug\\__init__.py\", line 259, in _get_pin\n    self._pin, self._pin_cookie = get_pin_and_cookie_name(self.app)\n  File \"C:\\Users\\jscholes\\dev\\fileserve\\env\\lib\\site-packages\\werkzeug-0.12.dev0-py3.4.egg\\werkzeug\\debug\\__init__.py\", line 169, in get_pin_and_cookie_name\n    h.update('cookiesalt')\nTypeError: Unicode-objects must be encoded before hashing\n\n>>> import werkzeug\n>>> werkzeug.__version__\n'0.12-dev'\n>>> import flask\n>>> flask.__version__\n'0.10.1'\n```\n\nThe simple app:\n\n```\nfrom flask import Flask\napp = Flask(__name__)\n\n\n@app.route('/')\ndef index():\n    return 'Hello world'\n\n\nif __name__ == '__main__':\n    app.run(debug=True)\n```\n\nI can get around this issue by setting the WERKZEUG_DEBUG_PIN environment variable to \"off\", but I don't imagine this is very good practice for most projects.\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/899/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/899/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/897", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/897/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/897/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/897/events", "html_url": "https://github.com/pallets/werkzeug/pull/897", "id": 148408709, "node_id": "MDExOlB1bGxSZXF1ZXN0NjY1MTA1Nzc=", "number": 897, "title": "Update __init__.py", "user": {"login": "taogeT", "id": 6917395, "node_id": "MDQ6VXNlcjY5MTczOTU=", "avatar_url": "https://avatars.githubusercontent.com/u/6917395?v=4", "gravatar_id": "", "url": "https://api.github.com/users/taogeT", "html_url": "https://github.com/taogeT", "followers_url": "https://api.github.com/users/taogeT/followers", "following_url": "https://api.github.com/users/taogeT/following{/other_user}", "gists_url": "https://api.github.com/users/taogeT/gists{/gist_id}", "starred_url": "https://api.github.com/users/taogeT/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/taogeT/subscriptions", "organizations_url": "https://api.github.com/users/taogeT/orgs", "repos_url": "https://api.github.com/users/taogeT/repos", "events_url": "https://api.github.com/users/taogeT/events{/privacy}", "received_events_url": "https://api.github.com/users/taogeT/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": {"login": "mitsuhiko", "id": 7396, "node_id": "MDQ6VXNlcjczOTY=", "avatar_url": "https://avatars.githubusercontent.com/u/7396?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mitsuhiko", "html_url": "https://github.com/mitsuhiko", "followers_url": "https://api.github.com/users/mitsuhiko/followers", "following_url": "https://api.github.com/users/mitsuhiko/following{/other_user}", "gists_url": "https://api.github.com/users/mitsuhiko/gists{/gist_id}", "starred_url": "https://api.github.com/users/mitsuhiko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mitsuhiko/subscriptions", "organizations_url": "https://api.github.com/users/mitsuhiko/orgs", "repos_url": "https://api.github.com/users/mitsuhiko/repos", "events_url": "https://api.github.com/users/mitsuhiko/events{/privacy}", "received_events_url": "https://api.github.com/users/mitsuhiko/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "mitsuhiko", "id": 7396, "node_id": "MDQ6VXNlcjczOTY=", "avatar_url": "https://avatars.githubusercontent.com/u/7396?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mitsuhiko", "html_url": "https://github.com/mitsuhiko", "followers_url": "https://api.github.com/users/mitsuhiko/followers", "following_url": "https://api.github.com/users/mitsuhiko/following{/other_user}", "gists_url": "https://api.github.com/users/mitsuhiko/gists{/gist_id}", "starred_url": "https://api.github.com/users/mitsuhiko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mitsuhiko/subscriptions", "organizations_url": "https://api.github.com/users/mitsuhiko/orgs", "repos_url": "https://api.github.com/users/mitsuhiko/repos", "events_url": "https://api.github.com/users/mitsuhiko/events{/privacy}", "received_events_url": "https://api.github.com/users/mitsuhiko/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2016-04-14T16:04:06Z", "updated_at": "2020-11-13T17:43:51Z", "closed_at": "2016-04-14T17:30:12Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/pallets/werkzeug/pulls/897", "html_url": "https://github.com/pallets/werkzeug/pull/897", "diff_url": "https://github.com/pallets/werkzeug/pull/897.diff", "patch_url": "https://github.com/pallets/werkzeug/pull/897.patch", "merged_at": null}, "body": "fixed hashlib.md5.update str bugs when start debug mode.\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/897/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/897/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/876", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/876/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/876/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/876/events", "html_url": "https://github.com/pallets/werkzeug/issues/876", "id": 139212184, "node_id": "MDU6SXNzdWUxMzkyMTIxODQ=", "number": 876, "title": "Non-empty CombinedMultiDict yields {} in dict(_) and json.dumps(_)", "user": {"login": "szym", "id": 222727, "node_id": "MDQ6VXNlcjIyMjcyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/222727?v=4", "gravatar_id": "", "url": "https://api.github.com/users/szym", "html_url": "https://github.com/szym", "followers_url": "https://api.github.com/users/szym/followers", "following_url": "https://api.github.com/users/szym/following{/other_user}", "gists_url": "https://api.github.com/users/szym/gists{/gist_id}", "starred_url": "https://api.github.com/users/szym/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/szym/subscriptions", "organizations_url": "https://api.github.com/users/szym/orgs", "repos_url": "https://api.github.com/users/szym/repos", "events_url": "https://api.github.com/users/szym/events{/privacy}", "received_events_url": "https://api.github.com/users/szym/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2016-03-08T08:32:10Z", "updated_at": "2020-11-13T15:43:24Z", "closed_at": "2018-12-10T14:58:43Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "``` python\na = MultiDict([('a', 'b'), ('a', 'c')])\nb = CombinedMultiDict([a])\nprint(dict(b))\n> {}\n# Expected same as print(dict(a)) == {'a': ['b', 'c']}\nprint(json.dumps(b))\n# Expected same as json.dumps(a) == '{\"a\": \"b\"}'\n> '{}'\n```\n\nHappens in python 2.7 and 3.4 with werkzeug 0.11.4\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/876/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/876/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/875", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/875/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/875/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/875/events", "html_url": "https://github.com/pallets/werkzeug/issues/875", "id": 138188936, "node_id": "MDU6SXNzdWUxMzgxODg5MzY=", "number": 875, "title": "werkzeug.formparser is really slow with large binary uploads", "user": {"login": "sekrause", "id": 595780, "node_id": "MDQ6VXNlcjU5NTc4MA==", "avatar_url": "https://avatars.githubusercontent.com/u/595780?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sekrause", "html_url": "https://github.com/sekrause", "followers_url": "https://api.github.com/users/sekrause/followers", "following_url": "https://api.github.com/users/sekrause/following{/other_user}", "gists_url": "https://api.github.com/users/sekrause/gists{/gist_id}", "starred_url": "https://api.github.com/users/sekrause/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sekrause/subscriptions", "organizations_url": "https://api.github.com/users/sekrause/orgs", "repos_url": "https://api.github.com/users/sekrause/repos", "events_url": "https://api.github.com/users/sekrause/events{/privacy}", "received_events_url": "https://api.github.com/users/sekrause/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/14", "html_url": "https://github.com/pallets/werkzeug/milestone/14", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/14/labels", "id": 5085882, "node_id": "MDk6TWlsZXN0b25lNTA4NTg4Mg==", "number": 14, "title": "2.0.0", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 132, "state": "closed", "created_at": "2020-02-09T21:53:29Z", "updated_at": "2021-05-11T20:31:10Z", "due_on": null, "closed_at": "2021-05-11T20:31:10Z"}, "comments": 33, "created_at": "2016-03-03T14:14:11Z", "updated_at": "2021-02-15T00:52:27Z", "closed_at": "2021-01-31T17:34:42Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "When I perform a `multipart/form-data` upload of any large binary file in Flask, those uploads are very easily CPU bound (with Python consuming 100% CPU) instead of I/O bound on any reasonably fast network connection.\n\nA little bit of CPU profiling reveals that almost all CPU time during these uploads is spent in `werkzeug.formparser.MultiPartParser.parse_parts()`. The reason this that the method `parse_lines()` yields _a lot_ of very small chunks, sometimes [even just single bytes](https://github.com/mitsuhiko/werkzeug/blob/master/werkzeug/formparser.py#L439):\n\n``` python\n# we have something in the buffer from the last iteration.\n# this is usually a newline delimiter.\nif buf:\n    yield _cont, buf\n    buf = b''\n```\n\nSo `parse_parts()` goes through a lot of small iterations (more than 2 million for a 100 MB file) processing single \"lines\", always writing just very short chunks or even single bytes into the output stream. This adds a lot of overhead slowing down those whole process and making it CPU bound very quickly.\n\nA quick test shows that a speed-up is very easily possible by first collecting the data in a `bytearray` in `parse_lines()` and only yielding that data back into `parse_parts()` when `self.buffer_size` is exceeded. Something like this:\n\n``` python\nbuf = b''\ncollect = bytearray()\nfor line in iterator:\n    if not line:\n        self.fail('unexpected end of stream')\n\n    if line[:2] == b'--':\n        terminator = line.rstrip()\n        if terminator in (next_part, last_part):\n            # yield remaining collected data\n            if collect:\n                yield _cont, collect\n            break\n\n    if transfer_encoding is not None:\n        if transfer_encoding == 'base64':\n            transfer_encoding = 'base64_codec'\n        try:\n            line = codecs.decode(line, transfer_encoding)\n        except Exception:\n            self.fail('could not decode transfer encoded chunk')\n\n    # we have something in the buffer from the last iteration.\n    # this is usually a newline delimiter.\n    if buf:\n        collect += buf\n        buf = b''\n\n    # If the line ends with windows CRLF we write everything except\n    # the last two bytes.  In all other cases however we write\n    # everything except the last byte.  If it was a newline, that's\n    # fine, otherwise it does not matter because we will write it\n    # the next iteration.  this ensures we do not write the\n    # final newline into the stream.  That way we do not have to\n    # truncate the stream.  However we do have to make sure that\n    # if something else than a newline is in there we write it\n    # out.\n    if line[-2:] == b'\\r\\n':\n        buf = b'\\r\\n'\n        cutoff = -2\n    else:\n        buf = line[-1:]\n        cutoff = -1\n\n    collect += line[:cutoff]\n\n    if len(collect) >= self.buffer_size:\n        yield _cont, collect\n        collect.clear()\n```\n\nThis change alone reduces the upload time for my 34 MB test file from 4200 ms to around 1100 ms over localhost on my machine, that's almost a 4X increase in performance. All tests are done on Windows (64-bit Python 3.4), I'm not sure if it's as much of a problem on Linux.\n\nIt's still mostly CPU bound, so I'm sure there is even more potential for optimization. I think I'll look into it when I find a bit more time.\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/875/reactions", "total_count": 6, "+1": 6, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/875/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/849", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/849/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/849/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/849/events", "html_url": "https://github.com/pallets/werkzeug/issues/849", "id": 126328972, "node_id": "MDU6SXNzdWUxMjYzMjg5NzI=", "number": 849, "title": "request.files FileStorage object iterates indefinitely on Python 3", "user": {"login": "joshringer", "id": 504709, "node_id": "MDQ6VXNlcjUwNDcwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/504709?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joshringer", "html_url": "https://github.com/joshringer", "followers_url": "https://api.github.com/users/joshringer/followers", "following_url": "https://api.github.com/users/joshringer/following{/other_user}", "gists_url": "https://api.github.com/users/joshringer/gists{/gist_id}", "starred_url": "https://api.github.com/users/joshringer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joshringer/subscriptions", "organizations_url": "https://api.github.com/users/joshringer/orgs", "repos_url": "https://api.github.com/users/joshringer/repos", "events_url": "https://api.github.com/users/joshringer/events{/privacy}", "received_events_url": "https://api.github.com/users/joshringer/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2016-01-13T02:57:56Z", "updated_at": "2020-11-13T16:54:33Z", "closed_at": "2016-04-05T17:41:58Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "When retrieving a file through request.files, attempting to iterate over it will hang as iterator indefinitely produces empty lines after content instead of raising `StopIteration`.\n\nThis only occurs on Python 3, Python 2 seems unaffected.\nTested against werkzeug version 0.10.4, also against master 818c27fb5191eb58a40049b61173c6711682cf66, Python 3.5.0 & 2.7.10\n\nCode to reproduce:\n\n``` python\nfrom werkzeug.wrappers import Request, Response\nfrom werkzeug.test import Client\n\n@Request.application\ndef iter_file(request):\n    fobj = request.files['testfile']\n    lines = [line for line in fobj]  # <-- this will hang on py3\n    # fobj produces empty lines after content indefinitely on iteration\n    # should be raising StopIteration at end of content\n    return Response(b'\\n'.join(lines))\n\nclient = Client(iter_file)\n\ndata = b'\\r\\n'.join([\n    b'--foo',\n    b'Content-Disposition: form-data; name=\"testfile\"; filename=\"atest.txt\"',\n    b'Content-Type: text/plain',\n    b'',\n    b'A simple test',\n    b'--foo--',\n])\n\nresponse = client.post(\n    '/',\n    data=data,\n    content_type='multipart/form-data; boundary=\"foo\"',\n    content_length=len(data)\n)  # ==> hang on py3\n```\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/849/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/849/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/822", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/822/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/822/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/822/events", "html_url": "https://github.com/pallets/werkzeug/issues/822", "id": 120629677, "node_id": "MDU6SXNzdWUxMjA2Mjk2Nzc=", "number": 822, "title": "dev server sets wrong HTTP_HOST when path starts with a double slash", "user": {"login": "ThiefMaster", "id": 179599, "node_id": "MDQ6VXNlcjE3OTU5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/179599?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ThiefMaster", "html_url": "https://github.com/ThiefMaster", "followers_url": "https://api.github.com/users/ThiefMaster/followers", "following_url": "https://api.github.com/users/ThiefMaster/following{/other_user}", "gists_url": "https://api.github.com/users/ThiefMaster/gists{/gist_id}", "starred_url": "https://api.github.com/users/ThiefMaster/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ThiefMaster/subscriptions", "organizations_url": "https://api.github.com/users/ThiefMaster/orgs", "repos_url": "https://api.github.com/users/ThiefMaster/repos", "events_url": "https://api.github.com/users/ThiefMaster/events{/privacy}", "received_events_url": "https://api.github.com/users/ThiefMaster/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": {"login": "untitaker", "id": 837573, "node_id": "MDQ6VXNlcjgzNzU3Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/837573?v=4", "gravatar_id": "", "url": "https://api.github.com/users/untitaker", "html_url": "https://github.com/untitaker", "followers_url": "https://api.github.com/users/untitaker/followers", "following_url": "https://api.github.com/users/untitaker/following{/other_user}", "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}", "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions", "organizations_url": "https://api.github.com/users/untitaker/orgs", "repos_url": "https://api.github.com/users/untitaker/repos", "events_url": "https://api.github.com/users/untitaker/events{/privacy}", "received_events_url": "https://api.github.com/users/untitaker/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "untitaker", "id": 837573, "node_id": "MDQ6VXNlcjgzNzU3Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/837573?v=4", "gravatar_id": "", "url": "https://api.github.com/users/untitaker", "html_url": "https://github.com/untitaker", "followers_url": "https://api.github.com/users/untitaker/followers", "following_url": "https://api.github.com/users/untitaker/following{/other_user}", "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}", "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions", "organizations_url": "https://api.github.com/users/untitaker/orgs", "repos_url": "https://api.github.com/users/untitaker/repos", "events_url": "https://api.github.com/users/untitaker/events{/privacy}", "received_events_url": "https://api.github.com/users/untitaker/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 5, "created_at": "2015-12-06T11:54:40Z", "updated_at": "2020-11-13T16:54:33Z", "closed_at": "2016-04-14T13:50:41Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "body": "See https://github.com/mitsuhiko/flask/issues/1639#issuecomment-162305541\n\n```\nif request_url.netloc:\n    environ['HTTP_HOST'] = request_url.netloc\n```\n\nThis code was added in 7486573d / #248. Do absolute http requests even make sense except for HTTP proxies?\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/822/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/822/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/810", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/810/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/810/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/810/events", "html_url": "https://github.com/pallets/werkzeug/issues/810", "id": 116724926, "node_id": "MDU6SXNzdWUxMTY3MjQ5MjY=", "number": 810, "title": "zombie process created with multiple workers in run_simple", "user": {"login": "mmnelemane", "id": 13483069, "node_id": "MDQ6VXNlcjEzNDgzMDY5", "avatar_url": "https://avatars.githubusercontent.com/u/13483069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mmnelemane", "html_url": "https://github.com/mmnelemane", "followers_url": "https://api.github.com/users/mmnelemane/followers", "following_url": "https://api.github.com/users/mmnelemane/following{/other_user}", "gists_url": "https://api.github.com/users/mmnelemane/gists{/gist_id}", "starred_url": "https://api.github.com/users/mmnelemane/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mmnelemane/subscriptions", "organizations_url": "https://api.github.com/users/mmnelemane/orgs", "repos_url": "https://api.github.com/users/mmnelemane/repos", "events_url": "https://api.github.com/users/mmnelemane/events{/privacy}", "received_events_url": "https://api.github.com/users/mmnelemane/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}, {"id": 127559587, "node_id": "MDU6TGFiZWwxMjc1NTk1ODc=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/reloader", "name": "reloader", "color": "5319e7", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2015-11-13T08:43:35Z", "updated_at": "2020-11-13T16:46:39Z", "closed_at": "2017-04-09T21:39:10Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "A simple server below with 2 processes creates zombie process on the server after serving a GET request. This is not observed with other server libraries (like `httpserver` with `Forkingmixin`).\r\n\r\n~~~python\r\nfrom werkzeug import serving\r\n\r\ndef application(environ, start_response):\r\n        start_response('200 OK', [('Content-type', 'text/html')])\r\n        return ['Hello World!!!']\r\n\r\nserving.run_simple('127.0.0.1', 8080, application, processes=2)\r\n~~~\r\n\r\nOutput of `ps aux | grep python` after a GET call:\r\n\r\n~~~\r\nuser1    6824  0.1  0.0  82248 14528 pts/1    S+   09:28   0:00 python werkzeug_api.py\r\nuser1    6825  0.0  0.0      0     0 pts/1    Z+   09:28   0:00 [python] <defunct>\r\n~~~", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/810/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/810/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/776", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/776/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/776/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/776/events", "html_url": "https://github.com/pallets/werkzeug/issues/776", "id": 109758028, "node_id": "MDU6SXNzdWUxMDk3NTgwMjg=", "number": 776, "title": "OverflowError when downloading big files", "user": {"login": "olilau", "id": 7594540, "node_id": "MDQ6VXNlcjc1OTQ1NDA=", "avatar_url": "https://avatars.githubusercontent.com/u/7594540?v=4", "gravatar_id": "", "url": "https://api.github.com/users/olilau", "html_url": "https://github.com/olilau", "followers_url": "https://api.github.com/users/olilau/followers", "following_url": "https://api.github.com/users/olilau/following{/other_user}", "gists_url": "https://api.github.com/users/olilau/gists{/gist_id}", "starred_url": "https://api.github.com/users/olilau/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/olilau/subscriptions", "organizations_url": "https://api.github.com/users/olilau/orgs", "repos_url": "https://api.github.com/users/olilau/repos", "events_url": "https://api.github.com/users/olilau/events{/privacy}", "received_events_url": "https://api.github.com/users/olilau/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2015-10-05T09:16:59Z", "updated_at": "2020-11-13T15:26:04Z", "closed_at": "2019-03-29T15:36:30Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "Hello,\n\nI sometimes get an OverflowError when downloading big files.\nI've included the traceback at the end.\n\nIt happens with big files. The first one is 4465410157 bytes (4.5 Gb) long and the other is 3670993906 bytes (3.7 Gb) long.\nIt does not happens every time. Some of my colleagues got that error. I couldn't reproduce it though.\n\nI'm running werkzeug version 0.9.6+dfsg-1 from Debian GNU Linux 8 in a docker container.\nPython 2.7.9\nMy colleagues are using 'wget' to download these files (in case it could help). I've tried with 'curl' and 'wget' but I don't get that error at my end.\n\nAm I doing something wrong ? Or is it an issue in werkzeug ?\nIf you need anything else, tell me.\n\nThank you.\n\nIn case it could help, I'm also pasting the serve_file method since it originates from that method:\n\n``` python\ndef serve_file(path):\n    range = http.request.httprequest.range\n    if range and len(range.ranges) > 1:\n        raise NotImplemented(\"Multiple ranges\")\n    try:\n        archive = open(path, 'rb')\n    except IOError, exc:\n        if exc.errno == 2:\n            raise NotFound(\"File does not exist\")\n    archive.seek(0, SEEK_END)\n    filesize = archive.tell()\n    if not range:\n        archive.seek(0)\n        return Response(archive, 200, mimetype='application/octet-stream',\n                        headers=[\n                            ('Content-Length', str(filesize)),\n                            ('Content-Disposition',\n                             \"attachment; filename=\\\"%s\\\"\"\n                             % basename(path)),\n                        ],\n                        direct_passthrough=True)\n    else:\n        start, stop = range.ranges[0]\n        if stop is None:\n            stop = filesize\n        if start > stop:\n            raise RequestedRangeNotSatisfiable()\n        archive.seek(start)\n        length = stop - start\n        if length == 0:\n            return Response('', 204)\n        response = Response(LimitedStream(archive, length),\n                            206, mimetype='application/octet-stream',\n                            headers=[\n                                ('Content-Length', str(length)),\n                                ('Content-Disposition',\n                                 \"attachment; filename=\\\"%s\\\"\"\n                                 % basename(path)),\n                            ],\n                            direct_passthrough=True)\n        response.content_range = \\\n            ContentRange('bytes', start, stop, filesize)\n        return response\n```\n\nTraceback:\n 444 2015-10-05 05:55:28,106 22421 ERROR upgrade werkzeug: Error on request:\n 445 Traceback (most recent call last):\n 446   File \"/usr/lib/python2.7/dist-packages/werkzeug/serving.py\", line 177, in run_wsgi\n 447     execute(self.server.app)\n 448   File \"/usr/lib/python2.7/dist-packages/werkzeug/serving.py\", line 167, in execute\n 449     for data in application_iter:\n 450   File \"/usr/lib/python2.7/dist-packages/werkzeug/wsgi.py\", line 1044, in **next**\n 451     line = self.readline()\n 452   File \"/usr/lib/python2.7/dist-packages/werkzeug/wsgi.py\", line 1006, in readline\n 453     line = self._readline(size)\n 454 OverflowError: signed integer is greater than maximum\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/776/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/776/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/731", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/731/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/731/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/731/events", "html_url": "https://github.com/pallets/werkzeug/issues/731", "id": 71528497, "node_id": "MDU6SXNzdWU3MTUyODQ5Nw==", "number": 731, "title": "JSONRequestMixin tries to call json.loads() on bytes if simplejson is not available under Python 3", "user": {"login": "underyx", "id": 1060436, "node_id": "MDQ6VXNlcjEwNjA0MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1060436?v=4", "gravatar_id": "", "url": "https://api.github.com/users/underyx", "html_url": "https://github.com/underyx", "followers_url": "https://api.github.com/users/underyx/followers", "following_url": "https://api.github.com/users/underyx/following{/other_user}", "gists_url": "https://api.github.com/users/underyx/gists{/gist_id}", "starred_url": "https://api.github.com/users/underyx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/underyx/subscriptions", "organizations_url": "https://api.github.com/users/underyx/orgs", "repos_url": "https://api.github.com/users/underyx/repos", "events_url": "https://api.github.com/users/underyx/events{/privacy}", "received_events_url": "https://api.github.com/users/underyx/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2015-04-28T08:56:02Z", "updated_at": "2020-11-13T15:53:14Z", "closed_at": "2016-06-03T19:21:55Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "Throws an exception that the stdlib `json.loads` needs `str`, not `bytes` such as `request.data`.\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/731/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/731/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/727", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/727/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/727/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/727/events", "html_url": "https://github.com/pallets/werkzeug/issues/727", "id": 70339714, "node_id": "MDU6SXNzdWU3MDMzOTcxNA==", "number": 727, "title": "Incorrect rule matched given two rules, one with a variable and suffix, another with two variables", "user": {"login": "abramclark", "id": 911967, "node_id": "MDQ6VXNlcjkxMTk2Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/911967?v=4", "gravatar_id": "", "url": "https://api.github.com/users/abramclark", "html_url": "https://github.com/abramclark", "followers_url": "https://api.github.com/users/abramclark/followers", "following_url": "https://api.github.com/users/abramclark/following{/other_user}", "gists_url": "https://api.github.com/users/abramclark/gists{/gist_id}", "starred_url": "https://api.github.com/users/abramclark/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/abramclark/subscriptions", "organizations_url": "https://api.github.com/users/abramclark/orgs", "repos_url": "https://api.github.com/users/abramclark/repos", "events_url": "https://api.github.com/users/abramclark/events{/privacy}", "received_events_url": "https://api.github.com/users/abramclark/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}, {"id": 141452452, "node_id": "MDU6TGFiZWwxNDE0NTI0NTI=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/routing", "name": "routing", "color": "5319e7", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/3", "html_url": "https://github.com/pallets/werkzeug/milestone/3", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/3/labels", "id": 3010848, "node_id": "MDk6TWlsZXN0b25lMzAxMDg0OA==", "number": 3, "title": "0.14", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 52, "state": "closed", "created_at": "2018-01-03T17:05:55Z", "updated_at": "2018-11-22T16:03:02Z", "due_on": null, "closed_at": "2018-01-03T19:06:25Z"}, "comments": 2, "created_at": "2015-04-23T07:58:04Z", "updated_at": "2020-11-13T16:38:36Z", "closed_at": "2018-01-03T18:38:30Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "There are two rules, the first one matching \"/&lt;owner_name&gt;:Stuff\" and the second matching \"/&lt;owner_name&gt;:&lt;label_name&gt;\". A request for \"/fooman:Stuff\" is matched by the second route, instead of the first as expected.\n\nA workaround as suggested by ronny on #pocoo is to change the first route to match \"/&lt;owner_name&gt;:&lt;any(Stuff):foo&gt;\"\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/727/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/727/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/712", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/712/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/712/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/712/events", "html_url": "https://github.com/pallets/werkzeug/issues/712", "id": 63005203, "node_id": "MDU6SXNzdWU2MzAwNTIwMw==", "number": 712, "title": "Test client does not handle WSGI iterator correctly", "user": {"login": "aop", "id": 217120, "node_id": "MDQ6VXNlcjIxNzEyMA==", "avatar_url": "https://avatars.githubusercontent.com/u/217120?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aop", "html_url": "https://github.com/aop", "followers_url": "https://api.github.com/users/aop/followers", "following_url": "https://api.github.com/users/aop/following{/other_user}", "gists_url": "https://api.github.com/users/aop/gists{/gist_id}", "starred_url": "https://api.github.com/users/aop/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aop/subscriptions", "organizations_url": "https://api.github.com/users/aop/orgs", "repos_url": "https://api.github.com/users/aop/repos", "events_url": "https://api.github.com/users/aop/events{/privacy}", "received_events_url": "https://api.github.com/users/aop/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2015-03-19T14:34:02Z", "updated_at": "2020-11-13T17:11:47Z", "closed_at": "2015-03-20T20:07:04Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "As described in the new relic forums [1] it seems that tests run with certain libraries such as the New Relic Python agent expose a bug. The client doesn't convert an iterable to an iterator.\n\nI've tried this with versions \nFlask==0.10.1\nWerkzeug==0.9.6\n\n[1] https://discuss.newrelic.com/t/werkzeug-cant-work-properly-when-using-agent-2-40-0-34/13318/4\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/712/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/712/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/709", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/709/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/709/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/709/events", "html_url": "https://github.com/pallets/werkzeug/issues/709", "id": 62547601, "node_id": "MDU6SXNzdWU2MjU0NzYwMQ==", "number": 709, "title": "`url_for` with a tuple does not work!", "user": {"login": "malev", "id": 55977, "node_id": "MDQ6VXNlcjU1OTc3", "avatar_url": "https://avatars.githubusercontent.com/u/55977?v=4", "gravatar_id": "", "url": "https://api.github.com/users/malev", "html_url": "https://github.com/malev", "followers_url": "https://api.github.com/users/malev/followers", "following_url": "https://api.github.com/users/malev/following{/other_user}", "gists_url": "https://api.github.com/users/malev/gists{/gist_id}", "starred_url": "https://api.github.com/users/malev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/malev/subscriptions", "organizations_url": "https://api.github.com/users/malev/orgs", "repos_url": "https://api.github.com/users/malev/repos", "events_url": "https://api.github.com/users/malev/events{/privacy}", "received_events_url": "https://api.github.com/users/malev/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2015-03-18T00:12:52Z", "updated_at": "2020-11-13T17:11:46Z", "closed_at": "2015-03-20T20:01:18Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "Code example:\n\n``` python\n#...\n@blueprint.route('/<value:val>/')\ndef settings(value):\n#...\n\n#...\nclass SettingsConverter(BaseConverter):\n    def to_url(self, value):\n        return '%s/%s' % (value[0], value[1])\n#...\n\nvalue = ('username', 'project1')\nurl = url_for('.settings', val=value)\n# url will be \"u/s\" instad of \"username/project1\"\n```\n\nAt some point we are loosing the second element of the **tuple** and I'm pretty sure it happens here: https://github.com/mitsuhiko/werkzeug/blob/master/werkzeug/routing.py#L1712-L1716\n## Versions\n- python 2.7\n- werkzeug 0.10\n\nMaybe @tswicegood can provide more information.\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/709/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/709/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/705", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/705/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/705/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/705/events", "html_url": "https://github.com/pallets/werkzeug/issues/705", "id": 61676398, "node_id": "MDU6SXNzdWU2MTY3NjM5OA==", "number": 705, "title": "Response.calculate_content_length doesn't use encoded self.response", "user": {"login": "touilleMan", "id": 3187637, "node_id": "MDQ6VXNlcjMxODc2Mzc=", "avatar_url": "https://avatars.githubusercontent.com/u/3187637?v=4", "gravatar_id": "", "url": "https://api.github.com/users/touilleMan", "html_url": "https://github.com/touilleMan", "followers_url": "https://api.github.com/users/touilleMan/followers", "following_url": "https://api.github.com/users/touilleMan/following{/other_user}", "gists_url": "https://api.github.com/users/touilleMan/gists{/gist_id}", "starred_url": "https://api.github.com/users/touilleMan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/touilleMan/subscriptions", "organizations_url": "https://api.github.com/users/touilleMan/orgs", "repos_url": "https://api.github.com/users/touilleMan/repos", "events_url": "https://api.github.com/users/touilleMan/events{/privacy}", "received_events_url": "https://api.github.com/users/touilleMan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/2", "html_url": "https://github.com/pallets/werkzeug/milestone/2", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/2/labels", "id": 2377222, "node_id": "MDk6TWlsZXN0b25lMjM3NzIyMg==", "number": 2, "title": "0.13", "description": "", "creator": {"login": "untitaker", "id": 837573, "node_id": "MDQ6VXNlcjgzNzU3Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/837573?v=4", "gravatar_id": "", "url": "https://api.github.com/users/untitaker", "html_url": "https://github.com/untitaker", "followers_url": "https://api.github.com/users/untitaker/followers", "following_url": "https://api.github.com/users/untitaker/following{/other_user}", "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}", "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions", "organizations_url": "https://api.github.com/users/untitaker/orgs", "repos_url": "https://api.github.com/users/untitaker/repos", "events_url": "https://api.github.com/users/untitaker/events{/privacy}", "received_events_url": "https://api.github.com/users/untitaker/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 22, "state": "closed", "created_at": "2017-03-10T11:39:33Z", "updated_at": "2018-01-03T17:05:47Z", "due_on": null, "closed_at": "2018-01-03T17:05:47Z"}, "comments": 0, "created_at": "2015-03-14T18:54:57Z", "updated_at": "2020-11-13T16:38:41Z", "closed_at": "2017-05-05T21:04:56Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "The implementation of `calculate_content_length` doesn't encode the elements of `self.response` before using them:\nhttps://github.com/mitsuhiko/werkzeug/blob/master/werkzeug/wrappers.py#L926\n\n``` python\n    def calculate_content_length(self):\n        [...]\n        return sum(len(x) for x in self.response)\n```\n\nIn case self.response is composed of utf-8 encoded unicode strings, this will lead to an  invalid return length:\n\n``` python\n>>> from werkzeug import Response\n>>> r = Response()\n>>> r.response.append(u'\u4f60\u597d')\n>>> r.calculate_content_length()\n2\n>>> len(u'\u4f60\u597d'.encode('utf-8'))\n6\n```\n\nThe easier solution to this would be to use `iter_encoded` inside `calculate_content_length`, but would decrease performances given the data would be encoded two time (for calculating content-lenght, then for actualy writing the data)\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/705/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/705/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/703", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/703/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/703/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/703/events", "html_url": "https://github.com/pallets/werkzeug/pull/703", "id": 60835867, "node_id": "MDExOlB1bGxSZXF1ZXN0MzEwNDU5ODI=", "number": 703, "title": "Problem with the Safari user agent parsing", "user": {"login": "zllak", "id": 140642, "node_id": "MDQ6VXNlcjE0MDY0Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/140642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zllak", "html_url": "https://github.com/zllak", "followers_url": "https://api.github.com/users/zllak/followers", "following_url": "https://api.github.com/users/zllak/following{/other_user}", "gists_url": "https://api.github.com/users/zllak/gists{/gist_id}", "starred_url": "https://api.github.com/users/zllak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zllak/subscriptions", "organizations_url": "https://api.github.com/users/zllak/orgs", "repos_url": "https://api.github.com/users/zllak/repos", "events_url": "https://api.github.com/users/zllak/events{/privacy}", "received_events_url": "https://api.github.com/users/zllak/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2015-03-12T15:21:31Z", "updated_at": "2020-11-13T15:53:57Z", "closed_at": "2015-03-20T21:57:21Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/pallets/werkzeug/pulls/703", "html_url": "https://github.com/pallets/werkzeug/pull/703", "diff_url": "https://github.com/pallets/werkzeug/pull/703.diff", "patch_url": "https://github.com/pallets/werkzeug/pull/703.patch", "merged_at": "2015-03-20T21:57:21Z"}, "body": "User agents for Safari are a bit different from other UA.\nThe version is not found in the form <browser>/<version> but in the form Version/<version> Safari/<build number>.\nTo correctly get the Safari version, we have to apply this small fix, otherwise, we get the build number.\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/703/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/703/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/695", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/695/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/695/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/695/events", "html_url": "https://github.com/pallets/werkzeug/issues/695", "id": 58373173, "node_id": "MDU6SXNzdWU1ODM3MzE3Mw==", "number": 695, "title": "AttributeError: 'datetime.date' object has no attribute 'tzinfo'", "user": {"login": "Gidrek", "id": 1173392, "node_id": "MDQ6VXNlcjExNzMzOTI=", "avatar_url": "https://avatars.githubusercontent.com/u/1173392?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Gidrek", "html_url": "https://github.com/Gidrek", "followers_url": "https://api.github.com/users/Gidrek/followers", "following_url": "https://api.github.com/users/Gidrek/following{/other_user}", "gists_url": "https://api.github.com/users/Gidrek/gists{/gist_id}", "starred_url": "https://api.github.com/users/Gidrek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Gidrek/subscriptions", "organizations_url": "https://api.github.com/users/Gidrek/orgs", "repos_url": "https://api.github.com/users/Gidrek/repos", "events_url": "https://api.github.com/users/Gidrek/events{/privacy}", "received_events_url": "https://api.github.com/users/Gidrek/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2015-02-20T16:09:23Z", "updated_at": "2020-11-13T16:46:42Z", "closed_at": "2016-12-13T15:24:17Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "I was working in Python 3 to generate my atom feed and I got the error.\n\n```\nAttributeError: 'datetime.date' object has no attribute 'tzinfo'\n```\n\nI have fixed adding the next code to werkzeug/contrib/atom.py file\n\n```\nfrom datetime import datetime, time\n\n\ndef format_iso8601(obj):\n    \"\"\"Format a datetime object for iso8601\"\"\"\n    iso8601 = obj.isoformat()\n    obj = datetime.combine(obj, time())\n    if obj.tzinfo:\n          return iso8601\n   return iso8601 + 'Z'\n```\n\nAnd the atom feed was working fine.\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/695/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/695/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/690", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/690/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/690/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/690/events", "html_url": "https://github.com/pallets/werkzeug/issues/690", "id": 57558399, "node_id": "MDU6SXNzdWU1NzU1ODM5OQ==", "number": 690, "title": "max_content_length is not enforced in all cases", "user": {"login": "danc86", "id": 398575, "node_id": "MDQ6VXNlcjM5ODU3NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/398575?v=4", "gravatar_id": "", "url": "https://api.github.com/users/danc86", "html_url": "https://github.com/danc86", "followers_url": "https://api.github.com/users/danc86/followers", "following_url": "https://api.github.com/users/danc86/following{/other_user}", "gists_url": "https://api.github.com/users/danc86/gists{/gist_id}", "starred_url": "https://api.github.com/users/danc86/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/danc86/subscriptions", "organizations_url": "https://api.github.com/users/danc86/orgs", "repos_url": "https://api.github.com/users/danc86/repos", "events_url": "https://api.github.com/users/danc86/events{/privacy}", "received_events_url": "https://api.github.com/users/danc86/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/23", "html_url": "https://github.com/pallets/werkzeug/milestone/23", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/23/labels", "id": 8230343, "node_id": "MI_kwDOAA832s4AfZXH", "number": 23, "title": "2.3.0", "description": "", "creator": {"login": "pgjones", "id": 1391482, "node_id": "MDQ6VXNlcjEzOTE0ODI=", "avatar_url": "https://avatars.githubusercontent.com/u/1391482?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pgjones", "html_url": "https://github.com/pgjones", "followers_url": "https://api.github.com/users/pgjones/followers", "following_url": "https://api.github.com/users/pgjones/following{/other_user}", "gists_url": "https://api.github.com/users/pgjones/gists{/gist_id}", "starred_url": "https://api.github.com/users/pgjones/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pgjones/subscriptions", "organizations_url": "https://api.github.com/users/pgjones/orgs", "repos_url": "https://api.github.com/users/pgjones/repos", "events_url": "https://api.github.com/users/pgjones/events{/privacy}", "received_events_url": "https://api.github.com/users/pgjones/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 57, "state": "closed", "created_at": "2022-07-23T19:29:58Z", "updated_at": "2023-04-25T18:07:11Z", "due_on": null, "closed_at": "2023-04-25T18:07:11Z"}, "comments": 6, "created_at": "2015-02-13T04:34:01Z", "updated_at": "2023-03-14T17:24:59Z", "closed_at": "2019-01-20T17:41:26Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "The wording in the docs about the `max_content_length` property indicates that it applies for all usages of the request, including when accessing the raw request data.\n\n> Special note on the get_data method: Calling this loads the full request data into memory. This is only safe to do if the max_content_length is set.\n> [...]\n> To avoid being the victim of a DDOS attack you can set the maximum accepted content length and request field sizes. The BaseRequest class has two attributes for that: max_content_length and max_form_memory_size.\n> The first one can be used to limit the total content length. For example by setting it to 1024 \\* 1024 \\* 16 the request won\u2019t accept more than 16MB of transmitted data.\n> [...]\n\nHowever in Werkzeug 0.9+ it actually only applies when form data is parsed (and that's the only case covered by tests). The length is not enforced when .get_data() is called.\n\nFailing test case:\n\n``` python\ndef test_content_length_limiting():\n    data = b'Hello World'\n    req = wrappers.Request.from_values(input_stream=BytesIO(data),\n            content_length=len(data), method='POST')\n    req.max_content_length = 400\n    strict_eq(req.get_data(), data)\n\n    req = wrappers.Request.from_values(input_stream=BytesIO(data),\n            content_length=len(data), method='POST')\n    req.max_content_length = 4\n    pytest.raises(RequestEntityTooLarge, lambda: req.get_data())\n```\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/690/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/690/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/682", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/682/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/682/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/682/events", "html_url": "https://github.com/pallets/werkzeug/issues/682", "id": 57087584, "node_id": "MDU6SXNzdWU1NzA4NzU4NA==", "number": 682, "title": "Werkzeug stat reloader problems", "user": {"login": "untitaker", "id": 837573, "node_id": "MDQ6VXNlcjgzNzU3Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/837573?v=4", "gravatar_id": "", "url": "https://api.github.com/users/untitaker", "html_url": "https://github.com/untitaker", "followers_url": "https://api.github.com/users/untitaker/followers", "following_url": "https://api.github.com/users/untitaker/following{/other_user}", "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}", "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions", "organizations_url": "https://api.github.com/users/untitaker/orgs", "repos_url": "https://api.github.com/users/untitaker/repos", "events_url": "https://api.github.com/users/untitaker/events{/privacy}", "received_events_url": "https://api.github.com/users/untitaker/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 37, "created_at": "2015-02-09T20:49:06Z", "updated_at": "2020-11-13T17:11:39Z", "closed_at": "2015-03-26T12:52:06Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "body": "So far two people have run into serious performance issues with the stat reloader. Anybody who has those, **the fix is to install watchdog from pypi**.\n\nIf you're interested in fixing this issue, uninstall watchdog again and:\n- How does setting `reloader_interval` on `werkzeug.run_simple` or `app.run` affect performance? Try various values:\n  \n  ```\n  app.run(reloader_interval=1)  # the default\n  ```\n- Run this code inside your virtualenv, post the returned number:\n  \n  ```\n  from werkzeug._reloader import _iter_module_files\n  print(len(list(_iter_module_files())))\n  ```\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/682/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/682/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/670", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/670/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/670/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/670/events", "html_url": "https://github.com/pallets/werkzeug/issues/670", "id": 56359285, "node_id": "MDU6SXNzdWU1NjM1OTI4NQ==", "number": 670, "title": "Request.mimetype should be always lowercase", "user": {"login": "KarelJakubec", "id": 2052163, "node_id": "MDQ6VXNlcjIwNTIxNjM=", "avatar_url": "https://avatars.githubusercontent.com/u/2052163?v=4", "gravatar_id": "", "url": "https://api.github.com/users/KarelJakubec", "html_url": "https://github.com/KarelJakubec", "followers_url": "https://api.github.com/users/KarelJakubec/followers", "following_url": "https://api.github.com/users/KarelJakubec/following{/other_user}", "gists_url": "https://api.github.com/users/KarelJakubec/gists{/gist_id}", "starred_url": "https://api.github.com/users/KarelJakubec/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/KarelJakubec/subscriptions", "organizations_url": "https://api.github.com/users/KarelJakubec/orgs", "repos_url": "https://api.github.com/users/KarelJakubec/repos", "events_url": "https://api.github.com/users/KarelJakubec/events{/privacy}", "received_events_url": "https://api.github.com/users/KarelJakubec/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}, {"id": 141452010, "node_id": "MDU6TGFiZWwxNDE0NTIwMTA=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/standards", "name": "standards", "color": "0052cc", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2015-02-03T10:27:08Z", "updated_at": "2020-11-13T16:54:44Z", "closed_at": "2015-10-28T23:04:35Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "As discused in https://github.com/mitsuhiko/flask/issues/1330 mimetype property of request is case insensitive (defined in http://tools.ietf.org/html/rfc2045). It is a rule of thumb that it is lowercase but APPLICATION/JSON is valid as well. Werkzeug currently copies value from header without any conversion to lower/uper case which may cause troubles in code using it.\n\nThe result of previous discussion was that Werkzeug should convert mimetype to lowercase. As I walked through the code, the question is whether this shoul hold for content_type as well as it is often computed from mimetype.\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/670/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/670/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/636", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/636/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/636/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/636/events", "html_url": "https://github.com/pallets/werkzeug/issues/636", "id": 50926421, "node_id": "MDU6SXNzdWU1MDkyNjQyMQ==", "number": 636, "title": "Python3 compatibility issue in get_content_type()", "user": {"login": "miki725", "id": 932940, "node_id": "MDQ6VXNlcjkzMjk0MA==", "avatar_url": "https://avatars.githubusercontent.com/u/932940?v=4", "gravatar_id": "", "url": "https://api.github.com/users/miki725", "html_url": "https://github.com/miki725", "followers_url": "https://api.github.com/users/miki725/followers", "following_url": "https://api.github.com/users/miki725/following{/other_user}", "gists_url": "https://api.github.com/users/miki725/gists{/gist_id}", "starred_url": "https://api.github.com/users/miki725/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/miki725/subscriptions", "organizations_url": "https://api.github.com/users/miki725/orgs", "repos_url": "https://api.github.com/users/miki725/repos", "events_url": "https://api.github.com/users/miki725/events{/privacy}", "received_events_url": "https://api.github.com/users/miki725/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2014-12-04T04:07:33Z", "updated_at": "2020-11-13T15:35:38Z", "closed_at": "2019-01-13T00:04:14Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "I use Django with `django_extensions` which uses werkzeug for debugging when using `runserver_plus`. Werkzeug seems to blow up in `get_content_type()` with following traceback when using Python3:\n\n```\nTraceback (most recent call last):\n  File \"/Volumes/Data/Users/miki725/.virtualenvs/test-py3/lib/python3.4/site-packages/werkzeug/serving.py\", line 177, in run_wsgi\n    execute(self.server.app)\n  File \"/Volumes/Data/Users/miki725/.virtualenvs/test-py3/lib/python3.4/site-packages/werkzeug/serving.py\", line 165, in execute\n    application_iter = app(environ, start_response)\n  File \"/Volumes/Data/Users/miki725/.virtualenvs/test-py3/lib/python3.4/site-packages/werkzeug/debug/__init__.py\", line 173, in __call__\n    response = self.get_resource(request, arg)\n  File \"/Volumes/Data/Users/miki725/.virtualenvs/test-py3/lib/python3.4/site-packages/werkzeug/debug/__init__.py\", line 154, in get_resource\n    return Response(f.read(), mimetype=mimetype)\n  File \"/Volumes/Data/Users/miki725/.virtualenvs/test-py3/lib/python3.4/site-packages/werkzeug/wrappers.py\", line 749, in __init__\n    mimetype = get_content_type(mimetype, self.charset)\n  File \"/Volumes/Data/Users/miki725/.virtualenvs/test-py3/lib/python3.4/site-packages/werkzeug/utils.py\", line 224, in get_content_type\n    if mimetype.startswith('text/') or \\\nTypeError: startswith first arg must be bytes or a tuple of bytes, not str\n```\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/636/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/636/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/609", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/609/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/609/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/609/events", "html_url": "https://github.com/pallets/werkzeug/issues/609", "id": 44839561, "node_id": "MDU6SXNzdWU0NDgzOTU2MQ==", "number": 609, "title": "get_host will use X-Forwarded-Host by default", "user": {"login": "danielrichman", "id": 222531, "node_id": "MDQ6VXNlcjIyMjUzMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/222531?v=4", "gravatar_id": "", "url": "https://api.github.com/users/danielrichman", "html_url": "https://github.com/danielrichman", "followers_url": "https://api.github.com/users/danielrichman/followers", "following_url": "https://api.github.com/users/danielrichman/following{/other_user}", "gists_url": "https://api.github.com/users/danielrichman/gists{/gist_id}", "starred_url": "https://api.github.com/users/danielrichman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/danielrichman/subscriptions", "organizations_url": "https://api.github.com/users/danielrichman/orgs", "repos_url": "https://api.github.com/users/danielrichman/repos", "events_url": "https://api.github.com/users/danielrichman/events{/privacy}", "received_events_url": "https://api.github.com/users/danielrichman/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": {"login": "untitaker", "id": 837573, "node_id": "MDQ6VXNlcjgzNzU3Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/837573?v=4", "gravatar_id": "", "url": "https://api.github.com/users/untitaker", "html_url": "https://github.com/untitaker", "followers_url": "https://api.github.com/users/untitaker/followers", "following_url": "https://api.github.com/users/untitaker/following{/other_user}", "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}", "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions", "organizations_url": "https://api.github.com/users/untitaker/orgs", "repos_url": "https://api.github.com/users/untitaker/repos", "events_url": "https://api.github.com/users/untitaker/events{/privacy}", "received_events_url": "https://api.github.com/users/untitaker/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "untitaker", "id": 837573, "node_id": "MDQ6VXNlcjgzNzU3Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/837573?v=4", "gravatar_id": "", "url": "https://api.github.com/users/untitaker", "html_url": "https://github.com/untitaker", "followers_url": "https://api.github.com/users/untitaker/followers", "following_url": "https://api.github.com/users/untitaker/following{/other_user}", "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}", "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions", "organizations_url": "https://api.github.com/users/untitaker/orgs", "repos_url": "https://api.github.com/users/untitaker/repos", "events_url": "https://api.github.com/users/untitaker/events{/privacy}", "received_events_url": "https://api.github.com/users/untitaker/received_events", "type": "User", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/4", "html_url": "https://github.com/pallets/werkzeug/milestone/4", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/4/labels", "id": 3010850, "node_id": "MDk6TWlsZXN0b25lMzAxMDg1MA==", "number": 4, "title": "0.15", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 125, "state": "closed", "created_at": "2018-01-03T17:06:24Z", "updated_at": "2019-03-19T15:15:44Z", "due_on": null, "closed_at": "2019-03-19T15:15:44Z"}, "comments": 21, "created_at": "2014-10-03T19:21:33Z", "updated_at": "2020-11-13T16:18:12Z", "closed_at": "2018-05-23T14:49:06Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "Here: https://github.com/mitsuhiko/werkzeug/blob/cbd049d88727936173386d2e80bb5ffa51fedd6e/werkzeug/wsgi.py#L141\n\nI don't think that this is a safe default.\nWhen using flask it gives any client the ability to set an arbitrary hostname in `request.url`.\n\nThis surprised me, since http://werkzeug.pocoo.org/docs/0.9/contrib/fixers/#werkzeug.contrib.fixers.ProxyFix exists to explicitly enable support for these headers (`X-Forwarded-For`, `X-Forwarded-Host`, ...).\n\nAnd I think that this is misleading: http://werkzeug.pocoo.org/docs/0.9/wrappers/#werkzeug.wrappers.BaseRequest.trusted_hosts since a web server must not only \u201cnot route invalid hosts to the application\u201d, but it must also delete any foreign `X-Forwarded-Host` headers.\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/609/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/609/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/582", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/582/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/582/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/582/events", "html_url": "https://github.com/pallets/werkzeug/issues/582", "id": 41563210, "node_id": "MDU6SXNzdWU0MTU2MzIxMA==", "number": 582, "title": "`url_fix` throws exception for malformed urls", "user": {"login": "tahajahangir", "id": 815585, "node_id": "MDQ6VXNlcjgxNTU4NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/815585?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tahajahangir", "html_url": "https://github.com/tahajahangir", "followers_url": "https://api.github.com/users/tahajahangir/followers", "following_url": "https://api.github.com/users/tahajahangir/following{/other_user}", "gists_url": "https://api.github.com/users/tahajahangir/gists{/gist_id}", "starred_url": "https://api.github.com/users/tahajahangir/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tahajahangir/subscriptions", "organizations_url": "https://api.github.com/users/tahajahangir/orgs", "repos_url": "https://api.github.com/users/tahajahangir/repos", "events_url": "https://api.github.com/users/tahajahangir/events{/privacy}", "received_events_url": "https://api.github.com/users/tahajahangir/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2014-08-30T13:23:35Z", "updated_at": "2020-11-13T17:23:24Z", "closed_at": "2014-09-05T15:36:42Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "`url_fix(ur'file://C:\\Users\\Administrator\\My Documents\\\u00d1\u00c8\u00e1\u00c7\u00ed\u00ed')` throws `UnicodeEncodeError` exception (while `sys.getdefaultencoding()` is `ascii`).\n\nI think url_fix should never throw an exception. (The above url is a real world referrer url)\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/582/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/582/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/569", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/569/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/569/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/569/events", "html_url": "https://github.com/pallets/werkzeug/issues/569", "id": 40995499, "node_id": "MDU6SXNzdWU0MDk5NTQ5OQ==", "number": 569, "title": "Reloader does not work after syntax error", "user": {"login": "char101", "id": 71255, "node_id": "MDQ6VXNlcjcxMjU1", "avatar_url": "https://avatars.githubusercontent.com/u/71255?v=4", "gravatar_id": "", "url": "https://api.github.com/users/char101", "html_url": "https://github.com/char101", "followers_url": "https://api.github.com/users/char101/followers", "following_url": "https://api.github.com/users/char101/following{/other_user}", "gists_url": "https://api.github.com/users/char101/gists{/gist_id}", "starred_url": "https://api.github.com/users/char101/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/char101/subscriptions", "organizations_url": "https://api.github.com/users/char101/orgs", "repos_url": "https://api.github.com/users/char101/repos", "events_url": "https://api.github.com/users/char101/events{/privacy}", "received_events_url": "https://api.github.com/users/char101/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2014-08-24T04:24:05Z", "updated_at": "2020-11-13T17:23:22Z", "closed_at": "2014-08-31T18:47:08Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "Hi,\n\nIf a module causes a syntax error, it's not appended to the sys.modules. Therefore editing the module file does not trigger the reload in the child server and the subsequent requests are handled by a stale server.\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/569/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/569/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/560", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/560/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/560/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/560/events", "html_url": "https://github.com/pallets/werkzeug/issues/560", "id": 40852896, "node_id": "MDU6SXNzdWU0MDg1Mjg5Ng==", "number": 560, "title": "NameError: name 'unicode' is not defined", "user": {"login": "greenaj", "id": 1936975, "node_id": "MDQ6VXNlcjE5MzY5NzU=", "avatar_url": "https://avatars.githubusercontent.com/u/1936975?v=4", "gravatar_id": "", "url": "https://api.github.com/users/greenaj", "html_url": "https://github.com/greenaj", "followers_url": "https://api.github.com/users/greenaj/followers", "following_url": "https://api.github.com/users/greenaj/following{/other_user}", "gists_url": "https://api.github.com/users/greenaj/gists{/gist_id}", "starred_url": "https://api.github.com/users/greenaj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/greenaj/subscriptions", "organizations_url": "https://api.github.com/users/greenaj/orgs", "repos_url": "https://api.github.com/users/greenaj/repos", "events_url": "https://api.github.com/users/greenaj/events{/privacy}", "received_events_url": "https://api.github.com/users/greenaj/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2014-08-21T21:35:31Z", "updated_at": "2020-11-13T17:23:33Z", "closed_at": "2014-08-22T21:39:18Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "I get this error in posixemulation.py for version 0.9.6 when running under Windows 7, Python 3.4. It seems that the code has not been ported to Python 3 and the unicode() function that no longer exists generates this error.\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/560/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/560/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/546", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/546/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/546/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/546/events", "html_url": "https://github.com/pallets/werkzeug/issues/546", "id": 35721663, "node_id": "MDU6SXNzdWUzNTcyMTY2Mw==", "number": 546, "title": "Race condition in routing.Map", "user": {"login": "methane", "id": 199592, "node_id": "MDQ6VXNlcjE5OTU5Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/199592?v=4", "gravatar_id": "", "url": "https://api.github.com/users/methane", "html_url": "https://github.com/methane", "followers_url": "https://api.github.com/users/methane/followers", "following_url": "https://api.github.com/users/methane/following{/other_user}", "gists_url": "https://api.github.com/users/methane/gists{/gist_id}", "starred_url": "https://api.github.com/users/methane/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/methane/subscriptions", "organizations_url": "https://api.github.com/users/methane/orgs", "repos_url": "https://api.github.com/users/methane/repos", "events_url": "https://api.github.com/users/methane/events{/privacy}", "received_events_url": "https://api.github.com/users/methane/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2014-06-14T05:23:10Z", "updated_at": "2020-11-13T17:11:54Z", "closed_at": "2015-01-25T11:18:06Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "Reported [here](http://lists.unbit.it/pipermail/uwsgi/2014-June/007370.html)\n\nrouting.Map.update() has race condition.\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/546/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/546/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/539", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/539/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/539/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/539/events", "html_url": "https://github.com/pallets/werkzeug/issues/539", "id": 34961482, "node_id": "MDU6SXNzdWUzNDk2MTQ4Mg==", "number": 539, "title": "Werkzeug-0.9.4 and python3_memcached-1.51 doesn't work on Python 3.4", "user": {"login": "artvolk", "id": 1260508, "node_id": "MDQ6VXNlcjEyNjA1MDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1260508?v=4", "gravatar_id": "", "url": "https://api.github.com/users/artvolk", "html_url": "https://github.com/artvolk", "followers_url": "https://api.github.com/users/artvolk/followers", "following_url": "https://api.github.com/users/artvolk/following{/other_user}", "gists_url": "https://api.github.com/users/artvolk/gists{/gist_id}", "starred_url": "https://api.github.com/users/artvolk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/artvolk/subscriptions", "organizations_url": "https://api.github.com/users/artvolk/orgs", "repos_url": "https://api.github.com/users/artvolk/repos", "events_url": "https://api.github.com/users/artvolk/events{/privacy}", "received_events_url": "https://api.github.com/users/artvolk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2014-06-04T14:04:27Z", "updated_at": "2020-11-13T17:23:28Z", "closed_at": "2014-08-23T00:37:49Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "I'm using `werkzeug.contrib.cache.MemcachedCache` with python3_memcached-1.51 when I try to get\\set data I get the following error: `memcache.MemcachedKeyTypeError: Key must be str()'s` here:\nhttps://github.com/eguven/python3-memcached/blob/master/memcache.py#L1039\n\n```\nif not isinstance(key, str):\n    raise Client.MemcachedKeyTypeError(\"Key must be str()'s\")\n```\n\nThe key type is `bytes`, not `str`. So I checked deeper.\n\nInside `werkzeug.contrib.cache.MemcachedCache` key is encoded into `bytes` (in Python 3) like this:\n\n```\nif isinstance(key, text_type):\n    key = key.encode('utf-8')\n```\n\nhttps://github.com/mitsuhiko/werkzeug/blob/master/werkzeug/contrib/cache.py#L342\n\nWhat is correct fix for this? Monkey patch?\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/539/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/539/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/516", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/516/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/516/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/516/events", "html_url": "https://github.com/pallets/werkzeug/issues/516", "id": 31977744, "node_id": "MDU6SXNzdWUzMTk3Nzc0NA==", "number": 516, "title": "Threading assertion error in python 3.4 using reloader", "user": {"login": "paradoxxxzero", "id": 271144, "node_id": "MDQ6VXNlcjI3MTE0NA==", "avatar_url": "https://avatars.githubusercontent.com/u/271144?v=4", "gravatar_id": "", "url": "https://api.github.com/users/paradoxxxzero", "html_url": "https://github.com/paradoxxxzero", "followers_url": "https://api.github.com/users/paradoxxxzero/followers", "following_url": "https://api.github.com/users/paradoxxxzero/following{/other_user}", "gists_url": "https://api.github.com/users/paradoxxxzero/gists{/gist_id}", "starred_url": "https://api.github.com/users/paradoxxxzero/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/paradoxxxzero/subscriptions", "organizations_url": "https://api.github.com/users/paradoxxxzero/orgs", "repos_url": "https://api.github.com/users/paradoxxxzero/repos", "events_url": "https://api.github.com/users/paradoxxxzero/events{/privacy}", "received_events_url": "https://api.github.com/users/paradoxxxzero/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}, {"id": 127559587, "node_id": "MDU6TGFiZWwxMjc1NTk1ODc=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/reloader", "name": "reloader", "color": "5319e7", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2014-04-22T14:32:08Z", "updated_at": "2020-11-13T17:23:21Z", "closed_at": "2014-09-14T10:47:05Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "Running this simple application with python 3.4.0 on linux:\n\n``` python\nfrom werkzeug.wrappers import Request, Response\nimport threading\n\n@Request.application\ndef application(request):\n    return Response(repr(threading.current_thread()))\n\nif __name__ == '__main__':\n    from werkzeug.serving import run_simple\n    run_simple('localhost', 4000, application, use_reloader=True)\n```\n\nraises the following error:\n\n```\n127.0.0.1 - - [22/Apr/2014 16:28:23] \"GET / HTTP/1.1\" 500 - \nError on request:                                                                                                                                                                              \nTraceback (most recent call last):                                                                                                                                                             \n  File \"/home/zero/.envs/wdb/lib/python3.4/site-packages/werkzeug/serving.py\", line 177, in run_wsgi                                                                                           \n    execute(self.server.app)                                                                                                                                                                   \n  File \"/home/zero/.envs/wdb/lib/python3.4/site-packages/werkzeug/serving.py\", line 165, in execute                                                                                            \n    application_iter = app(environ, start_response)                                                                                                                                            \n  File \"/home/zero/.envs/wdb/lib/python3.4/site-packages/werkzeug/wrappers.py\", line 285, in application                                                                                       \n    return f(*args[:-2] + (request,))(*args[-2:])                                                                                                                                              \n  File \"/home/zero/github/kozea/wdb/lol2.py\", line 6, in application                                                                                                                           \n    return Response(repr(threading.current_thread()))                                                                                                                                          \n  File \"/usr/lib/python3.4/threading.py\", line 824, in __repr__                                                                                                                                \n    self.is_alive() # easy way to get ._is_stopped set when appropriate                                                                                                                        \n  File \"/usr/lib/python3.4/threading.py\", line 1120, in is_alive                                                                                                                               \n    self._wait_for_tstate_lock(False)                                                                                                                                                          \n  File \"/usr/lib/python3.4/threading.py\", line 1076, in _wait_for_tstate_lock                                                                                                                  \n    assert self._is_stopped \nAssertionError \n```\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/516/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/516/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/513", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/513/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/513/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/513/events", "html_url": "https://github.com/pallets/werkzeug/issues/513", "id": 31389231, "node_id": "MDU6SXNzdWUzMTM4OTIzMQ==", "number": 513, "title": "Resource Warning in unit tests", "user": {"login": "rawrgulmuffins", "id": 1521575, "node_id": "MDQ6VXNlcjE1MjE1NzU=", "avatar_url": "https://avatars.githubusercontent.com/u/1521575?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rawrgulmuffins", "html_url": "https://github.com/rawrgulmuffins", "followers_url": "https://api.github.com/users/rawrgulmuffins/followers", "following_url": "https://api.github.com/users/rawrgulmuffins/following{/other_user}", "gists_url": "https://api.github.com/users/rawrgulmuffins/gists{/gist_id}", "starred_url": "https://api.github.com/users/rawrgulmuffins/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rawrgulmuffins/subscriptions", "organizations_url": "https://api.github.com/users/rawrgulmuffins/orgs", "repos_url": "https://api.github.com/users/rawrgulmuffins/repos", "events_url": "https://api.github.com/users/rawrgulmuffins/events{/privacy}", "received_events_url": "https://api.github.com/users/rawrgulmuffins/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2014-04-12T19:11:18Z", "updated_at": "2020-11-13T15:53:13Z", "closed_at": "2018-11-22T16:11:43Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "Cloned Werkzeug just a little bit ago and ran run-tests.py and saw these pop up.\nReported Error:\n\n```\n/Users/alord/flask/werkzeug/werkzeug/werkzeug/wsgi.py:802: ResourceWarning:   \nunclosed file <_io.FileIO name=5 mode='rb+'> iter = chain((first_item,), _iter)\n\n/Users/happy/flask/werkzeug/werkzeug/werkzeug/http.py:332: ResourceWarning: \nunclosed file <_io.FileIO name=5 mode='rb+'> extra = dict(parts)\n```\n\nEnvironment Information:\nOS X 10.8.5 (12F45)\nXTools\nPython3.4\nWerkZeug (cloned Today, I believe that makes it 0.10Dev but unsure)\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/513/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/513/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/512", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/512/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/512/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/512/events", "html_url": "https://github.com/pallets/werkzeug/issues/512", "id": 31199731, "node_id": "MDU6SXNzdWUzMTE5OTczMQ==", "number": 512, "title": "UserAgent detects ChromeOS as MacOS", "user": {"login": "jace", "id": 26695, "node_id": "MDQ6VXNlcjI2Njk1", "avatar_url": "https://avatars.githubusercontent.com/u/26695?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jace", "html_url": "https://github.com/jace", "followers_url": "https://api.github.com/users/jace/followers", "following_url": "https://api.github.com/users/jace/following{/other_user}", "gists_url": "https://api.github.com/users/jace/gists{/gist_id}", "starred_url": "https://api.github.com/users/jace/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jace/subscriptions", "organizations_url": "https://api.github.com/users/jace/orgs", "repos_url": "https://api.github.com/users/jace/repos", "events_url": "https://api.github.com/users/jace/events{/privacy}", "received_events_url": "https://api.github.com/users/jace/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}, {"id": 123873888, "node_id": "MDU6TGFiZWwxMjM4NzM4ODg=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/good%20first%20issue", "name": "good first issue", "color": "fbca04", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2014-04-09T22:16:07Z", "updated_at": "2020-11-13T17:11:37Z", "closed_at": "2015-04-04T13:06:37Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "On a Chromebook with the following UA string, `werkzeug.useragents.UserAgent` identifies platform as `macos`. It should be either `cros` (a new entry) or `linux`:\n\n`Mozilla/5.0 (X11; CrOS x86_64 5116.115.4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/33.0.1750.152 Safari/537.36`\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/512/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/512/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/510", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/510/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/510/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/510/events", "html_url": "https://github.com/pallets/werkzeug/issues/510", "id": 30939116, "node_id": "MDU6SXNzdWUzMDkzOTExNg==", "number": 510, "title": "POST multipart upload out of memory", "user": {"login": "sasha-stratoscale", "id": 6381353, "node_id": "MDQ6VXNlcjYzODEzNTM=", "avatar_url": "https://avatars.githubusercontent.com/u/6381353?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sasha-stratoscale", "html_url": "https://github.com/sasha-stratoscale", "followers_url": "https://api.github.com/users/sasha-stratoscale/followers", "following_url": "https://api.github.com/users/sasha-stratoscale/following{/other_user}", "gists_url": "https://api.github.com/users/sasha-stratoscale/gists{/gist_id}", "starred_url": "https://api.github.com/users/sasha-stratoscale/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sasha-stratoscale/subscriptions", "organizations_url": "https://api.github.com/users/sasha-stratoscale/orgs", "repos_url": "https://api.github.com/users/sasha-stratoscale/repos", "events_url": "https://api.github.com/users/sasha-stratoscale/events{/privacy}", "received_events_url": "https://api.github.com/users/sasha-stratoscale/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": {"login": "mitsuhiko", "id": 7396, "node_id": "MDQ6VXNlcjczOTY=", "avatar_url": "https://avatars.githubusercontent.com/u/7396?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mitsuhiko", "html_url": "https://github.com/mitsuhiko", "followers_url": "https://api.github.com/users/mitsuhiko/followers", "following_url": "https://api.github.com/users/mitsuhiko/following{/other_user}", "gists_url": "https://api.github.com/users/mitsuhiko/gists{/gist_id}", "starred_url": "https://api.github.com/users/mitsuhiko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mitsuhiko/subscriptions", "organizations_url": "https://api.github.com/users/mitsuhiko/orgs", "repos_url": "https://api.github.com/users/mitsuhiko/repos", "events_url": "https://api.github.com/users/mitsuhiko/events{/privacy}", "received_events_url": "https://api.github.com/users/mitsuhiko/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "mitsuhiko", "id": 7396, "node_id": "MDQ6VXNlcjczOTY=", "avatar_url": "https://avatars.githubusercontent.com/u/7396?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mitsuhiko", "html_url": "https://github.com/mitsuhiko", "followers_url": "https://api.github.com/users/mitsuhiko/followers", "following_url": "https://api.github.com/users/mitsuhiko/following{/other_user}", "gists_url": "https://api.github.com/users/mitsuhiko/gists{/gist_id}", "starred_url": "https://api.github.com/users/mitsuhiko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mitsuhiko/subscriptions", "organizations_url": "https://api.github.com/users/mitsuhiko/orgs", "repos_url": "https://api.github.com/users/mitsuhiko/repos", "events_url": "https://api.github.com/users/mitsuhiko/events{/privacy}", "received_events_url": "https://api.github.com/users/mitsuhiko/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 6, "created_at": "2014-04-06T15:01:41Z", "updated_at": "2020-11-13T16:46:52Z", "closed_at": "2016-05-24T09:24:14Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "Hi, I have an issue with OOM while using multipart upload of huge binary files. This is due to the \ndef make_line_iter(stream, limit=None, buffer_size=10 \\* 1024):\ncode in werkzeug/werkzeug/wsgi.py.\n\nSteps to reproduce:\n\nServer  side code:\n\n```\n@app.route('/', methods=['POST'])\ndef upload_file():\n    file = request.files['file']\n    return '''OK'''\n```\n\nclient side code (using requests-toolbelt)\n\n```\nfrom requests_toolbelt import MultipartEncoder\nimport requests\n\n\nm = MultipartEncoder(\n    fields = {'file': ( 'filename', open( '/var/tmp/sasha_test/input.bin' ), 'application/octet-stream' )}\n    )\n\nr = requests.post( 'http://localhost:5000/', data = m,\n                  headers = {'Content-Type': m.content_type})\n\nprint \"Done!!! %s\" % r\n```\n\ninput bin is a large binary file created like this:\n\n```\ndd if=/dev/zero of=input.bin bs=1MiB count=1K\n```\n\nWhat happens is that the code searches for teh \"\\r\\n\" in order to find multipart-part \"terminator\". It saves in memory 2 last lines.\nThis causes OOM while uploading large files. \n\nThanks.\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/510/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/510/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/506", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/506/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/506/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/506/events", "html_url": "https://github.com/pallets/werkzeug/issues/506", "id": 29636109, "node_id": "MDU6SXNzdWUyOTYzNjEwOQ==", "number": 506, "title": "'410 Gone' is rendered incorrectly", "user": {"login": "noumar", "id": 146694, "node_id": "MDQ6VXNlcjE0NjY5NA==", "avatar_url": "https://avatars.githubusercontent.com/u/146694?v=4", "gravatar_id": "", "url": "https://api.github.com/users/noumar", "html_url": "https://github.com/noumar", "followers_url": "https://api.github.com/users/noumar/followers", "following_url": "https://api.github.com/users/noumar/following{/other_user}", "gists_url": "https://api.github.com/users/noumar/gists{/gist_id}", "starred_url": "https://api.github.com/users/noumar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/noumar/subscriptions", "organizations_url": "https://api.github.com/users/noumar/orgs", "repos_url": "https://api.github.com/users/noumar/repos", "events_url": "https://api.github.com/users/noumar/events{/privacy}", "received_events_url": "https://api.github.com/users/noumar/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}, {"id": 123873888, "node_id": "MDU6TGFiZWwxMjM4NzM4ODg=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/good%20first%20issue", "name": "good first issue", "color": "fbca04", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2014-03-18T11:04:42Z", "updated_at": "2020-11-13T17:23:32Z", "closed_at": "2014-08-22T21:39:18Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "The description variable defined in `class Gone` contains a `</p><p>` part which is being escaped when `get_body()` calls `get_description()`.\n\nI.e the rendered error page source code contains `&lt;/p&gt;&lt;p&gt;` and displays literal `</p><p>` instead of paragraph break.\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/506/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/506/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/492", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/492/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/492/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/492/events", "html_url": "https://github.com/pallets/werkzeug/issues/492", "id": 26885503, "node_id": "MDU6SXNzdWUyNjg4NTUwMw==", "number": 492, "title": "I Think I find a bug in werkzeug.datastructures.ImmutableList", "user": {"login": "KaimingTao", "id": 988193, "node_id": "MDQ6VXNlcjk4ODE5Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/988193?v=4", "gravatar_id": "", "url": "https://api.github.com/users/KaimingTao", "html_url": "https://github.com/KaimingTao", "followers_url": "https://api.github.com/users/KaimingTao/followers", "following_url": "https://api.github.com/users/KaimingTao/following{/other_user}", "gists_url": "https://api.github.com/users/KaimingTao/gists{/gist_id}", "starred_url": "https://api.github.com/users/KaimingTao/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/KaimingTao/subscriptions", "organizations_url": "https://api.github.com/users/KaimingTao/orgs", "repos_url": "https://api.github.com/users/KaimingTao/repos", "events_url": "https://api.github.com/users/KaimingTao/events{/privacy}", "received_events_url": "https://api.github.com/users/KaimingTao/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2014-02-04T14:37:16Z", "updated_at": "2020-11-13T17:23:32Z", "closed_at": "2014-08-23T09:44:19Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "[See This](https://github.com/mitsuhiko/werkzeug/blob/master/werkzeug/datastructures.py#L134)\n\n```\n    def __repr__(self):\n        return '%s(%s)' % (\n            self.__class__.__name__,\n            dict.__repr__(self),\n        )\n```\n\nWhen Called `repr` to a ImmutableList, there will raise an Exception:\n\n`TypeError: descriptor '__repr__' requires a 'dict' object but received a 'ImmutableList'`\n\nBecause, ImmutableList is not a `dict` But a `list`\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/492/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/492/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/488", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/488/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/488/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/488/events", "html_url": "https://github.com/pallets/werkzeug/issues/488", "id": 26231652, "node_id": "MDU6SXNzdWUyNjIzMTY1Mg==", "number": 488, "title": "Building urls with host_matching Map does not produce host based URLs", "user": {"login": "sharoonthomas", "id": 305807, "node_id": "MDQ6VXNlcjMwNTgwNw==", "avatar_url": "https://avatars.githubusercontent.com/u/305807?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sharoonthomas", "html_url": "https://github.com/sharoonthomas", "followers_url": "https://api.github.com/users/sharoonthomas/followers", "following_url": "https://api.github.com/users/sharoonthomas/following{/other_user}", "gists_url": "https://api.github.com/users/sharoonthomas/gists{/gist_id}", "starred_url": "https://api.github.com/users/sharoonthomas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sharoonthomas/subscriptions", "organizations_url": "https://api.github.com/users/sharoonthomas/orgs", "repos_url": "https://api.github.com/users/sharoonthomas/repos", "events_url": "https://api.github.com/users/sharoonthomas/events{/privacy}", "received_events_url": "https://api.github.com/users/sharoonthomas/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": {"login": "aenglander", "id": 328648, "node_id": "MDQ6VXNlcjMyODY0OA==", "avatar_url": "https://avatars.githubusercontent.com/u/328648?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aenglander", "html_url": "https://github.com/aenglander", "followers_url": "https://api.github.com/users/aenglander/followers", "following_url": "https://api.github.com/users/aenglander/following{/other_user}", "gists_url": "https://api.github.com/users/aenglander/gists{/gist_id}", "starred_url": "https://api.github.com/users/aenglander/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aenglander/subscriptions", "organizations_url": "https://api.github.com/users/aenglander/orgs", "repos_url": "https://api.github.com/users/aenglander/repos", "events_url": "https://api.github.com/users/aenglander/events{/privacy}", "received_events_url": "https://api.github.com/users/aenglander/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "aenglander", "id": 328648, "node_id": "MDQ6VXNlcjMyODY0OA==", "avatar_url": "https://avatars.githubusercontent.com/u/328648?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aenglander", "html_url": "https://github.com/aenglander", "followers_url": "https://api.github.com/users/aenglander/followers", "following_url": "https://api.github.com/users/aenglander/following{/other_user}", "gists_url": "https://api.github.com/users/aenglander/gists{/gist_id}", "starred_url": "https://api.github.com/users/aenglander/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aenglander/subscriptions", "organizations_url": "https://api.github.com/users/aenglander/orgs", "repos_url": "https://api.github.com/users/aenglander/repos", "events_url": "https://api.github.com/users/aenglander/events{/privacy}", "received_events_url": "https://api.github.com/users/aenglander/received_events", "type": "User", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/1", "html_url": "https://github.com/pallets/werkzeug/milestone/1", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/1/labels", "id": 764000, "node_id": "MDk6TWlsZXN0b25lNzY0MDAw", "number": 1, "title": "1.0.0", "description": "", "creator": {"login": "untitaker", "id": 837573, "node_id": "MDQ6VXNlcjgzNzU3Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/837573?v=4", "gravatar_id": "", "url": "https://api.github.com/users/untitaker", "html_url": "https://github.com/untitaker", "followers_url": "https://api.github.com/users/untitaker/followers", "following_url": "https://api.github.com/users/untitaker/following{/other_user}", "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}", "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions", "organizations_url": "https://api.github.com/users/untitaker/orgs", "repos_url": "https://api.github.com/users/untitaker/repos", "events_url": "https://api.github.com/users/untitaker/events{/privacy}", "received_events_url": "https://api.github.com/users/untitaker/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 78, "state": "closed", "created_at": "2014-08-24T22:39:25Z", "updated_at": "2020-02-09T18:49:49Z", "due_on": null, "closed_at": "2020-02-09T18:49:49Z"}, "comments": 3, "created_at": "2014-01-24T10:29:46Z", "updated_at": "2020-11-13T14:55:12Z", "closed_at": "2020-01-05T01:28:07Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "``` python\n\n>>> from werkzeug import routing as r\n>>> m = r.Map([\n...   r.Rule('/', endpoint='index', host='www.domain.com'),\n...   r.Rule('/', endpoint='index', host='my.domain.com'),\n... ], host_matching=True)\n>>> www = m.bind('www.domain.com')\n>>> my = m.bind('my.domain.com')\n>>> www.match('/')\n('index', {})\n>>> my.match('/')\n('index', {})\n```\n\nWhen building\n\n``` python\n>>> www.build('index')\n'/'\n>>> my.build('index')\n'http://www.domain.com/'\n```\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/488/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/488/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/477", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/477/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/477/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/477/events", "html_url": "https://github.com/pallets/werkzeug/issues/477", "id": 24827023, "node_id": "MDU6SXNzdWUyNDgyNzAyMw==", "number": 477, "title": "Routing considers quoted slashes (%2F) as slashes.", "user": {"login": "Mattias-", "id": 1002805, "node_id": "MDQ6VXNlcjEwMDI4MDU=", "avatar_url": "https://avatars.githubusercontent.com/u/1002805?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mattias-", "html_url": "https://github.com/Mattias-", "followers_url": "https://api.github.com/users/Mattias-/followers", "following_url": "https://api.github.com/users/Mattias-/following{/other_user}", "gists_url": "https://api.github.com/users/Mattias-/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mattias-/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mattias-/subscriptions", "organizations_url": "https://api.github.com/users/Mattias-/orgs", "repos_url": "https://api.github.com/users/Mattias-/repos", "events_url": "https://api.github.com/users/Mattias-/events{/privacy}", "received_events_url": "https://api.github.com/users/Mattias-/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2013-12-27T17:23:35Z", "updated_at": "2020-11-13T17:23:29Z", "closed_at": "2014-08-25T15:55:33Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "The unquoting of slashes is done before routing and this is creating an unexpected behavior.\n\nThis issue is a copy of the following related issue in the repo for flask:\nhttps://github.com/mitsuhiko/flask/issues/900\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/477/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/477/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/464", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/464/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/464/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/464/events", "html_url": "https://github.com/pallets/werkzeug/issues/464", "id": 23306732, "node_id": "MDU6SXNzdWUyMzMwNjczMg==", "number": 464, "title": "ProxyFix does not work behind an AWS ELB with healthchecks", "user": {"login": "moodh", "id": 2162038, "node_id": "MDQ6VXNlcjIxNjIwMzg=", "avatar_url": "https://avatars.githubusercontent.com/u/2162038?v=4", "gravatar_id": "", "url": "https://api.github.com/users/moodh", "html_url": "https://github.com/moodh", "followers_url": "https://api.github.com/users/moodh/followers", "following_url": "https://api.github.com/users/moodh/following{/other_user}", "gists_url": "https://api.github.com/users/moodh/gists{/gist_id}", "starred_url": "https://api.github.com/users/moodh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/moodh/subscriptions", "organizations_url": "https://api.github.com/users/moodh/orgs", "repos_url": "https://api.github.com/users/moodh/repos", "events_url": "https://api.github.com/users/moodh/events{/privacy}", "received_events_url": "https://api.github.com/users/moodh/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2013-11-26T10:55:04Z", "updated_at": "2020-11-13T15:35:37Z", "closed_at": "2019-01-15T04:22:16Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "The ProxyFix middleware requires an argument that defines the amount of proxies in front of the application.\n\nIf you run the setup AWS ELB > NGINX > For example flask you would want the argument num_proxies=1. However if you point the health check to the same URL it will not have the correct headers and report the instance as crashed (with an exception since the proxy is out of range).\n\nI wrote my own ProxyFix for now, and I suppose this is somewhat of an edge case but I thought I'd report it just the same. :)\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/464/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/464/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/461", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/461/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/461/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/461/events", "html_url": "https://github.com/pallets/werkzeug/issues/461", "id": 22430082, "node_id": "MDU6SXNzdWUyMjQzMDA4Mg==", "number": 461, "title": "Reloader, python -m, and sys.path", "user": {"login": "SimonSapin", "id": 291359, "node_id": "MDQ6VXNlcjI5MTM1OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/291359?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SimonSapin", "html_url": "https://github.com/SimonSapin", "followers_url": "https://api.github.com/users/SimonSapin/followers", "following_url": "https://api.github.com/users/SimonSapin/following{/other_user}", "gists_url": "https://api.github.com/users/SimonSapin/gists{/gist_id}", "starred_url": "https://api.github.com/users/SimonSapin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SimonSapin/subscriptions", "organizations_url": "https://api.github.com/users/SimonSapin/orgs", "repos_url": "https://api.github.com/users/SimonSapin/repos", "events_url": "https://api.github.com/users/SimonSapin/events{/privacy}", "received_events_url": "https://api.github.com/users/SimonSapin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}, {"id": 127559587, "node_id": "MDU6TGFiZWwxMjc1NTk1ODc=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/reloader", "name": "reloader", "color": "5319e7", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/4", "html_url": "https://github.com/pallets/werkzeug/milestone/4", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/4/labels", "id": 3010850, "node_id": "MDk6TWlsZXN0b25lMzAxMDg1MA==", "number": 4, "title": "0.15", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 125, "state": "closed", "created_at": "2018-01-03T17:06:24Z", "updated_at": "2019-03-19T15:15:44Z", "due_on": null, "closed_at": "2019-03-19T15:15:44Z"}, "comments": 12, "created_at": "2013-11-11T06:24:01Z", "updated_at": "2020-11-13T15:43:28Z", "closed_at": "2018-12-08T22:28:32Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "See https://github.com/Kozea/WeasyPrint/issues/133\n\nWhat\u2019s going on is:\n- `python -m weasyprint.navigator` is run\n- `[sys.executable] + sys.argv` is `['\u2026/python', '\u2026/weasyprint/navigator.py']`\n- The reloader spawns a subprocess that way\n- The child process does not have `-m`, so Python add\u2019s the .py file\u2019s parent directory to `sys.path`\n- Werkzeug tries to import stdlib\u2019s `html.entities`\n- This incorrectly imports `weasyprint/html.py`\n- Stuff breaks\n\nNobody here is doing anything obviously wrong. How do you suggest dealing with this situation? What do you think of having `\u2026/weasyprint/navigator.py` (which is expected to be mostly used with `python -m`) remove its parent directory from `sys.path` if it\u2019s there?\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/461/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/461/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/458", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/458/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/458/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/458/events", "html_url": "https://github.com/pallets/werkzeug/issues/458", "id": 22091062, "node_id": "MDU6SXNzdWUyMjA5MTA2Mg==", "number": 458, "title": "MIMEAccept doesn't respect specificity", "user": {"login": "dougblack", "id": 942395, "node_id": "MDQ6VXNlcjk0MjM5NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/942395?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dougblack", "html_url": "https://github.com/dougblack", "followers_url": "https://api.github.com/users/dougblack/followers", "following_url": "https://api.github.com/users/dougblack/following{/other_user}", "gists_url": "https://api.github.com/users/dougblack/gists{/gist_id}", "starred_url": "https://api.github.com/users/dougblack/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dougblack/subscriptions", "organizations_url": "https://api.github.com/users/dougblack/orgs", "repos_url": "https://api.github.com/users/dougblack/repos", "events_url": "https://api.github.com/users/dougblack/events{/privacy}", "received_events_url": "https://api.github.com/users/dougblack/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/1", "html_url": "https://github.com/pallets/werkzeug/milestone/1", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/1/labels", "id": 764000, "node_id": "MDk6TWlsZXN0b25lNzY0MDAw", "number": 1, "title": "1.0.0", "description": "", "creator": {"login": "untitaker", "id": 837573, "node_id": "MDQ6VXNlcjgzNzU3Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/837573?v=4", "gravatar_id": "", "url": "https://api.github.com/users/untitaker", "html_url": "https://github.com/untitaker", "followers_url": "https://api.github.com/users/untitaker/followers", "following_url": "https://api.github.com/users/untitaker/following{/other_user}", "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}", "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions", "organizations_url": "https://api.github.com/users/untitaker/orgs", "repos_url": "https://api.github.com/users/untitaker/repos", "events_url": "https://api.github.com/users/untitaker/events{/privacy}", "received_events_url": "https://api.github.com/users/untitaker/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 78, "state": "closed", "created_at": "2014-08-24T22:39:25Z", "updated_at": "2020-02-09T18:49:49Z", "due_on": null, "closed_at": "2020-02-09T18:49:49Z"}, "comments": 7, "created_at": "2013-11-05T00:32:29Z", "updated_at": "2020-11-13T15:12:53Z", "closed_at": "2019-09-05T18:04:40Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "Hello!\n\nI've been using the helpful MIMEAccept class in `werkzeug.datastructures` and I noticed that while it does respect quality, it doesn't respect specificity as outlined in RFC 2616.\n\n> Media ranges can be overridden by more specific media ranges or specific media types. If more than one media range applies to a given type, the most specific reference has precedence. For example,\n> \n> Accept: text/_, text/html, text/html;level=1, */_\n>     have the following precedence:\n> \n> 1) text/html;level=1\n> 2) text/html\n> 3) text/*\n> 4) */*\n\nIs this something that people are interested in seeing fixed? I'd be happy to open a pull.\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/458/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 1}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/458/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/451", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/451/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/451/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/451/events", "html_url": "https://github.com/pallets/werkzeug/issues/451", "id": 21513612, "node_id": "MDU6SXNzdWUyMTUxMzYxMg==", "number": 451, "title": "Writing to response.stream does not invalidate/reset Content-Length", "user": {"login": "masklinn", "id": 6993, "node_id": "MDQ6VXNlcjY5OTM=", "avatar_url": "https://avatars.githubusercontent.com/u/6993?v=4", "gravatar_id": "", "url": "https://api.github.com/users/masklinn", "html_url": "https://github.com/masklinn", "followers_url": "https://api.github.com/users/masklinn/followers", "following_url": "https://api.github.com/users/masklinn/following{/other_user}", "gists_url": "https://api.github.com/users/masklinn/gists{/gist_id}", "starred_url": "https://api.github.com/users/masklinn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/masklinn/subscriptions", "organizations_url": "https://api.github.com/users/masklinn/orgs", "repos_url": "https://api.github.com/users/masklinn/repos", "events_url": "https://api.github.com/users/masklinn/events{/privacy}", "received_events_url": "https://api.github.com/users/masklinn/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2013-10-24T10:24:44Z", "updated_at": "2020-11-13T17:11:55Z", "closed_at": "2014-12-17T16:21:32Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "This is mostly an issue for \"expensive\" stream (e.g. images from disk resized on the fly), as the request's conditionality check will likely be performed before computing the payload, at least when it comes to `last_modified`/`if-modified-since`: the conditional response check is performed via `make_conditional` which will [compute a Content-Length if none is present](https://github.com/mitsuhiko/werkzeug/blob/master/werkzeug/wrappers.py#L1406)[0].\n\nWith an empty response (body not computed/set yet) this yields a `Content-Length` of 0. If one then uses `set_data`, by default (with `automatically_set_content_length=True`) it [will re-compute and re-set the `Content-Length` header](https://github.com/mitsuhiko/werkzeug/blob/master/werkzeug/wrappers.py#L903) whereas [`ResponseStream.write` will neither invalidate nor recompute an existing `Content-Lenght`](https://github.com/mitsuhiko/werkzeug/blob/master/werkzeug/wrappers.py#L1487).\n\nAs a result, if `make_conditional` was called before setting the response's content and the response's content was set using `response.stream` (e.g. by passing it to pillow's `image.save`) the browser will get a `Content-Length` of `0` and will thus ignore all content.\n\n[0] Also note that it does not check for the `automatically_set_content_length` flag. Not an issue here, but still...\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/451/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/451/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/442", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/442/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/442/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/442/events", "html_url": "https://github.com/pallets/werkzeug/issues/442", "id": 20233202, "node_id": "MDU6SXNzdWUyMDIzMzIwMg==", "number": 442, "title": "(Slightly) wrong exception raised for `abort(400)`", "user": {"login": "dcrosta", "id": 35122, "node_id": "MDQ6VXNlcjM1MTIy", "avatar_url": "https://avatars.githubusercontent.com/u/35122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dcrosta", "html_url": "https://github.com/dcrosta", "followers_url": "https://api.github.com/users/dcrosta/followers", "following_url": "https://api.github.com/users/dcrosta/following{/other_user}", "gists_url": "https://api.github.com/users/dcrosta/gists{/gist_id}", "starred_url": "https://api.github.com/users/dcrosta/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dcrosta/subscriptions", "organizations_url": "https://api.github.com/users/dcrosta/orgs", "repos_url": "https://api.github.com/users/dcrosta/repos", "events_url": "https://api.github.com/users/dcrosta/events{/privacy}", "received_events_url": "https://api.github.com/users/dcrosta/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2013-09-29T18:02:07Z", "updated_at": "2020-11-13T17:23:29Z", "closed_at": "2014-08-26T00:35:42Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "Calling `abort(400)` raises `ClientDisconnected`, a sub-class of `BadRequest`, instead of raising `BadRequest` as expected. Users that `try`/`except` for `BadRequest` won't notice the bug, since it is a sub-class; but if you are logging exceptions, the log lines are misleading.\n\nHere's a trivial REPL session that demonstrates the issue:\n\n``` python\n>>> import werkzeug\n>>> werkzeug.__version__\n'0.9.4'\n>>> from werkzeug.exceptions import abort, ClientDisconnected\n>>> try:\n...     abort(400)\n... except ClientDisconnected:\n...     print \"GOT WRONG EXCEPTION\"\n... except Exception, e:\n...     print \"Got %r\" % e\n...\nGOT WRONG EXCEPTION\n>>>\n```\n\nThis seems to be due to https://github.com/mitsuhiko/werkzeug/blob/master/werkzeug/exceptions.py#L542-L549 -- the sub-class will inherit the parent class's `code` attribute. So technically, this bug is non-deterministic, since it depends on the iteration order of `globals()`.\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/442/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/442/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/414", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/414/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/414/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/414/events", "html_url": "https://github.com/pallets/werkzeug/pull/414", "id": 17011316, "node_id": "MDExOlB1bGxSZXF1ZXN0NzA2MTcxMQ==", "number": 414, "title": "Fix #408: Response.age is semantically a timedelta, not a datetime", "user": {"login": "cvrebert", "id": 419884, "node_id": "MDQ6VXNlcjQxOTg4NA==", "avatar_url": "https://avatars.githubusercontent.com/u/419884?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cvrebert", "html_url": "https://github.com/cvrebert", "followers_url": "https://api.github.com/users/cvrebert/followers", "following_url": "https://api.github.com/users/cvrebert/following{/other_user}", "gists_url": "https://api.github.com/users/cvrebert/gists{/gist_id}", "starred_url": "https://api.github.com/users/cvrebert/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cvrebert/subscriptions", "organizations_url": "https://api.github.com/users/cvrebert/orgs", "repos_url": "https://api.github.com/users/cvrebert/repos", "events_url": "https://api.github.com/users/cvrebert/events{/privacy}", "received_events_url": "https://api.github.com/users/cvrebert/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/2", "html_url": "https://github.com/pallets/werkzeug/milestone/2", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/2/labels", "id": 2377222, "node_id": "MDk6TWlsZXN0b25lMjM3NzIyMg==", "number": 2, "title": "0.13", "description": "", "creator": {"login": "untitaker", "id": 837573, "node_id": "MDQ6VXNlcjgzNzU3Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/837573?v=4", "gravatar_id": "", "url": "https://api.github.com/users/untitaker", "html_url": "https://github.com/untitaker", "followers_url": "https://api.github.com/users/untitaker/followers", "following_url": "https://api.github.com/users/untitaker/following{/other_user}", "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}", "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions", "organizations_url": "https://api.github.com/users/untitaker/orgs", "repos_url": "https://api.github.com/users/untitaker/repos", "events_url": "https://api.github.com/users/untitaker/events{/privacy}", "received_events_url": "https://api.github.com/users/untitaker/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 22, "state": "closed", "created_at": "2017-03-10T11:39:33Z", "updated_at": "2018-01-03T17:05:47Z", "due_on": null, "closed_at": "2018-01-03T17:05:47Z"}, "comments": 10, "created_at": "2013-07-20T21:01:35Z", "updated_at": "2020-11-13T16:46:56Z", "closed_at": "2017-04-12T20:19:13Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "draft": false, "pull_request": {"url": "https://api.github.com/repos/pallets/werkzeug/pulls/414", "html_url": "https://github.com/pallets/werkzeug/pull/414", "diff_url": "https://github.com/pallets/werkzeug/pull/414.diff", "patch_url": "https://github.com/pallets/werkzeug/pull/414.patch", "merged_at": null}, "body": "First time I've tried to contribute to Werkzeug; criticism is welcome.\nFixes #408.\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/414/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/414/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/404", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/404/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/404/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/404/events", "html_url": "https://github.com/pallets/werkzeug/issues/404", "id": 16319089, "node_id": "MDU6SXNzdWUxNjMxOTA4OQ==", "number": 404, "title": "parse_options_header fails to parse quoted values", "user": {"login": "markoutso", "id": 1496466, "node_id": "MDQ6VXNlcjE0OTY0NjY=", "avatar_url": "https://avatars.githubusercontent.com/u/1496466?v=4", "gravatar_id": "", "url": "https://api.github.com/users/markoutso", "html_url": "https://github.com/markoutso", "followers_url": "https://api.github.com/users/markoutso/followers", "following_url": "https://api.github.com/users/markoutso/following{/other_user}", "gists_url": "https://api.github.com/users/markoutso/gists{/gist_id}", "starred_url": "https://api.github.com/users/markoutso/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/markoutso/subscriptions", "organizations_url": "https://api.github.com/users/markoutso/orgs", "repos_url": "https://api.github.com/users/markoutso/repos", "events_url": "https://api.github.com/users/markoutso/events{/privacy}", "received_events_url": "https://api.github.com/users/markoutso/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2013-07-03T14:01:48Z", "updated_at": "2020-11-13T17:11:32Z", "closed_at": "2015-09-07T12:34:33Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "``` python\nheader = '''multipart/form-data; boundary=----WebKitFormBoundaryUv6L4qL9bQlBDkzK\nform-data; name=\"\u03b1\u03c5\u03c4\u03cc \u03b5\u03af\u03bd\u03b1\u03b9, \u03ad\u03bd\u03b1 \u03b1\u03c1\u03c7\u03b5\u03af\u03bf \u03bc\u03b5 \u03ab \u03b4\u03b9\u03b1\u03bb\u03c5\u03c4\u03b9\u03ba\u03ac ;.rtf\"; filename=\"\u03b1\u03c5\u03c4\u03cc \u03b5\u03af\u03bd\u03b1\u03b9, \u03ad\u03bd\u03b1 \u03b1\u03c1\u03c7\u03b5\u03af\u03bf \u03bc\u03b5 \u03ab \u03b4\u03b9\u03b1\u03bb\u03c5\u03c4\u03b9\u03ba\u03ac ;.rtf\"\napplication/msword''' \nprint parse_options_header(header)[1][\"filename\"]\n```\n\nGiven the above code the output should be :\n\n``` text\n\u03b1\u03c5\u03c4\u03cc \u03b5\u03af\u03bd\u03b1\u03b9, \u03ad\u03bd\u03b1 \u03b1\u03c1\u03c7\u03b5\u03af\u03bf \u03bc\u03b5 \u03ab \u03b4\u03b9\u03b1\u03bb\u03c5\u03c4\u03b9\u03ba\u03ac ;\n```\n\nwithout any quotes, and with a final semicolon. Instead it is:\n\n``` text\n\"\u03b1\u03c5\u03c4\u03cc \u03b5\u03af\u03bd\u03b1\u03b9, \u03ad\u03bd\u03b1 \u03b1\u03c1\u03c7\u03b5\u03af\u03bf \u03bc\u03b5 \u03ab \u03b4\u03b9\u03b1\u03bb\u03c5\u03c4\u03b9\u03ba\u03ac\n```\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/404/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/404/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/397", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/397/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/397/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/397/events", "html_url": "https://github.com/pallets/werkzeug/issues/397", "id": 15692564, "node_id": "MDU6SXNzdWUxNTY5MjU2NA==", "number": 397, "title": "POSTing to a GET endpoint may trigger an unexpected redirect when another rule also matches the url", "user": {"login": "ThiefMaster", "id": 179599, "node_id": "MDQ6VXNlcjE3OTU5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/179599?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ThiefMaster", "html_url": "https://github.com/ThiefMaster", "followers_url": "https://api.github.com/users/ThiefMaster/followers", "following_url": "https://api.github.com/users/ThiefMaster/following{/other_user}", "gists_url": "https://api.github.com/users/ThiefMaster/gists{/gist_id}", "starred_url": "https://api.github.com/users/ThiefMaster/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ThiefMaster/subscriptions", "organizations_url": "https://api.github.com/users/ThiefMaster/orgs", "repos_url": "https://api.github.com/users/ThiefMaster/repos", "events_url": "https://api.github.com/users/ThiefMaster/events{/privacy}", "received_events_url": "https://api.github.com/users/ThiefMaster/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}, {"id": 141452452, "node_id": "MDU6TGFiZWwxNDE0NTI0NTI=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/routing", "name": "routing", "color": "5319e7", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2013-06-18T14:56:58Z", "updated_at": "2020-11-13T16:18:07Z", "closed_at": "2018-07-09T16:40:59Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "body": "I have route for `/foo/<path:bla>/` and one for `/foo/<xyz>/foobar`. The latter is more specific and thus the first rule only matches if the second rule did not match.\n\nHowever, when sending a POST request to the second url I get a slash-adding redirect triggered by the first rule instead of the expected 405 error.\n\nDemo: https://gist.github.com/ThiefMaster/5806003\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/397/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/397/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/382", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/382/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/382/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/382/events", "html_url": "https://github.com/pallets/werkzeug/issues/382", "id": 15109527, "node_id": "MDU6SXNzdWUxNTEwOTUyNw==", "number": 382, "title": "Test client incorrectly follows redirects with a non-root base_url", "user": {"login": "SimonSapin", "id": 291359, "node_id": "MDQ6VXNlcjI5MTM1OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/291359?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SimonSapin", "html_url": "https://github.com/SimonSapin", "followers_url": "https://api.github.com/users/SimonSapin/followers", "following_url": "https://api.github.com/users/SimonSapin/following{/other_user}", "gists_url": "https://api.github.com/users/SimonSapin/gists{/gist_id}", "starred_url": "https://api.github.com/users/SimonSapin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SimonSapin/subscriptions", "organizations_url": "https://api.github.com/users/SimonSapin/orgs", "repos_url": "https://api.github.com/users/SimonSapin/repos", "events_url": "https://api.github.com/users/SimonSapin/events{/privacy}", "received_events_url": "https://api.github.com/users/SimonSapin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/4", "html_url": "https://github.com/pallets/werkzeug/milestone/4", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/4/labels", "id": 3010850, "node_id": "MDk6TWlsZXN0b25lMzAxMDg1MA==", "number": 4, "title": "0.15", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 125, "state": "closed", "created_at": "2018-01-03T17:06:24Z", "updated_at": "2019-03-19T15:15:44Z", "due_on": null, "closed_at": "2019-03-19T15:15:44Z"}, "comments": 4, "created_at": "2013-06-04T09:32:06Z", "updated_at": "2020-11-13T15:53:12Z", "closed_at": "2018-11-25T05:41:37Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "Hi,\n\nWhen using the test client with `follow_redirects=True` and a `base_url` that has a non-root path, the client makes redirected requests with the base path includes once too many times. Test case:\n\n```\nfrom flask import Flask, redirect, url_for, abort\n\napp = Flask(__name__)\n\n@app.route('/create/')\ndef create():\n    return 'create'\n\n@app.route('/edit/')\ndef edit():\n    return redirect(url_for('create'))\n\n@app.route('/<path:path>')\ndef catch_all(path):\n    print(path)\n    abort(404)\n\nprint(app.test_client().get(\n    '/edit/', base_url='/not-root/', follow_redirects=True))\n```\n\nOutput:\n\n```\nnot-root/create/\n<Response streamed [404 NOT FOUND]>\n```\n\nExpected output: a single line with a 200 response.\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/382/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/382/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/379", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/379/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/379/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/379/events", "html_url": "https://github.com/pallets/werkzeug/issues/379", "id": 15047467, "node_id": "MDU6SXNzdWUxNTA0NzQ2Nw==", "number": 379, "title": "SharedDataMiddleware does not support unicode paths", "user": {"login": "mitsuhiko", "id": 7396, "node_id": "MDQ6VXNlcjczOTY=", "avatar_url": "https://avatars.githubusercontent.com/u/7396?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mitsuhiko", "html_url": "https://github.com/mitsuhiko", "followers_url": "https://api.github.com/users/mitsuhiko/followers", "following_url": "https://api.github.com/users/mitsuhiko/following{/other_user}", "gists_url": "https://api.github.com/users/mitsuhiko/gists{/gist_id}", "starred_url": "https://api.github.com/users/mitsuhiko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mitsuhiko/subscriptions", "organizations_url": "https://api.github.com/users/mitsuhiko/orgs", "repos_url": "https://api.github.com/users/mitsuhiko/repos", "events_url": "https://api.github.com/users/mitsuhiko/events{/privacy}", "received_events_url": "https://api.github.com/users/mitsuhiko/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2013-06-03T00:05:01Z", "updated_at": "2020-11-13T15:12:47Z", "closed_at": "2019-09-20T18:13:25Z", "author_association": "MEMBER", "active_lock_reason": "resolved", "body": "The static file serving currently does not support unicode paths on either 2.x or 3.x but it fails in different ways.  On Python 3 it lacks the WSGI encoding dance and on 2.x it hopes the URL encoding is the FS encoding.\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/379/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 1}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/379/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/185", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/185/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/185/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/185/events", "html_url": "https://github.com/pallets/werkzeug/issues/185", "id": 4442010, "node_id": "MDU6SXNzdWU0NDQyMDEw", "number": 185, "title": "Complex URL routes are sorted incorrectly", "user": {"login": "jace", "id": 26695, "node_id": "MDQ6VXNlcjI2Njk1", "avatar_url": "https://avatars.githubusercontent.com/u/26695?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jace", "html_url": "https://github.com/jace", "followers_url": "https://api.github.com/users/jace/followers", "following_url": "https://api.github.com/users/jace/following{/other_user}", "gists_url": "https://api.github.com/users/jace/gists{/gist_id}", "starred_url": "https://api.github.com/users/jace/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jace/subscriptions", "organizations_url": "https://api.github.com/users/jace/orgs", "repos_url": "https://api.github.com/users/jace/repos", "events_url": "https://api.github.com/users/jace/events{/privacy}", "received_events_url": "https://api.github.com/users/jace/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/3", "html_url": "https://github.com/pallets/werkzeug/milestone/3", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/3/labels", "id": 3010848, "node_id": "MDk6TWlsZXN0b25lMzAxMDg0OA==", "number": 3, "title": "0.14", "description": "", "creator": {"login": "davidism", "id": 1242887, "node_id": "MDQ6VXNlcjEyNDI4ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/1242887?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidism", "html_url": "https://github.com/davidism", "followers_url": "https://api.github.com/users/davidism/followers", "following_url": "https://api.github.com/users/davidism/following{/other_user}", "gists_url": "https://api.github.com/users/davidism/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidism/subscriptions", "organizations_url": "https://api.github.com/users/davidism/orgs", "repos_url": "https://api.github.com/users/davidism/repos", "events_url": "https://api.github.com/users/davidism/events{/privacy}", "received_events_url": "https://api.github.com/users/davidism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 52, "state": "closed", "created_at": "2018-01-03T17:05:55Z", "updated_at": "2018-11-22T16:03:02Z", "due_on": null, "closed_at": "2018-01-03T19:06:25Z"}, "comments": 1, "created_at": "2012-05-06T09:02:19Z", "updated_at": "2020-11-13T16:38:36Z", "closed_at": "2018-01-03T18:37:38Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "Here's a patch to 0.8-maintenance that highlights a route sorting error:\n\n``` diff\ndiff --git a/werkzeug/testsuite/routing.py b/werkzeug/testsuite/routing.py\nindex de3d8bf..f9203d6 100644\n--- a/werkzeug/testsuite/routing.py\n+++ b/werkzeug/testsuite/routing.py\n@@ -175,6 +175,18 @@ class RoutingTestCase(WerkzeugTestCase):\n         assert adapter.match('/Files/downloads/werkzeug/0.2.zip') == \\\n             ('files', {'file':'downloads/werkzeug/0.2.zip'})\n\n+    def test_path_complex(self):\n+        map = r.Map([\n+            r.Rule('/', endpoint='index'),\n+            r.Rule('/static/<path:filename>', endpoint='static'),\n+            r.Rule('/<first>/', endpoint='first'),\n+            r.Rule('/<first>/<second>/', endpoint='second'),\n+            r.Rule('/<first>/<second>/<third>', endpoint='third'),\n+        ])\n+        adapter = map.bind('example.org', '/')\n+        self.assertEquals(adapter.match('/'), ('index', {}))\n+        self.assertEquals(adapter.match('/static/img/favicon.ico'), ('static', {'filename': 'img/favicon.ico'}))\n+\n     def test_dispatch(self):\n         env = create_environ('/')\n         map = r.Map([\n```\n\nThe complex route with three variables gets sorted above the route with a path, resulting in this error:\n\n```\n======================================================================\nFAIL: test_path_complex (werkzeug.testsuite.routing.RoutingTestCase)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/Users/jace/Dropbox/Projects/werkzeug/werkzeug/testsuite/routing.py\", line 188, in test_path_complex\n    self.assertEquals(adapter.match('/static/img/favicon.ico'), ('static', {'filename': 'img/favicon.ico'}))\nAssertionError: ('third', {'second': u'img', 'third': u'favicon.ico', 'first': u'static'}) != ('static', {'filename': 'img/favicon.ico'})\n```\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/185/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/185/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/183", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/183/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/183/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/183/events", "html_url": "https://github.com/pallets/werkzeug/issues/183", "id": 4341132, "node_id": "MDU6SXNzdWU0MzQxMTMy", "number": 183, "title": "datastructures.Authorization.qop should be a string, not a HeaderSet", "user": {"login": "visteya", "id": 1690090, "node_id": "MDQ6VXNlcjE2OTAwOTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1690090?v=4", "gravatar_id": "", "url": "https://api.github.com/users/visteya", "html_url": "https://github.com/visteya", "followers_url": "https://api.github.com/users/visteya/followers", "following_url": "https://api.github.com/users/visteya/following{/other_user}", "gists_url": "https://api.github.com/users/visteya/gists{/gist_id}", "starred_url": "https://api.github.com/users/visteya/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/visteya/subscriptions", "organizations_url": "https://api.github.com/users/visteya/orgs", "repos_url": "https://api.github.com/users/visteya/repos", "events_url": "https://api.github.com/users/visteya/events{/privacy}", "received_events_url": "https://api.github.com/users/visteya/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pallets/werkzeug/milestones/2", "html_url": "https://github.com/pallets/werkzeug/milestone/2", "labels_url": "https://api.github.com/repos/pallets/werkzeug/milestones/2/labels", "id": 2377222, "node_id": "MDk6TWlsZXN0b25lMjM3NzIyMg==", "number": 2, "title": "0.13", "description": "", "creator": {"login": "untitaker", "id": 837573, "node_id": "MDQ6VXNlcjgzNzU3Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/837573?v=4", "gravatar_id": "", "url": "https://api.github.com/users/untitaker", "html_url": "https://github.com/untitaker", "followers_url": "https://api.github.com/users/untitaker/followers", "following_url": "https://api.github.com/users/untitaker/following{/other_user}", "gists_url": "https://api.github.com/users/untitaker/gists{/gist_id}", "starred_url": "https://api.github.com/users/untitaker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/untitaker/subscriptions", "organizations_url": "https://api.github.com/users/untitaker/orgs", "repos_url": "https://api.github.com/users/untitaker/repos", "events_url": "https://api.github.com/users/untitaker/events{/privacy}", "received_events_url": "https://api.github.com/users/untitaker/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 22, "state": "closed", "created_at": "2017-03-10T11:39:33Z", "updated_at": "2018-01-03T17:05:47Z", "due_on": null, "closed_at": "2018-01-03T17:05:47Z"}, "comments": 1, "created_at": "2012-04-29T14:41:09Z", "updated_at": "2020-11-13T16:38:41Z", "closed_at": "2017-04-16T12:40:29Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "`datastructures.Authorization.qop` property is of type `HeaderSet`.\nThis is incorrect.  RFC 2617 states that the value of `qop` of an Authorization Request header is a single token.\n\nfrom RFC 2617, 3.2.2 The Authorization Request Header\n\n>   qop\n>    Indicates what \"quality of protection\" the client has applied to\n>     the message. If present, its value MUST be one of the alternatives\n>     the server indicated it supports in the WWW-Authenticate header.\n>     These values affect the computation of the request-digest. Note\n>     that this is a single token, not a quoted list of alternatives as\n>     in WWW- Authenticate.\n\nThis is a patch against git head which fixes this problem:\n\n```\ndiff --git a/werkzeug/datastructures.py b/werkzeug/datastructures.py\nindex 3aaeb5f..6a08929 100644\n--- a/werkzeug/datastructures.py\n+++ b/werkzeug/datastructures.py\n@@ -2301,16 +2301,14 @@ class Authorization(ImmutableDictMixin, dict):\n         It is recommended that this string be base64 or hexadecimal data.\n         Digest auth only.''')\n\n-    @property\n-    def qop(self):\n-        \"\"\"Indicates what \"quality of protection\" the client has applied to\n-        the message for HTTP digest auth.\"\"\"\n-        def on_update(header_set):\n-            if not header_set and 'qop' in self:\n-                del self['qop']\n-            elif header_set:\n-                self['qop'] = header_set.to_header()\n-        return parse_set_header(self.get('qop'), on_update)\n+    qop = property(lambda x: x.get('qop'), doc='''\n+        Indicates what \"quality of protection\" the client has applied to\n+        the message. If present, its value MUST be one of the alternatives\n+        the server indicated it supports in the WWW-Authenticate header.\n+        These values affect the computation of the request-digest. Note\n+        that this is a single token, not a quoted list of alternatives as\n+        in WWW- Authenticate.  This directive is optional\n+        Digest auth only.''')\n\n\n class WWWAuthenticate(UpdateDictMixin, dict):\n```\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/183/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/183/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/144", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/144/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/144/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/144/events", "html_url": "https://github.com/pallets/werkzeug/issues/144", "id": 2590812, "node_id": "MDU6SXNzdWUyNTkwODEy", "number": 144, "title": "Properly handle negative subprocess.call return values", "user": {"login": "julianbrost", "id": 18552, "node_id": "MDQ6VXNlcjE4NTUy", "avatar_url": "https://avatars.githubusercontent.com/u/18552?v=4", "gravatar_id": "", "url": "https://api.github.com/users/julianbrost", "html_url": "https://github.com/julianbrost", "followers_url": "https://api.github.com/users/julianbrost/followers", "following_url": "https://api.github.com/users/julianbrost/following{/other_user}", "gists_url": "https://api.github.com/users/julianbrost/gists{/gist_id}", "starred_url": "https://api.github.com/users/julianbrost/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/julianbrost/subscriptions", "organizations_url": "https://api.github.com/users/julianbrost/orgs", "repos_url": "https://api.github.com/users/julianbrost/repos", "events_url": "https://api.github.com/users/julianbrost/events{/privacy}", "received_events_url": "https://api.github.com/users/julianbrost/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}, {"id": 127559587, "node_id": "MDU6TGFiZWwxMjc1NTk1ODc=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/reloader", "name": "reloader", "color": "5319e7", "default": false, "description": null}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2011-12-17T22:24:50Z", "updated_at": "2020-11-13T15:43:32Z", "closed_at": "2018-12-01T17:05:30Z", "author_association": "NONE", "active_lock_reason": "resolved", "body": "Werkzeug simply passes the return value of `subprocess.call` to `sys.exit` in the `run_with_reloader` and `run_with_reloader` functions in `werkzeug.serving` but `subprocess.call` returns a negative value if the child was terminated by signal [0]. For example if the child segfaults, you get this:\n\n```\n$ python\nPython 2.7.2 (default, Nov 21 2011, 17:25:27) \n[GCC 4.6.2] on linux2\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> import sys\n>>> sys.exit(-11)\n$ echo $?\n245\n```\n\n[0] http://docs.python.org/library/subprocess.html#subprocess.Popen.returncode\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/144/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/144/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/pallets/werkzeug/issues/58", "repository_url": "https://api.github.com/repos/pallets/werkzeug", "labels_url": "https://api.github.com/repos/pallets/werkzeug/issues/58/labels{/name}", "comments_url": "https://api.github.com/repos/pallets/werkzeug/issues/58/comments", "events_url": "https://api.github.com/repos/pallets/werkzeug/issues/58/events", "html_url": "https://github.com/pallets/werkzeug/issues/58", "id": 872313, "node_id": "MDU6SXNzdWU4NzIzMTM=", "number": 58, "title": "werkzeug.serving.run_simple does not handle SIGTERM correctly", "user": {"login": "masklinn", "id": 6993, "node_id": "MDQ6VXNlcjY5OTM=", "avatar_url": "https://avatars.githubusercontent.com/u/6993?v=4", "gravatar_id": "", "url": "https://api.github.com/users/masklinn", "html_url": "https://github.com/masklinn", "followers_url": "https://api.github.com/users/masklinn/followers", "following_url": "https://api.github.com/users/masklinn/following{/other_user}", "gists_url": "https://api.github.com/users/masklinn/gists{/gist_id}", "starred_url": "https://api.github.com/users/masklinn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/masklinn/subscriptions", "organizations_url": "https://api.github.com/users/masklinn/orgs", "repos_url": "https://api.github.com/users/masklinn/repos", "events_url": "https://api.github.com/users/masklinn/events{/privacy}", "received_events_url": "https://api.github.com/users/masklinn/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123868513, "node_id": "MDU6TGFiZWwxMjM4Njg1MTM=", "url": "https://api.github.com/repos/pallets/werkzeug/labels/bug", "name": "bug", "color": "bc2b39", "default": true, "description": ""}], "state": "closed", "locked": true, "assignee": {"login": "aenglander", "id": 328648, "node_id": "MDQ6VXNlcjMyODY0OA==", "avatar_url": "https://avatars.githubusercontent.com/u/328648?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aenglander", "html_url": "https://github.com/aenglander", "followers_url": "https://api.github.com/users/aenglander/followers", "following_url": "https://api.github.com/users/aenglander/following{/other_user}", "gists_url": "https://api.github.com/users/aenglander/gists{/gist_id}", "starred_url": "https://api.github.com/users/aenglander/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aenglander/subscriptions", "organizations_url": "https://api.github.com/users/aenglander/orgs", "repos_url": "https://api.github.com/users/aenglander/repos", "events_url": "https://api.github.com/users/aenglander/events{/privacy}", "received_events_url": "https://api.github.com/users/aenglander/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "aenglander", "id": 328648, "node_id": "MDQ6VXNlcjMyODY0OA==", "avatar_url": "https://avatars.githubusercontent.com/u/328648?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aenglander", "html_url": "https://github.com/aenglander", "followers_url": "https://api.github.com/users/aenglander/followers", "following_url": "https://api.github.com/users/aenglander/following{/other_user}", "gists_url": "https://api.github.com/users/aenglander/gists{/gist_id}", "starred_url": "https://api.github.com/users/aenglander/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aenglander/subscriptions", "organizations_url": "https://api.github.com/users/aenglander/orgs", "repos_url": "https://api.github.com/users/aenglander/repos", "events_url": "https://api.github.com/users/aenglander/events{/privacy}", "received_events_url": "https://api.github.com/users/aenglander/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 11, "created_at": "2011-05-09T17:49:38Z", "updated_at": "2020-11-13T15:25:56Z", "closed_at": "2019-05-12T19:20:18Z", "author_association": "CONTRIBUTOR", "active_lock_reason": "resolved", "body": "When the process receives `SIGTERM`, it should shut down and exit, with as few operations as possible and without printing anything.\n\nA `werkzeug.serving.run_simple` process receiving `SIGTERM` generally result in a return code of 141 (symptom of an un/mishandled `SIGPIPE`), and when using the reloader the process goes zombie (it has to be killed manually, as the port stays bound).\n\nAdding a signal handler for `SIGTERM` which simply invokes `sys.exit(0)` is sufficient to fix the issue (in that there is no more misbehavior of the process), but I am not sure it's the actually correct fix.\n", "reactions": {"url": "https://api.github.com/repos/pallets/werkzeug/issues/58/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pallets/werkzeug/issues/58/timeline", "performed_via_github_app": null, "state_reason": "completed"}]